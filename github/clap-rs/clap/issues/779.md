---
number: 779
title: "Replace colons with newlines in crate_authors!()"
type: issue
state: closed
author: nabijaczleweli
labels:
  - C-enhancement
assignees: []
created_at: 2016-12-18T12:02:06Z
updated_at: 2018-08-02T03:29:58Z
url: https://github.com/clap-rs/clap/issues/779
synced_at: 2026-01-07T12:31:16-06:00
---

# Replace colons with newlines in crate_authors!()

---

_Issue opened by @nabijaczleweli on 2016-12-18 12:02_

Since `cargo`'s `$CARGO_PKG_AUTHORS` is `:`-separated ([source](http://doc.crates.io/environment-variables.html)), it'd be nice to replace all colons with newlines in the macro making it much more end-user-friendly, e.g. this:

```
p:\Rust\http>target\debug\http -h
http 0.1.0
thecoshman <thecoshman@gmail.com>:nabijaczleweli <nabijaczleweli@gmail.com>
Host These Things Please - a basic HTTP server for hosting a folder fast and simply
```

Would turn into this:

```
p:\Rust\http>target\debug\http -h
http 0.1.0
thecoshman <thecoshman@gmail.com>
nabijaczleweli <nabijaczleweli@gmail.com>
Host These Things Please - a basic HTTP server for hosting a folder fast and simply
```

---

_Comment by @nabijaczleweli on 2016-12-18 12:24_

With some more magic and macro hand-parsing the implementation landed on my fork (see above-referenced commit). Is it quite alright as is for a PR or...?

---

_Comment by @kbknapp on 2016-12-18 20:32_

I'm good with the idea ðŸ‘ 

What I would do is keep the `crate_authors!` macro the same, for backwards compatibility, but also add a macro arm of `crate_authors!` to allowing specifying a "replacement" character in case people want to use something like `\n\t`, etc.

---

_Comment by @kbknapp on 2016-12-18 20:38_

I.e. adding:


```rust
#[macro_export]
macro_rules! crate_authors {
    ($sep:expr) => {{
        use std::ops::Deref;
        use std::sync::{ONCE_INIT, Once};

        #[allow(missing_copy_implementations)]
        #[allow(non_camel_case_types)]
        #[allow(dead_code)]
        struct CARGO_AUTHORS {__private_field: ()}
        static CARGO_AUTHORS: CARGO_AUTHORS = CARGO_AUTHORS {__private_field: ()};

        impl Deref for CARGO_AUTHORS {
            type Target = String;

            #[allow(unsafe_code)]
            fn deref<'a>(&'a self) -> &'a String {
                unsafe {
                    static mut LAZY: (*const String, Once) = (0 as *const String, ONCE_INIT);

                    let r = &mut LAZY.0;
                    LAZY.1.call_once(|| {
                        *r = Box::into_raw(Box::new(env!("CARGO_PKG_AUTHORS").replace(':', $sep)));
                    });
                    &*LAZY.0
                }
            }
        }

        &CARGO_AUTHORS[..]
    }};
    () => {
        env!("CARGO_PKG_AUTHORS")
    };
}
```

---

_Label `C: macros` added by @kbknapp on 2016-12-18 20:40_

---

_Label `D: intermediate` added by @kbknapp on 2016-12-18 20:40_

---

_Label `P4: nice to have` added by @kbknapp on 2016-12-18 20:40_

---

_Label `T: enhancement` added by @kbknapp on 2016-12-18 20:40_

---

_Label `W: 2.x` added by @kbknapp on 2016-12-18 20:40_

---

_Comment by @nabijaczleweli on 2016-12-18 20:43_

Well, the interface does stay backwards-compatible, just the result doesn't.
Plus, it'd be nice for everyone to be able to benefit from this w/o any changes to usercode, don't you think?

So, including your suggestion, the best compat/feature compromise seems to me like:

```rust
#[macro_export]
macro_rules! crate_authors {
    ($sep:expr) => {{ /* magic */ }};
    () => {
        crate_authors!("\n")
    };
}
```

---

_Comment by @kbknapp on 2016-12-18 20:50_

> Plus, it'd be nice for everyone to be able to benefit from this w/o any changes to usercode, don't you think?

Totally agree, but what I don't want to happen is people be relying on that colon (not sure why they would...??) with no way to get it back short of calling the `env` function themselves or be handling it in their own way. And I think in this particular case, adding, `crate_authors!("\n")` seems pretty minor and easy :wink:

So for the time being at least, I'd prefer to use the compromise since we can always pull that part out later and are left with only the enhancement if we deem that worth it.

---

_Referenced in [clap-rs/clap#780](../../clap-rs/clap/pulls/780.md) on 2016-12-18 20:59_

---

_Closed by @homu on 2016-12-19 00:10_

---
