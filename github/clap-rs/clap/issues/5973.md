---
number: 5973
title: Support clearing args matches
type: issue
state: closed
author: kryvashek
labels:
  - C-enhancement
  - A-parsing
  - E-easy
assignees: []
created_at: 2025-04-17T15:41:45Z
updated_at: 2025-04-18T19:05:43Z
url: https://github.com/clap-rs/clap/issues/5973
synced_at: 2026-01-07T12:31:17-06:00
---

# Support clearing args matches

---

_Issue opened by @kryvashek on 2025-04-17 15:41_

### Please complete the following tasks

- [x] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [x] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

master

### Describe your use case

I'm trying to "merge" commands from several sources (config and CLI actually), which means when some argument has been set to its default value because of its absence in CLI this default value will also override the value from the file. This behavior can be fixed by deleting all default-set arguments from ArgMatches before merging.

But ArgMatches doesn't have any interface for removing occurrences without getting them in return. Returning occurrences (in all supported forms) requires specifying the type (i.e. ArgMatches::try_remove_occurrences). This turns out to be inconvenient when it is only needed to remove specific argument matches without utilizing related values.

### Describe the solution you'd like

Implement a method like ~~`ArgMatches::drop_occurrences(id: &str)`~~ `ArgMatches::try_clear_id(id: &str)` (see comments below), which will remove all occurrences with the given id from the current `ArgMatches` without returning them.

### Alternatives, if applicable

Provide a method for removing all default-set arguments from the current ArgMatches.

### Additional Context

_No response_

---

_Label `C-enhancement` added by @kryvashek on 2025-04-17 15:41_

---

_Referenced in [clap-rs/clap#5974](../../clap-rs/clap/pulls/5974.md) on 2025-04-17 15:43_

---

_Label `A-parsing` added by @epage on 2025-04-17 21:14_

---

_Label `S-waiting-on-design` added by @epage on 2025-04-17 21:17_

---

_Comment by @epage on 2025-04-17 21:22_

This seems like a fairly niche use case but not too much cost to adding it.  Note that for us, the costs include build times, binary size, and API bloat.

Not thrilled with the prefix `drop`.  Know of any precedence for doing that?

As for `_occurrences` suffix, I feel like that would imply this is more limited than it is.  I'd maybe go with `_id` (or prefix only if it isn't too generic like `drop`).

We should at minimum have a `try_` variant of this function.  Due to its specialized nature, I lean towards only having the `try_` variant.

As for contributing, FYI
- We ask that non-draft PRs wait until a design is selected and this is marked as ready to contribute ([source](https://github.com/clap-rs/clap/blob/master/CONTRIBUTING.md#where-to-start))
- We ask that commits be atomic which includes documentation and tests ([source](https://github.com/clap-rs/clap/blob/master/CONTRIBUTING.md#preparing-the-pr))
-We suggest that test commits can come before the feature/fix commit (though not after) when it works to highlight the role of the fix or feature.  This is done by finding a way to make the test commit pass on its own, showing the current behavior.  The fix/feature commit then updates the test to ensure it still passes.  The diff of the test between the two commits role of the PR very clear to reviewers and the community.  This can likely be skipped for this PR.  One potential way of doing it would be to use `try_remove` when you don't know the type, getting an error and that nothing changed.  In the feature commit, you can then switch to the new function and show it now works.

---

_Comment by @kryvashek on 2025-04-18 07:30_

> seems like a fairly niche use case

It is indeed. That is why I've chosen the minimally invasive change which came to my mind (instead of making some kind of `remove_all_default_set` method for example).
> Not thrilled with the prefix `drop`. Know of any precedence for doing that?

Can't remember anything right now (except for the standard function of course). I've looked at options `remove` and `clear` at start, but disregarded both. The first implied some similarity with other `remove` methods, which I found confusing since the significant difference in their behavior. And the second do the same, but with `clear()` methods of standard containers, which clear all entries without distinguishing them. In the mean time the `drop()` function implies taking some single value without returning it back, which seemed similar to targeted behavior.
> As for `_occurrences` suffix, I feel like that would imply this is more limited than it is. I'd maybe go with `_id`

It actually seems like a good idea, thanks! I'll use this suffix.
> We should at minimum have a `try_` variant of this function. Due to its specialized nature, I lean towards only having the `try_` variant.

Agree. Considering two previous remarks I suggest the name `try_delete_id`.
> We ask that non-draft PRs wait until a design is selected and this is marked as ready to contribute

I see. I'm sorry I've broken some rules. I was kinda in a hurry and even implemented the solution first, and only then created this issue. I marked the PR as draft now to be that until we come into some final decision.
> We ask that commits be atomic which includes documentation and tests

I'll fix that. And thank you for the idea about how to implement the test when method still isn't added.

By the way, considering the suggested change should I bump the patch version? I'm not quite sure.

---

_Comment by @epage on 2025-04-18 14:19_

> Can't remember anything right now (except for the standard function of course). I've looked at options remove and clear at start, but disregarded both. The first implied some similarity with other remove methods, which I found confusing since the significant difference in their behavior. And the second do the same, but with clear() methods of standard containers, which clear all entries without distinguishing them. In the mean time the drop() function implies taking some single value without returning it back, which seemed similar to targeted behavior.
>
> Agree. Considering two previous remarks I suggest the name try_delete_id.

`delete` isn't commonly used.

`drop` has somewhat similar semantics but is usually limited to actual drop operations

`clear` has the same operational semantics though a wider scope.  However, I think the suffix could help with that.

I'm leaning towards `try_clear_id`

> By the way, considering the suggested change should I bump the patch version? I'm not quite sure.

I bump versions on release.

---

_Comment by @kryvashek on 2025-04-18 14:24_

> I'm leaning towards `try_clear_id`

Ok, then i'll use this name.

Shall we consider this issue passed the design stage?

---

_Label `S-waiting-on-design` removed by @epage on 2025-04-18 14:26_

---

_Label `E-easy` added by @epage on 2025-04-18 14:26_

---

_Comment by @epage on 2025-04-18 14:26_

Yup

---

_Comment by @kryvashek on 2025-04-18 14:57_

@epage, thank you for guiding me and being patient. I've marked [the PR](https://github.com/clap-rs/clap/pull/5974) as ready to review.

---

_Closed by @epage on 2025-04-18 19:05_

---
