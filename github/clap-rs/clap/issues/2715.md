---
number: 2715
title: Support fish correct completion for nested subcommands
type: issue
state: closed
author: ModProg
labels:
  - C-bug
  - A-completion
assignees: []
created_at: 2021-08-18T14:24:27Z
updated_at: 2021-09-08T14:32:28Z
url: https://github.com/clap-rs/clap/issues/2715
synced_at: 2026-01-07T12:31:17-06:00
---

# Support fish correct completion for nested subcommands

---

_Issue opened by @ModProg on 2021-08-18 14:24_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Clap Version

master

### Describe your use case

There are two cases where the current solution does not work:
#### Simple case (can be solved with fish build-ins)
Example command syntax:
`command A B <parameter>`
`command A C <parameter>`
Currently pressing tab after writing `A` it will complete `B` as well as `C` again.

#### Complex case (we probably would need to write something our own)
Probably wont happen that often:
Two subcommand chains:
`command A B C`
`command B A D`
These are even with the simple solution not differentiable.

### Describe the solution you'd like

#### Simple Case
Instead of only requirering the parent subcommand to exist, rather also check that self and the sibling commands do not exist:
```sh
complete -c command -n "__fish_use_subcommand" -x -a "A"
complete -c command -n "__fish_seen_subcommand_from A; and not __fish_seen_subcommand_from B C" -x -a "B"
complete -c command -n "__fish_seen_subcommand_from A; and not __fish_seen_subcommand_from B C" -x -a "C"
```
#### Complex case
Not sure how to solve. Probably need something like https://github.com/clap-rs/clap/blob/a61eaf8aade76cfe90ccc0f7125751ebf60e3254/src/completions.rs#L237-L248 again.
With fish buildins `A B` and `B A` is  the same. Therefor you would get both `C` and `D` for both. The same would happen if at some point a subcommand gets repeated (maybe more likely than the `AB` `BA` example).

Insufficient solution using standard `complete` functionality
```sh
complete -c command -n "__fish_use_subcommand" -x -a "A"
complete -c command -n "__fish_use_subcommand" -x -a "B"
complete -c command -n "__fish_seen_subcommand_from A; and not __fish_seen_subcommand_from B" -x -a "B"
complete -c command -n "__fish_seen_subcommand_from B; and not __fish_seen_subcommand_from A" -x -a "A"
complete -c command -n "__fish_seen_subcommand_from A; and __fish_seen_subcommand_from B;  and not __fish_seen_subcommand_from C" -x -a "C"
complete -c command -n "__fish_seen_subcommand_from B; and __fish_seen_subcommand_from A;  and not __fish_seen_subcommand_from D" -x -a "D"
```

### Alternatives, if applicable

_No response_

### Additional Context

This is somewhat a regression see  #685 

---

_Label `T: new feature` added by @ModProg on 2021-08-18 14:24_

---

_Comment by @ModProg on 2021-08-18 14:25_

Hmm, maybe this would have been rather a bug than a feature

---

_Referenced in [clap-rs/clap#685](../../clap-rs/clap/issues/685.md) on 2021-08-18 14:28_

---

_Comment by @pksunkara on 2021-08-18 14:54_

I wouldn't worry about subcommand chains since they are not supported in clap.

---

_Label `T: new feature` removed by @pksunkara on 2021-08-18 14:54_

---

_Label `T: bug` added by @pksunkara on 2021-08-18 14:54_

---

_Label `C: generator` added by @pksunkara on 2021-08-18 14:54_

---

_Comment by @ModProg on 2021-08-18 15:11_

> I wouldn't worry about subcommand chains since they are not supported in clap.

I did not mean chained commands, I meant multiple level of subcommands, where the naming is repeating.


---

_Comment by @ModProg on 2021-08-18 15:47_

I'll have a look at how the simple version can be implemented.

---

_Referenced in [clap-rs/clap#2726](../../clap-rs/clap/pulls/2726.md) on 2021-08-19 22:45_

---

_Closed by @pksunkara on 2021-09-08 14:32_

---
