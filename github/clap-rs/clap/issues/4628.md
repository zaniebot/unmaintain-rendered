---
number: 4628
title: "Assert an argument has no default values when `contains_id` or `try_contains_id` is called"
type: issue
state: closed
author: rhysd
labels:
  - C-enhancement
assignees: []
created_at: 2023-01-11T12:35:20Z
updated_at: 2023-01-11T13:46:19Z
url: https://github.com/clap-rs/clap/issues/4628
synced_at: 2026-01-07T12:31:17-06:00
---

# Assert an argument has no default values when `contains_id` or `try_contains_id` is called

---

_Issue opened by @rhysd on 2023-01-11 12:35_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

`master`

### Describe your use case

`contains_id` and `try_contains_id` always return `true` when the argument has default values as discussed below:

- https://github.com/clap-rs/clap/discussions/4511
- https://github.com/clap-rs/clap/discussions/4575

And I also mistook the usage:

https://github.com/rhysd/hgrep/commit/e64b4b84266af15ef58c6b404d7c7b2c22abb2ba

It looks a pitfall because

- `contains_id` just works fine as replacement of `is_present` when the argument has no default values
- `ArgAction::{SetTrue,SetFalse,Count}` introduce their default values implicitly
- These methods just return a boolean value. Compiler cannot check the misuse. Users need to notice some flags are always unintentionally set to `true` by themselves.

### Describe the solution you'd like

Check if the argument has no default values with `debug_assert` in `try_contains_id` so that users can notice their mistakes while development.

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @rhysd on 2023-01-11 12:35_

---

_Referenced in [clap-rs/clap#4629](../../clap-rs/clap/pulls/4629.md) on 2023-01-11 12:39_

---

_Comment by @epage on 2023-01-11 13:08_

This is expected behavior and is why we renamed `is_present`.  We wanted to focus on the role of `ArgMatches` as a container and the container does have the ID.

---

_Closed by @epage on 2023-01-11 13:08_

---

_Comment by @rhysd on 2023-01-11 13:25_

@epage Yes, I understand that this is an expected behavior. I just wonder it might be possible to add some assertions to prevent mistakes since calling the methods which always return `true` does not make sense. Don't adding the assertions make sense to you?

---

_Comment by @epage on 2023-01-11 13:33_

No as that would be breaking the API existing contract.  There would also be nothing in the name to clarify that this only works for some args and panics for others.  Yes, it can be documented but when you rely on documentation only, you have failed your users.  The same could not be said of the existing problem you are highlighting because we renamed the functions to both intentionally break people's code and to clarify the semantics.

Besides the point
- This would be a breaking change and would have to wait until v5.
- The `try_` versions are not supposed to panic but return error messages

---

_Comment by @rhysd on 2023-01-11 13:46_

OK, I understood the points. Thank you so much for the detailed explanation.

---
