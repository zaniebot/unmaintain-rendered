---
number: 3542
title: Ability to set min_values per occurance when multiple_occurances is used
type: issue
state: closed
author: tmccombs
labels:
  - C-enhancement
  - M-breaking-change
  - A-parsing
  - E-medium
assignees: []
created_at: 2022-03-07T07:40:56Z
updated_at: 2022-08-09T22:05:26Z
url: https://github.com/clap-rs/clap/issues/3542
synced_at: 2026-01-07T12:31:17-06:00
---

# Ability to set min_values per occurance when multiple_occurances is used

---

_Issue opened by @tmccombs on 2022-03-07 07:40_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

3.1.5

### Describe your use case

I have an option that supports multiple occurrences, but each occurrence is independent, and needs a minimum of 1 value passed to it.  I'm using `grouped_values_of` to get the groups of values. If I use `.min_values(1)`, then it requires that there is at least one value in total, not that there is one value per occurance.

Here's some example code:

```rust
use clap::*; // 3.1.5

fn main() {
 let app = Command::new("test")
 .arg(Arg::new("example").short('x').min_values(1).multiple_occurrences(true).value_name("x"));
 let matches = app.get_matches_from(&["test", "-x", "a", "-x"]);
 println!("{:?}", matches);

}
```

This produces a successful match, but I want it to fail, because no argument is given to the second occurance of `-x`. 



### Describe the solution you'd like

Ideally, `.min_values` would behave as I've described. And if the current behavior is unintentional , then this is probably a bug, and it might be worth changing. However, changing `min_values`'s behavior would technically be backwards incompatible, so it may be necessary to introduce a new api like `min_values_per_occurance` (and probably a similar `max_values_per_occurance`). 

### Alternatives, if applicable

The only alternative I know of is to have the application check that enough arguments are provided to each group returned by `grouped_values_of` rather than letting clap do the validation for me.

### Additional Context

See https://github.com/sharkdp/fd/pull/960#issuecomment-1059998122.


---

_Label `C-enhancement` added by @tmccombs on 2022-03-07 07:40_

---

_Comment by @tmccombs on 2022-03-07 08:04_

See also the workaround in https://github.com/sharkdp/fd/pull/960/commits/eb65a7e1cba4481ace80f9cfe065a65742a5a66e

---

_Label `A-parsing` added by @epage on 2022-03-07 16:42_

---

_Label `E-medium` added by @epage on 2022-03-07 16:42_

---

_Label `M-breaking-change` added by @epage on 2022-03-07 16:42_

---

_Added to milestone `4.0` by @epage on 2022-03-07 16:42_

---

_Comment by @epage on 2022-03-07 16:44_

Thanks for reporting this!

I had thought we had an issue for this (because I was aware of this and agree that this should change).

However, I worry about people relying on this and we'd need to wait until 4.0, though we might be able to do it earlier as part of the `unstable-v4` feature flag.

---

_Referenced in [clap-rs/clap#3678](../../clap-rs/clap/pulls/3678.md) on 2022-05-02 19:40_

---

_Referenced in [clap-rs/clap#2688](../../clap-rs/clap/issues/2688.md) on 2022-06-15 08:21_

---

_Comment by @epage on 2022-08-09 22:05_

Missed this, its resolved via #2688.  The new `num_args` is per occurrence.

---

_Closed by @epage on 2022-08-09 22:05_

---
