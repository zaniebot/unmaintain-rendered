---
number: 4441
title: "[Derive] Way to parse long_help from doc comments excluding "
type: issue
state: closed
author: tmccombs
labels:
  - C-enhancement
  - A-help
assignees: []
created_at: 2022-11-02T07:36:23Z
updated_at: 2022-11-07T15:59:08Z
url: https://github.com/clap-rs/clap/issues/4441
synced_at: 2026-01-07T12:31:17-06:00
---

# [Derive] Way to parse long_help from doc comments excluding 

---

_Issue opened by @tmccombs on 2022-11-02 07:36_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

4.0.18

### Describe your use case

In fd, there are many options where we want to have different help messages for the "short" and "long" help. When clap parses the doc comments, it interprets the first paragraph as the short help, and the entire doc comments as the long help. This means that the long help includes the short help text as its first paragraph. There isn't a way to have a different first paragraph for the long help output than for the short help output if you use doc comments. 

Relatedly, if you have an option with `hide_short_help = true`, then you don't need any short help from the doc comment. However, by default clap strips a trailing period off the end of the first paragraph, which may not be desirable. The only way to prevent that is to use `verbatim_doc_comment`, but then you lose the automatic wrapping and whitespace cleanup. 

I'd like a way to specify the long_help in the documentation comment without including the short help.

### Describe the solution you'd like

Have an attribute on the Parser struct and/or individual attributes to specify that the first paragraph in the doc comment should be passed to help and the remainder, excluding the first paragraph, should be used for the long_help. If the doc comment begins with two blank lines, then use the full comment as the long_help, and don't set a `help`:


```rust
#[derive(Parser)] 
#[command(name = "mycommand", distinct_doc_comment_help = true)]
pub struct Opts {
    /// This is the short help
    /// 
    /// This is the long help. 
    #[arg(short = 'a')]
    pub a: bool,
    ///
    ///
    /// This option only has a long_help.
    ///
    /// And it includes both paragraphs. The first period isn't 
    /// removed.
    #[arg(long, hide_short_help = true)]
    pub hidden_option: bool,
    /// This is in both.
    ///
    /// This option includes the first paragraph in both the short and long help messages.
    #[arg(short = 'c', distinct_doc_comment_help = false)]
    pub c: bool, 
}
```

The name of the attribute could probably be improved.


### Alternatives, if applicable

1. Change the behavior to never include the first paragraph in the long_help. This would break backwards compatibility, and might be inconvenient in the case you do want the same paragraph in both.
2.  Have some kind of special syntax in the doc comment itself to indicate where to split between the short help and the long help. Possibly with some way to indicate you want to include the short help at the beginning of the long help.
3. Just stop removing the trailing period when generating `long_help`. This helps in the case where `hide_short_help` is true, but not in the more general case where you want different text for the first paragraph of the long and short help.
4. Do nothing. It is possible to work around this by passing strings to `help` and `long_help`, although that is certainly less convenient than being able to use doc coumments (this is what fd currently does).

### Additional Context

Something that occurred to me, although I haven't needed it yet is, what if you want multiple paragraphs in the short help? Currently I don't think you can do that with the doc comment parser, and you have to manually use the `help=` attribute. 

---

_Label `C-enhancement` added by @tmccombs on 2022-11-02 07:36_

---

_Comment by @epage on 2022-11-02 15:01_

> In fd, there are many options where we want to have different help messages for the "short" and "long" help. When clap parses the doc comments, it interprets the first paragraph as the short help, and the entire doc comments as the long help. This means that the long help includes the short help text as its first paragraph. There isn't a way to have a different first paragraph for the long help output than for the short help output if you use doc comments.

Why not specify `#[arg(help = "")]` and leave the doc comment only for the long help?

> Relatedly, if you have an option with hide_short_help = true, then you don't need any short help from the doc comment. However, by default clap strips a trailing period off the end of the first paragraph, which may not be desirable. The only way to prevent that is to use verbatim_doc_comment, but then you lose the automatic wrapping and whitespace cleanup.

If short help is hidden, why does it matter what clap sets it to?

---

_Label `A-help` added by @epage on 2022-11-02 15:01_

---

_Comment by @tmccombs on 2022-11-02 15:42_

> Why not specify #[arg(help = "")] and leave the doc comment only for the long help?

I thought I tried that, and it didn't set the long_help at all. I could be misremembering though. 

That does still have the problem that it strips the "." off the end of the first paragraph though.

> If short help is hidden, why does it matter what clap sets it to?

It doesn't. In this case my main issue is that it still strips the "." off the end of the first paragraph (if it is there). 

---

_Comment by @epage on 2022-11-02 19:00_

so if I'm understanding correctly, clap is modifying the long help?

---

_Comment by @tmccombs on 2022-11-03 05:38_

Yeah, I just retried using `#[arg(help = "...")]` witha doc comment, like this:

```
    /// Show search results from files and directories that would otherwise be
    /// ignored by '.gitignore' files. The flag can be overridden with --ignore-vcs.
    #[arg(
        long,
        hide_short_help = true,
        help = "Do not respect .gitignore files",
    )]
    pub no_ignore_vcs: bool,
```


and for the long help it shows "Do not respect .gitignore files" instead of what is in the doc comment.  (if I rem ove `hide_short_help = true` it shows the same thing in the short help).

And if I remove the `help = ` line, then the long help shows:

```
      --no-ignore-vcs
          Show search results from files and directories that would otherwise be ignored by
          '.gitignore' files. The flag can be overridden with --ignore-vcs
```

Note that while there is a period at the end of the text in the doc comment, it is missing in the help text. The [documentation for derive](https://docs.rs/clap/latest/clap/_derive/index.html#pre-processing) does mention this:

> If the first paragraph ends in exactly one period, remove the trailing period (i.e. strip trailing periods but not trailing ellipses).

If specifying a `help = ` didn't impact the use of the doc comment for the long_help, and the period at the end of the first paragraph isn't removed, then that would be a pretty good solution to this as well. 


---

_Comment by @epage on 2022-11-03 14:32_

Turns out that `help =` is not impacting the long help but is overriding the short help set by the doc comment.  As the doc comment looks like short help only (single "line"), we never set `long_help`.  Long help is visually different than short help and not every application wants long help, so we key off of the presence of `long_help` for rendering `--help` differently than `-h`.

---

_Comment by @tmccombs on 2022-11-07 07:13_

hmm, what if `long_help` was allowed without an argument in the attribute, which would force the passing the doc comment to the long_help method, even if it is a single paragraph. And then do something about the period truncation (either don't remove it if it is long help, have a separate option for it, or just get rid of it altogether). 

---

_Comment by @epage on 2022-11-07 13:43_

I think that makes sense.  I would lean towards treating whatever is present as long help which means no period removal

---

_Referenced in [clap-rs/clap#4461](../../clap-rs/clap/pulls/4461.md) on 2022-11-07 15:42_

---

_Closed by @epage on 2022-11-07 15:59_

---
