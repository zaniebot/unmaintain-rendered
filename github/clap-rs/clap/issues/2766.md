---
number: 2766
title: "Don't suggest `--` in errors if it isn't relevant"
type: issue
state: open
author: silvioprog
labels:
  - C-enhancement
  - A-help
  - E-medium
assignees: []
created_at: 2021-09-09T18:54:41Z
updated_at: 2023-07-21T19:45:19Z
url: https://github.com/clap-rs/clap/issues/2766
synced_at: 2026-01-07T12:31:17-06:00
---

# Don't suggest `--` in errors if it isn't relevant

---

_Issue opened by @silvioprog on 2021-09-09 18:54_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Clap Version

3.0.0-beta.4

### Describe your use case

Hi.

Assuming I have an `args.rs` file:

```rust
use clap::Clap;

#[derive(Debug, Clap)]
pub struct Args {
    #[clap(short)]
    pub metric: bool,
    #[clap(short)]
    pub imperial: bool,
}

```

and a `main.rs`:

```rust
use clap::Clap;

mod args;

fn main() {
    let args = args::Args::parse();
    println!("{:?}", args);
}
```

if I call the executable like this (passing an invalid flag):

```bash
./target/debug/teste -d
```

it returns this message:

```
error: Found argument '-d' which wasn't expected, or isn't valid in this context

        If you tried to supply `-d` as a value rather than a flag, use `-- -d`

USAGE:
    teste [FLAGS]

For more information try --help

```

### Describe the solution you'd like

It would be nice any global configuration in Clap to avoid suggestions like `-- -x`. The message would be like this, which is much clear for the user (since the application contains only two optional flags):

```
error: Found argument '-d' which wasn't expected, or isn't valid in this context

USAGE:
    teste [FLAGS]

For more information try --help
```

or:

```
error: Found argument '-d' which wasn't expected, or isn't valid

USAGE:
    teste [FLAGS]

For more information try --help
```

or even:

```
error: Found argument '-d' which isn't valid

USAGE:
    teste [FLAGS]

For more information try --help
```

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `T: new feature` added by @silvioprog on 2021-09-09 18:54_

---

_Label `T: new feature` removed by @pksunkara on 2021-09-09 19:02_

---

_Label `T: enhancement` added by @pksunkara on 2021-09-09 19:02_

---

_Comment by @pksunkara on 2021-09-09 19:02_

@ldm0 Can we skip that if the subcommand we are parsing doesn't have any args with multiple values?

---

_Assigned to @ldm0 by @ldm0 on 2021-09-10 04:50_

---

_Label `C: errors` added by @pksunkara on 2021-09-24 19:31_

---

_Label `D: easy` added by @pksunkara on 2021-09-24 19:31_

---

_Referenced in [epage/clapng#206](../../epage/clapng/issues/206.md) on 2021-12-06 21:22_

---

_Label `C: errors` removed by @epage on 2021-12-08 20:24_

---

_Label `A-help` added by @epage on 2021-12-08 20:24_

---

_Renamed from "Allow to show less verbose messages or avoid unsupported suggestions" to "Don't suggest `--` in errors if it isn't relevant" by @epage on 2021-12-13 17:51_

---

_Label `D: easy` removed by @epage on 2021-12-13 17:51_

---

_Label `E-medium` added by @epage on 2021-12-13 17:51_

---

_Referenced in [clap-rs/clap#4379](../../clap-rs/clap/issues/4379.md) on 2022-10-13 12:12_

---

_Comment by @matklad on 2022-10-13 12:18_

Two extra points: 

* this is a regression from clap2
* subjectively, this is feels like a huge problem: 
  * it's very easy for the end-user to trigger this behavior (eg, anything with subcommands with non-global optiosn)
  * wrong error suggestions make it much harder for the end-user to fix their problem
  * the particular way this plays out is quite frustrating for the end user

---

_Comment by @epage on 2022-10-13 14:03_

For extra context, #1284 is the original issue and #1514 is the original PR

---

_Comment by @epage on 2022-10-13 14:09_

@matklad could you expand further on those points so that we better balance the different needs when coming up with a solution.

For example

> it's very easy for the end-user to trigger this behavior (eg, anything with subcommands with non-global optiosn)

I'm assuming the problem is: "When running a subcommand, I assumed some flags were global and put them after the subcommand and it failed, producing this message which doesn't apply to my situation"

If we made the message conditioned on there being positional arguments, that'll make it so we never show it when it isn't applicable but it can still show up in the workflow you mentioned if the subcommand has positional arguments.  This is one of the points I'm trying to understand since by the direction and strength of your comments it sounds like that wouldn't be acceptable but I want to understand why. 

> the particular way this plays out is quite frustrating for the end user

What was it that was so frustrating with it?  If you ended up going down the wrong path, what was it about the message that you went that way?  I'm trying to understand what is so frustrating about this when to me it clearly articulates when the suggestion is relevant.  This doesn't mean that you wrong but that you have a different perspective that we need to incorporate in handling this.

---

_Comment by @matklad on 2022-10-13 14:30_

>I'm assuming the problem is: "When running a subcommand, I assumed some flags were global and put them after the subcommand and it failed, producing this message which doesn't apply to my situation"

Yeah. And, in particular, this seems to be a very frequent problem, rather than an obscure edge case. More generally, it seems to me that more or less any mistake in the args leads to "If you tried to supply ..." message (although often with a more relevant suggestion as well), but the probability that I actually indeed meant to pass `--` is very low. It's a bit like if `rustc` added "you could try `unsafe { &(*x as *const _)}`" as a suggestion for "variable does not live long enough" error. There *are* rare cases where that'd be a correct suggestion, but they are very rare. 

> What was it that was so frustrating with it?

Several things:

* confident wrong suggestion which sends me down the wrong path
* the fact that if I try to follow the suggestion, I got echoed the same advice

```
λ cargo run -p neard -- init --home h
    Finished dev [unoptimized + debuginfo] target(s) in 0.16s
     Running `target/debug/neard init --home h`
error: Found argument '--home' which wasn't expected, or isn't valid in this context

	If you tried to supply `--home` as a value rather than a flag, use `-- --home`

USAGE:
    neard init [OPTIONS]
```

```
λ cargo run -p neard -- init -- --home h
    Finished dev [unoptimized + debuginfo] target(s) in 0.16s
     Running `target/debug/neard init -- --home h`
error: Found argument '--home' which wasn't expected, or isn't valid in this context

	If you tried to supply `--home` as a value rather than a flag, use `-- --home`

USAGE:
    neard init [OPTIONS]

For more information try --help
```

* the realization that not only it's a wrong suggestion for my situation, but that this can't be a correct suggestion at all (because there's nothing to take the value in this particular CLI)

More generally, features which make life more complicated with comparison to a hypothetical where such feature did't exist create a feeling of frustration.

---

_Comment by @epage on 2022-10-13 14:36_

> confident wrong suggestion which sends me down the wrong path

It had a condition on the suggestion.  What was unclear about the condition that you thought it applied (since you were trying to pass a flag instead of a value)?  Or is it a case of "scan and just do what it says", missing the condition?

---

_Comment by @epage on 2022-10-13 14:37_

> but the probability that I actually indeed meant to pass -- is very low

I can understand in this case.  I have personally been in the same situation as #1284 many times and haven't even considered using `--` and would have found this helpful.

---

_Comment by @matklad on 2022-10-13 14:55_

>Or is it a case of "scan and just do what it says", missing the condition?

Exactly this: I am a user in a hurry, whose mind is occupied by an unrelated problem. I don't have mental space to carefully consider if-then-else clauses. If a tool suggests some solution, my assumption is that that indeed is the most probable fix.

> many times and haven't even considered using -- and would have found this helpful.

Exactly: there are some **specific** contexts where `--` is useful, but they are rare in comparison to all the contexts where `--` is *not* useful. Off the top of my head, I recall only two instances where I do want to pass `--foo` as a value: 

* "take the rest of the argumetns to pass through to another binary" (`cargo run`)
* "needle" argument for text searches

That's sort of Bayes' rule, baseline probabilities matter. 

There's a bunch of ways we can make this more specific: 

* don't suggest if the suggestion is guaranteed to be wrong
* suggest only when we do expect a value and miss one (mandatory positional arg or switch)
* suggest only in highly-likely situations (trailing args pattern)
* add API to flag a specific argument with "hey, the value here might start with `-`", which would affect both default help and error messages. 

---

_Referenced in [clap-rs/clap#4380](../../clap-rs/clap/pulls/4380.md) on 2022-10-13 16:21_

---

_Comment by @epage on 2022-10-13 18:27_

For now, #4380 limits the `--` suggestion to only if
- `--` hasn't already been used
- positional arguments exist
- a short or long was passed in (refinement of existing condition)

Something I've also been considering for both clap and cargo is following [the rustc diagnostic guidelines](https://rustc-dev-guide.rust-lang.org/diagnostics.html#suggestion-style-guide) of not suggesting things to users but informing users what exist.

EDIT: To be clear, I'm leaving this open to encourage further discussion on the overall direction

---

_Referenced in [clap-rs/clap#4385](../../clap-rs/clap/pulls/4385.md) on 2022-10-13 19:04_

---

_Comment by @epage on 2022-10-13 19:05_

I've created #4385 to tweak the wording of the suggestions.  It could probably use some more work and I'm hesitant in doing a change like this in a patch release as people might design some of their own CLI to match clap and changing it could provide a degraded experience, so we might want to call attention to this by saving it for a minor release.

---

_Comment by @epage on 2022-10-13 19:13_

 v4.0.15 is released with #4380.

---

_Comment by @Nemo157 on 2023-06-29 11:04_

#4380 (or changes since then since that was quite some time ago) doesn't help with subcommands:

```console
> sshagmux lis
error: unrecognized subcommand 'lis'

  tip: a similar subcommand exists: 'list'
  tip: to pass 'lis' as a value, use 'sshagmux -- lis'

Usage: sshagmux <COMMAND>

For more information, try '--help'.
```

There is nowhere for "values" to go, and in fact trying to use this form emits the exact same error message

```console
> sshagmux -- lis
error: unrecognized subcommand 'lis'

  tip: a similar subcommand exists: 'list'
  tip: to pass 'lis' as a value, use 'sshagmux -- lis'

Usage: sshagmux <COMMAND>

For more information, try '--help'.
```

---

_Referenced in [clap-rs/clap#5033](../../clap-rs/clap/pulls/5033.md) on 2023-07-21 19:27_

---

_Comment by @epage on 2023-07-21 19:45_

That is fixed in v4.3.18 by #5033

---

_Referenced in [clap-rs/clap#5055](../../clap-rs/clap/issues/5055.md) on 2023-08-08 02:38_

---
