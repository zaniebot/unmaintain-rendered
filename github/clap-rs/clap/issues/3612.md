---
number: 3612
title: "Parser: unable to get multiple required fields using use_value_delimiter"
type: issue
state: closed
author: samueltardieu
labels:
  - C-bug
  - A-parsing
  - E-medium
assignees: []
created_at: 2022-04-05T13:24:08Z
updated_at: 2022-05-04T18:15:09Z
url: https://github.com/clap-rs/clap/issues/3612
synced_at: 2026-01-07T12:31:17-06:00
---

# Parser: unable to get multiple required fields using use_value_delimiter

---

_Issue opened by @samueltardieu on 2022-04-05 13:24_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.61.0-nightly (76d770ac2 2022-04-02)

### Clap Version

clap 3.1.8

### Minimal reproducible code

```rust
use clap::Parser;

#[derive(Parser)]
struct Args {
    #[clap(use_value_delimiter(true), required(true))]
    hosts: Vec<String>,
    #[clap(use_value_delimiter(true), required(true))]
    ports: Vec<u16>,
}

fn main() {
  let _args = Args::parse();
}
```


### Steps to reproduce the bug with the above code

# Command 1 should give the help message
cargo run

# Command 2 should parse correctly
cargo run -- google.com,yahoo.com 80,443

### Actual Behaviour

In both commands, I get:

```
thread 'main' panicked at 'Only one positional argument with .multiple_values(true) set is allowed per command, unless the second one also has .last(true) set', /home/sam/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.8/src/build/debug_asserts.rs:494:9
```


### Expected Behaviour

Since we use `use_value_delimiter(true)` and `required(true)`, there is no ambiguity in parsing the command line. We should get the help info on command 1, and nothing on command 2 since it should parse correctly.


### Additional Context

_No response_

### Debug Output

```
[        clap::build::command] 	App::_do_parse
[        clap::build::command] 	App::_build
[        clap::build::command] 	App::_propagate:xx
[        clap::build::command] 	App::_check_help_and_version: xx
[        clap::build::command] 	App::_check_help_and_version: Removing generated version
[        clap::build::command] 	App::_propagate_global_args:xx
[        clap::build::command] 	App::_derive_display_order:xx
[  clap::build::debug_asserts] 	Command::_debug_asserts
[  clap::build::debug_asserts] 	Arg::_debug_asserts:help
[  clap::build::debug_asserts] 	Arg::_debug_asserts:hosts
[  clap::build::debug_asserts] 	Arg::_debug_asserts:ports
[  clap::build::debug_asserts] 	Command::_verify_positionals
thread 'main' panicked at 'Only one positional argument with .multiple_values(true) set is allowed per command, unless the second one also has .last(true) set', /home/sam/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.1.8/src/build/debug_asserts.rs:494:9
```

---

_Label `C-bug` added by @samueltardieu on 2022-04-05 13:24_

---

_Comment by @epage on 2022-04-05 14:03_

The more complete example to have no ambiguity is
```rust
use clap::Parser;

#[derive(Parser)]
struct Args {
    #[clap(
        use_value_delimiter = true,
        require_value_delimiter = true,
        required = true,
        multiple_occurrences = false,
        multiple_values = true
    )]
    hosts: Vec<String>,
    #[clap(
        use_value_delimiter = true,
        require_value_delimiter = true,
        required = true,
        multiple_occurrences = false,
        multiple_values = true
    )]
    ports: Vec<u16>,
}

fn main() {
    let _args = Args::parse();
}
```
- `Vec` defaults to `multiple_occurrences`, so we need to switch it to `multiple_values`
- We need to not just allow using value delimiters but require it

And yes, this could be supported.  We'll need to double check that not just the debug asserts support this but that the parser won't get confused.

---

_Label `A-parsing` added by @epage on 2022-04-05 14:03_

---

_Label `E-medium` added by @epage on 2022-04-05 14:03_

---

_Comment by @epage on 2022-05-04 18:15_

I just ran the unambiguous version and it fully works.  Going ahead and closing this out.  If there is something else I missed in this issue, let me know!

---

_Closed by @epage on 2022-05-04 18:15_

---
