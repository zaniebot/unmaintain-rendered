---
number: 1246
title: textwrap is confused by ColoredHelp
type: issue
state: closed
author: vincentdephily
labels:
  - C-bug
  - A-help
assignees: []
created_at: 2018-04-13T09:25:52Z
updated_at: 2021-12-10T02:16:37Z
url: https://github.com/clap-rs/clap/issues/1246
synced_at: 2026-01-07T12:31:16-06:00
---

# textwrap is confused by ColoredHelp

---

_Issue opened by @vincentdephily on 2018-04-13 09:25_

This presumably depends on #836

### Rust Version
1.25.0

### Affected Version of clap
2.31.2

### Expected Behavior Summary
Displaying colored help should use the available `term_width`.
```
    -f <foo>                        Many colored values make this obvious [default: a]  [possible values: a, b, c, d, e,
                                    f, g, h, i, j]
```

### Actual Behavior Summary
The escape sequences make the `String` look long to the text wrapper, but not to the user, and the newline arrive long before the visible `term_width`.
```
    -f <foo>                        Many colored values make this obvious [default: a]  [possible values:
                                    a, b, c, d, e, f, g, h,
                                    i, j]
```

### Steps to Reproduce the issue
Take this App definition and run it either normally (colored) or piped to `cat` (non-colored).
```rust
    let args = app_from_crate!()
        .global_setting(AppSettings::ColoredHelp)
        .arg(Arg::with_name("foo")
             .help("Many colored values make this obvious")
             .short("f")
             .takes_value(true) 
             .possible_values(&["a","b","c","d","e","f","g","h","i","j"])
             .default_value("a"))
     .get_matches();
```


---

_Comment by @kbknapp on 2018-05-22 18:25_

Sorry for the long wait, I've been out with my day job. 

I looks like the unprinted color codes are what's confusing it. 

@mgeisler this looks like it might be on your end :wink: 

---

_Label `C: upstream crate / dep` added by @kbknapp on 2018-05-22 18:27_

---

_Referenced in [mgeisler/textwrap#140](../../mgeisler/textwrap/issues/140.md) on 2018-05-22 19:25_

---

_Comment by @mgeisler on 2018-05-22 19:26_

Hi guys, yeah, that is something textwrap should be able to handle better! Thanks for the great bug report, I've added an issue for it in my tracker: mgeisler/textwrap#140.

---

_Added to milestone `3.0` by @pksunkara on 2020-04-09 07:23_

---

_Assigned to @pksunkara by @pksunkara on 2020-04-11 14:55_

---

_Label `W: blocking on external` added by @pksunkara on 2020-04-11 15:59_

---

_Removed from milestone `3.0` by @pksunkara on 2020-04-11 15:59_

---

_Added to milestone `3.1` by @pksunkara on 2020-04-11 15:59_

---

_Removed from milestone `3.1` by @pksunkara on 2020-04-11 15:59_

---

_Unassigned @pksunkara by @pksunkara on 2020-04-11 15:59_

---

_Added to milestone `3.1` by @pksunkara on 2020-04-14 21:57_

---

_Comment by @pksunkara on 2020-04-14 22:06_

This is fixed in #1824 because I removed the colors for arg metadata. Re-adding them back will be addressed in #1456. And that should address this properly. Keeping this open until then.

---

_Label `C: help message` added by @pksunkara on 2020-04-14 22:06_

---

_Label `C: upstream crate / dep` removed by @pksunkara on 2020-04-14 22:07_

---

_Label `C: colorizing` added by @pksunkara on 2020-04-15 09:31_

---

_Referenced in [mgeisler/textwrap#179](../../mgeisler/textwrap/pulls/179.md) on 2020-04-15 23:49_

---

_Comment by @CreepySkeleton on 2020-06-30 13:07_

The linked `textwrap` issue has been closed, so this is _probably_ fixed. We would need to check again nonetheless.

---

_Comment by @pksunkara on 2020-06-30 23:08_

I removed the colors from being sent to textwrap. That still doesn't solve this issue because we are now not coloring the possible/default values. Let's keep this open until that is fixed.

---

_Label `W: blocking on external` removed by @pksunkara on 2021-05-26 11:04_

---

_Referenced in [epage/clapng#93](../../epage/clapng/issues/93.md) on 2021-12-06 17:35_

---

_Label `C: colorizing` removed by @epage on 2021-12-08 20:23_

---

_Label `T: bug` added by @epage on 2021-12-08 20:23_

---

_Removed from milestone `3.1` by @epage on 2021-12-08 20:23_

---

_Comment by @epage on 2021-12-09 18:21_

So it sounds like we've implemented a hack (remove coloring) and textwrap has a permanent fix even if we undo the hack.

@pksunkara what would be the reason for keeping this open?

---

_Comment by @pksunkara on 2021-12-10 02:16_

I think I wanted this open to give more context for #1456.

---

_Closed by @pksunkara on 2021-12-10 02:16_

---
