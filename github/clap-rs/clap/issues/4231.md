---
number: 4231
title: "[clap_mangen] Subcommand references in man pages miss prefix"
type: issue
state: closed
author: dnaka91
labels:
  - C-bug
  - E-help-wanted
  - E-easy
  - A-man
assignees: []
created_at: 2022-09-19T06:58:50Z
updated_at: 2024-01-12T22:40:49Z
url: https://github.com/clap-rs/clap/issues/4231
synced_at: 2026-01-07T12:31:17-06:00
---

# [clap_mangen] Subcommand references in man pages miss prefix

---

_Issue opened by @dnaka91 on 2022-09-19 06:58_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.63.0 (4b91a6ea7 2022-08-08)

### Clap Version

v3.2.22 (clap_mangen v0.1.11)

### Minimal reproducible code

```rust
#[derive(Parser)]
#[clap(about, author, version)]
struct Opt {
    #[clap(subcommand)]
    cmd: Option<Command>,
}

#[derive(Subcommand)]
enum Command {
    Check {
        file: PathBuf,
    },
    Manpages {
        dir: PathBuf,
    },
    #[clap(subcommand)]
    Temp(TempCommand),
}

#[derive(Subcommand)]
enum TempCommand {
    TestA,
    TestB,
}
```


### Steps to reproduce the bug with the above code

Create a dir `temp` in the current pwd and run a basic app with the above setup with `cargo run -- manpages temp`. As implementation for creating the manpages I use the below code:

```rust
fn print_manpages(dir: &Path) -> Result<()> {
    fn print(dir: &Path, app: &App) -> Result<()> {
        // `get_display_name()` is `Some` for all instances, except the root.
        let name = app.get_display_name().unwrap_or_else(|| app.get_name());
        let mut out = File::create(dir.join(format!("{name}.1")))?;

        clap_mangen::Man::new(app.clone()).render(&mut out)?;
        out.flush()?;

        for sub in app.get_subcommands() {
            print(dir, sub)?;
        }

        Ok(())
    }

    let mut app = Opt::command();
    app.build();

    print(dir, &app)
}
```

### Actual Behaviour

In the end of the man pages, the direct subcommands are listed as additional man page files. The sum of all these references are as follows:


- `sample-check(1)`
- `sample-manpages(1)`
- `sample-temp(1)`
- `temp-test-a(1)` <-- missing sample- prefix
- `temp-test-b(1)` <-- missing sample- prefix


### Expected Behaviour

As seen above, the last two references miss the expected prefix. The actual existing file name is right, but the names inside the man pages are wrong. The expected names would be:


- `sample(1)`
- `sample-check(1)`
- `sample-manpages(1)`
- `sample-temp(1)`
- `sample-temp-test-a(1)`
- `sample-temp-test-b(1)`


### Additional Context

Originally mentioned in discussion https://github.com/clap-rs/clap/discussions/3603, now extracted here as issue.

### Debug Output

_No response_

---

_Label `C-bug` added by @dnaka91 on 2022-09-19 06:58_

---

_Label `E-easy` added by @epage on 2022-09-19 14:14_

---

_Label `A-man` added by @epage on 2022-09-19 14:14_

---

_Label `E-help-wanted` added by @epage on 2022-09-20 14:30_

---

_Referenced in [clap-rs/clap#4255](../../clap-rs/clap/pulls/4255.md) on 2022-09-24 18:04_

---

_Closed by @epage on 2022-09-29 18:07_

---

_Comment by @BoostCookie on 2023-10-23 11:49_

The man pages have correct file names now, but the content of a page only shows the subcommand name under NAME and SYNOPSIS.
I would expect it to look like `man git-commit`
```
NAME
       git-commit - Record changes to the repository

SYNOPSIS
       git commit [-a | --interactive | --patch] [-s] [-v] [-u<mode>] [--amend]
       ...
```
But `clap_mangen` would generate the following
```
NAME
       commit - Record changes to the repository

SYNOPSIS
       commit [-a | --interactive | --patch] [-s] [-v] [-u<mode>] [--amend]
       ...
```
So the parent command is missing in the page.

---

_Comment by @Will-Shanks on 2024-01-12 21:34_

I'm running into the same problem as @BoostCookie, would it make sense to reopen this or should I submit a new issue @epage? I'd be happy to work on a PR if this change is agreeable.

---

_Comment by @epage on 2024-01-12 22:40_

Feel free

---

_Referenced in [clap-rs/clap#5301](../../clap-rs/clap/pulls/5301.md) on 2024-01-13 02:42_

---

_Referenced in [clap-rs/clap#5331](../../clap-rs/clap/pulls/5331.md) on 2024-01-28 02:44_

---
