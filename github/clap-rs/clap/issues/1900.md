---
number: 1900
title: Type no longer available for shells
type: issue
state: closed
author: alerque
labels:
  - C-bug
  - A-completion
assignees: []
created_at: 2020-05-02T23:03:56Z
updated_at: 2021-03-11T15:55:08Z
url: https://github.com/clap-rs/clap/issues/1900
synced_at: 2026-01-07T12:31:17-06:00
---

# Type no longer available for shells

---

_Issue opened by @alerque on 2020-05-02 23:03_

Using StructOpt, I was able to parse an option like this:

```rust
stuct Cli {
    /// Output Bash, Fish, Zsh, PowerShell, or Elvish shell completion rules
    #[structopt(long)]
    completions: clap::Shell,
}
```

(Where `clap` here was the re-exported one StructOpt provided.)

This made it really easy to parse `myapp --completions zsh` while only accepting valid shells with completion generators. Nothing like `myapp --completions foo` would be accepted, but all the known shells were. This was really easy to pass to the generator.

Using the new derive system from Git HEAD there doesn't seem to be any way to do this any more. There are type objects that all implement a common interface, but I don't see a way to use that to automatically get the right values filled in here.

---

_Label `T: bug` added by @alerque on 2020-05-02 23:03_

---

_Comment by @pksunkara on 2020-05-03 06:59_

We made it `clap_generate` separate and rewrote it a bit. There's no `Shell` anymore because I made the generator agnostic and to be able to generate for other stuff and not only shells. If you need an enum like that you should probably write one yourself.

---

_Comment by @alerque on 2020-05-03 07:31_

I understand the refactoring was to make it more extensible to other types of things in the future, but this is also an ergonomics regression coming from StructOpt. Given that the modules does have a fixed list of shells that are supported out of the box it seems like providing an enum and the ability to type cast like this would be an appropriate thing to do as part of the module.

---

_Comment by @kbknapp on 2020-05-04 17:15_

@pksunkara I like the re-write, but I also think it'd nice to add a shell enum that dispatches the proper completion type. I haven't dug into it too deep yet, so it's hard for me to say if it should only include the currently supported shells, or all completion types...

Alternatively, we could so something as simple as provide an example, or clearly in the docs show how to create this enum and dispatch to the corresponding type. I agree it's pretty simple task, but to ease the transition from 2.x/structopt to 3.x, it'd help with this use case.

This is especially useful for the CLIs that provide the completion script generation at runtime via some CLI option (a la `rustup` with `rustup completions <shell>`).

---

_Comment by @pksunkara on 2020-05-04 18:46_

Yeah, I think we should probably provide `clap_generate::Shell` enum for the ones we have autocompletions available.

---

_Comment by @CreepySkeleton on 2020-05-04 19:12_

This enum will need to be `#[non_exhaustive]`. Who knows which shells we will add in future?

---

_Added to milestone `3.0` by @pksunkara on 2020-05-05 08:39_

---

_Assigned to @pksunkara by @pksunkara on 2020-05-14 08:52_

---

_Label `C: generator` added by @pksunkara on 2020-08-23 05:05_

---

_Label `:money_with_wings: $5` added by @pksunkara on 2020-08-23 05:06_

---

_Unassigned @pksunkara by @pksunkara on 2020-08-23 05:07_

---

_Label `:money_with_wings: $5` removed by @pksunkara on 2020-10-25 20:01_

---

_Assigned to @pksunkara by @pksunkara on 2020-10-25 20:02_

---

_Comment by @pksunkara on 2021-02-28 12:32_

@logansquirel This is easy.

---

_Referenced in [clap-rs/clap#2407](../../clap-rs/clap/pulls/2407.md) on 2021-03-11 06:56_

---

_Closed by @pksunkara on 2021-03-11 15:54_

---

_Unassigned @pksunkara by @pksunkara on 2021-03-11 15:55_

---
