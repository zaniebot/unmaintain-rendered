---
number: 2459
title: Positional argument and subcommands interfere with each other
type: issue
state: closed
author: htejun
labels: []
assignees: []
created_at: 2021-04-30T10:52:16Z
updated_at: 2021-04-30T11:10:24Z
url: https://github.com/clap-rs/clap/issues/2459
synced_at: 2026-01-07T12:31:17-06:00
---

# Positional argument and subcommands interfere with each other

---

_Issue opened by @htejun on 2021-04-30 10:52_

<!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

### Rust Version

rustc 1.51.0 (2fd73fabe 2021-03-23)

### Affected Version of clap

2.33.3

### Expected Behavior Summary

Given the following source code:
```
fn main() {
    clap::App::new("test")
        .args_from_usage("<REQUIRED_POSITIONAL> 'required positional argument'")
        .subcommand(clap::SubCommand::with_name("test").about("test subcommand"))
        .get_matches();
}
```
All of the following three invocations should parse successfully:
```
test-clap out test
test-clap test.out test
test-clap test test
```

### Actual Behavior Summary

The last two fail.
```
$ target/debug/test-clap out test
$ target/debug/test-clap test.out test
error: The subcommand 'test.out' wasn't recognized
        Did you mean 'test'?

If you believe you received this message in error, try re-running with 'test-clap -- test.out'

USAGE:
    test-clap <REQUIRED_POSITIONAL> [SUBCOMMAND]

For more information try --help
$ target/debug/test-clap test test
error: Found argument 'test' which wasn't expected, or isn't valid in this context

USAGE:
    test-clap <REQUIRED_POSITIONAL> test

For more information try --help
```

### Steps to Reproduce the issue

Build the program from expected behavior summary and run the program with the commands from expected behavior summary.

### Sample Code or Link to Sample Code

```
fn main() {
    clap::App::new("test")
        .args_from_usage("<REQUIRED_POSITIONAL> 'required positional argument'")
        .subcommand(clap::SubCommand::with_name("test").about("test subcommand"))
        .get_matches();
}
```

### Debug output

<details>
<summary> Debug Output </summary>
<pre>
<code>
$ target/debug/test-clap test.out test
DEBUG:clap:UsageParser::from_usage;
DEBUG:clap:UsageParser::new: usage="<REQUIRED_POSITIONAL> \'required positional argument\'"
DEBUG:clap:UsageParser::parse;
DEBUG:clap:UsageParser::parse:iter: pos=0;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name: setting name...REQUIRED_POSITIONAL
DEBUG:clap:UsageParser::name: explicit name set...
DEBUG:clap:UsageParser::parse:iter: pos=20;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help: setting help...required positional argument
DEBUG:clap:UsageParser::parse:iter: pos=52;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::parse: vals...None
DEBUG:clap:Parser::add_subcommand: term_w=None, name=test
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=test, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing '"test.out"' ([116, 101, 115, 116, 46, 111, 117, 116])
DEBUG:clap:Parser::is_new_arg:"test.out":NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg="test.out"
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=["REQUIRED_POSITIONAL"], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=["REQUIRED_POSITIONAL"]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=test-clap <REQUIRED_POSITIONAL> [SUBCOMMAND]
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;
error: The subcommand 'test.out' wasn't recognized
        Did you mean 'test'?

If you believe you received this message in error, try re-running with 'test-clap -- test.out'

USAGE:
    test-clap <REQUIRED_POSITIONAL> [SUBCOMMAND]

For more information try --help
$ target/debug/test-clap test test
DEBUG:clap:UsageParser::from_usage;
DEBUG:clap:UsageParser::new: usage="<REQUIRED_POSITIONAL> \'required positional argument\'"
DEBUG:clap:UsageParser::parse;
DEBUG:clap:UsageParser::parse:iter: pos=0;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name: setting name...REQUIRED_POSITIONAL
DEBUG:clap:UsageParser::name: explicit name set...
DEBUG:clap:UsageParser::parse:iter: pos=20;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help: setting help...required positional argument
DEBUG:clap:UsageParser::parse:iter: pos=52;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::parse: vals...None
DEBUG:clap:Parser::add_subcommand: term_w=None, name=test
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=test, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing '"test"' ([116, 101, 115, 116])
DEBUG:clap:Parser::is_new_arg:"test":NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg="test"
DEBUG:clap:Parser::get_matches_with: possible_sc=true, sc=Some("test")
DEBUG:clap:Parser::parse_subcommand;
DEBUG:clap:usage::get_required_usage_from: reqs=["REQUIRED_POSITIONAL"], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=["REQUIRED_POSITIONAL"]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:Parser::parse_subcommand: About to parse sc=test
DEBUG:clap:Parser::parse_subcommand: sc settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing '"test"' ([116, 101, 115, 116])
DEBUG:clap:Parser::is_new_arg:"test":NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg="test"
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:Parser::get_matches_with: Positional counter...1
DEBUG:clap:Parser::get_matches_with: Low index multiples...false
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=test-clap <REQUIRED_POSITIONAL> test
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
error: Found argument 'test' which wasn't expected, or isn't valid in this context

USAGE:
    test-clap <REQUIRED_POSITIONAL> test

For more information try --help
</code>
</pre>
</details>


---

_Renamed from "Positional argument and subcommands interferes with each other" to "Positional argument and subcommands interfere with each other" by @htejun on 2021-04-30 10:55_

---

_Comment by @pksunkara on 2021-04-30 11:10_

Fixed on master.

---

_Closed by @pksunkara on 2021-04-30 11:10_

---
