---
number: 4411
title: create skip_with_default attribute for Subcommands
type: issue
state: closed
author: 0xForerunner
labels:
  - C-enhancement
assignees: []
created_at: 2022-10-20T21:06:56Z
updated_at: 2022-10-20T22:10:28Z
url: https://github.com/clap-rs/clap/issues/4411
synced_at: 2026-01-07T12:31:17-06:00
---

# create skip_with_default attribute for Subcommands

---

_Issue opened by @0xForerunner on 2022-10-20 21:06_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

4.0.17

### Describe your use case

The enum that I'm using with clap derive also serves as an external API so there are certain things it must have. It looks like this:

```rust
#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema, Parser)]
#[serde(rename_all = "snake_case")]
pub enum Msg {
    #[command(subcommand)]
    Base(BaseMsg),
    #[clap(skip_with_default=my_default_function)] // This is the feature I would like to add
    Receive(ExternalStruct),
    AddAssets {
        #[arg(value_parser=serde_json::from_str::<[AssetInfo; 2]>)]
        assets: [AssetInfo; 2],
    },
```

Because Default is not implemented for ExternalStruct I cannot skip the variant regularly.

### Describe the solution you'd like

An attribute like 
```
#[clap(skip_with_default=my_default_function)]
```
Should work perfectly for me. I'm currently not aware of any other solution.

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @0xForerunner on 2022-10-20 21:06_

---

_Comment by @epage on 2022-10-20 21:18_

The thing that is missing for me is why `#[command(skip]` is insufficient.  Clap would have no reason to instantiate a skipped variant, so defaults do not matter.

---

_Comment by @0xForerunner on 2022-10-20 21:23_

> The thing that is missing for me is why `#[command(skip]` is insufficient. Clap would have no reason to instantiate a skipped variant, so defaults do not matter.

The compiler wants the trait bound FromArgMatches to be satisfied, I assumed it was related to not implementing Default? What is the issue then?

```
error[E0277]: the trait bound `ExternalStruct: FromArgMatches` is not satisfied
  --> packages/lending/src/market.rs:26:71
   |
26 | #[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema, Parser)]
   |                                                                       ^^^^^^ the trait `FromArgMatches` is not implemented for `ExternalStruct`
```

---

_Referenced in [clap-rs/clap#4412](../../clap-rs/clap/pulls/4412.md) on 2022-10-20 21:45_

---

_Comment by @epage on 2022-10-20 21:45_

Looks like its a bug.  A fix is upcoming

---

_Comment by @0xForerunner on 2022-10-20 21:49_

> Looks like its a bug. A fix is upcoming

Oh wow thanks! I didn't realize it was a bug. Appreciate it.

---

_Closed by @epage on 2022-10-20 21:57_

---

_Comment by @epage on 2022-10-20 21:59_

v4.0.18 is now released with the fix

---

_Comment by @0xForerunner on 2022-10-20 22:10_

> v4.0.18 is now released with the fix

You're a legend. Thanks my friend.

---
