---
number: 6201
title: "Path completions don't work across symlinks"
type: issue
state: closed
author: devjgm
labels:
  - C-bug
  - A-completion
  - E-help-wanted
  - E-easy
assignees: []
created_at: 2025-12-26T21:18:35Z
updated_at: 2025-12-29T15:16:14Z
url: https://github.com/clap-rs/clap/issues/6201
synced_at: 2026-01-07T12:31:17-06:00
---

# Path completions don't work across symlinks

---

_Issue opened by @devjgm on 2025-12-26 21:18_

### Please complete the following tasks

- [x] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [x] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.91.0 (f8297e351 2025-10-28)

### Clap Version

clap = { version = "4.5.53", features = ["derive"] } clap_complete = { version = "4.5.62", features = ["unstable-dynamic"] }

### Minimal reproducible code

`Cargo.toml`:
```toml
[package]
name = "mycomp"
version = "0.1.0"
edition = "2024"

[dependencies]
clap = { version = "4.5.53", features = ["derive"] }
clap_complete = { version = "4.5.62", features = ["unstable-dynamic"] }
```

`src/main.rs`:
```rust
use clap::{CommandFactory, Parser};

#[derive(Parser, Debug, PartialEq)]
#[command(name = "mycomp")]
struct Opt {
    #[arg(short, long, value_hint = clap::ValueHint::FilePath)]
    file: Option<std::path::PathBuf>,
}

fn main() {
    clap_complete::CompleteEnv::with_factory(|| Opt::command()).complete();
    let opt = Opt::parse();

    println!("{opt:#?}");
}
```

```console
$ cargo build
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.07s

$ source <(COMPLETE=bash ./target/debug/mycomp)

$ ls -ld /home /Users/
drwxr-xr-x  5 root  admin  160 Nov  6 11:09 /Users/
lrwxr-xr-x  1 root  wheel   25 Dec 13 13:37 /home -> /System/Volumes/Data/home

$ ./target/debug/mycomp -f /Users/ # TAB completion works üëç 

$ ./target/debug/mycomp -f /ho<TAB>  # Does not work ‚ùå 
```


### Steps to reproduce the bug with the above code

Create a symlink to some directory, and try to use clap completion to complete through the symlink. On macOS this is common due to `/home -> /Users`, and `/tmp -> /private/tmp`

### Actual Behaviour

Trying to tab completion does not seem to work through a symlink. 

### Expected Behaviour

Tab completion should complete symlinks, just like regular path components.

### Additional Context

_No response_

### Debug Output

```console
$ ./target/debug/mycomp -f /ho<TAB>
[clap_builder::builder::command]Command::_build: name="mycomp"
[clap_builder::builder::command]Command::_propagate:mycomp
[clap_builder::builder::command]Command::_check_help_and_version:mycomp expand_help_tree=true
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_propagate_global_args:mycomp
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:file
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help
[clap_builder::builder::debug_asserts]Command::_verify_positionals
[clap_builder::builder::command]Command::_build_bin_names
[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true
[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]
[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]
[clap_builder::builder::command]Command::_build: name="mycomp"
[clap_builder::builder::command]Command::_build: already built
[clap_builder::builder::command]Command::_build_bin_names
[clap_builder::builder::command]Command::_build_bin_names: already built

```

---

_Label `C-bug` added by @devjgm on 2025-12-26 21:18_

---

_Label `S-triage` added by @devjgm on 2025-12-26 21:18_

---

_Label `A-completion` added by @epage on 2025-12-26 21:20_

---

_Label `S-triage` removed by @epage on 2025-12-26 21:20_

---

_Label `E-help-wanted` added by @epage on 2025-12-26 21:20_

---

_Label `E-easy` added by @epage on 2025-12-26 21:20_

---

_Comment by @epage on 2025-12-26 21:21_

Seems reasonable.  The main consideration is preserving the use of the symlink when reporting the path to the user.

---

_Comment by @cooronx on 2025-12-27 09:56_

@devjgm it seems work fine to me (Ubuntu 24.04.3 LTS with bash)

---

_Referenced in [clap-rs/clap#6202](../../clap-rs/clap/pulls/6202.md) on 2025-12-27 10:25_

---

_Comment by @iepathos on 2025-12-27 10:59_

Hi,

Opened a PR for this issue here https://github.com/clap-rs/clap/pull/6202

On Unix, https://doc.rust-lang.org/std/fs/struct.DirEntry.html#method.metadata is equivalent to symlink_metadata(), which returns metadata about the symlink itself rather than its target. This causes is_dir() to return false for symlinks pointing to directories, so they never appear in completions.

The fix implemented in the PR is to use Path::is_dir() which follows symlinks.

Tests that prove the issue in the PR (fail without fix, pass with fix):
- suggest_value_hint_file_path_symlink_to_dir - symlink to directory missing from completions
- suggest_value_hint_dir_path_symlink - symlink to directory not shown for DirPath hint

Please let me know if there are any adjustments I should make for the PR.

---

_Closed by @epage on 2025-12-29 15:16_

---
