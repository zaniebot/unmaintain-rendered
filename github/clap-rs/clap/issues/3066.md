---
number: 3066
title: "[derive] Vec<String> consumes all the arguments"
type: issue
state: closed
author: rgreinho
labels:
  - C-bug
assignees: []
created_at: 2021-12-06T18:50:25Z
updated_at: 2021-12-09T02:38:27Z
url: https://github.com/clap-rs/clap/issues/3066
synced_at: 2026-01-07T12:31:17-06:00
---

# [derive] Vec<String> consumes all the arguments

---

_Issue opened by @rgreinho on 2021-12-06 18:50_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

rustc 1.54.0 (a178d0322 2021-07-26)

### Clap Version

v3.0.0-beta.5

### Minimal reproducible code

The problem can be reproduced using the "example.rs" example.


### Steps to reproduce the bug with the above code

```bash
$ cargo run -q --example example -- --optv opt_a opt_b opt_c  in_file out_file
error: The following required arguments were not provided:
    <INPUT>

USAGE:
    example --optv <OPTV>... <INPUT>

For more information try --help
```

Since the example expects 2 mandatory arguments, the `--optv` flag should know how to ignore them. 

The behavior is correct when we add an extra flag before the mandatory arguments.

```bash
$ cargo run -q --example example -- --optv opt_a opt_b opt_c -d in_file out_file
""
```

### Actual Behaviour

See above.

### Expected Behaviour

See above.

### Additional Context

_No response_

### Debug Output

_No response_

---

_Label `T: bug` added by @rgreinho on 2021-12-06 18:50_

---

_Comment by @epage on 2021-12-06 19:08_

Yes, a sufficiently smart parser could handle back tracking for required positional arguments.  Unfortunately, that is a very specialized case and gets ambiguous when dealing with optional positionals, etc.

Instead, we provide a lot of [warnings when using `multiple_values`](https://docs.rs/clap/3.0.0-beta.4/clap/struct.Arg.html#method.multiple_values) to try to guide people on how to use it in a way that doesn't cause problems.

It is also likely that `clap_derive` will not release with setting `multiple_values` on `Vec`s but probably instead `multiple_occurrences`, see https://github.com/clap-rs/clap/issues/1772

---

_Comment by @epage on 2021-12-08 22:11_

With that said, any documentation or behavior changes that you think would help or should we consider this Issue resolved?

---

_Comment by @rgreinho on 2021-12-08 23:21_

I did solve my problem by listening to your advice and reading about in the docs and the issue you pointed out. These adjustments did the trick:

```rs
#[clap(long, multiple_occurrences(true), number_of_values = 1)]
pub field: Option<Vec<String>>,
```

Here are 2 things I think would have helped:

1. Have this use case in an example
2. If I do something which does not make sense, like adding a default value to an optional flag, the compiler raises an error. Maybe in the use case I described above with Vec, it could raise a warning?

Here is an example:
```rs
#[clap(short, long, default_value = "-")]
pub separator: Option<String>,
```
The build output
```bash
$ cargo build
error: default_value is meaningless for Option
  --> src/cli.rs:26:25
   |
26 |     #[clap(short, long, default_value = "-")]
   |                         ^^^^^^^^^^^^^
```

---

_Comment by @epage on 2021-12-09 00:40_

With 3.0.0-rc.0, which came out earlier today, `Vec` means `multiple_occurrences`, so hopefully that resolves that part.

As for the error "error: default_value is meaningless for Option", its basically saying that your `Option` will always end up being `None`, which makes it being an `Option` redundant.  Granted, there are some cases with the `default_value_if` functions where you can unset a default, so we might need to loosen up those restrictions.

---

_Comment by @rgreinho on 2021-12-09 00:52_

HÃ©hÃ©, I understood the error message for the option. I was just suggested to implement a warning message using a similar mechanism for `Vec<T>` ðŸ˜‰ 

---

_Closed by @rgreinho on 2021-12-09 02:38_

---
