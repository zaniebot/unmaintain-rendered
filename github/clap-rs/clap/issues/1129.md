---
number: 1129
title: "Bug: Bash completion is broken when sub-command names have hyphens"
type: issue
state: closed
author: fluffysquirrels
labels: []
assignees: []
created_at: 2017-12-16T11:41:46Z
updated_at: 2018-08-02T03:30:16Z
url: https://github.com/clap-rs/clap/issues/1129
synced_at: 2026-01-07T12:31:16-06:00
---

# Bug: Bash completion is broken when sub-command names have hyphens

---

_Issue opened by @fluffysquirrels on 2017-12-16 11:41_

### Rust Version

`rustc 1.22.1 (05e2e1c41 2017-11-22)`

### Affected Version of clap

`master` at time of discovery (e0f8479e0f6522af24484abc79aee24d60b939d2)

### Expected Behavior Summary

Bash completion should suggest parameters for a sub-command with a name that contains hypens.

### Actual Behavior Summary

Bash completion suggests parameters for a higher level sub-command, or none at all.

### Steps to Reproduce the issue

* Create a crate that uses clap and contains an App with sub-commands that have hyphens in their name, and also some arguments of their own.
* Generate the bash completion script for the App and source it into a bash shell.
* If you press tab after typing the sub-command name with a hyphen, the completion list should contain that sub-command's arguments, but it does not.

### Sample Code or Link to Sample Code

Here's a sample app definition from the test I've written in my fork:

```rust
fn build_app_with_name(s: &'static str) -> App<'static, 'static> {
    App::new(s)
        .about("Tests completions")
        .arg(Arg::with_name("file").help("some input file"))
        .subcommand(SubCommand::with_name("test")
            .about("tests things")
            .arg(Arg::with_name("case")
                .long("case")
                .takes_value(true)
                .help("the case to test")))
}

/// This is the sample app that displays the issue.
fn build_app_special_commands() -> App<'static, 'static> {
    build_app_with_name("my_app")
        .subcommand(SubCommand::with_name("some_cmd")
                    .about("tests other things")
                    .arg(Arg::with_name("config")
                         .long("--config")
                         .takes_value(true)
                         .help("the other case to test")))
        .subcommand(SubCommand::with_name("some-cmd-with-hypens"))
}
```

----

I have fixed this in my fork already and will add a pull request in a moment.

---

_Referenced in [clap-rs/clap#1130](../../clap-rs/clap/pulls/1130.md) on 2017-12-16 11:48_

---

_Renamed from "Bug: Bash completion is broken when sub-commands have hypens" to "Bug: Bash completion is broken when sub-commands have hyphens" by @fluffysquirrels on 2017-12-16 11:51_

---

_Renamed from "Bug: Bash completion is broken when sub-commands have hyphens" to "Bug: Bash completion is broken when sub-command names have hyphens" by @fluffysquirrels on 2017-12-16 11:51_

---

_Comment by @ghost on 2017-12-20 19:54_

```rust
clap_app!(gist =>
            (version: "0.1.0")
            (about: DESC)
            (@arg FORMAT: +required "pretty-printing format specification")
            (@arg path: -p --path +takes_value "path to test")
            (@subcommand is-repo =>
                (about: "Determine if given path is a git repository")
                (@arg path: -p --path +takes_value "path to test [default \".\"]")
            )
        ).get_matches();
```
Hyphens also fail when using the `clap_app!` macro. 
```
error: no rules expected the token `app`
  --> src/main.rs:78:23
   |
78 |           let matches = clap_app!(gist =>
   |  _______________________^
79 | |             (version: "0.1.0")
80 | |             (about: DESC)
...  |
87 | |             )
88 | |         ).get_matches();
   | |_________^
   |
   = note: this error originates in a macro outside of the current crate

```
Removing the hyphen works as expected.

---

_Closed by @kbknapp on 2018-01-09 15:48_

---

_Comment by @jeremymv2 on 2018-05-01 13:29_

@kbknapp 

Is there anything special I need to do in order to use the macro with subcommand containing a hyphen?

With version 2.31.2 and this block, I still get an error:

```
206         (@subcommand gather-logs =>
207             (about: "Gather important rumor, spec, log and other files for troubleshooting")
208             (aliases: &["gl"])
209         )
```

```
133 | /     clap_app!(("hab-sup") =>
134 | |         (about: "The Habitat Supervisor")
135 | |         (version: VERSION)
136 | |         (author: "\nAuthors: The Habitat Maintainers <humans@habitat.sh>\n")
...   |
209 | |         )
210 | |     )
    | |_____^
```

---

_Referenced in [habitat-sh/habitat#5019](../../habitat-sh/habitat/pulls/5019.md) on 2018-05-02 16:16_

---
