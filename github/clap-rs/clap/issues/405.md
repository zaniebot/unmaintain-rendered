---
number: 405
title: "argument with 'multiple' option enabled consumes subcommands that follow"
type: issue
state: closed
author: Byron
labels:
  - C-bug
  - A-parsing
assignees: []
created_at: 2016-01-31T11:28:23Z
updated_at: 2016-02-01T07:17:44Z
url: https://github.com/clap-rs/clap/issues/405
synced_at: 2026-01-07T12:31:16-06:00
---

# argument with 'multiple' option enabled consumes subcommands that follow

---

_Issue opened by @Byron on 2016-01-31 11:28_

When I upgraded [google-apis-rs] to clap v2, I noticed that subcommands seem to be consumed by greedy options preceding them.

A command with usage (_truncated_) ...

```
USAGE:
    drive3 [FLAGS] [OPTIONS] [SUBCOMMAND]
OPTIONS:
        --scope <url>...         Specify the authentication a method should be executed in.

SUBCOMMANDS:
    about          methods: 'get'
[...]
```

... will not be able to parse its subcommands anymore when invoked with (for example):

```
./drive3 --scope https://docs.google.com/feeds files list
# or 
./drive3 --scope=https://docs.google.com/feeds files list
```

This used to work with clap _v1_.
#### How to reproduce
1. Download the previous version of the program that used clap v1 ([DL for osx](http://dl.byronimo.de/google.rs/cli/0.3.1/osx/drive2.tar.gz)) and extract it.
   - Run `./drive2 --scope foo files list` to see that it will attempt to use that scope, failing with `invalid scope`
2. Download the current version of the program that uses clap v2 ([DL for osx](http://dl.byronimo.de/google.rs/cli/0.3.3_clap-broken/osx/drive3.tar.gz)) and extract it.
   - Run `./drive3 --scope foo files list` to see that it will fail to parse subcommands, and thus yields `Please specify the main sub-command.`.
   - The error message is part of the [commands implementation](https://github.com/Byron/google-apis-rs/blob/master/gen/drive3-cli/src/main.rs#L2904), and indicates that no subcommand was available in the argument matches.
   - I chose _drive2_ and _drive3_ just for convenience, they are equivalent in the way subcommands are defined and handled.
#### Meta
- clap-rs version v2.0.1
- ```
  ➜  google-apis-rs git:(master) ✗ rustc -vV
  rustc 1.6.0 (c30b771ad 2016-01-19)
  binary: rustc
  commit-hash: c30b771ad9d44ab84f8c88b80c25fcfde2433126
  commit-date: 2016-01-19
  host: x86_64-apple-darwin
  release: 1.6.0
  ```


---

_Referenced in [Byron/google-apis-rs#145](../../Byron/google-apis-rs/issues/145.md) on 2016-01-31 11:29_

---

_Comment by @kbknapp on 2016-01-31 19:29_

Ah ok, thanks for filing! This should be a simple fix to check if the next argument matches a subcommand before consuming as a value.


---

_Label `T: bug` added by @kbknapp on 2016-01-31 19:29_

---

_Label `P2: need to have` added by @kbknapp on 2016-01-31 19:29_

---

_Label `C: subcommands` added by @kbknapp on 2016-01-31 19:29_

---

_Label `D: easy` added by @kbknapp on 2016-01-31 19:29_

---

_Label `C: parsing` added by @kbknapp on 2016-01-31 19:29_

---

_Label `W: 2.x` added by @kbknapp on 2016-01-31 19:29_

---

_Assigned to @kbknapp by @kbknapp on 2016-01-31 19:29_

---

_Renamed from "argument 'multiple' option enabled consumes subcommands that follow" to "argument with 'multiple' option enabled consumes subcommands that follow" by @Byron on 2016-02-01 03:12_

---

_Comment by @Byron on 2016-02-01 03:14_

Great, I am looking forward to it !

By the way: I find the label-nomenclature intriguing ! Is there a formal descriptions of this system ? I'd like to see how it works :). 


---

_Closed by @homu on 2016-02-01 06:38_

---

_Comment by @kbknapp on 2016-02-01 06:46_

v2.0.2 is out on crates.io now.

For the label naming, no not that I know of. Use a single letter to logically group related labels (also visually separated by colors). The first letter as in `C: app` (the `C`) really only serves the purpose to sorting the labels, so the `C` is arbitrary. Although I do use letters that have some sort meaning, even though that's not required at all, i.e. `C` is for "Component" `D` is for "Difficulty", etc. The only one that's different is priority `P#` where the number also sorts the priorities in order of significance.


---

_Comment by @Byron on 2016-02-01 07:17_

Thanks again ! I will use that to rebuild the entire suite of google-api CLI programs. It's just going to take a day :D.

Now that I am working on [Byron's EditTools][https://github.com/Byron/atom-byrons-edittools] I was curious on how to best use tags to show what is going on via issues. The system you use here makes quite some sense to me, and I will see if I can just use it as you do in clap-rs. After all, it is a fantastic example of an open-source project, in every perceivable way.

The unit-tests added for v2 truly make it stand out as well, as it can now be trusted to work and stay that way.

Also noteworthy is the use of homu - for some reason I am somewhat afraid of bots, but do see the benefits coming with them. Let's see if I can make @homu work for me as well !


---
