---
number: 2059
title: Default alphabetical sorting of options in help message appears to be broken
type: issue
state: closed
author: CreepySkeleton
labels:
  - C-bug
  - A-help
assignees: []
created_at: 2020-08-12T13:53:28Z
updated_at: 2020-10-10T19:16:35Z
url: https://github.com/clap-rs/clap/issues/2059
synced_at: 2026-01-07T12:31:17-06:00
---

# Default alphabetical sorting of options in help message appears to be broken

---

_Issue opened by @CreepySkeleton on 2020-08-12 13:53_

### Make sure you completed the following tasks

- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [x] Searched the closes issues

### Code

```rust
use std::net::SocketAddr;
use std::net::IpAddr;
use std::path::PathBuf;
use clap::{Clap, AppSettings};

#[derive(Clap, Debug)]
#[clap(
    name = "Pod, the open-source backend for Memri project.",
    // the bug is present even without this option, but it makes it easier to spot
    setting = AppSettings::UnifiedHelpMessage,
)]
pub struct CLIOptions {
    /// Port to listen to.
    #[clap(short, long, default_value = "3030")]
    port: i16,

    /// File to read https public certificate from.
    #[clap(
        short = 'c',
        long,
        default_value = "./data/certs/pod.crt",
        name = "CERTIFICATE_FILE"
    )]
    https_pub_crt: String,

    /// File to read https private key from.
    #[clap(
        short = 'k',
        long,
        default_value = "./data/certs/pod.key",
        name = "KEY_FILE"
    )]
    https_priv_key: String,

    /// Set the callback address for services launched from within Pod.
    /// This should be the Pod-s address as seen by external services.
    /// During development, it defaults to "https://pod_pod_1:3030" if Pod is inside docker,
    /// or "https://localhost:3030" on Linux,
    /// or "https://host.docker.internal:3030" on other operating systems.
    #[clap(short = 's', long, name = "ADDRESS")]
    services_callback_address: Option<SocketAddr>,

    /// Do not use https when starting the server, instead run on http://127.0.0.1.
    /// Running on loopback interface (127.0.0.1) means that only apps
    /// from within the same computer will be able to access Pod.
    /// This option might be used during development as an alternative to self-signed certificates.
    #[clap(short = 't', long)]
    non_tls: bool,

    /// Unsafe version of --non-tls. Do not use https when starting the server,
    /// instead run on http on the provided network interface.
    /// WARNING: This is heavily discouraged as an intermediary
    /// (even your router on a local network)
    /// could spoof the traffic sent to the server and do a MiTM attack.
    /// Please consider running Pod on a non-public network (--non-tls),
    /// or use Pod with https encryption.
    #[clap(short, long)]
    insecure_non_tls: Option<IpAddr>,

    /// Comma-separated list of Pod owners (hex-encoded hashes of public keys).
    /// Only those owners are allowed to call Pod endpoints.
    /// Each Pod owner has its own database and files directory,
    /// the owners do not intersect data-wise.
    ///
    /// A magic value of "ANY" will allow any owner to connect to the Pod.
    ///
    /// Can be specified multiple times.
    #[clap(short = 'o', long, required = true, multiple = true)]
    owner: Vec<String>,

    /// Validate a schema file, and exit.
    /// This allows testing whether a given schema is suitable for use in Pod,
    /// see README.md#schema for details.
    /// Note that running project tests or starting the Pod will also automatically validate
    /// the schema in `res/autogenerated_database_schema.json`.
    #[clap(short = 'v', long, name = "SCHEMA_FILE", parse(from_os_str))]
    validate_schema: Option<PathBuf>,
}

fn main() {
    CLIOptions::parse_from(&["a", "--help"]);
}
```

### Steps to reproduce the issue

1. `cargo run`

### Version

* **Rust**: `1.45.0`
* **Clap**: `master`

### Actual Behavior Summary

Options in help message are sorted in a weird way I don't recognize:

```
Pod, the open-source backend for Memri project. 

USAGE:
    a [OPTIONS] --owner <owner>...

OPTIONS:
    -s, --services-callback-address <ADDRESS>
            Set the callback address for services launched from within Pod. This should be the Pod-s
            address as seen by external services. During development, it defaults to
            "https://pod_pod_1:3030" if Pod is inside docker, or "https://localhost:3030" on Linux,
            or "https://host.docker.internal:3030" on other operating systems
    -c, --https-pub-crt <CERTIFICATE_FILE>
            File to read https public certificate from [default: ./data/certs/pod.crt]

    -k, --https-priv-key <KEY_FILE>
            File to read https private key from [default: ./data/certs/pod.key]

    -v, --validate-schema <SCHEMA_FILE>
            Validate a schema file, and exit. This allows testing whether a given schema is suitable
            for use in Pod, see README.md#schema for details. Note that running project tests or
            starting the Pod will also automatically validate the schema in
            `res/autogenerated_database_schema.json`
    -h, --help                                   
            Prints help information

    -i, --insecure-non-tls <insecure-non-tls>
            Unsafe version of --non-tls. Do not use https when starting the server, instead run on
            http on the provided network interface. WARNING: This is heavily discouraged as an
            intermediary (even your router on a local network) could spoof the traffic sent to the
            server and do a MiTM attack. Please consider running Pod on a non-public network (--non-
            tls), or use Pod with https encryption
    -t, --non-tls
            Do not use https when starting the server, instead run on http://127.0.0.1. Running on
            loopback interface (127.0.0.1) means that only apps from within the same computer will
            be able to access Pod. This option might be used during development as an alternative to
            self-signed certificates
    -o, --owner <owner>...
            Comma-separated list of Pod owners (hex-encoded hashes of public keys). Only those
            owners are allowed to call Pod endpoints. Each Pod owner has its own database and files
            directory, the owners do not intersect data-wise.
            
            A magic value of "ANY" will allow any owner to connect to the Pod.
            
            Can be specified multiple times.
    -p, --port <port>                            
            Port to listen to [default: 3030]

    -V, --version                                
            Prints version information
```

### Expected Behavior Summary

Options must be sorted in alphabetical order, as specified in documentation.

### Additional context

Originally reported in https://github.com/TeXitoi/structopt/issues/421

The problem still persists in master. 

---

_Label `T: bug` added by @CreepySkeleton on 2020-08-12 13:53_

---

_Label `P2: need to have` added by @CreepySkeleton on 2020-08-12 13:53_

---

_Label `C: args` added by @CreepySkeleton on 2020-08-12 13:53_

---

_Label `C: help message` added by @CreepySkeleton on 2020-08-12 13:53_

---

_Label `C: options` added by @CreepySkeleton on 2020-08-12 13:53_

---

_Label `C: flags` added by @CreepySkeleton on 2020-08-12 13:53_

---

_Added to milestone `3.1` by @CreepySkeleton on 2020-08-12 13:53_

---

_Referenced in [clap-rs/clap#2166](../../clap-rs/clap/pulls/2166.md) on 2020-10-10 16:45_

---

_Closed by @bors[bot] on 2020-10-10 19:16_

---

_Referenced in [djeedai/weldr#19](../../djeedai/weldr/pulls/19.md) on 2020-12-06 20:32_

---

_Referenced in [clap-rs/clap#4728](../../clap-rs/clap/issues/4728.md) on 2023-02-24 11:25_

---
