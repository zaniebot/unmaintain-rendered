---
number: 3525
title: "Deprecation warnings and changed `-h` output after `cargo update` with Clap version fixed to \"3.0.7\" in my `cargo.toml`  "
type: issue
state: closed
author: asishallab
labels:
  - C-bug
assignees: []
created_at: 2022-03-01T23:44:22Z
updated_at: 2022-03-08T16:56:50Z
url: https://github.com/clap-rs/clap/issues/3525
synced_at: 2026-01-07T13:12:19-06:00
---

# Deprecation warnings and changed `-h` output after `cargo update` with Clap version fixed to "3.0.7" in my `cargo.toml`  

---

_Issue opened by @asishallab on 2022-03-01 23:44_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.59.0 (9d1b2106e 2022-02-23)

### Clap Version

3.0.7

### Minimal reproducible code

```rust
use clap::{App, Arg};

fn main() {
    let matches = App::new("prot-scriber")
        .version("version 0.1.0")
        .arg(
            Arg::new("seq-sim-table")
            .required(true)
            .short('s')
            .takes_value(true)
            .long("seq-sim-table")
            .multiple_occurrences(true)
            .help("File in which to find sequence similarity search results in tabular format (SSST). Use e.g. Blast or Diamond to produce them. Required columns are: 'qacc sacc stitle' (Blast) or 'qseqid sseqid stitle' (Diamond). (See section '2. prot-scriber input preparation' for more details.) If the required columns, or more, appear in different order than shown here you must use the --header (-e) argument. If any of the input SSSTs uses a different field-separator than the '<TAB>' character, you must provide the --field-separator (-p) argument. You can provide multiple SSSTs, simply by repeating the -s argument, e.g. '-s queries_vs_swissprot_diamond_out.txt -s queries_vs_trembl_diamond_out.txt'. Providing multiple --seq-sim-table (-s) arguments might imply the order in which you give other arguments like --header (-e) and --field-separator (-p). See there for more details."),
        );

    // do nothing
}
```


### Steps to reproduce the bug with the above code

1. Use a cargo,toml with clap version 3.0.7
2. Compile and see deprecation warnings
3. Use -h and --help to see differences in output
4. Please see comments below for why 2. and 3. are unexpected after a `cargo update` on March 1st

OS Ubuntu 20.04

### Actual Behaviour

The output of `-h` and `--help` is no longer identical. 
Also I get deprecation warnings upon `cargo build`

### Expected Behaviour

No deprecation warnings appeared previous to a `cargo update`

The output of `-h` and `--help` was identical.

Please note that I did _not_ change the version of Clap in the respective dependencies section in my `Cargo.toml`.
It was `3.0.7` before and after the `cargo update` command.

### Additional Context

Disclaimer: I am new to Rust. 

I have a command line interface project written in Rust. Previous to today I used Clap version `3.0.7`. Today I did a `cargo update` and suddenly when compiling my project I got the deprecation warnings. Additionally the output generated by `-h` differed from that generated by `--help`. I had to introduce `long_help` and write new, shorter `help` messages.   

What I do not understand is, why the version fixed changes its behavior? Should that not have resulted in a new version of Clap. In my understanding this is the very reason why in software development semantic versioning is used and why in `Cargo.toml` the version is fixed, so no unexpected behavior can suddenly arise.  

Or did I misunderstand something here (see Disclaimer above)?  

Help would be much appreciated!

### Debug Output

None

---

_Label `C-bug` added by @asishallab on 2022-03-01 23:44_

---

_Comment by @epage on 2022-03-02 00:39_

> Use a cargo,toml with clap version 3.0.7
> ...
> What I do not understand is, why the version fixed changes its behavior? Should that not have resulted in a new version of Clap. In my understanding this is the very reason why in software development semantic versioning is used and why in Cargo.toml the version is fixed, so no unexpected behavior can suddenly arise.

A dependency like
```
clap = "3.0.7"
```
is shorthand for
```
clap = "^3.0.7"
```
which is shorthand for
```
clap = ">=3.0.7,<4.0"
```

Or in other words, you are telling cargo to pick **a** version that is semver compatible with 3.0 that is at least 3.0.7.  Cargo records the exact version in a different file, the `Cargo.lock` file.  When you run `cargo update`, you are telling cargo to re-evaluate that dependency version range, picking the highest compatible version.  This led to you upgrading to clap 3.10+.

> Compile and see deprecation warnings

The deprecation warnings are just saying that in clap 4.0, some parts of the API will be going away (clap 4.0 is still several months away) and is telling you what they are replaced with.

Deprecations are allowed in a minor release (going from 3.0.x to 3.1.0).  [Item 7](https://semver.org/#spec-item-7) says:

> Minor version Y (x.Y.z | x > 0) MUST be incremented if new, backwards compatible functionality is introduced to the public API. **It MUST be incremented if any public API functionality is marked as deprecated.** It MAY be incremented if substantial new functionality or improvements are introduced within the private code. It MAY include patch level changes. Patch version MUST be reset to 0 when minor version is incremented.

(emphasis mine)

> Use -h and --help to see differences in output

Textual output is a fuzzy area for backwards compatibility.  We take the stance that some things can change freely while if its generally expected for you to design your application around certain behavior, we won't change it.

However, we have no known changes to `-h` vs `--help` output between 3.0.7 and now.  Could you post the help output before and after?  If you commit your `Cargo.lock` in git (which you generally should), you should be able to go back to the old commits and copy the output to here.  If you didn't commit your `Cargo.lock`, you can put `clap = "=3.0.7"` in your `Cargo.toml` file to revert back to the old behavior (using `=` should generally be avoided as it can cause cases where cargo can't find a usable version).

---

_Comment by @asishallab on 2022-03-08 16:56_

Thank you very much @epage for your insights. In the end my disclaimer of being a Rust newby was well placed. 
So, this is _not_ a bug. The problem was my usage of the crate. 

I will close the issue now. Thanks again!

---

_Closed by @asishallab on 2022-03-08 16:56_

---
