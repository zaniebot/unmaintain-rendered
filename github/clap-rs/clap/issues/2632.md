---
number: 2632
title: "When setting `value_name`, argument parsing fails"
type: issue
state: closed
author: epage
labels:
  - C-bug
  - A-derive
assignees: []
created_at: 2021-07-28T14:03:05Z
updated_at: 2021-07-30T09:40:34Z
url: https://github.com/clap-rs/clap/issues/2632
synced_at: 2026-01-07T12:31:17-06:00
---

# When setting `value_name`, argument parsing fails

---

_Issue opened by @epage on 2021-07-28 14:03_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

rustc 1.53.0 (53cb7b09b 2021-06-17)

### Clap Version

5fbd764

### Minimal reproducible code

```rust
#[clap(
    number_of_values = 1,
    long = "using",
    value_name = "pm"
)]
using: Option<String>,
```

### Steps to reproduce the bug with the above code

Pass arguments as expected

### Actual Behaviour

Error when parsing:
```
error: The argument '--using <USING> <pm>' requires 2 values, but 1 was provided
```
and help:
```
OPTIONS:
        --using <USING> <pm>    Specify the package manager to be invoked
```

### Expected Behaviour

```
OPTIONS:
        --using <pm>... Specify the package manager to be invoked
```

### Additional Context

_No response_

### Debug Output

_No response_

---

_Label `T: bug` added by @epage on 2021-07-28 14:03_

---

_Added to milestone `3.0` by @pksunkara on 2021-07-28 14:03_

---

_Label `C: derive macros` added by @pksunkara on 2021-07-28 14:03_

---

_Comment by @epage on 2021-07-28 14:03_

@rami3l created this to split the conversation out

---

_Comment by @epage on 2021-07-28 14:04_

Oh, weird, `value_name` **appends**

This isn't documented

> Specifies the name for value of option or positional arguments inside of help documentation. This name is cosmetic only, the name is not used to access arguments. This setting can be very helpful when describing the type of input the user should be using, such as FILE, INTERFACE, etc. Although not required, it's somewhat convention to use all capital letters for the value name.

Two possible fixes:
- No longer append in `value_name`
- Check for `value_name` among the attributes and skip doing it if its there

@pksunkara any thoughts on changing `value_name`?

---

_Comment by @pksunkara on 2021-07-28 14:05_

I think `value_name` is supposed to append because for an argument that takes multiple values people requested multiple value names.

---

_Comment by @epage on 2021-07-28 14:07_

Thats what `value_names` is for

> Specify multiple names for values of option arguments. 

---

_Comment by @epage on 2021-07-28 14:08_

Interesting, the help also says
>These names are cosmetic only, used for help and usage strings only

and yet @rami3l ran into parsing errors when setting this.

---

_Comment by @epage on 2021-07-28 14:09_

```
        if !(self.index.is_some() || (self.short.is_none() && self.long.is_none()))
            && self.is_set(ArgSettings::TakesValue)
            && self.val_names.len() > 1
        {
            self.num_vals = Some(self.val_names.len());
        }
```
It seems sane that we do this, just the help is a little misleading.

I'm unsure what `!(self.index.is_some() || (self.short.is_none() && self.long.is_none()))` is meant to protect against though

---

_Referenced in [clap-rs/clap#2633](../../clap-rs/clap/pulls/2633.md) on 2021-07-28 14:49_

---

_Referenced in [clap-rs/clap#2634](../../clap-rs/clap/issues/2634.md) on 2021-07-28 14:52_

---

_Closed by @pksunkara on 2021-07-30 09:40_

---
