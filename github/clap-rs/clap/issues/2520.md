---
number: 2520
title: Limit number of occurrences for flag arguments
type: issue
state: closed
author: reynoldsbd
labels:
  - A-parsing
  - ":money_with_wings: $10"
assignees: []
created_at: 2021-06-03T15:43:24Z
updated_at: 2021-06-17T18:54:25Z
url: https://github.com/clap-rs/clap/issues/2520
synced_at: 2026-01-07T12:31:17-06:00
---

# Limit number of occurrences for flag arguments

---

_Issue opened by @reynoldsbd on 2021-06-03 15:43_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Describe your use case

My application includes a `-v` flag to control logging verbosity. The user can specify multiple occurrences of the flag, in which case verbosity increases.

```rust
let args = App::new("foo")
    .arg(
        Arg::with_name("verbosity")
            .short("v")
            .multiple(true)
    )
    .get_matches();

let log_builder = env_logger::Builder::new();
match args.occurrences_of("verbosity") {
    0 => { log_builder.parse_default_env(); },
    1 => { log_builder.filter_level(LevelFilter::Info); },
    2 => { log_builder.filter_level(LevelFilter::Debug); },
    _ => { log_builder.filter_level(LevelFilter::Trace); },
}
```

As written, the user can specify an arbitrary number of `-v` occurrences, but any occurrences after the third have no effect. However, I am feeling a bit pedantic in this case and would like to prevent the user from specifying more than 3 `-v`'s.

### Describe the solution you'd like

It'd be awesome if there were something like `Arg::max_occurrences` which could be used to specify the maximum number of occurrences.

```rust
Arg::with_name("verbosity")
    .short("v")
    .multiple(true)
    .max_occurrences(3);
```

### Alternatives, if applicable

I can approximate the desired behavior quite closely as follows:

```rust
match args.occurrences_of("verbosity") {
    0 => { log_builder.parse_default_env(); },
    1 => { log_builder.filter_level(LevelFilter::Info); },
    2 => { log_builder.filter_level(LevelFilter::Debug); },
    3 => { log_builder.filter_level(LevelFilter::Trace); },
    _ => {
        eprintln!("Error: Argument -v specified more than 3 times\n");
        eprintln!("{}", args.usage());
        std::process::exit(1);
    },
}
```

### Additional Context

_No response_

---

_Label `T: new feature` added by @reynoldsbd on 2021-06-03 15:43_

---

_Label `:money_with_wings: $10` added by @pksunkara on 2021-06-03 19:31_

---

_Label `C: args` added by @pksunkara on 2021-06-03 19:31_

---

_Label `C: parsing` added by @pksunkara on 2021-06-03 19:31_

---

_Label `D: medium` added by @pksunkara on 2021-06-03 19:31_

---

_Comment by @veritem on 2021-06-05 21:48_

@reynoldsbd did you try using 

```rust
Arg::with_name("verbosity")
    .short("v")
    .multiple(true)
    .max_values(3);
```

---

_Comment by @reynoldsbd on 2021-06-08 15:03_

I did try that. `max_values(true)` seems to implicitly set `takes_value(true)`, resulting in my argument being treated as an option rather than a flag.

---

_Referenced in [clap-rs/clap#2543](../../clap-rs/clap/pulls/2543.md) on 2021-06-17 00:56_

---

_Closed by @pksunkara on 2021-06-17 18:54_

---
