---
number: 1630
title: Use serde to serialize-deserialize configs, including yaml
type: issue
state: closed
author: CreepySkeleton
labels:
  - C-enhancement
  - S-wont-fix
assignees: []
created_at: 2020-01-10T15:02:08Z
updated_at: 2022-01-11T18:47:32Z
url: https://github.com/clap-rs/clap/issues/1630
synced_at: 2026-01-07T12:31:17-06:00
---

# Use serde to serialize-deserialize configs, including yaml

---

_Issue opened by @CreepySkeleton on 2020-01-10 15:02_

### Summary

Implement `serde::Serialize/Deserialize` for `clap::App` so it could be deserialized not only from a YAML file, but from any other format.

### Motivation

Currently, yaml supports deserializing only from YAML via `App::from_yaml`. This restricts users to only the one blessed format, while the layout of `clap::App` is pretty simple on it's own and can be expressed in many config formats, such as [JSON](https://www.json.org/json-en.html), [TOML](https://github.com/toml-lang/toml), [`.plist`](https://en.wikipedia.org/wiki/Property_list) to name a few.

Supporting only the chosen one format is kind of inane nowadays, when we have `serde`, which   handles the differences between formats in a generic way.

Not to mention a number of ["YAML is too WTF-full format for config files"](https://github.com/clap-rs/clap/issues/552#issuecomment-572862739) considerations. Some users (myself included) would happily move to TOML if it was supported out-of-box.

### User experience

As for users of `clap` who only interested in YAML, nothing would change. From "user experience" side, there's no actual difference between 

```rust
let yml = load_yaml!("file.yml");
let app = App::from_yaml(&yml);
```
and 

```rust
let config = std::fs::File::open("file.yml").expect("No file.yaml!");
let app: App = serde_yaml::from_reader(config).unwrap();
```

But users interested on other formats, like TOML, JSON, you name it, could really make use of this feature.

### Implementation

I gave a quick look-over to `App` and `Arg` layout and I'm fairly certain that `Serialize` and `Deserialize` can be simply `derive`d. 

### Related issues

 #918: Serializing to / deserializing from JSON. @kbknapp agreed this feature would be pretty useful.

#853: use serde_yaml since it provides much more useful error messages.



---

_Comment by @jonericcook on 2020-01-18 06:43_

Would this feature allow for the following behavior?

./examplecli helpdump --json helpdump.json

and/or

./examplecli helpdump --stdout

The helpdump.json and stdout would contain all the information about how to use examplecli, essentially the --help for each command and subcommand with all the descriptions and arg type input.

The reason I ask because I have a handful of rust binaries that use clap and i would like to be able to call, for example, the helpdump command to get a json object that tells me how to interact with the binary so I can programmatically use the binary from another language.

I guess in a nut shell i'm asking for a rust program that uses clap to be able to output a .json file and/or a json string to stdout that describes how to use it so that it (the rust program) can be used by another program just by ingesting the .json/json string.

---

_Referenced in [clap-rs/clap#1337](../../clap-rs/clap/issues/1337.md) on 2020-02-03 11:15_

---

_Label `T: enhancement` added by @CreepySkeleton on 2020-02-06 07:21_

---

_Label `T: RFC / question` added by @CreepySkeleton on 2020-02-06 07:21_

---

_Label `W: 3.x` added by @CreepySkeleton on 2020-02-06 07:21_

---

_Label `T: RFC / question` removed by @pksunkara on 2020-04-01 18:18_

---

_Comment by @pickfire on 2020-04-11 15:46_

Maybe we could also merge configuration with the commands, with the configuration in file overwritten by the configuration specified by command arguments?

---

_Referenced in [clap-rs/clap#2447](../../clap-rs/clap/issues/2447.md) on 2021-04-20 15:16_

---

_Comment by @throwaway1037 on 2021-04-20 17:18_

I think RON should be supported.

Also, I think DSL support should only cost compile time and be baked into the binary, with no cost at runtime since it's essentially a declarative specification of the command-line arguments for the program. The alternative is reading the file at runtime, and then having to distribute it with the program, which is slower and uses more storage space. I don't know which is the current behaviour.

---

_Label `W: 3.x` removed by @pksunkara on 2021-05-26 10:51_

---

_Referenced in [clap-rs/clap#918](../../clap-rs/clap/issues/918.md) on 2021-07-20 17:42_

---

_Referenced in [epage/clapng#131](../../epage/clapng/issues/131.md) on 2021-12-06 18:38_

---

_Comment by @epage on 2021-12-09 16:13_

We have decided to deprecate the YAML API.  For more details, see https://github.com/clap-rs/clap/issues/3087.  If there is interest in a YAML API, it will likely be broken out into a `clap_yaml` and developed independent from the core of clap.

---

_Closed by @epage on 2021-12-09 16:13_

---

_Label `S-wont-fix` added by @epage on 2022-01-11 18:47_

---
