---
number: 4265
title: Subcommand aliases not included in completion scripts
type: issue
state: closed
author: martinvonz
labels:
  - C-bug
  - A-completion
  - E-help-wanted
  - E-easy
assignees: []
created_at: 2022-09-26T21:39:22Z
updated_at: 2024-06-06T21:33:03Z
url: https://github.com/clap-rs/clap/issues/4265
synced_at: 2026-01-07T12:31:17-06:00
---

# Subcommand aliases not included in completion scripts

---

_Issue opened by @martinvonz on 2022-09-26 21:39_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

1.63.0

### Clap Version

3.2.22

### Minimal reproducible code

```rust
use std::io::{stdout, Write};
use clap;
use clap::CommandFactory;

#[derive(clap::Parser, Clone, Debug)]
enum App {
    #[clap(alias = "bar")]
    Foo(FooArgs),
}

#[derive(clap::Args, Clone, Debug)]
struct FooArgs {
    my_flag: bool,
}

fn main() {
    let mut app = App::command().disable_help_flag(true).disable_help_subcommand(true);
    let mut buf = vec![];
    clap_complete::generate(clap_complete::Shell::Bash, &mut app, "test", &mut buf);
    stdout().write_all(&mut buf).unwrap();
}
```


### Steps to reproduce the bug with the above code

Run the program to print out a completion script for Bash

### Actual Behaviour

Sourcing the completion script and then running `test <TAB>` will not suggest `bar` and `test bar <TAB>` will not suggest `--my-flag`.

### Expected Behaviour

`test bar <TAB>` should suggest `--my-flag`. I'm not sure if I think `test <TAB>` should suggest both `foo` and `bar`; perhaps the current behavior of not suggesting aliases is best?

The same bug exists in the Fish completion script. I haven't tried others (or checked the code).

I actually noticed the bug because my tool has `jj log` command and a `jj operation/op log` command, and I ran `jj op log <TAB>`, which suggested arguments that are for `jj log`. That's because the `op` (an alias for `operation`) is ignored and completion is run for `jj log` instead.

### Additional Context

_No response_

### Debug Output

_No response_

---

_Label `C-bug` added by @martinvonz on 2022-09-26 21:39_

---

_Comment by @epage on 2022-09-26 22:02_

`alias` is hidden in `--help` and you need `visible_alias` to show up in `--help`.

We've had some back and forth on whether things that are hidden from help should show up in completions
- https://github.com/clap-rs/clap/issues/2541
- https://github.com/clap-rs/clap/issues/1335

When we resolve https://github.com/clap-rs/clap/issues/3166, my thought is to handle this according to https://github.com/clap-rs/clap/issues/3951

---

_Comment by @martinvonz on 2022-09-26 23:21_

> `alias` is hidden in `--help` and you need `visible_alias` to show up in `--help`.

That makes sense, but it doesn't seem to affect the completion script.

Are you open to a PR to add visible aliases to the completion scripts if I can figure out how?

---

_Comment by @epage on 2022-09-27 01:02_

Yes

Supports visible aliases:
- zsh: https://github.com/clap-rs/clap/blob/master/clap_complete/src/shells/zsh.rs#L170

Doesn't
- bash: https://github.com/clap-rs/clap/blob/master/clap_complete/src/shells/bash.rs#L104
- elvish: https://github.com/clap-rs/clap/blob/master/clap_complete/src/shells/elvish.rs#L122
- fish: https://github.com/clap-rs/clap/blob/master/clap_complete/src/shells/fish.rs#L135
- powershell: https://github.com/clap-rs/clap/blob/master/clap_complete/src/shells/powershell.rs#L151

---

_Label `A-completion` added by @epage on 2022-09-28 16:18_

---

_Label `E-help-wanted` added by @epage on 2022-09-28 16:18_

---

_Label `E-easy` added by @epage on 2022-09-28 16:18_

---

_Comment by @martinvonz on 2022-09-28 16:45_

I've noticed a few other bugs while working on this. Do you prefer that I file separate bugs for those? Looking at past release notes, it doesn't look like you require a bug for each fix, but I don't mind creating them if you prefer.

---

_Comment by @epage on 2022-09-28 16:50_

Separate issues are good in case
- There is discussion around the requirements (I prefer PRs to be focused on the implementation)
- In case not all of them get resolved together

I would at least ask for separate commits for each one.  If a change is likely to have more discussion, having that in a separate PR helps.

---

_Referenced in [clap-rs/clap#4273](../../clap-rs/clap/issues/4273.md) on 2022-09-28 18:49_

---

_Referenced in [clap-rs/clap#4284](../../clap-rs/clap/pulls/4284.md) on 2022-09-29 04:44_

---

_Referenced in [clap-rs/clap#4289](../../clap-rs/clap/pulls/4289.md) on 2022-09-29 16:44_

---

_Referenced in [ouch-org/ouch#357](../../ouch-org/ouch/issues/357.md) on 2023-02-03 02:09_

---

_Comment by @T0mstone on 2023-10-31 16:26_

> Supports visible aliases:
>    * zsh: https://github.com/clap-rs/clap/blob/master/clap_complete/src/shells/zsh.rs#L170

Although the zsh completion supports listing the aliases for `test <TAB>`, there is currently still the bug with `test bar <TAB>` not suggesting `--my-flag` (or anything else, for that matter).

---

_Referenced in [typst/typst#3281](../../typst/typst/issues/3281.md) on 2024-01-27 12:31_

---

_Referenced in [jj-vcs/jj#2947](../../jj-vcs/jj/issues/2947.md) on 2024-02-05 00:20_

---

_Referenced in [clap-rs/clap#5243](../../clap-rs/clap/issues/5243.md) on 2024-03-21 14:33_

---

_Referenced in [clap-rs/clap#5412](../../clap-rs/clap/pulls/5412.md) on 2024-03-21 17:57_

---

_Referenced in [clap-rs/clap#5476](../../clap-rs/clap/pulls/5476.md) on 2024-04-27 16:01_

---

_Closed by @epage on 2024-06-06 21:33_

---

_Referenced in [jj-vcs/jj#4811](../../jj-vcs/jj/pulls/4811.md) on 2024-11-10 09:41_

---

_Referenced in [tree-sitter/tree-sitter#4005](../../tree-sitter/tree-sitter/pulls/4005.md) on 2024-12-15 17:29_

---
