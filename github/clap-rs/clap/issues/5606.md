---
number: 5606
title: Hyphens missing from listItemText in generated PowerShell autocomplete scripts
type: issue
state: closed
author: Mixu78
labels:
  - C-bug
  - A-completion
  - E-easy
assignees: []
created_at: 2024-07-29T19:02:53Z
updated_at: 2024-08-10T00:22:31Z
url: https://github.com/clap-rs/clap/issues/5606
synced_at: 2026-01-07T12:31:17-06:00
---

# Hyphens missing from listItemText in generated PowerShell autocomplete scripts

---

_Issue opened by @Mixu78 on 2024-07-29 19:02_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.80.0 (051478957 2024-07-21)

### Clap Version

4.5.11

### Minimal reproducible code

```rust
use std::io;

use clap::{Arg, Command};
use clap_complete::{generate, Shell};

fn main() {

    let mut cmd = Command::new("dummy")
        .arg(Arg::new("foo").long("foo"))
        .subcommand(Command::new("foo"));

    generate(Shell::PowerShell, &mut cmd, "dummy", &mut io::stdout());
}
```


### Steps to reproduce the bug with the above code

```ps1
cargo run
```
or to source the script:
```ps1
Invoke-Expression (cargo run | Out-String)
```

### Actual Behaviour

The generated completion script is missing hyphens in the `CompletionResult::new` `listItemText` parameter for all options. This is at best confusing, leading to options being listed without their hyphens when attempting to complete them, and at worst causes collisions making it impossible to complete a subcommand with the same name as an option without first typing a character. Completion scripts for other shells seem to include hyphens correctly.

A snippet of the completion script generated by the reproduction code:
```ps1
'dummy' {
            [CompletionResult]::new('--foo', 'foo', [CompletionResultType]::ParameterName, 'foo')
            [CompletionResult]::new('-h', 'h', [CompletionResultType]::ParameterName, 'Print help')
            [CompletionResult]::new('--help', 'help', [CompletionResultType]::ParameterName, 'Print help')
            [CompletionResult]::new('foo', 'foo', [CompletionResultType]::ParameterValue, 'foo')
            [CompletionResult]::new('help', 'help', [CompletionResultType]::ParameterValue, 'Print this message or the help of the given subcommand(s)')     
            break
        }
```
In the snippet above the missing hyphens cause option `--foo` and subcommand `foo` to collide. The option `--foo` is displayed as "foo" when completing with no input other than the command, with the subcommand `foo` being uncompletable. `foo` is correctly completed only when at least the first letter has been typed.


### Expected Behaviour

The generated completion script should have hyphens in both the `completionText` and `listItemText` parameters in the `CompletionResult` constructor call:
```ps1
'dummy' {
            [CompletionResult]::new('--foo', '--foo', [CompletionResultType]::ParameterName, 'foo')
            [CompletionResult]::new('-h', '-h', [CompletionResultType]::ParameterName, 'Print help')
            [CompletionResult]::new('--help', '--help', [CompletionResultType]::ParameterName, 'Print help')
            [CompletionResult]::new('foo', 'foo', [CompletionResultType]::ParameterValue, 'foo')
            [CompletionResult]::new('help', 'help', [CompletionResultType]::ParameterValue, 'Print this message or the help of the given subcommand(s)')     
            break
        }
```


### Additional Context

Lines 134 and 145 in [`clap_complete/src/shells/powershell.rs`](https://github.com/clap-rs/clap/blob/16fba4b9f91cf772ab1f6e7b1016a257e5f6cf62/clap_complete/src/shells/powershell.rs) seem to be causing this.


### Debug Output

_No response_

---

_Label `C-bug` added by @Mixu78 on 2024-07-29 19:02_

---

_Label `A-completion` added by @epage on 2024-07-29 19:31_

---

_Label `E-easy` added by @epage on 2024-07-29 19:31_

---

_Referenced in [clap-rs/clap#5610](../../clap-rs/clap/pulls/5610.md) on 2024-07-31 11:17_

---

_Closed by @epage on 2024-08-10 00:22_

---
