---
number: 5421
title: "[derive] Argument `test`'s selected action SetTrue contradicts `takes_value`"
type: issue
state: closed
author: hasezoey
labels:
  - C-bug
assignees: []
created_at: 2024-03-24T16:14:35Z
updated_at: 2024-07-29T13:39:33Z
url: https://github.com/clap-rs/clap/issues/5421
synced_at: 2026-01-07T12:31:17-06:00
---

# [derive] Argument `test`'s selected action SetTrue contradicts `takes_value`

---

_Issue opened by @hasezoey on 2024-03-24 16:14_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.76.0 (07dca489a 2024-02-04)

### Clap Version

4.5.3

### Minimal reproducible code

```rust
use clap::Parser;

#[derive(Parser, Debug)]
#[clap(name = "testing")]
pub struct TestArg {
    #[arg(
        long = "test",
        default_missing_value = "true",
        num_args = 0..=1,
        require_equals = true,
    )]
    pub test: bool,
}

fn main() {
    let args = cli::TestArg::parse();

    println!("{:#?}", args);
}
```


### Steps to reproduce the bug with the above code

`cargo run -- --test=false`

### Actual Behaviour

Panic:
```txt
thread 'main' panicked at /home/hasezoey/.local/cargo/registry/src/index.crates.io-6f17d22bba15001f/clap_builder-4.5.2/src/builder/debug_asserts.rs:708:9:
Argument `test`'s selected action SetTrue contradicts `takes_value
```

### Expected Behaviour

No panic, as per documentation [`default_missing_value`](https://docs.rs/clap/latest/clap/struct.Arg.html#method.default_missing_value).

### Additional Context

i know that `default_missing_value` is currently not documented in [derive attributes](https://docs.rs/clap/latest/clap/_derive/index.html#arg-attributes), but i thought it would work anyway.

in case it is not clear, i am trying to do the following without problems:
```txt
cargo run --  # test = false
cargo run --  --test # test = true
cargo run --  --test=true # test = true
cargo run --  --test=false # test = false
```

### Debug Output

```txt
[clap_builder::builder::command]Command::_do_parse
[clap_builder::builder::command]Command::_build: name="testing"
[clap_builder::builder::command]Command::_propagate:testing
[clap_builder::builder::command]Command::_check_help_and_version:testing expand_help_tree=false
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_propagate_global_args:testing
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:test
thread 'main' panicked at /home/hasezoey/.local/cargo/registry/src/index.crates.io-6f17d22bba15001f/clap_builder-4.5.2/src/builder/debug_asserts.rs:708:9:
Argument `test`'s selected action SetTrue contradicts `takes_value`

```

---

_Label `C-bug` added by @hasezoey on 2024-03-24 16:14_

---

_Referenced in [tramhao/termusic#265](../../tramhao/termusic/pulls/265.md) on 2024-03-24 16:20_

---

_Comment by @epage on 2024-03-25 15:22_

There are attributes that are implied by the data type, see https://docs.rs/clap/latest/clap/_derive/index.html#arg-types and if you aren't using the data type in the built-in way, then you have to override those.  In this case, you need to set `action = ArgAction::Set`.

---

_Comment by @hasezoey on 2024-03-25 17:16_

> and if you aren't using the data type in the built-in way, then you have to override those. In this case, you need to set action = ArgAction::Set.

to my knowledge i am using data type `bool`, which is documented as `.action(ArgAction::SetTrue)`, and [`ArgAction::SetTrue`](https://docs.rs/clap/latest/clap/enum.ArgAction.html#variant.SetTrue) has documented

> No value is allowed. To optionally accept a value, see [Arg::default_missing_value](https://docs.rs/clap/latest/clap/struct.Arg.html#method.default_missing_value)

and `default_missing_value` writes:

> NOTE: using this configuration option requires the use of the [.num_args(0..N)](https://docs.rs/clap/latest/clap/struct.Arg.html#method.num_args) and the [.require_equals(true)](https://docs.rs/clap/latest/clap/struct.Arg.html#method.require_equals) configuration option. These are required in order to unambiguously determine what, if any, value was supplied for the argument.

and also a example:

```rs
fn cli() -> Command {
    Command::new("prog")
        .arg(Arg::new("create").long("create")
            .value_name("BOOL")
            .value_parser(value_parser!(bool))
            .num_args(0..=1)
            .require_equals(true)
            .default_missing_value("true")
        )
}
```

Note: i just discovered `default_missing_value` has a example for bools which has `.value_parser(value_parser!(bool))` set, is this something i would also need to do in derive?

---

I have now tested using `action = ArgAction::Set`, and yes this resolves the error. Maybe some documentation updates would be good?

---

_Comment by @epage on 2024-03-25 17:47_

The discrepancy is Builder vs Derive APIs.  The Builder API defaults to `Set` unconditionally while the Derive API tries to be a little smarter.

I've tried to avoid as much talk about the Derive API in the Builder API.  Part of this was from a negative experience as a user when clap had the Builder, YAML, and Usage APIs and each entry point was documented with the schema for them which made the docs more bloated and harder to follow.

---

_Comment by @hasezoey on 2024-03-25 18:27_

> I've tried to avoid as much talk about the Derive API in the Builder API.

i can understand that, so maybe add it as a note when `default_missing_value` gets mentioned in the derive API (as it currently is not listed there)?

---

_Comment by @epage on 2024-03-25 18:42_

`default_missing_value` is covered by a blanket statement on [raw attributes](https://docs.rs/clap/latest/clap/_derive/index.html#terminology).  Its not great but neither are the alternatives.  #4090 is for exploring ways of improving that.

---

_Closed by @epage on 2024-07-29 13:39_

---
