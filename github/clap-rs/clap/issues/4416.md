---
number: 4416
title: Allow visible aliases for PossibleValue
type: issue
state: open
author: dbrgn
labels:
  - C-enhancement
  - A-help
  - A-builder
  - S-waiting-on-design
assignees: []
created_at: 2022-10-22T20:06:35Z
updated_at: 2025-12-01T16:51:05Z
url: https://github.com/clap-rs/clap/issues/4416
synced_at: 2026-01-07T12:31:17-06:00
---

# Allow visible aliases for PossibleValue

---

_Issue opened by @dbrgn on 2022-10-22 20:06_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

4.0.18

### Describe your use case

[Tealdeer](https://github.com/dbrgn/tealdeer/) has a parameter `-p, --platform <PLATFORM>` to select the platform. For historic reasons, this list must include "osx", but should also include the alias "macos". This alias should not be hidden, but should be visible.

With Clap 3, this was implemented using `FromStr`:

```rust
#[derive(Debug, Eq, PartialEq, Copy, Clone, Serialize, Deserialize)]
#[serde(rename_all = "lowercase")]
#[allow(dead_code)]
pub enum PlatformType {
    Linux,
    OsX,
    SunOs,
    Windows,
    Android,
}

impl str::FromStr for PlatformType {
    type Err = anyhow::Error;

    fn from_str(s: &str) -> Result<Self, Self::Err> {
        match s {
            "linux" => Ok(Self::Linux),
            "osx" | "macos" => Ok(Self::OsX),
            "sunos" => Ok(Self::SunOs),
            "windows" => Ok(Self::Windows),
            "android" => Ok(Self::Android),
            other => Err(anyhow!(
                "Unknown OS: {}. Possible values: linux, macos, osx, sunos, windows, android",
                other
            )),
        }
    }
}
```

```rust
    /// Override the operating system
    #[clap(
        short = 'p',
        long = "platform",
        possible_values = ["linux", "macos", "windows", "sunos", "osx", "android"],
    )]
    pub platform: Option<PlatformType>,
```

With Clap 4, I tried to migrate to `EnumValueParser`:

```rust
impl clap::ValueEnum for PlatformType {
    fn value_variants<'a>() -> &'a [Self] {
        &[Self::Linux, Self::OsX, Self::Windows, Self::SunOs, Self::Android]
    }

    fn to_possible_value<'a>(&self) -> Option<clap::builder::PossibleValue> {
        match self {
            Self::Linux => Some(clap::builder::PossibleValue::new("linux")),
            Self::OsX => Some(clap::builder::PossibleValue::new("osx").alias("macos")),
            Self::Windows => Some(clap::builder::PossibleValue::new("windows")),
            Self::SunOs => Some(clap::builder::PossibleValue::new("sunos")),
            Self::Android => Some(clap::builder::PossibleValue::new("android")),
        }
    }
}
```

This works, but the alias is not visible in help output or error messages.

### Describe the solution you'd like

Since `Command` has both `.alias(...)` and `.visible_alias(...)`, would this be possible for `PossibleValue` as well?

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @dbrgn on 2022-10-22 20:06_

---

_Comment by @dbrgn on 2022-10-22 20:08_

Note: [This comment](https://github.com/clap-rs/clap/issues/4226#issuecomment-1251088224) by @epage might be related / an alternative API to the suggested `.visible_alias` method:

> Kind of like how clap switched from possible values being a `&str` to `PossibleValue`, I wonder if we should have an `Alias<T>` which has a `hide` method on it.

---

_Label `A-help` added by @epage on 2022-10-24 13:17_

---

_Label `A-builder` added by @epage on 2022-10-24 13:17_

---

_Label `E-medium` added by @epage on 2022-10-24 13:19_

---

_Label `E-help-wanted` added by @epage on 2022-10-24 13:19_

---

_Comment by @epage on 2022-10-24 13:22_

I broke that comment out into #4421.  I think I'd prefer not going that route for PossibleValue until we do it for everything as it'd be weird to have such a divergent API.

---

_Referenced in [clap-rs/clap#5479](../../clap-rs/clap/issues/5479.md) on 2024-05-01 22:27_

---

_Referenced in [topgrade-rs/topgrade#787](../../topgrade-rs/topgrade/issues/787.md) on 2024-05-06 13:02_

---

_Referenced in [clap-rs/clap#5480](../../clap-rs/clap/pulls/5480.md) on 2024-06-23 00:06_

---

_Comment by @epage on 2024-06-23 00:08_

The big question for me for this is how visible aliases for possible values should be rendered.  In the short help, it feels weird to redundantly list options that map back to the same thing and would get weird nesting expressions into each other.  With long help, we could have an `[aliases: ...]`  after the item, I guess.

---

_Label `E-medium` removed by @epage on 2024-06-23 00:14_

---

_Label `E-help-wanted` removed by @epage on 2024-06-23 00:14_

---

_Label `S-waiting-on-design` added by @epage on 2024-06-23 00:14_

---

_Comment by @AmmarAbouZor on 2024-08-21 07:54_

I thought of two solutions for the short help:
* Not rendering them in that case at all since the short help should be compact and it must not have all the information (Like we are not printing the description for value eighter)
* Adding brackets next to each option without the word 'aliases' in it. Something like `[possible values: foo-option (foo, f) , bar-option (b), no-alias-option]`

We can make printing aliases in short description optional be adding a boolean or a flag for the function. Something like:
```rust
// Boolean option 
pub fn visible_alias(mut self, name: impl IntoResettable<Str>, short-help: bool) -> ...

// Flag option 
pub fn visible_alias(mut self, name: impl IntoResettable<Str>, flags: AliasFlags) -> ...
bitflags! {
    pub struct AliasFlags: u32 {
        const ShortHelp = 0b00000001;
       ...
    }
}
```

---

_Comment by @epage on 2024-08-21 14:03_

> We can make printing aliases in short description optional be adding a boolean or a flag for the function.

We're trying to keep minimum the configuration we provide, focusing on a consistent, quality out of box experience.

---

_Referenced in [biomejs/gritql#544](../../biomejs/gritql/pulls/544.md) on 2024-10-21 16:40_

---

_Comment by @Alex-ley-scrub on 2024-10-25 18:52_

@dbrgn you could probably achieve something similar to what you want (at least displaying them all - not more custom formatting) using something like this:

`PossibleValuesParser.map() -> MapValueParser` ([docs.rs](https://docs.rs/clap/latest/clap/builder/struct.PossibleValuesParser.html#method.map))

i.e. `possible_values()` returns all of the names + aliases and `map_value()` does the many-to-one alias mapping to your defined enum variants.

see: https://github.com/getgrit/gritql/pull/544/commits/a5887a7

```rust
use clap::builder::{MapValueParser, PossibleValuesParser, TypedValueParser};

#[derive(ValueEnum, Debug, Clone, Copy, Default, PartialEq, Eq, Hash, Serialize, Deserialize)]
#[clap(rename_all = "lower")]
#[serde(rename_all = "lowercase")]
pub enum PlatformType {
    ...
}

impl PlatformType {
    fn get_aliases(&self) -> &'static [&'static str] {
        ...
    }

    fn map_value(s: String) -> Self {
        ...
    }

    fn possible_values() -> Vec<&'static str> {
        ...
    }

    pub fn value_parser() -> MapValueParser<PossibleValuesParser, fn(String) -> Self> {
        PossibleValuesParser::new(Self::possible_values()).map(|s| Self::map_value(s))
    }
```

usage:
```rust
#[derive(Args, Clone, Debug, Serialize)]
pub struct YourArgs {
    #[clap(short = 'p', long = "platform", value_parser = PlatformType::value_parser())]
    pub platform: Option<PlatformType>,
}
```

---

_Comment by @theotchlx on 2025-11-25 15:42_

Hi, when I wrote [this commit](https://github.com/ricktaylor/hardy/commit/b1ab229bd4c55fa0b49b5a44fbd485b2e3e0aef3), I couldn't find a way to print the aliases from the ValueEnum with `--help`.
So I hard-coded the aliases in the doc comments as you can see...:
```
    /// Standard X-25 CRC-16 [aliases: crc16_x25, 16]
    #[clap(alias = "crc16_x25", alias = "16")]
```

I don't like this, and I reckon this is originates from this issue.

If possible I'd like to get it done so that I can get rid of my hard-coded values in this other code. There seems to be unanswered design questions as to how to provide this feature?

---

_Comment by @eirnym on 2025-11-25 18:43_

I think it's better to have an unstable (versioned?) implementation rather than no implementation. 

---

_Comment by @theotchlx on 2025-11-26 07:25_

> I think it's better to have an unstable (versioned?) implementation rather than no implementation.

Could you clarify your thoughts? Are you referring to an existing implementation or some design idea?

---

_Comment by @eirnym on 2025-11-26 15:59_

The main problem I see in this PR is not that implementation of this PR would help people, but _how_ data should be presented to a user. My statement is that any implementation would be better than no implementation. 

There always be people, who don't agree on specific output. For example, we all know from the past, that major version may break how data is configured and presented, this is why I still see multiple tools using clap 3.x rather than the latest version. 

My additional proposal is to have presentation to be always feature-gated. And if there would be mechanism to provide representation of a specific feature, it would be even better. In this way even new representation would be placed, most people would use newest library version. rather than froze the version.

---

_Comment by @theotchlx on 2025-11-26 22:50_

The feature flag seems like a nice idea, but I wouldn't use it (same reasons as [this comment](https://github.com/clap-rs/clap/issues/4416#issuecomment-2302136777) I suppose).
It's more configuration for the devs (for a CLI!), e.g. with the commit I linked earlier, I don't want to add a feature flag on the CLI package, demonstrate to the maintainer why this is needed, and that it's transitive until the feature gets rolled out in some future version, when this flag will have to be removed.

---

All in all I think we should just design this. It has to be done some day anyway :P

It looks like the design is on hold, as per [this comment](https://github.com/clap-rs/clap/issues/4416#issuecomment-2184258391) from @epage :

> The big question for me for this is how visible aliases for possible values should be rendered. In the short help, it feels weird to redundantly list options that map back to the same thing and would get weird nesting expressions into each other. With long help, we could have an [aliases: ...] after the item, I guess.

I think the `[aliases: ...] ` idea is neat :-)

---

_Comment by @eirnym on 2025-11-26 23:31_

I understand. There's won't be a "standard" output which will be great for everyone. There's always be people who doesn't want something, who wants it in way it's implemented and many of them who want it differently. For example, I'd like some minor parts of `clap --help` output to be formatted differently and make eventually `clap --help` localized. Because of the same issues some applications just froze clap level, others hard-coded the output they like and in some applications I might do the same. 

`clap` could make output modular and configurable. E.g. to have default output, provide ability to pass a formatter function-like object directly and provide a separate module to keep legacy formats. This will satisfy all groups and keep standards while keeping all things clean. The additional improvement is this would open an ability to experiment and add multiple additional not yet implemented in standard way features like this one. 

By the way, Rust ecosystem is one of the worst across multiple languages to provide localized messages to the user. And the biggest reasons are "we don't want to expose internal parts of `Error` enum" and "we want to make it in the one and only standard way".

---

_Comment by @theotchlx on 2025-11-27 14:17_

That's an idea with even more flexibility, which is great, but that comes with again more configuration and as I understand that's not the point of clap

I mean we can provide an out-of-the-box "display aliases" thing and then, in a later issue, add a general formatter for clap but I feel this is a different beast.

I'd love to get a maintainer's input on if we can finalize the design for this feature and release something?

---

_Comment by @epage on 2025-12-01 16:51_

> That's an idea with even more flexibility, which is great, but that comes with again more configuration and as I understand that's not the point of clap

Earlier I commented about minimizing configuration (https://github.com/clap-rs/clap/issues/4416#issuecomment-2302136777).  That was specifically about having a toggle for every little custom behavior someone might want.   Those add binary bloat, slow down compile times, and bypass us having the conversations about what clap should do by default for all projects.

I would very much be interested in splitting the help generation out into a type that collects data and a type that formats to put that behind a trait for people to provide whatever they need.  Then instead of clap dynamically choosing between hard coded help and dynamically generated help, users can get what they want for help without paying extra in compilation time.  I just haven't had a chance yet to work on this.

> I'd love to get a maintainer's input on if we can finalize the design for this feature and release something?

I've not yet seen a concrete proposal for what the API and help output would be.

---
