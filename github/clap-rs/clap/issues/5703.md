---
number: 5703
title: "Support for `value_parser_if`"
type: issue
state: closed
author: 0xForerunner
labels:
  - C-enhancement
assignees: []
created_at: 2024-08-27T15:37:26Z
updated_at: 2024-08-27T16:01:10Z
url: https://github.com/clap-rs/clap/issues/5703
synced_at: 2026-01-07T12:31:17-06:00
---

# Support for `value_parser_if`

---

_Issue opened by @0xForerunner on 2024-08-27 15:37_

### Clap Version

master

### Describe your use case

I think it would be really useful to have flag dependent value parsers. Here's an example:
```rust
enum Emotion {
    Happy(Happy),
    Sad(Sad),
}

/// This is the default
enum Happy {
    Red,
    Yellow,
    Green
}

/// Note there can possibly be collisions here. Some values 
/// are valid for both emotions.
/// This means untagged enums are not an option for me.
enum Sad {
    Blue,
    Purple,
    Green
}
```

I want my cli to work like this:
`cli --color red` this should work
`cli --color blue` this should error
`cli --sad --color blue` this should work
`cli --sad --color red` this should error

### Describe the solution you'd like

I think specifying `value_parser_if` and `value_parser_ifs` would be great here. Perhaps there's another solution that I'm overlooking


---

_Label `C-enhancement` added by @0xForerunner on 2024-08-27 15:37_

---

_Comment by @epage on 2024-08-27 15:50_

`value_parser`s are processed while are are parsing which prevents it from being able to know the state of other arguments (e.g. `cli --sad --color red` could be `cli --color red --sad`).

This would best be done independent of `value_parser` as a validation step on the arguments as a whole. That can be done within your application.  If you are looking for a clap related solution, we've been discussing it at #3476.

---

_Closed by @epage on 2024-08-27 15:50_

---

_Comment by @0xForerunner on 2024-08-27 16:01_

@epage thanks for the quick response and all your hard work on this project!

---
