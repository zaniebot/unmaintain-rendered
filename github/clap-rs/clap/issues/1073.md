---
number: 1073
title: suboptimal flag suggestion
type: issue
state: closed
author: BurntSushi
labels:
  - C-enhancement
  - E-medium
  - E-help-wanted
assignees: []
created_at: 2017-10-21T22:42:48Z
updated_at: 2020-04-12T16:58:38Z
url: https://github.com/clap-rs/clap/issues/1073
synced_at: 2026-01-07T12:31:16-06:00
---

# suboptimal flag suggestion

---

_Issue opened by @BurntSushi on 2017-10-21 22:42_

<!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

### Rust Version

`rustc 1.17.0 (56124baa9 2017-04-24)`

### Affected Version of clap

`2.26.2`

### Expected Behavior Summary

CLI error message suggests `--files-without-match`

### Actual Behavior Summary

CLI error message suggests `--files-with-matches`

### Steps to Reproduce the issue

```
$ cargo new ripgrep-616 --bin
$ $EDITOR Cargo.toml
... add `clap` to dependencies
$ cat > src/main.rs <<EOF
extern crate clap;

use clap::{App, Arg};

fn main() {
    let app = App::new("ripgrep-616")
        .arg(Arg::with_name("files-with-matches").long("files-with-matches"))
        .arg(Arg::with_name("files-without-match").long("files-without-match"));
    app.get_matches();
}
EOF
$ cargo run -- --files-without-matches
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/ripgrep-616 --files-without-matches`
error: Found argument '--files-without-matches' which wasn't expected, or isn't valid in this context
        Did you mean --files-with-matches?

USAGE:
    ripgrep-616 --files-with-matches

For more information try --help
```

### Sample Code or Link to Sample Code

See above.

### Debug output

```
cargo run -- --files-without-matches
   Compiling clap v2.26.2
   Compiling ripgrep-616 v0.1.0 (file:///tmp/ripgrep-616)
    Finished dev [unoptimized + debuginfo] target(s) in 16.63 secs
     Running `target/debug/ripgrep-616 --files-without-matches`
DEBUG:clap:Parser::propogate_settings: self=ripgrep-616, g_settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing '"--files-without-matches"' ([45, 45, 102, 105, 108, 101, 115, 45, 119, 105, 116, 104, 111, 117, 116, 45, 109, 97, 116, 99, 104, 101, 115])
DEBUG:clap:Parser::is_new_arg: arg="--files-without-matches", Needs Val of=NotFound
DEBUG:clap:Parser::is_new_arg: Arg::allow_leading_hyphen(false)
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg="--files-without-matches"
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:Parser::parse_long_arg;
DEBUG:clap:Parser::parse_long_arg: Does it contain '='...No
DEBUG:clap:Parser::parse_long_arg: Didn't match anything
DEBUG:clap:Parser::groups_for_arg: name=files-with-matches
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::smart_usage;
DEBUG:clap:usage::get_required_usage_from: reqs=["files-with-matches"], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=["files-with-matches"]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::get_required_usage_from:iter:files-with-matches:
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
error: Found argument '--files-without-matches' which wasn't expected, or isn't valid in this context
        Did you mean --files-with-matches?

USAGE:
    ripgrep-616 --files-with-matches

For more information try --help
```

### Other

This bug was reported to ripgrep: https://github.com/BurntSushi/ripgrep/issues/616

Note that I don't *necessarily* think this can or should be fixed. In particular, these sorts of algorithms often involve heuristics, and making one case better may make other cases worse. Regardless, I wanted to shuffle this off to you in case there was something here.

---

_Referenced in [BurntSushi/ripgrep#616](../../BurntSushi/ripgrep/issues/616.md) on 2017-10-21 22:43_

---

_Comment by @kbknapp on 2017-10-22 00:31_

Thanks for pinging me and taking the time to file this! I've been swamped lately and haven't viewed my notifications in quite some time :smile: 

I'm *pretty sure* this is due to the heuristics used in [`strsim`](https://github.com/dguo/strsim-rs) which is actually quite tweakable. I'm currently using a [moderately arbitrary configuration](https://github.com/kbknapp/clap-rs/blob/569ced1f3d7036c3d6b3090a77e64161bfe1a01c/src/suggestions.rs#L22-L26), so it almost certainly can be improved. It's also code from two years ago (according to `git blame`), and `strsim` has changed and added features since then.

In this particular case if we discounted all matching characters in sequence, and only "compared" the remainder I'm sure it'd be more accurate. But I don't know if that would change other cases without a bit of testing.

So I'll leave this open in case someone wants to take a stab at it. Although, with the issues I've got in the backlog it'll be a low priority issue for me.

---

_Label `D: intermediate` added by @kbknapp on 2017-10-22 00:32_

---

_Label `help wanted` added by @kbknapp on 2017-10-22 00:32_

---

_Label `M: mentored` added by @kbknapp on 2017-10-22 00:32_

---

_Label `P4: nice to have` added by @kbknapp on 2017-10-22 00:32_

---

_Label `T: enhancement` added by @kbknapp on 2017-10-22 00:32_

---

_Label `W: 2.x` added by @kbknapp on 2017-10-22 00:32_

---

_Label `W: 3.x` added by @kbknapp on 2018-07-22 02:46_

---

_Label `W: 2.x` removed by @kbknapp on 2018-07-22 02:46_

---

_Added to milestone `3.0` by @pksunkara on 2020-04-09 07:10_

---

_Comment by @pksunkara on 2020-04-09 07:13_

@pickfire Since you worked on https://github.com/clap-rs/clap/pull/1710, do you think you can make a PR for this after testing that this is still an issue?

---

_Comment by @pickfire on 2020-04-11 11:55_

@pksunkara Thanks for pinging me on this old issue, I am surprised you still remembered it. I will check and add it to the tests.

---

_Comment by @pickfire on 2020-04-11 15:23_

@pksunkara No, that PR does not affect this. The output is still the same, probably.
```
    Finished dev [unoptimized + debuginfo] target(s) in 0.04s
     Running `target/debug/clap --files-without-matches`
error: Found argument '--files-without-matches' which wasn't expected, or isn't valid in this context
        Did you mean --files-without-match?
If you tried to supply `--files-without-matches` as a PATTERN use `-- --files-without-matches`

USAGE:
    clap --files-without-match

For more information try --help
```
But yes, the issue @BurntSushi is fixed. It recommends `--files-without-match` now. Should I still write a test for this?

---

_Comment by @pksunkara on 2020-04-11 15:43_

Yes, please add a test. If you see [here](https://github.com/clap-rs/clap/blob/5d2876163028b71c5b170d290c730bf472de7b97/tests/opts.rs#L6), the current test works with only 1 option.

---

_Referenced in [clap-rs/clap#1814](../../clap-rs/clap/pulls/1814.md) on 2020-04-12 15:46_

---

_Closed by @bors[bot] on 2020-04-12 16:58_

---

_Closed by @bors[bot] on 2020-04-12 16:58_

---
