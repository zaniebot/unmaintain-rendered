---
number: 3215
title: long_help() output includes output from long_version() instead of short_version()
type: issue
state: closed
author: ducaale
labels:
  - C-bug
  - A-help
  - S-waiting-on-author
assignees: []
created_at: 2021-12-24T09:23:36Z
updated_at: 2021-12-30T18:41:18Z
url: https://github.com/clap-rs/clap/issues/3215
synced_at: 2026-01-07T12:31:17-06:00
---

# long_help() output includes output from long_version() instead of short_version()

---

_Issue opened by @ducaale on 2021-12-24 09:23_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

rustc 1.56.0 (09c42c458 2021-10-18)

### Clap Version

3.0.0-rc.8

### Minimal reproducible code

```rust
use clap::Parser;

fn long_version() -> &'static str {
    concat!(env!("CARGO_PKG_VERSION"), "\n", "+native-tls")
}

/// Simple program to greet a person
///
/// longer description
#[derive(Parser, Debug)]
#[clap(about, version, author, long_version = long_version())]
struct Args {
    /// Name of the person to greet
    #[clap(short, long)]
    name: String,

    /// Number of times to greet
    #[clap(short, long, default_value_t = 1)]
    count: u8,
}

fn main() {
    let args = Args::parse();

    for _ in 0..args.count {
        println!("Hello {}!", args.name)
    }
}

```


### Steps to reproduce the bug with the above code

```
cargo run -- --help
```

### Actual Behaviour

Help output includes `+native-tls` because it uses the output from `--version` rather than `-V`
```
temp-clap 0.1.0
+native-tls
Simple program to greet a person

longer description

USAGE:
    temp-clap [OPTIONS] --name <NAME>

OPTIONS:
    -c, --count <COUNT>
            Number of times to greet

            [default: 1]

    -h, --help
            Print help information

    -n, --name <NAME>
            Name of the person to greet

    -V, --version
            Print version information
```

### Expected Behaviour

```
temp-clap 0.1.0
Simple program to greet a person

longer description

USAGE:
    temp-clap [OPTIONS] --name <NAME>

OPTIONS:
    -c, --count <COUNT>
            Number of times to greet

            [default: 1]

    -h, --help
            Print help information

    -n, --name <NAME>
            Name of the person to greet

    -V, --version
            Print version information
```

### Additional Context

~This bug only occurs when I set the long description for Clap.~ It happens every time the long help is outputted.

### Debug Output

No response

---

_Label `C-bug` added by @ducaale on 2021-12-24 09:23_

---

_Comment by @epage on 2021-12-24 11:56_

Could you expand on why you consider it a bug for us to  show the long version when we also show the long help?

---

_Label `S-waiting-on-author` added by @epage on 2021-12-24 11:56_

---

_Label `A-help` added by @epage on 2021-12-24 11:56_

---

_Comment by @ducaale on 2021-12-24 12:29_

Some CLI apps i.e ripgrep, include more output such as "enabled features" in the long version. And because Clap 2.x used the short version everywhere, there weren't any issues with that.


---

_Renamed from "Setting long description causes long_version() to be used in --help output" to "long_version() to be used in long_help() output" by @ducaale on 2021-12-24 13:42_

---

_Renamed from "long_version() to be used in long_help() output" to "long_help() output includes output from long_version() instead of short_version()" by @ducaale on 2021-12-24 13:43_

---

_Comment by @epage on 2021-12-24 18:05_

Ok, so this was a change of behavior from clap2 that you are concerned about.

Looks like this changed in #2369 without any direct acknowledgement (even says "version output is unchanged").  A reviewer did comment on it, just saying "Nice catch, adding a regression test would be great.".

@ldm0 any further background on why you were thinking its good for `--help` to show long version instead of the short version?

Still unsure of my thoughts.  I wonder if this might be a case similar to #3193.  In that, we only show short subcommand help, deferring to the subcommand's help for more details.  Here, it might make sense for us to show the short version, deferring to the long version for more details.

---

_Comment by @epage on 2021-12-27 16:32_

@BurntSushi as someone who uses long-version, what are your thoughts on long help (`--help`) showing the long-version ("because its showing other long info", well, except subcommands) or showing the short version (delegating to `--version`)?

During clap3, `--help` was changed from showing the short version to showing the long version.  There doesn't seem to have been any documented motivation behind the change.  Trying to weigh out the different perspectives before making a decision.

---

_Added to milestone `3.0` by @epage on 2021-12-27 16:32_

---

_Referenced in [clap-rs/clap#3232](../../clap-rs/clap/pulls/3232.md) on 2021-12-30 18:25_

---

_Closed by @epage on 2021-12-30 18:41_

---

_Referenced in [ducaale/xh#216](../../ducaale/xh/pulls/216.md) on 2022-01-01 18:26_

---
