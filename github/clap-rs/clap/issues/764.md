---
number: 764
title: Argument cannot require a particular value of positional argument
type: issue
state: closed
author: nagisa
labels: []
assignees: []
created_at: 2016-12-04T14:34:23Z
updated_at: 2016-12-29T16:57:24Z
url: https://github.com/clap-rs/clap/issues/764
synced_at: 2026-01-07T12:31:16-06:00
---

# Argument cannot require a particular value of positional argument

---

_Issue opened by @nagisa on 2016-12-04 14:34_

### Affected Version of clap

* 2.19.1

### Expected Behavior Summary

The application works *or* clap reports a misconfiguration error.

### Actual Behavior Summary

Instead clap complains about some required argument not being provided

```
     Running `.../kt --error 0.25 channel`
error: The following required arguments were not provided:

USAGE:
    kt <ELEMENT> --error <error>
```

and doesnâ€™t accept either of `--error 0.25` or `channel` positional argument in isolation:

```
     Running `.../kt --error 0.25`
error: The following required arguments were not provided:

USAGE:
    kt --error <error>
```

```
     Running `.../kt channel`
error: The following required arguments were not provided:

USAGE:
    kt <ELEMENT> --error <error>
```

### Steps to Reproduce the issue

```
        .arg(Arg::with_name("error")
             .long("error")
             .requires("channel") // NB: particular value of a positional argument
             .default_value("0.25")
        )
        .arg(Arg::with_name("element")
             .value_name("ELEMENT")
             .possible_value("channel")
             .min_values(1)
        );
```

---

_Comment by @kbknapp on 2016-12-05 02:16_

`Arg::requires` takes an argument name, not an argument value. Try:

```rust
       .arg(Arg::with_name("error")
             .long("error")
             .requires("element") // Use the name, not the value
             .default_value("0.25")
        )
        .arg(Arg::with_name("element")
             .value_name("ELEMENT")
             .possible_value("channel")
             .min_values(1)
        );
```

Let me know if that works as expected. :wink:

---

_Label `T: RFC / question` added by @kbknapp on 2016-12-05 02:17_

---

_Comment by @nagisa on 2016-12-05 05:30_

The point of this issue is that I want to require specific value of (there
might be more valid values added eventually) the positional argument.

I understand the feature like that not being built-in, but I would very
much like if clap at very least figured out the argument config was
malformed (i.e. I required a non-existant argument) and told me so.

On Dec 5, 2016 04:16, "Kevin K." <notifications@github.com> wrote:

> Arg::requires takes an argument name, not an argument value. Try:
>
> .arg(Arg::with_name("error")
>              .long("error")
>              .requires("element") // NB: particular value of a positional argument
>              .default_value("0.25")
>         )
>         .arg(Arg::with_name("element")
>              .value_name("ELEMENT")
>              .possible_value("channel")
>              .min_values(1)
>         );
>
> Let me know if that works as expected. ðŸ˜‰
>
> â€”
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> <https://github.com/kbknapp/clap-rs/issues/764#issuecomment-264753220>,
> or mute the thread
> <https://github.com/notifications/unsubscribe-auth/AApc0qDGpgdxoZBD_22kiS4iT8RATLgIks5rE3QQgaJpZM4LDmS5>
> .
>


---

_Comment by @kbknapp on 2016-12-05 16:41_

> The point of this issue is that I want to require specific value of (there
might be more valid values added eventually) the positional argument.


Ahhh Ok, my mistake! There seems to be two version of this issue in my mind.

 1. Upon receiving the value `channel`, `--error <error>` is now required.
  * Implemented via `Arg::requires_if(arg, value)` (set on `"element"` as in `element.requires_if("error", "channel")`)
 2. Using `--error <error>` requires that `<element>` be set to `channel`.
  * Perhaps implemented via `Arg::default_if(arg, default)` (set on `"element"` as in `element.default_if("error", "channel")`)
  * An alternative would be `Arg::default_if(arg, value, default)` (i.e. only use this default is `arg` is used, *and* with value `value` such as `element.default_if("error", "some_val", "channel")`)

Both seem doable, although I haven't tried implementing them yet.

With number 2, the only issue I can see is should this be a new default (i.e. only set `<element>` to `channel` if the user didn't `<element>` directly), or a mandatory setting (i.e. override the user's manual value)? The silently override user input seems dangerous to me and is something I'm not interested in doing. The new default value seems legitimate to me.

> but I would very much like if clap at very least figured out the argument config was
malformed

I had a branch which was the base of 3.x which used enum variants as argument keys instead of strings (although was still backwards compatible with strings) which solved exactly this. Although I've been waiting for Macros 1.1 in order to finish this.

Edit: more thoughts on the matter

---

_Label `C: args` added by @kbknapp on 2016-12-05 16:42_

---

_Label `D: intermediate` added by @kbknapp on 2016-12-05 16:42_

---

_Label `P4: nice to have` added by @kbknapp on 2016-12-05 16:42_

---

_Label `T: new feature` added by @kbknapp on 2016-12-05 16:42_

---

_Label `W: 2.x` added by @kbknapp on 2016-12-05 16:42_

---

_Label `T: RFC / question` removed by @kbknapp on 2016-12-05 16:42_

---

_Added to milestone `2.20.0` by @kbknapp on 2016-12-05 16:42_

---

_Comment by @kbknapp on 2016-12-10 04:42_

I'm working on this in a local branch, here's the TODO:

- [x] Conditional default values (`Arg::default_value_if[s]`, This arg has a default value of ____ in the following conditions)
  - [x] Implmement `default_value_if`
  - [x] Implmeent `default_value_ifs`
  - [x] `default_value_if` docs
  - [x] `default_value_ifs` docs
  - [x] `default_value_if` tests
  - [x] `default_value_ifs` tests
  - [x] `default_value_if` YAML
  - [x] `default_value_ifs` YAML
- [x] Conditional requirements (`Arg::required_if[s]`, or "This arg becomes required in the following conditions...)
  - [x] Implement `required_if`
  - [x] Implement `required_ifs`
  - [x] `required_if` docs
  - [x] `required_ifs` docs
  - [x] `required_if` tests
  - [x] `required_ifs` tests
  - [x] `required_if` YAML
  - [x] `required_ifs` YAML
- [x] Conditional external requirements (`Arg::requires_if[s]`, This arg has additional requirements in the following conditions...)
  - [x] `requires_if` docs
  - [x] `requires_ifs` docs
  - [x] Implement `requires_if`
  - [x] Implement `requires_ifs`
  - [x] `requires_if` tests
  - [x] `requies_ifs` tests
  - [x] `requires_if` YAML
  - [x] `requires_ifs` YAML

---

_Assigned to @kbknapp by @kbknapp on 2016-12-27 04:46_

---

_Closed by @homu on 2016-12-29 16:57_

---
