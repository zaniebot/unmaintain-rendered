---
number: 4849
title: Clippy almost swap triggering on clap subcommand and Parser
type: issue
state: closed
author: kristian1108
labels:
  - C-bug
assignees: []
created_at: 2023-04-20T16:44:42Z
updated_at: 2023-04-20T17:08:45Z
url: https://github.com/clap-rs/clap/issues/4849
synced_at: 2026-01-07T12:31:17-06:00
---

# Clippy almost swap triggering on clap subcommand and Parser

---

_Issue opened by @kristian1108 on 2023-04-20 16:44_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.69.0 (84c898d65 2023-04-16)

### Clap Version

Multiple versions in my Cargo.lock: 2.34.0, 3.2.23, 4.2.1

### Minimal reproducible code

```rust
use clap::Parser;

#[derive(Debug, Parser)]
#[clap(name = "test")]
#[clap(bin_name = "test")]
pub enum Test {
    TestSubcommandOne(TestOne),
    TestSubcommandTwo(TestTwo),
    TestThree
}

#[derive(clap::Args, Debug)]
#[clap(author, version, about, long_about = None)]
pub struct TestOne {
    #[clap(short, long, value_parser)]
    pub test_one: String,
    #[clap(short, long, value_parser)]
    pub test_two: String
}

#[derive(clap::Args, Debug)]
#[clap(author, version, about, long_about = None)]
pub struct TestTwo {
    #[clap(short, long, value_parser)]
    pub test_one: String,
    #[clap(short, long, value_parser)]
    pub test_two: String
}

fn main() {
    let args = Test::parse();
}
```


### Steps to reproduce the bug with the above code

`cargo clippy`

### Actual Behaviour

error: this looks like you are trying to swap `__clap_subcommand` and `Parser`
  --> src/test/test.rs:57:17
   |
57 | #[derive(Debug, Parser)]
   |                 ^^^^^^
   |
   = note: or maybe you should use `std::mem::replace`?
   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#almost_swapped


### Expected Behaviour

Should not fail. 

### Additional Context

Looks like it's related to this closed issue: https://github.com/clap-rs/clap/issues/4733

### Debug Output

_No response_

---

_Label `C-bug` added by @kristian1108 on 2023-04-20 16:44_

---

_Comment by @kristian1108 on 2023-04-20 17:08_

Sorry, this is fixed in the +nightly toolchain.

---

_Closed by @kristian1108 on 2023-04-20 17:08_

---

_Referenced in [rust-lang/rust-clippy#10676](../../rust-lang/rust-clippy/issues/10676.md) on 2023-04-21 00:05_

---

_Referenced in [bytebeamio/rumqtt#610](../../bytebeamio/rumqtt/pulls/610.md) on 2023-04-21 05:59_

---
