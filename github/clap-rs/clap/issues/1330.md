---
number: 1330
title: "Can't use named arguments if they have index"
type: issue
state: closed
author: Amomum
labels:
  - A-docs
  - E-help-wanted
  - E-easy
  - ":money_with_wings: $5"
assignees: []
created_at: 2018-08-17T13:34:24Z
updated_at: 2020-10-18T22:08:01Z
url: https://github.com/clap-rs/clap/issues/1330
synced_at: 2026-01-07T12:31:16-06:00
---

# Can't use named arguments if they have index

---

_Issue opened by @Amomum on 2018-08-17 13:34_

<!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

### Rust Version

rustc 1.28.0 

### Affected Version of clap

clap 2.32.0

### Bug or Feature Request Summary

When I create an argument with a name and give it explicit index, it can only be used by index; its name is not parsed correctly.

### Expected Behavior Summary

I'm not sure if it's a bug, it may be an intenional design decision.
So I would be glad to see one of two behaviours:

If it's a bug: I can give argument name and index simultaneously and it will work both ways - if no name is given - argument is parsed by it's index

If it's an intentional behaviour: I would like to see a more clear error when I try to use index and argument name (i.e. short() or long() with index()) simultaneously. A panic maybe?

### Actual Behavior Summary

```
error: Found argument '--htm' which wasn't expected, or isn't valid in this context
```

### Steps to Reproduce the issue

Create argument with short or long name and index. Call app with named argument.

### Sample Code or Link to Sample Code
```
let args = App::new( env!("CARGO_PKG_NAME") )
        .arg( Arg::with_name("htm file")
            .long("htm")
            .index(1)
            .required(true)
            .takes_value(true);
```


---

_Comment by @CreepySkeleton on 2020-02-02 07:33_

From the doc:

> Specifies the index of a **positional** argument

Index should not be used for short/long options.

I'm leaving this open as a reminder to check and tidy up the doc. 

---

_Label `C: docs` added by @CreepySkeleton on 2020-02-02 07:33_

---

_Label `good first issue` added by @CreepySkeleton on 2020-02-02 07:33_

---

_Label `help wanted` added by @CreepySkeleton on 2020-02-02 07:33_

---

_Label `W: 2.x` added by @CreepySkeleton on 2020-02-02 07:33_

---

_Label `W: 3.x` added by @CreepySkeleton on 2020-02-02 07:33_

---

_Added to milestone `3.0` by @CreepySkeleton on 2020-02-02 07:33_

---

_Label `C: asserts` added by @pksunkara on 2020-04-12 10:19_

---

_Comment by @pksunkara on 2020-04-12 10:19_

We should create an assert also.

---

_Label `:money_with_wings: $10` added by @pksunkara on 2020-08-14 13:52_

---

_Label `:money_with_wings: $10` removed by @pksunkara on 2020-08-14 14:28_

---

_Label `W: 2.x` removed by @pksunkara on 2020-08-14 14:28_

---

_Label `W: 3.x` removed by @pksunkara on 2020-08-14 14:28_

---

_Label `:money_with_wings: $5` added by @pksunkara on 2020-08-14 14:28_

---

_Label `D: easy` added by @pksunkara on 2020-08-14 14:28_

---

_Label `P3: want to have` added by @pksunkara on 2020-08-14 14:28_

---

_Comment by @pksunkara on 2020-08-14 15:05_

This issue now has bounty of **$5**. More info [here](https://github.com/clap-rs/clap/wiki/Issue-Bounties)

---

_Comment by @liamdawson on 2020-08-15 00:25_

As a counterpoint, `virsh` from libvirt allows positional parameters to be defined as flags instead. As in:

```
virsh vol-list --pool=images
virsh vol-list images
```

behave the same way. Similarly, the following are identical in behaviour:

```
virsh vol-create-as images guest 20G
virsh vol-create-as --pool=images --name=guest --capacity=20G
virsh vol-create-as --name=guest --pool=images 20G
```

I'm not suggesting clap needs this functionality, but there is a precedent for positional arguments being supported as flags.

---

_Comment by @pksunkara on 2020-08-15 00:34_

You can still do that here. But you have to actually define two args for this.

---

_Removed from milestone `3.0` by @pksunkara on 2020-10-12 08:40_

---

_Added to milestone `3.1` by @pksunkara on 2020-10-12 08:40_

---

_Comment by @CastilloDel on 2020-10-18 12:09_

I would be interested in solving this. I've looking at the code and I've thought of two solutions:
- Introduce assertions in the index, long and short methods from the Arg class(and other methods if needed)
- Add a function to the App class that gets called before _do_parse and that iterates over the Args looking for incongruities like this one.

The first one seems simpler to me and it makes more sense to me. If an Arg is inconsistent it should be the Arg itself that catches that.
The second one is more general and could also be used to catch other errors. Also, there could be a special clap::parse::Error variant for this, if that seems more elegant than a panic or an assertion.

I would like some guidance on which way should I take :) 

---

_Comment by @pksunkara on 2020-10-18 12:15_

We already have a place for it, https://github.com/clap-rs/clap/blob/1519ec81f79ad6f0ff1c94bf6a9af1c84e1a943f/src/build/arg/mod.rs#L4346

---

_Comment by @CastilloDel on 2020-10-18 12:43_

I thought this should work outside the debug config. Glad I asked, ty!

---

_Referenced in [clap-rs/clap#2177](../../clap-rs/clap/pulls/2177.md) on 2020-10-18 18:53_

---

_Closed by @bors[bot] on 2020-10-18 22:08_

---
