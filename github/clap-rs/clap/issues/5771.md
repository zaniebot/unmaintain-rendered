---
number: 5771
title: "[nushell] Generates invalid completions when variadic arg is used with last=true arg"
type: issue
state: open
author: milesj
labels:
  - C-bug
  - E-medium
  - A-completion
assignees: []
created_at: 2024-10-09T00:17:09Z
updated_at: 2024-10-09T14:48:05Z
url: https://github.com/clap-rs/clap/issues/5771
synced_at: 2026-01-07T12:31:17-06:00
---

# [nushell] Generates invalid completions when variadic arg is used with last=true arg

---

_Issue opened by @milesj on 2024-10-09 00:17_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.81.0 (eeb90cda1 2024-09-04)

### Clap Version

4.5.19

### Minimal reproducible code

```rust
use clap::Args;
use clap_complete::generate;
use clap_complete_nushell::Nushell;

#[derive(Args)]
pub struct ExampleArgs {
    #[arg(required = true, help = "...")]
    pub id: Vec<String>,

    // after --
    #[arg(last = true, help = "...")]
    pub passthrough: Vec<String>,
}

#[derive(Subcommand)]
pub enum CliCommand {
  #[command(name = "example")
  Example(ExampleArgs),
}

#[derive(Parser)]
pub struct Cli {
  #[command(subcommand)]
  pub command: CliCommand,
}

fn main() {
  let mut app = Cli::command();
  let mut stdio = std::io::stdout();
  generate(Nushell, &mut app, "bin", &mut stdio);
}
```

### Steps to reproduce the bug with the above code

cargo run -- example

### Actual Behaviour

It generates a completion that uses `...<arg>: string` syntax for both the variadic arg, and the `last` arg. This results in Nu erroring with "Multiple rest params".

Example: https://cdn.discordapp.com/attachments/974160221452763149/1289506849053343845/image.png?ex=6706ea16&is=67059896&hm=6df6cb538be11ccf5a531f46c2dab73013e965749fe809a95287666b16188803&

### Expected Behaviour

This generates a valid completion. We probably want to omit `last` args entirely.

### Additional Context

_No response_

### Debug Output

_No response_

---

_Label `C-bug` added by @milesj on 2024-10-09 00:17_

---

_Label `E-medium` added by @epage on 2024-10-09 14:45_

---

_Label `A-completion` added by @epage on 2024-10-09 14:45_

---

_Comment by @epage on 2024-10-09 14:48_

If we have to choose between one, seems fine to drop `last`.

Note that completions are mostly driven by users so if you want this fixed, doing it yourself is the most likely way for that to happen.

What would help even more is if someone implemented nushell support for #3166 so we'd no longer be limited by what nushell's completion rules support and if something gets implemented for one shell, most likely all shells benefit.

---

_Referenced in [moonrepo/proto#885](../../moonrepo/proto/issues/885.md) on 2025-10-03 03:51_

---
