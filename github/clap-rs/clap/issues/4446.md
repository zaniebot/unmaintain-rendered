---
number: 4446
title: "[clap_complete] support for guessing the shell from the environment."
type: issue
state: closed
author: tmccombs
labels:
  - C-enhancement
  - A-completion
assignees: []
created_at: 2022-11-03T07:45:28Z
updated_at: 2022-11-03T14:06:18Z
url: https://github.com/clap-rs/clap/issues/4446
synced_at: 2026-01-07T12:31:17-06:00
---

# [clap_complete] support for guessing the shell from the environment.

---

_Issue opened by @tmccombs on 2022-11-03 07:45_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

4.0.18

### Describe your use case

Currently it is up to the caller to determine which  "generator" to use to generate completions in clap_complete. 

In many cases it is possible to determine the user's current shell from the SHELL environment variable. It would be nice if the functionality to determine which `Shell` to use was provided by clap_complete so that it doesn't have to be re-implemented across multiple consumer projects of the crate. 

### Describe the solution you'd like

Something along the lines of what fd does:


```rust
#[cfg(feature = "completions")]
fn guess_shell() -> anyhow::Result<Shell> {
    let env_shell = std::env::var_os("SHELL").map(PathBuf::from);
    if let Some(shell) = env_shell
        .as_ref()
        .and_then(|s| s.file_name())
        .and_then(|s| s.to_str())
    {
        shell
            .parse::<Shell>()
            .map_err(|_| anyhow!("Unknown shell {}", shell))
    } else {
        // Assume powershell on windows
        #[cfg(windows)]
        return Ok(Shell::PowerShell);
        #[cfg(not(windows))]
        return Err(anyhow!("Unable to get shell from environment"));
    }
}
```



### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @tmccombs on 2022-11-03 07:45_

---

_Referenced in [clap-rs/clap#4447](../../clap-rs/clap/pulls/4447.md) on 2022-11-03 08:11_

---

_Comment by @epage on 2022-11-03 14:02_

A previous take on this: #4296

---

_Label `A-completion` added by @epage on 2022-11-03 14:02_

---

_Comment by @epage on 2022-11-03 14:06_

Closing as duplicate of #4300

---

_Closed by @epage on 2022-11-03 14:06_

---
