---
number: 827
title: Index out of range in get_matches with certain arguments
type: issue
state: closed
author: ShadowNinja
labels: []
assignees: []
created_at: 2017-01-29T18:50:13Z
updated_at: 2018-08-02T03:30:00Z
url: https://github.com/clap-rs/clap/issues/827
synced_at: 2026-01-07T12:31:16-06:00
---

# Index out of range in get_matches with certain arguments

---

_Issue opened by @ShadowNinja on 2017-01-29 18:50_

Rust Version: Tested with both 1.14.0 stable and 1.16.0-nightly (2017-01-03)
Clap version: 2.20.0

### Steps to Reproduce
Compile my sample code and run it with any options except the default help and version options

[Sample Code](https://gist.github.com/ShadowNinja/11b5d35988dddd090596ad17e6e2c882) | [Debug output with backtrace](https://gist.github.com/ShadowNinja/ed1b58d88867e8dce9951a5af6744cfc)

Removing `requires("media_transfer")` fixes the issue.

---

_Comment by @SuperFluffy on 2017-01-29 19:52_

It looks like I ran into a similar problem with this code:

```rust
#[macro_use]
extern crate clap;

use clap::{App,Arg,ArgGroup};

fn main() {
    let matches = App::new("myapp")
        .arg(Arg::with_name("req_a").required(true).takes_value(true))
        .arg(Arg::with_name("req_b").required(true).takes_value(true))
        .arg(Arg::with_name("req_c").required(true).takes_value(true))
        .arg(Arg::with_name("group_a").short("a"))
        .arg(Arg::with_name("group_b").short("b"))
        .group(ArgGroup::with_name("group").args(&["group_a", "group_b"]))
    .get_matches();
}
```

The error seems to be connected to the interaction between required arguments and arg groups. In the code above, you need at least 3 required options to trigger the error. The `ArgGroup` only needs one member to trigger the error.

**Note:** The error seems to not be triggered when the number of group members exceeds the number of required options! If you add a group `group_c`, the error is fixed. If you then add a required option `req_d`, the error appears again, but now with the message `'index out of bounds: the len is 3 but the index is 3'` instead of `'index out of bounds: the len is 2 but the index is 2'`.

The minimum example to trigger the error is (with `index out of bounds: the len is 1 but the index is 1'`):

```rust
#[macro_use]
extern crate clap;

use clap::{App,Arg,ArgGroup};

fn main() {
    let matches = App::new("myapp")
        .arg(Arg::with_name("req_a").required(true).takes_value(true))
        .arg(Arg::with_name("req_b").required(true).takes_value(true))
        .arg(Arg::with_name("group_a").short("a"))
        .group(ArgGroup::with_name("group").args(&["group_a"]))
    .get_matches();
}
```

Here are the log files, cmpiled with `feature = ["debug"]`, one with `RUST_BACKTRACE=1, and one without: [clap error log](https://gist.github.com/SuperFluffy/7572c8455627ae6d5c8a8c71fd083aa2)

---

_Referenced in [clap-rs/clap#829](../../clap-rs/clap/pulls/829.md) on 2017-01-29 20:50_

---

_Comment by @SuperFluffy on 2017-01-29 20:53_

I just made a PR, #829. It seems to fix the issue for me.

@ShadowNinja Can you please check if it fixes it for you? 

---

_Comment by @ShadowNinja on 2017-01-29 23:38_

@SuperFluffy: Yep, that seems to do it.  :-)


---

_Closed by @kbknapp on 2017-01-30 02:14_

---
