---
number: 1809
title: "Replace value_t* macros with functions"
type: issue
state: closed
author: CreepySkeleton
labels: []
assignees: []
created_at: 2020-04-12T00:12:14Z
updated_at: 2020-04-13T08:07:04Z
url: https://github.com/clap-rs/clap/issues/1809
synced_at: 2026-01-07T12:31:17-06:00
---

# Replace value_t* macros with functions

---

_Issue opened by @CreepySkeleton on 2020-04-12 00:12_

### Make sure you completed the following tasks

- [x] Searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [x] Searched the closes issues

### Describe your use case

I'm trying to cure the `#[doc(hidden)]` infestation that is spread largely thought our codebase. I'm hitting the wall in the form of `Cannot leak crate-visible type in public interface`. 

The problem is that certain functions marked as `#[doc(hidden)] pub` are used by these macros so they ought to be `pub`, and certain `struct`s are `pub hidden` only because they occur in a signature of one of those functions.

### Describe the solution you'd like

Replace the macros with functions of the same name:

```rust
pub fn value_of_t<K: Key, R: FromStr>(&self, name: K) -> Result<R, clap::Error> {
    if let Some(v) = self.value_of(name) {
        match v.parse::<R>() {
            Ok(val) => Ok(val),
            Err(_)  =>
                Err(::clap::Error::value_validation_auto(
                    format!("The argument '{}' isn't a valid value", v))),
        }
    } else {
        Err(::clap::Error::argument_not_found_auto(name))
    }
} 

// and so on ...
```

No need for those hidden functions to be `pub` anymore!

This will actually be improvement over macros because users won't have to specify the type explicitly, in many cases they can just leave the type up to the type inference.

If maintainers think this is a good design, I would be happy to send a PR for you!

### Alternatives, if applicable

Do nothing and let the disease spread ðŸ¤¢ . Might as well render #1803 impossible.

### Additional context

This was previously discussed in https://github.com/clap-rs/clap/issues/915 and Kevin agreed it would be nice, although he eventually closed the issue in favor of the upcoming derive. Since the derive is 90% imported, we could just remove the macros. I don't have a strong opinion regarding removal - I can imagine where these macros are preferable over derive, all I want is to finally move forward.

Related to #1803 since `Id` occurs in some of these functions.

---

_Label `T: new feature` added by @CreepySkeleton on 2020-04-12 00:12_

---

_Added to milestone `3.0` by @pksunkara on 2020-04-12 00:31_

---

_Referenced in [clap-rs/clap#1811](../../clap-rs/clap/pulls/1811.md) on 2020-04-12 03:27_

---

_Closed by @bors[bot] on 2020-04-13 08:07_

---
