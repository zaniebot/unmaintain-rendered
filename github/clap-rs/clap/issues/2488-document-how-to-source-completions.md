---
number: 2488
title: Document how to source completions
type: issue
state: closed
author: ajeetdsouza
labels:
  - C-enhancement
  - A-docs
  - A-completion
  - E-easy
assignees: []
created_at: 2021-05-20T05:59:38Z
updated_at: 2024-08-10T00:38:12Z
url: https://github.com/clap-rs/clap/issues/2488
synced_at: 2026-01-07T13:12:19-06:00
---

# Document how to source completions

---

_Issue opened by @ajeetdsouza on 2021-05-20 05:59_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Clap Version

3.0.0-beta.2

### Where?

clap_generate

### What's wrong?

Currently, clap generates completions without providing any insight into how to actually get them running in the shell.

### How to fix?

It would be nice if we could specify (for each shell):

1. How to source the generated completions as a file
2. How to source the generated completions when printed to stdout
3. How to add the above to your shell configuration file

---

_Label `C: docs` added by @ajeetdsouza on 2021-05-20 05:59_

---

_Label `C: generator` added by @pksunkara on 2021-05-20 09:29_

---

_Referenced in [clap-rs/clap#2479](../../clap-rs/clap/issues/2479.md) on 2021-05-21 11:47_

---

_Comment by @kidonng on 2021-06-20 16:08_

I'd like to give a simple and general description:

- Bash: install [bash-completion](https://github.com/scop/bash-completion) (some distros have this by default), then the completions can be sourced
- Zsh: the optimal way is to use `$fpath`, but if one would really like to go the manual way:

  ```sh
  autoload -U compinit
  compinit
  source <(program completions zsh | sed '$d') # can also be `head -n -1` or whatever as long as the last line is removed
  compdef _program program
  ```

  FWIW, it is [said](https://github.com/starship/starship/issues/2806#issuecomment-864568502) that completions generated by [cobra](https://github.com/spf13/cobra) (clap counterpart in Go) can be directly sourced (i.e. no need to strip the last line), may worth looking into

- Fish: directly source-able ðŸŽ‰

I don't have much experience with other shells so additions welcome.

---

_Comment by @nicholastmosher on 2021-07-03 17:22_

Hmm, that makes me wonder if there wouldn't be any reason not to update the output of `program completions zsh` to just include the autoload and compdef commands. It'd be nice to just be able to do

```
source <(program completions zsh)
```

Where `program completions zsh` would just look like

```
autoload -U compinit
compinit
<old content of 'program completions zsh'>
compdef _program program
```

One could certainly do that at the app-level, but is there no reason to build that directly into the completions output of clap?

---

_Comment by @kidonng on 2021-07-04 05:36_

@nicholastmosher I can't say for sure, but I think generally clap completions are generated at _packaging time_. That is to say, when you install a program from the package manager, it comes with the completions placed at the suitable location so shells will pick them up automatically. Manually sourcing the completions is not the usual way people use it.

---

_Comment by @nicholastmosher on 2021-07-06 13:44_

Ah I see. I was taking inspiration from the oh-my-zsh `kubectl` completions plugin: https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/kubectl/kubectl.plugin.zsh#L1-L11, though it seems like that is more geared towards dynamic completions like described in https://github.com/clap-rs/clap/issues/1232

---

_Referenced in [epage/clapng#187](../../epage/clapng/issues/187.md) on 2021-12-06 21:14_

---

_Label `E-easy` added by @epage on 2021-12-13 16:39_

---

_Label `C-enhancement` added by @epage on 2021-12-13 16:39_

---

_Comment by @gakonst on 2021-12-22 02:10_

For me I had to do 2 things to get it working with ZSH 5.8 (`program` is your command's name):

1. Remove the last line (`program "$@"`)
2. Replace the first line from `#compdef program` to `#compdef _program program`

Unsure why this is not happening by default, is this a bug? 

Also, if there's any backticks in any help message, the shell tries to interpret it due to shell expansion, suspect it's related to https://github.com/clap-rs/clap/issues/1596

---

_Referenced in [TeXitoi/structopt#461](../../TeXitoi/structopt/issues/461.md) on 2021-12-22 02:17_

---

_Referenced in [jj-vcs/jj#67](../../jj-vcs/jj/issues/67.md) on 2022-02-20 21:50_

---

_Referenced in [starship/starship#2806](../../starship/starship/issues/2806.md) on 2023-01-22 07:13_

---

_Referenced in [jstz-dev/jstz#382](../../jstz-dev/jstz/pulls/382.md) on 2024-02-08 14:33_

---

_Referenced in [clap-rs/clap#3166](../../clap-rs/clap/issues/3166.md) on 2024-07-05 14:14_

---

_Referenced in [clap-rs/clap#5586](../../clap-rs/clap/pulls/5586.md) on 2024-07-17 14:53_

---

_Comment by @epage on 2024-07-19 14:30_

The `feature=unstable-dynamic` completions now have documentation on how to source them, see #5586.

I'm inclined to consider this closed but would be open to input from others on if there is concern over that vs the current code-generated completions.

---

_Comment by @epage on 2024-08-10 00:38_

As this was resolved for dynamic completions in #5586, I'm going to go ahead and close this.

To track stabilization, see #3166

---

_Closed by @epage on 2024-08-10 00:38_

---

_Referenced in [clap-rs/clap#6086](../../clap-rs/clap/issues/6086.md) on 2025-08-04 17:48_

---
