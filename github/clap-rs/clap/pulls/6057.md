---
number: 6057
title: "feat(help): Allow styling for inline context"
type: pull_request
state: merged
author: GilShoshan94
labels: []
assignees: []
merged: true
base: master
head: master
created_at: 2025-07-01T20:41:19Z
updated_at: 2025-07-09T22:45:10Z
url: https://github.com/clap-rs/clap/pull/6057
synced_at: 2026-01-07T12:31:17-06:00
---

# feat(help): Allow styling for inline context

---

_Pull request opened by @GilShoshan94 on 2025-07-01 20:41_

Styles for [aliases], [default], [env], and [possible values] as well as their values

fix https://github.com/clap-rs/clap/issues/5093

Continuation of PR https://github.com/clap-rs/clap/pull/5482 but clean.

I created an issue (https://github.com/clap-rs/clap/issues/6056) about `literal` possible values in long help for when 5.0 is rolling out as @pksunkara asked. 

I added more granularity in the styling of each "context" but still a general one to style all of them at once too.


---

_@epage reviewed on 2025-07-01 20:48_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:40 on 2025-07-01 20:48_

So I wasn't able to catch up on #5482 before the content was lost but this does not look like what was discussed in #5093 and there is no context in the PR for why we are allowing distinct customization of each part.

---

_@GilShoshan94 reviewed on 2025-07-01 20:58_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:40 on 2025-07-01 20:58_

Hi,
I did the first PR in May 2024... I had to rebase and revisit, some things changed a bit, so I had to really rethink it.
On the way I did this improvement and permit more granularity (without breaking change).

What was discussed was just 2 styling options:
- `inline_context`
- `inline_context_value`

The original discussion, with you, is here: https://github.com/clap-rs/clap/issues/5093

I did the same here but exposed more options to overwrite the styling of individual context as well.
The contexts are the following: [aliases], [default], [env], and [possible values].

I also renamed to a `context` and `context_data` to be a bit shorter.

If you have an issue with it, I can remove the granularity and stay with only `context` and `context_data`.

---

_@epage reviewed on 2025-07-01 21:02_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:40 on 2025-07-01 21:02_

Yes, please remove all of the extra styles.

In the future, at best check-in on the issue if you have additional thoughts and at minimum, call them out in the PR.  PR reviewers shouldn't be surprised about user-facing design deviations when they start looking at code.

---

_@GilShoshan94 reviewed on 2025-07-01 21:50_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:40 on 2025-07-01 21:50_

Ok, I will remove it now and open a new issue for that specifically.

Just to point it out, I wrote in the PR message:
```
"I added more granularity in the styling of each "context" but still a general one to style all of them at once too."
```

So, I did call them out in the PR.

Ok, working on it now

---

_@GilShoshan94 reviewed on 2025-07-01 22:06_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:40 on 2025-07-01 22:06_

Done, I removed all the granularity and left only `context` and `context_data` (also eddited the documentation)

Sorry for the confusion. I saw it as an improvement, but I understand that we need to discuss it beforehand.
I will open a new issue and new PR once this get merged.

---

_Review comment by @pksunkara on `clap_builder/src/builder/styling.rs`:32 on 2025-07-02 01:56_

I think I preferred the `context_value`, but I will leave it for @epage to give his opinion.

---

_Review comment by @pksunkara on `clap_builder/src/output/help_template.rs`:795 on 2025-07-02 02:03_

Please rename all `pvs` for default related block to `dvs` (default values)

---

_@pksunkara requested changes on 2025-07-02 02:06_

Nothing else jumps out.

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:32 on 2025-07-02 16:53_

I switched from `context_value` to `context_data` because of my enhancement for more granularity in the styling for each "context" category (but I will do it in another issue ticket instead of here).

And in that enhancement, I got a `context_possible_values` for the `[possible values]` context, and so for its values, it would be `context_possible_values_value`, which is ugly as well as confusing, so I switched the `_value` into `_data` and kept it consistent across all the contexts as well as the general one.

You can see what I plan to later PR in my branch "granularity" [link](https://github.com/clap-rs/clap/compare/master...GilShoshan94:clap:granularity)

---

_@GilShoshan94 reviewed on 2025-07-02 16:53_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:795 on 2025-07-02 17:09_

I did see that too while working on the code and got confused too.
I renamed `pvs` to `dvs` for the `[default]` context but did not push yet because I have a question about it:

I did not even know we can have a list of default values for an argument, it is not entirely clear to me when it does happens but when it does, I see here that the list is joined with simple space `.join(" ")`. 
Shouldn't it be separated by commas `.join(", ")`  instead?

---

_@GilShoshan94 reviewed on 2025-07-02 17:09_

---

_@epage reviewed on 2025-07-02 20:27_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:32 on 2025-07-02 20:27_

Considering the granularity was explicitly asked not to be included `_value` to be used (https://github.com/clap-rs/clap/issues/5093#issuecomment-2083062949), I would ask that we stay with `_value`

---

_@epage reviewed on 2025-07-02 20:28_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:795 on 2025-07-02 20:28_

We offer [`Arg::default_values`](https://docs.rs/clap/latest/clap/struct.Arg.html#method.default_values).

Changing other output should not be part of this PR.  If you want, feel free to open an issue and we can discuss what the output should be there.

---

_@epage reviewed on 2025-07-02 20:30_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:124 on 2025-07-02 20:30_

- This includes `,` and `and` in the literal text
- Enumerating every type of context can make this more difficult to read, can grow stale, etc

I'd recommend
```suggestion
    /// Highlight all specified contexts (e.g. `[default: false]`)
```

---

_@epage reviewed on 2025-07-02 20:31_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:126 on 2025-07-02 20:31_

I'd frame this differently
```suggestion
    /// To specialize the style of the value within the context, see [`Styling::context_value`]
```

---

_@epage reviewed on 2025-07-02 20:32_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:135 on 2025-07-02 20:32_

```suggestion
    /// Highlight values within all of the context (e.g. the `false` in `[default: false]`)
    ///
    /// If not explicitly set, falls back to `context`'s style.
```

---

_@epage reviewed on 2025-07-02 20:35_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:795 on 2025-07-02 20:35_

If any such rename happens, it should be in its own commit.

Since the code is already like this, I consider this feedback to be non-blocking

---

_@epage reviewed on 2025-07-02 20:37_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:837 on 2025-07-02 20:37_

Should we split out these `{ctx},{ctx:#}`s?  I'm less thinking from a performance perspective and more from a binary size perspective

---

_@epage reviewed on 2025-07-02 20:37_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:835 on 2025-07-02 20:37_

shouldn't that be `pv` since this is the non-plural form this is operating on? 

---

_@epage reviewed on 2025-07-02 20:41_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:1 on 2025-07-02 20:41_

Can you update `src/bin/stdio-fixture.rs` to
- Cover each of the cases (including plurals), this should be in its own commit
- Update it to use this new feature

Hmm, I still need to go back and add an SVG snapshot of that help output so we can track through PRs how that changes.

---

_@GilShoshan94 reviewed on 2025-07-03 05:08_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:795 on 2025-07-03 05:08_

> We offer [`Arg::default_values`](https://docs.rs/clap/latest/clap/struct.Arg.html#method.default_values).
> 
> Changing other output should not be part of this PR. If you want, feel free to open an issue and we can discuss what the output should be there.

I see that the method, I have never seen a concrete example of it... What does it mean to have a list of default for one argument? I assume that there is a meaning that I fail to see but regardless the formatting of simply space separator seems strange where a comma separator seems more appropriated. 

I open a new issue to discuss it, see #6059

---

_@GilShoshan94 reviewed on 2025-07-03 05:10_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:835 on 2025-07-03 05:10_

correct, I will fix that

---

_@GilShoshan94 reviewed on 2025-07-03 05:12_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:837 on 2025-07-03 05:12_

I don't understand what you mean by
> split out these {ctx},{ctx:#}s

What are you suggesting for me to do ?

---

_@GilShoshan94 reviewed on 2025-07-03 05:13_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:1 on 2025-07-03 05:13_

Sure, I never touched those fixtures before, but I will try my best

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:32 on 2025-07-03 05:25_

done,
It is `context` and `context_value` now.

---

_@GilShoshan94 reviewed on 2025-07-03 05:25_

---

_@GilShoshan94 reviewed on 2025-07-03 06:41_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:795 on 2025-07-03 06:41_

> If any such rename happens, it should be in its own commit.
> 
> Since the code is already like this, I consider this feedback to be non-blocking

I made a separated commit for the rename

---

_@GilShoshan94 reviewed on 2025-07-03 06:45_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:124 on 2025-07-03 06:45_

done, thank you for the recommendation, it is better indeed.

---

_@GilShoshan94 reviewed on 2025-07-03 06:47_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:124 on 2025-07-03 06:47_

I just removed the parentheses around the example and add a comma to be consistent with the other existing docs on the others existing methods

---

_@GilShoshan94 reviewed on 2025-07-03 06:47_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:135 on 2025-07-03 06:47_

done

---

_@GilShoshan94 reviewed on 2025-07-03 06:47_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:835 on 2025-07-03 06:47_

done

---

_@GilShoshan94 reviewed on 2025-07-03 06:54_

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:126 on 2025-07-03 06:54_

Indeed better, I just changed  "_see [`Styling::context_value`]_" to "_see [`Styles::context_value`]_", I think this is what you meant, correct ?

---

_@GilShoshan94 reviewed on 2025-07-03 06:56_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:837 on 2025-07-03 06:56_

I did put the `format!("{ctx}, {ctx:#}")` as its own string in a variable like so:
`let val_sep = format!("{ctx}, {ctx:#}"); // context values styled separator`

And I am using a ref to it in the join.
Is this what you were suggesting ?

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:997 on 2025-07-03 07:08_

@epage 

I just found something strange, in this function `sc_spec_vals` for the aliases of the Command, I see we have 3 types:
- **aliases** -> and we show them in the help with `.get_visible_aliases()`
- **short_flag_aliases** -> with `.get_visible_short_flag_aliases()`
- **long_flag_aliases** -> with `.get_visible_long_flag_aliases()`

The visible aliases and the short flag ones are collected, but the long flag aliases are forgotten.

Also, it is weird that in the function is using a vector to collect only one string to after join on it to return either one string or an empty string ...

Anyway, this seems like long flag aliases are forgotten, should I open a new issue for it (with a new PR for it) ?

---

_@epage reviewed on 2025-07-03 14:20_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:683 on 2025-07-03 14:20_

Let's defer out all "Possible Values" changes in long help to #6056.

The original issue was focused on the `[]` sections.  The possibility of touching long help didn't come up until https://github.com/clap-rs/clap/issues/5093#issuecomment-2091863555 and I never got to reply to that.

I feel like the formatting of Possible Values is very different than `[]`.  Instead of being a special syntax for context, its written more like what someone would write out and I don't feel confident that styling it like `[]` is the right call.

Take `rg --help` as an example
```
        --color <WHEN>
            This flag controls when to use colors. The default setting is 'auto', which
            means ripgrep will try to guess when to use colors. For example, if ripgrep is
            printing to a terminal, then it will use colors, but if it is redirected to a
            file or a pipe, then it will suppress color output. ripgrep will suppress color
            output in some other circumstances as well. For example, if the TERM
            environment variable is not set or set to 'dumb', then ripgrep will not use
            colors.

            The possible values for this flag are:

                never    Colors will never be used.
                auto     The default. ripgrep tries to be smart.
                always   Colors will always be used regardless of where output is sent.
                ansi     Like 'always', but emits ANSI escapes (even in a Windows console).

            When the --vimgrep flag is given to ripgrep, then the default value for the
            --color flag changes to 'never'.
```
this isn't using clap anymore and it didn't use our Possible Values rendering, but the format is similar.

---

_@epage reviewed on 2025-07-03 14:22_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:126 on 2025-07-03 14:22_

Yes, thank you

---

_@epage reviewed on 2025-07-03 14:22_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:837 on 2025-07-03 14:22_

Yes, thank you

---

_@epage reviewed on 2025-07-03 14:23_

---

_Review comment by @epage on `clap_builder/src/builder/styling.rs`:203 on 2025-07-03 14:23_

nit: this can also be written as
```rust
self.context_value.as_ref().unwrap_or(&self.context)
```

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:683 on 2025-07-03 16:42_

But except for this case, the other "contexts" (default, env, ...) use the same formatting function for the long help, so they are automatically using the same styling `context` and `context_value` for the long help than in the short help.

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:203 on 2025-07-03 16:52_

No, I can't because `unwrap_or` is _non-const_, so I had to do it this way to keep the method `const` as the other get methods are already.

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:1 on 2025-07-03 19:49_

I did it, I added a bunch of cases in a new commit.
You can clearly see that we are missing the visible long flag aliases that I talked about in my other comment.

I see that I failed CI and it was because I didn't the tests using this fixture.

I updated those tests to reflect the new cases and now it passes the checks.

---

_Review comment by @GilShoshan94 on `clap_builder/src/builder/styling.rs`:1 on 2025-07-07 23:56_

I am letting you @epage to mark this conversation as resolved or let me know what you want me to do.

---

_@epage reviewed on 2025-07-08 20:03_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:683 on 2025-07-08 20:03_

Why was this marked as resolved when we are still applying `{ctx}` to "Possible Values:" in the long help?

---

_@epage reviewed on 2025-07-08 20:04_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:683 on 2025-07-08 20:04_

Looking at the screenshot in #6056, it looks like there was a pending comment that didn't get posted.  That said, that pending comment and lack of change here doesn't seem to warrant marking this as resolved.

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:683 on 2025-07-09 20:39_

My bad, I never encountered the "Pending" comment in Github, I understand now that you never saw it. If I understood correctly, I have to "submit" a review for you to see it.

Sorry for the technical miscommunication from my end due to my lack of collaborative workflow knowledge. I am learning and will get better at it.

So, do you prefer for me to remove the change `{ctx}` to "Possible Values:" in the long help for this PR and leave the discussion for #6056  ? 

---

_@GilShoshan94 reviewed on 2025-07-09 20:43_

I didn't know about the "pending" comments.... Had no idea you could not see them even.
I apologize for my miscommunication. I learned for next time.

---

_@epage reviewed on 2025-07-09 20:46_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:683 on 2025-07-09 20:46_

Yes, I would.

---

_@epage reviewed on 2025-07-09 21:11_

---

_Review comment by @epage on `clap_builder/src/output/help_template.rs`:997 on 2025-07-09 21:11_

This was all added in #1974.  Based on https://github.com/clap-rs/clap/pull/1974/files#r452746777, it sounds like long aliases were added later.  Since I don't see any explicit comments about it, I'm assuming this was overlooked when updating the PR.

Feel free to open an issue about this.  Based on that history, it might be minor enough to include in another commit in this PR.  Interesting how subcommands had a combined alias spec value before #5999.

As for the `Vec`, its setup to be general for new spec values to be added.  I can take it or leave it for changing it.

---

_@GilShoshan94 reviewed on 2025-07-09 21:43_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:683 on 2025-07-09 21:43_

Ok, I will remove it. Once done I will mark this as resolved.

---

_@GilShoshan94 reviewed on 2025-07-09 21:49_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:997 on 2025-07-09 21:49_

I opened an issue about it => #6067
I will add a commit in this PR to fix it.

---

_@GilShoshan94 reviewed on 2025-07-09 22:24_

---

_Review comment by @GilShoshan94 on `clap_builder/src/output/help_template.rs`:683 on 2025-07-09 22:24_

Done, I removed it.

---
