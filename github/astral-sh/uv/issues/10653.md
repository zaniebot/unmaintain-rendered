---
number: 10653
title: Publish integration test flakes
type: issue
state: open
author: zanieb
labels:
  - testing
  - ci-flake
assignees: []
created_at: 2025-01-15T21:44:15Z
updated_at: 2025-05-30T21:16:47Z
url: https://github.com/astral-sh/uv/issues/10653
synced_at: 2026-01-07T12:31:15-06:00
---

# Publish integration test flakes

---

_Issue opened by @zanieb on 2025-01-15 21:44_

at https://github.com/astral-sh/uv/actions/runs/12796865454/job/35677669338

```
DEBUG No cache entry for: https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/
DEBUG Transient request failure for https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/, retrying: error sending request for url (https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/)
  Caused by: operation timed out
DEBUG Transient request failure for https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/, retrying: error sending request for url (https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/)
  Caused by: operation timed out
DEBUG Transient request failure for https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/, retrying: error sending request for url (https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/)
  Caused by: operation timed out
DEBUG Transient request failure for https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/, retrying: error sending request for url (https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/)
  Caused by: operation timed out
error: Failed to fetch: `[https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/`](https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/%60)
  Caused by: Request failed after 3 retries
  Caused by: error sending request for url (https://codeberg.org/api/packages/astral-test-user/pypi/simple/astral-test-token/)
  Caused by: operation timed out
Traceback (most recent call last):

  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 507, in <module>
Publish astral-test-token for pypi-token

=== 1. Publishing a new version: astral-test-token 0.1.3621 https://test.pypi.org/legacy/ ===

=== 2. Publishing astral-test-token 0.1.3621 again (PyPI) ===

=== 3. Publishing astral-test-token 0.1.3621 again with index ===

=== 4. Publishing modified astral-test-token 0.1.3621 again with skip existing (error test) ===

Publish astral-test-password for pypi-password-env

=== 1. Publishing a new version: astral-test-password 0.1.1386 https://test.pypi.org/legacy/ ===

=== 2. Publishing astral-test-password 0.1.1386 again (PyPI) ===

=== 3. Publishing astral-test-password 0.1.1386 again with check URL ===

=== 4. Publishing modified astral-test-password 0.1.1386 again with skip existing (error test) ===

Publish astral-test-keyring for pypi-keyring

=== 1. Publishing a new version: astral-test-keyring 0.1.1361 https://test.pypi.org/legacy/?astral-test-keyring ===

=== 3. Publishing astral-test-keyring 0.1.1361 again with check URL ===
uv pip compile not updated, missing 2 files for 0.1.1361, sleeping for 2s: `[https://test.pypi.org/simple/`:](https://test.pypi.org/simple/%60:)
```
astral-test-keyring==0.1.1360 --hash=sha256:4e54f8efa5652f8abed4b20b6e150275c56f27c9f4c56f511a745d90176d110a --hash=sha256:5341e7dc2309cb0554f4693407782cecdd43ce505aab3472d3761f66c3a1e22b
```

=== 4. Publishing modified astral-test-keyring 0.1.1361 again with skip existing (error test) ===

Publish astral-test-token for gitlab

=== 1. Publishing a new version: astral-test-token 0.1.3621 https://gitlab.com/api/v4/projects/61853105/packages/pypi ===

=== 3. Publishing astral-test-token 0.1.3621 again with check URL ===

=== 4. Publishing modified astral-test-token 0.1.3621 again with skip existing (error test) ===

Publish astral-test-token for codeberg

=== 1. Publishing a new version: astral-test-token 0.1.3622 https://codeberg.org/api/packages/astral-test-user/pypi ===

=== 3. Publishing astral-test-token 0.1.3622 again with check URL ===
    main()
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 503, in main
    publish_project(project_name, uv, client)
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 381, in publish_project
    wait_for_index(index_url, project_name, version, uv)
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 295, in wait_for_index
    output = check_output(
             ^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.12.8/x64/lib/python3.12/subprocess.py", line 466, in check_output
    return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.12.8/x64/lib/python3.12/subprocess.py", line 571, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '[PosixPath('/home/runner/work/uv/uv/uv'), 'pip', 'compile', '-p', '3.12', '--index', 'https://codeberg.org/api/packages/astral-test-user/pypi/simple/', '--quiet', '--generate-hashes', '--no-header', '--refresh-package', 'astral-test-token', '-']' returned non-zero exit status 2.
DEBUG Command exited with code: 1
```

---

_Renamed from "Publish integration test flake" to "Publish integration test flakes" by @zanieb on 2025-01-15 21:44_

---

_Comment by @zanieb on 2025-01-15 21:45_

at https://github.com/astral-sh/uv/actions/runs/12796244275/job/35675573382

```
Uploading astral_test_password-0.1.1384.tar.gz (5.4KiB)
DEBUG Hashing dist/astral_test_password-0.1.1384.tar.gz
DEBUG Using username/password basic auth
DEBUG Response code for https://test.pypi.org/legacy/: 400 Bad Request
TRACE Response headers for https://test.pypi.org/legacy/: Response { url: "https://test.pypi.org/legacy/", status: 400, headers: {"referrer-policy": "origin-when-cross-origin", "content-type": "application/json", "accept-ranges": "bytes", "content-security-policy": "base-uri 'self'; connect-src 'self' https://api.github.com/repos/ https://api.github.com/search/issues https://gitlab.com/api/ https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com fastly-insights.com *.fastly-insights.com *.ethicalads.io https://api.pwnedpasswords.com https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/sre/mathmaps/; default-src 'none'; font-src 'self' fonts.gstatic.com; form-action 'self' https://checkout.stripe.com; frame-ancestors 'none'; frame-src 'none'; img-src 'self' https://testpypi-camo.freetls.fastly.net/ https://*.google-analytics.com https://*.googletagmanager.com *.fastly-insights.com *.ethicalads.io ethicalads.blob.core.windows.net; script-src 'self' https://*.googletagmanager.com https://www.google-analytics.com https://ssl.google-analytics.com *.fastly-insights.com *.ethicalads.io 'sha256-U3hKDidudIaxBDEzwGJApJgPEf2mWk6cfMWghrAa6i0=' https://cdn.jsdelivr.net/npm/mathjax@3.2.2/ 'sha256-1CldwzdEg2k1wTmf7s5RWVd7NMXI/7nxxjJM2C4DqII=' 'sha256-0POaN8stWYQxhzjKS+/eOfbbJ/u4YHO5ZagJvLpMypo='; style-src 'self' fonts.googleapis.com *.ethicalads.io 'sha256-2YHqZokjiizkHi1Zt+6ar0XJ0OeEy/egBnlm+MDMtrM=' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=' 'sha256-JLEjeN9e5dGsz5475WyRaoA4eQOdNPxDIeUhclnJDCE=' 'sha256-mQyxHEuwZJqpxCw3SLmc4YOySNKXunyu2Oiz1r3/wAE=' 'sha256-OCf+kv5Asiwp++8PIevKBYSgnNLNUZvxAp4a7wMLuKA=' 'sha256-h5LOiLhk6wiJrGsG5ItM0KimwzWQH/yAcmoJDJL//bY='; worker-src *.fastly-insights.com", "date": "Wed, 15 Jan 2025 20:15:54 GMT", "x-served-by": "cache-iad-kiad7000084-IAD, cache-iad-kiad7000020-IAD", "x-cache": "MISS, MISS", "x-cache-hits": "0, 0", "x-timer": "S1736972154.992757,VS0,VE264", "vary": "Cookie, Cookie, Authorization", "strict-transport-security": "max-age=31536000; includeSubDomains; preload", "x-frame-options": "deny", "x-xss-protection": "1; mode=block", "x-content-type-options": "nosniff", "x-permitted-cross-domain-policies": "none", "permissions-policy": "publickey-credentials-create=(self),publickey-credentials-get=(self),accelerometer=(),ambient-light-sensor=(),autoplay=(),battery=(),camera=(),display-capture=(),document-domain=(),encrypted-media=(),execution-while-not-rendered=(),execution-while-out-of-viewport=(),fullscreen=(),gamepad=(),geolocation=(),gyroscope=(),hid=(),identity-credentials-get=(),idle-detection=(),local-fonts=(),magnetometer=(),microphone=(),midi=(),otp-credentials=(),payment=(),picture-in-picture=(),screen-wake-lock=(),serial=(),speaker-selection=(),storage-access=(),usb=(),web-share=(),xr-spatial-tracking=()", "content-length": "602"} }
TRACE Response content for non-200 response for https://test.pypi.org/legacy/: {"message": "The server could not comply with the request since it is either malformed or otherwise incorrect.\n\n\nFile already exists ('astral_test_password-0.1.1384.tar.gz', with blake2_256 hash '5b1d243e7cdd2bb2c87868c69defce7b75484547075be2a12a9714b5fba59bd7'). See https://test.pypi.org/help/#file-name-reuse for more information.\n\n", "code": "400 File already exists ('astral_test_password-0.1.1384.tar.gz', with blake2_256 hash '5b1d243e7cdd2bb2c87868c69defce7b75484547075be2a12a9714b5fba59bd7'). See https://test.pypi.org/help/#file-name-reuse for more information.", "title": "Bad Request"}
DEBUG Upload error response: {"message": "The server could not comply with the request since it is either malformed or otherwise incorrect.\n\n\nFile already exists ('astral_test_password-0.1.1384.tar.gz', with blake2_256 hash '5b1d243e7cdd2bb2c87868c69defce7b75484547075be2a12a9714b5fba59bd7'). See https://test.pypi.org/help/#file-name-reuse for more information.\n\n", "code": "400 File already exists ('astral_test_password-0.1.1384.tar.gz', with blake2_256 hash '5b1d243e7cdd2bb2c87868c69defce7b75484547075be2a12a9714b5fba59bd7'). See https://test.pypi.org/help/#file-name-reuse for more information.", "title": "Bad Request"}
error: Failed to publish `dist/astral_test_password-0.1.1384.tar.gz` to https://test.pypi.org/legacy/
  Caused by: Upload failed with status code 400 Bad Request. Server says: 400 File already exists ('astral_test_password-0.1.1384.tar.gz', with blake2_256 hash '5b1d243e7cdd2bb2c87868c69defce7b75484547075be2a12a9714b5fba59bd7'). See https://test.pypi.org/help/#file-name-reuse for more information.
Traceback (most recent call last):
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 507, in <module>
    main()
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 503, in main
    publish_project(project_name, uv, client)
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 358, in publish_project
    check_call(args, cwd=project_dir, env=env)
  File "/opt/hostedtoolcache/Python/3.12.8/x64/lib/python3.12/subprocess.py", line 413, in check_call

Publish astral-test-token for pypi-token

=== 1. Publishing a new version: astral-test-token 0.1.3616 https://test.pypi.org/legacy/ ===

=== 2. Publishing astral-test-token 0.1.3616 again (PyPI) ===
uv pip compile not updated, missing 2 files for 0.1.3616, sleeping for 2s: `https://test.pypi.org/simple/`:
```
astral-test-token==0.1.3614 --hash=sha256:a759c8c9a8b43a83d234d28dce[399](https://github.com/astral-sh/uv/actions/runs/12796244275/job/35675573382#step:7:400)f465f287a04e92fd3ac161ddb9a4f3ce5f4 --hash=sha256:f36b30a7cb55d1c42efeb5931a8b219f16b52b998e04892c739b65dc93e8ec57
```

=== 3. Publishing astral-test-token 0.1.3616 again with index ===

=== 4. Publishing modified astral-test-token 0.1.3616 again with skip existing (error test) ===

Publish astral-test-password for pypi-password-env

=== 1. Publishing a new version: astral-test-password 0.1.1384 https://test.pypi.org/legacy/ ===
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command '[PosixPath('/home/runner/work/uv/uv/uv'), 'publish', '--publish-url', 'https://test.pypi.org/legacy/', '--username', '__token__']' returned non-zero exit status 2.
```

---

_Comment by @zanieb on 2025-01-15 21:45_

at https://github.com/astral-sh/uv/actions/runs/12796229434/job/35675576870

```
Uploading astral_test_token-0.1.3616.tar.gz (5.4KiB)
DEBUG Hashing dist/astral_test_token-0.1.3616.tar.gz
DEBUG Using username/password basic auth
DEBUG Response code for https://test.pypi.org/legacy/: 400 Bad Request
TRACE Response headers for https://test.pypi.org/legacy/: Response { url: "https://test.pypi.org/legacy/", status: 400, headers: {"referrer-policy": "origin-when-cross-origin", "content-type": "application/json", "accept-ranges": "bytes", "content-security-policy": "base-uri 'self'; connect-src 'self' https://api.github.com/repos/ https://api.github.com/search/issues https://gitlab.com/api/ https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com fastly-insights.com *.fastly-insights.com *.ethicalads.io https://api.pwnedpasswords.com https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/sre/mathmaps/; default-src 'none'; font-src 'self' fonts.gstatic.com; form-action 'self' https://checkout.stripe.com; frame-ancestors 'none'; frame-src 'none'; img-src 'self' https://testpypi-camo.freetls.fastly.net/ https://*.google-analytics.com https://*.googletagmanager.com *.fastly-insights.com *.ethicalads.io ethicalads.blob.core.windows.net; script-src 'self' https://*.googletagmanager.com https://www.google-analytics.com https://ssl.google-analytics.com *.fastly-insights.com *.ethicalads.io 'sha256-U3hKDidudIaxBDEzwGJApJgPEf2mWk6cfMWghrAa6i0=' https://cdn.jsdelivr.net/npm/mathjax@3.2.2/ 'sha256-1CldwzdEg2k1wTmf7s5RWVd7NMXI/7nxxjJM2C4DqII=' 'sha256-0POaN8stWYQxhzjKS+/eOfbbJ/u4YHO5ZagJvLpMypo='; style-src 'self' fonts.googleapis.com *.ethicalads.io 'sha256-2YHqZokjiizkHi1Zt+6ar0XJ0OeEy/egBnlm+MDMtrM=' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=' 'sha256-JLEjeN9e5dGsz5475WyRaoA4eQOdNPxDIeUhclnJDCE=' 'sha256-mQyxHEuwZJqpxCw3SLmc4YOySNKXunyu2Oiz1r3/wAE=' 'sha256-OCf+kv5Asiwp++8PIevKBYSgnNLNUZvxAp4a7wMLuKA=' 'sha256-h5LOiLhk6wiJrGsG5ItM0KimwzWQH/yAcmoJDJL//bY='; worker-src *.fastly-insights.com", "date": "Wed, 15 Jan 2025 20:15:51 GMT", "x-served-by": "cache-chi-kigq8000059-CHI, cache-chi-kigq8000041-CHI", "x-cache": "MISS, MISS", "x-cache-hits": "0, 0", "x-timer": "S1736972151.948750,VS0,VE974", "vary": "Cookie, Authorization, Cookie", "strict-transport-security": "max-age=3[153](https://github.com/astral-sh/uv/actions/runs/12796229434/job/35675576870#step:7:154)6000; includeSubDomains; preload", "x-frame-options": "deny", "x-xss-protection": "1; mode=block", "x-content-type-options": "nosniff", "x-permitted-cross-domain-policies": "none", "permissions-policy": "publickey-credentials-create=(self),publickey-credentials-get=(self),accelerometer=(),ambient-light-sensor=(),autoplay=(),battery=(),camera=(),display-capture=(),document-domain=(),encrypted-media=(),execution-while-not-rendered=(),execution-while-out-of-viewport=(),fullscreen=(),gamepad=(),geolocation=(),gyroscope=(),hid=(),identity-credentials-get=(),idle-detection=(),local-fonts=(),magnetometer=(),microphone=(),midi=(),otp-credentials=(),payment=(),picture-in-picture=(),screen-wake-lock=(),serial=(),speaker-selection=(),storage-access=(),usb=(),web-share=(),xr-spatial-tracking=()", "content-length": "596"} }
TRACE Response content for non-200 response for https://test.pypi.org/legacy/: {"message": "The server could not comply with the request since it is either malformed or otherwise incorrect.\n\n\nFile already exists ('astral_test_token-0.1.3616.tar.gz', with blake2_256 hash 'c0547189760eda191dbdb998f712aa3432e582bab2ee1e3d96f0b01481b4b41a'). See https://test.pypi.org/help/#file-name-reuse for more information.\n\n", "code": "400 File already exists ('astral_test_token-0.1.3616.tar.gz', with blake2_256 hash 'c0547189760eda191dbdb998f712aa3432e582bab2ee1e3d96f0b01481b4b41a'). See https://test.pypi.org/help/#file-name-reuse for more information.", "title": "Bad Request"}
DEBUG Upload error response: {"message": "The server could not comply with the request since it is either malformed or otherwise incorrect.\n\n\nFile already exists ('astral_test_token-0.1.3616.tar.gz', with blake2_256 hash 'c0547189760eda191dbdb998f712aa3432e582bab2ee1e3d96f0b01481b4b41a'). See https://test.pypi.org/help/#file-name-reuse for more information.\n\n", "code": "400 File already exists ('astral_test_token-0.1.3616.tar.gz', with blake2_256 hash 'c0547189760eda191dbdb998f712aa3432e582bab2ee1e3d96f0b01481b4b41a'). See https://test.pypi.org/help/#file-name-reuse for more information.", "title": "Bad Request"}
error: Failed to publish `dist/astral_test_token-0.1.3616.tar.gz` to https://test.pypi.org/legacy/
  Caused by: Upload failed with status code 400 Bad Request. Server says: 400 File already exists ('astral_test_token-0.1.3616.tar.gz', with blake2_256 hash 'c0547189760eda191dbdb998f712aa3432e582bab2ee1e3d96f0b01481b4b41a'). See https://test.pypi.org/help/#file-name-reuse for more information.
Traceback (most recent call last):
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 507, in <module>

Publish astral-test-token for pypi-token

=== 1. Publishing a new version: astral-test-token 0.1.3616 https://test.pypi.org/legacy/ ===
    main()
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 503, in main
    publish_project(project_name, uv, client)
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 358, in publish_project
    check_call(args, cwd=project_dir, env=env)
  File "/opt/hostedtoolcache/Python/3.12.8/x64/lib/python3.12/subprocess.py", line 413, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command '[PosixPath('/home/runner/work/uv/uv/uv'), 'publish', '--publish-url', 'https://test.pypi.org/legacy/']' returned non-zero exit status 2.
DEBUG Command exited with code: 1
```

---

_Label `testing` added by @zanieb on 2025-01-15 22:19_

---

_Referenced in [mypdns/matrix#121078](../../mypdns/matrix/issues/121078.md) on 2025-02-28 07:18_

---

_Label `ci-flake` added by @zanieb on 2025-05-30 21:16_

---
