---
number: 11828
title: Encoding issue in Windows cmd when path contains non-ASCII characters
type: issue
state: closed
author: flaribbit
labels:
  - bug
assignees: []
created_at: 2025-02-27T11:01:32Z
updated_at: 2025-02-28T01:07:37Z
url: https://github.com/astral-sh/uv/issues/11828
synced_at: 2026-01-07T12:31:15-06:00
---

# Encoding issue in Windows cmd when path contains non-ASCII characters

---

_Issue opened by @flaribbit on 2025-02-27 11:01_

### Summary

When using `uv` to generate a virtual environment, the `activate.bat` script is encoded in UTF-8, which is good. However, the bad thing is when executing `.venv\Scripts\activate` in `cmd`, the script uses the local codepage for execution. This causes issues when the file path contains non-ASCII characters, resulting in corrupted environment variables such as `VIRTUAL_ENV`.

```
E:\æµ‹è¯•ä»£ç 
â¯ uv init foo
Initialized project `foo` at `E:\æµ‹è¯•ä»£ç \foo`


E:\æµ‹è¯•ä»£ç 
â¯ cd foo                                                                                                                

foo on î‚  master [?] is ğŸ“¦ v0.1.0 via ğŸ v3.13.0
â¯ uv sync
Using CPython 3.12.7
Creating virtual environment at: .venv
Resolved 1 package in 4ms
Audited in 0.01ms


foo on î‚  master [?] is ğŸ“¦ v0.1.0 via ğŸ v3.13.0
â¯ .venv\Scripts\activate


foo on î‚  master [?] is ğŸ“¦ v0.1.0 via ğŸ v3.13.0 (.venv)
â¯ uv run hello.py
warning: `VIRTUAL_ENV=E:\å¨´å¬­ç˜¯æµ ï½‡çˆœ\foo\.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead
Hello from foo!
```

### Platform

Windows

### Version

uv 0.6.3 (a0b9f22a2 2025-02-24)

### Python version

-

---

_Label `bug` added by @flaribbit on 2025-02-27 11:01_

---

_Comment by @flaribbit on 2025-02-27 11:05_

`python -m venv` do not have this issue as it `chcp 65001` before setting environment variables.

https://github.com/python/cpython/blob/3.13/Lib/venv/scripts/nt/activate.bat#L3-L9

---

_Referenced in [astral-sh/uv#11831](../../astral-sh/uv/pulls/11831.md) on 2025-02-27 11:33_

---

_Comment by @Elmekior on 2025-02-27 18:22_

Sorry to butt into this issue, out of curiosity would this also fix something akin to this ? ( I can create a second issue but wanted to make sure ). This is also under windows

Commands to run :
uv init --name "test" --no-readme --python "3.7" --python-preference only-managed --no-package
uv venv --python-preference only-managed --seed --link-mode=copy

--------
output

PS F:\Project\uv\uv_venv> uv init --name "test" --no-readme --python "3.7" --python-preference only-managed --no-package

Initialized project `test`
PS F:\Project\uv\uv_venv> ls


    Directory: F:\Project\uv\uv_venv


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         2/27/2025     13:19            109 .gitignore
-a----         2/27/2025     13:19              4 .python-version
-a----         2/27/2025     13:19             82 main.py
-a----         2/27/2025     13:19            128 pyproject.toml


PS F:\Project\uv\uv_venv> uv venv --python-preference only-managed --seed --link-mode=copy
Using CPython 3.7.9
Creating virtual environment with seed packages at: .venv
 + pip==24.0
 + setuptools==68.0.0
 + wheel==0.42.0
Activate with: .venv\Scripts\activate
PS F:\Project\uv\uv_venv> .\.venv\Scripts\activate
(uv_venv) PS F:\Project\uv\uv_venv> pip list
  File "F:\Project\uv\uv_venv\.venv\Scripts\pip.exe", line 1
SyntaxError: Non-UTF-8 code starting with '\xe8' in file F:\Project\uv\uv_venv\.venv\Scripts\pip.exe on line 2, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details

---

_Closed by @charliermarsh on 2025-02-27 21:14_

---

_Comment by @flaribbit on 2025-02-28 01:07_

@Elmekior Sure, I can reproduce it in both `cmd` and `powershell` on windows.

I don't think it is related to this issue. There is a problem with `pip.exe` generated by uv. You may create a new issue.

```
E:\æµ‹è¯•ä»£ç 
â¯ uv init --name "test" --no-readme --python "3.7" --python-preference only-managed --no-package
Initialized project `test`

æµ‹è¯•ä»£ç  on î‚  master [?] is ğŸ“¦ v0.1.0 via ğŸ v3.13.0
â¯ uv venv --python-preference only-managed --seed --link-mode=copy
Using CPython 3.7.9
Creating virtual environment with seed packages at: .venv
 + pip==24.0
 + setuptools==68.0.0
 + wheel==0.42.0
Activate with: .venv\Scripts\activate

æµ‹è¯•ä»£ç  on î‚  master [?] is ğŸ“¦ v0.1.0 via ğŸ v3.13.0
â¯ .venv\Scripts\activate

æµ‹è¯•ä»£ç  on î‚  master [?] is ğŸ“¦ v0.1.0 via ğŸ v3.7.9 (æµ‹è¯•ä»£ç )
â¯ pip list
  File "E:\æµ‹è¯•ä»£ç \.venv\Scripts\pip.exe", line 1
SyntaxError: Non-UTF-8 code starting with '\xe8' in file E:\æµ‹è¯•ä»£ç \.venv\Scripts\pip.exe on line 2, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details

æµ‹è¯•ä»£ç  on î‚  master [?] is ğŸ“¦ v0.1.0 via ğŸ v3.7.9 (æµ‹è¯•ä»£ç )
â¯ pip3
  File "E:\æµ‹è¯•ä»£ç \.venv\Scripts\pip3.exe", line 1
SyntaxError: Non-UTF-8 code starting with '\xe8' in file E:\æµ‹è¯•ä»£ç \.venv\Scripts\pip3.exe on line 2, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details
```

(Small tip: you can put your code in code blocks to make it easier to read)

---
