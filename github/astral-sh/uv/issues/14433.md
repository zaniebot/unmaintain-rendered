---
number: 14433
title: "`uv version --bump major` half-fails with incompatible conflicts"
type: issue
state: closed
author: oyarsa
labels:
  - bug
assignees: []
created_at: 2025-07-03T01:12:41Z
updated_at: 2025-07-03T12:30:01Z
url: https://github.com/astral-sh/uv/issues/14433
synced_at: 2026-01-07T12:31:16-06:00
---

# `uv version --bump major` half-fails with incompatible conflicts

---

_Issue opened by @oyarsa on 2025-07-03 01:12_

### Summary

Running `uv version --bump major` to update the project version "fails" when there are conflicting extras. The update still goes through, but it prints an error and exits with status code 2. The bump (major/minor/patch) doesn't matter.

This was working normally on 0.7.2. It started happening when I upgraded to 0.7.19.

Full example:

```console
❯ cat pyproject.toml 
[project]
name = "project"
version = "0.1.0"
requires-python = ">=3.12.0"
dependencies = []

[project.optional-dependencies]
cpu = [
  "torch>=2.7.0",
  "torchvision>=0.22.0",
]
cu128 = [
  "torch>=2.7.0",
  "torchvision>=0.22.0",
]

[tool.uv]
conflicts = [
  [
    { extra = "cpu" },
    { extra = "cu128" },
  ],
]

[tool.uv.sources]
torch = [
  { index = "pytorch-cpu", extra = "cpu" },
  { index = "pytorch-cu128", extra = "cu128" },
]
torchvision = [
  { index = "pytorch-cpu", extra = "cpu" },
  { index = "pytorch-cu128", extra = "cu128" },
]

[[tool.uv.index]]
name = "pytorch-cpu"
url = "https://download.pytorch.org/whl/cpu"
explicit = true

[[tool.uv.index]]
name = "pytorch-cu128"
url = "https://download.pytorch.org/whl/cu128"
explicit = true⏎                                                                                                                                                                 

❯ uv version --bump major
Using CPython 3.12.9
Creating virtual environment at: .venv
Resolved 34 packages in 925ms
error: Extras `cpu` and `cu128` are incompatible with the declared conflicts: {`project[cpu]`, `project[cu128]`}
```

Project file from https://docs.astral.sh/uv/guides/integration/pytorch/#configuring-accelerators-with-optional-dependencies

### Platform

Darwin 23.4.0 arm64 Darwin (Sonoma 14.4.1)

### Version

uv 0.7.19 (38ee6ec80 2025-07-02)

### Python version

Python 3.12.9

---

_Label `bug` added by @oyarsa on 2025-07-03 01:12_

---

_Comment by @zanieb on 2025-07-03 01:37_

Thanks for the report, we'll investigate. I presume this regressed in 0.7.7 when we started locking on `uv version` (see https://github.com/astral-sh/uv/pull/13317)? Can you confirm?

---

_Comment by @oyarsa on 2025-07-03 01:48_

I can confirm that 0.7.6 works fine, but 0.7.7 fails with the same error.

Note that locking and syncing from the command line works:

```console
❯ uv self version
uv 0.7.19 (38ee6ec80 2025-07-02)

❯ uv lock
Resolved 34 packages in 13ms

❯ uv sync
Resolved 34 packages in 0.76ms
Audited in 0.25ms

```

---

_Comment by @zanieb on 2025-07-03 02:26_

Thanks! I think this is because we're passing enabling all extras here?

https://github.com/astral-sh/uv/blob/6a5d2f1ec4b8a43a38fb29cf31d57fd9f2bc362f/crates/uv/src/commands/project/version.rs#L388

The fix should be trivial https://github.com/astral-sh/uv/pull/14434 — but I'll need to understand why it was written that way and add test coverage.

If you want to test it, there will be artifacts attached to the CI job.


---

_Referenced in [astral-sh/uv#14434](../../astral-sh/uv/pulls/14434.md) on 2025-07-03 02:27_

---

_Comment by @oyarsa on 2025-07-03 02:29_

Would `ExtrasSpecification::default()` perform the same as `uv sync` in the command line? I don't quite understand how that works with the extras, to be honest. I know I can use `uv sync --extra <extra>` to select the extras I want, and `uv sync` afterwards seems to keep that. Would `::default` do the same?

---

_Closed by @zanieb on 2025-07-03 12:30_

---
