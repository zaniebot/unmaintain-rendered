---
number: 12368
title: github token auth
type: issue
state: open
author: kristjanvalur
labels:
  - question
assignees: []
created_at: 2025-03-21T14:20:58Z
updated_at: 2025-03-31T08:58:03Z
url: https://github.com/astral-sh/uv/issues/12368
synced_at: 2026-01-07T12:31:15-06:00
---

# github token auth

---

_Issue opened by @kristjanvalur on 2025-03-21 14:20_

### Question

Hello there.  I'm trying to move a project from poetry to uv.  Our project uses sources from a private repo, and the `migrate-to-uv` tool has migrated a dependency

```
[tool.poetry.dependencies]
barsoom = {git = "https://github.com/foobar/barsoom.git", rev = "v1.7.4"}
```

to 

```
[tool.uv.sources]
barsoom = { git = "https://github.com/foobar/barsoom.git", rev = "v1.7.4" }
```

However, we also have scripts that do something like:

```
echo configuring poetry authentication for github repo barsoom.git using GH_TOKEN
poetry config repositories.barsoom https://github.com/foobar/barsoom.git
poetry config http-basic.barsoom x-token-auth %GH_TOKEN%
```

I have found no similar support in uv.  What is the correct way to provide token based authentication to remote git repositories?

### Platform

Windows

### Version

uv 0.6.7 (029b9e1fc 2025-03-17)

---

_Label `question` added by @kristjanvalur on 2025-03-21 14:20_

---

_Comment by @zanieb on 2025-03-21 14:29_

We don't support configuring authentication via the CLI like that yet. There are some docs on Git authentication at https://docs.astral.sh/uv/configuration/authentication/#git-authentication â€” generally the idea is to pre-populate the git credential helper. In the future, we'll have more first-class support.

---

_Comment by @kristjanvalur on 2025-03-21 15:04_

Ok, that's a shame.  This is used in CI on Windows and we need CLI help for it.  I'll need to hold off converting this project until there is better support.

---

_Comment by @zanieb on 2025-03-21 15:16_

Can you clone the repository first with `git` directly? That will propagate the credentials into the helper.

---

_Comment by @kristjanvalur on 2025-03-22 14:28_

I'll run some experiments.  One way would be to do a `git clone` with a `https//<token>@github.com/foo/bar`. and hope that the credential helper caches that.  Another might be to use the gh cli, which alledgedly stores credentials, but might do so only for the API.


---

_Comment by @kristjanvalur on 2025-03-24 10:44_

So, here is what I've found.  (Information on this is remarkably hard to come by, and there seems to be no generic way to provide a github PAT to a CI pipeline.)

1. git on windows by default uses the cross platform https://github.com/git-ecosystem/git-credential-manager
2. It will accept a PAT (personal access token), talk to github, and query for the username it matches.
3. It will then store the username/password(token) in window's own credentials helper as a "generic" token, with the ID `git:https://github.com`

Here is what will not work:

- using `gh auth login --with-token`.  The github client will not store credentials that git itself will use. (*)
- using `git clone https://<token>@github.com/foo/bar.git`.  Git performs no auth dance with this tokenized url, and subsequent access without the token won't work; no credentials are stored.
- invoiking `git-credential-manager.exe` with some command line option to give it the token.  It is not on the path and not designed to be directly called by the user.
- using `git config credentials.*` something, this is apparently not designed for accepting passwords.  Git tries really hard to ensure that all and any authentication is interactive.

What I did find will work:

```
cmdkey /generic:git:https://github.com /user:<username> /pass:<token>
```

This will create the same kind of credential as the password manager will.  The drawback here is that one has to know the correct username that the PAT is created for.

So:  Personal access tokens seem to be _really_ intended to be used direcly in the repository URL.  Therefore, support for injecting them into urls really is needed by tools such as `poetry` and `uv` if one is to hope to avoid git's credential manager hell.

For now, I will circumvent the issue by  calling the windows credential manager directly, but it would be best if `uv` could be configured, perhaps via env var, to apply a PAT to an url before cloning it.

(*) it is claimed here that `gh auth login` _should_ work: https://github.com/git-ecosystem/git-credential-manager, but I for some reason I have not been able to make that happen here on my desktop...  I might be doing something wrong... Some experimentation reveals that a `gh auth --with-token` will not create a `git:https://github.com` credential, but running it interacctively, and answering `yes` to `authenticate git with your github credentials` will work.  I guess this must be a bug and I will report it there.


---

_Comment by @kristjanvalur on 2025-03-24 12:04_

## Update

Over [here](https://github.com/cli/cli/issues/10658), it was suggested to me that I use `gh auth setup-git` in addition to `gh auth login --with-token`.  That seems to allow login using github client.  One can even use the env var `GH_TOKEN` and skipt the `gh auth login` step altogether.

So, for the case of github, at least, the issue is resolved, although other urls might need something different.

---

_Comment by @hikouki-gumo on 2025-03-31 03:26_

Hi @zanieb What is the recommend method for Github Actions? I don't think using PAT is a good option.

---

_Comment by @kristjanvalur on 2025-03-31 08:58_

> Hi [@zanieb](https://github.com/zanieb) What is the recommend method for Github Actions? I don't think using PAT is a good option.

I have been using https://github.com/astral-sh/setup-uv successfully for GHA.  My questions above were for a self hosted TeamCity pipeline.

---

_Referenced in [astral-sh/uv#11342](../../astral-sh/uv/issues/11342.md) on 2025-06-04 03:54_

---

_Referenced in [astral-sh/uv#13850](../../astral-sh/uv/pulls/13850.md) on 2025-06-04 21:56_

---
