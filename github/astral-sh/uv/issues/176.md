---
number: 176
title: Explore the use of a secondary cache atop the HTTP cache
type: issue
state: closed
author: charliermarsh
labels:
  - performance
assignees: []
created_at: 2023-10-24T01:16:09Z
updated_at: 2023-11-21T16:18:45Z
url: https://github.com/astral-sh/uv/issues/176
synced_at: 2026-01-07T12:31:14-06:00
---

# Explore the use of a secondary cache atop the HTTP cache

---

_Issue opened by @charliermarsh on 2023-10-24 01:16_

When we fetch the list of files, we store the entire response in an HTTP cache. But we only need a subset of that response. Consider instead serializing the `Vec<File>` directly in a separate content-addressed cache? (This should at least be doable for wheel metadata, since it's immutable.)

---

_Label `performance` added by @charliermarsh on 2023-10-24 01:18_

---

_Comment by @MichaReiser on 2023-10-24 01:19_

What's the motivation for caching both? For in-memory caching, https://lib.rs/crates/moka could be interesting

---

_Comment by @charliermarsh on 2023-10-24 01:25_

Yeah we may not need the HTTP cache at all in that case. It's nice to have the HTTP _semantics_, but I want to be able to intercept and transform the response...

---

_Comment by @konstin on 2023-10-24 07:58_

I'd cache (package, version) -> Vec<File>, i found deserializing all files becomes a bottleneck

---

_Comment by @charliermarsh on 2023-10-24 16:29_

Yeah, that information is also immutable

---

_Referenced in [astral-sh/uv#111](../../astral-sh/uv/issues/111.md) on 2023-10-24 19:21_

---

_Label `wish` added by @charliermarsh on 2023-10-24 19:21_

---

_Added to milestone `Initial release` by @charliermarsh on 2023-10-24 19:24_

---

_Label `wish` removed by @charliermarsh on 2023-10-24 19:36_

---

_Comment by @charliermarsh on 2023-10-30 04:36_

By the way... SQLite could be interesting here. I think Cargo uses SQLite for its local (cached) index.

---

_Comment by @zanieb on 2023-10-30 20:59_

I like SQLite :) especially when you don't need to worry about a lot of migrations

---

_Comment by @konstin on 2023-10-31 11:24_

I'd be happy if we could get away without writing SQL or the pains it has with multithreading, but i see how sqlite is an extremely proven storage; If we could get away with just some (maybe hierarchical) key-value storage this would reduce the complexity a bit

---

_Assigned to @konstin by @charliermarsh on 2023-11-09 14:24_

---

_Comment by @charliermarsh on 2023-11-09 14:24_

\cc @konstin - this is basically your open PR.

---

_Comment by @konstin on 2023-11-21 16:18_

This is partially done with the `CachedClient`, i filed individual issues for what remains

---

_Closed by @konstin on 2023-11-21 16:18_

---
