---
number: 11238
title: "`uv sync` runs indefinitely when symlinks exist in src"
type: issue
state: closed
author: dennismoe
labels:
  - question
  - external
assignees: []
created_at: 2025-02-05T08:18:49Z
updated_at: 2025-02-05T16:56:35Z
url: https://github.com/astral-sh/uv/issues/11238
synced_at: 2026-01-07T12:31:15-06:00
---

# `uv sync` runs indefinitely when symlinks exist in src

---

_Issue opened by @dennismoe on 2025-02-05 08:18_

### Summary

Hi,

I encounter a sporadic issue when (multiple, _recursive_) symlinks are in `src`. Once `uv sync` stops working, it persistently stops working.

<details>
  <summary>tree</summary>

  ```
$ tree
.
├── pyproject.toml
├── src
│   ├── repo_name
│   │   ├── __init__.py
│   │   ├── sub
│   │   │   ├── repo_name -> ../..
│   │   │   ├── __init__.py
│   │   │   └── test.py
│   │   └── test.py
│   └── repo_name.egg-info
│       └── [...]
├── [...]
└── uv.lock
```

</details>


For example, when I update the version of another dependency package in `pyproject.toml`, `uv sync` stops working:

```
$ uv sync
Resolved 214 packages in 0.76ms
Building repo-name @ file:///home/user/Projects/repo-name
⠙ Preparing packages... (0/1) <-- Stays like indefinitely
```

<details>
  <summary>uv sync -vvvv</summary>

Noted the `Requirement installed, but not fresh: repo-name==0.1.0 (from file:///home/user/Projects/repo-name)`

```
$ uv sync -vvvv
    0.000013s DEBUG uv uv 0.5.28
    0.000126s DEBUG uv_workspace::workspace Found project root: `/home/user/Projects/repo-name`
    0.000311s DEBUG uv_workspace::workspace No workspace root found, using project root
    0.000367s DEBUG uv::commands::project Using Python request `==3.12.8` from `requires-python` metadata
    0.000381s DEBUG uv_python::environment Checking for Python environment at `.venv`
    0.000477s DEBUG uv::commands::project The virtual environment's Python version satisfies `==3.12.8`
 uv_client::linehaul::linehaul 
    0.006365s DEBUG uv_client::base_client Using request timeout of 30s
 uv_resolver::flat_index::from_entries 
 uv_distribution::distribution_database::get_or_build_wheel_metadata dist=repo-name @ file:///home/user/Projects/repo-name
    0.007280s   0ms DEBUG uv_distribution::source Found static `pyproject.toml` for: repo-name @ file:///home/user/Projects/repo-name
    0.007430s   0ms DEBUG uv_workspace::workspace No workspace root found, using project root
    0.007591s DEBUG uv::commands::project::lock Existing `uv.lock` satisfies workspace requirements
Resolved 214 packages in 1ms
 uv_client::linehaul::linehaul 
    0.009541s DEBUG uv_client::base_client Using request timeout of 30s
 uv_resolver::flat_index::from_entries 
    0.010827s DEBUG uv_installer::plan Requirement installed, but not fresh: repo-name==0.1.0 (from file:///home/user/Projects/repo-name)
    0.010906s DEBUG uv_installer::plan Identified uncached distribution: repo-name @ file:///home/user/Projects/repo-name
    0.010912s DEBUG uv_installer::plan Requirement already installed: orjson==3.10.15
    0.010914s DEBUG uv_installer::plan Requirement already installed: pydantic==2.10.6
    0.010917s DEBUG uv_installer::plan Requirement already installed: pydantic-settings==2.7.1
    0.010919s DEBUG uv_installer::plan Requirement installed, but mismatched:
   Installed: Registry(InstalledRegistryDist { name: PackageName("boto3"), version: "1.36.12", path: "/home/user/Projects/repo-name/.venv/lib/python3.12/site-packages/boto3-1.36.12.dist-info", cache_info: None })
   Requested: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "1.36.13" }]), index: Some(Url { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }), conflict: None }
    0.010975s DEBUG uv_installer::plan Requirement already cached: boto3==1.36.13
    0.010978s DEBUG uv_installer::plan Requirement installed, but mismatched:
   Installed: Registry(InstalledRegistryDist { name: PackageName("boto3-stubs"), version: "1.36.12", path: "/home/user/Projects/repo-name/.venv/lib/python3.12/site-packages/boto3_stubs-1.36.12.dist-info", cache_info: None })
   Requested: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "1.36.13" }]), index: Some(Url { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }), conflict: None }
    0.011009s DEBUG uv_installer::plan Requirement already cached: boto3-stubs==1.36.13
    [...]
    0.011081s DEBUG uv_installer::plan Requirement already installed: python-dotenv==1.0.1
    0.011083s DEBUG uv_installer::plan Requirement installed, but mismatched:
   Installed: Registry(InstalledRegistryDist { name: PackageName("botocore"), version: "1.36.12", path: "/home/user/Projects/repo-name/.venv/lib/python3.12/site-packages/botocore-1.36.12.dist-info", cache_info: None })
   Requested: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "1.36.13" }]), index: Some(Url { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }), conflict: None }
    0.011120s DEBUG uv_installer::plan Requirement already cached: botocore==1.36.13
    [...]
    0.011425s DEBUG uv_installer::plan Requirement already installed: types-python-dateutil==2.9.0.20241003
 uv_installer::preparer::prepare total=1
   uv_installer::preparer::get_wheel name=repo-name @ file:///home/user/Projects/repo-name, size=None, url=""
     uv_distribution::distribution_database::get_or_build_wheel dist=repo-name @ file:///home/user/Projects/repo-name
    0.011677s DEBUG uv_fs Acquired lock for `/home/user/.cache/uv/sdists-v7/editable/3c6c6e1c7e18186c`
       uv_distribution::source::build_distribution dist=repo-name @ file:///home/user/Projects/repo-name
          0.011794s   0ms DEBUG uv_distribution::source Building: repo-name @ file:///home/user/Projects/repo-name
         uv_dispatch::setup_build version_id="repo-name @ file:///home/user/Projects/repo-name", subdirectory=None
            0.012132s   0ms DEBUG uv_workspace::workspace No workspace root found, using project root
            0.012150s   0ms DEBUG uv_python::interpreter Assessing Python executable as base candidate: /home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12
            0.012158s   0ms DEBUG uv_virtualenv::virtualenv Using base executable for virtual environment: /home/user/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12
            0.012168s   0ms DEBUG uv_virtualenv::virtualenv Ignoring empty directory
            0.012391s   0ms DEBUG uv_build_frontend Resolving build requirements
 uv_resolver::resolver::solve 
    0.013225s   0ms DEBUG uv_resolver::resolver Solving with installed Python version: 3.12.8
    0.013233s   0ms DEBUG uv_resolver::resolver Solving with target Python version: >=3.12.8
   uv_resolver::resolver::get_dependencies_forking package=root, version=0a0.dev0
     uv_resolver::resolver::get_dependencies package=root, version=0a0.dev0
    0.013327s   0ms DEBUG uv_resolver::resolver Adding direct dependency: setuptools*
           uv_resolver::resolver::process_request request=Versions setuptools
             uv_client::registry_client::simple_api package=setuptools
               uv_client::cached_client::get_cacheable_with_retry 
                 uv_client::cached_client::get_cacheable 
                   uv_client::cached_client::read_and_parse_cache file=/home/user/.cache/uv/simple-v15/pypi/setuptools.rkyv
           uv_resolver::resolver::process_request request=Prefetch setuptools *
 uv_client::cached_client::from_path_sync path="/home/user/.cache/uv/simple-v15/pypi/setuptools.rkyv"
                    0.014055s   0ms DEBUG uv_client::cached_client Found fresh response for: https://pypi.org/simple/setuptools/
             uv_resolver::version_map::from_metadata 
             uv_distribution::distribution_database::get_or_build_wheel_metadata dist=setuptools==75.8.0
               uv_client::registry_client::wheel_metadata built_dist=setuptools==75.8.0
    0.014278s   1ms DEBUG uv_resolver::resolver Searching for a compatible version of setuptools (*)
    0.014286s   1ms DEBUG uv_resolver::resolver Selecting: setuptools==75.8.0 [compatible] (setuptools-75.8.0-py3-none-any.whl)
   uv_resolver::resolver::get_dependencies_forking package=setuptools, version=75.8.0
     uv_resolver::resolver::get_dependencies package=setuptools, version=75.8.0
                 uv_client::cached_client::get_serde_with_retry 
                   uv_client::cached_client::get_cacheable_with_retry 
                     uv_client::cached_client::get_cacheable 
                       uv_client::cached_client::read_and_parse_cache file=/home/user/.cache/uv/wheels-v3/pypi/setuptools/setuptools-75.8.0-py3-none-any.msgpack
 uv_client::cached_client::from_path_sync path="/home/user/.cache/uv/wheels-v3/pypi/setuptools/setuptools-75.8.0-py3-none-any.msgpack"
                        0.014401s   0ms DEBUG uv_client::cached_client Found fresh response for: https://files.pythonhosted.org/packages/69/8a/b9dc7678803429e4a3bc9ba462fa3dd9066824d3c607490235c6a796be5a/setuptools-75.8.0-py3-none-any.whl.metadata
    0.014524s   1ms DEBUG uv_resolver::resolver::batch_prefetch Tried 1 versions: setuptools 1
    0.014529s   1ms DEBUG uv_resolver::resolver marker environment resolution took 0.001s
           uv_dispatch::install build_stack=BuildStack({Url(CanonicalUrl(Url { scheme: "file", cannot_be_a_base: false, username: "", password: None, host: None, port: None, path: "/home/user/Projects/repo-name", query: None, fragment: None }))}), resolution="setuptools==75.8.0", venv="/home/user/.cache/uv/builds-v0/.tmpF89849"
              0.014695s   0ms DEBUG uv_dispatch Installing in setuptools==75.8.0 in /home/user/.cache/uv/builds-v0/.tmpF89849
              0.014756s   0ms DEBUG uv_installer::plan Requirement already cached: setuptools==75.8.0
              0.014764s   0ms DEBUG uv_dispatch Installing build requirement: setuptools==75.8.0
             uv_installer::installer::install num_wheels=1
 uv_installer::installer::install num_wheels=1
   uv_install_wheel::install::install_wheel wheel=setuptools-75.8.0-py3-none-any.whl
     uv_install_wheel::linker::link_wheel_files 
            0.035131s  23ms DEBUG uv_build_frontend Creating PEP 517 build environment
            0.035148s  23ms DEBUG uv_build_frontend Calling `setuptools.build_meta.get_requires_for_build_editable()`
           uv_build_frontend::run_python_script script="get_requires_for_build_editable", version_id="repo-name @ file:///home/user/Projects/repo-name"
```

</details>


<details>
  <summary>pyproject.toml</summary>
  
Parts from `pyproject.toml`

```yaml
[build-system]
requires = [ "setuptools" ]
build-backend = "setuptools.build_meta"

[project]
requires-python = "==3.12.8"
name = "repo_name"
readme = "README.md"
version = "0.1.0"

[tool.setuptools.packages.find]
where = [ "src" ]
namespaces = false
```

</details>

The symbolic link(s) is/are basically created with:

```python
from pathlib import Path
link_path = Path(
    "src/repo_name/sub/repo_name"
)
link_target = Path("src/repo_name")
symlink_target_relative = link_target.relative_to(
    link_path.parent, walk_up=True
)
link_path.symlink_to(
    symlink_target_relative,
    target_is_directory=True,
)
```

---

Maybe the error is also mine, but we can reproduce the error on several machines and narrow it down to the symlinks.
After deleting the symlinks `uv sync` works again as fast and great as usual.

Is it maybe related to #11223  , links are also mentioned there?

### Platform

Linux 6.1.0-27-amd64 x86_64 GNU/Linux and MacOS

### Version

uv 0.5.28

### Python version

Python 3.12.8

---

_Label `bug` added by @dennismoe on 2025-02-05 08:18_

---

_Comment by @charliermarsh on 2025-02-05 13:50_

Can you please include a minimal reproduction, ie, a Git repo we can clone or an archive we can download to reproduce?

---

_Comment by @zanieb on 2025-02-05 15:07_

We have some [docs](https://docs.astral.sh/uv/reference/troubleshooting/reproducible-examples/) on that which may be helpful.

---

_Comment by @dennismoe on 2025-02-05 15:17_

I've created a simple example

https://github.com/dennismoe/tmp_uv_issue_11238

Thanks for looking into it

---

_Comment by @zanieb on 2025-02-05 16:33_

It seems very likely that this is a setuptools bug, e.g., something like https://github.com/pypa/setuptools/issues/332

---

_Comment by @zanieb on 2025-02-05 16:36_

Hm I might need to take that back, as I cannot reproduce with `pip`

```
❯ git clean -fdx
❯ uv venv -p 3.12.8 --seed
Using CPython 3.12.8 interpreter at: /opt/homebrew/opt/python@3.12/bin/python3.12
Creating virtual environment with seed packages at: .venv
 + pip==25.0
Activate with: source .venv/bin/activate
❯ ./.venv/bin/pip install -e .
Obtaining file:///Users/zb/workspace/tmp_uv_issue_11238
  Installing build dependencies ... done
  Checking if build backend supports build_editable ... done
  Getting requirements to build editable ... done
  Preparing editable metadata (pyproject.toml) ... done
Collecting ipython==8.31.0 (from repo_name==0.1.0)
  Using cached ipython-8.31.0-py3-none-any.whl.metadata (4.9 kB)
Collecting decorator (from ipython==8.31.0->repo_name==0.1.0)
  Using cached decorator-5.1.1-py3-none-any.whl.metadata (4.0 kB)
Collecting jedi>=0.16 (from ipython==8.31.0->repo_name==0.1.0)
  Using cached jedi-0.19.2-py2.py3-none-any.whl.metadata (22 kB)
Collecting matplotlib-inline (from ipython==8.31.0->repo_name==0.1.0)
  Using cached matplotlib_inline-0.1.7-py3-none-any.whl.metadata (3.9 kB)
Collecting pexpect>4.3 (from ipython==8.31.0->repo_name==0.1.0)
  Using cached pexpect-4.9.0-py2.py3-none-any.whl.metadata (2.5 kB)
Collecting prompt_toolkit<3.1.0,>=3.0.41 (from ipython==8.31.0->repo_name==0.1.0)
  Using cached prompt_toolkit-3.0.50-py3-none-any.whl.metadata (6.6 kB)
Collecting pygments>=2.4.0 (from ipython==8.31.0->repo_name==0.1.0)
  Using cached pygments-2.19.1-py3-none-any.whl.metadata (2.5 kB)
Collecting stack_data (from ipython==8.31.0->repo_name==0.1.0)
  Using cached stack_data-0.6.3-py3-none-any.whl.metadata (18 kB)
Collecting traitlets>=5.13.0 (from ipython==8.31.0->repo_name==0.1.0)
  Using cached traitlets-5.14.3-py3-none-any.whl.metadata (10 kB)
Collecting parso<0.9.0,>=0.8.4 (from jedi>=0.16->ipython==8.31.0->repo_name==0.1.0)
  Using cached parso-0.8.4-py2.py3-none-any.whl.metadata (7.7 kB)
Collecting ptyprocess>=0.5 (from pexpect>4.3->ipython==8.31.0->repo_name==0.1.0)
  Using cached ptyprocess-0.7.0-py2.py3-none-any.whl.metadata (1.3 kB)
Collecting wcwidth (from prompt_toolkit<3.1.0,>=3.0.41->ipython==8.31.0->repo_name==0.1.0)
  Using cached wcwidth-0.2.13-py2.py3-none-any.whl.metadata (14 kB)
Collecting executing>=1.2.0 (from stack_data->ipython==8.31.0->repo_name==0.1.0)
  Using cached executing-2.2.0-py2.py3-none-any.whl.metadata (8.9 kB)
Collecting asttokens>=2.1.0 (from stack_data->ipython==8.31.0->repo_name==0.1.0)
  Using cached asttokens-3.0.0-py3-none-any.whl.metadata (4.7 kB)
Collecting pure-eval (from stack_data->ipython==8.31.0->repo_name==0.1.0)
  Using cached pure_eval-0.2.3-py3-none-any.whl.metadata (6.3 kB)
Using cached ipython-8.31.0-py3-none-any.whl (821 kB)
Using cached jedi-0.19.2-py2.py3-none-any.whl (1.6 MB)
Using cached pexpect-4.9.0-py2.py3-none-any.whl (63 kB)
Using cached prompt_toolkit-3.0.50-py3-none-any.whl (387 kB)
Using cached pygments-2.19.1-py3-none-any.whl (1.2 MB)
Using cached traitlets-5.14.3-py3-none-any.whl (85 kB)
Using cached decorator-5.1.1-py3-none-any.whl (9.1 kB)
Using cached matplotlib_inline-0.1.7-py3-none-any.whl (9.9 kB)
Using cached stack_data-0.6.3-py3-none-any.whl (24 kB)
Using cached asttokens-3.0.0-py3-none-any.whl (26 kB)
Using cached executing-2.2.0-py2.py3-none-any.whl (26 kB)
Using cached parso-0.8.4-py2.py3-none-any.whl (103 kB)
Using cached ptyprocess-0.7.0-py2.py3-none-any.whl (13 kB)
Using cached pure_eval-0.2.3-py3-none-any.whl (11 kB)
Using cached wcwidth-0.2.13-py2.py3-none-any.whl (34 kB)
Building wheels for collected packages: repo_name
  Building editable for repo_name (pyproject.toml) ... done
  Created wheel for repo_name: filename=repo_name-0.1.0-0.editable-py3-none-any.whl size=1672 sha256=7ba168bca4978b64a7414099d09a698409de3d7d5475fb9edc2613f260ab6d5a
  Stored in directory: /private/var/folders/6p/k5sd5z7j31b31pq4lhn0l8d80000gn/T/pip-ephem-wheel-cache-ryzq5zy7/wheels/2f/d6/7b/f39dd15daebc22585a59190c1c0ba1cc2964b3bf15de938a77
Successfully built repo_name
Installing collected packages: wcwidth, pure-eval, ptyprocess, traitlets, pygments, prompt_toolkit, pexpect, parso, executing, decorator, asttokens, stack_data, matplotlib-inline, jedi, ipython, repo_name
Successfully installed asttokens-3.0.0 decorator-5.1.1 executing-2.2.0 ipython-8.31.0 jedi-0.19.2 matplotlib-inline-0.1.7 parso-0.8.4 pexpect-4.9.0 prompt_toolkit-3.0.50 ptyprocess-0.7.0 pure-eval-0.2.3 pygments-2.19.1 repo_name-0.1.0 stack_data-0.6.3 traitlets-5.14.3 wcwidth-0.2.13
```

---

_Comment by @zanieb on 2025-02-05 16:38_

Ah nevermind, forgot to "create" the symlinks!

This hangs

```
❯ uv run python tools/create_links_to_top_level_package.py
   Built repo-name @ file:///Users/zb/workspace/tmp_uv_issue_11238
Uninstalled 1 package in 3ms
Installed 17 packages in 30ms
Created symlink: src/repo_name/sub1/repo_name -> ..
Created symlink: src/repo_name/sub2/repo_name -> ..
❯ ./.venv/bin/pip install -e . --no-cache --force-reinstall -v
Using pip 25.0 from /Users/zb/workspace/tmp_uv_issue_11238/.venv/lib/python3.12/site-packages/pip (python 3.12)
Obtaining file:///Users/zb/workspace/tmp_uv_issue_11238
  Running command pip subprocess to install build dependencies
  Using pip 25.0 from /Users/zb/workspace/tmp_uv_issue_11238/.venv/lib/python3.12/site-packages/pip (python 3.12)
  Collecting setuptools
    Obtaining dependency information for setuptools from https://files.pythonhosted.org/packages/69/8a/b9dc7678803429e4a3bc9ba462fa3dd9066824d3c607490235c6a796be5a/setuptools-75.8.0-py3-none-any.whl.metadata
    Using cached setuptools-75.8.0-py3-none-any.whl.metadata (6.7 kB)
  Using cached setuptools-75.8.0-py3-none-any.whl (1.2 MB)
  Installing collected packages: setuptools
  Successfully installed setuptools-75.8.0
  Installing build dependencies ... done
  Running command Checking if build backend supports build_editable
  Checking if build backend supports build_editable ... done
  Running command Getting requirements to build editable

```

It's not a bug in uv, but your build backend (setuptools)

---

_Label `bug` removed by @zanieb on 2025-02-05 16:38_

---

_Label `question` added by @zanieb on 2025-02-05 16:38_

---

_Label `upstream` added by @zanieb on 2025-02-05 16:38_

---

_Comment by @dennismoe on 2025-02-05 16:49_

Wow! That's sad.

I would never have thought of it...

So, I'll guess it's time to switch to hatch. 
Yes, hatch works fine with my first attempts. 

Thank you for the help!

---

_Comment by @zanieb on 2025-02-05 16:56_

Yep no problem! Sorry about that. We'll have our own build backend soon :)

---

_Closed by @zanieb on 2025-02-05 16:56_

---

_Referenced in [astral-sh/uv#12061](../../astral-sh/uv/issues/12061.md) on 2025-03-08 00:56_

---
