---
number: 7059
title: "Wrong hash is used for repeated `tensorflow-text`"
type: issue
state: closed
author: charliermarsh
labels:
  - bug
assignees: []
created_at: 2024-09-05T01:22:45Z
updated_at: 2024-09-05T03:09:33Z
url: https://github.com/astral-sh/uv/issues/7059
synced_at: 2026-01-07T12:31:15-06:00
---

# Wrong hash is used for repeated `tensorflow-text`

---

_Issue opened by @charliermarsh on 2024-09-05 01:22_

Not sure it's exactly the same issue, but it is related, so adding it here.

Here is a simple pyproject.toml, on macOS:

```
[project]
name = "test_uv"
version = "0.0.1"
requires-python = ">=3.11;<3.12"
dependencies = [
  "tensorflow-text @ https://github.com/sun1638650145/Libraries-and-Extensions-for-TensorFlow-for-Apple-Silicon/releases/download/v2.17/tensorflow_text-2.17.0-cp311-cp311-macosx_11_0_arm64.whl#sha256=f0a7225a1242f06e4d206235f56025a0f70fb9a2e3ecb85bd5ba686269e74c16 ; sys_platform == 'darwin'",
  "tensorflow-text; sys_platform == 'linux'",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.metadata]
allow-direct-references = true
```

an `uv sync` on this will fail with this message:

```
Resolved 41 packages in 352ms
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: tensorflow-text @ https://github.com/sun1638650145/Libraries-and-Extensions-for-TensorFlow-for-Apple-Silicon/releases/download/v2.17/tensorflow_text-2.17.0-cp311-cp311-macosx_11_0_arm64.whl#sha256=f0a7225a1242f06e4d206235f56025a0f70fb9a2e3ecb85bd5ba686269e74c16
  Caused by: Hash mismatch for `tensorflow-text @ https://github.com/sun1638650145/Libraries-and-Extensions-for-TensorFlow-for-Apple-Silicon/releases/download/v2.17/tensorflow_text-2.17.0-cp311-cp311-macosx_11_0_arm64.whl#sha256=f0a7225a1242f06e4d206235f56025a0f70fb9a2e3ecb85bd5ba686269e74c16`

Expected:
  sha256:ff3e9a8e19256e184a0e0997b189fa4a73bb00da74a109cef542e48073d99142

Computed:
  sha256:f0a7225a1242f06e4d206235f56025a0f70fb9a2e3ecb85bd5ba686269e74c16
```

Note that the computed is exactly as requested.

More important: Removing line 7, `"tensorflow-text; sys_platform == 'linux'",` allows uv to sync successfully.
The linux line should never be activated on macos; but somehow it tells uv to fetch the hash for the linux version of the wheel and create a wrong expectation.

I hope this is helpful.

_Originally posted by @maparent in https://github.com/astral-sh/uv/issues/6974#issuecomment-2329651443_
            

---

_Label `bug` added by @charliermarsh on 2024-09-05 01:22_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-09-05 01:22_

---

_Referenced in [astral-sh/uv#7060](../../astral-sh/uv/pulls/7060.md) on 2024-09-05 01:50_

---

_Closed by @charliermarsh on 2024-09-05 01:58_

---

_Closed by @charliermarsh on 2024-09-05 01:58_

---

_Referenced in [astral-sh/uv#7061](../../astral-sh/uv/pulls/7061.md) on 2024-09-05 01:58_

---

_Comment by @maparent on 2024-09-05 03:09_

That was swift! Thanks a lot!

---
