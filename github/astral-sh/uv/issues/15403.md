---
number: 15403
title: "Tests in show_settings::* fail due to user-level uv.toml being loaded"
type: issue
state: closed
author: pposca
labels:
  - bug
  - help wanted
  - testing
assignees: []
created_at: 2025-08-21T08:48:03Z
updated_at: 2025-08-21T22:10:12Z
url: https://github.com/astral-sh/uv/issues/15403
synced_at: 2026-01-07T12:31:16-06:00
---

# Tests in show_settings::* fail due to user-level uv.toml being loaded

---

_Issue opened by @pposca on 2025-08-21 08:48_

### Summary

Hi ðŸ‘‹,

After cloning the repository and running the test suite, Iâ€™m seeing multiple failures in the show_settings::* group.
It seems these tests are not fully isolated from user-level configuration (~/.config/uv/uv.toml), which affects the snapshot expectations.

**Steps to reproduce**

1. Clone the repository 
2. Ensure Rust and C compiler are installed
3. cargo run python install
4. cargo nextest run --no-fail-fast

**Observed behavior**

When running the tests with my normal configuration, I get the following failures:

<img width="664" height="227" alt="Image" src="https://github.com/user-attachments/assets/b45aac54-b64c-4852-abee-2ddf68d67a54" />

One issue looks like this:

<img width="855" height="702" alt="Image" src="https://github.com/user-attachments/assets/367dddab-b3d2-46d3-b47a-3521f933bc7e" />

<img width="1470" height="302" alt="Image" src="https://github.com/user-attachments/assets/7769465c-90fc-402a-a786-ec3f7872c260" />

**Analysis**

It looks like the tests are picking up my system/user config at:

<img width="381" height="68" alt="Image" src="https://github.com/user-attachments/assets/3950a537-2bdf-4b14-b329-c23c1cd58740" />

After commenting out that file and re-running the tests, all the show_settings::* failures disappeared âœ….

This suggests the test suite is not fully isolating $HOME.


### Platform

openSUSE Tumbleweed x86_64 - Linux 6.16.1-1-default

### Version

uv 0.8.12

### Python version

Python 3.14.0rc2

---

_Label `bug` added by @pposca on 2025-08-21 08:48_

---

_Comment by @zanieb on 2025-08-21 10:54_

It looks like these tests clear the variables from our standard test context

https://github.com/astral-sh/uv/blob/b8049eaa20a1f38e7f6530f2ccc793c34e22f334/crates/uv/tests/it/show_settings.rs#L15

otherwise it would be isolated by

https://github.com/astral-sh/uv/blob/7a9e07a98eab351aa49929c70267d52b6abfac56/crates/uv/tests/it/common/mod.rs#L815

---

_Label `help wanted` added by @zanieb on 2025-08-21 10:54_

---

_Label `testing` added by @zanieb on 2025-08-21 10:54_

---

_Referenced in [astral-sh/uv#15434](../../astral-sh/uv/pulls/15434.md) on 2025-08-21 21:10_

---

_Closed by @zanieb on 2025-08-21 22:10_

---
