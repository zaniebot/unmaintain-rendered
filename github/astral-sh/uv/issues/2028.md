---
number: 2028
title: Unable to activate VIRTUAL_ENV when CONDA_PREFIX exists
type: issue
state: closed
author: teepoy
labels:
  - question
  - virtualenv
assignees: []
created_at: 2024-02-28T00:25:55Z
updated_at: 2024-03-20T20:14:45Z
url: https://github.com/astral-sh/uv/issues/2028
synced_at: 2026-01-07T12:31:14-06:00
---

# Unable to activate VIRTUAL_ENV when CONDA_PREFIX exists

---

_Issue opened by @teepoy on 2024-02-28 00:25_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

I'm trying out uv, together with [hatch-pip-compile](https://github.com/juftin/hatch-pip-compile) (and hatch). venv creation works fine, and speed is significantly faster, great!

Except when I try to run command with created virtual env, error raises

```
(base)  test-hatch-pip-compile$ hatch run default1:python
error: Both VIRTUAL_ENV and CONDA_PREFIX are set. Please unset one of them.
```

The error message is clean, that's great, and I can fix it on my computer in 5 seconds (conda deactivate).
I just wonder if there is any difficulty makes this "user action" necessary?



Here is the hatch.toml (very likely unrelated imo since hatch is just an invoker and after I deactivated conda environment everything looks ok)
```toml
[env]
requires = [
    "hatch-pip-compile",
]

[envs.default]
path = ".venv/default"

[envs.default1]
path = ".venv/default1"
type = "pip-compile"
pip-compile-installer = "uv"
pip-compile-resolver = "uv"
```

Thank you!



---

_Label `question` added by @zanieb on 2024-02-28 02:45_

---

_Label `virtualenv` added by @zanieb on 2024-02-28 02:45_

---

_Assigned to @konstin by @zanieb on 2024-02-28 02:45_

---

_Comment by @charliermarsh on 2024-02-28 05:19_

@konstin - Thoughts?

---

_Comment by @konstin on 2024-02-28 09:08_

We could have `VIRTUAL_ENV` take precedence over `CONDA_PREFIX` if the `python` in PATH is from that venv; I'm not sure what behavior conda users would expect. 

---

_Comment by @ananis25 on 2024-03-18 14:16_

> We could have `VIRTUAL_ENV` take precedence over `CONDA_PREFIX` if the `python` in PATH is from that venv; I'm not sure what behavior conda users would expect.

This'd be useful, same error came up when using Rye to set up a new project, while the global python comes from Conda.
Having a base conda/mamba env activated is useful for one-off scripts (Rye is a bit new to use everywhere).

---

_Comment by @matthewfeickert on 2024-03-19 20:58_

This also happens if you try to have `uv` be installed globally with `pixi` via `pixi global install uv`.

The easy alternative is just to globally install `uv` itself, but it is nice to have `pixi global` be able to manage all your tools with a `pixi global upgrade-all`.

---

_Comment by @notatallshaw on 2024-03-20 17:49_

> We could have `VIRTUAL_ENV` take precedence over `CONDA_PREFIX` if the `python` in PATH is from that venv; I'm not sure what behavior conda users would expect.

When conda is activated it can be considered a globally available Python, therefore when a virtual environment is activated in a conda environment it is equivalent to a virtual environment being activated when there is a system install, the virtual environment should take precedence.

This has come up a few of times on pip issues, I'll try and find the discussion .

But anecdotally when I was a heavy conda user this is what I would have expected.

---

_Referenced in [astral-sh/uv#2574](../../astral-sh/uv/pulls/2574.md) on 2024-03-20 19:51_

---

_Closed by @charliermarsh on 2024-03-20 20:14_

---
