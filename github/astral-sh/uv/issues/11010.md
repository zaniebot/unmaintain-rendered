---
number: 11010
title: "caching: Ignoring existing virtual environment"
type: issue
state: open
author: sshleifer
labels:
  - question
assignees: []
created_at: 2025-01-28T00:49:22Z
updated_at: 2025-10-16T11:44:17Z
url: https://github.com/astral-sh/uv/issues/11010
synced_at: 2026-01-07T12:31:15-06:00
---

# caching: Ignoring existing virtual environment

---

_Issue opened by @sshleifer on 2025-01-28 00:49_

### Question

I am trying to mount a uv cache on every pod of my CI application to save startup time (at `/root/.cache/uv`).

I have tried a few different configurations following [documented caching Dockerfile](https://docs.astral.sh/uv/guides/integration/docker/#non-editable-installs) and variants. 

When I only specify `$UV_CACHE_DIR` it takes 3 minutes, as expected.
When I additionally specify `$UV_PROJECT_ENVIRONMENT` it takes 4 minutes and prints 

```
warning: Ignoring existing virtual environment linked to non-existent Python interpreter: 
/root/.cache/uv/project2/bin/python3 -> python

Using CPython 3.11.11
Removed virtual environment at: /root/.cache/uv/project2
Creating virtual environment at: /root/.cache/uv/project2
```

Any recommendations how to do this efficiently? The less work for each pull request the better. Usually dependencies don't change.



### Full Build Script
```bash
export UV_INSTALL_DIR=/root/.cache/uv/install2
export UV_LINK_MODE="copy"
export UV_CACHE_DIR=/root/.cache/uv/cache
export UV_PROJECT_ENVIRONMENT=/root/.cache/uv/project2

start_time=$(date +%s)

# UV setup
echo "Installing UV if missing"
if [ -f "${UV_INSTALL_DIR}/env" ]; then
    . "${UV_INSTALL_DIR}/env"
else
    echo "UV install env not found, skipping"
fi

if ! command -v uv &> /dev/null; then
  curl -LsSf https://astral.sh/uv/0.5.18/install.sh | sh
  . "${UV_INSTALL_DIR}/env"
fi

if [ -f "${UV_PROJECT_ENVIRONMENT}/bin/activate" ]; then
    . "${UV_PROJECT_ENVIRONMENT}/bin/activate"
else
    echo "UV project environment activate script not found, skipping"
fi

uv sync --frozen --no-install-project --no-editable;
sync_time=$(date +%s)
echo "Preamble took $((sync_time - start_time)) seconds"

uv run pytest
echo "Done tests"
```





### Platform

linux

### Version

0.5.18

---

_Label `question` added by @sshleifer on 2025-01-28 00:49_

---

_Comment by @zanieb on 2025-01-28 01:11_

In

```
warning: Ignoring existing virtual environment linked to non-existent Python interpreter: 
/root/.cache/uv/project2/bin/python3 -> python
```

Does `/root/.cache/uv/project2/bin/python` exist? Or resolve to a file that does? The message indicates we're invalidating your environment because the interpreter is broken / missing.

---

_Comment by @sshleifer on 2025-01-28 04:32_

It probably was linked to something outside of /root/.cache. Is there a flag to keep python inside UV_PROJECT_ENVIRONMENT or UV_CACHE_DIR?

---

_Comment by @clafoutis42 on 2025-10-16 11:40_

Hi @sshleifer I am encountering the same issue, did you manage to solve this?

---

_Comment by @clafoutis42 on 2025-10-16 11:44_

For people future people, I solved this by using `UV_LINK_MODE=copy` and/or `UV_SYSTEM_PYTHON=true`

---
