---
number: 10733
title: "`uv publish` error uploading to test.pypi.org due to metadata version mismatch"
type: issue
state: closed
author: CaptSolo
labels:
  - duplicate
  - external
assignees: []
created_at: 2025-01-18T13:44:45Z
updated_at: 2025-01-18T15:25:05Z
url: https://github.com/astral-sh/uv/issues/10733
synced_at: 2026-01-07T13:12:18-06:00
---

# `uv publish` error uploading to test.pypi.org due to metadata version mismatch

---

_Issue opened by @CaptSolo on 2025-01-18 13:44_

An error appears when uploading a package to `test.pypi.org`:

```
â¯ uv publish --index testpypi
warning: `uv publish` is experimental and may change without warning
Publishing 2 files https://test.pypi.org/legacy/
Uploading my_package-0.1.0-py3-none-any.whl (29.9KiB)
error: Failed to publish `dist/my_package-0.1.0-py3-none-any.whl` to https://test.pypi.org/legacy/
  Caused by: Upload failed with status code 400 Bad Request. Server says: 400 license-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.
```

It appears that `uv` generates the `License-File:` property in package metadata but that metadata is not compatible with the metadata version used: 

`License-File: LICENSE`

The version of uv:
- uv 0.5.21 (Homebrew 2025-01-17)

The operating system:
- macOS 14.7

The output of the command with the --verbose flag:

```
Uploading my_project-0.1.0-py3-none-any.whl (29.9KiB)
DEBUG Hashing dist/my_project-0.1.0-py3-none-any.whl
DEBUG Using username/password basic auth
DEBUG Response code for https://test.pypi.org/legacy/: 400 Bad Request
DEBUG Upload error response: {"message": "The server could not comply with the request since it is either malformed or otherwise incorrect.\n\n\nlicense-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.\n\n", "code": "400 license-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.", "title": "Bad Request"}
DEBUG Checking for my_project-0.1.0-py3-none-any.whl in the registry
DEBUG No cache entry for: https://test.pypi.org/simple/lv-namedays/
WARN Package not found in the registry; skipping upload check for my_project-0.1.0-py3-none-any.whl
error: Failed to publish `dist/my_project-0.1.0-py3-none-any.whl` to https://test.pypi.org/legacy/
  Caused by: Upload failed with status code 400 Bad Request. Server says: 400 license-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.
```

The index used for publishing (set in the `pyproject.toml` file):

```
[[tool.uv.index]]
name = "testpypi"
url = "https://test.pypi.org/simple/"
publish-url = "https://test.pypi.org/legacy/"
explicit = true
```

---

_Comment by @CaptSolo on 2025-01-18 13:46_

Here's the package metadata generated by `uv`:

```
Metadata-Version: 2.2
[...]
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: click
Provides-Extra: convert
Requires-Dist: pandas; extra == "convert"
Requires-Dist: openpyxl; extra == "convert"
```

---

_Comment by @CaptSolo on 2025-01-18 13:49_

Related issue (sorry, my issue might be a duplicate): #9513 

---

_Comment by @CaptSolo on 2025-01-18 13:54_

It seems to be an upstream problem. A workaround is to change the build system from setuptools to hatchling:

```
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
```



---

_Comment by @charliermarsh on 2025-01-18 15:24_

Yeah I don't believe this is in our control -- this is generated by the build backend (like setuptools or hatchling), not the build frontend (uv).

---

_Closed by @charliermarsh on 2025-01-18 15:25_

---

_Label `duplicate` added by @charliermarsh on 2025-01-18 15:25_

---

_Label `upstream` added by @charliermarsh on 2025-01-18 15:25_

---

_Referenced in [ToFuProject/datastock#226](../../ToFuProject/datastock/issues/226.md) on 2025-04-02 21:23_

---
