---
number: 15043
title: Using an index name with UV_INDEX
type: issue
state: open
author: tonnico
labels:
  - bug
  - documentation
assignees: []
created_at: 2025-08-03T19:14:41Z
updated_at: 2025-09-23T13:07:55Z
url: https://github.com/astral-sh/uv/issues/15043
synced_at: 2026-01-07T12:31:16-06:00
---

# Using an index name with UV_INDEX

---

_Issue opened by @tonnico on 2025-08-03 19:14_

### Summary

Looks like, the default index did not work, when not explicit set, when `UV_INDEX` is set.

Create a private simple python package repo.
```bash
> mkdir local-pypi
> python -m http.server -d local-pypi
```

Create a new project with uv and set the local repo in the `UV_INDEX` variable.
```bash
> uv init foo
> cd foo
> export UV_INDEX=local=http://localhost:8000
```

Adding a dependency outside the local repo.
```bash
> uv add ruff
Using CPython 3.12.1 interpreter at: /Users/nico/.pyenv/versions/3.12.1/bin/python3.12
Creating virtual environment at: .venv
  × No solution found when resolving dependencies:
  ╰─▶ Because ruff was not found in the package registry and your project depends on ruff, we can conclude that your project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.
```

### Platform

macOS 15.5 Intel

### Version

uv 0.8.4 (e176e1714 2025-07-30)

### Python version

_No response_

---

_Label `bug` added by @tonnico on 2025-08-03 19:14_

---

_Renamed from "can't add dependecies when UV_INDEX is set" to "can't add dependencies when UV_INDEX is set" by @tonnico on 2025-08-03 19:15_

---

_Comment by @konstin on 2025-08-04 09:04_

A flat directory does not follow the simple index protocol, you need to use `UV_FIND_LINKS=http://localhost:8000` for a flat index.

---

_Comment by @tonnico on 2025-08-04 09:44_

I try to make a minimal example. This same problem occure, when I add a JFrog Artifactory repo in `UV_INDEX`.

---

_Comment by @tonnico on 2025-08-05 15:40_

Adding `UV_FIND_LINKS=http://localhost:8000` results in the same error:

```
❯ uv sync
Resolved 1 package in 14ms
Audited in 0.07ms
❯ uv add ruff
  × No solution found when resolving dependencies:
  ╰─▶ Because ruff was not found in the package registry and your project depends on ruff, we can conclude that your project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.
```

---

_Comment by @konstin on 2025-08-05 15:57_

Can you provide a minimal example with all commands and files you used to setup the index? It works for me locally.

---

_Label `bug` removed by @konstin on 2025-08-05 15:57_

---

_Label `needs-mre` added by @konstin on 2025-08-05 15:57_

---

_Comment by @tonnico on 2025-08-05 16:26_

I have normally a private index, where i use a `.netrc` to authorize. However, the super simple local index creates the same issue.  
Maybe you can create a more complex local private index?

```bash
❯ uv init foo
Initialized project `foo` at `/Users/nico/projects/foo`
❯ cd foo
❯ export UV_INDEX=artifactory=https://artifactory.example.com/artifactory/api/pypi/custom-local/simple
❯ uv add ruff
Using CPython 3.13.5
Creating virtual environment at: .venv
  × No solution found when resolving dependencies:
  ╰─▶ Because ruff was not found in the package registry and your project depends on ruff, we can conclude that your project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.
```

---

_Comment by @tonnico on 2025-08-05 17:48_

I just noticed, that an index without a name will work.

So this is ok:

```
❯ export UV_INDEX=http://localhost:8000
❯ uv add ruff
Resolved 2 packages in 19ms
Installed 1 package in 4ms
 + ruff==0.12.7
```

while this is not

```
❯ export UV_INDEX=local=http://localhost:8000
❯ uv add ruff
  × No solution found when resolving dependencies:
  ╰─▶ Because ruff was not found in the package registry and your project depends on ruff>=0.12.7, we can conclude that your project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.
```

---

_Comment by @tonnico on 2025-08-06 06:36_

please try this minimal example

for the simple local index
```bash
mkdir local-pypi
cd local-pypi
cat <<EOL >index.html
<!doctype html>
<html>
  <body>
    <a href="/frob/">frob</a>
    <a href="/spamspamspam/">spamspamspam</a>
  </body>
</html>
EOL
python -m http.server
```

create a new uv project
```bash
uv init foo
cd foo
```

add an index with name `local` and try install ruff will fail
```bash
# cleanup env
unset UV_DEFAULT_INDEX
unset UV_INDEX
uv remove ruff &> /dev/null | true

export UV_INDEX=local=http://localhost:8000
uv add ruff
```

add an index without a name will not fail
```bash
# cleanup env
unset UV_DEFAULT_INDEX
unset UV_INDEX
uv remove ruff &> /dev/null | true

export UV_INDEX=http://localhost:8000
uv add ruff
```

add an index with name `local` _and_ a default index will not fail
```bash
# cleanup env
unset UV_DEFAULT_INDEX
unset UV_INDEX
uv remove ruff &> /dev/null | true

export UV_INDEX=local=http://localhost:8000
export UV_DEFAULT_INDEX=https://pypi.org/simple
uv add ruff
```

---

_Label `needs-mre` removed by @konstin on 2025-08-06 08:24_

---

_Label `bug` added by @konstin on 2025-08-06 08:34_

---

_Label `documentation` added by @konstin on 2025-08-06 08:34_

---

_Comment by @konstin on 2025-08-06 08:38_

Thank you for the reproducer! With this I can identify the problem.

In the documentation for `UV_INDEX`/`--index`, we claim that named indexes aren't supported, while they are supported (`parse_indices` -> `Index::from_str`):

>       --index <INDEX>
>           The URLs to use when resolving dependencies, in addition to the default index.
>           
>           Accepts either a repository compliant with PEP 503 (the simple repository API), or a local directory laid out in the same format.
>           
>           All indexes provided via this flag take priority over the index specified by `--default-index` (which defaults to PyPI). When multiple `--index` flags are provided, earlier values take priority.
>           
>           Index names are not supported as values. Relative paths must be disambiguated from index names with `./` or `../` on Unix or `.\\`, `..\\`, `./` or `../` on Windows.
>           
>           [env: UV_INDEX=]

In the `uv add` code, we drop the default index if a named index is present:

https://github.com/astral-sh/uv/blob/57f900ad0d1c69dfb25cf31d83a7cedbd928608d/crates/uv/src/commands/project/add.rs#L516

From the logs, we indeed only use the local index when we have an index name.

---

_Renamed from "can't add dependencies when UV_INDEX is set" to "Using an index name with UV_INDEX" by @konstin on 2025-08-06 08:38_

---

_Comment by @tonnico on 2025-08-06 10:13_

So it is the correct behaviour?

---

_Comment by @konstin on 2025-08-06 10:28_

CC @charliermarsh (https://github.com/astral-sh/uv/pull/7747): Is this intended behavior and do we need to update the docs?

---

_Comment by @tonnico on 2025-08-07 06:05_

At least it's inconsistent, as a pyproject.toml without a default index and no `UV_` variables set behaves differently.

---

_Referenced in [astral-sh/uv#15560](../../astral-sh/uv/issues/15560.md) on 2025-08-27 18:43_

---

_Comment by @jgiacobbi on 2025-09-23 13:07_

Came here to report this issue. I am relying on the `UV_INDEX_{name}_USERNAME/PASSWORD` env variables along with the named UV_INDEX format. I hope the resolution is that this behavior is not desired and the documentation is correct, specifically (emphasis mine):
> Equivalent to the --index command-line argument. If set, uv will use this space-separated list of URLs as **additional** indexes when searching for packages.

Is there another intended approach for using a private index that does not mirror pypi?

---
