---
number: 15057
title: Lazy loading of multiple paths for same dependency
type: issue
state: closed
author: lilian-delouvy
labels:
  - question
assignees: []
created_at: 2025-08-04T13:21:05Z
updated_at: 2025-08-05T08:25:27Z
url: https://github.com/astral-sh/uv/issues/15057
synced_at: 2026-01-07T12:31:16-06:00
---

# Lazy loading of multiple paths for same dependency

---

_Issue opened by @lilian-delouvy on 2025-08-04 13:21_

### Question

Hello,

I'm working on a very specific context where I can have multiple path sources for a given dependency called common_modules.
When working locally, this dependency is located, relatively speaking to my package that we'll call "teststep", in "../../common_modules".
On an AzureML pipeline (on which I have no control over the folder structure - a local package will always be placed right inside my package), the path becomes "./common_modules".
I tried doing this in my pyproject.toml:

```
dependencies = [
    "common-modules",
]

[tool.uv.sources]
common-modules = [
    { path = "../../common_modules", marker = "platform_system == 'Windows'", editable = true },
    { path = "./common_modules", marker = "platform_system != 'Windows'"}
]
```
The problem is that, after doing ```uv sync --native-tls```, I get the following error:
```
error: Failed to generate package metadata for `common-modules==0.1.0 @ directory+common_modules`
  Caused by: Distribution not found at: file:///C:/<MY_PROJECT_PATH>/teststep/common_modules
```

What's happening is that uv is trying to resolve both paths, which obviously doesn't work.

Is there a way to specify to uv that only one of the paths is fine for the current context ? If not, do you have any suggestion ?

I unfortunately cannot change the folder structure.

EDIT:

I also tried using conflicts and extras, in the hope that it was possible to resolve dependencies by specifying a single extra, like this:
```pyproject.toml
dependencies = []

[project.optional-dependencies]
local = ["common-modules"]
pipeline = ["common-modules"]

[tool.uv.sources]
common-modules = [
    { path = "../../common_modules", editable = true, extra = "local" },
    { path = "./common_modules", extra = "pipeline" }
]

[tool.uv]
package = true
conflicts = [
    [
        { extra = "local" },
        { extra = "pipeline" }
    ]
]
```

I still get an error while running ```uv sync --native-tls --extra local```:
```
error: Failed to generate package metadata for `common-modules==0.1.0 @ directory+common_modules`
  Caused by: Distribution not found at: file:///C:<MY_PROJECT_PATH>/teststep/common_modules

```

### Platform

Windows (locally) and ubuntu (pipeline)

### Version

0.7.15 (4ed9c5791 2025-06-25)

---

_Label `question` added by @lilian-delouvy on 2025-08-04 13:21_

---

_Referenced in [astral-sh/uv#15078](../../astral-sh/uv/issues/15078.md) on 2025-08-05 08:22_

---

_Comment by @lilian-delouvy on 2025-08-05 08:25_

Found the solution. Using 'uv sync --extra <extra_name>' will never work as uv will still try to resolve both paths.
Using 'uv pip install -r pyproject.toml --extra <extra_name>' will work properly. I'm not sure this is the intended behaviour, so I opened a bug ticket that can be seen [here, on issue 15078](https://github.com/astral-sh/uv/issues/15078).

---

_Closed by @lilian-delouvy on 2025-08-05 08:25_

---
