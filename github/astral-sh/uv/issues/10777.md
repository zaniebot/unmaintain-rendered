---
number: 10777
title: "[tool.uv.sources] uv is trying to normalize the path, even when the system platform differs from the marker"
type: issue
state: closed
author: campanya
labels:
  - bug
assignees: []
created_at: 2025-01-20T13:05:04Z
updated_at: 2025-01-20T21:36:19Z
url: https://github.com/astral-sh/uv/issues/10777
synced_at: 2026-01-07T12:31:15-06:00
---

# [tool.uv.sources] uv is trying to normalize the path, even when the system platform differs from the marker

---

_Issue opened by @campanya on 2025-01-20 13:05_

My dev platform is Windows; trying to deploy to a linux docker image.

I have this in my pyproject.toml:

```toml
[tool.uv.sources]
python-ldap = { path = "/uti/Python/python_ldap-3.4.4-cp312-cp312-win_amd64.whl", marker = "sys_platform  == 'win32'" }
```

This causes an error with Docker (even though the Docker image is Linux):

```bash
> [stage-0 6/6] RUN uv sync --frozen:
0.264 Using CPython 3.12.5 interpreter at: /usr/bin/python3.12
0.264 Creating virtual environment at: .venv
0.278 error: Failed to parse `uv.lock`
0.278   Caused by: TOML parse error at line 228, column 5
0.278     |
0.278 228 |     { name = "python-ldap", marker = "sys_platform == 'win32'", path = "../../uti/Python/python_ldap-3.4.4-cp312-cp312-win_amd64.whl" },
0.278     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
0.278 path could not be normalized: /app/../../uti/Python/python_ldap-3.4.4-cp312-cp312-win_amd64.whl
```

I'm not sure if this is a bug. Maybe uv could ignore the source when the marker indicates it's a dependency for another platform and avoid trying to normalize the path.

---

_Comment by @charliermarsh on 2025-01-20 14:35_

I'm not sure what to do here. We definitely shouldn't ignore this due to the markers. But arguably it should be a non-fatal failure.

---

_Label `bug` added by @charliermarsh on 2025-01-20 14:42_

---

_Comment by @charliermarsh on 2025-01-20 14:54_

Can you please share the complete `uv.lock`? I can't reproduce it.

---

_Comment by @campanya on 2025-01-20 19:38_

The problem seems to be in the normalization of the path.  You can modify the Dockerfile to make it work:

**Dockerfile**
```dockerfile
FROM ghcr.io/astral-sh/uv:python3.12-bookworm

RUN apt-get update && apt-get install -y libsasl2-dev python-dev-is-python3 libldap2-dev libssl-dev
ENV UV_COMPILE_BYTECODE=1
ENV UV_LINK_MODE=copy

# **we'll get an error:** path could not be normalized: /app/../../../uti/Python/python_ldap-3.4.4-cp312-cp312-win_amd64.whl
# WORKDIR /app
# COPY . /app

# this works
WORKDIR /app/projects/uv_test
COPY . /app/projects/uv_test

RUN  uv sync --frozen --no-editable

ENV PATH="/app/.venv/bin:$PATH"
```

**pyproject.toml**
```toml
[project]
name = "uv_test"
version = "1.0"

dependencies = ["python-ldap"]

[tool.uv.sources]
python-ldap = { path = "/uti/Python/python_ldap-3.4.4-cp312-cp312-win_amd64.whl", marker = "sys_platform  == 'win32'" }

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

```

---

_Comment by @campanya on 2025-01-20 19:51_

[uv.lock.zip](https://github.com/user-attachments/files/18481923/uv.lock.zip)

---

_Comment by @charliermarsh on 2025-01-20 20:31_

I sort of doubt we will support this. The lockfile is referencing an impossible path.


---

_Referenced in [astral-sh/uv#10789](../../astral-sh/uv/pulls/10789.md) on 2025-01-20 21:02_

---

_Comment by @charliermarsh on 2025-01-20 21:05_

I've fixed this in https://github.com/astral-sh/uv/pull/10789.

---

_Assigned to @charliermarsh by @charliermarsh on 2025-01-20 21:05_

---

_Closed by @charliermarsh on 2025-01-20 21:36_

---

_Closed by @charliermarsh on 2025-01-20 21:36_

---

_Referenced in [astral-sh/uv#16156](../../astral-sh/uv/issues/16156.md) on 2025-10-07 16:30_

---
