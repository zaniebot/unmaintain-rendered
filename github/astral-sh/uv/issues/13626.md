---
number: 13626
title: Optionally disable file locking
type: issue
state: closed
author: eaubin
labels:
  - enhancement
  - help wanted
  - configuration
assignees: []
created_at: 2025-05-23T20:42:06Z
updated_at: 2025-07-16T14:56:26Z
url: https://github.com/astral-sh/uv/issues/13626
synced_at: 2026-01-07T12:31:16-06:00
---

# Optionally disable file locking

---

_Issue opened by @eaubin on 2025-05-23 20:42_

### Summary

I have the same problem and situation as https://github.com/astral-sh/uv/issues/9050, my cluster has a lustre file system with flock disabled and admins are unwilling to enable it. Trying to install something with uv errors with:

```
In error: Could not acquire lock for `.local/share/uv/python` at `.local/share/uv/python/.lock`: Function not implemented (os error 38)
```

@zanieb rightfully points out that uv needs to take locks to prevent concurrent access to state. 

I'd be happy to give up safety though to make uv usable on my cluster. Could uv take an `UV_UNSAFE_IGNORE_FLOCK` option and not attempt flock or ignore flock errors?

### Example

_No response_

---

_Label `enhancement` added by @eaubin on 2025-05-23 20:42_

---

_Comment by @charliermarsh on 2025-05-23 21:04_

I'd be okay with something like that, personally.

---

_Comment by @philipp-fischer on 2025-05-28 15:50_

Hitting the same issue

---

_Comment by @zanieb on 2025-05-28 15:51_

I'm fine with that too. Or, can we fallback to a more rudimentary form of locking?

cc @geofft 

---

_Label `configuration` added by @zanieb on 2025-05-28 15:51_

---

_Comment by @zanieb on 2025-05-28 15:52_

(It seems fine to take the incremental step of just letting you turn it off first, regardless)

---

_Label `help wanted` added by @zanieb on 2025-05-28 15:52_

---

_Comment by @CodeMan62 on 2025-05-28 16:35_

i will try to do this and propose a PR asap 

---

_Comment by @geofft on 2025-05-28 17:18_

Yeah, an option to disable locking seems sensible to me (especially if there's "unsafe" in its name), regardless of what else we do.

The documentation should point out exactly what is unsafe and how to not get yourself into problems. My understanding is: for things like `uv python install` or `uv tool`, you can only have one running copy of `uv` at a time in the same home directory (same account), even on multiple computers. For things like `uv sync`, you can run it once _per environment_. But this gets a little dicey in that sometimes `uv` will automatically install a new Python version if needed, etc. Also, common things like `uv run` will want to at least consider `uv sync`, meaning it's a little dangerous to `uv run` on multiple computers if you disable locking, right? That seems like a surprising limitation, especially for people running in a clustered environment. Is `uv run --no-sync` / `export UV_NO_SYNC=1` sufficient to make this safe?

---

@eaubin, I guess you've already gone down this road, but if your admins haven't already seen it, https://wiki.lustre.org/Mounting_a_Lustre_File_System_on_Client_Nodes says:
> `flock`: enable support for cluster-wide, coherent POSIX file locks ('flock'). Must be applied to the `mount` commands for all clients that will be accessing common data requiring lock functionality. This has no measurable performance impact in modern (2.x) versions of Lustre (this page previously stated there was a performance impact; this is not correct for modern versions). This is the recommended mode, and is enabled by default in Lustre 2.13 and newer."

Also, if you're not specifically trying to use uv across the cluster (on multiple nodes) and you just happen to be on a workstation with a Lustre home directory, you might be better served by putting the uv install directory onto local disk somewhere, which you can do with [`UV_TOOL_DIR`](https://docs.astral.sh/uv/reference/cli/#uv-tool-dir). You may also need [`UV_CACHE_DIR`](https://docs.astral.sh/uv/reference/settings/#cache-dir).

(Out of curiosity, what's your intended workflow, as in, on which machines are you running `uv` and on which machines do you intend to actually have it change anything? In particular, if your workflow is something like running `uv` on one machine to set up an environment and then access it read-only from a compute cluster, and so you really only need single-machine locking _but_ you need the Python interpreter to be installed on Lustre, I think there are some potential designs in uv to make this use case easier.)

---

Let me do some research on locks and add some comments on #9050 in a bit, it's a little complicated and I want to make sure I say something accurate :)

---

_Referenced in [astral-sh/uv#13760](../../astral-sh/uv/pulls/13760.md) on 2025-06-01 12:30_

---

_Comment by @charliermarsh on 2025-07-11 02:05_

These errors are now non-fatal, is that sufficient to close the issue?

---

_Comment by @eaubin on 2025-07-11 14:16_

Thanks @charliermarsh! Tested with 0.7.20 and confirmed it warns and proceeds.

---

_Closed by @eaubin on 2025-07-11 14:16_

---

_Comment by @philipp-fischer on 2025-07-16 13:09_

Am I doing something wrong?
```
$ uv tool install megatron-energon
error: Could not acquire lock for `/home/pfischer/.local/share/uv/tools` at `/home/pfischer/.local/share/uv/tools/.lock`: Function not implemented (os error 38)
$ uv self update
info: Checking for updates...
success: You're on the latest version of uv (v0.7.21)
```

---

_Comment by @charliermarsh on 2025-07-16 13:21_

We only made this non-fatal this in routes where it writes outside of uv-controlled directories; we didn't make it non-fatal everywhere, though we could.

---

_Comment by @philipp-fischer on 2025-07-16 14:56_

I think it'd make sense. Right now it seems there is no way I can install anything with `uv tool install` if the FS is a network fs (which currently is true for almost any folder in my context)

---
