---
number: 6836
title: Universal resolution can generate un-installable requirements with environments
type: issue
state: closed
author: alex
labels: []
assignees: []
created_at: 2024-08-29T22:23:42Z
updated_at: 2024-09-03T22:41:17Z
url: https://github.com/astral-sh/uv/issues/6836
synced_at: 2026-01-07T13:12:17-06:00
---

# Universal resolution can generate un-installable requirements with environments

---

_Issue opened by @alex on 2024-08-29 22:23_

```
(tempenv-564a2572618) ~/.v/tempenv-564a2572618 ❯❯❯ uv version
uv 0.4.0 (Homebrew 2024-08-28)
(tempenv-564a2572618) ~/.v/tempenv-564a2572618 ❯❯❯ cat uv.toml
environments = ["python_version >= '3.10'", "python_version >= '3.8' and python_version < '3.10'", "python_version < '3.8'"]

(tempenv-564a2572618) ~/.v/tempenv-564a2572618 ❯❯❯ echo 'build' | uv pip compile - --universal -p 3.7
warning: The requested Python version 3.7 is not available; 3.12.5 will be used to build dependencies instead.
Resolved 12 packages in 5ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - --universal -p 3.7
build==1.1.1 ; python_full_version < '3.8'
build==1.2.1 ; python_full_version >= '3.8'
colorama==0.4.6 ; os_name == 'nt'
    # via build
importlib-metadata==6.7.0 ; python_full_version < '3.8'
    # via build
importlib-metadata==8.4.0 ; python_full_version < '3.10.2'
    # via build
packaging==24.0 ; python_full_version < '3.8'
    # via build
packaging==24.1 ; python_full_version >= '3.8'
    # via build
pyproject-hooks==1.1.0
    # via build
tomli==2.0.1 ; python_full_version < '3.11'
    # via build
typing-extensions==4.7.1 ; python_full_version < '3.8'
    # via importlib-metadata
zipp==3.15.0 ; python_full_version < '3.8'
    # via importlib-metadata
zipp==3.20.1 ; python_full_version < '3.10.2'
    # via importlib-metadata
```

The resolutions for `importlib-metadata` are not usable on Python 3.7, because both of the following match the markers:

```
importlib-metadata==6.7.0 ; python_full_version < '3.8'
    # via build
importlib-metadata==8.4.0 ; python_full_version < '3.10.2'
    # via build
```



---

_Referenced in [pyca/cryptography#11505](../../pyca/cryptography/pulls/11505.md) on 2024-08-29 22:23_

---

_Comment by @charliermarsh on 2024-08-29 22:34_

@BurntSushi - Can you check if this is fixed on your branch?

---

_Comment by @alex on 2024-08-29 22:36_

I feel like I should apologize for constantly dragging weird universal resolution issues in, like a cat dragging in mice.

---

_Comment by @charliermarsh on 2024-08-29 22:37_

Haha no, it’s good!

---

_Comment by @BurntSushi on 2024-08-29 23:49_

On main, I get this:

```
$ echo 'build' | run-uv main -- pip compile - --universal -p 3.7
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.12s
warning: uv is only compatible with Python >=3.8, found Python 3.7.9
Resolved 12 packages in 96ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - --universal -p 3.7
build==1.1.1 ; python_full_version < '3.10'
build==1.2.1 ; python_full_version >= '3.10'
colorama==0.4.6 ; os_name == 'nt'
    # via build
importlib-metadata==6.7.0 ; python_full_version < '3.10'
    # via build
importlib-metadata==8.4.0 ; python_full_version < '3.10.2'
    # via build
packaging==24.0 ; python_full_version < '3.10'
    # via build
packaging==24.1 ; python_full_version >= '3.10'
    # via build
pyproject-hooks==1.1.0
    # via build
tomli==2.0.1 ; python_full_version < '3.11'
    # via build
typing-extensions==4.7.1 ; python_full_version < '3.8'
    # via importlib-metadata
zipp==3.15.0 ; python_full_version < '3.10'
    # via importlib-metadata
zipp==3.20.1 ; python_full_version < '3.10.2'
    # via importlib-metadata
```

Notice that the markers here are different from yours @alex, but they are still overlapping and thus incorrect.

On my branch, I get:

```
$ echo 'build' | run-uv pr1 -- pip compile - --universal -p 3.7
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.12s
warning: uv is only compatible with Python >=3.8, found Python 3.7.9
Resolved 12 packages in 38ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - --universal -p 3.7
build==1.1.1 ; python_full_version < '3.10'
build==1.2.1 ; python_full_version >= '3.10'
colorama==0.4.6 ; os_name == 'nt'
    # via build
importlib-metadata==6.7.0 ; python_full_version < '3.10'
    # via build
importlib-metadata==8.4.0 ; python_full_version >= '3.10' and python_full_version < '3.10.2'
    # via build
packaging==24.0 ; python_full_version < '3.10'
    # via build
packaging==24.1 ; python_full_version >= '3.10'
    # via build
pyproject-hooks==1.1.0
    # via build
tomli==2.0.1 ; python_full_version < '3.11'
    # via build
typing-extensions==4.7.1 ; python_full_version < '3.8'
    # via importlib-metadata
zipp==3.15.0 ; python_full_version < '3.10'
    # via importlib-metadata
zipp==3.20.1 ; python_full_version >= '3.10' and python_full_version < '3.10.2'
    # via importlib-metadata
```

The markers are not overlapping but quite constraining. I haven't dug in to see whether that's correct or not, but these requirements are at least valid.

---

_Comment by @BurntSushi on 2024-08-29 23:50_

I also get a different warning:

```
warning: uv is only compatible with Python >=3.8, found Python 3.7.9
```

Where as @alex's output has:

```
warning: The requested Python version 3.7 is not available; 3.12.5 will be used to build dependencies instead.
```

---

_Comment by @alex on 2024-08-30 11:24_

I spot checked those markers against the `build` source, and they look right.

---

_Referenced in [astral-sh/uv#6268](../../astral-sh/uv/pulls/6268.md) on 2024-08-30 11:55_

---

_Comment by @BurntSushi on 2024-08-30 11:55_

All righty, that means this should be fixed by: https://github.com/astral-sh/uv/pull/6268

---

_Assigned to @BurntSushi by @BurntSushi on 2024-08-30 11:55_

---

_Comment by @alex on 2024-08-30 11:57_

Great, thanks.

On Fri, Aug 30, 2024 at 7:55 AM Andrew Gallant ***@***.***> wrote:
>
> All righty, that means this should be fixed by: #6268
>
> —
> Reply to this email directly, view it on GitHub, or unsubscribe.
> You are receiving this because you were mentioned.Message ID: ***@***.***>



-- 
All that is necessary for evil to succeed is for good people to do nothing.


---

_Closed by @BurntSushi on 2024-09-03 22:41_

---

_Closed by @BurntSushi on 2024-09-03 22:41_

---
