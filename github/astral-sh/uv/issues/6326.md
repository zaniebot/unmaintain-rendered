---
number: 6326
title: Internal modules / packages without pyproject.toml (Poetry transition)
type: issue
state: closed
author: nunokaeru
labels: []
assignees: []
created_at: 2024-08-21T13:38:35Z
updated_at: 2024-08-21T14:50:30Z
url: https://github.com/astral-sh/uv/issues/6326
synced_at: 2026-01-07T12:31:14-06:00
---

# Internal modules / packages without pyproject.toml (Poetry transition)

---

_Issue opened by @nunokaeru on 2024-08-21 13:38_

I want to transition to using UV but cannot understand how to transition the `tool.poetry.packages` toml variable to UV.

I am currently using `poetry` to manage internal packages of my project. Which means I want to be able to import my files based on their folder structure. Example:

```toml
pyproject.toml

[tool.poetry]
packages = [
    { include = "my_package" },
    { include = "my_other_package" },
]

[tool.poetry.dependencies]
ruff = "0.6.1"
poetry = "1.8.3"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

-------------------------------------------------------
<repo>/
    my_package/
        p1/
            m1.py
    my_other_package/
        p2/
             m2.py

-------------------------------------------------------
In m2.py

from my_package.p1 import m1

m1.func()
```

When switching to UV, I see `packages` is not a supported attribute of `[project]`, which replaces `[tool.poetry]`. Instead UV has `workspaces` which can be used with:

```
[tool.uv.workspace]
members = ["my_package", "my_other_package"]
```

This fails because neither `my_package` or `my_other_package` have a `pyproject.toml` file. If I add those, I will have to continue adding `pyproject.toml` files recursively to my packages, which is not necessarily something I want to do, as these packages are only internal to the package itself (and should always use the exact same dependencies), so it adds a lot of boilerplate.

```PS <repo>\> uv sync
error: No `project` table found in: `<repo>\my_package`
```

I also tried to use sources instead, but I cannot get these sources to be built recursively without adding `pyproject.toml` files to every single folder.

```
dependencies = ["my_package"]

[tool.uv.sources]
my_package= { path = "./my_package", editable = true }
```

Running pip with the poetry system manages to find all my files and install them locally. With:

```
PS <repo>\> python -m pip install -e .
Obtaining file:///<repo>
  Installing build dependencies ... done
  Checking if build backend supports build_editable ... done
  Getting requirements to build editable ... done
  Preparing editable metadata (pyproject.toml) ... done
Requirement already satisfied: ruff==0.6.1 in <python>\lib\site-packages (from <repo_name>==1.0.1) (0.6.1)
```

I can install the dependencies with `uv` by running `uv pip sync pyproject.toml --no-python-downloads --python-preference only-system` but cannot install my own project and my internal packages.

version: `uv 0.3.0 (dd1934c9c 2024-08-20)`

Example of usage via `uv` and `pip`
```
-----------------------------------------------------------------------------------------------------------------------------------------------------
PS C:\project> python -m pip uninstall squishtests_pkg
Found existing installation: squishtests_pkg 1.0.1
Uninstalling squishtests_pkg-1.0.1:
  Would remove:
    c:\users\nuno\squish7\python3\lib\site-packages\squishtests_pkg-1.0.1.dist-info\*
    c:\users\nuno\squish7\python3\lib\site-packages\squishtests_pkg.pth
Proceed (Y/n)? Y
  Successfully uninstalled squishtests_pkg-1.0.1
-----------------------------------------------------------------------------------------------------------------------------------------------------
PS C:\project> pytest .
================================================================== ERRORS 
ImportError while importing test module 'C:\project\shared\scripts\test\test_distribution.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
C:\Users\Nuno\Squish7\python3\lib\importlib\__init__.py:126: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
shared\scripts\test\test_distribution.py:4: in <module>
    from shared.scripts.distribution import distribute_tests, parse_features
E   ModuleNotFoundError: No module named 'shared'
-----------------------------------------------------------------------------------------------------------------------------------------------------
PS C:\project> uv pip sync pyproject.toml --no-python-downloads --python-preference only-system
Resolved 11 packages in 12ms
Audited 11 packages in 0.02ms
-----------------------------------------------------------------------------------------------------------------------------------------------------
PS C:\project> pytest .
================================================================== ERRORS 
ImportError while importing test module 'C:\project\shared\scripts\test\test_distribution.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
C:\Users\Nuno\Squish7\python3\lib\importlib\__init__.py:126: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
shared\scripts\test\test_distribution.py:4: in <module>
    from shared.scripts.distribution import distribute_tests, parse_features
E   ModuleNotFoundError: No module named 'shared'
-----------------------------------------------------------------------------------------------------------------------------------------------------
PS C:\project> uv pip sync pyproject.toml --no-python-downloads --python-preference only-system
Resolved 11 packages in 11ms
Audited 11 packages in 0.02ms
-----------------------------------------------------------------------------------------------------------------------------------------------------
PS C:\project> python -m pip install -e .
Obtaining file:///C:/xochitl/squishtests
  Installing build dependencies ... done
  Checking if build backend supports build_editable ... done
  Getting requirements to build editable ... done
  Preparing editable metadata (pyproject.toml) ... done
<blah blah blah>
Successfully built squishtests_pkg
Installing collected packages: squishtests_pkg
Successfully installed squishtests_pkg-1.0.1
-----------------------------------------------------------------------------------------------------------------------------------------------------
PS C:\project> pytest .
============================================================ test session starts ============================================================
platform win32 -- Python 3.10.6, pytest-8.3.2, pluggy-1.5.0
rootdir: C:\xochitl\squishtests
configfile: pyproject.toml
plugins: anyio-4.4.0, rerunfailures-14.0
collected 18 items

shared\scripts\test\test_distribution.py ..........                                                                                    [ 55%]
shared\scripts\test\test_feature_parser.py .                                                                                           [ 61%]
shared\scripts\test\test_labels.py ..                                                                                                  [ 72%]
shared\scripts\test\test_run_squish.py ....                                                                                            [ 94%]
shared\scripts\test\test_utilts.py .                                                                                                   [100%]

============================================================ 18 passed in 1.32s =============================================================
```




---

_Comment by @charliermarsh on 2024-08-21 14:25_

I think you want something like this for the top-level `pyproject.toml`:

```toml
[project]
name = "project"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = ["my_package", "my_other_package", "ruff==0.6.1"]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.uv.sources]
my_package = { path = "./my_package" }
my_other_package = { path = "./my_other_package" }

# If the top-level project doesn't actually have any code in it, like a `src` directory -- otherwise, can omit this.
[tool.hatch.build.targets.wheel]
packages = ["."]
```

Personally, I'd recommend adding a `pyproject.toml` to `my_package` and `my_other_package`, since you're treating them as Python packages (by declaring them as dependencies).


---

_Comment by @nunokaeru on 2024-08-21 14:50_

Thank you!

Followed your steps and they didn't work until they did ðŸ˜† 

The last solution was very simple, just used in my main pyproject.toml:
```
[tool.hatch.build.targets.wheel]
packages = [".", "my_package", "my_other_package"]
```

Always a pleasure!

---

_Closed by @nunokaeru on 2024-08-21 14:50_

---
