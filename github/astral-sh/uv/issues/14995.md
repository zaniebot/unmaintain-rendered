---
number: 14995
title: "`ncu` uses system Python instead of virtualenv Python created by `uv`"
type: issue
state: closed
author: yuxuan-z19
labels:
  - question
assignees: []
created_at: 2025-07-31T14:07:32Z
updated_at: 2025-07-31T14:38:18Z
url: https://github.com/astral-sh/uv/issues/14995
synced_at: 2026-01-07T12:31:16-06:00
---

# `ncu` uses system Python instead of virtualenv Python created by `uv`

---

_Issue opened by @yuxuan-z19 on 2025-07-31 14:07_

### Question

I created a virtual environment using `uv` in a project folder:

```bash
uv venv && source .venv/bin/activate
```

And confirmed it's being used:

```bash
$ which python
/data/zyx/learn-cuda/.venv/bin/python

$ python -c 'import sys; print(sys.executable)'
/data/zyx/learn-cuda/.venv/bin/python
```

However, when I run this command with Nsight Compute `ncu`:

```bash
$ ncu --target-processes all python -c 'import sys; print(sys.executable)'
/usr/bin/python
==WARNING== No kernels were profiled.
```

It resolves to `/usr/bin/python`, and not the one from `.venv`. Using `$(which python)` yields expected behavior:

```bash
$ ncu --target-processes all $(which python) -c 'import sys; print(sys.executable)'
/data/zyx/learn-cuda/.venv/bin/python
==WARNING== No kernels were profiled.
```

### Expected

If the virtual environment is active (either manually or via `uv`), I would expect python to resolve to the one inside `.venv`, even under `ncu`.

### Question

Is this a limitation or design choice of `uv` (e.g. not modifying `PATH`/`VIRTUAL_ENV` like` venv` does)? Should I be using `uv run` or something else to ensure subprocesses inherit the correct Python path?


### Platform

Ubuntu 24.04.2 LTS

### Version

uv 0.7.0

---

_Label `question` added by @yuxuan-z19 on 2025-07-31 14:07_

---

_Comment by @zanieb on 2025-07-31 14:17_

If you activate the virtual environment, it _is_ on the `PATH`. I'm not sure what the deal is with `ncu`.

You could try `uv run ncu ...` and we'll activate the environment automatically, but... I doubt the behavior will be different than manually activating it.

---

_Comment by @yuxuan-z19 on 2025-07-31 14:38_

@zanieb Thank you! This workaround indeed resolves the issue in some way.

```bash
$ uv run ncu --target-processes all python -c 'import sys; print(sys.executable)'
/data/zyx/learn-cuda/.venv/bin/python
==WARNING== No kernels were profiled.
```

I have observed that this problem depends on the shell environment being used.

When running in `bash`, `ncu` behaves as expected:

```bash
(learn-cuda) zyx@nv4090:~/learn-cuda$ ps -p $$ -o comm=
bash
(learn-cuda) zyx@nv4090:~/learn-cuda$ ncu --target-processes all python -c 'import sys; print(sys.executable)' 
/data/zyx/learn-cuda/.venv/bin/python
==WARNING== No kernels were profiled.
```

However, in my default **`zsh`** shell with **`oh-my-zsh`**, the command fails to pick up the virtual environment Python unless I specify the absolute path:

Interestingly, running the command inside a subshell works correctly in `zsh`:

```bash
$ ps -p $$ -o comm=
zsh
$ zsh -c "ncu --target-processes all python -c 'import sys; print(sys.executable)'"
/data/zyx/learn-cuda/.venv/bin/python
```

I will report this issue on the NVIDIA Developer Forum for further investigation.

Thanks again for your help!

---

_Closed by @yuxuan-z19 on 2025-07-31 14:38_

---
