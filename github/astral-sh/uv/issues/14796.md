---
number: 14796
title: UV_DEFAULT_INDEX overwrites pyproject tool.uv.index.url
type: issue
state: open
author: Halkcyon
labels:
  - question
assignees: []
created_at: 2025-07-21T17:45:26Z
updated_at: 2025-07-23T18:25:55Z
url: https://github.com/astral-sh/uv/issues/14796
synced_at: 2026-01-07T12:31:16-06:00
---

# UV_DEFAULT_INDEX overwrites pyproject tool.uv.index.url

---

_Issue opened by @Halkcyon on 2025-07-21 17:45_

### Summary

A bit surprising, configuring the `UV_DEFAULT_INDEX` envvar causes any `uv` commands to overwrite the `pyproject.toml`'s `tool.uv.index.url` value where `default = true`.  Usually the behavior is FILE_CONFIG > ENV_VAR in precedence, so I'm not sure if this is a bug or not.  We want to be able to configure a "default" index to avoid Internet access, but not if it means that we're seeing these overwrites.


### Platform

Windows 11 x86_64

### Version

uv 0.7.19

### Python version

Python 3.13

---

_Label `bug` added by @Halkcyon on 2025-07-21 17:45_

---

_Comment by @zanieb on 2025-07-21 17:46_

The precedence in uv is FILE -> ENV -> CLI

---

_Label `bug` removed by @zanieb on 2025-07-21 17:46_

---

_Label `question` added by @zanieb on 2025-07-21 17:46_

---

_Comment by @Halkcyon on 2025-07-21 17:48_

@zanieb I still find this behavior of the envvar _overwriting_ the file config to be unusual/confusing.  It's common in other CLI tools that FILE overwrites ENV.  Is this hierarchy difference documented somewhere?

---

_Comment by @zanieb on 2025-07-21 17:53_

I don't think what you're saying is true, i.e., I don't think that's common. Do you have concrete examples?

A brief search shows our pattern is far more common, e.g., https://chatgpt.com/share/687e7df1-f808-8011-a537-982436a6693f

---

_Comment by @Halkcyon on 2025-07-21 19:20_

> I don't think what you're saying is true, i.e., I don't think that's common. Do you have concrete examples?

Hm, I was confused on this matter and misremembered how precedence in, e.g., pip, worked.

I still think it is _surprising_ behavior that `pyproject.toml` is _overwritten_ based on the environment configuration.  This creates diff noise when, for example, we have several Artifactory proxies/registries and those end up bleeding through based on a given contributor's configuration.

I guess what I'm asking for here is a preservation of the prior, expected configuration as an additional index, and a warning of some kind that the value is being overwritten because the envvar and pyproject differ.

---

_Comment by @zanieb on 2025-07-21 19:24_

> I still think it is surprising behavior that pyproject.toml is overwritten based on the environment configuration. 

Can you explain what you mean more concretely here? e.g., that the `pyproject.toml` is updated when you use `uv add` or similar? What's the actual workflow and outcome?

---

_Comment by @Halkcyon on 2025-07-21 19:49_

> Can you explain what you mean more concretely here? e.g., that the `pyproject.toml` is updated when you use `uv add` or similar?

Yes.  I have a few registries configured with `[[tool.uv.index]]` in my `pyproject.toml` since one or two are private to my team/organization.  I have a `UV_DEFAULT_INDEX` that is also configured based on some corporate tooling/automated configuration.  There are other proxies which may be more out of date for some reason or another due to provisioning/replication lag.  When using `uv` commands like `add`, with a given default registry configured, if it's different from the environment variable, it's being overwritten, even if it exists as another registry source, and the previous default information is being lost.

```toml
[[tool.uv.index]]
name = "primary"
url = "https://pypi.org/simple"
default = true

[[tool.uv.index]]
name = "sandbox"
url = "https://test.pypi.org/simple"
```

```shell
$ UV_DEFAULT_INDEX=https://test.pypi.org/simple uv add click --index-strategy=unsafe-best-match
```

```toml
[[tool.uv.index]]
name = "primary"
url = "https://test.pypi.org/simple"
default = true
```

---

_Comment by @zanieb on 2025-07-21 19:54_

I'm not sure there's something better we can do there. That's the index you asked us to solve with, that's the index that will be written to the `uv.lock` and it needs to be in the `pyproject.toml` to avoid invalidating the lockfile. I think what you're asking for, more generally, is a first-class index proxy feature, similar to https://github.com/astral-sh/uv/issues/6349

---

_Comment by @Halkcyon on 2025-07-23 18:00_

If the original value cannot be preserved as an additional index, I think it should at least be a warning that your default is being overwritten because of a difference caused by UV_DEFAULT_INDEX.

---

_Comment by @tonnico on 2025-07-23 18:25_

I also got confused by this. Shouldn't the `uv.lock` not be in sync with the `pyproject.toml`? ENV over FILE may work for something less persistent things.

---
