---
number: 1362
title: uv pip compile fails to resolve packages that pip-compile resolves with internal pypi artifactory repo
type: issue
state: closed
author: merc1031
labels:
  - bug
  - compatibility
  - registry
assignees: []
created_at: 2024-02-15T21:41:47Z
updated_at: 2024-02-16T20:11:21Z
url: https://github.com/astral-sh/uv/issues/1362
synced_at: 2026-01-07T12:31:14-06:00
---

# uv pip compile fails to resolve packages that pip-compile resolves with internal pypi artifactory repo

---

_Issue opened by @merc1031 on 2024-02-15 21:41_

using pip-compile
```
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ pip-compile --index-url https://<host>/artifactory/api/pypi/virtual-pypi/simple <(echo "retry==0.9.2\ncelery==5.3.0\n") -o /tmp/ci2 
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.10
# by the following command:
#
#    pip-compile --index-url=https://<host>/artifactory/api/pypi/virtual-pypi/simple --output-file=/tmp/ci2 /proc/self/fd/11
#
--index-url https://<host>/artifactory/api/pypi/virtual-pypi/simple

amqp==5.2.0
    # via kombu
billiard==4.2.0
    # via celery
celery==5.3.0
    # via -r /proc/self/fd/11
click==8.1.7
    # via
    #   celery
    #   click-didyoumean
    #   click-plugins
    #   click-repl
click-didyoumean==0.3.0
    # via celery
click-plugins==1.1.1
    # via celery
click-repl==0.3.0
    # via celery
decorator==5.1.1
    # via retry
kombu==5.3.5
    # via celery
prompt-toolkit==3.0.43
    # via click-repl
py==1.11.0
    # via retry
python-dateutil==2.8.2
    # via celery
retry==0.9.2
    # via -r /proc/self/fd/11
six==1.16.0
    # via python-dateutil
tzdata==2024.1
    # via celery
vine==5.1.0
    # via
    #   amqp
    #   celery
    #   kombu
wcwidth==0.2.13
    # via prompt-toolkit
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ cat /tmp/ci2                                                                                                                                                                
#
# This file is autogenerated by pip-compile with Python 3.10
# by the following command:
#
#    pip-compile --index-url=https://<host>/artifactory/api/pypi/virtual-pypi/simple --output-file=/tmp/ci2 /proc/self/fd/11
#
--index-url https://<host>/artifactory/api/pypi/virtual-pypi/simple

amqp==5.2.0
    # via kombu
billiard==4.2.0
    # via celery
celery==5.3.0
    # via -r /proc/self/fd/11
click==8.1.7
    # via
    #   celery
    #   click-didyoumean
    #   click-plugins
    #   click-repl
click-didyoumean==0.3.0
    # via celery
click-plugins==1.1.1
    # via celery
click-repl==0.3.0
    # via celery
decorator==5.1.1
    # via retry
kombu==5.3.5
    # via celery
prompt-toolkit==3.0.43
    # via click-repl
py==1.11.0
    # via retry
python-dateutil==2.8.2
    # via celery
retry==0.9.2
    # via -r /proc/self/fd/11
six==1.16.0
    # via python-dateutil
tzdata==2024.1
    # via celery
vine==5.1.0
    # via
    #   amqp
    #   celery
    #   kombu
wcwidth==0.2.13
    # via prompt-toolkit
```

odd behaviour using uv pip compile
```
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ uv pip compile --index-url https://<host>/artifactory/api/pypi/virtual-pypi/simple --no-cache --no-deps <(echo "retry==0.9.2\n") -o /tmp/ci
Resolved 1 package in 150ms
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ cat /tmp/ci                                                                                                                                                                                           
# This file was autogenerated by uv v0.1.0 via the following command:
#    uv pip compile --index-url https://<host>/artifactory/api/pypi/virtual-pypi/simple --no-cache --no-deps /proc/self/fd/11 -o /tmp/ci
retry==0.9.2
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ uv pip compile --index-url https://<host>/artifactory/api/pypi/virtual-pypi/simple --no-cache --no-deps <(echo "retry==0.9.2\ncelery==5.3.0\n") -o /tmp/ci
error: Failed to download: retry==0.9.2
  Caused by: HTTP status client error (404 Not Found) for url (https://<host>/artifactory/api/pypi/packages/packages/4b/0d/53aea75710af4528a25ed6837d71d117602b01946b307a3912cb3cfcbcba/retry-0.9.2-py2.py3-none-any.whl#sha256=ccddf89761fa2c726ab29391837d4327f819ea14d244c232a1d24c67a2f98606)
  ```

---

_Label `bug` added by @zanieb on 2024-02-15 21:44_

---

_Label `compatibility` added by @zanieb on 2024-02-15 21:44_

---

_Comment by @zanieb on 2024-02-15 21:45_

Thanks for the report!

How are you authenticating with the service?

---

_Comment by @merc1031 on 2024-02-15 21:51_

We have unauthenticated read allowed.
For uploads theres a service user that is configured in a .pypirc.

Here it should be simply the configuration in pip config
```
(assets-3.10.11) ➜  tools-3 git:(master) ✗ pip config list
global.ignore-installed='true'
global.index='https://<host>/artifactory/api/pypi/virtual-pypi/simple'
global.index-url='https://<host>/artifactory/api/pypi/virtual-pypi/simple'
global.require-virtualenv='True'
```

---

_Comment by @rcramblit on 2024-02-15 22:41_

I might have a related error.
I am also using an internal python registry, Sonatype Nexus, and am getting a 404 Not Found with `uv pip`.

I notice the URL that `uv pip` attempts to download the artifact from is different than what `pip` is getting:

`pip`:
```
Downloading https://*****/repository/python/packages/requests/2.31.0/requests-2.31.0.tar.gz
```

`uv pip`:
```
error: Failed to download and build: requests==2.31.0
  Caused by: HTTP status client error (404 Not Found) for url (https://*****/repository/packages/requests/2.31.0/requests-2.31.0.tar.gz ...
```



---

_Referenced in [astral-sh/uv#1388](../../astral-sh/uv/issues/1388.md) on 2024-02-15 23:45_

---

_Label `index` added by @zanieb on 2024-02-15 23:47_

---

_Comment by @jamesgilmorelyst on 2024-02-16 14:21_

@rcramblit this issue seems to be fixed in 0.1.2 released today after testing myself. Not sure if this version also resolves the main issue of this post.

---

_Comment by @rcramblit on 2024-02-16 17:11_

Confirmed the issue is resolved for me - thanks!

---

_Closed by @zanieb on 2024-02-16 17:48_

---

_Comment by @merc1031 on 2024-02-16 20:11_

Confirmed as well. this bug was fixed!
I hit another one #1528 , but it seems like a new issue

---
