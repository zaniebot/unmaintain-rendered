---
number: 4812
title: "`uv sync` should lock (unless `--locked` is provided)"
type: issue
state: closed
author: charliermarsh
labels:
  - enhancement
  - preview
assignees: []
created_at: 2024-07-04T17:40:17Z
updated_at: 2024-11-23T13:19:59Z
url: https://github.com/astral-sh/uv/issues/4812
synced_at: 2026-01-07T12:31:14-06:00
---

# `uv sync` should lock (unless `--locked` is provided)

---

_Issue opened by @charliermarsh on 2024-07-04 17:40_

_No description provided._

---

_Label `enhancement` added by @charliermarsh on 2024-07-04 17:40_

---

_Label `preview` added by @charliermarsh on 2024-07-04 17:40_

---

_Referenced in [astral-sh/uv#4803](../../astral-sh/uv/issues/4803.md) on 2024-07-04 17:41_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-07-04 22:27_

---

_Referenced in [astral-sh/uv#4839](../../astral-sh/uv/pulls/4839.md) on 2024-07-05 21:43_

---

_Comment by @chrisrodrigue on 2024-07-08 20:17_

Just wanted to make sure this wasn't a typo... if locking is implicit shouldn't the command be `uv sync --no-lock` or `uv sync --without-lock`?

---

_Comment by @zanieb on 2024-07-08 20:50_

`--locked` follows Cargo's command line interface, meaning assert the lock file would not change.`--no-lock` feels ambiguous as it might hint that we won't read or update the lock file â€” which isn't true.

Here's their help menu:

```
      --locked                Assert that `Cargo.lock` will remain unchanged
      --offline               Run without accessing the network
      --frozen                Equivalent to specifying both --locked and --offline
```

---

_Comment by @chrisrodrigue on 2024-07-08 21:12_

Ahh I see, so `--locked` would imply that the lockfile is "locked" and be a signal to *not* update it. Got it.

I am used to the `ruff` CLI with `ruff check --no-fix` / `ruff check --fix` so my brain tripped up.

Is parity with cargo something you guys are shooting for? Personally I'm not sure how much overlap there is between Rustaceans and Pythonistas... I wish the [TIOBE index](https://www.tiobe.com/tiobe-index/) showed multilingual demographics. I'm a Python/C++ guy myself.

---

_Closed by @charliermarsh on 2024-07-09 22:18_

---

_Closed by @charliermarsh on 2024-07-09 22:18_

---

_Comment by @provinzkraut on 2024-11-23 12:09_

@charliermarsh For my own understanding, could you explain why it should lock by default? 

This was rather unexpected to me, as it deviates from the behaviour of most other package managers, and for most projects, it's almost never the desired default behaviour. 

I see that it makes sense for a `sync` command to also sync the lockfile, but seeing as there's no separate `install` command that just install everything from the lockfile, running `uv sync` without `--locked` / `--frozen` seems to defeat one of the purposes of a lockfile: Consistent installs. 
When I tell someone to check out my branch and run something, I'd like them to have the same packages installed as I do. Implicit updates is something I virtually never want, and might be consider a footgun instead :eyes: 

This extends to other commands such as `uv run`, where I'd argue this is even more unexpected. For example, what is the benefit of e.g. `uv run pytest` updating my dependencies? If I execute that command twice in a row, I would expected to not to run into any issues, but it could actually update my dependencies on the second run, breaking my test suite :see_no_evil:

Am I missing something here? Am I using uv wrong? 



---

_Comment by @charliermarsh on 2024-11-23 13:00_

It generally matches Cargo, as an example. We _only_ update the lockfile if it's out-of-sync with the `pyproject.toml`, i.e., if you've added a new dependency. We don't update arbitrary dependencies on `uv sync` or `uv run`.

---

_Comment by @charliermarsh on 2024-11-23 13:00_

> If I execute that command twice in a row, I would expected to not to run into any issues, but it could actually update my dependencies on the second run, breaking my test suite.

As an example: this wouldn't happen unless you changed your dependencies.

---

_Comment by @provinzkraut on 2024-11-23 13:18_

> > If I execute that command twice in a row, I would expected to not to run into any issues, but it could actually update my dependencies on the second run, breaking my test suite.
> 
> As an example: this wouldn't happen unless you changed your dependencies.

Hm. That is the behaviour I've expected, but not the one I've experienced in a few cases. So, if `uv run` would update the lockfile without a change to the dependencies in `pyproject.toml`, that would be considered a bug? In that case, the next time this happens I'll investigate / open an issue if I can reproduce this somehow

---

_Comment by @provinzkraut on 2024-11-23 13:19_

> It generally matches Cargo, as an example. We _only_ update the lockfile if it's out-of-sync with the `pyproject.toml`, i.e., if you've added a new dependency. We don't update arbitrary dependencies on `uv sync` or `uv run`.

Thanks for the clarification! So my expectations were correct, it's just that either I've misconfigured something somewhere, or found a bug :)

---
