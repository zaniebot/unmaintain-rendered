---
number: 8512
title: uv installs incorrect versions of dependencies when using Nexus
type: issue
state: open
author: nwp90
labels:
  - needs-mre
assignees: []
created_at: 2024-10-24T04:10:56Z
updated_at: 2024-10-29T02:34:50Z
url: https://github.com/astral-sh/uv/issues/8512
synced_at: 2026-01-07T12:31:15-06:00
---

# uv installs incorrect versions of dependencies when using Nexus

---

_Issue opened by @nwp90 on 2024-10-24 04:10_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->
With uv 0.4.26 on Linux and python 3.8 found first in PATH:

* init a new project with "uv init"
* uv will init the project and set .python-version to 3.8, and requires-python to >= 3.8 in pyproject.toml.
* "uv add sphinx"
* uv will add the correct sphinx version, 7.1.2
* add a [tool.uv] section specifying an index-url that points to a Nexus repo that mirrors pypi (and perhaps adds local packages too)
* remove the existing dependency specs from pyproject.toml and blow away uv.lock
* "uv add sphinx"
* uv will add an incorrect sphinx version (7.2.2) which specifies a requires-python >= 3.9

---

_Comment by @charliermarsh on 2024-10-24 23:50_

Have you confirmed that the Nexus index is serving that Python requirement properly? And can you share the resulting `pyproject.toml` and `uv.lock` file? 

---

_Label `needs-mre` added by @charliermarsh on 2024-10-24 23:50_

---

_Comment by @nwp90 on 2024-10-29 02:34_

When we fix the requirements to what it "should" serve, it gets it from Nexus with no problems, so I'd think Nexus is working as designed.

Interestingly, returning to this today, I can no longer get uv to install the wrong version of sphinx, but it does still install an incorrect version of alabaster (dependency of sphinx, should use 0.7.13 but uses 0.7.16 from Nexus) and sphinxcontrib-devhelp (should use 1.0.2, uses 1.0.6).

Pyproject.toml after init:

> [project]
> name = "test-uv-bad"
> version = "0.1.0"
> description = "Add your description here"
> readme = "README.md"
> requires-python = ">=3.8"
> dependencies = []

`uv add sphinx`, then pyproject.toml:

> [project]
> name = "test-uv-bad"
> version = "0.1.0"
> description = "Add your description here"
> readme = "README.md"
> requires-python = ">=3.8"
> dependencies = [
>     "sphinx>=7.1.2",
> ]

uv.lock at this point: 
[uv.lock.txt](https://github.com/user-attachments/files/17550735/uv.lock.txt)

Remove uv.lock, remove sphinx dep, add index-url, pyproject.toml now:

> [project]
> name = "test-uv-bad"
> version = "0.1.0"
> description = "Add your description here"
> readme = "README.md"
> requires-python = ">=3.8"
> dependencies = [
> ]
> 
> [tool.uv]
> index-url = "https://nexus.otago.ac.nz/repository/dst-python-localshop/simple/"

`uv add sphinx`, output:

> Resolved 26 packages in 296ms
> Uninstalled 2 packages in 4ms
> Installed 2 packages in 4ms
>  - alabaster==0.7.13
>  + alabaster==0.7.16
>  - sphinxcontrib-devhelp==1.0.2
>  + sphinxcontrib-devhelp==1.0.6

pyproject.toml now:

> [project]
> name = "test-uv-bad"
> version = "0.1.0"
> description = "Add your description here"
> readme = "README.md"
> requires-python = ">=3.8"
> dependencies = [
>     "sphinx>=7.1.2",
> ]
> 
> [tool.uv]
> index-url = "https://nexus.otago.ac.nz/repository/dst-python-localshop/simple/"

uv.lock now: 
[uv.lock.txt](https://github.com/user-attachments/files/17550784/uv.lock.txt)

Comment out index-url, remove uv.lock, and `uv sync`, output:

> Resolved 26 packages in 20ms
> Uninstalled 2 packages in 3ms
> Installed 2 packages in 4ms
>  - alabaster==0.7.16
>  + alabaster==0.7.13
>  - sphinxcontrib-devhelp==1.0.6
>  + sphinxcontrib-devhelp==1.0.2

When I was doing this at the time of creating this issue, sphinx was getting up/downgraded along with alabaster and sphinxcontrib-devhelp (and perhaps sphinxcontrib-serializinghtml as well, not 100% sure).

Running `uv sync` with -vvv at the time gave lots of "Abandoning prefetch for <xxx> due to missing registry capabilities" which I assume is due to something Nexus does/doesn't do, and might be related? There seem to be fewer of these messages now, unless I delete uv's cache - but even then the correct version of sphinx is still loading.

alabaster 0.7.16 and sphinxcontrib-devhelp 1.0.6 both have the requires-python >= 3.9 in the METADATA file that's been installed into .venv/lib/python3.8/site-packages/alabaster-0.7.16.dist-info/METADATA or equivalent, so still broken, just slightly more subtly than the other day.

---
