---
number: 13321
title: "Struggling to install `axolotl[flash-attn,deepspeed]` via `pyproject.toml` with"
type: issue
state: open
author: sidmadala
labels:
  - question
assignees: []
created_at: 2025-05-06T22:13:25Z
updated_at: 2025-06-06T11:42:05Z
url: https://github.com/astral-sh/uv/issues/13321
synced_at: 2026-01-07T12:31:16-06:00
---

# Struggling to install `axolotl[flash-attn,deepspeed]` via `pyproject.toml` with

---

_Issue opened by @sidmadala on 2025-05-06 22:13_

### Summary

I am trying to install my research environment which requires the `axolotl` finetuning library alongside `flash-attn` and `deepspeed` extras. This requires using `no-build-isolation` which has been giving me significant trouble. I have pasted my `pyproject.toml` below along with the commands I am using the set up the environment. A similar issue is #1582 but does not solve my problem. I have also looked at some [docs](https://docs.astral.sh/uv/concepts/projects/config/#build-isolation) which were not helpful on this issue. Any assistance would be much appreciated.

pyproject.toml
```toml
[project]
name = "test-uv"
version = "0.1.0"
requires-python = ">=3.13"
dependencies = [
    "torch==2.6.0",
    "torchvision",
    "huggingface_hub[cli,torch]>=0.30.0",
    "transformers>=4.51",
    "evaluate>=0.4.0",
    "datasets>=3.5.0",
    "accelerate>=1.6.0",
    "peft>=0.15.0",
    "bitsandbytes>=0.45.0",
    "trl>=0.17.0",
    "unsloth",
    "sentencepiece",
    "openai",
    "scikit-learn",
    "scipy",
    "jupyterlab", 
    "matplotlib",
    "seaborn",
    "gradio",
    "wandb",
    "nltk==3.9.1",
    "pandas",
    "tenacity",
    "requests",
    "aiohttp",
    "ratelimit",
    "importlib_resources",
    "mypy",
    "python-dotenv",
    "nvitop",
    "gpustat",

    "vllm==0.8.5", 
    # "axolotl[flash-attn,deepspeed]==0.9.0",  # This causes errors when uncommented
]

[project.optional-dependencies]
build = ["packaging", "setuptools", "wheel", "ninja"]  # might need torch
compile = ["axolotl"]

[tool.uv]
no-build-isolation-package = ["axolotl"]    

[[tool.uv.dependency-metadata]]
name = "axolotl"
provides-extras = ["flash-attn", "deepspeed"]
version = "0.9.0"
```

Commands:
```shell
sidmadala@icgpu01:~/hocklab/test-uv$ uv sync
Using CPython 3.13.3
Creating virtual environment at: .venv
Resolved 280 packages in 2.41s
  × Failed to build `outlines-core==0.1.26`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta.build_wheel` failed (exit status: 1)

      [stdout]
      running bdist_wheel
      running build
      running build_py
      copying python/outlines_core/__init__.py -> build/lib.linux-x86_64-cpython-313/outlines_core
      copying python/outlines_core/_version.py -> build/lib.linux-x86_64-cpython-313/outlines_core
      running egg_info
      writing python/outlines_core.egg-info/PKG-INFO
      writing dependency_links to python/outlines_core.egg-info/dependency_links.txt
      writing requirements to python/outlines_core.egg-info/requires.txt
      writing top-level names to python/outlines_core.egg-info/top_level.txt
      reading manifest file 'python/outlines_core.egg-info/SOURCES.txt'
      adding license file 'LICENSE'
      writing manifest file 'python/outlines_core.egg-info/SOURCES.txt'
      copying python/outlines_core/py.typed -> build/lib.linux-x86_64-cpython-313/outlines_core
      copying python/outlines_core/fsm/__init__.py -> build/lib.linux-x86_64-cpython-313/outlines_core/fsm
      copying python/outlines_core/fsm/guide.py -> build/lib.linux-x86_64-cpython-313/outlines_core/fsm
      copying python/outlines_core/fsm/json_schema.py -> build/lib.linux-x86_64-cpython-313/outlines_core/fsm
      copying python/outlines_core/fsm/outlines_core_rs.pyi -> build/lib.linux-x86_64-cpython-313/outlines_core/fsm
      copying python/outlines_core/fsm/regex.py -> build/lib.linux-x86_64-cpython-313/outlines_core/fsm
      running build_ext
      running build_rust

      [stderr]
      /home/sidmadala/.cache/uv/builds-v0/.tmp0f9q72/lib/python3.13/site-packages/setuptools/config/_apply_pyprojecttoml.py:82:
      SetuptoolsDeprecationWarning: `project.license` as a TOML table is deprecated
      !!

              ********************************************************************************
              Please use a simple string containing a SPDX expression for `project.license`. You can also use `project.license-files`. (Both options
      available on setuptools>=77.0.0).

              By 2026-Feb-18, you need to update your project and remove deprecated calls
              or your builds will no longer be supported.

              See https://packaging.python.org/en/latest/guides/writing-pyproject-toml/#license for details.
              ********************************************************************************

      !!
        corresp(dist, value, root_dir)
      ERROR setuptools_scm._file_finders.git listing git files failed - pretending there aren't any
      /home/sidmadala/.cache/uv/builds-v0/.tmp0f9q72/lib/python3.13/site-packages/setuptools/command/build_py.py:212: _Warning: Package
      'outlines_core.fsm' is absent from the `packages` configuration.
      !!

              ********************************************************************************
              ############################
              # Package would be ignored #
              ############################
              Python recognizes 'outlines_core.fsm' as an importable package[^1],
              but it is absent from setuptools' `packages` configuration.

              This leads to an ambiguous overall configuration. If you want to distribute this
              package, please make sure that 'outlines_core.fsm' is explicitly added
              to the `packages` configuration field.

              Alternatively, you can also rely on setuptools' discovery methods
              (for example by using `find_namespace_packages(...)`/`find_namespace:`
              instead of `find_packages(...)`/`find:`).

              You can read more about "package discovery" on setuptools documentation page:

              - https://setuptools.pypa.io/en/latest/userguide/package_discovery.html

              If you don't want 'outlines_core.fsm' to be distributed and are
              already explicitly excluding 'outlines_core.fsm' via
              `find_namespace_packages(...)/find_namespace` or `find_packages(...)/find`,
              you can try to use `exclude_package_data`, or `include-package-data=False` in
              combination with a more fine grained `package-data` configuration.

              You can read more about "package data files" on setuptools documentation page:

              - https://setuptools.pypa.io/en/latest/userguide/datafiles.html


              [^1]: For Python, any directory (with suitable naming) can be imported,
                    even if it does not contain any `.py` files.
                    On the other hand, currently there is no concept of package data
                    directory, all directories are treated like packages.
              ********************************************************************************

      !!
        check.warn(importable)
      error: can't find Rust compiler

      If you are using an outdated pip version, it is possible a prebuilt wheel is available for this package but pip is not able to install from it.
      Installing from the wheel would avoid the need for a Rust compiler.

      To update pip, run:

          pip install --upgrade pip

      and then retry package installation.

      If you did intend to build this package from source, try installing a Rust compiler from your system package manager and ensure it is on
      the PATH during installation. Alternatively, rustup (available at https://rustup.rs) is the recommended way to download and update the Rust
      compiler toolchain.

      hint: This usually indicates a problem with the package or the build environment.
  help: `outlines-core` (v0.1.26) was included because `test-uv` (v0.1.0) depends on `vllm` (v0.8.5) which depends on `outlines` (v0.1.11) which
        depends on `outlines-core`
```


### Platform

Linux 5.15.0-113-generic x86_64 GNU/Linux

### Version

uv 0.7.2

### Python version

Python 3.13

---

_Label `bug` added by @sidmadala on 2025-05-06 22:13_

---

_Comment by @konstin on 2025-05-06 22:32_

You resolution has an old version of outlines-core that doesn't have binaries for 3.13. It needs to build the package from source, and then encounters this error:

> error: can't find Rust compiler

If you install Rust, you should be able to build and install the package. Alternatively, use a lower Python version or check if you can use a newer outlines-core version, too.

---

_Comment by @sidmadala on 2025-05-06 22:59_

Sorry, I downgraded to `python==3.12.*` This is the issue I'm getting now.

```shell
sidmadala@icgpu01:~/hocklab/test-uv$ uv sync
Resolved 279 packages in 10ms
  × Failed to build `axolotl==0.9.0`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File "<string>", line 8, in <module>
      ModuleNotFoundError: No module named 'setuptools'

      hint: This usually indicates a problem with the package or the build environment.
  help: `axolotl` (v0.9.0) was included because `test-uv` (v0.1.0) depends on `axolotl`
```

pyproject.toml
```toml
[project]
name = "test-uv"
version = "0.1.0"
requires-python = "==3.12.*"
dependencies = [
    "torch==2.6.0",
    "torchvision",
    "huggingface_hub[cli,torch]>=0.30.0",
    "transformers>=4.51",
    "evaluate>=0.4.0",
    "datasets>=3.5.0",
    "accelerate>=1.6.0",
    "peft>=0.15.0",
    "bitsandbytes>=0.45.0",
    "trl>=0.17.0",
    "unsloth",
    "sentencepiece",
    "openai",
    "scikit-learn",
    "scipy",
    "jupyterlab", 
    "matplotlib",
    "seaborn",
    "gradio",
    "wandb",
    "nltk==3.9.1",
    "pandas",
    "tenacity",
    "requests",
    "aiohttp",
    "ratelimit",
    "importlib_resources",
    "mypy",
    "python-dotenv",
    "nvitop",
    "gpustat",

    "vllm==0.8.5", 
    "axolotl[flash-attn,deepspeed]==0.9.0",  # This causes errors when uncommented but doesn't install when commented
]

# [project.optional-dependencies]
# build = ["packaging", "setuptools", "wheel", "ninja"]  # might need torch
# compile = ["axolotl"]

[tool.uv]
no-build-isolation-package = ["axolotl"]    

[[tool.uv.dependency-metadata]]
name = "axolotl"
provides-extras = ["flash-attn", "deepspeed"]
version = "0.9.0"
requires-dist = ["setuptools"]
```

---

_Comment by @charliermarsh on 2025-05-07 12:57_

Happy to help, why does it require build isolation though? If you omit build isolation, what problem do you run into?

---

_Comment by @sidmadala on 2025-05-07 15:26_

I don't think `axolotl` itself requires build isolation, rather it's `flash-attn` which is causing the issue. I was referring to the `axolotl` [docs](https://docs.axolotl.ai/docs/installation.html) though and they said to install the library with no build isolation enabled. I had a similar issue when using `pixi` as shown [here](https://github.com/prefix-dev/pixi/issues/3730), but found a workaround [here](https://github.com/prefix-dev/pixi/issues/3735).

---

_Label `bug` removed by @konstin on 2025-06-06 11:42_

---

_Label `question` added by @konstin on 2025-06-06 11:42_

---
