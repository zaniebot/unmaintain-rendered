---
number: 6425
title: "Feature Request: Constraints for generating first `uv.lock` when migrating"
type: issue
state: closed
author: mrcljx
labels:
  - question
assignees: []
created_at: 2024-08-22T12:06:11Z
updated_at: 2024-08-22T23:25:10Z
url: https://github.com/astral-sh/uv/issues/6425
synced_at: 2026-01-07T12:31:14-06:00
---

# Feature Request: Constraints for generating first `uv.lock` when migrating

---

_Issue opened by @mrcljx on 2024-08-22 12:06_

When migrating from Poetry (or other solutions) I want to ensure that the generated `uv.lock` does not accidentally upgrade any packages.

The [docs](https://docs.astral.sh/uv/concepts/resolution/#dependency-preferences) say:

> If resolution output file exists, i.e. a uv lockfile (`uv.lock`) or a requirements output file (`requirements.txt`), uv will _prefer_ the dependency versions listed there.

So what I assumed would work is:

1. Transform poetry dependencies (wrote a small script).
2. Export a `requirements.txt` from `poetry.lock` via `poetry export`.
3. Run `uv lock`

Sadly that didn't work (docs might be confusing here, I guess the latter just works with `uv pip`). I then assumed that maybe I can do:

```
uv lock --constraint requirements.txt
```

But that option does not exist.

What seems to have worked is to generate a fake `uv.lock` from my script, but I'm also not sure whether that *really* worked: I get a log statement that the lockfile is ignored because `requires-dist` doesn't match (I'm not generating that one).

It would be great if I could somehow provide constraints to `uv lock`. Or am I'm overlooking some existing feature?

---

_Comment by @charliermarsh on 2024-08-22 12:33_

I think you could take the output of that `requirements.txt`, and add it to the `pyproject.toml` under `constraint-dependencies`

```toml
[project]
name = "foo"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = ["anyio"]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.uv]
constraint-dependencies = [
    "anyio==3"
]
```

Then run `uv lock`. Then remove the `constraint-dependencies` and run `uv lock` again, and it should preserve the versions to the extent that it can.


---

_Label `question` added by @charliermarsh on 2024-08-22 12:33_

---

_Comment by @zanieb on 2024-08-22 15:48_

Feel free to open again if that's not working for you.

---

_Closed by @zanieb on 2024-08-22 15:48_

---

_Referenced in [astral-sh/uv#5605](../../astral-sh/uv/issues/5605.md) on 2024-08-22 15:49_

---

_Comment by @mrcljx on 2024-08-22 23:24_

Worked like a charm. ğŸ‘ 

---

_Comment by @charliermarsh on 2024-08-22 23:25_

That's awesome.

---

_Referenced in [astral-sh/uv#1804](../../astral-sh/uv/issues/1804.md) on 2024-08-23 15:27_

---
