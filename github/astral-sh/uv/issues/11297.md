---
number: 11297
title: Install packages system wide with sudo on Google Cloud Compute Engine
type: issue
state: closed
author: Noobzik
labels:
  - question
assignees: []
created_at: 2025-02-06T21:02:13Z
updated_at: 2025-02-13T20:13:58Z
url: https://github.com/astral-sh/uv/issues/11297
synced_at: 2026-01-07T12:31:15-06:00
---

# Install packages system wide with sudo on Google Cloud Compute Engine

---

_Issue opened by @Noobzik on 2025-02-06 21:02_

### Question

I have a use case about installing MLFlow system wide into a GCP Cloud Engine instance.
So for my command where ; 
```
sudo apt update && sudo apt install python3-pip -y
sudo pip3 install mlflow google-cloud-storage --break-system-packages
``` 

So I have tried with UV
``` 
curl -LsSf https://astral.sh/uv/install.sh | sh
source $HOME/.local/bin/env
uv pip install mlflow google-cloud-storage --system
``` 

I have the following error : 
``` 
To install Python packages system-wide, try apt install
  python3-xyz, where xyz is the package you are trying to
  install.

  If you wish to install a non-Debian-packaged Python package,
  create a virtual environment using python3 -m venv path/to/venv.
  Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
  sure you have python3-full installed.

  If you wish to install a non-Debian packaged Python application,
  it may be easiest to use pipx install xyz, which will manage a
  virtual environment for you. Make sure you have pipx installed.

  See /usr/share/doc/python3.11/README.venv for more information.
``` 

Okay let's try with 

``` 
uv pip install mlflow google-cloud-storage --break-system-packages --system

Using Python 3.11.2 environment at: /usr
Resolved 74 packages in 871ms
      Built sqlalchemy==2.0.38
Prepared 74 packages in 30.65s
error: Failed to install: idna-3.10-py3-none-any.whl (idna==3.10)
  Caused by: failed to create directory `/usr/local/lib/python3.11/dist-packages/idna`: Permission denied (os error 13)
``` 

It works ! But can't get past Permission denied.

Any tips how to get past that ?
UV is not available in sudo, even running the uv install command with sudo

### Platform

_No response_

### Version

_No response_

---

_Label `question` added by @Noobzik on 2025-02-06 21:02_

---

_Comment by @zanieb on 2025-02-06 21:05_

See https://superuser.com/questions/927512/how-to-set-path-for-sudo-commands 

Basically `sudo $(which uv) pip install ...` should work

---

_Comment by @geofft on 2025-02-06 23:12_

BTW - why do you want to install it systemwide? The trouble with doing it systemwide (and the reason you have to say `--break-system-packages`) is that the things you're installing may have dependencies that conflict with Python code that's part of the operating system.

Can you just create a venv and install into it? e.g. something like this:
```
uv venv
source .venv/bin/activate
uv pip install mlflow google-cloud-storage
```

Should have basically the same effect in practice - I'm curious if there's something that installing it systemwide does that this doesn't do.

---

_Comment by @Noobzik on 2025-02-10 19:53_

I wanted to create an mlflow service via Systemctl, so I don't have make it launch from a bash terminal 

So in order to do this (lets suppose MLFlow is installed system wide) all I had to do is : 
``` 
sudo nano /etc/systemd/system/mlflow.service
``` 

Paste this content 

``` 
[Unit]
Description=MLflow
After=network.target 

[Service]
Restart=on-failure
RestartSec=30
ExecStart=mlflow server --default-artifact-root gs://<gcs_bucket_name_here>/mlflow --backend-store-uri sqlite:///mlflow.db --host 0.0.0.0 --port 80

[Install]
WantedBy=multi-user.target
``` 
Followed by 

``` 
sudo systemctl daemon-reload
sudo systemctl enable mlflow
``` 

And let's start MLFlow
``` 
sudo systemctl start mlflow
``` 

With this configuration, I can restart my VM without having to start the service again from the ssh terminal.
Note : I am in a CI/CD environment, in the documentation I have followed this instruction : https://docs.astral.sh/uv/reference/settings/#pip_system
 

---

_Comment by @zanieb on 2025-02-10 20:04_

I think you'd just change the `ExecStart` to use the full path to the `mlflow` executable in a virtual environment.

---

_Comment by @Noobzik on 2025-02-13 20:13_

Thank you for the tip, I really felt dumb about it

Just for future reference if anyone lands here poking around uv with CI/CD environment on Compute Engine: 
``` 
which mlflow
(rakib_hernandez) rakib_hernandez@mlflow:~$ which mlflow
/home/rakib_hernandez/.venv/bin/mlflow
``` 

At the `/etc/systemd/system/mlflow.service `
```
[Unit]
Description=MLflow
After=network.target 

[Service]
Restart=on-failure
RestartSec=30
ExecStart=/home/rakib_hernandez/.venv/bin/mlflow server --default-artifact-root gs://<gcs_bucket_name_here>/mlflow --backend-store-uri sqlite:///mlflow.db --host 0.0.0.0 --port 80

[Install]
WantedBy=multi-user.target
``` 

---

_Closed by @Noobzik on 2025-02-13 20:13_

---
