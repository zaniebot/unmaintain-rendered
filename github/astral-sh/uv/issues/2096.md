---
number: 2096
title: Support PyPy
type: issue
state: closed
author: charliermarsh
labels:
  - wish
  - pypy
assignees: []
created_at: 2024-02-29T20:58:42Z
updated_at: 2025-06-16T15:24:41Z
url: https://github.com/astral-sh/uv/issues/2096
synced_at: 2026-01-07T12:31:14-06:00
---

# Support PyPy

---

_Issue opened by @charliermarsh on 2024-02-29 20:58_

Right now, `uv` does not officially support PyPy. It might work, and we've done a few things to enable it, like:

- https://github.com/astral-sh/uv/pull/1028
- https://github.com/astral-sh/uv/pull/1785
- https://github.com/astral-sh/uv/pull/2094

But we're likely missing a bunch of stuff, like:

- https://github.com/astral-sh/uv/issues/2095
- https://github.com/astral-sh/uv/issues/2092
- https://github.com/astral-sh/uv/issues/2490


---

_Label `wish` added by @charliermarsh on 2024-02-29 20:58_

---

_Label `pypy` added by @charliermarsh on 2024-02-29 20:58_

---

_Comment by @charliermarsh on 2024-02-29 20:59_

Not prioritizing this immediately, but it should happen, and I'd welcome contributors and PRs around it.

---

_Label `good first issue` added by @konstin on 2024-03-01 10:54_

---

_Referenced in [python/typing_extensions#348](../../python/typing_extensions/pulls/348.md) on 2024-03-04 06:31_

---

_Referenced in [astral-sh/uv#1636](../../astral-sh/uv/issues/1636.md) on 2024-03-05 07:33_

---

_Referenced in [pypa/build#751](../../pypa/build/pulls/751.md) on 2024-03-06 15:49_

---

_Referenced in [astral-sh/uv#1802](../../astral-sh/uv/issues/1802.md) on 2024-03-07 21:54_

---

_Referenced in [astral-sh/uv#2490](../../astral-sh/uv/issues/2490.md) on 2024-03-16 17:48_

---

_Comment by @wimglenn on 2024-03-18 01:43_

Might be a helpful data-point here - uv seems to select a wheel which it shouldn't when running with PyPy.

```
$ uv --version 
uv 0.1.21 (e9c12c52f 2024-03-14)
$ python3 -VV
Python 3.10.13 (fc59e61cfbff, Jan 15 2024, 14:31:34)
[PyPy 7.3.15 with GCC Apple LLVM 15.0.0 (clang-1500.1.0.2.5)]
```

Example reproducer:

```
$ cat reqs.in 
psycopg2-binary; implementation_name == 'cpython'
psycopg2; implementation_name != 'cpython'
$ uv pip compile reqs.in -v
DEBUG Starting interpreter discovery for active Python
DEBUG Found a virtualenv through VIRTUAL_ENV at: /private/tmp/p/.venv
DEBUG Probing interpreter info for: /private/tmp/p/.venv/bin/python
DEBUG Found Python 3.10.13 for: /private/tmp/p/.venv/bin/python
DEBUG Using Python 3.10.13 interpreter at /private/tmp/p/.venv/bin/python for builds
DEBUG Using registry request timeout of 300s
DEBUG Solving with target Python version 3.10.13
DEBUG Adding direct dependency: psycopg2*
DEBUG No cache entry for: https://pypi.org/simple/psycopg2/
DEBUG No credentials found for: https://pypi.org/simple/psycopg2/
DEBUG Searching for a compatible version of psycopg2 (*)
DEBUG Selecting: psycopg2==2.9.9 (psycopg2-2.9.9-cp310-cp310-win32.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/a2/14/2767d963915f957c07f5d4c3d9c5c9a407415289f5cde90b82cb3e8c2a12/psycopg2-2.9.9-cp310-cp310-win32.whl.metadata
DEBUG No credentials found for: https://files.pythonhosted.org/packages/a2/14/2767d963915f957c07f5d4c3d9c5c9a407415289f5cde90b82cb3e8c2a12/psycopg2-2.9.9-cp310-cp310-win32.whl.metadata
Resolved 1 package in 370ms
# This file was autogenerated by uv via the following command:
#    uv pip compile reqs.in
psycopg2==2.9.9
```

This wheel is unsupported (CPython, windows) and pip (pypy, macOS) would not consider it:

```
$ pip install https://files.pythonhosted.org/packages/a2/14/2767d963915f957c07f5d4c3d9c5c9a407415289f5cde90b82cb3e8c2a12/psycopg2-2.9.9-cp310-cp310-win32.whl
ERROR: psycopg2-2.9.9-cp310-cp310-win32.whl is not a supported wheel on this platform.
```

---

_Comment by @charliermarsh on 2024-03-18 01:44_

Can you just confirm that the Python in your virtualenv there is PyPy too?

---

_Comment by @wimglenn on 2024-03-18 01:51_

Yes, it is:

```
$ ls -l .venv/bin 
total 48248
-rw-r--r--  1 wim  wheel      9033 Mar 17 20:25 Activate.ps1
-rw-r--r--  1 wim  wheel      1989 Mar 17 20:25 activate
-rw-r--r--  1 wim  wheel       915 Mar 17 20:25 activate.csh
-rw-r--r--  1 wim  wheel      2195 Mar 17 20:25 activate.fish
-rwxr-xr-x  1 wim  wheel       235 Mar 17 20:33 pip
-rwxr-xr-x  1 wim  wheel       235 Mar 17 20:33 pip3
-rwxr-xr-x  1 wim  wheel       235 Mar 17 20:33 pip3.10
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 pypy -> pypy3
lrwxr-xr-x  1 wim  wheel        20 Mar 17 20:25 pypy3 -> /usr/local/bin/pypy3
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 python -> pypy3
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 python3 -> pypy3
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 python3.10 -> pypy3
-rwxr-xr-x  1 wim  wheel  24665448 Mar 17 20:26 uv
```

I created it with `/usr/local/bin/pypy3 -m venv .venv` and activated it, then installed uv within env.


---

_Comment by @charliermarsh on 2024-03-18 02:01_

Thanks!

---

_Comment by @charliermarsh on 2024-03-18 02:04_

Oh sorry, to be clear, we let the resolver use incompatible wheels during resolution for the purpose of fetching metadata. So this is fine and intended. The only problem would be if we then _installed_ that wheel with `pip sync` or `pip install`.

---

_Comment by @wimglenn on 2024-03-18 02:15_

Hmm, _is_ that really fine? As far as I'm aware, there's no promise that the dependencies specified in the wheel metadata are correct for other environments. It should possible, at least in theory, for `mypkg-1.2.3-cp310-cp310-win32.whl` to have different dependencies than a `pp310-none-any` tagged wheel, or even a `mypkg-1.2.3.tar.gz`.

---

_Comment by @charliermarsh on 2024-03-18 02:22_

It's an assumption we make in dependency resolution. Poetry and other tools make the same assumption. It's not standardized or guaranteed. There's discussion around it here: https://discuss.python.org/t/lock-files-again-but-this-time-w-sdists/46593/274. There's also some data on it here: https://discuss.python.org/t/insights-into-how-poetry-lock-works-cross-platform/17846/23. At least on PyPI, there are about 700 (out of 523,405) that ship with wheels with different metadata.


---

_Comment by @ofek on 2024-03-18 02:31_

Would it be sufficiently complex to assume that each wheel has different metadata?

---

_Comment by @charliermarsh on 2024-03-18 02:36_

Not really. It's just an optimization.

---

_Comment by @wimglenn on 2024-03-18 02:42_

Those discuss links are very informative, thanks.

---

_Comment by @charliermarsh on 2024-03-18 02:43_

(If anyone's looking to continue discussing the wheel metadata usage, I humbly request that we do so in a new issue.)

---

_Comment by @olliemath on 2024-08-16 09:59_

I noticed that this seems to work pretty well now (I recently installed a large project with >150 requirements under pypy) - what's left to do on this front? Or is it mostly about battle testing various edge cases (e.g. the metadata mismatch)?

---

_Label `good first issue` removed by @charliermarsh on 2024-08-16 12:32_

---

_Comment by @charliermarsh on 2024-08-16 12:33_

We might be missing some edge cases around the exact virtualenv executables that are created on various platforms, but I think this is good enough that we can close it, and follow-up on any remaining issues separately as they come up.

---

_Closed by @charliermarsh on 2024-08-16 12:33_

---

_Comment by @charliermarsh on 2024-08-16 12:33_

(I consider PyPy supported.)

---

_Referenced in [ua-parser/uap-python#102](../../ua-parser/uap-python/issues/102.md) on 2025-01-01 10:36_

---

_Comment by @michealroberts on 2025-05-23 06:50_

This is great.

Sorry to be that dumb monkey, but are there any usage guides on how to use pypy with uv, can we just use:

```
uv run pypy ...
```

as a drop in replacement for

```
uv run python
```

Or am I over simplifying things ...

---

_Comment by @hugovk on 2025-05-23 07:54_

You can use `--python` to say which Python yo use:

```sh
uv run --python pypy3 myscript.py
```

https://docs.astral.sh/uv/guides/scripts/#using-different-python-versions

---

_Comment by @michealroberts on 2025-05-23 09:47_

@hugovk Cool, and we would install pypy3 with uv or ... into the .venv ... ?

---

_Comment by @hugovk on 2025-05-23 11:10_

You don't need to worry about it: if you don't already have pypy3 installed, uv will fetch it for you and just use it :)

---

_Comment by @michealroberts on 2025-05-23 11:14_

Magic ðŸª„ thanks @hugovk Hugo.

---

_Comment by @michealroberts on 2025-06-12 15:42_

Note to future me that Google's this in 3-6 months time ... PyPy is only supported up to version 3.11.1. ðŸ˜­ 

---

_Comment by @michealroberts on 2025-06-12 15:50_

@hugovk Would you happen to know the steps to use JIT enabled Python with uv? Would this:

```python
PYTHON_JIT=1 uv run python bases/observatory/lraq/core.py
``` 

or this

```python
uv run python -X jit=1 bases/observatory/lraq/core.py
```

Just "work" ?

---

_Comment by @hugovk on 2025-06-13 09:11_

I've not tried it, let's ask @zanieb.

---

_Comment by @konstin on 2025-06-13 10:18_

uv spawns a python subprocess, so all env vars and python args should work just like the do with regular python. Note that by default we're running astral's Python distributions (https://github.com/astral-sh/python-build-standalone), so you may need to check https://gregoryszorc.com/docs/python-build-standalone/main/quirks.html.

---

_Comment by @zanieb on 2025-06-13 13:35_

Yes since https://github.com/astral-sh/python-build-standalone/pull/538 `PYTHON_JIT=1` should work. We should take further questions out of this thread, as this is about PyPy support.

---

_Comment by @michealroberts on 2025-06-16 15:24_

Agree, thanks @zanieb.

---

_Referenced in [ua-parser/uap-python#272](../../ua-parser/uap-python/issues/272.md) on 2025-08-02 10:33_

---

_Referenced in [python/pyperformance#425](../../python/pyperformance/pulls/425.md) on 2025-10-26 09:49_

---
