---
number: 12576
title: "Cannot install package from \"flat\" index"
type: issue
state: closed
author: luh-t-to
labels:
  - bug
assignees: []
created_at: 2025-03-31T06:52:36Z
updated_at: 2025-03-31T13:22:37Z
url: https://github.com/astral-sh/uv/issues/12576
synced_at: 2026-01-07T12:31:15-06:00
---

# Cannot install package from "flat" index

---

_Issue opened by @luh-t-to on 2025-03-31 06:52_

### Summary

Hey guys,
thanks for including the feature to add dependencies from "flat" indexes.
I did however run into an issue with installing the "kaldifeat" package from the following index: https://csukuangfj.github.io/kaldifeat/cpu.html

Here's the command that was used: `uv add kaldifeat --verbose`.

And here's the output:

```shell
uv add kaldifeat --verbose                                                                               
DEBUG uv 0.6.11
DEBUG Found project root: `/home/luhtto/asl/tools/flat_indexes`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/home/luhtto/asl/tools/flat_indexes`
DEBUG Reading Python requests from version file at `/home/luhtto/asl/tools/flat_indexes/.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment's Python version satisfies `3.12`
DEBUG Released lock at `/tmp/uv-056db868502cc209.lock`
DEBUG Using request timeout of 30s
Ignoring existing lockfile due to change in pre-release mode: `if-necessary-or-explicit` vs. `allow`
DEBUG Found static `pyproject.toml` for: flat-indexes-test @ file:///home/luhtto/asl/tools/flat_indexes
DEBUG No workspace root found, using project root
DEBUG Solving with installed Python version: 3.12.3
DEBUG Solving with target Python version: >=3.12
DEBUG Adding direct dependency: flat-indexes-test*
DEBUG Searching for a compatible version of flat-indexes-test @ file:///home/luhtto/asl/tools/flat_indexes (*)
DEBUG Adding direct dependency: kaldifeat*
DEBUG Adding direct dependency: torch>=2.6.0
DEBUG Adding direct dependency: torchaudio>=2.6.0
DEBUG No cache entry for: https://csukuangfj.github.io/kaldifeat/cpu.html/kaldifeat/
DEBUG No cache entry for: https://download.pytorch.org/whl/cpu/torch/
DEBUG No cache entry for: https://download.pytorch.org/whl/cpu/torchaudio/
DEBUG Checking netrc for credentials for https://csukuangfj.github.io/kaldifeat/cpu.html/kaldifeat/
DEBUG Searching for a compatible version of kaldifeat (*)
DEBUG No compatible version found for: kaldifeat
DEBUG Recording unit propagation conflict of kaldifeat from incompatibility of (flat-indexes-test)
DEBUG Searching for a compatible version of flat-indexes-test @ file:///home/luhtto/asl/tools/flat_indexes (<0.1.0 | >0.1.0)
DEBUG No compatible version found for: flat-indexes-test
DEBUG Reverting changes to `pyproject.toml`
DEBUG Reverting changes to `uv.lock`
  × No solution found when resolving dependencies:
  ╰─▶ Because kaldifeat was not found in the package registry and your project depends on kaldifeat, we can conclude that your
      project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and
        syncing.
```
I guess the problem is, that the package name is appended to the index URL, no?
Did I do something wrong in the configuration in `pyproject.toml`?

Here's the `pyproject.toml` config:

```toml
[project]
name = "flat-indexes-test"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = [
    "torch>=2.6.0",
    "torchaudio>=2.6.0",
]

[[tool.uv.index]]
name = "pytorch-cpu"
url = "https://download.pytorch.org/whl/cpu"
explicit = true

[tool.uv.sources]
torch = [
  { index = "pytorch-cpu" },
]
torchaudio = [
  { index = "pytorch-cpu" },
]
kaldifeat = [
  { index = "kaldifeat-cpu" },
]

[[tool.uv.index]]
name = "kaldifeat-cpu"
url = "https://csukuangfj.github.io/kaldifeat/cpu.html"
kind = "flat"
explicit = true

[tool.uv]
prerelease = "allow"
```

The `.python-version` is set to `3.12`.

Using `uv pip install" works though:

```shell
uv pip install --find-links https://csukuangfj.github.io/kaldifeat/cpu.html kaldifeat --prerelease allow --verbose --no-cach
e --force-reinstall
DEBUG uv 0.6.11
DEBUG Searching for default Python interpreter in virtual environments
DEBUG Found `cpython-3.12.3-linux-x86_64-gnu` at `/home/luhtto/asl/tools/flat_indexes/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.12.3 environment at: .venv
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG No cache entry for: https://csukuangfj.github.io/kaldifeat/cpu.html
DEBUG Found 2403 packages in `--find-links` entry: https://csukuangfj.github.io/kaldifeat/cpu.html
DEBUG Solving with installed Python version: 3.12.3
DEBUG Solving with target Python version: >=3.12.3
DEBUG Adding direct dependency: kaldifeat*
DEBUG No cache entry for: https://pypi.org/simple/kaldifeat/
DEBUG Searching for a compatible version of kaldifeat (*)
DEBUG Selecting: kaldifeat==1.25.5.dev20250307+cpu.torch2.6.0 [compatible] (kaldifeat-1.25.5.dev20250307+cpu.torch2.6.0-cp312-cp312-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl)
DEBUG No cache entry for: https://huggingface.co/csukuangfj/kaldifeat/resolve/main/cpu/1.25.5.dev20250307/linux-x64/kaldifeat-1.25.5.dev20250307+cpu.torch2.6.0-cp312-cp312-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl
DEBUG Tried 1 versions: kaldifeat 1
DEBUG marker environment resolution took 1.109s
Resolved 1 package in 1.11s
DEBUG Must revalidate requirement: kaldifeat
DEBUG No cache entry for: https://huggingface.co/csukuangfj/kaldifeat/resolve/main/cpu/1.25.5.dev20250307/linux-x64/kaldifeat-1.25.5.dev20250307+cpu.torch2.6.0-cp312-cp312-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl
Prepared 1 package in 417ms
DEBUG Uninstalled kaldifeat (37 files, 9 directories)
Uninstalled 1 package in 1ms
Installed 1 package in 46ms
 ~ kaldifeat==1.25.5.dev20250307+cpu.torch2.6.0
DEBUG Released lock at `/home/luhtto/asl/tools/flat_indexes/.venv/.lock`
```



### Platform

Ubuntu 24.04.2 LTS (WSL2)

### Version

uv 0.6.11

### Python version

Python 3.12.3

---

_Label `bug` added by @luh-t-to on 2025-03-31 06:52_

---

_Comment by @charliermarsh on 2025-03-31 13:12_

Did you try `uv add kaldifeat --index=https://csukuangfj.github.io/kaldifeat/cpu.html`?

---

_Comment by @luh-t-to on 2025-03-31 13:15_

I have not. But it does not work either.

```shell
DEBUG uv 0.6.11
DEBUG Found project root: `/home/luhtto/asl/tools/flat_indexes`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/home/luhtto/asl/tools/flat_indexes`
DEBUG Reading Python requests from version file at `/home/luhtto/asl/tools/flat_indexes/.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment's Python version satisfies `3.12`
DEBUG Released lock at `/tmp/uv-056db868502cc209.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: flat-indexes-test @ file:///home/luhtto/asl/tools/flat_indexes
DEBUG No workspace root found, using project root
DEBUG Solving with installed Python version: 3.12.3
DEBUG Solving with target Python version: >=3.12
DEBUG Adding direct dependency: flat-indexes-test*
DEBUG Searching for a compatible version of flat-indexes-test @ file:///home/luhtto/asl/tools/flat_indexes (*)
DEBUG Adding direct dependency: kaldifeat*
DEBUG Adding direct dependency: torch>=2.6.0
DEBUG Adding direct dependency: torchaudio>=2.6.0
DEBUG No cache entry for: https://csukuangfj.github.io/kaldifeat/cpu.html/kaldifeat/
DEBUG No cache entry for: https://download.pytorch.org/whl/cpu/torch/
DEBUG No cache entry for: https://download.pytorch.org/whl/cpu/torchaudio/
DEBUG Checking netrc for credentials for https://csukuangfj.github.io/kaldifeat/cpu.html/kaldifeat/
DEBUG Searching for a compatible version of kaldifeat (*)
DEBUG No compatible version found for: kaldifeat
DEBUG Recording unit propagation conflict of kaldifeat from incompatibility of (flat-indexes-test)
DEBUG Searching for a compatible version of flat-indexes-test @ file:///home/luhtto/asl/tools/flat_indexes (<0.1.0 | >0.1.0)
DEBUG No compatible version found for: flat-indexes-test
DEBUG Reverting changes to `pyproject.toml`
DEBUG Removing `uv.lock`
  × No solution found when resolving dependencies:
  ╰─▶ Because kaldifeat was not found in the package registry and your project depends on kaldifeat, we can conclude that your
      project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and
        syncing.
```

Here is this line again: `DEBUG No cache entry for: https://csukuangfj.github.io/kaldifeat/cpu.html/kaldifeat/`

And that URL throws a 404.

---

_Comment by @charliermarsh on 2025-03-31 13:18_

Oh wait, `kind = "flat"` should be `format = "flat"`

---

_Comment by @charliermarsh on 2025-03-31 13:18_

I assume I missed a reference to that in the docs somewhere?

---

_Comment by @luh-t-to on 2025-03-31 13:20_

That works! Wonderful, thank you very much.

I got it from the [docs](https://docs.astral.sh/uv/configuration/indexes/#flat-indexes)

---

_Referenced in [astral-sh/uv#12583](../../astral-sh/uv/pulls/12583.md) on 2025-03-31 13:22_

---

_Comment by @charliermarsh on 2025-03-31 13:22_

Fixed in https://github.com/astral-sh/uv/pull/12583, so sorry.

---

_Assigned to @charliermarsh by @charliermarsh on 2025-03-31 13:22_

---

_Closed by @charliermarsh on 2025-03-31 13:22_

---

_Closed by @charliermarsh on 2025-03-31 13:22_

---
