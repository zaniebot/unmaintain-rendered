---
number: 11855
title: "Add \"current platform\" to `required-environments` by default"
type: issue
state: open
author: jonaslb
labels:
  - enhancement
assignees: []
created_at: 2025-02-28T14:15:08Z
updated_at: 2025-02-28T14:57:58Z
url: https://github.com/astral-sh/uv/issues/11855
synced_at: 2026-01-07T12:31:15-06:00
---

# Add "current platform" to `required-environments` by default

---

_Issue opened by @jonaslb on 2025-02-28 14:15_

### Summary

Related to #9412 / #9711, I was made aware of the new `required-environments` feature, which looks great. Especially it makes sense for "deployed projects" where you know the intended destination platform, and obviously the lock must be compatible there.

The issue I'm facing is that even if you don't have a single intended prod platform, you still have an implied required environment: The environment you're developing on. This means you'll need to add boilerplate in every pyproject file. And it gets more complicated when the project developers are on multiple platforms or if the project is a library without a single intended destination platform.

So, I would like to propose that `uv` by default adds the "current platform" to `required-environments` when locking. Or perhaps, as a step one, only does so if `required-environments` is unset. I don't know if that would be considered a breaking change, I guess it would, but it would make it nicer to use `uv` without needing too much copy-pasta boilerplate :)

### Example

_No response_

---

_Label `enhancement` added by @jonaslb on 2025-02-28 14:15_

---

_Comment by @charliermarsh on 2025-02-28 14:21_

This makes sense intuitively though I'm hesitant to add behavior to the locking process that would vary from machine to machine. Today, `uv lock` operates in exactly the same way regardless of the user's current platform, and that's a really, really useful property.

---

_Comment by @konstin on 2025-02-28 14:43_

If we would take the current platform into account, with colleagues working on different platform, them running `uv sync` could cause a re-lock and a lockfile change, without any requirements change. We found that in most cases, the default support all platforms that users care about, or put the other way round: The cases where projects are making releases with neither a source distribution and nor wheels for common platforms that existed in earlier releases are rare enough that we didn't make that the default. 

Since you are having such a case with the ecmwf libraries, we provide `required-environments` so you can manually specify the platforms you require around those libraries.

---

_Comment by @jonaslb on 2025-02-28 14:57_

I think that's a fair prioritization considering the relative rarity of the issue at hand, and yes we can make workarounds and manually specify `required-environments` for that. 

However, I do still think that "the right thing", hypothetically and regardless how unreachable/large effort it might seem right now, is either something like my proposal here or doing it for all platforms at once, like what was worked on in #9928. This would eliminate those last corner cases like what I had here permanently, without workarounds needed.

---
