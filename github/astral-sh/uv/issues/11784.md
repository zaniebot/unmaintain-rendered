---
number: 11784
title: Weird interaction of --resolution highest with uv.lock
type: issue
state: closed
author: dimaqq
labels:
  - question
assignees: []
created_at: 2025-02-26T00:13:16Z
updated_at: 2025-03-05T19:02:12Z
url: https://github.com/astral-sh/uv/issues/11784
synced_at: 2026-01-07T12:31:15-06:00
---

# Weird interaction of --resolution highest with uv.lock

---

_Issue opened by @dimaqq on 2025-02-26 00:13_

### Question

`otlp-test-data==0.9.4` was the latest when I locked my app.

My pyproject.toml specified `>= 0.9.4`.

Since then, `otlp-test-data==0.10.0` was released.

Somehow, `uv sync --all-groups --resolution highest` and `uv sync --all-groups --resolution highest --no-cache` would not upgrade the virtualenv to 0.10.0.

In the end, `rm uv.lock; uv sync ...` did the trick.

I'm curious why. Do I misunderstand locking or the resolution strategy?

pyproject snippet for reference:

```toml
[dependency-groups]
dev = [
    "maturin ~= 1.8",
    "opentelemetry-api ~= 1.30",  # 1.30 fixed type hints for Python 3.8
    "pyright ~= 1.1",
    "ruff ~= 0.9",
]
testing = [
    "pytest ~= 8.3.4",
    "otlp-test-data >= 0.9.4",
]
```

### Platform

macos

### Version

uv 0.6.3 (Homebrew 2025-02-24)

---

_Label `question` added by @dimaqq on 2025-02-26 00:13_

---

_Comment by @zanieb on 2025-02-26 00:26_

That's surprising â€” it sounds like a bug. Did any package versions change with `--resolution highest`?

---

_Label `question` removed by @zanieb on 2025-02-26 00:26_

---

_Label `bug` added by @zanieb on 2025-02-26 00:26_

---

_Comment by @zanieb on 2025-02-26 00:27_

Would you mind writing a minimal example using something a single small package like `anyio`?

---

_Comment by @dimaqq on 2025-02-26 00:29_

Other packages too seemed to have required removing the lock file:

I've tried "highest before" and uv seemed to keep versions as locked... or perhaps "as any version allowed in the lock file"?

Then when I whacked the lock file, my dep and one more dep were updated:

```command
(otlp-proto) ğŸ¦/c/otlp-proto (main)> rm uv.lock
(otlp-proto) ğŸ¦/c/otlp-proto (main)> uv sync --all-groups --resolution highest --no-cache
Resolved 39 packages in 509ms
Prepared 2 packages in 65ms
Uninstalled 2 packages in 8ms
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ [0/2] Installing wheels...                                                                                                                                                                                                                                                                                                                                                                           warning: Failed to clone files; falling back to full copy. This may lead to degraded performance.
         If the cache and target directories are on different filesystems, reflinking may not be supported.
         If this is intentional, set `export UV_LINK_MODE=copy` or use `--link-mode=copy` to suppress this warning.
Installed 2 packages in 33ms
 - googleapis-common-protos==1.67.0
 + googleapis-common-protos==1.68.0
 - otlp-test-data==0.9.4
 + otlp-test-data==0.10.0
```

---

_Comment by @dimaqq on 2025-02-26 00:33_

Re: making a MRE, I feel that would require me to cook up a lock file by hand, wouldn't it?

Instead, I could perhaps pull a lock from from some small project history... wdyt?

---

_Comment by @zanieb on 2025-02-26 00:44_

```
â¯ uv init example
Initialized project `example` at `/Users/zb/workspace/uv/example`
â¯ cd example
â¯ uv add anyio==4.7.0
Using CPython 3.13.0
Creating virtual environment at: .venv
Resolved 4 packages in 181ms
Prepared 1 package in 118ms
Installed 3 packages in 5ms
 + anyio==4.7.0
 + idna==3.10
 + sniffio==1.3.1
â¯ uv add 'anyio>=4.7.0' --frozen
â¯ uv lock
Resolved 4 packages in 3ms
â¯ uv sync
Resolved 4 packages in 0.83ms
Audited 3 packages in 0.02ms
â¯ uv sync --resolution highest
Resolved 4 packages in 1ms
Audited 3 packages in 0.03ms
â¯ uv sync --resolution highest --upgrade-package anyio
Resolved 4 packages in 60ms
Prepared 1 package in 0.72ms
Uninstalled 1 package in 1ms
Installed 1 package in 2ms
 - anyio==4.7.0
 + anyio==4.8.0
```

---

_Comment by @zanieb on 2025-02-26 00:44_

cc @charliermarsh can you confirm if this is expected?

---

_Comment by @dimaqq on 2025-02-26 00:47_

Thank you @zanieb 

P.S. if someone needs a MRE, I've tagged the "problem state" in a smaller repo here:
https://github.com/dimaqq/otlp-json/tree/mre-uv-11784

---

_Comment by @charliermarsh on 2025-02-26 00:58_

That we prefer existing versions? I donâ€™t know if itâ€™s intentional.

---

_Comment by @zanieb on 2025-02-26 01:07_

Oh sorry, I've forgotten that "highest" is the default mode (https://docs.astral.sh/uv/reference/settings/#resolution)

We _will_ invalidate the lockfile if you change the resolution mode

```
â¯ uv sync --resolution lowest
Ignoring existing lockfile due to change in resolution mode: `highest` vs. `lowest`
Resolved 4 packages in 175ms
Prepared 2 packages in 90ms
Uninstalled 3 packages in 18ms
Installed 3 packages in 4ms
 - anyio==4.8.0
 + anyio==4.7.0
 - idna==3.10
 + idna==2.8
 - sniffio==1.3.1
 + sniffio==1.1.0
```

I think this actually is working as intended. The most we could do is warn? but it seems hard to get that right.



---

_Label `bug` removed by @zanieb on 2025-02-26 01:07_

---

_Label `question` added by @zanieb on 2025-02-26 01:07_

---

_Comment by @zanieb on 2025-02-26 01:08_

I think it's correct for us to prefer the lockfile versions, as that's the intent of the lockfile â€” an explicit upgrade request makes sense if that's what you're looking for.

---

_Comment by @dimaqq on 2025-03-03 05:49_

Indeed, I dunno what would be most expected.

It is a bit weird if the lock file is â€œsometimesâ€ invalidated and sometimes not.

Maybe the default should be â€œfrozenâ€?

---

_Comment by @dimaqq on 2025-03-05 05:43_

Maybe this would be best solved by a separate command like `yarn outdated`? ğŸ¤” 

---

_Comment by @zanieb on 2025-03-05 19:02_

> Maybe this would be best solved by a separate command like yarn outdated? ğŸ¤”

That exists as `uv tree --outdated`

> It is a bit weird if the lock file is â€œsometimesâ€ invalidated and sometimes not.

It's invalidated if it would change based on your settings. I don't think that should be surprising.

I don't think we'll change the default behavior to frozen and this specific feature is working as intended â€” going to close this as I don't think there's something actionable here.


---

_Closed by @zanieb on 2025-03-05 19:02_

---
