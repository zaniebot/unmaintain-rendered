---
number: 7862
title: requires-python specification not correctly resolved
type: issue
state: closed
author: Wietse
labels:
  - bug
assignees: []
created_at: 2024-10-02T09:29:08Z
updated_at: 2024-10-10T07:26:57Z
url: https://github.com/astral-sh/uv/issues/7862
synced_at: 2026-01-07T12:31:15-06:00
---

# requires-python specification not correctly resolved

---

_Issue opened by @Wietse on 2024-10-02 09:29_

Hello,

I'm having a problem specifying `requires-python`.

My environment:
MacOS M1
uv 0.4.16 (e81ed8ec5 2024-09-24)
python 3.12.6 (pyenv)

To reproduce:

```bash
uv init test-requires-python --lib --python 3.12.6 --python-preference only-system
cd test-requires-python
python -m venv .venv
. ./.venv/bin/activate
```

Open `pyproject.toml` and update the value for `requires-python`:
```
requires-python = ">=3.8,<3.13,!=3.9.7"
```

Next:
```
uv lock
```

This gives an error:
```
Using CPython 3.12.6
error: The Python request from `.python-version` resolved to Python 3.12.6, which is incompatible with the project's Python requirement: `>=3.8, <3.9.7, >3.9.7, <3.13`. However, a workspace member (`test-requires-python`) supports Python >=3.8, !=3.9.7, <3.13. To install the workspace member on its own, navigate to ``, then run `uv venv --python 3.12.6` followed by `uv pip install -e .`.
```

I would expect the version 3.12.6 to be according to the constraints.
See https://packaging.python.org/en/latest/specifications/version-specifiers/#id5 which states:
> The comma (“,”) is equivalent to a logical and operator: a candidate version must match all given version clauses in order to match the specifier as a whole.

But it seems that `uv` transforms `>=3.8,<3.13,!=3.9.7` to `>=3.8, <3.9.7, >3.9.7, <3.13`, which is not what is intended. OTOH, in a different code path, `uv` does recognize that  `3.12.6` is within the constraint of `>=3.8, !=3.9.7, <3.13`

Thanks for a great tool!
Wietse


---

_Comment by @Wietse on 2024-10-02 09:48_

I've upgraded uv to the latest `uv 0.4.18 (7b55e9790 2024-10-01)`, but the problem still exists.

---

_Comment by @zanieb on 2024-10-02 14:42_

This looks like a weird bug, thanks for the report.

---

_Label `bug` added by @zanieb on 2024-10-02 14:42_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-10-03 12:51_

---

_Comment by @charliermarsh on 2024-10-03 13:04_

The issue here is in the PubGrub conversion: we convert to a range with a hole, and when we convert back, that becomes `>3.9.7, <3.9.7`. Then `3.12.6` doesn't match, since those conditions are AND'd, and `3.12.6` is not less than `3.9.7`.

---

_Referenced in [astral-sh/uv#7897](../../astral-sh/uv/pulls/7897.md) on 2024-10-03 14:01_

---

_Closed by @charliermarsh on 2024-10-09 22:24_

---

_Closed by @charliermarsh on 2024-10-09 22:24_

---

_Comment by @Wietse on 2024-10-10 07:26_

Thanks for the fix!

---

_Referenced in [astral-sh/uv#8103](../../astral-sh/uv/issues/8103.md) on 2024-10-10 18:34_

---
