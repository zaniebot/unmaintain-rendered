---
number: 12003
title: uv cache prune removes binaries that are symlinked to
type: issue
state: open
author: eblade
labels:
  - error messages
  - needs-mre
assignees: []
created_at: 2025-03-06T13:13:48Z
updated_at: 2025-03-18T22:23:23Z
url: https://github.com/astral-sh/uv/issues/12003
synced_at: 2026-01-07T12:31:15-06:00
---

# uv cache prune removes binaries that are symlinked to

---

_Issue opened by @eblade on 2025-03-06 13:13_

### Summary

We used uv 0.5 previously and this problem did not occur there, so we had a `uv cache prune` at the end of the docker script to save some space (but we still wanted a small cache so we could sync the env on run later).

Now we have upgraded to uv 0.6.4 and cache prune is much more aggressive. We run with UV_LINK_MODE=symlink (also to save some space), which might be of interest.

The result is that the imports that point to .so binaries no longer resolve in python.

Anyway, thanks for this great piece of software!

### Platform

Linux 5.15.167.4-microsoft-standard-WSL2 x86_64 GNU/Linux

### Version

uv 0.6.4

### Python version

Python 3.12.3

---

_Label `bug` added by @eblade on 2025-03-06 13:13_

---

_Comment by @charliermarsh on 2025-03-06 15:13_

Unfortunately using `uv cache prune` (and `uv cache clean`) with `UV_LINK_MODE=symlink` is effectively unsupported. We should probably warn about this. They're sort of just inherently incompatible... If you're symlinking into the cache, we have no way of knowing what's in-use, and removing the source files breaks the symlinks (as you'd expect).

---

_Comment by @charliermarsh on 2025-03-06 15:55_

I think we should at least warn about this (and possibly do a more limited prune).

---

_Label `bug` removed by @charliermarsh on 2025-03-06 15:55_

---

_Label `error messages` added by @charliermarsh on 2025-03-06 15:55_

---

_Comment by @charliermarsh on 2025-03-06 16:27_

Actually, do you know exactly what's failing here? Like what it can't find? I'm trying to reproduce.

---

_Comment by @charliermarsh on 2025-03-06 16:27_

(Are you running `uv cache prune --ci`? Or `uv cache prune`?)

---

_Comment by @jezekra1 on 2025-03-07 16:11_

Hi, have you seen this issue by any chance? #11694

It's a bit unrelated but it's also about `uv cache prune` removing things it shouldn't :)

---

_Comment by @eblade on 2025-03-10 07:34_

I did try both with and without the --ci flag, but it does not seem to matter much. 

It seems like the files that it can't find are mostly .so files, the binary modules. So if you try something like numpy this would happen. If I reainstall the package from which it fails to import, it will start working and move on to the next one.

I'm starting to think that if I must choose, it makes more sense to do that pruning (with --ci) than the symlinking, so I should try that.

---

_Comment by @charliermarsh on 2025-03-18 22:23_

Can you give me a concrete example of the commands to run (and which package to use), and the error message you see? It's hard for me to help without being able to reproduce.

---

_Label `needs-mre` added by @charliermarsh on 2025-03-18 22:23_

---
