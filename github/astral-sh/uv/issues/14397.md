---
number: 14397
title: "Missing dependency with `uv pip compile` when constraints include `python_full_version`"
type: issue
state: closed
author: adamsol
labels:
  - question
assignees: []
created_at: 2025-07-01T14:59:04Z
updated_at: 2025-07-02T15:18:33Z
url: https://github.com/astral-sh/uv/issues/14397
synced_at: 2026-01-07T12:31:16-06:00
---

# Missing dependency with `uv pip compile` when constraints include `python_full_version`

---

_Issue opened by @adamsol on 2025-07-01 14:59_

### Question

A slightly unexpected behaviour occurs when one of the dependencies in `requirements.in` uses a `python_full_version` constraint.

For example, [redis-py](https://github.com/redis/redis-py/blob/master/pyproject.toml) has the following dependency:

```async-timeout>=4.0.3; python_full_version<"3.11.3"```

After running `uv pip compile requirements.in` with Python 3.11.3+ on the following file:

```
redis
```

we only get:

```
redis==6.2.0
    # via -r ../requirements.in
```

Since I'm preparing a requirements file for all Python 3.11+ environments, I'd expect `async-timeout` to also be included here.

It can be argued that the compiled file is correct for the current Python version, but the same happens even with `--universal`.

One solution I've found is to add `--python-version=3.11`, after which the missing dependency is included:

```
async-timeout==5.0.1
    # via redis
redis==6.2.0
    # via -r ../requirements.in
```

Shouldn't `uv pip compile` assume a `.0` patch version for current minor Python version by default?

### Platform

_No response_

### Version

uv 0.7.17 (41c218a89 2025-06-29)

---

_Label `question` added by @adamsol on 2025-07-01 14:59_

---

_Comment by @charliermarsh on 2025-07-02 00:49_

Hmm, I'm not sure... I mean, we assume that we're compiling for the given Python interpreter, which does _not_ have a patch version of `.0`. I could perhaps see an argument that if `--universal` is provided, we should resolve for a patch version of `.0` as you suggest, but it'd be good to hear another opinion on this (maybe from @konstin or @zanieb).


---

_Assigned to @charliermarsh by @charliermarsh on 2025-07-02 01:25_

---

_Referenced in [astral-sh/uv#14405](../../astral-sh/uv/pulls/14405.md) on 2025-07-02 01:59_

---

_Comment by @konstin on 2025-07-02 12:29_

When compiling with `--universal`, we still have to determine a value to consider the minimum version. As `requirements.in`, unlike `pyproject.toml`, don't have a `requires-python` field, we default to the current Python version. 

Fwiw, I would expect and highly recommend users to be on the latest patch version of a Python minor. Newer patch versions are highly compatible (they contain only critical fixes) and avoid issues such as the one that caused this bound (https://github.com/redis/redis-py/issues/2633#issuecomment-1481672064)

---

_Closed by @charliermarsh on 2025-07-02 15:11_

---

_Comment by @notatallshaw-gts on 2025-07-02 15:17_

And just to add to this, I would find that if `uv pip compile` _without_ universal didn't take the current patch version of Python that it would be a breaking change, as `uv pip compile` is modeled after `pip-compile` which uses the current Python installation to resolve.

---

_Comment by @charliermarsh on 2025-07-02 15:18_

Yeah that's intentionally _not_ implemented. Without universal, we resolve for the current interpreter (which includes its patch).

---
