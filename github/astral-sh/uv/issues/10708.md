---
number: 10708
title: How to work with OpenCV 4 different installation methods?
type: issue
state: open
author: kevinsimper
labels:
  - needs-mre
assignees: []
created_at: 2025-01-17T12:41:00Z
updated_at: 2025-04-28T10:12:23Z
url: https://github.com/astral-sh/uv/issues/10708
synced_at: 2026-01-07T12:31:15-06:00
---

# How to work with OpenCV 4 different installation methods?

---

_Issue opened by @kevinsimper on 2025-01-17 12:41_

Hi UV, really like the work âœŒï¸

We are using OpenCV and we use the `opencv-python-headless`

The docs are very explicit that you only install one of the packages and you can't have multiple since that gives problems.

https://github.com/opencv/opencv-python#installation-and-usage

Have anybody some tips and tricks on how to use it inside and outside containers while developing?

---

_Comment by @konstin on 2025-01-17 12:57_

Can you describe the specific problem you're encountering, e.g. which commands you run and what error message you get?

---

_Label `needs-mre` added by @charliermarsh on 2025-01-17 15:17_

---

_Comment by @kesitrifork on 2025-01-20 11:47_

Hi @konstin 

Yeah, the problem is that there is 2 groups:

> - Packages for standard desktop environments (Windows, macOS, almost any GNU/Linux distribution)
> - Packages for server (headless) environments (such as Docker, cloud environments etc.), no GUI library dependencies

For development we want to be able to run in the standard desktop environments.
For deployment we want to use the headless environments.

And opencv will complain about missing deps if you try to trigger a Gui for debugging, if you have the headless installed.
https://github.com/ultralytics/ultralytics/issues/1270#issuecomment-1695904298

And you can not have multiple installed, that also gives errors. https://github.com/ltdrdata/ComfyUI-Impact-Pack/issues/395

---

_Comment by @konstin on 2025-01-20 14:11_

Can you share a minimal reproducible examples as described in #9452? Without the commands as well as the logs and error messages you got we cannot diagnose the problem.

---

_Comment by @rknitrifork on 2025-01-21 12:37_

The commands used is:
uv run path/to/main.py

The error:
Import "cv2" could not be resolved

Traceback (most recent call last):
  File , line 4, in <module>
    from  import output
  File x
    import cv2
ModuleNotFoundError: No module named 'cv2'

pyproject dependencies:
dependencies = [
    "huggingface-hub>=0.27.0",
    "matplotlib>=3.10.0",
    "numpy>=2.2.1",
    "opencv-python-headless>=4.10.0.84",
    "pillow>=11.1.0",
    "pydantic>=2.10.4",
    "sam2>=1.1.0",
    "torch>=2.5.1",
    "torchvision>=0.20.1",
    "transformers>=4.48.0",
]

regardless of how we run it seems to continue with the same error.

i did discover a wierd fix. 
if i install opencv-python with
uv add opencv-python

then i am able to run it. and if just remove the change from the pyproject.toml it will not break the cloud build that requires headless

i hope this is sufficient reproduceable 


---

_Referenced in [astral-sh/uv#11806](../../astral-sh/uv/issues/11806.md) on 2025-02-26 17:53_

---

_Comment by @tomasgareau on 2025-04-23 20:49_

Chiming in real quick since I bumped into similar issues in having mixed `opencv-python` and `opencv-python-headless` in the same workspace. I was able to get my `venv` into a state where `uv` thought it was synced, but I was missing the `cv2` package.

This Dockerfile provides an MRE illustrating how I did so -- it might be a good starting point or playground for this issue so I thought I'd share.[^1] It may not be a perfect reflection of the original posters' issue though!

```dockerfile
FROM --platform=linux/amd64 ghcr.io/astral-sh/uv:0.6.16-debian-slim

# Install libgl1 deps so we don't get "failed to import libGL.so" errors, which
# aren't what we're trying to repro
RUN apt-get update -y && apt-get install -y --no-install-recommends \
		libgl1-mesa-glx \
		libglib2.0-0

## Create a workspace
COPY <<EOF /mre/pyproject.toml
[project]
name = "mre"
version = "0.1.0"
requires-python = ">=3.13"

[tool.uv.workspace]
members = []
EOF

WORKDIR /mre

## Add some --lib package with a dependency on opencv-python-headless
RUN uv init --lib packages/some-lib
RUN uv add --package some-lib "opencv-python-headless>=4.11.0.86"

## Add some example that imports cv2 to some-lib
COPY <<EOF /mre/packages/some-lib/src/some_lib/__init__.py
import cv2

def hello() -> str:
    return f"hello from some-lib! I imported cv2 version {cv2.__version__}"
EOF

## Add another package that depends on some-lib
RUN uv init --package apps/my-app
RUN uv add --package my-app some-lib
RUN uv add --package my-app --group dev pytest

## Create a test that uses cv2 via some_lib
COPY <<EOF /mre/apps/my-app/tests/test_my_app.py
from some_lib import hello

def test_hello_from_lib():
    print(hello())
EOF

## Run pytest in `my-app` to show that everything worked so far
#
# This demonstrates that we've successfully resolved the transitive dependency
# and that `sync`ing `my-app` does indeed pull in `cv2`
RUN cd /mre/apps/my-app && \
		uv sync && \
		uv run pytest && echo "pytest succeeds here: we pulled in the transitive opencv-python-headless dep"

## Create some other application that requires `opencv-python` (not headless)
#
# `uv` creates a single root .venv for the workspace we're in, so installing
# both opencv-python and opencv-python-headless will cause issues. 
RUN uv init --package apps/other-app
RUN uv add --package other-app "opencv-python>=4.11.0.86"

## Run pytest in `my-app` to demonstrate the failure from conflicting opencv
#
# When we ran `uv add ... opencv-python` above, uv added it to our root .venv
#
# I'm assuming this means it overwrote the existing `cv2` package that was
# formerly provided by `opencv-python-headless`.
#
# When we run `uv sync` in `my-app` here, `uv` will "remove" `opencv-python`, but
# it doesn't ensure that `opencv-python-headless` is reinstalled? In either
# case: uv thinks we're synced, but we can't `import cv2`
RUN cd /mre/apps/my-app && \
		uv sync && \
		uv run pytest || echo "pytest fails here: uv sync removed opencv-python -- fair enough"

## Replace `opencv-python` with `opencv-python-headless`
#
# The error above is fair enough: we shouldn't be mixing opencv-python-*** in
# one environment and uv workspaces have a root venv. So really, we shouldn't
# have both packages in the workspace. Let's say `other-app` can use other
# libraries for its GUI components and replace opencv-python with the headless
# variant.
#
# If we manually edit pyproject.toml like so, uv will just remove `opencv-python`
# (it won't re-add `opencv-python-headless`). Since `opencv-python` and
# `opencv-python-headless` provide the same package (i.e., `cv2`), this means
# we'll delete `cv2` without replacing it. Oops:
RUN sed -i 's/opencv-python/opencv-python-headless/g' /mre/apps/other-app/pyproject.toml
RUN uv lock


# Note that if instead of the above, you used `uv` to remove & add the dependencies:
#		```
# 	uv remove --package other-app opencv-python
# 	uv add --package other-app "opencv-python-headless>=4.11.0.86"
# 	```
# You _would_ be able to `import cv2` in the pytest run below. I'm assuming
# this is because `uv add` forces it to re-add the missing `cv2` package?


## Finally, try syncing my-app and running pytest again
#
# This fails again: I'm assuming `uv` can't determine that removing
# `opencv-python` had a side effect on the files provided by
# `opencv-python-headless` or something.
RUN cd /mre/apps/my-app && \
		uv sync && \
		uv run pytest || echo "pytest still doesn't succeed here"

## We can fully recreate the venv to fix this
RUN rm -rf /mre/.venv && \
		cd /mre/apps/my-app && \
		uv sync && \
		uv run pytest && echo "pytest succeeds now that we fully recreated the venv"
```

[^1]: Just to be clear -- I don't think my use case above is necessarily an issue with uv. I'm not looking to jump onto another issue for support ðŸ˜… No need to dive into the specifics of what I ran here if it's not relevant/useful: just thought the Dockerfile above might be a good starting point!

---

_Comment by @konstin on 2025-04-24 07:39_

Installing different opencv disitributions is indeed a problem, unfortunately I don't think there's a good solution on the uv side since packages are allowed to overwrite each other. 

---

_Comment by @robmarkcole on 2025-04-25 13:42_

I'm getting `Import "cv2" could not be resolved` even after just `uv add opencv-python`

---

_Comment by @konstin on 2025-04-25 13:45_

@robmarkcole Can you share a minimal reproducible example (https://github.com/astral-sh/uv/issues/9452) with all input files, commands, platform information and logs that reproduces your problem?

---

_Comment by @robmarkcole on 2025-04-25 13:58_

@konstin I created the example below, but it succeeds. The odd thing is that I also had no issue importing cv2 for a few runs, and then the import error appeared. Note this is using a notebook in vscode, so not sure if that could be a factor. I appreciate this is not reproducible simply. For reference, the flow below does succeed:

```md
# 1. Create and enter a fresh folder
mkdir uv-opencv-repro
cd uv-opencv-repro

# 2. Create pyproject.toml as above
echo '[project]
name = "uv-opencv-repro"
version = "0.1.0"
dependencies = ["opencv-python"]' > pyproject.toml

# Create venv
uv venv .venv
source .venv/bin/activate

# 4. Install dependencies with uv
uv pip install -r pyproject.toml

# 5. Create test script
echo 'import cv2
print(cv2.__version__)' > main.py

# 6. Run the script
python main.py
```

---

_Comment by @konstin on 2025-04-28 10:12_

Thanks for the script! Unfortunately, it always passes on my machine. Can you check that in VS Code, it uses the correct environment `print(sys.prefix)`? If the error occurs again, can you the contents of `.venv/lib/[platform dependent]/site-packages` and check if there is a `cv2` folder and what it contains?

---

_Referenced in [astral-sh/uv#13437](../../astral-sh/uv/pulls/13437.md) on 2025-05-13 20:55_

---

_Referenced in [astral-sh/uv#15357](../../astral-sh/uv/issues/15357.md) on 2025-08-18 16:36_

---
