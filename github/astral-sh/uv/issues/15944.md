---
number: 15944
title: "`uv build` fails to build local project when invoked by pex"
type: issue
state: closed
author: matthieucx
labels:
  - external
assignees: []
created_at: 2025-09-19T09:33:40Z
updated_at: 2025-09-19T12:54:46Z
url: https://github.com/astral-sh/uv/issues/15944
synced_at: 2026-01-07T12:31:16-06:00
---

# `uv build` fails to build local project when invoked by pex

---

_Issue opened by @matthieucx on 2025-09-19 09:33_

### Summary

Hello!

I am trying to package my project and its dependencies using pex, to make it available on a spark cluster. If the project is included in the lockfile, pex invokes the configured build backend. This step fails with uv_build.

The pex creation is successful when using hatchling, which is why I am opening the issue in this repo. Sorry if this issue is on the pex side, tagging @jsirois just in case.

Here is a reproducible example:

```bash
mkdir uv-pex && cd uv-pex
uv init --lib
uv export --output-file pylock.toml
uvx pex --pylock pylock.toml
```

```bash
There was 1 error downloading required artifacts:
1. uv-pex from file://.
    Failed to build sdist for local project .: PEP-517:build_sdist at .: Executing /home/[user]/.cache/pex/venvs/1/bba7cd5ad78c1f55b532cd0b62be6af5e9571e8d/0de1795ad4486f45ee94cecd983e9905b6b11dc9/bin/python /home/[user]/.cache/pex/venvs/1/bba7cd5ad78c1f55b532cd0b62be6af5e9571e8d/0de1795ad4486f45ee94cecd983e9905b6b11dc9/pex -c import json
    import sys
    
    import uv_build
    
    
    if not hasattr(uv_build, 'build_sdist'):
        sys.exit(75)
    
    result = uv_build.build_sdist(*('/tmp/tmp28a30lpz/dists',), **{})
    with open('/tmp/pex-pep-517.webptr6e/build_hook_result.json', "w") as fp:
        json.dump(result, fp)
     failed with 1
    STDERR:
    Error: failed to create file `/tmp/tmp28a30lpz/dists/uv_pex-0.1.0.tar.gz`: No such file or directory (os error 2)
    
    Error: failed to create file `/tmp/tmp28a30lpz/dists/uv_pex-0.1.0.tar.gz`: No such file or directory (os error 2)
```

Thank you for your work on uv!

### Platform

Linux 6.14.0-29-generic x86_64 GNU/Linux

### Version

uv 0.8.18

### Python version

Python 3.12.3

---

_Label `bug` added by @matthieucx on 2025-09-19 09:33_

---

_Comment by @konstin on 2025-09-19 09:52_

This does sound like a pex bug, the target directory needs to already exist for a PEP 517 build.

---

_Comment by @jsirois on 2025-09-19 10:09_

I'll take this up as a Pex bug later today and link the issue. That said @konstin , where does the spec say this? There's a lot to read, and I have just now, but don't see it. In particular, all I see is https://peps.python.org/pep-0517/#build-sdist

> Must build a .tar.gz source distribution and place it in the specified sdist_directory. It must return the basename (not the full path) of the .tar.gz file it creates, as a unicode string.

And, later, for build front ends, no suggestion they need to create the dir arguments to backend hooks AFAICT:
+ https://peps.python.org/pep-0517/#build-environment
+ https://peps.python.org/pep-0517/#recommendations-for-build-frontends-non-normative

---

_Referenced in [pex-tool/pex#2913](../../pex-tool/pex/issues/2913.md) on 2025-09-19 10:31_

---

_Comment by @jsirois on 2025-09-19 10:40_

FWIW @matthieucx, you can work around by having uv skip emitting the local project in the lock and adjusting how you build the PEX by telling Pex about the project instead:
```console
:; mkdir uv-pex && cd uv-pex
:; uv init --lib

# Tell uv to skip the local project, just record the locked 3rdparty deps:
:; uv export --no-emit-project --output-file pylock.toml

# Now tell Pex about the local project instead:
:; uvx pex --pylock pylock.toml --project .
Project `uv-pex` is already a member of workspace `/home/jsirois/dev/pex-tool/pex`
Initialized project `uv-pex`
Resolved 252 packages in 585ms
# This file was autogenerated by uv via the following command:
#    uv export --no-emit-project --output-file pylock.toml
lock-version = "1.0"
created-by = "uv"
requires-python = ">=2.7, <3.15"
Pex 2.58.0 ephemeral hermetic environment with 1 requirement and 1 activated distribution.
Python 3.13.7 (main, Aug 15 2025, 11:40:50) [GCC 14.2.0] on linux
Type "help", "pex", "copyright", "credits" or "license" for more information.
>>> pex()
Running from ephemeral loose PEX directory: /tmp/tmpdbuom6nn
Requirements:
  uv-pex==0.1.0
Activated Distributions:
  uv_pex-0.1.0-py3-none-any.whl
>>>
```

That said, I should have a Pex fix out in a 2.58.1 release in a few hours.

---

_Comment by @matthieucx on 2025-09-19 11:17_

> FWIW [@matthieucx](https://github.com/matthieucx), you can work around by having uv skip emitting the local project in the lock and adjusting how you build the PEX by telling Pex about the project instead:

Neat, I played around and this definitely works. I was going to need the flag for poetry-based projects so that also helps!

> That said, I should have a Pex fix out in a 2.58.1 release in a few hours.

Thanks a lot for processing this so quickly! 

---

_Comment by @jsirois on 2025-09-19 11:24_

@matthieucx you're welcome. I will point out that locking local projects is inherently weird since you tend to want to actually mutate the local project. When you don't, you use the envelope of the project - git, an enclosing archive, what have you - to pin the project source tree with the lock file. That said, Pex locks allow locking projects too, although they do it differently and actually take you seriously and lock the hash of the source tree as it exists when you lock. That is why an sdist build happens here instead of a direct local project wheel build. The pex lock infra assumes it needs to build an sdist and get the hash of its contents to compare to the locked hash. In pylock.toml though, local projects do not get a hash. The issue was raised during PEP-751 spec development but punted in the end.

---

_Label `bug` removed by @konstin on 2025-09-19 12:53_

---

_Label `external` added by @konstin on 2025-09-19 12:53_

---

_Comment by @konstin on 2025-09-19 12:54_

Thank you for being so responsive!

Fixed in https://github.com/pex-tool/pex/pull/2914

---

_Closed by @konstin on 2025-09-19 12:54_

---
