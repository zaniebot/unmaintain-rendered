---
number: 13327
title: Ephemeral environments lacking scripts entry points
type: issue
state: closed
author: fvbrandt
labels:
  - bug
assignees: []
created_at: 2025-05-07T10:46:36Z
updated_at: 2025-07-22T12:11:06Z
url: https://github.com/astral-sh/uv/issues/13327
synced_at: 2026-01-07T12:31:16-06:00
---

# Ephemeral environments lacking scripts entry points

---

_Issue opened by @fvbrandt on 2025-05-07 10:46_

### Summary

# Short summary
Ephemeral environments created via `--with` do not contain the "scripts" entry points (Windows: `scripts/<script>.exe`, Linux: `bin/<script>`) of their base venv. Thus, if one launches such an entry point from an ephemeral venv, one ends up running the interpreter from the base venv which lacks the packages installed by `--with`.

I already asked about this in discord and @zanieb replied it might be worth opening an issue because it might be a bug.
If it is not a bug, then at least it might be worth a warning in the documentation of the `--with` parameter.

# Minimal example
<details>
<summary>Windows cmd commands</summary>

```
uv init uvEphemeralScriptsExample
cd uvEphemeralScriptsExample
uv add pytest
# (Now we have an entry point we want to use: .venv/scripts/pytest.exe)
mkdir tests
# Add a test case that depends on another package, e.g. "pyyaml". We will install that package via --with
(echo def test_pyyaml^(^):& echo     import yaml)> tests\test_pyyaml.py
uv run --with pyyaml python -c "import subprocess;subprocess.run(['pytest'], text=True)"
```

</details>


# Work arounds / why is this bad?
In my particular use case the script I needed was `pytest` and a work around was to call `[sys.executable, "-m", "pytest"]`.

But the pytest docs have an explicit warning that this triggers slightly different behavior: https://docs.pytest.org/en/7.1.x/explanation/pythonpath.html#invoking-pytest-versus-python-m-pytest

Also, other python packages might define more complicated entry points and trying to circumvent the entry-points to directly call the underlying API seems like bad practice.

### Platform

Windows

### Version

uv 0.7.2 (481d05d8d 2025-04-30)

### Python version

tested on 3.9 and 3.13

---

_Label `bug` added by @fvbrandt on 2025-05-07 10:46_

---

_Comment by @hynek on 2025-06-08 10:12_

Ooof thanks for opening this issue, because this is a really nasty one and I would be still debugging otherwise!

The fact that `uv run --with pdbpp python -c 'import pdbpp'` works and `uv run --with pdbpp pytest` claims pdbpp isn't installed is _really_ confusing. ðŸ˜…

---

_Referenced in [astral-sh/uv#8883](../../astral-sh/uv/issues/8883.md) on 2025-06-08 10:17_

---

_Comment by @zanieb on 2025-06-09 14:36_

@hynek just to be clear, the latter claims that `pytest` isn't installed, yes?

---

_Comment by @hynek on 2025-06-09 14:38_

> @hynek just to be clear, the latter claims that `pytest` isn't installed, yes?

No, much worse. :) 

It falls back to the pytest from the main venv which means the `--with` is meaningless.

---

_Comment by @zanieb on 2025-06-09 14:48_

I see, that makes more sense.

The fix here is presumably to copy over all the entry points from the parent environment with a re-written shebang, unless an entry point already exists in the ephemeral layer.

---

_Comment by @hynek on 2025-07-07 14:37_

BTW, I would argue that the correct behavior here would be to only look at the venv's bin directory like tox â€“ or at least warning if the command is coming from somewhere else. It's really hard to debug once a transparent fallback happens.

---

_Comment by @zanieb on 2025-07-07 14:58_

That'd be really breaking and confusing, e.g., `uv run bash -c "..."` would warn?

It might be reasonable to warn if a command comes from another _Python_ environment, but not just if it's from outside the virtual environment.

---

_Comment by @hynek on 2025-07-07 15:02_

> It might be reasonable to warn if a command comes from another _Python_ environment, but not just if it's from outside the virtual environment.

ah yes, that!

especially if it's the main one. that was really super confusing to debug. ðŸ˜…

---

_Referenced in [astral-sh/uv#14729](../../astral-sh/uv/issues/14729.md) on 2025-07-21 12:31_

---

_Referenced in [astral-sh/uv#14749](../../astral-sh/uv/issues/14749.md) on 2025-07-21 12:32_

---

_Referenced in [astral-sh/uv#14790](../../astral-sh/uv/pulls/14790.md) on 2025-07-21 14:41_

---

_Referenced in [jupyterlab/jupyterlab#17716](../../jupyterlab/jupyterlab/issues/17716.md) on 2025-07-21 16:17_

---

_Closed by @zanieb on 2025-07-22 12:11_

---
