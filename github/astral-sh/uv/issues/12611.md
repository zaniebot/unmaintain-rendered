---
number: 12611
title: Authenticate argument ignored with explicit index
type: issue
state: closed
author: jdumas
labels:
  - bug
assignees: []
created_at: 2025-04-01T22:10:01Z
updated_at: 2025-04-02T18:14:59Z
url: https://github.com/astral-sh/uv/issues/12611
synced_at: 2026-01-07T12:31:15-06:00
---

# Authenticate argument ignored with explicit index

---

_Issue opened by @jdumas on 2025-04-01 22:10_

### Summary

When using the following configuration:

```toml
dependencies = [
    "lagrange>=6.31.0"
]

[tool.uv.sources]
lagrange = { index = "artifactory" }

[[tool.uv.index]]
name = "artifactory"
url = "https://artifactory.internal-url.com/artifactory/api/pypi/pypi-myrepo/simple"
explicit = true
authenticate = "always"
```

It seems that the `authenticate` parameter is ignored by `uv`:

```
❯ uv sync
Using CPython 3.13.2
Creating virtual environment at: .venv
  × No solution found when resolving dependencies:
  ╰─▶ Because only lagrange<=3.0.1 is available and your project depends on lagrange>=6.31.0, we can conclude that your
      project's requirements are unsatisfiable.
```

If I remove the `explicit = true` I get a different error:

```
❯ uv sync
  × No solution found when resolving dependencies:
  ╰─▶ Because only lagrange<=3.0.1 is available and your project depends on lagrange>=6.31.0, we can conclude that your
      project's requirements are unsatisfiable.

      hint: `lagrange` was found on
      https://artifactory.corp.adobe.com/artifactory/api/pypi/pypi-lagrange-python-release/simple, but not at the
      requested version (lagrange>=6.31.0). A compatible version may be available on a subsequent index (e.g.,
      https://pypi.org/simple). By default, uv will only consider versions that are published on the first index
      that contains a given package, to avoid dependency confusion attacks. If all indexes are equally trusted, use
      `--index-strategy unsafe-best-match` to consider all versions from all indexes, regardless of the order in which
      they were defined.
```

Finally, by adding the `--index-strategy unsafe-best-match` it works as expected:

```
❯ uv sync --index-strategy unsafe-best-match
Using CPython 3.13.2
Creating virtual environment at: .venv
Resolved 4 packages in 7ms
Installed 3 packages in 34ms
 + colorama==0.4.6
 + lagrange==6.31.0
 + numpy==2.2.4
```

This seems to indicate that when `explicit = true` is used, the `authenticate` argument is ignored.

### Platform

macOS 14.5

### Version

0.6.11

### Python version

3.12

---

_Label `bug` added by @jdumas on 2025-04-01 22:10_

---

_Assigned to @jtfmumm by @zanieb on 2025-04-01 22:12_

---

_Comment by @zanieb on 2025-04-01 22:13_

Thanks for the report! We'll look into it.

---

_Comment by @jtfmumm on 2025-04-02 10:17_

Thanks @jdumas. Could you please include the trace output (`-vv`) when running against your private index? 

~~If authentication is failing on the index with `authenticate = "always"`, uv will still currently fall back to the default index (PyPI), which could explain why it's not finding the correct version. If you set `default = true` on your `artifactory` index then this fallback will not occur.~~ 

---

_Comment by @zanieb on 2025-04-02 13:34_

We shouldn't fallback if `lagrange = { index = "artifactory" }` is set though? Are we?

---

_Comment by @jtfmumm on 2025-04-02 14:13_

No you're correct. Modified above

---

_Comment by @zanieb on 2025-04-02 14:41_

I added some test coverage in https://github.com/astral-sh/uv/pull/12624 and ~it appears to be working as intended~ it looks like it reproduces the problem

---

_Referenced in [astral-sh/uv#12624](../../astral-sh/uv/pulls/12624.md) on 2025-04-02 14:42_

---

_Comment by @jdumas on 2025-04-02 14:43_

Hi! Here is the trace output when using `explicit = true`:

```
DEBUG uv 0.6.11 (Homebrew 2025-03-30)
DEBUG Found project root: `/Users/jedumas/sandbox/myproject`
DEBUG No workspace root found, using project root
TRACE Checking lock for `/Users/jedumas/sandbox/myproject` at `/var/folders/_d/n30mgrzx0933r_7bpbgb1q640000gq/T/uv-17d5ee10c504290f.lock`
DEBUG Acquired lock for `/Users/jedumas/sandbox/myproject`
DEBUG Using Python request `>=3.12` from `requires-python` metadata
DEBUG Checking for Python environment at `.venv`
DEBUG Searching for Python >=3.12 in managed installations or search path
DEBUG Searching for managed installations at `/Users/jedumas/.local/share/uv/python`
DEBUG Found managed installation `cpython-3.13.2-macos-aarch64-none`
TRACE Cached interpreter info for Python 3.13.2, skipping probing: /Users/jedumas/.local/share/uv/python/cpython-3.13.2-macos-aarch64-none/bin/python3.13
DEBUG Found `cpython-3.13.2-macos-aarch64-none` at `/Users/jedumas/.local/share/uv/python/cpython-3.13.2-macos-aarch64-none/bin/python3.13` (managed installations)
Using CPython 3.13.2
Creating virtual environment at: .venv
DEBUG Assessing Python executable as base candidate: /Users/jedumas/.local/share/uv/python/cpython-3.13.2-macos-aarch64-none/bin/python3.13
DEBUG Using base executable for virtual environment: /Users/jedumas/.local/share/uv/python/cpython-3.13.2-macos-aarch64-none/bin/python3.13
DEBUG Released lock at `/var/folders/_d/n30mgrzx0933r_7bpbgb1q640000gq/T/uv-17d5ee10c504290f.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: myproject @ file:///Users/jedumas/sandbox/myproject
DEBUG No workspace root found, using project root
TRACE Performing lookahead for myproject @ file:///Users/jedumas/sandbox/myproject
DEBUG Solving with installed Python version: 3.13.2
DEBUG Solving with target Python version: >=3.12
TRACE Assigned packages:
TRACE Chose package for decision: root. remaining choices:
DEBUG Adding direct dependency: myproject*
TRACE Assigned packages: root==0a0.dev0
TRACE Chose package for decision: myproject. remaining choices:
DEBUG Searching for a compatible version of myproject @ file:///Users/jedumas/sandbox/myproject (*)
DEBUG Adding direct dependency: lagrange>=6.31.0
TRACE Assigned packages: root==0a0.dev0, myproject==0.1.0
TRACE Chose package for decision: lagrange. remaining choices:
TRACE Fetching metadata for lagrange from https://artifactory.internal-url.com/artifactory/api/pypi/pypi-myrepo/simple/lagrange/
TRACE Cached request https://artifactory.internal-url.com/artifactory/api/pypi/pypi-myrepo/simple/lagrange/ is storable because its response has an 'max-age' cache-control directive
TRACE Freshness lifetime found via cache-control max age setting: 60s
DEBUG Found fresh response for: https://artifactory.internal-url.com/artifactory/api/pypi/pypi-myrepo/simple/lagrange/
TRACE Received package metadata for: lagrange
DEBUG Searching for a compatible version of lagrange (>=6.31.0)
TRACE Selecting candidate for lagrange with range >=6.31.0 with 9 remote versions
TRACE Exhausted all candidates for package lagrange with range >=6.31.0 after 0 steps
DEBUG No compatible version found for: lagrange
DEBUG Recording unit propagation conflict of lagrange from incompatibility of (myproject)
TRACE Assigned packages: root==0a0.dev0
TRACE Chose package for decision: myproject. remaining choices:
DEBUG Searching for a compatible version of myproject @ file:///Users/jedumas/sandbox/myproject (<0.1.0 | >0.1.0)
DEBUG No compatible version found for: myproject
TRACE Resolver derivation tree before reduction
term root==0a0.dev0
  root==0a0.dev0 depends on myproject*
  term myproject*
    term myproject==0.1.0
      myproject==0.1.0 depends on lagrange>=6.31.0
      no versions of lagrange>=6.31.0
    no versions of myproject<0.1.0 | >0.1.0
TRACE Resolver derivation tree after reduction
term myproject==0.1.0
  myproject==0.1.0 depends on lagrange>=6.31.0
  no versions of lagrange>=6.31.0
  × No solution found when resolving dependencies:
  ╰─▶ Because only lagrange<=3.0.1 is available and your project depends on lagrange>=6.31.0, we can conclude that your project's requirements are unsatisfiable.
```

---

_Comment by @jtfmumm on 2025-04-02 15:59_

I've investigated this and indexes configured as `explicit = true` are being excluded from the list of index URLs our auth middleware uses to check for authentication policies. That would explain why authentication is not being forced here. I'll fix this and see if it resolves your issue.

---

_Referenced in [astral-sh/uv#12631](../../astral-sh/uv/pulls/12631.md) on 2025-04-02 16:59_

---

_Closed by @zanieb on 2025-04-02 17:54_

---

_Comment by @jdumas on 2025-04-02 18:14_

Thanks for the quick fix. You guys are the best!

---
