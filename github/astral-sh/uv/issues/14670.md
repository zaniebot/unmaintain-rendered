---
number: 14670
title: "`uv venv` sometimes overwrites symlink with a new directory"
type: issue
state: closed
author: YodaEmbedding
labels:
  - bug
assignees: []
created_at: 2025-07-16T19:19:11Z
updated_at: 2025-11-09T03:06:53Z
url: https://github.com/astral-sh/uv/issues/14670
synced_at: 2026-01-07T12:31:16-06:00
---

# `uv venv` sometimes overwrites symlink with a new directory

---

_Issue opened by @YodaEmbedding on 2025-07-16 19:19_

### Summary

`uv venv` behaves differently depending on `.venv` directory state:

- If symlinked directory does not exist, `uv venv` fails.
- If symlinked directory exists, `uv venv` succeeds and preserves the symlink.
- If symlinked directory exists and `uv venv` is run twice, the symlink is replaced with a new directory.

Desired behavior: consistency, e.g. the `uv venv` should not delete an existing symlink.

Related: https://github.com/astral-sh/uv/issues/1472

---

### Details

If symlinked directory does not exist:

```bash
λ rm -rf .venv
λ ln -rs ~/.local/state/uv/virtualenvs/"${PWD##*/}" .venv

λ uv venv
Using CPython 3.8.20
Creating virtual environment at: .venv
uv::venv::creation

  × Failed to create virtualenv
  ╰─▶ failed to create directory `$PWD/.venv`: File exists (os error 17)
```

---

If symlinked directory exists:

```bash
λ rm -rf .venv
λ ln -rs ~/.local/state/uv/virtualenvs/"${PWD##*/}" .venv
λ mkdir ~/.local/state/uv/virtualenvs/"${PWD##*/}"

λ uv venv
Using CPython 3.8.20
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate

λ ls -la .venv
lrwxr-xr-x 1 user group 54 2025-07-14 00:00:00 .venv -> ../../../.local/state/uv/virtualenvs/"${PWD##*/}"

# Yay!
```

---

If symlinked directory exists, but `uv venv` is run *twice*: 

```bash
λ rm -rf .venv
λ ln -rs ~/.local/state/uv/virtualenvs/"${PWD##*/}" .venv
λ mkdir ~/.local/state/uv/virtualenvs/"${PWD##*/}"

λ uv venv
Using CPython 3.8.20
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate

λ ls -la .venv
lrwxr-xr-x 1 user group 54 2025-07-14 00:00:00 .venv -> ../../../.local/state/uv/virtualenvs/"${PWD##*/}"

λ uv venv
Using CPython 3.8.20
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate

λ ls -la .venv
total 12K
drwxr-xr-x  7 user group  224 2025-07-14 20:56:17 .
drwxr-xr-x 35 user group 1.1K 2025-07-14 20:56:17 ..
drwxr-xr-x 14 user group  448 2025-07-14 20:56:17 bin
drwxr-xr-x  3 user group   96 2025-07-14 20:56:17 lib
-rw-r--r--  1 user group    1 2025-07-14 20:56:17 .gitignore
-rw-r--r--  1 user group   43 2025-07-14 20:56:17 CACHEDIR.TAG
-rw-r--r--  1 user group  211 2025-07-14 20:56:17 pyvenv.cfg

# Destroyed the symlink?!
```

---

### Platform

Darwin 23.6.0 arm64

### Version

uv 0.7.13 (62ed17b23 2025-06-12)

### Python version

Python 3.8.20

---

_Label `bug` added by @YodaEmbedding on 2025-07-16 19:19_

---

_Comment by @zanieb on 2025-07-16 19:25_

I see a slightly different behavior, but.. yeah we seem to be breaking the symlink

```
❯ ln -s foo .venv
❯ ls -lah
total 0
drwxr-xr-x   3 zb    wheel    96B Jul 16 14:24 .
drwxrwxrwt  15 root  wheel   480B Jul 16 14:23 ..
lrwxr-xr-x   1 zb    wheel     3B Jul 16 14:24 .venv -> foo
❯ uv venv
Using CPython 3.13.3
Creating virtual environment at: .venv
uv::venv::creation

  × Failed to create virtualenv
  ╰─▶ failed to create directory `.venv`: File exists (os error 17)
❯ ls -lah
total 0
drwxr-xr-x   3 zb    wheel    96B Jul 16 14:24 .
drwxrwxrwt  15 root  wheel   480B Jul 16 14:23 ..
lrwxr-xr-x   1 zb    wheel     3B Jul 16 14:24 .venv -> foo
❯ mkdir foo
❯ uv venv
Using CPython 3.13.3
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
❯ ls -lah
total 0
drwxr-xr-x   4 zb    wheel   128B Jul 16 14:24 .
drwxrwxrwt  15 root  wheel   480B Jul 16 14:23 ..
lrwxr-xr-x   1 zb    wheel     3B Jul 16 14:24 .venv -> foo
drwxr-xr-x   7 zb    wheel   224B Jul 16 14:24 foo
❯ uv venv
Using CPython 3.13.3
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
❯ ls -lah
total 0
drwxr-xr-x   4 zb    wheel   128B Jul 16 14:24 .
drwxrwxrwt  15 root  wheel   480B Jul 16 14:23 ..
drwxr-xr-x   7 zb    wheel   224B Jul 16 14:24 .venv
drwxr-xr-x   7 zb    wheel   224B Jul 16 14:24 foo
```

---

_Referenced in [astral-sh/uv#14933](../../astral-sh/uv/pulls/14933.md) on 2025-07-28 06:55_

---

_Comment by @yumeminami on 2025-07-28 07:01_

@YodaEmbedding I also encountered a similar problem, I submitted a fix to mr https://github.com/astral-sh/uv/pull/14933, below is the terminal log output after my fix

```bash
➜  test-env ls -lah
total 0
drwxr-xr-x   2 wingmunfung  staff    64B Jul 28 14:47 .
drwxr-xr-x  47 wingmunfung  staff   1.5K Jul 28 14:37 ..
➜  test-env alias uv-dev='/Users/wingmunfung/workspace/uv/target/debug/uv'
➜  test-env ln -s foo .venv
➜  test-env ls -lah        
total 0
drwxr-xr-x   3 wingmunfung  staff    96B Jul 28 14:47 .
drwxr-xr-x  47 wingmunfung  staff   1.5K Jul 28 14:37 ..
lrwxr-xr-x   1 wingmunfung  staff     3B Jul 28 14:47 .venv -> foo
➜  test-env uv-dev venv
Using CPython 3.13.2
Creating virtual environment at: .venv
Activate with: source foo/bin/activate

### virtual venv create successful

➜  test-env ls -lah
total 0
drwxr-xr-x   4 wingmunfung  staff   128B Jul 28 14:47 .
drwxr-xr-x  47 wingmunfung  staff   1.5K Jul 28 14:37 ..
lrwxr-xr-x   1 wingmunfung  staff     3B Jul 28 14:47 .venv -> foo
drwxr-xr-x@  7 wingmunfung  staff   224B Jul 28 14:47 foo
➜  test-env uv-dev venv
Using CPython 3.13.2
Creating virtual environment at: .venv
? A virtual environment already exists at `.venv`. Do you want to replace it? 
✔ A virtual environment already exists at `.venv`. Do you want to replace it? · yes
Activate with: source foo/bin/activate
➜  test-env ls -lah
total 0
drwxr-xr-x   4 wingmunfung  staff   128B Jul 28 14:48 .
drwxr-xr-x  47 wingmunfung  staff   1.5K Jul 28 14:37 ..
lrwxr-xr-x   1 wingmunfung  staff     3B Jul 28 14:47 .venv -> foo
drwxr-xr-x@  7 wingmunfung  staff   224B Jul 28 14:48 foo

### the symlink still exists
```

---

_Closed by @zanieb on 2025-11-09 03:06_

---
