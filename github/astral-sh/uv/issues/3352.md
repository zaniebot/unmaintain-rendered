---
number: 3352
title: "universal-lock: add marker evaluation for just extras"
type: issue
state: closed
author: BurntSushi
labels:
  - preview
assignees: []
created_at: 2024-05-03T15:44:29Z
updated_at: 2024-05-09T13:24:38Z
url: https://github.com/astral-sh/uv/issues/3352
synced_at: 2026-01-07T12:31:14-06:00
---

# universal-lock: add marker evaluation for just extras

---

_Issue opened by @BurntSushi on 2024-05-03 15:44_

The central way that a universal lock file is generated is by ignoring the markers in a list of dependencies. For example, given:

```
foo>=3 ; sys_platform == 'linux'
foo<3 ; sys_platform == 'darwin'
```

then a universal lock file needs to be generated by considering _both_ `foo>=3` and `foo<3`. Normally, the marker expressions would cause these dependencies to be disjoint.

However, not all markers should be ignored. The `extra` marker, for example, should still be evaluated since it isn't directly dependent on the platform.

This ticket is thus about adding a new marker evaluation routine that only looks at platform independent markers:

https://github.com/astral-sh/uv/blob/e33ff95575e8165078799548070210947d1cfad0/crates/pep508-rs/src/lib.rs#L354-L361

There does exist this routine:

https://github.com/astral-sh/uv/blob/e33ff95575e8165078799548070210947d1cfad0/crates/pep508-rs/src/lib.rs#L363-L379

But it also evaluates Python versions and its signature is a bit different.

---

_Label `preview` added by @BurntSushi on 2024-05-03 15:44_

---

_Referenced in [astral-sh/uv#3350](../../astral-sh/uv/issues/3350.md) on 2024-05-03 15:44_

---

_Renamed from "universal-lock: add marker evaluation for just extras and `python_version`" to "universal-lock: add marker evaluation for just extras" by @BurntSushi on 2024-05-07 14:51_

---

_Referenced in [astral-sh/uv#3466](../../astral-sh/uv/pulls/3466.md) on 2024-05-08 18:10_

---

_Closed by @BurntSushi on 2024-05-09 13:24_

---
