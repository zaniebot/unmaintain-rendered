---
number: 4358
title: "Should `uv sync` remove extraneous packages?"
type: issue
state: closed
author: ibraheemdev
labels: []
assignees: []
created_at: 2024-06-17T15:56:26Z
updated_at: 2024-10-11T12:34:19Z
url: https://github.com/astral-sh/uv/issues/4358
synced_at: 2026-01-07T12:31:14-06:00
---

# Should `uv sync` remove extraneous packages?

---

_Issue opened by @ibraheemdev on 2024-06-17 15:56_

[It currently does not](https://github.com/astral-sh/uv/blob/67f1285ce3f00840e1833e4aa5a7e6480e94e489/crates/uv/src/commands/project/sync.rs#L191), while `uv pip sync` does. This would also affect whether `uv remove` removes *all* extraneous packages, or has to do extra work to only remove the affected packages.

---

_Comment by @zanieb on 2024-06-17 17:00_

In brief, I think we should:

1. Change sync to always remove extraneous packages. This is the common understanding on sync.
2. Implement an opt-out option for removal during sync, e.g. `--allow-extra-packages`
3. Update `uv remove` to allow extraneous packages by default, only removing the relevant dependency tree

---

_Label `preview` added by @zanieb on 2024-06-17 17:00_

---

_Assigned to @ibraheemdev by @ibraheemdev on 2024-06-17 17:12_

---

_Referenced in [astral-sh/uv#4366](../../astral-sh/uv/pulls/4366.md) on 2024-06-17 18:28_

---

_Comment by @ibraheemdev on 2024-06-19 18:37_

`uv sync` now removes extraneous packages by default, which you can opt-out with `--no-clean`.

Currently `uv add` and `uv run` do not ever remove from the environment, and so `uv remove` should, for consistency, only remove the affected packages. An alternative approach to 3 is to have all project commands, `uv run`, `uv add`, and `uv remove`, always clean the virtual environment, which would simplify things and doesn't seem necessarily problematic.

---

_Comment by @zanieb on 2024-06-19 20:29_

I don't think they should always clean the virtual environment. I think it's too common for people to manually manage packages in Python and without an explicit sync it seems excessive for us to purge extraneous packages. Changing remove to be more clearly scoped by default seems like a more intuitive user experience.

---

_Comment by @charliermarsh on 2024-06-23 15:34_

> Update uv remove to allow extraneous packages by default, only removing the relevant dependency tree

Does this mean: `uv remove foo` uninstalls `foo`, or uninstalls `foo` and its dependencies?

---

_Assigned to @charliermarsh by @charliermarsh on 2024-08-09 14:03_

---

_Unassigned @ibraheemdev by @charliermarsh on 2024-08-09 14:03_

---

_Comment by @charliermarsh on 2024-08-10 18:54_

My current vote is that it uses the same semantics as `uv run`, and we add an `--exact` argument to enable exact syncing. But I would also be okay shipping with the current behavior.

---

_Label `preview` removed by @zanieb on 2024-08-20 18:22_

---

_Comment by @T-256 on 2024-09-19 10:47_

> I think it's too common for people to manually manage packages in Python and without an explicit sync it seems excessive for us to purge extraneous packages.

IIUC, uv's top level commands do some automations to keep your workspace in sync between lockfile, pyproject.toml and venv.
I think who wants manually manage packages could use low level commands, i.e. `uv pip uninstall` in this case.

---

_Comment by @zanieb on 2024-09-19 11:02_

I think we made a decision on this â€” we have a toggle now.

---

_Closed by @zanieb on 2024-09-19 11:02_

---

_Comment by @aberres on 2024-10-11 12:34_

For anyone coming here after not finding the switch when looking at `--help`: It is called `--inexact`.

---

_Referenced in [astral-sh/uv#7838](../../astral-sh/uv/issues/7838.md) on 2024-11-13 18:38_

---

_Referenced in [astral-sh/uv#11937](../../astral-sh/uv/issues/11937.md) on 2025-03-03 23:12_

---
