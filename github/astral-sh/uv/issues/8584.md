---
number: 8584
title: "Trusted publishing support for GitHub Actions + TestPyPI via `uv publish`"
type: issue
state: closed
author: nathanjmcdougall
labels: []
assignees: []
created_at: 2024-10-26T04:14:10Z
updated_at: 2024-10-28T09:57:46Z
url: https://github.com/astral-sh/uv/issues/8584
synced_at: 2026-01-07T12:31:15-06:00
---

# Trusted publishing support for GitHub Actions + TestPyPI via `uv publish`

---

_Issue opened by @nathanjmcdougall on 2024-10-26 04:14_

Currently, `uv publish` supports trusted publishing support via GitHub Actions with PyPI, but not with TestPyPI. For testing purposes, it would be great if support could be extended to TestPyPI.

---

_Assigned to @konstin by @zanieb on 2024-10-26 16:22_

---

_Comment by @konstin on 2024-10-28 08:09_

The trusted publishing support exists for both TestPyPI and PyPI, is there anything specific not working?

---

_Comment by @nathanjmcdougall on 2024-10-28 08:53_

OK, that's great to hear, I guess in that case I just haven't worked out how to set up trusted publishing properly yet. I'm experimenting here:
https://github.com/nathanjmcdougall/postmodern-python-ci/blob/main/.github/workflows/release.yml

[I get errors](https://github.com/nathanjmcdougall/postmodern-python-ci/actions/runs/11550297410/job/32144983240) about missing credentials:

> error: Failed to publish `dist/postmodern_ci-0.1.0-py3-none-any.whl` to https://upload.test.pypi.org/legacy/
>  Caused by: Failed to send POST request
>  Caused by: Missing credentials for https://upload.test.pypi.org/legacy/

My TestPyPI config is here:
![image](https://github.com/user-attachments/assets/74456a34-2c6d-42ab-bf06-36489d89f89e)

I don't actually know where the TestPyPI upload endpoint is, I've tried manually using API tokens but I get the following:

- https://test.upload.pypi.org/legacy/  -> `dns error: No such host is known. (os error 11001)`
- https://upload.test.pypi.org/legacy/  -> `dns error: No such host is known. (os error 11001)`
- https://upload.pypi.org/legacy/ ->`Permission denied (status code 403 Forbidden)`

Probably I need to do more work to diagnose my issue, so I'm closing for now. Any support appreciated but not expected.

---

_Closed by @nathanjmcdougall on 2024-10-28 08:53_

---

_Comment by @konstin on 2024-10-28 08:58_

The publish endpoint for TestPyPI is https://test.pypi.org/legacy/

---

_Comment by @konstin on 2024-10-28 08:59_

To help with debugging trusted publishing, I recommend `uv publish --trusted-publishing always`, this will show errors earlier when there is a problem.

---

_Comment by @nathanjmcdougall on 2024-10-28 09:57_

Thanks, great to know the endpoint and the suggestion to `--trusted-publishing` was also helpful. The message I got was:

> error: Failed to obtain token for trusted publishing
> Caused by: environment variable not found

This was a tad cryptic without knowing the ins-and-outs of trusted publishing, but the issue was that I had not set `id-token` write permission, [as described here](https://docs.pypi.org/trusted-publishers/using-a-publisher/). Once this was set, everything worked.

Thank you so much for your help.

---

_Referenced in [astral-sh/uv#8632](../../astral-sh/uv/pulls/8632.md) on 2024-10-28 11:04_

---

_Referenced in [gerrymanoim/exchange_calendars#501](../../gerrymanoim/exchange_calendars/issues/501.md) on 2025-10-13 14:53_

---
