---
number: 3137
title: Option to resolve to latest version from all indices
type: issue
state: closed
author: yorickvP
labels:
  - compatibility
assignees: []
created_at: 2024-04-19T08:14:41Z
updated_at: 2024-04-27T01:31:48Z
url: https://github.com/astral-sh/uv/issues/3137
synced_at: 2026-01-07T13:12:17-06:00
---

# Option to resolve to latest version from all indices

---

_Issue opened by @yorickvP on 2024-04-19 08:14_

When specifying `unsafe-any-match`. I'd expect to find the latest version of a package from all indices. However, when using the pytorch index, which has an ancient version of certifi for some reason, uv finds that instead of the recent version from pypi.

This causes SSL certificates to be two years out of date whenever the torch index is used.

It would be nice if there could be an `unsafer-any-match`, that allows newer pypi packages to override packages from an index.

uv version: eded6c9fae13591d36d775161e1001f2835edc8a

### with pytorch index
```console
$ echo  'certifi' | uv pip compile - -p 3.10 --extra-index-url https://download.pytorch.org/whl/cu121 --index-strategy unsafe-any-match --verbose
```
<details>
<summary>verbose output</summary>

```
DEBUG Starting interpreter discovery for Python 3.10
DEBUG Starting interpreter discovery for Python @ `3.10`
DEBUG Cached interpreter info for Python 3.11.8, skipping probing: /home/yorick/.nix-profile/bin/python3
DEBUG Cached interpreter info for Python 3.11.8, skipping probing: /home/yorick/.nix-profile/bin/python
DEBUG Cached interpreter info for Python 3.11.8, skipping probing: /home/yorick/.nix-profile/bin/python3
DEBUG Using Python 3.11.8 interpreter at /home/yorick/.nix-profile/bin/python3 for builds
warning: The requested Python version 3.10 is not available; 3.11.8 will be used to build dependencies instead.
DEBUG Using registry request timeout of 300s
DEBUG Solving with target Python version 3.10
DEBUG Adding direct dependency: certifi*
TRACE Fetching metadata for certifi from https://download.pytorch.org/whl/cu121/certifi/
TRACE No cache entry exists for /home/yorick/.cache/uv/simple-v7/105f2b6141aa1e84/certifi.rkyv
DEBUG No cache entry for: https://download.pytorch.org/whl/cu121/certifi/
TRACE Sending fresh GET request for https://download.pytorch.org/whl/cu121/certifi/
DEBUG No credentials found for: https://download.pytorch.org/whl/cu121/certifi/
TRACE cached request https://download.pytorch.org/whl/cu121/certifi/ is not storable because its response has a 'no-store' cache-control directive
TRACE Fetching metadata for certifi from https://pypi.org/simple/certifi/
TRACE cached request https://pypi.org/simple/certifi/ is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://pypi.org/simple/certifi/
TRACE Received package metadata for: certifi
TRACE selecting candidate for package certifi with range Range { segments: [(Unbounded, Unbounded)] } with 58 remote versions
TRACE found candidate for package PackageName("certifi") with range Range { segments: [(Unbounded, Unbounded)] } after 0 steps: "2022.12.7" version
DEBUG Searching for a compatible version of certifi (*)
TRACE selecting candidate for package certifi with range Range { segments: [(Unbounded, Unbounded)] } with 58 remote versions
TRACE found candidate for package PackageName("certifi") with range Range { segments: [(Unbounded, Unbounded)] } after 0 steps: "2022.12.7" version
DEBUG Selecting: certifi==2022.12.7 (certifi-2022.12.7-py3-none-any.whl)
TRACE cached request https://download.pytorch.org/whl/certifi-2022.12.7-py3-none-any.whl#sha256=4ad3232f5e926d6718ec31cfc1fcadfde020920e278684144551c91769c7bc18 is storable because its response has a heuristically cacheable status code 200
DEBUG Found fresh response for: https://download.pytorch.org/whl/certifi-2022.12.7-py3-none-any.whl#sha256=4ad3232f5e926d6718ec31cfc1fcadfde020920e278684144551c91769c7bc18
TRACE Received built distribution metadata for: certifi==2022.12.7
```
</details>

```
Resolved 1 package in 449ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - -p 3.10 --index-strategy unsafe-any-match
certifi==2022.12.7
```


### no pytorch index
```console
$ echo  'certifi' | uv pip compile - -p 3.10 --index-strategy unsafe-any-match --verbose
```
<details>
<summary>verbose output</summary>

```
DEBUG Starting interpreter discovery for Python 3.10
DEBUG Starting interpreter discovery for Python @ `3.10`
DEBUG Cached interpreter info for Python 3.11.8, skipping probing: /home/yorick/.nix-profile/bin/python3
DEBUG Cached interpreter info for Python 3.11.8, skipping probing: /home/yorick/.nix-profile/bin/python
DEBUG Cached interpreter info for Python 3.11.8, skipping probing: /home/yorick/.nix-profile/bin/python3
DEBUG Using Python 3.11.8 interpreter at /home/yorick/.nix-profile/bin/python3 for builds
warning: The requested Python version 3.10 is not available; 3.11.8 will be used to build dependencies instead.
DEBUG Using registry request timeout of 300s
DEBUG Solving with target Python version 3.10
DEBUG Adding direct dependency: certifi*
TRACE Fetching metadata for certifi from https://pypi.org/simple/certifi/
TRACE cached request https://pypi.org/simple/certifi/ is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://pypi.org/simple/certifi/
TRACE Received package metadata for: certifi
TRACE selecting candidate for package certifi with range Range { segments: [(Unbounded, Unbounded)] } with 57 remote versions
TRACE found candidate for package PackageName("certifi") with range Range { segments: [(Unbounded, Unbounded)] } after 0 steps: "2024.2.2" version
DEBUG Searching for a compatible version of certifi (*)
TRACE selecting candidate for package certifi with range Range { segments: [(Unbounded, Unbounded)] } with 57 remote versions
TRACE found candidate for package PackageName("certifi") with range Range { segments: [(Unbounded, Unbounded)] } after 0 steps: "2024.2.2" version
DEBUG Selecting: certifi==2024.2.2 (certifi-2024.2.2-py3-none-any.whl)
TRACE cached request https://files.pythonhosted.org/packages/ba/06/a07f096c664aeb9f01624f858c3add0a4e913d6c96257acb4fce61e7de14/certifi-2024.2.2-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/ba/06/a07f096c664aeb9f01624f858c3add0a4e913d6c96257acb4fce61e7de14/certifi-2024.2.2-py3-none-any.whl.metadata
TRACE Received built distribution metadata for: certifi==2024.2.2
```
</details>

```
Resolved 1 package in 8ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - -p 3.10 --index-strategy unsafe-any-match
certifi==2024.2.2
```

---

_Referenced in [astral-sh/uv#3138](../../astral-sh/uv/pulls/3138.md) on 2024-04-19 10:24_

---

_Comment by @charliermarsh on 2024-04-19 14:00_

This is intentional. I'm wondering, in this case, if you should instead be enforcing a lower bound on certifi?

---

_Comment by @yorickvP on 2024-04-19 14:19_

I've enforced a lower bound on certifi, but certifi isn't the only package this is happening to. The following packages are affected in one of my dependency sets:

| pkg | unsafe-any-match | unsafe-highest |
| ---- | ---- | ----|
| certifi | 2022.12.7 | 2024.2.2 |
| charset-normalizer | 2.1.1 | 3.3.2 |
| filelock | 3.9.0 | 3.13.4 |
| idna | 3.4 | 3.7 |
| jinja2 | 3.1.2 | 3.1.3 |
| markupsafe | 2.1.3 | 2.1.5 |
| networkx | 3.2.1 | 3.3 |
| numpy | 1.26.3 | 1.26.4 |
| packaging | 22.0 | 24.0 |
| pillow | 10.2.0 | 10.3.0 |
| tqdm | 4.64.1 | 4.66.2 |
| typing-extensions | 4.8.0 | 4.11.0 |

I don't think torch should be publishing these, but it would be good if we had a way to mirror pip's behaviour here.

---

_Label `compatibility` added by @charliermarsh on 2024-04-20 01:33_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-04-26 02:46_

---

_Comment by @charliermarsh on 2024-04-27 01:31_

Closed by https://github.com/astral-sh/uv/pull/3138.

---

_Closed by @charliermarsh on 2024-04-27 01:31_

---
