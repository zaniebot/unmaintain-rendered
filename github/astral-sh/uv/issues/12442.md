---
number: 12442
title: "`uv sync` does not respect `build-constraint-dependencies` in workspace subpackages"
type: issue
state: closed
author: alex-debrecht-kcftech
labels:
  - bug
assignees: []
created_at: 2025-03-24T17:04:36Z
updated_at: 2025-03-24T17:28:35Z
url: https://github.com/astral-sh/uv/issues/12442
synced_at: 2026-01-07T12:31:15-06:00
---

# `uv sync` does not respect `build-constraint-dependencies` in workspace subpackages

---

_Issue opened by @alex-debrecht-kcftech on 2025-03-24 17:04_

### Summary

The documentation for `build-constraint-dependencies` states:

> In uv lock, uv sync, and uv run, uv will only read build-constraint-dependencies from the pyproject.toml at the workspace root, and will ignore any declarations in other workspace members or uv.toml files.

However, when running `uv sync --all-packages` in a workspace, `build-constraint-dependencies` is not respected for dependencies of non-root packages. It seems like the correct behavior would be to apply the constraints declared in the root `pyproject.toml` (build or install) to every package in the workspace.

Example repository structure:
```
albatross
├── packages
│   ├── bird-feeder
│   │   ├── pyproject.toml
├── pyproject.toml
```

Root `pyproject.toml`:
```toml
[tool.uv.sources]
bird-feeder = { workspace = true }

[tool.uv.workspace]
members = ["packages/*"]

[tool.uv]
build-constraint-dependencies = ["setuptools<78"]
```
(adding a `project` table does not change the behavior)

bird-feeder `pyproject.toml`:
```toml
[project]
name = "bird-feeder"
version = "0.0.0"
requires-python = ">=3.12"
dependencies = ["pyspark==3.5.3"]
```

`uv sync --all-packages -v` output:
```
DEBUG uv 0.6.9
DEBUG Found project root: `/home/alex/test-workspace`
DEBUG Adding discovered workspace member: `/home/alex/test-workspace/packages/bird-feeder`
DEBUG Acquired lock for `/home/alex/test-workspace`
DEBUG Using Python request `>=3.12` from `requires-python` metadata
warning: `VIRTUAL_ENV=/mnt/c/Users/alexander.debrecht/git/core/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment's Python version satisfies `>=3.12`
DEBUG Released lock at `/tmp/uv-9e4d8ed9a2d92e2b.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: bird-feeder @ file:///home/alex/test-workspace/packages/bird-feeder
DEBUG Found workspace root: `/home/alex/test-workspace`
DEBUG Adding discovered workspace member: `/home/alex/test-workspace/packages/bird-feeder`
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 3 packages in 2ms
DEBUG Using request timeout of 30s
DEBUG Must revalidate requirement: pyspark
DEBUG Must revalidate requirement: py4j
DEBUG Acquired lock for `/tmp/.tmpXDJFA3/sdists-v9/pypi/pyspark/3.5.3`
DEBUG No cache entry for: https://files.pythonhosted.org/packages/10/30/a58b32568f1623aaad7db22aa9eafc4c6c194b429ff35bdc55ca2726da47/py4j-0.10.9.7-py2.py3-none-any.whl
DEBUG No cache entry for: https://files.pythonhosted.org/packages/9a/90/cb80c8cf194958ab9a3242851c62fa5aef1a0b42f2d9642f1e2eca098005/pyspark-3.5.3.tar.gz
DEBUG Downloading source distribution: pyspark==3.5.3
   Building pyspark==3.5.3
DEBUG Building: pyspark==3.5.3
DEBUG Assessing Python executable as base candidate: /home/alex/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12
DEBUG Using base executable for virtual environment: /home/alex/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.12.8
DEBUG Solving with target Python version: >=3.12.8
DEBUG Adding direct dependency: setuptools>=40.8.0
DEBUG No cache entry for: https://pypi.org/simple/setuptools/
...
DEBUG Searching for a compatible version of setuptools (>=40.8.0)
DEBUG Selecting: setuptools==78.0.1 [compatible] (setuptools-78.0.1-py3-none-any.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/42/c8/3faed884acdb2c1f2eb353cbacdd1ee4943de89a199d1f622ebefb6170e5/setuptools-78.0.1-py3-none-any.whl.metadata
DEBUG Tried 1 versions: setuptools 1
DEBUG marker environment resolution took 0.187s
DEBUG Installing in setuptools==78.0.1 in /tmp/.tmpXDJFA3/builds-v0/.tmprOwTmX
DEBUG Must revalidate requirement: setuptools
DEBUG Downloading and building requirement for build: setuptools==78.0.1
DEBUG No cache entry for: https://files.pythonhosted.org/packages/42/c8/3faed884acdb2c1f2eb353cbacdd1ee4943de89a199d1f622ebefb6170e5/setuptools-78.0.1-py3-none-any.whl
DEBUG Installing build requirement: setuptools==78.0.1
DEBUG Creating PEP 517 build environment
...
DEBUG Released lock at `/tmp/.tmpXDJFA3/sdists-v9/pypi/pyspark/3.5.3/.lock`
  × Failed to build `pyspark==3.5.3`
  ...
  help: `pyspark` (v3.5.3) was included because `bird-feeder` (v0.0.0) depends on `pyspark`
```

The actual build error seems irrelevant, but this came up due to [the breaking change in setuptools 78](https://github.com/pypa/setuptools/issues/4910#issuecomment-2748734607).

### Platform

Linux 4.4.0-22621-Microsoft x86_64 GNU/Linux

### Version

0.6.9

### Python version

3.12.8

---

_Label `bug` added by @alex-debrecht-kcftech on 2025-03-24 17:04_

---

_Comment by @alex-debrecht-kcftech on 2025-03-24 17:09_

Adding
```toml
[tool.uv]
build-constraint-dependencies = ["setuptools<78"]
```

to the `bird-feeder` `pyproject.toml` has no effect, as documented.

---

_Referenced in [pypa/setuptools#4910](../../pypa/setuptools/issues/4910.md) on 2025-03-24 17:10_

---

_Comment by @notatallshaw on 2025-03-24 17:12_

This is a duplicate of https://github.com/astral-sh/uv/issues/12441, workaround provided in https://github.com/astral-sh/uv/issues/12440

---

_Closed by @alex-debrecht-kcftech on 2025-03-24 17:28_

---
