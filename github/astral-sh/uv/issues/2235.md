---
number: 2235
title: "CI/Github Action Failed to extract archive: /home/runner/.cache/uv/.tmppavima/extracted"
type: issue
state: closed
author: anilbey
labels:
  - bug
assignees: []
created_at: 2024-03-06T09:23:46Z
updated_at: 2025-02-10T18:05:54Z
url: https://github.com/astral-sh/uv/issues/2235
synced_at: 2026-01-07T12:31:14-06:00
---

# CI/Github Action Failed to extract archive: /home/runner/.cache/uv/.tmppavima/extracted

---

_Issue opened by @anilbey on 2024-03-06 09:23_

Hello, 

There is this small error that occurs only in the first CI run. When the CI is run the first time it says failed to extract archive (pointing to the .cache directory).

```
  Caused by: Failed to build: bluecellulab @ file:///home/runner/work/BlueCelluLab/BlueCelluLab/.tox/.tmp/package/1/bluecellulab-0.0.1.dev1.tar.gz
  Caused by: Failed to extract archive: /home/runner/.cache/uv/.tmppavima/extracted
  Caused by: failed to unpack `/home/runner/.cache/uv/.tmppavima/extracted/bluecellulab-0.0.1.dev1/tests/examples/circuit_sonata_quick_scx_multi_circuit/components/CircuitB/mo`
  Caused by: failed to unpack `bluecellulab-0.0.1.dev1/tests/examples/circuit_sonata_quick_scx_multi_circuit/components/CircuitB/mo` into `/home/runner/.cache/uv/.tmppavima/extracted/bluecellulab-0.0.1.dev1/tests/examples/circuit_sonata_quick_scx_multi_circuit/components/CircuitB/mo`
  Caused by: Is a directory (os error 21)
```

When I restart the CI in the 2nd attempt, it works perfectly fine. This pattern repeats in every CI run. First one fails, the second one succeeds.

here are the CI logs. The uv version, Python version and the other dependencies are all listed in the logs below.
https://github.com/BlueBrain/BlueCelluLab/actions/runs/8169106907/job/22332500653

---

_Comment by @anilbey on 2024-03-06 09:24_

Logs from the successful run (2nd attempt): https://github.com/BlueBrain/BlueCelluLab/actions/runs/8169106907/job/22334002556

---

_Label `bug` added by @charliermarsh on 2024-03-06 13:35_

---

_Comment by @charliermarsh on 2024-03-06 13:35_

Thanks!

---

_Comment by @charliermarsh on 2024-03-06 17:25_

My read of the trace is that for some reason `bluecellulab-0.0.1.dev1/tests/examples/circuit_sonata_quick_scx_multi_circuit/components/CircuitB/mo` is not marked as a directory in the archive, i.e., the headers don't indicate that it's a directory. Any idea how the source distribution is being built? (Is that path a symlink, or something like that?)

---

_Comment by @anilbey on 2024-03-07 16:51_

Oh I see. Those directories contain static files required to run some tests and those are excluded from the package.


---

_Comment by @anilbey on 2024-03-12 09:18_

With the newer versions of uv and tox-uv, restarting the workflow does not change the outcome. If the cache fails, the whole workflow fails.

I rolled back to uv==0.1.14 and tox-uv==1.4.0

---

_Referenced in [BlueBrain/BlueCelluLab#149](../../BlueBrain/BlueCelluLab/pulls/149.md) on 2024-03-13 14:24_

---

_Comment by @charliermarsh on 2024-03-22 04:59_

Is there any way you could extract and share the `bluecellulab-0.0.1.dev1.tar.gz` file from the failing run?

---

_Label `needs-mre` added by @charliermarsh on 2024-03-22 17:16_

---

_Comment by @anilbey on 2024-03-25 10:09_

Unfortunately I cannot access the data from the github actions. It is not listed in the Artifacts section.

---

_Comment by @AlessandroPomponio on 2024-04-19 13:22_

I've seen the same thing happen with the latest versions of uv as well. Sometimes it takes multiple restarts for it to work.
Unfortunately I can't provide the tar archive either :(

---

_Comment by @anilbey on 2024-04-19 14:23_

A couple of times it happened in my local as well but at that time I was in the middle of some other task and later I couldn't reproduce it.
It is a Heisenbug :)

---

_Comment by @DetachHead on 2025-01-30 08:34_

not sure if this helps at all but i've noticed this happening much more frequently since updating from uv 0.5.20 to 0.5.24. i've added a step to my CI to upload the relevant files so i'll share that here next time it happens

---

_Comment by @DetachHead on 2025-01-30 09:22_

ok it happened first try:

```
   √ó Failed to build `/home/runner/work/basedpyright/basedpyright`
  ‚îú‚îÄ‚ñ∂ failed to unpack
  ‚îÇ   `/home/runner/.cache/uv/sdists-v6/.tmppLstqH/basedpyright-1.26.0/packages/pyright-internal/typeshed-fallback/stubs/aws-xray-sdk/aws_xray_sdk/core`
  ‚îú‚îÄ‚ñ∂ failed to unpack
  ‚îÇ   `basedpyright-1.26.0/packages/pyright-internal/typeshed-fallback/stubs/aws-xray-sdk/aws_xray_sdk/core`
  ‚îÇ   into
  ‚îÇ   `/home/runner/.cache/uv/sdists-v6/.tmppLstqH/basedpyright-1.26.0/packages/pyright-internal/typeshed-fallback/stubs/aws-xray-sdk/aws_xray_sdk/core`
  ‚ï∞‚îÄ‚ñ∂ Is a directory (os error 21)
```

[here's the run](https://github.com/DetachHead/basedpyright/actions/runs/13048414283/job/36404010126?pr=1029) and [here's the whole uv cache directory](https://github.com/DetachHead/basedpyright/actions/runs/13048414283/artifacts/2509320401), but i couldn't find any of those paths inside it. do they get moved or deleted after the build fails or something? let me know if you need any more info or artifacts and i'll try to provide them

---

_Comment by @patrickhulce on 2025-02-03 15:30_

I have the same Heisenbug-like behavior here across a few different projects. In case it helps investigate, for me at least it's always on a directory with a git submodule.

---

_Comment by @felnne on 2025-02-04 21:55_

I'm also experiencing this nearly constantly. Dropping back to 0.5.19 seems to fix it though.

---

_Comment by @charliermarsh on 2025-02-04 22:33_

Interesting -- I will take a look, thanks. (Does the submodule thing apply to anyone else's projects?)

---

_Comment by @charliermarsh on 2025-02-04 22:37_

The trace suggests there's... something wrong with the tar file itself that's been built? Like, the `basedpyright-1.26.0/packages/pyright-internal/typeshed-fallback/stubs/aws-xray-sdk/aws_xray_sdk/core` entry isn't being considered a "directory".

---

_Comment by @DetachHead on 2025-02-04 23:48_

mines not a submodule. the only thing of note i can think of is that im bundling all the typeshed stubs so theres a lot of files in there 

---

_Comment by @charliermarsh on 2025-02-05 00:01_

Could be related? I'm not sure. I'm gonna go through `tar-rs` and see if we're missing any changes from upstream in our async-oriented fork.

---

_Comment by @felnne on 2025-02-05 09:41_

> Does the submodule thing apply to anyone else's projects?

Mine isn't either these are the sort of errors I get:

```
Building source distribution...
  √ó Failed to build `/builds/MAGIC/assets-tracking-service`
  ‚îú‚îÄ‚ñ∂ failed to unpack
  ‚îÇ   `/builds/MAGIC/assets-tracking-service/.uv-cache/sdists-v7/.tmpl3VH14/assets_tracking_service-0.0.0.post45/.uv-cache/sdists-v7/pypi/arcgis/2.4.0/YNtoI0PDe5rTJdNyzq2A4/src`
  ‚îú‚îÄ‚ñ∂ failed to unpack
  ‚îÇ   `assets_tracking_service-0.0.0.post45/.uv-cache/sdists-v7/pypi/arcgis/2.4.0/YNtoI0PDe5rTJdNyzq2A4/src`
  ‚îÇ   into
  ‚îÇ   `/builds/MAGIC/assets-tracking-service/.uv-cache/sdists-v7/.tmpl3VH14/assets_tracking_service-0.0.0.post45/.uv-cache/sdists-v7/pypi/arcgis/2.4.0/YNtoI0PDe5rTJdNyzq2A4/src`
  ‚ï∞‚îÄ‚ñ∂ Is a directory (os error 21)
```

Most recently I was getting this error consistently which prompted me to rollback to 0.5.19 (I'm not sure if it's exactly the same problem but I assume related):

```
$ uv build
Building source distribution...
  √ó Failed to build `/builds/MAGIC/assets-tracking-service`
  ‚îú‚îÄ‚ñ∂ failed to unpack
  ‚îÇ   `/builds/MAGIC/assets-tracking-service/.uv-cache/sdists-v7/.tmpRCOa4v/assets_tracking_service-0.4.2/.uv-cache/builds-v0/.tmprScxgk/lib/python3.11/site-packages/hatchling/__about__.py`
  ‚ï∞‚îÄ‚ñ∂ No such file or directory (os error 2) while canonicalizing
      /builds/MAGIC/assets-tracking-service/.uv-cache/sdists-v7/.tmpRCOa4v/assets_tracking_service-0.4.2/.uv-cache/builds-v0/.tmprScxgk/lib/python3.11/site-packages/hatchling/assets_tracking_service-0.4.2/.uv-cache/archive-v0/gq0qJxV0iQijn3Zm5EYb6/hatchling/__about__.py
```



---

_Comment by @charliermarsh on 2025-02-05 13:49_

The second trace you referenced there is unrelated. It was fixed in v0.5.28.

---

_Comment by @charliermarsh on 2025-02-05 16:15_

I'm trying to reproduce this: https://github.com/astral-sh/uv/pull/11249

---

_Assigned to @charliermarsh by @charliermarsh on 2025-02-05 16:15_

---

_Comment by @charliermarsh on 2025-02-05 19:56_

@DetachHead -- I've been trying to get this to trigger [here](https://github.com/astral-sh/uv/actions/runs/13164683476), with a modified build that persists everything in the cache. It hasn't failed yet, though. Any ideas on where I could be divering?


---

_Comment by @DetachHead on 2025-02-05 23:50_

only thing i can think of is the uv version is newer (i'm currently on 0.5.24), i can try bumping uv and see if it still happens. my ci is quite a mess so i'll try to see if i can make a cut down version that reproduces the issue.

---

_Comment by @charliermarsh on 2025-02-06 00:00_

I'll try bumping down to 0.5.24 for good measure.

---

_Comment by @DetachHead on 2025-02-08 12:42_

confirmed still happening on uv 0.5.29. i made a branch that runs the same thing in a matrix of 10 jobs and removed the steps that make it take half an hour to run https://github.com/DetachHead/basedpyright/actions/runs/13215596833/job/36894495570?pr=1047


---

_Comment by @charliermarsh on 2025-02-08 13:17_

Great, thank you! I‚Äôll try to patch in my changes and re-run.

---

_Comment by @charliermarsh on 2025-02-08 19:44_

Were you able to trigger this on your first try? I can't get it to fail.

---

_Comment by @DetachHead on 2025-02-09 01:37_

that time it failed first try, but i ran it again with `fail-fast: false` in a matrix of 20 jobs and it looks like it has about a 1 in 10 chance of failing https://github.com/DetachHead/basedpyright/actions/runs/13221110183/job/36906253949?pr=1047

---

_Comment by @charliermarsh on 2025-02-09 02:03_

Ok I _think_ I was able to reproduce and now have my hands on the failing `.tar.gz` file...

---

_Comment by @charliermarsh on 2025-02-09 02:37_

Ok, I've confirmed that it's this issue: https://github.com/astral-sh/tokio-tar/pull/1

---

_Label `needs-mre` removed by @charliermarsh on 2025-02-09 02:37_

---

_Comment by @charliermarsh on 2025-02-09 02:37_

Attaching the archive that `tokio-tar` fails to unpack (but `tar-rs` unpacks without issue): [basedpyright-1.26.0.tar.gz](https://github.com/user-attachments/files/18722926/basedpyright-1.26.0.tar.gz)

---

_Referenced in [astral-sh/tokio-tar#1](../../astral-sh/tokio-tar/pulls/1.md) on 2025-02-09 02:39_

---

_Comment by @charliermarsh on 2025-02-09 03:19_

I _think_ I have a fix here: https://github.com/astral-sh/tokio-tar/pull/40. It now successfully unpacks the linked archive.

---

_Referenced in [astral-sh/uv#11359](../../astral-sh/uv/pulls/11359.md) on 2025-02-09 18:58_

---

_Closed by @charliermarsh on 2025-02-09 19:14_

---

_Closed by @charliermarsh on 2025-02-09 19:14_

---

_Comment by @charliermarsh on 2025-02-09 19:15_

Should be fixed in the next release.

---

_Comment by @DetachHead on 2025-02-10 00:10_

thank you! i really appreciate your work narrowing down these difficult to reproduce issues. on any other project bugs like these would never get fixed

---

_Comment by @charliermarsh on 2025-02-10 01:10_

Thanks for your help! I'm so happy that we were able to fix it.

---

_Referenced in [DetachHead/basedpyright#1053](../../DetachHead/basedpyright/pulls/1053.md) on 2025-02-10 10:30_

---

_Comment by @patrickhulce on 2025-02-10 16:28_

> i really appreciate your work narrowing down these difficult to reproduce issues. on any other project bugs like these would never get fixed

Big +1 here. This is what sets uv apart. When colleagues express adoption hesitation about uv being new, this is what I tell them and interactions like this are what make me an evangelist.

Thanks for all your work! üôè 

---

_Comment by @thiago-pythonic on 2025-02-10 18:02_

Thanks for the quick action, @charliermarsh!

Is there a workaround to prevent this from happening while the new release isn't available? This continues to happen even after rolling back to `uv` 0.5.13.

---

_Comment by @charliermarsh on 2025-02-10 18:05_

No, but we'll probably release today.

---

_Comment by @thiago-pythonic on 2025-02-10 18:05_

Sounds great! Thanks!

---
