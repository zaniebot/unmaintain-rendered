---
number: 13024
title: "`uv publish` test flakes on `test.pypi.org` during re-upload check"
type: issue
state: open
author: zanieb
labels:
  - testing
  - ci-flake
assignees: []
created_at: 2025-04-21T20:08:34Z
updated_at: 2025-05-30T21:16:48Z
url: https://github.com/astral-sh/uv/issues/13024
synced_at: 2026-01-07T12:31:15-06:00
---

# `uv publish` test flakes on `test.pypi.org` during re-upload check

---

_Issue opened by @zanieb on 2025-04-21 20:08_

```
=== 3. Publishing astral-test-token 0.1.6663 again with index ===
DEBUG uv 0.6.14 (65782814c 2025-04-21)
DEBUG Starting Python discovery for Python 3.12
DEBUG Looking for exact match for request Python 3.12
DEBUG Searching for Python 3.12 in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.12.10-linux-x86_64-gnu` at `/home/runner/.cache/uv/environments-v2/test-publish-2a582df2afcfc9c5/bin/python3` (active virtual environment)
DEBUG Using Python 3.12.10 interpreter at /home/runner/.cache/uv/environments-v2/test-publish-2a582df2afcfc9c5/bin/python3 for builds
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.10
DEBUG Solving with target Python version: >=3.12
DEBUG Adding direct dependency: astral-test-token*
DEBUG Found stale response for: https://test.pypi.org/simple/astral-test-token/
DEBUG Sending revalidation request for: https://test.pypi.org/simple/astral-test-token/
DEBUG Found not-modified response for: https://test.pypi.org/simple/astral-test-token/
DEBUG Searching for a compatible version of astral-test-token (*)
DEBUG Selecting: astral-test-token==0.1.6663 [compatible] (astral_test_token-0.1.6663-py3-none-any.whl)
DEBUG Found fresh response for: https://test-files.pythonhosted.org/packages/04/06/9dbda8dec4d424a154e892ef5c5fed4685ffab1c9f655c1a213e10fcd0a4/astral_test_token-0.1.6663-py3-none-any.whl.metadata
DEBUG Tried 1 versions: astral-test-token 1
DEBUG marker environment resolution took 0.072s
Traceback (most recent call last):
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 559, in <module>
    main()
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 555, in main
    publish_project(project_name, uv, client)
  File "/home/runner/work/uv/uv/scripts/publish/test_publish.py", line 459, in publish_project
    raise RuntimeError(
RuntimeError: Re-upload with check URL failed: 1 != 0, 1 != 2
---
DEBUG uv 0.6.14 (65782814c 2025-04-21)
DEBUG Publishing with index test-pypi
DEBUG Not a distribution filename: `.DS_Store`
DEBUG Not a distribution filename: `.gitignore`
Publishing 2 files https://test.pypi.org/legacy/
DEBUG Using request timeout of 900s
DEBUG Checking for astral_test_token-0.1.6663-py3-none-any.whl in the registry
DEBUG Found stale response for: https://test.pypi.org/simple/astral-test-token/
DEBUG Sending revalidation request for: https://test.pypi.org/simple/astral-test-token/
DEBUG Found modified response for: https://test.pypi.org/simple/astral-test-token/
Uploading astral_test_token-0.1.6663-py3-none-any.whl (6.7KiB)
DEBUG Hashing dist/astral_test_token-0.1.6663-py3-none-any.whl
DEBUG Using HTTP Basic authentication
DEBUG Response code for https://test.pypi.org/legacy/: [200](https://github.com/astral-sh/uv/actions/runs/14580070015/job/40894769725?pr=10662#step:7:201) OK
TRACE Response headers for https://test.pypi.org/legacy/: Response { url: "https://test.pypi.org/legacy/", status: 200, headers: {"content-type": "application/json", "accept-ranges": "bytes", "content-security-policy": "base-uri 'self'; connect-src 'self' https://api.github.com/repos/ https://api.github.com/search/issues https://gitlab.com/api/ https://analytics.python.org fastly-insights.com *.fastly-insights.com *.ethicalads.io https://api.pwnedpasswords.com https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/sre/mathmaps/; default-src 'none'; font-src 'self' fonts.gstatic.com; form-action 'self' https://checkout.stripe.com; frame-ancestors 'none'; frame-src 'none'; img-src 'self' https://testpypi-camo.freetls.fastly.net/ *.fastly-insights.com *.ethicalads.io ethicalads.blob.core.windows.net; script-src 'self' https://analytics.python.org *.fastly-insights.com *.ethicalads.io 'sha256-U3hKDidudIaxBDEzwGJApJgPEf2mWk6cfMWghrAa6i0=' https://cdn.jsdelivr.net/npm/mathjax@3.2.2/ 'sha256-1CldwzdEg2k1wTmf7s5RWVd7NMXI/7nxxjJM2C4DqII=' 'sha256-0POaN8stWYQxhzjKS+/eOfbbJ/u4YHO5ZagJvLpMypo='; style-src 'self' fonts.googleapis.com *.ethicalads.io 'sha256-2YHqZokjiizkHi1Zt+6ar0XJ0OeEy/egBnlm+MDMtrM=' 'sha256-47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=' 'sha256-JLEjeN9e5dGsz5475WyRaoA4eQOdNPxDIeUhclnJDCE=' 'sha256-mQyxHEuwZJqpxCw3SLmc4YOySNKXunyu2Oiz1r3/wAE=' 'sha256-OCf+kv5Asiwp++8PIevKBYSgnNLNUZvxAp4a7wMLuKA=' 'sha256-h5LOiLhk6wiJrGsG5ItM0KimwzWQH/yAcmoJDJL//bY='; worker-src *.fastly-insights.com", "referrer-policy": "origin-when-cross-origin", "date": "Mon, 21 Apr 2025 19:44:19 GMT", "x-served-by": "cache-sjc1000122-SJC, cache-sjc1000135-SJC", "x-cache": "MISS, MISS", "x-cache-hits": "0, 0", "x-timer": "S1745264659.731400,VS0,VE357", "vary": "Cookie, Authorization, Cookie", "strict-transport-security": "max-age=31536000; includeSubDomains; preload", "x-frame-options": "deny", "x-xss-protection": "1; mode=block", "x-content-type-options": "nosniff", "x-permitted-cross-domain-policies": "none", "permissions-policy": "publickey-credentials-create=(self),publickey-credentials-get=(self),accelerometer=(),ambient-light-sensor=(),autoplay=(),battery=(),camera=(),display-capture=(),document-domain=(),encrypted-media=(),execution-while-not-rendered=(),execution-while-out-of-viewport=(),fullscreen=(),gamepad=(),geolocation=(),gyroscope=(),hid=(),identity-credentials-get=(),idle-detection=(),local-fonts=(),magnetometer=(),microphone=(),midi=(),otp-credentials=(),payment=(),picture-in-picture=(),screen-wake-lock=(),serial=(),speaker-selection=(),storage-access=(),usb=(),web-share=(),xr-spatial-tracking=()", "content-length": "58"} }
TRACE Response content for https://test.pypi.org/legacy/: {"message": "\n\n\n\n\n", "code": "200 OK", "title": "OK"}
INFO Upload succeeded
DEBUG Checking for astral_test_token-0.1.6663.tar.gz in the registry
DEBUG Found stale response for: https://test.pypi.org/simple/astral-test-token/
DEBUG Sending revalidation request for: https://test.pypi.org/simple/astral-test-token/
DEBUG Found modified response for: https://test.pypi.org/simple/astral-test-token/
DEBUG Hashing dist/astral_test_token-0.1.6663.tar.gz
DEBUG Found astral_test_token-0.1.6663.tar.gz in the registry with matching hash 805b910e9cc7e023f8a20abe1e28b60cac7064bb979c9d696239ffd89b7f92a4
File astral_test_token-0.1.6663.tar.gz already exists, skipping
```

https://github.com/astral-sh/uv/actions/runs/14580070015/job/40894769725?pr=10662

---

_Label `testing` added by @zanieb on 2025-04-21 20:08_

---

_Label `ci-flake` added by @zanieb on 2025-05-30 21:16_

---
