---
number: 16661
title: uv export not correctly handling extra markers
type: issue
state: open
author: jsiverskog
labels:
  - bug
assignees: []
created_at: 2025-11-10T09:06:35Z
updated_at: 2025-11-10T12:49:09Z
url: https://github.com/astral-sh/uv/issues/16661
synced_at: 2026-01-07T13:12:19-06:00
---

# uv export not correctly handling extra markers

---

_Issue opened by @jsiverskog on 2025-11-10 09:06_

### Summary

hi,
i have a project that (among other things) have a package setup like this:
```
[project]
name = "my-project"
version = "0.0.0"
requires-python = ">=3.11"
dependencies = [
  "opencv-python-headless==4.12.0.88; extra != 'dev'",
]

[project.optional-dependencies]
dev = [
  "opencv-python==4.12.0.88",
]
```
running `uv export` yields:
```
DEBUG uv 0.9.8
DEBUG Acquired shared lock for `[...]`
DEBUG Found project root: `[...]`
DEBUG No workspace root found, using project root
DEBUG Reading Python requests from version file at `[...]/.python-version`
DEBUG Using Python request `3.11.13` from version file at `.python-version`
DEBUG Checking for Python environment at: `[...]`
DEBUG The project environment's Python version satisfies the request: `Python 3.11.13`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: my-project @ file:///[...]
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 3 packages in 0.46ms
# This file was autogenerated by uv via the following command:
#    uv export
DEBUG Released lock at `[...]/.cache/uv/.lock`
```

the issue can be reproduced also without the `project.optional-dependencies` extra specification:
```
[project]
name = "my-project"
version = "0.0.0"
requires-python = ">=3.11"
dependencies = [
  "opencv-python-headless==4.12.0.88; extra != 'dev'",
]
```

```
> uv export --verbose 
DEBUG uv 0.9.8
DEBUG Acquired shared lock for [...]
DEBUG Found project root: `[...]`
DEBUG No workspace root found, using project root
DEBUG Reading Python requests from version file at `[...]/.python-version`
DEBUG Using Python request `3.11.13` from version file at `.python-version`
DEBUG Checking for Python environment at: `[...]`
DEBUG The project environment's Python version satisfies the request: `Python 3.11.13`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: my-project @ file:///[...]
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 1 package in 0.48ms
# This file was autogenerated by uv via the following command:
#    uv export
DEBUG Released lock at `[...]/.cache/uv/.lock`
```

in both cases i would expect `opencv-python-headless==4.12.0.88` to be exported.

### Platform

Linux 6.17.7-061707-generic x86_64 GNU/Linux

### Version

uv 0.9.8

### Python version

python 3.11.13

---

_Label `bug` added by @jsiverskog on 2025-11-10 09:06_

---

_Comment by @konstin on 2025-11-10 11:31_

This is a limitation with the `extra` marker: It allows only using `extra == "<name>"`, and only in a top level conjunction of a marker. Basically, everything that isn't expressible through `project.optional-dependencies` isn't supported, or put another way round, you should never need to write an `extra` marker in `[project]` yourself, this should be abstracted away by `project.optional-dependencies`.

---

_Comment by @jsiverskog on 2025-11-10 12:05_

@konstin : right. is this something that will change? we have our reasons for doing as we're doing, but i guess we need to see if we can use `project.optional-dependencies` for both cases.

---

_Comment by @konstin on 2025-11-10 12:49_

I don't think so, the way markers work is loadbearing in some places across the ecosystem, including uv's resolver (it assumes extras are purely additional so packages can never be removed from the resolution graph once selected). We are interested though in adding better support for switching packages between different implementations, there are several cases where this comes up. The closest we currently have is conflicts (https://docs.astral.sh/uv/concepts/projects/config/#conflicting-dependencies).

---
