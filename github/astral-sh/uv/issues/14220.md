---
number: 14220
title: "Replace transitive dependencies? `opencv-python` -> `opencv-python-headless`"
type: issue
state: closed
author: afaulconbridge
labels:
  - question
  - great writeup
assignees: []
created_at: 2025-06-23T16:21:36Z
updated_at: 2025-10-31T14:18:34Z
url: https://github.com/astral-sh/uv/issues/14220
synced_at: 2026-01-07T12:31:16-06:00
---

# Replace transitive dependencies? `opencv-python` -> `opencv-python-headless`

---

_Issue opened by @afaulconbridge on 2025-06-23 16:21_

### Question

I couldn't see this scenario in the docs, nor in existing issues, but I think I can't be the only one whod have it.

As you may know, popular computer vision library OpenCV has two python packages `opencv-python` and `opencv-python-headless`. The `opencv-python` requires various graphical dependencies, so on many devices it won't work; for such cases the `-headless` exists. If _both_ are installed together, bad stuff happens.

Many packages are built on top of OpenCV - I'm trying to use both [Ultraltyics ](https://github.com/ultralytics/ultralytics) and [Supervsion ](https://github.com/roboflow/supervision) for image processing for instance. These packages list the `opencv-python` package as a dependency, and as a consequence won't work on headless machines that need the `opencv-python-headless` package.

Can UV be configured to always replace `opencv-python` to  `opencv-python-headless` when calculating dependencies, no matter how deep? Note that this is about changing the package itself, not the versions used.

(the root cause is probably OpenCV's packaging decisions, but its large and legacy and can't really be changed at this point)

### Platform

all

### Version

0.7.13

---

_Label `question` added by @afaulconbridge on 2025-06-23 16:21_

---

_Comment by @konstin on 2025-06-23 16:40_

While we're not yet supporting proper dependency exclusions (https://github.com/astral-sh/uv/issues/12616), you hack this in by using an override with an impossible platform marker, then add `opencv-python-headless` as a regular dependency:

```toml
[tool.uv]
override-dependencies = [
  "opencv-python; python_version < '0'"
]
```

---

_Label `great writeup` added by @konstin on 2025-06-23 16:41_

---

_Comment by @afaulconbridge on 2025-06-23 21:21_

Many thanks for answering. I can confirm this solution works, though it feels strange to have an unfullfillable dependency that doesn't cause any errors.

---

_Comment by @konstin on 2025-06-24 10:40_

It's a little more silly than that: You can regularly have dependency that can't match due to their Python version, e.g. if a dependency says `importlib-metadata; python_version < '3.9'` but you have `requires-python = "python_version > '3.11'"`. These just get filter out and ignored. For overrides, the twist is that we replace all dependencies on the package with the override, no matter their marker. So the only dependency on the package that remains is one that gets filtered out. But of course it's true, this is a hack and proper exclude support is better.

---

_Comment by @afaulconbridge on 2025-06-24 13:32_

Oh yes, I get it now. Typically that `python_version` specifier is used on backported functionallity isn't it? So the platform marker could be read like "only use this dependency if `python < 3..9`, otherwise ignore". That's actually pretty close to one way the underlying problem can be expressed - "only use this dependency if there is (not) GUI support". So it's not as hacky as it looked at first glance!

I think this addresses the original question, so this issues can be closed.

---

_Closed by @konstin on 2025-06-24 13:40_

---

_Referenced in [ultralytics/ultralytics#20385](../../ultralytics/ultralytics/issues/20385.md) on 2025-06-25 14:10_

---

_Referenced in [roboflow/supervision#1861](../../roboflow/supervision/issues/1861.md) on 2025-07-02 09:57_

---

_Comment by @Satge96 on 2025-09-09 09:16_

We use the following:
[tool.uv]override-dependencies = ["opencv-python; sys_platform == 'never'"]
or when not wanting the headless:
[tool.uv]override-dependencies = ["opencv-python-headless; sys_platform == 'never'"]
Are there any opinions on if this is better or worse than the trick with the Python version?

---

_Comment by @charliermarsh on 2025-10-31 14:18_

Heads up, we just added support for excluding dependencies entirely by name: https://github.com/astral-sh/uv/pull/16528 (available in the next release)

---
