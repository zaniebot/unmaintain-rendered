---
number: 14671
title: "unclear how to `uv add causal-conv1d`"
type: issue
state: closed
author: riklopfer
labels:
  - question
assignees: []
created_at: 2025-07-16T20:29:36Z
updated_at: 2025-11-03T02:34:49Z
url: https://github.com/astral-sh/uv/issues/14671
synced_at: 2026-01-07T12:31:16-06:00
---

# unclear how to `uv add causal-conv1d`

---

_Issue opened by @riklopfer on 2025-07-16 20:29_

### Question


When I try to add [`causal-conv1d`](https://github.com/Dao-AILab/causal-conv1d) to my project, I get a series of errors. This dependency is only needed on machines with a CUDA device. With that in mind, I also tried `uv add "causal-conv1d; sys_platform == 'linux'"` but received the same error. I also tried doing `uv add torch` first. It's possible that "causal-conv1d" can only be built when the CUDA libs are installed but I'm not certain about that. 

```console
❯ uv add causal-conv1d
  × Failed to build `causal-conv1d==1.5.0.post8`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File "<string>", line 14, in <module>
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmp8zLtL2/lib/python3.12/site-packages/setuptools/build_meta.py", line 331,
      in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmp8zLtL2/lib/python3.12/site-packages/setuptools/build_meta.py", line 301,
      in _get_build_requires
          self.run_setup()
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmp8zLtL2/lib/python3.12/site-packages/setuptools/build_meta.py", line 512,
      in run_setup
          super().run_setup(setup_script=setup_script)
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmp8zLtL2/lib/python3.12/site-packages/setuptools/build_meta.py", line 317,
      in run_setup
          exec(code, locals())
        File "<string>", line 20, in <module>
      ModuleNotFoundError: No module named 'torch'

      hint: This error likely indicates that `causal-conv1d@1.5.0.post8` depends on `torch`, but doesn't declare it as a
      build dependency. If `causal-conv1d` is a first-party package, consider adding `torch` to its `build-system.requires`.
      Otherwise, `uv pip install torch` into the environment and re-run with `--no-build-isolation`.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and
        syncing.
```


### Platform

Darwin 24.5.0 arm64

### Version

uv 0.7.21 (77c771c7f 2025-07-14)

---

_Label `question` added by @riklopfer on 2025-07-16 20:29_

---

_Comment by @zanieb on 2025-07-16 20:33_

It looks like they require `--no-build-isolation` as hinted at

> hint: This error likely indicates that `causal-conv1d@1.5.0.post8` depends on `torch`, but doesn't declare it as a
>      build dependency. If `causal-conv1d` is a first-party package, consider adding `torch` to its `build-system.requires`.
>     Otherwise, `uv pip install torch` into the environment and re-run with `--no-build-isolation`.

---

_Comment by @riklopfer on 2025-07-16 20:51_

I tried that and I get the following error. Does this mean I need to add `setuptools`  too? 

```console
 ❯ uv add causal-conv1d --no-build-isolation
  × Failed to build `causal-conv1d==1.5.0.post8`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.prepare_metadata_for_build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File "<string>", line 8, in <module>
      ModuleNotFoundError: No module named 'setuptools'

      hint: This usually indicates a problem with the package or the build environment.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and
        syncing.
```

---

_Comment by @zanieb on 2025-07-16 21:15_

Yeah, you need to add its build dependencies manually since build isolation is disabled.

---

_Comment by @riklopfer on 2025-07-17 16:26_

The errors keep coming (pasted below). This package is only needed in environments when a CUDA device is present. Is there a way to specify that in `pyproject.toml` such that `uv lock` will work? 

I would like to do something like the snippet below where I the this package is installed as an extra when we know we have a CUDA device. But `uv lock` fails because it can't find torch and there is no build isolation flag available.  The fact that adding this dependency is so difficult makes me wonder if I am taking the wrong approach. Do I need to have a completely separate package for the GPU-enabled version? 

```toml
[project.optional-dependencies]
cuda = [
    "causal-conv1d>=1.5.0",
]
```



```console
❯ uv add causal-conv1d --no-build-isolation
  × Failed to build `causal-conv1d==1.5.0.post8`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.prepare_metadata_for_build_wheel` failed (exit status: 1)

      [stdout]


      torch.__version__  = 2.7.1



      [stderr]
      /Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/torch/_subclasses/functional_tensor.py:276:
      UserWarning: Failed to initialize NumPy: No module named 'numpy' (Triggered internally at
      /Users/runner/work/pytorch/pytorch/pytorch/torch/csrc/utils/tensor_numpy.cpp:81.)
        cpu = _conversion_method_template(device=torch.device("cpu"))
      <string>:113: UserWarning: causal_conv1d was requested, but nvcc was not found.  Are you sure your environment has nvcc
      available?  If you're installing within a container from https://hub.docker.com/r/pytorch/pytorch, only images whose
      names contain 'devel' will provide nvcc.
      Traceback (most recent call last):
        File "<string>", line 14, in <module>
        File "/Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/setuptools/build_meta.py", line 374, in
      prepare_metadata_for_build_wheel
          self.run_setup()
        File "/Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/setuptools/build_meta.py", line 512, in run_setup
          super().run_setup(setup_script=setup_script)
        File "/Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/setuptools/build_meta.py", line 317, in run_setup
          exec(code, locals())
        File "<string>", line 185, in <module>
      NameError: name 'bare_metal_version' is not defined

      hint: This usually indicates a problem with the package or the build environment.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and
        syncing.
```

here's the `uv lock` output when I add it as an extra with the TOML snippet from above. 

```console
❯ uv lock
  × Failed to build `causal-conv1d==1.5.0.post8`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File "<string>", line 14, in <module>
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmpIKTNSW/lib/python3.12/site-packages/setuptools/build_meta.py", line 331,
      in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmpIKTNSW/lib/python3.12/site-packages/setuptools/build_meta.py", line 301,
      in _get_build_requires
          self.run_setup()
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmpIKTNSW/lib/python3.12/site-packages/setuptools/build_meta.py", line 512,
      in run_setup
          super().run_setup(setup_script=setup_script)
        File "/Users/a9dwhzz/.cache/uv/builds-v0/.tmpIKTNSW/lib/python3.12/site-packages/setuptools/build_meta.py", line 317,
      in run_setup
          exec(code, locals())
        File "<string>", line 20, in <module>
      ModuleNotFoundError: No module named 'torch'

      hint: This error likely indicates that `causal-conv1d@1.5.0.post8` depends on `torch`, but doesn't declare it as a
      build dependency. If `causal-conv1d` is a first-party package, consider adding `torch` to its `build-system.requires`.
      Otherwise, `uv pip install torch` into the environment and re-run with `--no-build-isolation`.
  help: `causal-conv1d` (v1.5.0.post8) was included because `xxx[cuda]` (v0.1.0) depends on `causal-conv1d>=1.5.0`
```






---

_Comment by @riklopfer on 2025-07-17 17:24_

I found this https://github.com/Zyphra/Zonos/issues/144 issue. I see on that repo how to add no build isolation when using `uv lock`, so now my `pyproject.toml` is 

```toml
[project]
name = "xxx"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = [
    "torch>=2.7.1",
    "setuptools>=80.9.0",
]

[project.optional-dependencies]
cuda = [
    "causal-conv1d>=1.5.0",
]

[tool.uv]
no-build-isolation-package = ["causal-conv1d"]
```

and here is the `uv lock` output


```console
❯ uv lock
  × Failed to build `causal-conv1d==1.5.0.post8`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.prepare_metadata_for_build_wheel` failed (exit status: 1)

      [stdout]


      torch.__version__  = 2.7.1



      [stderr]
      /Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/torch/_subclasses/functional_tensor.py:276:
      UserWarning: Failed to initialize NumPy: No module named 'numpy' (Triggered internally at
      /Users/runner/work/pytorch/pytorch/pytorch/torch/csrc/utils/tensor_numpy.cpp:81.)
        cpu = _conversion_method_template(device=torch.device("cpu"))
      <string>:113: UserWarning: causal_conv1d was requested, but nvcc was not found.  Are you sure your environment has nvcc
      available?  If you're installing within a container from https://hub.docker.com/r/pytorch/pytorch, only images whose
      names contain 'devel' will provide nvcc.
      Traceback (most recent call last):
        File "<string>", line 14, in <module>
        File "/Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/setuptools/build_meta.py", line 374, in
      prepare_metadata_for_build_wheel
          self.run_setup()
        File "/Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/setuptools/build_meta.py", line 512, in run_setup
          super().run_setup(setup_script=setup_script)
        File "/Users/a9dwhzz/tmp/xxx/.venv/lib/python3.12/site-packages/setuptools/build_meta.py", line 317, in run_setup
          exec(code, locals())
        File "<string>", line 185, in <module>
      NameError: name 'bare_metal_version' is not defined

      hint: This usually indicates a problem with the package or the build environment.
  help: `causal-conv1d` (v1.5.0.post8) was included because `xxx[cuda]` (v0.1.0) depends on `causal-conv1d>=1.5.0`
```



---

_Comment by @charliermarsh on 2025-11-03 02:34_

Like `flash-attn`, you need:

```toml
[project]
name = "project"
version = "0.1.0"
description = "..."
readme = "README.md"
requires-python = ">=3.12"
dependencies = ["causal-conv1d", "torch"]

[tool.uv.extra-build-dependencies]
causal-conv1d = [{ requirement = "torch", match-runtime = true }]

[tool.uv.extra-build-variables]
causal-conv1d = { CAUSAL_CONV1D_SKIP_CUDA_BUILD = "TRUE" }
```

---

_Assigned to @charliermarsh by @charliermarsh on 2025-11-03 02:34_

---

_Closed by @charliermarsh on 2025-11-03 02:34_

---
