---
number: 11791
title: "git-lfs doesn't work when LFS files are required to link against"
type: issue
state: closed
author: weshoke
labels:
  - needs-mre
assignees: []
created_at: 2025-02-26T05:41:36Z
updated_at: 2025-02-27T01:54:53Z
url: https://github.com/astral-sh/uv/issues/11791
synced_at: 2026-01-07T12:31:15-06:00
---

# git-lfs doesn't work when LFS files are required to link against

---

_Issue opened by @weshoke on 2025-02-26 05:41_

### Summary

I have a larger project where `UV_GIT_LFS=1` wasn't working to build from source when adding a module via `git+https`.  I made a smaller example to reproduce:

```
UV_GIT_LFS=1 uv -v add git+https://github.com/weshoke/test-bin-lfs
```

```
cache/uv/git-v0/checkouts/7b507fa0e455d7e1/205c20a/src/vendor/deps/libdeps.a'
      clang++: error: linker command failed with exit code 1 (use -v to see invocation)
      ninja: build stopped: subcommand failed.


      [stderr]
      2025-02-25 22:36:57,044 - scikit_build_core - WARNING - No license files found, set wheel.license-files to [] to suppress this warning

      *** CMake build failed
```

Listing out the `libdeps.a` file shows:

```
version https://git-lfs.github.com/spec/v1
oid sha256:39cdeb0ae304adbf8646986294a9f78a06a198e7d3d0c675a71d74e876b96720
size 4640
```

It's still a pointer to the LFS file and not the actual file pointed too despite `UV_GIT_LFS=1`

### Platform

Darwin 24.1.0 arm64

### Version

uv 0.6.3 (a0b9f22a2 2025-02-24)

### Python version

Python 3.12.7

---

_Label `bug` added by @weshoke on 2025-02-26 05:41_

---

_Comment by @zanieb on 2025-02-26 15:32_

cc @sydduckworth â€” no pressure, you just have more context here than me :)

---

_Comment by @zanieb on 2025-02-26 15:33_

And you have the `git-lfs` CLI installed? Can you share verbose logs?

---

_Comment by @sydduckworth on 2025-02-26 15:41_

~~I think the issue doesn't have anything to do with linking, I think it's because the files are in a Git Submodule.~~

---

_Comment by @weshoke on 2025-02-26 15:43_

@sydduckworth There is a submodule, but that's not the issue

```
âžœ pymod (main) âœ—  UV_GIT_LFS=1 uv -v add git+https://github.com/weshoke/test-bin-lfs
DEBUG uv 0.6.3 (a0b9f22a2 2025-02-24)
DEBUG Found project root: `/Users/wesleysmith/Documents/code/pymod`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/Users/wesleysmith/Documents/code/pymod`
DEBUG Reading Python requests from version file at `/Users/wesleysmith/Documents/code/pymod/.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG Searching for Python 3.12 in managed installations or search path
DEBUG Searching for managed installations at `/Users/wesleysmith/.local/share/uv/python`
DEBUG Found managed installation `cpython-3.12.7-macos-aarch64-none`
DEBUG Found `cpython-3.12.7-macos-aarch64-none` at `/Users/wesleysmith/.local/share/uv/python/cpython-3.12.7-macos-aarch64-none/bin/python3.12` (managed installations)
Using CPython 3.12.7
Creating virtual environment at: .venv
DEBUG Assessing Python executable as base candidate: /Users/wesleysmith/.local/share/uv/python/cpython-3.12.7-macos-aarch64-none/bin/python3.12
DEBUG Using base executable for virtual environment: /Users/wesleysmith/.local/share/uv/python/cpython-3.12.7-macos-aarch64-none/bin/python3.12
DEBUG Released lock at `/var/folders/3f/0073hkm56q76_vjw8nzk9n5r0000gn/T/uv-f6a7b58d0e379bf2.lock`
DEBUG Using request timeout of 30s
DEBUG Attempting GitHub fast path for: https://api.github.com/repos/weshoke/test-bin-lfs/commits/HEAD
DEBUG Attempting to fetch `pyproject.toml` from: https://raw.githubusercontent.com/weshoke/test-bin-lfs/7505b93fe95142a4974397f89ad226fb0898d0ad/pyproject.toml
DEBUG Found static metadata via GitHub fast path for: git+https://github.com/weshoke/test-bin-lfs
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: pymod @ file:///Users/wesleysmith/Documents/code/pymod
DEBUG No workspace root found, using project root
DEBUG Attempting to fetch `pyproject.toml` from: https://raw.githubusercontent.com/weshoke/test-bin-lfs/7505b93fe95142a4974397f89ad226fb0898d0ad/pyproject.toml
DEBUG Found static metadata via GitHub fast path for: bin-lfs @ git+https://github.com/weshoke/test-bin-lfs
DEBUG Solving with installed Python version: 3.12.7
DEBUG Solving with target Python version: >=3.12
DEBUG Adding direct dependency: pymod*
DEBUG Searching for a compatible version of pymod @ file:///Users/wesleysmith/Documents/code/pymod (*)
DEBUG Adding direct dependency: bin-lfs*
DEBUG Searching for a compatible version of bin-lfs @ git+https://github.com/weshoke/test-bin-lfs (*)
DEBUG Tried 2 versions: bin-lfs 1, pymod 1
DEBUG all marker environments resolution took 0.001s
Resolved 2 packages in 90ms
DEBUG Using request timeout of 30s
DEBUG Identified uncached distribution: bin-lfs @ git+https://github.com/weshoke/test-bin-lfs@7505b93fe95142a4974397f89ad226fb0898d0ad
DEBUG Fetching source distribution from Git: https://github.com/weshoke/test-bin-lfs
DEBUG Acquired lock for `https://github.com/weshoke/test-bin-lfs`
DEBUG Using existing Git source `https://github.com/weshoke/test-bin-lfs`
DEBUG Released lock at `/Users/wesleysmith/.cache/uv/git-v0/locks/7b507fa0e455d7e1`
DEBUG Acquired lock for `/Users/wesleysmith/.cache/uv/sdists-v8/git/22ef60b00d0f1052/7505b93fe95142a4`
   Building bin-lfs @ git+https://github.com/weshoke/test-bin-lfs@7505b93fe95142a4974397f89ad226fb0898d0ad
DEBUG Building: bin-lfs @ git+https://github.com/weshoke/test-bin-lfs@7505b93fe95142a4974397f89ad226fb0898d0ad
DEBUG No workspace root found, using project root
DEBUG Assessing Python executable as base candidate: /Users/wesleysmith/.local/share/uv/python/cpython-3.12.7-macos-aarch64-none/bin/python3.12
DEBUG Using base executable for virtual environment: /Users/wesleysmith/.local/share/uv/python/cpython-3.12.7-macos-aarch64-none/bin/python3.12
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.12.7
DEBUG Solving with target Python version: >=3.12.7
DEBUG Adding direct dependency: scikit-build-core*
DEBUG Found fresh response for: https://pypi.org/simple/scikit-build-core/
DEBUG Searching for a compatible version of scikit-build-core (*)
DEBUG Selecting: scikit-build-core==0.10.7 [compatible] (scikit_build_core-0.10.7-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/88/fe/90476c4f6a1b2f922efa00d26e876dd40c7279e28ec18f08f0851ad21ba6/scikit_build_core-0.10.7-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for scikit-build-core==0.10.7: packaging>=21.3
DEBUG Adding transitive dependency for scikit-build-core==0.10.7: pathspec>=0.10.1
DEBUG Found fresh response for: https://pypi.org/simple/packaging/
DEBUG Searching for a compatible version of packaging (>=21.3)
DEBUG Selecting: packaging==24.2 [compatible] (packaging-24.2-py3-none-any.whl)
DEBUG Found fresh response for: https://pypi.org/simple/pathspec/
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/88/ef/eb23f262cca3c0c4eb7ab1933c3b1f03d021f2c48f54763065b6f0e321be/packaging-24.2-py3-none-any.whl.metadata
DEBUG Searching for a compatible version of pathspec (>=0.10.1)
DEBUG Selecting: pathspec==0.12.1 [compatible] (pathspec-0.12.1-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/cc/20/ff623b09d963f88bfde16306a54e12ee5ea43e9b597108672ff3a408aad6/pathspec-0.12.1-py3-none-any.whl.metadata
DEBUG Tried 3 versions: packaging 1, pathspec 1, scikit-build-core 1
DEBUG marker environment resolution took 0.002s
DEBUG Installing in scikit-build-core==0.10.7, packaging==24.2, pathspec==0.12.1 in /Users/wesleysmith/.cache/uv/builds-v0/.tmpcfvcLm
DEBUG Registry requirement already cached: scikit-build-core==0.10.7
DEBUG Registry requirement already cached: packaging==24.2
DEBUG Registry requirement already cached: pathspec==0.12.1
DEBUG Installing build requirements: scikit-build-core==0.10.7, packaging==24.2, pathspec==0.12.1
DEBUG Creating PEP 517 build environment
DEBUG Calling `scikit_build_core.build.get_requires_for_build_wheel()`
DEBUG No workspace root found, using project root
DEBUG Installing extra requirements for build backend
DEBUG Solving with installed Python version: 3.12.7
DEBUG Solving with target Python version: >=3.12.7
DEBUG Adding direct dependency: scikit-build-core*
DEBUG Adding direct dependency: ninja>=1.5
DEBUG Searching for a compatible version of scikit-build-core (*)
DEBUG Selecting: scikit-build-core==0.10.7 [compatible] (scikit_build_core-0.10.7-py3-none-any.whl)
DEBUG Adding transitive dependency for scikit-build-core==0.10.7: packaging>=21.3
DEBUG Adding transitive dependency for scikit-build-core==0.10.7: pathspec>=0.10.1
DEBUG Found fresh response for: https://pypi.org/simple/ninja/
DEBUG Searching for a compatible version of ninja (>=1.5)
DEBUG Selecting: ninja==1.11.1.3 [compatible] (ninja-1.11.1.3-py3-none-macosx_10_9_universal2.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/ea/ba/0069cd4a83d68f7b0308be70e219b15d675e50c8ea28763a3f0373c45bfc/ninja-1.11.1.3-py3-none-macosx_10_9_universal2.whl.metadata
DEBUG Searching for a compatible version of packaging (>=21.3)
DEBUG Selecting: packaging==24.2 [compatible] (packaging-24.2-py3-none-any.whl)
DEBUG Searching for a compatible version of pathspec (>=0.10.1)
DEBUG Selecting: pathspec==0.12.1 [compatible] (pathspec-0.12.1-py3-none-any.whl)
DEBUG Tried 4 versions: ninja 1, packaging 1, pathspec 1, scikit-build-core 1
DEBUG marker environment resolution took 0.001s
DEBUG Installing in packaging==24.2, pathspec==0.12.1, ninja==1.11.1.3, scikit-build-core==0.10.7 in /Users/wesleysmith/.cache/uv/builds-v0/.tmpcfvcLm
DEBUG Requirement already installed: packaging==24.2
DEBUG Requirement already installed: pathspec==0.12.1
DEBUG Registry requirement already cached: ninja==1.11.1.3
DEBUG Requirement already installed: scikit-build-core==0.10.7
DEBUG Installing build requirement: ninja==1.11.1.3
DEBUG Calling `scikit_build_core.build.build_wheel("/Users/wesleysmith/.cache/uv/builds-v0/.tmp6SiVwD", {}, None)`
DEBUG *** scikit-build-core 0.10.7 using CMake 3.31.0 (wheel)
DEBUG 2025-02-26 08:41:47,492 - scikit_build_core - WARNING - No license files found, set wheel.license-files to [] to suppress this warning
DEBUG *** Configuring CMake...
DEBUG loading initial cache file build/CMakeInit.txt
DEBUG -- The C compiler identification is AppleClang 16.0.0.16000026
DEBUG -- The CXX compiler identification is AppleClang 16.0.0.16000026
DEBUG -- Detecting C compiler ABI info
DEBUG -- Detecting C compiler ABI info - done
DEBUG -- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/clang - skipped
DEBUG -- Detecting C compile features
DEBUG -- Detecting C compile features - done
DEBUG -- Detecting CXX compiler ABI info
DEBUG -- Detecting CXX compiler ABI info - done
DEBUG -- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/clang++ - skipped
DEBUG -- Detecting CXX compile features
DEBUG -- Detecting CXX compile features - done
DEBUG -- Found Python: /Users/wesleysmith/.cache/uv/builds-v0/.tmpcfvcLm/bin/python (found suitable version "3.12.7", minimum required is "3.12") found components: Interpreter Development.Module
DEBUG -- Configuring done (0.7s)
DEBUG -- Generating done (0.0s)
DEBUG -- Build files have been written to: /Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/build
DEBUG *** Building project with Ninja...
DEBUG Change Dir: '/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/build'
DEBUG 
DEBUG Run Build Command(s): /Users/wesleysmith/.cache/uv/builds-v0/.tmpcfvcLm/bin/ninja -v
DEBUG [1/1] : && /Library/Developer/CommandLineTools/usr/bin/clang++ -O3 -DNDEBUG -flto=thin -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX15.1.sdk -bundle -Wl,-headerpad_max_install_names -Wl,@/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/nanobind/cmake/darwin-ld-cpython.sym -Wl,-dead_strip -Wl,-x -Wl,-S -o src/cpp/_bin_lfs.cpython-312-darwin.so src/cpp/CMakeFiles/_bin_lfs.dir/bin_lfs.cpp.o  src/cpp/libnanobind-static.a  /Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/deps/libdeps.a && :
DEBUG FAILED: src/cpp/_bin_lfs.cpython-312-darwin.so 
DEBUG : && /Library/Developer/CommandLineTools/usr/bin/clang++ -O3 -DNDEBUG -flto=thin -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX15.1.sdk -bundle -Wl,-headerpad_max_install_names -Wl,@/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/nanobind/cmake/darwin-ld-cpython.sym -Wl,-dead_strip -Wl,-x -Wl,-S -o src/cpp/_bin_lfs.cpython-312-darwin.so src/cpp/CMakeFiles/_bin_lfs.dir/bin_lfs.cpp.o  src/cpp/libnanobind-static.a  /Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/deps/libdeps.a && :
DEBUG ld: unknown file type in '/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/deps/libdeps.a'
DEBUG clang++: error: linker command failed with exit code 1 (use -v to see invocation)
DEBUG ninja: build stopped: subcommand failed.
DEBUG 
DEBUG 
DEBUG *** CMake build failed
DEBUG Released lock at `/Users/wesleysmith/.cache/uv/sdists-v8/git/22ef60b00d0f1052/7505b93fe95142a4/.lock`
DEBUG Reverting changes to `pyproject.toml`
DEBUG Removing `uv.lock`
  Ã— Failed to build `bin-lfs @ git+https://github.com/weshoke/test-bin-lfs@7505b93fe95142a4974397f89ad226fb0898d0ad`
  â”œâ”€â–¶ The build backend returned an error
  â•°â”€â–¶ Call to `scikit_build_core.build.build_wheel` failed (exit status: 1)

      [stdout]
      *** scikit-build-core 0.10.7 using CMake 3.31.0 (wheel)
      *** Configuring CMake...
      loading initial cache file build/CMakeInit.txt
      -- The C compiler identification is AppleClang 16.0.0.16000026
      -- The CXX compiler identification is AppleClang 16.0.0.16000026
      -- Detecting C compiler ABI info
      -- Detecting C compiler ABI info - done
      -- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/clang - skipped
      -- Detecting C compile features
      -- Detecting C compile features - done
      -- Detecting CXX compiler ABI info
      -- Detecting CXX compiler ABI info - done
      -- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/clang++ - skipped
      -- Detecting CXX compile features
      -- Detecting CXX compile features - done
      -- Found Python: /Users/wesleysmith/.cache/uv/builds-v0/.tmpcfvcLm/bin/python (found suitable version "3.12.7", minimum required is "3.12") found components: Interpreter Development.Module
      -- Configuring done (0.7s)
      -- Generating done (0.0s)
      -- Build files have been written to: /Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/build
      *** Building project with Ninja...
      Change Dir: '/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/build'

      Run Build Command(s): /Users/wesleysmith/.cache/uv/builds-v0/.tmpcfvcLm/bin/ninja -v
      [1/1] : && /Library/Developer/CommandLineTools/usr/bin/clang++ -O3 -DNDEBUG -flto=thin -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX15.1.sdk -bundle -Wl,-headerpad_max_install_names
      -Wl,@/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/nanobind/cmake/darwin-ld-cpython.sym -Wl,-dead_strip -Wl,-x -Wl,-S -o src/cpp/_bin_lfs.cpython-312-darwin.so src/cpp/CMakeFiles/_bin_lfs.dir/bin_lfs.cpp.o
      src/cpp/libnanobind-static.a  /Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/deps/libdeps.a && :
      FAILED: src/cpp/_bin_lfs.cpython-312-darwin.so
      : && /Library/Developer/CommandLineTools/usr/bin/clang++ -O3 -DNDEBUG -flto=thin -arch arm64 -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX15.1.sdk -bundle -Wl,-headerpad_max_install_names
      -Wl,@/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/nanobind/cmake/darwin-ld-cpython.sym -Wl,-dead_strip -Wl,-x -Wl,-S -o src/cpp/_bin_lfs.cpython-312-darwin.so src/cpp/CMakeFiles/_bin_lfs.dir/bin_lfs.cpp.o
      src/cpp/libnanobind-static.a  /Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/deps/libdeps.a && :
      ld: unknown file type in '/Users/wesleysmith/.cache/uv/git-v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/deps/libdeps.a'
      clang++: error: linker command failed with exit code 1 (use -v to see invocation)
      ninja: build stopped: subcommand failed.


      [stderr]
      2025-02-26 08:41:47,492 - scikit_build_core - WARNING - No license files found, set wheel.license-files to [] to suppress this warning

      *** CMake build failed

      hint: This usually indicates a problem with the package or the build environment.
  help: `bin-lfs` was included because `pymod` (v0.1.0) depends on `bin-lfs`
```


```
v0/checkouts/7b507fa0e455d7e1/7505b93/src/vendor/deps/libdeps.a'
      clang++: error: linker command failed with exit code 1 (use -v to see invocation)
      ninja: build stopped: subcommand failed.
```

This particular file is not in a submodule

---

_Comment by @weshoke on 2025-02-26 15:44_

To reproduce:

```
uv init amodule
cd amodule
UV_GIT_LFS=1 uv -v add git+https://github.com/weshoke/test-bin-lfs
```

---

_Comment by @sydduckworth on 2025-02-26 15:45_

@weshoke yep, sorry. Mixed up the paths. I'm able to reproduce your example.

---

_Comment by @sydduckworth on 2025-02-26 16:00_

@weshoke the issue is that the repo doesn't contain a `.gitattributes` file, which is what LFS uses to determine which files to fetch.

When I run `git lfs track src/vendor/deps/libdeps.a` and commit the resulting `.gitattributes` file the example command above succeeds.

---

_Comment by @weshoke on 2025-02-26 16:14_

@sydduckworth Of course!  I should've double checked that.  That makes a lot of sense.  ðŸ¤¦ 

---

_Comment by @weshoke on 2025-02-26 16:25_

@sydduckworth That said, I have another repo with a more complex setup.  I can't share it unfortunately, but it fails with git-lfs.  The .gitattributes file is there and when I clone, with git clone, I get all of the files fully resolved.

I'll have to figure out what the difference is.  In this case, .gitattributes is in a parent folder of the files being managed.  Maybe that's the difference?

---

_Comment by @weshoke on 2025-02-26 17:44_

@sydduckworth I just modified my test repo to use .gitattributes from a parent directly.  No issues there.  I'll have to continue to dig deeper on why my private repo is failing.  Any useful tips for debugging this?

---

_Comment by @sydduckworth on 2025-02-26 17:59_

@weshoke hard to say, unfortunately. `.gitattributes` being in a parent directory shouldn't matter, but make sure that all of the LFS files in your private repo are tracked in `.gitattributes`. 

Also, if you haven't already, definitely try clearing your uv cache.


---

_Comment by @weshoke on 2025-02-26 18:01_

@sydduckworth Thanks, I will try clearing the cache.  I have verified that the relevant files are tracked with `.gitattributes`.  There are a lot of them and they're not small.  Will post back when I have learned more.

---

_Label `bug` removed by @charliermarsh on 2025-02-27 00:40_

---

_Label `needs-mre` added by @charliermarsh on 2025-02-27 00:40_

---

_Comment by @weshoke on 2025-02-27 01:48_

@sydduckworth I cleared the cache and everything worked.  Thank you for the suggestion.  I think we can close this issue out.  Appreciate the help.

---

_Closed by @weshoke on 2025-02-27 01:48_

---

_Comment by @charliermarsh on 2025-02-27 01:54_

Thanks for following up @weshoke and for helping out @sydduckworth, I appreciate it.

---
