---
number: 16383
title: uv does not use mentioned cache directory inside of docker containers when using cache mount.
type: issue
state: open
author: vaibhavmano
labels:
  - bug
  - needs-mre
assignees: []
created_at: 2025-10-21T11:39:39Z
updated_at: 2025-10-22T05:45:16Z
url: https://github.com/astral-sh/uv/issues/16383
synced_at: 2026-01-07T12:31:16-06:00
---

# uv does not use mentioned cache directory inside of docker containers when using cache mount.

---

_Issue opened by @vaibhavmano on 2025-10-21 11:39_

### Summary

I've been trying to follow the various examples of a optimal docker usage from this [repository: uv-docker-examples](https://github.com/astral-sh/uv-docker-example/) but it seems uv does not write to the mentioned cache directory.

`/var/lib/jenkins/builds/` is the path of the `persistantVolume` attached to the Jenkins instance. I'm trying to build a docker image from within the Jenkins instance and I have set the `ENV` as `UV_CACHE_DIR=/var/lib/jenkins/builds/.cache/uv`. The below is a version of my Dockerfile.

```
FROM basexg:latest

ENV UV_LINK_MODE=copy UV_CACHE_DIR=/var/lib/jenkins/builds/.cache/uv

COPY /pyproject.toml /build/
COPY /uv.lock /build/
COPY /baselib /build/baselib
COPY /application /build/application

WORKDIR /build
RUN --mount=type=cache,id=uv-cache,target=/var/lib/jenkins/builds/.cache/uv \
    uv sync --active --frozen --no-group dev --package application
```

This issue is reproducible in my local machine as well. I've been trying to build the docker image with the above dockerfile and once the image is built, I assumed that the cache will exist in the above path (i.e `var/lib/jenkins/builds/.cache/uv`) but there is no cache that is being written. All subsequent builds keep downloading the package.

Steps to reproduce
1. Clear all docker cache
2. Rebuild the image pointing to the local machines cache directory, which can be obtained by using command (`uv cache dir`)
3. Docker build and you should see that the packages are being downloaded instead of being copies from the cache.

Is this an expected behaviour?


### Platform

macOS 15.4.1 intel

### Version

0.8.17 (10960bc13 2025-09-10)

### Python version

Python 3.12.11

---

_Label `bug` added by @vaibhavmano on 2025-10-21 11:39_

---

_Comment by @zanieb on 2025-10-21 14:16_

Please share a complete reproducible example that demonstrates the issue.

If I write a simplified version of what you've provided, and add `--offline` to the `sync` invocation, it succeeds, which indicates that we are successfully reading from the cache.

---

_Label `needs-mre` added by @zanieb on 2025-10-21 14:16_

---

_Comment by @vaibhavmano on 2025-10-22 05:45_

Hey @zanieb

I've been able to reproduce the issue and I'll use the same Dockerfile provided in the the the [uv-docker-example repo](https://github.com/astral-sh/uv-docker-example/blob/main/Dockerfile).

I cloned the above repo and ran `uv sync --refresh`. I also verified that the `uv cache dir` in my system points to `/Users/ratchet/.cache/uv`. I made sure that there is no existing docker build cache available in my system with `docker system df`. 

TYPE | TOTAL | ACTIVE | SIZE | RECLAIMABLE
-- | -- | -- | -- | --
Images | 0 | 0 | 0B | 0B
Containers | 0 | 0 | 0B | 0B
Local Volumes | 1 | 0 | 0B | 0B
Build Cache | 0 | 0 | 0B | 0B



I made a few changes to the `DockerFile`. I've made sure to point the cache mount to `/Users/ratchet/.cache/uv`. It should technically mount my local system (Host) directory for that particular `RUN` command and I've also added the `--offline` command to ensure that the package should be picked from the host cache. 

```
# Use a Python image with uv pre-installed
FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim

# Setup a non-root user
RUN groupadd --system --gid 999 nonroot \
 && useradd --system --gid 999 --uid 999 --create-home nonroot

# Install the project into `/app`
WORKDIR /app

# Enable bytecode compilation
ENV UV_COMPILE_BYTECODE=1

# Copy from the cache instead of linking since it's a mounted volume
ENV UV_LINK_MODE=copy

# Ensure installed tools can be executed out of the box
ENV UV_TOOL_BIN_DIR=/usr/local/bin

# Install the project's dependencies using the lockfile and settings
RUN --mount=type=cache,target=/Users/ratchet/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --locked --no-install-project --no-dev --offline

# Then, add the rest of the project source code and install it
# Installing separately from its dependencies allows optimal layer caching
COPY . /app
RUN --mount=type=cache,target=/Users/ratchet/.cache/uv \
    uv sync --locked --no-dev --offline

# Place executables in the environment at the front of the path
ENV PATH="/app/.venv/bin:$PATH"

# Reset the entrypoint, don't invoke `uv`
ENTRYPOINT []

# Use the non-root user to run our application
USER nonroot

# Run the FastAPI application by default
# Uses `fastapi dev` to enable hot-reloading when the `watch` sync occurs
# Uses `--host 0.0.0.0` to allow access from outside the container
# Note in production, you should use `fastapi run` instead
CMD ["fastapi", "dev", "--host", "0.0.0.0", "src/uv_docker_example"]

```

Here is the complete error that I get while trying to build the image

```
 => ERROR [stage-0 4/6] RUN --mount=type=cache,target=/Users/ratchet/.cache/uv     --mount=t  0.6s
------
 > [stage-0 4/6] RUN --mount=type=cache,target=/Users/ratchet/.cache/uv     --mount=type=bind,source=uv.lock,target=uv.lock     --mount=type=bind,source=pyproject.toml,target=pyproject.toml     uv sync --locked --no-install-project --no-dev --offline:
0.269 warning: The `tool.uv.dev-dependencies` field (used in `pyproject.toml`) is deprecated and will be removed in a future release; use `dependency-groups.dev` instead
0.568 Using CPython 3.12.12 interpreter at: /usr/local/bin/python3
0.568 Creating virtual environment at: .venv
0.574 Resolved 42 packages in 0.99ms
0.580   × Failed to download `pydantic==2.11.10`
0.580   ╰─▶ Network connectivity is disabled, but the
0.580       requested data wasn't found in the cache for:
0.580       `https://files.pythonhosted.org/packages/bd/1f/73c53fcbfb0b5a78f91176df41945ca466e71e9d9d836e5c522abda39ee7/pydantic-2.11.10-py3-none-any.whl`
0.580   help: `pydantic` (v2.11.10) was included because `uv-docker-example`
0.580         (v0.1.0) depends on `fastapi` (v0.118.0) which depends on `pydantic`
```

My understanding could be wrong over here but I'm assuming that clearing the docker build cache should have no effect on the cache mount since it's a volume/directory that is temporarily mounted from the host system. Let me know if you'd like more information or any further clarifications.



---
