---
number: 5739
title: Presence of an extra index URL that does not contain the package fails the installation
type: issue
state: closed
author: gaborbernat
labels: []
assignees: []
created_at: 2024-08-02T21:17:47Z
updated_at: 2024-08-03T15:45:03Z
url: https://github.com/astral-sh/uv/issues/5739
synced_at: 2026-01-07T12:31:14-06:00
---

# Presence of an extra index URL that does not contain the package fails the installation

---

_Issue opened by @gaborbernat on 2024-08-02 21:17_

```bash
venv/bin/pip install confluent-kafka==2.4.0 --force-reinstall -vv

Using pip 24.1.2 from /Users/bgabor8/git/dti/metadata-sync/venv/lib/python3.12/site-packages/pip (python 3.12)
Non-user install because user site-packages disabled
Created temporary directory: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-build-tracker-jrkhtl60
Initialized build tracking at /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-build-tracker-jrkhtl60
Created build tracker: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-build-tracker-jrkhtl60
Entered build tracker: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-build-tracker-jrkhtl60
Created temporary directory: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-install-rh9cmf9t
Created temporary directory: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-ephem-wheel-cache-fckjp7kt
Looking in indexes: https://magic.com/api/pypi/pypi/simple, https://magic.com/api/pypi/pypi-macos/simple
2 location(s) to search for versions of confluent-kafka:
* https://magic.com/api/pypi/pypi/simple/confluent-kafka/
* https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/
Fetching project page and analyzing links: https://magic.com/api/pypi/pypi/simple/confluent-kafka/
Getting page https://magic.com/api/pypi/pypi/simple/confluent-kafka/
Found index url https://magic.com/api/pypi/pypi/simple/
Looking up "https://magic.com/api/pypi/pypi/simple/confluent-kafka/" in the cache
Request header has "max_age" as 0, cache bypassed
Starting new HTTPS connection (1): artprod.dev.bloomberg.com:443
https://artprod.dev.bloomberg.com:443 "GET /artifactory/api/pypi/pypi/simple/confluent-kafka/ HTTP/1.1" 200 None
Updating cache with response from "https://magic.com/api/pypi/pypi/simple/confluent-kafka/"
Caching b/c date exists and max-age > 0
Fetched page https://magic.com/api/pypi/pypi/simple/confluent-kafka/ as text/html
...
  Skipping link: none of the wheel's tags (cp38-cp38-manylinux2014_x86_64, cp38-cp38-manylinux_2_17_x86_64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl#sha256=baaf1022972bd213bf20cfccb1b13b613d7ab13ebcafacd65220bd5908f5e460 (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp38-cp38-manylinux_2_28_aarch64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp38-cp38-manylinux_2_28_aarch64.whl#sha256=16be3360f040b5d17dcb7e1b66a170b72f428c98d0978705b0a3081de756b2c7 (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp38-cp38-win_amd64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp38-cp38-win_amd64.whl#sha256=45e6f719f6bd95210e0451b50cd19f33a44d7b16be560217240caa71f165420d (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp39-cp39-macosx_10_9_x86_64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp39-cp39-macosx_10_9_x86_64.whl#sha256=3cf1b40ae59569e50ba15da1dc0030bac904b74d8aff82f02a16df3bb9b87e53 (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp39-cp39-macosx_11_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp39-cp39-macosx_11_0_arm64.whl#sha256=5b5dd225596325159eee928caba47e0cf3f03ce3c8244371457a1823d7c66c22 (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp39-cp39-manylinux2014_x86_64, cp39-cp39-manylinux_2_17_x86_64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl#sha256=d338e8189f5836b916c632e0f2db9a197352c199db7323ca3f2bd1785cb9a747 (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp39-cp39-manylinux_2_28_aarch64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp39-cp39-manylinux_2_28_aarch64.whl#sha256=40d18f1bd1bac6d2cf8dbf47da11cdb82d077b26a81ea551136515a1079ec532 (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp39-cp39-win_amd64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp39-cp39-win_amd64.whl#sha256=52f937ab1cde9aacb01288293d374bf09da728b79cf907504dec8f3c4f82030e (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
Fetching project page and analyzing links: https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/
Getting page https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/
Found index url https://magic.com/api/pypi/pypi-macos/simple/
Looking up "https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/" in the cache
Request header has "max_age" as 0, cache bypassed
Resetting dropped connection: artprod.dev.bloomberg.com
Starting new HTTPS connection (2): artprod.dev.bloomberg.com:443
https://artprod.dev.bloomberg.com:443 "GET /artifactory/api/pypi/pypi-macos/simple/confluent-kafka/ HTTP/1.1" 200 None
Updating cache with response from "https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/"
Caching b/c date exists and max-age > 0
Fetched page https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/ as text/html
  Found link https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240721t211529/confluent_kafka-1.7.0%2Bb20240721t211529-cp312-cp312-macosx_14_0_arm64.whl#sha256=1a3b265a6df23c21e2c4a9bb22d49f610e35f6db0567cc37506cb66ece599080 (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/), version: 1.7.0+b20240721t211529
  Skipping link: none of the wheel's tags (cp310-cp310-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240721t212513/confluent_kafka-1.7.0%2Bb20240721t212513-cp310-cp310-macosx_14_0_arm64.whl#sha256=4dd5b71a08f5c7400de82bed5e5df35103c0dbe2a5a5cf54839057e1ea491c15 (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp311-cp311-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240721t212513/confluent_kafka-1.7.0%2Bb20240721t212513-cp311-cp311-macosx_14_0_arm64.whl#sha256=4a14a4491fa274828eaf59b41cee34ef02cc07bdf46f513acab0d4321648622d (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Found link https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240721t212513/confluent_kafka-1.7.0%2Bb20240721t212513-cp312-cp312-macosx_14_0_arm64.whl#sha256=769655f9fffa611b532279c933de5de4cf1daa781e3213164d0ea2961191c9ef (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/), version: 1.7.0+b20240721t212513
  Skipping link: none of the wheel's tags (cp39-cp39-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240721t212513/confluent_kafka-1.7.0%2Bb20240721t212513-cp39-cp39-macosx_14_0_arm64.whl#sha256=51f6121c7090df94494431d7f1bebf40832a88c3f230c4816bedfc8cdec806ea (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Found link https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240722t142532/confluent_kafka-1.7.0%2Bb20240722t142532-cp312-cp312-macosx_14_0_arm64.whl#sha256=a1b8af2da52ffa9c9b6dbda02c5dd6a21ab5ce70d7f0edcf1a942662ec6afa6c (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/), version: 1.7.0+b20240722t142532
  Skipping link: none of the wheel's tags (cp310-cp310-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240801t163438/confluent_kafka-1.7.0%2Bb20240801t163438-cp310-cp310-macosx_14_0_arm64.whl#sha256=d67114b98a069547405556337a071222291bc496867089ccbc438b69a0d30542 (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp311-cp311-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240801t163438/confluent_kafka-1.7.0%2Bb20240801t163438-cp311-cp311-macosx_14_0_arm64.whl#sha256=62e7e269d96f224143c2960ff7e5b2130cd0e641ea81ea74f3a15417e7f81f0c (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Found link https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240801t163438/confluent_kafka-1.7.0%2Bb20240801t163438-cp312-cp312-macosx_14_0_arm64.whl#sha256=2e892b55db049df538882f72e6b21c86e575b5830d391923583751b6cbb2443f (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/), version: 1.7.0+b20240801t163438
  Skipping link: none of the wheel's tags (cp39-cp39-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240801t163438/confluent_kafka-1.7.0%2Bb20240801t163438-cp39-cp39-macosx_14_0_arm64.whl#sha256=fac0c62f1484156a7f2d892df39ca23b17b08f577f484689261a5ac159659e90 (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp310-cp310-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240802t104235/confluent_kafka-1.7.0%2Bb20240802t104235-cp310-cp310-macosx_14_0_arm64.whl#sha256=9b14526d70cf4af706fddaf788f7feb0f4d89cd68d5f5f2df54c35757d89e4a6 (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Skipping link: none of the wheel's tags (cp311-cp311-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240802t104235/confluent_kafka-1.7.0%2Bb20240802t104235-cp311-cp311-macosx_14_0_arm64.whl#sha256=b6f673ada765631c825a69bd6b6f654aa48915615935ddf7fae09e78c07a3074 (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
  Found link https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240802t104235/confluent_kafka-1.7.0%2Bb20240802t104235-cp312-cp312-macosx_14_0_arm64.whl#sha256=c4e054148ddbf8faa43ca865ceab30009cdd3671b72a540f5cba3b4fb559013d (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/), version: 1.7.0+b20240802t104235
  Skipping link: none of the wheel's tags (cp39-cp39-macosx_14_0_arm64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240802t104235/confluent_kafka-1.7.0%2Bb20240802t104235-cp39-cp39-macosx_14_0_arm64.whl#sha256=b36a21aacf8a98b81d8eac20480de19aae9e49847681bc27d333f4e568c2e98b (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/)
Skipping link: not a file: https://magic.com/api/pypi/pypi/simple/confluent-kafka/
Skipping link: not a file: https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/
Given no hashes to check 2 links for project 'confluent-kafka': discarding no candidates
Collecting confluent-kafka==2.4.0
  Created temporary directory: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-unpack-5gscjlq1
  Found index url https://magic.com/api/pypi/pypi/simple/
  Looking up "https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl" in the cache
  Current age based on date: 109
  Freshness lifetime from max-age: 31536000
  The response is "fresh", returning cached response
  31536000 > 109
  Using cached https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl (2.8 MB)
Created temporary directory: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-unpack-mbnhhk5p
Installing collected packages: confluent-kafka
  Attempting uninstall: confluent-kafka
    Found existing installation: confluent-kafka 2.4.0
    Uninstalling confluent-kafka-2.4.0:
      Created temporary directory: /private/var/folders/v0/l8q3ghks2gs5ns2_p63tyqh40000gq/T/pip-uninstall-1h25onc5
      Removing file or directory /Users/bgabor8/git/dti/metadata-sync/venv/LICENSE.txt
      Created temporary directory: /Users/bgabor8/git/dti/metadata-sync/venv/lib/python3.12/site-packages/~onfluent_kafka-2.4.0.dist-info
      Removing file or directory /Users/bgabor8/git/dti/metadata-sync/venv/lib/python3.12/site-packages/confluent_kafka-2.4.0.dist-info/
      Created temporary directory: /Users/bgabor8/git/dti/metadata-sync/venv/lib/python3.12/site-packages/~onfluent_kafka
      Removing file or directory /Users/bgabor8/git/dti/metadata-sync/venv/lib/python3.12/site-packages/confluent_kafka/
      Successfully uninstalled confluent-kafka-2.4.0

Successfully installed confluent-kafka-2.4.0
Remote version of pip: 24.1.2
Local version of pip:  24.1.2
Was pip installed by pip? True
```

```
uv pip install 'confluent_kafka==2.4.0' -vv

    0.000018s DEBUG uv uv 0.2.33
 uv_requirements::specification::from_source source=confluent_kafka==2.4.0
    0.000782s DEBUG uv_python::discovery Searching for Python interpreter in system path
    0.001515s DEBUG uv_python::discovery Found `cpython-3.12.4-macos-aarch64-none` at `/Users/bgabor8/git/dti/metadata-sync/.venv/bin/python3` (virtual environment)
    0.001553s DEBUG uv::commands::pip::install Using Python 3.12.4 environment at [36m.venv/bin/python3[39m
    0.001660s DEBUG uv_fs Acquired lock for `.venv`
    0.001793s DEBUG uv::commands::pip::install At least one requirement is not satisfied: confluent-kafka==2.4.0
 uv_client::linehaul::linehaul
    0.002322s DEBUG uv_client::base_client Using request timeout of 30s
 uv_resolver::flat_index::from_entries
 uv_resolver::resolver::solve
    0.003471s   0ms DEBUG uv_resolver::resolver Solving with installed Python version: 3.12.4
   uv_resolver::resolver::choose_version package=root
   uv_resolver::resolver::get_dependencies_forking package=root, version=0a0.dev0
     uv_resolver::resolver::get_dependencies package=root, version=0a0.dev0
    0.003560s   0ms DEBUG uv_resolver::resolver Adding direct dependency: confluent-kafka==2.4.0
   uv_resolver::resolver::choose_version package=confluent-kafka
 uv_resolver::resolver::process_request request=Versions confluent-kafka
   uv_client::registry_client::simple_api package=confluent-kafka
     uv_client::cached_client::get_cacheable
       uv_client::cached_client::read_and_parse_cache file=/Users/bgabor8/Library/Caches/uv/simple-v11/index/ee1c0b0542f7cb47/confluent-kafka.rkyv
 uv_resolver::resolver::process_request request=Prefetch confluent-kafka ==2.4.0
 uv_client::cached_client::from_path_sync path="/Users/bgabor8/Library/Caches/uv/simple-v11/index/ee1c0b0542f7cb47/confluent-kafka.rkyv"
        0.004026s   0ms DEBUG uv_client::cached_client Found fresh response for: https://magic.com/pypi/bloomberg-pypi-macos/simple/confluent-kafka/
   uv_resolver::version_map::from_metadata
      0.004139s   0ms DEBUG uv_resolver::resolver Searching for a compatible version of confluent-kafka (==2.4.0)
    0.004156s   0ms DEBUG uv_resolver::resolver No compatible version found for: confluent-kafka
  √ó No solution found when resolving dependencies:
  ‚ï∞‚îÄ‚ñ∂ Because there is no version of confluent-kafka==2.4.0 and you require confluent-kafka==2.4.0, we can conclude that the requirements are unsatisfiable.

```


---

_Comment by @gaborbernat on 2024-08-02 21:21_

Seems the pure presence of an extra index url that does not contain the package is enough to fail the installation...

```
 env UV_EXTRA_INDEX_URL= uv pip install 'confluent_kafka==2.4.0' -vv
    0.000034s DEBUG uv uv 0.2.33
 uv_requirements::specification::from_source source=confluent_kafka==2.4.0
    0.001077s DEBUG uv_python::discovery Searching for Python interpreter in system path
    0.001558s DEBUG uv_python::discovery Found `cpython-3.12.4-macos-aarch64-none` at `/Users/bgabor8/git/dti-storage-platform/metadata-sync/.venv/bin/python3` (virtual environment)
    0.001577s DEBUG uv::commands::pip::install Using Python 3.12.4 environment at .venv/bin/python3
    0.001830s DEBUG uv_fs Acquired lock for `.venv`
    0.002842s DEBUG uv::commands::pip::install Requirement satisfied: confluent-kafka==2.4.0
Audited 1 package in 1ms
~/git/dti-storage-platform/metadata-sync on ÓÇ† main [!+?]
‚ùØ env UV_EXTRA_INDEX_URL= uv pip install 'confluent_kafka==2.4.0' -vv --force-reinstall
    0.000023s DEBUG uv uv 0.2.33
 uv_requirements::specification::from_source source=confluent_kafka==2.4.0
    0.002052s DEBUG uv_python::discovery Searching for Python interpreter in system path
    0.136213s DEBUG uv_python::discovery Found `cpython-3.12.4-macos-aarch64-none` at `/Users/bgabor8/git/dti-storage-platform/metadata-sync/.venv/bin/python3` (virtual environment)
    0.136255s DEBUG uv::commands::pip::install Using Python 3.12.4 environment at .venv/bin/python3
    0.136412s DEBUG uv_fs Acquired lock for `.venv`
 uv_client::linehaul::linehaul
    0.137894s DEBUG uv_client::base_client Using request timeout of 30s
 uv_resolver::flat_index::from_entries
 uv_resolver::resolver::solve
    0.139206s   0ms DEBUG uv_resolver::resolver Solving with installed Python version: 3.12.4
   uv_resolver::resolver::choose_version package=root
   uv_resolver::resolver::get_dependencies_forking package=root, version=0a0.dev0
     uv_resolver::resolver::get_dependencies package=root, version=0a0.dev0
    0.139280s   0ms DEBUG uv_resolver::resolver Adding direct dependency: confluent-kafka==2.4.0
   uv_resolver::resolver::choose_version package=confluent-kafka
 uv_resolver::resolver::process_request request=Versions confluent-kafka
   uv_client::registry_client::simple_api package=confluent-kafka
     uv_client::cached_client::get_cacheable
       uv_client::cached_client::read_and_parse_cache file=/Users/bgabor8/Library/Caches/uv/simple-v11/index/f85683082b98592e/confluent-kafka.rkyv
 uv_resolver::resolver::process_request request=Prefetch confluent-kafka ==2.4.0
 uv_client::cached_client::from_path_sync path="/Users/bgabor8/Library/Caches/uv/simple-v11/index/f85683082b98592e/confluent-kafka.rkyv"
        0.139859s   0ms DEBUG uv_client::cached_client Found stale response for: https://magic.com/api/pypi/pypi/simple/confluent-kafka/
        0.139865s   0ms DEBUG uv_client::cached_client Sending revalidation request for: https://magic.com/api/pypi/pypi/simple/confluent-kafka/
       uv_client::cached_client::revalidation_request url="https://magic.com/api/pypi/pypi/simple/confluent-kafka/"
        0.902940s 763ms DEBUG uv_client::cached_client Found modified response for: https://magic.com/api/pypi/pypi/simple/confluent-kafka/
       uv_client::cached_client::new_cache file=/Users/bgabor8/Library/Caches/uv/simple-v11/index/f85683082b98592e/confluent-kafka.rkyv
       uv_client::registry_client::parse_simple_api package=confluent-kafka
         uv_client::html::parse url=https://magic.com/api/pypi/pypi/simple/confluent-kafka/
   uv_resolver::version_map::from_metadata
      0.996952s 857ms DEBUG uv_resolver::resolver Searching for a compatible version of confluent-kafka (==2.4.0)
      0.996996s 857ms DEBUG uv_resolver::resolver Selecting: confluent-kafka==2.4.0 [compatible] (confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl)
   uv_distribution::distribution_database::get_or_build_wheel_metadata dist=confluent-kafka==2.4.0
     uv_client::registry_client::wheel_metadata built_dist=confluent-kafka==2.4.0
   uv_resolver::resolver::get_dependencies_forking package=confluent-kafka, version=2.4.0
     uv_resolver::resolver::get_dependencies package=confluent-kafka, version=2.4.0
       uv_client::cached_client::get_serde
         uv_client::cached_client::get_cacheable
           uv_client::cached_client::read_and_parse_cache file=/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.msgpack
 uv_client::cached_client::from_path_sync path="/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.msgpack"
            0.997315s   0ms DEBUG uv_client::cached_client No cache entry for: https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1
           uv_client::cached_client::fresh_request url="https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1"
           uv_client::cached_client::new_cache file=/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.msgpack
           uv_client::registry_client::read_metadata_range_request wheel=confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl
      2.161020s   1s   WARN uv_distribution::distribution_database Range requests unsupported when fetching metadata for confluent-kafka==2.4.0; downloading wheel directly (Failed to unzip wheel: confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl)
     uv_client::cached_client::get_serde
       uv_client::cached_client::get_cacheable
         uv_client::cached_client::read_and_parse_cache file=/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.http
 uv_client::cached_client::from_path_sync path="/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.http"
          2.162595s   1ms DEBUG uv_client::cached_client Found stale response for: https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1
          2.162618s   1ms DEBUG uv_client::cached_client Sending revalidation request for: https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1
         uv_client::cached_client::revalidation_request url="https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1"
          2.735452s 573ms DEBUG uv_client::cached_client Found not-modified response for: https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1
         uv_client::cached_client::refresh_cache file=/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.http
    2.740838s   2s  DEBUG uv_resolver::resolver::batch_prefetch Tried 1 versions: confluent-kafka 1
    2.740850s   2s  DEBUG uv_resolver::resolver Split specific environment resolution took 2.602s
Resolved 1 package in 2.60s
    2.741102s DEBUG uv_installer::plan Must revalidate requirement: confluent-kafka
 uv_installer::preparer::prepare total=1
   uv_installer::preparer::get_wheel name=confluent-kafka==2.4.0, size=None, url="../../confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1"
     uv_distribution::distribution_database::get_or_build_wheel dist=confluent-kafka==2.4.0
       uv_client::cached_client::get_serde
         uv_client::cached_client::get_cacheable
           uv_client::cached_client::read_and_parse_cache file=/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.http
 uv_client::cached_client::from_path_sync path="/Users/bgabor8/Library/Caches/uv/wheels-v1/index/f85683082b98592e/confluent-kafka/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.http"
            2.741430s   0ms DEBUG uv_client::cached_client Found fresh response for: https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp312-cp312-macosx_11_0_arm64.whl#sha256=dd53d58a6648e4d5e435ff5178248b91af050a4478ed51a95b2b0eaedddafdb1
Prepared 1 package in 0.37ms
    2.747092s DEBUG uv::commands::pip::operations Uninstalled confluent-kafka (45 files, 11 directories)
Uninstalled 1 package in 5ms
 uv_installer::installer::install_blocking num_wheels=1
   uv_installer::installer::install num_wheels=1
Installed 1 package in 4ms
 - confluent-kafka==2.4.0
 + confluent-kafka==2.4.0

```

---

_Renamed from "uv fails to install package when pip succeeds against internal repo" to "Presence of an extra index URL that does not contain the package fails the installation" by @gaborbernat on 2024-08-02 21:22_

---

_Comment by @charliermarsh on 2024-08-02 21:23_

It looks like https://magic.com/api/pypi/pypi/simple/confluent-kafka/ contains the package, but not that version. Is that correct? You may be looking for `--index-strategy unsafe-first-match`.

---

_Comment by @gaborbernat on 2024-08-02 21:43_

That is not true. That's why pip in itself succeed. Uv Get fooled by the presence, or rather the lack of the extra index without any information for that package and just gives up.

---

_Comment by @charliermarsh on 2024-08-02 22:09_

What does `https://magic.com/api/pypi/pypi/simple/confluent-kafka/` return / contain?

---

_Comment by @charliermarsh on 2024-08-02 22:14_

I think we typically take 401, 403, or 404 as a signal that the package isn't present on the registry. Does your registry return a 200 with no versions, or something like that?

---

_Comment by @gaborbernat on 2024-08-02 22:20_

I think you are misunderstanding what I'm saying. There are not one but two in that server that plays here. One of them is the primary and contains the package as expected. The second one is the secondary and has no information on that package. Just by the presence of setting the secondary server, the package from the primary server is not installed.

---

_Comment by @gaborbernat on 2024-08-02 22:21_

If you check my first two comments on this issue, you will see that's what I am demonstrating.

---

_Comment by @charliermarsh on 2024-08-02 22:30_

I think I am understanding, but apologies if not. You have two indexes -- something like:

- https://magic.com/api/pypi/pypi/simple
- https://magic.com/api/pypi/pypi-macos/simple

The package exists on both indexes, for example:

- https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl#sha256=baaf1022972bd213bf20cfccb1b13b613d7ab13ebcafacd65220bd5908f5e460
- https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240721t212513/confluent_kafka-1.7.0%2Bb20240721t212513-cp310-cp310-macosx_14_0_arm64.whl#sha256=4dd5b71a08f5c7400de82bed5e5df35103c0dbe2a5a5cf54839057e1ea491c15

(This part I did misunderstand. I thought you said the package `confluent-kafka` did not exist at all in one of the two indexes. Did you mean `confluent-kafka` does not exist at `2.4.0` on one of the two indexes?)

If the above is correct, then the behavior you're seeing is intended. Unlike pip, by default uv does _not_ look across all indexes, to prevent dependency confusion attacks. So if `confluent-kafka` exists on the `--extra-index-url`, uv will stop looking.

As an example, if `confluent-kafka` is available on the `pypi-macos` index as `1.7.0` (and no other versions), as suggested by the logs, and that index is the `--extra-index-url`, uv will stop as soon as it finds it, and fail to find `2.4.0`.

You can disable this behavior (and instruct uv to look across all indexes) with `--index-strategy unsafe-best-match`.

Again, apologies if I'm misunderstanding.


---

_Comment by @gaborbernat on 2024-08-02 22:32_

It's more along the lines that the package does not exists at all on the second index. The second index contains information for just a few packages the packaging question here is not part of those packages.

---

_Comment by @charliermarsh on 2024-08-02 22:53_

I'm confused... The logs above demonstrate that both `https://magic.com/api/pypi/pypi/simple` and `https://magic.com/api/pypi/pypi-macos/simple` contain versions of `confluent-kafka`. Quoting from the logs:

```
Fetched page https://magic.com/api/pypi/pypi/simple/confluent-kafka/ as text/html
...
  Skipping link: none of the wheel's tags (cp38-cp38-manylinux2014_x86_64, cp38-cp38-manylinux_2_17_x86_64) are compatible (run pip debug --verbose to show compatible tags): https://magic.com/api/pypi/pypi/confluent-kafka/2.4.0/confluent_kafka-2.4.0-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl#sha256=baaf1022972bd213bf20cfccb1b13b613d7ab13ebcafacd65220bd5908f5e460 (from https://magic.com/api/pypi/pypi/simple/confluent-kafka/)
...
Fetched page https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/ as text/html
  Found link https://magic.com/api/pypi/pypi-macos/confluent-kafka/1.7.0%2Bb20240721t211529/confluent_kafka-1.7.0%2Bb20240721t211529-cp312-cp312-macosx_14_0_arm64.whl#sha256=1a3b265a6df23c21e2c4a9bb22d49f610e35f6db0567cc37506cb66ece599080 (from https://magic.com/api/pypi/pypi-macos/simple/confluent-kafka/), version: 1.7.0+b20240721t211529
```

Did you try my suggestion above?


---

_Closed by @gaborbernat on 2024-08-02 23:57_

---

_Comment by @gaborbernat on 2024-08-02 23:59_

Ah missed that üëç 

---

_Reopened by @gaborbernat on 2024-08-03 15:33_

---

_Comment by @gaborbernat on 2024-08-03 15:33_

Any reason why the extra takes precedence over the primary index? 

---

_Comment by @charliermarsh on 2024-08-03 15:40_

Basically an arbitrary choice but we found that it better matched to user expectations based on filed issues, the most common case by far being the use of the PyTorch index as an extra index URL, in which case users expect the PyTorch `torch` to be selected over the PyPI `torch`.

---

_Closed by @gaborbernat on 2024-08-03 15:45_

---
