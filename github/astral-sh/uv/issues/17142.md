---
number: 17142
title: "`uv` couldn't find `ffmpeg` on macOS installed with `Homebrew` when running `demucs`"
type: issue
state: closed
author: setoelkahfi
labels:
  - question
assignees: []
created_at: 2025-12-16T12:16:23Z
updated_at: 2025-12-23T12:49:21Z
url: https://github.com/astral-sh/uv/issues/17142
synced_at: 2026-01-07T12:31:16-06:00
---

# `uv` couldn't find `ffmpeg` on macOS installed with `Homebrew` when running `demucs`

---

_Issue opened by @setoelkahfi on 2025-12-16 12:16_

### Summary

The title is self-explanatory.

I'm trying to migrate my `Python` tooling to uv`,` and managed to do so for two of our background jobs so far. But this one job that needs `ffmpeg` is failing locally:

```bash
➜  musik88-web git:(feature/backend-uv-splitfire-job) ✗ uv run demucs -n=htdemucs_ft -d cpu yt-dlp/output/test.mp3
Selected model is a bag of 4 models. You will see that many progress bars per track.
Separated tracks will be stored in /Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/separated/htdemucs_ft
Separating track yt-dlp/output/test.mp3
100%|██████████████████████████████████████████████████████████████████████████| 23.4/23.4 [00:05<00:00,  4.28seconds/s]
100%|██████████████████████████████████████████████████████████████████████████| 23.4/23.4 [00:04<00:00,  4.75seconds/s]
100%|██████████████████████████████████████████████████████████████████████████| 23.4/23.4 [00:04<00:00,  4.81seconds/s]
100%|██████████████████████████████████████████████████████████████████████████| 23.4/23.4 [00:04<00:00,  4.78seconds/s]
Traceback (most recent call last):
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/bin/demucs", line 10, in <module>
    sys.exit(main())
             ^^^^^^
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/demucs/separate.py", line 199, in main
    save_audio(source, str(stem), **kwargs)
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/demucs/audio.py", line 260, in save_audio
    ta.save(str(path), wav, sample_rate=samplerate,
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchaudio/__init__.py", line 178, in save
    return save_with_torchcodec(
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchaudio/_torchcodec.py", line 246, in save_with_torchcodec
    from torchcodec.encoders import AudioEncoder
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/__init__.py", line 12, in <module>
    from . import decoders, encoders, samplers  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/decoders/__init__.py", line 7, in <module>
    from .._core import AudioStreamMetadata, VideoStreamMetadata
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/_core/__init__.py", line 8, in <module>
    from ._metadata import (
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/_core/_metadata.py", line 16, in <module>
    from torchcodec._core.ops import (
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/_core/ops.py", line 104, in <module>
    ffmpeg_major_version, core_library_path = load_torchcodec_shared_libraries()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/_core/ops.py", line 75, in load_torchcodec_shared_libraries
    raise RuntimeError(
RuntimeError: Could not load libtorchcodec. Likely causes:
          1. FFmpeg is not properly installed in your environment. We support
             versions 4, 5, 6, 7, and 8. On Windows, ensure you've installed
             the "full-shared" version which ships DLLs.
          2. The PyTorch version (2.9.1) is not compatible with
             this version of TorchCodec. Refer to the version compatibility
             table:
             https://github.com/pytorch/torchcodec?tab=readme-ov-file#installing-torchcodec.
          3. Another runtime dependency; see exceptions below.
        The following exceptions were raised as we tried to load libtorchcodec:

[start of libtorchcodec loading traceback]
FFmpeg version 8: Could not load this library: /Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/libtorchcodec_core8.dylib
FFmpeg version 7: Could not load this library: /Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/libtorchcodec_core7.dylib
FFmpeg version 6: Could not load this library: /Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/libtorchcodec_core6.dylib
FFmpeg version 5: Could not load this library: /Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/libtorchcodec_core5.dylib
FFmpeg version 4: Could not load this library: /Users/setoelkahfi/Repositories/splitfire/backend/musik88-web/.venv/lib/python3.12/site-packages/torchcodec/libtorchcodec_core4.dylib
[end of libtorchcodec loading traceback].
```

My pyproject.toml file:
```toml
[project]
name = "musik88-web"
version = "1.0.0"
description = "Cool stuff"
readme = "README.md"
requires-python = ">=3.12.12"
dependencies = [
    "demucs>=4.0.1",
    "ffmpeg>=1.4",
    "librosa>=0.11.0",
    "torchcodec>=0.9.1",
    "yt-dlp>=2025.12.8",
]
```

I already installed ffmpeg through Homebrew:

```bash
➜  musik88-web git:(feature/backend-uv-splitfire-job) ✗ brew install ffmpeg
==> Auto-updating Homebrew...
Adjust how often this is run with `$HOMEBREW_AUTO_UPDATE_SECS` or disable with
`$HOMEBREW_NO_AUTO_UPDATE=1`. Hide these hints with `$HOMEBREW_NO_ENV_HINTS=1` (see `man brew`).
==> Auto-updated Homebrew!
Updated 2 taps (homebrew/core and homebrew/cask).
==> New Formulae
ctre: Compile-time PCRE-compatible regular expression matcher for C++

You have 18 outdated formulae installed.

Warning: ffmpeg 8.0.1 is already installed and up-to-date.
To reinstall 8.0.1, run:
  brew reinstall ffmpeg
```

Any pointers? Do I need the `ffmpeg` package on my deps file?

### Platform

Darwin 25.1.0 arm64

### Version

uv 0.9.16 (a63e5b62e 2025-12-06)

### Python version

3.12.12

---

_Label `bug` added by @setoelkahfi on 2025-12-16 12:16_

---

_Comment by @setoelkahfi on 2025-12-16 12:27_

I updated uv to the latest with `uv self update` `uv 0.9.17 (2b5d65e61 2025-12-09)` and tried `Python` 3.13, got the same errors. When trying Python 3.14 got error from `uv`:
```
➜  musik88-web git:(feature/backend-uv-splitfire-job) ✗ uv sync
Using CPython 3.14.2
Removed virtual environment at: .venv
Creating virtual environment at: .venv
Resolved 74 packages in 0.63ms
error: Distribution `lameenc==1.8.1 @ registry+https://pypi.org/simple` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're using CPython 3.14 (`cp314`), but `lameenc` (v1.8.1) only has wheels with the following Python ABI tags: `cp312`, `cp313`, `cp313t`
```

---

_Comment by @konstin on 2025-12-16 12:52_

It this a uv-specific problem, or a problem between `splitfire` and `[lib]torchcodec`?

---

_Label `bug` removed by @konstin on 2025-12-16 12:52_

---

_Label `question` added by @konstin on 2025-12-16 12:52_

---

_Comment by @setoelkahfi on 2025-12-17 09:22_

I was not sure because my current setup without uv is working ok but `uv run` fails with seemingly the same dependencies, hence the question. I think Claude pointed me the problem now. 

---

_Comment by @konstin on 2025-12-17 10:27_

Does this mean this issue is solved?

---

_Comment by @setoelkahfi on 2025-12-17 12:00_

Ok, this is happening on my production environment as well, running Linux Debian, ffmpeg 4. @konstin feel free to close this if you think it's unrelated to `uv`. I still don't know yet.

---

_Comment by @konstin on 2025-12-17 12:10_

Yep, this looks like it needs to be solved by the packages, not by the package manager.

---

_Closed by @konstin on 2025-12-17 12:10_

---

_Comment by @setoelkahfi on 2025-12-23 12:49_

For my future reference and people who probably stumble upon this thread, we're running this in a Rails `ActiveJob`, and we need to append the envrionment variables in the command level in the `ActiveJob` class:

```ruby
  # Always use absolute path in production until we figure out how to load the command
  # in the sidekiq.service
  def demucs
    if Rails.env.production?
      '/home/deploy/.local/bin/uv run demucs'
    else
      "#{local_environments} uv run demucs"
    end
  end

  def local_environments
    'DYLD_LIBRARY_PATH=/opt/homebrew/lib:$DYLD_LIBRARY_PATH DYLD_FALLBACK_LIBRARY_PATH=/opt/homebrew/lib'
  end
```

---
