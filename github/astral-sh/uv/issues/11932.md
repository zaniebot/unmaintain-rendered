---
number: 11932
title: "`uv lock --check` doesn't error if environment doesn't match lockfile"
type: issue
state: open
author: cjw296
labels:
  - question
assignees: []
created_at: 2025-03-03T20:02:59Z
updated_at: 2025-04-03T14:41:24Z
url: https://github.com/astral-sh/uv/issues/11932
synced_at: 2026-01-07T12:31:15-06:00
---

# `uv lock --check` doesn't error if environment doesn't match lockfile

---

_Issue opened by @cjw296 on 2025-03-03 20:02_

### Summary

I expect `uv lock --check` not only to check that the lockfile and pyproject.toml are consistent but also that the current project/library virtualenv matches the lockfile.

I changed one of the hashes in `uv.lock` and also a third point version of one of the dependencies to check this, and then ran `uv lock --check`, which run to a zero return code and gave no error output.

I feel like this could be a feature request for new behaviour, but either way, it feels like there should be a way to say "check everything matches" between `pyproject.toml`, `uv.lock` and the project's virtualenv, including hashes. It's already confusing that there's `uv lock --locked` and `uv lock --check`, and yet there still appears to be no way to verify that the virtualenv matches both the lockfile and the requirements in `pyproject.toml`.

### Platform

macOS

### Version

uv 0.5.21 (3478c068b 2025-01-17)

### Python version

_No response_

---

_Label `bug` added by @cjw296 on 2025-03-03 20:02_

---

_Comment by @cjw296 on 2025-03-03 20:10_

It's also troubling that if I change the version in the lockfile such that it no longer matches the environment or `pyproject.toml`, such as by changing to a lower second point release, `uv sync` and `uv sync --locked` both do nothing, `uv lock --check` and `uv lock` also both do nothing.

---

_Referenced in [astral-sh/uv#12202](../../astral-sh/uv/issues/12202.md) on 2025-04-01 21:39_

---

_Comment by @zanieb on 2025-04-01 21:49_

> I expect uv lock --check not only to check that the lockfile and pyproject.toml are consistent but also that the current project/library virtualenv matches the lockfile.

Why? `uv lock --check` is "check the lockfile is consistent with the project". The `uv lock` namespace never touches the environment.

It sounds like you want `uv sync --check`?

> It's already confusing that there's uv lock --locked and uv lock --check,

These are just aliases. `--locked` exists for consistency with the rest of the interface.

> I changed one of the hashes in uv.lock and also a third point version of one of the dependencies to check this, and then ran uv lock --check, which run to a zero return code and gave no error output.

Regarding changing the version, we've added some validation in #12235. It's not reasonable for `uv sync --check` to check hashes, because we'd need to download the wheels to see if they match (which defeats the purpose of a dry-run command). We could add support for this, but what are we defending against here? People writing invalid hashes into the lockfile? Once the wheels are unpacked into the cache, we can't check that the hashes match anymore so there's nothing to do there.

---

_Label `question` added by @zanieb on 2025-04-01 21:51_

---

_Label `bug` removed by @zanieb on 2025-04-01 21:51_

---

_Comment by @cjw296 on 2025-04-03 14:41_

I guess stepping back, what I think I have is a feature request for a `uv check` that "check everything matches" between `pyproject.toml`, `uv.lock` and the project's virtualenv. I take your point about hashes being hard to validate once you've unpacked the package.

It's pretty confusing to have:

```
uv lock --check
uv lock --locked
uv sync --locked
uv sync --check
```

I appreciate they do subtley different things or are synonyms, but I don't see that as a good thing ðŸ˜…

---
