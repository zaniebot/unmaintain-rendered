---
number: 15445
title: uv lock does not re-evaluate constraints
type: issue
state: open
author: janbernloehr
labels:
  - needs-mre
assignees: []
created_at: 2025-08-22T06:27:58Z
updated_at: 2025-08-22T19:00:10Z
url: https://github.com/astral-sh/uv/issues/15445
synced_at: 2026-01-07T12:31:16-06:00
---

# uv lock does not re-evaluate constraints

---

_Issue opened by @janbernloehr on 2025-08-22 06:27_

### Summary

Suppose I have a pyproject which poses a constraint on some package version (here `numpy==1.26.3`)

```
[project]
name = "footest"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.13"
dependencies = [
    "numpy<2"
]

[tool.uv]
constraint-dependencies = [
    "numpy==1.26.3"
]
```

Now I have a uv.lock file which violates this constraint by referring to `1.26.4` instead of `1.26.3`
```
version = 1
revision = 3
requires-python = ">=3.13"

[manifest]
constraints = [{ name = "numpy", specifier = "==1.26.3" }]

[[package]]
name = "footest"
version = "0.1.0"
source = { virtual = "." }
dependencies = [
    { name = "numpy" },
]

[package.metadata]
requires-dist = [{ name = "numpy", specifier = "<2" }]

[[package]]
name = "numpy"
version = "1.26.4"
source = { registry = "https://jfrog.ad-alliance.biz/artifactory/api/pypi/shared-pypi-prod/simple" }
sdist = { url = "https://jfrog.ad-alliance.biz/artifactory/api/pypi/shared-pypi-prod/packages/packages/65/6e/09db70a523a96d25e115e71cc56a6f9031e7b8cd166c1ac8438307c14058/numpy-1.26.4.tar.gz", hash = "sha256:2a02aba9ed12e4ac4eb3ea9421c420301a0c6460d9830d74a9df87efa4912010" }
```

This will happily pass `uv lock --check` and `uv lock` only `uv lock -P numpy` will fix this

### Platform

Ubuntu 22.04

### Version

uv 0.8.12

### Python version

Python 3.13

---

_Label `bug` added by @janbernloehr on 2025-08-22 06:27_

---

_Comment by @konstin on 2025-08-22 08:31_

I cannot reproduce this, adding or changing `constraint-dependencies` always triggers lockfile revalidation for me. Did you manually edit the lockfile?

---

_Label `bug` removed by @konstin on 2025-08-22 08:31_

---

_Label `needs-mre` added by @konstin on 2025-08-22 08:31_

---

_Comment by @janbernloehr on 2025-08-22 09:50_

yes itâ€™s about changes to the lock file which might happen eg during a merge. So if I have the lock file as is which might happen if someone adds the constraint and someone else updates the version and they are merged together, uv lock will accept this happily 

---

_Comment by @charliermarsh on 2025-08-22 10:07_

Updating the lockfile "manually" like that isn't a supported operation -- the lockfile could change in arbitrary ways that we can't recover from.

---

_Comment by @konstin on 2025-08-22 10:17_

Could you describe the sequence of steps in Git, was there ever a merge conflict involved?

---

_Comment by @janbernloehr on 2025-08-22 18:59_

So the initial state is 1.26.3 and no constraint.

Now we have two PRs merged in sequence
1. adding the constraint for 1.26.3
2. updating the version to 1.26.4

This resulted in this very combination of uv.lock and pyproject.toml and our ci did not catch it because uv lock was fine.

We found the problem only later when we tried to run uv export which then re-evaluated the constraints.

Would it be possible to have a more expensive version of uv lock that re evaluates everything. We could run that in CI

---
