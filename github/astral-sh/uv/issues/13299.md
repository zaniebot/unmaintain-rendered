---
number: 13299
title: "uv add fails to install package while  uv pip install doesn't"
type: issue
state: closed
author: SSchleehauf
labels:
  - question
assignees: []
created_at: 2025-05-05T10:29:15Z
updated_at: 2025-05-05T20:24:34Z
url: https://github.com/astral-sh/uv/issues/13299
synced_at: 2026-01-07T12:31:16-06:00
---

# uv add fails to install package while  uv pip install doesn't

---

_Issue opened by @SSchleehauf on 2025-05-05 10:29_

### Summary

PS C:\Users\Schleehauf\PycharmProjects\myproject> uv add pyqt5   
```
Resolved 4 packages in 1.69s
error: Distribution `pyqt5-qt5==5.15.16 @ registry+https://pypi.org/simple` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're on Windows (`win_amd64`), but `pyqt5-qt5` (v5.15.16) only has wheels for the following platforms: `manylinux2014_x86_64`, `macosx_10_13_x86_64`, `macosx_11_0_arm64`
```
**uv add fails, while uv pip install properly resolves the correct packages:**

PS C:\Users\Schleehauf\PycharmProjects\myproject>  pyqt5
```
Resolved 3 packages in 140ms
Installed 3 packages in 295ms
 + pyqt5==5.15.11
 + pyqt5-qt5==5.15.2
 + pyqt5-sip==12.17.0

```

### Platform

Windows 11

### Version

myproject

### Python version

Python 3.11.12

---

_Label `bug` added by @SSchleehauf on 2025-05-05 10:29_

---

_Comment by @konstin on 2025-05-05 11:17_

Your hitting an edge case due to pyqt5-qt5 publishing wheels for different platforms in different versions: `uv add` tries to do a universal resolution and picks the latest version, which then fails to install, while `uv pip install` goes back to an older, compatible version. You can work around this by setting the required environments to include your platform before running `uv add` (https://docs.astral.sh/uv/concepts/resolution/#required-environments).

---

_Label `bug` removed by @konstin on 2025-05-05 11:17_

---

_Label `question` added by @konstin on 2025-05-05 11:17_

---

_Comment by @SSchleehauf on 2025-05-05 19:15_

I am not sure if I am doing this right, I added

```toml
[tool.uv]
environments = [
    "sys_platform=='win32'",
]
```
to ```pyproject.toml```, but this does not help:

```powershell

> uv add --verbose pyqt5
DEBUG uv 0.7.2 (481d05d8d 2025-04-30)
DEBUG Found project root: `C:\Users\sebi\test_env`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `C:\Users\sebi\test_env`
DEBUG Reading Python requests from version file at `C:\Users\sebi\test_env\.python-version`
DEBUG Using Python request `3.11` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment's Python version satisfies the request: `Python 3.11`
DEBUG Released lock at `C:\Users\sebi\AppData\Local\Temp\uv-f6c3a328fae758f2.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: test-env @ file:///C:/Users/sebi/test_env
DEBUG No workspace root found, using project root
DEBUG Ignoring existing lockfile due to mismatched requirements for: `test-env==0.1.0`
  Requested: {Requirement { name: PackageName("pyqt5"), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([]), index: None, conflict: None }, origin: None }}
  Existing: {}
DEBUG Solving with installed Python version: 3.11.1
DEBUG Solving with target Python version: >=3.11, <4
DEBUG Solving split (python_full_version >= '3.11' and python_full_version < '4' and sys_platform == 'win32') (requires-python: RequiresPython { specifiers: VersionSpecifiers([VersionSpecifier { operator: GreaterThanEqual, version: "3.11" }, VersionSpecifier { operator: LessThan, version: "4" }]), range: RequiresPythonRange(LowerBound(Included("3.11")), UpperBound(Excluded("4"))) })
DEBUG Adding direct dependency: test-env*
DEBUG Searching for a compatible version of test-env @ file:///C:/Users/sebi/test_env (*)
DEBUG Adding direct dependency: pyqt5*
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5.lock`
DEBUG Found stale response for: https://pypi.org/simple/pyqt5/
DEBUG Sending revalidation request for: https://pypi.org/simple/pyqt5/
DEBUG Found not-modified response for: https://pypi.org/simple/pyqt5/
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5.lock`
DEBUG Searching for a compatible version of pyqt5 (*)
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5\pyqt5-5.15.11-cp38-abi3-macosx_11_0_arm64.lock`
DEBUG Selecting: pyqt5==5.15.11 [compatible] (PyQt5-5.15.11-cp38-abi3-macosx_11_0_arm64.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/11/64/42ec1b0bd72d87f87bde6ceb6869f444d91a2d601f2e67cd05febc0346a1/PyQt5-5.15.11-cp38-abi3-macosx_11_0_arm64.whl.metadata
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5\pyqt5-5.15.11-cp38-abi3-macosx_11_0_arm64.lock`
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-qt5>=5.15.2, <5.16.0
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-sip>=12.15, <13
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-qt5.lock`
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-sip.lock`
DEBUG Found stale response for: https://pypi.org/simple/pyqt5-sip/
DEBUG Sending revalidation request for: https://pypi.org/simple/pyqt5-sip/
DEBUG Found stale response for: https://pypi.org/simple/pyqt5-qt5/
DEBUG Sending revalidation request for: https://pypi.org/simple/pyqt5-qt5/
DEBUG Found not-modified response for: https://pypi.org/simple/pyqt5-sip/
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-sip.lock`
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-sip\pyqt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.lock`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/52/fd/7d6e3deca5ce37413956faf4e933ce6beb87ac0cc7b26d934b5ed998f88a/PyQt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.whl.metadata
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-sip\pyqt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.lock`
DEBUG Found not-modified response for: https://pypi.org/simple/pyqt5-qt5/
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-qt5.lock`
DEBUG Searching for a compatible version of pyqt5-qt5 (>=5.15.2, <5.16.0)
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-qt5\pyqt5_qt5-5.15.16-1-py3-none-manylinux2014_x86_64.lock`
DEBUG Selecting: pyqt5-qt5==5.15.16 [compatible] (PyQt5_Qt5-5.15.16-1-py3-none-manylinux2014_x86_64.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/2f/97/ef77663fb5d61b65f2e93edc135cc0b86724c1fc610c10a6867ae0c0baff/PyQt5_Qt5-5.15.16-1-py3-none-manylinux2014_x86_64.whl.metadata
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-qt5\pyqt5_qt5-5.15.16-1-py3-none-manylinux2014_x86_64.lock`
DEBUG Searching for a compatible version of pyqt5-sip (>=12.15, <13)
DEBUG Selecting: pyqt5-sip==12.17.0 [compatible] (PyQt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.whl)
DEBUG Tried 4 versions: pyqt5 1, pyqt5-qt5 1, pyqt5-sip 1, test-env 1
DEBUG split `python_full_version >= '3.11' and python_full_version < '4' and sys_platform == 'win32'` resolution took 0.201s
DEBUG Distinct solution for split (python_full_version >= '3.11' and python_full_version < '4' and sys_platform == 'win32') with 4 packages
Resolved 4 packages in 208ms
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: test-env @ file:///C:/Users/sebi/test_env
DEBUG No workspace root found, using project root
DEBUG Ignoring existing lockfile due to mismatched requirements for: `test-env==0.1.0`
  Requested: {Requirement { name: PackageName("pyqt5"), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: GreaterThanEqual, version: "5.15.11" }]), index: None, conflict: None }, origin: None }}
  Existing: {Requirement { name: PackageName("pyqt5"), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([]), index: None, conflict: None }, origin: None }}
DEBUG Solving with installed Python version: 3.11.1
DEBUG Solving with target Python version: >=3.11, <4
DEBUG Solving split (python_full_version >= '3.11' and python_full_version < '4' and sys_platform == 'win32') (requires-python: RequiresPython { specifiers: VersionSpecifiers([VersionSpecifier { operator: GreaterThanEqual, version: "3.11" }, VersionSpecifier { operator: LessThan, version: "4" }]), range: RequiresPythonRange(LowerBound(Included("3.11")), UpperBound(Excluded("4"))) })
DEBUG Adding direct dependency: test-env*
DEBUG Searching for a compatible version of test-env @ file:///C:/Users/sebi/test_env (*)
DEBUG Adding direct dependency: pyqt5>=5.15.11
DEBUG Searching for a compatible version of pyqt5 (>=5.15.11)
DEBUG Selecting: pyqt5==5.15.11 [preference] (PyQt5-5.15.11-cp38-abi3-macosx_11_0_arm64.whl)
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-qt5>=5.15.2, <5.16.0
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-sip>=12.15, <13
DEBUG Searching for a compatible version of pyqt5-qt5 (>=5.15.2, <5.16.0)
DEBUG Selecting: pyqt5-qt5==5.15.16 [preference] (PyQt5_Qt5-5.15.16-1-py3-none-manylinux2014_x86_64.whl)
DEBUG Searching for a compatible version of pyqt5-sip (>=12.15, <13)
DEBUG Selecting: pyqt5-sip==12.17.0 [preference] (PyQt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.whl)
DEBUG Tried 4 versions: pyqt5 1, pyqt5-qt5 1, pyqt5-sip 1, test-env 1
DEBUG split `python_full_version >= '3.11' and python_full_version < '4' and sys_platform == 'win32'` resolution took 0.015s
DEBUG Distinct solution for split (python_full_version >= '3.11' and python_full_version < '4' and sys_platform == 'win32') with 4 packages
DEBUG Reverting changes to `pyproject.toml`
DEBUG Reverting changes to `uv.lock`
error: Distribution `pyqt5-qt5==5.15.16 @ registry+https://pypi.org/simple` can't be installed because it doesn't have a source distribution or wheel for the current platform

```

The problem is the dependency ```pyqt5-qt5```, the newest windows version is indeed 5.15.2. 

**When I specify the pyqt5-qt5 version, things work just fine:**

```powershell 
> uv add pyqt5 pyqt5-qt5==5.15.2
Resolved 4 packages in 45ms
Installed 3 packages in 1.81s
 + pyqt5==5.15.11
 + pyqt5-qt5==5.15.2
 + pyqt5-sip==12.17.0

```

Using this workaround, I pin the version of a dependency. For Qt5 this is obviously fine because there won't be any new non-commercial releases, but for ```uv add``` in general this behavior (and the workaround) do not look right to me. 

---

_Comment by @konstin on 2025-05-05 19:37_

Can you try `required-environments` instead of `environments`? I.e.:

```toml
[tool.uv]
required-environments = [
  "sys_platform == 'win32'"
]
```

This should resolve versions that install on windows, too.

---

_Comment by @SSchleehauf on 2025-05-05 19:54_

Yes, this solves the package resolution and I get

```
> uv add pyqt5
Resolved 5 packages in 1.18s
Installed 3 packages in 1.56s
 + pyqt5==5.15.11
 + pyqt5-qt5==5.15.2
 + pyqt5-sip==12.17.0
```

So this pin the Linux/MacOS version of pyt5-qt5 to 5.15.2 even though there are newer wheels, right?

---

_Comment by @konstin on 2025-05-05 20:04_

Yeah, it makes uv skip over versions that can't be installed with the platform listed in `required-environments`, going back to a version that can be installed.

---

_Comment by @SSchleehauf on 2025-05-05 20:24_

Thanks a lot, now I get it. You are right, this seems to be reasonable behaviour.

---

_Closed by @SSchleehauf on 2025-05-05 20:24_

---
