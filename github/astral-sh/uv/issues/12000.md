---
number: 12000
title: "`uvx` uses cached environment of a nonexistent Python version"
type: issue
state: closed
author: srenfo
labels:
  - bug
assignees: []
created_at: 2025-03-06T11:12:43Z
updated_at: 2025-07-09T13:21:00Z
url: https://github.com/astral-sh/uv/issues/12000
synced_at: 2026-01-07T12:31:15-06:00
---

# `uvx` uses cached environment of a nonexistent Python version

---

_Issue opened by @srenfo on 2025-03-06 11:12_

### Summary

After bumping the Python Docker image in our CI _with a shared cache_, `uvx` uses a cached env of a now nonexistent Python version. I expected `uvx` to detect the missing interpreter and create a new environment.

## Use Case

We have a GitLab CI job pretty much as follows:

```yaml
Test:
  image: "ghcr.io/astral-sh/uv:0.6-python3.11-bookworm"
  script:
    - uvx --with tox-uv==1.25.0 -- tox@4.24.1 run -e unit
```

After bumping the image to `ghcr.io/astral-sh/uv:0.6-python3.12-bookworm` (i. e. changing just the Python version), `uvx` tries to invoke tox using the old 3.11 environment. Notably, `XDG_CACHE_HOME` points to a directory that is shared between these invocations.

## Minimal Reproducible Example

```sh
docker volume create uvx-tool-test
docker run -v uvx-tool-test:/root/.cache ghcr.io/astral-sh/uv:python3.11-bookworm uvx tox --version
docker run -v uvx-tool-test:/root/.cache ghcr.io/astral-sh/uv:python3.12-bookworm uvx tox --version
```

The third command fails to run `tox`. Sample output, slightly redacted:

```sh
$ sudo docker volume create uvx-tool-test
uvx-tool-test

$ sudo docker run -v uvx-tool-test:/root/.cache ghcr.io/astral-sh/uv:python3.11-bookworm uvx tox --version
Downloading virtualenv (4.1MiB)
 Downloaded virtualenv
Installed 11 packages in 22ms
ROOT: No tox.ini or setup.cfg or pyproject.toml or tox.toml found, assuming empty tox.ini at /
4.24.1 from /root/.cache/uv/archive-v0/9tvCQSvNfVTYHrkVKA6MB/lib/python3.11/site-packages/tox/__init__.py

$ sudo docker run -v uvx-tool-test:/root/.cache ghcr.io/astral-sh/uv:python3.12-bookworm uvx tox --version
Traceback (most recent call last):
  File "/root/.cache/uv/archive-v0/9tvCQSvNfVTYHrkVKA6MB/bin/tox", line 6, in <module>
    from tox.run import run
ModuleNotFoundError: No module named 'tox'
```

Note how the `9tvCQSvNfVTYHrkVKA6MB` token stays the same. 

To be extra sure:

```sh
sudo docker run -v uvx-tool-test:/root/.cache ghcr.io/astral-sh/uv:python3.12-bookworm cat /root/.cache/uv/archive-v0/9tvCQSvNfVTYHrkVKA6MB/pyvenv.cfg
home = /usr/local/bin
implementation = CPython
uv = 0.6.4
version_info = 3.11.11
include-system-site-packages = false
relocatable = true
```

## Workaround

Adding an explicit Python version works just fine. `uvx --python 3.12 ...`.

### Platform

GitLab Runner with Docker images provided by Astral

### Version

uv 0.6.4

### Python version

Python 3.11 & 3.12

---

_Label `bug` added by @srenfo on 2025-03-06 11:12_

---

_Assigned to @jtfmumm by @zanieb on 2025-06-20 14:54_

---

_Comment by @jtfmumm on 2025-07-09 12:40_

I'm unable to replicate this on macOS on the latest uv (0.7.19) running your minimal reproduction commands. I see:
```
$ docker volume create uvx-tool-test
uvx-tool-test

$ docker run -v uvx-tool-test:/root/.cache ghcr.io/astral-sh/uv:python3.11-bookworm uvx tox --version
Downloading virtualenv (5.8MiB)
 Downloading virtualenv
Installed 11 packages in 33ms
ROOT: No tox.ini or setup.cfg or pyproject.toml or tox.toml found, assuming empty tox.ini at /
4.27.0 from /root/.cache/uv/archive-v0/8r4jCcebY_0XOfnVd5nM7/lib/python3.11/site-packages/tox/__init__.py

$ docker run -v uvx-tool-test:/root/.cache ghcr.io/astral-sh/uv:python3.12-bookworm uvx tox --version
Installed 11 packages in 9ms
ROOT: No tox.ini or setup.cfg or pyproject.toml or tox.toml found, assuming empty tox.ini at /
4.27.0 from /root/.cache/uv/archive-v0/NAbOR_8F1xcCoteNv0sOV/lib/python3.12/site-packages/tox/__init__.py
```

Were you running these commands locally? And do you still have this problem after upgrading uv?

---

_Comment by @srenfo on 2025-07-09 13:21_

Yes we were running these commands locally. And no, we can no longer reproduce the problem after upgrading.

I did a little bisecting and it looks like uv 0.7.13 was the last affected version (albeit in a different way than reported here, with empty output rather than a traceback) and the fix must have landed in 0.7.14.

Thank you for following up on this!

---

_Closed by @srenfo on 2025-07-09 13:21_

---
