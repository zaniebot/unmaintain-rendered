---
number: 9424
title: Please comment on CVE-2024-53899 and virtualenv activation scripts
type: issue
state: closed
author: musicinmybrain
labels:
  - security
assignees: []
created_at: 2024-11-25T19:47:23Z
updated_at: 2024-11-27T14:27:40Z
url: https://github.com/astral-sh/uv/issues/9424
synced_at: 2026-01-07T13:12:18-06:00
---

# Please comment on CVE-2024-53899 and virtualenv activation scripts

---

_Issue opened by @musicinmybrain on 2024-11-25 19:47_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->
Yesterday, [CVE-2024-53899](https://nvd.nist.gov/vuln/detail/CVE-2024-53899) was published, with the following description:

> virtualenv before 20.26.6 allows command injection through the activation scripts for a virtual environment. Magic template strings are not quoted correctly when replacing.

This corresponds to https://github.com/pypa/virtualenv/issues/2768 and is supposed to be fixed by https://github.com/pypa/virtualenv/pull/2771.

Because `uv` vendors `virtualenv` activation scripts in [`crates/uv-virtualenv/src/activator/`](https://github.com/astral-sh/uv/tree/0.5.4/crates/uv-virtualenv/src/activator/), I wondered if `uv` was also affected. Imitating the original reproducer in https://github.com/pypa/virtualenv/issues/2768, and working with a `uv` checkout on the `0.5.4` tag:

```
$ cargo build
$ envname="';uname -a;':"
$ mkdir "$envname"
$ cd "$envname"
$ ../target/debug/uv venv .
$ . ./bin/activate
(';uname -a;':) ben@musicbox:~/src/forks/uv/';uname -a;':$
```

This is good; the `uname -a` command was not executed, so this test did *not* reproduce the problem.

Checking older versions, it looks like this was fixed between `uv` 0.5.2 and 0.5.3, probably in https://github.com/astral-sh/uv/pull/8984 (although I did not bother bisecting). To reiterate this very clearly, I *was not* able to trivially reproduce CVE-2024-53899 in `uv` 0.5.3 and later, but I *was* able to reproduce it (output from `uname -a` appeared in my console) in `uv` 0.5.2 and earlier.

Could you please comment on whether you believe the underlying issue is entirely mitigated in `uv`, or whether further work needs to be done? Thank you!

---

_Assigned to @konstin by @zanieb on 2024-11-25 19:54_

---

_Comment by @charliermarsh on 2024-11-25 20:10_

Thanks for filing! We'll take a look.

---

_Label `security` added by @charliermarsh on 2024-11-25 20:10_

---

_Referenced in [astral-sh/uv#9466](../../astral-sh/uv/pulls/9466.md) on 2024-11-27 12:35_

---

_Comment by @konstin on 2024-11-27 12:37_

Due to #8984, uv is unaffected for:
* bash
* csg
* fish
* nushell

The powershell activator does not contain the path.

The batch activator is fixed by #9466.

While #8947 and the batch behavior are clearly bugs, I would like to remind users that you should never build virtual environments from untrusted input. There are various sources of arbitrary code execution, such as `.pth` files, wheel data writing to arbitrary paths in the venv and source dist builds running arbitrary code.

---

_Comment by @musicinmybrain on 2024-11-27 14:27_

Thank you for investigating!

---

_Closed by @musicinmybrain on 2024-11-27 14:27_

---
