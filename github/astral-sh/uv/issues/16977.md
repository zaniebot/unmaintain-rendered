---
number: 16977
title: "uv: local package randomly becomes unimportable in project created with `uv init --package`"
type: issue
state: open
author: jesusseper
labels:
  - bug
  - needs-mre
assignees: []
created_at: 2025-12-04T12:18:05Z
updated_at: 2025-12-10T14:53:52Z
url: https://github.com/astral-sh/uv/issues/16977
synced_at: 2026-01-07T12:31:16-06:00
---

# uv: local package randomly becomes unimportable in project created with `uv init --package`

---

_Issue opened by @jesusseper on 2025-12-04 12:18_

### Summary

GitHub issue

# uv: local package randomly becomes unimportable in project created with `uv init --package`

I'm using uv to manage a Python project for my master's thesis, and I'm seeing a strange, seemingly non-deterministic behavior with my local package imports.

Sometimes uv installs my package correctly and I can import it, but after running a few commands the same import suddenly fails with ModuleNotFoundError, without any changes to the code or configuration.

At this point I'm not sure whether I’m misconfiguring something or hitting a bug.

**Update / Root cause (not uv-specific):**  
The imports fail when Python skips the editable `.pth` file because it is marked hidden at the filesystem level (macOS `UF_HIDDEN`). With `python -v`, you can see:  
`Skipping hidden .pth file: .../__editable__.tfm_rag_municipal-0.1.0.pth`  

Since Python 3.12+ skips hidden `.pth` files, the PEP 660 editable hook is never executed, so the package disappears from imports.  

**Workaround / Fix:** create the venv as `venv/` (not `.venv/`) or remove hidden flags (e.g. `chflags -R nohidden .venv`). After creating `uv venv venv`, imports are stable.

---

## Environment

- OS: macOS (MacBook Air M1, 2020)
- Python: 3.12.7
- uv version: uv 0.9.15 (5eafae332 2025-12-02)
- Project layout: src layout, created with:

    uv init --package tfm-rag-municipal

---

## Project layout

After creating the project, I copied my existing code into the generated structure:

    tfm-rag-municipal/
      pyproject.toml
      src/
        tfm_rag_municipal/
          __init__.py
          example.py
          corpus_audit/
            __init__.py
            corpusrecord_example.py
            schema.py
      tests/
        test_example.py

Example module:

    # src/tfm_rag_municipal/example.py
    def add(a: int, b: int) -> int:
        return a + b

Test:

    # tests/test_example.py
    from tfm_rag_municipal.example import add

    def test_add_basic():
        assert add(2, 3) == 5

Submodule usage:

    # src/tfm_rag_municipal/corpus_audit/corpusrecord_example.py
    from tfm_rag_municipal.corpus_audit.schema import CorpusRecord

    record = CorpusRecord(
        doc_id="ordenanza_reguladora_01",
        title=(
            "ORDENANZA REGULADORA SOBRE PROTECCIÓN DEL MEDIO AMBIENTE "
            "CONTRA LA EMISIÓN DE RUIDOS Y VIBRACIONES"
        ),
        # ... other fields ...
    )

    print(record.title)

---

## pyproject.toml

    [project]
    name = "tfm-rag-municipal"
    version = "0.1.0"
    description = "TFM: Asistente RAG municipal para Aguilar de Campoo"
    readme = "README.md"
    authors = [
        { name = "Jesús Sevilla", email = "83033602+jesusseper@users.noreply.github.com" }
    ]
    requires-python = ">=3.12"
    dependencies = []

    [project.scripts]
    tfm-rag-municipal = "tfm_rag_municipal:main"

    [project.optional-dependencies]
    dev = [
        "pytest>=9.0.1",
        "ruff>=0.14.7",
        "pre-commit>=4.5.0",
    ]

    [build-system]
    requires = ["uv_build>=0.9.15,<0.10.0"]
    build-backend = "uv_build"

Dev dependencies:

    uv add --dev pytest ruff pre-commit
    uv sync

uv sync output includes:

    + tfm-rag-municipal==0.1.0 (from file:///Users/.../tfm-rag-municipal)

---

## The weird behavior

Fresh sync works:

    rm -rf .venv uv.lock src/tfm_rag_municipal.egg-info
    uv sync
    uv run python -c "import tfm_rag_municipal"
    uv run pytest
    uv run python -m tfm_rag_municipal.corpus_audit.corpusrecord_example

But repeatedly running imports eventually fails:

    uv run python -c "import tfm_rag_municipal"
    uv run python -c "import tfm_rag_municipal"
    uv run python -c "import tfm_rag_municipal"
    uv run python -c "import tfm_rag_municipal"

Result:

    ModuleNotFoundError: No module named 'tfm_rag_municipal'

Resetting and syncing fixes it temporarily:

    rm -rf .venv uv.lock src/tfm_rag_municipal.egg-info
    uv sync

---

## Things I’ve already tried

- Recreated project with uv init --package
- Added explicit uv_build backend
- Verified uv sync installs the local package
- Verified __init__.py exists
- Reproduced with minimal steps
- Not using pip install/uninstall manually
- Not modifying PYTHONPATH
- VS Code open but issue reproduces only with terminal

---

## Question

Is anything wrong with my configuration or usage of uv?

- Is this a known issue with uv and local packages?
- Is there a recommended way to ensure the package is always importable?
- Should I revert to venv + pip install -e . for stability?

Any insight or workaround would be appreciated. 


### Platform

Darwin 25.1.0 arm64

### Version

uv 0.9.15 (5eafae332 2025-12-02)

### Python version

Python 3.12.7

---

_Label `bug` added by @jesusseper on 2025-12-04 12:18_

---

_Comment by @zanieb on 2025-12-04 14:38_

That's weird.

Do you have verbose logs for the `uv run` operations that fail? e.g., `uv run -vv  python -c "import tfm_rag_municipal"`? It'd be nice to see both the failing and succeeding cases there.

---

_Comment by @jesusseper on 2025-12-04 15:25_

Thanks for the quick reply!

I’ve collected verbose logs for both the succeeding and failing cases.

I started from a clean state with:

```bash
rm -rf .venv uv.lock src/tfm_rag_municipal.egg-info
uv sync
```

---

### 1) Succeeding run

Right after `uv sync`, this works:

```bash
uv run -vv python -c "import tfm_rag_municipal"
```

Verbose output:

```text
DEBUG uv 0.9.15 (5eafae332 2025-12-02)
TRACE Checking shared lock for `/Users/jesus/.cache/uv` at `/Users/jesus/.cache/uv/.lock`
DEBUG Acquired shared lock for `/Users/jesus/.cache/uv`
DEBUG Found project root: `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal`
DEBUG No workspace root found, using project root
DEBUG Discovered project `tfm-rag-municipal` at: /Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal
TRACE Checking lock for `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal` at `/var/folders/63/80bmhs111lvc5y5wf0gkcsjh0000gn/T/uv-39e
6438bbf77604a.lock`                                                                                                                                           DEBUG Acquired lock for `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal`
DEBUG Reading Python requests from version file at `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at: `.venv`
TRACE Found cached interpreter info for Python 3.12.7, skipping query of: .venv/bin/python3
DEBUG The project environment's Python version satisfies the request: `Python 3.12`
TRACE The project environment's Python version meets the Python requirement: `>=3.12`
TRACE The virtual environment's Python interpreter meets the Python preference: `prefer managed`
DEBUG Released lock at `/var/folders/63/80bmhs111lvc5y5wf0gkcsjh0000gn/T/uv-39e6438bbf77604a.lock`
TRACE Checking lock for `.venv` at `.venv/.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: tfm-rag-municipal @ file:///Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 17 packages in 35ms
DEBUG Using request timeout of 30s
TRACE Comparing installed with source: InstalledDist { kind: Url(InstalledDirectUrlDist { name: PackageName("tfm-rag-municipal"), version: "0.1.0", direct_url
: LocalDirectory { url: "file:///Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", dir_info: DirInfo { editable: Some(true) }, subdirectory: None }, url: DisplaySafeUrl { scheme: "file", cannot_be_a_base: false, username: "", password: None, host: None, port: None, path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", query: None, fragment: None }, editable: true, path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/tfm_rag_municipal-0.1.0.dist-info", cache_info: Some(CacheInfo { timestamp: Some(Timestamp(SystemTime { tv_sec: 1764847066, tv_nsec: 184468365 })), commit: None, tags: None, env: {}, directories: {"src": Some(Timestamp(Timestamp(SystemTime { tv_sec: 1764846439, tv_nsec: 845151379 })))} }), build_info: Some(BuildInfo { config_settings: ConfigSettings({}), extra_build_requires: [], extra_build_variables: {} }) }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Directory { install_path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", editable: Some(true), virtual: Some(false), url: VerbatimUrl { url: DisplaySafeUrl { scheme: "file", cannot_be_a_base: false, username: "", password: None, host: None, port: None, path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", query: None, fragment: None }, given: None } }                                                                                                                                                       DEBUG Computed cache info: Timestamp(SystemTime { tv_sec: 1764847066, tv_nsec: 184468365 }), None, None, {}, {"src": Some(Timestamp(Timestamp(SystemTime { tv_
sec: 1764846439, tv_nsec: 845151379 })))}. Most recently modified: pyproject.toml                                                                             DEBUG Requirement already installed: tfm-rag-municipal==0.1.0 (from file:///Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal)
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pre-commit"), version: "4.5.0", path: "/Users
/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pre_commit-4.5.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "4.5.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }     DEBUG Requirement already installed: pre-commit==4.5.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pytest"), version: "9.0.1", path: "/Users/jes
us/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pytest-9.0.1.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "9.0.1" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }             DEBUG Requirement already installed: pytest==9.0.1
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("ruff"), version: "0.14.7", path: "/Users/jesu
s/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/ruff-0.14.7.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "0.14.7" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }              DEBUG Requirement already installed: ruff==0.14.7
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("cfgv"), version: "3.5.0", path: "/Users/jesus
/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/cfgv-3.5.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "3.5.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }                 DEBUG Requirement already installed: cfgv==3.5.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("identify"), version: "2.6.15", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/identify-2.6.15.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "2.6.15" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }      DEBUG Requirement already installed: identify==2.6.15
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("nodeenv"), version: "1.9.1", path: "/Users/je
sus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/nodeenv-1.9.1.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "1.9.1" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }           DEBUG Requirement already installed: nodeenv==1.9.1
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pyyaml"), version: "6.0.3", path: "/Users/jes
us/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pyyaml-6.0.3.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "6.0.3" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }             DEBUG Requirement already installed: pyyaml==6.0.3
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("virtualenv"), version: "20.35.4", path: "/Use
rs/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/virtualenv-20.35.4.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "20.35.4" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }                                                                                                                                                             DEBUG Requirement already installed: virtualenv==20.35.4
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("iniconfig"), version: "2.3.0", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/iniconfig-2.3.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "2.3.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }       DEBUG Requirement already installed: iniconfig==2.3.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("packaging"), version: "25.0", path: "/Users/j
esus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/packaging-25.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "25.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }          DEBUG Requirement already installed: packaging==25.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pluggy"), version: "1.6.0", path: "/Users/jes
us/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pluggy-1.6.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "1.6.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }             DEBUG Requirement already installed: pluggy==1.6.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pygments"), version: "2.19.2", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pygments-2.19.2.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "2.19.2" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }      DEBUG Requirement already installed: pygments==2.19.2
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("distlib"), version: "0.4.0", path: "/Users/je
sus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/distlib-0.4.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "0.4.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }           DEBUG Requirement already installed: distlib==0.4.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("filelock"), version: "3.20.0", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/filelock-3.20.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "3.20.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }      DEBUG Requirement already installed: filelock==3.20.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("platformdirs"), version: "4.5.0", path: "/Use
rs/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/platformdirs-4.5.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "4.5.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None } DEBUG Requirement already installed: platformdirs==4.5.0
Audited 16 packages in 11ms
DEBUG Released lock at `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/.lock`
DEBUG Using Python 3.12.7 interpreter at: /Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/bin/python3
DEBUG Running `python -c import tfm_rag_municipal`
DEBUG Spawned child 53182 in process group 53181
DEBUG Command exited with code: 0
DEBUG Released lock at `/Users/jesus/.cache/uv/.lock`

```

---

### 2) Failing run

After about 10 minutes of normal work (editing code) while frequently trying the command to check if it still works, I ran:

```bash
git commit
```

This triggers my `pre-commit` hooks (trailing whitespace fixer, EOF fixer, Ruff, etc.), but doesn’t touch the virtualenv directly.

Immediately after that, the same command:

```bash
uv run -vv python -c "import tfm_rag_municipal"
```

started failing with `ModuleNotFoundError`. In previous experiences I did not run commits, just had to wait to see it fail, so it may be a coincidence. Verbose output:

```text
DEBUG uv 0.9.15 (5eafae332 2025-12-02)
TRACE Checking shared lock for `/Users/jesus/.cache/uv` at `/Users/jesus/.cache/uv/.lock`
DEBUG Acquired shared lock for `/Users/jesus/.cache/uv`
DEBUG Found project root: `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal`
DEBUG No workspace root found, using project root
DEBUG Discovered project `tfm-rag-municipal` at: /Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal
TRACE Checking lock for `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal` at `/var/folders/63/80bmhs111lvc5y5wf0gkcsjh0000gn/T/uv-39e
6438bbf77604a.lock`                                                                                                                                           DEBUG Acquired lock for `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal`
DEBUG Reading Python requests from version file at `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at: `.venv`
TRACE Found cached interpreter info for Python 3.12.7, skipping query of: .venv/bin/python3
DEBUG The project environment's Python version satisfies the request: `Python 3.12`
TRACE The project environment's Python version meets the Python requirement: `>=3.12`
TRACE The virtual environment's Python interpreter meets the Python preference: `prefer managed`
DEBUG Released lock at `/var/folders/63/80bmhs111lvc5y5wf0gkcsjh0000gn/T/uv-39e6438bbf77604a.lock`
TRACE Checking lock for `.venv` at `.venv/.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: tfm-rag-municipal @ file:///Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 17 packages in 31ms
DEBUG Using request timeout of 30s
TRACE Comparing installed with source: InstalledDist { kind: Url(InstalledDirectUrlDist { name: PackageName("tfm-rag-municipal"), version: "0.1.0", direct_url
: LocalDirectory { url: "file:///Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", dir_info: DirInfo { editable: Some(true) }, subdirectory: None }, url: DisplaySafeUrl { scheme: "file", cannot_be_a_base: false, username: "", password: None, host: None, port: None, path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", query: None, fragment: None }, editable: true, path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/tfm_rag_municipal-0.1.0.dist-info", cache_info: Some(CacheInfo { timestamp: Some(Timestamp(SystemTime { tv_sec: 1764847066, tv_nsec: 184468365 })), commit: None, tags: None, env: {}, directories: {"src": Some(Timestamp(Timestamp(SystemTime { tv_sec: 1764846439, tv_nsec: 845151379 })))} }), build_info: Some(BuildInfo { config_settings: ConfigSettings({}), extra_build_requires: [], extra_build_variables: {} }) }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Directory { install_path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", editable: Some(true), virtual: Some(false), url: VerbatimUrl { url: DisplaySafeUrl { scheme: "file", cannot_be_a_base: false, username: "", password: None, host: None, port: None, path: "/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal", query: None, fragment: None }, given: None } }                                                                                                                                                       DEBUG Computed cache info: Timestamp(SystemTime { tv_sec: 1764847066, tv_nsec: 184468365 }), None, None, {}, {"src": Some(Timestamp(Timestamp(SystemTime { tv_
sec: 1764846439, tv_nsec: 845151379 })))}. Most recently modified: pyproject.toml                                                                             DEBUG Requirement already installed: tfm-rag-municipal==0.1.0 (from file:///Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal)
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pre-commit"), version: "4.5.0", path: "/Users
/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pre_commit-4.5.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "4.5.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }     DEBUG Requirement already installed: pre-commit==4.5.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pytest"), version: "9.0.1", path: "/Users/jes
us/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pytest-9.0.1.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "9.0.1" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }             DEBUG Requirement already installed: pytest==9.0.1
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("ruff"), version: "0.14.7", path: "/Users/jesu
s/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/ruff-0.14.7.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "0.14.7" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }              DEBUG Requirement already installed: ruff==0.14.7
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("cfgv"), version: "3.5.0", path: "/Users/jesus
/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/cfgv-3.5.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "3.5.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }                 DEBUG Requirement already installed: cfgv==3.5.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("identify"), version: "2.6.15", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/identify-2.6.15.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "2.6.15" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }      DEBUG Requirement already installed: identify==2.6.15
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("nodeenv"), version: "1.9.1", path: "/Users/je
sus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/nodeenv-1.9.1.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "1.9.1" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }           DEBUG Requirement already installed: nodeenv==1.9.1
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pyyaml"), version: "6.0.3", path: "/Users/jes
us/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pyyaml-6.0.3.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "6.0.3" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }             DEBUG Requirement already installed: pyyaml==6.0.3
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("virtualenv"), version: "20.35.4", path: "/Use
rs/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/virtualenv-20.35.4.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "20.35.4" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }                                                                                                                                                             DEBUG Requirement already installed: virtualenv==20.35.4
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("iniconfig"), version: "2.3.0", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/iniconfig-2.3.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "2.3.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }       DEBUG Requirement already installed: iniconfig==2.3.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("packaging"), version: "25.0", path: "/Users/j
esus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/packaging-25.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "25.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }          DEBUG Requirement already installed: packaging==25.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pluggy"), version: "1.6.0", path: "/Users/jes
us/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pluggy-1.6.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "1.6.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }             DEBUG Requirement already installed: pluggy==1.6.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("pygments"), version: "2.19.2", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/pygments-2.19.2.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "2.19.2" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }      DEBUG Requirement already installed: pygments==2.19.2
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("distlib"), version: "0.4.0", path: "/Users/je
sus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/distlib-0.4.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "0.4.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }           DEBUG Requirement already installed: distlib==0.4.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("filelock"), version: "3.20.0", path: "/Users/
jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/filelock-3.20.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "3.20.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None }      DEBUG Requirement already installed: filelock==3.20.0
TRACE Comparing installed with source: InstalledDist { kind: Registry(InstalledRegistryDist { name: PackageName("platformdirs"), version: "4.5.0", path: "/Use
rs/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/lib/python3.12/site-packages/platformdirs-4.5.0.dist-info", cache_info: None, build_info: None }), metadata_cache: OnceLock(<uninit>), tags_cache: OnceLock(<uninit>) } Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "4.5.0" }]), index: Some(IndexMetadata { url: Pypi(VerbatimUrl { url: DisplaySafeUrl { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }, given: None }), format: Simple }), conflict: None } DEBUG Requirement already installed: platformdirs==4.5.0
Audited 16 packages in 11ms
DEBUG Released lock at `/Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/.lock`
DEBUG Using Python 3.12.7 interpreter at: /Users/jesus/Documents/MASTER_BIG_DATA/python_projects/tfm-rag-municipal/.venv/bin/python3
DEBUG Running `python -c import tfm_rag_municipal`
DEBUG Spawned child 62984 in process group 62983
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ModuleNotFoundError: No module named 'tfm_rag_municipal'
DEBUG Command exited with code: 1
DEBUG Released lock at `/Users/jesus/.cache/uv/.lock`

```

In both logs I can see uv detecting the project, using the same `.venv` and the same Python interpreter, and confirming that `tfm-rag-municipal==0.1.0` is already installed as an editable local package from the project directory. The only difference is that in the failing case the child Python process exits with:

```text
ModuleNotFoundError: No module named 'tfm_rag_municipal'
```

I didn’t change `pyproject.toml`, the directory structure, or the environment configuration between the successful and failing runs — the only notable event in between was running `git commit` (which runs the `pre-commit` hooks).

Let me know if any other diagnostics would be useful.


---

_Comment by @konstin on 2025-12-10 14:53_

What are those pre-commit hooks running, are they potentially changing the venv? I can't reproduce the failure and wouldn't know where uv would make those changes and we haven't seen this behavior before, my best guess is that there is some other tool that traverses the whole projects and makes some change that sets the pth file to hidden.

---

_Label `needs-mre` added by @konstin on 2025-12-10 14:53_

---
