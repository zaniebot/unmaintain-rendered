---
number: 13183
title: Wrong pep508 error message when moving a package from a mandatory to an optional dependency.
type: issue
state: closed
author: facundoq
labels:
  - question
assignees: []
created_at: 2025-04-28T18:14:39Z
updated_at: 2025-04-29T08:42:59Z
url: https://github.com/astral-sh/uv/issues/13183
synced_at: 2026-01-07T12:31:16-06:00
---

# Wrong pep508 error message when moving a package from a mandatory to an optional dependency.

---

_Issue opened by @facundoq on 2025-04-28 18:14_

### Summary

When moving a dependency from the mandatory to the optional section in `pyproject.toml`, subsequent uv sync calls fail claiming that the syntax of the dependency does not conform to pep508. Maybe I'm using uv incorrectly but in any case the error message does not make sense.

When this error appeared locally, removing the package with `uv remove <package>` and adding it with `uv add <package> --optional <group>` fixes the error. However, it still happens in github actions when caching is enabled!

Output:
````
Run uv sync --locked --all-extras --dev
  uv sync --locked --all-extras --dev
  shell: /usr/bin/bash -e {0}
  env:
    UV_CACHE_DIR: /home/runner/work/_temp/setup-uv-cache
    pythonLocation: /opt/hostedtoolcache/Python/3.13.3/x64
    PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.3/x64/lib/pkgconfig
    Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.3/x64
    Python[2](https://github.com/facundoq/sklearnmodels/actions/runs/14714665612/job/41295174058#step:5:2)_ROOT_DIR: /opt/hostedtoolcache/Python/[3](https://github.com/facundoq/sklearnmodels/actions/runs/14714665612/job/41295174058#step:5:3).13.3/x64
    Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.3/x6[4](https://github.com/facundoq/sklearnmodels/actions/runs/14714665612/job/41295174058#step:5:4)
    LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.3/x64/lib
Using CPython 3.13.3 interpreter at: /opt/hostedtoolcache/Python/3.13.3/x64/bin/python3
Creating virtual environment at: .venv
error: Failed to generate package metadata for `sklearnmodels @ editable+.`
  Caused by: The build backend returned an error
  Caused by: Call to `setuptools.build_meta.build_editable` failed (exit status: 1)

[stdout]
configuration error: `project.optional-dependencies.classifiers[0]` must be pep[5](https://github.com/facundoq/sklearnmodels/actions/runs/14714665612/job/41295174058#step:5:5)08
DESCRIPTION:
    Project dependency specification according to PEP 508

GIVEN VALUE:
    "Programming Language :: Python :: 3"

OFFENDING RULE: 'format'

DEFINITION:
    {
        "$id": "#/definitions/dependency",
        "title": "Dependency",
        "type": "string",
        "format": "pep508"
    }

For more details about `format` see
https://validate-pyproject.readthedocs.io/en/latest/api/validate_pyproject.formats.html


[stderr]
/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools_scm/git.py:1[6](https://github.com/facundoq/sklearnmodels/actions/runs/14714665612/job/41295174058#step:5:6)7: UserWarning: "/home/runner/work/sklearnmodels/sklearnmodels" is shallow and may cause errors
  warnings.warn(f'"{wd.path}" is shallow and may cause errors')
Traceback (most recent call last):
  File "<string>", line 14, in <module>
    requires = get_requires_for_build({})
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/build_meta.py", line 4[7](https://github.com/facundoq/sklearnmodels/actions/runs/14714665612/job/41295174058#step:5:7)3, in get_requires_for_build_editable
    return self.get_requires_for_build_wheel(config_settings)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/build_meta.py", line 331, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=[])
           ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/build_meta.py", line 301, in _get_build_requires
    self.run_setup()
    ~~~~~~~~~~~~~~^^
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/build_meta.py", line 317, in run_setup
    exec(code, locals())
    ~~~~^^^^^^^^^^^^^^^^
  File "<string>", line 1, in <module>
    import sys
    
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/__init__.py", line 117, in setup
    return distutils.core.setup(**attrs)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/_distutils/core.py", line 160, in setup
    dist.parse_config_files()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/_virtualenv.py", line 20, in parse_config_files
    result = old_parse_config_files(self, *args, **kwargs)
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/dist.py", line 756, in parse_config_files
    pyprojecttoml.apply_configuration(self, filename, ignore_option_errors)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/config/pyprojecttoml.py", line 72, in apply_configuration
    config = read_configuration(filepath, True, ignore_option_errors, dist)
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/config/pyprojecttoml.py", line 140, in read_configuration
    validate(subset, filepath)
    ~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/_temp/setup-uv-cache/builds-v0/.tmpBghUUC/lib/python3.13/site-packages/setuptools/config/pyprojecttoml.py", line 61, in validate
    raise ValueError(f"{error}\n{summary}") from None
ValueError: invalid pyproject.toml config: `project.optional-dependencies.classifiers[0]`.
configuration error: `project.optional-dependencies.classifiers[0]` must be pep50[8](https://github.com/facundoq/sklearnmodels/actions/runs/14714665612/job/41295174058#step:5:8)

hint: This usually indicates a problem with the package or the build environment.

````

### Platform

ubuntu  24.04.2 

### Version

uv 0.6.17

### Python version

python 3.13.3

---

_Label `bug` added by @facundoq on 2025-04-28 18:14_

---

_Comment by @charliermarsh on 2025-04-28 18:15_

That isn't a uv error. That error is coming from `setuptools`.

---

_Comment by @facundoq on 2025-04-28 18:40_

You are right. Still, the package was added to `pyproject.toml` via `uv add` with a `setuptools` build backend project, which seemingly does not support optional dependencies, with no error. When `uv sync` runs, the error appears. It's a bit counter intuitive, since `uv` is adding an optional dependency, but then setuptools seemingly does not support it (changing to `hatchling` removes the issue).

---

_Label `bug` removed by @konstin on 2025-04-28 19:06_

---

_Comment by @konstin on 2025-04-28 19:07_

Can you share your pyproject.toml? `"Programming Language :: Python :: 3"` is not valid requirement, that's a trove classifier. Did you manually rewrite your `pyproject.toml` in a way that `classifiers` is now under `[project.optional-dependencies]` instead of `[project]`?

---

_Label `question` added by @konstin on 2025-04-28 19:08_

---

_Comment by @facundoq on 2025-04-28 23:47_

Sure,

 [version with setuptools that doesn't work](https://github.com/facundoq/sklearnmodels/blob/953031df3893b8456bb4b1521f482e910726229b/pyproject.toml),

[Version with hatchling that works](https://github.com/facundoq/sklearnmodels/blob/d622c95f78617435cf98e83c50dab5e4437b5b25/pyproject.toml)

The only change is the build system.


The file has a lot of stuff because it's the one provided by the sklearn team to contrib models (It has some pixy stuff and other things i'd personally do differently/remove). I may be able to provide a mwe tomorrow.

Note that the error happens when i'm syncing (didn't try building)

Also, everything was working properly, project went under many changes, it only broke when moving pygraphviz to an optional dependency; and only when syncing the dependency. If instead of syncing i remove and re-add the optional dependency, there's no error


---

_Comment by @facundoq on 2025-04-28 23:49_

> Can you share your pyproject.toml? `"Programming Language :: Python :: 3"` is not valid requirement, that's a trove classifier. Did you manually rewrite your `pyproject.toml` in a way that `classifiers` is now under `[project.optional-dependencies]` instead of `[project]`?

That was not intentional, but I'm sure the error happens with our without that line. I'll double check tomorrow at the office 

---

_Comment by @konstin on 2025-04-29 08:42_

Your `classifiers` entry is in the wrong spot, where it's parsed as optional dependencies entry: https://github.com/facundoq/sklearnmodels/blob/953031df3893b8456bb4b1521f482e910726229b/pyproject.toml#L28.

---

_Closed by @konstin on 2025-04-29 08:42_

---
