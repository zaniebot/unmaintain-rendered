---
number: 10664
title: Environment building fails based on order of libraries
type: issue
state: closed
author: thedch
labels:
  - resolver
assignees: []
created_at: 2025-01-16T02:12:58Z
updated_at: 2025-01-16T15:07:29Z
url: https://github.com/astral-sh/uv/issues/10664
synced_at: 2026-01-07T12:31:15-06:00
---

# Environment building fails based on order of libraries

---

_Issue opened by @thedch on 2025-01-16 02:12_

I'm not sure if this is an appropriate bug to file here, or if this is just an artifact of various libraries specifying their requirements poorly / python versioning being difficult -- resolving a dependency matrix is hard! Feel free to close if this isn't in the scope of what `uv` can fix, but I wanted to flag in case it was interesting.

In this specific case, the environment successfully builds if the ordering is `umap-learn,numpy,pandas`, but not if it's `umap-learn,pandas,numpy`.

```
❯ uv run --python 3.12 --with "umap-learn,numpy,pandas" python
Python 3.12.8 (main, Dec  6 2024, 19:42:06) [Clang 18.1.8 ] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>>

❯ uv run --python 3.12 --with "umap-learn,pandas,numpy" python
  × Failed to build `llvmlite==0.36.0`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File "<string>", line 14, in <module>
        File "/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py", line 334, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File "/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py", line 304, in _get_build_requires
          self.run_setup()
        File "/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py", line 522, in run_setup
          super().run_setup(setup_script=setup_script)
        File "/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py", line 320, in run_setup
          exec(code, locals())
        File "<string>", line 55, in <module>
        File "<string>", line 52, in _guard_py_ver
      RuntimeError: Cannot install on Python version 3.12.8; only versions >=3.6,<3.10 are supported.

      hint: This usually indicates a problem with the package or the build environment.
  help: `llvmlite` (v0.36.0) was included because `umap-learn` (v0.5.7) depends on `pynndescent` (v0.5.13) which depends on `llvmlite`

❯ uv version
uv 0.5.18 (Homebrew 2025-01-11)
```

---

_Comment by @zanieb on 2025-01-16 02:25_

Thanks for the report!

The resolver prioritized packages by their ordering (in the absence of other reasons to prioritize packages), so the change in behavior is expected. Since you don't provide any bounds on your requirements, this means we can backtrack in an undesirable way. Some discussion in https://github.com/astral-sh/uv/issues/8157 (which links to more discussion). Ideally, we'd solve the expected environment here.

---

_Label `resolver` added by @zanieb on 2025-01-16 02:25_

---

_Comment by @charliermarsh on 2025-01-16 15:07_

I believe this is because we don't respect upper-bounds on `requires-python`. See, e.g., https://github.com/astral-sh/uv/issues/10440#issuecomment-2581677866.

---

_Closed by @charliermarsh on 2025-01-16 15:07_

---
