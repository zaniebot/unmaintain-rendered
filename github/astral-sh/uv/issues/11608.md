---
number: 11608
title: "`uv run --prerelease=allow script.py` with in-line index seems to fail"
type: issue
state: closed
author: bluecoconut
labels:
  - question
assignees: []
created_at: 2025-02-18T23:00:53Z
updated_at: 2025-02-19T00:20:26Z
url: https://github.com/astral-sh/uv/issues/11608
synced_at: 2026-01-07T12:31:15-06:00
---

# `uv run --prerelease=allow script.py` with in-line index seems to fail

---

_Issue opened by @bluecoconut on 2025-02-18 23:00_

### Summary

I'm trying to get inline torch-xla[tpu] to work, but keep running into issues.

script.py
```python
# /// script
# requires-python = "==3.10.*"
# dependencies = [
#   "torch~=2.6.0",
#   "torch_xla[tpu]~=2.6.0",
# ]
#
# [[tool.uv.index]]
# url = "https://storage.googleapis.com/libtpu-releases/index.html"
#
# [[tool.uv.index]]
# url = "https://storage.googleapis.com/libtpu-wheels/index.html"
# ///

import torch
import torch_xla

print(torch_xla.__version__)
print(torch.__version__)
```

however `uv run --prerelease=allow script.py` gets an error 
```bash
  × No solution found when resolving script dependencies:
  ╰─▶ Because there is no version of libtpu-nightly==0.1.dev20241010+nightly.cleanup and
      torch-xla[tpu]==2.6.0 depends on libtpu-nightly==0.1.dev20241010+nightly.cleanup,
      we can conclude that torch-xla[tpu]==2.6.0 cannot be used.
      And because only torch-xla[tpu]<=2.6.0 is available and you require
      torch-xla[tpu]>=2.6.0, we can conclude that your requirements are unsatisfiable.
```

I created this script using 
```bash
uv add --index https://storage.googleapis.com/libtpu-releases/index.html --index https://storage.googleapis.com/libtpu-wheels/index.html --script example.py 'torch~=2.6.0' 'torch_xla[tpu]~=2.6.0' 
```

However, when i directly use UV in a different way (add to a lock file directly i guess)
```bash
uv add torch_xla[tpu]~=2.6.0 -f https://storage.googleapis.com/libtpu-releases/index.html  -f https://storage.googleapis.com/libtpu-wheels/index.html --prerelease=allow
```

this successfully adds the dependencies to a `uv.lock`

looking into the uv lock, i see:
```toml
[[package]]
name = "libtpu-nightly"
version = "0.1.dev20241010+nightly.cleanup"
source = { registry = "https://storage.googleapis.com/libtpu-releases/index.html" }
wheels = [
    { url = "https://storage.googleapis.com/libtpu-nightly-releases/wheels/libtpu-nightly/libtpu_nightly-0.1.dev20241010+nightly.cleanup-py3-none-any.whl" },
]
```

which shows that the lock file (outside of the inline toml of scripts) correctly handled the index and worked. 

By using the lock file, I was able to get the manual wheel, and then I was able to pin the script (so I have a very temproary workaround) where I ignore the indexes (since they don't seem to work) and simply pin the wheel. 

```
# /// script
# requires-python = "==3.10.*"
# dependencies = [
#   "torch~=2.6.0",
#   "torch-xla[tpu]~=2.6.0",
#   "libtpu-nightly @ https://storage.googleapis.com/libtpu-nightly-releases/wheels/libtpu-nightly/libtpu_nightly-0.1.dev20241010+nightly.cleanup-py3-none-any.whl"
# ]
# ///
```

i don't really like doing this though, and would rather the index work as expected. 

My only guess is that the `--prerelease=allow` flag somehow is causing this to not work, since in the documetnation there are other examples of using `[[tool.uv.index]]` sections in-line with a script. 

(For some context, I'm trying to install based on instructions on the pytorch-xla repo https://github.com/pytorch/xla for TPU VMs, which includes the `pip install ... -f` command I'm trying to adopt into a script toml header) 

### Platform

Linux 5.19.0-1022-gcp x86_64 GNU/Linux

### Version

uv 0.5.26

### Python version

Python 3.13.1 (though the script im using pins to ==3.10.*)

---

_Label `bug` added by @bluecoconut on 2025-02-18 23:00_

---

_Comment by @charliermarsh on 2025-02-19 00:03_

Those aren't actually indexes, they're `--find-links` entries (which are a little different and not standardized). We do support them, but you have to use a different field, like:

```toml
# /// script
# requires-python = "==3.10.*"
# dependencies = [
#   "torch~=2.6.0",
#   "torch_xla[tpu]~=2.6.0",
# ]
#
# [tool.uv]
# find-links = [
#   "https://storage.googleapis.com/libtpu-releases/index.html",
#   "https://storage.googleapis.com/libtpu-wheels/index.html",
# ]
# ///
```

Can you give something like that a try?


---

_Label `bug` removed by @charliermarsh on 2025-02-19 00:03_

---

_Label `question` added by @charliermarsh on 2025-02-19 00:03_

---

_Comment by @bluecoconut on 2025-02-19 00:13_

Aha! Beautiful. Thank you, TIL about "find-links" vs. "index". 

this worked wonderfully.

Here's the updated header that worked for me, and hopefully will save anyone else searching for something similar in the future.

```
# /// script
# requires-python = "==3.10.*"
# dependencies = [
#   "torch~=2.6.0",
#   "torch-xla[tpu]~=2.6.0",
# ]
# [tool.uv]
# find-links = [
#   "https://storage.googleapis.com/libtpu-releases/index.html",
#   "https://storage.googleapis.com/libtpu-wheels/index.html",
# ]
# prerelease = "allow"
# ///
```

---

_Closed by @bluecoconut on 2025-02-19 00:13_

---

_Comment by @charliermarsh on 2025-02-19 00:17_

Awesome, thanks for following up. There's a TODO somewhere to add support for `--find-links`-style HTML pages in the `[[tool.uv.index]]` API.

(`--find-links` is basically a single HTML page with a bunch of links to assets, whereas with a standard registry, you have an index that tells you all the available packages, and then you can ask it to list the versions / assets for a given package.)


---

_Comment by @zanieb on 2025-02-19 00:20_

Can we hint if there are no versions on an index that looks find-linksy?

---
