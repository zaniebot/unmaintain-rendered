---
number: 7838
title: Workspace dependencies are not fully synced before run
type: issue
state: closed
author: mathialo
labels:
  - enhancement
  - cli
assignees: []
created_at: 2024-10-01T13:10:03Z
updated_at: 2024-12-27T16:43:32Z
url: https://github.com/astral-sh/uv/issues/7838
synced_at: 2026-01-07T12:31:15-06:00
---

# Workspace dependencies are not fully synced before run

---

_Issue opened by @mathialo on 2024-10-01 13:10_

I'm currently testing out the workspace features of uv, and have come across something unexpected.

When running `uv run ...` in a workspace member, it will install any new packages from the member's dependencies into the venv, but it will not remove any dependencies left-over from other members. That can lead to an issue where two members needs a dependency, and it's only listed for one, but unless you manually run `uv sync` every time you move between them you will not notice.

I've set up a small project to illustrate, with two subpackages:

```
.
├── project-a
│   ├── hello.py
│   ├── pyproject.toml
│   └── README.md
├── project-b
│   ├── hello.py
│   ├── pyproject.toml
│   └── README.md
├── pyproject.toml
├── README.md
└── uv.lock
```

where `project-a` has a dependency on `pyhumps`:

``` toml
[project]
name = "project-a"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = ["pyhumps>=3.8.0"]
```

and `project-b` does not:

``` toml
[project]
name = "project-b"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = []
```

Both have a similar `hello.py` test script that uses `pyhumps`:
``` python
from humps import pascalize

def main():
    print(f"Hello from {pascalize('project-a')}!")

if __name__ == "__main__":
    main()
```

If I run `uv run hello.py` in `project-a` first, `uv run hello.py` will work in `project-b` after - until I manually run `uv sync` and then it stops working.

This same behavior is there for dev dependencies as well. Say if one member dev-depends on `pytest`, running `uv run pytest` anywhere else in the workspace works until manually synced.

This can of course be worked around by always running `uv sync`, but knowing myself I will forget to do that.

---

_Comment by @charliermarsh on 2024-10-16 19:33_

I guess this would be `uv run --exact`.

---

_Label `enhancement` added by @charliermarsh on 2024-10-16 19:33_

---

_Label `cli` added by @charliermarsh on 2024-10-16 19:33_

---

_Comment by @jstriebel on 2024-11-13 18:38_

> I guess this would be `uv run --exact`.

Sounds great IMO. FTR, the default behavior with `uv sync` is to remove superfluous packages, and uses `--inexact` to flip the behavior. (Related issue: https://github.com/astral-sh/uv/issues/4358)

On a similar note (but maybe worth a separate ticket?):
`uv run --no-sync` is slightly confusing, given that `--sync` already has a different default behavior. Should/Could this be clarified in the help text? One more alternative would be to unify the default behavior of `run` and `sync`, but I see that the current defaults match typical scenarios very well, especially in workspaces, since un- and re-installing all the time when switching packages is not very ergonomic.

PS: Thanks a ton for the awesome work!

---

_Comment by @NicholasPini on 2024-11-20 17:04_

> I guess this would be `uv run --exact`.

This would be really useful. I'm running a workspace with various subpackages, and being certain that `uv run --package whatever` matches the `pyproject.toml` exactly would be great.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-12-27 16:08_

---

_Referenced in [astral-sh/uv#10198](../../astral-sh/uv/pulls/10198.md) on 2024-12-27 16:31_

---

_Closed by @charliermarsh on 2024-12-27 16:43_

---
