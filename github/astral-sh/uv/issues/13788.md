---
number: 13788
title: Monorepo support with import-based dependency inference and custom build targets
type: issue
state: open
author: jperezr21
labels:
  - enhancement
  - wish
assignees: []
created_at: 2025-06-02T18:57:13Z
updated_at: 2025-06-05T09:53:20Z
url: https://github.com/astral-sh/uv/issues/13788
synced_at: 2026-01-07T12:31:16-06:00
---

# Monorepo support with import-based dependency inference and custom build targets

---

_Issue opened by @jperezr21 on 2025-06-02 18:57_

### Summary

I would like uv to support a monorepo setup similar to Pants, where:

1. A single `pyproject.toml` file declares all third-party dependencies using version ranges.
2. A single `uv.lock` file pins exact versions across the entire repository.
3. Multiple subprojects can be defined with something akin to Pants’s `BUILD` files, enabling custom target types (for example, `python_aws_lambda_layer`: https://www.pantsbuild.org/stable/docs/python/integrations/aws-lambda).
4. When building a specific target, UV automatically infers which dependencies are actually needed by scanning imports, and packages only those requirements for that target.


### Motivation

Right now, uv workspaces let me install every package in one consolidated virtual environment and lock down versions in `uv.lock`. However:

* Each subproject still needs its own `pyproject.toml` and explicit dependency list.
* There’s no mechanism to declare higher-level “build targets” (e.g., an AWS Lambda layer or a Python binary) that pull in only the necessary dependencies.
* UV doesn’t scan imports to figure out which packages a given target actually needs, so I end up shipping unnecessary code or manually pruning dependencies when building.

In a monorepo with multiple services or functions (for example, several AWS Lambdas plus a shared library), it becomes cumbersome to keep each subproject’s `pyproject.toml` in sync with the actual imports. A unified setup would let us:

* Define all dependencies only once (with range constraints) in the root `pyproject.toml`.
* Lock them to exact versions in `uv.lock`.
* Create lightweight “target” descriptions in dedicated files (similar to Pants’s `BUILD` files) that specify what type of output I want (e.g., Lambda layer, Python binary, test suite).
* Have UV inspect the imports under each target’s source directory and automatically include only the third-party packages needed for that target, without manually updating each subproject’s manifest.

This workflow reduces drift between declared vs. actual dependencies, avoids shipping unused code, and simplifies dependency management across many small services.


---

_Label `enhancement` added by @jperezr21 on 2025-06-02 18:57_

---

_Comment by @konstin on 2025-06-03 09:48_

> A single pyproject.toml file declares all third-party dependencies using version ranges.

We'd like to support that too, but unfortunately PEP 621 doesn't this for a workspace atm.

> Each subproject still needs its own pyproject.toml and explicit dependency list.

We consider this a feature, it makes the dependencies of different parts of the project explicit, and it also helps with features such as IDE integrations. Ideally, the IDE checks that the declared imports and the used packages match (PyCharm for example does this to some extend). This may become a lint in ty rather than uv in the future.

I agree that it would be nice to be able to define build targets, but it's still a bit far out for uv.

---

_Label `wish` added by @konstin on 2025-06-03 09:48_

---

_Comment by @vhtmui on 2025-06-05 09:53_

That's exactly what I want! !

---

_Referenced in [thromer/uv-monorepo-example#1](../../thromer/uv-monorepo-example/pulls/1.md) on 2025-06-29 21:52_

---
