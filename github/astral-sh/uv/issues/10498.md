---
number: 10498
title: "Revised `activate` script fails on `alpine:edge`"
type: issue
state: open
author: charliermarsh
labels:
  - bug
assignees: []
created_at: 2025-01-11T14:11:31Z
updated_at: 2025-04-01T19:23:16Z
url: https://github.com/astral-sh/uv/issues/10498
synced_at: 2026-01-07T12:31:15-06:00
---

# Revised `activate` script fails on `alpine:edge`

---

_Issue opened by @charliermarsh on 2025-01-11 14:11_

This change caused our CI to fail using `alpine:edge` image 

```
web-1  | /srv/scripts/run.sh: /srv/.venv/bin/activate: line 81: OSTYPE: parameter not set
```

_Originally posted by @andypost in https://github.com/astral-sh/uv/issues/10397#issuecomment-2584967660_
            

---

_Renamed from "This change caused our CI to fail using `alpine:edge` image" to "Revised `activate` script fails on `alpine:edge`" by @charliermarsh on 2025-01-11 14:11_

---

_Label `bug` added by @charliermarsh on 2025-01-11 14:11_

---

_Referenced in [astral-sh/uv#10492](../../astral-sh/uv/pulls/10492.md) on 2025-01-11 15:34_

---

_Comment by @zanieb on 2025-01-11 16:44_

I can't reproduce this

```Dockerfile
FROM alpine:edge

RUN apk add --update --no-cache python3

COPY --from=ghcr.io/astral-sh/uv:0.5.17 /uv /uvx /bin/
RUN uv venv /venv
RUN . /venv/bin/activate
```

---

_Comment by @zanieb on 2025-01-11 16:46_

@andypost am I using a different image or shell than you?

---

_Comment by @andypost on 2025-01-11 19:09_

@zanieb the way to reproduce is `set -eux` before activation

```Dockerfile
FROM alpine:edge

RUN apk add --update --no-cache python3

COPY --from=ghcr.io/astral-sh/uv:0.5.17 /uv /uvx /bin/
RUN uv venv /venv
RUN set -eux && . /venv/bin/activate
```

the log
```
0.710 + . /venv/bin/activate                                                                                                                                                                                                                                 
0.712 + '[' -n  ]
0.712 + '[' -n  ]
0.712 + '[' -n  ]
0.713 + deactivate nondestructive
0.714 + unset -f pydoc
0.714 + '[' -n  ]
0.714 + '[' -n  ]
0.714 + hash -r
0.714 + '[' -n  ]
0.714 + unset VIRTUAL_ENV
0.714 + unset VIRTUAL_ENV_PROMPT
0.714 + '[' '!' nondestructive '=' nondestructive ]
0.715 + VIRTUAL_ENV=/venv
0.715 /bin/sh: /venv/bin/activate: line 81: OSTYPE: parameter not set
```

---

_Comment by @zanieb on 2025-01-11 19:33_

Thanks! Looks like this can be resolved with

```
RUN sed -i 's/if { \[ "$OSTYPE" = "cygwin" \] || \[ "$OSTYPE" = "msys" \]; }/if { [ "${OSTYPE-}" = "cygwin" ] || [ "${OSTYPE-}" = "msys" ]; }/' /venv/bin/activate
```

or

```diff
â¯ gd
diff --git a/crates/uv-virtualenv/src/activator/activate b/crates/uv-virtualenv/src/activator/activate
index 3678ee23b..f87ca81dd 100644
--- a/crates/uv-virtualenv/src/activator/activate
+++ b/crates/uv-virtualenv/src/activator/activate
@@ -78,7 +78,7 @@ deactivate () {
 deactivate nondestructive
 
 VIRTUAL_ENV='{{ VIRTUAL_ENV_DIR }}'
-if { [ "$OSTYPE" = "cygwin" ] || [ "$OSTYPE" = "msys" ]; } && command -v cygpath > /dev/null 2>&1 ; then
+if { [ "${OSTYPE-}" = "cygwin" ] || [ "${OSTYPE-}" = "msys" ]; } && command -v cygpath > /dev/null 2>&1; then
     VIRTUAL_ENV=$(cygpath -u "$VIRTUAL_ENV")
 fi
 export VIRTUAL_ENV
```

---

_Referenced in [astral-sh/uv#10521](../../astral-sh/uv/pulls/10521.md) on 2025-01-11 19:35_

---

_Assigned to @Gankra by @Gankra on 2025-01-15 17:37_

---
