---
number: 14318
title: Unable to Authenticate and Install from AWS CodeArtifact via iPython Magic Commands
type: issue
state: open
author: nscipione-sumer
labels:
  - bug
assignees: []
created_at: 2025-06-27T15:28:53Z
updated_at: 2025-09-18T12:05:50Z
url: https://github.com/astral-sh/uv/issues/14318
synced_at: 2026-01-07T12:31:16-06:00
---

# Unable to Authenticate and Install from AWS CodeArtifact via iPython Magic Commands

---

_Issue opened by @nscipione-sumer on 2025-06-27 15:28_

### Summary

# Overview
I'm trying to write a tutorial that shows you how to import Python packages from an AWS CodeArtifact repo, and I attempted to write it in a Jupyter Notebook. I copied the same steps I use to run successfully in my terminal, but I suspect that the uv magic command is unable to access the notebook's environment variables.

# Reproduce: In a Jupyter Notebook
Requirements: uv and aws cli

## Step 1: Setup
```
<VSCode.Cell language="python">
%%bash
# Must login every 12 hours
if aws sts get-caller-identity --profile data > /dev/null 2>&1; then
  echo "Already logged in to AWS SSO (profile: data)."
else
  echo "Not logged in. Running 'aws sso login --profile data'..."
  aws sso login --profile data
fi
</VSCode.Cell>
```

```
<VSCode.Cell language="python">
%%bash --out CODEARTIFACT_AUTH_TOKEN
aws codeartifact get-authorization-token \
  --domain private-pypi \
  --domain-owner account-id \
  --region us-east-1 \
  --query authorizationToken \
  --output text \
  --profile data
</VSCode.Cell>
```

```
<VSCode.Cell language="python">
%set_env UV_INDEX_PRIVATE_USERNAME=aws
%set_env UV_INDEX_PRIVATE_PASSWORD=$CODEARTIFACT_AUTH_TOKEN
!uv add play-speed --group traits
</VSCode.Cell>
```

## Step 2: Add packages
```
<VSCode.Cell language="python">
uv add play-speed --group traits --verbose
</VSCode.Cell>
```

Output snippet:
```
DEBUG Reverting changes to `pyproject.toml`
DEBUG Reverting changes to `uv.lock`
  × No solution found when resolving dependencies:
  ╰─▶ Because play-speed was not found in the package registry and
      player-traits:traits depends on play-speed, we can conclude that
      player-traits:traits's requirements are unsatisfiable.
      And because your project requires player-traits:traits, we can conclude
      that your project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution,
        provide the `--frozen` flag to skip locking and syncing.
DEBUG Released lock at `/Users/nick.scipione/Developer/Work/player-traits/.venv/.lock`
Note: you may need to restart the kernel to use updated packages.
```


### Platform

Darwin 24.5.0 arm64

### Version

uv 0.7.15 (4ed9c5791 2025-06-25)

### Python version

Python 3.12.9

---

_Label `bug` added by @nscipione-sumer on 2025-06-27 15:28_

---

_Comment by @IllarionovDimitri on 2025-08-20 13:39_

i have the same issue with uv 0.8.12 on Ubuntu, setting USERNAME and PASSWORD as provided in documentation has no effect. i get 401 Not authorized. But pulling a package from Codeartifact works if i hardcode them in `pyproject.toml` like "url = https://aws:eyJ2ZXIiOj...@..."

---

_Comment by @IllarionovDimitri on 2025-08-29 08:12_

@charliermarsh great job! uv rocks! have you any intent/plans to fix this issue? we're using AWS Codeartifact but i get following error:

```bash
uv sync
  × No solution found when resolving dependencies:
  ╰─▶ Because alphaconf was not found in the package registry and your project depends on alphaconf, we can conclude that your project's requirements are unsatisfiable.

      hint: An index URL (https://***-***.d.codeartifact.***.amazonaws.com/pypi/d***/simple/) could not be queried due to a lack of valid authentication credentials (401
      Unauthorized).
```

If i hardcode the creds it works. And package is definitely in registry, because i've just published it using `uv publish` :)

I assume smth might be wrong with reading 
export UV_INDEX_PRIVATE_REGISTRY_USERNAME=aws
export UV_INDEX_PRIVATE_REGISTRY_PASSWORD="$AWS_CODEARTIFACT_TOKEN"

thanks!

---

_Comment by @charliermarsh on 2025-08-29 12:06_

What does the entry in your `pyproject.toml` look like?

---

_Comment by @IllarionovDimitri on 2025-08-29 12:18_

thanks for quick response! here is my `pyproject.toml` (i've masked aws account number, but in original version it is fully expanded of course)

Publishing with 

```
export UV_PUBLISH_USERNAME=aws
export UV_PUBLISH_PASSWORD="$AWS_CODEARTIFACT_TOKEN"
```
works.

But pulling back via `uv sync` and 

```
export UV_INDEX_CODEARTIFACT_USERNAME=aws
export UV_INDEX_CODEARTIFACT_PASSWORD="$AWS_CODEARTIFACT_TOKEN"
```

does not.

```
[project]
name = "agent-handler"
version = "0.1.0"
description = "Add your description here"
requires-python = ">=3.13"
dependencies = [
    "alphaconf",
]

[build-system]
requires = ["uv_build>=0.8.5,<0.9.0"]
build-backend = "uv_build"

[tool.uv.sources]
alphaconf = [ {index = "codeartifact"} ]

[[tool.uv.index]]
name = "codeartifact"
url = "https://aicore-20*****.d.codeartifact.eu-central-1.amazonaws.com/pypi/aicore-repo/simple/"
publish-url = "https://aicore-20*****.d.codeartifact.eu-central-1.amazonaws.com/pypi/aicore-repo/"
```




---

_Comment by @IllarionovDimitri on 2025-08-29 12:33_

UPDATE!!!

following renaming solved the problem. Is `CODEARTIFACT` reserved keyword?

```
export UV_INDEX_CODEART_USERNAME=aws
export UV_INDEX_CODEART_PASSWORD="$AWS_CODEARTIFACT_TOKEN"
```

```
[project]
name = "agent-handler"
version = "0.1.0"
description = "Add your description here"
requires-python = ">=3.13"
dependencies = [
    "alphaconf",
]

[build-system]
requires = ["uv_build>=0.8.5,<0.9.0"]
build-backend = "uv_build"

[tool.uv.sources]
alphaconf = [ {index = "codeart"} ]

[[tool.uv.index]]
name = "codeart"
url = "https://aicore-20*****.d.codeartifact.eu-central-1.amazonaws.com/pypi/aicore-repo/simple/"
publish-url = "https://aicore-20*****.d.codeartifact.eu-central-1.amazonaws.com/pypi/aicore-repo/"


---

_Comment by @IllarionovDimitri on 2025-08-29 13:51_

final update: push&pull to/from aws codeartifact works, looks like some reserved words must be avoided (like codeartifact and private_registry). published version of `pyproject.toml` in my previous comment above solved the problem

---

_Comment by @ldkv on 2025-09-18 12:05_

Hello,

I have encountered exactly the same issue where setting the password in environment variable does not work, however setting directly the same value upon executing the command works normally.

I use AWS Codeartifact, the default username `aws` is defined in `pyproject.toml`.

```pyproject.toml
[[tool.uv.index]]
name = "myrepo"
username = "aws"
url = "https://myrepo-***.amazonaws.com/pypi/myrepo-pypi/simple/"
```
This does not work (401 Unauthorized).

```
export UV_INDEX_MYREPO_PASSWORD=foo
uv sync
```

This one works.

```
export UV_INDEX_MYREPO_PASSWORD=foo
UV_INDEX_MYREPO_PASSWORD=$UV_INDEX_MYREPO_PASSWORD uv sync
```

---
