---
number: 16111
title: Super slow resolution when using --extra-index-url for JAX artifacts
type: issue
state: open
author: sontungkieu
labels:
  - question
assignees: []
created_at: 2025-10-03T07:39:25Z
updated_at: 2025-12-18T16:18:34Z
url: https://github.com/astral-sh/uv/issues/16111
synced_at: 2026-01-07T12:31:16-06:00
---

# Super slow resolution when using --extra-index-url for JAX artifacts

---

_Issue opened by @sontungkieu on 2025-10-03 07:39_

### Question

### Description
I'm migrating an old project to `uv` for faster dependency setup, but the initial cold resolution takes around 10 minutes. This is significantly slower than expected, especially since `uv` is designed for speed. The slowdown seems tied to resolving dependencies that require an extra index URL for JAX artifacts.

Without the extra index URL, resolution fails due to unavailable packages like `jax` and `jaxlib`. With it, it works but is painfully slow.

### Steps to Reproduce
1. Create a new directory and set up the following `pyproject.toml`:
   ```
   [project]
   name = "xql-offline"
   version = "0.1.0"
   description = "Project generated from pinned requirements"
   readme = "README.md"
   authors = [{ name = "Your Name" }]
   license = "MIT"
   requires-python = ">=3.8,<3.10"

   dependencies = [
       "numpy >= 1.20.2,<1.24.4",
       "scipy >= 1.6.0,<1.11.1",
       "absl-py >= 0.12.0",
       'gym[mujoco-py] <= 0.24.1',
       "gdown >= 3.12.2",
       "tqdm >= 4.60.0",
       "flax >= 0.3.5",
       "jax <=0.3.15",
       "jaxlib <= 0.3.15",
       "ml_collections >= 0.1.0",
       "optax >= 0.0.6,<0.1.5",
       "tensorboard < 2.15",
       "tensorflow-probability == 0.17.0",
       "imageio >= 2.9.0",
       "imageio-ffmpeg >= 0.4.3",
       "d4rl @ git+https://github.com/rail-berkeley/d4rl@master#egg=d4rl",
       "wandb<0.19.12",
       "tensorboardX",
       "cython <3, >=0.29",  # Pin to fix MuJoCo-py build; <3 avoids noexcept conflict
       "chex==0.1.5",
   ]
   ```

2. Run `uv sync --extra-index-url https://us-python.pkg.dev/ml-oss-artifacts-published/jax/simple/`.

3. Observe the resolution step hanging for ~10 minutes (e.g., "Resolving..." phase).

### Expected Behavior
Dependency resolution should be fast (seconds), as advertised for `uv`.

### Actual Behavior
Cold resolution takes ~10 minutes. Subsequent `uv sync` runs are faster (cached), but the initial one is a blocker for CI/CD or new setups.

### Environment
- `uv` version: 0.8.22
- Python version: 3.11.13
- Architecture: x86_64
- **Reproducible on multiple setups:** Personal machine, Kaggle notebooks, Vast.ai instances (USA, China, Norway regions) – all show ~10 min resolution time.

### Additional Context
- This project uses older pinned versions of JAX/Flax (from ~2022), which require the Google Cloud artifact repo.
- No `uv.lock` file present initially (cold resolve).
- Tested across diverse environments (as above) to rule out local network issues, but slowdown persists.

### Possible Workarounds
- Pre-generate `uv.lock` on a faster machine/network.
- But this defeats the purpose of fast setup.

Happy to provide more logs or test on a minimal repro if needed!



### Platform

_No response_

### Version

uv 0.8.22

---

_Label `question` added by @sontungkieu on 2025-10-03 07:39_

---

_Comment by @lagamura on 2025-10-28 13:04_

I am using the following pattern to install from `pypi` public packages and fallback to the private index for closed once:

```text
[project]
dependencies = [
"numpy",
"matplotlib",
...
"<private-package>,
]

[tool.uv]
index-strategy = "unsafe-best-match"

[[tool.uv.index]]
name = "pypi"
url = "https://pypi.org/simple"
default = true

[[tool.uv.index]]
name = "<private-artifactory-name>"
url = "<private-index-url>"
```

This should improve your timings.

---

_Comment by @konstin on 2025-10-28 13:38_

> Happy to provide more logs or test on a minimal repro if needed!

Can you share verbose (`-v`) logs? Those should usually say what's taking a lot of time. Similarly, does it show many builds during resolution? Those usually take a long time.

---

_Comment by @sontungkieu on 2025-11-11 08:46_

Thanks! I’ve attached verbose logs for both runs.

**Before (slow):**

```bash
uv sync -v --extra-index-url https://us-python.pkg.dev/ml-oss-artifacts-published/jax/simple/ \
  1>uv_out.txt 2>uv_err.txt
```

* Took ~8 minutes to resolve.
* Logs: [uv_err.txt](https://github.com/user-attachments/files/23474190/uv_err.txt)

**After applying @lagamura’s pattern (fast):**

```toml
# pyproject.toml
[tool.uv]
index-strategy = "unsafe-best-match"

[tool.uv.sources]
jax = { index = "jax" }
jaxlib = { index = "jax" }


[[tool.uv.index]]
name = "pypi"
url = "https://pypi.org/simple"
default = true

[[tool.uv.index]]
name = "jax"
url = "https://us-python.pkg.dev/ml-oss-artifacts-published/jax/simple/"
explicit = true
```

```bash
uv sync -v 1>uv_out_fix.txt 2>uv_err_fix.txt
```

* Output includes: `Resolved 144 packages in 19.04s`
* Logs: [uv_err_fix.txt](https://github.com/user-attachments/files/23475032/uv_err_fix.txt)

Let me know if you want me to highlight specific parts of the logs (e.g., builds triggered during resolution).

---

_Comment by @konstin on 2025-12-18 16:18_

The problem is that the index does support neither PEP 658 (the modern standard) not range requests (the HTTP-based fallback), which makes it really slow to use for resolutions. uv needs to download and unpack all wheels just to get their metadata, instead of getting the metadata separately from the index.

> DEBUG No cache entry for: https://us-python.pkg.dev/ml-oss-artifacts-published/jax/setuptools/setuptools-80.9.0-py3-none-any.whl
> WARN Range requests not supported for setuptools-80.9.0-py3-none-any.whl; streaming wheel

---
