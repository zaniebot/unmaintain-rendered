---
number: 15488
title: "CMake `find_package(Python ...)` Failed with `uv` (Or, python-dev is not installed)"
type: issue
state: closed
author: jamesnulliu
labels:
  - question
assignees: []
created_at: 2025-08-24T18:20:22Z
updated_at: 2025-08-25T23:13:46Z
url: https://github.com/astral-sh/uv/issues/15488
synced_at: 2026-01-07T12:31:16-06:00
---

# CMake `find_package(Python ...)` Failed with `uv` (Or, python-dev is not installed)

---

_Issue opened by @jamesnulliu on 2025-08-24 18:20_

### Question

I am moving from `conda` to `uv`, but meet a problem when building a python project (specifically, [vllm](https://github.com/vllm-project/vllm)), which contains cmake build. 

The key error shows that:

```
-- The CXX compiler identification is GNU 13.3.0
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: /usr/bin/c++ - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Build type: RelWithDebInfo
-- Target device: cuda
-- Could NOT find Python (missing: Python_INCLUDE_DIRS Interpreter Development.Module Development.SABIModule)
-- Configuring incomplete, errors occurred!

[stderr]
/home/james/Projects/vllm/.venv/lib/python3.12/site-packages/setuptools_scm/git.py:202: UserWarning: "/home/james/Projects/vllm" is
shallow and may cause errors
  warnings.warn(f'"{wd.path}" is shallow and may cause errors')
/home/james/Projects/vllm/.venv/lib/python3.12/site-packages/setuptools_scm/_integration/version_inference.py:51: UserWarning: version
of None already set
  warnings.warn(self.message)
CMake Error at cmake/utils.cmake:10 (message):
  Unable to find python matching:
  /home/james/Projects/vllm/.venv/bin/python3.
Call Stack (most recent call first):
  CMakeLists.txt:58 (find_python_from_executable)
```

Which is actually caused by `find_package(Python ...)` in:

```
macro (find_python_from_executable EXECUTABLE SUPPORTED_VERSIONS)
  file(REAL_PATH ${EXECUTABLE} EXECUTABLE)
  set(Python_EXECUTABLE ${EXECUTABLE})
  find_package(Python COMPONENTS Interpreter Development.Module Development.SABIModule)
  if (NOT Python_FOUND)
    message(FATAL_ERROR "Unable to find python matching: ${EXECUTABLE}.")
  endif()
  set(_VER "${Python_VERSION_MAJOR}.${Python_VERSION_MINOR}")
  set(_SUPPORTED_VERSIONS_LIST ${SUPPORTED_VERSIONS} ${ARGN})
  if (NOT _VER IN_LIST _SUPPORTED_VERSIONS_LIST)
    message(FATAL_ERROR
      "Python version (${_VER}) is not one of the supported versions: "
      "${_SUPPORTED_VERSIONS_LIST}.")
  endif()
  message(STATUS "Found python matching: ${EXECUTABLE}.")
endmacro()
```

**I believe the key problem is that `uv` does not install the headers and lib (which includes cmake configs), and that prevents me from python & C++ development.**

What should I do to install python dev-pack with `uv`? 

**NOTE**: Currently, this problem can be solved by running `apt-get install python3.12-dev`, but I don't want to install it with `apt` cuz one of the reasons I use `uv` is to keep my system env clean.

### Platform

Ubuntu 24.04

### Version

uv 0.8.13

---

_Label `question` added by @jamesnulliu on 2025-08-24 18:20_

---

_Renamed from "CMake `find_package(Python ...)` Failed when Using `uv` (Or, python-dev is not installed)" to "CMake `find_package(Python ...)` Failed with `uv` (Or, python-dev is not installed)" by @jamesnulliu on 2025-08-24 21:29_

---

_Comment by @konstin on 2025-08-25 13:08_

CC @geofft 

---

_Comment by @geofft on 2025-08-25 15:08_

I suspect that the cause here is that you're using your system version of Python, not the version we provide, and so it is correct to install `python3.12-dev` to build things from source using that Python. uv defaults to using your system Python if it's usable.

Are you manually creating a venv? If you don't want to use the system-provided Python version, can you try using `--managed-python` and see if that works out of the box without installing anything from apt?

For reference, I cannot reproduce this with our managed versions of Python, and we do install the development components by default. (I'm also on Ubuntu 24.04, which has Python 3.12, and specifically the fact that you have python3.12 in your paths makes me suspect you're using the Ubuntu-provided version of Python.)

---

_Comment by @jamesnulliu on 2025-08-25 22:56_

> For reference, I cannot reproduce this with our managed versions of Python, and we do install the development components by default. 

@geofft Thank you for your response. I found the problem is that "**I am indeed using the system python**", by checking target of python in my venv (which should be a symbolic link) :

```
$ source .venv/bin/activate
$ ll $(which python)
> lrwxrwxrwx 1 root root 76 Aug 25 22:25 /home/james/Projects/vllm/.venv/bin/python -> /usr/bin/python3
```

**THE REASON IS THAT** when I created my venv with command:

```
$ uv venv -p 3.12
```

uv would first check if there has been a python in the system, just like the [doc](https://docs.astral.sh/uv/pip/environments/#creating-a-virtual-environment) says:

> Note this requires the requested Python version to be available on the system. However, if unavailable, uv will download Python for you.

I fixed this by removing my system python and then creating venv again:

```
$ apt remove python python3 python3.12 python-dev && apt autoremove
$ rm -rf .venv
$ uv venv -p 3.12
> Using CPython 3.12.11
> Creating virtual environment at: .venv
> Activate with: source .venv/bin/activate
$ source .venv/bin/activate
$ ll $(which python)
$ lrwxrwxrwx 1 root root 76 Aug 25 15:42 /root/vllm/.venv/bin/python -> /root/.local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu/bin/python3.12*
```

This time we can see that I am using the python downloaded by uv correctly. 

Moreover, under "/root/.local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu", I found the "include" and "lib" dirs which are exactly what I need to build vllm.

Thank you for your response again. Now I can build cuda kernels in vllm properly.

**HOWEVER, I AM STILL WONDERED THAT:**

1. Instead of removing the system python, is there a way to force uv to download python instead of checking the system python when creating venv?
2. Which environment variable controls the downloaded python path (which is by default "~/.local/share/uv/")? Can I change it to a public directory?


---

_Comment by @zanieb on 2025-08-25 23:10_

1. Yep! `--managed-python`. See https://docs.astral.sh/uv/concepts/python-versions/#requiring-or-disabling-managed-python-versions
2. We respect the XDG variables, or you can use `UV_PYTHON_INSTALL_DIR` https://docs.astral.sh/uv/reference/environment/#uv_python_install_dir

---

_Comment by @jamesnulliu on 2025-08-25 23:13_

> 1. Yep! `--managed-python`. See https://docs.astral.sh/uv/concepts/python-versions/#requiring-or-disabling-managed-python-versions
> 
> 2. We respect the XDG variables, or you can use `UV_PYTHON_INSTALL_DIR` https://docs.astral.sh/uv/reference/environment/#uv_python_install_dir

@zanieb Thank you for the references. I would check the doc right away!

---

_Closed by @jamesnulliu on 2025-08-25 23:13_

---
