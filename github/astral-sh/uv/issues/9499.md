---
number: 9499
title: Platform markers are ignored when syncing optional self-dependencies
type: issue
state: closed
author: befelix
labels:
  - bug
assignees: []
created_at: 2024-11-28T12:33:28Z
updated_at: 2024-11-28T17:40:01Z
url: https://github.com/astral-sh/uv/issues/9499
synced_at: 2026-01-07T12:31:15-06:00
---

# Platform markers are ignored when syncing optional self-dependencies

---

_Issue opened by @befelix on 2024-11-28 12:33_

In the following minimal  `pyproject.toml` file, we are creating a package where the `self` optional dependency that depends on the `base` extra (the `tomli` package) through a self-dependency together with a platform marker that is not satisfied on my Linux machine. When running `uv sync --extra self` the packages from the `base` extra get installed, even though the platform marker should exclude them.

```bash
$ uv sync --extra self

Using CPython 3.13.0
Creating virtual environment at: .venv
Resolved 2 packages in 5ms
Installed 1 package in 2ms
 + tomli==2.2.1
```

```toml
[project]
name = "testing"
version = "0.1.0"
requires-python = ">=3.11"
dependencies = []

[project.optional-dependencies]
base = [
    "tomli>=2.2.1",
]
self = [
    "testing[base]; platform_system == 'Windows'",
]

[tool.uv.sources]
testing = { workspace = true }
```

- platform: Linux
- uv version: 0.5.5

---

_Label `bug` added by @konstin on 2024-11-28 12:36_

---

_Comment by @BhupalPrajapati on 2024-11-28 16:40_

[project.optional-dependencies]
base = [
    "tomli>=2.2.1; platform_system == 'Windows'",
]
self = [
    "testing[base]",
]

---

_Assigned to @charliermarsh by @charliermarsh on 2024-11-28 16:42_

---

_Comment by @charliermarsh on 2024-11-28 16:45_

I got it.

---

_Comment by @charliermarsh on 2024-11-28 16:46_

(Good bug!)

---

_Referenced in [astral-sh/uv#9509](../../astral-sh/uv/pulls/9509.md) on 2024-11-28 17:28_

---

_Closed by @charliermarsh on 2024-11-28 17:40_

---

_Referenced in [astral-sh/uv#9530](../../astral-sh/uv/issues/9530.md) on 2024-11-29 19:26_

---
