---
number: 6700
title: uv does not recognize dependencies declared in script
type: issue
state: closed
author: bongomachine
labels:
  - bug
assignees: []
created_at: 2024-08-27T16:52:40Z
updated_at: 2024-08-27T17:49:10Z
url: https://github.com/astral-sh/uv/issues/6700
synced_at: 2026-01-07T12:31:14-06:00
---

# uv does not recognize dependencies declared in script

---

_Issue opened by @bongomachine on 2024-08-27 16:52_

Howdy and thanks for a great piece of software! I'm not sure if this is a bug or if I'm simply doing things wrong. Anyway..

When I run the following piece of python:

```
# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "cyclonedds ==0.11.0",
# ]

# [tool.uv]
# index-strategy = "unsafe-best-match"

# [tool.uv.sources]
# cyclonedds = { git = "https://github.com/eclipse-cyclonedds/cyclonedds-python.git", rev = "080dfd4b26e4c4dc2529694ef9cf9589750360c1" }

# ///


import cyclonedds as dds

print("Hello, World!")
```

With command: `CYCLONEDDS_HOME=~/.local uv -v run test.py`

I get the following error: 

```
DEBUG uv 0.3.4
DEBUG No project found; searching for Python interpreter
DEBUG Searching for Python interpreter in managed installations or system path
DEBUG Searching for managed installations at `~/.local/share/uv/python`
DEBUG Found `cpython-3.12.3-linux-x86_64-gnu` at `/usr/bin/python3` (search path)
DEBUG Using Python 3.12.3 interpreter at: /usr/bin/python3
DEBUG Running `python test.py`
Traceback (most recent call last):
  File "~/tmp/test.py", line 15, in <module>
    import cyclonedds as dds
ModuleNotFoundError: No module named 'cyclonedds'
```

However, if I run the following: `uv venv && CYCLONEDDS_HOME=~/.local uv pip install git+https://github.com/eclipse-cyclonedds/cyclonedds-pytho
n@080dfd4b26e4c4dc2529694ef9cf9589750360c1 && uv run test.py`, everything works.

As stated earlier, this might be the intended behavior, but I'm not sure.

* The current uv platform.
 **Linux (x86_64) Ubuntu 24.04**

* The current uv version (`uv --version`).
**uv 0.3.4**


---

_Comment by @charliermarsh on 2024-08-27 16:54_

I agree that this should work, at least from the above description.

---

_Comment by @zanieb on 2024-08-27 16:55_

I presume the problem here is that we're not respecting `[tool.uv.sources]`? Or are we not installing `cyclonedds` at all? Kind of looks like the latter...

---

_Comment by @charliermarsh on 2024-08-27 16:55_

The problem is the break in the script -- try this:
```python
# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "cyclonedds ==0.11.0",
# ]
#
# [tool.uv]
# index-strategy = "unsafe-best-match"
#
# [tool.uv.sources]
# cyclonedds = { git = "https://github.com/eclipse-cyclonedds/cyclonedds-python.git", rev = "080dfd4b26e4c4dc2529694ef9cf9589750360c1" }
#
# ///


import cyclonedds as dds

print("Hello, World!")
```

---

_Comment by @charliermarsh on 2024-08-27 16:55_

I need to review the spec to see what the correct behavior is.

---

_Comment by @zanieb on 2024-08-27 16:56_

Ah gotcha... I wonder if we can / should warn here? We could document it, at least.

---

_Comment by @charliermarsh on 2024-08-27 16:57_

Okay, it _is_ correct to reject that per the spec:

> Every line between these two lines (# /// TYPE and # ///) MUST be a comment starting with #. If there are characters after the # then the first character MUST be a space. 

But I think we should warn if we see `# /// script` but don't identify a script?

---

_Comment by @bongomachine on 2024-08-27 17:10_

> The problem is the break in the script -- try this:
> 
> ```python
> # /// script
> # requires-python = ">=3.12"
> # dependencies = [
> #     "cyclonedds ==0.11.0",
> # ]
> #
> # [tool.uv]
> # index-strategy = "unsafe-best-match"
> #
> # [tool.uv.sources]
> # cyclonedds = { git = "https://github.com/eclipse-cyclonedds/cyclonedds-python.git", rev = "080dfd4b26e4c4dc2529694ef9cf9589750360c1" }
> #
> # ///
> 
> 
> import cyclonedds as dds
> 
> print("Hello, World!")
> ```

That worked! Thanks! 

FYI: The break was introduced when I first ran the following command: `CYCLONEDDS_HOME=~/.local uv add --script test.py git+https://github.com/eclipse-cyclonedds/cyclonedds-python.git --rev 080dfd4b26e4c4dc2529694ef9cf9589750360c1`. (And then I added index-strategy and explicit version while debugging).

---

_Comment by @charliermarsh on 2024-08-27 17:13_

Ohh nice, now _that_ is a bug!

---

_Assigned to @charliermarsh by @charliermarsh on 2024-08-27 17:13_

---

_Label `bug` added by @charliermarsh on 2024-08-27 17:14_

---

_Referenced in [astral-sh/uv#6704](../../astral-sh/uv/pulls/6704.md) on 2024-08-27 17:19_

---

_Referenced in [astral-sh/uv#6706](../../astral-sh/uv/pulls/6706.md) on 2024-08-27 17:24_

---

_Closed by @charliermarsh on 2024-08-27 17:49_

---
