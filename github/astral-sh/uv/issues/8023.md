---
number: 8023
title: "`uv publish` giving `Missing credentials for https://upload.pypi.org/legacy/`"
type: issue
state: closed
author: jamesbraza
labels:
  - error messages
assignees: []
created_at: 2024-10-08T22:25:10Z
updated_at: 2024-10-15T08:01:15Z
url: https://github.com/astral-sh/uv/issues/8023
synced_at: 2026-01-07T12:31:15-06:00
---

# `uv publish` giving `Missing credentials for https://upload.pypi.org/legacy/`

---

_Issue opened by @jamesbraza on 2024-10-08 22:25_

I moved from this GitHub Actions that publishes to PyPI using:

```yaml
      - uses: pypa/gh-action-pypi-publish@release/v1
        with:
          password: ${{ secrets.PYPI_API_TOKEN }}
```

To this with `uv==0.4.20`:

```yaml
      - run: uv publish
        env:
          UV_PUBLISH_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}
```

However, `uv publish` fails with:

```none
warning: `uv publish` is experimental and may change without warning
Publishing 2 files https://upload.pypi.org/legacy/
Uploading ldp-0.10.0-py3-none-any.whl (90.7KiB)
error: Failed to publish `dist/repo-0.10.0-py3-none-any.whl` to https://upload.pypi.org/legacy/
  Caused by: Failed to send POST request
  Caused by: Missing credentials for https://upload.pypi.org/legacy/
Error: Process completed with exit code 2.
```

What am I doing wrong here? Also, I am thinking perhaps the stack could be made more user friendly

---

_Comment by @charliermarsh on 2024-10-08 22:26_

\cc @konstin 

---

_Comment by @charliermarsh on 2024-10-08 22:27_

I think you need `UV_PUBLISH_TOKEN` instead?

---

_Label `question` added by @charliermarsh on 2024-10-08 22:27_

---

_Comment by @zanieb on 2024-10-08 22:29_

Yeah I think you want to set it via the token variable or provide a username (`UV_PUBLISH_USERNAME=__token__`)

---

_Label `error messages` added by @charliermarsh on 2024-10-08 22:39_

---

_Comment by @charliermarsh on 2024-10-08 22:39_

(If that's the issue, we should def have a custom error for this.)

---

_Assigned to @konstin by @charliermarsh on 2024-10-08 22:39_

---

_Comment by @jamesbraza on 2024-10-08 22:42_

This worked indeed:

```diff
      - run: uv publish
        env:
---          UV_PUBLISH_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}
+++          UV_PUBLISH_TOKEN: ${{ secrets.PYPI_API_TOKEN }}
```

It's slightly strange to me because `pypa/gh-action-pypi-publish@release/v1` had `password` configured. I wonder if they automatically fail over from trying password to trying token.

So yes perhaps `uv` can nice-ify `Missing credentials` a bit

---

_Comment by @charliermarsh on 2024-10-08 22:43_

Okay awesome. Yeah, let's fix up this error message etc.

---

_Label `question` removed by @charliermarsh on 2024-10-08 22:43_

---

_Referenced in [astral-sh/uv#8045](../../astral-sh/uv/pulls/8045.md) on 2024-10-09 12:20_

---

_Comment by @konstin on 2024-10-09 12:30_

it's unfortunate that `pypa/gh-action-pypi-publish@release/v1` calls the token a password. We can catch using a password without a username in clap, I don't think we need to special case the password -> token migration: #8045.

---

_Closed by @konstin on 2024-10-15 08:01_

---

_Referenced in [astral-sh/uv#7839](../../astral-sh/uv/issues/7839.md) on 2024-11-03 18:09_

---
