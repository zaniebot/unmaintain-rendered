---
number: 15746
title: Performance issues when using multiple git+ssh dependencies
type: issue
state: open
author: jasondamour
labels:
  - bug
  - external
  - network
assignees: []
created_at: 2025-09-08T23:06:26Z
updated_at: 2026-01-05T21:57:28Z
url: https://github.com/astral-sh/uv/issues/15746
synced_at: 2026-01-07T12:31:16-06:00
---

# Performance issues when using multiple git+ssh dependencies

---

_Issue opened by @jasondamour on 2025-09-08 23:06_

### Summary

**Unfortunately, I believe this issue is caused by Github**. However, I'd like to log a ticket here to help others find this issue.

Using more than ~4 git+ssh dependencies causes connections to fail. I don't have a public repro, but here is the redacted logs:
**pyproject.toml**
```
[project]
name = "proj"
version = "0.1.0"
description = ""
requires-python = "~=3.11.0"
dependencies = [
    "config",
    "cache",
    "entitlement_metadata",
    "exceptions",
    "aws",
    "feature-flags",
    "logger",
    "retry",
    "secrets",
    "stats",
    "types",
]

[tool.uv.sources]
config = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/config" }
cache = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/cache" }
exceptions = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/exceptions" }
aws = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/aws" }
feature-flags = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/feature_flags" }
logger = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/logger" }
retry = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/retry" }
secrets = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/secrets" }
stats = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/stats" }
types = { git = "ssh://git@github.com/org/repo", branch = "main", subdirectory = "backend/python/libs/types" }
```

**error**
```
uv lock --verbose
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
   Updating ssh://git@github.com/org/repo (main)
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)


  × Failed to download and build `stats @ git+ssh://git@github.com/org/repo@main#subdirectory=backend/python/libs/stats`
  ├─▶ Git operation failed
  ├─▶ failed to fetch into: /home/vscode/.cache/uv/git-v0/db/2c7a0873aed5bc02
  ├─▶ failed to fetch branch `main`
  ╰─▶ process didn't exit successfully: `/usr/local/bin/git fetch --force --update-head-ok 'ssh://git@github.com/org/repo'
      '+refs/heads/main:refs/remotes/origin/main'` (exit status: 128)
      --- stderr
      kex_exchange_identification: Connection closed by remote host
      Connection closed by 140.82.116.4 port 22
      fatal: Could not read from remote repository.

      Please make sure you have the correct access rights
      and the repository exists.
```

I don't think this is uv's fault as I can repro using ssh
```
➜  for i in {1..5}; do echo "Attempt $i:"; ssh -o ConnectTimeout=5 -T git@github.com; echo "Exit code: $?"; echo "---"; done
Attempt 1:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 2:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 3:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 4:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 5:
Connection timed out during banner exchange
Connection to 140.82.116.4 port 22 timed out
Exit code: 255
---
```


### Platform

macos

### Version

0.8.15

### Python version

Python 3.11

---

_Label `bug` added by @jasondamour on 2025-09-08 23:06_

---

_Comment by @jasondamour on 2025-09-08 23:08_

I think I've worked around the issue locally by setting `~/.ssh/config` to share connections:
```
Host github.com
    ControlMaster auto
    ControlPath ~/.ssh/control:%h:%p:%r
    ControlPersist 600
```

Would this be something that UV considers automatically configuring, when a project defines many git+ssh dependencies? Or, is it definitely the responsibility of the host to manage ssh configuration? If the latter, may I add a note to UV docs?

---

_Label `external` added by @konstin on 2025-09-09 07:10_

---

_Label `network` added by @konstin on 2025-09-09 07:11_

---

_Comment by @zsol on 2025-09-09 07:54_

I wonder what other package managers do here, like Cargo

---

_Comment by @sabeechen on 2026-01-05 18:05_

I'm not sure if its the same issue, but in my project with 7 git python dependencies over ssh, performing `uv sync` would consistently see:
```bash
41.36   × Failed to download and build `<my_private_repo> @
41.36   │ git+ssh://git@github.com/<my_company>/<my_private_repo>.git@<some_sha>`
41.36   ├─▶ Git operation failed
41.36   ├─▶ failed to clone into: /root/.cache/uv/git-v0/db/<some_hash>
41.36   ├─▶ failed to fetch commit `<some_sha>`
41.36   ╰─▶ process didn't exit successfully: `/usr/bin/git fetch --force
41.36       --update-head-ok 'ssh://git@github.com/<my_company>/<my_private_repo>.git'
41.36       '+<some_sha>`
41.36       (exit status: 128)
41.36       --- stderr
41.36       ssh: Could not resolve hostname github.com: Temporary failure in name
41.36       resolution
41.36       fatal: Could not read from remote repository.
41.36 
41.36       Please make sure you have the correct access rights
41.36       and the repository exists.
41.36 
41.36   help: `<my_private_repo>` was included because `<my_project>` depends on
41.36         `<my_private_repo>`
```
for a random one of my private repo dependencies. A DNS failure instead of a connection reset. No amount of futzing with `~/.ssh/config` seemed to work, but  I was able to work around it by setting:
```Dockerfile
ENV UV_CONCURRENT_DOWNLOADS=5
```
in my `Dockerfile` prior to `uv sync`, which in my case didn't seems to have a measurable impact on total  `uv sync` time.

Thank you @jasondamour for identifying and creating this issue, I'd spent far too long thinking assuming was broken with my local docker DNS.

---

_Comment by @zanieb on 2026-01-05 20:15_

It seems like we should add a separate, lower concurrency limit to Git operations that applies per domain?

---

_Comment by @zanieb on 2026-01-05 20:16_

Is this an ssh-only issue?

We could also just add a hint to that error message suggesting the proper ssh configuration?

---

_Comment by @sabeechen on 2026-01-05 21:57_

| Is this an ssh-only issue?

It would seem so to me, though I'm not knowledgeable about the `uv` internals at play  My project has a great deal more non-git+ssh dependencies and I've never seen a similar problem with any of them.

---
