---
number: 14600
title: "uv sync ignores [sources] mapping from --config-file when a default index is present in pyproject.toml"
type: issue
state: closed
author: mrogowski11
labels:
  - error messages
assignees: []
created_at: 2025-07-14T06:41:43Z
updated_at: 2025-08-04T17:53:43Z
url: https://github.com/astral-sh/uv/issues/14600
synced_at: 2026-01-07T12:31:16-06:00
---

# uv sync ignores [sources] mapping from --config-file when a default index is present in pyproject.toml

---

_Issue opened by @mrogowski11 on 2025-07-14 06:41_

### Summary

I'm trying to use a separate configuration file (uv-nightly.toml) to sync dependencies from a special, secondary index. My main pyproject.toml defines a default index.

When I run uv sync --group <name> --config-file uv-nightly.toml, it appears to ignore the [sources] mapping in the config file and only searches the default index from pyproject.toml. This prevents me from installing prerelease versions of specific packages from the correct, separate index.

The expected behavior is that uv should merge the configurations and use the [sources] mapping to route the specified packages to the correct index, overriding the default search behavior for those packages.

## Steps to Reproduce

Here is my current setup:
- pyproject.toml:
```toml
[project]
name = "ovrunner"
version = "0.1.0"
readme = "README.md"
requires-python = ">=3.12"
dependencies = ["requests"]

[project.scripts]
ovrunner = "ovrunner.main:main"

[tool.setuptools]
packages = ["ovrunner", "ovrunner.benchmark", "ovrunner.utils"]

[tool.uv]
package = true
native-tls = true
conflicts = [
    [
        { group = "ov-nightly"},
        { group = "ov-25-0"},
    ]
]

[[tool.uv.index]]
url = "abc"

[dependency-groups]
ov-nightly = [
    "diffusers",
    "librosa",
    "matplotlib",
    "nncf",
    "numpy",
    "onnx",
    "openvino",
    "openvino-tokenizers",
    "openvino-genai",
    "optimum-intel",
    "packaging",
    "pillow",
    "psutil",
    "tiktoken",
    "timm",
    "torch",
    "tokenizers",
    "transformers",
]
ov-25-0 = [
    "accelerate==0.33.0",
    "aiohappyeyeballs==2.3.5",
    "aiohttp==3.10.1",
    "aiosignal==1.3.1",
    "attrs==24.2.0",
    "audioread==3.0.1",
    "bitsandbytes==0.43.3",
    "certifi==2024.7.4",
    "cffi==1.17.0",
    "charset-normalizer==3.3.2",
    "colorama==0.4.6",
    "coloredlogs==15.0.1",
    "datasets==2.20.0",
    "decorator==5.1.1",
    "diffusers==0.30.0",
    "dill==0.3.8",
    "einops==0.8.0",
    "filelock==3.15.4",
    "frozenlist==1.4.1",
    "fsspec==2024.5.0",
    "gekko==1.2.1",
    "huggingface-hub==0.24.5",
    "humanfriendly==10.0",
    "idna==3.7",
    "importlib-metadata==8.2.0",
    "jinja2==3.1.4",
    "joblib==1.4.2",
    "lazy-loader==0.4",
    "librosa==0.10.2.post1",
    "llvmlite==0.43.0",
    "markupsafe==2.1.5",
    "mpmath==1.3.0",
    "msgpack==1.0.8",
    "multidict==6.0.5",
    "multiprocess==0.70.16",
    "networkx==3.3",
    "numba==0.60.0",
    "numpy==1.26.4",
    "onnx==1.16.2",
    "opencv-python>=4.11.0.86",
    "openvino==2025.0.0",
    "openvino-genai==2025.0.0",
    "openvino-telemetry==2025.0.0",
    "optimum==1.24.0",
    "optimum-intel==1.22.0",
    "packaging==24.1",
    "pandas==2.2.2",
    "peft==0.12.0",
    "pillow==10.4.0",
    "platformdirs==4.2.2",
    "pooch==1.8.2",
    "protobuf==5.27.3",
    "psutil==6.0.0",
    "pyarrow==17.0.0",
    "pyarrow-hotfix==0.6",
    "pycparser==2.22",
    "pyreadline3==3.4.1",
    "python-dateutil==2.9.0.post0",
    "pytz==2024.1",
    "pyyaml==6.0.2",
    "regex==2024.7.24",
    "requests==2.32.3",
    "rouge==1.0.1",
    "safetensors==0.4.4",
    "scikit-learn==1.5.1",
    "scipy==1.14.0",
    "sentencepiece==0.2.0",
    "six==1.16.0",
    "soundfile==0.12.1",
    "soxr==0.4.0",
    "sympy==1.13.1",
    "threadpoolctl==3.5.0",
    "tiktoken==0.7.0",
    "timm==1.0.8",
    "tokenizers==0.20.4",
    "torch==2.4.1",
    "torchvision==0.19.1",
    "tqdm==4.66.5",
    "transformers==4.46.3",
    "transformers-stream-generator==0.0.5",
    "typing-extensions==4.12.2",
    "tzdata==2024.1",
    "urllib3==2.2.2",
    "xxhash==3.4.1",
    "yarl==1.9.4",
    "zipp==3.19.2",
]
```
- uv-nightly.toml:
```toml
package = true
native-tls = true
prerelease = "allow"
index-strategy = "unsafe-best-match"

[[index]]
name = "openvino-nightly"
url = "https://storage.openvinotoolkit.org/simple/wheels/nightly"
explicit = true

[[index]]
url =  "abc"

[sources]
openvino = { index = "openvino-nightly" }
openvino-tokenizers = { index = "openvino-nightly" }
openvino-genai = { index = "openvino-nightly" }
```

Used command:
`uv sync --group ov-nightly --config-file uv-nightly.toml`

I have also tried using `prerelease = explicit` and setting `>=2025.0.0.dev0` for the packages' versions, to no avail.

## Actual Behavior
`openvino`, `openvino-tokenizers`, `openvino-genai` packages are installed in released versions (at the moment that is 2025.2.0), from the `abc` index.

## Expected Behavior
When I run `uv sync --group ov-nightly --config-file uv-nightly.toml` I would like the `openvino`, `openvino-tokenizers`, `openvino-genai` packages to be installed in a nightly version (at the moment that is 2025.3.0.0.dev20250711) via `openvino-nightly` index and other packages to be installed via the default index. 

When I run a command like this:
`uv pip install --reinstall  openvino openvino-tokenizers openvino-genai --pre --index-url https://storage.openvinotoolkit.org/simple/wheels/nightly --no-cache --index-strategy=unsafe-best-match` it installs the packages in nightly versions. Why is my config file behaving differently (I assume merging data from pyproject.toml and config file is the reason)?

## Reasoning
My project consists of multiple conflicting dependency-groups where each group is an environment with a specific version of openvino package. All groups other than `ov-nightly` use the default, single index and work perfectly with usage such as `uv sync --group ov-25-0`. The `ov-nightly` group requires a couple of packages to be installed in nightly versions, from a separate index. How can I achieve this behavior? I could reinstall the packages with `uv pip install` like mentioned before or have a separate pyproject.toml in a different directory. However that would mean multiple package installation steps (first idea) or updating two files (second idea). 

Is the presented behavior a bug or erroneous configuration on my part?  


### Platform

x86_64 GNU/Linux

### Version

uv 0.7.20

### Python version

_No response_

---

_Label `bug` added by @mrogowski11 on 2025-07-14 06:41_

---

_Comment by @charliermarsh on 2025-07-16 13:28_

I believe it's intentional that we (1) don't respect sources defined in `uv.toml` and (2) don't allow named indexes from "outside" the project. The intent is that configuration related to the project dependencies like that needs to be defined within the project, and not in a global file.


---

_Comment by @charliermarsh on 2025-07-16 13:29_

I filed https://github.com/astral-sh/uv/issues/14650 to warn on this, I thought we already did.

---

_Referenced in [astral-sh/uv#14694](../../astral-sh/uv/issues/14694.md) on 2025-07-17 21:39_

---

_Closed by @charliermarsh on 2025-08-04 17:53_

---

_Assigned to @charliermarsh by @charliermarsh on 2025-08-04 17:53_

---

_Label `bug` removed by @charliermarsh on 2025-08-04 17:53_

---

_Label `error messages` added by @charliermarsh on 2025-08-04 17:53_

---
