---
number: 11184
title: "Using `uv pip install` to install pytorch from its source code fails, while `pip install` works."
type: issue
state: closed
author: xulongwu4
labels:
  - bug
assignees: []
created_at: 2025-02-03T16:04:30Z
updated_at: 2025-07-03T18:28:59Z
url: https://github.com/astral-sh/uv/issues/11184
synced_at: 2026-01-07T12:31:15-06:00
---

# Using `uv pip install` to install pytorch from its source code fails, while `pip install` works.

---

_Issue opened by @xulongwu4 on 2025-02-03 16:04_

### Summary

I am trying to build and install `pytorch` from its source code. When using `uv pip install .`, I got a error message: 

```bash
[stdout]
Building wheel torch-2.6.0a0+git1eba9b3
-- Building version torch-2.6.0a0+git1eba9b3
cmake --build . --target install --config Release

[stderr]
no such file or directory
CMake Error: Generator: execution of make failed. Make command was:
/home/xxx/.cache/uv/builds-v0/.tmpG1dhel/bin/ninja install
``` 

However, if I use `pip install .` instead, the installation succeed without errors.

## Steps to reproduce:

```bash
git clone git@github.com:pytorch/pytorch.git
cd pytorch
git checkout v2.6.0
git submodule update --init --recursive

uv venv --python 3.9
BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .
```

## Expected result:

`torch` should be installed correctly.

## Actual result:

The error message is posted above.



### Platform

Linux

### Version

uv 0.5.21

### Python version

3.9.21

---

_Label `bug` added by @xulongwu4 on 2025-02-03 16:04_

---

_Comment by @charliermarsh on 2025-02-03 19:29_

Does it also fail with `pip install --use-pep517 --force-reinstall --no-cache`?

---

_Comment by @xulongwu4 on 2025-02-03 20:21_

@charliermarsh 

`pip install .` and `pip install --use-pep517 --force-reinstall --no-cache .` both succeed.

`uv pip install .` fails with the error message I posted above, and `uv pip install --use-pep517 --force-reinstall --no-cached .` complains about `uv pip` not understanding the `--use-pep517` option.

---

_Comment by @zanieb on 2025-02-03 20:32_

Does it fail immediately? Attempting to reproduce.

We might need a Docker image reproduction to isolate from system state https://docs.astral.sh/uv/reference/troubleshooting/reproducible-examples/#docker-image

---

_Label `needs-mre` added by @zanieb on 2025-02-03 21:21_

---

_Comment by @zanieb on 2025-02-03 21:21_

Does it work with `uvx -p 3.9 --from build pyproject-build`?

---

_Renamed from "Use `uv pip install` to install pytorch from its source code fails, while `pip install` works." to "Using `uv pip install` to install pytorch from its source code fails, while `pip install` works." by @xulongwu4 on 2025-02-03 21:44_

---

_Comment by @xulongwu4 on 2025-02-03 21:47_

> Does it fail immediately? Attempting to reproduce.

@zanieb No it doesn't fail immediately. It ran for about 20 min before it failed on my machine, where I saw from `htop` that it was running a bunch of `gcc` commands to build the c++ libraries. Judging from the error message, I guess the build process succeeded, but the `ninja install` command failed.

> We might need a Docker image reproduction to isolate from system state https://docs.astral.sh/uv/reference/troubleshooting/reproducible-examples/#docker-image

I will try to get a reproducible docker environment later.

---

_Comment by @xulongwu4 on 2025-02-04 01:07_

> Does it work with `uvx -p 3.9 --from build pyproject-build`?

@zanieb Yes, using `pyproject-build` works as well.

---

_Comment by @charliermarsh on 2025-02-04 01:08_

Predicting that is gonna end up being something miserable :joy: like us creating a directory with a specific name that PyTorch doesn't like, or something related to `.gitignore`, etc.

---

_Comment by @xulongwu4 on 2025-02-04 06:45_

@zanieb This is a `Dockerfile` that can reproduce the error:

```dockerfile
FROM ubuntu:20.04

RUN apt-get update && apt-get install -y git build-essential python3-pip
RUN pip3 install uv==0.5.24
RUN uv python install 3.9.21
WORKDIR /pytorch-build
RUN git clone https://github.com/pytorch/pytorch.git
WORKDIR /pytorch-build/pytorch
RUN git checkout v2.6.0
RUN git submodule update --init --recursive
RUN uv venv --python 3.9.21
RUN BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .
```

The following is the content towards the end of the build log:

```
#14 [11/11] RUN BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .
#14 2609.1 Resolved 9 packages in 43m 28s
#14 2617.1   × Failed to build `torch @ file:///pytorch-build/pytorch`
#14 2617.1   ├─▶ The build backend returned an error
#14 2617.1   ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit
#14 2617.1       status: 1)
#14 2617.1
#14 2617.1       [stdout]
#14 2617.1       Building wheel torch-2.6.0a0+git1eba9b3
#14 2617.1       -- Building version 2.6.0a0+git1eba9b3
#14 2617.1       cmake --build . --target install --config Release
#14 2617.1
#14 2617.1       [stderr]
#14 2617.1       no such file or directory
#14 2617.1       CMake Error: Generator: execution of make failed. Make command was:
#14 2617.1       /root/.cache/uv/builds-v0/.tmpvh905G/bin/ninja install
#14 2617.1
#14 2617.1       hint: This usually indicates a problem with the package or the build
#14 2617.1       environment.
#14 ERROR: process "/bin/sh -c BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install ." did not complete successfully: exit code: 1
------
 > [11/11] RUN BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .:
2617.1       -- Building version 2.6.0a0+git1eba9b3
2617.1       cmake --build . --target install --config Release
2617.1
2617.1       [stderr]
2617.1       no such file or directory
2617.1       CMake Error: Generator: execution of make failed. Make command was:
2617.1       /root/.cache/uv/builds-v0/.tmpvh905G/bin/ninja install
2617.1
2617.1       hint: This usually indicates a problem with the package or the build
2617.1       environment.
------
Dockerfile:12
--------------------
  10 |     RUN git submodule update --init --recursive
  11 |     RUN uv venv --python 3.9.21
  12 | >>> RUN BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .
  13 |
--------------------
ERROR: failed to solve: process "/bin/sh -c BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install ." did not complete successfully: exit code: 1

```

---

_Comment by @charliermarsh on 2025-02-05 15:58_

I got this to complete by adding `RUN mkdir /pytorch-build/pytorch/build` just before the `uv pip install` step... Can you try that?

```dockerfile
FROM ubuntu:20.04

# Set UV cache directory to mounted cache location
ENV UV_CACHE_DIR=/root/.cache/uv

RUN --mount=type=cache,target=/root/.cache/uv \
    apt-get update && apt-get install -y git build-essential python3-pip && \
    pip3 install uv==0.5.24 && \
    uv python install 3.9.21

WORKDIR /pytorch-build
RUN git clone https://github.com/pytorch/pytorch.git
WORKDIR /pytorch-build/pytorch
RUN git checkout v2.6.0
RUN git submodule update --init --recursive

RUN mkdir /pytorch-build/pytorch/build

RUN --mount=type=cache,target=/root/.cache/uv \
    uv venv --python 3.9.21 && \
    VERBOSE=1 CMAKE_DEBUG_OUTPUT=ON CMAKE_VERBOSE_MAKEFILE=ON MAKEFLAGS="--debug=v" BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .
```

---

_Comment by @xulongwu4 on 2025-02-06 15:22_

@charliermarsh I have tried your Dockerfile but got the same error as before:

```
#11 [stage-0 8/9] RUN mkdir /pytorch-build/pytorch/build
#11 DONE 0.1s

#12 [stage-0 9/9] RUN --mount=type=cache,target=/root/.cache/uv     uv venv --python 3.9.21 &&     VERBOSE=1 CMAKE_DEBUG_OUTPUT=ON CMAKE_VERBOSE_MAKEFILE=ON MAKEFLAGS="--debug=v" BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .
#12 0.402 Using CPython 3.9.21
#12 0.402 Creating virtual environment at: .venv
#12 2957.0 Resolved 9 packages in 49m 16s
#12 2964.6   × Failed to build `torch @ file:///pytorch-build/pytorch`
#12 2964.6   ├─▶ The build backend returned an error
#12 2964.6   ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit
#12 2964.6       status: 1)
#12 2964.6
#12 2964.6       [stdout]
#12 2964.6       Change Dir: '/pytorch-build/pytorch/build'
#12 2964.6
#12 2964.6       Run Build Command(s): /root/.cache/uv/builds-v0/.tmphdWrSR/bin/ninja
#12 2964.6       -v install
#12 2964.6
#12 2964.6       Generator: execution of make failed. Make command was:
#12 2964.6       /root/.cache/uv/builds-v0/.tmphdWrSR/bin/ninja -v install
#12 2964.6       Building wheel torch-2.6.0a0+git1eba9b3
#12 2964.6       -- Building version 2.6.0a0+git1eba9b3
#12 2964.6       cmake --build . --target install --config Release
#12 2964.6
#12 2964.6       [stderr]
#12 2964.6       no such file or directory
#12 2964.6       CMake Error: Generator: execution of make failed. Make command was:
#12 2964.6       /root/.cache/uv/builds-v0/.tmphdWrSR/bin/ninja -v install
#12 2964.6
#12 2964.6       hint: This usually indicates a problem with the package or the build
#12 2964.6       environment.
#12 ERROR: process "/bin/sh -c uv venv --python 3.9.21 &&     VERBOSE=1 CMAKE_DEBUG_OUTPUT=ON CMAKE_VERBOSE_MAKEFILE=ON MAKEFLAGS=\"--debug=v\" BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install ." did not complete successfully: exit code: 1
------
 > [stage-0 9/9] RUN --mount=type=cache,target=/root/.cache/uv     uv venv --python 3.9.21 &&     VERBOSE=1 CMAKE_DEBUG_OUTPUT=ON CMAKE_VERBOSE_MAKEFILE=ON MAKEFLAGS="--debug=v" BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .:
2964.6       -- Building version 2.6.0a0+git1eba9b3
2964.6       cmake --build . --target install --config Release
2964.6
2964.6       [stderr]
2964.6       no such file or directory
2964.6       CMake Error: Generator: execution of make failed. Make command was:
2964.6       /root/.cache/uv/builds-v0/.tmphdWrSR/bin/ninja -v install
2964.6
2964.6       hint: This usually indicates a problem with the package or the build
2964.6       environment.
------
Dockerfile:19
--------------------
  18 |
  19 | >>> RUN --mount=type=cache,target=/root/.cache/uv \
  20 | >>>     uv venv --python 3.9.21 && \
  21 | >>>     VERBOSE=1 CMAKE_DEBUG_OUTPUT=ON CMAKE_VERBOSE_MAKEFILE=ON MAKEFLAGS="--debug=v" BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install .
  22 |
--------------------
ERROR: failed to solve: process "/bin/sh -c uv venv --python 3.9.21 &&     VERBOSE=1 CMAKE_DEBUG_OUTPUT=ON CMAKE_VERBOSE_MAKEFILE=ON MAKEFLAGS=\"--debug=v\" BUILD_BINARY=0 USE_PRECOMPILED_HEADERS=1 BUILD_TEST=0 USE_CUDA=0 uv pip install ." did not complete successfully: exit code: 1
```

---

_Comment by @charliermarsh on 2025-02-06 17:29_

Weird, I'll try again. It ran to completion for me yesterday. Maybe there's some non-determinism here?

---

_Comment by @zanieb on 2025-02-06 17:48_

Are you on the same architecture? Since they're on Linux I presume they're on linux/amd64 and you're on linux/arm64?

---

_Comment by @charliermarsh on 2025-02-06 17:51_

I believe I ran with `--platform linux/amd64`.

---

_Comment by @charliermarsh on 2025-02-06 19:42_

Although maybe I didn't, because it's now been running for over 9000 seconds.

---

_Comment by @xulongwu4 on 2025-02-06 19:55_

> Although maybe I didn't, because it's now been running for over 9000 seconds.

My log shows that it took about 3000 seconds on my side to hit the error. So I guess yeah, it takes a while to run this build.

---

_Comment by @charliermarsh on 2025-07-03 18:28_

I believe this is fixed by #14338.

---

_Closed by @charliermarsh on 2025-07-03 18:28_

---

_Assigned to @charliermarsh by @charliermarsh on 2025-07-03 18:28_

---

_Label `needs-mre` removed by @charliermarsh on 2025-07-03 18:28_

---
