---
number: 3346
title: Bugs in the activate_this.py script created by uv venv
type: issue
state: closed
author: pfmoore
labels:
  - bug
assignees: []
created_at: 2024-05-03T13:51:20Z
updated_at: 2024-05-04T23:30:01Z
url: https://github.com/astral-sh/uv/issues/3346
synced_at: 2026-01-07T12:31:14-06:00
---

# Bugs in the activate_this.py script created by uv venv

---

_Issue opened by @pfmoore on 2024-05-03 13:51_

If I do `uv venv`, the file `.venv/Scripts/activate_this.py` contains errors:

Too many closing parentheses:
```
    msg = "You must use exec(open(this_file).read(), {'__file__': this_file}))"
```

Invalid backslash escapes (this is on Windows):
```
for lib in "..\Lib\site-packages".split(os.pathsep):
```

---

_Comment by @charliermarsh on 2024-05-03 13:59_

Thanks, we vendored these from virtualenv and looks like the first one at least was fixed: https://github.com/pypa/virtualenv/pull/2651

---

_Label `bug` added by @charliermarsh on 2024-05-03 13:59_

---

_Comment by @charliermarsh on 2024-05-03 13:59_

The second looks like _our_ bug.

---

_Comment by @AlexWaygood on 2024-05-03 15:27_

There's some other weirdness as well.

https://github.com/astral-sh/uv/blob/1089abda3f98fe681c75cdb784b2e4b200122da2/crates/uv-virtualenv/src/activator/activate_this.py#L47

Isn't that just exactly equivalent to this?

```py
os.environ["VIRTUAL_ENV_PROMPT"] = os.path.basename(base)
```

https://github.com/astral-sh/uv/blob/1089abda3f98fe681c75cdb784b2e4b200122da2/crates/uv-virtualenv/src/activator/activate_this.py#L53-L54

Isn't that exactly equivalent to this?

```py
     site.addsitedir(path) 
 sys.path[:] = sys.path[prev_length:] + sys.path[:prev_length] 
```

---

_Comment by @konstin on 2024-05-03 15:30_

I think some parts were lost when copying the upstream (https://github.com/pypa/virtualenv/blob/01cc6fbeb9f6e4a261d3bcf292801d5959525870/src/virtualenv/activation/python/activate_this.py), i'll give this a proper a look on monday.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-05-04 21:48_

---

_Referenced in [astral-sh/uv#3376](../../astral-sh/uv/pulls/3376.md) on 2024-05-04 21:48_

---

_Closed by @charliermarsh on 2024-05-04 23:30_

---
