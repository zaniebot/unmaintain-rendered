---
number: 15619
title: Support for environment markers unclear – docs incomplete/need updating
type: issue
state: open
author: keikoro
labels:
  - error messages
assignees: []
created_at: 2025-09-01T13:07:42Z
updated_at: 2025-09-03T12:12:40Z
url: https://github.com/astral-sh/uv/issues/15619
synced_at: 2026-01-07T12:31:16-06:00
---

# Support for environment markers unclear – docs incomplete/need updating

---

_Issue opened by @keikoro on 2025-09-01 13:07_

The docs include information about environment markers to narrow down dependency definitions and link to the relevant Python docs in several places, like [here](https://docs.astral.sh/uv/concepts/projects/dependencies/#dependency-specifiers) or [here](https://docs.astral.sh/uv/concepts/resolution/#dependency-overrides), but fail to warn users they can't actually use them all (!) since `uv` [doesn't fully support them](https://github.com/astral-sh/uv/issues/15520#issuecomment-3221289223).

This applies to the markers `extras` and `dependency_groups`. Thanks to #14753, assumably, they don't throw any errors – which obscures the fact they aren't properly implemented yet. Until that's done, please update the docs to make users aware of that fact so they don't unnecessarily waste time on them, thinking whatever _they_ are doing must be wrong.

---

_Comment by @charliermarsh on 2025-09-01 13:12_

> ...which obscures the fact they aren't properly implemented yet.

To clarify, they are properly implemented. You _cannot_ use those markers anywhere but in the output of a PEP 751 lockfile, per the spec. Those aren't markers that users are allowed to use in any other context. You can read the PEP here: https://peps.python.org/pep-0751/#additions-to-marker-expression-syntax

> The additions outlined in this PEP ONLY apply in the context of lock files as defined by this PEP and not in other contexts where marker syntax is used (e.g. METADATA, pyproject.toml).

---

_Comment by @charliermarsh on 2025-09-01 13:12_

We should error in other contexts though, per the PEP:

> Fourth, use of extras and dependency_groups will be considered an error outside of lock file (much like extra outside of [Core metadata specifications](https://packaging.python.org/en/latest/specifications/core-metadata/#core-metadata)).

---

_Label `error messages` added by @charliermarsh on 2025-09-01 13:12_

---

_Comment by @keikoro on 2025-09-01 14:14_


> To clarify, they are properly implemented. You _cannot_ use those markers anywhere but in the output of a PEP 751 lockfile, per the spec. Those aren't markers that users are allowed to use in any other context. You can read the PEP here: https://peps.python.org/pep-0751/#additions-to-marker-expression-syntax

The links in the `uv` docs that I found don't talk about or link to _lockfile_-specific PEPs or Python documentation, though.

The sections I pointed to as well as others I came across all (eventually) reference or link to [`PEP 508`](https://peps.python.org/pep-0508/) or the [dependency specifiers page](https://packaging.python.org/en/latest/specifications/dependency-specifiers/) of the Packaging docs. The [environment markers section](https://packaging.python.org/en/latest/specifications/dependency-specifiers/#environment-markers) of the latter links to again different PEPs.

---

_Comment by @keikoro on 2025-09-01 14:25_

> The [environment markers section](https://packaging.python.org/en/latest/specifications/dependency-specifiers/#environment-markers) of the latter links to again different PEPs.

Above the table with all the markers, it says:

> The “extras” and “dependency_groups” variables are also special. They are used to specify any requested extras or dependency groups when installing from a lock file. Outside of the context of lock files, these two variables should result in an error like all other unknown variables.

The average user wouldn't necessarily know that `uv`'s lock files are formatted differently than the "ideal" or recommended lock file.

---

_Comment by @zanieb on 2025-09-01 14:46_

I don't really get what you're saying? Maybe you should be more concrete about what you want here? I think the linked specification documentation is quite clear that these fields are only usable inside lockfiles, but you're complaining that we're not explaining that you can't use them elsewhere?

---

_Comment by @keikoro on 2025-09-01 18:32_

> I think the linked specification documentation is quite clear that these fields are only usable inside lockfiles

It isn't, though. Maybe that's how you know to interpret it with your greater knowledge of how packaging works and what packaging tool devs (need to) know.

I am not that. The passage I quoted doesn't say what you are saying. It talks about "_installing_ from lock files" and that these fields are only relevant in the "_context_ of lock files". The context exists merely by using a tool that uses lock files.

> I don't really get what you're saying? Maybe you should be more concrete about what you want here?

Expert's curse? I don't know how much clearer I could have been in describing my issue. Unless you're asking me to type out concrete suggestions for changes, i.e. what would normally go in a PR.

> but you're complaining that we're not explaining that you can't use them elsewhere?

This is a really weird way to react to feedback regarding improvements that could be made to documentation you maintain. Whose entire point is to make things easier to use and understand for more people.

If `uv` doesn't look further than its own docs because ¯\_(ツ)_/¯ it clearly isn't your responsibility: point taken & useful to know going forward.

---

_Comment by @keikoro on 2025-09-02 08:07_

> We should error in other contexts though, per the PEP:
> 
> > Fourth, use of extras and dependency_groups will be considered an error outside of lock file (much like extra outside of [Core metadata specifications](https://packaging.python.org/en/latest/specifications/core-metadata/#core-metadata)).

Thank you. Had there been an error, I might have found out about proper usage/that specific PEP sooner.

(Not being particularly knowledgeable about lock files and then seeing several remarks about these fields _not yet_ being supported certainly didn't help.)


---

_Comment by @zanieb on 2025-09-03 12:12_

I think you're assuming the worst of us here. We're both interested in improving our documentation and helping you, but the tone of this interaction is making it challenging.

I think in your last post you clarified part of what I didn't understand:

>  The passage I quoted doesn't say what you are saying. It talks about "installing from lock files" and that these fields are only relevant in the "context of lock files". The context exists merely by using a tool that uses lock files.

I think this should be clarified in the upstream documentation, as it is in the PEP. They're talking about these markers only being valid when present in a lockfile. It sounds like you interpreted this as them being available outside of a lockfile when a lockfile exists? Where were you trying to use the markers?

I still don't understand what you mean by:

> The average user wouldn't necessarily know that uv's lock files are formatted differently than the "ideal" or recommended lock file.

---
