---
number: 1224
title: Jupyter sometimes fails to install
type: issue
state: closed
author: charliermarsh
labels:
  - bug
assignees: []
created_at: 2024-02-01T14:22:50Z
updated_at: 2024-02-01T15:00:38Z
url: https://github.com/astral-sh/uv/issues/1224
synced_at: 2026-01-07T12:31:14-06:00
---

# Jupyter sometimes fails to install

---

_Issue opened by @charliermarsh on 2024-02-01 14:22_

If I run `python -m scripts.bench --puffin ./scripts/requirements/compiled/jupyter.txt` enough times, it will eventually fail with:

```
error: Failed to install: jupyterlab-4.0.11-py3-none-any.whl (jupyterlab==4.0.11)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmphqqjw2bm/tmp525tkoe0/.venv/share/icons/hicolor/scalable`
  Caused by: File exists (os error 17)
```

---

_Assigned to @charliermarsh by @charliermarsh on 2024-02-01 14:22_

---

_Label `bug` added by @charliermarsh on 2024-02-01 14:22_

---

_Comment by @charliermarsh on 2024-02-01 14:26_

High-priority bug, I'll fix it today.

---

_Comment by @charliermarsh on 2024-02-01 14:32_

Various other incarnations of the same issue, to help understand the conflict:

```text
error: Failed to install: jupyterlab-4.0.11-py3-none-any.whl (jupyterlab==4.0.11)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmpwdvv_3ac/tmpyg8gnfgf/.venv/share/icons/hicolor/scalable`
  Caused by: File exists (os error 17)

error: Failed to install: jupyterlab-4.0.11-py3-none-any.whl (jupyterlab==4.0.11)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmpev2bts2z/tmpgn09za74/.venv/share/jupyter/lab/schemas`
  Caused by: File exists (os error 17)

error: Failed to install: notebook-7.0.7-py3-none-any.whl (notebook==7.0.7)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmpuo9hjrtw/tmp95ctafr1/.venv/share/icons/hicolor/scalable/apps`
  Caused by: File exists (os error 17)
```

---

_Comment by @konstin on 2024-02-01 14:35_

These are all data directories, that's on the `install_data` path. Could it be https://github.com/astral-sh/puffin/blob/4ad0dc8b9e921a544c46e8e48888164cdf58dd30/crates/install-wheel-rs/src/wheel.rs#L672 should be `create_dir_all`?

---

_Comment by @charliermarsh on 2024-02-01 14:36_

Ahh you're a hero! TOCTOU

---

_Referenced in [astral-sh/uv#1227](../../astral-sh/uv/pulls/1227.md) on 2024-02-01 14:51_

---

_Comment by @charliermarsh on 2024-02-01 15:00_

Closed by #1227.

---

_Closed by @charliermarsh on 2024-02-01 15:00_

---
