---
number: 4534
title: "`invalid peer certificate: BadSignature` when installing package from private index using ECDSA SHA-512 SSL cert"
type: issue
state: open
author: kcon-stackav
labels:
  - great writeup
assignees: []
created_at: 2024-06-25T23:22:05Z
updated_at: 2025-08-21T11:12:35Z
url: https://github.com/astral-sh/uv/issues/4534
synced_at: 2026-01-07T12:31:14-06:00
---

# `invalid peer certificate: BadSignature` when installing package from private index using ECDSA SHA-512 SSL cert

---

_Issue opened by @kcon-stackav on 2024-06-25 23:22_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

I use a private Python package index server (anonymized as `pypi.internal` in the snippets below) that uses an `ecdsa-with-SHA512` SSL certificate:

```
‚ùØ openssl s_client -connect pypi.internal:443 < /dev/null 2>/dev/null | openssl x509 -in /dev/stdin -text -noout -certopt ca_default -certopt no_validity -certopt no_serial -certopt no_subject -certopt no_extensions  -certopt no_sigdump
        Signature Algorithm: ecdsa-with-SHA512
```

I am able to use `pip` to fetch and install Python packages from this index, but when I try to use `uv` it fails with the following error:

```
‚ùØ uv pip install https://pypi.internal/pypi/package/version/package-version-py3-none-any.whl
error: Failed to download: `package @ https://pypi.internal/pypi/package/version/package-version-py3-none-any.whl`
  Caused by: error sending request for url (https://pypi.internal/pypi/package/version/package-version-py3-none-any.whl)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: BadSignature

‚ùØ uname -mv
#20~22.04.1-Ubuntu SMP Wed May  1 16:10:50 UTC 2024 x86_64

‚ùØ uv --version
uv 0.2.15
```

I think this may be the same issue described by https://github.com/rust-lang/rustup/issues/3820, because I understand `uv` depends on `reqwest`:

https://github.com/astral-sh/uv/blob/c28a2c758321d3caeead0dd021457b773269d1b3/Cargo.toml#L112

which depends on `rustls` using the `ring` feature: https://github.com/seanmonstar/reqwest/blob/c4ebb073438026e09c99469be02fc1f1a254058a/Cargo.toml#L181

and `ring` does not yet support the ECDSA SHA-512 certificate signature algorithm (WIP but has been open for over 8 months so it's not clear when it would land and be released: https://github.com/briansmith/ring/pull/1631).

I was reading [here](https://github.com/seanmonstar/reqwest/pull/2225#issuecomment-2145678324) that it may be possible to configure `reqwest` to use `aws-lc-rs` (which [does provide support for the ECDSA SHA-512 algorithm for `rustls`](https://github.com/rustls/rustls/pull/1706)) instead of `ring`. Here is a draft PR where it looks like `rustup` is trying to take this approach: https://github.com/rust-lang/rustup/pull/3898

Would ya'll consider switching `uv` from using `ring` to `aws-lc-rs` to support fetching Python packages from an index server whose SSL certificate uses the ECDSA SHA-512 signature algorithm?

---

_Comment by @samypr100 on 2024-06-26 02:20_

Could you share your private package index TLS setup to reproduce? Are you using nginx as a reverse proxy?

---

_Comment by @kcon-stackav on 2024-06-26 21:04_

@samypr100 thank you for the quick response. üôè My private package index's SSL certificate is self-signed by a private CA, and yes I'm using nginx as a reverse proxy where TLS is terminated at the proxy.

---

_Comment by @samypr100 on 2024-06-26 23:59_

Thanks for confirming @kcon-stackav. Would you be able to share some of the tls settings of the nginx config you're using? (e.g. `ssl_protocols`, `ssl_ciphers`, etc.) and also the `openssl` command used to generate the self-signed certificate? It would help in reproducing the issue.

---

_Label `great writeup` added by @zanieb on 2024-06-27 10:44_

---

_Comment by @zanieb on 2024-06-27 10:48_

Thanks for the thorough write-up and cross references, that's really helpful. I'd be willing to consider changing backends, though I worry it'd be a breaking change and don't fully understand the implications yet. Would you be interested in opening a pull request to explore the change?

---

_Comment by @Sovietaced on 2024-06-27 17:11_

> Thanks for confirming @kcon-stackav. Would you be able to share some of the tls settings of the nginx config you're using? (e.g. `ssl_protocols`, `ssl_ciphers`, etc.) and also the `openssl` command used to generate the self-signed certificate? It would help in reproducing the issue.

We are using nginx with certificates managed by cert-manager. Cert-manager is hooked up to AWS private CA as an issuer. Certificate generation is automated for us. Presumably if you use a ECDSA private key with enough bits it will sign the cert with the problematic algorithm. 

---

_Comment by @kcon-stackav on 2024-06-27 18:02_

> Thanks for the thorough write-up and cross references, that's really helpful. I'd be willing to consider changing backends, though I worry it'd be a breaking change and don't fully understand the implications yet. Would you be interested in opening a pull request to explore the change?

Thank you! Sure I'll work on a pull request to try to make the change. üôè 

---

_Referenced in [astral-sh/uv#4734](../../astral-sh/uv/pulls/4734.md) on 2024-07-02 18:39_

---

_Comment by @kcon-stackav on 2024-07-02 22:45_

I created this PR to try out using `aws-lc-rs` instead of `ring` for TLS: https://github.com/astral-sh/uv/pull/4734

Unfortunately it looks like it won't solve our issue üòû. Although `aws-lc-rs` supports the ECDSA SHA-512 certificate signature algorithm we need, our certificate trust chain's issuing CA uses ECDSA P384 for its subject public key algorithm, and I learned that `aws-lc-rs` does not support verifying that particular combination of subject public key algorithm and signature algorithm. 

Instead it only supports verifying a ECDSA SHA-512 signature when the subject public key algorithm is ECDSA P521:

https://github.com/rustls/webpki/blob/dba3b84bcf810612a83c8fd3c750d3c4106e7b9e/src/aws_lc_rs_algs.rs#L70-L75

Or otherwise verifying a ECDSA SHA-384 signature when the subject public key algorithm is ECDSA P384:

https://github.com/rustls/webpki/blob/dba3b84bcf810612a83c8fd3c750d3c4106e7b9e/src/aws_lc_rs_algs.rs#L63-L68

I'm not sure changing our certs to match one of those combinations will be an option, so now I'm thinking our best option may be to leverage https://github.com/astral-sh/uv/issues/1339 once it is available.

---

_Comment by @cpu on 2024-07-29 18:01_

> Unfortunately it looks like it won't solve our issue üòû. Although aws-lc-rs supports the ECDSA SHA-512 certificate signature algorithm we need, our certificate trust chain's issuing CA uses ECDSA P384 for its subject public key algorithm, and I learned that aws-lc-rs does not support verifying that particular combination of subject public key algorithm and signature algorithm.

@kcon-stackav Have you tried with the recently released [rustls 0.23.12](https://github.com/rustls/rustls/releases/tag/v%2F0.23.12) & the aws-lc-rs provider? There have been a handful of related PRs across the ecosystem:
* https://github.com/rustls/rustls/pull/2050
* https://github.com/rustls/webpki/pull/272
* https://github.com/aws/aws-lc-rs/pull/461

---

_Comment by @kcon-stackav on 2024-07-31 18:11_

@cpu thanks for the heads-up, unfortunately it looks like `webpki` and the others are still missing support for the particular combination we need (ECDSA P384 with SHA-512 or following their naming convention in https://github.com/rustls/webpki/blob/main/src/aws_lc_rs_algs.rs, I think it would be called something like `ECDSA_P384_SHA512`).

---

_Comment by @samypr100 on 2024-07-31 20:04_

@cpu Unrelated, but I just needed to take a moment and appreciate your awesome github handle ü§Ø 

---

_Comment by @kcon-stackav on 2024-08-27 22:18_

I can confirm the support for `--allow-insecure-host` introduced in 0.3.5 (https://github.com/astral-sh/uv/issues/1339) enables me to use `uv` with my private Python package index server. ü•≥ I'll close this issue for now since we have a workaround. Thanks so much for all of your help! üôè 

---

_Closed by @kcon-stackav on 2024-08-27 22:18_

---

_Referenced in [zed-industries/zed#24656](../../zed-industries/zed/pulls/24656.md) on 2025-02-12 01:26_

---

_Referenced in [zed-industries/zed#19620](../../zed-industries/zed/issues/19620.md) on 2025-02-12 01:27_

---

_Comment by @zoobab on 2025-07-07 14:55_

This issue is still there, ignoring security with "--allow-insecure-host" is not a solution.

This should be reopened.

I can reproduce the issue at the moment.

---

_Reopened by @zanieb on 2025-07-07 15:00_

---

_Comment by @zoobab on 2025-07-08 09:45_

I have an issue with an Artifactory server that has the following cipher:

ECDHE-RSA-AES128-GCM-SHA256

Can someone confirm that it is supported?

---

_Comment by @1ml-coder on 2025-07-31 16:43_

I've also stumbled upon the same issue. 

 DEBUG Transient request failure for https://pypi-local, retrying: error sending request for url (https://pypi-local/)
 Caused by: client error (Connect)
 Caused by: invalid peer certificate: BadSignature

pypi-local is an internal Artifactory server with a Self-signed certificate. **Signature Algorithm: ecdsa-with-SHA512**

---

_Referenced in [istio/ztunnel#1613](../../istio/ztunnel/issues/1613.md) on 2025-08-14 13:53_

---

_Comment by @lel-amri on 2025-08-21 07:35_

Hello there, we also had an issue with certificates of an internal Artifactory instance.

uv 0.8.3 failed with the `BadSignature` error, and uv 0.8.4 was succeeding.
During this version bump, `rusttls` was updated from 0.23.22 to 0.23.29, which in turn updated `rusttls-webpki` from 0.102.8 to 0.103.4. By looking at the log of `rusttls-webpki` I was able to find commit https://github.com/rustls/webpki/commit/16abda163f5a643013c21d73e0577fbdec030a56, which fixes the issue.

Our Artifactory certificate lacked signatures (the RSA PKCS#1 kind) parameters. The RFC forbid generating such certificates, but require verifiers to treat absent parameters as a `NULL` parameter, which `rusttls-webpki` wasn't doing until version [0.103.3](https://github.com/rustls/webpki/releases/tag/v/0.103.3).

Anyway: **In our case the issue was fixed with uv 0.8.4. I advise people with this issue to check whether the signature algorithm of their certificate is supported by [`rusttls-webpki`](https://github.com/rustls/webpki).**

---

_Comment by @zanieb on 2025-08-21 11:12_

Thank you!

---
