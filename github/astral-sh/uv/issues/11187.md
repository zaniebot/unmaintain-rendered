---
number: 11187
title: "Hash (#) in password within UV_INDEX_URL causes \"invalid port number\" error"
type: issue
state: closed
author: RStreitfeld
labels:
  - question
assignees: []
created_at: 2025-02-03T17:10:16Z
updated_at: 2025-02-05T09:57:29Z
url: https://github.com/astral-sh/uv/issues/11187
synced_at: 2026-01-07T12:31:15-06:00
---

# Hash (#) in password within UV_INDEX_URL causes "invalid port number" error

---

_Issue opened by @RStreitfeld on 2025-02-03 17:10_

### Summary

### Description
When using a  `#` character in the password field of UV_INDEX_URL, the URL appears to be truncated at the hash, leading to an "invalid port number" error rather than properly attempting authentication.

### To Reproduce
1. Set `UV_INDEX_URL` to include a password with `#`. For this purpose, even invalid credentials and server expose the problem.
```shell
UV_INDEX_URL='https://user:pass#@server' uv pip install flake8
```
2. Observe that instead of `Failed to fetch: https://server/flake8/` we get this error:
```
error: invalid value 'https://user:pass#@server' for '--index-url <INDEX_URL>': invalid port number
```


### Platform

Ubuntu 20.04.6 amd64

### Version

uv 0.5.26

### Python version

Python 3.12.6

---

_Label `bug` added by @RStreitfeld on 2025-02-03 17:10_

---

_Comment by @zanieb on 2025-02-03 18:21_

I think this is correct. `#` is a special character in URLs, I presume you need to escape it?

---

_Label `question` added by @zanieb on 2025-02-03 18:22_

---

_Comment by @charliermarsh on 2025-02-03 19:23_

It's possible that we're parsing `#@server` as a fragment? I have to check.

---

_Comment by @charliermarsh on 2025-02-03 19:26_

Okay yeah, it looks like `Url::parse("https://user:pass#@server")` returns `Err(InvalidPort)`, so it's correct to fail here.

---

_Label `bug` removed by @charliermarsh on 2025-02-03 19:26_

---

_Comment by @notatallshaw-gts on 2025-02-03 19:31_

This is a common problem with passwords in URLs, I've seen it most often with SqlAlchemy connection strings.

You usually have to url encode the password, e.g. `https://user:pass%23@server`, I assume the same is true with uv here?

---

_Comment by @zanieb on 2025-02-03 19:47_

Yeah I don't think we can safely perform that encoding for the user.

---

_Comment by @RStreitfeld on 2025-02-05 09:57_

Thank you for the hint to url encode the password. This fixed the issue for me.

---

_Closed by @RStreitfeld on 2025-02-05 09:57_

---
