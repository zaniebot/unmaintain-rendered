---
number: 5226
title: "`--resolution lowest` with `uv sync` needs to discard preferences"
type: issue
state: closed
author: konstin
labels:
  - enhancement
  - preview
assignees: []
created_at: 2024-07-19T17:37:10Z
updated_at: 2024-07-22T12:28:23Z
url: https://github.com/astral-sh/uv/issues/5226
synced_at: 2026-01-07T12:31:14-06:00
---

# `--resolution lowest` with `uv sync` needs to discard preferences

---

_Issue opened by @konstin on 2024-07-19 17:37_

Currently, when switching to `uv sync --resolution lowest` from `uv sync`, nothing changes, because we're using the existing preferences. This breaks the use case for `--resolution lowest`.

We should instead discard the preferences when using `--resolution lowest` or `--resolution lowest-direct`, since these two modes are not for regular development, but for testing your dependency specifiers.

---

_Label `bug` added by @konstin on 2024-07-19 17:37_

---

_Label `preview` added by @konstin on 2024-07-19 17:37_

---

_Label `bug` removed by @charliermarsh on 2024-07-19 17:38_

---

_Comment by @charliermarsh on 2024-07-19 17:38_

I don't consider this a bug, but we can consider changing it.

---

_Comment by @charliermarsh on 2024-07-19 17:39_

I don't think discarding preferences alone would change this. We'd also have to skip the "resolve from lockfile" behavior.

---

_Comment by @charliermarsh on 2024-07-19 17:42_

Perhaps we _always_ do both these things if `--resolution` is set explicitly...? Like, say that it implies `--upgrade`?

---

_Comment by @charliermarsh on 2024-07-19 17:42_

I can try it.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-07-19 17:42_

---

_Label `enhancement` added by @charliermarsh on 2024-07-19 17:47_

---

_Comment by @charliermarsh on 2024-07-19 17:50_

I guess arguably `--prerelease` and other settings should have the same effect, but I don't know where to draw the line.

---

_Comment by @konstin on 2024-07-19 18:31_

Do we need to record the settings used for the resolution in `uv.lock`?

---

_Comment by @charliermarsh on 2024-07-19 19:05_

The downside of that approach is that it wouldn't work for `uv pip install --resolution lowest`, which has also led to confusion before and would be nice to solve here.

---

_Comment by @charliermarsh on 2024-07-19 23:33_

No obviously-good solution here... Options are something like:

- Use `--upgrade` semantics whenever `--resolution` is explicitly provided. But, how does this work when `--resolution` is provided via a configuration file? We never pin? That wouldn't work.
-  Write the `resolution` and `prerelease` to the lockfile, so that we can rerun when they're mismatched. This is good, but it doesn't solve the same problem that already exists for `uv pip install`, which has been described before: #1647.

I suspect we need to do the latter, though.


---

_Comment by @charliermarsh on 2024-07-19 23:48_

We probably want to record the `resolution`, `prerelease`, and `exclude-newer` setting.

---

_Comment by @charliermarsh on 2024-07-21 12:15_

Working on that change (adding resolution options to the lockfile).

---

_Comment by @charliermarsh on 2024-07-21 12:16_

I wonder if, eventually, we'd want to enable projects to have multiple locks for this purpose. Or enable the lockfile to contain multiple entries if they resolve with different input settings.

---

_Comment by @zanieb on 2024-07-21 14:59_

It seems like it depends on the use-case. Are you going to always run your project in `lowest` resolution because you prefer it? I don't know why you'd need multiple lock files in that case. Or is it a single invocation in CI to test if the lowest versions are correct? There, I don't think the lock matters at all?

---

_Comment by @charliermarsh on 2024-07-21 15:11_

Are you commenting on the originating issue here or my previous comment?

---

_Comment by @zanieb on 2024-07-21 15:57_

The previous comment.

---

_Referenced in [astral-sh/uv#5264](../../astral-sh/uv/pulls/5264.md) on 2024-07-21 20:16_

---

_Closed by @charliermarsh on 2024-07-22 12:28_

---

_Closed by @charliermarsh on 2024-07-22 12:28_

---
