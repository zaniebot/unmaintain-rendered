---
number: 16786
title: weird behaviour of uv sync and the uv cache
type: issue
state: open
author: kforner
labels:
  - bug
assignees: []
created_at: 2025-11-20T10:30:44Z
updated_at: 2025-11-21T08:44:39Z
url: https://github.com/astral-sh/uv/issues/16786
synced_at: 2026-01-07T12:31:16-06:00
---

# weird behaviour of uv sync and the uv cache

---

_Issue opened by @kforner on 2025-11-20 10:30_

### Summary

When I preinstall a package using uv pip install, the cache seems to be populated but `uv sync` does not use it.
Here's a Dockerfile:

```
FROM ubuntu:24.04
COPY --from=ghcr.io/astral-sh/uv:0.9.8 /uv /uvx /bin/
USER ubuntu
RUN uv python install 3.14
WORKDIR /home/ubuntu

RUN uv venv && uv pip install pandas && rm -rf .venv
COPY --chown=ubuntu:ubuntu py_dev/project_only/pyproject.toml .

RUN ls  -ls ~/.cache/uv/wheels-v5/pypi/

RUN rm  -rf .venv && uv sync --link-mode copy -v 2>&1 | grep pandas | grep  Identified
RUN rm  -rf .venv && uv sync --link-mode copy -v 2>&1 | grep pandas 
```

Here's the pyproject.toml:

```
[project]
name = "dummy"
version = "0.1.0"
requires-python = ">=3.14"
dependencies = [ 
    "pandas"
]
```

and here's the interesting part of the docker build output:
```
#16 [stage-0 10/12] RUN ls  -ls ~/.cache/uv/wheels-v5/pypi/
#16 0.157 total 24
#16 0.157 4 drwxr-xr-x 2 ubuntu ubuntu 4096 Nov 20 10:28 numpy
#16 0.157 4 drwxr-xr-x 2 ubuntu ubuntu 4096 Nov 20 10:28 pandas
#16 0.157 4 drwxr-xr-x 2 ubuntu ubuntu 4096 Nov 20 10:28 python-dateutil
#16 0.157 4 drwxr-xr-x 2 ubuntu ubuntu 4096 Nov 20 10:28 pytz
#16 0.157 4 drwxr-xr-x 2 ubuntu ubuntu 4096 Nov 20 10:28 six
#16 0.157 4 drwxr-xr-x 2 ubuntu ubuntu 4096 Nov 20 10:28 tzdata
#16 DONE 0.2s

#17 [stage-0 11/12] RUN rm  -rf .venv && uv sync --link-mode copy -v 2>&1 | grep pandas | grep  Identified
#17 18.57 DEBUG Identified uncached distribution: pandas==2.3.3
#17 DONE 18.8s

#18 [stage-0 12/12] RUN rm  -rf .venv && uv sync --link-mode copy -v 2>&1 | grep pandas
#18 0.416 DEBUG Registry requirement already cached: pandas==2.3.3
#18 0.416  + pandas==2.3.3
#18 DONE 0.6s
```

- the first `uv sync` execution states that ` DEBUG Identified uncached distribution: pandas==2.3.3`
- the second run: DEBUG Registry requirement already cached: pandas==2.3.3
Since pandas was already installed using `uv pip install`, and the cache populated, I can't understand what's happening.




### Platform

docker on linux

### Version

uv 0.9.8

### Python version

_No response_

---

_Label `bug` added by @kforner on 2025-11-20 10:30_

---

_Comment by @kforner on 2025-11-20 10:43_

Note that substituting `uv pip install pandas` by `uv add pandas` fixes that behaviour.

---

_Comment by @zanieb on 2025-11-20 14:28_

How do you know they're resolving to the same version of `pandas`? What version does `uv pip install pandas` install?

---

_Comment by @konstin on 2025-11-20 14:59_

I can reproduce this with any package, e.g. sniffio. When using torch it become notable that we don't share the cache between `uv pip install` and `uv sync`, but we do share it inside the interface. That shouldn't happen, cause they are the same file and should go through the same preparation and install code.

---

_Comment by @konstin on 2025-11-20 15:05_

MRE (works with sniffio too, but pandas or torch shows that it's not just a logging error):
```
uv cache clean && uv venv -c && uv pip install nvidia-nccl-cu12 && rm -rf .venv # Fresh
uv venv -c && uv pip install nvidia-nccl-cu12 && rm -rf .venv # Cached
rm -rf .venv && rm -f pyproject.toml && uv init && uv add nvidia-nccl-cu12 # Fresh, but it should be cached
rm -rf .venv && rm -f pyproject.toml && uv init && uv add nvidia-nccl-cu12 # Cached
```

---

_Comment by @charliermarsh on 2025-11-20 21:58_

I think this is because in `uv pip`, we don't compute hashes by default, but `uv sync` needs them to validate -- so we end up re-downloading.

---

_Comment by @charliermarsh on 2025-11-20 21:59_

In other words, I think this works if you add `--verify-hashes` to `uv pip install`.

---

_Comment by @kforner on 2025-11-21 08:44_

Thanks, I confirm that `--verify-hashes` fixes it. 
Is there a reason it is not enabled by default?

---

_Referenced in [astral-sh/uv#16816](../../astral-sh/uv/pulls/16816.md) on 2025-11-22 03:05_

---
