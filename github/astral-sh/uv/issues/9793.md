---
number: 9793
title: "PowerPC binary build failure \"relocation truncated to fit: R_PPC64_REL24\""
type: issue
state: open
author: zanieb
labels: []
assignees: []
created_at: 2024-12-11T00:13:06Z
updated_at: 2024-12-11T14:33:07Z
url: https://github.com/astral-sh/uv/issues/9793
synced_at: 2026-01-07T12:31:15-06:00
---

# PowerPC binary build failure "relocation truncated to fit: R_PPC64_REL24"

---

_Issue opened by @zanieb on 2024-12-11 00:13_

The build failed during linking with

```
libthread_local-14bdf71b2f8c428a.rlib(thread_local-14bdf71b2f8c428a.thread_local.9165f86b66b4614-cgu.0.rcgu.o): in function `thread_local::thread_id::get_slow':
          thread_local.9165f86b66b4614-cgu.0:(.text.unlikely._ZN12thread_local9thread_id8get_slow17h6b636cdf3f4cc69eE+0x250): relocation truncated to fit: R_PPC64_REL24 against symbol `__tls_get_addr' defined in .text.__tls_get_addr section in /usr/local/musl/bin/../lib/gcc/powerpc64le-unknown-linux-musl/11.2.0/../../../../powerpc64le-unknown-linux-musl/lib/libc.a(__tls_get_addr.lo)
          /home/runner/work/uv/uv/target/powerpc64le-unknown-linux-musl/release-no-lto/deps/libuv_installer-2b553695d2f31d2e.rlib(uv_installer-2b553695d2f31d2e.uv_installer.2988552f99df20af-cgu.04.rcgu.o): in function `std::sys::thread_local::native::lazy::Storage<T,D>::initialize':
          uv_installer.2988552f99df20af-cgu.04:(.text.unlikely._ZN3std3sys12thread_local6native4lazy20Storage$LT$T$C$D$GT$10initialize17hc81f5ebe44f2f56dE+0x34): relocation truncated to fit: R_PPC64_REL24 against symbol `__tls_get_addr' defined in .text.__tls_get_addr section in /usr/local/musl/bin/../lib/gcc/powerpc64le-unknown-linux-musl/11.2.0/../../../../powerpc64le-unknown-linux-musl/lib/libc.a(__tls_get_addr.lo)
          /home/runner/work/uv/uv/target/powerpc64le-unknown-linux-musl/release-no-lto/deps/libuv_installer-2b553695d2f31d2e.rlib(uv_installer-2b553695d2f31d2e.uv_installer.2988552f99df20af-cgu.10.rcgu.o): in function `rayon_core::registry::Registry::in_worker_cold':
          uv_installer.2988552f99df20af-cgu.10:(.text.unlikely._ZN10rayon_core8registry8Registry14in_worker_cold17h7266177902601b2eE+0x2c): relocation truncated to fit: R_PPC64_REL24 against symbol `__tls_get_addr' defined in .text.__tls_get_addr section in /usr/local/musl/bin/../lib/gcc/powerpc64le-unknown-linux-musl/11.2.0/../../../../powerpc64le-unknown-linux-musl/lib/libc.a(__tls_get_addr.lo)
          collect2: error: ld returned 1 exit status
```

ref https://github.com/astral-sh/uv/actions/runs/12265976138/job/34223179814?pr=9791

See https://stackoverflow.com/questions/10486116/what-does-this-gcc-error-relocation-truncated-to-fit-mean

---

_Comment by @zanieb on 2024-12-11 00:13_

Attempting a fix by changing some compiler flags 

- dffaf24b3
- 5cc430188
- 00cf29b7b
- 0c369b235
- e579d038e
- 6f8f133c823508550db076579f888e9ac7c96b76 (I thought this one _had_ to work)

In most of these, I'm just trying to get the flag past Maturin in various ways. Not sure if it's working at all; e.g., the `rustc` call does not include the flags

> Caused by: Cargo build finished with "exit status: 101": `env -u CARGO "cargo" "rustc" "--profile" "release-no-lto" "--features" "self-update" "--target" "powerpc64le-unknown-linux-musl" "--message-format" "json-render-diagnostics" "--locked" "--manifest-path" "/home/runner/work/uv/uv/crates/uv/Cargo.toml" "--bin" "uv" "--" "-C" "strip=symbols"`

edit: At least in some of these it looks like I was editing the `gnu` job instead of the `musl` cross job; see https://github.com/astral-sh/uv/issues/9793#issuecomment-2533439207 instead

---

_Comment by @zanieb on 2024-12-11 01:29_

Also tried

- Reverting the microarchitecture change (https://github.com/astral-sh/uv/pull/9791/commits/ef59b4e98e7ba099935cc6b0ac1ea07c8abcad01)
- Reverting the cc upgrade (https://github.com/astral-sh/uv/pull/9791/commits/61433bb6ed89b05e7625c608948b5ff2a1bda481)
- Reverting the entire `cargo update` commit from #9712 (88f637d2e600300648df47e9aded68556d89246f)
- Reverting the tracing update from #9566 (54f661863badbc16e0bbdf9d3f65f1d3aa799c85)
- Reverting the `Cargo.lock` file to the previous release (20b52687f8e8bcf9bd4775a18831fc4ac538d9ae)
- Reverting the resolver change from #9769 (c29afade8358c6bb7d4682e5faba84faaa709e86)

---

_Comment by @zanieb on 2024-12-11 01:51_

I got the compiler flags to go through, but they don't solve the issue

- `-Crelocation-model=pic -Clink-args=-Wl,-z,notext` (https://github.com/astral-sh/uv/pull/9796/commits/0e0fd1d66ffea99fdb868d9ff413a0f29ed120ce)
- `-Crelocation-model=pic -Clink-args=-Wl,-z,notext -Ccode-model=large"` (0e0fd1d66ffea99fdb868d9ff413a0f29ed120ce)
- `-Ctarget-feature=+crt-static`(3842d88427a7d7aebced59c0f826d83261aacced)
- `-Ccode-model=large` (441ca34ca80b78bc01d61a193ebda5fe309bc171)
- `-Clink-args=-Wl,-z,notls` (ca8f7b0635070d2be17527e0b3ab9c1da3fa994a)

---

_Referenced in [astral-sh/uv#9796](../../astral-sh/uv/pulls/9796.md) on 2024-12-11 02:28_

---

_Comment by @zanieb on 2024-12-11 02:45_

The trace suggests some sort of interaction between `uv-installer`, `rayon`, and `tracing-subscriber`

---

_Comment by @zanieb on 2024-12-11 02:54_

The cross-build Docker image (`ghcr.io/rust-cross/rust-musl-cross:powerpc64le-musl`) is identical

---

_Comment by @zanieb on 2024-12-11 04:32_

I re-ran the 0.5.7 version bump CI job to see if _that_ would still pass https://github.com/astral-sh/uv/actions/runs/12207650814 â€” it succeeded so sanity prevails and it is some sort of regression.

---

_Comment by @zanieb on 2024-12-11 04:46_

I think the next step is to do a bisect, though I suspect we've just reached some threshold of complexity that the linker has problems with on powerpc.

I briefly looked at the download stats for this artifact and they're low but non-zero.

As a drastic step, I think we could turn of tracing for this target? But that seems pretty invasive.

---

_Referenced in [astral-sh/uv#9810](../../astral-sh/uv/pulls/9810.md) on 2024-12-11 13:58_

---

_Comment by @zanieb on 2024-12-11 14:33_

We are going to drop support for now, see https://github.com/astral-sh/uv/pull/9810

---

_Referenced in [astral-sh/uv#9815](../../astral-sh/uv/pulls/9815.md) on 2024-12-11 15:21_

---

_Referenced in [Homebrew/homebrew-core#200827](../../Homebrew/homebrew-core/pulls/200827.md) on 2024-12-11 17:26_

---
