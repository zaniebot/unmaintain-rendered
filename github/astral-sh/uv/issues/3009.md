---
number: 3009
title: Cache is invalidated on token renewal
type: issue
state: closed
author: jvdw-synth
labels: []
assignees: []
created_at: 2024-04-12T06:55:39Z
updated_at: 2024-04-15T14:46:10Z
url: https://github.com/astral-sh/uv/issues/3009
synced_at: 2026-01-07T12:31:14-06:00
---

# Cache is invalidated on token renewal

---

_Issue opened by @jvdw-synth on 2024-04-12 06:55_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

# Cache is invalidated on token renewal

Some private package registries (e.g. `CodeArtifact`) use short-lived credentials. Since they are short-lived, the exact URL that is assigned to `UV_INDEX_URL` changes frequently and with that the cache key / hashes of these URLs. This causes the cache to be missed on token renewal.

```bash
aws codeartifact login \
    --tool pip \
    --domain my_domain \
    --domain-owner 111122223333 \
    --repository my_repo

export UV_INDEX_URL=$(pip config global.index-url)

# First time, cold cache (will download)
uv pip install -r requirements.txt

# Remove
uv pip uninstall -r requirements.txt

# Desired behavior: warm cache, fast installs
uv pip install -r requirements.txt

# Remove again to clarify issue below
uv pip uninstall -r requirements.txt

# Renew credentials
aws codeartifact login \
    --tool pip \
    --domain my_domain \
    --domain-owner 111122223333 \
    --repository my_repo

export UV_INDEX_URL=$(pip config global.index-url)

# Should be warm cache, but downloads because token renewalc
uv pip install -r requirements.txt
```

Version: `uv 0.1.31 (7bcca28b1 2024-04-09)`
Platform: Macbook M2 Pro - MacOS 14.0

---

_Referenced in [astral-sh/uv#3010](../../astral-sh/uv/pulls/3010.md) on 2024-04-12 07:14_

---

_Closed by @charliermarsh on 2024-04-15 14:46_

---

_Comment by @charliermarsh on 2024-04-15 14:46_

Closed by #3010.

---
