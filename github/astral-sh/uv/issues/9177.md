---
number: 9177
title: maturin build system not always copying the compiled build into the .venv on uv build
type: issue
state: closed
author: zwing99
labels:
  - question
assignees: []
created_at: 2024-11-18T00:47:40Z
updated_at: 2024-11-18T04:02:31Z
url: https://github.com/astral-sh/uv/issues/9177
synced_at: 2026-01-07T12:31:15-06:00
---

# maturin build system not always copying the compiled build into the .venv on uv build

---

_Issue opened by @zwing99 on 2024-11-18 00:47_

When using the maturin build system, I cannot seem to run `uv build` or `uv run maturin develop` or any set of commands that both compiles the library (rust based) and installs it to the local `.venv`. It works once, but then future builds do not copy the binary into the virtualenv. I am not sure if this is 100% UV's fault, but it seems worth reporting as I suspect many folks will be using pyo3, maturin, uv, and rust to build performant libraries going forward. Below is an example toml file.

my work around was to chain these commands:
`rm -fr .venv; uv clean; uv build; uv run ipython`
Note: the clean was very needed.

```toml
[build-system]
requires = ["maturin>=1.7,<2.0"]
build-backend = "maturin"

[project]
name = "factors-py"
requires-python = ">=3.8"
classifiers = [
    "Programming Language :: Rust",
    "Programming Language :: Python :: Implementation :: CPython",
    "Programming Language :: Python :: Implementation :: PyPy",
]
dynamic = ["version"]
dependencies = [
    "ipython>=8.12.3",
    "maturin>=1.7.4",
]
[tool.maturin]
features = ["pyo3/extension-module"]

[dependency-groups]
dev = [
    "pip>=24.3.1",
]
```

---

_Comment by @charliermarsh on 2024-11-18 01:15_

Are you looking for `uv sync`? `uv build` doesn't install the package; it just builds it into a distribution that you can then publish to a registry.

---

_Label `question` added by @charliermarsh on 2024-11-18 01:15_

---

_Comment by @zwing99 on 2024-11-18 02:47_

I did try a `uv sync` and it does not update the binary part of the package. after the `uv build` and `uv sync` I tried a `ls -la .venv/path/to_lib/` and see that the built binary had not been updated. I could also confirm with `println!` statements

---

_Comment by @charliermarsh on 2024-11-18 02:49_

We don't rebuild on source change by default. You need to use `--reinstall-package factors-py`, or add `reinstall-package = [ "factors-py"]` to the `pyproject.toml` under `tool.uv`, or define a cache key: https://docs.astral.sh/uv/reference/settings/#cache-keys.

---

_Comment by @charliermarsh on 2024-11-18 02:51_

You can read more about dynamic builds here: https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata

---

_Comment by @zwing99 on 2024-11-18 03:06_

Cache keys was the trick! Thanks for the fast response! Love this project! Thanks for being an engaged maintainer.

```toml
cache-keys = [{file = "pyproject.toml"}, {file = "requirements.txt"}, {git = {commit = true}}, {file = "**/*.rs"}]
```

---

_Closed by @zwing99 on 2024-11-18 03:09_

---

_Comment by @charliermarsh on 2024-11-18 04:02_

Thank you! :)

---
