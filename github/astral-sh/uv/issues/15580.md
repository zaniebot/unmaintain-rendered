---
number: 15580
title: "--overrides but merge extras OR relax strictness for --constrain with URLs"
type: issue
state: open
author: nmichlo
labels:
  - enhancement
assignees: []
created_at: 2025-08-29T12:50:50Z
updated_at: 2025-08-29T14:37:42Z
url: https://github.com/astral-sh/uv/issues/15580
synced_at: 2026-01-07T12:31:16-06:00
---

# --overrides but merge extras OR relax strictness for --constrain with URLs

---

_Issue opened by @nmichlo on 2025-08-29 12:50_

### Summary

Due to docker, caching, and ease of version specification across many dockerfiles and many requirements files, while also pulling from internal libs I am wanting to structure my files as so:

requirements-service1.txt
```txt
myinternallib[extra1] @ git+https://purposely.invalid.url
# other deps
```

requirements-service2.txt
```txt
myinternallib[extra1,extra2] @ git+https://purposely.invalid.url
# other deps
```

along with a common versions.txt file that can be used to override the above, e.g. `versions.txt`
```txt
myinternallib @ git+https://github.com/nmichlo/myinternallib@v1.2.3
```

The problem comes in when using `uv pip compile`, to override the above, e.g.
```bash
uv pip compile --overrides=versions.txt requirements-service1.txt -o requirements-service1.gen
uv pip compile --overrides=versions.txt requirements-service2.txt -o requirements-service2.gen
```

**problem** Is there any way to keep the extras from the downstream files, instead of completely overwriting everything? So that the lists of extras get merged instead, and only the source/version is overwritten?

EDIT: see below for alternate possible solution by relaxing the strictness of `--constrain`

### Example

_No response_

---

_Label `enhancement` added by @nmichlo on 2025-08-29 12:50_

---

_Comment by @nmichlo on 2025-08-29 12:58_

NOTE: I have also tried `--constrain` instead of `--overrides`, but this doesn't seem to allow URL overwriting? Or passing in dummy URLs first.

```
error: Requirements contain conflicting URLs for package `myinternallib `:
- git+https://github.com/nmichlo/myinternallib
- git+https://github.com/nmichlo/myinternallib@v1.2.3
```

Otherwise

If instead you specify an invalid url, then it tries to check that URL even though you have overwritten the version which seems counter-intuitive? Seems like it should actually work. e.g.

```
 fatal: unable to access 'https://invalid.url/': Could not resolve host: invalid.url
```

Same goes if you use a dummy local file as the version / source e.g. `file://.` Also tries to read the repo even though you have specified a version constraint.

---

_Comment by @nmichlo on 2025-08-29 13:01_

NOTE2: It seems like `--constrain` with a url version works when the requirements files you are constrain DONT have any url for the packges you want to install... problem is this is quite insecure, someone with knowledge could just create a malicious package on pypi with the same name and this would get installed if anyone user makes an error with process.

e.g. 

requirements-service1.txt
```txt
myinternallib[extra1]
```

and `versions.txt`
```txt
myinternallib @ git+https://github.com/nmichlo/myinternallib@v1.2.3
```


----


**Solution?** Maybe a compromise would be to relax the strictness for conflicting URL checks, because if there is a URL, technically you are adjusting the version IFF you change the tag. So if you had:

requirements-service1.txt
```txt
myinternallib[extra1] @ git+https://github.com/nmichlo/myinternallib  # no tag
```

This should work with the above versions.txt


---

_Renamed from "--overrides but merge extras?" to "--overrides but merge extras OR relax strictness for --constrain with URLs" by @nmichlo on 2025-08-29 13:04_

---

_Comment by @konstin on 2025-08-29 13:38_

> problem is this is quite insecure, someone with knowledge could just create a malicious package on pypi with the same name and this would get installed if anyone user makes an error with process.

The best protection against this is using a private registry, either with higher priority than PyPI or replacing PyPI entirely, mirroring required packages. For the use case you describe, we currently only support this solution, with a requirements file without only name and extras and a constraints file with the URL.

---

_Comment by @konstin on 2025-08-29 13:40_

The problem with `myinternallib[extra1] @ git+https://github.com/nmichlo/myinternallib  # no tag` is that in the view of Git, this isn't like an empty version specifier, but it refers to the default branch specifically. We would need some different configuration that says something like "treat `https://github.com/nmichlo/myinternallib` as the repository for myinternallib, find a working reference for it".

---

_Comment by @nmichlo on 2025-08-29 14:35_

@konstin thank you for the response.

I agree about hosting the internal repository, however, its not an option in the current case.

For your second comment, instead of modifying behavior of `--override` and `--constrain`, it seems like a third option is needed that acts as something in between. A `--version` option might make sense (or maybe named better)? Otherwise even a flag then like `--override-merge-extras=myinternallib`

---
