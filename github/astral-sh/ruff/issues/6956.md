---
number: 6956
title: "SIM300: CONSTANT_CASE variables are improperly flagged for yoda violation"
type: issue
state: closed
author: rseeley
labels:
  - bug
  - help wanted
assignees: []
created_at: 2023-08-28T20:52:47Z
updated_at: 2023-12-20T20:26:08Z
url: https://github.com/astral-sh/ruff/issues/6956
synced_at: 2026-01-07T12:31:12-06:00
---

# SIM300: CONSTANT_CASE variables are improperly flagged for yoda violation

---

_Issue opened by @rseeley on 2023-08-28 20:52_

Ruff version: 0.0.286.

Values with CONSTANT_CASE seem to be flagged improperly by the [yoda rule (SIM300)](https://beta.ruff.rs/docs/rules/yoda-conditions/).
```python
UPPER_VAL = 1

assert UPPER_VAL == 1

UPPER_LIST = ['upper']

assert UPPER_LIST == ['upper']

lower_val = 1

assert lower_val == 1
```

Running `ruff . --select SIM300 --isolated` gives the following result:
```
path/to/some/test_file.py:45:12: SIM300 [*] Yoda conditions are discouraged, use `['upper'] == UPPER_LIST` instead
Found 1 error.
```
I may be incorrect, but it seems like `assert UPPER_LIST == ['upper']` should be correct.

Though not shown in my example above, I first noticed this when using a constant-cased class attribute, in case that helps with testing a fix.


---

_Comment by @charliermarsh on 2023-08-28 21:06_

Hmm, I think we're not recognizing `['upper']` as a "constant".

---

_Label `bug` added by @charliermarsh on 2023-08-28 21:06_

---

_Comment by @rseeley on 2023-08-28 21:10_

Ah right, I meant to mention it only seems to happen with mutable data types.

Another sample, and maybe an added bug:
```python
lower = [1, 2]

assert lower == [1, 2]  # it's fine with this
assert [1, 2] == lower  # it's fine with this, added bug?

UPPER = [1, 2]
assert UPPER == [1, 2]  # it doesn't like this
assert [1, 2] == UPPER  # it requires this
```

---

_Comment by @tdulcet on 2023-08-29 09:42_

Doing simple calculations with constant literal values also triggers this:
```py
primes_diff = [
    ... # Large list
]
PRIMES_PTAB_ENTRIES = len(primes_diff)

assert PRIMES_PTAB_ENTRIES == 6542 - 1
```
Ruff output:
```
$ ruff --select SIM300 --isolated factor.py
factor.py:260:8: SIM300 [*] Yoda conditions are discouraged, use `6542 - 1 == PRIMES_PTAB_ENTRIES` instead
Found 1 error.
[*] 1 potentially fixable with the --fix option.
```
There is a [full example here](https://gist.github.com/tdulcet/0c4567c0c295025723807026a4d27d33/#file-factor-py-L95).

---

**Edit**: Here is a simpler example:
```py
SECONDS_IN_DAY = 86400

assert SECONDS_IN_DAY == 60 * 60 * 24
```

---

_Referenced in [astral-sh/ruff#8759](../../astral-sh/ruff/issues/8759.md) on 2023-11-18 23:05_

---

_Comment by @charliermarsh on 2023-11-18 23:05_

This came up again in https://github.com/astral-sh/ruff/issues/8759.


---

_Comment by @ThiefMaster on 2023-11-18 23:09_

> We should probably flag `assert 1 == DummyHandler.CONFIG`, which we don't today -- we consider both of those expressions to be equally "constant".

Maybe `is_constant_like` could return a numeric value (False -> 0, uppercase -> 1, literal -> 2) so an actual literal can get higher priority than a constant in that check?

Looking at the example from @tdulcet, I guess it'd also need to consider arithmetic operations on literals to still be a literal

---

_Label `help wanted` added by @zanieb on 2023-11-20 15:57_

---

_Referenced in [astral-sh/ruff#9164](../../astral-sh/ruff/pulls/9164.md) on 2023-12-16 19:22_

---

_Closed by @charliermarsh on 2023-12-20 20:26_

---
