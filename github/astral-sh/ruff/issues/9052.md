---
number: 9052
title: Autofix EM101
type: issue
state: closed
author: kunaltyagi
labels:
  - fixes
assignees: []
created_at: 2023-12-08T04:49:41Z
updated_at: 2023-12-08T05:26:29Z
url: https://github.com/astral-sh/ruff/issues/9052
synced_at: 2026-01-07T12:31:12-06:00
---

# Autofix EM101

---

_Issue opened by @kunaltyagi on 2023-12-08 04:49_

EM101: Exception must not use a string literal, assign to variable first

This seems a simple enough to auto-fix given [the example](https://docs.astral.sh/ruff/rules/raw-string-in-exception/)

current
```py
    raise XYZ(<some-kind-of-string>)
```

autofix to:
```py
    msg = <some-kind-of-string>
    raise XYZ(msg)
```

1. if msg has been previously defined, we could still fail (with an unfixable message) (or try weird names for the variable like message, xyz_msg, xyz_message, error_msg, error_message, etc.)

Verified no autofix for:
* ruff: ruff 0.1.7
* python: 3.11
* nothing relevant to em101 in pyproject.toml (except selecting "EM")

---

_Comment by @charliermarsh on 2023-12-08 04:51_

I believe autofix is already supported for this rule.

---

_Comment by @charliermarsh on 2023-12-08 04:56_

You may need to run with `--unsafe-fixes`?

---

_Closed by @charliermarsh on 2023-12-08 04:56_

---

_Label `autofix` added by @charliermarsh on 2023-12-08 04:56_

---

_Comment by @kunaltyagi on 2023-12-08 04:57_

I did use --unsafe-fixes but it still didn't fix

---

_Comment by @kunaltyagi on 2023-12-08 05:00_

![image](https://github.com/astral-sh/ruff/assets/2657068/27641039-52c0-4bfc-8f70-f445e2a31721)

And I verified that I was using ruff 0.1.7

---

_Comment by @kunaltyagi on 2023-12-08 05:00_

Only F401 is marked as unfixable

---

_Comment by @charliermarsh on 2023-12-08 05:00_

Can you share a complete reproducible example? The rule is typically fixable, as you can see in the [playground](https://play.ruff.rs/408a1766-159f-4d16-ada0-dfaec37ca006).

---

_Comment by @kunaltyagi on 2023-12-08 05:03_

https://play.ruff.rs/9a03509b-9aab-4959-b2c7-beccdfb8b10a

Does this work for you?

(And it's fixing in the playground)

---

_Comment by @charliermarsh on 2023-12-08 05:04_

Yup!

<img width="642" alt="Screen Shot 2023-12-08 at 12 04 00 AM" src="https://github.com/astral-sh/ruff/assets/1309177/5e4cd0dc-c90d-4b31-86d3-774a72ede0d3">

<img width="766" alt="Screen Shot 2023-12-08 at 12 04 04 AM" src="https://github.com/astral-sh/ruff/assets/1309177/a92f01be-2e33-4c7a-9ab7-1cd35d38eae0">

<img width="269" alt="Screen Shot 2023-12-08 at 12 04 11 AM" src="https://github.com/astral-sh/ruff/assets/1309177/7c4a588e-762f-4f32-ba56-e941f59b8f8c">


---

_Comment by @kunaltyagi on 2023-12-08 05:06_

I copied my own code instead of trying to re-create

![image](https://github.com/astral-sh/ruff/assets/2657068/b18c0503-2cb8-4a74-94c3-3b7aeccc9eba)


https://play.ruff.rs/70dcf7e0-23f6-40f4-95cf-670b6b713307

---

_Comment by @kunaltyagi on 2023-12-08 05:10_

This is a valid repro, right? üòÖ 

---

_Comment by @dhruvmanila on 2023-12-08 05:11_

This is happening because the `msg` variable is already defined in the current scope and Ruff would generate the fix only if the `msg` variable is available.

---

_Comment by @kunaltyagi on 2023-12-08 05:12_

But that msg is used to raise an error earlier. It's not on any code-path that leads to this error

If I tried accessing msg, I'd get a big fat error

---

_Comment by @kunaltyagi on 2023-12-08 05:14_

https://play.ruff.rs/1feffa3b-9314-481d-ace9-7a15c5c644e2

Thanks to you, I've created another smaller example where msg is not accessible in the code leading to the raise statement

---

_Comment by @dhruvmanila on 2023-12-08 05:19_

> If I tried accessing msg, I'd get a big fat error

You would be getting a runtime error in that case. This is a limitation of every static analysis tools - it's not possible to determine the path the code will take, _statically_.

---

_Comment by @kunaltyagi on 2023-12-08 05:20_

Statically, it's possible to determine if:
1. There's a raise, or return right after the variable
2. The variable is in the literally different part of `if-elif-else`

---

_Comment by @charliermarsh on 2023-12-08 05:25_

Correct but updating the semantic model to support control-flow analysis isn't a current priority. I would say we should just always offer this fix now that it's marked as unsafe anyway.

---

_Comment by @dhruvmanila on 2023-12-08 05:26_

Yeah, seems reasonable to me üëç 

---

_Referenced in [astral-sh/ruff#9059](../../astral-sh/ruff/pulls/9059.md) on 2023-12-08 20:59_

---
