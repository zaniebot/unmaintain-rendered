---
number: 13862
title: SIM115 false positive on functions that return file handler objects
type: issue
state: closed
author: gboeing
labels:
  - bug
  - rule
  - help wanted
assignees: []
created_at: 2024-10-21T15:59:52Z
updated_at: 2024-11-03T19:16:29Z
url: https://github.com/astral-sh/ruff/issues/13862
synced_at: 2026-01-07T12:31:13-06:00
---

# SIM115 false positive on functions that return file handler objects

---

_Issue opened by @gboeing on 2024-10-21 15:59_

ruff 0.7 gives a false positive for SIM115 on something like:

```python
def my_function(filepath, encoding):
    return bz2.open(filepath, mode="rt", encoding=encoding)
```

which can be resolved like:
```python
def my_function(filepath, encoding):
    with bz2.open(filepath, mode="rt", encoding=encoding) as f:
        return f
```

But this prevents the calling function from being able to work with `f` because the context manager has closed it. It seems that SIM115 should not trigger when returning a file handler object from a function?

---

_Comment by @zanieb on 2024-10-21 16:32_

Yeah strong agree that this should not be flagged.

Related https://github.com/astral-sh/ruff/pull/13679#issuecomment-2400078411

---

_Label `bug` added by @zanieb on 2024-10-21 16:32_

---

_Label `rule` added by @zanieb on 2024-10-21 16:32_

---

_Label `help wanted` added by @MichaReiser on 2024-10-21 16:34_

---

_Comment by @AlexWaygood on 2024-10-21 16:47_

I agree that this could be improved. FWIW, though, this is really a pre-existing issue that could occur prior to Ruff 0.7. For example, Ruff 0.1 emits `SIM115` on this code that uses the builtin `open` function:

```py
def my_function(filepath, encoding):
    return open(filepath, mode="rt", encoding=encoding)
```

The only difference in Ruff 0.7 is that the rule is now applied consistently to more stdlib functions that open files, rather than just the builtin `open` function and `pathlib.Path.open`.

---

_Renamed from "SIM115 false positive in 0.7" to "SIM115 false positive on functions that return file handler objects" by @AlexWaygood on 2024-10-21 16:48_

---

_Comment by @AlexWaygood on 2024-10-21 18:33_

> ```python
> def my_function(filepath, encoding):
>     return bz2.open(filepath, mode="rt", encoding=encoding)
> ```

Ideally, of course, rather than writing a wrapper function that _returns_ an open file handle, you'd write a wrapper context manager that _yields_ an open file handle, because then you can be confident that the file will always be closed after you're done with it:

```python
from contextlib import contextmanager

@contextmanager
def my_function(filepath, encoding):
    with bz2.open(filepath, mode="rt", encoding=encoding) as f:
        yield f
```

Enforcing that kind of practice is probably outside the scope of this rule, however.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-11-03 19:00_

---

_Referenced in [astral-sh/ruff#14066](../../astral-sh/ruff/pulls/14066.md) on 2024-11-03 19:00_

---

_Closed by @charliermarsh on 2024-11-03 19:16_

---

_Closed by @charliermarsh on 2024-11-03 19:16_

---

_Referenced in [astral-sh/ruff#14291](../../astral-sh/ruff/issues/14291.md) on 2024-11-12 03:13_

---

_Referenced in [astral-sh/ruff#20581](../../astral-sh/ruff/issues/20581.md) on 2025-09-25 19:48_

---
