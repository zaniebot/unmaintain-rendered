---
number: 2967
title: "[Panic] \"`__future__` imports should be marked as used\""
type: issue
state: closed
author: manueljacob
labels:
  - bug
assignees: []
created_at: 2023-02-16T19:22:15Z
updated_at: 2023-02-16T22:56:05Z
url: https://github.com/astral-sh/ruff/issues/2967
synced_at: 2026-01-07T12:31:12-06:00
---

# [Panic] "`__future__` imports should be marked as used"

---

_Issue opened by @manueljacob on 2023-02-16 19:22_

The following code was reduced from some output of pytype:

```python
import __future__
annotations: __future__._Feature
```

It crashes:

```
thread 'main' panicked at 'internal error: entered unreachable code: `__future__` imports should be marked as used', crates/ruff/src/rules/flake8_type_checking/rules/typing_only_runtime_import.rs:189:35
```

I tested it with ruff 0.0.247.

---

_Comment by @charliermarsh on 2023-02-16 19:36_

Oh interesting! Will fix. What is this code doing? Trying to parse it myself.

---

_Label `bug` added by @charliermarsh on 2023-02-16 19:37_

---

_Comment by @charliermarsh on 2023-02-16 19:37_

Oh, or is this not _Python_ code, but code _generated_ by Pytype per #2967?

---

_Comment by @manueljacob on 2023-02-16 20:22_

Yes, the code is generated by pytype and put in the `.pytype` directory. With #2966, this is not a problem for me anymore, but I think it should still not panic.

---

_Comment by @charliermarsh on 2023-02-16 20:23_

Hah, that's true :)

---

_Comment by @charliermarsh on 2023-02-16 20:23_

I can fix.

---

_Comment by @charliermarsh on 2023-02-16 20:28_

Do you mind posting the complete file, command, and pyproject.toml? Somehow not reproducing with `ruff --isolated --select ALL` on that snippet.

---

_Comment by @manueljacob on 2023-02-16 20:36_

File:
```python
import __future__
annotations: __future__._Feature
```

Ruff command: `ruff utils.pyi --isolated --select TCH001`
But `ruff --isolated --select ALL utils.pyi` panics as well.

No `pyproject.toml`.

I build ruff from the `main` branch in the meantime, to check if I can reproduce it with that.

---

_Comment by @manueljacob on 2023-02-16 21:04_

It fails for me on the main branch.

---

_Comment by @charliermarsh on 2023-02-16 22:44_

Ah it depends on the `.pyi` suffix (since that enables deferred annotation handling).

---

_Referenced in [astral-sh/ruff#2974](../../astral-sh/ruff/pulls/2974.md) on 2023-02-16 22:48_

---

_Closed by @charliermarsh on 2023-02-16 22:56_

---
