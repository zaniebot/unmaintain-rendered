---
number: 17202
title: "[red-knot] `is_subtype_of` no longer implies `is_assignable_to` for all `Type::Tuple` types"
type: issue
state: closed
author: github-actions
labels:
  - bug
  - testing
  - ty
assignees: []
created_at: 2025-04-04T12:13:10Z
updated_at: 2025-04-04T20:00:30Z
url: https://github.com/astral-sh/ruff/issues/17202
synced_at: 2026-01-07T12:31:13-06:00
---

# [red-knot] `is_subtype_of` no longer implies `is_assignable_to` for all `Type::Tuple` types

---

_Issue opened by @github-actions on 2025-04-04 12:13_

Failing property-test run listed here: https://github.com/astral-sh/ruff/actions/runs/14265011645

---

_Label `bug` added by @github-actions[bot] on 2025-04-04 12:13_

---

_Label `red-knot` added by @github-actions[bot] on 2025-04-04 12:13_

---

_Label `testing` added by @github-actions[bot] on 2025-04-04 12:13_

---

_Comment by @AlexWaygood on 2025-04-04 12:38_

```
failures:

---- types::property_tests::stable::all_type_pairs_are_assignable_to_their_union stdout ----

thread 'types::property_tests::stable::all_type_pairs_are_assignable_to_their_union' panicked at /home/runner/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (AlwaysFalsy, Tuple([]))
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

---- types::property_tests::stable::subtype_of_implies_assignable_to stdout ----

thread 'types::property_tests::stable::subtype_of_implies_assignable_to' panicked at /home/runner/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/quickcheck-1.0.3/src/tester.rs:165:28:
[quickcheck] TEST FAILED. Arguments: (Tuple([]), AlwaysFalsy)
```

@sharkdp I think this may be due to the changes we made to `Type::is_assignable_to` in https://github.com/astral-sh/ruff/pull/17168...?

---

_Comment by @sharkdp on 2025-04-04 13:01_

> [@sharkdp](https://github.com/sharkdp) I think this may be due to the changes we made to `Type::is_assignable_to` in [#17168](https://github.com/astral-sh/ruff/pull/17168)...?

That seems likely, thank you for the ping. I will look into it.

---

_Comment by @AlexWaygood on 2025-04-04 13:06_

haven't tested it, but I think this might fix things:

```diff
diff --git a/crates/red_knot_python_semantic/src/types.rs b/crates/red_knot_python_semantic/src/types.rs
index 4f89feb57..17a43a519 100644
--- a/crates/red_knot_python_semantic/src/types.rs
+++ b/crates/red_knot_python_semantic/src/types.rs
@@ -1071,9 +1071,12 @@ impl<'db> Type<'db> {
             // This special case is required because the left-hand side tuple might be a
             // gradual type, so we can not rely on subtyping. This allows us to assign e.g.
             // `tuple[Any, int]` to `tuple`.
-            (Type::Tuple(_), _) => KnownClass::Tuple
-                .to_instance(db)
-                .is_assignable_to(db, target),
+            (Type::Tuple(_), _) => {
+                self.is_subtype_of(db, target)
+                    || KnownClass::Tuple
+                        .to_instance(db)
+                        .is_assignable_to(db, target)
+            }
 
             // `type[Any]` is assignable to any `type[...]` type, because `type[Any]` can
             // materialize to any `type[...]` type.
```

though there may also be a more elegant or more efficient solution.

---

_Renamed from "Daily property test run failed on Fri Apr 04 2025" to "[red-knot] `is_subtype_of` no longer implies `is_assignable_to` for all `Type::Tuple` types" by @AlexWaygood on 2025-04-04 13:22_

---

_Assigned to @sharkdp by @sharkdp on 2025-04-04 19:04_

---

_Referenced in [astral-sh/ruff#17213](../../astral-sh/ruff/pulls/17213.md) on 2025-04-04 19:22_

---

_Closed by @sharkdp on 2025-04-04 20:00_

---

_Closed by @sharkdp on 2025-04-04 20:00_

---
