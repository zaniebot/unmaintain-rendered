---
number: 6431
title: Formatter adds unnecessary parentheses around return type annotations
type: issue
state: closed
author: charliermarsh
labels:
  - formatter
assignees: []
created_at: 2023-08-08T19:05:58Z
updated_at: 2023-08-16T07:11:14Z
url: https://github.com/astral-sh/ruff/issues/6431
synced_at: 2026-01-07T12:31:12-06:00
---

# Formatter adds unnecessary parentheses around return type annotations

---

_Issue opened by @charliermarsh on 2023-08-08 19:05_

Contrived example:

```python
def handleMatch(self, m: Match[str], data: str) -> Union[Tuple[None, None, None], Tuple[None, None, None], Tuple[Element, int, int], Tuple[Element, int, int]]:
    pass
```

Ruff:

```python
def handleMatch(self, m: Match[str], data: str) -> (
    Union[
        Tuple[None, None, None],
        Tuple[None, None, None],
        Tuple[Element, int, int],
        Tuple[Element, int, int],
    ]
):
    pass
```

Black:

```python
def handleMatch(
    self, m: Match[str], data: str
) -> Union[
    Tuple[None, None, None],
    Tuple[None, None, None],
    Tuple[Element, int, int],
    Tuple[Element, int, int],
]:
    pass
```

---

_Label `formatter` added by @charliermarsh on 2023-08-08 19:06_

---

_Comment by @charliermarsh on 2023-08-08 19:06_

(This issue is just about the parentheses around the `Union` in the Ruff case; ignore the breaking of the parameters.)

---

_Comment by @MichaReiser on 2023-08-08 19:53_

Is this specific to subscripts in type positions? E.g how does black break if you put a similar expression into an of condition?

---

_Comment by @charliermarsh on 2023-08-08 20:06_

Do you mean "or" condition, like this?

```python
Union[Tuple[None, None, None], Tuple[None, None, None], Tuple[Element, int, int], Tuple[Element, int, int]] or True
```

Ruff:
```python
Union[
    Tuple[None, None, None],
    Tuple[None, None, None],
    Tuple[Element, int, int],
    Tuple[Element, int, int],
] or True
```

Black:
```python
Union[
    Tuple[None, None, None],
    Tuple[None, None, None],
    Tuple[Element, int, int],
    Tuple[Element, int, int],
] or True
```

---

_Comment by @charliermarsh on 2023-08-08 21:21_

It looks like this behavior only kicks in if the parameters breaks ([playground](https://black.vercel.app/?version=main&state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AO6AKNdAD2IimZxl1N_WlbvK5WAyg6q-gZl1JqaLLCTCBcrOc_jKAgkaYzQZkMnSiPEI9QFGxRWi8ZRO_zphAO9dYnWK6C4U1JOnXyslDiEeN4vXuNQ727NsSHJ31rsleEN9NDwCw75Lmu5ObLJf4kx9pWIIKZ0OCxOkNQYtKQ1_gtbYWo5GNgoMQh7elIXvaw774P8Hs8NYRVfF1XJn6oDIv5gHdtDjgAAALI5cbmARo3AAAG_AbsHAADTg5XascRn-wIAAAAABFla)).

---

_Comment by @charliermarsh on 2023-08-08 21:47_

(No need to engage here until I understand the behavior, I am reading the Black source.)

---

_Referenced in [astral-sh/ruff#6436](../../astral-sh/ruff/pulls/6436.md) on 2023-08-09 04:15_

---

_Assigned to @charliermarsh by @charliermarsh on 2023-08-09 04:18_

---

_Closed by @charliermarsh on 2023-08-11 18:19_

---

_Added to milestone `Formatter: Alpha` by @MichaReiser on 2023-08-16 07:11_

---
