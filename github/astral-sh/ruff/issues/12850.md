---
number: 12850
title: "Rule request: enforce best practices when mocking"
type: issue
state: open
author: mgaitan
labels:
  - plugin
  - needs-decision
assignees: []
created_at: 2024-08-12T19:15:05Z
updated_at: 2024-08-13T08:50:04Z
url: https://github.com/astral-sh/ruff/issues/12850
synced_at: 2026-01-07T12:31:13-06:00
---

# Rule request: enforce best practices when mocking

---

_Issue opened by @mgaitan on 2024-08-12 19:15_

I'd like to propose the integration of `flake8-patch` like rule/s  into `ruff` to help enforce best practices when mocking in Python tests.

In a legacy codebase, we've encountered issues where direct monkeypatching  leads to tests that do not properly clean up after themselves. This can result in flaky tests that pass or fail depending on the order of execution. For example, we had the following pattern:

```python
Shipment.get_label_info = mocker.Mock()
Shipment.get_label_info.return_value = (None, tracking_url, None)
```

This approach led to issues in teardown, as the mock was not automatically undone. We switched to using `mocker.patch.object()`:

```python
mocker.patch.object(Shipment, "get_label_info", return_value=(None, tracking_url, None))
```

This approach ensures that the patch is properly removed after the test.


The [flake8-patch](https://pypi.org/project/flake8-patch/) plugin helps identify improper mocking practices, such as direct assignment to imported objects, which can cause tests to be unreliable. Integrating similar functionality into `ruff` would allow us to catch these issues early in the development process. 

---

_Label `plugin` added by @dhruvmanila on 2024-08-13 08:50_

---

_Label `needs-decision` added by @dhruvmanila on 2024-08-13 08:50_

---

_Referenced in [astral-sh/ruff#17352](../../astral-sh/ruff/issues/17352.md) on 2025-04-15 02:58_

---
