---
number: 7891
title: ruff fix on UP032 breaks applied code when f-string is too long
type: issue
state: closed
author: Grosskopf
labels:
  - bug
assignees: []
created_at: 2023-10-10T12:34:35Z
updated_at: 2023-10-10T16:31:11Z
url: https://github.com/astral-sh/ruff/issues/7891
synced_at: 2026-01-07T12:31:12-06:00
---

# ruff fix on UP032 breaks applied code when f-string is too long

---

_Issue opened by @Grosskopf on 2023-10-10 12:34_

Hi, I'm not sure where I should post this error but I have a weird chain reaction of errors that result in ruff breaking my code.

The following code results in a UP032 Error:
```python
from django.utils.translation import gettext

long = 'long'
split_to = 'split_to'
gettext(
    'some super {} and complicated string so that the error code '
    'E501 Triggers when this is not {} multi-line'.format(
        long, split_to)
)

```
when I then run `ruff --fix` on it I get

```python
from django.utils.translation import gettext

long = 'long'
split_to = 'split_to'
gettext(
    f'some super {long} and complicated string so that the error code '
    f'E501 Triggers when this is not {split_to} multi-line'
)

```
This would be perfect, I love the style of code, but there is a problem, this code does not work.
When I then go ahead and run makemessages as usual, the text generated from this is
`some super {long} and complicated string so that the error code ` and the second line is lost

Should I report this upstream at Django or at python? I would prefer if this would work but sadly this is a rare edge case where ruff --fix breaks code.

this happens on ruff 0.0.290

---

_Comment by @charliermarsh on 2023-10-10 16:05_

It looks like `gettext` does not yet support f-strings, per the [Django docs](https://docs.djangoproject.com/en/4.2/topics/i18n/translation/#troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs):

<img width="620" alt="Screen Shot 2023-10-10 at 12 05 33 PM" src="https://github.com/astral-sh/ruff/assets/1309177/8bb35be1-f657-4da8-ab3a-7f5c33a54f78">

We can avoid suggesting this in Ruff, for `gettext` calls...


---

_Label `bug` added by @charliermarsh on 2023-10-10 16:05_

---

_Assigned to @charliermarsh by @charliermarsh on 2023-10-10 16:18_

---

_Referenced in [astral-sh/ruff#7898](../../astral-sh/ruff/pulls/7898.md) on 2023-10-10 16:21_

---

_Closed by @charliermarsh on 2023-10-10 16:31_

---
