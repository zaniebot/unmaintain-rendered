---
number: 17118
title: Add rule to only allow specific top-level imports
type: issue
state: open
author: ofek
labels:
  - rule
  - needs-decision
assignees: []
created_at: 2025-04-01T12:36:55Z
updated_at: 2025-07-24T15:51:06Z
url: https://github.com/astral-sh/ruff/issues/17118
synced_at: 2026-01-07T12:31:13-06:00
---

# Add rule to only allow specific top-level imports

---

_Issue opened by @ofek on 2025-04-01 12:36_

### Summary

We would like a rule similar to [TID253](https://docs.astral.sh/ruff/rules/banned-module-level-imports/) but that has an option where you supply a list of packages (e.g. `["foo", "bar.baz"]` that are allowed to be imported at the top level and everything else would produce an error. Inclusion should not allow subpackages e.g. configuring `foo` would not grant privilege to `foo.bar` and dotted paths should grant privilege to parents e.g. `bar` is okay if `bar.baz` is configured.

This would benefit applications (CLIs and serverless) that enforce the near-ubiquitous use of lazy module loading but wish to allow known fast imports such as `os` or imports that are known to always occur anyway.

I would recommend always allowing `__future__` and `typing` no matter what the user defines.

---

_Label `rule` added by @MichaReiser on 2025-04-01 12:39_

---

_Comment by @mikeshardmind on 2025-04-01 14:09_

allowing `typing` as a top level here in spite of what a user configures would cause this to be an unusable rule for me. Typing is a slow import and is one of the ones I take [extra steps to avoid eagerly importing](https://github.com/mikeshardmind/async-utils/blob/main/src/async_utils/_typings.py) that are significantly faster.

I think I agree about `__future__`


---

_Comment by @ofek on 2025-04-01 14:56_

The trade-off here is that every user of this rule who happens to use type hints (likely the vast majority) will be always forced to add `typing` to their list of allowed packages/modules because that is always a top-level import since `if TYPE_CHECKING:` couldn't go anywhere else. However, given we now have [PEP 781](https://peps.python.org/pep-0781/) which will probably be accepted then perhaps what you're saying is more future proof.

---

_Comment by @mikeshardmind on 2025-04-01 15:16_

Maybe this rule could have a configuration that defaults to true if 781 is accepted that implicitly allows `typing` within the true branch of `if TYPE_CHECKING:` (or whatever the symbol ends up being) and can be extended with other typing-only allowed imports?

---

_Comment by @ofek on 2025-04-01 15:54_

I like that!

---

_Comment by @MichaReiser on 2025-04-01 16:14_

I'm not sure I fully follow but I'm hesitant to requiring another option only to avoid adding `typing` to another setting

---

_Comment by @ofek on 2025-04-01 16:21_

What Mike is saying, the part that I'm also in favor of, would be that if PEP 781 is accepted that `typing` would be allowed within `if TYPE_CHECKING:` blocks no matter what the user configures.

---

_Comment by @ofek on 2025-04-02 15:51_

@MichaReiser What do you think about adding the `help wanted` label to encourage contributions since the logic is mostly already implemented via that other rule?

---

_Label `needs-decision` added by @MichaReiser on 2025-04-02 16:03_

---

_Comment by @ofek on 2025-04-15 17:06_

Until this is implemented I added a note in our documentation: https://datadoghq.dev/datadog-agent-dev/guidelines/cli/#lazy-imports

Hopefully our CLI's overall responsiveness doesn't regress by then ðŸ˜… 

---

_Comment by @ofek on 2025-07-24 15:36_

Has there been any progress on this?

---

_Comment by @MichaReiser on 2025-07-24 15:51_

No. We'll post here if there is

---
