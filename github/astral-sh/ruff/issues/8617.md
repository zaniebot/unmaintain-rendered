---
number: 8617
title: Q000 fixer does not remove obsolete backslash-escape inside string after changing quotes
type: issue
state: closed
author: ThiefMaster
labels:
  - bug
  - wish
assignees: []
created_at: 2023-11-11T13:52:15Z
updated_at: 2023-11-13T21:59:39Z
url: https://github.com/astral-sh/ruff/issues/8617
synced_at: 2026-01-07T12:31:12-06:00
---

# Q000 fixer does not remove obsolete backslash-escape inside string after changing quotes

---

_Issue opened by @ThiefMaster on 2023-11-11 13:52_

ruff.toml:
```toml
select = ['Q']

[flake8-quotes]
inline-quotes = 'single'
multiline-quotes = 'single'
docstring-quotes = 'double'
avoid-escape = true
```

Code:
```python
a = "hello\"world"
```

ruff output:
```
[adrian@claptrap:/tmp/rufftest]> ~/dev/ruff/target/release/ruff check --no-cache test.py
test.py:1:5: Q000 [*] Double quotes found but single quotes preferred
Found 1 error.
[*] 1 fixable with the `--fix` option.
```


And after running with `--fix` added:

```python
a = 'hello\"world'
```

While not invalid, this is ugly - in particular since `avoid-escape` is enabled. It should have been this:

```python
a = 'hello"world'
```

---

_Referenced in [astral-sh/ruff#8616](../../astral-sh/ruff/issues/8616.md) on 2023-11-11 13:52_

---

_Label `rule` added by @charliermarsh on 2023-11-11 14:52_

---

_Comment by @charliermarsh on 2023-11-11 14:52_

Agreed, it makes sense to remove redundant escapes when converting quote styles.

(I consider this low-priority since we're more focused on string normalization in the formatter, but I would gladly accept a contribution here.)


---

_Label `rule` removed by @charliermarsh on 2023-11-11 14:53_

---

_Label `bug` added by @charliermarsh on 2023-11-11 14:53_

---

_Label `wish` added by @charliermarsh on 2023-11-11 14:56_

---

_Comment by @ThiefMaster on 2023-11-11 14:57_

I would gladly use the formatter if it had an option to only apply certain changes (such as quote style) since I really do not like what black does to my codebase, so I don't think I'd want to use the ruff formatter either. :/

For implementing a fix, would you do it as part of this fixer of as a new rule (if yes: where, since it's not in the original flake8-quotes) that only looks at unnecessary escapes in a string?

---

_Comment by @charliermarsh on 2023-11-11 15:02_

I hear you! While I don't share that opinion for my own code :) I do understand why saying "Just use the formatter" doesn't close out the issue. I'm more just trying to convey that for our own prioritization, we're more focused on improving the formatter's string normalization than investing further in the linter's string-formatting rules (right now, we basically have to maintain these two separate implementations).

I think easiest would be to add a new rule to the `Q` set to detect unnecessary escape quotes. We could _also_ change the existing `Q` rules to take unnecessary escapes into account, but it wouldn't be strictly necessary, since the new rule would fix any unnecessary escapes after the outer quote conversion.

---

_Referenced in [astral-sh/ruff#8630](../../astral-sh/ruff/pulls/8630.md) on 2023-11-12 16:48_

---

_Closed by @charliermarsh on 2023-11-13 21:59_

---
