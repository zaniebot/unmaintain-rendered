---
number: 17117
title: Don’t flag “await outside async function” for notebooks
type: issue
state: closed
author: ctcjab
labels:
  - needs-info
  - notebook
assignees: []
created_at: 2025-04-01T12:25:26Z
updated_at: 2025-04-28T08:31:37Z
url: https://github.com/astral-sh/ruff/issues/17117
synced_at: 2026-01-07T12:31:13-06:00
---

# Don’t flag “await outside async function” for notebooks

---

_Issue opened by @ctcjab on 2025-04-01 12:25_

### Summary

We have a monorepo set up for all the notebooks at our firm and are using Jupytext to keep those notebooks in version control as .py files rather than .ipynb files. (This setup isn’t all that uncommon when keeping notebooks in version control.) 

In Jupyter notebooks, [await outside async function](https://docs.astral.sh/ruff/rules/await-outside-async/) is not an error, but ruff is flagging it as such. What do you think of having logic in ruff to detect if a .py file is actually a Jupytext notebook (straightforward to detect via the telltale Jupytext metadata comment at the top of the file), and automatically ignore rules that don’t apply to notebooks in this case?

Thanks for your consideration and for the amazing work on ruff ❤️


---

_Comment by @ctcjab on 2025-04-01 12:27_

Note, this issue is compounded for us by https://github.com/python-lsp/python-lsp-ruff/issues/102 — We can’t currently configure ruff to ignore this rule for all notebooks in our monorepo via a ruff.toml at the root of the repo due to that bug. 

---

_Comment by @MichaReiser on 2025-04-01 12:32_

The rule documentation suggests that this is already the case for notebooks (`.ipynb`). Do you use a different file extension? 

> As an exception, await is allowed at the top level of a Jupyter notebook (see: [autoawait](https://ipython.readthedocs.io/en/stable/interactive/autoawait.html)).

CC: @ntBre because this might be important for your syntax work

---

_Label `needs-info` added by @MichaReiser on 2025-04-01 12:32_

---

_Comment by @ntBre on 2025-04-01 12:34_

I think they're using .py files, which explains the issue.

> using Jupytext to keep those notebooks in version control as .py files rather than .ipynb files

I thought we had a setting for specifying other extensions as notebooks, but I can't find it now. That's not as nice as auto-detection, but it could help.

---

_Comment by @MichaReiser on 2025-04-01 12:41_

> I thought we had a setting for specifying other extensions as notebooks, but I can't find it now. That's not as nice as auto-detection, but it could help.

I think it's CLI only, see `--extensions` 

This is probably a duplicate of https://github.com/astral-sh/ruff/issues/8800


---

_Referenced in [python-lsp/python-lsp-ruff#102](../../python-lsp/python-lsp-ruff/issues/102.md) on 2025-04-01 14:45_

---

_Label `notebook` added by @AlexWaygood on 2025-04-02 09:25_

---

_Closed by @MichaReiser on 2025-04-28 08:31_

---

_Referenced in [astral-sh/ruff#8800](../../astral-sh/ruff/issues/8800.md) on 2025-04-29 17:35_

---
