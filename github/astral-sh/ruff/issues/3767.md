---
number: 3767
title: F403 false positive with native module
type: issue
state: open
author: konstin
labels:
  - bug
assignees: []
created_at: 2023-03-28T12:34:50Z
updated_at: 2023-08-28T14:33:25Z
url: https://github.com/astral-sh/ruff/issues/3767
synced_at: 2026-01-07T12:31:12-06:00
---

# F403 false positive with native module

---

_Issue opened by @konstin on 2023-03-28 12:34_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

`F403` is falsely shown even if there is a native module that can be imported from, in the case of the [reproducer](https://github.com/konstin/F403-false-positive-with-native-module) on `from .reproducer import *` where `reproducer.abi3.so` exists:

```shell
git clone 
pip install ruff==0.0.259 "maturin>=0.14,<0.15"
maturin develop
```

```
$ tree python
tree python
python
└── reproducer
    ├── __init__.py
    └── reproducer.abi3.so

1 directory, 2 files
```

The ` python/reproducer/__init__.py `:

```
from .reproducer import *
```

Running ruff with default settings on this:

```
$ ruff .
python/reproducer/__init__.py:1:1: F403 `from .reproducer import *` used; unable to detect undefined names
Found 1 error.
```




---

_Label `question` added by @charliermarsh on 2023-03-28 15:07_

---

_Comment by @charliermarsh on 2023-03-28 15:08_

I think this is "correct" since `F403` just flags _all_ `*` imports -- that is, it effectively enforces that users don't use `*` imports at all. Maybe it's the message that's unclear?

---

_Comment by @konstin on 2023-03-28 15:43_

Yes that definitely the message that is unclear. To a lesser extend it's also that this file is just a reexport (there are no usages in this file) and an on-by-default lint shouldn't flag those, but i'm not sure how to separate them from actual F403 cases

---

_Comment by @charliermarsh on 2023-05-18 15:27_

Pyright's resolver is able to detect that an import is a native, I think. So, should we add a proper resolver, we should be able to avoid these.

---

_Label `question` removed by @charliermarsh on 2023-07-10 01:17_

---

_Label `bug` added by @charliermarsh on 2023-07-10 01:17_

---

_Comment by @charliermarsh on 2023-07-27 13:31_

Why is it common to use wildcard imports with native modules?

---

_Comment by @konstin on 2023-07-27 15:10_

One part is that we want to have the native module in a module itself, both because it's cleaner than a top level native module when installed and because we want to add stub files and/or `py.typed` in that directory (type hints from within pyo3 or raw C bindings is an unsolved problem), the other part is that we want to have the functions and classes on the top level of the module (i.e. we need to reexport all symbols). Listing all symbols explicitly is hard since we would need to load the library.

---

_Comment by @nerdoc on 2023-08-28 08:10_

It is possible to add a `# noqa: F403` to each line, but this seems to be ridiculous, as it adds much clutter.
What could help maybe is to add a "file scoped" F403 exception - would that be possible - for those __init__ files which only purpose is to reexport symbols, this could be a solution.

---

_Comment by @charliermarsh on 2023-08-28 14:33_

You can automatically ignore `F403` in all `__init__.py` files like:

```toml
[tool.ruff.per-file-ignores]
"__init__.py" = ["F403"]
```

Or, you can add this to the top of your `__init__.py` file:

```python
# ruff: noqa: F403
```

---
