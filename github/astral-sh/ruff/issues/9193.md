---
number: 9193
title: "`ruff check . --fix` incorrectly fixes `from urllib import request`"
type: issue
state: open
author: discentem
labels:
  - bug
assignees: []
created_at: 2023-12-18T20:15:50Z
updated_at: 2024-01-16T04:02:12Z
url: https://github.com/astral-sh/ruff/issues/9193
synced_at: 2026-01-07T12:31:12-06:00
---

# `ruff check . --fix` incorrectly fixes `from urllib import request`

---

_Issue opened by @discentem on 2023-12-18 20:15_

Please let me know if you need any further information. This is my first time submitting an issue and using Ruff!


## Description of issue:

Ruff detects that 

```
`urllib.request` imported but unused
```

but it is being used by 

```
urllib.request.Request
```

According to my research technically this is user error. 

```
from urllib import request
```

should be 

```
import urllib.request
```

**tl:dr**

but I'm wondering: should Ruff be able to detect this situation and either (a) ignore `--fix` if Ruff is actually unable to fix without breaking or (b) perform the fix correctly? 


### A minimal code snippet that reproduces the bug.

```python
discentem@laptop ruff_testing % python3 thing.py 
<urllib.request.Request object at 0x1027e2490>
discentem@laptop ruff_testing % cat thing.py 
import urllib
from urllib import request

print(urllib.request.Request("https://google.com"))
discentem@laptop ruff_testing % ruff check .
thing.py:2:20: F401 [*] `urllib.request` imported but unused
Found 1 error.
[*] 1 fixable with the `--fix` option.
discentem@laptop ruff_testing % ruff check . --fix
Found 1 error (1 fixed, 0 remaining).
discentem@laptop ruff_testing % cat thing.py      
import urllib

print(urllib.request.Request("https://google.com"))
discentem@laptop ruff_testing % python3 thing.py 
Traceback (most recent call last):
  File "/Users/discentem/ruff_testing/thing.py", line 3, in <module>
    print(urllib.request.Request("https://google.com"))
          ^^^^^^^^^^^^^^
AttributeError: module 'urllib' has no attribute 'request'
```

### The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.

`ruff check . --fix`

### The current Ruff settings (any relevant sections from your `pyproject.toml`).

n/a, there is no pyproject.toml in this minimal example

### The current Ruff version (`ruff --version`).

```
ruff 0.1.5
```


---

_Comment by @charliermarsh on 2023-12-18 22:04_

Submodule imports (like `import urllib.request`) are pretty tricky! They _tend_ to work, but there are a few exceptions (like you're seeing here) that can only be determined via knowledge of the underlying module design (IIUC). For example, this works fine:

```python
>>> import os
>>> os.path.expanduser
<function expanduser at 0x101007490>
```

If you _just_ use `import urllib.request`, you should be fine. But we should consider special-casing `urllib` and other standard-library modules that use this unusual approach.

---

_Comment by @discentem on 2023-12-18 22:53_

Thanks for the quick reply! Feel free to close if you want to consider this PEBKAC but if it's tenable for Ruff to handle this special-case for urllib and other stdlib modules that'd be great! 

---

_Label `bug` added by @charliermarsh on 2024-01-02 18:13_

---

_Comment by @eli-schwartz on 2024-01-16 04:00_

I'm not sure I understand what's tricky or an unusual approach here?

```
import urllib
from urllib import request

urllib.request.Request
```

The issue here is that unlike os.path, you do have to load both `sys.modules['urllib']` and `sys.modules['urllib.request']` separately -- the former won't automatically import the latter.

Using `from urllib import request` both adds the second sys.modules entry, adding "request" as a property of the "urllib" module, and binds the "request" name -- which is genuinely unused.

Any package with a submodule or subpackage will do this, it's not an urllib thing.

You can automatically detect the overall pattern (`import a; from a import b; a.b.c()`) by assuming that `a.b.c` has a "probably" dependency on `a.b`, making it unsafe to remove the import:
- `a.b` *could* be a submodule
- or it *could* be a class where `a.b.c` is a class staticmethod

and in the former case the import can and should be rewritten to `import a.b` and in the latter case rewriting the import would be a fatal error (and deleting it is fine).

---

_Referenced in [astral-sh/ruff#10674](../../astral-sh/ruff/issues/10674.md) on 2024-03-30 23:12_

---
