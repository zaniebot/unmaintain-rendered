---
number: 7446
title: PERF403 potential false positive
type: issue
state: closed
author: LefterisJP
labels: []
assignees: []
created_at: 2023-09-16T20:32:36Z
updated_at: 2023-09-19T03:18:57Z
url: https://github.com/astral-sh/ruff/issues/7446
synced_at: 2026-01-07T12:31:12-06:00
---

# PERF403 potential false positive

---

_Issue opened by @LefterisJP on 2023-09-16 20:32_

I enabled `--preview` with version `0.0.290` and got an interesting hit for `PERF403`.

Code looks kind of like this:

```python
mapping = {}

animals = ['dog', 'cat', 'bird', 'elephant']
other_mapping = {'snake': 69, 'owl': 42}

for idx, animal in enumerate(animals):
    if animal == 'elephant':
        continue
    mapping[animal] = idx

for animal, idx in other_mapping.items():
    mapping[animal] = idx

print(mapping)
```

And this will hit `PERF403` asking to use dict comprehension where we do

```python
for animal, idx in other_mapping.items():
    mapping[animal] = idx
```

The only dict comprehension I can imagine is 

```python
mapping = {animal: idx for animal, idx in other_mapping.items()}
```

Which will not do what we want.

Using

```python
mapping.update(other_mapping)
```

Will work instead. But then in this case isn't the `PERF403` hit here a false positive?

---

_Comment by @charliermarsh on 2023-09-16 20:50_

I think the rule generally wants you to do `mapping.update({animal: idx for animal, idx in other_mapping.items()})` here. We should probably have a separate rule that detects that `{animal: idx for animal, idx in other_mapping.items()}` is an unnecessary comprehension though, and then further corrects to `mapping.update(other_mapping)`.

---

_Comment by @charliermarsh on 2023-09-16 20:57_

It looks like C416 will further correct that to:

```python
mapping.update(dict(other_mapping.items()))
```

Which is close...

---

_Comment by @charliermarsh on 2023-09-19 03:18_

Closing for now as I think `mapping.update` is the intended solution.

---

_Closed by @charliermarsh on 2023-09-19 03:18_

---
