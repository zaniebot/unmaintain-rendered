---
number: 3472
title: "Bug - Cannot ignore `TCH004` via config file"
type: issue
state: closed
author: Kilo59
labels:
  - bug
assignees: []
created_at: 2023-03-13T01:14:35Z
updated_at: 2023-03-14T20:24:02Z
url: https://github.com/astral-sh/ruff/issues/3472
synced_at: 2026-01-07T12:31:12-06:00
---

# Bug - Cannot ignore `TCH004` via config file

---

_Issue opened by @Kilo59 on 2023-03-13 01:14_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->
Ignoring `TCH004` in the configuration file has no effect. This seems to be true for `ruff.toml` and `pyproject.toml` files.

Suppressing in-line with `# noqa: TCH004` works fine.
Ignoring other `TCH**` rules seems to work fine.

```
ruff 0.0.254
```

```toml
# ruff.toml
select = ["TCH"]
ignore = ["TCH004"]
```

```python
# my_script.py
from typing import TYPE_CHECKING, Union

try:
    import numpy as np
except ImportError:
    np = None


if TYPE_CHECKING:
    import numpy as np


# Note: without postponed annotations, this will fail at runtime
def my_func(a: Union[float, np.float64], b: Union[float, np.float64]):
    return a + b
```

```
❯ ruff my_script.py
my_script.py:10:12: TCH004 Move import `numpy` out of type-checking block. Import is used for more than type hinting.
Found 1 error.
```

☝️ I would expect to get no errors above due to the config ignore of `TCH004`


---

_Renamed from "Bug - Cannot ignore `TCH004`" to "Bug - Cannot ignore `TCH004` via config file" by @Kilo59 on 2023-03-13 01:15_

---

_Comment by @charliermarsh on 2023-03-13 02:15_

Just a bug, fixing...

---

_Assigned to @charliermarsh by @charliermarsh on 2023-03-13 02:15_

---

_Label `bug` added by @charliermarsh on 2023-03-13 02:15_

---

_Referenced in [astral-sh/ruff#3474](../../astral-sh/ruff/pulls/3474.md) on 2023-03-13 02:16_

---

_Closed by @charliermarsh on 2023-03-13 02:23_

---

_Referenced in [great-expectations/great_expectations#7349](../../great-expectations/great_expectations/pulls/7349.md) on 2023-03-14 18:02_

---

_Referenced in [astral-sh/ruff#5787](../../astral-sh/ruff/issues/5787.md) on 2023-07-15 20:35_

---
