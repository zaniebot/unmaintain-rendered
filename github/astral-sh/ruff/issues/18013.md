---
number: 18013
title: Duplicate match case
type: issue
state: open
author: JelleZijlstra
labels:
  - rule
assignees: []
created_at: 2025-05-11T03:03:16Z
updated_at: 2025-05-11T07:10:08Z
url: https://github.com/astral-sh/ruff/issues/18013
synced_at: 2026-01-07T12:31:13-06:00
---

# Duplicate match case

---

_Issue opened by @JelleZijlstra on 2025-05-11 03:03_

### Summary

I'd like Ruff to warn on code like this:

```
def f(x: object):
    match x:
        case int():
            pass
        case int():
            pass
```

I was writing a match like this involving a lot of types, and I'm worried I'll duplicate a case, which would make the second case silently not execute.

A type checker could discover this problem somewhat naturally, but at the moment none of mypy, pyright, or ty detect this. (The algorithm is something like: start the type of the match subject as T. After every case matching to a type M, update it to `T & ~M`, taking into account previous narrowings. Within each match block, narrow it down to `T & M`, and warn if that intersection becomes Never.)

In a linter, the heuristic for this rule could be that the AST of a match case is identical to that of a previous case. You'd want to include any `if` guards in the match, but exclude `as` clauses, and distribute `|` patterns at the top level.

---

_Comment by @AlexWaygood on 2025-05-11 07:07_

ty seems to be the type checker that gets closest here, FWIW! Unlike mypy, pyright and pyrefly, we correctly reveal `Never` for the second branch here:

```py
def f(x: object):
    match x:
        case int():
            reveal_type(x)  # int
        case int():
            reveal_type(x)  # Never
```

https://play.ty.dev/590ff49f-44cf-4c55-8a3b-b732910222e6

the only bit we don't do is this second part:

> warn if that intersection becomes Never

We'd probably want to do that as part of a general ty lint that warns about unintentionally unreachable blocks of code. But that requires some design work before we can implement it for ty, and it isn't an immediate priority for us. In the meantime, a lint rule like the one you suggest seems like a reasonable suggestion to me.

---

_Label `rule` added by @AlexWaygood on 2025-05-11 07:07_

---

_Referenced in [astral-sh/ruff#21690](../../astral-sh/ruff/issues/21690.md) on 2025-11-30 12:02_

---
