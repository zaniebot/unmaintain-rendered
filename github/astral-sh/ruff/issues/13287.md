---
number: 13287
title: "[F821] Improve error message for `anext`/`aiter`"
type: issue
state: closed
author: JP-Ellis
labels:
  - rule
assignees: []
created_at: 2024-09-09T01:41:28Z
updated_at: 2024-09-10T18:05:37Z
url: https://github.com/astral-sh/ruff/issues/13287
synced_at: 2026-01-07T12:31:13-06:00
---

# [F821] Improve error message for `anext`/`aiter`

---

_Issue opened by @JP-Ellis on 2024-09-09 01:41_

## Summary

The lint [F821](https://docs.astral.sh/ruff/rules/undefined-name/) has a false positive with `anext`.

As pointed out by @MichaReiser, this ultimately is due to having either `project.requires-python` or `tools.ruff.target-version` set to a too lower version.

In this instances, it was discovered that Ruff was targeting Python 3.8 (from an erroneous config).

## Example

```python
async def foo(iter: AsyncGenerator[str, None]):
    assert await anext(iter)
```

## Desired Behaviour

Where a symbol is introduced in a more recent version of Python, Ruff should:

1. Still raise F821 as it is strictly correct; but also,
2. Inform the use Ruff is assuming Python 3.x, and the symbol in question was only introduced in Python 3.y, and nudge the user to set `reures-python` or `target-version`.

## Environment

```console
❯ ruff --version
ruff 0.6.4

❯ python --version
Python 3.12.5
```

---

_Comment by @evanarlian on 2024-09-09 07:12_

False positive on `aiter` as well.

---

_Label `question` added by @MichaReiser on 2024-09-09 10:43_

---

_Comment by @MichaReiser on 2024-09-09 10:45_

Have you specified ` requires-python` in your `pyproject.toml` or a `target-version` in your `ruff.toml`?  I'm asking because `anext` is only available in Python 3.10 and newer (and the default is Python 3.8) 

---

_Comment by @JP-Ellis on 2024-09-09 11:23_

Good catch. I have a monorepo and the root project has

```toml
[project]
# ...
requires-python = "~=3.12.0"

[tool.ruff]
target-version = "py312"
```

and one of the sub-packages has 

```toml
[project]
# ...
requires-python = "~=3.12.0"

[tool.ruff]
target-version = "py38"
```

I can confirm that changing from `py38` to `py312` fixes this.

In cases like there where there is a new symbol introduced in a more recent version of Python, should ruff instead suggest/direct the end-user to update the settings?


---

_Comment by @MichaReiser on 2024-09-09 11:29_

> In cases like there where there is a new symbol introduced in a more recent version of Python, should ruff instead suggest/direct the end-user to update the settings?

That's a neat idea. I think the error message could possibly be improved by saying that the symbol is only defined in Python XX or newer.

---

_Renamed from "[F821] False positive: `anext`" to "[F821] Improve error message for `anext`/`aiter`" by @JP-Ellis on 2024-09-09 11:37_

---

_Comment by @JP-Ellis on 2024-09-09 11:38_

I have updated the original issue to incorporate the suggestion that Ruff provide a better suggestion in this case.

---

_Label `question` removed by @MichaReiser on 2024-09-09 11:41_

---

_Label `rule` added by @MichaReiser on 2024-09-09 11:41_

---

_Label `help wanted` added by @MichaReiser on 2024-09-09 11:41_

---

_Assigned to @AlexWaygood by @AlexWaygood on 2024-09-09 13:57_

---

_Label `help wanted` removed by @AlexWaygood on 2024-09-09 13:57_

---

_Referenced in [astral-sh/ruff#13293](../../astral-sh/ruff/pulls/13293.md) on 2024-09-09 16:11_

---

_Referenced in [astral-sh/ruff#13296](../../astral-sh/ruff/issues/13296.md) on 2024-09-09 21:41_

---

_Closed by @AlexWaygood on 2024-09-10 18:03_

---

_Comment by @MichaReiser on 2024-09-10 18:05_

Thanks @AlexWaygood !

---
