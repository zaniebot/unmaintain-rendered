---
number: 6065
title: "Formatter: Break quality check before breaking parentheses"
type: issue
state: closed
author: konstin
labels:
  - formatter
assignees: []
created_at: 2023-07-25T11:01:01Z
updated_at: 2023-08-07T17:19:00Z
url: https://github.com/astral-sh/ruff/issues/6065
synced_at: 2026-01-07T12:31:12-06:00
---

# Formatter: Break quality check before breaking parentheses

---

_Issue opened by @konstin on 2023-07-25 11:01_

We need to change the breaking priorities with equality checks and parentheses:

black:
```python
def f():
    return (
        unicodedata.normalize("NFKC", s1).casefold()
        == unicodedata.normalize("NFKC", s2).casefold()
    )

ct_match = (
    aaaaaaaaaaact_id == self.get_content_type(obj=rel_obj, using=instance._state.db).id
)
```

ours:
```python
def f():
    return unicodedata.normalize("NFKC", s1).casefold() == unicodedata.normalize(
        "NFKC", s2
    ).casefold()

ct_match = aaaaaaaaaaact_id == self.get_content_type(
    obj=rel_obj, using=instance._state.db
).id
```

---

_Label `formatter` added by @konstin on 2023-07-25 11:01_

---

_Referenced in [astral-sh/ruff#6069](../../astral-sh/ruff/issues/6069.md) on 2023-07-25 11:22_

---

_Comment by @MichaReiser on 2023-07-25 11:28_

There could be two possible solutions for this

* Either can_omit_parentheses incorrectly returns false
Or call expressions should not use parenthesized (which gives them a higher priority)


Or it's something entirely different 

We may want to rename the issue. This is specific to call expressions. Lists, tuples should have a higher priority 

---

_Added to milestone `Formatter: Alpha` by @MichaReiser on 2023-07-31 15:50_

---

_Referenced in [astral-sh/ruff#6203](../../astral-sh/ruff/issues/6203.md) on 2023-07-31 17:12_

---

_Comment by @charliermarsh on 2023-08-03 23:35_

This is pretty specific -- it seems like it has to be a comparator, with a call on either side, and _without_ another parenthesized node? E.g., Black formats this:

```python
ct_match = (
    {aaaaaaaaaaaaaaaa} == self.get_content_type(obj=rel_obj, using=instance._state.db).id
)
```

As:
```python
ct_match = {aaaaaaaaaaaaaaaa} == self.get_content_type(
    obj=rel_obj, using=instance._state.db
).id
```

---

_Referenced in [astral-sh/ruff#6322](../../astral-sh/ruff/pulls/6322.md) on 2023-08-03 23:48_

---

_Assigned to @charliermarsh by @charliermarsh on 2023-08-03 23:52_

---

_Closed by @charliermarsh on 2023-08-07 17:18_

---
