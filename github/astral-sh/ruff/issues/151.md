---
number: 151
title: "E402: allow putting an import after conditional import"
type: issue
state: closed
author: Jackenmen
labels:
  - bug
assignees: []
created_at: 2022-09-11T04:00:39Z
updated_at: 2022-09-11T14:44:07Z
url: https://github.com/astral-sh/ruff/issues/151
synced_at: 2026-01-07T12:31:12-06:00
---

# E402: allow putting an import after conditional import

---

_Issue opened by @Jackenmen on 2022-09-11 04:00_

Example reproduction code:
```py
try:
    import tomllib
except ModuleNotFoundError:
    CAN_PARSE_TOML = False
else:
    CAN_PARSE_TOML = True

import sys

if CAN_PARSE_TOML:
    import os

import asyncio

asyncio, os, tomllib, sys  # silences F401 since it's not relevant
```
Output:
```py
❯ ruff repro.py -v
[2022-09-11][05:56:11][ruff::pyproject][DEBUG] Found pyproject.toml at: pyproject.toml
[2022-09-11][05:56:11][ruff][DEBUG] Identified files to lint in: 15.462µs
[2022-09-11][05:56:11][ruff][DEBUG] Checked files in: 1.800791ms
repro.py:8:1: E402 Module level import not at top of file
repro.py:13:1: E402 Module level import not at top of file

Found 2 error(s).

❯ flake8 repro.py -v        
flake8.checker            MainProcess     84 INFO     Making checkers
flake8.checker            MainProcess     85 INFO     Checking 1 files
flake8.main.application   MainProcess     90 INFO     Finished running
flake8.main.application   MainProcess     90 INFO     Reporting errors
flake8.main.application   MainProcess     90 INFO     Found a total of 0 violations and reported 0
```

I believe flake8 allows any code in try and if blocks without causing E402. It might also not be limited to try and if, not sure on that.

---

_Comment by @charliermarsh on 2022-09-11 13:38_

Yeah this is supposed to be supported but there must be a bug. Thanks :)

---

_Label `bug` added by @charliermarsh on 2022-09-11 13:50_

---

_Referenced in [astral-sh/ruff#155](../../astral-sh/ruff/pulls/155.md) on 2022-09-11 14:17_

---

_Closed by @charliermarsh on 2022-09-11 14:44_

---
