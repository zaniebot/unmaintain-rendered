---
number: 19005
title: "[Linter panic] “for-loop target binding must exist” for PERF403"
type: issue
state: closed
author: dscorbett
labels:
  - bug
  - fixes
  - help wanted
assignees: []
created_at: 2025-06-27T23:37:09Z
updated_at: 2025-06-30T14:47:50Z
url: https://github.com/astral-sh/ruff/issues/19005
synced_at: 2026-01-07T12:31:13-06:00
---

# [Linter panic] “for-loop target binding must exist” for PERF403

---

_Issue opened by @dscorbett on 2025-06-27 23:37_

### Summary

The fix for [`manual-dict-comprehension` (PERF403)](https://docs.astral.sh/ruff/rules/manual-dict-comprehension/) panics when an assignment target of the `for` loop is an attribute reference or a subscription.

[Playground](https://play.ruff.rs/1cc4aba6-43d2-47eb-8cf4-4371648b882b)

```console
$ cat >perf403.py <<'# EOF'
for a.b in ():
    c[d] = e
# EOF

$ RUST_BACKTRACE=1 ruff --isolated check perf403.py --select PERF403   
error: Panicked while linting perf403.py: This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BLinter%20panic%5D

...with the relevant file contents, the `pyproject.toml` settings, and the following stack trace, we'd be very appreciative!

panicked at crates/ruff_linter/src/rules/perflint/rules/manual_dict_comprehension.rs:470:18:
for-loop target binding must exist
Backtrace:    0: __mh_execute_header
   1: __mh_execute_header
   2: __mh_execute_header
   3: __mh_execute_header
   4: __mh_execute_header
   5: __mh_execute_header
   6: __mh_execute_header
   7: __mh_execute_header
   8: __mh_execute_header
   9: __mh_execute_header
  10: __mh_execute_header
  11: __mh_execute_header
  12: __mh_execute_header
  13: __mh_execute_header
  14: __mh_execute_header
  15: __mh_execute_header
  16: __mh_execute_header
  17: __mh_execute_header
  18: __mh_execute_header
  19: __mh_execute_header
  20: __mh_execute_header
  21: __mh_execute_header
  22: __mh_execute_header
  23: __mh_execute_header
  24: __mh_execute_header
  25: __mh_execute_header


All checks passed!
```

### Version

ruff 0.12.1 (32c54189c 2025-06-26)

---

_Label `bug` added by @ntBre on 2025-06-28 02:42_

---

_Label `fixes` added by @ntBre on 2025-06-28 02:42_

---

_Label `help wanted` added by @ntBre on 2025-06-28 02:42_

---

_Comment by @ntBre on 2025-06-28 02:49_

This used to be a `debug_assert!` but got changed to an `expect` call in #18866:

https://github.com/astral-sh/ruff/blob/90cb0d3a7b0d1b9528854dad64dd17330bfd5f36/crates/ruff_linter/src/rules/perflint/rules/manual_dict_comprehension.rs#L465-L470

I think we'll need to drop the assertion entirely and just put it back to a `let-else` that returns `true` if `None` (because `true` will short-circuit the rule).

Also, I think this even panics before it gets to a fix. The playground showed an error as soon as I selected the rule.

---

_Referenced in [astral-sh/ruff#19042](../../astral-sh/ruff/pulls/19042.md) on 2025-06-30 07:25_

---

_Closed by @ntBre on 2025-06-30 14:47_

---
