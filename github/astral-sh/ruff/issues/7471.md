---
number: 7471
title: Formatter conflict with E501 and comments
type: issue
state: closed
author: shughes-uk
labels:
  - formatter
  - accepted
assignees: []
created_at: 2023-09-17T19:44:39Z
updated_at: 2023-10-02T18:27:08Z
url: https://github.com/astral-sh/ruff/issues/7471
synced_at: 2026-01-07T12:31:12-06:00
---

# Formatter conflict with E501 and comments

---

_Issue opened by @shughes-uk on 2023-09-17 19:44_

Ruff version 0.0.289

Before

```python
if (
    "aaaaaaaaaaaaaaaaaaaa"
    and "sdasdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"  # type: ignore
):
    pass
```

After `ruff format`
```python
if (
    "aaaaaaaaaaaaaaaaaaaa" and "sdasdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"  # type: ignore
):
    pass
```


There's now an E501 violation, due to the length of the comment. I'm guessing this is a disparity between the formatter ignoring comments for line length calculations and E501 not. 

I understand there's some disparity between the way `black` handles line length and ruff, but i'd expect the ruff formatter to be consistent with ruff's line length rules, which is not the case here.

---

_Comment by @JonathanPlasse on 2023-09-18 17:42_

~Did you try [pycodestyle.ignore-overlong-task-comments](https://docs.astral.sh/ruff/settings/#pycodestyle-ignore-overlong-task-comments) mentioned in [line-too-long](https://docs.astral.sh/ruff/rules/line-too-long/)?~
My bad, this has not been implemented yet.

---

_Label `formatter` added by @MichaReiser on 2023-09-27 16:28_

---

_Added to milestone `Formatter: Beta` by @MichaReiser on 2023-09-27 16:31_

---

_Comment by @charliermarsh on 2023-09-27 16:35_

Our plan is to modify E501 to allow for overlong pragma comments, to make it consistent with the formatter.


---

_Label `accepted` added by @charliermarsh on 2023-09-27 16:36_

---

_Comment by @charliermarsh on 2023-09-27 16:36_

(That we allow the formatter to exceed the line length for pragma comments is intended and documented.)

---

_Assigned to @charliermarsh by @charliermarsh on 2023-09-27 23:50_

---

_Referenced in [astral-sh/ruff#7687](../../astral-sh/ruff/pulls/7687.md) on 2023-09-28 02:06_

---

_Referenced in [astral-sh/ruff#7692](../../astral-sh/ruff/pulls/7692.md) on 2023-09-28 05:10_

---

_Closed by @charliermarsh on 2023-09-29 23:26_

---

_Comment by @gertvdijk on 2023-10-02 18:22_

Hi @charliermarsh! Just installed 0.0.292 (from 0.0.291), using the Ruff linter (not formatter) and I have found this change to the formatting it wants (removing `# noqa: E501`), which I think may be unexpected or not (?):

```diff
-    @serial.validator  # pyright: ignore[reportUnknownMemberType, reportUntypedFunctionDecorator, reportGeneralTypeIssues]  # noqa: E501
+    @serial.validator  # pyright: ignore[reportUnknownMemberType, reportUntypedFunctionDecorator, reportGeneralTypeIssues]
```

(source code [here](https://github.com/gertvdijk/PyKMP/blob/c2eb95487aed9b347caed9804924087c8af1732b/src/pykmp/messages.py#L338)) ... which sounds like what's happened in 1646939383336c45f91a553035c6e5b1f1e2341a for this issue.

That change in behaviour for E501 appears to be missing from [the 0.0.292 changelog](https://github.com/astral-sh/ruff/releases/tag/v0.0.292), I guess?

```
$ flake8 src/pykmp/messages.py --max-line-length 88
src/pykmp/messages.py:338:89: E501 line too long (122 > 88 characters)
src/pykmp/messages.py:429:89: E501 line too long (125 > 88 characters)
```

This wasn't clear after reading the changelog and I believe deviating from flake8's E501, may deserve a line in the changelog, if that's intentional. If not, I'm happy to create a new issue for this.

---

_Comment by @charliermarsh on 2023-10-02 18:27_

@gertvdijk - Sorry, that's intentional -- I knew I was missing something from the changelog. I'll update it now.

---
