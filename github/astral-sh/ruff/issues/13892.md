---
number: 13892
title: DJ012 produces false positive when there are other dunder methods in model class
type: issue
state: closed
author: maddrum
labels:
  - rule
  - breaking
  - help wanted
assignees: []
created_at: 2024-10-23T13:53:12Z
updated_at: 2025-01-09T13:36:44Z
url: https://github.com/astral-sh/ruff/issues/13892
synced_at: 2026-01-07T12:31:13-06:00
---

# DJ012 produces false positive when there are other dunder methods in model class

---

_Issue opened by @maddrum on 2024-10-23 13:53_

`ruff check` produces false positive DJ012 for Django models like so:

```
class Person(models.Model):
    name = models.CharField(xxxx)    
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        <some custom code>

    def save(*args, **kwargs):
        super().save(*args, `**kwargs)

```
According to Python best practices, dunder methods should always be kept at the beginning of the class.
But since `save()` is a Django method which is after other methods method it invokes error. 

DJ012 should obey other Python class structuring, before evaluating Django styleguide.


    


---

_Comment by @MichaReiser on 2024-10-23 14:45_

I'm not a Django expert, so it's unclear to me why the [Django style guide](https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/#model-style) only mentions the ordering of `__str__`. Unless all other dunder methods are included in the *Any custom methods* section.

It seems overriding [`__init__` isn't recommended](https://docs.djangoproject.com/en/5.1/ref/models/instances/#creating-objects).

---

_Comment by @maddrum on 2024-10-23 15:49_

> I'm not a Django expert, so it's unclear to me why the [Django style guide](https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/#model-style) only mentions the ordering of `__str__`. Unless all other dunder methods are included in the _Any custom methods_ section.
> 
> It seems overriding [`__init__` isn't recommended](https://docs.djangoproject.com/en/5.1/ref/models/instances/#creating-objects).

`__init__` is only for display purposes, that is going to be true for all __dunder__ methods. 


---

_Label `rule` added by @MichaReiser on 2024-10-24 06:16_

---

_Label `breaking` added by @MichaReiser on 2024-10-24 06:16_

---

_Label `needs-decision` added by @MichaReiser on 2024-10-24 06:16_

---

_Comment by @MichaReiser on 2024-10-24 06:27_

I want to make sure that we're 100% sure that this change is in conformance with the style guide because it is a breaking change: All dunder methods other than `__str__` would suddenly be flagged as incorrectly ordered. 

As I said before, I'm not a Django expert but I did some extra research. 

* The [upstream rule](https://github.com/rocioar/flake8-django/blob/895364969af49cbdd3c6ba8e63adeb9e4415ec5d/flake8_django/checkers/model_content_order.py#L77C5-L85) implements the same ordering as Ruff
* The django style guide and model documentation only mention overriding `__str__` and warn about overriding `__init__`

The impression I get is that Ruff's current behavior is correct. My suspicious is that overriding other dunder methods is just very uncommon (or not advised) for Django models. Could you share some examples (from your project and/or other projects) where it is necessary to override additional dunder methods?

---

_Comment by @maddrum on 2024-10-24 15:27_

> I want to make sure that we're 100% sure that this change is in conformance with the style guide because it is a breaking change: All dunder methods other than `__str__` would suddenly be flagged as incorrectly ordered.
> 
> As I said before, I'm not a Django expert but I did some extra research.
> 
>     * The [upstream rule](https://github.com/rocioar/flake8-django/blob/895364969af49cbdd3c6ba8e63adeb9e4415ec5d/flake8_django/checkers/model_content_order.py#L77C5-L85) implements the same ordering as Ruff
> 
>     * The django style guide and model documentation only mention overriding `__str__` and warn about overriding `__init__`
> 
> 
> The impression I get is that Ruff's current behavior is correct. My suspicious is that overriding other dunder methods is just very uncommon (or not advised) for Django models. Could you share some examples (from your project and/or other projects) where it is necessary to override additional dunder methods?

For example, you might want to define `__repr__` in your Django model, which is safe and okay and has common usage in logging.

For `__init__` there is a semi-dirty solution/which is a lot common/ for tracking model field updates, since Django does not have a solution for that on the model level/it has on forms, but that might not be a solution in every case/

More on that - [https://medium.com/@mmzeynalli/how-to-detect-field-changes-in-django-ae4bc719aea2](https://medium.com/@mmzeynalli/how-to-detect-field-changes-in-django-ae4bc719aea2  )
Solution 3.

To summarize, in real-world scenarios, there are a lot of cases where that style guide is impossible to follow, which is why this check is going to produce fake positives

 
 

---

_Comment by @MichaReiser on 2024-10-24 15:57_

@AlexWaygood any chance that you're familiar with DJango?

---

_Comment by @AlexWaygood on 2024-10-24 16:06_

I think @carljm is almost certainly our best django expert on the team ðŸ˜„
Whereas I have never used django, Carl was both a member of the django core team (maybe still is?) and helped maintain a very large django-based codebase for many years (Instagram)

---

_Comment by @carljm on 2024-10-24 16:20_

Possibly we should open an issue on Django itself to get the style guide clarified? I assume the upstream rule was simply based on a literal reading of the style guide as currently written. Although overriding `__init__` specifically may be discouraged on Django models, there are certainly other dunder methods that may make sense to override, so the style guide should offer guidance on where they belong.

Personally I agree with @maddrum that the typical Python convention to put dunder methods first should be respected here, and `__str__` should be replaced with "`__str__` or any other Python dunder methods" in the Django style guide. But I don't think this is really our call to make. The rule is intended to encode the style guide, and the style guide is simply not clear here.

---

_Comment by @MichaReiser on 2024-10-25 06:35_

Thanks @carljm. This is a great point. @maddrum would you be interested in opening an issue on the django style guide project where you ask them to clarify the ordering?

---

_Comment by @maddrum on 2024-10-25 13:16_

I have raised this 

[https://code.djangoproject.com/ticket/35866#ticket](https://code.djangoproject.com/ticket/35866#ticket)

---

_Comment by @maddrum on 2024-10-25 13:21_

> Possibly we should open an issue on Django itself to get the style guide clarified? I assume the upstream rule was simply based on a literal reading of the style guide as currently written. Although overriding `__init__` specifically may be discouraged on Django models, there are certainly other dunder methods that may make sense to override, so the style guide should offer guidance on where they belong.
> 
> Personally I agree with @maddrum that the typical Python convention to put dunder methods first should be respected here, and `__str__` should be replaced with "`__str__` or any other Python dunder methods" in the Django style guide. But I don't think this is really our call to make. The rule is intended to encode the style guide, and the style guide is simply not clear here.

This one applies to staticmethods, private methods, properties and a lot of other methods that come on top. 
The proposed structure violates many practices and that error currently requires restyling code not according to Python directives. And Django code should follow those first and then apply other rules. 

---

_Comment by @nessita on 2024-10-25 13:59_

> Possibly we should open an issue on Django itself to get the style guide clarified?

Ticket accepted! (Hello, Django Fellow here :wave: )

> Personally I agree with @maddrum that the typical Python convention to put dunder methods first should be respected here, and `__str__` should be replaced with "`__str__` or any other Python dunder methods" in the Django style guide. But I don't think this is really our call to make. The rule is intended to encode the style guide, and the style guide is simply not clear here.

As I put in the ticket, my reading of the Django docs for "any custom method" is "any custom business logic or helper method that you create for your model", and it does not apply to overrides of what `object` provides or any other documented dunder method.

I accepted the ticket on the basis that the docs could be more clear about this. Thanks everyone!

---

_Comment by @maddrum on 2024-10-29 05:54_

Added a PR with suggested changes

https://github.com/django/django/pull/18723

---

_Comment by @sarahboyce on 2024-10-29 13:56_

Hello :wave: another Django Fellow 

> The impression I get is that Ruff's current behavior is correct. My suspicious is that overriding other dunder methods is just very uncommon (or not advised) for Django models. Could you share some examples (from your project and/or other projects) where it is necessary to override additional dunder methods?

Correct, it's really uncommon. This is an **internal** style guide for our docs and there's no models in our docs that override a dunder method other than `__str__`

> Personally I agree with @maddrum that the typical Python convention to put dunder methods first should be respected here, and `__str__` should be replaced with "`__str__` or any other Python dunder methods" in the Django style guide. But I don't think this is really our call to make. The rule is intended to encode the style guide, and the style guide is simply not clear here.

Agreed, I have commented on the PR to make this update so our docs are clearer.
Given this doesn't really happen, I don't think we need to go into further detail in the Django internal docs, as the audience is contributors to Django (rather than a strict style guide for the Django community)

---

_Label `needs-decision` removed by @dhruvmanila on 2024-10-30 03:32_

---

_Added to milestone `v0.8` by @MichaReiser on 2024-10-30 18:21_

---

_Comment by @MichaReiser on 2024-10-30 18:21_

Thanks everyone for your help in clarifying the style guide. The style guide has been updated and we'd welcome a PR that updates the rule implementation accordingly. 

---

_Label `help wanted` added by @MichaReiser on 2024-10-30 18:21_

---

_Removed from milestone `v0.8` by @AlexWaygood on 2024-11-18 11:38_

---

_Added to milestone `v0.9` by @AlexWaygood on 2024-11-18 11:38_

---

_Removed from milestone `v0.9` by @MichaReiser on 2025-01-08 13:35_

---

_Added to milestone `v.0.10` by @MichaReiser on 2025-01-08 13:35_

---

_Referenced in [astral-sh/ruff#15365](../../astral-sh/ruff/pulls/15365.md) on 2025-01-09 03:13_

---

_Closed by @MichaReiser on 2025-01-09 13:36_

---
