---
number: 12458
title: "[Infinite loop] Parser error with I002 (required imports) and F401 (unused import)"
type: issue
state: closed
author: AA-Turner
labels:
  - bug
assignees: []
created_at: 2024-07-22T17:56:14Z
updated_at: 2024-07-26T18:39:56Z
url: https://github.com/astral-sh/ruff/issues/12458
synced_at: 2026-01-07T12:31:13-06:00
---

# [Infinite loop] Parser error with I002 (required imports) and F401 (unused import)

---

_Issue opened by @AA-Turner on 2024-07-22 17:56_

I ran into a fun error:

```ps1con
PS> ruff -V
ruff 0.5.4
PS> ruff check --isolated --select I002,F401 --fix --unsafe-fixes --config "lint.isort.required-imports=['from path import Path']" bug.py

error: Failed to converge after 100 iterations.

This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BInfinite%20loop%5D

...quoting the contents of `bug.py`, the rule codes I002, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

bug.py:1:1: I002 Missing required import: `from path import Path`
Found 101 errors (100 fixed, 1 remaining).
[*] 1 fixable with the --fix option.

PS> type bug.py
_ = 'Path'

```

The content of ``bug.py`` is ``"_ = 'Path'\n"``. If you remove the assignment, all works (one imagines as the string is parsed as a docstring).

```python
_ = 'Path'
```

The error exists going back at least as far as 0.2.2 (0.2.1 gives errors with mixing ``--isolated`` and ``--config``).

I can't see any similar issues, but if I've missed one please close this!

A

---

_Comment by @charliermarsh on 2024-07-22 18:18_

Thanks, this makes sense. Will fix.

---

_Label `bug` added by @charliermarsh on 2024-07-22 18:18_

---

_Comment by @charliermarsh on 2024-07-22 18:19_

It's kind of an obvious failure, whoops -- but it's never come up because "required imports" is typically used for `from __future` imports, which are never marked as unused.

---

_Comment by @AA-Turner on 2024-07-22 18:44_

As background, this came up in the context of moving Sphinx to ``pathlib`` globally (or at least attempting to). I wanted to add ``from pathlib import Path`` to every module to avoid undefined name errors when doing simple regex-based refactorings, but when I ran ``ruff check . --fix`` I had this error.

I'm not sure which of the required import or the undefined name should take priority (instict says the required import, as the user has requested it), but hopefully Ruff shouldn't crash!

Thank you for the quick response as always Charlie!

Best,
Adam

---

_Comment by @charliermarsh on 2024-07-22 18:45_

Totally. That's a clever trick! (I'm guessing you can workaround by running `I002` first with the `required-import`, then `F401` second, without the `required-import`?)

Agree that the required import should take priority. Think we just need to respect that in `F401`.

---

_Comment by @AA-Turner on 2024-07-22 18:47_

> I'm guessing you can workaround by running `I002` first with the `required-import`, then `F401` second, without the `required-import`?

Yep, running with ``--select`` fixed things -- I just wanted to report upstream to make the team aware!

A

---

_Referenced in [astral-sh/ruff#12536](../../astral-sh/ruff/pulls/12536.md) on 2024-07-26 16:43_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-07-26 16:51_

---

_Referenced in [astral-sh/ruff#12537](../../astral-sh/ruff/pulls/12537.md) on 2024-07-26 17:15_

---

_Closed by @charliermarsh on 2024-07-26 18:23_

---

_Closed by @charliermarsh on 2024-07-26 18:23_

---

_Comment by @AA-Turner on 2024-07-26 18:39_

Thanks Charlie!

A

---
