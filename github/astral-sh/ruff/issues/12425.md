---
number: 12425
title: Inconsistent removal of whitespace around operators
type: issue
state: closed
author: robin-weiland
labels: []
assignees: []
created_at: 2024-07-20T21:33:25Z
updated_at: 2024-07-21T12:17:41Z
url: https://github.com/astral-sh/ruff/issues/12425
synced_at: 2026-01-07T12:31:13-06:00
---

# Inconsistent removal of whitespace around operators

---

_Issue opened by @robin-weiland on 2024-07-20 21:33_

In the snippet below, there are two occurrences of the `**`-operator.
Following pep8, I added spaces around them.

Now I can either run pre-commit or `ruff format` directly and the only issue it finds and corrects are the spaces around the first power operator, which it removes. Notably, the ones in the Exception are left as they are.

Is there any reason I am unaware of for this inconsistency?
Also, if the removal of spaces is indeed the intended behavior here, is there a way to ignore this?
I could only find rules to explicitly ignore missing whitespace (e.g., E225) not vice versa.

## snippet

```python
if not (0 <= value < (2 ** self.size)):
    raise ValueError(
        f'Value "{value}" must be between 0 and {(2 ** self.size) - 1} with size {size}!'
    )
```


## ruff settings

```toml
[tool.ruff]
exclude = [
    ".git",
    ".pytest_cache",
    ".ruff_cache",
    ".venv",
    "dist",
]
line-length = 88
indent-width = 4
target-version = "py311"

[tool.ruff.format]
quote-style = "single"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"
```

### pre-commit-config.yaml

```yaml
# ...

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.4.9
    hooks:
      - id: ruff
      - id: ruff-format

# ...
```

## ruff version

ruff 0.4.10

## environment

win11 23H2
Python 3.11.5 (tags/v3.11.5:cce6ba9) 64 bit
Poetry (version 1.8.3)
pre-commit 3.7.1

---

keywords: whitespace-around-operator, E225



---

_Comment by @charliermarsh on 2024-07-20 21:39_

I believe it's because we don't format content within f-strings, unless you pass `--preview. You can see that they're formatted identically [here](https://play.ruff.rs/?secondary=Format), with preview enabled.

---

_Comment by @robin-weiland on 2024-07-21 11:17_

Thank you for the reply. I was not aware about the behavior with f-strings (rtfm I guess).
I'm a still wondering about the removal of whitespace around `**`, though. I rarely use them, admittedly. But I couldn't find any reference to it anywhere in terms of style conventions. Naively, I would assume it is treated like any other binary operator.
(I know this is not the place to discuss style conventions. I don't intend to argue over anything, I am just curious about this behavior)

---

_Comment by @charliermarsh on 2024-07-21 11:53_

ðŸ‘ We tend to follow Black's style guide unless we have a reason to deviate, and the formatting for power operators is described here: https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#line-breaks-binary-operators. It depends on whether the expressions on either side of the operator are considered "simple", IIRC to make basic math more dense.

---

_Comment by @robin-weiland on 2024-07-21 12:17_

Thanks. Makes sense, to reflect the closeness of both sides regarding order of precedence.
Regardless, since I only use base 2, I will probably avoid that rule by using left-shifts insteadðŸ˜…

---

_Closed by @robin-weiland on 2024-07-21 12:17_

---
