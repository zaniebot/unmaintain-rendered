---
number: 20214
title: "`os-path-expanduser` (PTH111) should be marked unsafe"
type: issue
state: closed
author: dscorbett
labels:
  - fixes
  - preview
assignees: []
created_at: 2025-09-03T14:33:07Z
updated_at: 2025-09-17T15:23:57Z
url: https://github.com/astral-sh/ruff/issues/20214
synced_at: 2026-01-07T12:31:13-06:00
---

# `os-path-expanduser` (PTH111) should be marked unsafe

---

_Issue opened by @dscorbett on 2025-09-03 14:33_

### Summary

The fix for [`os-path-expanduser` (PTH111)](https://docs.astral.sh/ruff/rules/os-path-expanduser/) should be marked unsafe because the replacement is not always equivalent. If `os.path.expanduser` canâ€™t determine a home directory, it returns the input unchanged, whereas `pathlib.Path.expanduser` raises an error. One reason it might not be able to determine a home directory is if the indicated user does not exist, but that is not the only possible reason. [Example](https://play.ruff.rs/7b404540-09b0-48be-a3a0-3fb6ac57cd5d):
```console
$ cat >pth111.py <<'# EOF'
import os
try: print(os.path.expanduser("~pth111_nonexistent_user"))
except RuntimeError as e: print(e)
# EOF

$ python pth111.py
~pth111_nonexistent_user

$ ruff --isolated check pth111.py --select PTH111 --preview --fix
Found 1 error (1 fixed, 0 remaining).

$ cat pth111.py
import os
import pathlib
try: print(pathlib.Path("~pth111_nonexistent_user").expanduser())
except RuntimeError as e: print(e)

$ python pth111.py
Could not determine home directory.
```

### Version

ruff 0.12.11 (c2bc15bc1 2025-08-28)

---

_Label `fixes` added by @ntBre on 2025-09-03 14:39_

---

_Label `preview` added by @ntBre on 2025-09-03 14:39_

---

_Referenced in [astral-sh/ruff#20215](../../astral-sh/ruff/pulls/20215.md) on 2025-09-03 15:14_

---

_Closed by @ntBre on 2025-09-17 15:23_

---
