---
number: 7899
title: "Unable to parse '.ruff.toml' when configured for Ruff linter"
type: issue
state: closed
author: echoix
labels:
  - question
assignees: []
created_at: 2023-10-10T16:36:13Z
updated_at: 2023-10-10T20:11:15Z
url: https://github.com/astral-sh/ruff/issues/7899
synced_at: 2026-01-07T12:31:12-06:00
---

# Unable to parse '.ruff.toml' when configured for Ruff linter

---

_Issue opened by @echoix on 2023-10-10 16:36_

**Describe the bug**
A clear and concise description of what the bug is.

I configured '.ruff.toml' with additional parameters for Ruff linter, and when running locally or GHA I encounter parsing error:

```
--Error detail:
<jemalloc>: MADV_DONTNEED does not work (memset will be used instead)
<jemalloc>: (This is the expected behaviour if you are running under QEMU)
ruff failed
  Cause: Failed to parse `/tmp/lint/.ruff.toml`: TOML parse error at line 1, column 1
  |
1 | [format]
  | ^^^^^^^^
wanted exactly 1 element, more than 1 element
```

**To Reproduce**
Steps to reproduce the behavior:

1. enable Ruff linter and Create .ruff.toml
2. Provide the following parameters in .ruff.toml: 
```
[format]
indent-style = "tab"
quote-style = "single"
```
4. Run locally 'mega-linter-runner --flavor python' (or) via GH Actions.
5. See error:
```
--Error detail:
<jemalloc>: MADV_DONTNEED does not work (memset will be used instead)
<jemalloc>: (This is the expected behaviour if you are running under QEMU)
ruff failed
  Cause: Failed to parse `/tmp/lint/.ruff.toml`: TOML parse error at line 1, column 1
  |
1 | [format]
  | ^^^^^^^^
wanted exactly 1 element, more than 1 element
```

**Expected behavior**
Script expected to be tab indented and quote style be single quote.

**Screenshots**
N/A

**Additional context**
When running Ruff as-is it works well with:
```
ruff format "myScript.py"
```

Megalinter's ruff ver : 
```
 "ruff": "0.0.291",
```
My local Stand-alone Ruff ver: ruff 0.0.291

Python flavor: oxsecurity/megalinter/flavors/python@v7.4.0







_Originally posted by @fawazsalah in https://github.com/oxsecurity/megalinter/issues/2995_



-------------


And with a comment that has the same bug directly with ruff: 

> > Since [the error](https://github.com/toml-rs/toml-rs/blob/464e7153879be75965eb067062cc8cc6743b7eb6/src/de.rs#L263-L270) occurs when running Ruff through MegaLinter but not when running Ruff directly, and [MegaLinter v7.4.0 is on Ruff 0.0.290](https://megalinter.io/7.4.0/descriptors/python_ruff/), I would try running Ruff directly at 0.0.290.
> 
> Thanks @Kurt-von-Laven and @echoix for the support.
> 
> Bingo Good catch; I can confirm similar error with 0.0.290 locally.
> 
> [...]




_Originally posted by @fawazsalah in https://github.com/oxsecurity/megalinter/issues/2995#issuecomment-1754720775_

---

_Renamed from "**Describe the bug**" to "Unable to parse '.ruff.toml' when configured for Ruff linter" by @echoix on 2023-10-10 16:36_

---

_Comment by @charliermarsh on 2023-10-10 16:38_

Hmm, I'm unable to reproduce this on Ruff v0.0.291 or v0.0.292. 

With:

```
â¯ ruff --version
ruff 0.0.291
```

I created `foo.py` with `x=1`, and `ruff.toml` with:

```toml
[format]
indent-style = "tab"
quote-style = "single"
```

Running `ruff format foo.py`:

```
warning: `ruff format` is a work-in-progress, subject to change at any time, and intended only for experimentation.
1 file reformatted
```

---

_Comment by @charliermarsh on 2023-10-10 16:39_

Let me verify that the config is being picked up in my repro.

---

_Comment by @charliermarsh on 2023-10-10 16:40_

Hmm, yes, confirmed, so still unable to repro. Could megalinter be using an older version?

---

_Label `waiting-on-author` added by @charliermarsh on 2023-10-10 16:40_

---

_Comment by @echoix on 2023-10-10 16:41_

If the whole parsing of the format section in a ruff.toml file instead of a pyproject.toml file isn't broken, I suspect something with a BOM header might be going on here.

Does your tests cover a similar case?

---

_Comment by @echoix on 2023-10-10 16:43_

The affected version was 0.290 (from that user). 

---

_Comment by @echoix on 2023-10-10 16:45_

> Hmm, yes, confirmed, so still unable to repro. Could megalinter be using an older version?

The latest release of Megalinter still has 0.290, but 0.291 is already in main. 


0.292 is still in https://github.com/oxsecurity/megalinter/pull/2988

---

_Comment by @zanieb on 2023-10-10 16:51_

The new `format` section is only available in 0.0.291+ (https://github.com/astral-sh/ruff/pull/7543); related https://github.com/astral-sh/ruff/pull/7514



---

_Comment by @echoix on 2023-10-10 17:10_

I saw the second, #7514, but thought that an existing cli option was renamed, but didn't realise by the release notes that it didn't exist yet, as I thought it was a rename of an old command, and output-format wasn't at a section level.


So I'll go and mention that. I really didn't catch that it was a new feature from the release notes, I caught that `lint` was a new section though. 
Some projects, like the Python documentation, or CMake documentation add at what version a feature was added. Is it something that would be worth it for your project? (I see it is very fast-moving, congratulations for your work!)

---

_Referenced in [oxsecurity/megalinter#2995](../../oxsecurity/megalinter/issues/2995.md) on 2023-10-10 17:16_

---

_Comment by @Kurt-von-Laven on 2023-10-10 17:19_

I have often spent significant time determining which rules are available at which version. Sometimes I have found the answer in the release notes, and sometimes have resorted to binary search.

---

_Comment by @zanieb on 2023-10-10 17:20_

So... we took the `format = <string>` option and renamed it to `output-format = <string>` (with backwards compatibility) to make room for the `[format]` section which can be used for our formatter options. Since you were using `[format]` with an older version that expected a string you were getting the error message "wanted exactly 1 element, more than 1 element".

I'd like to have documentation include versions in which things are added. We'd need to build out tooling for it though.

---

_Label `waiting-on-author` removed by @zanieb on 2023-10-10 17:21_

---

_Label `question` added by @zanieb on 2023-10-10 17:21_

---

_Comment by @Kurt-von-Laven on 2023-10-10 17:44_

Sphinx offers [`::versionadded::`](https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html#paragraph-level-markup). [Sphinx](https://sphinxcontrib-versioning.readthedocs.io/en/latest/), [Docusaurus](https://docusaurus.io/docs/versioning), and  [MkDocs](https://squidfunk.github.io/mkdocs-material/setup/setting-up-versioning/) offer versioning.

---

_Comment by @zanieb on 2023-10-10 17:49_

Unfortunately I don't think those really address our use-cases. We'd probably need to build the tooling into our Rust documentation generator, but we should talk about this in a [new discussion](https://github.com/astral-sh/ruff/discussions/new?category=ideas) instead of cluttering this issue.

---

_Closed by @echoix on 2023-10-10 20:11_

---
