---
number: 21925
title: Though about formatting mathematical code
type: issue
state: open
author: maxtremblay
labels:
  - formatter
  - style
assignees: []
created_at: 2025-12-11T17:51:27Z
updated_at: 2025-12-11T17:58:33Z
url: https://github.com/astral-sh/ruff/issues/21925
synced_at: 2026-01-07T12:31:14-06:00
---

# Though about formatting mathematical code

---

_Issue opened by @maxtremblay on 2025-12-11 17:51_

### Question

I want to implement the following trigonometric expression as part of a larger calculation.

```math
f(\vec{x}) = cos(x_1) \cdot sin(x_2) - cos(x_0) \cdot sin(x_1) \cdot cos(x_2)
```

However, I find that the formatting with ruff of such expression can be weird. 

```python
computation_outcome = jnp.cos(x[1]) * jnp.sin(x[2]) - jnp.cos(x[0]) * jnp.sin(
    x[1]
) * jnp.cos(x[2])
```

This is an example amongst many others. In general, I find that formatting code with multiple calls to simple functions with some of the functions split on three lines yields weird looking results.

In opposition, compare the following code formatted with ruff.

```python
class Something:
    def __init__(self):
        self.x = 0

    def function(self, x):
        self.x = x
        return self


a = (
    Something()
    .function(1)
    .function(2)
    .function(3)
    .function(4)
    .function(5)
    .function(6)
    .function(7)
)
```

This looks much nicer than 

```python
a = Something().function(1).function(2).function(3).function(4).function(5).function(
    6
).function(7)
```

If ruff used the same strategy for the above snippet, it would look like

```python
computation_outcome = (
    jnp.cos(x[1]) 
    * jnp.sin(x[2]) 
    - jnp.cos(x[0]) 
    * jnp.sin(x[1]) 
    * jnp.cos(x[2])
)
```
which is already nicer (at least, I find it nicer).

Also, it would be great if in this case, it can be displayed as

```python
computation_outcome = (
    jnp.cos(x[1]) * jnp.sin(x[2]) - jnp.cos(x[0]) * jnp.sin(x[1]) * jnp.cos(x[2])
)
```

Possibly, if the expression is too long for a single line, it can be splitted at the minus sign keeping the products together.

```python
computation_outcome = (
    jnp.cos(x[1]) * jnp.sin(x[2])
    - jnp.cos(x[0]) * jnp.sin(x[1]) * jnp.cos(x[2])
)
```

However, this would required more heuristics for how to parse and format mathematical expressions.



### Version

ruff 0.14.1

---

_Label `question` added by @maxtremblay on 2025-12-11 17:51_

---

_Label `question` removed by @MichaReiser on 2025-12-11 17:57_

---

_Label `formatter` added by @MichaReiser on 2025-12-11 17:57_

---

_Label `style` added by @MichaReiser on 2025-12-11 17:57_

---
