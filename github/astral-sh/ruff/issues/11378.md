---
number: 11378
title: Ruff unconditionally assumes any string in a type parameter is a forward annotation
type: issue
state: open
author: lanzz
labels:
  - type-inference
assignees: []
created_at: 2024-05-12T11:09:57Z
updated_at: 2024-06-13T00:23:29Z
url: https://github.com/astral-sh/ruff/issues/11378
synced_at: 2026-01-07T12:31:13-06:00
---

# Ruff unconditionally assumes any string in a type parameter is a forward annotation

---

_Issue opened by @lanzz on 2024-05-12 11:09_

I have an alias for `Annotated`, to be used in a container class:

```python

class Container:
    # class that inspects its type annotations at runtime and does stuff with them

Field = typing.Annotated

class MyContainer(Container):
    foo_field: Field[int, 'metadata']    # ruff raises F281 "Undefined name `metadata` here
    bar_field: Field[str, 'not a valid identifier']   # ruff raises F722 "Syntax error in forward annotation" here
    foo_ann: typing.Annotated[int, 'metadata']    # no complaints here
    bar_ann: typing.Annotated[str, 'not a valid identifier']   # no complaints here either
```

Ultimately, the `Field` alias is just sugar to make the definitions of subclasses of `Container` better self-documenting. I understand this is a pretty niche use and it's very likely not feasible for Ruff to figure out that `Field` is alias for `Annotated` (especially since in practice that alias definition is in a completely different module), but is there a way to explicitly instruct Ruff to treat those instances of `Field` the same way it treats actual `Annotated` type definitions, without having to suppress the rule explicitly on every single line that uses `Field`? If I could define ignores by line regex that would work (e.g. ignore F281, F722 for lines matching `:\s+Field\[`), but I don't think Ruff supports that, or at least I could not find it in the docs.

---

_Comment by @charliermarsh on 2024-05-13 01:48_

I don't know that we have a great workaround here right now. If we can't resolve a symbol, and it's subscripted in an annotation, we _do_ assume that any strings within the subscript are forward annotations, since they're almost always generics.

I suspect this will eventually "just work" as we're doing a lot of foundational work right now to make Ruff capable of this kind of inference. But in the interim, struggling to think of anything other than adding `# ruff: noqa: F281, F722` to the file.


---

_Label `type-inference` added by @charliermarsh on 2024-05-13 01:48_

---

_Referenced in [microsoft/pyright#8134](../../microsoft/pyright/issues/8134.md) on 2024-06-12 23:07_

---

_Comment by @rmorshea on 2024-06-12 23:07_

As an additional note, this happens for any string literal in `Annotated`:

```python
Field[int, {"some": "metadata"}] 
```

```
Undefined name `some`
Undefined name `metadata`
```

---

_Comment by @charliermarsh on 2024-06-12 23:09_

Do you mean, if you reassign `Annotated` to something else? I don't see that behavior for `Annotated` itself: https://play.ruff.rs/2f8e1c84-7a7d-4173-8146-4d5718d279ea

---

_Comment by @rmorshea on 2024-06-12 23:10_

Correct. If `Annotated` has been aliased or imported from a different location this is true.

---

_Comment by @charliermarsh on 2024-06-13 00:23_

You should be able to successfully import it from a different location by setting [`typing-modules`](https://docs.astral.sh/ruff/settings/#lint_typing-modules), as long as it isn't aliased.

---

_Referenced in [astral-sh/ruff#16985](../../astral-sh/ruff/issues/16985.md) on 2025-03-26 18:08_

---

_Referenced in [astral-sh/ruff#9860](../../astral-sh/ruff/issues/9860.md) on 2025-09-12 16:55_

---

_Referenced in [astral-sh/ruff#21077](../../astral-sh/ruff/issues/21077.md) on 2025-10-26 01:02_

---
