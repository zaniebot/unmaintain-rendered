---
number: 6262
title: "exclude pattern with `*` in file name incorrectly matches entire file path"
type: issue
state: open
author: DetachHead
labels:
  - cli
  - needs-decision
assignees: []
created_at: 2023-08-02T04:21:09Z
updated_at: 2025-08-13T13:24:20Z
url: https://github.com/astral-sh/ruff/issues/6262
synced_at: 2026-01-07T12:31:12-06:00
---

# exclude pattern with `*` in file name incorrectly matches entire file path

---

_Issue opened by @DetachHead on 2023-08-02 04:21_

```
ruff --exclude foo*.py
```
this incorrectly excludes the file `foo/bar/baz.py`.

since `excludes` takes globs (as mentioned [here](https://beta.ruff.rs/docs/configuration/#pyprojecttoml-discovery)), i would expect it to only match python files with names starting with `foo`.

i'm on windows (which uses `\` as path separators instead of `/`), that may be related

---

_Referenced in [astral-sh/ruff#6225](../../astral-sh/ruff/issues/6225.md) on 2023-08-02 04:24_

---

_Comment by @charliermarsh on 2023-08-02 14:54_

We use `globset` which lets `*` match the path separator by default, but is configurable to disable that behavior (https://docs.rs/globset/latest/globset/#syntax).

@zanieb - could use a second opinion, any objection to changing that?


---

_Assigned to @charliermarsh by @charliermarsh on 2023-08-02 14:59_

---

_Comment by @zanieb on 2023-08-02 19:26_

What are you expected to do to get the desired behavior without `literal_separator` set? What's the point of `**` then?

I'm a little confused that this is the default in `globset` @burntsushi is probably best for a second opinion :D

It'd be a breaking change for us to change this, but I think it'd probably be best to match Unix shell behavior.

---

_Comment by @BurntSushi on 2023-08-02 20:00_

On mobile so apologies for short reply.

Globbing is pretty tricky because it depends on the context in which it is run. For example, at a shell, you might expect `*.py` to only match Python files in the current directory, but in a `.gitignore` file you would expect (and is what happens) `*.py` to exclude both `foo.py` and `bar/foo.py`. In the gitignore world, you would restrict your glob to the current directory (relative to the `.gitignore` file) by prefixing the glob with a `/`. So, `/*.py` would match `foo.py` but not `bar/foo.py`.

So whether `*.py` is supposed to match a path separator or not depends a lot on the context in which a glob is applied. But generally speaking, for exclude rules I would try to follow what gitignore does. (With that said, I haven't looked at in detail the context here, so take what I'm saying with a grain of salt.)

---

_Comment by @charliermarsh on 2023-08-02 20:03_

Thanks! I'm impressed that you can manage code formatting on mobile.

---

_Comment by @charliermarsh on 2023-08-02 20:12_

We have kind of a weird thing going on, which I think I followed from Flake8 or Black. When given a pattern like `foo*.py`, we match against _both_ the basename and the absolute path (when testing to exclude a given file or directory).

So it may make sense to turn on `literal_separator`, since we'd still match `*.py` on the cases described above. Or we may want to reconsider our behavior here more holistically.

---

_Comment by @BurntSushi on 2023-08-02 20:17_

> Or we may want to reconsider our behavior here more holistically.

ðŸ‘ 


---

_Label `cli` added by @charliermarsh on 2023-08-02 21:31_

---

_Label `needs-decision` added by @charliermarsh on 2023-08-02 21:31_

---

_Comment by @tylerlaprade on 2023-08-02 22:02_

>Thanks! I'm impressed that you can manage code formatting on mobile.

I'm not sure about Android, but if you long-press the `'` key on the standard iPhone keyboard it will give you a contextual menu of other apostrophe-like characters, including `` ` ``.

---

_Comment by @KotlinIsland on 2023-08-03 02:06_

> > Thanks! I'm impressed that you can manage code formatting on mobile.
> 
> I'm not sure about Android, but if you long-press the `'` key on the standard iPhone keyboard it will give you a contextual menu of other apostrophe-like characters, including `` ` ``.

On Android, the long press variations for `'` do not include `` ` ``, but you can instead do:
`?123` -> `=\<` -> `` ` ``

---

_Comment by @JP-Ellis on 2023-11-03 01:00_

Came here because I was having an issue with the globs unexpectedly including subdirectories.

In my case, I am trying to exclude `tests/*.py` (which contains an old codebase which will be deprecated) while including `tests/v3/*.py`. Following the documentation:

> - Relative patterns, like `directory/foo.py` (to exclude that specific file) or `directory/*.py` (to exclude any Python files in directory). Note that these paths are relative to the project root (e.g., the directory containing your `pyproject.toml`).

I added:

```toml
[tool.ruff]
extend-exclude = ["tests/*.py"]
```

I was surprised to find out that this excluded all Python files in `tests/` _and subdirectories thereof_. As pointed out above, it brings into question the purpose of having both `*` and `**`. Being a glob pattern, Ruff's behaviour also doesn't match a standard shell glob (e.g., `ls tests/*.py` does not list files in `tests/v3/`)

---

_Referenced in [pact-foundation/pact-python#458](../../pact-foundation/pact-python/issues/458.md) on 2023-11-06 03:39_

---

_Referenced in [astral-sh/ruff#11139](../../astral-sh/ruff/pulls/11139.md) on 2024-04-25 02:16_

---

_Comment by @MichaReiser on 2024-06-25 10:47_

Related https://github.com/astral-sh/ruff/issues/8267

---

_Comment by @max-sixty on 2024-09-18 23:59_

Is it currently possible to exclude python files in the root directory without excluding python files in every subdirectory?

The current approach seems different from both gitignore and standard globs, instead a third thing:

> Globbing is pretty tricky because it depends on the context in which it is run. For example, at a shell, you might expect `*.py` to only match Python files in the current directory, but in a `.gitignore` file you would expect (and is what happens) `*.py` to exclude both `foo.py` and `bar/foo.py`. In the gitignore world, you would restrict your glob to the current directory (relative to the `.gitignore` file) by prefixing the glob with a `/`. So, `/*.py` would match `foo.py` but not `bar/foo.py`.

...in no case would we expect `/*.py` to match all python files â€” which IIUC is what ruff currently does?

---

_Comment by @JP-Ellis on 2024-09-19 01:07_

For visibility, I think [my comment](https://github.com/astral-sh/ruff/pull/11139#issuecomment-2188635361) to my (closed) PR addressing this is quite relevant here:

> While I am open to suggestions for this PR, I do think that it would be good to follow a widely accepted convention such as the [`gitignore` specification](https://git-scm.com/docs/gitignore#_pattern_format). Specifically the following from the specification:
> 
> > * An asterisk `*` matches anything except a slash. The character `?` matches any one character except `/`. The range notation, e.g. `[a-zA-Z]`, can be used to match one of the characters in a range. See fnmatch(3) and the FNM_PATHNAME flag for a more detailed description.
> > 
> > Two consecutive asterisks (`**`) in patterns matched against full pathname may have special meaning:
> > 
> > * A leading `**` followed by a slash means match in all directories. For example, `**/foo` matches file or directory `foo` anywhere, the same as pattern `foo`. `**/foo/bar` matches file or directory `bar` anywhere that is directly under directory `foo`.
> > * A trailing `/**` matches everything inside. For example, `abc/**` matches all files inside directory `abc`, relative to the location of the `.gitignore` file, with infinite depth.
> > * A slash followed by two consecutive asterisks then a slash matches zero or more directories. For example, `a/**/b` matches `a/b`, `a/x/b`, `a/x/y/b` and so on.
> > * Other consecutive asterisks are considered regular asterisks and will match according to the previous rules.

Implementing the `.gitignore` logic as to the meaning of a leading forward slash, `/`, would be good as well to distinguish `/*.py` and `*.py`.

---

_Comment by @JP-Ellis on 2025-04-12 08:09_

I'm wondering what the desire is for implementing this (given my PR was closed)?

I understand it _**is**_ a breaking change, so I am sympathetic with the reluctance; but I also would like to avoid cumbersome patterns [like these](https://github.com/pact-foundation/pact-python/blob/2e2a0861c57618c316ae50d345d603a9c9071783/pyproject.toml#L247-L283).

Is this perhaps planned for an eventual `v1` release? Or could we introduce new `include` and `exclude` config keys as an opt-in way to do this?

---

_Comment by @zanieb on 2025-04-15 20:21_

I think @konstin and @MichaReiser have also been thinking about this recently

---

_Comment by @MichaReiser on 2025-04-22 09:32_

Our plan for red knot is to have either an `include` and `exclude` (or both?) that support git patterns. Whether we bring this behavior to ruff depends on how it proves in practice and the timeline for using Red Knot's infrastructure for Ruff. 

---

_Referenced in [astral-sh/ty#176](../../astral-sh/ty/issues/176.md) on 2025-06-02 16:02_

---

_Comment by @nedbat on 2025-08-01 20:26_

I tried to only format Python files in the top-level directories, so used `include = ["*/*.py"]`   This found all Python files in the whole tree.  As @zanieb points out earlier, the way globset is being used, "*" and "**" are the same, removing power from the user.   "*" should not match path separators.

BTW: The docs say, "go read the globset docs" without mentioning what options are in use, making this behavior difficult to read about.

---

_Referenced in [astral-sh/ruff#19841](../../astral-sh/ruff/pulls/19841.md) on 2025-08-10 13:07_

---

_Referenced in [astral-sh/ruff#21425](../../astral-sh/ruff/issues/21425.md) on 2025-11-13 23:23_

---
