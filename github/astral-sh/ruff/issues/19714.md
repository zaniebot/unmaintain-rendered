---
number: 19714
title: Many C4 rules’ fixes should be safe when no comments are deleted
type: issue
state: open
author: dscorbett
labels:
  - fixes
  - preview
assignees: []
created_at: 2025-08-03T19:27:52Z
updated_at: 2025-08-04T22:48:25Z
url: https://github.com/astral-sh/ruff/issues/19714
synced_at: 2026-01-07T12:31:13-06:00
---

# Many C4 rules’ fixes should be safe when no comments are deleted

---

_Issue opened by @dscorbett on 2025-08-03 19:27_

### Summary

Many C4 rules’ fixes are marked unsafe with this rationale:
>This rule's fix is marked as unsafe, as it may occasionally drop comments when rewriting the call. In most cases, though, comments will be preserved.

The fixes should be marked safe when no comments are dropped. This affects:

* [`unnecessary-generator-list` (C400)](https://docs.astral.sh/ruff/rules/unnecessary-generator-list/)
* [`unnecessary-generator-set` (C401)](https://docs.astral.sh/ruff/rules/unnecessary-generator-set/)
* [`unnecessary-generator-dict` (C402)](https://docs.astral.sh/ruff/rules/unnecessary-generator-dict/)
* [`unnecessary-literal-set` (C405)](https://docs.astral.sh/ruff/rules/unnecessary-literal-set/)
* [`unnecessary-literal-dict` (C406)](https://docs.astral.sh/ruff/rules/unnecessary-literal-dict/)
* [`unnecessary-collection-call` (C408)](https://docs.astral.sh/ruff/rules/unnecessary-collection-call/)
* [`unnecessary-literal-within-tuple-call` (C409)](https://docs.astral.sh/ruff/rules/unnecessary-literal-within-tuple-call/)
* [`unnecessary-literal-within-list-call` (C410)](https://docs.astral.sh/ruff/rules/unnecessary-literal-within-list-call/)
* [`unnecessary-list-call` (C411)](https://docs.astral.sh/ruff/rules/unnecessary-list-call/)
* [`unnecessary-map` (C417)](https://docs.astral.sh/ruff/rules/unnecessary-map/)
* [`unnecessary-literal-within-dict-call` (C418)](https://docs.astral.sh/ruff/rules/unnecessary-literal-within-dict-call/)

[Example](https://play.ruff.rs/a9f18534-0333-4b7a-8dfe-a785854af535):

```console
$ cat >c4.py <<'# EOF'
list(int(x) for x in "12")
set(int(x) for x in "12")
dict((x, int(x)) for x in "12")
set([1, 2])
dict([(1, 2), (3, 4)])
dict()
tuple([1, 2])
list([1, 2])
list([int(x) for x in "12"])
map(lambda x: x + 1, (1, 2))
dict({})
# EOF

$ ruff --isolated check c4.py --select C4 --output-format concise
c4.py:1:1: C400 Unnecessary generator (rewrite as a list comprehension)
c4.py:2:1: C401 Unnecessary generator (rewrite as a set comprehension)
c4.py:3:1: C402 Unnecessary generator (rewrite as a dict comprehension)
c4.py:4:1: C405 Unnecessary list literal (rewrite as a set literal)
c4.py:5:1: C406 Unnecessary list literal (rewrite as a dict literal)
c4.py:6:1: C408 Unnecessary `dict()` call (rewrite as a literal)
c4.py:7:1: C409 Unnecessary list literal passed to `tuple()` (rewrite as a tuple literal)
c4.py:8:1: C410 Unnecessary list literal passed to `list()` (remove the outer call to `list()`)
c4.py:9:1: C411 Unnecessary `list()` call (remove the outer call to `list()`)
c4.py:10:1: C417 Unnecessary `map()` usage (rewrite using a generator expression)
c4.py:11:1: C418 Unnecessary dict literal passed to `dict()` (remove the outer call to `dict()`)
Found 11 errors.
No fixes available (11 hidden fixes can be enabled with the `--unsafe-fixes` option).
```

If any of these rules has another reason to always be marked unsafe, it should be documented.

### Version

ruff 0.12.7 (c5ac99889 2025-07-29)

---

_Comment by @ntBre on 2025-08-04 22:48_

Thanks! We should double check these in line with https://github.com/astral-sh/ruff/issues/15584 to make sure there are no other reasons for unsafety, and then we can promote the fixes to safe under `preview`, if we don't find any. 

To anyone looking into these, I'd suggest breaking PRs up with one per rule, unless they look really small. There are usually still a fair number of changes with adding a new `preview` function, new preview tests, and the actual rule change to make the fix conditionally safe.

---

_Label `fixes` added by @ntBre on 2025-08-04 22:48_

---

_Label `preview` added by @ntBre on 2025-08-04 22:48_

---
