---
number: 6600
title: "Formatting breaks in `with` statement with leading comments on `as`"
type: issue
state: closed
author: dhruvmanila
labels:
  - bug
  - formatter
assignees: []
created_at: 2023-08-15T16:56:13Z
updated_at: 2023-08-18T03:30:40Z
url: https://github.com/astral-sh/ruff/issues/6600
synced_at: 2026-01-07T12:31:12-06:00
---

# Formatting breaks in `with` statement with leading comments on `as`

---

_Issue opened by @dhruvmanila on 2023-08-15 16:56_

```python
with test as (
    # test
foo):
    pass
```

The above code gets formatted to:

```python
with test as
# test
(foo):
    pass
```

Most likely this can be handled in a similar manner as done in #6594 

---

_Label `bug` added by @dhruvmanila on 2023-08-15 16:56_

---

_Label `formatter` added by @dhruvmanila on 2023-08-15 16:56_

---

_Comment by @charliermarsh on 2023-08-15 17:00_

Let's hold off on debugging until #6485 is merged as it may change how the comment is placed.

---

_Comment by @charliermarsh on 2023-08-15 19:25_

Looks like this is still a problem.

---

_Assigned to @charliermarsh by @charliermarsh on 2023-08-15 19:55_

---

_Comment by @charliermarsh on 2023-08-16 03:45_

It looks like there are a lot of deviations in our `with` formatting, I need to revisit it holistically.

---

_Added to milestone `Formatter: Alpha` by @MichaReiser on 2023-08-16 07:12_

---

_Referenced in [astral-sh/ruff#6621](../../astral-sh/ruff/pulls/6621.md) on 2023-08-16 16:34_

---

_Closed by @charliermarsh on 2023-08-18 03:30_

---
