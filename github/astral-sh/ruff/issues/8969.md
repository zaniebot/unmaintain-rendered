---
number: 8969
title: "`PLR1736` yields invalid suggestion and unsafe fix that changes semantics."
type: issue
state: closed
author: Skylion007
labels:
  - bug
assignees: []
created_at: 2023-12-02T17:09:55Z
updated_at: 2023-12-02T18:17:19Z
url: https://github.com/astral-sh/ruff/issues/8969
synced_at: 2026-01-07T12:31:12-06:00
---

# `PLR1736` yields invalid suggestion and unsafe fix that changes semantics.

---

_Issue opened by @Skylion007 on 2023-12-02 17:09_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->
```python
l = list(range(1, 10))
b = []
for i, a in enumerate(l):
    if a < 5:
        a = -a
    b.append(l[i])
assert b == l, "b and l should match"
```
but it gets flagged and transform by the fixes into
```python
l = list(range(1, 10))
b = []
for i, a in enumerate(l):
    if a < 5:
        a = -a
    b.append(a)
assert b == l, "b and l should match"
```
which is wrong and now fails the assert. Seems like the refactor may have missed this test case. I ran this test on the PR before it was merged a few weeks agi and it ran fine so it might have something to do with either last minute changes to the PR or changes @charliermarsh made to the PR after it was merged (https://github.com/astral-sh/ruff/pull/8932). This is a contrived example with an unused, but it's simplified from a real failure case in `torch/optim/adamw.py` in the pytorch repo.

Current ruff version is a build done on the latest master as of today 2023/12/2.

---

_Comment by @Skylion007 on 2023-12-02 17:18_

I flagged a similar issue here: https://github.com/astral-sh/ruff/pull/7999#issuecomment-1793503531 in the PR, but that one appeared to be fixed.

---

_Comment by @charliermarsh on 2023-12-02 17:24_

Thanks, will fix. Just confirming, this isnâ€™t released yet, right?

---

_Comment by @Skylion007 on 2023-12-02 17:34_

Correct, and it's still a preview rule.

---

_Referenced in [astral-sh/ruff#8970](../../astral-sh/ruff/pulls/8970.md) on 2023-12-02 18:12_

---

_Label `bug` added by @charliermarsh on 2023-12-02 18:12_

---

_Comment by @charliermarsh on 2023-12-02 18:15_

Awesome, thanks for reporting from `main`!

---

_Closed by @charliermarsh on 2023-12-02 18:17_

---
