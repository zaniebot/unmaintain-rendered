---
number: 20610
title: ANN2 fixes can add return types that are shadowed
type: issue
state: closed
author: dscorbett
labels:
  - bug
  - fixes
assignees: []
created_at: 2025-09-28T18:06:39Z
updated_at: 2025-10-02T22:44:07Z
url: https://github.com/astral-sh/ruff/issues/20610
synced_at: 2026-01-07T12:31:13-06:00
---

# ANN2 fixes can add return types that are shadowed

---

_Issue opened by @dscorbett on 2025-09-28 18:06_

### Summary

The fixes for [`missing-return-type-undocumented-public-function` (ANN201)](https://docs.astral.sh/ruff/rules/missing-return-type-undocumented-public-function/), [`missing-return-type-private-function` (ANN202)](https://docs.astral.sh/ruff/rules/missing-return-type-private-function/), [`missing-return-type-special-method` (ANN204)](https://docs.astral.sh/ruff/rules/missing-return-type-special-method/), [`missing-return-type-static-method` (ANN205)](https://docs.astral.sh/ruff/rules/missing-return-type-static-method/), and [`missing-return-type-class-method` (ANN206)](https://docs.astral.sh/ruff/rules/missing-return-type-class-method/) add return types without checking for shadowed variables, which can cause type-checking errors. They should use [`get_or_import_builtin_symbol`](https://github.com/astral-sh/ruff/blob/0.13.2/crates/ruff_linter/src/importer/mod.rs#L285) or similar. [Example](https://play.ruff.rs/816d2f85-9113-4039-8009-35420b66fe07):
```console
$ cat >ann2.py <<'# EOF'
from collections import UserString as str
from typing import override
def foo(): return "!"
def _foo(): return "!"
class C:
    @override
    def __str__(self): return "!"
    @staticmethod
    def foo(): return "!"
    @classmethod
    def bar(cls): return "!"
# EOF

$ ruff --isolated check --select ANN201,ANN202,ANN204,ANN205,ANN206 ann2.py --unsafe-fixes --fix
Found 5 errors (5 fixed, 0 remaining).

$ mypy ann2.py
ann2.py:3: error: Incompatible return value type (got "str", expected "UserString")  [return-value]
ann2.py:4: error: Incompatible return value type (got "str", expected "UserString")  [return-value]
ann2.py:7: error: Return type "UserString" of "__str__" incompatible with return type "str" in supertype "builtins.object"  [override]
ann2.py:7: error: Incompatible return value type (got "str", expected "UserString")  [return-value]
ann2.py:9: error: Incompatible return value type (got "str", expected "UserString")  [return-value]
ann2.py:11: error: Incompatible return value type (got "str", expected "UserString")  [return-value]
Found 6 errors in 1 file (checked 1 source file)
```

### Version

ruff 0.13.2 (b0bdf0334 2025-09-25)

---

_Referenced in [astral-sh/ruff#20612](../../astral-sh/ruff/pulls/20612.md) on 2025-09-28 19:18_

---

_Label `bug` added by @ntBre on 2025-09-29 20:54_

---

_Label `fixes` added by @ntBre on 2025-09-29 20:54_

---

_Closed by @ntBre on 2025-10-02 22:44_

---
