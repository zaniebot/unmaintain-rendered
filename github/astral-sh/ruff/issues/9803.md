---
number: 9803
title: "`unused-function-argument` (`ARG001`) - false positive on pytest `hookspec` functions"
type: issue
state: open
author: DetachHead
labels:
  - rule
assignees: []
created_at: 2024-02-02T22:04:12Z
updated_at: 2024-02-05T01:38:11Z
url: https://github.com/astral-sh/ruff/issues/9803
synced_at: 2026-01-07T12:31:13-06:00
---

# `unused-function-argument` (`ARG001`) - false positive on pytest `hookspec` functions

---

_Issue opened by @DetachHead on 2024-02-02 22:04_

in pytest, a new hook function is defined using the `hookspec` decorator, and the function has no implementation as it's basically like an abstract method:

```py
from pytest import hookspec

@hookspec
def pytest_foo(value: int):  # error Unused function argument: `value`
    ...
```
[playground](https://play.ruff.rs/c8a25959-2278-4072-95ed-9894874dae5e)

ruff could detect the use of the `hookspec` decorator and not report the error here.

related:
- #7286 
- https://github.com/pytest-dev/pytest/issues/11300

---

_Comment by @charliermarsh on 2024-02-02 22:05_

We should be able to support this. Can you link to any relevant docs on `hookspec`?

---

_Comment by @DetachHead on 2024-02-03 00:25_

https://docs.pytest.org/en/7.1.x/how-to/writing_hook_functions.html#declaring-new-hooks

a couple things worth noting:
- the `hookspec` decorator isn't actually required to declare a hook. instead you have to hook `pytest_addhooks` and register the whole module:
  ```py
  # foo/hooks.py
  from pytest import hookspec
  
  def pytest_foo(value: int):
      ...
  ```
  ```py
  # conftest.py
  def pytest_addhooks(pluginmanager):
      from foo import hooks
  
      pluginmanager.add_hookspecs(hooks)
  ```
  as far as i can tell the `hookspec` decorator is mainly used to specify additional options to individual hooks (so it's not needed if you are just using the default options). however using the decorator without any options like in my original example is perfectly valid, and a good way to let ruff know it's a hookspec without needing multi-file analysis (#7447)

- pytest' plugin functionality comes from [pluggy](https://pluggy.readthedocs.io/en/stable/), so ideally ruff would also recognize hookspecs in any project that uses pluggy. however since decorators are defined like this, it would either need multi-file analysis to work, or just assume any decorator called `hookspec` is a pluggy hook:
  ```py
  hookspec = pluggy.HookspecMarker("myproject")
  hookimpl = pluggy.HookimplMarker("myproject")
  ```

---

_Comment by @charliermarsh on 2024-02-05 00:41_

Assuming it's defined within the same file (which seems common), we _could_ detect that `@hookspec` resolves to `hookspec = HookspecMarker("...")`.

---

_Label `rule` added by @charliermarsh on 2024-02-05 00:41_

---

_Comment by @DetachHead on 2024-02-05 01:38_

would still require special casing for pytest, since its `hookspec` decorators are defined in a different file to where they're used in plugins

---

_Referenced in [astral-sh/ruff#10645](../../astral-sh/ruff/issues/10645.md) on 2024-03-28 13:52_

---

_Referenced in [DetachHead/basedpyright#311](../../DetachHead/basedpyright/issues/311.md) on 2024-08-17 08:11_

---

_Referenced in [DetachHead/basedpyright#1240](../../DetachHead/basedpyright/issues/1240.md) on 2025-04-20 01:59_

---
