---
number: 11398
title: FURB110 may break code 
type: issue
state: closed
author: martinlehoux
labels:
  - bug
  - fixes
assignees: []
created_at: 2024-05-13T07:55:28Z
updated_at: 2024-05-19T03:17:12Z
url: https://github.com/astral-sh/ruff/issues/11398
synced_at: 2026-01-07T12:31:13-06:00
---

# FURB110 may break code 

---

_Issue opened by @martinlehoux on 2024-05-13 07:55_


* Keywords: FURB110
* Command: `ruff --preview --select FURB110 --fix`
* Ruff version: 0.4.3

FURB110 autofix (with preview) changed code
```py
place_id = (
    location_place_id
    if location_place_id
    else City.objects.get(pk=city_id).gmaps_place_id
    if city_id
    else None
)    
```
into
```py
place_id = location_place_id or City.objects.get(pk=city_id).gmaps_place_id if city_id else None
```

With inputs `location_place_id = "abc"` and `city_id = None`, the code previously returned "abc" but now returns None

---

_Comment by @VascoSch92 on 2024-05-13 08:03_

Could you provide a minimal code snippet to try?

---

_Comment by @blueraft on 2024-05-13 11:01_

I'm able to reproduce it using the following example.

```sh
❯ bat test.py
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: test.py
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ location_place_id = "abc"
   2   │ city_id = None
   3   │ place_id = (
   4   │     location_place_id
   5   │     if location_place_id
   6   │     else "ghi"
   7   │     if city_id
   8   │     else None
   9   │ )
  10   │
  11   │ print(place_id)
───────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ python test.py
abc

```

After running `ruff --fix`.

```sh
❯ ruff check test.py --preview --select FURB110 --fix
Found 1 error (1 fixed, 0 remaining).
❯ bat test.py
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: test.py
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ location_place_id = "abc"
   2   │ city_id = None
   3   │ place_id = (
   4   │     location_place_id or "ghi"
   5   │     if city_id
   6   │     else None
   7   │ )
   8   │
   9   │ print(place_id)
───────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ python test.py
None
```

The correct fix here should wrap the second `or` statement in parentheses. 

```sh
❯ bat test.py
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: test.py
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ location_place_id = "abc"
   2   │ city_id = None
   3   │ place_id = location_place_id or ("ghi" if city_id else None)
   4   │ print(place_id)
───────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ python test.py
abc
```

---

_Comment by @martinlehoux on 2024-05-13 11:34_

Thanks @blueraft , and yes that is exactly the fix I did ;)

---

_Label `bug` added by @charliermarsh on 2024-05-13 13:57_

---

_Label `fixes` added by @charliermarsh on 2024-05-13 13:57_

---

_Comment by @charliermarsh on 2024-05-13 13:57_

Probably a precedence issue.

---

_Comment by @dhruvmanila on 2024-05-13 14:03_

I think the edit content should be generated using the `Generator` to account for precedence as it currently uses raw string:

https://github.com/astral-sh/ruff/blob/1c18408e5223f34857c514c78a3885e102ea39b1/crates/ruff_linter/src/rules/refurb/rules/if_exp_instead_of_or_operator.rs#L85-L92

---

_Comment by @charliermarsh on 2024-05-13 14:05_

Raw strings are better right now IMO since they preserve more of the verbatim content. I think I'd rather augment the fix to parenthesize if needed.

---

_Label `help wanted` added by @charliermarsh on 2024-05-13 17:01_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-05-18 17:24_

---

_Label `help wanted` removed by @charliermarsh on 2024-05-18 20:39_

---

_Referenced in [astral-sh/ruff#11464](../../astral-sh/ruff/pulls/11464.md) on 2024-05-19 03:13_

---

_Closed by @charliermarsh on 2024-05-19 03:17_

---
