---
number: 801
title: "Come up with a more declarative interface for adding simple checks to `Checker`"
type: issue
state: closed
author: charliermarsh
labels:
  - internal
assignees: []
created_at: 2022-11-17T22:27:57Z
updated_at: 2023-09-14T19:50:33Z
url: https://github.com/astral-sh/ruff/issues/801
synced_at: 2026-01-07T12:31:12-06:00
---

# Come up with a more declarative interface for adding simple checks to `Checker`

---

_Issue opened by @charliermarsh on 2022-11-17 22:27_

Right now, whenever we add a check to `Checker`, we have to expand the visit methods.

It'd be nice if we could instead define a mapping from node kind to check methods (and the codes they correspond to), then add those methods to `Checker` ahead-of-time, and iterate over them -- or something like that, I haven't really explored any concrete options. Generally, what I'd like is for adding a check to be closer to "adding a (node, code, method) pair to a list" rather than expanding the `Checker`.

There could also be a benefit here in that if we only add the methods we need ahead-of-time, maybe we can get a small performance gain by avoiding so many `self.settings.enabled` calls, but I'm not sure.

I'd love proposals or ideas here.


---

_Label `internal` added by @charliermarsh on 2022-11-17 22:27_

---

_Comment by @charliermarsh on 2022-11-17 22:29_

The AST structure makes this kind of difficult, because each check function has a slightly different interface. It'd be nice if every `ExprKind` had its own struct, instead of being an enum, so we could define checks as functions on (`Checker`, `ExprKind`).

---

_Comment by @squiddy on 2022-12-18 06:29_

Just putting this up here.

```rust
pub trait AstPass {
    fn check_classdef(&self, checker: &mut Checker, stmt: &Stmt) {}
    fn check_call(&self, checker: &mut Checker, expr: &Expr) {}
    ...
}

pub struct AbstractBaseClass;

impl AstPass for AbstractBaseClass {
    fn check_classdef(&self, checker: &mut Checker, stmt: &Stmt) {
         do_stuff();
    }
}

pub struct UselessExpression;

impl AstPass for UselessExpression {
    fn check_functiondef(&self, checker: &mut Checker, stmt: &Stmt) {
        do_stuff();
    }
}
```

```rust
let passes: Vec<Box<dyn AstPass>> = vec![
    Box::new(flake8_bugbear::plugins::UselessExpressionInfo),
    Box::new(flake8_bugbear::plugins::AbstractBaseClass),
];

// somewhere in the ast checker
for pass in &passes {
    pass.check_classdef(self, &stmt);
}
```

Don't know enough about rust yet to understand any potential performance effect using trait objects here.

---

_Comment by @charliermarsh on 2023-09-14 19:50_

This isn't super actionable -- closing for now.

---

_Closed by @charliermarsh on 2023-09-14 19:50_

---
