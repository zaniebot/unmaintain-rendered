---
number: 1719
title: SIM108 autofix removes comments
type: issue
state: closed
author: twoertwein
labels:
  - fixes
assignees: []
created_at: 2023-01-07T19:50:52Z
updated_at: 2023-01-30T12:29:31Z
url: https://github.com/astral-sh/ruff/issues/1719
synced_at: 2026-01-07T12:31:12-06:00
---

# SIM108 autofix removes comments

---

_Issue opened by @twoertwein on 2023-01-07 19:50_

```py
def test(x: int) -> int:
    if x > 0:
        # test test
        abc = x
    else:
        # test test test
        abc = -x
    return abc
```
ruff --fix  # 0.0.213
```py
def test(x: int) -> int:
    abc = x if x > 0 else -x
    return abc

```

---

_Comment by @messense on 2023-01-08 01:55_

I'm not sure what to do, merge comments together doesn't make much sense to me.

---

_Comment by @twoertwein on 2023-01-08 02:04_

Maybe something like:
```py
def test(x: int) -> int:
    abc = (
        # test test
        x if x > 0 else
        # test test test
        -x
    )
    return abc
```

---

_Comment by @charliermarsh on 2023-01-08 03:00_

My gut reaction is that this is quite hard to get right in the general case. We could try to come up with some formal rules, but it might be easier to just avoid fixing in the event that the snippet contains comments (or make that an option).

---

_Label `autofix` added by @charliermarsh on 2023-01-08 03:17_

---

_Referenced in [astral-sh/ruff#1791](../../astral-sh/ruff/issues/1791.md) on 2023-01-11 22:41_

---

_Comment by @spaceone on 2023-01-11 22:55_

Maybe just ignore the check if there are multiple lines involved?
I got this fix also for this code:

```
                   if parser.errno == BAD_FIRST_LINE:
                      req = wrappers.Request(sock, server=self._server)
                  else:
                      req = wrappers.Request(
                          sock,
                          parser.get_method(),
                          parser.get_scheme() or _scheme,
                          parser.get_path(),
                          parser.get_version(),
                          parser.get_query_string(),
                          server=self._server,
                      ) 
```
and it didn't make the code cleaner.

Duplicate: https://github.com/charliermarsh/ruff/issues/1791#issue-1529813542

---

_Assigned to @charliermarsh by @charliermarsh on 2023-01-11 22:59_

---

_Comment by @spaceone on 2023-01-11 23:00_

See also https://github.com/charliermarsh/ruff/issues/1766

---

_Referenced in [astral-sh/ruff#1802](../../astral-sh/ruff/pulls/1802.md) on 2023-01-12 00:21_

---

_Closed by @charliermarsh on 2023-01-12 00:21_

---

_Comment by @spaceone on 2023-01-30 12:29_

REOPEN:

ruff 0.0.237 just changed this, which ends with a comment:
```
-            if 200 <= exitcode < 300:
-                exitcode = 0
-            else:
-                exitcode = 1  # dooh, sys.exit returns a short, mapping 400 to 144
+            exitcode = 0 if 200 <= exitcode < 300 else 1  # dooh, sys.exit returns a short, mapping 400 to 144 
```

---

_Referenced in [astral-sh/ruff#2351](../../astral-sh/ruff/issues/2351.md) on 2023-01-30 12:37_

---
