---
number: 4103
title: "Request: autofix for EM102 with `msg`"
type: issue
state: closed
author: jamesbraza
labels:
  - fixes
assignees: []
created_at: 2023-04-25T21:44:32Z
updated_at: 2023-04-27T18:53:28Z
url: https://github.com/astral-sh/ruff/issues/4103
synced_at: 2026-01-07T12:31:12-06:00
---

# Request: autofix for EM102 with `msg`

---

_Issue opened by @jamesbraza on 2023-04-25 21:44_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

```python
some_string = "ruff"
raise ValueError(f"Hello {some_string}.")
```

Running with `ruff==0.0.263`:
```
> ruff --fixable=EM102 --fix --select=EM102 a.py
a.py:2:18: EM102 Exception must not use an f-string literal, assign to variable first
Found 1 error.
```

It would be nice if `EM102` supported autofix with `msg` like the [rule explanation](https://beta.ruff.rs/docs/rules/f-string-in-exception/) so:

```python
some_string = "ruff"
msg = f"Hello {some_string}."
raise ValueError(msg)
```

---

_Label `autofix` added by @charliermarsh on 2023-04-25 23:55_

---

_Comment by @charliermarsh on 2023-04-26 00:36_

üëç I think we should be able to support this.

---

_Comment by @dhruvmanila on 2023-04-26 03:35_

What if the `msg` variable is already defined in same or outer scope? Should we try different variable names or maybe a config option for the user to specify the variable name? In any case, this would be a `AutofixKind::Sometimes`.

---

_Comment by @charliermarsh on 2023-04-26 04:24_

I'd suggest just skipping the fix if `msg` is defined in the same scope or any parent scope (but not making the name configurable).

---

_Comment by @dhruvmanila on 2023-04-26 18:05_

I would like to work on this, will get my hands dirty with the autofix API :)

---

_Comment by @charliermarsh on 2023-04-26 18:08_

Rock on, thanks @dhruvmanila! (Know I owe you some responses in other PRs too.)

---

_Assigned to @dhruvmanila by @MichaReiser on 2023-04-26 18:09_

---

_Referenced in [astral-sh/ruff#4123](../../astral-sh/ruff/pulls/4123.md) on 2023-04-26 19:32_

---

_Closed by @charliermarsh on 2023-04-27 18:53_

---
