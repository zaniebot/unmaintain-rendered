---
number: 12408
title: "Setup `--preview` flag for neovim lsp"
type: issue
state: closed
author: eltbus
labels:
  - question
assignees: []
created_at: 2024-07-19T16:33:28Z
updated_at: 2024-07-22T10:52:32Z
url: https://github.com/astral-sh/ruff/issues/12408
synced_at: 2026-01-07T12:31:13-06:00
---

# Setup `--preview` flag for neovim lsp

---

_Issue opened by @eltbus on 2024-07-19 16:33_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

# Keywords
"neovim", "nvim", "lsp", "ruff", "server", "--preview"
# Code/settings example
```
# Using Lazy, inside "neovim/nvim-lspconfig":
["ruff"] = function()
	local lspconfig = require("lspconfig")
	local lsp_python = require("plugins.lsp.python")
	local custom_on_attach = function(client, bufnr)
		on_attach(client, bufnr)
		client.server_capabilities.hoverProvider = false
	end
	lspconfig.ruff.setup {
		on_attach = custom_on_attach,
		capabilities=capabilities,
		on_init = function(client)
			client.config.settings.interpreter = lsp_python.get_python_path(client.config.root_dir)
		end,
		init_options = { settings = { lint = { preview = true } } }
	}
end,
```
# Ruff version
0.5.2

# Issue

On medium to big projects (i.e. [uvicorn](https://github.com/encode/uvicorn)) I get the following warning:
```
[ERROR][2024-07-19 18:03:54] .../vim/lsp/rpc.lua:770	"rpc"	"/Users/eltbus/.local/share/nvim/mason/bin/ruff"	"stderr"	"error: --preview needs to be provided as a command line argument while the server is still unstable.\nFor example: `ruff server --preview`\n"
```

# Question
How can I set that flag while using nvim? I tried the following
```
init_options = { settings = { lint = { preview = true } } }
```

But it does not solve the issue (probably because this is a LINTER option, and not a SERVER option.



---

_Comment by @FishAlchemist on 2024-07-19 17:27_

If you want to enable preview for lint, why not just set it in the configuration file(e.g. pyproject.toml, ruff.toml)?
I just want to know why your usage scenario can't do this.

These are the relevant link to the settings:
https://docs.astral.sh/ruff/settings/#preview
https://docs.astral.sh/ruff/settings/#lint_preview
https://docs.astral.sh/ruff/settings/#format_preview

Edit:
Ruff server (ruff-lsp) was unstable before Ruff version 0.5.3, so the ``preview`` flag needed to be provided. Providing only the preview flag for lint would not allow the Ruff server to be used.


---

_Comment by @T-256 on 2024-07-19 19:21_

> error: --preview needs to be provided as a command line argument while the server is still unstable.

I think update to 0.5.3 will solve it.

---

_Comment by @eltbus on 2024-07-20 06:58_

Update 0.5.3 did indeed solve my issue. Thank you, @T-256!

---

_Comment by @dhruvmanila on 2024-07-22 10:15_

Yes, this was indicated as a breaking change in `nvim-lspconfig` (https://github.com/neovim/nvim-lspconfig/pull/3241). If you've upgrade `nvim-lspconfig` to include that commit, you need to be using a minimum Ruff version of `0.5.3`.

---

_Label `question` added by @dhruvmanila on 2024-07-22 10:18_

---

_Comment by @dhruvmanila on 2024-07-22 10:18_

Closing this issue as resolved. Feel free to ask any other questions that you might have.

---

_Closed by @dhruvmanila on 2024-07-22 10:18_

---

_Comment by @FishAlchemist on 2024-07-22 10:48_

> Yes, this was indicated as a breaking change in `nvim-lspconfig` ([neovim/nvim-lspconfig#3241](https://github.com/neovim/nvim-lspconfig/pull/3241)). If you've upgrade `nvim-lspconfig` to include that commit, you need to be using a minimum Ruff version of `0.5.3`.

Should this PR be mentioned in Editors > Setup > Neovim?

---

_Comment by @dhruvmanila on 2024-07-22 10:52_

> Should this PR be mentioned in Editors > Setup > Neovim?

Yeah, good idea.

---

_Referenced in [astral-sh/ruff#12507](../../astral-sh/ruff/pulls/12507.md) on 2024-07-25 13:58_

---
