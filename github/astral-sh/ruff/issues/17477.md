---
number: 17477
title: False positive for F841 in case clause
type: issue
state: closed
author: Goldziher
labels:
  - question
assignees: []
created_at: 2025-04-19T11:47:55Z
updated_at: 2025-04-22T07:31:49Z
url: https://github.com/astral-sh/ruff/issues/17477
synced_at: 2026-01-07T12:31:13-06:00
---

# False positive for F841 in case clause

---

_Issue opened by @Goldziher on 2025-04-19 11:47_

### Summary

False positive of unused variable

```python
from typing import Final

EVENT_APPLICATION_SETUP: Final[str] = "application_setup"


def match(event_type: str) -> None:
    match event_type:
        case EVENT_APPLICATION_SETUP: # <-- F841 violation
            ...
```

### Version

>=0.11.1

---

_Comment by @maxmynter on 2025-04-19 23:31_

I've looked into this a bit and my hypothesis is that while the `visitor` correctly traverses the AST correctly, the semantic analyzer does not add a reference to the name. We seem to only visit the context, not the constant itself. This results in the false positive if the constant is only used in a `match`.

https://github.com/astral-sh/ruff/blob/da6b68cb58824e52efa2a9ae7ebf3c2cbeacad2d/crates/ruff_python_ast/src/visitor.rs#L523-L525
Note that there is no `visitor.visit_expr(value)` call and the `ast::ExprName` also has no`value` field.

I will do some more digging the coming days. But since I'm new to the codebase, I'm thankful for any pointers

---

_Comment by @ntBre on 2025-04-20 00:20_

I believe this is a duplicate of #16969. Variables in `case` arms must be dotted names if they're meant to refer to existing variables. The `EVENT_APPLICATION_SETUP` in the `case` is a new variable **not** the  `EVENT_APPLICATION_SETUP` outside the `match`, so if you don't use it in the `case` arm it's genuinely unused.

---

_Label `question` added by @ntBre on 2025-04-20 00:21_

---

_Comment by @maxmynter on 2025-04-20 11:50_


Seems like it! The following example, using dotted access, doesn't violate F841:

```python
from dataclasses import dataclass
from typing import Final


@dataclass
class Globals:
    EVENT_APPLICATION_SETUP: Final[str] = "application_setup"


def match(event_type: str) -> None:
    match event_type:
        case Globals.EVENT_APPLICATION_SETUP:
            ...
```

Nice, i learned something new today. I didn't use `match` much in Python before. 


---

_Closed by @MichaReiser on 2025-04-22 07:31_

---
