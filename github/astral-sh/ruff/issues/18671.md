---
number: 18671
title: Invalid f-string conversion type code parses/passes
type: issue
state: closed
author: MeGaGiGaGon
labels:
  - bug
  - parser
assignees: []
created_at: 2025-06-14T00:18:12Z
updated_at: 2025-06-16T16:44:43Z
url: https://github.com/astral-sh/ruff/issues/18671
synced_at: 2026-01-07T12:31:13-06:00
---

# Invalid f-string conversion type code parses/passes

---

_Issue opened by @MeGaGiGaGon on 2025-06-14 00:18_

### Summary

It feels like this code should be rejected, or there should be some sort of lint for this. All three of these f-strings are invalid
```py
f"{1!
r}"
f"{1! r}"
f"{1!\
r}"
```
And raise `SyntaxError: f-string: conversion type must come right after the exclamanation mark`, but it parses/formats with no complaints, even with all lints enabled [playground link](https://play.ruff.rs/f054e9f1-21f8-4b1e-91ad-463f11e54a7f)
(Also I already make a PR in CPython for the typo in the error)

### Version

playground

---

_Renamed from "Valid code parses/passes" to "Invalid f-string conversion type code parses/passes" by @MeGaGiGaGon on 2025-06-14 00:18_

---

_Comment by @MeGaGiGaGon on 2025-06-14 00:40_

You can also use this fact to cause code changing formatting/comment deletion [playground](https://play.ruff.rs/8c0ad55f-181c-4379-9491-a50bb34ea8b7)
```py
f"{1! #test
r:}"
f"{1=! #test
r:}"
```
Formats to
```py
f"{
    1!r:  # test
}"
f"{1=!r:}"
```

---

_Comment by @ntBre on 2025-06-14 15:09_

Thanks! I'll add these to https://github.com/astral-sh/ruff/issues/17412

---

_Comment by @ntBre on 2025-06-14 15:13_

Oh, these are actually reported by the parser, not the compiler. We can just track them here then.

---

_Label `parser` added by @ntBre on 2025-06-14 15:13_

---

_Assigned to @dylwil3 by @dylwil3 on 2025-06-16 12:16_

---

_Referenced in [astral-sh/ruff#18706](../../astral-sh/ruff/pulls/18706.md) on 2025-06-16 12:20_

---

_Label `bug` added by @dylwil3 on 2025-06-16 13:01_

---

_Closed by @dylwil3 on 2025-06-16 16:44_

---
