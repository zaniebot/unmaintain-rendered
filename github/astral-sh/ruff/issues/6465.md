---
number: 6465
title: type-comparison (E721) only works on some builtin classes and nothing else
type: issue
state: closed
author: DetachHead
labels:
  - rule
assignees: []
created_at: 2023-08-10T01:09:13Z
updated_at: 2024-06-25T16:22:46Z
url: https://github.com/astral-sh/ruff/issues/6465
synced_at: 2026-01-07T12:31:12-06:00
---

# type-comparison (E721) only works on some builtin classes and nothing else

---

_Issue opened by @DetachHead on 2023-08-10 01:09_

```py
def asdf(value: object):
    type(value) is str  # error
    type(value) is int  # error
    type(value) is list  # no error
    type(value) is dict  # no error

    class Foo:
        ...

    type(value) is Foo  # no error
```

pylint's `unidiomatic-typecheck` detects all of these cases

---

_Comment by @charliermarsh on 2023-08-10 02:18_

I'm honestly tempted to revert the changes to this rule and just go back to pycodestyle parity, because I don't really understand the contexts in which pycodestyle is meant to be enforcing it, and it doesn't seem worth it to me to keep spending time refining it. (This rule in pycodestyle is _not_ the same as `unidiomatic-typecheck`, and we're now deviating from both subtly.)

For example, pycodestyle allows `type(a1) is type(b1)`, `type(a1) is int`, etc., but disallows `type(a) is type(1)`. I don't really understand it.

Separately, comparing `type(value) is int` is actually reasonable to me in some cases if you want to do a direct comparison, _not_ a subclass comparison. I assume that's why pycodestyle is more limited in its rule.


---

_Label `needs-decision` added by @charliermarsh on 2023-08-10 02:21_

---

_Referenced in [astral-sh/ruff#6468](../../astral-sh/ruff/pulls/6468.md) on 2023-08-10 02:23_

---

_Referenced in [astral-sh/ruff#6469](../../astral-sh/ruff/pulls/6469.md) on 2023-08-10 02:24_

---

_Comment by @charliermarsh on 2023-08-10 02:25_

(I added the missing builtin types at least.)

---

_Referenced in [canonical/cloud-init#4339](../../canonical/cloud-init/issues/4339.md) on 2023-08-14 14:02_

---

_Referenced in [lsst/daf_butler#882](../../lsst/daf_butler/pulls/882.md) on 2023-08-17 23:10_

---

_Referenced in [pymor/pymor#2198](../../pymor/pymor/pulls/2198.md) on 2023-10-09 15:26_

---

_Comment by @bdowning on 2024-01-08 22:42_

IMHO ruff needs to allow stuff like `type(foo) is int`.  flake8 allowed this, it just disallowed `type(foo) == int` and recommended replacing `==` with `is` and _not_ replacing with `isinstance`, which obviously has completely different behavior.  I just had code break from "fixing" lint violations with `isinstance` due to a behavior change (because `bool` is a subclass of `int` for some insane reason).

---

_Comment by @charliermarsh on 2024-01-08 22:51_

@bdowning -- I believe we already allowed that if you run with `--preview`: https://play.ruff.rs/90c3ddba-0c1f-450d-96bc-df09ee8e6adb. (This will become stable behavior when we ship v0.2.0.)

---

_Comment by @bdowning on 2024-01-09 00:13_

Thanks.  BTW, the playground seems more than a little busted on Firefox right now:
![image](https://github.com/astral-sh/ruff/assets/366426/b4af14b3-ca1d-42ac-b532-b0d699ae8f59)


---

_Comment by @bdowning on 2024-02-02 01:13_

@charliermarsh So I updated to 0.2.0 and I'm still only seeing stuff like `type(foo) is int` being allowed with `--preview`.  Did this not make the cut?
```
$ poetry run ruff --version
ruff 0.2.0
$ poetry run ruff xxx/
warning: The top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in `pyproject.toml`:
  - 'ignore' -> 'lint.ignore'
  - 'select' -> 'lint.select'
  - 'isort' -> 'lint.isort'
xxx/yyy.py:193:8: E721 Do not compare types, use `isinstance()`
xxx/yyy.py:195:10: E721 Do not compare types, use `isinstance()`
xxx/yyy.py:199:10: E721 Do not compare types, use `isinstance()`
Found 3 errors.
$ poetry run ruff --preview xxx/
warning: The top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in `pyproject.toml`:
  - 'ignore' -> 'lint.ignore'
  - 'select' -> 'lint.select'
  - 'isort' -> 'lint.isort'
$
```

---

_Comment by @zanieb on 2024-02-02 01:18_

It's possible we missed this in the `0.2.0` stabilizations. For what it's worth, I think this is a bug and we should fix it immediately.



---

_Assigned to @zanieb by @zanieb on 2024-02-02 01:18_

---

_Comment by @bdowning on 2024-04-06 00:03_

@zanieb Any word on this?  Just checked with 0.3.5 and it looks like this is still behind the preview barrier.

---

_Referenced in [pymc-devs/pytensor#596](../../pymc-devs/pytensor/pulls/596.md) on 2024-06-06 14:05_

---

_Comment by @joaoe on 2024-06-07 12:45_

Hi.
I'm hitting this warning.

Now and then I want to do `type(a) is B` or `type(a) is type(c)` to do strict type checking, not subclassing, namely in unit tests.

The `type(...) is ...` check with the `is` operator should be allowed and not trigger a warning, or in an alternative case, produce a separate warning from E721 which we can choose to ignore.
Cheers.

---

_Comment by @dhruvmanila on 2024-06-12 16:39_

@joaoe Can you try your example with `--preview` mode? This is resolved in preview mode, we just need to move it into stable in the next minor release.

---

_Label `needs-decision` removed by @dhruvmanila on 2024-06-12 16:39_

---

_Label `rule` added by @dhruvmanila on 2024-06-12 16:39_

---

_Added to milestone `v0.5.0` by @dhruvmanila on 2024-06-12 16:39_

---

_Comment by @dhruvmanila on 2024-06-12 16:40_

Ok, there's a PR up which will resolve this: https://github.com/astral-sh/ruff/pull/11220

---

_Referenced in [astral-sh/ruff#11220](../../astral-sh/ruff/pulls/11220.md) on 2024-06-25 05:55_

---

_Comment by @dhruvmanila on 2024-06-25 16:22_

The preview logic has been moved to stable and will be released as part of v0.5.

Resolved by #11220 

---

_Closed by @dhruvmanila on 2024-06-25 16:22_

---

_Referenced in [astral-sh/ruff#12005](../../astral-sh/ruff/pulls/12005.md) on 2024-06-26 08:52_

---
