---
number: 10307
title: "Invalid fix for `PYI053` for f-strings"
type: issue
state: closed
author: dhruvmanila
labels:
  - bug
  - fixes
  - linter
assignees: []
created_at: 2024-03-09T09:09:44Z
updated_at: 2024-03-14T08:00:24Z
url: https://github.com/astral-sh/ruff/issues/10307
synced_at: 2026-01-07T12:31:13-06:00
---

# Invalid fix for `PYI053` for f-strings

---

_Issue opened by @dhruvmanila on 2024-03-09 09:09_

Given:

```python
def foo(
    arg2: str = f'51 character {x} stringgggggggggggggggggggggggggggggggggggggggggggg',
) -> None: ...
```

Here, the number of characters after the replacement field is > 50 which is what we flag and fix:

```
src/PYI053.pyi:3:35: PYI053 [*] String and bytes literals longer than 50 characters are not permitted
  |
1 | def foo(
2 |     arg1: str = '51 character stringggggggggggggggggggggggggggggggg',
3 |     arg2: str = f'51 character {x} stringgggggggggggggggggggggggggggggggggggggggggggg',
  |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ PYI053
4 | ) -> None: ...
  |
  = help: Replace with `...`

â„¹ Safe fix
1 1 | def foo(
2 2 |     arg1: str = '51 character stringggggggggggggggggggggggggggggggg',
3   |-    arg2: str = f'51 character {x} stringgggggggggggggggggggggggggggggggggggggggggggg',
  3 |+    arg2: str = f'51 character {x}...',
4 4 | ) -> None: ...

Found 1 error.
[*] 1 fixable with the --fix option.
```

This is not ideal and it raises an interesting question - how to count the characters for an f-string containing replacement fields?
1. `f"one{expr}one"` (6 total or 3 and 3)
2. `"one" f"one{expr}one"` (9 total or 3, 3, 3)
3. `f"one{expr}one" f"one{expr}one"` (12 total or 3, 3, 3, 3)

---

_Label `bug` added by @dhruvmanila on 2024-03-09 09:09_

---

_Comment by @AlexWaygood on 2024-03-09 10:01_

(I don't think there's a use case for having f-strings in a `.pyi` file, FWIW, so I think the correctness issue with this specific rule is _unlikely_ to come up in real life. The broader issue you're pointing to is obviously still valid, however :)

---

_Referenced in [astral-sh/ruff#10311](../../astral-sh/ruff/pulls/10311.md) on 2024-03-09 11:29_

---

_Comment by @zanieb on 2024-03-09 15:08_

This is such a weird "safe fix". Does this actually have any effect? Will an IDE hint the wrong default value now?

---

_Comment by @dhruvmanila on 2024-03-10 03:12_

> Will an IDE hint the wrong default value now?

Yeah, Ruff will basically replace only part of a f-string. The linked PR has a solution to instead count all of the characters in a f-string and replace the _entire_ f-string if it's > 50 instead.

---

_Label `fixes` added by @zanieb on 2024-03-11 16:53_

---

_Label `linter` added by @zanieb on 2024-03-11 16:53_

---

_Closed by @dhruvmanila on 2024-03-14 08:00_

---
