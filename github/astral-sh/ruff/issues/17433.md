---
number: 17433
title: Ruff github format uses absolute paths which break annotation placement
type: issue
state: open
author: sochotnicky
labels:
  - bug
assignees: []
created_at: 2025-04-16T19:07:26Z
updated_at: 2025-04-17T06:05:07Z
url: https://github.com/astral-sh/ruff/issues/17433
synced_at: 2026-01-07T12:31:13-06:00
---

# Ruff github format uses absolute paths which break annotation placement

---

_Issue opened by @sochotnicky on 2025-04-16 19:07_

### Summary

I'm running ruff in a Github Enterprise environment and can't seem to force github annotation output no matter what I do.

Slightly redacted snippet of logs:
```
...
2025-04-16T17:22:40.1751001Z [36;1mvenv/bin/ruff check --output-format=github .[0m
2025-04-16T17:22:40.1768217Z shell: /usr/bin/bash -e {0}
2025-04-16T17:22:40.1768619Z env:
2025-04-16T17:22:40.1768918Z   RUFF_OUTPUT_FORMAT: github
2025-04-16T17:22:40.1769321Z   pythonioencoding: utf-8
2025-04-16T17:22:40.1770211Z   pythonLocation: /opt/github-actions-runner2/_work/_tool/Python/3.12.8/x64
2025-04-16T17:22:40.1771299Z   PKG_CONFIG_PATH: /opt/github-actions-runner2/_work/_tool/Python/3.12.8/x64/lib/pkgconfig
2025-04-16T17:22:40.1772368Z   Python_ROOT_DIR: /opt/github-actions-runner2/_work/_tool/Python/3.12.8/x64
2025-04-16T17:22:40.1773358Z   Python2_ROOT_DIR: /opt/github-actions-runner2/_work/_tool/Python/3.12.8/x64
2025-04-16T17:22:40.1774531Z   Python3_ROOT_DIR: /opt/github-actions-runner2/_work/_tool/Python/3.12.8/x64
2025-04-16T17:22:40.1775829Z   LD_LIBRARY_PATH: /opt/github-actions-runner2/_work/_tool/Python/3.12.8/x64/lib:
2025-04-16T17:22:40.1776760Z ##[endgroup]
2025-04-16T17:22:40.2024874Z ##[error]canary.py:15:13: PLW2901 Outer `for` loop variable `i` overwritten by inner `for` loop target
2025-04-16T17:22:40.2036060Z ##[error]canary.py:15:13: B007 Loop control variable `i` not used within loop body
2025-04-16T17:22:40.2039994Z ##[error]Process completed with exit code 1.
2025-04-16T17:22:40.2142559Z Post job cleanup.
...
```

As can be seen above - ruff is run with `--output-format=github` (with env var as a bonus). But it still outputs concise output. Adding the output-format to `pyproject.toml` has no impact either.

I can not reproduce this outside a GH actions run. Even on the same machine setting as much of the environment to the same state. 

I've tried downgrading and can reproduce all the way to 0.1.0 (haven't tried further).

I'm happy to dig through the code but I am out of ideas. Neither of the following looks suspicious to me
* https://github.com/astral-sh/ruff/tree/1a79722ee0fb160f8929612508d5ee88b7838d09/crates/ruff_linter/src/message/github.rs 
* https://github.com/astral-sh/ruff/tree/1a79722ee0fb160f8929612508d5ee88b7838d09/crates/ruff/src/printer.rs

For example using `--output-format=json-lines` works as expected though

### Version

0.11.5

---

_Comment by @sochotnicky on 2025-04-16 20:46_

I'm working around with something like this:
`venv/bin/ruff check -v --output-format=json-lines . | sed "s:$(pwd)/::" | jq -rs '.[] | "::error title=Ruff (\(.code)),file=\(.filename),line=\(.location.row),col=\(.location.column),endLine=\(.end_location.row),endColumn=\(.end_location.column)::\(.message) -- \(.url)"'`

It works quite well 

---

_Comment by @sochotnicky on 2025-04-16 21:03_

Actually I think I found the problem - there's no `relativize_path` called on annotation. Will submit a PR

---

_Referenced in [astral-sh/ruff#17435](../../astral-sh/ruff/pulls/17435.md) on 2025-04-16 21:10_

---

_Label `bug` added by @ntBre on 2025-04-16 21:23_

---

_Renamed from "Ruff ignores --output-format=github in some cases" to "Ruff github format uses absolute paths which break annotation placement" by @sochotnicky on 2025-04-17 06:05_

---

_Referenced in [randombit/botan#5090](../../randombit/botan/pulls/5090.md) on 2025-09-03 19:49_

---
