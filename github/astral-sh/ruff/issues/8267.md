---
number: 8267
title: "`format|lint.exclude` does not exclude directories"
type: issue
state: open
author: MichaReiser
labels:
  - cli
assignees: []
created_at: 2023-10-27T00:03:13Z
updated_at: 2025-10-07T14:49:11Z
url: https://github.com/astral-sh/ruff/issues/8267
synced_at: 2026-01-07T12:31:12-06:00
---

# `format|lint.exclude` does not exclude directories

---

_Issue opened by @MichaReiser on 2023-10-27 00:03_

Given:

```toml
[tool.ruff.lint]
exclude = ["directory"]
```

with `foo.py` in `directory`

```python
import os
```

```bash
cargo run -p ruff_cli -- check .
    Finished dev [unoptimized + debuginfo] target(s) in 0.10s
     Running `/Users/crmarsh/workspace/ruff/target/debug/ruff check .`
warning: Detected debug build without --no-cache.
directory/foo.py:1:8: F401 [*] `os` imported but unused
Found 1 error.
```

The file is excluded when changing the configuration to 

```toml
[tool.ruff.lint]
exclude = ["directory/*"]
```

or

```toml
[tool.ruff]
exclude = ["directory"]
```

---

_Label `cli` added by @MichaReiser on 2023-10-27 00:03_

---

_Referenced in [astral-sh/ruff#8241](../../astral-sh/ruff/issues/8241.md) on 2023-10-27 00:03_

---

_Comment by @MichaReiser on 2023-10-27 00:04_

I'm undecided if this is a bug or matches the documented behavior. It certainly is unexpected that the path works in one but not the other. But reading our documentation and globset, excluding the entire directory would require using `directory/**`

---

_Added to milestone `Formatter: Stable` by @MichaReiser on 2023-10-27 00:04_

---

_Comment by @dhruvmanila on 2023-10-27 08:32_

(I've updated the second configuration to use `exclude = ["directory/*"]` which is what I think you meant?)

---

_Comment by @MichaReiser on 2023-10-27 08:34_

> (I've updated the second configuration to use `exclude = ["directory/*"]` which is what I think you meant?)

What was it before xD I think it works if `exclude` is either `"directory/**`, `"directory/*` or if using the global exclude. 

---

_Comment by @MichaReiser on 2023-10-27 09:43_

This PR adds a test demonstrating the behavior.

https://github.com/astral-sh/ruff/pull/8276

I'm not sure how to fix this yet without trying to match all parent sub-paths of a file. The alternative is to change the semantics of `tool.exclude` to be explicit that it only matches on files. We may want to rename the option in that case (`exclude-files` or `file-ignores`). @charliermarsh any ideas/thoguhts on this?

---

_Referenced in [home-assistant/core#102893](../../home-assistant/core/pulls/102893.md) on 2023-10-27 11:04_

---

_Comment by @MichaReiser on 2023-10-29 23:36_

I think I have an idea on how to approach this. It's not elegant, but could work. 

The idea is to add two patterns for each entry in `tool.exclude`:

1. The pattern as specified in the configuration
2. The pattern with a `/**/*` suffix to ensure it matches all files if the pattern excludes a directory

It may not always be necessary to add the extra pattern.

---

_Assigned to @MichaReiser by @MichaReiser on 2023-10-30 00:48_

---

_Comment by @dhruvmanila on 2023-10-30 03:18_

This could work. We should probably only check if it's not already suffixed with a glob pattern (`*`, `**`, `**/*`, `*.{ext}`).

---

_Comment by @MichaReiser on 2023-10-30 03:23_

Yeah, this could be an optimisation. But I'm not sure about: ` *.{ext}` because you can have a `test/a.py` directory (not that I would recommend it but you can ;))

---

_Comment by @dhruvmanila on 2023-10-30 03:27_

Haha yeah, although what I meant was the literal value if I'm not mis-interpreting what you said. So, ignoring `test/*.py` as that explicitly mentions the glob pattern.

---

_Comment by @MichaReiser on 2023-10-30 06:23_

I have to spend some more time on this to fully understand the semantics of `exclude`. I assumed it matches the `gitignore` syntax but aren't so sure about it anymore.

For example, `logs` matches  `logs`, `logs/debug.log`, `logs/latest/foo.bar`,  `build/logs`, and `build/logs/debug.log` according to [atlassian](https://www.atlassian.com/git/tutorials/saving-changes/gitignore#git-ignore-patterns). I believe our system correctly handles directories called `logs` or files called logs, but not `build/logs/debug.log`. 

The idea is to create a new integration test file that tests various exclusion patterns, and then try to come up with a fix. I wonder if we could rely more on the `ignore` crate, to model our own exclusions.

---

_Comment by @MichaReiser on 2023-11-02 09:01_

Something similar to https://github.com/BurntSushi/ripgrep/blob/master/crates/ignore/src/gitignore.rs#L32-L43 could be useful. 

---

_Removed from milestone `Formatter: Stable` by @MichaReiser on 2024-02-13 11:38_

---

_Referenced in [astral-sh/ruff#10147](../../astral-sh/ruff/issues/10147.md) on 2024-03-04 12:45_

---

_Referenced in [astral-sh/ruff#10878](../../astral-sh/ruff/issues/10878.md) on 2024-04-11 14:56_

---

_Referenced in [astral-sh/ruff#6262](../../astral-sh/ruff/issues/6262.md) on 2024-06-25 10:47_

---

_Comment by @JP-Ellis on 2024-06-25 11:08_

I might just add that it might be worth aligning the behaviour with the [gitignore specification](https://git-scm.com/docs/gitignore#_pattern_format). Of relevance to directories:

> - The slash `/` is used as the directory separator. Separators may occur at the beginning, middle or end of the `.gitignore` search pattern.
> - If there is a separator at the end of the pattern then the pattern will only match directories, otherwise the pattern can match both files and directories.

---

_Referenced in [astral-sh/ruff#11139](../../astral-sh/ruff/pulls/11139.md) on 2024-06-25 11:18_

---

_Referenced in [astral-sh/ruff#13027](../../astral-sh/ruff/issues/13027.md) on 2024-08-23 05:48_

---

_Unassigned @MichaReiser by @MichaReiser on 2025-01-15 14:22_

---

_Referenced in [astral-sh/ruff#15749](../../astral-sh/ruff/issues/15749.md) on 2025-01-27 01:24_

---

_Referenced in [astral-sh/ruff#16146](../../astral-sh/ruff/issues/16146.md) on 2025-02-14 07:24_

---

_Referenced in [astral-sh/ty#176](../../astral-sh/ty/issues/176.md) on 2025-06-02 16:02_

---

_Referenced in [brainglobe/brainglobe-atlasapi#584](../../brainglobe/brainglobe-atlasapi/pulls/584.md) on 2025-07-31 09:55_

---

_Comment by @theo-brown on 2025-10-07 14:49_

What's the status of this?

---
