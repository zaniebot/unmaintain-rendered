---
number: 1490
title: Fixing I001 in file with Cr Lf line endings fails after 100 iterations
type: issue
state: closed
author: rhkleijn
labels:
  - bug
assignees: []
created_at: 2022-12-30T23:34:14Z
updated_at: 2022-12-31T12:37:28Z
url: https://github.com/astral-sh/ruff/issues/1490
synced_at: 2026-01-07T12:31:12-06:00
---

# Fixing I001 in file with Cr Lf line endings fails after 100 iterations

---

_Issue opened by @rhkleijn on 2022-12-30 23:34_


With `ruff 0.0.203` the reproducer from #1477 now results in a loop, and the `I001` linting error ends up not being fixed.

```
$ echo -e -n '"""A file with CRLF line endings."""\r\nimport sys\r\nimport os\r\n' > crlf.py

$ python -c "from pathlib import Path;print(Path('crlf.py').read_bytes())"
b'"""A file with CRLF line endings."""\r\nimport sys\r\nimport os\r\n'

$ ruff crlf.py --select I001 --fix

warning: Failed to converge after 100 iterations.

This likely indicates a bug in `ruff`. If you could open an issue at:

https://github.com/charliermarsh/ruff/issues

quoting the contents of `crlf.py`, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

crlf.py:2:1: I001 Import block is un-sorted or un-formatted
Found 101 error(s) (100 fixed, 1 remaining).
```

---

_Comment by @charliermarsh on 2022-12-30 23:50_

\cc @squiddy 

---

_Label `bug` added by @charliermarsh on 2022-12-30 23:50_

---

_Comment by @charliermarsh on 2022-12-31 04:50_

I'm wondering (though hard for me to iterate and test) if this is also the cause of the [CI failure](https://github.com/charliermarsh/ruff-lsp/actions/runs/3810657619/jobs/6482868822) I'm seeing in `ruff-lsp`.

---

_Comment by @charliermarsh on 2022-12-31 05:00_

It does seem to be the case: https://github.com/charliermarsh/ruff-lsp/actions/runs/3810683049/jobs/6482911720.

---

_Comment by @charliermarsh on 2022-12-31 05:04_

I'll try to figure out how to reproduce this in the morning. I don't have access to a windows machine so it's a little tricky.

---

_Comment by @squiddy on 2022-12-31 05:25_

Very sorry about that. It's morning here so I'm having a look.

---

_Comment by @squiddy on 2022-12-31 05:50_

Found the culprit. `isort::plugins::check_imports` does a check whether the sorting of imports yielded any difference. The implementation of `textwrap::dedent` uses `\n` which always results in a difference, so ruff always sees an issue that needs fixing.

Example: a properly sorted file is still continously fixed:

`echo -e -n 'import os\r\nimport sys\r\n' | cargo run -- - --select I001 --fix`

I'll prepare a fix and some tests to prevent in this in the future.

---

_Referenced in [astral-sh/ruff#1501](../../astral-sh/ruff/pulls/1501.md) on 2022-12-31 08:00_

---

_Referenced in [astral-sh/ruff#1504](../../astral-sh/ruff/pulls/1504.md) on 2022-12-31 08:16_

---

_Closed by @charliermarsh on 2022-12-31 12:37_

---
