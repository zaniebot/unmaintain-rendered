---
number: 15306
title: "False positives when defering import of `typing.Literal`"
type: issue
state: closed
author: mikeshardmind
labels: []
assignees: []
created_at: 2025-01-06T18:56:36Z
updated_at: 2025-01-06T20:19:59Z
url: https://github.com/astral-sh/ruff/issues/15306
synced_at: 2026-01-07T12:31:13-06:00
---

# False positives when defering import of `typing.Literal`

---

_Issue opened by @mikeshardmind on 2025-01-06 18:56_


```py
# _typings.py

from __future__ import annotations

TYPE_CHECKING = False

if TYPE_CHECKING:
    from typing import Any, Final, Literal, Self, final
else:
    def final(f):  # noqa: ANN001
        return f


def __getattr__(name: str):
    if name == "final":  # this one actually executes at runtime
        return final

    if name in {"Any", "Final", "Literal", "Self"}:
        import typing
        return getattr(typing, name)

    msg = f"module {__name__!r} has no attribute {name!r}"
    raise AttributeError(msg)


__all__ = ["Any", "Final", "Literal", "Self", "final"]
```

```py
# any other module

from ._typings import Literal

type HandleableSignals = Literal["SIGINT", "SIGTERM", "SIGBREAK", "SIGHUP"]
```

This causes ruff to give an F821 (Undefined name) on each string literal here, while also trying to have me remove the quotes with TC0008 This happens with that as the entirety of the file, and there is no corresponding symbol with that name here. 

(This is used to cross-platform handle any of these signals so long as they are handleable on the platform, as they may not exist on signals.Signals at runtime on a platform, this pulls the intersections of what's on the system, and which of the ones the user wants handled)

---

_Comment by @AlexWaygood on 2025-01-06 19:15_

Thanks for the issue -- have you tried making use of this setting? https://docs.astral.sh/ruff/settings/#lint_typing-modules

---

_Comment by @mikeshardmind on 2025-01-06 19:18_

I wasn't aware of that setting, but I would expect that ruff if linting typings would see the type checking conditional block and that those are for the purposes of typing sourced from typing

---

_Comment by @mikeshardmind on 2025-01-06 19:26_

Setting handles it, and this is documented behavior, so I'm going to close this, but this is pretty surprising to need to specify.

---

_Closed by @mikeshardmind on 2025-01-06 19:26_

---

_Comment by @AlexWaygood on 2025-01-06 20:19_

Yeah, I agree that this is often somewhat confusing for users; sorry about that. In the long term we hope to transform Ruff into a linter capable of multifile analysis, which will solve this problem, but it'll be a long road to get there unfortunately.

---
