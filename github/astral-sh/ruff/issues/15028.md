---
number: 15028
title: ruff check --add-noqa struggles on lines that already have comments
type: issue
state: closed
author: arrdem
labels:
  - suppression
assignees: []
created_at: 2024-12-17T00:43:11Z
updated_at: 2024-12-17T04:15:26Z
url: https://github.com/astral-sh/ruff/issues/15028
synced_at: 2026-01-07T12:31:13-06:00
---

# ruff check --add-noqa struggles on lines that already have comments

---

_Issue opened by @arrdem on 2024-12-17 00:43_

Consider the snippet

```
elif type(event) == RiskEvent:  # since some common helper methods call this function
  return False
```

This is an instance of E721 as it rightly should be, and `ruff check` will correctly detect that. The long comment is within the line length limit and so the condition won't be parenthesized and flowed either. However if you `ruff check --add-noqa`, you get the expanded comment `# ... # noqa: E721` which does overflow the line length, causing the expression to be parenthesized and reflowed into

```
elif (
  type(event) == RiskEvent
):  # since some common helper methods call this function  # noqa: E721
  return False
```

Which is still an instance of E721 because the `noqa:` has been flowed off the problem line.

Produced in Ruff 0.8.3

---

_Comment by @dhruvmanila on 2024-12-17 04:14_

Thanks for raising this. This is a known issue, I'll merge this into https://github.com/astral-sh/ruff/issues/12901.

---

_Closed by @dhruvmanila on 2024-12-17 04:14_

---

_Label `formatter` added by @dhruvmanila on 2024-12-17 04:15_

---

_Label `formatter` removed by @dhruvmanila on 2024-12-17 04:15_

---

_Label `suppression` added by @dhruvmanila on 2024-12-17 04:15_

---
