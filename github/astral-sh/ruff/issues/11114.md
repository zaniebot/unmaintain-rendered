---
number: 11114
title: "`ruff server`: `publishDiagnostics` should be sent on `onClose` to clear diagnostics"
type: issue
state: closed
author: snowsignal
labels:
  - server
assignees: []
created_at: 2024-04-23T19:40:47Z
updated_at: 2024-04-25T02:38:55Z
url: https://github.com/astral-sh/ruff/issues/11114
synced_at: 2026-01-07T12:31:13-06:00
---

# `ruff server`: `publishDiagnostics` should be sent on `onClose` to clear diagnostics

---

_Issue opened by @snowsignal on 2024-04-23 19:40_

When clients don't support pull diagnostics, we'll need to send them an empty `publishDiagnostics` notification when a file is closed - otherwise, the previous diagnostics for that file will continue to exist.

Reported by @dhruvmanila [here](https://github.com/astral-sh/ruff/pull/11092#pullrequestreview-2016229411).

---

_Label `server` added by @snowsignal on 2024-04-23 19:40_

---

_Assigned to @snowsignal by @snowsignal on 2024-04-23 19:40_

---

_Referenced in [astral-sh/ruff#11092](../../astral-sh/ruff/pulls/11092.md) on 2024-04-23 19:41_

---

_Referenced in [astral-sh/ruff#11137](../../astral-sh/ruff/pulls/11137.md) on 2024-04-25 01:51_

---

_Closed by @snowsignal on 2024-04-25 02:38_

---
