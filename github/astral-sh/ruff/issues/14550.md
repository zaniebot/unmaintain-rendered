---
number: 14550
title: "[red-knot] support narrowing on `if x` and `if not x`"
type: issue
state: closed
author: carljm
labels:
  - ty
assignees: []
created_at: 2024-11-22T23:45:27Z
updated_at: 2024-12-17T16:37:09Z
url: https://github.com/astral-sh/ruff/issues/14550
synced_at: 2026-01-07T12:31:13-06:00
---

# [red-knot] support narrowing on `if x` and `if not x`

---

_Issue opened by @carljm on 2024-11-22 23:45_

This is trickier than it might appear; the complexities are discussed in https://github.com/astral-sh/ruff/issues/13694#issuecomment-2438438759

It will likely require adding a new method `Type::exclude_always_truthy` which returns a new `Type` that excludes all inhabitants of the previous type that are known to always be truthy.


---

_Label `red-knot` added by @carljm on 2024-11-22 23:45_

---

_Assigned to @carljm by @carljm on 2024-11-22 23:45_

---

_Referenced in [astral-sh/ruff#13694](../../astral-sh/ruff/issues/13694.md) on 2024-11-23 00:53_

---

_Comment by @cake-monotone on 2024-11-23 02:19_

May I work on this?

I noticed the comment about using an enum for narrowing (e.g., EliminateNonTruthy). Did you perhaps mean EliminateNonFalsy or EliminateTruthy instead?( `if not x`)

Would it be simpler to just define it as Falsy? I feel that the enum name doesn't necessarily need to include the notion of negation. What do you think about this approach?

If your intention is to emphasize that intersections with literals must always be negative, I can proceed as you suggested.

---

_Comment by @MichaReiser on 2024-11-23 08:51_

@cake-monotone  We have someone new starting next week and I think Carl created this task deliberately for them.  That's why he assigned it to himself. 

---

_Comment by @cake-monotone on 2024-11-23 09:15_

Ah! I see! Thanks for your comment! I haven’t started working on it. 

---

_Comment by @MichaReiser on 2024-11-23 09:17_

I haven't done much typing work myself so I don't have a good sense for how "hard" some of these tasks are but if you're interested in contributing, you could consider tackling one of the [special form](https://github.com/astral-sh/ruff/issues/14172) tasks or take a look at any other [task labeled with help-wanted](https://github.com/astral-sh/ruff/issues?q=sort%3Aupdated-desc+is%3Aissue+is%3Aopen+label%3Ared-knot+label%3A%22help+wanted%22)

---

_Comment by @carljm on 2024-11-23 17:13_

@cake-monotone Micha is right about why I created this issue and assigned it to myself, but that said: if you are interested in working on this, please go ahead, that would be great! Given your past work I have no doubt you'll do a good job with it. We have plenty of things to work on, I won't have any trouble finding a replacement task for our new hire. (And this isn't one of the initial starter tasks, so they wouldn't have gotten to it for a few weeks anyway.)

Please do confirm if you start working on it, and I will assign it to you. 

---

_Comment by @carljm on 2024-11-23 17:17_

Regarding the naming, I think you are right, it will be clearer to use a name like I suggested in the description of this issue (`exclude_always_truthy`). It is important to reflect that this is a negative intersection (that is, we are excluding all types known to always be truthy, which is different from intersecting with Falsy.)

But the word "exclude" already serves that purpose, it's just confusing to use another negative beyond that. 

---

_Comment by @cake-monotone on 2024-11-24 04:51_

I got it. Thanks for clarifying and for your encouragement! I’ll start working on this—feel free to assign it to me.

Also, thanks to MichaReiser for pointing out other potential tasks. I really appreciate it!

---

_Assigned to @cake-monotone by @AlexWaygood on 2024-11-24 19:46_

---

_Unassigned @carljm by @AlexWaygood on 2024-11-24 19:47_

---

_Referenced in [astral-sh/ruff#14588](../../astral-sh/ruff/issues/14588.md) on 2024-11-25 17:15_

---

_Closed by @carljm on 2024-12-17 16:37_

---
