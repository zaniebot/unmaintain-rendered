---
number: 15989
title: "[red-knot] Relative imports in the root directory"
type: issue
state: closed
author: MichaReiser
labels:
  - bug
  - ty
assignees: []
created_at: 2025-02-06T08:50:17Z
updated_at: 2025-02-06T14:08:22Z
url: https://github.com/astral-sh/ruff/issues/15989
synced_at: 2026-01-07T12:31:13-06:00
---

# [red-knot] Relative imports in the root directory

---

_Issue opened by @MichaReiser on 2025-02-06 08:50_

### Description

Steps to reproduce:

* Create a `knot.toml` in `crates/ruff_benchmark/resources/tomllib/` that contains 
  ```toml
	[src]
	root = "."
	
	[environment]
	python-version = "3.12"
  ```
* Run red-knot in `crates/ruff_benchmark/resources/tomllib/`


Actual behavior:

Red knot fails to resolve all relative imports 

```
2025-02-06 09:46:45.320415000 DEBUG Searching for a project in '/Users/micha/astral/ruff/crates/ruff_benchmark/resources/tomllib'
2025-02-06 09:46:45.321217000 DEBUG Found project at '/Users/micha/astral/ruff/crates/ruff_benchmark/resources/tomllib'
2025-02-06 09:46:45.321466000 INFO Python version: Python 3.12, platform: all
2025-02-06 09:46:45.321526000 DEBUG Adding first-party search path '/Users/micha/astral/ruff/crates/ruff_benchmark/resources/tomllib'
2025-02-06 09:46:45.321580000 DEBUG Using vendored stdlib
2025-02-06 09:46:45.326449000 DEBUG Starting main loop
2025-02-06 09:46:45.326850000 DEBUG Waiting for next main loop message.
2025-02-06 09:46:45.327719000 DEBUG Checking project 'tomllib'
2025-02-06 09:46:45.338186000 INFO Found 4 files in project `tomllib`
2025-02-06 09:46:45.339492000 DEBUG Checking file '/Users/micha/astral/ruff/crates/ruff_benchmark/resources/tomllib/__init__.py'
2025-02-06 09:46:45.339493000 DEBUG Checking file '/Users/micha/astral/ruff/crates/ruff_benchmark/resources/tomllib/_types.py'
2025-02-06 09:46:45.339583000 DEBUG Checking file '/Users/micha/astral/ruff/crates/ruff_benchmark/resources/tomllib/_re.py'
2025-02-06 09:46:45.340281000 DEBUG Resolving dynamic module resolution paths
2025-02-06 09:46:45.340307000 DEBUG Module `crates.ruff_benchmark.resources.tomllib._parser` not found in search paths
2025-02-06 09:46:45.341487000 DEBUG Checking file '/Users/micha/astral/ruff/crates/ruff_benchmark/resources/tomllib/_parser.py'
2025-02-06 09:46:45.380899000 DEBUG Module `collections.abc.Iterable` not found in search paths
2025-02-06 09:46:45.380928000 DEBUG Relative module resolution `._types` failed: too many leading dots
2025-02-06 09:46:45.381480000 DEBUG Relative module resolution `._re` failed: too many leading dots
2025-02-06 09:46:45.381522000 DEBUG Relative module resolution `._re` failed: too many leading dots
2025-02-06 09:46:45.381554000 DEBUG Relative module resolution `._re` failed: too many leading dots
2025-02-06 09:46:45.381584000 DEBUG Relative module resolution `._re` failed: too many leading dots
2025-02-06 09:46:45.381616000 DEBUG Relative module resolution `._re` failed: too many leading dots
2025-02-06 09:46:45.381643000 DEBUG Relative module resolution `._re` failed: too many leading dots
2025-02-06 09:46:45.381672000 DEBUG Relative module resolution `._types` failed: too many leading dots
2025-02-06 09:46:45.381700000 DEBUG Relative module resolution `._types` failed: too many leading dots
2025-02-06 09:46:45.381730000 DEBUG Relative module resolution `._types` failed: too many leading dots
2025-02-06 09:46:45.382514000 DEBUG Module `collections.abc.Set` not found in search paths
2025-02-06 09:46:45.395553000 DEBUG Module `collections.abc.Iterator` not found in search paths
2025-02-06 09:46:45.399402000 DEBUG Module `collections.abc.Callable` not found in search paths
2025-02-06 09:46:45.408206000 DEBUG Module `collections.abc.Sized` not found in search paths
```

Expected behavior

Pyright does just fine


What's interesting. Red Knot does just fine too when moving all source files into a `src` sub-directory

---

_Label `bug` added by @MichaReiser on 2025-02-06 08:50_

---

_Label `red-knot` added by @MichaReiser on 2025-02-06 08:50_

---

_Referenced in [astral-sh/ruff#15990](../../astral-sh/ruff/pulls/15990.md) on 2025-02-06 09:08_

---

_Closed by @MichaReiser on 2025-02-06 14:08_

---

_Closed by @MichaReiser on 2025-02-06 14:08_

---
