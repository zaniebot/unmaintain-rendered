---
number: 4173
title: possible false positive with RET504 and class method
type: issue
state: closed
author: Borda
labels:
  - bug
assignees: []
created_at: 2023-05-01T20:41:03Z
updated_at: 2023-06-10T04:05:03Z
url: https://github.com/astral-sh/ruff/issues/4173
synced_at: 2026-01-07T12:31:12-06:00
---

# possible false positive with RET504 and class method

---

_Issue opened by @Borda on 2023-05-01 20:41_

I have the following code sample, and here I do think it is correct:
```py
  def collate_none_when_even(self, batch):
      result = None if self.counter % 2 == 0 else default_collate(batch)
      self.counter += 1
      return result
```
or another example:
```py
def training_step(self, dataloader_iter: Iterator) -> STEP_OUTPUT:
    output = super().training_step(dataloader_iter)
    batch_idx = self.trainer.fit_loop.epoch_loop.batch_idx
    if self.trigger_stop_iteration and batch_idx == EXPECT_NUM_BATCHES_PROCESSED:
        raise StopIteration
    return output
```

---

_Referenced in [Lightning-AI/pytorch-lightning#17540](../../Lightning-AI/pytorch-lightning/pulls/17540.md) on 2023-05-01 20:44_

---

_Label `bug` added by @charliermarsh on 2023-05-02 01:01_

---

_Comment by @charliermarsh on 2023-05-06 18:15_

I'm considering changing this rule to only detect the simple case of "assignment followed by return".

---

_Referenced in [astral-sh/ruff#4997](../../astral-sh/ruff/pulls/4997.md) on 2023-06-10 02:42_

---

_Closed by @charliermarsh on 2023-06-10 04:05_

---
