---
number: 18658
title: "[BUG][Formatter] `ruff format` does not respect `# fmt: {on,off,skip}` in `.pyi` stub files"
type: issue
state: closed
author: XuehaiPan
labels:
  - question
  - suppression
  - formatter
assignees: []
created_at: 2025-06-13T09:06:17Z
updated_at: 2025-06-13T13:35:47Z
url: https://github.com/astral-sh/ruff/issues/18658
synced_at: 2026-01-07T12:31:13-06:00
---

# [BUG][Formatter] `ruff format` does not respect `# fmt: {on,off,skip}` in `.pyi` stub files

---

_Issue opened by @XuehaiPan on 2025-06-13 09:06_

### Summary

As per the issue title.

Related CI failure:

- https://github.com/pytorch/pytorch/actions/runs/15630997368/job/44035153534?pr=144552

Minimal reproduce:

```python
# test.pyi

from typing import Union

def func1(
    # fmt: off
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],
    # fmt: on
) -> None: ...
# fmt: off
def func2(
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],
) -> None: ...
# fmt: on
def func3(
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],  # fmt: skip
) -> None: ...
def func4(  # fmt: skip
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],
) -> None: ...
def func5(
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],
) -> None: ...  # fmt: skip
```

Output with `ruff format test.pyi`:

```python
# test.pyi

from typing import Union

def func1(
    # fmt: off
    a: Union[
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
    ],
    # fmt: on
) -> None: ...

# fmt: off
def func2(
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],
) -> None: ...
# fmt: on
def func3(
    a: Union[
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
    ],  # fmt: skip
) -> None: ...
def func4(  # fmt: skip
    a: Union[
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
    ],
) -> None: ...
def func5(
    a: Union[
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
        int,
    ],
) -> None: ...  # fmt: skip
```

### Version

ruff 0.11.13

---

_Label `question` added by @MichaReiser on 2025-06-13 11:37_

---

_Comment by @MichaReiser on 2025-06-13 11:40_

Hi. 

Ruff only supports suppression comments at the statement level as documented [here](https://docs.astral.sh/ruff/formatter/#format-suppression) and RUF 028 should warn you about invalid suppression comments ([playground](https://play.ruff.rs/b63e101e-3b77-40af-87e3-97e294a03770)). 

Now, there's a bug with compound statements when the body is `...`. In this case, Ruff should disable formatting but it currently doesn't. See https://github.com/astral-sh/ruff/issues/11216

For now, use 

```py
# fmt: off
def func1(
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],
) -> None: ...
# fmt: on
```


or

```py
def func5(
    a: Union[int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int, int],
) -> None:   # fmt: skip
    ...
```

---

_Label `suppression` added by @AlexWaygood on 2025-06-13 12:40_

---

_Label `formatter` added by @AlexWaygood on 2025-06-13 12:40_

---

_Referenced in [pytorch/pytorch#155909](../../pytorch/pytorch/pulls/155909.md) on 2025-06-13 13:25_

---

_Comment by @XuehaiPan on 2025-06-13 13:29_

Thanks for the context. I want to note that the issue was raised because the `.pyi` files are autogenerated. I updated the signature generation rule if the argument is too long with:

```python
def function_name(
    arg1: long_annotation,
    arg2: long_annotation,
) -> return_annotation:  # fmt: skip
    ...
```

- pytorch/pytorch#155909

---

_Comment by @XuehaiPan on 2025-06-13 13:29_

Please feel free to close this if it is a duplicate issue.

---

_Closed by @MichaReiser on 2025-06-13 13:35_

---
