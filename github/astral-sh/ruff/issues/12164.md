---
number: 12164
title: "Rule B909 (loop-iterator-mutation) doesn't detect many kinds of list mutation"
type: issue
state: closed
author: Boon-in-Oz
labels: []
assignees: []
created_at: 2024-07-03T07:10:28Z
updated_at: 2024-07-17T16:03:37Z
url: https://github.com/astral-sh/ruff/issues/12164
synced_at: 2026-01-07T12:31:13-06:00
---

# Rule B909 (loop-iterator-mutation) doesn't detect many kinds of list mutation

---

_Issue opened by @Boon-in-Oz on 2024-07-03 07:10_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->
Hello and thank you for this excellent tool,

I'm running Ruff as a linter in VS Code with `select = ["ALL"]`, `preview = true` and only specific rules ignored. I'm still on Python 3.7.7, and using the Ruff 2024.28.0 extension.

I've found that B909 sometimes fires when I extend a list in a loop, but not when I remove or del an item from it. I'm not sure how the original Bugbear behaves in this case but in practice these seem very similar and any of them can cause bugs.

I can't find any report of this in issues, searching for "B909", "mutation", "iterator". The only issue I found was the original task to implement B038: https://github.com/astral-sh/ruff/issues/9511

Repros:

This does not generate any linting errors:
(from https://stackoverflow.com/questions/6260089/strange-result-when-removing-item-from-a-list-while-iterating-over-it-in-python)
```
numbers = list(range(1, 30))
for i in numbers:
    if i < 20:
        numbers.remove(i)
print(numbers)
```
> [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29]

But this triggers both B909 and PERF401:
```
numbers = list(range(1, 30))
for i in numbers:
    if i < 20:
        numbers.append(i + 20)
print(numbers)
```

This does not trigger B909 or PERF401 either (though it does correctly trigger FURB148 on the `enumerate` call)
```
numbers = list(range(1, 30))
for i, _ in enumerate(numbers):
    if i < 20:
        numbers.append(i)
```

Same for this:
```
numbers = list(range(1, 30))
for i, _ in enumerate(numbers):
    if i < 20:
        del numbers[i]
print(numbers)
```
> [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28]

And this (don't try this one, it's an infinite loop)
```
numbers = list(range(1, 30))
for i, _ in enumerate(numbers):
    if i > 20:
        numbers.append(i)
```

---

_Comment by @charliermarsh on 2024-07-17 02:08_

```python
numbers = list(range(1, 30))
for i in numbers:
    if i < 20:
        numbers.remove(i)
print(numbers)
```

It looks like we specifically allow this pattern... For example, we _do_ flag an error for this:

```python
numbers = list(range(1, 30))
for i in numbers:
    if i < 20:
        numbers.remove(i + 1)
print(numbers)
```

The `enumerate(...)` variants we should probably catch.

---

_Comment by @charliermarsh on 2024-07-17 02:10_

I feel like we _should_ still be flagging:

```python
numbers = list(range(1, 30))
for i in numbers:
    if i < 20:
        numbers.remove(i)
print(numbers)
```

But need to look at the source to understand why that exception was added.

---

_Comment by @charliermarsh on 2024-07-17 02:40_

Ok, I think I should remove that exception -- it seems misguided.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-07-17 02:40_

---

_Referenced in [astral-sh/ruff#12365](../../astral-sh/ruff/pulls/12365.md) on 2024-07-17 14:15_

---

_Referenced in [astral-sh/ruff#12366](../../astral-sh/ruff/pulls/12366.md) on 2024-07-17 14:21_

---

_Closed by @charliermarsh on 2024-07-17 16:03_

---
