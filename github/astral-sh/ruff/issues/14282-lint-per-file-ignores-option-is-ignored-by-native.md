---
number: 14282
title: "`lint.per-file-ignores` option is ignored by native server in `ruff.toml`"
type: issue
state: closed
author: SXHRYU
labels:
  - bug
  - server
assignees: []
created_at: 2024-11-11T14:45:50Z
updated_at: 2024-11-15T08:15:01Z
url: https://github.com/astral-sh/ruff/issues/14282
synced_at: 2026-01-07T13:12:16-06:00
---

# `lint.per-file-ignores` option is ignored by native server in `ruff.toml`

---

_Issue opened by @SXHRYU on 2024-11-11 14:45_

Basically it's the same issue as https://github.com/astral-sh/ruff/issues/11751 but the problem still occurs when using `ruff.toml` as config file.

jic: this happens in VS Code, when `ruff check`ing via console everything's okay.

---

_Label `configuration` added by @AlexWaygood on 2024-11-11 17:43_

---

_Label `server` added by @AlexWaygood on 2024-11-11 17:43_

---

_Label `configuration` removed by @MichaReiser on 2024-11-12 08:25_

---

_Label `needs-mre` added by @MichaReiser on 2024-11-12 08:25_

---

_Comment by @MichaReiser on 2024-11-12 08:27_

Could you share a small reproduction? How does the directory layout look like? What files do you open in VS code. 

I'm asking because I just tried what you described and VS Code correctly shows or doesn't show diagnostic based on the `per-file-ignores` in the `ruff.toml`



---

_Comment by @amoralesc on 2024-11-14 03:15_

@MichaReiser I'm experiencing the same problem. I might add that I'm using a custom location for my Ruff config file, setting it under `.config/.ruff.toml`. Also working on Dev Containers.

I want to ignore the pydocstyle linter on all files under `src/migrations/versions`. Here's my environment (simplified) and steps to reproduce:

**Versions**

- `ruff`: 0.7.3
- `charliermarsh.ruff` extension: latest
- VSCode: 1.95.2

**Project structure:**

```
.
├─ .config
│  └─ .ruff.toml
├─ .venv
└─ src
   └─ migrations
      └─ versions
         └─ 1e8f6175aeef_a.py # <- file with errors
```

**VSCode settings:**

```json
{
  "python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",
  "[python]": {
    "editor.defaultFormatter": "charliermarsh.ruff",
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
      "source.organizeImports": "explicit"
    }
  },
  "ruff.importStrategy": "fromEnvironment",
  "ruff.interpreter": ["${workspaceFolder}/.venv/bin/python"],
  "ruff.fixAll": true,
  "ruff.organizeImports": true,
  "ruff.configuration": "${workspaceFolder}/.config/.ruff.toml",
}
```

**Ruff config file:**

```toml
target-version = "py312"
line-length    = 80
indent-width   = 4

[lint]
select = [
  "D"
]

[lint.per-file-ignores]
"**/versions/*.py" = [
  "D",
]

[lint.pydocstyle]
convention = "numpy"
```

The problematic file in question:

```python
"""Test

Revision ID: 1e8f6175aeef
Revises:
Create Date: 2024-11-14 02:42:01.465193

"""

from collections.abc import Sequence

# revision identifiers, used by Alembic.
revision: str = "1e8f6175aeef"
down_revision: str | None = None
branch_labels: str | Sequence[str] | None = None
depends_on: str | Sequence[str] | None = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###

```

When the file is on focus:

![image](https://github.com/user-attachments/assets/8a94be05-40ff-4e44-9122-61696602f116)

Running ruff check from the project root:

```bash
ruff check --config .config/.ruff.toml .
```

```
All checks passed!
```

For good measure, commenting out the `[lint.per-file-ignores]` section and running ruff again returns:

```
src/migrations/versions/1e8f6175aeef_a.py:1:1: D400 First line should end with a period
  |
1 | / """Test
2 | | 
3 | | Revision ID: 1e8f6175aeef
4 | | Revises:
5 | | Create Date: 2024-11-14 02:42:01.465193
6 | | 
7 | | """
  | |___^ D400
8 |   
9 |   from collections.abc import Sequence
  |
  = help: Add period

src/migrations/versions/1e8f6175aeef_a.py:18:5: D103 Missing docstring in public function
   |
18 | def upgrade() -> None:
   |     ^^^^^^^ D103
19 |     # ### commands auto generated by Alembic - please adjust! ###
20 |     pass
   |

src/migrations/versions/1e8f6175aeef_a.py:24:5: D103 Missing docstring in public function
   |
24 | def downgrade() -> None:
   |     ^^^^^^^^^ D103
25 |     # ### commands auto generated by Alembic - please adjust! ###
26 |     pass
   |

Found 3 errors.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
```

---

_Comment by @amoralesc on 2024-11-14 04:17_

Same behavior with `exclude = []` on the Ruff config file.

Temporary workaround: use `ruff.exclude` in the VSCode `settings.json`. From the [docs](https://docs.astral.sh/ruff/editors/settings/#exclude).

---

_Comment by @dhruvmanila on 2024-11-14 04:22_

@amoralesc Do you mind trying it outside the Dev Container? There have been a couple of issues when working inside a dev container and I want to find some time to look into those soon.

---

_Comment by @amoralesc on 2024-11-14 04:53_

@dhruvmanila I can indeed reproduce this error outside of the dev container. Tested with `extend-exclude` and `[lint.per-file-ignores]`.

My local environment is WSL. Worth noting that VSCode through WSL is still a remote server.

@SXHRYU Can you confirm how does your environment look like?

---

_Comment by @dhruvmanila on 2024-11-14 04:54_

Ok, thanks for confirming. Although I don't have a Windows machine I can try reproducing on a Mac.

---

_Comment by @dhruvmanila on 2024-11-14 06:51_

@amoralesc I'm looking at this now but just want to point out a couple of things:

```json
  "ruff.interpreter": ["./.venv/bin/python"],
```
I don't think this will work (https://github.com/astral-sh/ruff-vscode/pull/553), you'll need to update it to:

```json
  "ruff.interpreter": ["${workspaceFolder}/.venv/bin/python"],
```

But, otherwise I can reproduce this on my end although I'm not sure why this is happening.

---

_Comment by @amoralesc on 2024-11-14 15:30_

@dhruvmanila Yes, my bad there. I wanted to generalize the reproducible environment and totally forgot that dot access doesn't work in `ruff.interpreter`. I'm actually using `${containerWorkspaceFolder}` there as well as in `ruff.configuration`. I'm gonna update the original snippet.

I may also add that the behavior is rather strange. Let's call the the problematic file `file.py`, deeply nested at `/path/to/file.py`. If I exclude the file like this:

```toml
# .config/.ruff.toml

# either like:
exclude = ["**/file.py"]
# or:
[lint.per-file-ignores]
"**/file.py" = ["D"]
```

That actually works correctly! This is not the ideal solution though, because I'd want to ignore everything under `path/to`. So when the pattern matching is changed to `./path/to/*.py`, `**/path/to/*.py` or `**/to/*.py`, it fails.

---

_Comment by @MichaReiser on 2024-11-14 15:33_

@dhruvmanila and I narrowed the problem down to that patterns in `.config/ruff.toml` are resolved relative to the configuration directory, which I think is surprising. So changing `per-file-ignores` to `../**/file.py` should work. We'll look into if it makes sense to change the behavior

---

_Label `needs-mre` removed by @MichaReiser on 2024-11-14 15:34_

---

_Comment by @amoralesc on 2024-11-14 15:51_

I can confirm the fix on https://github.com/astral-sh/ruff/issues/14282#issuecomment-2476724202 works on my environment.

I can't comment on this being the intended behavior, but it is still different from calling ruff from the project's root with:

```bash
ruff check --config .config/.ruff.toml
```

Thankfully, adding the `..` does work on both calls (VSCode extension and ruff).

---

_Label `bug` added by @MichaReiser on 2024-11-14 15:51_

---

_Referenced in [astral-sh/ruff#14352](../../astral-sh/ruff/pulls/14352.md) on 2024-11-15 05:12_

---

_Comment by @dhruvmanila on 2024-11-15 05:15_

@amoralesc I'd also recommend to use absolute path for `ruff.configuration` because this setting is applied for every workspaces that you open in VS Code. So, it could be that in a workspace there isn't a `.config/ruff.toml` file. Using absolute path is more useful in this context, we also support expanding tilde (`~`) here. I don't know your setup so I leave this up to you.

---

_Comment by @amoralesc on 2024-11-15 07:27_

Since my environment is a Dev Container, I choose to use `${containerWorkspaceFolder}`. I can confirm this resolves to an absolute path to the config file inside the container in the extension logs.

Thanks for the heads up though!

---

_Closed by @dhruvmanila on 2024-11-15 08:15_

---
