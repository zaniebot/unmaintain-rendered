---
number: 6571
title: TCH001 TCH002 false negative – add msgspec.Struct support
type: issue
state: closed
author: Olegt0rr
labels:
  - needs-info
assignees: []
created_at: 2023-08-14T20:19:03Z
updated_at: 2023-08-16T01:45:47Z
url: https://github.com/astral-sh/ruff/issues/6571
synced_at: 2026-01-07T12:31:12-06:00
---

# TCH001 TCH002 false negative – add msgspec.Struct support

---

_Issue opened by @Olegt0rr on 2023-08-14 20:19_

> TCH001 [*] Move application import `.objects.Issue` into a type-checking block

and 

> TCH002 [*] Move third-party import `myapp.types.Issue` into a type-checking block

```python
from __future__ import annotations

from msgspec import Struct

from myapp.types import Issue


class FullIssue(Struct):
    parent: Issue | None = None

```

Ruff v0.0.284 
target-version = "py39"

---

_Renamed from "TCH001 TCH002 add msgspec.Struct support" to "TCH001 TCH002 false negative – add msgspec.Struct support" by @Olegt0rr on 2023-08-14 20:19_

---

_Comment by @charliermarsh on 2023-08-14 20:21_

Does it work as expected if you set [`runtime-evaluated-base-classes`](https://beta.ruff.rs/docs/settings/#flake8-type-checking-runtime-evaluated-base-classes)?

```toml
[tool.ruff.flake8-type-checking]
runtime-evaluated-base-classes = ["msgspec.Struct"]
```

---

_Label `waiting-on-author` added by @charliermarsh on 2023-08-14 20:21_

---

_Comment by @Olegt0rr on 2023-08-14 20:25_

Yes, thanks!

But as long it's a default behavior for all msgspec structs – it would be nice to make similar support as pydantic

---

_Comment by @charliermarsh on 2023-08-14 20:25_

You can add `pydantic.BaseModel` to that list too. I'm considering adding them by default.

---

_Comment by @Olegt0rr on 2023-08-14 20:32_

Aw, the same setting has troubles with inherits

> [tool.ruff.flake8-type-checking]
> runtime-evaluated-base-classes = ["msgspec.Struct"]

```python
from __future__ import annotations

from msgspec import Struct

from yatracker.types import Issue


class Foo(Struct):
    """Intermediate class"""


class FullIssue(Foo):
    parent: Issue | None = None

```

> TCH002 [*] Move third-party import `myapp.types.Issue` into a type-checking block

Should I add to the list every base class? :(

---

_Comment by @charliermarsh on 2023-08-14 20:38_

Yes, this is a known issue. It'll be solved at some point, but probably not in an upcoming release, because it requires us to resolve symbols like `Foo` across files to really be useful in practice (e.g., if you did `from module import Foo`, and `Foo` inherited from `Struct`, we'd need to detect that).

You can either add every class to the list, or include `Struct` as a base class, like:

```python
from __future__ import annotations

from msgspec import Struct

from yatracker.types import Issue


class Foo(Struct):
    """Intermediate class"""


class FullIssue(Foo, Struct):
    parent: Issue | None = None
```

Or just disable these rules when working with libraries that rely on type annotations at runtime.


---

_Closed by @zanieb on 2023-08-16 01:45_

---
