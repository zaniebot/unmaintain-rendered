---
number: 8715
title: Ruff Jupiter notebook removes imports in separate block from use
type: issue
state: closed
author: Matt-Ord
labels: []
assignees: []
created_at: 2023-11-16T09:13:26Z
updated_at: 2023-11-16T17:36:27Z
url: https://github.com/astral-sh/ruff/issues/8715
synced_at: 2026-01-07T12:31:12-06:00
---

# Ruff Jupiter notebook removes imports in separate block from use

---

_Issue opened by @Matt-Ord on 2023-11-16 09:13_

Notebook
```json
{
    "cells": [
        {
            "cell_type": "code",
            "execution_count": 1,
            "id": "840d65b4-53dd-4ee6-a5a6-e57293fabd2c",
            "metadata": {
                "editable": true,
                "slideshow": {
                    "slide_type": ""
                },
                "tags": []
            },
            "outputs": [],
            "source": [
                "import numpy as np "
            ]
        },
        {
            "cell_type": "code",
            "execution_count": 2,
            "id": "8c74da64-4991-4501-8c88-1262e59e256e",
            "metadata": {
                "editable": true,
                "slideshow": {
                    "slide_type": ""
                },
                "tags": []
            },
            "outputs": [],
            "source": [
                "# The matrix we want to block-encode\n",
                "matrix_1 = np.array([[1, 1], [1, -1]])"
            ]
        }
    ],
    "metadata": {
        "kernelspec": {
            "display_name": "Python 3 (ipykernel)",
            "language": "python",
            "name": "python3"
        },
        "language_info": {
            "codemirror_mode": {
                "name": "ipython",
                "version": 3
            },
            "file_extension": ".py",
            "mimetype": "text/x-python",
            "name": "python",
            "nbconvert_exporter": "python",
            "pygments_lexer": "ipython3",
            "version": "3.11.6"
        }
    },
    "nbformat": 4,
    "nbformat_minor": 5
}
```
Vscode settings.json
```json
{
	"notebook.formatOnSave.enabled": true,
	"notebook.codeActionsOnSave": {
		"source.fixAll": true,
		"source.organizeImports": true
	},
	"[python]": {
		"editor.defaultFormatter": "charliermarsh.ruff"
	},
	"editor.formatOnSave": true,
	"editor.codeActionsOnSave": {
	         "source.fixAll": true,
	         "source.organizeImports": true
	},
	"python.analysis.typeCheckingMode": "basic",
	"python.analysis.diagnosticMode": "workspace"
}
```
using an empty pyproject.toml
when saving the notebook the import `numpy as np` block is removed
ruff version 0.1.5

---

_Comment by @charliermarsh on 2023-11-16 17:36_

üëç I believe this is a known problem that we're working on. It's tracked in the LSP repository, so I'll merge into that issue: https://github.com/astral-sh/ruff-lsp/issues/320.

I think that if you use the `Ruff:` specific versions of these commands, we avoid this issue since it runs over the whole notebook rather than the cell, but we do plan to fix this:

<img width="328" alt="Screen Shot 2023-11-16 at 12 36 10 PM" src="https://github.com/astral-sh/ruff/assets/1309177/2a7f9f7f-d472-4a6e-97f5-0beeb755fb26">


---

_Closed by @charliermarsh on 2023-11-16 17:36_

---

_Comment by @charliermarsh on 2023-11-16 17:36_

\cc @dhruvmanila for visibility

---
