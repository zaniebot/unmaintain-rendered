---
number: 6715
title: " Failed to create fix for `UnnecessaryMap: Currently not supporting default values`"
type: issue
state: closed
author: qarmin
labels:
  - bug
  - fixes
  - fuzzer
assignees: []
created_at: 2023-08-21T08:50:11Z
updated_at: 2023-08-22T19:08:10Z
url: https://github.com/astral-sh/ruff/issues/6715
synced_at: 2026-01-07T12:31:12-06:00
---

#  Failed to create fix for `UnnecessaryMap: Currently not supporting default values`

---

_Issue opened by @qarmin on 2023-08-21 08:50_

Ruff 0.0.285

```
ruff  *.py --select ALL
```

file content:
```
_ = f"{dict(map(lambda v: (v, v**2), nums))}"
# For simple expressions, this could be: `(x if x else 1 for x in nums)`.
map(lambda x=1: x, nums)
```

error:
```
error: Failed to create fix for UnnecessaryMap: Currently not supporting default values
```

For me, this error should not be visible for user, because this message is useless for it


[PY_FILE_TEST_178904787.py.zip](https://github.com/astral-sh/ruff/files/12394161/PY_FILE_TEST_178904787.py.zip)


---

_Comment by @dhruvmanila on 2023-08-21 10:35_

The fix might not work if there are any falsy values in the iterable. For example, if one of the values of `nums` is 0 then it would use 1 but it explicitly passed the argument.

I do agree that the message isn't useful from user perspective and instead we should avoid auto-generating the fix. 

---

_Label `bug` added by @dhruvmanila on 2023-08-21 10:35_

---

_Label `autofix` added by @dhruvmanila on 2023-08-21 10:35_

---

_Label `fuzzer` added by @charliermarsh on 2023-08-21 12:55_

---

_Comment by @charliermarsh on 2023-08-21 12:56_

Yeah it's fine that this is unsupported, but we should attempting to fix it and thus raising the message.

---

_Comment by @charliermarsh on 2023-08-21 23:25_

> The fix might not work if there are any falsy values in the iterable. For example, if one of the values of nums is 0 then it would use 1 but it explicitly passed the argument.

Can you expand on this with an example?

---

_Comment by @dhruvmanila on 2023-08-22 02:33_

Here, you can see the output is different. Default values in this context will never be used as `map` will always pass a value to the function.
```python
In [1]: nums = [0, 1, 2]

In [2]: list(map(lambda x=1: x, nums))
Out[2]: [0, 1, 2]

In [3]: list(x if x else 1 for x in nums)
Out[3]: [1, 1, 2]
```

---

_Comment by @charliermarsh on 2023-08-22 02:57_

But, isn't this suggesting that the user change `list(map(lambda x=1: x, nums))` to `[x for x in nums]`? Why the inclusion of `if x else 1`?

---

_Comment by @dhruvmanila on 2023-08-22 03:55_

Oh, it's mentioned in the PR description: 

> For simple expressions, this could be: `(x if x else 1 for x in nums)`.

But yeah, your suggestion would work correctly.

---

_Comment by @charliermarsh on 2023-08-22 03:57_

We should probably just skip attempting the fix if there are default values. It's an unusual pattern and I can think of a few cases where it would cause problems.

---

_Comment by @dhruvmanila on 2023-08-22 04:01_

Yeah, I'm thinking of the same solution.

---

_Assigned to @dhruvmanila by @dhruvmanila on 2023-08-22 04:01_

---

_Referenced in [astral-sh/ruff#6752](../../astral-sh/ruff/pulls/6752.md) on 2023-08-22 04:22_

---

_Closed by @dhruvmanila on 2023-08-22 19:08_

---
