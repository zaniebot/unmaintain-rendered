---
number: 9570
title: Behaviour of E721 with numpy.dtype
type: issue
state: closed
author: nstarman
labels:
  - rule
  - accepted
assignees: []
created_at: 2024-01-17T22:00:45Z
updated_at: 2024-01-29T17:39:03Z
url: https://github.com/astral-sh/ruff/issues/9570
synced_at: 2026-01-07T12:31:13-06:00
---

# Behaviour of E721 with numpy.dtype

---

_Issue opened by @nstarman on 2024-01-17 22:00_

`numpy.dtype` is tripping rule E721. I'm not sure it should be.

```python
x = np.array([1,2,3], dtype=float)
x.dtype == float  # <- trips E721
```

``.dtype`` is an object, e.g. a `dtype('float64')`.
While `x.dtype == float` may not be the best means of testing a dtype, I don't think this is E721.

---

_Comment by @charliermarsh on 2024-01-18 05:20_

What about `x.dtype is np.dtype(float)`?

---

_Label `question` added by @charliermarsh on 2024-01-18 05:20_

---

_Comment by @nstarman on 2024-01-18 15:01_

Looking at https://github.com/numpy/numpy/blob/5feea41396910a3065c8e79886127fad4cbdebf3/numpy/__init__.pyi#L844, it appears that `==` is fine for dtypes.

I suppose we should ask a numpy dev — ping @mhvk — about preferred syntax.


---

_Referenced in [astropy/astropy#15889](../../astropy/astropy/pulls/15889.md) on 2024-01-18 15:46_

---

_Comment by @mhvk on 2024-01-18 16:00_

`dtype` are a bit of a strange beast, but definitely best thought of as instances, not classes, and they are meant to be comparable not just to their own class, but also to the corresponding scalar types (e.g., `x.dtype == np.float32`) and strings (e.g., `x.dtype == ['i1,i4']`; basically, `__eq__` always tries to do `dtype(other)`.

---

_Comment by @charliermarsh on 2024-01-19 16:47_

Okay, we can try to special-case it when comparing a `.dtype` attribute directly, though we'll still get it wrong in the general case (since given `x == y`, we can't know definitively whether `x` is a `dtype`).

---

_Label `question` removed by @charliermarsh on 2024-01-19 16:48_

---

_Label `rule` added by @charliermarsh on 2024-01-19 16:48_

---

_Comment by @charliermarsh on 2024-01-19 16:59_

@mhvk -- Just to clarify, is `x.dtype == float` is preferable over (e.g.) `x.dtype is np.dtype(float)` or looking at the dtype kind or char?

---

_Comment by @zanieb on 2024-01-19 17:23_

I feel like `x.dtype is np.dtype(float)` is more correct, but this might make sense to exclude from E721 as it doesn't seem worse to use `== float`.

---

_Comment by @mhvk on 2024-01-19 19:21_

I think it is much safer in general usage to use `==`, since `is` really only works for the basic numpy built-in dtype. `np.dtype("i,i") is np.dtype("i,i")` gives `False`, because a new structured dtype is created for every call. So, to the point of this PR, `dtype` really should not generally be considered classes and thus no preference for `is` over `isinstance` or `==`.

---

_Comment by @charliermarsh on 2024-01-20 01:00_

Okay, sounds good. Thanks for chiming in.

---

_Label `accepted` added by @charliermarsh on 2024-01-29 03:58_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-01-29 17:13_

---

_Referenced in [astral-sh/ruff#9676](../../astral-sh/ruff/pulls/9676.md) on 2024-01-29 17:21_

---

_Closed by @charliermarsh on 2024-01-29 17:39_

---

_Referenced in [astral-sh/ruff#12290](../../astral-sh/ruff/issues/12290.md) on 2024-07-11 16:46_

---
