---
number: 2999
title: Allow noqa on preceding line
type: issue
state: open
author: NeilGirdhar
labels:
  - suppression
assignees: []
created_at: 2023-02-17T23:08:54Z
updated_at: 2024-04-08T02:03:21Z
url: https://github.com/astral-sh/ruff/issues/2999
synced_at: 2026-01-07T12:31:12-06:00
---

# Allow noqa on preceding line

---

_Issue opened by @NeilGirdhar on 2023-02-17 23:08_

Would it be possible to place the ignore comment on the preceding line?  Something like:
```python
    def to_exp(self) -> VonMisesFisherEP:
        q = self.mean_times_concentration
        kappa: RealArray = jnp.linalg.norm(q, 2, axis=-1, keepdims=True)
        # noqa: PLR2004
        return VonMisesFisherEP(jnp.where(kappa == 0.0, q, q * (_a_k(d, kappa) / kappa)))
```
in addition to
```python
    def to_exp(self) -> VonMisesFisherEP:
        q = self.mean_times_concentration
        kappa: RealArray = jnp.linalg.norm(q, 2, axis=-1, keepdims=True)
        return VonMisesFisherEP(
            jnp.where(kappa == 0.0,  # noqa: PLR2004
                      q,
                      q * (_a_k(d, kappa) / kappa)))
```
The latter sometimes requires breaking long lines of code in unnatural places.  The simple rule would be if `noqa` occurs on a line _without any code_, then it applies to the next line _that has code in it_.

This will be even more useful if human-friend rule names https://github.com/charliermarsh/ruff/issues/1773 are implemented since then the rule names will be longer, breaking even more lines of code.

---

_Referenced in [astral-sh/ruff#3000](../../astral-sh/ruff/issues/3000.md) on 2023-02-17 23:24_

---

_Label `noqa` added by @charliermarsh on 2023-02-17 23:44_

---

_Referenced in [python/cpython#101494](../../python/cpython/issues/101494.md) on 2023-02-25 21:58_

---

_Comment by @jamesbraza on 2023-05-26 20:41_

For reference, [`pylint` has a `disable-next` directive](https://pylint.readthedocs.io/en/latest/user_guide/messages/message_control.html), which accomplishes this nicely.

So similarly, there could be `# noqa-next`.

---

_Comment by @NeilGirdhar on 2024-04-07 20:37_

`noqa-next` is a cool idea.  If we're going down that road, you could also have:
* `noqa-file`: At the top of a file to indicate blocking the whole file.
* `noqa-block`: At the start of a block to indicate that it's for the entire block (function, if, while, etc.)

---

_Comment by @zanieb on 2024-04-07 21:32_

I think if/when we go this route we'd use directives similar to the Rust ecosystem.

---

_Comment by @NeilGirdhar on 2024-04-08 02:02_

@zanieb What are those like?

---
