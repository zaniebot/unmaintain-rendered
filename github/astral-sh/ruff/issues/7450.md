---
number: 7450
title: "Formatter undocumented deviation: ruff recurses into .git folder and can try to format files inside."
type: issue
state: closed
author: m-richards
labels:
  - bug
  - formatter
assignees: []
created_at: 2023-09-17T06:14:10Z
updated_at: 2023-09-25T09:40:00Z
url: https://github.com/astral-sh/ruff/issues/7450
synced_at: 2026-01-07T12:31:12-06:00
---

# Formatter undocumented deviation: ruff recurses into .git folder and can try to format files inside.

---

_Issue opened by @m-richards on 2023-09-17 06:14_

This is a quite an obscure edge case, but is still a behaviour difference with black. I maintain an open source project, and have previously checked out a branch from a contributor which they named `th-geodataframe.py`. This creates files `.git\logs\refs\heads\th-geodataframe.py` and `.git\refs\heads\th-geoseries.py` as part of git's internal data.

I ran `ruff format .` in the root of the repository to test out how the formatting compares to black and noticed it generated errors for these files, I guess ruff tries to format these as they are text files with a .py extension I guess.

I'm not exactly sure what black does here - why it doesn't format these (or if it does, why there are no errors). I suppose it might either blanket ignore .git folders or somehow try to check if a file contains valid python.

It seems it could be reasonable to never recurse into the .git folder? (or at least folders besides hooks, as one could have python file hooks)

It also seems fair enough to call this a weird edge case and not do anything special for it.



---

_Label `bug` added by @MichaReiser on 2023-09-17 13:17_

---

_Label `formatter` added by @MichaReiser on 2023-09-17 13:17_

---

_Comment by @MichaReiser on 2023-09-17 13:18_

Uhh, that shouldn't happen. Any chance you set [`respect-gitignore`](https://docs.astral.sh/ruff/settings/#respect-gitignore) to false in your project?

---

_Comment by @m-richards on 2023-09-18 12:08_

Ah, I managed to cut down to a minimal reproducer - it's because we have exclude set:
```toml

[tool.ruff]

exclude = ["doc/*"]

```
And I think we should be using extend-exclude instead?

---

_Comment by @dhruvmanila on 2023-09-18 12:14_

> And I think we should be using extend-exclude instead?

Yes, using `extend-exclude` should ignore the `.git` directory as it's included in the default value for [`exclude`](https://docs.astral.sh/ruff/settings/#exclude) option.

---

_Closed by @charliermarsh on 2023-09-18 13:18_

---

_Added to milestone `Formatter: Beta` by @MichaReiser on 2023-09-25 09:40_

---
