---
number: 4451
title: RUF009 false positive for descriptor fields
type: issue
state: closed
author: nstarman
labels:
  - bug
  - type-inference
assignees: []
created_at: 2023-05-16T14:41:19Z
updated_at: 2023-07-05T19:19:25Z
url: https://github.com/astral-sh/ruff/issues/4451
synced_at: 2026-01-07T12:31:12-06:00
---

# RUF009 false positive for descriptor fields

---

_Issue opened by @nstarman on 2023-05-16 14:41_

Dataclasses permit descriptor fields (https://docs.python.org/3.10/library/dataclasses.html#descriptor-typed-fields) but RUF009 is complaining about function calls at class construction. This is similar to https://github.com/charliermarsh/ruff/issues/4091, but I think sufficiently different to merit its own issue.


---

_Label `bug` added by @charliermarsh on 2023-05-16 14:54_

---

_Comment by @JonathanPlasse on 2023-05-16 15:25_

You can use [flake8-bugbear.extend-immutable-calls](https://beta.ruff.rs/docs/settings#extend-immutable-calls) to set your descriptor as immutable.
You can find this option in the rule documentation [function-call-in-dataclass-default-argument](https://beta.ruff.rs/docs/rules/function-call-in-dataclass-default-argument/)

The documentation could be explicit on the possibility to mark a call as immutable.

---

_Comment by @charliermarsh on 2023-05-16 17:17_

That's almost certainly the "best we can do" for now, until we can reliably detect that a class is a descriptor across files.

---

_Comment by @nstarman on 2023-05-16 20:13_

Thanks @JonathanPlasse. That looks like it will work for now.

@charliermarsh, what about within a file? Many of my descriptor field classes are defined in the same file as the dataclass.


---

_Comment by @JonathanPlasse on 2023-05-16 20:51_

Ruff did not have the type checking necessary to do this now.

---

_Comment by @charliermarsh on 2023-05-16 20:52_

We might be able to do it based on references though, even without type-checking. In the linked example, if the file were `src/foo.py`, we could certainly detect that references within that file to `IntConversionDescriptor` are `foo.IntConversionDescriptor`.

---

_Comment by @JonathanPlasse on 2023-05-16 20:54_

@charliermarsh, should we add a tag for issues that could be improved with type checking ability?
It would facilitate finding what should be changed when we add the type checker.

---

_Label `type-inference` added by @charliermarsh on 2023-05-16 20:55_

---

_Comment by @charliermarsh on 2023-05-16 20:55_

Yeah, we have an existing tag -- just added it.

---

_Referenced in [astral-sh/ruff#5537](../../astral-sh/ruff/pulls/5537.md) on 2023-07-05 19:05_

---

_Closed by @charliermarsh on 2023-07-05 19:19_

---
