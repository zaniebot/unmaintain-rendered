---
number: 5822
title: "Formatter: Ellipses in stub files get formatted on a single line"
type: issue
state: closed
author: konstin
labels:
  - good first issue
  - formatter
  - help wanted
assignees: []
created_at: 2023-07-17T06:53:20Z
updated_at: 2024-02-16T21:33:30Z
url: https://github.com/astral-sh/ruff/issues/5822
synced_at: 2026-01-07T12:31:12-06:00
---

# Formatter: Ellipses in stub files get formatted on a single line

---

_Issue opened by @konstin on 2023-07-17 06:53_

If a class, method or function is stub out with an ellipsis (`...`), black gives them their own line in python files and appends them end-of-line after the colon in stub files:

**scratch.py**

```python
class Animal:
    ...


class Cat(Animal):
    def meow(self):
        ...


def f():
    ...
```


**scratch.pyi**

```python
class Animal: ...

class Cat(Animal):
    def meow(self): ...

def f(): ...
```

---

_Label `formatter` added by @konstin on 2023-07-17 06:53_

---

_Comment by @MichaReiser on 2023-07-17 07:34_

Note: This requires tracking the source type and passing it to the formatter context.

---

_Referenced in [astral-sh/ruff#5828](../../astral-sh/ruff/issues/5828.md) on 2023-07-17 09:32_

---

_Added to milestone `Formatter: Stable` by @MichaReiser on 2023-07-31 16:16_

---

_Comment by @andersk on 2023-08-02 19:03_

With any luck, Black will soon be changing here to allow the concise form in both `.py` and `.pyi` files.

- psf/black#1797
- psf/black#3796

---

_Comment by @konstin on 2023-08-03 09:59_

Applying the same formatting for source and stub files would be nice, and it would also reduce formatter complexity because it gives us one variable that changes formatting less.

---

_Comment by @hauntsaninja on 2023-08-04 01:58_

Black still handles other things (like whitespace) differently between py and pyi, so you'll still need to put source type in formatter context if you wish to format stub files like Black does.

---

_Comment by @MichaReiser on 2023-08-04 05:48_

We should probably implement this anyway for now, because the change will be part of Black's new preview style.

---

_Referenced in [astral-sh/ruff#6331](../../astral-sh/ruff/pulls/6331.md) on 2023-08-04 07:37_

---

_Comment by @konstin on 2023-08-04 07:38_

Added the file type information to the context #6331

---

_Label `good first issue` added by @konstin on 2023-08-10 08:43_

---

_Label `help wanted` added by @konstin on 2023-08-10 08:43_

---

_Comment by @konstin on 2023-08-10 08:45_

`PyFormatOptions` now has a `source_type` field

---

_Referenced in [astral-sh/ruff#6501](../../astral-sh/ruff/pulls/6501.md) on 2023-08-11 15:29_

---

_Referenced in [astral-sh/ruff#6592](../../astral-sh/ruff/pulls/6592.md) on 2023-08-15 10:04_

---

_Closed by @MichaReiser on 2023-08-21 07:02_

---

_Removed from milestone `Formatter: Stable` by @MichaReiser on 2023-08-22 14:20_

---

_Added to milestone `Formatter: Alpha` by @MichaReiser on 2023-08-22 14:20_

---

_Referenced in [jackmpcollins/magentic#15](../../jackmpcollins/magentic/pulls/15.md) on 2023-09-14 07:24_

---

_Comment by @saulshanabrook on 2024-02-16 21:16_

Hey! I would love to try to adopt this formatting in my normal Python files as well. I saw that black I believe supports this under the next flag and was curious if that might be possible to support in ruff too.

---

For what it's worth, my use case is for [a library](https://egglog-python.readthedocs.io/latest/) that allows other libraries to create DSLs based off uninterpreted functions, so none of them will have bodies. I have [gotten some feedback](https://egraphs.zulipchat.com/#narrow/stream/375765-egg.2Fegglog/topic/egglog.20python.20midlevel.20api/near/421923656) that it's annoying that it takes an extra line for every definition.

---

_Comment by @MichaReiser on 2024-02-16 21:20_

@saulshanabrook You can give it a try by running the formatter with `--preview`. We plan to release the new preview styles soon. See https://github.com/astral-sh/ruff/issues/8678

---

_Referenced in [egraphs-good/egglog-python#122](../../egraphs-good/egglog-python/pulls/122.md) on 2024-02-16 21:31_

---

_Comment by @saulshanabrook on 2024-02-16 21:33_

Oh wow, thank you @MichaReiser! That's great!

---

_Referenced in [astral-sh/ruff#10026](../../astral-sh/ruff/issues/10026.md) on 2024-02-18 13:39_

---

_Referenced in [pydata/xarray#8761](../../pydata/xarray/pulls/8761.md) on 2024-02-18 14:10_

---

_Referenced in [dagster-io/dagster#20249](../../dagster-io/dagster/pulls/20249.md) on 2024-03-04 23:41_

---
