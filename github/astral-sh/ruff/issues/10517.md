---
number: 10517
title: "rule for ValueError: I/O operation on closed file."
type: issue
state: open
author: tooptoop4
labels:
  - rule
assignees: []
created_at: 2024-03-22T05:16:34Z
updated_at: 2024-04-06T05:04:50Z
url: https://github.com/astral-sh/ruff/issues/10517
synced_at: 2026-01-07T12:31:13-06:00
---

# rule for ValueError: I/O operation on closed file.

---

_Issue opened by @tooptoop4 on 2024-03-22 05:16_

ruff does not complain about:
```
with open('/a.txt', "w") as f:
    f.write('a')
with open('/b.txt', "w"):
    f.write('b')
```

but python does:
```
ValueError: I/O operation on closed file.
```

---

_Label `rule` added by @MichaReiser on 2024-03-22 07:43_

---

_Comment by @MichaReiser on 2024-03-22 07:43_

Do you think the rule could be generalized to disallow method calls on any object defined in a context expression after the `with` statement?

---

_Comment by @zanieb on 2024-03-22 20:32_

@MichaReiser no, you can safely use many objects after their context is exited :) we'd need type-inference for that to be broadly correct.

---

_Comment by @autinerd on 2024-03-24 07:40_

For example with `with pytest.raises() as exc_info` you have to use the object after the context is exited.

---

_Comment by @charliermarsh on 2024-03-24 20:13_

We would probably need to make this specific to `open` calls (which would be okay).

---

_Comment by @tooptoop4 on 2024-04-06 05:04_

https://github.com/wemake-services/wemake-python-styleguide?tab=readme-ov-file finds this

flake8 --select WPS441 somefile.py

https://wemake-python-styleguide.readthedocs.io/en/0.16.1/pages/usage/violations/best_practices.html#wemake_python_styleguide.violations.best_practices.ControlVarUsedAfterBlockViolation


---

_Referenced in [astral-sh/ruff#15865](../../astral-sh/ruff/pulls/15865.md) on 2025-02-01 01:18_

---
