---
number: 8683
title: "query: UP032 fix leaves bad formatting?"
type: issue
state: closed
author: lucascolley
labels:
  - fixes
assignees: []
created_at: 2023-11-14T20:21:42Z
updated_at: 2023-11-16T07:47:21Z
url: https://github.com/astral-sh/ruff/issues/8683
synced_at: 2026-01-07T12:31:12-06:00
---

# query: UP032 fix leaves bad formatting?

---

_Issue opened by @lucascolley on 2023-11-14 20:21_

noted by @ilayn https://github.com/scipy/scipy/pull/19516#issuecomment-1810150463

version: ruff 0.1.5

UP032 fix seems to leave some undesired formatting. In the case of SciPy where we want to run the linter without a formatter, this is less than ideal. Is this the intended behaviour, or could it be improved? Examples:

```diff
- raise ValueError("Conflicting configuration dicts: {!r} {!r}"
-                  "".format(new_dict, d))
+ raise ValueError(f"Conflicting configuration dicts: {new_dict!r} {d!r}"
+                  "")
```

```diff
+ raise ValueError("invalid number of data points ({}) specified"
+                  .format(tmp.shape[axis]))
- raise ValueError(f"invalid number of data points ({tmp.shape[axis]}) specified"
-                  )

---

_Comment by @charliermarsh on 2023-11-14 21:31_

Fix formatting is very much a best-effort thing, but we can definitely try to improve these. (I might argue that the first one had strange formatting _before_ the fix too :))

---

_Label `autofix` added by @charliermarsh on 2023-11-14 21:31_

---

_Comment by @lucascolley on 2023-11-14 21:35_

> I might argue that the first one had strange formatting _before_ the fix too

Definitely ðŸ˜† I don't know how much code is formatted like this in the wider world but there are quite a few cases of this in scipy/scipy#19516

---

_Comment by @ilayn on 2023-11-14 21:41_

> first one had strange formatting before the fix too

Indeed and I am responsible for a few of those. But in our defense, the reasoning is the PEP8 80 chars line limit olympics. 

We can live with the 2nd example though not really a big deal.

---

_Comment by @charliermarsh on 2023-11-15 17:38_

It'd be nice to detect-and-strip trailing empty strings and trailing newlines.

---

_Assigned to @charliermarsh by @charliermarsh on 2023-11-16 02:59_

---

_Referenced in [astral-sh/ruff#8712](../../astral-sh/ruff/pulls/8712.md) on 2023-11-16 03:59_

---

_Closed by @charliermarsh on 2023-11-16 04:14_

---

_Comment by @charliermarsh on 2023-11-16 04:15_

Hopefully better in the next release! At least, the two examples above are fixed by https://github.com/astral-sh/ruff/pull/8712.

---

_Comment by @ilayn on 2023-11-16 07:47_

@charliermarsh thank you for the rapid action. Much appreciated. 

---

_Referenced in [scipy/scipy#19516](../../scipy/scipy/pulls/19516.md) on 2023-11-16 08:40_

---

_Referenced in [scikit-image/scikit-image#7197](../../scikit-image/scikit-image/pulls/7197.md) on 2023-11-16 18:08_

---
