---
number: 5739
title: Ruff fails when a directory ends with .py
type: issue
state: closed
author: konstin
labels:
  - bug
  - good first issue
  - help wanted
assignees: []
created_at: 2023-07-13T15:17:56Z
updated_at: 2023-07-18T01:25:44Z
url: https://github.com/astral-sh/ruff/issues/5739
synced_at: 2026-01-07T12:31:12-06:00
---

# Ruff fails when a directory ends with .py

---

_Issue opened by @konstin on 2023-07-13 15:17_

Ruff gets confused when a directory is named like a python file (ends with `.py`):

```shell
$ mkdir repro
$ mkdir repro/some_folder.py
$ cargo run --bin ruff -- --no-cache repro
error: Failed to lint repro/some_folder.py: Is a directory (os error 21)
  Caused by: Is a directory (os error 21)
repro/some_folder.py:1:1: E902 Is a directory (os error 21)
  Caused by: Is a directory (os error 21)
Found 1 error.
```



---

_Label `bug` added by @konstin on 2023-07-13 15:17_

---

_Comment by @zanieb on 2023-07-13 23:18_

@konstin is this a good first issue?

---

_Comment by @charliermarsh on 2023-07-13 23:21_

(From my perspective, seems like a good issue, will probably require digging into how we collect the "files to lint".)

---

_Label `help wanted` added by @zanieb on 2023-07-13 23:25_

---

_Label `good first issue` added by @konstin on 2023-07-14 08:47_

---

_Comment by @konstin on 2023-07-14 08:48_

i've confirmed it's not related to #5611, so yes it's a good first issue

---

_Comment by @harupy on 2023-07-15 07:38_

can I work on this?

---

_Comment by @harupy on 2023-07-15 07:51_

Is this the part that needs to be fixed?

https://github.com/astral-sh/ruff/blob/f029f8b7840e4477f2f42d8f589c4ac290a249e6/crates/ruff/src/resolver.rs#L332-L350


It looks like the else block is missing `is_file` check.

---

_Comment by @harupy on 2023-07-15 07:59_

Testing the following change:

```diff
diff --git a/crates/ruff/src/resolver.rs b/crates/ruff/src/resolver.rs
index 0ad0fa244..0d851135c 100644
--- a/crates/ruff/src/resolver.rs
+++ b/crates/ruff/src/resolver.rs
@@ -330,9 +330,12 @@ pub fn python_files_in_path(
             }
 
             if result.as_ref().map_or(true, |entry| {
+                if !(entry.file_type().map_or(false, |ft| ft.is_file())) {
+                    return false;
+                }
                 if entry.depth() == 0 {
                     // Accept all files that are passed-in directly.
-                    entry.file_type().map_or(false, |ft| ft.is_file())
+                    true
                 } else {
                     // Otherwise, check if the file is included.
                     let path = entry.path();
```


Result:

```
> tree dir
dir
├── dir.py
│   └── file.py
└── file.py

1 directory, 2 files

> cargo run -p ruff_cli -- check dir --no-cache
    Finished dev [unoptimized + debuginfo] target(s) in 0.08s
     Running `target/debug/ruff check dir --no-cache`
dir/dir.py/file.py:1:7: F821 Undefined name `a`
dir/file.py:1:7: F821 Undefined name `a`
Found 2 errors.
```

---

_Assigned to @harupy by @konstin on 2023-07-15 08:43_

---

_Referenced in [astral-sh/ruff#5775](../../astral-sh/ruff/pulls/5775.md) on 2023-07-15 11:19_

---

_Closed by @zanieb on 2023-07-18 01:25_

---
