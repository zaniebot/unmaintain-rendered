---
number: 16317
title: unnecessary-literal-union (PYI030) can remove comments without being marked as unsafe
type: issue
state: closed
author: Avasam
labels:
  - bug
  - fixes
  - help wanted
assignees: []
created_at: 2025-02-22T17:41:40Z
updated_at: 2025-02-23T21:22:15Z
url: https://github.com/astral-sh/ruff/issues/16317
synced_at: 2026-01-07T12:31:13-06:00
---

# unnecessary-literal-union (PYI030) can remove comments without being marked as unsafe

---

_Issue opened by @Avasam on 2025-02-22 17:41_

### Description

Reproduction:
```py
from typing import Literal

_: (
    # First group
    Literal["a", "b"]
    # Second group
    | Literal["c", "d"]
)
```

Becomes:
```py
from typing import Literal

_: (
    # First group
    Literal["a", "b", "c", "d"]
)
```

What I'd expect:
```py
from typing import Literal

_: (
    Literal[
        # First group
        "a",
        "b",
        # Second group
        "c",
        "d",
    ]
)
```

I don't think the autofix needs to know where to put the comments (although that'd be nice). Marking the autofix as unsafe in this situation like many other rules already do is enough.

Ruff version: 0.9.6

---

_Label `bug` added by @ntBre on 2025-02-22 18:44_

---

_Label `fixes` added by @ntBre on 2025-02-22 18:44_

---

_Label `help wanted` added by @ntBre on 2025-02-22 18:44_

---

_Comment by @ntBre on 2025-02-22 18:54_

Thanks for the report! If anyone wants to work on this, the main fix is something like this (from [TC006](https://docs.astral.sh/ruff/rules/runtime-cast-value/)):
https://github.com/astral-sh/ruff/blob/64effa4aead8bf2e5eeafbe48abed7921862b4d1/crates/ruff_linter/src/rules/flake8_type_checking/rules/runtime_cast_value.rs#L73-L77

where we check if the region being replaced contains any comments. We'll also need to add a `## Fix safety` section to the rule documentation, also along the lines of TC006 or [SIM905](https://docs.astral.sh/ruff/rules/split-static-string/#fix-safety).

We'll also want some new test cases showing where comments are preserved and lost.

---

_Comment by @VascoSch92 on 2025-02-22 20:07_

I can give a try ;)

---

_Assigned to @VascoSch92 by @ntBre on 2025-02-22 20:08_

---

_Referenced in [astral-sh/ruff#16322](../../astral-sh/ruff/pulls/16322.md) on 2025-02-22 22:54_

---

_Closed by @AlexWaygood on 2025-02-23 21:22_

---
