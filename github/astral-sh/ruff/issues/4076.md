---
number: 4076
title: F811 false positive in match statement
type: issue
state: closed
author: cgahr
labels:
  - bug
assignees: []
created_at: 2023-04-24T08:45:48Z
updated_at: 2023-04-30T18:39:47Z
url: https://github.com/astral-sh/ruff/issues/4076
synced_at: 2026-01-07T12:31:12-06:00
---

# F811 false positive in match statement

---

_Issue opened by @cgahr on 2023-04-24 08:45_

Hi,

really love ruff, such a great tool! It also inspired me to learn Rust ;)

I found the following bug, which can be reproduced with this MWE:
```python
def no_redef(value):
    if value:

        def fun(x, y):
            return x

    else:

        def fun(x, y):
            return y

    return fun


def redef(value):
    match value:
        case True:

            def fun(x, y):
                return x

        case False:

            def fun(x, y):
                return y

    return fun
```
Running ruff throws the following error which (IMO) is a bug:
```bash
> ruff redef.py --isolated
redef.py:24:17: F811 Redefinition of unused `fun` from line 19
Found 1 error.
```
**Why is this a bug?** 
In my understanding both the `no_redef` and `redef` function have the same behavior. Thus, F811 should behave the same for both functions, which is not the case.


This behavior is consistent with flake8/pyflakes, however, I think this is a bug in their code as well and I opened a ticket there too (https://github.com/PyCQA/pyflakes/issues/771).


**Ruff version**
```bash
> ruff --version
ruff 0.0.261
```

**pyproject.toml**
```toml
[tool.ruff]
select = ["F"]
target-version = "py38"
```

Constantin

---

_Comment by @dhruvmanila on 2023-04-24 16:54_

Looking at the way the detection works, I think we might require help from `RustPython` in order to resolve this. Currently, the branch detection only works for an `if` statement:

https://github.com/charliermarsh/ruff/blob/d64146683ee571832b1d6ce61fe8dc79052fd3b7/crates/ruff/src/checkers/ast/mod.rs#L4143-L4148

Correct me if I'm wrong!

---

_Comment by @JonathanPlasse on 2023-04-24 20:25_

I think the solution would be to add MatchCase to the binding and implement an equivalent different_forks for MatchCase instead of Stmt.
I can pick it up.

---

_Label `bug` added by @charliermarsh on 2023-04-25 00:13_

---

_Referenced in [astral-sh/ruff#4161](../../astral-sh/ruff/pulls/4161.md) on 2023-04-30 13:08_

---

_Closed by @charliermarsh on 2023-04-30 18:39_

---
