---
number: 6721
title: "Failed to fix nested if: Failed to extract statement from source"
type: issue
state: closed
author: qarmin
labels:
  - needs-decision
  - fuzzer
assignees: []
created_at: 2023-08-21T09:20:24Z
updated_at: 2023-10-01T08:21:42Z
url: https://github.com/astral-sh/ruff/issues/6721
synced_at: 2026-01-07T12:31:12-06:00
---

# Failed to fix nested if: Failed to extract statement from source

---

_Issue opened by @qarmin on 2023-08-21 09:20_

Ruff 0.0.285

```
ruff  *.py --select ALL --no-cache
```

file content:
```
def find_compatible_interpreter(interpreter_test=None):
    def gather_constraints():
            constraints.append("PEX_PYTHON={}".format(ENV.PEX_PYTHON))
        if ENV.PEX_PYTHON_PATH:
        if interpreter_constraints:
            constraints.append("Version matches {}".format(interpreter_constraints))
```

error:
```
error: Failed to fix nested if: Failed to extract statement from source
```

[PY_FILE_TEST_12681606511.py.zip](https://github.com/astral-sh/ruff/files/12394446/PY_FILE_TEST_12681606511.py.zip)


---

_Comment by @dhruvmanila on 2023-08-21 11:00_

Interesting! Shouldn't this raise an indentation error @MichaReiser? It isn't doing so https://play.ruff.rs/a673ff2e-1672-4c8d-8eb3-e58a4d8c923f, while Python does raise it:
```
    if ENV.PEX_PYTHON_PATH:
                           ^
IndentationError: unindent does not match any outer indentation level
```

---

_Label `fuzzer` added by @charliermarsh on 2023-08-21 12:58_

---

_Comment by @charliermarsh on 2023-08-21 12:58_

I am personally fine _not_ to fix errors that arise from invalid Python syntax.

---

_Label `needs-decision` added by @charliermarsh on 2023-08-21 12:58_

---

_Referenced in [astral-sh/ruff#6811](../../astral-sh/ruff/issues/6811.md) on 2023-08-23 13:32_

---

_Comment by @qarmin on 2023-10-01 08:21_

File is not longer parsable

---

_Closed by @qarmin on 2023-10-01 08:21_

---
