---
number: 17062
title: "docs: fix safety of `UP007` should be clarified"
type: issue
state: open
author: pjonsson
labels:
  - documentation
assignees: []
created_at: 2025-03-30T10:43:22Z
updated_at: 2025-04-09T08:21:56Z
url: https://github.com/astral-sh/ruff/issues/17062
synced_at: 2026-01-07T12:31:13-06:00
---

# docs: fix safety of `UP007` should be clarified

---

_Issue opened by @pjonsson on 2025-03-30 10:43_

### Summary

This pyproject.yaml:
```yaml
[tool.ruff]
target-version = "py310"

[tool.ruff.lint]
select = ["UP"]
```
and running `ruff check --fix file.py` on this example:
```python
from typing import Optional

def a() -> Optional[str]:
    return None
```
results in:
```python
from typing import Optional

def a() -> str | None:
    return None
```
so Ruff has updated the type signature, but left the import.

Trying to figure out if my expectations are wrong, the documentation at https://docs.astral.sh/ruff/rules/non-pep604-annotation-union/#fix-safety says:

> This rule's fix is marked as unsafe, as it may lead to runtime errors when alongside libraries that rely on runtime type annotations, like Pydantic, on Python versions prior to Python 3.10.

which I believe is contradictory to being able to use `--fix`, unsafe rules require enabling some other switch.

Edit: the phrasing "it may lead to runtime errors when alongside libraries" is also confusing to me; what is alongside the libraries, the fix?

### Version

ruff 0.11.2

---

_Comment by @ntBre on 2025-03-30 14:42_

Most of the time rules like this don't remove the imports on their own. I would expect [unused-import (F401)](https://docs.astral.sh/ruff/rules/unused-import/#unused-import-f401) to clean it  up instead. Have you tried enabling both rules?

---

_Label `question` added by @ntBre on 2025-03-30 14:42_

---

_Comment by @ntBre on 2025-03-30 14:51_

To your question about the docs, I think they are a bit confusing. In looking at the code, the fix is marked unsafe on Python versions "prior to Python 3.10" (so 3.9 and earlier) but safe on and after 3.10, which is why you only had to run with `--fix` instead of `--unsafe-fixes` with a target version of 3.10.

I'm not sure of the specific interactions with Pydantic being referenced here, but I think it would be slightly more clear if the docs said "**used** alongside" rather than just "alongside." So I take it to mean that some interaction with libraries like Pydantic before Python 3.10 could require the old annotation to be present, making the fix unsafe.

---

_Label `documentation` added by @ntBre on 2025-03-30 14:51_

---

_Label `question` removed by @ntBre on 2025-03-30 14:51_

---

_Comment by @pjonsson on 2025-03-30 17:22_

If the fix is meant to leave the unused imports I guess it's not a bug, but documentation issue as you've tagged.

For the documentation issue, I suggest to flip the sentence around:

> This rule's fix is marked as unsafe on Python versions prior to 3.10 since it may introduce runtime errors in code that uses libraries that rely on runtime type annotations, like Pydantic.

---

_Renamed from "`UP007` fix leaves unused imports" to "docs: fix safety of `UP007` should be clarified" by @pjonsson on 2025-04-09 08:21_

---
