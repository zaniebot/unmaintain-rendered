---
number: 17405
title: ruff check with file read from stdin does not use options from pyproject.toml when --stdin-filename argument is used
type: issue
state: open
author: ipvych
labels:
  - configuration
  - needs-decision
assignees: []
created_at: 2025-04-15T07:43:01Z
updated_at: 2025-04-22T09:17:34Z
url: https://github.com/astral-sh/ruff/issues/17405
synced_at: 2026-01-07T12:31:13-06:00
---

# ruff check with file read from stdin does not use options from pyproject.toml when --stdin-filename argument is used

---

_Issue opened by @ipvych on 2025-04-15 07:43_

### Summary

# Steps to reproduce:
```shell
mkdir repro
cd repro
echo '[project]
requires-python = ">=3.11"
[tool.ruff.lint]
extend-select = ["UP"]' > pyproject.toml

mkdir src
cd src
echo -e 'from typing import Callable\nCallable' > repro.py

ruff check --stdin-filename stdin - < repro.py
```

# Observed behavior:
Ruff reported no issues found in file

# Expected behavior:
Pyupgrade plugin that was enabled in pyproject.toml should have reported `Import from collections.abc instead: Callable` error.  Error is correctly reported when I remove `--stdin-filename <anything>` flag from ruff command line or when I run `ruff check repro.py` directly.


### Version

ruff 0.11.5 (7186d5e9a 2025-04-10)

---

_Label `question` added by @dylwil3 on 2025-04-15 10:28_

---

_Label `question` removed by @dylwil3 on 2025-04-15 10:36_

---

_Label `configuration` added by @dylwil3 on 2025-04-15 10:36_

---

_Comment by @dylwil3 on 2025-04-15 10:45_

In your situation the following should both work:

```console
ruff check --stdin-filename ../stdin - < repro.py
```

or, from `repro` instead of `repro/src`:

```console
ruff check --stdin-filename stdin - < src/repro.py
```

When searching for a configuration, we look at ancestors of the current working directory for configuration files - but if you pass in a stdin filename, we use ancestors of whatever path you give.

Probably this should be more clearly documented, but I think it might be correct behavior? I guess another option would be to try to join the stdin filename with the current working directory? Maybe others can weigh in.

---

_Label `needs-decision` added by @dylwil3 on 2025-04-15 10:45_

---

_Comment by @ipvych on 2025-04-15 11:16_

I expected `--stdin-filename` to only affect the text that is displayed as file name (the `-` part of `-:1:1: UP035 [*] Import from `collections.abc` instead: `Callable``) when file is passed via stdin and nothing else. 

I want to change that part to `stdin` so output is similar to that of flake8 allowing me to reuse existing tooling that expects flake8 output by just replacing command to ruff. Specifically in Emacs there is a builtin variable specifying command to use for linting code that I want to make just work with ruff without messing up with regexps that parse output of the command.

---

_Comment by @MichaReiser on 2025-04-22 09:17_

> Probably this should be more clearly documented, but I think it might be correct behavior? I guess another option would be to try to join the stdin filename with the current working directory? Maybe others can weigh in.

The current behavior was added in https://github.com/astral-sh/ruff/pull/1281 

Making the stdin path absolute does sound reasonable to me (unless it is already absolute)

---
