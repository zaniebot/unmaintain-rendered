---
number: 14204
title: FURB157 has incorrect fixes when replacing strings with integers
type: issue
state: closed
author: dscorbett
labels:
  - bug
  - fixes
assignees: []
created_at: 2024-11-08T14:23:21Z
updated_at: 2024-11-09T02:08:24Z
url: https://github.com/astral-sh/ruff/issues/14204
synced_at: 2026-01-07T12:31:13-06:00
---

# FURB157 has incorrect fixes when replacing strings with integers

---

_Issue opened by @dscorbett on 2024-11-08 14:23_

The fixes for [`verbose-decimal-constructor` (FURB157)](https://docs.astral.sh/ruff/rules/verbose-decimal-constructor/) are sometimes incorrect in Ruff 0.7.3. Two of them change behavior and one introduces a syntax error.

First, negative zero should be kept as a string. `int` doesn’t have signed zeroes but `Decimal` does.
```console
$ cat furb157.py
from decimal import Decimal
print(Decimal("-0"))

$ python furb157.py
-0

$ ruff check --isolated --preview --select FURB157 furb157.py --fix
Found 1 error (1 fixed, 0 remaining).

$ cat furb157.py
from decimal import Decimal
print(Decimal(-0))

$ python furb157.py
0
```

Second, the empty string should not be normalized to zero. The empty string signals an `InvalidOperation`, which can be trapped and converted to NaN or can cause an error. “Empty” here refers to the string after normalizing away white space and underscores.
```console
$ cat furb157.py
from decimal import Decimal, ExtendedContext
print(Decimal("_", ExtendedContext))
print(Decimal(" "))

$ python furb157.py
NaN
Traceback (most recent call last):
  File "furb157.py", line 3, in <module>
    print(Decimal(" "))
          ^^^^^^^^^^^
decimal.InvalidOperation: [<class 'decimal.ConversionSyntax'>]

$ ruff check --isolated --preview --select FURB157 furb157.py --fix
Found 2 errors (2 fixed, 0 remaining).

$ cat furb157.py
cat furb157.py
from decimal import Decimal, ExtendedContext
print(Decimal(0, ExtendedContext))
print(Decimal(0))

$ python furb157.py
0
0
```

Third, decimal `int` literals with too many digits cause syntax errors. [The minimum maximum digit count](https://docs.python.org/3.13/library/sys.html#sys.int_info.str_digits_check_threshold) is 640. If the integer-valued string argument to `Decimal` has over that many digits, it should stay a string.
```console
$ { printf 'from decimal import Decimal\nDecimal("1'; printf 0%0.s {1..640}; printf '")\n'; } >furb157.py

$ PYTHONINTMAXSTRDIGITS=640 python furb157.py

$ ruff check --isolated --preview --select FURB157 furb157.py --fix
Found 1 error (1 fixed, 0 remaining).

$ PYTHONINTMAXSTRDIGITS=640 python furb157.py 2>&1 | tail -n 1
SyntaxError: Exceeds the limit (640 digits) for integer string conversion: value has 641 digits; use sys.set_int_max_str_digits() to increase the limit - Consider hexadecimal for huge integer literals to avoid decimal conversion limits.
```

---

_Comment by @dylwil3 on 2024-11-08 21:29_

Fantastic, thank you!

---

_Assigned to @dylwil3 by @dylwil3 on 2024-11-08 21:30_

---

_Label `bug` added by @AlexWaygood on 2024-11-08 22:34_

---

_Label `fixes` added by @AlexWaygood on 2024-11-08 22:34_

---

_Referenced in [astral-sh/ruff#14216](../../astral-sh/ruff/pulls/14216.md) on 2024-11-08 23:42_

---

_Closed by @charliermarsh on 2024-11-09 02:08_

---

_Referenced in [astral-sh/ruff#20588](../../astral-sh/ruff/pulls/20588.md) on 2025-09-30 20:13_

---
