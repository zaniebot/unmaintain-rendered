---
number: 12913
title: "[feature request] FastAPI rule: prefer `Annotated` for `Query`, `Path`, `Body`, `Cookie`"
type: issue
state: closed
author: tiangolo
labels:
  - rule
assignees: []
created_at: 2024-08-16T01:44:06Z
updated_at: 2025-01-15T18:05:55Z
url: https://github.com/astral-sh/ruff/issues/12913
synced_at: 2026-01-07T12:31:13-06:00
---

# [feature request] FastAPI rule: prefer `Annotated` for `Query`, `Path`, `Body`, `Cookie`

---

_Issue opened by @tiangolo on 2024-08-16 01:44_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

## In short

I would like to have a FastAPI rule to prefer `Annotated` for:

* `Body`
* `Cookie`
* `File`
* `Form`
* `Header`
* `Path`
* `Query`

and hopefully autofix them.

 `Depends` and `Security` are already supported.

This would be related to/continuation of https://github.com/astral-sh/ruff/pull/11579

## Description

I would like to have `Annotated` as the recommended style/syntax for FastAPI params that support it:

* `Body`
* `Cookie`
* `File`
* `Form`
* `Header`
* `Path`
* `Query`

This is very similar to the rule for  `Depends` and `Security` implemented here: https://github.com/astral-sh/ruff/pull/11579

The only caveat is that if one of these parameters has a `default` argument (or the first argument), as in `Query(default="foo")` then that would become the new default value. For example:

```Python
@app.post("/stuff/")
def do_stuff(
    some_query_param: str | None = Query(default=None),
    some_path_param: str = Path(),
    some_body_param: str = Body("foo"),
    some_cookie_param: str = Cookie(),
    some_header_param: int = Header(default=5),
    some_file_param: UploadFile = File(),
    some_form_param: str = Form(),
):
    # do stuff
    pass
```

would ideally be transformed into:

```Python
@app.post("/stuff/")
def do_stuff(
    some_path_param: Annotated[str, Path()],
    some_cookie_param: Annotated[str, Cookie()],
    some_file_param: Annotated[UploadFile, File()],
    some_form_param: Annotated[str, Form()],
    some_query_param: Annotated[str | None, Query()] = None,
    some_body_param: Annotated[str, Body()] = "foo",
    some_header_param: Annotated[int, Header()] = 5,
):
    # do stuff
    pass
```

or:

```Python
@app.post("/stuff/")
def do_stuff(
   *,
    some_query_param: Annotated[str | None, Query()] = None,
    some_path_param: Annotated[str, Path()],
    some_body_param: Annotated[str, Body()] = "foo",
    some_cookie_param: Annotated[str, Cookie()],
    some_header_param: Annotated[int, Header()] = 5,
    some_file_param: Annotated[UploadFile, File()],
    some_form_param: Annotated[str, Form()],
):
    # do stuff
    pass
```

---

_Label `rule` added by @charliermarsh on 2024-08-16 01:45_

---

_Label `help wanted` added by @charliermarsh on 2024-08-16 01:45_

---

_Comment by @amirsoroush on 2024-08-16 03:44_

Have a question though:
The ideal form currently has invalid syntax as some non-default parameters follow the default parameters. Does that mean Ruff is *also* going to change the order of the parameters to fix it? In that case the dependencies are going to be resolved in different order.
I usually tend to put the (mostly custom one with `Depends` not Query and Body etc.) dependencies that would fail fast at the beginning.
What would be the behavior of Ruff? Is that something I should concern about at all?
Thanks.

---

_Comment by @tiangolo on 2024-08-16 04:54_

Right! I just updated the expected result. :nerd_face: 

---

_Comment by @kiran-4444 on 2024-08-16 04:59_

Iâ€™d love to take this up!

---

_Comment by @RevKraft on 2024-08-16 05:16_

I can give some help on that and team up with other people

---

_Comment by @MichaReiser on 2024-08-16 05:48_

Thanks for suggesting this rule. Is there some resource that explains why using `Annotated` is preferred? It's probably a silly question but for someone who never used fastapi (or Python) a lot, it primarily looks more verbose ;) 

---

_Comment by @TomerBin on 2024-08-16 06:58_

> Thanks for suggesting this rule. Is there some resource that explains why using `Annotated` is preferred? It's probably a silly question but for someone who never used fastapi (or Python) a lot, it primarily looks more verbose ;) 

Here it is https://fastapi.tiangolo.com/tutorial/dependencies/#share-annotated-dependencies

---

_Comment by @MichaReiser on 2024-08-16 07:04_

Thanks, I think this is the important section (we should link it in the rule) https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#advantages-of-annotated

---

_Comment by @TomerBin on 2024-08-16 07:39_

We should already support all of the mentioned params (Query, File, etc..). Can you please attach your code sample where it doesn't work as expected? I put your example in the Ruff playground (with the needed imports) and it seems to work.

Regarding the default value handling - I really liked @tiangolo suggestion of adding `*` when needed. 

---

_Comment by @tiangolo on 2024-08-16 15:37_

> We should already support all of the mentioned params (Query, File, etc..). Can you please attach your code sample where it doesn't work as expected? I put your example in the Ruff playground (with the needed imports) and it seems to work.

Indeed! :scream: That's amazing! I assumed it didn't work, but it actually does! :rocket: 

From:

```Python
@app.post("/stuff/")
def do_stuff(
    some_query_param: str | None = Query(default=None),
    some_path_param: str = Path(),
    some_body_param: str = Body("foo"),
    some_cookie_param: str = Cookie(),
    some_header_param: int = Header(default=5),
    some_file_param: UploadFile = File(),
    some_form_param: str = Form(),
):
    # do stuff
    pass
```

to:

```Python
@app.post("/stuff/")
def do_stuff(
    some_query_param: Annotated[str | None, Query(default=None)],
    some_path_param: Annotated[str, Path()],
    some_body_param: Annotated[str, Body("foo")],
    some_cookie_param: Annotated[str, Cookie()],
    some_header_param: Annotated[int, Header(default=5)],
    some_file_param: Annotated[UploadFile, File()],
    some_form_param: Annotated[str, Form()],
):
    # do stuff
    pass

```

The only piece missing would be to move the `default` outside of `Annotated`. Maybe with `*`.

---

_Label `help wanted` removed by @MichaReiser on 2024-12-02 17:23_

---

_Referenced in [astral-sh/ruff#15462](../../astral-sh/ruff/pulls/15462.md) on 2025-01-13 22:26_

---

_Closed by @ntBre on 2025-01-15 18:05_

---

_Closed by @ntBre on 2025-01-15 18:05_

---
