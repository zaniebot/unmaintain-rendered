---
number: 10264
title: Update parser to have Notebook context
type: issue
state: open
author: dhruvmanila
labels:
  - wish
  - parser
  - notebook
assignees: []
created_at: 2024-03-07T03:52:22Z
updated_at: 2024-03-07T05:32:20Z
url: https://github.com/astral-sh/ruff/issues/10264
synced_at: 2026-01-07T12:31:13-06:00
---

# Update parser to have Notebook context

---

_Issue opened by @dhruvmanila on 2024-03-07 03:52_

Taking the following 2 code cells as an example:

_Cell 1:_
```python
def foo():
	print("first")
```

_Cell 2:_
```python
	print("second")
```

Currently, Ruff would concatenate it into a single source and pass it to the parser. This means that the parser would see it as:

```python
def foo():
	print("first")
	print("second")
```

Which is a valid code. But, actually the indentation before the second print statement is invalid as it is in another cell.

A possible solution, as suggested by @MichaReiser, would be to run the parser per cell, merge the statements, and update the node ranges for all the subsequent cells with the correct offset.

---

_Label `wish` added by @dhruvmanila on 2024-03-07 03:52_

---

_Label `parser` added by @dhruvmanila on 2024-03-07 03:52_

---

_Label `notebook` added by @dhruvmanila on 2024-03-07 03:52_

---

_Comment by @dhruvmanila on 2024-03-07 05:32_

There might be more to it but it doesn't seem like the server raises any syntax errors. It could be that they strip any whitespace ü§∑‚Äç‚ôÇÔ∏è 
 
<img width="389" alt="Screenshot 2024-03-07 at 10 59 43" src="https://github.com/astral-sh/ruff/assets/67177269/c8ff02b8-243c-4497-a507-19071b2afc01">


---

_Referenced in [astral-sh/ruff#10291](../../astral-sh/ruff/pulls/10291.md) on 2024-03-19 08:23_

---
