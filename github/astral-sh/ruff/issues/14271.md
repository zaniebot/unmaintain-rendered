---
number: 14271
title: "docstring code formatter:Allow customizing to-be-formatted directives"
type: issue
state: open
author: flying-sheep
labels:
  - formatter
assignees: []
created_at: 2024-11-11T12:18:25Z
updated_at: 2024-11-11T12:55:30Z
url: https://github.com/astral-sh/ruff/issues/14271
synced_at: 2026-01-07T12:31:13-06:00
---

# docstring code formatter:Allow customizing to-be-formatted directives

---

_Issue opened by @flying-sheep on 2024-11-11 12:18_

Currently the supported directives are hardcoded here: https://github.com/astral-sh/ruff/blob/9180635171dcb61bf2b96ab7a489fe0f549d78d7/crates/ruff_python_formatter/src/string/docstring.rs#L1082-L1087

Would be great to be able to customize the list of directives, so e.g. [`.. plot::`](https://matplotlib.org/stable/api/sphinxext_plot_directive_api.html) can be supported.

Iâ€™d suggest to only allow adding directives that have code in the body, i.e. doing `docstring-code-format-extra-directives = ["plot"]` would format the last line here:

```restructuredtext
.. plot::
   :foo: bar

   import baz
```

but not something like this:

```restructuredtext
.. plot::
   import baz
```

in reStructuredText semantics, the first `import baz` is in the body of the block (the block also has options that we can ignore), while the second one is a positional argument to the block.

---

_Comment by @MichaReiser on 2024-11-11 12:55_

Reading through the documentation, I see cases where what follows isn't guaranteed to be code. 

```
.. plot:: path/to/plot.py

   The plot caption.
```

In addition, it limits how we can evolve the docstring formatting in the future because we know less about the surrounding context. Without a custom regex, we know exactly when and where the docstrings get formatted and if making a certain change doesn't cause any issues in those contexts. 

That's why I'm very hesitant to support dynamic code blocks. 


---

_Label `formatter` added by @MichaReiser on 2024-11-11 12:55_

---
