---
number: 21431
title: PTH fixes should be unsafe when they change return types
type: issue
state: closed
author: dscorbett
labels:
  - fixes
  - preview
assignees: []
created_at: 2025-11-13T16:05:44Z
updated_at: 2025-12-01T20:26:56Z
url: https://github.com/astral-sh/ruff/issues/21431
synced_at: 2026-01-07T12:31:13-06:00
---

# PTH fixes should be unsafe when they change return types

---

_Issue opened by @dscorbett on 2025-11-13 16:05_

### Summary

The fixes for [`os-rename` (PTH104)](https://docs.astral.sh/ruff/rules/os-rename/), [`os-replace` (PTH105)](https://docs.astral.sh/ruff/rules/os-replace/), [`os-getcwd` (PTH109)](https://docs.astral.sh/ruff/rules/os-getcwd/), and [`os-readlink` (PTH115)](https://docs.astral.sh/ruff/rules/os-readlink/) should generally be marked unsafe because the replacements have different return types. [Example](https://play.ruff.rs/7e724491-845c-4667-bda4-cb66fd4e6783):
```console
$ cat >pth1.py <<'# EOF'
import os
import sys

# code   name               original return type -> replacement

# PTH104 os-rename          None -> Path
print(os.rename("pth1.py", "pth1.py.bak"))

# PTH105 os-replace         None -> Path
print(os.replace("pth1.py.bak", "pth1.py"))

# PTH109 os-getcwd          str -> Path
#        os-getcwdb         bytes -> Path
try: print(os.getcwd().upper())
except AttributeError as e: print(e)
try: print(os.getcwdb().upper())
except AttributeError as e: print(e)

# PTH115 os-readlink        str -> Path
try: print(os.readlink(sys.executable).upper())
except AttributeError as e: print(e)
# EOF

$ ruff --isolated check pth1.py --select PTH --preview --unsafe-fixes --fix
Found 5 errors (5 fixed, 0 remaining).

$ python pth1.py
pth1.py.bak
pth1.py
'PosixPath' object has no attribute 'upper'
'PosixPath' object has no attribute 'upper'
'PosixPath' object has no attribute 'upper'
```

The fixes are still safe in two cases. When the function call is the top-level expression in its statement, the return value is not used, so the return type does not matter, so the fix is safe. This case is common enough and easy enough to detect that I think it is worth supporting. When the original function returns a `str` or `bytes` and the replacement returns a `Path` and the function call is an argument to a function that interprets that argument as a [path-like object](https://docs.python.org/3/glossary.html#term-path-like-object) and whose return value doesn’t expose the difference, then the difference in return type doesn’t matter, so the fix is safe. This case is harder to support because it requires reviewing each such function carefully, but if the ecosystem report reveals a common function that could be safe, it might be worth supporting it.

This all applies to [`os-path-abspath` (PTH100)](https://docs.astral.sh/ruff/rules/os-path-abspath/), [`os-path-expanduser` (PTH111)](https://docs.astral.sh/ruff/rules/os-path-expanduser/), and [`os-path-dirname` (PTH120)](https://docs.astral.sh/ruff/rules/os-path-dirname/) too. Their fixes are already marked unsafe, but their documentation should explain this additional reason for unsafety.

### Version

ruff 0.14.4 (c7ff9826d 2025-11-06)

---

_Label `fixes` added by @ntBre on 2025-11-13 20:40_

---

_Label `preview` added by @ntBre on 2025-11-13 20:40_

---

_Referenced in [astral-sh/ruff#21440](../../astral-sh/ruff/pulls/21440.md) on 2025-11-13 22:20_

---

_Closed by @ntBre on 2025-12-01 20:26_

---
