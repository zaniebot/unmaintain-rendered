---
number: 2192
title: operate on files with certain hashbang
type: issue
state: closed
author: spaceone
labels:
  - cli
assignees: []
created_at: 2023-01-26T12:21:15Z
updated_at: 2023-04-12T14:40:24Z
url: https://github.com/astral-sh/ruff/issues/2192
synced_at: 2026-01-07T12:31:12-06:00
---

# operate on files with certain hashbang

---

_Issue opened by @spaceone on 2023-01-26 12:21_

ruff seems only to search for files with `.py` (maybe also `.pyi) file extensions?!

it would be good to detect some certain hashbangs like:
`!#/usr/bin/python`
`!#/usr/bin/python3`
`!#/usr/bin/python -b`
`!#/usr/bin/env python3`

and it would be nice to be able to put further definitions in the config files, we e.g. have definitions like:
`#!/usr/share/test/runner python3`
`#!/usr/share/test/runner py.test-3`

---

_Label `cli` added by @charliermarsh on 2023-01-26 14:49_

---

_Comment by @sciyoshi on 2023-01-26 14:49_

Rather than looking for a specific shebang, maybe a configuration could be added to include certain files based on paths?

---

_Comment by @charliermarsh on 2023-01-26 14:52_

Yeah, I'm extremely hesitant to check every file for a shebang.

If you pass a file to Ruff directly, it will check it, even if it's not a `.py` or `.pyi` file (like `ruff /path/to/file`). That's what most users have done in the past. Though I'd be open to some kind of opt-in list.


---

_Comment by @spaceone on 2023-01-26 14:55_

I wouldn't use a configurable list of files as files are too often just changing by too many people. The files are tracked in git and all of them might be relevant.

What's wrong with checking hashbangs? I am using it currently and it is not really making a performance issue.

---

_Comment by @charliermarsh on 2023-01-26 14:58_

I assume it will come at a performance cost. I'd need to benchmark it.

Is there a common extension on those files? (Or even: do they all have _no_ extension?)

---

_Comment by @spaceone on 2023-01-26 14:58_

I guess they all have no extension. simple scripts.

---

_Comment by @charliermarsh on 2023-01-26 15:00_

We could consider checking non-extension files for hashbangs.

---

_Comment by @spaceone on 2023-01-26 15:03_

That would be great. we have 462 python files without file extensions and 4 python files with (accidental) file extensions (`.in`, `.conf`, `.3`, `.0-dev`)

---

_Comment by @sciyoshi on 2023-01-26 15:05_

Another simple workaround would be to find the files separately and pass those explicitly to ruff, e.g. (with ripgrep):

```
rg -l -0 '\A#!/usr/bin/env python' | xargs -0 ruff
```

---

_Comment by @spaceone on 2023-01-26 15:09_

yes, this is kind of my current workaround.

---

_Comment by @spaceone on 2023-01-27 11:38_

This workaround would also be needed in a pre-commit hook, where I did not yet find out how to achieve it.

---

_Comment by @spaceone on 2023-02-08 21:28_

ok, `pre-commit` already supports it: it first searches for files with `.py`[`i`] extension and then for executable files with common python hashbangs.

---

_Comment by @charliermarsh on 2023-03-08 22:55_

This could also be solved by https://github.com/charliermarsh/ruff/issues/3410, sort of, though you'd have to enumerate them explicitly.

---

_Comment by @neingeist on 2023-03-08 22:57_

> This could also be solved by #3410, sort of, though you'd have to enumerate them explicitly.

For me, it would suffice to include them explicitly and I agree that performance could suffer if ruff would read every file to search for the bang.

(Using the term "include" here, because the include option is how you can do it with Black.)

---

_Referenced in [astral-sh/ruff#3410](../../astral-sh/ruff/issues/3410.md) on 2023-03-25 13:59_

---

_Referenced in [astral-sh/ruff#3914](../../astral-sh/ruff/pulls/3914.md) on 2023-04-08 04:17_

---

_Closed by @charliermarsh on 2023-04-12 03:39_

---

_Comment by @spaceone on 2023-04-12 07:15_

hm,  #3914 closed it but this allows only files with a specific extension. our files/scripts don't have any file extension.

---

_Comment by @charliermarsh on 2023-04-12 14:40_

Ah yeah, the reasoning was that this now provides a manual workaround, analogous to Black's own configuration (whereby you can specify the script names in the `extend-include` vector). I'm open to re-opening this, although I don't yet have a solution that I'm happy with for supporting arbitrary scripts via shebangs, so I can't commit to improving it further.


---

_Referenced in [astral-sh/ruff#13122](../../astral-sh/ruff/issues/13122.md) on 2024-08-28 05:59_

---
