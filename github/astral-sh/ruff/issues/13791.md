---
number: 13791
title: "PERF401: split or improve message?"
type: issue
state: closed
author: xmo-odoo
labels:
  - rule
  - help wanted
assignees: []
created_at: 2024-10-17T09:58:23Z
updated_at: 2025-02-10T14:20:57Z
url: https://github.com/astral-sh/ruff/issues/13791
synced_at: 2026-01-07T12:31:13-06:00
---

# PERF401: split or improve message?

---

_Issue opened by @xmo-odoo on 2024-10-17 09:58_

I think PERF401 is a good rule, however while its message works fine for the "transformed copy" case e.g.
```python
original = list(range(10000))
filtered = []
for i in original:
    if i % 2:
        filtered.append(i)
```
the feedback message of

> Use a list comprehension to create a transformed list

is very confusing for the second case of a transforming expansion e.g.

```python
original = list(range(10000))
filtered = get_a_base_list()
for i in original:
    if i % 2:
        filtered.append(i)
```
in this case the improvement would be
```python
filtered.extend(i for i in original if i % 2)
```
But this involves neither a *creation* nor a *list comprehension*. Before I checked the lint's extended documentation I figured it was a false positive due to how "off" the message is.

Since the codes are already different from perflint source, I think the ideal would be to split this lint in two, and to extend the source span of PERF401 (the bit it says to replace) to encompass the collection instantiation and loop, not just the `append` call itself. For the other one, it might make sense to include the loop too.

---

_Label `documentation` added by @MichaReiser on 2024-10-18 06:44_

---

_Comment by @MichaReiser on 2024-10-18 06:45_

Makes sense. We should look into how complicated it would be to detect if the starting list is empty or not and adjust the message based on that. If that's not possible, we should try to refine the message to mention `extend` or at least update the documentation

---

_Label `documentation` removed by @MichaReiser on 2024-10-18 06:45_

---

_Label `rule` added by @MichaReiser on 2024-10-18 06:45_

---

_Label `help wanted` added by @MichaReiser on 2024-10-18 06:45_

---

_Comment by @junhsonjb on 2025-02-10 13:23_

Looks like this issue may have been [resolved by this PR](https://github.com/astral-sh/ruff/pull/13919). If so, should we mark this issue as closed/completed?

---

_Comment by @MichaReiser on 2025-02-10 14:20_

Yes, I think you're right. Thank's for the ping :)

---

_Closed by @MichaReiser on 2025-02-10 14:20_

---
