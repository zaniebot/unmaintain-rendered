---
number: 2613
title: "`Removes quotes from annotations` removes quotes from literal values"
type: issue
state: closed
author: Czaki
labels:
  - bug
assignees: []
created_at: 2023-02-06T22:51:13Z
updated_at: 2023-02-07T19:28:10Z
url: https://github.com/astral-sh/ruff/issues/2613
synced_at: 2026-01-07T13:12:14-06:00
---

# `Removes quotes from annotations` removes quotes from literal values

---

_Issue opened by @Czaki on 2023-02-06 22:51_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

It looks like  #2431 also removes quotes from literal values in type annotation 

In general, when bump ruff from 0.0.237 to 0.0.242 the following change is generated by ruff: 

```
Literal["x86_64", "arm64"]
```
to 
```
Literal[x86_64, arm64]
```
cibuilwheel PR with visible problem 

https://github.com/pypa/cibuildwheel/pull/1412

The change, when force revert changes

[pypa/cibuildwheel@`923fd3c` (#1412)](https://github.com/pypa/cibuildwheel/pull/1412/commits/923fd3c493f26461cd22a85ce736bb7cd54bc273)

And log from ruff: 

https://results.pre-commit.ci/run/github/85508223/1675723555.oUgkXTipRmOlnOPISWV1OA

ruff configuration https://github.com/pypa/cibuildwheel/blob/e42277a69204ccfae9a1f4ae3b574eaa54109925/pyproject.toml#L120

---

_Comment by @charliermarsh on 2023-02-06 23:02_

Thank you, I'll fix this tonight and cut a new release.

---

_Comment by @henryiii on 2023-02-06 23:04_

Breaking pypa/build too: https://github.com/pypa/build/pull/576/files

```diff
- PathType = Union[str, 'os.PathLike[str]']
+ PathType = Union[str, os.PathLike[str]]

- _TProjectBuilder = TypeVar('_TProjectBuilder', bound='ProjectBuilder')
+ _TProjectBuilder = TypeVar('_TProjectBuilder', bound=ProjectBuilder)
```

These are both broken. `os.PathLike[str]` is not valid on Python 3.7 (and it's not an annotation). TypeVar can't have the quotes removed, the thing it's bound to doesn't exist yet. And it's also not an annotation.

---

_Comment by @henryiii on 2023-02-06 23:07_

Also, I'd really love for a way to see see fixed operaitons too. I have no idea what rules were applied when things are "fixed". Maybe there's a flag I missed?

---

_Comment by @charliermarsh on 2023-02-06 23:07_

In the `Literal` case, the issue is that you're accessing `Literal` from a module that isn't `typing` or `typing_extensions`.

For example, this doesn't raise an error:

```py
from __future__ import annotations

from typing import Literal

x: Literal["x86_64", "arm64"]
```

But this does:

```py
from __future__ import annotations

from .typing import Literal

x: Literal["x86_64", "arm64"]
```

We use [`typing-modules`](https://github.com/charliermarsh/ruff#typing-modules) to fix this, but it doesn't support relative imports right now.


---

_Comment by @charliermarsh on 2023-02-06 23:08_

> Also, I'd really love for a way to see see fixed operaitons too. I have no idea what rules were applied when things are "fixed". Maybe there's a flag I missed?

There's a `--diff` flag -- is that along the lines of what you're describing?


---

_Assigned to @charliermarsh by @charliermarsh on 2023-02-06 23:09_

---

_Label `bug` added by @charliermarsh on 2023-02-06 23:09_

---

_Referenced in [astral-sh/ruff#2614](../../astral-sh/ruff/pulls/2614.md) on 2023-02-06 23:14_

---

_Comment by @charliermarsh on 2023-02-06 23:15_

The issues that @henryiii raised are fixed in #2614.

---

_Comment by @charliermarsh on 2023-02-06 23:16_

I can add support for relative import paths with `typing-modules` to fix the issue @Czaki raised. (I'm actually surprised that hasn't bitten you already prior to this lint rule!)

---

_Comment by @henryiii on 2023-02-06 23:16_

I can see a diff of what changed via git, I just can't see the list of rules that were applied to make those changes. For example, if I make a fixable change to a Ruby file and run rubocop:

```
Inspecting 16 files
....C...........

Offenses:

_plugins/checkproj.rb:36:7: C: [Corrected] Style/RedundantReturn: Redundant return detected.
      return @people ||= people_gen
      ^^^^^^

16 files inspected, 1 offense detected, 1 offense corrected
```

I can see exactly what rules were applied in the fixes.

Something like `Fixed:\n` followed by the rules that were fixed, for example.

---

_Comment by @henryiii on 2023-02-06 23:18_

The typing modules issue has bit before, it's https://github.com/charliermarsh/ruff/issues/2005.

---

_Comment by @charliermarsh on 2023-02-06 23:45_

Gonna try and fix that tonight.

---

_Referenced in [astral-sh/ruff#2615](../../astral-sh/ruff/pulls/2615.md) on 2023-02-07 00:39_

---

_Closed by @charliermarsh on 2023-02-07 00:51_

---

_Referenced in [scikit-hep/awkward#2215](../../scikit-hep/awkward/pulls/2215.md) on 2023-02-07 15:28_

---

_Comment by @Czaki on 2023-02-07 19:28_

Thanks for the really fast action :) :heart: 

---

_Referenced in [astral-sh/ruff#2677](../../astral-sh/ruff/issues/2677.md) on 2023-02-09 03:45_

---

_Referenced in [astral-sh/ruff#3508](../../astral-sh/ruff/issues/3508.md) on 2023-03-14 20:46_

---
