---
number: 675
title: Import sorting deletes comments
type: issue
state: closed
author: andersk
labels:
  - isort
assignees: []
created_at: 2022-11-11T00:51:33Z
updated_at: 2022-11-16T03:02:53Z
url: https://github.com/astral-sh/ruff/issues/675
synced_at: 2026-01-07T12:31:12-06:00
---

# Import sorting deletes comments

---

_Issue opened by @andersk on 2022-11-11 00:51_

(This is a known limitation mentioned in https://github.com/charliermarsh/ruff/issues/465#issuecomment-1311075618, but might as well be tracked as an issue.)

`ruff --select=I --fix` incorrectly transforms

```python
# preserved
import os  # deleted

# deleted
import third_party  # deleted
```

into

```python
# preserved
import os

import third_party
```


---

_Referenced in [astral-sh/ruff#465](../../astral-sh/ruff/issues/465.md) on 2022-11-11 00:56_

---

_Label `isort` added by @charliermarsh on 2022-11-11 03:32_

---

_Assigned to @charliermarsh by @charliermarsh on 2022-11-12 03:42_

---

_Comment by @charliermarsh on 2022-11-12 04:11_

I don't understand isort's comment behavior yet, trying to make sense of it.

Before:
```py
# Comment 1
# Comment 2
import D

# Comment 3a
import C
# Comment 3b
import C

import B  # Comment 4

# Comment 5

# Comment 6
from A import (
	a,  # Comment 7
	b,
	c,  # Comment 8
)
from A import (
	a,  # Comment 9
	b,  # Comment 10
	c,  # Comment 11
)
```

After:
```py
# Comment 1
# Comment 2
import B  # Comment 4

# Comment 3b
# Comment 3a
import C
import D

# Comment 6
from A import a  # Comment 9
from A import b  # Comment 10
from A import c  # Comment 11

# Comment 5
```

---

_Comment by @charliermarsh on 2022-11-12 04:15_

I'll just try to come up with something reasonable that does the right thing in the common cases (comment at end-of-line, etc.).

---

_Comment by @charliermarsh on 2022-11-12 15:02_

Gonna try to fix this today. I've added comment extraction, now I just need to figure out the preservation strategy.

---

_Comment by @tiangolo on 2022-11-13 18:20_

Amazing! This is one of the two things not allowing me to switch to Ruff's sorting, I need to preserve some comments for some `# type: ignore` and things like that.

---

_Referenced in [astral-sh/ruff#736](../../astral-sh/ruff/issues/736.md) on 2022-11-14 14:53_

---

_Referenced in [astral-sh/ruff#749](../../astral-sh/ruff/pulls/749.md) on 2022-11-15 05:09_

---

_Comment by @charliermarsh on 2022-11-16 02:28_

This took longer than expected. I'm not super happy with the amount of code required to handle comments, but the output is looking pretty good.

Here's the diff on Zulip:

![Screen Shot 2022-11-15 at 9 27 05 PM](https://user-images.githubusercontent.com/1309177/202068800-3850a40d-45c9-4bfd-a936-cd5b296a77e6.png)

Here's the diff on FastAPI:

![Screen Shot 2022-11-15 at 9 27 48 PM](https://user-images.githubusercontent.com/1309177/202068828-ccd37a18-0775-4378-80d8-cee4210e4097.png)


---

_Closed by @charliermarsh on 2022-11-16 03:02_

---
