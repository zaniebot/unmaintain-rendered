---
number: 10323
title: "`unnecessary-literal-within-tuple-call` (C409) rule transforms single element list literals incorrectly"
type: issue
state: closed
author: bardiharborow
labels:
  - bug
  - good first issue
  - fixes
  - linter
assignees: []
created_at: 2024-03-11T03:31:46Z
updated_at: 2024-03-26T06:45:12Z
url: https://github.com/astral-sh/ruff/issues/10323
synced_at: 2026-01-07T12:31:13-06:00
---

# `unnecessary-literal-within-tuple-call` (C409) rule transforms single element list literals incorrectly

---

_Issue opened by @bardiharborow on 2024-03-11 03:31_

The `unnecessary-literal-within-tuple-call` ([C409](https://docs.astral.sh/ruff/rules/unnecessary-literal-within-tuple-call/)) rule detects the violation here:
```py
tuple([1])
```

`ruff check --fix --unsafe-fixes` fails to transform the code correctly, resulting in this, which is not a tuple:
```py
(1)
```

Instead it should transform the code to:
```py
(1,)
```

Environment:

```shell
% ruff --version
ruff 0.3.2

% cat pyproject.toml
[tool.ruff]
lint.select = [
    "C4"
]
```

---

_Renamed from "`unnecessary-literal-within-tuple-call` (C409) rule fixes single element tuples incorrectly" to "`unnecessary-literal-within-tuple-call` (C409) rule fixes zero and single element lists incorrectly" by @bardiharborow on 2024-03-11 04:43_

---

_Renamed from "`unnecessary-literal-within-tuple-call` (C409) rule fixes zero and single element lists incorrectly" to "`unnecessary-literal-within-tuple-call` (C409) rule transforms single element list literals incorrectly" by @bardiharborow on 2024-03-11 04:54_

---

_Label `bug` added by @zanieb on 2024-03-11 16:43_

---

_Label `good first issue` added by @zanieb on 2024-03-11 16:43_

---

_Label `fixes` added by @zanieb on 2024-03-11 16:43_

---

_Label `linter` added by @zanieb on 2024-03-11 16:43_

---

_Comment by @zanieb on 2024-03-11 16:44_

Thanks for the report!

---

_Comment by @WindowGenerator on 2024-03-11 20:19_

@zanieb Hi!
Can I take it too?

---

_Comment by @charliermarsh on 2024-03-11 21:13_

Go for it @WindowGenerator.

---

_Assigned to @WindowGenerator by @zanieb on 2024-03-11 23:21_

---

_Comment by @bardiharborow on 2024-03-12 02:01_

I don't know much about Ruff internals but it feels like it might be safer to take the approach of transforming and then rendering the AST, rather than replacing specific string indexes, since the latter is vulnerable to producing invalid or incorrect code in this fashion.

---

_Comment by @dhruvmanila on 2024-03-12 09:00_

Yeah, we have a [`Generator`](https://github.com/astral-sh/ruff/blob/2cad4bbb354f5d43131b2d9cd583caad8e65e840/crates/ruff_python_codegen/src/generator.rs#L64) struct which does exactly that. Moving the fix to use that would solve the issue as it takes one element tuple into consideration.

---

_Comment by @charliermarsh on 2024-03-12 13:49_

We should just add this case to the fix. Text-based fixes are preferable because they preserve all trivia. (This fix used to use LibCST but we intentionally changed it because itâ€™s slow and we want to remove our LibCST dependency altogether eventually.)

I think there was just a misunderstanding on what the fix is supposed to do based on the comment above it in the code, which led to this oversight.

---

_Referenced in [astral-sh/ruff#10491](../../astral-sh/ruff/pulls/10491.md) on 2024-03-20 16:29_

---

_Comment by @bardiharborow on 2024-03-26 06:45_

Fixed by #10491.

---

_Closed by @bardiharborow on 2024-03-26 06:45_

---
