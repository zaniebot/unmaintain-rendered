---
number: 8332
title: "Formatter: different than black when wrapping parentheses for `with`"
type: issue
state: closed
author: njzjz
labels:
  - formatter
assignees: []
created_at: 2023-10-30T00:59:13Z
updated_at: 2023-10-30T01:13:29Z
url: https://github.com/astral-sh/ruff/issues/8332
synced_at: 2026-01-07T12:31:12-06:00
---

# Formatter: different than black when wrapping parentheses for `with`

---

_Issue opened by @njzjz on 2023-10-30 00:59_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->
The ruff version is v0.1.3.

Original code:
```py
class SomeClass:
    def some_method():
        with WriteBuffer(tempfile.NamedTemporaryFile("wb", delete=False)) if self.getoriginfile or not self.runHMM else ExitStack() as fo, WriteBuffer(tempfile.NamedTemporaryFile("wb", delete=False)) if self.runHMM else ExitStack() as fh, open(self.moleculetempfilename, "rb") as ft, WriteBuffer(tempfile.NamedTemporaryFile("wb", delete=False)) as ft2:
            pass
```

Black:
```py
class SomeClass:
    def some_method():
        with WriteBuffer(
            tempfile.NamedTemporaryFile("wb", delete=False)
        ) if self.getoriginfile or not self.runHMM else ExitStack() as fo, WriteBuffer(
            tempfile.NamedTemporaryFile("wb", delete=False)
        ) if self.runHMM else ExitStack() as fh, open(
            self.moleculetempfilename, "rb"
        ) as ft, WriteBuffer(
            tempfile.NamedTemporaryFile("wb", delete=False)
        ) as ft2:
            pass
```

Ruff:
```py
class SomeClass:
    def some_method():
        with WriteBuffer(
            tempfile.NamedTemporaryFile("wb", delete=False)
        ) if self.getoriginfile or not self.runHMM else ExitStack() as fo, WriteBuffer(
            tempfile.NamedTemporaryFile("wb", delete=False)
        ) if self.runHMM else ExitStack() as fh, open(
            self.moleculetempfilename, "rb"
        ) as ft, WriteBuffer(tempfile.NamedTemporaryFile("wb", delete=False)) as ft2:
            pass
```

See https://play.ruff.rs/b9a611b0-88cd-4ea7-a263-87e9f5375fa4

---

_Comment by @charliermarsh on 2023-10-30 01:07_

I realized we have an existing issue for this -- we marked it as an accepted deviation, but forgot to add it to the documentation: https://github.com/astral-sh/ruff/issues/7441

---

_Closed by @charliermarsh on 2023-10-30 01:07_

---

_Label `formatter` added by @charliermarsh on 2023-10-30 01:07_

---

_Comment by @MichaReiser on 2023-10-30 01:07_

Hy @njzjz 

Thanks for reporting the deviation. This is related to https://github.com/astral-sh/ruff/issues/7441 where we decided to accept this deviation until implementing preview style But it seems this deviation isn't documented. Which we should. 

---

_Comment by @njzjz on 2023-10-30 01:13_

Thanks!

---
