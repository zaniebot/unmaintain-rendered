---
number: 13021
title: EXE003 and uv run?
type: issue
state: closed
author: fschulze
labels:
  - rule
  - needs-decision
  - "priority:medium"
assignees: []
created_at: 2024-08-21T04:16:13Z
updated_at: 2025-03-19T16:53:11Z
url: https://github.com/astral-sh/ruff/issues/13021
synced_at: 2026-01-07T12:31:13-06:00
---

# EXE003 and uv run?

---

_Issue opened by @fschulze on 2024-08-21 04:16_

Should EXE003 be extended for ``uv run``?

I used the following she-bang:
```
#!/usr/bin/env uv run
```

Maybe another she-bang would work better?

---

_Comment by @MichaReiser on 2024-08-21 15:48_

@zanieb @charliermarsh, how official is the use of `uv run` in shebang? 

---

_Comment by @ngnpope on 2024-08-21 17:14_

It'd be really nice to be able to do this for a fully distributable script, but note that it will need the `-S` flag.

Using the example from [here](https://astral.sh/blog/uv-unified-python-packaging#single-file-scripts):

```python
#!/usr/bin/env -S uv run --quiet

# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "requests<3",
#     "rich",
# ]
# ///

import requests
from rich.pretty import pprint

resp = requests.get("https://peps.python.org/api/peps.json")
data = resp.json()
pprint([(k, v["title"]) for k, v in data.items()][:10])
```

This makes it usable as truly standalone executable, e.g. `./list-peps.py` instead of `uv run list-peps.py`:

```console
$ ./list-peps.py 
[
â”‚   ('1', 'PEP Purpose and Guidelines'),
â”‚   ('2', 'Procedure for Adding New Modules'),
â”‚   ('3', 'Guidelines for Handling Bug Reports'),
â”‚   ('4', 'Deprecation of Standard Modules'),
â”‚   ('5', 'Guidelines for Language Evolution'),
â”‚   ('6', 'Bug Fix Releases'),
â”‚   ('7', 'Style Guide for C Code'),
â”‚   ('8', 'Style Guide for Python Code'),
â”‚   ('9', 'Sample Plaintext PEP Template'),
â”‚   ('10', 'Voting Guidelines')
]
```

And adding `--quiet` allows hiding the extra noise at the beginning:

```console
Reading inline script metadata from: ./list-peps.py
```

----

As a curious aside, if I wanted to drop the `.py` extension, `uv` gets confused and gets stuck in an recursive loop.

This is with switching `--quiet` for `--verbose`: 

```console
$ ./list-peps
DEBUG uv 0.3.0
DEBUG No project found; searching for Python interpreter
DEBUG Searching for Python interpreter in managed installations or system path
DEBUG Searching for managed installations at `.local/share/uv/python`
DEBUG Found `cpython-3.12.4-linux-x86_64-gnu` at `/home/nick/.pyenv/shims/python3` (search path)
DEBUG Using Python 3.12.4 interpreter at: /usr/bin/python3
DEBUG Running `./list-peps`
DEBUG uv 0.3.0
DEBUG No project found; searching for Python interpreter
DEBUG Searching for Python interpreter in managed installations or system path
DEBUG Searching for managed installations at `.local/share/uv/python`
DEBUG Found `cpython-3.12.4-linux-x86_64-gnu` at `/usr/bin/python3` (search path)
DEBUG Using Python 3.12.4 interpreter at: /usr/bin/python3
DEBUG Running `./list-peps`
...
```

So it doesn't seem to realise that it's a Python script and so doesn't look for the PEP 723 metadata and then attempts to call itself. I've not got around to reporting this yet.

---

_Referenced in [astral-sh/uv#6313](../../astral-sh/uv/pulls/6313.md) on 2024-08-21 17:24_

---

_Referenced in [astral-sh/uv#6360](../../astral-sh/uv/issues/6360.md) on 2024-08-21 17:37_

---

_Comment by @fschulze on 2024-08-22 07:50_

Hmm, it seems like ``/usr/bin/env`` isn't as portable as I thought:
https://stackoverflow.com/a/16365367/3748142

---

_Label `rule` added by @MichaReiser on 2024-08-22 08:01_

---

_Label `needs-decision` added by @MichaReiser on 2024-08-22 08:01_

---

_Comment by @PaarthShah on 2024-08-22 08:11_

@fschulze That answer is very, very outdated (from 2013, edited 2018). It's far more portable nowadays.

---

_Comment by @martimlobao on 2025-01-29 09:32_

This is a @charliermarsh -[sanctioned](https://x.com/charliermarsh/status/1884448591617384688) way of running `uv` scripts, clearly this rule needs to be updated ðŸ˜

---

_Comment by @charliermarsh on 2025-01-29 13:49_

That's true!

---

_Comment by @Avasam on 2025-03-08 03:27_

Just hit this in typeshed, trying to promote usage of `uv run` to help new contributors who'd forget to enable (or don't want to handle) their virtual environment! https://github.com/python/typeshed/pull/13599

Also, would the `--active` flag be allowed here? Would any flag even be restricted (ie: just check for `uv run`)?

---

_Referenced in [python/typeshed#13599](../../python/typeshed/pulls/13599.md) on 2025-03-08 03:28_

---

_Comment by @andrei-korshikov on 2025-03-19 03:04_

> Would any flag even be restricted (ie: just check for `uv run`)?

I don't think that `uv run` options should be restrictedâ€”it would reduce flexibility. Sometimes I use `--offline`, for example.

Also don't forget, that `uv run` might not have space on the left:

```sh
#! /usr/bin/env --split-string=uv run --script
```

---

_Label `priority:medium` added by @MichaReiser on 2025-03-19 07:03_

---

_Comment by @hyperknot on 2025-03-19 14:06_

I also come here to say that please embrace the uv shebang. This is currently the best way to work with Python scripts, yet it's totally unofficial / you have to ask on Discord level hidden.

I recommend the following:
1. Please agree on an official uv shebang line. Just in this thread there are quite a few alternatives. I'm personally using 
```
#!/usr/bin/env -S uv run
```

2. Advertise it everywhere, in the FAQ, in the uv init scripts, etc.

3. Modify EXE003 rule to allow this.

---

_Referenced in [astral-sh/ruff#16849](../../astral-sh/ruff/pulls/16849.md) on 2025-03-19 15:27_

---

_Comment by @dylwil3 on 2025-03-19 15:34_

I think for the purposes of this issue the linked PR should suffice - the rule was not doing anything super sophisticated to check for flags and such, it's just skipping if it finds, e.g. "python".

As for advertising `uv run` and the shebang trick, and settling on the "official recommendation" - I'm all for it! But that probably makes more sense in the `uv` docs rather than the `ruff` docs ðŸ˜„ 

---

_Closed by @dylwil3 on 2025-03-19 15:35_

---

_Comment by @hyperknot on 2025-03-19 16:53_

Thanks for the PR!

---

_Referenced in [astral-sh/ruff#18902](../../astral-sh/ruff/issues/18902.md) on 2025-06-23 19:06_

---
