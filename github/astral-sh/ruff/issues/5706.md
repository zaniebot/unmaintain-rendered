---
number: 5706
title: UP007 false negative with quoted type
type: issue
state: closed
author: dorschw
labels:
  - bug
assignees: []
created_at: 2023-07-12T10:15:00Z
updated_at: 2023-07-13T11:34:06Z
url: https://github.com/astral-sh/ruff/issues/5706
synced_at: 2026-01-07T12:31:12-06:00
---

# UP007 false negative with quoted type

---

_Issue opened by @dorschw on 2023-07-12 10:15_

UP007 won't recognize cases like 
```python
from typing import Optional


def foo(_: Optional["myclass"]):
    pass
```

While it recognizes
```python
from typing import Optional


def foo(_: Optional[myclass]):
    pass
```

reproduces with 0.0.277 and on the playground


---

_Comment by @charliermarsh on 2023-07-12 12:47_

I think this follows pyupgrade’s behavior, but I need to look into if that’s true, and why.

---

_Label `bug` added by @charliermarsh on 2023-07-12 12:48_

---

_Label `needs-decision` added by @charliermarsh on 2023-07-12 12:48_

---

_Comment by @charliermarsh on 2023-07-12 13:30_

I think this is the correct behavior (in some cases). E.g., this fails for me on 3.11:

```python
from typing import Optional


def foo(_:  "myclass" | None):
    pass
```

With:

```console
Traceback (most recent call last):
  File "/Users/crmarsh/workspace/ruff/foo.py", line 4, in <module>
    def foo(_:  "myclass" | None):
                ~~~~~~~~~~^~~~~~
TypeError: unsupported operand type(s) for |: 'str' and 'NoneType'
```

However, it's _sometimes_ okay, e.g. this is fine:

```python
from typing import Optional

class MyClass:
    pass


def foo():
    x: "MyClass" | None = MyClass()

foo()
```

But this is not:

```python
from typing import Optional

class MyClass:
    pass


def foo():
    x: "MyClass" | None = MyClass()

    def bar(x: "MyClass" | None):
        pass

foo()
```

It has to do with when Python evaluates annotations at runtime (e.g., any parameters to functions need to be evaluated at runtime because they get added to `__annotations__`). We can support this in more cases but it's not safe to do everywhere.

---

_Assigned to @charliermarsh by @charliermarsh on 2023-07-12 13:30_

---

_Label `needs-decision` removed by @charliermarsh on 2023-07-12 13:31_

---

_Referenced in [astral-sh/ruff#5725](../../astral-sh/ruff/pulls/5725.md) on 2023-07-13 04:11_

---

_Closed by @charliermarsh on 2023-07-13 11:34_

---
