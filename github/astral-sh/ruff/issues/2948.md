---
number: 2948
title: RET503 autofix errors when function ends with nested block
type: issue
state: closed
author: gdub
labels:
  - bug
  - fixes
assignees: []
created_at: 2023-02-16T05:10:31Z
updated_at: 2023-02-17T05:28:31Z
url: https://github.com/astral-sh/ruff/issues/2948
synced_at: 2026-01-07T12:31:12-06:00
---

# RET503 autofix errors when function ends with nested block

---

_Issue opened by @gdub on 2023-02-16 05:10_

## Example 1

Autofix incorrectly adds return statement inside the last indented block rather than outside. (Not shown in this example, but when there are multiple nested blocks at end of function, a return statement gets added to the innermost block.)

### Input
```python
def test(values):
    if not values:
        return False

    for value in values:
        print(value)
```
### Result
```
$ ruff check --isolated --select RET ret_test.py --fix
Found 1 error (1 fixed, 0 remaining).
```
```python
def test(values):
    if not values:
        return False

    for value in values:
        print(value)
        return None
```

## Example 2

Autofix adds two return statements when indented code block is at last line of file, has an inline comment, and has no trailing newline.

### Input
```python
def test(values):
    if not values:
        return False

    for value in values:
        print(value) # Comment here, no newline at end.
```
### Result
```
$ ruff check --isolated --select RET ret_test.py --fix
Found 2 errors (2 fixed, 0 remaining).
```
```python
def test(values):
    if not values:
        return False

    for value in values:
        print(value) # Comment here, no newline at end.        return None
        return None
```

## Example 3

Autofix errors when indented code block at last line of file and has no trailing newline.

### Input
```python
def test(values):
    if not values:
        return False

    for value in values:
        print(value)
```
### Result
When run without `--fix`:
```
$ ruff check --isolated --select RET ret_test.py
ret_test.py:6:9: RET503 [*] Missing explicit `return` at the end of function able to return non-`None` value
Found 1 error.
[*] 1 potentially fixable with the --fix option.
```
When run with `--fix`:
```
$ ruff check --isolated --select RET ret_test.py --fix

error: Autofix introduced a syntax error. Reverting all changes.

This indicates a bug in `ruff`. If you could open an issue at:

    https://github.com/charliermarsh/ruff/issues/new?title=%5BAutofix%20error%5D

...quoting the contents of `ret_test.py`, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

ret_test.py:6:9: RET503 Missing explicit `return` at the end of function able to return non-`None` value
Found 1 error.
```


## Version
```
$ ruff --version
ruff 0.0.247
```

---

_Label `bug` added by @charliermarsh on 2023-02-16 14:01_

---

_Label `autofix` added by @charliermarsh on 2023-02-16 14:01_

---

_Comment by @charliermarsh on 2023-02-16 14:02_

Thank you for this!

---

_Assigned to @charliermarsh by @charliermarsh on 2023-02-16 17:00_

---

_Referenced in [astral-sh/ruff#2962](../../astral-sh/ruff/pulls/2962.md) on 2023-02-16 17:44_

---

_Closed by @charliermarsh on 2023-02-16 18:42_

---

_Comment by @gdub on 2023-02-17 05:28_

@charliermarsh Thanks for the fix. I tested main branch against the examples from my original post, and looks good except notice that an in-line comment on the last line:
```python
def test(values):
    if not values:
        return False

    for value in values:
        print(value) # Comment here.
```
...gets moved to the line with added `return` statement:
```python
def test(values):
    if not values:
        return False

    for value in values:
        print(value)
    return None # Comment here.
```

---
