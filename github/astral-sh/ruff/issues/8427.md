---
number: 8427
title: "`typing_extensions.TYPE_CHECKING` branch ignored and `TCH001` & `TCH002` are raised"
type: issue
state: closed
author: chaburkland
labels:
  - bug
assignees: []
created_at: 2023-11-02T01:12:23Z
updated_at: 2023-11-09T18:21:04Z
url: https://github.com/astral-sh/ruff/issues/8427
synced_at: 2026-01-07T12:31:12-06:00
---

# `typing_extensions.TYPE_CHECKING` branch ignored and `TCH001` & `TCH002` are raised

---

_Issue opened by @chaburkland on 2023-11-02 01:12_

```python
# example.py prior to ruff fix
from __future__ import annotations

import typing_extensions as tp

if tp.TYPE_CHECKING:
    from application.types import something
    from sqlalchemy.orm.session import Session


def foo(a: something) -> Session:
    pass
```
Command: `ruff example.py --fix` (Unable to reproduce with the `--isolated` flag)

The fix applies a strange behavior. It appears that `ruff` is unable to identify the `typing_extensions.TYPE_CHECKING` branch.
```python
# example.py after ruff fix
from __future__ import annotations

import typing_extensions as tp
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from application.types import something
    from sqlalchemy.orm.session import Session

if tp.TYPE_CHECKING:
    pass


def foo(a: something) -> Session:
    pass
```

Version: `ruff 0.0.292`

`pyproject.toml`
```toml
[tool.ruff]
target-version = "py38"
exclude = [
	".git",
	"__pycache__",
	".mypy_cache",
	".ruff_cache",
]
ignore = [
	"B011",     
	"B015",     
	"B023",     
	"B028",     
	"F811",     
	"F841",     
	"PLR0911",  
	"PLR0912",  
	"PLR0913",  
	"PLR0915",  
	"PLW2901",  
	"PLW3301",  
	"RUF001",   
	"RUF002",   
	"RUF003",   
	"RUF005",   
	"RUF012",   
	"UP025",    
	"PLR1711",  
	"PLR2004",  
	"PLR5501",  
	"PIE794",
	"F821",     
	"PLC0414",  
]
select = [
	"F",   
	"W",   
	"UP",  
	"B",   
	"T10", 
	"EXE", 
	"ISC", 
	"ICN", 
	"PIE", 
	"RSE", 
	"TCH", 
	"PGH", 
	"PL",  
	"NPY", 
	"RUF", 
]
```

---

_Referenced in [astral-sh/ruff#8429](../../astral-sh/ruff/pulls/8429.md) on 2023-11-02 01:32_

---

_Comment by @zanieb on 2023-11-02 01:35_

Thanks for the report!

I've started a fix at https://github.com/astral-sh/ruff/pull/8429 with some notes on what else needs to be done.

---

_Label `bug` added by @zanieb on 2023-11-02 01:35_

---

_Closed by @zanieb on 2023-11-09 18:21_

---
