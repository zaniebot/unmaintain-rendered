---
number: 10235
title: "UP032 Failing to Detect `format` based on Length"
type: issue
state: closed
author: max-muoto
labels:
  - bug
  - rule
assignees: []
created_at: 2024-03-05T05:51:43Z
updated_at: 2024-03-06T08:58:21Z
url: https://github.com/astral-sh/ruff/issues/10235
synced_at: 2026-01-07T12:31:13-06:00
---

# UP032 Failing to Detect `format` based on Length

---

_Issue opened by @max-muoto on 2024-03-05 05:51_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

Running into a weird edge case where UP032 is not picking up the usage of formats.

Take this example, UP032 finds nothing wrong here:

```python
idx = 1
foo = (
    "This is a test, this is a test, this is a test, this is a test {}, {} test".format(
        idx + 1, len([])
    )
)
```

However, if I reduce the length, it gets flagged:

```python
idx = 1
z = "This is a test, this is a test, {}, {} test".format(
   idx + 1, len([])
)
```

Ruff Version: 0.3.0
Command: `ruff check .`.



---

_Comment by @MichaReiser on 2024-03-05 12:08_

Thanks. Agree, that this is unexpected

The rule has a specific check to opt out of providing a fix when the fixed string exceeds the configured line length (because it could introduce new lint errors). 

https://github.com/astral-sh/ruff/blob/184241f99affa895c5e8c1a2e144587cfaa2339a/crates/ruff_linter/src/rules/pyupgrade/rules/f_strings.rs#L450-L459

We do this for a couple of rules but there seems to be no pattern: 
1. Some rules don't provide a fix if the "fixed" string exceeds the configured line width
1. Some rules don't create a diagnostic when the fixed expression exceeds the configured line width. 

I understand 1. but am surprised by 2. Let me see if I can figure out what the reasoning behind it is.

---

_Label `bug` added by @MichaReiser on 2024-03-05 12:08_

---

_Label `rule` added by @MichaReiser on 2024-03-05 12:08_

---

_Referenced in [astral-sh/ruff#10238](../../astral-sh/ruff/pulls/10238.md) on 2024-03-05 14:55_

---

_Comment by @max-muoto on 2024-03-06 01:09_

> Thanks. Agree, that this is unexpected
> 
> The rule has a specific check to opt out of providing a fix when the fixed string exceeds the configured line length (because it could introduce new lint errors).
> 
> https://github.com/astral-sh/ruff/blob/184241f99affa895c5e8c1a2e144587cfaa2339a/crates/ruff_linter/src/rules/pyupgrade/rules/f_strings.rs#L450-L459
> 
> We do this for a couple of rules but there seems to be no pattern:
> 
> 1. Some rules don't provide a fix if the "fixed" string exceeds the configured line width
> 2. Some rules don't create a diagnostic when the fixed expression exceeds the configured line width.
> 
> I understand 1. but am surprised by 2. Let me see if I can figure out what the reasoning behind it is.

Thank! It would be nice if there was some way (for formatter users) to still fix it, but then reformat the code to fix the now violating line, but not sure how this would work considering how they're detached. Perhaps this would work better as a setting (i.e. fix violating rules even if it leads to a resulting line greater than the line limit).

---

_Closed by @MichaReiser on 2024-03-06 08:58_

---
