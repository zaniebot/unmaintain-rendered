---
number: 5765
title: Autofix for RET503 breaks RET505 (in one case)
type: issue
state: closed
author: Jeremiah-England
labels:
  - bug
  - fixes
assignees: []
created_at: 2023-07-14T19:15:28Z
updated_at: 2024-08-14T07:47:47Z
url: https://github.com/astral-sh/ruff/issues/5765
synced_at: 2026-01-07T12:31:12-06:00
---

# Autofix for RET503 breaks RET505 (in one case)

---

_Issue opened by @Jeremiah-England on 2023-07-14 19:15_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

On the latest version of `ruff` (0.0.278) this fails on the following code:

```sh
ruff --select RET503,RET505 test.py --fix --isolated
# test.py:11:9: RET505 Unnecessary `else` after `return` statement
```

```python
def main(value: str) -> int | None:
    if value == "one":
        return 1

    if value.startswith("do_stuff"):
        print("doing stuff")

        if value.endswith("haha"):
            print("haha")
        else:
            print("Instruction unclear.")
    else:
        print("Doing nothing.")
```

That is because the autofix for RET503 inserts `return None` in all three
branches of the if/else tree:

```diff
--- test.py
+++ test.py
@@ -7,7 +7,10 @@
 
         if value.endswith("haha"):
             print("haha")
+            return None
         else:
             print("Instruction unclear.")
+            return None
     else:
         print("Doing nothing.")
+        return None
```

But that is not compliant with RET505.

The fix in this case is to insert `return None` at the end of the function instead of in each branch in the if/else tree.

```python
def main(value: str) -> int | None:
    if value == "one":
        return 1

    if value.startswith("do_stuff"):
        print("doing stuff")

        if value.endswith("haha"):
            print("haha")
        else:
            print("Instruction unclear.")
    else:
        print("Doing nothing.")
    return None
```

Not sure it is worth the effort to update behavior of the `RET503` autofix for this case. But I thought I should report it.

---

_Label `bug` added by @charliermarsh on 2023-07-14 19:17_

---

_Label `autofix` added by @charliermarsh on 2023-07-14 19:17_

---

_Comment by @Zac-HD on 2023-08-20 07:39_

Using Ruff 0.0.285, it also just looks pretty silly to have a chain of `return None` statements added:

```shell
ruff --isolated --fix-only t.py --select=RET503
```
```diff
  def f():
      if ...:
          return True
      if ...:
          pass
+         return None
+     return None
```

It's not a big deal for me since I don't mind skipping this cosmetic check, but with such a small repro it seemed worth reporting.

---

_Comment by @JonathanPlasse on 2024-04-21 14:24_

Should `RET503` be simplified to only add `return None` at the end of the function?

---

_Referenced in [astral-sh/ruff#11074](../../astral-sh/ruff/pulls/11074.md) on 2024-04-21 16:27_

---

_Closed by @MichaReiser on 2024-08-14 07:47_

---
