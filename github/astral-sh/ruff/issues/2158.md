---
number: 2158
title: "`TRY004` auto-fix is too aggressive"
type: issue
state: closed
author: WilliamJamieson
labels:
  - bug
assignees: []
created_at: 2023-01-25T16:40:25Z
updated_at: 2023-01-25T18:01:01Z
url: https://github.com/astral-sh/ruff/issues/2158
synced_at: 2026-01-07T12:31:12-06:00
---

# `TRY004` auto-fix is too aggressive

---

_Issue opened by @WilliamJamieson on 2023-01-25 16:40_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

- A minimal code snippet that reproduces the bug.
- The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
- The current Ruff settings (any relevant sections from your `pyproject.toml`).
- The current Ruff version (`ruff --version`).
-->

The `TRY004` ([`TC004`](https://github.com/guilatrova/tryceratops/blob/main/docs/violations/TC004.md) in try.ceratops) is a bit too aggressive for me.

It is indicating an error in:

```python
if isinstance(this, some_type):
    # look for a something in `this` and return it, if it is found
   ....

    raise ValueError(f"{this} does not have what your looking for")
```

This is not a `TypeError` as what `TRY004` is saying it should be, and I don't like the auto-fix trying to correct this. I think this is a `ValueError` as `this` does not contain the value I am looking for.

Note that the above also does not follow the example presented in the try.ceratops docs, namely:
```python
if isinstance(my_var, int):
    pass
else:
    raise ValueError(f'{my_var} must be an int')
```

Should raise a `TypeError` instead (as it is not the correct type).

It seems like `ruff` is doing more with `TRY004` than checking for errors raised if the type is not what is expected. It seems to be also applying this to cases where a type check is performed and then an error is raised within that check, not if the check fails.

---

_Comment by @charliermarsh on 2023-01-25 16:45_

Thanks for filing! Looks like we're not handling the `else` case faithfully.

What would you suggest as a better methodology for TRY004? Only flag if there are no other statements in the `if` block, to be more conservative? I _think_ the originating plugin also flags on the case you've described, but definitely correct me if I'm mistaken.


---

_Label `question` added by @charliermarsh on 2023-01-25 16:45_

---

_Comment by @WilliamJamieson on 2023-01-25 16:50_

I would prefer if it didn't flag if there is a return (method to escape) between the start of the block and the error being raised. That would imply (to me) that the error is not being raised due to the type of something but for some other reason.

---

_Comment by @charliermarsh on 2023-01-25 16:53_

That seems reasonable to me.

---

_Label `question` removed by @charliermarsh on 2023-01-25 16:53_

---

_Label `bug` added by @charliermarsh on 2023-01-25 16:53_

---

_Comment by @WilliamJamieson on 2023-01-25 17:04_

In any case, I don't think this should be autofixed by default.

---

_Comment by @charliermarsh on 2023-01-25 17:16_

Let me think on it! We're already working on a more granular API for enabling safe and unsafe fixes of varying degrees. You also have full control to disable fixes for any rule or class of rules like so:

```toml
[tool.ruff]
unfixable = ["TRY004", "B"]
```

---

_Referenced in [astral-sh/ruff#2162](../../astral-sh/ruff/pulls/2162.md) on 2023-01-25 18:00_

---

_Closed by @charliermarsh on 2023-01-25 18:01_

---

_Referenced in [asdf-format/asdf#1329](../../asdf-format/asdf/pulls/1329.md) on 2023-01-26 16:51_

---

_Referenced in [asdf-format/asdf#1339](../../asdf-format/asdf/pulls/1339.md) on 2023-01-30 16:54_

---
