---
number: 14535
title: "More rules out of stub author's control"
type: issue
state: closed
author: SamuelT-Beslogic
labels:
  - rule
  - help wanted
  - accepted
assignees: []
created_at: 2024-11-22T17:13:36Z
updated_at: 2025-01-06T04:27:59Z
url: https://github.com/astral-sh/ruff/issues/14535
synced_at: 2026-01-07T12:31:13-06:00
---

# More rules out of stub author's control

---

_Issue opened by @SamuelT-Beslogic on 2024-11-22 17:13_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->
Ruff 0.8.0 ignores `ambiguous-variable-name (E741)` automatically in pyi files. This prompted me to look at other rules I disable specifically for `.pyi` files and found the following which I think should apply in all cases:
- `PLR0904` https://docs.astral.sh/ruff/rules/too-many-public-methods/
- `PLR0913` https://docs.astral.sh/ruff/rules/too-many-arguments/
- `PLR0917` https://docs.astral.sh/ruff/rules/too-many-positional-arguments/
- `PLW3201` https://docs.astral.sh/ruff/rules/bad-dunder-method-name/
- `SLOT` https://docs.astral.sh/ruff/rules/#flake8-slots-slot
- `FBT` https://docs.astral.sh/ruff/rules/#flake8-boolean-trap-fbt
- Possibly some of `A` https://docs.astral.sh/ruff/rules/#flake8-builtins-a
- Maybe `PLC2701` https://docs.astral.sh/ruff/rules/import-private-name/

I haven't gone back and validated if these still trigger in stub files since I added them to [our shared config](https://github.com/BesLogic/shared-configs/blob/main/ruff.toml), sorry if I tagged a rule that's already ignored.

---

_Comment by @AlexWaygood on 2024-11-22 17:26_

Thanks! Your analysis all seems correct to me. I'd happily accept PRs disapplying these rules to stub files.

For E741 we were quite cautious, and made the change preview-only for several minor releases before stabilising the change. I don't think we need to be as cautious this time around. Our [versioning policy](https://docs.astral.sh/ruff/versioning/) states that it's fine to apply changes in patch releases if they reduce scope (and these _would_ be reductions in scope); we only need to wait for a minor release if a change increases the scope of a rule.

---

_Label `rule` added by @AlexWaygood on 2024-11-22 17:26_

---

_Label `accepted` added by @AlexWaygood on 2024-11-22 17:26_

---

_Label `help wanted` added by @AlexWaygood on 2024-11-22 17:26_

---

_Referenced in [astral-sh/ruff#14541](../../astral-sh/ruff/pulls/14541.md) on 2024-11-22 21:07_

---

_Comment by @dylwil3 on 2024-11-22 21:09_

The linked PR is for all but the last two bullets since those were suggested with less oomph ðŸ˜„ 

---

_Comment by @InSyncWithFoo on 2024-11-24 08:14_

@dylwil3 Is this issue resolved or is there something left to be done?

---

_Comment by @dylwil3 on 2024-11-24 12:48_

I leave that to @Samuel-Therrien-Beslogic to decide - as I said, I did not do anything regarding the last two bullet points. So it depends on whether there is interest in continuing to discuss those items.

---

_Comment by @SamuelT-Beslogic on 2024-11-24 18:32_

Thanks @dylwil3 !

For `PLC2701`, I think that some users may still want a warning about using private names that are subject to change and suddenly break a stub, as per:
> Further, as private imports are not considered part of the public API, they are prone to unexpected changes, especially outside of semantic versioning.
> 
> Instead, consider using the public API of the module.

But also
> This rule ignores private name imports that are exclusively used in type annotations. Ideally, types would be public; however, this is not always possible when using third-party libraries.

(that last sentence is why I've been ignoring it, since more often then not there's no alternatives other than re-writing Aliases, TypeVars and Protocols)

So I'm not 100% convinced either way whether this should be disabled for everyone.

--- 

`flake8-builtins (A)`

The following I'm pretty sure should be disabled in stubs:
- `A002` https://docs.astral.sh/ruff/rules/builtin-argument-shadowing/
- `A003` https://docs.astral.sh/ruff/rules/builtin-attribute-shadowing/
- `A005` https://docs.astral.sh/ruff/rules/builtin-module-shadowing/

As for the rest:
- `A001` https://docs.astral.sh/ruff/rules/builtin-variable-shadowing/
  This could happen with aliases and other top-level variables. Non-runtime type aliases should be private in the first place. Devs also shouldn't try to import builtins from a module that happens to import said builtin. And finally this rule mostly tries to protect against *using* the shadowed variable. In a typing-only context, you should mostly be guarded by type tests anyway.
I think this should be ignored in stubs.
-  `A004` https://docs.astral.sh/ruff/rules/builtin-import-shadowing/
  Very similar as `A001` but can actually be worked around with import aliases and re-export aliases. (which would trigger `A001` instead)
- `A006` https://docs.astral.sh/ruff/rules/builtin-lambda-argument-shadowing/
  I don't think lambdas apply to type stubs anyway. Probably doesn't need to be ignored.

---

_Comment by @harahu on 2024-12-04 10:54_

Just wanted to chime in and say that most if not all of the [pep8-naming (N)](https://docs.astral.sh/ruff/rules/#pep8-naming-n) rules should probably not be applied to stub files either.

---

_Referenced in [astral-sh/ruff#15132](../../astral-sh/ruff/issues/15132.md) on 2024-12-24 17:01_

---

_Comment by @Avasam on 2024-12-24 21:33_

I did an experiment where I enabled nearly all rules in typeshed, and here's what I found typeshed would disable in PYI files (that isn't just an opinionated matter): https://github.com/Avasam/typeshed/pull/39/files#diff-50c86b7ed8ac2cf95bd48334961bf0530cdc77b5a56f852c5c61b89d735fd711

- `pep8-naming (N)`: As @harahu just mentioned, most pep8-naming rules don't apply for third-party stubs
  - **But** relevant rules could be made to apply to names decorated with `@type_check_only`, since that's a clear signal the stub author is very likely in control of that name.
  - `N811`, `N812`, `N813`, `N814`, `N817` are probably fine in stubs, as long as the name isn't re-exported (in `__all__`, or `var = var`)
- `A001`, `A002`, `A004`: https://github.com/astral-sh/ruff/issues/15293 
- `PLC2701` as previously mentioned in https://github.com/astral-sh/ruff/issues/14535#issuecomment-2496160152 (that's just my work account, same person here), https://github.com/astral-sh/ruff/issues/15294, https://github.com/astral-sh/ruff/issues/15295
- `PIE796 non-unique-enums`: I already raised https://github.com/astral-sh/ruff/issues/15132 for different reasons
- `FURB189 subclass-builtin`: https://github.com/astral-sh/ruff/issues/15291 (Stub author should follow runtime superclass when possible)
- `PLW1641 eq-without-hash`: https://github.com/astral-sh/ruff/issues/15292 (If runtime doesn't implement `__hash__`, stubs shouldn't show it as such)
- `flake8-bandit (S)`
  - `S105`, `S106`, `S107`: https://github.com/astral-sh/ruff/issues/15206
  - `S4`: https://github.com/astral-sh/ruff/issues/15207

As for opinionated rules: `RUF022`, `RUF023`, `F403`, `F405` (caught by type-checkers), `FURB180` (often breaks mypy/stubtest) are disabled for reasons specific to typeshed and can be kept out of this conversation.

---

_Referenced in [python/typeshed#13306](../../python/typeshed/pulls/13306.md) on 2024-12-26 19:53_

---

_Referenced in [astral-sh/ruff#15206](../../astral-sh/ruff/issues/15206.md) on 2024-12-30 22:04_

---

_Referenced in [astral-sh/ruff#15207](../../astral-sh/ruff/issues/15207.md) on 2024-12-30 22:14_

---

_Referenced in [astral-sh/ruff#15291](../../astral-sh/ruff/issues/15291.md) on 2025-01-06 03:24_

---

_Referenced in [astral-sh/ruff#15292](../../astral-sh/ruff/issues/15292.md) on 2025-01-06 03:29_

---

_Referenced in [astral-sh/ruff#15293](../../astral-sh/ruff/issues/15293.md) on 2025-01-06 03:50_

---

_Comment by @SamuelT-Beslogic on 2025-01-06 04:25_

Closing as all the mentioned rules and groups here now all have an associated PR or issue.

---

_Closed by @SamuelT-Beslogic on 2025-01-06 04:25_

---

_Referenced in [astral-sh/ruff#15296](../../astral-sh/ruff/issues/15296.md) on 2025-01-06 04:32_

---
