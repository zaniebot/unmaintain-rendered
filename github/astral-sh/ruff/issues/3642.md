---
number: 3642
title: Add a step by step diff of the auto-fix
type: issue
state: closed
author: JonathanPlasse
labels:
  - wish
assignees: []
created_at: 2023-03-21T08:32:45Z
updated_at: 2023-05-10T20:45:31Z
url: https://github.com/astral-sh/ruff/issues/3642
synced_at: 2026-01-07T12:31:12-06:00
---

# Add a step by step diff of the auto-fix

---

_Issue opened by @JonathanPlasse on 2023-03-21 08:32_

To help debug auto-fix problems and add auto-fixes, it could be useful to be able to have a step-by-step diff for each application of a fix.

---

_Label `Whishlist` added by @MichaReiser on 2023-03-21 10:17_

---

_Comment by @jfmengels on 2023-03-22 19:07_

For what it's worth, this is the default behavior for `elm-review --fix`, which I think is the best approach to gain the user's trust: by showing that you're fixing each issue in the correct way. I talk about this in [this video](https://youtu.be/XjwJeHRa53A?t=1222).

![FaHfMbbX0AA_Sba](https://user-images.githubusercontent.com/3869412/227010991-a19a6003-2faf-4504-b819-6bad8c7c486e.png)

It does however look a lot less impressive if you're trying to impress the user with the speed of the tool though, which I guess is pretty important for Ruff's adoption at this point.

`elm-review` also has a `--fix-all` command which accumulates all errors and then prompts the user on whether to accept the larger diff. And there is a `--fix-all-without-prompt` flag (which is not very much documented on purpose) where the behavior is the same as what Ruff has today.

---

_Comment by @JonathanPlasse on 2023-03-22 19:41_

It's awesome!

---

_Comment by @charliermarsh on 2023-03-22 20:05_

(FWIW I support adding a "review mode".)

---

_Comment by @charliermarsh on 2023-03-26 23:33_

If any contributor gets excited about implementing this, I do think it's something we'd like to support. Though there are some details to work out before diving in.

As a straw proposal:

- Invoke via `ruff --fix --review`.
- Render a `cargo insta review`-like experience: a diff, with "accept" or "skip" actions (might be some things we can reuse from `cargo insta`, I like their UI a lot).
- On completion: should we print out all remaining lint errors? Unclear, need to look at how other tools behave here.
- Once you've cycled through all the fixable errors: should we re-run Ruff, and show you the remaining fixable errors? Probably, that's how `--fix` works internally today (we iteratively fix until there's nothing left to fix).

\cc @MichaReiser

---

_Comment by @jfmengels on 2023-03-31 12:05_

> On completion: should we print out all remaining lint errors? Unclear, need to look at how other tools behave here.

That's what `elm-review` does. I'd say you don't want to let the user re-run the tool to know whether they're done with linting (and can move on to other things) or not.

> Once you've cycled through all the fixable errors: should we re-run Ruff, and show you the remaining fixable errors? Probably, that's how --fix works internally today (we iteratively fix until there's nothing left to fix).

We do this as well.

---

If you want to try out how `elm-review` does it:
- Clone https://github.com/jfmengels/elm-spa-example
- Run `npm install`
- Play with
  - `npx elm-review --fix`
  - `npx elm-review --fix-all`

(There are a lot of errors in that example, so maybe you want to use `--rules` to limit which rules to run, like `--rules NoUnused.Patterns`)

---

_Referenced in [astral-sh/ruff#4361](../../astral-sh/ruff/issues/4361.md) on 2023-05-10 20:38_

---

_Comment by @charliermarsh on 2023-05-10 20:45_

Consolidating into #4361.

---

_Closed by @charliermarsh on 2023-05-10 20:45_

---
