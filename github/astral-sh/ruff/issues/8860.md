---
number: 8860
title: "docstring code formatter: add support for Markdown Python code snippets"
type: issue
state: closed
author: BurntSushi
labels:
  - docstring
  - formatter
assignees: []
created_at: 2023-11-27T17:04:40Z
updated_at: 2023-12-07T19:30:45Z
url: https://github.com/astral-sh/ruff/issues/8860
synced_at: 2026-01-07T12:31:12-06:00
---

# docstring code formatter: add support for Markdown Python code snippets

---

_Issue opened by @BurntSushi on 2023-11-27 17:04_

The initial implementation of the docstring code snippet formatter in #8811 only reformats doctest code snippets. This issue tracks the work for making it also reformat Markdown Python code snippets. Work should probably proceed by adding a new `CodeExampleKind`:

https://github.com/astral-sh/ruff/blob/d9845a2628d25cba3fa21bb53ad78ad377128aa2/crates/ruff_python_formatter/src/expression/string.rs#L1373-L1385

---

_Label `formatter` added by @BurntSushi on 2023-11-27 17:04_

---

_Referenced in [astral-sh/ruff#8811](../../astral-sh/ruff/pulls/8811.md) on 2023-11-27 17:05_

---

_Referenced in [astral-sh/ruff#7146](../../astral-sh/ruff/issues/7146.md) on 2023-11-27 17:05_

---

_Comment by @ofek on 2023-11-27 17:08_

I am especially looking forward to this as my code snippets render as documentation and are almost exclusively written as Markdown Python code blocks.

---

_Comment by @BurntSushi on 2023-11-27 17:25_

@ofek Do you have any example code I could take a look at that uses Markdown blocks?

---

_Comment by @ofek on 2023-11-27 17:34_

- https://github.com/pypa/hatch/blob/52a81d80cd03bfb90d99a5837c778971ea0c8c22/src/hatch/env/plugin/interface.py#L23-L41 ([rendered](https://hatch.pypa.io/1.7/plugins/environment/reference/#hatch.env.plugin.interface.EnvironmentInterface))
- https://github.com/pypa/hatch/blob/52a81d80cd03bfb90d99a5837c778971ea0c8c22/src/hatch/env/plugin/interface.py#L694-L697 ([rendered](https://hatch.pypa.io/1.7/plugins/environment/reference/#hatch.env.plugin.interface.EnvironmentInterface.get_build_process))
- https://github.com/DataDog/integrations-core/blob/master/datadog_checks_base/datadog_checks/base/checks/base.py#L990-L995 ([rendered](https://datadoghq.dev/integrations-core/base/api/#datadog_checks.base.checks.base.AgentCheck.metadata_entrypoint))

---

_Comment by @konstin on 2023-11-27 18:40_

Another example, with mixed non-python and python blocks: https://github.com/sacdallago/bio_embeddings/blob/efb9801f0de9b9d51d19b741088763a7d2d0c3a2/bio_embeddings/embed/bepler_embedder.py#L1-L38. i think it makes sense to assume blocks are python just like rustdoc defaults to code blocks being python, but we should skip blocks with an explicitly different language

---

_Comment by @ofek on 2023-11-27 20:22_

I would prefer if we don't treat Markdown blocks differently compared to other parsers and assume unspecified blocks are generic, similar to the first block in your example where they show shell commands to run.

---

_Comment by @BurntSushi on 2023-11-27 20:56_

I think it makes sense to _assume_ unmarked blocks are Python code. As @konstin said, this is what `rustdoc` does and it works great. The mitigation here is that if the blocks are not valid Python code, then we can leave them as-is untouched.

---

_Comment by @ofek on 2023-11-27 21:18_

I understand what you both are saying but I'm saying that model does not work for Python because historically we do not use Markdown and have no such concept of embedded documentation that is rendered in a standard way. If you do what you say here you're going to immediately fail on the vast majority of code blocks, because most are not Python, because we do not do that.

---

_Comment by @zanieb on 2023-11-27 21:59_

Here are some additional examples from a real project (kind of randomly pulled, there are more for sure)

- https://github.com/PrefectHQ/prefect/blob/bbaa0208d476240da1ac370d2735c4af41c304f0/src/prefect/runner/runner.py#L6-L29 (`python` annotation)
- https://github.com/PrefectHQ/prefect/blob/bbaa0208d476240da1ac370d2735c4af41c304f0/src/prefect/utilities/annotations.py#L81-L89 (no annotation, python)
- https://github.com/PrefectHQ/prefect/blob/bbaa0208d476240da1ac370d2735c4af41c304f0/src/prefect/blocks/kubernetes.py#L38-L42 (`python` annotation)
- https://github.com/PrefectHQ/prefect/blob/bbaa0208d476240da1ac370d2735c4af41c304f0/src/prefect/settings.py#L160-L163 (`python` annotation)
- https://github.com/PrefectHQ/prefect/blob/bbaa0208d476240da1ac370d2735c4af41c304f0/src/prefect/utilities/templating.py#L180-L186 (no annotation, json)
- https://github.com/PrefectHQ/prefect/blob/bbaa0208d476240da1ac370d2735c4af41c304f0/src/prefect/workers/process.py#L10-L12 (`bash` annotation)

---

_Label `docstring` added by @MichaReiser on 2023-11-27 23:29_

---

_Added to milestone `Formatter: Stable` by @BurntSushi on 2023-11-29 13:21_

---

_Referenced in [astral-sh/ruff#9030](../../astral-sh/ruff/pulls/9030.md) on 2023-12-06 22:32_

---

_Closed by @BurntSushi on 2023-12-07 19:30_

---

_Referenced in [analogdevicesinc/pyadi-iio#662](../../analogdevicesinc/pyadi-iio/pulls/662.md) on 2025-04-15 08:04_

---
