---
number: 19152
title: "ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`"
type: issue
state: open
author: aaronsteers
labels:
  - rule
  - needs-decision
assignees: []
created_at: 2025-07-05T01:41:19Z
updated_at: 2025-11-07T08:58:59Z
url: https://github.com/astral-sh/ruff/issues/19152
synced_at: 2026-01-07T12:31:13-06:00
---

# ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`

---

_Issue opened by @aaronsteers on 2025-07-05 01:41_

There's been some discussion about how `Any` and `ANN401` should behave with `*args` and `**kwargs`. Some of that is discussed here:
- https://github.com/astral-sh/ruff/issues/677


I also understand there's an override config:

```
[tool.ruff.flake8-annotations]
allow-star-arg-any = true
```

What I'd like to propose is that we have separate rules for "Any" when typing _singular-inputs_ versus in an inherently _multi-input_ setting.

I am perfectly happy to strongly-type my input args or to add a lint exception for very-rare exceptions. However, the `**kwargs: Any` input specifically seems like a completely different animal. This is most often used in cases of programming for (1) backwards compatibility, (2) forwards compatibility, or (3) hand-off to an API we don't control. In all of these cases, there's no feasible manner of typing for things we don't know yet or don't ourselves control.

Example of the third use case (hand-off to 3rd-party):

```
def get_openai_client_from_api_key(
    **kwargs: Any,  # noqa: ANN401 (let the called library verify these)
) -> Client | None:
    """Get the OpenAI API key, or None if not set.

    Anything sent as keyword argument will be passed to the OpenAI client constructor.
    """
    if api_key := get_secret("OPENAI_API_KEY"):
        return Client(api_key=api_key, **kwargs)

    return None
```

This implementation seems about as clean as I can make it. I don't want to take any assumptions on the library I'm calling out to. Any changes beyond what I have here seems like it would only make the code more brittle.

I'd like to avoid noqa-ing ANN401 while still accepting this type of kwargs-passthrough as the best-available method.

Is there something I'm missing? Any appetite to splitting the rule so that kwargs isn't triggering it? 

FWIW, I'm sure a case for `*args` could be made also, but I don't see positional args (`*args`) being a real issue. (1) a sequence of positional args are more likely to share type, and (2) there's a lot more risk of positional args vs keyword args. While positional args can easily be passed out of order, it is much less likely to receive a kwarg that doesn't match (or at least be duck-type-compatible) with its downstream caller.

If anything, this could be a rule against _any_ usage of `kwargs`, since practically speaking, a passthrough of `kwargs: Any` and a passthrough of `kwargs: str` are _equally_ likely to fail, solely on the grounds that the called function or method might not support the named arg.

Maybe there's a thread here: kwargs as passthrough, or when guarded by `isinstance` type checks, would not trigger the error. But kwargs with unchecked (first-party) assumptions would not? Again, seems like a good grounds for a new and separate rule to sort it all out.

Thanks for listening and for your support of this awesome tool. Apologies in advance if there's a better solution that I'm missing. Also, I totally understand if the answer is "in general, yes, but not a high enough priority as of now".

---

_Renamed from "ANN401: Resolve conflation between `arg: Any` and `**kwargs: Any`" to "ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`?" by @aaronsteers on 2025-07-05 01:41_

---

_Renamed from "ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`?" to "ANN401: Split rule to resolve conflation between `arg: Any` and `**kwargs: Any`" by @aaronsteers on 2025-07-05 01:52_

---

_Label `rule` added by @ntBre on 2025-07-07 21:24_

---

_Label `needs-decision` added by @ntBre on 2025-07-07 21:24_

---

_Comment by @ntBre on 2025-07-07 21:41_

Thanks for the thoughtful write-up and the kind words! ðŸ˜„ 

I don't have a strong sense for the best path here with the rule, but we can certainly leave the issue open to collect ideas/discussion.

Just to make sure I'm following, what's the difference between the current config option and splitting the rule? It seems like you'd end up using noqa with the new rule here instead of `ANN401`. Would it help if the config option were more granular so that you could apply the rule to `*args` but not `**kwargs`?

And here's the example in the [playground](https://play.ruff.rs/9067b58b-6a1b-4115-8472-1448c73f8e9a) in case anyone else wants to try it.

---

_Comment by @travis-leith on 2025-11-07 08:58_

The override config is useful *if* you know about.
As far as I can see, it is not documented on the page for rule ANN401: https://docs.astral.sh/ruff/rules/any-type/

At the very least, this config should be easily discoverable to anyone looking at the rule page.

---

_Referenced in [astral-sh/ruff#21326](../../astral-sh/ruff/pulls/21326.md) on 2025-11-07 19:28_

---
