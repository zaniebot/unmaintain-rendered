---
number: 4553
title: "FA100 doesn't catch using modern annotation syntax when target version is 3.9"
type: issue
state: closed
author: akx
labels:
  - question
assignees: []
created_at: 2023-05-20T21:45:45Z
updated_at: 2023-05-21T19:42:06Z
url: https://github.com/astral-sh/ruff/issues/4553
synced_at: 2026-01-07T12:31:12-06:00
---

# FA100 doesn't catch using modern annotation syntax when target version is 3.9

---

_Issue opened by @akx on 2023-05-20 21:45_

As I'm reading it, FA100 should add a `from __future__ import annotations` import when a file already uses modern annotation syntax and the configuration targets Python 3.9, but it doesn't:

Refs https://github.com/AUTOMATIC1111/stable-diffusion-webui/pull/10580

```
$ cat a.py
def foo(x: str | None):
	pass
$ ruff --version
ruff 0.0.269
$ ruff --target-version=py39 --select=FA100 --isolated a.py
$ ~/.pyenv/versions/3.9.16/bin/python3.9 a.py
Traceback (most recent call last):
  File "a.py", line 1, in <module>
    def foo(x: str | None):
TypeError: unsupported operand type(s) for |: 'type' and 'NoneType'
```


---

_Referenced in [AUTOMATIC1111/stable-diffusion-webui#10580](../../AUTOMATIC1111/stable-diffusion-webui/pulls/10580.md) on 2023-05-20 21:46_

---

_Comment by @charliermarsh on 2023-05-21 19:24_

I believe the intent of `FA100` is that it should trigger when it finds a type annotation you _could_ rewrite _if_ you enabled future annotations. So, e.g., if you had `x: Optional[str]`, _then_ it might trigger. But I don't believe it's intended to trigger in the case you outlined above. Am I misunderstanding? Or are the docs misrepresenting the rule in some way?

---

_Label `question` added by @charliermarsh on 2023-05-21 19:25_

---

_Comment by @akx on 2023-05-21 19:31_

Well, in that case another FA* rule that would address this would probably be useful?

I.e. if the target Python version is <= 3.9, then any file using modern type annotations would also have to have a `from __future__ import annotations` . (PyCharm's "version compatibility" lint does this, FWIW.)

---

_Comment by @charliermarsh on 2023-05-21 19:33_

I think that might be `FA102`: https://pypi.org/project/flake8-future-annotations/

---

_Comment by @akx on 2023-05-21 19:38_

@charliermarsh Ah, yeah, thanks! Someone oughta get implementing FA102 in Ruff then, I guess ðŸ˜‚ 

Closing this, I guess the rest of FA* is tracked in https://github.com/charliermarsh/ruff/issues/3072

---

_Closed by @akx on 2023-05-21 19:38_

---

_Comment by @charliermarsh on 2023-05-21 19:42_

Lol yes :joy:

---

_Referenced in [astral-sh/ruff#4702](../../astral-sh/ruff/pulls/4702.md) on 2023-05-29 08:45_

---
