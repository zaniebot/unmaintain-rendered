---
number: 17527
title: Ruff fails to build in Termux on Android 14, unable to find -lgcc
type: issue
state: closed
author: bdegreve
labels:
  - cli
assignees: []
created_at: 2025-04-21T17:31:56Z
updated_at: 2025-04-26T21:25:40Z
url: https://github.com/astral-sh/ruff/issues/17527
synced_at: 2026-01-07T12:31:13-06:00
---

# Ruff fails to build in Termux on Android 14, unable to find -lgcc

---

_Issue opened by @bdegreve on 2025-04-21 17:31_

### Summary

When trying to build Ruff in Termux on Android, it fails with the error `unable to find library -lgcc`

First, the following message is repeated many times:
```
'+fpmr' is not a recognized feature for this target (ignoring feature)
```
To finally conclude with:
```
...
'+fpmr' is not a recognized feature for this target (ignoring feature)
'+fpmr' is not a recognized feature for this target (ignoring feature)
error: linking with `cc` failed: exit status: 1
  |
  = note:  "cc" "<sysroot>/tmp/rustc7xXo1P/symbols.o" "<2201 object files omitted>" "-Wl,--as-needed" "-Wl,-Bstatic" "<sysroot>/tmp/rustc7xXo1P/{libtikv_jemalloc_sys-*,libzstd_sys-*}.rlib" "<sysroot>/lib/rustlib/aarch64-linux-android/lib/{libcompiler_builtins-*}.rlib" "-Wl,-Bdynamic" "-lgcc" "-ldl" "-llog" "-lunwind" "-ldl" "-lm" "-lc" "-Wl,--eh-frame-hdr" "-Wl,-z,noexecstack" "-L" "/data/data/com.termux/files/home/ruff/target/release/build/zstd-sys-8e4a345f2fc1e8e3/out" "-L" "/data/data/com.termux/files/home/ruff/target/release/build/tikv-jemalloc-sys-c141053eefecffab/out/build/lib" "-L" "/data/data/com.termux/files/home/ruff/target/release/build/tikv-jemalloc-sys-c141053eefecffab/out" "-o" "/data/data/com.termux/files/home/ruff/target/release/deps/ruff-b7c7594f40f7712c" "-Wl,--gc-sections" "-pie" "-Wl,-z,relro,-z,now" "-Wl,-O1" "-Wl,--strip-debug" "-nodefaultlibs"
  = note: some arguments are omitted. use `--verbose` to show all linker arguments
  = note: ld.lld: error: unable to find library -lgcc
          cc: error: linker command failed with exit code 1 (use -v to see invocation)
```



I've found a similar issue reported to termux about [vim-clap](https://github.com/termux/termux-packages/issues/20063) [1],
which was resolved upstream by [disabling tikv-jemallocator on Android](https://github.com/liuchengxu/vim-clap/pull/1079) [2].

When duplicating that resolution by also disabling tikv-jemallocator in Ruff, `cargo build --release` will succeed, and running `cargo run -p ruff -- check /path/to/file.py --no-cache` also succeeds.

I don't know if that's the best solution, or even an acceptable (I'm not familiar with the Rust nor Android ecosystem), but I can create a PR with my changes for consideration.

I know there's a pre-built termux package that I can install with `pkg install ruff`, but I'd like to install ruff as part of a venv, for which it needs to be able to build from source.

**Steps to reproduce in Termux:**

```
pkg install build-essential rust
git clone https://github.com/astral-sh/ruff.git
cd ruff
cargo build --release
```

**Environment:**

- TERMUX_VERSION=0.118.1
- Android version: 14
- Kernel build information: `Linux localhost 5.15.153-android13-3-29539737 #1 SMP PREEMPT Fri Feb 14 18:09:51 KST 2025 aarch64 Android`
- Device: Samsung Galaxy Tab S9 FE (SM-X510)
- SUPPORTED_ABIS: arm64-v8a,armeabi-v7a,armeabi
- cargo: 1.86.0 (adf9b6ad1 2025-02-28)
- ruff: main branch, g1918c6162

[1] https://github.com/termux/termux-packages/issues/20063
[2] https://github.com/liuchengxu/vim-clap/pull/1079

### Version

ruff 0.11.6 (1918c6162 2025-04-18)

---

_Comment by @MichaReiser on 2025-04-23 07:22_

Thanks for the nice write up. Disabling jemalloc is an option, but it will result in a slower version of Ruff. I'd have to do some more research but jemalloc at least claims that android is supported. But maybe only if gcc is installed (which doesn't seem to be the case anymore for newer andorid ndks?)

---

_Label `cli` added by @MichaReiser on 2025-04-23 07:22_

---

_Comment by @bdegreve on 2025-04-23 15:56_

I've found this stating libgcc is indeed no longer available: https://blog.rust-lang.org/2023/01/09/android-ndk-update-r25/
But I'm honestly unsure what that means for tikv-jemallocator.

In meantime, I could try that workaround that the blog post mentions, and and redirect libgcc.a to libunwind.a.  I'll keep you posted on how that goes...

---

_Comment by @bdegreve on 2025-04-23 21:58_

@MichaReiser I'm happy to report that the workaround metiond in that blog post works.  Ruff correctly builds, and `pip install ruff` now also works (pip needs to build it from source on Termux)

---

_Closed by @MichaReiser on 2025-04-24 06:09_

---

_Comment by @laguill on 2025-04-26 21:25_

Hi @bdegreve,

Can you elaborate a bit more how you did to solve this issue ?

---

_Referenced in [astral-sh/ruff#18016](../../astral-sh/ruff/issues/18016.md) on 2025-05-11 17:18_

---

_Referenced in [astral-sh/ruff#18033](../../astral-sh/ruff/pulls/18033.md) on 2025-05-12 07:19_

---
