---
number: 14901
title: flake8-bandit import check should not trigger on TYPE_CHECKING imports or classes not in defusedxml
type: issue
state: open
author: scy
labels:
  - help wanted
assignees: []
created_at: 2024-12-10T22:30:41Z
updated_at: 2024-12-16T08:19:59Z
url: https://github.com/astral-sh/ruff/issues/14901
synced_at: 2026-01-07T12:31:13-06:00
---

# flake8-bandit import check should not trigger on TYPE_CHECKING imports or classes not in defusedxml

---

_Issue opened by @scy on 2024-12-10 22:30_

The following code triggers [S408](https://docs.astral.sh/ruff/rules/suspicious-xml-minidom-import/) ("`xml.dom.minidom` is vulnerable to XML attacks"):

```python
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from xml.dom.minidom import Element
```

As far as I know, [defusedxml](https://github.com/tiran/defusedxml), which this rule suggests as an alternative, does not supply alternative implementations for most of the types, only of some functions. In other words, I _have_ to import types like these for the standard library; there is no defusedxml alternative.

So in order to signal to Ruff that "this is fine"â„¢, I've tried moving the import to `TYPE_CHECKING`, but still received the same error.

This probably applies to other rules in the S4xx range, too.

---

_Comment by @scy on 2024-12-10 22:44_

The following code has a similar problem, triggering S409 on the `pulldom` import, but this time I can't even move the import into a `TYPE_CHECKING` block:

```python
from xml.dom import pulldom

from defusedxml.pulldom import parseString


doc = parseString("<foo></foo>")

for ev, node in doc:
    if ev == pulldom.START_ELEMENT:
        print(node)
```

Again, `defusedxml` does not provide everything required for parsing XML; here it's the event constant to compare against. Nevertheless I'm using `defusedxml` for the actual parsing, which means I'm not vulnerable.

---

_Comment by @MichaReiser on 2024-12-16 08:19_

Thanks. This makes sense to me. So what we need to do here is to allow some imports from `xml.dom` or at least when under the `TYPE_CHECKING`

---

_Label `help wanted` added by @MichaReiser on 2024-12-16 08:19_

---
