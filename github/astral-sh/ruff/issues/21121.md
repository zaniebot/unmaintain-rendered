---
number: 21121
title: TC003 false-positive for dataclass.KW_ONLY when future-annotations is true
type: issue
state: closed
author: beskep
labels:
  - bug
assignees: []
created_at: 2025-10-29T04:51:35Z
updated_at: 2025-10-30T18:14:30Z
url: https://github.com/astral-sh/ruff/issues/21121
synced_at: 2026-01-07T12:31:13-06:00
---

# TC003 false-positive for dataclass.KW_ONLY when future-annotations is true

---

_Issue opened by @beskep on 2025-10-29 04:51_

### Summary

playground: https://play.ruff.rs/10ce19b3-ce84-44e2-be98-19ece9acdf9d

---

pyproject.toml
```toml
[project]
name = "TC-TEST"
version = "0.1.0"
description = "TC-TEST"
readme = "README.md"
requires-python = ">=3.13"
dependencies = ["ruff>=0.14.2"]

[tool.ruff.lint]
select = ["TC"]
extend-safe-fixes = ["TC"]
future-annotations = true
```

```python
from dataclasses import KW_ONLY, dataclass


@dataclass
class DataClass:
    a: int
    _: KW_ONLY
    b: int
```

ruff (v0.14.2) check `TC003` for importing `KW_ONLY` in python 3.13.

<br>

Auto (unsafe) fix result:
```python
from __future__ import annotations
from dataclasses import dataclass
from typing import TYPE_CHECKING
from dataclasses import KW_ONLY
```

<br>

`KW_ONLY` import in `TYPE_CHECKING` block cause `TC004`.
```python
from __future__ import annotations

from dataclasses import dataclass
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from dataclasses import KW_ONLY


@dataclass
class DataClass:
    a: int
    _: KW_ONLY
    b: int
```

Relative to #12859


### Version

ruff 0.14.2 (83a3bc4ee 2025-10-23)

---

_Label `bug` added by @ntBre on 2025-10-29 13:58_

---

_Comment by @ntBre on 2025-10-29 13:59_

Interesting, thanks for the report and for finding the other issue! It seems like I probably missed something here when adding the `future-annotations` setting.

---

_Assigned to @ntBre by @ntBre on 2025-10-29 14:17_

---

_Referenced in [astral-sh/ruff#21125](../../astral-sh/ruff/pulls/21125.md) on 2025-10-29 14:53_

---

_Closed by @ntBre on 2025-10-30 18:14_

---
