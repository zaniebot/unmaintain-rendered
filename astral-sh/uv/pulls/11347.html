<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use a stable directory for (local) script virtual environments - astral-sh/uv #11347</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use a stable directory for (local) script virtual environments</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11347">#11347</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-02-09 02:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>Today, scripts use <code>CachedEnvironment</code>, which results in a different virtual environment path every time the interpreter changes <em>or</em> the project requirements change. This makes it impossible to provide users with a stable path to the script that they can use for (e.g.) directing their editor.</p>
<p>This PR modifies <code>uv run</code> to use a stable path for local scripts (we continue to use <code>CachedEnvironment</code> for remote scripts and scripts from <code>stdin</code>). The logic now looks a lot more like it does for projects: we <code>get_or_init</code> an environment, etc.</p>
<p>For now, the path to the script is like: <code>environments-v1/4485801245a4732f</code>, where <code>4485801245a4732f</code> is a SHA of the absolute path to the script. But I&#x27;m not picky on that :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-09 02:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-09 02:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-09 02:51</div>
            <div class="timeline-body"><p>As a second PR, I&#x27;ll add <code>uv sync --script</code> using these stable paths.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-09 03:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-11 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-11 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/mod.rs</code>:533 on 2025-02-11 11:17</div>
            <div class="timeline-body"><pre><code>            format!(&quot;{file_name}-{digest}&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/mod.rs</code>:532 on 2025-02-11 11:18</div>
            <div class="timeline-body"><p>missing replace?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1171 on 2025-02-11 11:26</div>
            <div class="timeline-body"><pre><code>/// The Python environment for a script.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-02-11 11:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-02-11 22:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-12 00:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-12 00:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-12 00:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:50:47 UTC
    </footer>
</body>
</html>
