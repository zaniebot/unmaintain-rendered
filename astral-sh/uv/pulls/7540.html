<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use a single lint task in CI - astral-sh/uv #7540</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use a single lint task in CI</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7540">#7540</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-09-19 10:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>We initially had two jobs for fast lints, one for Python and one for Rust (rustfmt). We now have fast lints for more (Rust, Python, {json5,yaml,yml}, Markdown, Readme). Instead of arbitrarily splitting the new cases between Python or Rust and reporting e.g. Prettier failures as Rust problems, we run them in a single job that&#x27;s still &lt;1min on a regular runner. This also reduces our large test matrix by one job.</p>
<p>Note: Before merging, we need to change the required checks configuration in the settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-09-19 10:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-19 10:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/ci.yml</code>:62 on 2024-09-19 10:55</div>
            <div class="timeline-body"><p>Should we use our action here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-09-19 11:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>.github/workflows/ci.yml</code>:62 on 2024-09-19 11:09</div>
            <div class="timeline-body"><p>yeah!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-09-19 11:10</div>
            <div class="timeline-body"><p>ðŸ¥³ sorry didn&#x27;t realize we weren&#x27;t already using it elsewhere</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-19 11:12</div>
            <div class="timeline-body"><p>I disabled the branch protection check for &#x27;cargo fmt&#x27;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-19 11:18</div>
            <div class="timeline-body"><p>I think you&#x27;ll need to disable the cache</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-09-19 11:24</div>
            <div class="timeline-body"><p>The cache dir is set unconditionally at https://github.com/astral-sh/setup-uv/blob/ce0062aac78b2f340c6612e0e40b80a2fa668ced/src/setup-uv.ts#L48. We can&#x27;t unset an env var (<a href="https://github.com/actions/runner/issues/1126">actions/runner#1126</a>), but we should also in general make our test suite robust against <code>UV_CACHE_DIR</code> being set. Follow-up #7542</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2024-09-19 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-09-19 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-19 11:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:48:20 UTC
    </footer>
</body>
</html>
