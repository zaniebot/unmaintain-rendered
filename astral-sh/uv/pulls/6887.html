<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make headers title case for backward compatibility - astral-sh/uv #6887</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Make headers title case for backward compatibility</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6887">#6887</a>
        opened by <a href="https://github.com/leiserfg">@leiserfg</a>
        on 2024-08-30 20:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leiserfg">@leiserfg</a></div>
            <div class="timeline-body">Summary
<p>Http headers are supposed to be case-insensitive (RFC 2616), but there are some implementations that don&#x27;t normalize them.
I noticed it while migrating to <code>uv</code>, calls to an internal registry failed. A man in the middle server helped me to find that <code>pip</code> uses Title-Case while <code>uv pip</code> uses lowercase.</p>
Test Plan
<p>I tested <code>uv</code> with the same server and now it works fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-30 20:42</div>
            <div class="timeline-body"><p>Interesting. I did some reading and it looks like this is disabled by default both out of spec compliance and due to performance risks. I wish we could enable this selectively so it didn&#x27;t affect all users, since it seems like a minority of servers need this. Maybe an env var?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-30 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leiserfg">@leiserfg</a> on 2024-08-30 21:49</div>
            <div class="timeline-body"><p>Regarding spec compliance, both are equally valid with the only difference being that correctly implemented servers will work with both but http1 servers will use the old way (Title-Case).
I don&#x27;t think that changing the case of the header would have any impact on performance (I could be wrong tho).
What I fear is that if there are other servers broken the same way, the error coming from the server does not reflect it, you will just get a 401 or worse.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leiserfg">@leiserfg</a> on 2024-09-02 07:53</div>
            <div class="timeline-body"><p>An example of a webserver not doing headers normalization: AWS lambda. Therefore local pypi using lambda like https://github.com/khornberg/elasticpypi will only work with uv if they handroll the normalization.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">network</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-03 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-03 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-03 17:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:47:58 UTC
    </footer>
</body>
</html>
