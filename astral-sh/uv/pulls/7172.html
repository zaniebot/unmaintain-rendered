<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respect `[tool.uv.sources]` in build requirements - astral-sh/uv #7172</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Respect <code>[tool.uv.sources]</code> in build requirements</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7172">#7172</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-09-07 17:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>We weren&#x27;t respecting <code>tool.uv.sources</code> for <code>build-requires</code>.</p>
<p>Closes <a href="https://github.com/astral-sh/uv/issues/7147">astral-sh/uv#7147</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/sync.rs</code>:2157 on 2024-09-07 17:27</div>
            <div class="timeline-body"><p>Nit: Why a workspace member instead of a local path? This seems a bit more complicated and I think we&#x27;d want to duplicate the test if we stop requiring a source definition here. Maybe worth adding both now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-07 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-07 17:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/sync.rs</code>:2157 on 2024-09-07 17:28</div>
            <div class="timeline-body"><p>Good idea, we can test both.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 17:34</div>
            <div class="timeline-body"><p>Ugh, the lower bound warnings are super annoying here. I guess I have to make that configurable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 17:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-10 02:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-09-10 13:54</div>
            <div class="timeline-body"><p>The <code>[build-system]</code> table was created so that projects can be built by any PEP 517 build frontend. This means that you could mix and match tools, allowing people to migrate away from setuptools and for alternative to pip to being built. By reading <code>tool.uv.sources</code>, we support a uv-only feature, something that e.g. <code>python -m build</code> doesn&#x27;t support. To make it clear that this doesn&#x27;t build a vendor lock-in, we need to make it clear in the docs:</p>
<p><code>tool.uv.sources</code> for the <code>build-system</code> table is for development only. It is our equivalent to using <code>pip install -e ./my-setuptools-ext</code> and then building without build isolation: It&#x27;s our way of feature parity with pip without dropping you out if the uv project interface. We do only support it when building from a directory, we do not support it when building when from an index or a file sdist. Even <code>uv build --wheel --sdist</code> will not recognize it, but give you the default standards-only PEP 517 build experience. As a package author, you need to test that your (published) project does also builds without <code>tool.uv.sources</code> using only published packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mmerickel">@mmerickel</a> on 2024-09-10 14:31</div>
            <div class="timeline-body"><p>At some point you may want to support a find-links feature to side load a wheelhouse. You can see an example of how that works in the additional info of #7147. That would impact the lookup at all times and it does work to allow a build backend to find/resolve dependencies that are not distributed externally. As a naive user that’s basically how I think of tool.uv.sources as well.</p>
<p>Separately from that when you say that <code>uv build --wheel</code> won’t use the sources that doesn’t feel like it will be ok in the long term. Build dependencies do not need to be distributed if I’m building a wheel. Only a sdist where building happens by an external system. uv should be able to build my wheel using workspace dependencies and no one else needs them. The wheel can be installed without them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/sync.rs</code>:2115 on 2024-09-10 15:04</div>
            <div class="timeline-body"><p>Maybe call it <code>my-build</code> or something so it&#x27;s clear that this isn&#x27;t about <code>python -m build</code>, otherwise <code>build-system.requires = [&quot;setuptools&gt;=42&quot;, &quot;build&quot;]</code> is easy to confuse.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-09-10 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mmerickel">@mmerickel</a> on 2024-09-10 22:46</div>
            <div class="timeline-body"><blockquote>
<p>Even uv build --wheel --sdist will not recognize it</p>
</blockquote>
<p>I guess just to poke at this more if we go back to my issue that inspired this work #7147, I&#x27;m concerned about @konstin&#x27;s assertion that <code>uv build --wheel --package my-app</code> wouldn&#x27;t work with this new feature? Is that true that it wouldn&#x27;t use the workspace dependency to build the wheel for package my-app which depends on the local workspace package <code>my-setuptools-extension</code>? So I could <code>uv sync</code> properly but not <code>uv build</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mmerickel">@mmerickel</a> on 2024-10-04 19:39</div>
            <div class="timeline-body"><p>Is there anything I can do to help move this forward?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 00:08</div>
            <div class="timeline-body"><p>I think <code>uv build</code> <em>would</em> respect this, and you&#x27;d need to use <code>uv build --no-sources</code> to avoid it. Are you okay with that, @konstin? I think it would be surprising if <code>uv build</code> didn&#x27;t run the same build process as our other hooks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-15 07:26</div>
            <div class="timeline-body"><p>Yeah that&#x27;s what I&#x27;d suggest.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 12:43</div>
            <div class="timeline-body"><p>Ok, will rebase and merge this today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-15 15:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:48:08 UTC
    </footer>
</body>
</html>
