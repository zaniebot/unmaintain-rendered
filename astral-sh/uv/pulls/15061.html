<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prefer system Python installations over managed ones when `--system` is used - astral-sh/uv #15061</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Prefer system Python installations over managed ones when <code>--system</code> is used</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/15061">#15061</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-08-04 14:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>This fixes a regression from 0.8.0 from <a href="https://github.com/astral-sh/uv/pull/7934">astral-sh/uv#7934</a> and follows <a href="https://github.com/astral-sh/uv/pull/15059">astral-sh/uv#15059</a></p>
<p>The regression is from <a href="https://github.com/astral-sh/uv/pull/7934/files#diff-c7a660ac39628d5e12f388b0cacc7360affa3d7bb21191184d7ee78489675e83">this change</a>, which was made because we&#x27;d otherwise (with the other changes in that pull request) <em>filter out</em> managed Python interpreters found in virtual environments.</p>
<p>When <code>--system</code> is used we&#x27;ll convert the default Python preference of <code>managed</code> to <code>system</code> which avoids things like <code>uv pip install --system</code> targeting a managed Python installation.</p>
<p>The basic test is</p>
<pre><code>uv python install
uv pip install --system anyio
</code></pre>
<p>Prior to this change, we&#x27;d read a managed interpreter from our managed installation directory and target that. After this change, without #15059, we&#x27;d read a managed interpreter from the PATH and target that. Both of those experiences are bad, because the managed interpreters are marked as externally managed. After this change, with #15059, we properly target the system interpreter.</p>
<p>Since we use <code>system</code> instead of <code>only-system</code>, if there is not a system interpreter we&#x27;ll still retain our existing behavior and use a managed interpreter. This should limit breakage from the change. Given the source of the regression, we could probably use <code>only-system</code> here. I don&#x27;t feel strongly. I think the main benefit of doing so would be that we&#x27;d omit the check for managed installations in error messages when an interpreter cannot be found?</p>
<p>We can&#x27;t really add test coverage here because the test suite always has externally managed interpreters :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-04 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-04 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-08-04 23:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-05 00:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-05 00:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-05 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-05 00:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:53:27 UTC
    </footer>
</body>
</html>
