<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>generate-shell-completion: generate `uvx` shell completions for the fish shell - astral-sh/uv #7323</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>generate-shell-completion: generate <code>uvx</code> shell completions for the fish shell</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/7323">#7323</a>
        opened by <a href="https://github.com/ilyagr">@ilyagr</a>
        on 2024-09-12 05:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ilyagr">@ilyagr</a> on 2024-09-12 05:09</div>
            <div class="timeline-body"><p>Cc: #7258</p>
<h2>Summary</h2>
<p><code>uv generate-shell-completion fish</code> will automatically include completion for <code>uvx</code>.</p>
<p>Hopefully, others will contribute something similar to other shells.</p>
<h2>Test Plan</h2>
<p>I ran</p>
<pre><code> cargo run -- generate-shell-completion fish |source</code></pre>
<p>in <code>fish</code> and checked <code>uvx --f&lt;TAB&gt;</code> expands to the correct options. You can also do <code>uvx -&lt;TAB&gt;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ilyagr on 2024-09-12 05:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilyagr">@ilyagr</a> on 2024-09-12 16:06</div>
            <div class="timeline-body"><p>Another approach to this would be to make a <code>clap::Command</code> for <code>uvx</code> and call <code>clap_complete::generate</code> on it. That would work for all shells. I haven't yet looked into whether this would be easy to do; something like this <code>clap::Command</code> might already exist to make <code>uvx</code> work in the first place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-12 16:49</div>
            <div class="timeline-body"><p>I think that for bash, you want the uv and uvx completion to end up in different files, because completion is lazy loaded by filename.</p>
<p>There might be some way to work around, that, however -- the <a href="https://github.com/scop/bash-completion/blob/main/README.md">recommended way</a> seems to be to put the whole completion in a file called <code>uv</code> and symlink <code>uvx</code> -&gt; <code>uv</code> in the completions dir.   That should work, but it's still a solution that requires two files. :neutral_face:</p>
<p>I know the PR is about another shell, just bringing this up as a concern that could need to be addressed in general in the design.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-12 16:56</div>
            <div class="timeline-body"><p>The concern about filename that I had for bash, probably applies in a similar way to fish:</p>
<blockquote>
<p>A completion file must have a filename consisting of the name of the command to complete and the suffix .fish.</p>
</blockquote>
<p>https://fishshell.com/docs/current/completions.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilyagr">@ilyagr</a> on 2024-09-12 20:46</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>A completion file must have a filename consisting of the name of the command to complete and the suffix .fish.</p>
</blockquote>
<p>https://fishshell.com/docs/current/completions.html</p>
</blockquote>
<p>I think this applies if you want to ship the completions together with the fish shell. I don't think it matters if you follow <a href="https://docs.astral.sh/uv/getting-started/installation/#shell-autocompletion">the instructions</a> and do</p>
<pre><code>echo 'eval &quot;$(uv generate-shell-completion bash)&quot;' &gt;&gt; ~/.bashrc
echo 'uv generate-shell-completion fish | source' &gt;&gt; ~/.config/fish/config.fish
</code></pre>
<p>I think my statement applies to <code>bash</code> as well, <code>eval &quot;$(uv generate-shell-completion bash)&quot;</code> looks like it will initialize the completion eagerly and that there is no file to call <code>uv.bash</code>. However, I'm less familiar with bash, so I might be missing something.</p>
<hr />
<p>One situation where your concerns might be much more relevant is for people who package <code>uv</code> for various distributions (Arch, Debian, Chocolatey,...). They might include the shell completions in files as opposed to running <code>uv generation-shell-completion</code> every time, and they would probably want to follow guidelines closer to what you describe. So, perhaps more should be done to support them at some point, e.g. <code>uv generate-shell-completion --uv-only</code> and <code>uv generate-shell-completion --uvx-only</code>. Or we could wait for such people to show up and request something, I'm just guessing what they might need.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-12 21:37</div>
            <div class="timeline-body"><p>I didn't know the docs had those instructions, I can see how it makes it work.</p>
<p>I prefer to use bash completions this way and would recommend it to others:</p>
<pre><code class="language-bash">BASH_COMPLETION_DIR=&quot;$HOME/.local/share/bash-completion/completions&quot;
mkdir -p &quot;$BASH_COMPLETION_DIR&quot;
uv generate-shell-completion bash &gt; &quot;$BASH_COMPLETION_DIR&quot;/uv
</code></pre>
<p>It sets up lazy loading correctly. If every tool wanted to be called every time you open a shell (to generate completions), it would take a long time, it's not sustainable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilyagr">@ilyagr</a> on 2024-09-12 22:39</div>
            <div class="timeline-body"><blockquote>
<p>If every tool wanted to be called every time you open a shell (to generate completions), it would take a long time, it's not sustainable.</p>
</blockquote>
<p>I would have thought so, but my understanding is that <code>fish</code> seems to load all the completions eagerly, and seems to work fine and open quickly. It's magic. I'm guessing that <code>bash</code> is just as fast. <strong>Update:</strong> Or maybe not, judging by bluss's comment below, which is a quote from https://fishshell.com/docs/current/completions.html.</p>
<p>If somebody has a better understanding, let me know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-13 17:24</div>
            <div class="timeline-body"><p>This makes it sound like lazy loading, not eager, &quot;<em>and any completions defined are automatically loaded when needed.</em>&quot;</p>
<p>Now that we know about bash's symlinks, assuming that works for fish too, maybe it's just fine to combine both completion scripts in the same output? It will work with uv's instructions. And the more detailed setups with a file per command can use a symlink from uvx.fish -&gt; uv.fish and so on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-14 09:30</div>
            <div class="timeline-body"><p>There is a proof of concept solution here https://github.com/astral-sh/uv/pull/7388 but it has some small technical complications</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilyagr">@ilyagr</a> on 2024-09-16 01:38</div>
            <div class="timeline-body"><p>I like the approach of #7388, since it will work for all shells. I haven't thought about the questions you asked in that PR much. I'm happy to close this PR in favor of #7388 if that PR has a promising future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilyagr">@ilyagr</a> on 2024-09-16 19:55</div>
            <div class="timeline-body"><p>I'm closing this in favor of #7388.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ilyagr on 2024-09-16 19:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:01:30 UTC
    </footer>
</body>
</html>
