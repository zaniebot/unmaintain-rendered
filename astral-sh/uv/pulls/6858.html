<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ci(windows): Introduce setup-dev-drive.ps1, maximize dev drive usage - astral-sh/uv #6858</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ci(windows): Introduce setup-dev-drive.ps1, maximize dev drive usage</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6858">#6858</a>
        opened by <a href="https://github.com/fasterthanlime">@fasterthanlime</a>
        on 2024-08-30 10:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/fasterthanlime">@fasterthanlime</a> on 2024-08-30 10:05</div>
            <div class="timeline-body"><p>As suggested by @samypr100 on #6680:
https://github.com/astral-sh/uv/pull/6680#issuecomment-2313607984</p>
<h2>Summary</h2>
<p>Instead of using <code>UV_INTERNAL__TEST_DIR</code>, it simply exports <code>TEMP</code> when running Windows jobs.</p>
<h2>Test Plan</h2>
<p>I'm going to run this manually under ProcMon on my Windows machine and see where uv writes temp files, hopefully to the dev drive and not <code>%(LOCAL)APPDATA%</code> or something.</p>
<p>I'm going to commit a dummy code change and look at build time changes in CI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fasterthanlime">@fasterthanlime</a> on 2024-08-30 10:55</div>
            <div class="timeline-body"><p>So: in <code>uv/tests/common</code>, there's a bit of code that makes a directory under the <em>data</em> dir. There's a rationale for macOS.</p>
<p>We need to keep exporting the internal var for Windows, I'm afraid, but I think setting <code>TEMP</code> there is also a good idea (for other tools), and I've deduplicated the dev-drive setup into its own PowerShell script. Let's see if it still works.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ci(windows): Simply use the TEMP dir" to "ci(windows): Introduce setup-dev-drive.ps1, maximize dev drive usage" by @fasterthanlime on 2024-08-30 11:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-30 12:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/setup-dev-drive.ps1</code>:1 on 2024-08-30 12:13</div>
            <div class="timeline-body"><p>Arguably could belong in <code>scripts/</code> but I don't feel strongly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-30 12:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/setup-dev-drive.ps1</code>:1 on 2024-08-30 12:14</div>
            <div class="timeline-body"><p>(I guess this relies on <code>GITHUB_ENV</code> so nevermind)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-08-30 12:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @zanieb on 2024-08-30 12:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-30 12:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>.github/workflows/setup-dev-drive.ps1</code>:1 on 2024-08-30 12:27</div>
            <div class="timeline-body"><p>If there's any interest, I also maintain a separate https://github.com/samypr100/setup-dev-drive which could help achieve the same here if we want to cleanup and have more control on the settings per job</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-08-30 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-30 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-30 13:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>.github/workflows/setup-dev-drive.ps1</code>:19 on 2024-08-30 13:08</div>
            <div class="timeline-body"><p>Was <code>UV_INTERNAL__TEST_DIR</code> going to be removed as part of this PR? Maybe a testing remnant</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/setup-dev-drive.ps1</code>:19 on 2024-08-30 13:10</div>
            <div class="timeline-body"><p>I think this is addressed in https://github.com/astral-sh/uv/pull/6858#issuecomment-2320839792</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-30 13:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-30 13:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>.github/workflows/setup-dev-drive.ps1</code>:19 on 2024-08-30 13:11</div>
            <div class="timeline-body"><p>I see, thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fasterthanlime">@fasterthanlime</a> reviewed on 2024-08-30 14:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/fasterthanlime">@fasterthanlime</a> on <code>.github/workflows/setup-dev-drive.ps1</code>:19 on 2024-08-30 14:18</div>
            <div class="timeline-body"><p>it can't be (woops, zanieb got to this first)</p>
<p>https://github.com/astral-sh/uv/pull/6858#issuecomment-2320839792</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:01:17 UTC
    </footer>
</body>
</html>
