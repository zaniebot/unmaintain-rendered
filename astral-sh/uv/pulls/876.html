<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement `--find-links` as flat indexes (pip-compile) - astral-sh/uv #876</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement <code>--find-links</code> as flat indexes (pip-compile)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/876">#876</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-01-10 21:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Add directory <code>--find-links</code> support for local paths to pip-compile.</p>
<p>It seems that pip joins all sources and then picks the best package. We explicitly give find links packages precedence if the same exists on an index and locally by prefilling the <code>VersionMap</code>, otherwise they are added as another index and the existing rules of precedence apply.</p>
<p>Internally, the feature is called <em>flat index</em>, which is more meaningful than <em>find links</em>: We&#x27;re not looking for links, we&#x27;re picking up local directories, and (TBD) support another index format that&#x27;s just a flat list of files instead of a nested index. I&#x27;ve kept the flat index terminology in the user facing parts for pip compatibility.</p>
<p>Previously, a <code>RegistryBuiltDist</code>/<code>RegistrySourceDist</code> would be formatted as <code>&lt;name&gt;==&lt;version&gt;</code> while path and url dists would be formatted as <code>&lt;name&gt; @ &lt;url&gt;</code>. Now there are flat index path and url dists that behave as additions to the index and should be formatted by version instead of by url. Instead of adding more <code>Dist</code> types, i chose to track their designation as <code>is_registry</code>. An alternative would be adding an <code>is_registry</code> field to path and url dists.</p>
<p><code>PrioritizedDistribution</code> and <code>FlatIndex</code> have been moved to locations where we can use them in the upstack PR.</p>
<p>I added a <code>scripts/wheels</code> directory with stripped down wheels to use for testing.</p>
<p>We&#x27;re lacking tests for correct tag priority precedence with flat indexes, i only confirmed this manually since it is not covered in the pip-compile or pip-sync output.</p>
<p>Part 1/3 (directory find links in pip-compile, find links in pip-sync, remote find links).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/konstin">@konstin</a> on 2024-01-11 10:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/distribution-types/src/lib.rs</code>:74 on 2024-01-11 14:13</div>
            <div class="timeline-body"><p>Nit: we don&#x27;t export any other modules in the crate this way. Mind changing to match the convention?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/distribution-types/src/index_url.rs</code>:56 on 2024-01-11 14:14</div>
            <div class="timeline-body"><p>Nit: <code>URL</code>, <code>HTML</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/distribution-types/src/index_url.rs</code>:70 on 2024-01-11 14:15</div>
            <div class="timeline-body"><p>This seems off. Should we not try to parse the file, and fall back to path? Or parse the file, check the scheme, then fall back to path?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-cli/src/main.rs</code>:162 on 2024-01-11 14:16</div>
            <div class="timeline-body"><p>Nit: two spaces after &quot;distributions&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/flat_index.rs</code>:19 on 2024-01-11 18:02</div>
            <div class="timeline-body"><p>I&#x27;d err on the side of removing this -- IMO it&#x27;s better as a comment on the PR than as a comment in-code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/flat_index.rs</code>:45 on 2024-01-11 18:02</div>
            <div class="timeline-body"><p>This is stale, no? Per requires-python above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/flat_index.rs</code>:49 on 2024-01-11 18:03</div>
            <div class="timeline-body"><p>This seems like an error that we need to propagate, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/registry_client.rs</code>:117 on 2024-01-11 18:04</div>
            <div class="timeline-body"><p>Nit: I&#x27;d remove <code>// It doesn&#x27;t feel like it matter for this one time call</code>, again it feels like a comment for reviewers that you could leave in the PR, not something that should live in code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/registry_client.rs</code>:128 on 2024-01-11 18:04</div>
            <div class="timeline-body"><p>Should this be an actual <code>todo!</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/registry_client.rs</code>:132 on 2024-01-11 18:04</div>
            <div class="timeline-body"><p>You could probably write this whole thing as a single iterator.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/registry_client.rs</code>:137 on 2024-01-11 18:06</div>
            <div class="timeline-body"><p>Nit: absolut</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/registry_client.rs</code>:134 on 2024-01-11 18:07</div>
            <div class="timeline-body"><p>Would it be simpler for this to just return <code>Vec</code> and do the concat outside? That would also avoid <code>dir_dists = 0</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/flat_index.rs</code>:29 on 2024-01-11 18:10</div>
            <div class="timeline-body"><p>Maybe <code>from_dists</code>? I think it&#x27;s confusing to have <code>FlatIndex::from_flat_index</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolution.rs</code>:38 on 2024-01-11 18:12</div>
            <div class="timeline-body"><p>I don&#x27;t think I understand this part. Can you walk me through what happens if we omit this entirely?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:705 on 2024-01-11 18:13</div>
            <div class="timeline-body"><p>I don&#x27;t fully understand this part and it feels like something we need a better abstraction around. We call <code>package_id()</code> in a lot of places -- is this even safe?</p>
<p>Can you walk me through the problem here in more detail? If this is a file from a <code>--find-links</code>, what would go wrong?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/registry_client.rs</code>:118 on 2024-01-11 18:14</div>
            <div class="timeline-body"><p>I&#x27;m a bit mixed on whether this belongs in <code>RegistryClient</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-11 18:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:705 on 2024-01-11 18:15</div>
            <div class="timeline-body"><blockquote>
<p>Now there are flat index path and url dists that behave as additions to the index and should be formatted by version instead of by url. Instead of adding more Dist types, i chose to track their designation as is_registry. An alternative would be adding an is_registry field to path and url dists.</p>
</blockquote>
<p>Clarifying: should <code>--find-links</code> versions <em>not</em> be represented as URLs? Is it wrong to do so?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-11 18:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/distribution-types/src/index_url.rs</code>:70 on 2024-01-12 10:23</div>
            <div class="timeline-body"><p>The cases we need to support are</p>
<pre><code>--find-links https://packages.example.com/path/to/flat-index.html
--find-links path/to/local/flat-index
--find-links file:///absolute/path/to/local/flat-index
</code></pre>
<p>I don&#x27;t really expect <code>file://</code> indexes to be use, but it would be strange to not support them here. First checking the <code>://</code> is to avoid that an invalid url accidentally falls back to a path and then gives confusing error messages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/flat_index.rs</code>:49 on 2024-01-12 10:28</div>
            <div class="timeline-body"><p>We know that <code>read_flat_index_dir</code> only returns absolute paths (we call <code>fs_err::canonicalize(path)</code> in the beginning), so we know that this call succeeds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/registry_client.rs</code>:128 on 2024-01-12 10:29</div>
            <div class="timeline-body"><p>I had it like that in the beginning, but if we merge this PR before the html find links support PR i didn&#x27;t want to have something that panics on main (and then explodes tokio&#x27;s executor).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/registry_client.rs</code>:132 on 2024-01-12 10:40</div>
            <div class="timeline-body"><p>The problem is that we need to flat map (<code>read_flat_index_dir</code> returns a list of entries and should warn when it yielded 0 items) while also raising any error; I unfortunately wouldn&#x27;t know any iterator to express this in a readable way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/registry_client.rs</code>:137 on 2024-01-12 10:42</div>
            <div class="timeline-body"><p><img src="https://github.com/astral-sh/puffin/assets/6826232/e02f94d9-17a7-4205-a093-f23f4921303a" alt="image"></p>
<p>It took me unreasonably long to see the problem</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/registry_client.rs</code>:134 on 2024-01-12 10:43</div>
            <div class="timeline-body"><p>If we don&#x27;t mind the allocations, sure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/flat_index.rs</code>:29 on 2024-01-12 10:43</div>
            <div class="timeline-body"><p>Definitely, the name should have changed with the refactoring</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:705 on 2024-01-12 10:58</div>
            <div class="timeline-body"><p>From looking at what pip and pip-tools do, i consider <code>--find-links</code> as an <code>--extra-index-url</code> with a different format, a flat index instead of a nested index. I consider <code>--index-url</code>, <code>--extra-index-url</code> and <code>--find-inks</code> together making up the search path, as opposed to saying e.g. i want the source dist at a specific url or at this location in the project.</p>
<p>If we run <code>jax[cuda12_pip]</code> through <code>pip-compile -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html jax.in</code>, we get:</p>
<pre><code>[...prelude...]
--find-links https://storage.googleapis.com/jax-releases/jax_cuda_releases.html

jax[cuda12-pip,cuda12_pip]==0.4.23
    # via -r target/jax.in
jaxlib==0.4.23+cuda12.cudnn89
    # via jax
[...more deps...]
</code></pre>
<p>The alternative would would be something like below, where we pin a specific wheel: This would pin the resolution to a specific platform, while the <code>pip-compile</code> output is platform independent, and in this case even works across python versions.</p>
<pre><code>[...prelude...]
jax[cuda12-pip,cuda12_pip]==0.4.23
    # via -r target/jax.in
jaxlib @ https://storage.googleapis.com/jax-releases/cuda12/jaxlib-0.4.23+cuda12.cudnn89-cp312-cp312-manylinux2014_x86_64.whl
    # via jax
[...more deps...]
</code></pre>
<p>The architectural problem is that the find links entries don&#x27;t have a <code>File</code> (we can&#x27;t really match paths on a <code>File</code>, no hashes and no url, and handling path find links different to url find links would be also inconsistent), so we can&#x27;t build a <code>RegistryBuiltDist</code>/<code>RegistrySourceDist</code> out of them. I chose the less invasive route by just tracking the registry-ness outside of the <code>Dist</code> hierarchy. The alternatives would be migrating <code>Registry*Dist</code> away from <code>File</code> to a new type that also support find links, or adding a field to <code>DirectUrl*Dist</code> and <code>Path*Dist</code> that tracks their registry-ness.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-12 10:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/registry_client.rs</code>:118 on 2024-01-12 10:58</div>
            <div class="timeline-body"><p>Same, where&#x27;d you move it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/registry_client.rs</code>:137 on 2024-01-12 14:42</div>
            <div class="timeline-body"><p>Hahaha I&#x27;m sorry!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 14:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 14:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:705 on 2024-01-12 14:44</div>
            <div class="timeline-body"><p>Okay, I need to spend a bit more time reading this code today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:718 on 2024-01-12 19:00</div>
            <div class="timeline-body"><p>Why is this not respected here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:711 on 2024-01-12 19:06</div>
            <div class="timeline-body"><p>So is the <em>specific</em> problem here that <code>Candidate</code> assumes it only gets registry dists? Because it returns <code>distribution_types::VersionOrUrl::Version(self.version.into())</code>? (Can we change <em>that</em> somehow to avoid this? It doesn&#x27;t seem <em>required</em> that we use a <code>{name}-{version}</code> representation for <code>--find-links</code> distributions here, only that it&#x27;s <em>assumed</em> in other parts of the code.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolution.rs</code>:205 on 2024-01-12 19:08</div>
            <div class="timeline-body"><p>Can we just remove this instead, and <code>dist_to_requirement</code>? It&#x27;s only used in the <code>resolve-cli</code> in dev.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolution.rs</code>:38 on 2024-01-12 19:08</div>
            <div class="timeline-body"><p>I can maybe live with this part though I find it clear evidence that we&#x27;re missing an abstraction :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolution.rs</code>:271 on 2024-01-12 19:09</div>
            <div class="timeline-body"><p>Is this actually true for source distributions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/flat_index.rs</code>:32 on 2024-01-12 19:11</div>
            <div class="timeline-body"><p>I think I misread this originally, but the fact that this doesn&#x27;t return <code>Self</code> feels really confusing from an API design perspective. I think you should consider adding a separate struct that wraps <code>FxHashMap&lt;PackageName, FlatIndex&gt;</code>, and putting this method on that separate struct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:711 on 2024-01-12 19:11</div>
            <div class="timeline-body"><p>I think we need to fix this before merging and find some other solution. I can barely understand it <em>now</em>, so there&#x27;s just no way I&#x27;ll be able to follow in the future. (This isn&#x27;t your fault, it&#x27;s confusing, I&#x27;m just articulating that we should try to address this.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-12 19:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:718 on 2024-01-12 19:12</div>
            <div class="timeline-body"><p>Can&#x27;t we have a source distribution from a <code>--find-links</code> here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-13 01:54</div>
            <div class="timeline-body"><p>My worst nightmare, I worked through all the merge conflicts here but now tests are just hanging...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-13 01:59</div>
            <div class="timeline-body"><p>@konstin - Did you a solid and fixed some rough merge conflicts here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-13 02:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:711 on 2024-01-13 02:07</div>
            <div class="timeline-body"><p>Okay, seeing the problem better now. In <code>get_dependencies</code>, we use <code>PubGrubDistribution::from_registry</code>, so we <em>always</em> get the registry ID.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-13 02:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:711 on 2024-01-13 02:18</div>
            <div class="timeline-body"><p>So it&#x27;s like: there&#x27;s a coupling (right now) between the way the dependency is declared (URL vs. version specifier) and the distribution type to which it resolves (URL is assumed to resolve to a URL, version specifier is assumed to resolve to a registry distribution). And now, we&#x27;re returning a URL-based distribution for a version specifier...</p>
<p>Can this be solved by improving the distribution type hierarchy?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-13 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver/mod.rs</code>:711 on 2024-01-13 14:32</div>
            <div class="timeline-body"><p>I think we may want to consider adding a layer of indirection in the resolver between (requirement / <code>PubGrubPackage</code>) and distribution, but I need to try it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-15 02:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-15 09:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:43:09 UTC
    </footer>
</body>
</html>
