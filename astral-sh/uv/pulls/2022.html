<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>add tests for versions with local segments - astral-sh/uv #2022</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>add tests for versions with local segments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/2022">#2022</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-02-27 17:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-27 17:36</div>
            <div class="timeline-body"><p>While trying to fix #1855, I came up with a few tests that improve
our coverage of versions with local segments. Those tests were added
to packse here: https://github.com/zanieb/packse/pull/132</p>
<p>None of these tests pass yet, so they are marked as ignored.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-27 22:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-28 02:33</div>
            <div class="timeline-body"><p>Note we should merge in packse first so they publish to PyPI and are discovered by tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-28 14:01</div>
            <div class="timeline-body"><p>All righty, so I've got the packse repo updated with tests for local versions, but (and I should have anticipated this), <a href="https://github.com/zanieb/packse/actions/runs/8081475053/job/22080133217">publishing to <code>test.pypi.org</code> fails</a> because of the local segments in the version numbers. They aren't allowed to be published. This present an interesting conundrum, because the ban isn't reflective of the reality that other indexes (such as pytorch) <em>do</em> allow local versions to be published.</p>
<p>I'm not quite sure how to fix this, and I also don't know the implications of merging this PR when publishing to <code>test.pypi.org</code> fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-28 17:36</div>
            <div class="timeline-body"><p>@BurntSushi I can definitely look into this when I'm back, I'm interested in getting us using a local PyPI mirror for tests which would allow us to do things like this.</p>
<p>In the meantime.. if you merge with broken PyPI uploads we'll spam PyPI retrying the upload every few hours. You could exclude these scenarios from the PyPI uploads somehow then rely on our public CodeArtifact proxy to test the scenarios in CI. I'm not sure if it's worth the effort though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-13 15:13</div>
            <div class="timeline-body"><p>Should this be closed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-13 15:14</div>
            <div class="timeline-body"><p>Yep!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-03-13 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-13 15:14</div>
            <div class="timeline-body"><p>Sweet. (For posterity, these got merged into main separately.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-13 15:14</div>
            <div class="timeline-body"><p>Done in https://github.com/astral-sh/uv/pull/2256</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:49:26 UTC
    </footer>
</body>
</html>
