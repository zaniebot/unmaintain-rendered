<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[WIP] Add a `--suffix` option to `uv tool install` - astral-sh/uv #7095</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[WIP] Add a <code>--suffix</code> option to <code>uv tool install</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/7095">#7095</a>
        opened by <a href="https://github.com/teofr">@teofr</a>
        on 2024-09-05 18:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/teofr">@teofr</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Ongoing attempt to close #6365</p>
<p>So far:</p>
<ul>
<li>Added the CLI argument and general setting</li>
<li>Modified the tools enviroments and receipts to work with a suffix<ul>
<li>Right now the design stores tools in the directory <code>{name}{suffix}</code></li>
</ul>
</li>
<li>Made the <code>uv tool install</code> command thread and process suffixes</li>
</ul>
<p>TODO:</p>
<ul>
<li>Add support for <code>upgrade</code>, <code>uninstall</code></li>
<li>Normalize suffixes (right now they're taken verbatim and not according the rules specified in the RFC #3560)</li>
<li>Modify the representation of <code>ToolName</code> after discussions</li>
<li>Improve testing<ul>
<li>Colliding tools (Packagea <code>A</code> and <code>A_B</code> can collide if <code>A</code> is installed with suffix <code>_B</code>)</li>
<li>Preliminary discussions point towards requiring uniqueness of <code>{package name}{suffix}</code> as an id, we need to test that</li>
</ul>
</li>
</ul>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<p>For now, tests that the same package can be installed with different suffixes</p>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/lib.rs</code>:66 on 2024-09-05 19:01</div>
            <div class="timeline-body"><p>This may be a problematic structure for <code>uv tool upgrade</code> etc., e.g., if the user specifies a tool name via the command line we won't know what's the package name and what's a suffix until sometime later?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-05 19:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-05 19:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/lib.rs</code>:195 on 2024-09-05 19:03</div>
            <div class="timeline-body"><p>We'll generally probably want to see the both the name and suffix that we're performing operations on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-05 19:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/lib.rs</code>:195 on 2024-09-05 19:04</div>
            <div class="timeline-body"><p>I'm a bit curious why you did this instead of implementing <code>Display</code> for <code>ToolName</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-05 19:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/tool/common.rs</code>:115 on 2024-09-05 19:05</div>
            <div class="timeline-body"><p>Does this handle file extensions on Windows?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-05 19:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:249 on 2024-09-05 19:07</div>
            <div class="timeline-body"><p>Do we need to write the tool package name somewhere now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/teofr">@teofr</a> reviewed on 2024-09-05 19:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/teofr">@teofr</a> on <code>crates/uv-tool/src/lib.rs</code>:66 on 2024-09-05 19:10</div>
            <div class="timeline-body"><p>Agree, thanks for pointing it out</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/teofr">@teofr</a> reviewed on 2024-09-05 19:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/teofr">@teofr</a> on <code>crates/uv-tool/src/lib.rs</code>:195 on 2024-09-05 19:12</div>
            <div class="timeline-body"><p>Yes, didn't change to showing the whole tool name to simplify for now.
Of course, I complicated myself by not implementing Display, I blame my late little use of Rust, will change to that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/teofr">@teofr</a> reviewed on 2024-09-05 19:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/teofr">@teofr</a> on <code>crates/uv/tests/tool_install.rs</code>:249 on 2024-09-05 19:18</div>
            <div class="timeline-body"><p>That's a good question, I think it depends a bit on what's the point of the receipt</p>
<p>If the goal is to differentiate package installations, I think not, since a package should behave exactly the same if it was installed with a given suffix or not. (ie, could we want to have a cache of package installations? if so, are the receipts the keys of the cache?)</p>
<p>However, if the receipt is just general information used by <code>uv</code> then yes, specially since upgrading a package may add entry points, and we may need to use the suffix there.</p>
<p>I lean towards adding it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/teofr">@teofr</a> reviewed on 2024-09-05 19:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/teofr">@teofr</a> on <code>crates/uv/src/commands/tool/common.rs</code>:115 on 2024-09-05 19:37</div>
            <div class="timeline-body"><p>Added the suffix between the stem and the extension, thanks for noticing</p>
<p>More thought and testing is needed for this bit (as in, what happens with tools that have a <code>.</code> in their name)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/teofr">@teofr</a> on <code>crates/uv-tool/src/lib.rs</code>:195 on 2024-09-05 19:39</div>
            <div class="timeline-body"><p>I added a TODO for changing how ToolNames are displayed, since it needs discussion</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/teofr">@teofr</a> reviewed on 2024-09-05 19:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:249 on 2024-09-05 19:43</div>
            <div class="timeline-body"><p>Yeah, I presumed we would need the package name during future operations, e.g. during <code>uv tool upgrade</code> to retrieve the entry points for the package as you mentioned.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-05 19:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-09-15 23:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-22 19:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:39:26 UTC
    </footer>
</body>
</html>
