<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix best-interpreter lookups when there is an invalid interpreter in the PATH - astral-sh/uv #11030</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix best-interpreter lookups when there is an invalid interpreter in the PATH</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11030">#11030</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-01-28 18:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Closes https://github.com/astral-sh/uv/issues/10978</p>
<p>The root cause is the same as #10908 â€” I should have been more careful with the original change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-01-28 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Gankra by @zanieb on 2025-01-28 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2025-01-28 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-01-28 19:38</div>
            <div class="timeline-body"><p>What's the nested Result? What do the two levels indicate?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-28 19:43</div>
            <div class="timeline-body"><p>This was a design decision in Python discovery a while back (which I'm sort of regretting as it was the source of this bug)</p>
<p>The outer error is if we <em>fail</em> during discovery for some reason.
The inner error is we don't find a Python interpreter.</p>
<p>https://github.com/astral-sh/uv/blob/db4ab9dc8aecd9c4deaffd6036304aae70d93791/crates/uv-python/src/discovery.rs#L166-L179</p>
<p>The bug is that I changed things so a deferred discovery failure is sometimes raised instead of the inner error to improve error messages when there's an invalid interpreter on the path. However, this broke some downstream code where we take actions after failing to find an interpreter and counted the function to only return <em>fatal</em> outer errors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-28 19:44</div>
            <div class="timeline-body"><p>I was worried about breakage here when I made the change, but foolishly trusted the test coverage (which it seems didn't exist for the case of a broken interpreter)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-01-28 19:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-28 19:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-28 19:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:41:44 UTC
    </footer>
</body>
</html>
