<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enable uploads via pre-signed URLs - astral-sh/uv #17349</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enable uploads via pre-signed URLs</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/17349">#17349</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2026-01-07 18:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-07 18:24</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>For pyx, we can allow uploads that bypass the registry and send the file directly to S3. This is an opt-in feature, enabled via the <code>--direct</code> flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2026-01-07 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:7596 on 2026-01-07 18:26</div>
            <div class="timeline-body"><p>The latter part of this seems wrong.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2026-01-07 18:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-07 18:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:7596 on 2026-01-07 18:28</div>
            <div class="timeline-body"><p>How so?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-07 18:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:7596 on 2026-01-07 18:28</div>
            <div class="timeline-body"><p>Like it's not <em>required</em>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2026-01-07 19:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:7596 on 2026-01-07 19:08</div>
            <div class="timeline-body"><p>Yeah, it's not required</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2026-01-07 19:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-publish/src/lib.rs</code>:774 on 2026-01-07 19:17</div>
            <div class="timeline-body"><p>Since this is a streaming request, does it need to have an outer retry wrapper?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2026-01-07 19:19</div>
            <div class="timeline-body"><p>This looks reasonable though @woodruffw or @konstin should be final reviewers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2026-01-08 12:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/publish.rs</code>:253 on 2026-01-08 12:48</div>
            <div class="timeline-body"><p>nit: we should rename this client</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-publish/src/lib.rs</code>:774 on 2026-01-08 12:50</div>
            <div class="timeline-body"><p>That's the client with the regular settings wrt to retries and timeouts, and with no auth middleware</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-publish/src/lib.rs</code>:740 on 2026-01-08 12:53</div>
            <div class="timeline-body"><p>Is that URL confidential, should we redact it in logs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-publish/src/lib.rs</code>:761 on 2026-01-08 12:55</div>
            <div class="timeline-body"><p>We need a retry loop here, streaming uploads can't be retried otherwise</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-publish/src/lib.rs</code>:697 on 2026-01-08 12:56</div>
            <div class="timeline-body"><p>That's the client without retries, I think that should be the regular client, plus/minus auth settings?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2026-01-08 12:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv-cli/src/lib.rs</code>:7595 on 2026-01-08 15:16</div>
            <div class="timeline-body"><p>Seems reasonable to me, although noting that we could in principle do this without a flag by having uv send an <code>Accept: ...</code> header that indicates support, to which pyx would then respond with the pre-signed URL.</p>
<p>(That might be nice for enabling this implicit/by default in the future, but seems like not worth doing initially!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv-publish/src/lib.rs</code>:712 on 2026-01-08 15:18</div>
            <div class="timeline-body"><p>Q, minor: should we use HTTP 409 (Conflict) for this, given that we're not tied to PyPI's response code semantics for our own upload scheme?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> approved on 2026-01-08 15:22</div>
            <div class="timeline-body"><p>LGTM, one note and one comment but neither is blocking IMO. I'll follow up with some comments on the pyx side too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-08 15:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-publish/src/lib.rs</code>:712 on 2026-01-08 15:26</div>
            <div class="timeline-body"><p>Would 409 be for the case in which it already exists and isn't the same file? Or already exists and <em>is</em> the same file? Here I'm using 200 for &quot;already exists and is the same&quot; (and 201 for &quot;created, now proceed to upload&quot;).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2026-01-08 15:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv-publish/src/lib.rs</code>:712 on 2026-01-08 15:38</div>
            <div class="timeline-body"><p>Oh, good point. 409 would be for &quot;exists but with different content&quot; I believe, 200 is semantically correct for &quot;exists with the same content already.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2026-01-08 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2026-01-08 18:03</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<h3>Merging this PR will <strong>not alter performance</strong></h3>
<h3>Summary</h3>
<p><code>âœ… 5</code> untouched benchmarks</p>
<hr />
<p><sub>Comparing <code>charlie/direct-s3</code> (fa48051) with <code>main</code> (25d691e)</sub></p>
<a href="https://codspeed.io/astral-sh/uv/branches/charlie%2Fdirect-s3?utm_source=github&utm_medium=comment-v2&utm_content=button">
  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="https://codspeed.io/pr-report/open-in-codspeed-dark.svg">
    <source media="(prefers-color-scheme: light)" srcset="https://codspeed.io/pr-report/open-in-codspeed-light.svg">
    <img alt="Open in CodSpeed" src="https://codspeed.io/pr-report/open-in-codspeed-light.svg" width="169" height="32">
  </picture>
</a>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2026-01-09 02:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2026-01-09 02:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-09 02:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2026-01-09 11:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/publish.rs</code>:146 on 2026-01-09 11:13</div>
            <div class="timeline-body"><p>For the OIDC client, we need retries (GitHub's networking is too unreliable) and ideally the default timeouts, the S3 is separate in that it uses its own retry loop, upload timeouts and no auth middleware.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-09 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/publish.rs</code>:146 on 2026-01-09 14:32</div>
            <div class="timeline-body"><p>Fixing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2026-01-09 14:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/publish.rs</code>:146 on 2026-01-09 14:39</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/pull/17379</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:43:37 UTC
    </footer>
</body>
</html>
