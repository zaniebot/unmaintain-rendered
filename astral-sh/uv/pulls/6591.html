<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for `--trusted-host` - astral-sh/uv #6591</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for <code>--trusted-host</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6591">#6591</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-08-24 21:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-24 21:51</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR revives https://github.com/astral-sh/uv/pull/4944, which I think was a good start towards adding <code>--trusted-host</code>. Last night, I tried to add <code>--trusted-host</code> with a custom verifier, but we had to vendor a lot of <code>reqwest</code> code and I eventually hit some private APIs. I'm not confident that I can implement it correctly with that mechanism, and since this is security, correctness is the priority.</p>
<p>So, instead, we now use two clients and multiplex between them.</p>
<p>Closes https://github.com/astral-sh/uv/issues/1339.</p>
<h2>Test Plan</h2>
<p>Created self-signed certificate, and ran <code>python3 -m http.server --bind 127.0.0.1 4443 --directory . --certfile cert.pem --keyfile key.pem</code> from the packse index directory.</p>
<p>Verified that <code>cargo run pip install transitive-yanked-and-unyanked-dependency-a-0abad3b6 --index-url https://127.0.0.1:8443/simple-html</code> failed with:</p>
<pre><code>error: Request failed after 3 retries
  Caused by: error sending request for url (https://127.0.0.1:8443/simple-html/transitive-yanked-and-unyanked-dependency-a-0abad3b6/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: Other(OtherError(CaUsedAsEndEntity))
</code></pre>
<p>Verified that <code>cargo run pip install transitive-yanked-and-unyanked-dependency-a-0abad3b6 --index-url 'https://127.0.0.1:8443/simple-html' --trusted-host '127.0.0.1:8443'</code> failed with the expected error (invalid resolution) and made valid requests.</p>
<p>Verified that <code>cargo run pip install transitive-yanked-and-unyanked-dependency-a-0abad3b6 --index-url 'https://127.0.0.1:8443/simple-html' --trusted-host '127.0.0.2' -n</code> also failed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-08-24 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-08-24 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">security</span> added by @charliermarsh on 2024-08-24 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-24 22:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-settings/src/settings.rs</code>:219 on 2024-08-24 22:45</div>
            <div class="timeline-body"><p>Ahh URL is wrong -- it's just a host or host:port pair.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-08-24 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-24 23:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-client/src/base_client.rs</code>:292 on 2024-08-24 23:16</div>
            <div class="timeline-body"><p>The only way to access this client is via <code>for_host</code>. It's not exposed anywhere else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-24 23:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-24 23:22</div>
            <div class="timeline-body"><p>Would it be reasonable to also warn the user once on the usage of this option / mitm implications? (e.g. mostly making sense on trusted private registries/mirrors or self-signed corporate pypi proxies)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blu3r4d0n">@blu3r4d0n</a> reviewed on 2024-08-24 23:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/blu3r4d0n">@blu3r4d0n</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-24 23:43</div>
            <div class="timeline-body"><p>I think that makes sense. Although since it's opt-in maybe they would already be aware?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-24 23:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-24 23:48</div>
            <div class="timeline-body"><p>As in, show a warning on the CLI?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blu3r4d0n">@blu3r4d0n</a> reviewed on 2024-08-24 23:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/blu3r4d0n">@blu3r4d0n</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-24 23:59</div>
            <div class="timeline-body"><p>I think that's what Sammy means. Iirc, pip doesn't show a warning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 00:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 00:00</div>
            <div class="timeline-body"><p>Indeed, I was thinking CLI warning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 00:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 00:12</div>
            <div class="timeline-body"><p><code>pip</code> doesnt show a warning neither should <code>uv</code>, it's an opt-in option. It's the same as doing <code>curl -k https://fakehost.com</code>, which doesnt have a warning.</p>
<p>uv should show an error if the user tries to install from a non-trusted source without using &quot;--trusted-hosts&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 00:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 00:12</div>
            <div class="timeline-body"><p>Here's an initial stab at it</p>
<pre><code>Only use `--trusted-host` in a secure network with verified sources, as it bypasses SSL verification and could expose you to MITM attacks.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blu3r4d0n">@blu3r4d0n</a> reviewed on 2024-08-25 00:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/blu3r4d0n">@blu3r4d0n</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 00:13</div>
            <div class="timeline-body"><p>I think gaby is right here. Follow pip's approach. Could add a line in docs indicating pitfalls.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 00:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 00:20</div>
            <div class="timeline-body"><p>You often have cases like this https://github.com/astral-sh/uv/issues/1339#issuecomment-2232619423 where using the appropriate <code>UV_NATIVE_TLS</code> or <code>SSL_CERT_FILE</code> could've sufficed instead of a more dangerous option like <code>--trusted-host</code>.  This SO's warning also speaks for itself https://stackoverflow.com/a/29751768 as to the dangers of blindly using this option and the effect it can have if used inappropriately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> reviewed on 2024-08-25 00:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 00:23</div>
            <div class="timeline-body"><p>(lurker here) I would prefer the documentation for this command line option to have the warning but not on the actual usage. Rationale: the command is called &quot;trusted-host&quot; as in I trust this thing whatever it may be. This option is also likely to live in the uv.toml or pyproject.toml or env variables. Meaning every single call to uv will have a warning</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-25 00:24</div>
            <div class="timeline-body"><p>Also might be helpful for #5726</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaby">@gaby</a> on 2024-08-25 00:30</div>
            <div class="timeline-body"><p>What happens if <code>--trusted-host</code> is supplied multiple times, is that taken into account? Or do the later override the first one?</p>
<p>Edit: I see the code allows a list, which if it's like <code>pip</code> it would be space-separated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 00:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-cli/src/lib.rs</code>:1588 on 2024-08-25 00:40</div>
            <div class="timeline-body"><p>Where is this <code>space</code> delimiter tested? I couldn't find it in the PR changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 00:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 00:43</div>
            <div class="timeline-body"><blockquote>
<p>I trust this thing whatever it may be</p>
</blockquote>
<p>Trust is vaguely defined in the name of the option, for example <code>--trusted-host pypi.org --trusted-host pypi.python.org</code> hosts may be trusted since they're official, but in an insecure network location it can expose your system to the dangers aformentioned.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 13:07</div>
            <div class="timeline-body"><p>@charliermarsh</p>
<p>Given the above feedback if we want to have a self-documenting flag and skip the warning, I propose renaming the option to more aligned with other tools e.g. curl's <code>--insecure</code>, k8s <code>--insecure-skip-tls-verify</code>, docker's <code>--insecure-registry</code> etc .</p>
<p>Hence instead of <code>--trusted-host</code>, using something like <code>--insecure-host</code> or <code>--insecure-skip-verify-host</code>?</p>
<p>uv has a chance to improve this area rather than to stick with the same name which has been easily misunderstood on the security implications over the years. This also can be documented in pip compatibility guide like the other cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 13:08</div>
            <div class="timeline-body"><p>@samypr100 <code>trusted-host</code> is the name used by <code>pip</code>.</p>
<p>It implies i'm trusting that host, it's a choice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 13:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 13:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 13:18</div>
            <div class="timeline-body"><p>@gaby Yes, I proposed this knowing its the original name used by <code>pip</code>. <code>uv</code> doesn't have to keep the same name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 13:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 13:21</div>
            <div class="timeline-body"><p>Yeah, <code>--insecure-host</code> should work too. Simple and clear.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 14:10</div>
            <div class="timeline-body"><p>I think we could say something like <code>--unsafe-insecure-host</code>?  I think regardless, we probably need to provide an alias to <code>--trusted-host</code>. Though we really feel strongly about a new name we could use our <code>CompatArgs</code> utility to suggest using the new flag instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:2015 on 2024-08-25 14:14</div>
            <div class="timeline-body"><p>I don't think we say &quot;A list&quot; for most options that take multiple values. I'd say like...</p>
<blockquote>
<p>Allow insecure connections to a host.</p>
<p>Can be provided multiple times.</p>
<p>...</p>
</blockquote>
<p>We also should be a bit more verbose about the warning and the implications.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 14:22</div>
            <div class="timeline-body"><p><code>--allow-insecure-host</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:117 on 2024-08-25 14:22</div>
            <div class="timeline-body"><p>Can you add a test case for something with a path? e.g. <code>https://example.com/hello/world</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:24</div>
            <div class="timeline-body"><p>I think you can / should use <code>Realm</code> in place of this (<code>crates/uv-auth/src/realm.rs</code>) â€” I think you can just move the <code>from_str</code> implementation over. I'm not sure if that adds complexity to the setting schema part â€” but it seems like we could just have <code>Realm</code> in the setting schema.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:25</div>
            <div class="timeline-body"><p>&quot;should&quot; because it's our canonical way to do this and there's <code>From&lt;&amp;Url&gt; for Realm</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:25</div>
            <div class="timeline-body"><p>Doesn't that require a scheme? These values don't require a scheme.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 14:28</div>
            <div class="timeline-body"><p>Just felt like we should reuse our <code>unsafe</code> concept from index strategies, but it does get pretty verbose.. <code>--allow-insecure-host</code> is okay.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:28</div>
            <div class="timeline-body"><p>It does yeah, hm. But if someone provides a scheme here (which is allowed per the parser), shouldn't that match be enforced?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:30</div>
            <div class="timeline-body"><p>The scheme could become optional on <code>Realm</code>, I'm not sure if that causes problems. I don't feel strongly if it seems like a pain. There's not a lot of complexity in the matching anymore (<code>Realm</code> got simplified at some point, relying on some behaviors from <code>reqwest</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:31</div>
            <div class="timeline-body"><p>Yeah I agree. Should we assume HTTPS if omitted...? It would be strange to put that in <code>FromStr</code>, but it could make sense for <em>this</em> setting. Or could scheme be optional on <code>Realm</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:32</div>
            <div class="timeline-body"><p>I'm not sure, I feel like if you do <code>--trusted-host example.com</code> and we make a request to <code>http://example.com</code>â€” does skipping SSL verification even matter or make sense? It seems reasonable to assume <code>https</code> since it's only relevant there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:33</div>
            <div class="timeline-body"><p>And I guess another point this raises: should we allow <code>--trusted-host http://example.com</code>? What does that mean?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:34</div>
            <div class="timeline-body"><p>I suppose we could reject <code>http</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 14:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:39</div>
            <div class="timeline-body"><p>We should allow <code>http://</code>. It's normal practice to run internal pypi mirror that runs on http. That's the whole point of <code>trusting</code> a host.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 14:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:40</div>
            <div class="timeline-body"><p>Same applies to, lets say the mirror is https but uses a custom/internal/enterprise CA.</p>
<p>You would want to install from it without verifying the cert, for example inside a Docker build, where you dont want to be adding custom CA's in the container.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:43</div>
            <div class="timeline-body"><p>If you're running over <code>http://</code>, why would certificate validity matter?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 14:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:44</div>
            <div class="timeline-body"><p>The following use-cases should work with --trusted-host/--insecure-host or whichever is the final name.</p>
<ul>
<li>http://example.com</li>
<li>https://example.com</li>
<li>https://example.com (Don't verify CA)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:45</div>
            <div class="timeline-body"><p>Sorry, I'm not following. Why is <code>--trusted-host</code> necessary <em>at all</em> for an <code>http://</code> domain?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:47</div>
            <div class="timeline-body"><p>I guess pip warns if you try to use <code>http://</code>? We don't do that. I don't think you need <code>--trusted-host</code> at all for <code>http://</code> domains with uv. This is only relevant to <code>https://</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 14:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:48</div>
            <div class="timeline-body"><p>You are right, there's no verification needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:48</div>
            <div class="timeline-body"><p>Yeah I feel like setting an index URL to <code>http://example.com</code> works today (e.g., I'm pretty sure it was fine in #5726) but setting <code>ALL_PROXY</code> didn't work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-25 14:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:49</div>
            <div class="timeline-body"><p>We might need to test what happens if you set <code>HTTPS_PROXY</code> or <code>ALL_PROXY</code> to an <code>http://</code> URL?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaby">@gaby</a> reviewed on 2024-08-25 14:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gaby">@gaby</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:52</div>
            <div class="timeline-body"><p>@zanieb That's typically what I use when using something like Squid-Proxy + Pypi. I set both <code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code> to &quot;http://squid-hostname`, and let Squid handle the request/redirect/etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 14:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 14:54</div>
            <div class="timeline-body"><p>Will do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 14:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 14:59</div>
            <div class="timeline-body"><p>I like <code>--allow-insecure-host</code> ðŸ’¯</p>
<blockquote>
<p>I think regardless, we probably need to provide an alias to --trusted-host.</p>
</blockquote>
<p>I think this is where I'd go back to my original suggestion of including a warning when <code>--trusted-host</code> is used (if such alias exists) given the confusion around what it means and the security implications as it shies away from it's true meaning and associated dangers mentioned in https://github.com/astral-sh/uv/pull/6591#discussion_r1730176753.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 15:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 15:23</div>
            <div class="timeline-body"><blockquote>
<p>We should allow <code>http://</code>. It's normal practice to run internal pypi mirror that runs on http. That's the whole point of <code>trusting</code> a host.</p>
</blockquote>
<p>This is a reason as to why I'm suggesting a rename away from <code>--trusted-host</code>  as it's not about trusting a host, rather skipping TLS verification ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 15:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/trusted_host.rs</code>:10 on 2024-08-25 15:45</div>
            <div class="timeline-body"><p>@zanieb - I opted for now to keep <code>TrustedHost</code>, because the requirements are different than <code>Realm</code>... <code>Realm</code> requires a scheme, <code>TrustedHost</code> requires a host (<code>Realm</code> does not), etc. I was also hesitant to make <code>uv-auth</code> a dependency everywhere, and add <code>Schemars</code> as a dep to that crate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> reviewed on 2024-08-25 18:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 18:03</div>
            <div class="timeline-body"><p>I believe you might be missing the mark with the insecure thing. The connection is secure as in it will still use TLS (transport layer security). It is encrypted by a valid certificate of unknown origin. Note even if you say to trust it, the certificate still must be valid!</p>
<p>You have all the benefits of the https connection. Saying this is insecure is comparing this to http which is indeed insecure.</p>
<p>Trusted is the correct word here.</p>
<p>Also this is not only for self signed certificates. There are older systems not recognizing newer CAs such as Let's encrypt (our case for needing this feature).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 18:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 18:16</div>
            <div class="timeline-body"><p>@inoa-jboliveira It's insecure by definition to not have tls verification of the name. Anyone can claim they have a valid certificate otherwise and give you a false sense of security.</p>
<p>Note, using <code>insecure</code> was also suggested by @pradyunsg in the discussion of possible rename/removal of <code>--trusted-host</code> from pip in https://github.com/pypa/pip/issues/7725#issuecomment-899035686 started by @graingert</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> reviewed on 2024-08-25 18:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 18:27</div>
            <div class="timeline-body"><p>@samypr100
By this definition, you must show same warning on any HTTP host being used. But it won't happen.</p>
<p>Just FYI: Regardless of the name you pick by whatever reason you do, I thank the astral team for providing the feature I need the most for wide deploy of uv in my org. You guys rock</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-08-25 18:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cli/src/lib.rs</code>:1581 on 2024-08-25 18:52</div>
            <div class="timeline-body"><blockquote>
<p>By this definition, you must show same warning on any HTTP host being used. But it won't happen.</p>
</blockquote>
<p>This option only applies to https connections, not http.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2024-08-26 11:09</div>
            <div class="timeline-body"><blockquote>
<p>Youâ€™re receiving notifications because you were mentioned.</p>
</blockquote>
<p>Not sure why GitHub thinks I have a mention here... this seems fine to me, in case someone mentioned me for asking my opinion on the idea. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-08-26 18:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-08-27 12:41</div>
            <div class="timeline-body"><p>LGTM. Might want to add a note around https://docs.astral.sh/uv/configuration/authentication/#custom-ca-certificates</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/graingert">@graingert</a> on 2024-08-27 12:45</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Youâ€™re receiving notifications because you were mentioned.</p>
</blockquote>
<p>Not sure why GitHub thinks I have a mention here... this seems fine to me, in case someone mentioned me for asking my opinion on the idea. :)</p>
</blockquote>
<p>You were tagged here https://github.com/astral-sh/uv/pull/6591#discussion_r1730406532</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-08-27 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-27 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-27 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonathanasdf">@jonathanasdf</a> on 2024-08-27 19:10</div>
            <div class="timeline-body"><p>I seem to be getting some errors, eg.</p>
<pre><code>[tool.uv]
allow-insecure-host = [
  &quot;amazonaws.com&quot;,
]
</code></pre>
<pre><code>warning: Failed to parse `pyproject.toml` during settings discovery:
  TOML parse error at line 93, column 1
     |
  93 | [tool.uv]
     | ^^^^^^^^^
  invalid type: string &quot;amazonaws.com&quot;, expected struct TrustedHost
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 19:11</div>
            <div class="timeline-body"><p>Apologies, that's my bad. Can you open a separate issue? It should work on the command-line though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 19:21</div>
            <div class="timeline-body"><p>See: https://github.com/astral-sh/uv/pull/6716</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:01:08 UTC
    </footer>
</body>
</html>
