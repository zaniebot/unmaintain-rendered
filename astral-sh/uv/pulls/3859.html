<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>implement `uv pip tree` - astral-sh/uv #3859</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>implement <code>uv pip tree</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3859">#3859</a>
        opened by <a href="https://github.com/ChannyClaus">@ChannyClaus</a>
        on 2024-05-27 06:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-05-27 06:46</div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>resolves https://github.com/astral-sh/uv/issues/3272</p>
<ol>
<li>added it as a new subcommand rather than a flag on an existing command since that seems more consistent with <code>cargo tree</code> + cleaner code organization, but can make changes if it's preferred the other way.</li>
<li>throws an error on finding a cyclic dependency, which is more similar to <code>cargo</code> than <code>pipdeptree</code> (<code>pipdeptree</code> seems to ignore the packages that are part of the dependency cycle and display the rest).</li>
</ol>
<h2>Test Plan</h2>
<p>added tests ğŸŒµ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-05-27 13:45</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/uv/branches/ChannyClaus:uv-pip-tree">CodSpeed Performance Report</a></h2>
<h3>Merging #3859 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>ChannyClaus:uv-pip-tree</code> (828fc7d) with <code>main</code> (e0ad649)</sub></p>
<h3>Summary</h3>
<p><code>âœ… 13</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @ChannyClaus on 2024-05-29 03:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-05-29 03:13</div>
            <div class="timeline-body"><p>discovered a bit of an issue - the current implementation goes through all extras when constructing the graph, resulting in a cycle way more often. seems like <code>pipdeptree</code> just ignores extras entirely; let me know if y'all have any thoughts but probably going to look into doing the same here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eth3lbert">@eth3lbert</a> on 2024-05-29 06:42</div>
            <div class="timeline-body"><blockquote>
<p>discovered a bit of an issue - the current implementation goes through all extras when constructing the graph, resulting in a cycle way more often. seems like <code>pipdeptree</code> just ignores extras entirely; let me know if y'all have any thoughts but probably going to look into doing the same here.</p>
</blockquote>
<p>I've actually tried adding support for extras to pipdeptree, and it partially works. However, I haven't found the time to clean it up and submit a pull request.</p>
<p>My approach is to first consider all extras, but respect the marker (excluding the extra part). Then, while building the extra map, prune impossible extra branches that lack required packages or are unreachable nodes.</p>
<p>However, this approach isn't perfect. It determines extra branches based on the installed packages and tries to infer backwards, leading to situations where it can't determine the root package requesting the extra installation correctly. This can happen when two separate packages have similar extra packages.</p>
<p>Another approach for the tree might be to leverage the manifest/lock file, which is also used by multiple package management tools like Cargo, pnpm, Poetry, etc. This might be more accurate.</p>
<p>My other concern is the tree display for packages with extras, especially those with multiple extras. How should we handle them: aggregate or split them in the display?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-05-30 02:02</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>discovered a bit of an issue - the current implementation goes through all extras when constructing the graph, resulting in a cycle way more often. seems like <code>pipdeptree</code> just ignores extras entirely; let me know if y'all have any thoughts but probably going to look into doing the same here.</p>
</blockquote>
<p>I've actually tried adding support for extras to pipdeptree, and it partially works. However, I haven't found the time to clean it up and submit a pull request.</p>
<p>My approach is to first consider all extras, but respect the marker (excluding the extra part). Then, while building the extra map, prune impossible extra branches that lack required packages or are unreachable nodes.</p>
<p>However, this approach isn't perfect. It determines extra branches based on the installed packages and tries to infer backwards, leading to situations where it can't determine the root package requesting the extra installation correctly. This can happen when two separate packages have similar extra packages.</p>
<p>Another approach for the tree might be to leverage the manifest/lock file, which is also used by multiple package management tools like Cargo, pnpm, Poetry, etc. This might be more accurate.</p>
<p>My other concern is the tree display for packages with extras, especially those with multiple extras. How should we handle them: aggregate or split them in the display?</p>
</blockquote>
<p>hmm yeah, given the complexity, maybe we shall go with what pipdeptree does for the time being then?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ChannyClaus on 2024-05-31 04:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2024-05-31 10:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-09 16:32</div>
            <div class="timeline-body"><p>handled the case where there's a dependency cycle (test at https://github.com/astral-sh/uv/pull/3859/files#diff-ada61e3d2726ed1b05e633096131a477c895c737c6350b8238d9e81b2745e8eaR165)</p>
<p>let me know if there's anything else that y'all think should be changed ğŸŒµ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-10 23:51</div>
            <div class="timeline-body"><p>@charliermarsh let me know if this is kinda low-prio to get in now - wasn't sure if i should keep rebasing on main ğŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-15 02:49</div>
            <div class="timeline-body"><p>Charlie's out next week, if I have time I'll take a look!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-17 03:04</div>
            <div class="timeline-body"><blockquote>
<p>Charlie's out next week, if I have time I'll take a look!</p>
</blockquote>
<p>thanks! seems like something strange is going on with windows test after rebasing - will try to take a look more this week...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @zanieb on 2024-06-17 10:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-19 02:47</div>
            <div class="timeline-body"><p>i just noticed the failure is from <code>uv pip install</code> - it <em>seems</em> like it's handling cyclic dependency differently for windows. excluded the test for windows for now, but can continue to look but if y'all have thoughts as to what's going on, let me know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-19 02:51</div>
            <div class="timeline-body"><p>Hey @ChannyClaus, it's overflowing the stack which is common on our test builds on Windows. I'd recommend setting up your test invocations like this</p>
<p>https://github.com/astral-sh/uv/blob/b22ee82f0d3af607cc49d3f3870805769ea0b6e6/crates/uv/tests/common/mod.rs#L261-L294</p>
<p>https://github.com/astral-sh/uv/blob/b22ee82f0d3af607cc49d3f3870805769ea0b6e6/crates/uv/tests/pip_install.rs#L321-L326</p>
<p>Note the <code>UV_STACK_SIZE</code> tweak on Windows.</p>
<p>I just gave this a quick look so lmk if you're accounting for that already.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-19 03:41</div>
            <div class="timeline-body"><blockquote>
<p>Hey @ChannyClaus, it's overflowing the stack which is common on our test builds on Windows. I'd recommend setting up your test invocations like this</p>
<p>https://github.com/astral-sh/uv/blob/b22ee82f0d3af607cc49d3f3870805769ea0b6e6/crates/uv/tests/common/mod.rs#L261-L294</p>
<p>https://github.com/astral-sh/uv/blob/b22ee82f0d3af607cc49d3f3870805769ea0b6e6/crates/uv/tests/pip_install.rs#L321-L326</p>
<p>Note the <code>UV_STACK_SIZE</code> tweak on Windows.</p>
<p>I just gave this a quick look so lmk if you're accounting for that already.</p>
</blockquote>
<p>ahh, that must be it, i think i removed that without knowing what it did while adding the extra index :.)</p>
<blockquote>
<p>Hey @ChannyClaus, it's overflowing the stack which is common on our test builds on Windows. I'd recommend setting up your test invocations like this</p>
<p>https://github.com/astral-sh/uv/blob/b22ee82f0d3af607cc49d3f3870805769ea0b6e6/crates/uv/tests/common/mod.rs#L261-L294</p>
<p>https://github.com/astral-sh/uv/blob/b22ee82f0d3af607cc49d3f3870805769ea0b6e6/crates/uv/tests/pip_install.rs#L321-L326</p>
<p>Note the <code>UV_STACK_SIZE</code> tweak on Windows.</p>
<p>I just gave this a quick look so lmk if you're accounting for that already.</p>
</blockquote>
<p>this was absolutely the case (sorry removed that bit when i was writing out the invocation cuz i had to add the extra index arg) - should be ready for review again now ğŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:181 on 2024-06-20 15:14</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code class="language-suggestion">                let visited_lines = self.visit(self.dist_by_package_name[&amp;required.name], visited, path)?;
                lines.extend(visited_lines);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:79 on 2024-06-20 15:17</div>
            <div class="timeline-body"><p>What's the reason for filtering these out?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:109 on 2024-06-20 15:18</div>
            <div class="timeline-body"><p>Nit:</p>
<pre><code class="language-suggestion">        line.push_str(&quot;â””â”€â”€ &quot;);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:111 on 2024-06-20 15:21</div>
            <div class="timeline-body"><p>No need to allocate here, you can simplify all of this with <code>write!</code>.</p>
<pre><code>write!(&amp;mut line, &quot;{} v{}&quot; installed_dist.name(), installed_dist.version()).unwrap();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:151 on 2024-06-20 15:22</div>
            <div class="timeline-body"><p><code>PackageName</code> is already a <code>String</code>, no need to allocate.</p>
<pre><code class="language-suggestion">        let package_name = installed_dist.name().as_ref();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:196 on 2024-06-20 15:24</div>
            <div class="timeline-body"><p>Should we be reusing the same <code>path</code> for all dependencies? Cycles can only occur in <code>visit</code>, so it seems like we should be clearing the <code>Vec</code> or creating a new <code>path</code> for each dependency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/tests/pip_tree.rs</code>:222 on 2024-06-20 15:29</div>
            <div class="timeline-body"><p>Can we give a better error message here? Something like:</p>
<pre><code>package `a` depends on package `b`, which depends cyclically on package `a`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:42 on 2024-06-20 15:33</div>
            <div class="timeline-body"><p>I believe this needs to be updated with the new internal toolchain changes.</p>
<pre><code class="language-suggestion">    let environment = PythonEnvironment::from_toolchain(Toolchain::find(
        python.map(ToolchainRequest::parse),
        EnvironmentPreference::from_system_flag(system, true),
        ToolchainPreference::from_settings(preview),
        &amp;cache,
    )?);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> requested changes on 2024-06-20 15:37</div>
            <div class="timeline-body"><p>Some small nits and questions. Otherwise this looks good!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-20 15:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:42 on 2024-06-20 15:45</div>
            <div class="timeline-body"><p>I'm happy to do this rebase. I keep changing things :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-06-20 20:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:79 on 2024-06-20 20:24</div>
            <div class="timeline-body"><p>cycles become way too common if extras are included (in which case the current implementation throws an error). <code>pipdeptree</code> seems to just remove the extras when building the tree, and it seemed like the right choice for usability.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:111 on 2024-06-20 20:57</div>
            <div class="timeline-body"><p>this is actually what i had previously i believe - i changed it because this would then print the tree partially when there's a cycle (and thought it looked better if no tree gets printed at all if an error was going to be thrown)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-06-20 20:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-06-20 21:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:79 on 2024-06-20 21:57</div>
            <div class="timeline-body"><p>I see, that seems reasonable. But why filter only the extras that are included by default, and not all extras installed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-06-20 22:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:111 on 2024-06-20 22:03</div>
            <div class="timeline-body"><p>GitHub doesn't let me edit the selected lines, but I'm just suggesting to use <code>write!</code> for an individual package. Makes it a little nicer:</p>
<pre><code class="language-diff">+    write!(&amp;mut line, &quot;{} v{}&quot; installed_dist.name(), installed_dist.version()).unwrap();
-    line.push_str((*installed_dist.name()).to_string().as_str());
-    line.push_str(&quot; v&quot;);
-    line.push_str((*installed_dist.version()).to_string().as_str());
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:151 on 2024-06-20 22:06</div>
            <div class="timeline-body"><p>Hmm looks like this was marked as resolved but didn't get changed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-06-20 22:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-20 23:01</div>
            <div class="timeline-body"><p>So I gave this a try today, just to get a sense for the user experience and the output for a small project looks like this</p>
<pre><code>â¯ uv pip tree
editables v0.5
packse v0.0.0
â””â”€â”€ chevron-blue v0.2.1
â””â”€â”€ hatchling v1.24.2
    â””â”€â”€ packaging v24.1
    â””â”€â”€ pathspec v0.12.1
    â””â”€â”€ pluggy v1.5.0
    â””â”€â”€ trove-classifiers v2024.5.22
â””â”€â”€ msgspec v0.18.6
â””â”€â”€ pyyaml v6.0.1
â””â”€â”€ setuptools v70.0.0
â””â”€â”€ twine v5.1.0
    â””â”€â”€ pkginfo v1.11.1
    â””â”€â”€ readme-renderer v43.0
        â””â”€â”€ nh3 v0.2.17
        â””â”€â”€ docutils v0.21.2
        â””â”€â”€ pygments v2.18.0
    â””â”€â”€ requests v2.32.3
        â””â”€â”€ charset-normalizer v3.3.2
        â””â”€â”€ idna v3.7
        â””â”€â”€ urllib3 v2.2.1
        â””â”€â”€ certifi v2024.6.2
    â””â”€â”€ requests-toolbelt v1.0.0
        â””â”€â”€ requests v2.32.3 (*)
    â””â”€â”€ urllib3 v2.2.1 (*)
    â””â”€â”€ importlib-metadata v7.1.0
        â””â”€â”€ zipp v3.19.2
    â””â”€â”€ keyring v25.2.1
        â””â”€â”€ jaraco-classes v3.4.0
            â””â”€â”€ more-itertools v10.3.0
        â””â”€â”€ jaraco-functools v4.0.1
            â””â”€â”€ more-itertools v10.3.0 (*)
        â””â”€â”€ jaraco-context v5.3.0
    â””â”€â”€ rfc3986 v2.0.0
    â””â”€â”€ rich v13.7.1
        â””â”€â”€ markdown-it-py v3.0.0
            â””â”€â”€ mdurl v0.1.2
        â””â”€â”€ pygments v2.18.0 (*)
psutil v5.9.8
pypiserver v2.1.1
â””â”€â”€ pip v24.0
â””â”€â”€ packaging v24.1 (*)
ruff v0.1.15
syrupy v4.6.1
â””â”€â”€ pytest v8.2.2
    â””â”€â”€ iniconfig v2.0.0
    â””â”€â”€ packaging v24.1 (*)
    â””â”€â”€ pluggy v1.5.0 (*)
watchfiles v0.21.0
â””â”€â”€ anyio v4.4.0
    â””â”€â”€ idna v3.7 (*)
    â””â”€â”€ sniffio v1.3.1
</code></pre>
<p>A things I notice here.</p>
<ol>
<li>The tree is not drawn with properly &quot;connected&quot; branches. As a contrasting example, here's the packse tree for a scenario:</li>
</ol>
<pre><code>â¯ uv run -- packse view scenarios/examples/example.json
example-961b4c22
â”œâ”€â”€ environment
â”‚   â””â”€â”€ python3.8
â”œâ”€â”€ root
â”‚   â””â”€â”€ requires a
â”‚       â””â”€â”€ satisfied by a-1.0.0
â”œâ”€â”€ a
â”‚   â””â”€â”€ a-1.0.0
â”‚       â””â”€â”€ requires b&gt;1.0.0
â”‚           â”œâ”€â”€ satisfied by b-2.0.0
â”‚           â””â”€â”€ satisfied by b-3.0.0
â””â”€â”€ b
    â”œâ”€â”€ b-1.0.0
    â”œâ”€â”€ b-2.0.0
    â””â”€â”€ b-3.0.0
        â””â”€â”€ requires c
            â””â”€â”€ unsatisfied: no versions for package
</code></pre>
<ol start="2">
<li><p>The lack of extras display is very confusing, e.g. most of these dependencies are from <code>packse</code> and it's weird that the extras are not shown as sources. I know this was discussed elsewhere, but this seems like a big deal to me. I'm not sure I fully understand why this is hard to do.</p>
</li>
<li><p>There's no indication of what the <code>(*)</code> means</p>
</li>
<li><p>The versions seem superfluous and distracting when inspecting a dependency tree â€” should we make display of those opt-in?</p>
</li>
</ol>
<p>For comparison purposes, here's the <code>pipdeptree</code> output for the same project:</p>
<pre><code>â¯ uv tool run pipdeptree --python .venv/bin/python
------------------------------------------------------------------------
packse==0.0.0
â”œâ”€â”€ chevron-blue [required: &gt;=0.2.1, installed: 0.2.1]
â”œâ”€â”€ hatchling [required: &gt;=1.20.0, installed: 1.24.2]
â”‚   â”œâ”€â”€ packaging [required: &gt;=23.2, installed: 24.1]
â”‚   â”œâ”€â”€ pathspec [required: &gt;=0.10.1, installed: 0.12.1]
â”‚   â”œâ”€â”€ pluggy [required: &gt;=1.0.0, installed: 1.5.0]
â”‚   â””â”€â”€ trove-classifiers [required: Any, installed: 2024.5.22]
â”œâ”€â”€ msgspec [required: &gt;=0.18.4, installed: 0.18.6]
â”œâ”€â”€ PyYAML [required: &gt;=6.0.1, installed: 6.0.1]
â”œâ”€â”€ setuptools [required: &gt;=69.1.1, installed: 70.0.0]
â””â”€â”€ twine [required: &gt;=4.0.2, installed: 5.1.0]
    â”œâ”€â”€ importlib_metadata [required: &gt;=3.6, installed: 7.1.0]
    â”‚   â””â”€â”€ zipp [required: &gt;=0.5, installed: 3.19.2]
    â”œâ”€â”€ keyring [required: &gt;=15.1, installed: 25.2.1]
    â”‚   â”œâ”€â”€ jaraco.classes [required: Any, installed: 3.4.0]
    â”‚   â”‚   â””â”€â”€ more-itertools [required: Any, installed: 10.3.0]
    â”‚   â”œâ”€â”€ jaraco.context [required: Any, installed: 5.3.0]
    â”‚   â””â”€â”€ jaraco.functools [required: Any, installed: 4.0.1]
    â”‚       â””â”€â”€ more-itertools [required: Any, installed: 10.3.0]
    â”œâ”€â”€ pkginfo [required: &gt;=1.8.1, installed: 1.11.1]
    â”œâ”€â”€ readme_renderer [required: &gt;=35.0, installed: 43.0]
    â”‚   â”œâ”€â”€ docutils [required: &gt;=0.13.1, installed: 0.21.2]
    â”‚   â”œâ”€â”€ nh3 [required: &gt;=0.2.14, installed: 0.2.17]
    â”‚   â””â”€â”€ Pygments [required: &gt;=2.5.1, installed: 2.18.0]
    â”œâ”€â”€ requests [required: &gt;=2.20, installed: 2.32.3]
    â”‚   â”œâ”€â”€ certifi [required: &gt;=2017.4.17, installed: 2024.6.2]
    â”‚   â”œâ”€â”€ charset-normalizer [required: &gt;=2,&lt;4, installed: 3.3.2]
    â”‚   â”œâ”€â”€ idna [required: &gt;=2.5,&lt;4, installed: 3.7]
    â”‚   â””â”€â”€ urllib3 [required: &gt;=1.21.1,&lt;3, installed: 2.2.1]
    â”œâ”€â”€ requests-toolbelt [required: &gt;=0.8.0,!=0.9.0, installed: 1.0.0]
    â”‚   â””â”€â”€ requests [required: &gt;=2.0.1,&lt;3.0.0, installed: 2.32.3]
    â”‚       â”œâ”€â”€ certifi [required: &gt;=2017.4.17, installed: 2024.6.2]
    â”‚       â”œâ”€â”€ charset-normalizer [required: &gt;=2,&lt;4, installed: 3.3.2]
    â”‚       â”œâ”€â”€ idna [required: &gt;=2.5,&lt;4, installed: 3.7]
    â”‚       â””â”€â”€ urllib3 [required: &gt;=1.21.1,&lt;3, installed: 2.2.1]
    â”œâ”€â”€ rfc3986 [required: &gt;=1.4.0, installed: 2.0.0]
    â”œâ”€â”€ rich [required: &gt;=12.0.0, installed: 13.7.1]
    â”‚   â”œâ”€â”€ markdown-it-py [required: &gt;=2.2.0, installed: 3.0.0]
    â”‚   â”‚   â””â”€â”€ mdurl [required: ~=0.1, installed: 0.1.2]
    â”‚   â””â”€â”€ Pygments [required: &gt;=2.13.0,&lt;3.0.0, installed: 2.18.0]
    â””â”€â”€ urllib3 [required: &gt;=1.26.0, installed: 2.2.1]
pipdeptree==2.23.0
â”œâ”€â”€ packaging [required: &gt;=23.1, installed: 24.1]
â””â”€â”€ pip [required: &gt;=23.1.2, installed: 24.1]
psutil==5.9.8
pypiserver==2.1.1
â”œâ”€â”€ packaging [required: &gt;=23.2, installed: 24.1]
â””â”€â”€ pip [required: &gt;=7, installed: 24.1]
syrupy==4.6.1
â””â”€â”€ pytest [required: &gt;=7.0.0,&lt;9.0.0, installed: 8.2.2]
    â”œâ”€â”€ iniconfig [required: Any, installed: 2.0.0]
    â”œâ”€â”€ packaging [required: Any, installed: 24.1]
    â””â”€â”€ pluggy [required: &gt;=1.5,&lt;2.0, installed: 1.5.0]
watchfiles==0.22.0
â””â”€â”€ anyio [required: &gt;=3.0.0, installed: 4.4.0]
    â”œâ”€â”€ idna [required: &gt;=2.8, installed: 3.7]
    â””â”€â”€ sniffio [required: &gt;=1.1, installed: 1.3.1]
</code></pre>
<p>Note they display the tree correctly as I requested. It's nice that they show version requirements as well as the installed version, but I still feel like it's way too hard to read as a default output. It seems entirely fine to add support for that separately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-20 23:06</div>
            <div class="timeline-body"><p>I also find the cargo behavior around cycles pretty unhelpful as it makes it very difficult to understand how the cycle is happening. What's the problem with displaying cycles? It seems like if <code>a</code> depends on <code>b</code> and <code>b</code> depends on <code>c</code> which depends on <code>a</code> we'd just display something like</p>
<pre><code>- a
    - b
       - c
          - a
</code></pre>
<p>Where if a package is already present at the top-level we omit display of its tree?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-20 23:24</div>
            <div class="timeline-body"><blockquote>
<p>The tree is not drawn with properly &quot;connected&quot; branches.</p>
</blockquote>
<p>ah my bad - let me try to fix this today.</p>
<blockquote>
<p>There's no indication of what the (*) means</p>
</blockquote>
<p>i can definitely add some sort footnote for this in the output; was just following what <code>cargo tree</code> does.</p>
<blockquote>
<p>The versions seem superfluous and distracting when inspecting a dependency tree â€” should we make display of those opt-in?</p>
</blockquote>
<p>i'd guess it would be more common default to display the versions but putting it behind a flag seems also fine.</p>
<blockquote>
<p>The lack of extras display is very confusing, e.g. most of these dependencies are from packse and it's weird that the extras are not shown as sources. I know this was discussed elsewhere, but this seems like a big deal to me. I'm not sure I fully understand why this is hard to do.</p>
</blockquote>
<p>i'll make a separate comment on this with an example, when i was playing around with the version that includes extra, installing a few popular packages would create a dependency cycle. seemed like it would be too limiting as a feature to fail on common set of installed packages.</p>
<blockquote>
<p>we'd just display something like</p>
</blockquote>
<pre><code>a
|--&gt; b
        |-&gt;&gt; c
</code></pre>
<p>this is actually easier; if preferred, i can revert the code to print the above output? (and error underneath?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-06-20 23:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:111 on 2024-06-20 23:34</div>
            <div class="timeline-body"><p>sorry i think i was not clear - what i was saying was, with <code>write!</code>, the output would look like</p>
<pre><code>package1
|--&gt; package 2
package3
...
cycle_package1
|--&gt; cycle_package2
         |--&gt; cycle_package1
Error: cycle exists: cycle_package1 -&gt; cycle_package2
</code></pre>
<p>rather than</p>
<pre><code>Error: cycle exists: cycle_package1 -&gt; cycle_package2
</code></pre>
<p>i thought the latter was preferred but maybe the former is preferred based on the comment @zanieb made below? https://github.com/astral-sh/uv/pull/3859#issuecomment-2181687503</p>
<p>i can make the change if the former is preferred!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-20 23:34</div>
            <div class="timeline-body"><blockquote>
<p>ah my bad - let me try to fix this today.</p>
</blockquote>
<p>Note this is pretty painful. The <a href="https://github.com/astral-sh/packse/blob/main/src/packse/view.py#L67">packse implementation</a> may be a helpful reference.</p>
<blockquote>
<p>re <code>(*)</code> was just following what cargo tree does.</p>
</blockquote>
<p>What does it mean though? :)</p>
<p>Regarding cycles in extras: I'm not sure why they need to be an error though? It seems like we should be able to display them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-06-20 23:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:79 on 2024-06-20 23:35</div>
            <div class="timeline-body"><p>hmm the code looks like filtering all extra packages altogether, but maybe i'm missing something?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-06-20 23:37</div>
            <div class="timeline-body"><blockquote>
<p>The tree is not drawn with properly &quot;connected&quot; branches. As a contrasting example, here's the packse tree for a scenario:</p>
</blockquote>
<p>Another thing that is missing is the current package as the root of the tree.</p>
<blockquote>
<p>There's no indication of what the (*) means</p>
</blockquote>
<p><code>(*)</code> is taken from cargo to represent a duplicated package that has already been expanded elsewhere. Cargo has the <code>--no-dedupe</code> flag to fully expand these nodes. De-duplicating by default would likely be far too noisy. The other alternative is to omit the <code>(*)</code> entirely, but I think that would end up being more confusing.</p>
<p>Cycles could similarly use <code>(*)</code> and not be special-cased, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-06-20 23:40</div>
            <div class="timeline-body"><p><code>cargo tree</code> has some other options, such as <code>--prune</code> and especially <code>--depth</code>, that we likely will want to add eventually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-20 23:42</div>
            <div class="timeline-body"><p>Ah thank you @ibraheemdev. Yeah I'm suggesting something like using <code>(*)</code> for the cycles. We could do <code>(**)</code> as well. Notably we couldn't expand them though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-06-20 23:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:111 on 2024-06-20 23:46</div>
            <div class="timeline-body"><p>oh never mind, i see what you mean</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-06-21 00:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:151 on 2024-06-21 00:16</div>
            <div class="timeline-body"><p>oh oops, yah i think i reverted this while working on other comments; this change makes compiler to complain about a flurry of other things and my tiny brain was not strong enough to win that battle - will look again after fixing the display issue ğŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-21 02:38</div>
            <div class="timeline-body"><p>alright, handled:</p>
<ol>
<li>the incorrect rendering issue https://github.com/astral-sh/uv/pull/3859/files#diff-ada61e3d2726ed1b05e633096131a477c895c737c6350b8238d9e81b2745e8eaR223-R259</li>
<li>allowing cycles https://github.com/astral-sh/uv/pull/3859/files#diff-ada61e3d2726ed1b05e633096131a477c895c737c6350b8238d9e81b2745e8eaR324-R328</li>
</ol>
<p>what's left now?</p>
<ul>
<li>add a footnote type output for (*) for de-duplication?</li>
<li>(**) for cycle?</li>
</ul>
<p>i'll look at https://github.com/astral-sh/uv/pull/3859/files#r1647760723 in the meantime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-06-21 02:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:151 on 2024-06-21 02:56</div>
            <div class="timeline-body"><p>Ah you end up needing the <code>String</code> later anyways. You could use a <code>HashSet&lt;&amp;str&gt;</code> and <code>Vec&lt;&amp;str&gt;</code> for the <code>visited</code> and <code>lines</code> types to avoid the allocations, but it's fine how it is now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-21 03:36</div>
            <div class="timeline-body"><p>The branching looks great now! A footnote seems reasonable for <code>*</code> I think we can skip using <code>**</code> and just use <code>*</code> with a different footnote when a <code>--no-dedupe</code> flag is used.</p>
<p>Thoughts on extras? Should we pursue it as a follow-up?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-21 03:56</div>
            <div class="timeline-body"><blockquote>
<p>The branching looks great now! A footnote seems reasonable for <code>*</code> I think we can skip using <code>**</code> and just use <code>*</code> with a different footnote when a <code>--no-dedupe</code> flag is used.</p>
<p>Thoughts on extras? Should we pursue it as a follow-up?</p>
</blockquote>
<p>yah, follow-up sounds good. i think it's confusing both ways. if we do show extras, it would be confusing if the user didn't install it with extras. if we do <em>not</em> show extras, as you pointed out, the user will be surprised by them <em>not</em> being linked in the tree output.</p>
<p>i'll add a footnote shortly!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on 2024-06-21 04:34</div>
            <div class="timeline-body"><p>done ğŸŒµ</p>
<pre><code>$ cargo run -q pip tree
uv-cyclic-dependencies-c v0.1.0
â””â”€â”€ uv-cyclic-dependencies-a v0.1.0
    â””â”€â”€ uv-cyclic-dependencies-b v0.1.0
        â””â”€â”€ uv-cyclic-dependencies-a v0.1.0 (*)
Note: (*) indicates the package has been `de-duplicated`.
The dependencies for the package have already been shown elsewhere in the graph, and so are not repeated.
</code></pre>
<p>~should i use a period not a semi-colon - i feel like i overuse it~</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-06-21 16:23</div>
            <div class="timeline-body"><p>Thanks for your work on this (and your patience!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ibraheemdev by @ChannyClaus on 2024-06-21 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-06-21 16:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip/tree.rs</code>:151 on 2024-06-21 16:54</div>
            <div class="timeline-body"><p>got it, yah maybe better to leave it as is for now then (was iffy around adding all the lifetimes annotation etc ğŸ˜… )</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> approved on 2024-06-21 19:44</div>
            <div class="timeline-body"><p>Great work! Some of the other things we discussed can be addressed in follow-up PRs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ibraheemdev on 2024-06-21 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ibraheemdev on 2024-06-21 19:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:48:46 UTC
    </footer>
</body>
</html>
