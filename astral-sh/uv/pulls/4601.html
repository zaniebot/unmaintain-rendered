<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow configuring the toolchain fetch strategy - astral-sh/uv #4601</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow configuring the toolchain fetch strategy</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4601">#4601</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-06-27 20:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Adds a <code>toolchain-fetch</code> option alongside <code>toolchain-preference</code> with <code>automatic</code> (default) and <code>manual</code> values allowing automatic toolchain fetches to be disabled (replaces <a href="https://github.com/astral-sh/uv/pull/4425">astral-sh/uv#4425</a>). When <code>manual</code>, toolchains must be installed with <code>uv toolchain install</code>.</p>
<p>Note this was previously implemented with <code>if-necessary</code>, <code>always</code>, <code>never</code> variants but the interaction between this and <code>toolchain-preference</code> was too confusing. By reducing to a binary option, things should be clearer. The <code>if-necessary</code> behavior moved to <code>toolchain-preference=installed</code>. See <a href="https://github.com/astral-sh/uv/pull/4601">astral-sh/uv#4601</a>#discussion_r1657839633 and <a href="https://github.com/astral-sh/uv/pull/4601">astral-sh/uv#4601</a>#discussion_r1658658755</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-27 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-27 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-27 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-27 21:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:86 on 2024-06-27 21:33</div>
            <div class="timeline-body"><p>I worry a little bit about the interaction between these two options being confusing, but I think it&#x27;d be worse to try to enumerate in a single setting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-27 21:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:128 on 2024-06-27 21:34</div>
            <div class="timeline-body"><p>Should we... hide these? I feel like they&#x27;re targeting the configuration file more than the CLI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-27 21:34</div>
            <div class="timeline-body"><p>I&#x27;m still not sure what our testing strategy is for toolchains since I don&#x27;t want to fetch them in unit tests.</p>
<p>I tested various combinations of <code>--toolchain-preference</code> and <code>--toolchain-fetch</code> locally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-27 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-27 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:82 on 2024-06-28 11:43</div>
            <div class="timeline-body"><pre><code>    /// Always fetch a managed toolchain if it can be used to fulfill a request.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-06-28 11:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:128 on 2024-06-28 12:18</div>
            <div class="timeline-body"><p>Is there an interaction between <code>--toolchain-preference</code> and <code>--toolchain-fetch</code> that should be documented here?</p>
<p>I like having the flags available on the CLI personally. Unless there&#x27;s a specific downside of using them on the CLI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:128 on 2024-06-28 13:01</div>
            <div class="timeline-body"><p>Ah I see the interactions are documented on the options. Do those show up in <code>--help</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:86 on 2024-06-28 13:03</div>
            <div class="timeline-body"><p>Yeah hmmm. Would it help to tie them back to a specific user experience? Like, &quot;You might want to use <code>only-system</code> because , and so setting this to <code>always</code> has no effect.&quot; Honestly not sure though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-06-28 13:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-28 14:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:128 on 2024-06-28 14:34</div>
            <div class="timeline-body"><p>Yeah they show up in <code>--help</code> for every command since they&#x27;re global options. The interactions aren&#x27;t explained actually in <code>--help</code>, I guess because they&#x27;re on a subsequent line. I could add some notes to the CLI flag itself though?</p>
<p>I don&#x27;t mind having them be available in the CLI but I&#x27;m tempted to omit them from the help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-06-28 14:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:128 on 2024-06-28 14:38</div>
            <div class="timeline-body"><p>Aye yeah that sounds good. I think I&#x27;d still prefer to have them in the <code>--help</code> personally. Although I see how it might be a bit of a bummer to have them in <em>every</em> help since they&#x27;re global <em>and</em> because yeah, I agree, these probably won&#x27;t get used much on the CLI. So I defer to you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-28 14:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:86 on 2024-06-28 14:52</div>
            <div class="timeline-body"><p>Idk. Maybe warnings would be sensible? Do you think they make sense as separate options?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-28 14:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:86 on 2024-06-28 14:54</div>
            <div class="timeline-body"><p>Like, an alternative is <code>toolchain-fetch-allowed</code> as a bool and <code>toolchain-preference</code> has <code>only-managed</code>, <code>only-system</code>, <code>managed</code>, <code>system</code>, <code>installed</code> (default), where <code>installed</code> prefers any installed toolchain over any not-yet-downloaded one  i.e. replacing <code>if-necessary</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-06-28 14:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:86 on 2024-06-28 14:56</div>
            <div class="timeline-body"><p>When I was reading the docs, it did take me a minute to put the pieces together. But after having understood it, yeah, it does feel like they belong as two different options. They seem <em>almost</em> orthogonal, but not quite.</p>
<p>I&#x27;d be in favor of a warning for things like <code>pref=only-system</code> and <code>strat=always</code> combinations that are probably a mistake.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-02 01:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-02 01:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-02 01:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:46:11 UTC
    </footer>
</body>
</html>
