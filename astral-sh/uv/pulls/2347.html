<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement &quot;Requires&quot; field in `pip show` - astral-sh/uv #2347</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implement &quot;Requires&quot; field in <code>pip show</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/2347">#2347</a>
        opened by <a href="https://github.com/ChannyClaus">@ChannyClaus</a>
        on 2024-03-10 22:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Follow-up for https://github.com/astral-sh/uv/commit/395be442fc170af4f22c08ead59911078bc02f8c</p>
<p>adds <code>Requires</code> field to pip show output.</p>
<p>I've aimed to make it behave exactly the same as <code>pip</code> does for now, but there seem to be subtle issues that may require some discussion going forward:</p>
<ul>
<li>Should <code>uv pip show</code> support extras? <code>pip</code> has an open issue for it, but currently does not support https://github.com/pypa/pip/issues/4824.</li>
<li>Relatedly, <code>Requred-by</code> field (not implemented in this PR) in <code>pip show</code> currently doesn't take the extras into account transparently, i.e. when <code>PySocks</code> has been installed as an extra for <code>requests[socks]</code>, <code>pip show PySocks</code> doesn't have <code>requests</code> or <code>requests[socks]</code> under <code>Requred-by</code> field. Should <code>uv pip show</code> for now just replicate <code>pip</code>'s behavior for now for simplicity and parity or try to cover the extras for completeness?</li>
</ul>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<p>Added a couple of tests:</p>
<ol>
<li><code>requests==2.31.0</code> has four dependencies that would be ordered differently unless sorted. Additionally, it has two dependencies that are optionally included for extras.</li>
<li><code>pandas==2.1.3</code> depends on different versions of <code>numpy</code> depending on the python version used.</li>
</ol>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ChannyClaus on 2024-03-10 23:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-03-10 23:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/tests/pip_show.rs</code>:119 on 2024-03-10 23:46</div>
            <div class="timeline-body"><p>not super clear why windows doesn't pull <code>tzdata</code> https://github.com/astral-sh/uv/actions/runs/8225296455/job/22490152644; seems like it's not a platform-dependent dependency https://github.com/pandas-dev/pandas/blob/871f01b5582fc737a63f17c1d9027eb6a2099912/pyproject.toml#L37. may continue to look while having this open for review ðŸ˜­ (probably not a blocking issue?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-03-11 08:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/pip_show.rs</code>:119 on 2024-03-11 08:05</div>
            <div class="timeline-body"><p>We have a windows filter hack in the snapshots for our common test packages: https://github.com/astral-sh/uv/blob/1181aa9be40b7f99334f7efd15d5102653d8b38b/crates/uv/tests/common/mod.rs#L370-L376</p>
<p>Could you use a pure python package for the test case? Pandas and numpy wheel are big due to their native modules (something like 5-20 MB) and since we run the tests with no cache these add up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-03-11 11:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/tests/pip_show.rs</code>:119 on 2024-03-11 11:41</div>
            <div class="timeline-body"><p>updated to use <code>click</code>.</p>
<pre><code>$ du -sh /Users/chan.kang/test/uv/venv/lib/python3.12/site-packages/click
824K	/Users/chan.kang/test/uv/venv/lib/python3.12/site-packages/click
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @ChannyClaus on 2024-03-11 13:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/pip_show.rs</code>:130 on 2024-03-11 16:57</div>
            <div class="timeline-body"><p>Can you try collecting into a <code>BTreeSet</code> instead? There are some cases where names occur twice in the requirements. This would remove those duplicates and skip the sorting step</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/pip_show.rs</code>:124 on 2024-03-11 16:58</div>
            <div class="timeline-body"><p>Can you move this to the test function docstring with an extra sentence about the test?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-11 16:58</div>
            <div class="timeline-body"><blockquote>
<p>Should uv pip show support extras? pip has an open issue for it, but currently does not support https://github.com/pypa/pip/issues/4824.</p>
</blockquote>
<p>That would be a nice addition, feel free to make a follow-up PR.</p>
<blockquote>
<p>Relatedly, Requred-by field (not implemented in this PR) in pip show currently doesn't take the extras into account transparently, i.e. when PySocks has been installed as an extra for requests[socks], pip show PySocks doesn't have requests or requests[socks] under Requred-by field. Should uv pip show for now just replicate pip's behavior for now for simplicity and parity or try to cover the extras for completeness?</p>
</blockquote>
<p>There's unfortunately no tracking for which extras get installed, so we don't know if an extra was activated or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-03-11 16:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ChannyClaus">@ChannyClaus</a> on <code>crates/uv/src/commands/pip_show.rs</code>:130 on 2024-03-12 02:40</div>
            <div class="timeline-body"><p>Do you happen to remember which particular package has duplicates (was thinking if I should add a test using it)? https://github.com/pypa/pip/blob/fb5f63f0f4c3a204ada8353ce9858d4d4b777c2a/src/pip/_internal/commands/show.py#L104 does seem to suggest the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ChannyClaus">@ChannyClaus</a> reviewed on 2024-03-12 02:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @ChannyClaus on 2024-03-12 02:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-03-12 04:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-03-12 04:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @charliermarsh on 2024-03-12 04:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "implement "Requires" field in `pip show`" to "Implement "Requires" field in `pip show`" by @charliermarsh on 2024-03-12 04:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-03-12 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-12 04:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:36:01 UTC
    </footer>
</body>
</html>
