<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatically install Python version needed for tool - astral-sh/uv #7827</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Automatically install Python version needed for tool</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/7827">#7827</a>
        opened by <a href="https://github.com/tfsingh">@tfsingh</a>
        on 2024-10-01 05:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/tfsingh">@tfsingh</a> on 2024-10-01 05:32</div>
            <div class="timeline-body"><p>This PR adds support for automatically installing the Python version required for a given tool, should it not already be installed.</p>
<p>(Tests I added fails, working on it)</p>
<p>Closes #6381</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tfsingh">@tfsingh</a> reviewed on 2024-10-01 06:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tfsingh">@tfsingh</a> on <code>crates/uv/src/commands/tool/install.rs</code>:398 on 2024-10-01 06:09</div>
            <div class="timeline-body"><p>I'm looking for the best way to derive the necessary Python version error from a <a href="https://github.com/astral-sh/uv/blob/1602b5c8d7c63ef175e0fe1bb5088c6e9f8f26b1/crates/uv-resolver/src/error.rs#L108">NoSolutionError</a> instance (potentially via a combination of an explicit call to fmt/regex?). Will keep digging, but open to thoughts on how best to approach this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-01 14:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/tool/install.rs</code>:398 on 2024-10-01 14:09</div>
            <div class="timeline-body"><p>Python requirements are tracked as incompatibilities in the resolver https://github.com/astral-sh/uv/blob/fe88c108136f689c54bc5a9c15df472433d36312/crates/uv-resolver/src/resolver/mod.rs#L2223-L2234 so you should have a <code>External::FromDependencyOf</code> with a <code>PubGrubPackageInner::Python</code> package in the derivation tree. I'm not sure this is the best method, but should be feasible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-01 19:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/error.rs</code>:207 on 2024-10-01 19:47</div>
            <div class="timeline-body"><p>If you're going to sort and take one value in the end shouldn't you just track the lowest version in an <code>Option&lt;Version&gt;</code> in <code>find_required_python_versions</code> instead of collecting a <code>Vec</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tfsingh">@tfsingh</a> on <code>crates/uv-resolver/src/error.rs</code>:207 on 2024-10-01 20:20</div>
            <div class="timeline-body"><p>That def makes more sense for these purposes — I think I originally thought it best to make the helper return a vector in case there were multiple missing versions but:</p>
<ol>
<li>I'm not certain if that's possible?</li>
<li>Even if it is, it's unlikely there'd be a case where someone doesn't just want the maximum</li>
</ol>
<p>I'll go ahead and make this change</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tfsingh">@tfsingh</a> reviewed on 2024-10-01 20:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tfsingh">@tfsingh</a> on 2024-10-01 21:21</div>
            <div class="timeline-body"><p>@zanieb Is there precedent for installing Python versions via an override of <code>UV_PYTHON_DOWNLOADS</code>/<code>UV_PYTHON_PREFERENCE</code> in tests? I think it might be unnecessary to write formal tests for this as it's more of an enhancement, and a test that does a Python installation might worsen already long CI times. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-01 21:43</div>
            <div class="timeline-body"><p>Yeah we need to figure out a testing strategy for that but haven't yet. The idea is to setup <code>UV_PYTHON_INSTALL_MIRROR</code> to a local cache of fake interpreters or something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tfsingh">@tfsingh</a> on 2024-10-01 22:00</div>
            <div class="timeline-body"><p>Got it, that makes a lot of sense — thanks again for the feedback!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @tfsingh on 2024-10-01 22:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-01 22:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/error.rs</code>:222 on 2024-10-01 22:08</div>
            <div class="timeline-body"><p>We shouldn't have to collect here, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/error.rs</code>:238 on 2024-10-01 22:08</div>
            <div class="timeline-body"><p>This clone seems avoidable</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-01 22:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tfsingh">@tfsingh</a> reviewed on 2024-10-01 22:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tfsingh">@tfsingh</a> on <code>crates/uv-resolver/src/error.rs</code>:222 on 2024-10-01 22:30</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tfsingh">@tfsingh</a> reviewed on 2024-10-01 22:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tfsingh">@tfsingh</a> on <code>crates/uv-resolver/src/error.rs</code>:238 on 2024-10-01 22:31</div>
            <div class="timeline-body"><p>TIL .take() :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @tfsingh on 2024-10-01 22:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @tfsingh on 2024-12-02 05:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:13 UTC
    </footer>
</body>
</html>
