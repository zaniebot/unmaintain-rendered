<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running `uv lock --check` with outdated lockfile will print that `--check` was passed, instead of `--locked`  - astral-sh/uv #16322</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Running <code>uv lock --check</code> with outdated lockfile will print that <code>--check</code> was passed, instead of <code>--locked</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/16322">#16322</a>
        opened by <a href="https://github.com/cmnemoi">@cmnemoi</a>
        on 2025-10-15 18:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/cmnemoi">@cmnemoi</a> on 2025-10-15 18:27</div>
            <div class="timeline-body"><p>Hello,</p>
<h1>Summary</h1>
<p>This PR fixes the confusing error message when running <code>uv lock --check</code> with an outdated lockfile.</p>
<p>Previously, the error message incorrectly stated that <code>--locked</code> was provided, even when the user used <code>--check</code>.</p>
<p>Now, the error message correctly indicates which flag was used: either <code>--check</code> or <code>--locked</code>.</p>
<p>This closes #14105.</p>
<h1>Test plan</h1>
<ul>
<li>I updated the existing integration test (<code>check_outdated_lock</code> in <code>lock.rs</code>) to verify the new error message includes the correct flag.</li>
<li>I ran existing tests to ensure I have no introduced regressions for other commands.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-15 23:06</div>
            <div class="timeline-body"><p>I was imaging instead setting up a type like <code>Mode::Lock | Mode::Check(CheckSource::Check | CheckSource::Locked)</code> instead  of a <code>bool</code> so we can report this value appropriately?</p>
<p>sort of like https://github.com/astral-sh/uv/blob/b4168e665e585dff4e21cef352aa2c8a438c4f29/crates/uv/src/commands/tool/run.rs#L65-L72 or https://github.com/astral-sh/uv/blob/13a976a89763442c5fb13e1db3804c9e9920968c/crates/uv/src/commands/python/install.rs#L153-L176</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cmnemoi">@cmnemoi</a> on 2025-10-16 07:15</div>
            <div class="timeline-body"><p>@zanieb Thanks for the review, I applied necessary changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "fix: Running `uv lock --check` with outdated lockfile will print that `--check` or `--locked` was passed, instead of `--locked` only" to "fix: Running `uv lock --check` with outdated lockfile will print that `--check` was passed, instead of `--locked` " by @cmnemoi on 2025-10-16 07:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "fix: Running `uv lock --check` with outdated lockfile will print that `--check` was passed, instead of `--locked` " to "Running `uv lock --check` with outdated lockfile will print that `--check` was passed, instead of `--locked` " by @konstin on 2025-10-20 18:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @konstin on 2025-10-21 11:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-10-21 11:15</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-10-21 13:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3731 on 2025-10-21 13:47</div>
            <div class="timeline-body"><p>We should hide this one, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/add.rs</code>:183 on 2025-10-21 13:49</div>
            <div class="timeline-body"><p>Shouldn't we use the source in this warning message?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-10-21 13:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/add.rs</code>:981 on 2025-10-21 13:50</div>
            <div class="timeline-body"><p>We should use <code>if let LockCheck::Enabled(source) = lock_check {</code> so you can avoid the <code>unwrap</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-10-21 13:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-10-21 13:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/add.rs</code>:981 on 2025-10-21 13:50</div>
            <div class="timeline-body"><p>(there are some more instances of this following)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/add.rs</code>:183 on 2025-10-21 13:50</div>
            <div class="timeline-body"><p>(there are some more instances of this following)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-10-21 13:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-10-21 13:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:13143 on 2025-10-21 13:52</div>
            <div class="timeline-body"><p>I'm a bit confused that the setup for this test case changed. Why did it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-21 13:53</div>
            <div class="timeline-body"><p>Nice! That's what I had in mind :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cmnemoi">@cmnemoi</a> reviewed on 2025-10-21 14:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/cmnemoi">@cmnemoi</a> on <code>crates/uv/tests/it/lock.rs</code>:13143 on 2025-10-21 14:24</div>
            <div class="timeline-body"><p>This is from my old implementation.</p>
<p>I badly reverted the test case I added for that, I will fix that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cmnemoi">@cmnemoi</a> on 2025-10-21 15:01</div>
            <div class="timeline-body"><p>@zanieb Thanks for the insightful review again, I applied needed changes :+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-10-21 17:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-10-21 17:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-10-21 17:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:31 UTC
    </footer>
</body>
</html>
