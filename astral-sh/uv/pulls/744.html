<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Always pre-fetch distribution metadata - astral-sh/uv #744</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Always pre-fetch distribution metadata</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/744">#744</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-01-02 20:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>This PR fixes our prefetching logic to ensure that we always attempt to prefetch the &quot;best-guess&quot; distribution for all dependencies. This logic already existed, but because we only attempted to prefetch when package metadata was available, it almost never triggered. Now, we wait for the package metadata to become available, <em>then</em> kick off the &quot;best-guess&quot; prefetch (for every package).</p>
<p>In my testing, this dramatically improves performance (like 2x). I&#x27;m wondering if this regressed at some point?</p>
<p>Closes #743.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-02 20:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-02 20:59</div>
            <div class="timeline-body"><p>@konstin - Would you mind generating your same span graphs here? (Also feel free to merge as you like.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-02 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-01-02 21:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver.rs</code>:791 on 2024-01-02 21:04</div>
            <div class="timeline-body"><p>This is identical to the <code>Requires::Dist</code> case above, but making it recursive requires boxing the async function ðŸ‘Ž</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-03 10:34</div>
            <div class="timeline-body"><p><code>black</code> before:
<img src="https://github.com/astral-sh/puffin/assets/6826232/dbcf1ec5-d1ef-415e-9890-8c3980c00984" alt="black-no-cache"></p>
<p><code>black</code> after:
<img src="https://github.com/astral-sh/puffin/assets/6826232/fbc695f0-123c-420b-9b42-72ff5f6c82bb" alt="black-no-cache"></p>
<p><code>meine_stadt_transparent</code> before:
<img src="https://github.com/astral-sh/puffin/assets/6826232/cefeab78-5fdb-44ed-92e4-2def509aa806" alt="meine_stadt_transparent-no-cache"></p>
<p><code>meine_stadt_transparent</code> after:
<img src="https://github.com/astral-sh/puffin/assets/6826232/b77dc2ba-6a6f-49d2-9e1a-473c3ded6dde" alt="meine_stadt_transparent-no-cache"></p>
<p><code>jupyter</code> before:
<img src="https://github.com/astral-sh/puffin/assets/6826232/6ea168ee-1630-4190-afca-091fde1650a7" alt="jupyter-no-cache"></p>
<p><code>jupyter</code> after:
<img src="https://github.com/astral-sh/puffin/assets/6826232/70934f6e-5959-4c5b-9feb-b9da8a2e3028" alt="jupyter-no-cache"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-01-03 10:37</div>
            <div class="timeline-body"><p>:rocket:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2024-01-03 10:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-01-03 10:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-03 10:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:43:00 UTC
    </footer>
</body>
</html>
