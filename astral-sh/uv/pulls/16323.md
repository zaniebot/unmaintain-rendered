```yaml
number: 16323
title: Error when there is an authentication failure in check URL
type: pull_request
state: open
author: konstin
labels:
  - bug
  - breaking
assignees: []
draft: true
base: main
head: konsti/error-on-authentication-error-in-check-url
created_at: 2025-10-15T18:44:36Z
updated_at: 2025-12-05T10:31:57Z
url: https://github.com/astral-sh/uv/pull/16323
synced_at: 2026-01-10T01:57:38Z
```

# Error when there is an authentication failure in check URL

---

_Pull request opened by @konstin on 2025-10-15 18:44_

Currently, when `--check-url` or the index URL from `--index` returns a 401 or 403, we continue with the update, not actually performing the check. Instead, we now error and hint at missing check URL credentials.

There are two ways this change could go wrong:

* Someone publishes a new package to an index that sends 401 or 403 for missing packages (torch is known to do this, but is also not a regular upload target)
* Someone publishes to an index with invalid credentials, but didn't realize that they were invalid due to this bug

Fixes #16073


---

_Label `bug` added by @konstin on 2025-10-15 18:44_

---

_@charliermarsh reviewed on 2025-10-27 02:03_

---

_Review comment by @charliermarsh on `crates/uv-publish/src/lib.rs`:567 on 2025-10-27 02:03_

I kind of feel like this should be returning a different variant?

---

_@charliermarsh reviewed on 2025-10-27 13:50_

---

_Review comment by @charliermarsh on `crates/uv-publish/src/lib.rs`:572 on 2025-10-27 13:50_

is it not possible to propagate the status code to the error itself? It seems awkward to use the index capabilities here. Those capabilities could be set by some other failing request.

---

_@konstin reviewed on 2025-10-27 16:19_

---

_Review comment by @konstin on `crates/uv-publish/src/lib.rs`:572 on 2025-10-27 16:19_

The typing is still kinda wrong (single vs. multiple errors), but it's cleaner now.

---

_Label `breaking` added by @zanieb on 2025-10-27 16:36_

---

_Comment by @zanieb on 2025-10-27 16:36_

I worry this will cause breakage.

---

_Comment by @konstin on 2025-10-27 17:49_

Should we get this into 0.10?

---

_Comment by @zanieb on 2025-10-27 19:41_

That seems like a reasonable goal â€” it's on my todo list to review the change still though. I'm a little wary of making this fatal in general, since it's sort of a "nice to have" check and publish can still succeed?

---

_Comment by @konstin on 2025-12-02 15:17_

The question is basically which kind of failure is worse, check-url not working when you need it (e.g. for CI publish retries), or annoying users be requiring them to have valid read credentials for a publish job.

---

_Converted to draft by @konstin on 2025-12-05 10:31_

---
