<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for relative durations in `exclude-newer` - astral-sh/uv #16814</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for relative durations in `exclude-newer`</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/16814">#16814</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-11-21 21:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-21 21:59</div>
            <div class="timeline-body"><p>Adds support for &quot;friendly&quot; durations like, 1 week, 7 days, 24 hours using Jiff's parser. During resolution, we calculate this relative to the current time and resolve it into a concrete timestamp for the lockfile. If the span has not changed, e.g., to another relative value, then locking again will not change the lockfile. The locked timestamp will only be updated when the lockfile is invalidated, e.g., with <code>--upgrade</code>. This prevents the lockfile from repeatedly churning when a relative value is used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/namurphy">@namurphy</a> on 2025-11-26 22:55</div>
            <div class="timeline-body"><p>Thank you for doing this!  I'm going to start using this feature immediately after 48 hours after it's released! ðŸ˜¹</p>
<p>I'm wondering if it would be helpful to add the term &quot;cooldown&quot; in the documentation for <code>--exclude-newer</code> since it's been gaining traction, and might be what a lot of people would do web searches for. ðŸ¤”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-06 13:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/exclude_newer.rs</code>:275 on 2025-12-06 13:58</div>
            <div class="timeline-body"><p>Unfortunately this error message is pretty bad. I'm not sure what the best way to fix it is though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:3045 on 2025-12-06 15:47</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// (e.g., `2006-12-02`, resolved based on your system's configured time zone), and relative durations
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-12-06 15:51</div>
            <div class="timeline-body"><p>This seems quite reasonable to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 18:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/concepts/resolution.md</code>:694 on 2025-12-09 18:58</div>
            <div class="timeline-body"><p>@woodruffw want to review this copy?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2025-12-09 18:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:3092 on 2025-12-09 19:03</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// number of seconds assuming that a day is 24 hours (e.g., DST transitions are ignored).
</code></pre>
<p>Since DST transitions are just one example of discontinuities or repetitions in civil time. (The main other one being much rarer: when the standard time zone for a locale changes.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:3088 on 2025-12-09 19:05</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// duration (e.g., `24 hours`, `1 week`, `30 days`), or an ISO 8601 duration (e.g., `PT24H`,
</code></pre>
<p>For ISO 8601, the <code>T</code> designator has to be used to denote time units. So e.g., <code>P1DT12H</code> is 1 day 12 hours.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:3107 on 2025-12-09 19:05</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// number of seconds assuming that a day is 24 hours (e.g., DST transitions are ignored).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:3103 on 2025-12-09 19:05</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// (e.g., `24 hours`, `1 week`, `30 days`), or a ISO 8601 duration (e.g., `PT24H`, `P7D`,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:5598 on 2025-12-09 19:06</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// duration (e.g., `24 hours`, `1 week`, `30 days`), or an ISO 8601 duration (e.g., `PT24H`,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:5602 on 2025-12-09 19:06</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// number of seconds assuming that a day is 24 hours (e.g., DST transitions are ignored).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:5613 on 2025-12-09 19:06</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// (e.g., `24 hours`, `1 week`, `30 days`), or an ISO 8601 duration (e.g., `PT24H`, `P7D`,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:5617 on 2025-12-09 19:06</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// number of seconds assuming that a day is 24 hours (e.g., DST transitions are ignored).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:6570 on 2025-12-09 19:06</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// duration (e.g., `24 hours`, `1 week`, `30 days`), or an ISO 8601 duration (e.g., `PT24H`,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:6574 on 2025-12-09 19:07</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// number of seconds assuming that a day is 24 hours (e.g., DST transitions are ignored).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-cli/src/lib.rs</code>:6574 on 2025-12-09 19:07</div>
            <div class="timeline-body"><p>OK, I'll stop marking these. I ran out of steam lol.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-resolver/src/exclude_newer.rs</code>:166 on 2025-12-09 19:09</div>
            <div class="timeline-body"><p>It's probably fine to make this <code>Copy</code> since <code>Span</code> is also <code>Copy</code>. That will let you drop some <code>.clone()</code> calls.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2025-12-09 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-resolver/src/exclude_newer.rs</code>:191 on 2025-12-09 19:10</div>
            <div class="timeline-body"><p>I might add a note here that calls out that this will serialize to an ISO 8601 duration and that this was specifically intended for reasons of interoperability. That is, even though the &quot;friendly&quot; format is arguably more readable, the ISO 8601 format enjoys broader support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-resolver/src/exclude_newer.rs</code>:324 on 2025-12-09 19:16</div>
            <div class="timeline-body"><p>Nice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-resolver/src/exclude_newer.rs</code>:525 on 2025-12-09 19:18</div>
            <div class="timeline-body"><p>Maybe...</p>
<pre><code class="language-rust">let Some(other_timestamp) = other.get(package) else {
    return Some(ExcludeNewerPackageChange::PackageRemoved(package.clone()));
};
...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-resolver/src/exclude_newer.rs</code>:640 on 2025-12-09 19:20</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            &quot;description&quot;: &quot;Exclude distributions uploaded after the given timestamp.\n\nAccepts both RFC 3339 timestamps (e.g., `2006-12-02T02:07:43Z`) and local dates in the same format (e.g., `2006-12-02`), as well as relative durations (e.g., `1 week`, `30 days`, `6 months`). Relative durations are resolved to a timestamp at lock time.&quot;,
</code></pre>
<p>I feel like &quot;absolute timestamp&quot; sounds a little funny. Not a strong opinion here though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2025-12-09 19:25</div>
            <div class="timeline-body"><p>LGTM with some nits. :-) Nice work on the error messages!!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 19:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/exclude_newer.rs</code>:640 on 2025-12-09 19:27</div>
            <div class="timeline-body"><p>Fair enough!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-12-09 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-12-09 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-09 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GeoVizNow">@GeoVizNow</a> on 2026-01-06 16:55</div>
            <div class="timeline-body"><p>Wonderful, thanks a lot for implementing this!!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:43:35 UTC
    </footer>
</body>
</html>
