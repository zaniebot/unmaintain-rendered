<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Rust crate thiserror to v2 - astral-sh/uv #9006</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Update Rust crate thiserror to v2</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/9006">#9006</a>
        opened by <a href="https://github.com/renovate">@renovate</a>
        on 2024-11-11 03:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/renovate">@renovate</a></div>
            <div class="timeline-body"><p>This PR contains the following updates:</p>
<p>| Package | Type | Update | Change |
|---|---|---|---|
| <a href="https://redirect.github.com/dtolnay/thiserror">thiserror</a> | dev-dependencies | major | <code>1.0.56</code> -&gt; <code>2.0.0</code> |
| <a href="https://redirect.github.com/dtolnay/thiserror">thiserror</a> | workspace.dependencies | major | <code>1.0.63</code> -&gt; <code>2.0.0</code> |</p>
<hr />
<h3>Release Notes</h3>
<details>
<summary>dtolnay/thiserror (thiserror)</summary>

<h3><a href="https://redirect.github.com/dtolnay/thiserror/releases/tag/2.0.3"><code>v2.0.3</code></a></h3>
<p><a href="https://redirect.github.com/dtolnay/thiserror/compare/2.0.2...2.0.3">Compare Source</a></p>
<ul>
<li>Support the same Path field being repeated in both Debug and Display representation in error message (<a href="https://redirect.github.com/dtolnay/thiserror/issues/383">#‚Äã383</a>)</li>
<li>Improve error message when a format trait used in error message is not implemented by some field (<a href="https://redirect.github.com/dtolnay/thiserror/issues/384">#‚Äã384</a>)</li>
</ul>
<h3><a href="https://redirect.github.com/dtolnay/thiserror/releases/tag/2.0.2"><code>v2.0.2</code></a></h3>
<p><a href="https://redirect.github.com/dtolnay/thiserror/compare/2.0.1...2.0.2">Compare Source</a></p>
<ul>
<li>Fix hang on invalid input inside #[error(...)] attribute (<a href="https://redirect.github.com/dtolnay/thiserror/issues/382">#‚Äã382</a>)</li>
</ul>
<h3><a href="https://redirect.github.com/dtolnay/thiserror/releases/tag/2.0.1"><code>v2.0.1</code></a></h3>
<p><a href="https://redirect.github.com/dtolnay/thiserror/compare/2.0.0...2.0.1">Compare Source</a></p>
<ul>
<li>Support errors that contain a dynamically sized final field (<a href="https://redirect.github.com/dtolnay/thiserror/issues/375">#‚Äã375</a>)</li>
<li>Improve inference of trait bounds for fields that are interpolated multiple times in an error message (<a href="https://redirect.github.com/dtolnay/thiserror/issues/377">#‚Äã377</a>)</li>
</ul>
<h3><a href="https://redirect.github.com/dtolnay/thiserror/releases/tag/2.0.0"><code>v2.0.0</code></a></h3>
<p><a href="https://redirect.github.com/dtolnay/thiserror/compare/1.0.69...2.0.0">Compare Source</a></p>
<h4>Breaking changes</h4>
<ul>
<li><p>Referencing keyword-named fields by a raw identifier like <code>{r#type}</code> inside a format string is no longer accepted; simply use the unraw name like <code>{type}</code> (<a href="https://redirect.github.com/dtolnay/thiserror/issues/347">#‚Äã347</a>)</p>
<p>This aligns thiserror with the standard library's formatting macros, which gained support for implicit argument capture later than the release of this feature in thiserror 1.x.</p>
<pre><code class="language-rust">#[derive(Error, Debug)]
#[error(&quot;... {type} ...&quot;)]  // Before: {r#type}
pub struct Error {
    pub r#type: Type,
}
</code></pre>
</li>
<li><p>Trait bounds are no longer inferred on fields whose value is shadowed by an explicit named argument in a format message (<a href="https://redirect.github.com/dtolnay/thiserror/issues/345">#‚Äã345</a>)</p>
<pre><code class="language-rust">// Before: impl&lt;T: Octal&gt; Display for Error&lt;T&gt;
// After: impl&lt;T&gt; Display for Error&lt;T&gt;
#[derive(Error, Debug)]
#[error(&quot;{thing:o}&quot;, thing = &quot;...&quot;)]
pub struct Error&lt;T&gt; {
    thing: T,
}
</code></pre>
</li>
<li><p>Tuple structs and tuple variants can no longer use numerical <code>{0}</code> <code>{1}</code> access at the same time as supplying extra positional arguments for a format message, as this makes it ambiguous whether the number refers to a tuple field vs a different positional arg (<a href="https://redirect.github.com/dtolnay/thiserror/issues/354">#‚Äã354</a>)</p>
<pre><code class="language-rust">#[derive(Error, Debug)]
#[error(&quot;ambiguous: {0} {}&quot;, $N)]
//                  ^^^ Not allowed, use #[error(&quot;... {0} {n}&quot;, n = $N)]
pub struct TupleError(i32);
</code></pre>
</li>
<li><p>Code containing invocations of thiserror's <code>derive(Error)</code> must now have a direct dependency on the <code>thiserror</code> crate regardless of the error data structure's contents (<a href="https://redirect.github.com/dtolnay/thiserror/issues/368">#‚Äã368</a>, <a href="https://redirect.github.com/dtolnay/thiserror/issues/369">#‚Äã369</a>, <a href="https://redirect.github.com/dtolnay/thiserror/issues/370">#‚Äã370</a>, <a href="https://redirect.github.com/dtolnay/thiserror/issues/372">#‚Äã372</a>)</p>
</li>
</ul>
<h4>Features</h4>
<ul>
<li><p>Support disabling thiserror's standard library dependency by disabling the default &quot;std&quot; Cargo feature: <code>thiserror = { version = &quot;2&quot;, default-features = false }</code> (<a href="https://redirect.github.com/dtolnay/thiserror/issues/373">#‚Äã373</a>)</p>
</li>
<li><p>Support using <code>r#source</code> as field name to opt out of a field named &quot;source&quot; being treated as an error's <code>Error::source()</code> (<a href="https://redirect.github.com/dtolnay/thiserror/issues/350">#‚Äã350</a>)</p>
<pre><code class="language-rust">#[derive(Error, Debug)]
#[error(&quot;{source} ==&gt; {destination}&quot;)]
pub struct Error {
    r#source: char,
    destination: char,
}

let error = Error { source: 'S', destination: 'D' };
</code></pre>
</li>
<li><p>Infinite recursion in a generated Display impl now produces an <code>unconditional_recursion</code> warning (<a href="https://redirect.github.com/dtolnay/thiserror/issues/359">#‚Äã359</a>)</p>
<pre><code class="language-rust">#[derive(Error, Debug)]
#[error(&quot;??? {self}&quot;)]
pub struct Error;
</code></pre>
</li>
<li><p>A new attribute <code>#[error(fmt = path::to::myfmt)]</code> can be used to write formatting logic for an enum variant out-of-line (<a href="https://redirect.github.com/dtolnay/thiserror/issues/367">#‚Äã367</a>)</p>
<pre><code class="language-rust">#[derive(Error, Debug)]
pub enum Error {
    #[error(fmt = demo_fmt)]
    Demo { code: u16, message: Option&lt;String&gt; },
}

fn demo_fmt(code: &amp;u16, message: &amp;Option&lt;String&gt;, formatter: &amp;mut fmt::Formatter) -&gt; fmt::Result {
    write!(formatter, &quot;{code}&quot;)?;
    if let Some(msg) = message {
        write!(formatter, &quot; - {msg}&quot;)?;
    }
    Ok(())
}
</code></pre>
</li>
<li><p>Enums with an enum-level format message are now able to have individual variants that are <code>transparent</code> to supersede the enum-level message (<a href="https://redirect.github.com/dtolnay/thiserror/issues/366">#‚Äã366</a>)</p>
<pre><code class="language-rust">#[derive(Error, Debug)]
#[error(&quot;my error {0}&quot;)]
pub enum Error {
    Json(#[from] serde_json::Error),
    Yaml(#[from] serde_yaml::Error),
    #[error(transparent)]
    Other(#[from] anyhow::Error),
}
</code></pre>
</li>
</ul>
<h3><a href="https://redirect.github.com/dtolnay/thiserror/releases/tag/1.0.69"><code>v1.0.69</code></a></h3>
<p><a href="https://redirect.github.com/dtolnay/thiserror/compare/1.0.68...1.0.69">Compare Source</a></p>
<ul>
<li>Backport 2.0.2 fixes</li>
</ul>
<h3><a href="https://redirect.github.com/dtolnay/thiserror/releases/tag/1.0.68"><code>v1.0.68</code></a></h3>
<p><a href="https://redirect.github.com/dtolnay/thiserror/compare/1.0.67...1.0.68">Compare Source</a></p>
<ul>
<li>Handle incomplete expressions more robustly in format arguments, such as while code is being typed (<a href="https://redirect.github.com/dtolnay/thiserror/issues/341">#‚Äã341</a>, <a href="https://redirect.github.com/dtolnay/thiserror/issues/344">#‚Äã344</a>)</li>
</ul>
</details>

<hr />
<h3>Configuration</h3>
<p>üìÖ <strong>Schedule</strong>: Branch creation - &quot;before 4am on Monday&quot; (UTC), Automerge - At any time (no schedule defined).</p>
<p>üö¶ <strong>Automerge</strong>: Disabled by config. Please merge this manually once you are satisfied.</p>
<p>‚ôª <strong>Rebasing</strong>: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.</p>
<p>üîï <strong>Ignore</strong>: Close this PR and you won't be reminded about these updates again.</p>
<hr />
<ul>
<li>[ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box</li>
</ul>
<hr />
<p>This PR was generated by <a href="https://mend.io/renovate/">Mend Renovate</a>. View the <a href="https://developer.mend.io/github/astral-sh/uv">repository job log</a>.</p>
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS43LjEiLCJ1cGRhdGVkSW5WZXIiOiIzOS43LjEiLCJ0YXJnZXRCcmFuY2giOiJtYWluIiwibGFiZWxzIjpbImludGVybmFsIl19-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @renovate[bot] on 2024-11-11 03:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/renovate[bot]">@renovate[bot]</a> on 2024-11-11 03:14</div>
            <div class="timeline-body"><h3>‚ö†Ô∏è Artifact update problem</h3>
<p>Renovate failed to update an artifact related to this branch. You probably do not want to merge this PR as-is.</p>
<p>‚ôª Renovate will retry this branch, including artifacts, only when one of the following happens:</p>
<ul>
<li>any of the package files in this branch needs updating, or</li>
<li>the branch becomes conflicted, or</li>
<li>you click the rebase/retry checkbox if found above, or</li>
<li>you rename this PR's title to start with &quot;rebase!&quot; to trigger it manually</li>
</ul>
<p>The artifact failure details are included below:</p>
<h5>File name: Cargo.lock</h5>
<pre><code>Command failed: cargo update --config net.git-fetch-with-cli=true --manifest-path Cargo.toml --package thiserror@1.0.67 --precise 2.0.3
    Updating crates.io index
error: failed to select a version for the requirement `thiserror = &quot;^1.0.21&quot;`
candidate versions found which didn't match: 2.0.3
location searched: crates.io index
required by package `reqwest-middleware v0.3.3 (https://github.com/TrueLayer/reqwest-middleware?rev=d95ec5a99fcc9a4339e1850d40378bbfe55ab121#d95ec5a9)`
    ... which satisfies git dependency `reqwest-middleware` (locked to 0.3.3) of package `uv-auth v0.0.1 (/tmp/renovate/repos/github/astral-sh/uv/crates/uv-auth)`
    ... which satisfies path dependency `uv-auth` (locked to 0.0.1) of package `uv v0.5.1 (/tmp/renovate/repos/github/astral-sh/uv/crates/uv)`

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-11-15 15:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-11-15 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-11-15 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-15 15:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:40:34 UTC
    </footer>
</body>
</html>
