<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactor batch prefetch - astral-sh/uv #10349</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Refactor batch prefetch</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/10349">#10349</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2025-01-07 09:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2025-01-07 09:40</div>
            <div class="timeline-body"><p>Ref https://github.com/astral-sh/uv/issues/10344</p>
<p>The first commit split determining and executing batch prefetch. The second commit splits out a batch prefetch runner type. It comes from a failed attempt to use threading for the batch prefetch, separating the concerns between deciding whether to prefetch (resolver thread) and executing the prefetch (potentially expensive, possible to move to another thread).</p>
<p>No functional changes.</p>
<p>I have confirmed that urllib3/boto3/botocore is still fast (<code>uv pip compile --no-cache-dir scripts/requirements/boto3.in</code> gives <code>Resolved 7 packages in 1.21s</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2025-01-07 09:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2025-01-07 09:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-01-07 09:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-resolver/src/resolver/batch_prefetch.rs</code>:328 on 2025-01-07 09:41</div>
            <div class="timeline-body"><p>Should this live somewhere shared?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-01-07 13:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-07 13:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/resolver/batch_prefetch.rs</code>:328 on 2025-01-07 13:53</div>
            <div class="timeline-body"><p>I think it's alright for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2025-01-07 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-01-07 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-07 13:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:17 UTC
    </footer>
</body>
</html>
