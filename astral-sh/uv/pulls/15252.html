<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `extra-build-dependencies` hint for any missing module on build failure - astral-sh/uv #15252</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>extra-build-dependencies</code> hint for any missing module on build failure</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/15252">#15252</a>
        opened by <a href="https://github.com/blueraft">@blueraft</a>
        on 2025-08-13 16:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/blueraft">@blueraft</a> on 2025-08-13 16:00</div>
            <div class="timeline-body"><p>Alternative to https://github.com/astral-sh/uv/pull/15251.</p>
<p>As suggested in https://github.com/astral-sh/uv/issues/15118#issuecomment-3175735416</p>
<h2>Test Plan</h2>
<p><code>cargo test</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-13 20:11</div>
            <div class="timeline-body"><p>Sorry I broke <code>main</code>!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-13 20:29</div>
            <div class="timeline-body"><p>I think you can test this with something like https://github.com/astral-sh/uv/blob/323aa8f3324a2faaf286ad3a6bb84113c2d69e52/crates/uv/tests/it/sync.rs#L1571-L1601</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-13 20:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/sync.rs</code>:1416 on 2025-08-13 20:30</div>
            <div class="timeline-body"><p>I think we just want to use the package name throughout here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blueraft">@blueraft</a> reviewed on 2025-08-13 21:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/blueraft">@blueraft</a> on <code>crates/uv/tests/it/sync.rs</code>:1416 on 2025-08-13 21:06</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-13 21:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-build-frontend/src/error.rs</code>:217 on 2025-08-13 21:43</div>
            <div class="timeline-body"><p>This seems workable but is a little weird? I wonder if we can parse the filename instead? I'm not entirely sure what's best. @charliermarsh may have thoughts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blueraft">@blueraft</a> reviewed on 2025-08-14 10:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/blueraft">@blueraft</a> on <code>crates/uv-build-frontend/src/error.rs</code>:217 on 2025-08-14 10:58</div>
            <div class="timeline-body"><p>I found this function https://github.com/astral-sh/uv/blob/c4e5984258c13204bd0aedd183a93cb16d6b754f/crates/uv-pep508/src/lib.rs#L487</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-14 11:22</div>
            <div class="timeline-body"><p>I'm a little worried about the impact it will have on binary size, did you check a release build before and after?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2025-08-14 12:10</div>
            <div class="timeline-body"><blockquote>
<p>did you check a release build before and after?</p>
</blockquote>
<p>Not much of an increase, only 32kbs more</p>
<pre><code class="language-sh">❯ du -sk uv_with_pipreqs
45240   uv_with_pipreqs
❯ du -sk uv_without_pepreqs
45208   uv_without_pepreqs
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-14 13:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/pip_install.rs</code>:4977 on 2025-08-14 13:06</div>
            <div class="timeline-body"><p>Fwiw this instruction isn't sufficient, because then they also need to install all of the other build dependencies of <code>anyio</code>. I'm hesitant to suggest it without that additional information (and broadly hesitant to suggest it at all).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-14 13:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/pip_install.rs</code>:5048 on 2025-08-14 13:07</div>
            <div class="timeline-body"><p>Can we drop the quotes on the key when they're not needed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-14 13:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-build-frontend/src/error.rs</code>:228 on 2025-08-14 13:08</div>
            <div class="timeline-body"><p>Maybe we should split this into a utility function to make it clear what we're doing. I'd also probably call the variable <code>package_name</code> instead of <code>normalized_version_id</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blueraft">@blueraft</a> reviewed on 2025-08-14 14:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/blueraft">@blueraft</a> on <code>crates/uv/tests/it/pip_install.rs</code>:4977 on 2025-08-14 14:50</div>
            <div class="timeline-body"><p>Yeah I thought about this, but this matches the current hint we give for people facing issues with <code>torch</code> so I figured we shouldn't remove that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-14 14:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/pip_install.rs</code>:4977 on 2025-08-14 14:51</div>
            <div class="timeline-body"><p>I think now that we have the extra build dependencies it's actually okay to remove that, but... I'm okay with considering that separately. Can you open a tracking issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blueraft">@blueraft</a> reviewed on 2025-08-14 14:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/blueraft">@blueraft</a> on <code>crates/uv/tests/it/pip_install.rs</code>:4977 on 2025-08-14 14:58</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/issues/15283</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add pipreqs module-to-package mapping for build time ModuleNotFoundError hints" to "Add `extra-build-dependencies` hint for any missing module on build failure" by @zanieb on 2025-08-14 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-08-14 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-08-14 17:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:29 UTC
    </footer>
</body>
</html>
