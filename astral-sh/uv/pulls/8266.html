<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for reading and resolving `include-group` in dependency groups - astral-sh/uv #8266</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for reading and resolving <code>include-group</code> in dependency groups</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/8266">#8266</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-10-16 18:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-16 18:27</div>
            <div class="timeline-body"><p>Part of #8090</p>
<p>Adds the ability to read group inclusions (<code>include-group = &lt;name&gt;</code>) in the <code>pyproject.toml</code>. Resolves groups into concrete dependencies for resolution.</p>
<p>See https://github.com/astral-sh/uv/pull/8110 for a bit more commentary on deferred work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 18:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-distribution/src/metadata/requires_dist.rs</code>:240 on 2024-10-16 18:28</div>
            <div class="timeline-body"><p>I don't love this implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 18:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-distribution/src/metadata/requires_dist.rs</code>:258 on 2024-10-16 18:29</div>
            <div class="timeline-body"><p>It's unclear to me if we want to track the <em>original</em> group of requirements throughout the resolver for error messages (it seems like it'd be nice, but may be a fair bit of work)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add support for reading `include-group` in dependency groups" to "Add support for reading and resolving `include-group` in dependency groups" by @zanieb on 2024-10-16 18:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:123 on 2024-10-16 21:27</div>
            <div class="timeline-body"><p>I think it's enough for this to be included at the top-level, or is it not?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-16 21:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-16 21:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-distribution/src/metadata/requires_dist.rs</code>:334 on 2024-10-16 21:29</div>
            <div class="timeline-body"><p>I would say just raise here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 21:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:123 on 2024-10-16 21:29</div>
            <div class="timeline-body"><p>This is derived from the implementation at https://github.com/PyO3/pyproject-toml-rs/pull/24 per https://github.com/astral-sh/uv/pull/8104#discussion_r1800654513 ‚Äî I don't have any preference, personally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 21:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-distribution/src/metadata/requires_dist.rs</code>:334 on 2024-10-16 21:30</div>
            <div class="timeline-body"><p>It defies the &quot;SHOULD&quot; recommendation in the PEP, but we will generally need to resolve all groups anyway for locking so I think that's reasonable for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-16 21:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:126 on 2024-10-16 21:32</div>
            <div class="timeline-body"><p>Should this be required?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:128 on 2024-10-16 21:32</div>
            <div class="timeline-body"><p>Do we... want a catch-all variant? So we can catch other objects that are added in the future...? (We might want to error in that case anyway.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-16 21:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-16 21:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:126 on 2024-10-16 21:34</div>
            <div class="timeline-body"><p>If you make this <code>Option&lt;GroupName&gt;</code>, it will simplify some error handling. You can probably then also avoid some <code>GroupName</code> clones (I think <code>parents</code> can become <code>BTreeSet&lt;&amp;GroupName&gt;</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 21:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:126 on 2024-10-16 21:45</div>
            <div class="timeline-body"><p>I had the same thought. I think it's written this way so other fields can be added here in the future then they can be made mutually exclusive or not based on whether or not they're populated? We should probably fail with an empty table though? Or at least warn after deserialization?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:128 on 2024-10-16 21:46</div>
            <div class="timeline-body"><p>I'm not sure. Sounds like a nice property sometimes? We don't do this elsewhere in the <code>pyproject.toml</code> do we?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 21:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-16 21:46</div>
            <div class="timeline-body"><p>As discussed gonna take this one over, will push to this branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-16 22:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/lock.rs</code>:15549 on 2024-10-16 22:27</div>
            <div class="timeline-body"><p>@zanieb -- Good suggestion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-16 22:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:128 on 2024-10-16 22:28</div>
            <div class="timeline-body"><p>Ok the current structure is pretty strict... It rejects empty tables, extra fields, and missing <code>include_group</code>... It does match the reference implementation: https://peps.python.org/pep-0735/#reference-implementation. But I'd say what I have here is too strict though since we're doing eager validation. I think we should just warn if we see unsupported groups.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 22:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:128 on 2024-10-16 22:35</div>
            <div class="timeline-body"><p>Sounds good to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 22:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:15743 on 2024-10-16 22:35</div>
            <div class="timeline-body"><p>Perhaps we should say &quot;in group <code>foo</code>&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-16 22:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/sync.rs</code>:1188 on 2024-10-16 22:36</div>
            <div class="timeline-body"><p>üëç nice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-10-16 23:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2024-10-16 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-10-17 00:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-17 00:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-17 00:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:02:02 UTC
    </footer>
</body>
</html>
