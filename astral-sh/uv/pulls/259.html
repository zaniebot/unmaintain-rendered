<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for `--all-extras` to `pip-compile` - astral-sh/uv #259</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for <code>--all-extras</code> to <code>pip-compile</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/259">#259</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2023-10-31 19:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Closes #244</p>
<p>Notable decision to error if <code>--all-extra</code> and <code>--extra &lt;name&gt;</code> are both provided.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-31 20:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/src/requirements.rs</code>:106 on 2023-10-31 20:27</div>
            <div class="timeline-body"><p>Simple optimization to avoid iterating over (and parsing) the optional dependency groups if the user doesn't want any of them; the rest of this section is indented without change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-31 21:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-cli/src/main.rs</code>:77 on 2023-10-31 21:01</div>
            <div class="timeline-body"><p>Does Clap allow us to also add <code>conflicts_with = &quot;extra&quot;</code> on <code>all_extras</code>? I know it's redundant but I find the symmetry a bit clearer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-31 21:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-cli/src/main.rs</code>:215 on 2023-10-31 21:01</div>
            <div class="timeline-body"><p>Nit: maybe collapse this to an <code>else if</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-10-31 21:01</div>
            <div class="timeline-body"><p>Nice, looks great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 00:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/src/main.rs</code>:77 on 2023-11-01 00:47</div>
            <div class="timeline-body"><p>Yeah I think we usually do that in Ruff so I can give it a try — don't mind as long as the error message is nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/src/commands/pip_compile.rs</code>:57 on 2023-11-01 12:03</div>
            <div class="timeline-body"><p>What about using a <code>BTreeSet</code> here? Not for performance but because it's more concise</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/tests/pip_compile.rs</code>:467 on 2023-11-01 12:04</div>
            <div class="timeline-body"><p>I like to <a href="https://docs.rs/indoc/latest/indoc/">indoc</a> for those, but it's a matter of taste so entirely your choice</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/tests/pip_compile.rs</code>:483 on 2023-11-01 12:05</div>
            <div class="timeline-body"><p>Since we use the same replacements everywhere, do we want to assign to a const or static? I check and it doesn't match on the expression contents: https://docs.rs/insta/latest/src/insta/macros.rs.html#515</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__compile_does_not_allow_both_extra_and_all_extras.snap</code>:25 on 2023-11-01 12:13</div>
            <div class="timeline-body"><p>Could we inline this snapshot? I should be short enough without the info block on top and for error message test i find it helpful to have the output next to the test</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__compile_pyproject_toml_all_extras.snap</code>:10 on 2023-11-01 12:14</div>
            <div class="timeline-body"><p>temp path</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-11-01 12:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-01 12:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__compile_pyproject_toml_all_extras.snap</code>:10 on 2023-11-01 12:39</div>
            <div class="timeline-body"><p>These aren’t actually used for validation, since they’re just part of the input command. I think removing them is nice but not fully required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-01 13:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-cli/src/commands/pip_compile.rs</code>:57 on 2023-11-01 13:26</div>
            <div class="timeline-body"><p>I suggested using a <code>Vec</code> here originally, I preferred it over the set-based approach personally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-01 13:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/tests/pip_compile.rs</code>:483 on 2023-11-01 13:44</div>
            <div class="timeline-body"><p>Done in #270</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 15:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/pip_compile.rs</code>:483 on 2023-11-01 15:22</div>
            <div class="timeline-body"><p>Yeah these test cases feel way heavier than they need to be. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 15:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/pip_compile.rs</code>:467 on 2023-11-01 15:22</div>
            <div class="timeline-body"><p>Oh interesting, I didn't know about that. Will consider that separately; here (as before) I'm just copying and pasting the existing test pattern.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 15:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__compile_does_not_allow_both_extra_and_all_extras.snap</code>:25 on 2023-11-01 15:23</div>
            <div class="timeline-body"><p>I agree inline snapshots seem preferable often.. let me see.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 15:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__compile_pyproject_toml_all_extras.snap</code>:10 on 2023-11-01 15:40</div>
            <div class="timeline-body"><p>Yeah this is the same in all of our existing snapshots</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-01 16:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__compile_pyproject_toml_all_extras.snap</code>:10 on 2023-11-01 16:38</div>
            <div class="timeline-body"><p>What would you think about just removing the header from all the snapshots? (In another PR, this one is fine)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-11-01 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @konstin on 2023-11-01 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 18:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__compile_pyproject_toml_all_extras.snap</code>:10 on 2023-11-01 18:39</div>
            <div class="timeline-body"><p>No preference from me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2023-11-01 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-11-01 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-01 18:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:34:36 UTC
    </footer>
</body>
</html>
