<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Added ability to select bytecode invalidation mode of generated .pyc - astral-sh/uv #2297</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Added ability to select bytecode invalidation mode of generated .pyc</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/2297">#2297</a>
        opened by <a href="https://github.com/wimglenn">@wimglenn</a>
        on 2024-03-08 07:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/wimglenn">@wimglenn</a> on 2024-03-08 07:34</div>
            <div class="timeline-body"><p>Since Python 3.7, deterministic pycs are possible (see <a href="https://peps.python.org/pep-0552/">PEP 552</a>)
To select the bytecode invalidation mode explicitly by env var:</p>
<pre><code>PYC_INVALIDATION_MODE=UNCHECKED_HASH uv pip install --compile ...</code></pre>
<p>Valid values are TIMESTAMP (default), CHECKED_HASH, and UNCHECKED_HASH.
The latter options are useful for reproducible builds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-08 08:42</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>I added specific error handling and a test and fixed a bug the error handling surfaced.</p>
<pre><code>$ PYC_INVALIDATION_MODE=bogus cargo run -q pip install --compile django
Resolved 3 packages in 4ms
Installed 3 packages in 45ms
error: Failed to bytecode compile /home/konsti/projects/uv/.venv/lib/python3.12/site-packages
  Caused by: Python process stderr:
Invalid value for PYC_INVALIDATION_MODE &quot;bogus&quot;, valid are &quot;TIMESTAMP&quot;, &quot;CHECKED_HASH&quot;, &quot;UNCHECKED_HASH&quot;:
  Caused by: Bytecode compilation failed, expected &quot;/home/konsti/projects/uv/.venv/lib/python3.12/site-packages/asgiref/sync.py&quot;, received: &quot;&quot;
</code></pre>
<p>@charliermarsh and/or @zanieb: Do we have a good spot to document advanced non-cli configuration such as <code>PYC_INVALIDATION_MODE</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2024-03-08 08:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-03-08 08:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-08 11:20</div>
            <div class="timeline-body"><p>(Sorry for the CI failures, it's passing locally for me)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-08 15:33</div>
            <div class="timeline-body"><p>@konstin I'd just add a &quot;Compilation of Python modules&quot; section to the &quot;Advanced Usage&quot; part of the README and explain <code>--compile</code> and this environment variable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-08 15:58</div>
            <div class="timeline-body"><p>Made a separate issue for: https://github.com/astral-sh/uv/issues/2303</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-03-08 16:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-03-08 16:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-08 17:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:55:04 UTC
    </footer>
</body>
</html>
