<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use faster disjointness check for markers - astral-sh/uv #10439</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use faster disjointness check for markers</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/10439">#10439</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2025-01-09 18:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2025-01-09 18:10</div>
            <div class="timeline-body"><p>Motivated by #10438. Ideally we wouldn't be calling this code that much in the first place, but it's the more idiomatic way to write this code.</p>
<p>Crude-ish benchmark based on #10438 with the <code>without_markers</code> patched out:</p>
<pre><code>hyperfine --warmup 1 &quot;./uv-1 pip compile scripts/requirements/airflow2-req.in -c scripts/requirements/airflow2-constraints.txt --universal --python-version 3.8&quot; &quot;./uv-2 pip compile scripts/requirements/airflow2-req.in -c scripts/requirements/airflow2-constraints.txt --universal --python-version 3.8&quot;
Benchmark 1: ./uv-1 pip compile scripts/requirements/airflow2-req.in -c scripts/requirements/airflow2-constraints.txt --universal --python-version 3.8
  Time (mean ± σ):      1.229 s ±  0.018 s    [User: 1.206 s, System: 0.111 s]
  Range (min … max):    1.211 s …  1.269 s    10 runs

Benchmark 2: ./uv-2 pip compile scripts/requirements/airflow2-req.in -c scripts/requirements/airflow2-constraints.txt --universal --python-version 3.8
  Time (mean ± σ):     873.8 ms ±   5.1 ms    [User: 851.2 ms, System: 112.5 ms]
  Range (min … max):   865.2 ms … 880.4 ms    10 runs

Summary
  ./uv-2 pip compile scripts/requirements/airflow2-req.in -c scripts/requirements/airflow2-constraints.txt --universal --python-version 3.8 ran
    1.41 ± 0.02 times faster than ./uv-1 pip compile scripts/requirements/airflow2-req.in -c scripts/requirements/airflow2-constraints.txt --universal --python-version 3.8
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @konstin on 2025-01-09 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-01-09 18:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2025-01-09 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-01-09 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-01-09 18:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:17 UTC
    </footer>
</body>
</html>
