<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add a fast-path to skip resolution when installation is complete - astral-sh/uv #613</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add a fast-path to skip resolution when installation is complete</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/613">#613</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-12-12 04:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-12 04:33</div>
            <div class="timeline-body"><p>For a very large resolution (a few hundred packages), I see 13ms vs. 400ms for a no-op. It's worth optimizing this case, in my opinion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @charliermarsh on 2023-12-12 04:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-12-12 04:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/src/commands/pip_install.rs</code>:71 on 2023-12-12 04:48</div>
            <div class="timeline-body"><p>It'd probably be fair to just have this comment without the TODO attached, e.g.</p>
<pre><code class="language-suggestion">    // Ideally, the resolver would be fast enough to let us remove this check.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-12-12 04:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-installer/src/site_packages.rs</code>:140 on 2023-12-12 04:49</div>
            <div class="timeline-body"><p>For my learnings, does pre-specifying the capacity make a big difference?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-12 05:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-installer/src/site_packages.rs</code>:140 on 2023-12-12 05:43</div>
            <div class="timeline-body"><p>In general yes -- always good to pre-specify if you can. It means you can allocate the memory upfront, rather than dynamically resizing (which requires further allocations) as you build up the hash map. This also applies to strings, and even to things like (e.g.) reading a file into a buffer: if you know the size in advance, you can allocate the buffer at that size for better efficiency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-12 05:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-installer/src/site_packages.rs</code>:140 on 2023-12-12 05:46</div>
            <div class="timeline-body"><p>I randomly had a benchmark for this in my slides from the Rust Dublin meetup:</p>
<img width="925" alt="Screen Shot 2023-12-12 at 12 46 07 AM" src="https://github.com/astral-sh/puffin/assets/1309177/f0dfe1c1-0180-40ab-af08-7bc4ac116acb">

<img width="1145" alt="Screen Shot 2023-12-12 at 12 46 11 AM" src="https://github.com/astral-sh/puffin/assets/1309177/c440ff93-60e1-4987-a463-cf879468240c">

<p>Just a micro-benchmark though, take it with a grain of salt!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/distribution-types/src/installed.rs</code>:140 on 2023-12-12 11:15</div>
            <div class="timeline-body"><p>We should attach the filename here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-installer/src/site_packages.rs</code>:140 on 2023-12-12 11:19</div>
            <div class="timeline-body"><p>Rust also tries this aggresively internally, e.g. <code>.collecting()</code> into a hashmap will allocate based on <code>iter.size_hint()</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-12-12 11:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-12-12 17:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-12 17:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-12 17:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:45:06 UTC
    </footer>
</body>
</html>
