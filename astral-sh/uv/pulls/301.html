<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch wheel metadata by async range requests on the remote wheel - astral-sh/uv #301</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fetch wheel metadata by async range requests on the remote wheel</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/301">#301</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-11-02 23:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Use range requests and async zip to extract the METADATA file from a remote wheel.</p>
<p>We currently only cache when the remote says the remote declares the resource as immutable, see https://github.com/06chaynes/http-cache/issues/57 and  https://github.com/baszalmstra/async_http_range_reader/pull/1 . The cache is stored as json with the description omitted, this improve cache deserialization performance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Async range requests" to "Fetch wheel metadata by async range requests on the remote wheel" by @konstin on 2023-11-03 12:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-04 13:49</div>
            <div class="timeline-body"><p>@konstin - Is this ready for review?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-05 22:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/install-wheel-rs/src/lib.rs</code>:77 on 2023-11-05 22:17</div>
            <div class="timeline-body"><p>I expect we'll have to reuse this, at least for async zip and unpacked to the fs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-05 22:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/client.rs</code>:261 on 2023-11-05 22:22</div>
            <div class="timeline-body"><p>This branch exists but has not been given care since i much rather hope that registries/file hosts support range requests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2023-11-05 22:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-05 22:24</div>
            <div class="timeline-body"><p>It had a branch and tests missing, now it's ready</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/client.rs</code>:214 on 2023-11-06 00:04</div>
            <div class="timeline-body"><p>Can we put this comment within the <code>else</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 00:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 00:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/client.rs</code>:251 on 2023-11-06 00:05</div>
            <div class="timeline-body"><p>Let's remove this for now -- we should revisit this holistically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 00:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/client.rs</code>:251 on 2023-11-06 00:07</div>
            <div class="timeline-body"><p>E.g., I think it could be confusing that the metadata is sometimes complete and sometimes incomplete depending on where it comes from. I'd rather store the whole thing, and then change all representations at once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/error.rs</code>:53 on 2023-11-06 00:08</div>
            <div class="timeline-body"><p>Can you either remove this comment or fold it into the error message? As a reader I don't totally understand what it's saying or why it's relevant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 00:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>Cargo.toml</code>:17 on 2023-11-06 00:10</div>
            <div class="timeline-body"><p>It looks like this is published, can we remove the Git dep now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 00:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/client.rs</code>:238 on 2023-11-06 00:11</div>
            <div class="timeline-body"><p>Sort of wish we could just pass down our cached HTTP client to the async request crate, then we wouldn't need a custom cache implementation (nor would we need to expose the raw client). But I guess the thinking is that we'll need to do this anyway at some point?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 00:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 00:12</div>
            <div class="timeline-body"><p>Generally looks good! A few small comments, and I'd prefer to move the license attribution directly to the source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-06 09:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>Cargo.toml</code>:17 on 2023-11-06 09:46</div>
            <div class="timeline-body"><p>It's not published, i've removed the wrong version</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-06 09:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-client/src/client.rs</code>:238 on 2023-11-06 09:49</div>
            <div class="timeline-body"><p>I wouldn't cache those range requests, just the metadata we need eventually (which is even less than the <code>Metadata21</code> we have atm). I found deserialization being the major performance bottleneck in the other prototype (even though the deserialization was in rust and the resolver was in python), so i try to cache as minimal data as possible</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-11-06 14:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-06 14:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-client/src/client.rs</code>:238 on 2023-11-06 14:04</div>
            <div class="timeline-body"><p>I agree but I'd rather have a consistent caching strategy, and then change over to a <em>better</em> consistent caching strategy, rather than use separate strategies for separate requests. But it's not worth blocking on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-11-06 14:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-11-06 14:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-06 14:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:34:38 UTC
    </footer>
</body>
</html>
