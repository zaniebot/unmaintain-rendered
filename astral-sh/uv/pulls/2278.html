<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retry on python interpreter launch failures - astral-sh/uv #2278</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Retry on python interpreter launch failures</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/2278">#2278</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-03-07 14:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Sometimes, the first time we read from the stdout of the bytecode compiler python subprocess, we get an empty string back (no newline). If we try to write to stdin, it will often be a broken pipe (#2245). After we got an empty string the first time, we will get the same empty string if we read a line again.</p>
<p>The details of this behavior are mysterious to me, but it seems that it can be identified by the first empty string. We check by inserting starting with a <code>Ready</code> message on the Python side. When we encounter the broken state, we discard the interpreter and try again.</p>
<p>We have to introduce a third timeout check for the interpreter launch itself.</p>
<p>Minimized test script:</p>
<pre><code>#!/usr/bin/env bash

set -euo pipefail

while true; do
  date --iso-8601=seconds # Progress indicator
  rm -rf testenv
  target/profiling/uv venv testenv -q --python 3.12
  VIRTUAL_ENV=$PWD/testenv target/profiling/uv pip install -q --compile wheel==0.42.0
done
</code></pre>
<p>Run as</p>
<pre><code>cargo build --profile profiling &amp;&amp; bash compile_bug.sh
</code></pre>
<p>Fixes #2245</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-03-07 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-03-07 14:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2024-03-07 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-03-07 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-07 15:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:44:10 UTC
    </footer>
</body>
</html>
