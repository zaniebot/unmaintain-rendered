<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover workspaces without using them in resolution - astral-sh/uv #3585</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Discover workspaces without using them in resolution</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3585">#3585</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-05-14 18:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2024-05-14 18:09</div>
            <div class="timeline-body"><p>Add minimal support for workspace discovery, only used for determining paths in the bluejay commands.</p>
<p>We can now discover the workspace structure, namely that the <code>pyproject.toml</code> of a package belongs to a workspace <code>pyproject.toml</code> with members and exclusion. The globbing logic is inspired by cargo. We don't resolve <code>workspace = true</code> metadata declarations yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-05-14 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/discovery.rs</code>:40 on 2024-05-14 18:09</div>
            <div class="timeline-body"><p>We want this information when resolving workspace dependencies, but we don't use it yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-14 18:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-14 18:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/discovery.rs</code>:548 on 2024-05-14 18:10</div>
            <div class="timeline-body"><p>I tried the json snapshots here for the first time and find them better than the regular debug snapshots</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-14 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/pyproject.rs</code>:9 on 2024-05-14 18:11</div>
            <div class="timeline-body"><p>This makes the test snapshots deterministic</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/discovery.rs</code>:1 on 2024-05-15 21:55</div>
            <div class="timeline-body"><p>See for a more used state of this file https://gist.github.com/konstin/f8c05311223fbd627b0491295915e865</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-15 21:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-17 01:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-requirements/src/discovery.rs</code>:80 on 2024-05-17 01:44</div>
            <div class="timeline-body"><p>Does this need a doc too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-17 01:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-requirements/src/discovery.rs</code>:73 on 2024-05-17 01:45</div>
            <div class="timeline-body"><p>Can you make this message a bit more user-facing e.g. &quot;Found project root <code>{}</code>&quot; or similar?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-17 01:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-requirements/src/discovery.rs</code>:208 on 2024-05-17 01:45</div>
            <div class="timeline-body"><p>Does this need a doc?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-requirements/src/discovery.rs</code>:68 on 2024-05-17 01:47</div>
            <div class="timeline-body"><p>Should we use <code>is_file()</code> instead of <code>exists()</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-17 01:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-17 01:53</div>
            <div class="timeline-body"><p>Could you add some documentation explaining what's going on? Or at least link to the relevant &quot;specification&quot; we're implementing here? I'm having a hard time reviewing because there's a lot of behavior in here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-17 11:23</div>
            <div class="timeline-body"><p>I've edited the spec from #3404 into a docstring</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-21 14:50</div>
            <div class="timeline-body"><p>If this is causing you trouble, you can merge and I'll do a post-push review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-21 17:05</div>
            <div class="timeline-body"><p>Merging this now to avoid merge conflicts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-05-21 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-05-21 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-21 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-21 20:53</div>
            <div class="timeline-body"><p>@konstin - Gave this a read, looks like a good start.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-21 20:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/workspace.rs</code>:246 on 2024-05-21 20:54</div>
            <div class="timeline-body"><p>Should this be an <code>or_else</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-21 20:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/workspace.rs</code>:246 on 2024-05-21 20:55</div>
            <div class="timeline-body"><p>Does this mean we're in a <em>member</em> of a workspace?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-22 09:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/workspace.rs</code>:246 on 2024-05-22 09:25</div>
            <div class="timeline-body"><p>yeah, added some docs in the other branch</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:32:37 UTC
    </footer>
</body>
</html>
