<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Include version constraints in derivation chains - astral-sh/uv #9112</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Include version constraints in derivation chains</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/9112">#9112</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-11-14 04:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>Derivation chains can now include the versions at which a package was requested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-14 04:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-14 04:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/diagnostics.rs</code>:353 on 2024-11-14 04:16</div>
            <div class="timeline-body"><p>I need to DRY this up with the error reporting in the resolver.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-14 04:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-distribution-types/src/derivation.rs</code>:58 on 2024-11-14 04:17</div>
            <div class="timeline-body"><p>This is somewhat confusing but it is the most normalized representation...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-11-14 05:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-14 05:01</div>
            <div class="timeline-body"><p>I&#x27;m not sure if the parenthesis are helpful for readability here. Is there a particular reason you went with that approach instead of <code>wsgiref==0.1.2</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-15 02:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 02:27</div>
            <div class="timeline-body"><p>In prior entries, I want to show both the selected version and the version range -- like <code>django==1.4.0 (&gt;=1.0.0)</code>. So it seemed nice to be consistent with the use of parentheses here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-15 02:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 02:27</div>
            <div class="timeline-body"><p>Maybe it should be like: <code>django v1.4.0 (&gt;=1.0.0)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-15 02:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-15 02:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-15 02:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/error.rs</code>:912 on 2024-11-15 02:56</div>
            <div class="timeline-body"><p>Just moved and restructured to make it public.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-15 02:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 02:58</div>
            <div class="timeline-body"><p>There are like three different cases to consider in the chain:</p>
<ul>
<li>The first dependency (<code>project==0.1.0</code>, which doesn&#x27;t have a set of constraints, because it&#x27;s just attached to the root).</li>
<li>Intermediary dependencies (not visible here), which have both a pinned version and a set of constraints, so we want to show both (like, <code>django==1.4.0 (&gt;=1.0.0)</code>).</li>
<li>The final dependency (<code>wsgiref (==0.1.2)</code>), which we don&#x27;t show the version for just to be succinct, but could.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 18:05</div>
            <div class="timeline-body"><p>Interesting, thanks for explaining. I&#x27;m happy with whatever you do here. <code>django v1.4.0 (&gt;=1.0.0)</code> seems easier to understand.</p>
<p>Regarding the root package, we might want to do something more consistent with the resolver reporter https://github.com/astral-sh/uv/blob/744a9091a2a35b6b3f4e5f8f2a3394e7261f7e14/crates/uv-resolver/src/pubgrub/report.rs#L341-L355</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-11-15 18:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-11-15 18:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 18:10</div>
            <div class="timeline-body"><p>Sorry looking at the snapshots again..</p>
<blockquote>
<p>help: <code>wsgiref</code> was included because <code>project==0.1.0</code> depends on <code>wsgiref (&gt;=0.1)</code></p>
</blockquote>
<p>If the language is &quot;depends on&quot; I would expect the version specifiers to be first-class? e.g.</p>
<blockquote>
<p>help: <code>wsgiref v0.1</code> was included because <code>project==0.1.0</code> depends on <code>wsgiref&gt;=0.1</code></p>
</blockquote>
<p>The chain case is a bit tricky, because we then say &quot;which depends on&quot; in which the concrete version needs to be first-class. e.g.,</p>
<blockquote>
<p>help: <code>wsgiref</code> was included because <code>project==0.1.0</code> depends on <code>child==0.1.0 (*)</code> which depends on <code>wsgiref (*)</code></p>
</blockquote>
<p>In this case perhaps we can say:</p>
<blockquote>
<p>help: <code>wsgiref</code> was included because <code>project==0.1.0</code> depends on <code>child</code> and <code>child==0.1.0</code> depends on <code>wsgiref</code></p>
</blockquote>
<p>I don&#x27;t love the increase in verbosity though it&#x27;s hard to say how often we&#x27;ll get a particularly long chain.  Another option is to put the concrete version inside the parenthesis:</p>
<blockquote>
<p>help: <code>wsgiref</code> was included because <code>project==0.1.0</code> depends on <code>child (v0.1.0)</code> which depends on <code>wsgiref</code></p>
</blockquote>
<p>For a pretend case with a specifier:</p>
<blockquote>
<p>help: <code>wsgiref</code> was included because <code>project==0.1.0</code> depends on <code>child&gt;=0.1.0 (v0.1.0)</code> which depends on <code>wsgiref</code></p>
</blockquote>
<p>Maybe more context is the move?</p>
<blockquote>
<p>help: <code>wsgiref</code> was included because <code>project==0.1.0</code> depends on <code>child&gt;=0.1.0 (selected: v0.1.0)</code> which depends on <code>wsgiref</code></p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-11-15 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 18:11</div>
            <div class="timeline-body"><p>I&#x27;d omit the <code>*</code> throughout, I don&#x27;t think we usually show that to users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-15 18:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 18:34</div>
            <div class="timeline-body"><p>I&#x27;m kind of into <code>wsgiref was included because project v0.1.0 depends on child&gt;=0.1.0 and child v0.1.4 depends on wsgiref</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-15 18:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 18:34</div>
            <div class="timeline-body"><p>Actually the last one you gave isn&#x27;t bad either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-11-15 19:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 19:17</div>
            <div class="timeline-body"><p>Whatever you&#x27;re more into â€” we can iterate later if we need to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-11-15 19:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/lock.rs</code>:19885 on 2024-11-15 19:35</div>
            <div class="timeline-body"><p>Okay, I went with:</p>
<pre><code>help: `wsgiref` (v0.1.2) was included because `project` (v0.1.0) depends on `child` (v0.1.0) which depends on `wsgiref&gt;=0.1.2`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-11-15 19:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-15 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-15 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-11-15 20:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:49:22 UTC
    </footer>
</body>
</html>
