<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplify managed Python flags - astral-sh/uv #12246</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Simplify managed Python flags</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/12246">#12246</a>
        opened by <a href="https://github.com/jtfmumm">@jtfmumm</a>
        on 2025-03-17 19:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-03-17 19:53</div>
            <div class="timeline-body"><p>Currently, for users to specify at the command line whether to use uv-managed or system Python interpreters, they use the <code>--python-preference</code> parameter, which takes four possible values. This is more complex than necessary since the normal case is to either say &quot;only managed&quot; or &quot;not managed&quot;. This PR hides the old <code>--python-preference</code> parameter from help and documentation and adds two new flags: <code>--managed-python</code> and <code>--no-managed-python</code> to capture the &quot;only managed&quot; and &quot;not managed&quot; cases.</p>
<p>I have successfully tested this locally but currently cannot add snapshot tests because of problems with distinguishing managed vs. system interpreters in CI (and non-determinism when run on different developers' machines). The <code>--python-preference</code> test in <code>tool-install.rs</code> is currently ignored for this reason. See #5144 and #7473.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @zanieb on 2025-03-17 19:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:161 on 2025-03-17 20:21</div>
            <div class="timeline-body"><p>I would re-phrase (I think we use &quot;Whether&quot; when we only show one of the options)</p>
<pre><code class="language-suggestion">    /// Disable use of uv-managed Python distributions.
</code></pre>
<p>I think we could say a bit more here, too, like</p>
<blockquote>
<p>Instead, uv will search for a suitable Python installation on the system.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-17 20:22</div>
            <div class="timeline-body"><p>Similar to https://github.com/astral-sh/uv/pull/12246/files#r1999551644</p>
<pre><code class="language-suggestion">    /// Only use uv-managed Python distributions.
</code></pre>
<p>(Sort of on the fence about &quot;installations&quot; vs &quot;distributions&quot; here but don't want users to be confused about whether we are &quot;installing&quot; here)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:151 on 2025-03-17 20:23</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    /// installed. This option disables use of system Python versions.```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-17 20:23</div>
            <div class="timeline-body"><p>I guess &quot;versions&quot; is actually the most consistent with other language?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:161 on 2025-03-17 20:23</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/uv/pull/12246/files#r1999556537 — maybe we want to say &quot;Python versions&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:166 on 2025-03-17 20:24</div>
            <div class="timeline-body"><p>I think we prefer <code>overrides_with</code> for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:166 on 2025-03-17 20:24</div>
            <div class="timeline-body"><p>(Though <code>conflicts_with</code> makes sense for <code>python_preference</code>, I think)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-17 20:27</div>
            <div class="timeline-body"><p>I wonder if we should also mention that this is equivalent to the <code>python-preference = &quot;only-managed&quot;</code> setting? I'm not sure. We might want to reference <code>python-preference</code> though unless we intend to later add a <code>managed-python = true | false</code> option to the settings to replace <code>python-preference</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/concepts/python-versions.md</code>:283 on 2025-03-17 20:28</div>
            <div class="timeline-body"><p>We didn't remove this option from the settings reference too, did you mean to remove this link?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/concepts/python-versions.md</code>:281 on 2025-03-17 20:30</div>
            <div class="timeline-body"><p>I wonder if we should reframe similar to above? Like, rename to &quot;Disabling managed Python versions&quot;?</p>
<p>We should definitely describe the <code>--managed-python</code> and <code>--no-managed-python</code> flags here though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-17 20:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-17 20:31</div>
            <div class="timeline-body"><p>I also think a <code>UV_MANAGED_PYTHON=1|0</code> variable might makes sense for these new options. It seems easier to use than <code>UV_PYTHON_PREFERENCE</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-03-18 09:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>docs/concepts/python-versions.md</code>:283 on 2025-03-18 09:35</div>
            <div class="timeline-body"><p>I was trying to split the difference in terms of what we're emphasizing, but I've restored the link.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-03-18 09:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>docs/concepts/python-versions.md</code>:281 on 2025-03-18 09:37</div>
            <div class="timeline-body"><p>I've added the flag descriptions.</p>
<p>I wonder if we should keep the <code>python-preference</code> section in here at all. It's a little confusing to have them both. If we remove it, we could rename the section.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-03-18 09:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-18 09:39</div>
            <div class="timeline-body"><p>I'm hesitant to reference <code>python-preference</code> because the user might then try to learn two different ways to do the same thing (which might defeat part of the purpose of simplifying configuration here).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-03-18 09:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-18 09:41</div>
            <div class="timeline-body"><p>It would be nice to use the same language consistently. I'm fine with &quot;versions&quot;. There are a number of other points in help/docs where we say &quot;Python installations&quot; or &quot;Python distributions&quot;. And we say &quot;Python installations&quot; in output (e.g., &quot;Searching for Python installations&quot;).</p>
<p>I could open a separate issue for unifying this language and just update these ones to &quot;versions&quot; for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-03-18 09:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-18 09:52</div>
            <div class="timeline-body"><p>I considered an env var, but the problem is we have a third option as a default.</p>
<p>We could use <code>UV_MANAGED_PYTHON</code> to mean 1 == required, 0 == not required (i.e., managed then system). But then we don't have &quot;forbidden&quot; represented. I didn't want another multi-value env var if we still have <code>UV_PYTHON_PREFERENCE</code>. But it also seemed a little awkward to add a <code>UV_NO_MANAGED_PYTHON</code> env var.</p>
<p>What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-18 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-18 13:14</div>
            <div class="timeline-body"><blockquote>
<p>It would be nice to use the same language consistently.</p>
</blockquote>
<p>Yeah, but there are some places where it might be clearer to refer to installations or distributions. I think we should probably use &quot;versions&quot; when it's not confusing. It'd be good to audit other usages too, I'm sure there are more cases where we could switch to &quot;versions&quot;.</p>
<p>I think I'd prefer updating the ones here then opening an issue to standardize the language.</p>
<blockquote>
<p>I'm hesitant to reference python-preference because the user might then try to learn two different ways to do the same thing</p>
</blockquote>
<p>Since there's not a configuration file setting for <code>managed-python</code>, I think it makes sense to explain how it's related? I wouldn't suggest the <code>--python-preference</code> CLI option.</p>
<blockquote>
<p>I considered an env var, but the problem is we have a third option as a default.</p>
</blockquote>
<p>Thinking out loud here...</p>
<p>I assumed <code>UV_MANAGED_PYTHON=1</code> means <code>--managed-python</code> and <code>UV_MANAGED_PYTHON=0</code> means <code>--no-managed-python</code> while unset means default.</p>
<p>Looking at some of our existing patterns, we do use <code>UV_NO_...</code> sometimes. I think most of them don't have an equivalent &quot;yes&quot; flag though. I might be okay with <code>UV_MANAGED_PYTHON=1</code> means <code>--managed-python</code> and <code>UV_NO_MANAGED_PYTHON=1</code> means <code>--no-managed-python</code>. I think <code>UV_MANAGED_PYTHON=0</code> not working would be surprising. That's how other boolean flags work today though, e.g.:</p>
<pre><code>❯ UV_SYSTEM_PYTHON=0 uv python find
/opt/homebrew/opt/python@3.13/bin/python3.13
</code></pre>
<p>but as you said, that's for an option that's truly binary.</p>
<p>I think I've loosely talked myself into using <code>UV_NO_MANAGED_PYTHON</code> / <code>UV_MANAGED_PYTHON</code> :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-18 13:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/concepts/python-versions.md</code>:281 on 2025-03-18 13:30</div>
            <div class="timeline-body"><p>I posted a draft of what I would write at https://github.com/astral-sh/uv/pull/12279</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-03-18 13:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-cli/src/lib.rs</code>:147 on 2025-03-18 13:40</div>
            <div class="timeline-body"><p>Yeah if <code>UV_MANAGED_PYTHON</code> is the only env var, I do think <code>UV_MANAGED_PYTHON=0</code> feels like &quot;don't use managed Python&quot;. But I'd find the 0/1/unset options to be surprising. I guess I'd assume the default would effectively be 0.</p>
<p>But if we have two separate env vars <code>UV_MANAGED_PYTHON</code> and <code>UV_NO_MANAGED_PYTHON</code> this is probably less surprising, since it would mean 1 == use the flag, 0 == don't use the flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-18 13:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/concepts/python-versions.md</code>:281 on 2025-03-18 13:42</div>
            <div class="timeline-body"><p>(feel free to merge it or crib what you want)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-03-18 13:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>docs/concepts/python-versions.md</code>:281 on 2025-03-18 13:44</div>
            <div class="timeline-body"><p>I like your proposal, though I still worry about it being confusing to read through both in sequence. Instead of 4 options to learn, it seems like there are 6 options to learn. But I'm also ok with merging your changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-18 16:39</div>
            <div class="timeline-body"><blockquote>
<p>I like your proposal, though I still worry about it being confusing to read through both in sequence. Instead of 4 options to learn, it seems like there are 6 options to learn. But I'm also ok with merging your changes.</p>
</blockquote>
<p>I think there's probably a long-term improvement we can make here, like... introducing a <code>managed-python</code> setting (as you proposed) and phasing out the <code>python-preference</code> entirely. I'm just not certain what that should look like yet. I'm hoping feedback on this incremental improvement can help guide a future decision.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-03-18 16:40</div>
            <div class="timeline-body"><p>I don't see environment variables as blocking (we often add them in follow-ups), but I do think we should add them — people often use <code>UV_PYTHON_PREFERENCE</code> in Docker containers and I'd like to offer this simpler option instead. (Speaking of that, we might need to look at updating the <code>uv-docker-example</code> and the Docker integration guide)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-03-18 17:10</div>
            <div class="timeline-body"><p>I've added the env vars.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @jtfmumm on 2025-03-18 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @jtfmumm on 2025-03-18 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-03-18 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2025-03-21 17:36</div>
            <div class="timeline-body"><p>So the only way of getting <code>--python-preference=system</code> is now to use a hidden option, is that correct? There's no intention in the longer term to <em>remove</em> the <code>--python-preference=system</code> option, is there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-21 17:38</div>
            <div class="timeline-body"><blockquote>
<p>There's no intention in the longer term to remove the --python-preference=system option, is there?</p>
</blockquote>
<p>There's no plan to currently. It was considered, but I think it's valuable to advanced users and we need to retain it for backwards compatibility anyway.</p>
<blockquote>
<p>So the only way of getting --python-preference=system is now to use a hidden option, is that correct?</p>
</blockquote>
<p>Yeah, or to use the non-hidden configuration file setting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2025-03-21 17:47</div>
            <div class="timeline-body"><p>OK. Please don't remove this option until there is better support for managing &quot;mixed&quot; environments with both system and uv-managed interpreters (see the discussion under https://github.com/astral-sh/uv/issues/12122 for context).</p>
<p>Currently, preferring the system Python is the only viable way of having a standard Python install while using uv-managed Pythons for temporary testing, unless you're willing to forego things like <code>uv venv</code> or <code>uv run</code> when you want to use your system Python.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-21 17:50</div>
            <div class="timeline-body"><p>We intend to fix those other problems you're having regardless, but yeah.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikenerone">@mikenerone</a> on 2025-04-28 15:42</div>
            <div class="timeline-body"><p>Even if the older preference option remains (stealthed), it seems like an inconsistency that the option is hidden in docs and help output, but the environment variable is <a href="https://docs.astral.sh/uv/configuration/environment/#uv_python_preference">still included</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-28 15:45</div>
            <div class="timeline-body"><p>The environment variable matches the persistent setting at https://docs.astral.sh/uv/reference/settings/#python-preference — I think it seems reasonable to keep?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:21 UTC
    </footer>
</body>
</html>
