<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve formatting of package ranges in error messages - astral-sh/uv #864</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve formatting of package ranges in error messages</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/864">#864</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-01-10 00:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Closes #810
Closes https://github.com/astral-sh/puffin/issues/812
Requires https://github.com/zanieb/pubgrub/pull/19 and https://github.com/zanieb/pubgrub/pull/18</p>
<ul>
<li>Always pair package ranges with names e.g. <code>... of a matching a&lt;1.0</code> instead of <code>... of a matching &lt;1.0</code></li>
<li>Split range segments onto multiple lines when not a singleton as suggested in <a href="https://github.com/astral-sh/puffin/pull/850#discussion_r1446419610">#850</a></li>
<li>Improve formatting when ranges are split across multiple lines e.g. by avoiding extra spaces and improving wording</li>
</ul>
<p>Note review will require expanding the hidden files as there are significant changes to the report formatter and snapshots.</p>
<p>Bear with me here as these are definitely not perfect still.</p>
<p>The following changes build on top of this independently for further improvements:</p>
<ul>
<li>#868</li>
<li>#867</li>
<li>#866</li>
<li>#871</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 00:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:182 on 2024-01-10 00:30</div>
            <div class="timeline-body"><p>I'm not enthused about this pattern, but I'm not sure what else to do since all of these may or may not split onto multiple lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 00:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:194 on 2024-01-10 00:30</div>
            <div class="timeline-body"><p>From PubGrub's implementation... should remove.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 00:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:445 on 2024-01-10 00:53</div>
            <div class="timeline-body"><p>It's not clear where this additional newline is coming from, but it's not good.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 01:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:182 on 2024-01-10 01:18</div>
            <div class="timeline-body"><p>It might be better to perform the splitting outside of <code>PackageRange</code> instead</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-01-10 05:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2024-01-10 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:161 on 2024-01-10 16:54</div>
            <div class="timeline-body"><p>I think I like the space after the <code>,</code>. :zipper_mouth_face:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:167 on 2024-01-10 17:03</div>
            <div class="timeline-body"><p>I was trying to figure out what this was doing based on how it was used, but I couldn't find any uses of it. Are they used in another PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-01-10 17:03</div>
            <div class="timeline-body"><p>I think the error messages here are greatly improved!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 17:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:161 on 2024-01-10 17:05</div>
            <div class="timeline-body"><p>Happy to restore that â€” although it's not common in requirements files. We could also use <code>and</code> or <code>&amp;&amp;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 17:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:167 on 2024-01-10 17:06</div>
            <div class="timeline-body"><p>See https://github.com/zanieb/pubgrub/pull/19 this is an internal method of the PubGrub error reporter pulled out into a trait.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 17:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:161 on 2024-01-10 17:12</div>
            <div class="timeline-body"><p>Although I think we'd only want it in the multiline display, it'd be different when it's just a single segment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:161 on 2024-01-10 17:13</div>
            <div class="timeline-body"><p>e.g. https://github.com/astral-sh/puffin/pull/870</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 17:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-01-10 17:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:161 on 2024-01-10 17:16</div>
            <div class="timeline-body"><p>Yeah I confess I do like just <code>and</code> or <code>&amp;&amp;</code>. I think <code>,</code> is common in math circles for short-hand for &quot;and,&quot; but I don't think it has such an obvious meaning outside of that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-01-10 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:167 on 2024-01-10 17:18</div>
            <div class="timeline-body"><p>Hmmm okay I see. I think it's my unfamiliarity with pubgrub that is biting me here. But makes sense at a high level!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 17:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:161 on 2024-01-10 17:23</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/puffin/pull/871</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-01-10 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:167 on 2024-01-10 17:24</div>
            <div class="timeline-body"><p>Yeah I think eventually we might want to rewrite the whole reporter, it's kind of awkward as-is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-01-10 20:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-01-10 20:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-10 20:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-01-11 09:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-cli/tests/pip_install_scenarios.rs</code>:161 on 2024-01-11 09:04</div>
            <div class="timeline-body"><p>I agree in general, but for python specifically the comma comes from PEP 440 / PEP 508 so users will have e.g. written <code>a&gt;1.0.0,&lt;2.0.0</code> in their own requirements and tend to be familiar with that syntax, while <code>and</code> would introduce and additional format for the same data</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:35:07 UTC
    </footer>
</body>
</html>
