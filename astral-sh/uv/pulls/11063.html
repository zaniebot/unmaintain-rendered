<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>add provides-extras to lockfile - astral-sh/uv #11063</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>add provides-extras to lockfile</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11063">#11063</a>
        opened by <a href="https://github.com/Gankra">@Gankra</a>
        on 2025-01-29 14:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a></div>
            <div class="timeline-body"><p>Fixes #10953</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @Gankra on 2025-01-29 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-01-29 14:20</div>
            <div class="timeline-body"><p>I still need to add a snapshot test where this is non-empty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-29 15:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 15:03</div>
            <div class="timeline-body"><p>Something we need to consider: if we want to start using this to <em>enforce</em> that a given extra exists (at install time, by reading from the lockfile), we won't be able to tell the difference between &quot;empty&quot; and &quot;absent&quot;. So we either need to <em>not</em> do that, or bump the lockfile version so we can tell the difference, or write these even when empty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-29 15:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1807 on 2025-01-29 15:03</div>
            <div class="timeline-body"><p>I think you need to change <code>to_toml</code> to write these out. The impl is manual.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-01-29 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 15:07</div>
            <div class="timeline-body"><p>Do you have a preference on which approach? &quot;bump lockfile version&quot; sounds principled but dunno if it's a Big Deal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 15:13</div>
            <div class="timeline-body"><p>I'm not sure. @zanieb, do you have an opinion? Bumping the lockfile version means that older uv versions will reject newer lockfiles (but we can still read older lockfiles in newer uv versions).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-29 15:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-29 15:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 15:14</div>
            <div class="timeline-body"><p>We might just want to always write this (and always write <code>requires-dist</code> too). It's not, like, a huge change... Since we only show this for local packages anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 15:26</div>
            <div class="timeline-body"><p>In addition to always writing this we'd also need to make this like... an <code>Option&lt;Vec&lt;ExtraName&gt;&gt;</code> to distinguish whether we found it in the lockfile, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-01-29 15:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-29 15:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 15:36</div>
            <div class="timeline-body"><p>Yeah thatâ€™s right</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-01-29 15:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 15:59</div>
            <div class="timeline-body"><p>Added the commit, I'm not sure we're gonna love how effectively <code>[package.metadata]</code> is no longer ever empty-and-therefore-omitable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-29 16:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 16:07</div>
            <div class="timeline-body"><p>I was thinking that we'd continue to omit it for immutable sources, is that doable? It should massively reduce the diff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-01-29 16:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 16:54</div>
            <div class="timeline-body"><p>It did remove a lot of them, yeah. (updated the commit)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-29 17:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 17:59</div>
            <div class="timeline-body"><p>Generally in favor of less breaking lockfile changes :) it's decent timing with 0.6 coming up, but from what I understand this doesn't justify the churn?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-01-29 18:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 18:47</div>
            <div class="timeline-body"><p>It's just to enable more validation on cli arguments, yeah. Not really worth a break.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-01-29 18:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:1790 on 2025-01-29 18:48</div>
            <div class="timeline-body"><p>Yeah I don't think we should bump for it. I do wonder if we should treat <code>requires-dist</code> the same way, though: always write it, even if empty?</p>
<p>I think users will likely be annoyed that the lockfile is churning more (even without a bump) in that you're now getting different results if you lock with a later version (even though it should be backwards-compatible), but I don't know how we avoid that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.6.0" by @Gankra on 2025-01-29 23:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-11 19:20</div>
            <div class="timeline-body"><blockquote>
<p>CI / check system | python3.13 on windows x86-64 (pull_request)</p>
</blockquote>
<p>this task is extremely haunted on this PR and I wish I had any reason to think this PR breaks it...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-11 19:21</div>
            <div class="timeline-body"><blockquote>
<p>Error: Cache folder path is retrieved for pip but doesn't exist on disk: c:\users\runneradmin\appdata\local\pip\cache. This likely indicates that there are no dependencies to cache. Consider removing the cache step if it is not needed.</p>
</blockquote>
<p>god worst reason to die too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-02-11 19:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-11 19:30</div>
            <div class="timeline-body"><blockquote>
<p>god worst reason to die too</p>
</blockquote>
<p>I think @zanieb fixed this on <code>main</code> so this branch might just be behind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @Gankra on 2025-02-11 19:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Gankra on 2025-02-11 19:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-11 19:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:41:45 UTC
    </footer>
</body>
</html>
