<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for listing system toolchains - astral-sh/uv #4172</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for listing system toolchains</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4172">#4172</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-06-09 16:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Includes system interpreters in <code>uv toolchain list</code>.</p>
<p>This includes a refactor of <code>find_toolchain</code> to support iterating over all toolchains
that match a request rather than ending earlier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Add support for listing all available toolchains&quot; to &quot;Add support for listing system toolchains&quot; by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-10 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-11 19:10</div>
            <div class="timeline-body"><p>Example</p>
<pre><code>❯ uv toolchain list
cpython-3.12.3-macos-aarch64-none	/opt/homebrew/opt/python@3.12/bin/python3.12
cpython-3.12.3-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.12.3-macos-aarch64-none/install/bin/python3
cpython-3.11.9-macos-aarch64-none
cpython-3.10.14-macos-aarch64-none
cpython-3.9.19-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.9.19-macos-aarch64-none/install/bin/python3
cpython-3.9.6-macos-aarch64-none	/Library/Developer/CommandLineTools/usr/bin/python3
cpython-3.8.19-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.8.19-macos-aarch64-none/install/bin/python3
</code></pre>
<pre><code>❯ uv toolchain list --all-platforms
cpython-3.12.3-windows-x86_64-none
cpython-3.12.3-macos-x86_64-none
cpython-3.12.3-macos-aarch64-none	/opt/homebrew/opt/python@3.12/bin/python3.12
cpython-3.12.3-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.12.3-macos-aarch64-none/install/bin/python3
cpython-3.12.3-linux-x86_64-musl
cpython-3.11.9-windows-x86_64-none
cpython-3.11.9-macos-x86_64-none
cpython-3.11.9-linux-x86_64-musl
cpython-3.10.14-windows-x86_64-none
cpython-3.10.14-macos-x86_64-none
cpython-3.10.14-linux-x86_64-musl
cpython-3.9.19-windows-x86_64-none
cpython-3.9.19-macos-x86_64-none
cpython-3.9.19-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.9.19-macos-aarch64-none/install/bin/python3
cpython-3.9.19-linux-x86_64-musl
cpython-3.9.6-macos-aarch64-none	/Library/Developer/CommandLineTools/usr/bin/python3
cpython-3.8.19-windows-x86_64-none
cpython-3.8.19-macos-x86_64-none
cpython-3.8.19-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.8.19-macos-aarch64-none/install/bin/python3
cpython-3.8.19-linux-x86_64-musl
cpython-3.7.9-windows-x86_64-none
cpython-3.7.9-macos-x86_64-none
</code></pre>
<pre><code>❯ uv toolchain list --all-versions
cpython-3.12.3-macos-aarch64-none	/opt/homebrew/opt/python@3.12/bin/python3.12
cpython-3.12.3-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.12.3-macos-aarch64-none/install/bin/python3
cpython-3.12.3-macos-aarch64-none
cpython-3.12.2-macos-aarch64-none
cpython-3.12.1-macos-aarch64-none
cpython-3.12.0-macos-aarch64-none
cpython-3.11.9-macos-aarch64-none
cpython-3.11.8-macos-aarch64-none
cpython-3.11.7-macos-aarch64-none
cpython-3.11.6-macos-aarch64-none
cpython-3.11.5-macos-aarch64-none
cpython-3.11.4-macos-aarch64-none
cpython-3.11.3-macos-aarch64-none
cpython-3.11.1-macos-aarch64-none
cpython-3.10.14-macos-aarch64-none
cpython-3.10.13-macos-aarch64-none
cpython-3.10.12-macos-aarch64-none
cpython-3.10.11-macos-aarch64-none
cpython-3.10.9-macos-aarch64-none
cpython-3.10.8-macos-aarch64-none
cpython-3.10.7-macos-aarch64-none
cpython-3.10.6-macos-aarch64-none
cpython-3.10.5-macos-aarch64-none
cpython-3.10.4-macos-aarch64-none
cpython-3.10.3-macos-aarch64-none
cpython-3.10.2-macos-aarch64-none
cpython-3.10.0-macos-aarch64-none
cpython-3.9.19-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.9.19-macos-aarch64-none/install/bin/python3
cpython-3.9.19-macos-aarch64-none
cpython-3.9.18-macos-aarch64-none
cpython-3.9.17-macos-aarch64-none
cpython-3.9.16-macos-aarch64-none
cpython-3.9.15-macos-aarch64-none
cpython-3.9.14-macos-aarch64-none
cpython-3.9.13-macos-aarch64-none
cpython-3.9.12-macos-aarch64-none
cpython-3.9.11-macos-aarch64-none
cpython-3.9.10-macos-aarch64-none
cpython-3.9.7-macos-aarch64-none
cpython-3.9.6-macos-aarch64-none	/Library/Developer/CommandLineTools/usr/bin/python3
cpython-3.9.6-macos-aarch64-none
cpython-3.9.5-macos-aarch64-none
cpython-3.9.4-macos-aarch64-none
cpython-3.9.3-macos-aarch64-none
cpython-3.9.2-macos-aarch64-none
cpython-3.8.19-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.8.19-macos-aarch64-none/install/bin/python3
cpython-3.8.19-macos-aarch64-none
cpython-3.8.18-macos-aarch64-none
cpython-3.8.17-macos-aarch64-none
cpython-3.8.16-macos-aarch64-none
cpython-3.8.15-macos-aarch64-none
cpython-3.8.14-macos-aarch64-none
cpython-3.8.13-macos-aarch64-none
cpython-3.8.12-macos-aarch64-none
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-11 19:12</div>
            <div class="timeline-body"><p>Will probably add <code>--all-architectures</code> and <code>--all-libc</code> flags eventually because they seems more useful than <code>--all-platforms</code> but I&#x27;m going to wait. What I did here felt like the minimum necessary for decent output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-11 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-12 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-12 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-12 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-13 13:41</div>
            <div class="timeline-body"><p>Still reviewing, but the first question in my head when I see the output is: why do some installations have a path and some don&#x27;t?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 13:44</div>
            <div class="timeline-body"><p>The ones that don&#x27;t have a path aren&#x27;t downloaded yet. Couldn&#x27;t find a nice way to represent that yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:601 on 2024-06-13 13:47</div>
            <div class="timeline-body"><p>Maybe... <code>result.map_err(|e| should_stop_discovery(&amp;e)).err().unwrap_or(true)</code>? I think that works, but it&#x27;s a little subtle because <code>err()</code> is turning the <code>Result&lt;Foo, bool&gt;</code> into <code>Option&lt;bool&gt;</code>. Could also be written <code>result.err().map_or(true, |e| should_stop_discovery(&amp;e))</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/src/commands/toolchain/list.rs</code>:69 on 2024-06-13 13:49</div>
            <div class="timeline-body"><p>I think you can just do <code>.filter_map(|result| result.ok())</code> here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/src/commands/toolchain/list.rs</code>:80 on 2024-06-13 13:52</div>
            <div class="timeline-body"><p>Oh okay, I see now. The significance of the path in the output is that it indicates a toolchain that is actually installed? But any entry <em>without</em> a path means it is merely available and not installed?</p>
<p>The other thing that I&#x27;m a little confused by in the output:</p>
<pre><code>❯ uv toolchain list --all-versions
cpython-3.12.3-macos-aarch64-none	/opt/homebrew/opt/python@3.12/bin/python3.12
cpython-3.12.3-macos-aarch64-none	/Users/zb/Library/Application Support/uv/toolchains/cpython-3.12.3-macos-aarch64-none/install/bin/python3
cpython-3.12.3-macos-aarch64-none
</code></pre>
<p>Here, <code>cpython-3.12.3-macos-aarch64-none</code> is repeated three times. I get the first two: the output makes it clear they are two distinct installations on my system. But what&#x27;s the third? I guess it means it&#x27;s available but not installed? But I have two of them installed already?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-06-13 13:55</div>
            <div class="timeline-body"><p>LGTM!</p>
<p>Concerning the output, I think my confusion stems from a very strong a priori bias that the list I&#x27;m looking at reflects toolchains that are already installed. Maybe I&#x27;m an odd duck and most won&#x27;t have that bias, and perhaps therefore most won&#x27;t be confused. Not sure.</p>
<p>One idea is to add something like <code>&lt;available to install&gt;</code> or something for each toolchain that is available but not installed. But... I could see that being noisy. And it&#x27;s just kind of redundant info repeated a lot.</p>
<p>I think I still personally like listing only installed toolchains by default, and having an opt-in flag like <code>--available</code> or whatever that shows the bigger output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-13 14:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/toolchain/list.rs</code>:80 on 2024-06-13 14:22</div>
            <div class="timeline-body"><blockquote>
<p>The significance of the path in the output is that it indicates a toolchain that is actually installed? But any entry without a path means it is merely available and not installed?</p>
</blockquote>
<p>Yes</p>
<blockquote>
<p>But what&#x27;s the third? I guess it means it&#x27;s available but not installed? But I have two of them installed already?</p>
</blockquote>
<p>Ah we shouldn&#x27;t list the download there, that&#x27;s a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-13 14:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/toolchain/list.rs</code>:80 on 2024-06-13 14:29</div>
            <div class="timeline-body"><p>(fixed)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-13 14:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:601 on 2024-06-13 14:33</div>
            <div class="timeline-body"><p>Opting for <code>result.as_ref().err().map_or(true, should_stop_discovery)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 14:35</div>
            <div class="timeline-body"><p>Thanks for the review.</p>
<p>I think you have some fair concerns about the output. Maybe I&#x27;m over-optimizing on the fact that we dynamically fetch requested interpreters so it doesn&#x27;t really matter if something is installed or not because you can <code>uv run --python 3.12.3</code> regardless. I&#x27;m trying to do a bit of a paradigm shift here to reflect that so maybe I&#x27;ll merge as is and we can tweak it based on feedback? I&#x27;m biasing towards trying something new during this experimental phase.</p>
<p>I added the <code>&lt;download available&gt;</code> output you mentioned, I think it&#x27;s reasonable. A little annoying if you&#x27;re trying to parse the output, I guess.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 14:37</div>
            <div class="timeline-body"><p>Maybe we <em>shouldn&#x27;t</em> show paths by default and just <em>exclude</em> system interpreters that overlap with managed interpreters by default. Then the output would be nice and simple like I want :) I will explore... probably as a follow-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-13 14:40</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m trying to do a bit of a paradigm shift here to reflect that so maybe I&#x27;ll merge as is and we can tweak it based on feedback? I&#x27;m biasing towards trying something new during this experimental phase.</p>
</blockquote>
<p>Totally in favor of this! If we&#x27;re going to try something new, now is definitely the time.</p>
<blockquote>
<p>Maybe we shouldn&#x27;t show paths by default and just exclude system interpreters that overlap with managed interpreters by default. Then the output would be nice and simple like I want :) I will explore... probably as a follow-up.</p>
</blockquote>
<p>:+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-13 15:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:45:49 UTC
    </footer>
</body>
</html>
