<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>More descriptive error message for `uv run pythonx.xx` - astral-sh/uv #12201</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>More descriptive error message for <code>uv run pythonx.xx</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/12201">#12201</a>
        opened by <a href="https://github.com/JWLee89">@JWLee89</a>
        on 2025-03-16 12:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/JWLee89">@JWLee89</a> on 2025-03-16 12:12</div>
            <div class="timeline-body"><h2>Related Issue</h2>
<p>https://github.com/astral-sh/uv/issues/11796</p>
<h2>Summary</h2>
<ol>
<li>Add meaningful message when user invokes uv with <code>run python&lt;valid-python-version&gt;</code>.</li>
</ol>
<p>‚úÖ &quot;python&quot;, &quot;python3&quot;, &quot;python3.9&quot;, &quot;python4&quot;, &quot;python3.10&quot;, &quot;python3.13.3&quot;, &quot;python39&quot; (yes, python39 might still be released in 100 years üòÜ )
‚ùå &quot;python3abc&quot;, &quot;python3.12b3&quot;, &quot;&quot;, &quot;python-foo&quot;</p>
<ol start="2">
<li>Contextual information added depending on whether the command was run inside of a <code>uv project</code> or not. See: https://github.com/astral-sh/uv/pull/12201/files#diff-423c3a82aab6dba4068dd7675391fc9328a66682131dbf2043e7847ab4ba8661R1092</li>
</ol>
<h2>Automated Tests</h2>
<ol>
<li>Added unit test for new functions created for parsing and validating python executable entered by user</li>
<li>TODO: Once specs are finalized through discussions in PR, will create integration tests if necessary</li>
</ol>
<h2>Need to Discuss</h2>
<ol>
<li>Invoking python via its patch version - E.g. <code>python3.11.9</code> is invalid. However, uv supports <code>uv run -p 3.11.9 python</code>, which is why when we do the following:</li>
</ol>
<pre><code class="language-python">uv run python3.11.9
</code></pre>
<p>We will get the following error:</p>
<pre><code class="language-shell">error: Failed to spawn: `python3.11.9`
  Caused by: `python3.11.9` not available in the environment, which uses python `3.11.9`. Did you mean to search for a Python 3.11.9 environment with `uv run -p 3.11.9 python`?
</code></pre>
<p>Is this okay? If not, we need to define the specs in the PR here.</p>
<ol start="2">
<li>Supported python executable specs are defined as:</li>
</ol>
<ul>
<li>is stable version</li>
<li>is not <code>post</code> version</li>
</ul>
<p>See:https://github.com/astral-sh/uv/pull/12201/files#diff-423c3a82aab6dba4068dd7675391fc9328a66682131dbf2043e7847ab4ba8661R1572-R1574</p>
<p>Would this be okay?
We can change the specs if needed. Lets discuss.</p>
<h2>Manual Test</h2>
<h3>Case 1: run outside of project</h3>
<ol>
<li>Case where no project is created. Look for a python executable version that is not available in my local machine (in my case, it was <code>python3.9</code>)</li>
<li>Run <code>cargo run -- run python3.9.3</code></li>
</ol>
<pre><code class="language-Shell">error: Failed to spawn: `python3.9.3`
  Caused by: `python3.9.3` not available in the environment, which uses python `3.11.9`. Did you mean to search for a Python 3.9.3 environment with `uv run -p 3.9.3 python`?
</code></pre>
<ol start="5">
<li>Run <code>cargo run -- run python3.9</code></li>
</ol>
<pre><code class="language-shell">error: Failed to spawn: `python3.9`
  Caused by: `python3.9` not available in the environment, which uses python `3.11.9`. Did you mean to search for a Python 3.9 environment with `uv run -p 3.9 python`?
</code></pre>
<ol start="6">
<li>Run <code>cargo run -- run python3.11</code></li>
</ol>
<pre><code class="language-Shell">Running `target/debug/uv run python3.11`
Python 3.11.9 (main, Apr  2 2024, 08:25:04) [Clang 15.0.0 (clang-1500.3.9.4)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
</code></pre>
<ol start="7">
<li>Run <code>cargo run -- run python3.11.9</code></li>
</ol>
<pre><code class="language-Shell"> Running `target/debug/uv run python3.11.9`
error: Failed to spawn: `python3.11.9`
  Caused by: `python3.11.9` not available in the environment, which uses python `3.11.9`. Did you mean to search for a Python 3.11.9 environment with `uv run -p 3.11.9 python`?
</code></pre>
<p><strong>IMPORTANT</strong>: Is this acceptable? Invoking python by its patch version is not supported, so this is the expected behavior, but we need to discuss whether this behavior is acceptable.</p>
<h3>Case 2: run inside of project</h3>
<p>Create project using <code>uv init example-app</code></p>
<ol>
<li><code>uv run python3.13</code></li>
</ol>
<pre><code class="language-shell">error: Failed to spawn: `python3.13`
  Caused by: `python3.13` not available in the project environment, which uses python `3.12.5`. Did you mean to change the environment to Python 3.13 with `uv run -p 3.13 python`?
</code></pre>
<ol start="2">
<li><code>uv run python3</code></li>
</ol>
<pre><code class="language-shell">uv run python3
Python 3.12.5 (main, Aug  6 2024, 19:08:49) [Clang 15.0.0 (clang-1500.3.9.4)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @charliermarsh on 2025-03-16 17:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-16 15:36</div>
            <div class="timeline-body"><p>Hey @JWLee89, thanks for the contribution! This looks like a nice improvement. We can provide some feedback to unblock adding tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-16 15:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:1110 on 2025-04-16 15:38</div>
            <div class="timeline-body"><p>Should <code>is_python_executable</code> be <code>python_executable_version -&gt; Some(str)</code> instead? Then you can avoid the <code>unwrap_or</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-16 15:40</div>
            <div class="timeline-body"><p>I think the semantics make sense here. I wonder if we can reuse anything from the <code>uv-python</code> crate, but nothing obvious comes to mind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2025-04-16 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @jtfmumm by @jtfmumm on 2025-04-16 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-04-16 16:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv/src/commands/project/run.rs</code>:1110 on 2025-04-16 16:00</div>
            <div class="timeline-body"><p>Maybe <code>specified_version</code> instead of <code>version_part</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv/src/commands/project/run.rs</code>:1628 on 2025-04-16 16:04</div>
            <div class="timeline-body"><p>Since this is likely a typo and we probably don't have to worry about the distant future at the moment, should we detect cases over 37 and treat them as typos? Not necessary for this PR though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-04-16 16:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-16 16:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:1585 on 2025-04-16 16:06</div>
            <div class="timeline-body"><p>Worth noting this isn't sufficient for Windows, where you'll have a <code>.exe</code> suffix (though versioned executables are not common there)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JWLee89">@JWLee89</a> on <code>crates/uv/src/commands/project/run.rs</code>:1585 on 2025-04-19 06:40</div>
            <div class="timeline-body"><p>@zanieb</p>
<p>Thank you for the followup!</p>
<h2>Windows handling logic</h2>
<p>Good point! I don't a windows machine available to me right now, but my guess is that the access pattern for invoking python will be something like the following:</p>
<pre><code class="language-Shell"># versioned executable
python3.11.exe
# General 
python.exe
</code></pre>
<p>Would this be correct?</p>
<p>A simple approach could be also stripping suffix <code>.exe</code>. I don't think we should introduce complexity by checking whether the host is running windows unless this contextual information is already available without extra compute somewhere else.</p>
<h2>Additional Possible Cases for Windows.</h2>
<p>From some quick ChatGPT search, I found the following:</p>
<p>|   Command   |                                Notes                               |
|:-----------:|:------------------------------------------------------------------:|
| python      | After installing via the official installer, adds to PATH.         |
| py          | Python launcher for Windows. Supports version flags like py -3.11. |
| python.exe  | Explicit executable, useful in scripts or batch files.             |
| py -X.Y     | e.g., py -3.10 to launch a specific version via Python launcher.   |
| pythonw.exe | Launches Python without a console window (GUI apps).               |</p>
<p>Out of these items above, do we need to support the py launcher (E.g. <code>py</code>)? Just wanted to be sure :)</p>
<h2>Edge cases</h2>
<p>After thinking I just realized that people might invoke python using the following paths:</p>
<pre><code># absolute path
/usr/bin/python3
# venv path 
/Users/username/repos/uv/venv/bin/python3.10
</code></pre>
<p>Should these kinds of absolute path specifications also be covered by this feature update?</p>
<p>CC: @jtfmumm</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JWLee89">@JWLee89</a> reviewed on 2025-04-19 06:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JWLee89">@JWLee89</a> reviewed on 2025-04-19 06:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JWLee89">@JWLee89</a> on <code>crates/uv/src/commands/project/run.rs</code>:1110 on 2025-04-19 06:53</div>
            <div class="timeline-body"><p>Applied: https://github.com/astral-sh/uv/pull/12201/commits/e4a2fa1c1335af89e960036526d8456baef25fd9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JWLee89">@JWLee89</a> reviewed on 2025-04-19 06:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JWLee89">@JWLee89</a> on <code>crates/uv/src/commands/project/run.rs</code>:1628 on 2025-04-19 06:54</div>
            <div class="timeline-body"><p>I think this can be a good idea, especially since python version <code>37</code> will not likely be released anytime in the future while we are still alive üòÜ .</p>
<p>Still I think we should carefully discuss this and come up with a reasonable spec before making any feature changes.</p>
<p>Would it be okay if I create a separate PR for this once we discuss and decide on specifications here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JWLee89">@JWLee89</a> reviewed on 2025-04-20 07:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JWLee89">@JWLee89</a> on <code>crates/uv/src/commands/project/run.rs</code>:1110 on 2025-04-20 07:31</div>
            <div class="timeline-body"><p>Applied: https://github.com/astral-sh/uv/pull/12201/commits/0cb2d5e35dddaabf6eef93410643bbc58e8098fd</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JWLee89">@JWLee89</a> reviewed on 2025-04-20 13:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JWLee89">@JWLee89</a> on <code>crates/uv/src/commands/project/run.rs</code>:1585 on 2025-04-20 13:21</div>
            <div class="timeline-body"><p>Applied here: https://github.com/astral-sh/uv/pull/12201/commits/e6a801d0fe3deb62318b1e5aed5a18a3e350517b</p>
<p>Specs include:</p>
<ul>
<li>strip <code>.exe</code> suffix</li>
<li>Support absolute path python. E.g. <code>/Users/username/repos/uv/venv/bin/python3.10</code></li>
</ul>
<p>Since spec was defined on the fly, might be good to review and discuss this together.</p>
<p>Thank you! üôá</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @JWLee89 on 2025-04-20 13:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @jtfmumm by @JWLee89 on 2025-04-20 13:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Issue-11796: Provide more descriptive message for uv run pythonx.xx" to "Provide more descriptive message for uv run pythonx.xx" by @konstin on 2025-04-24 13:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Provide more descriptive message for uv run pythonx.xx" to "More descriptive error message for `uv run pythonx.xx`" by @konstin on 2025-04-24 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-24 16:15</div>
            <div class="timeline-body"><p>I pushed some snapshot (integration) tests for a handful of cases.</p>
<p>I think we might want to update the error messages for <code>uv run pythonX.X.X</code> (the case you called out in your description). At least when it matches the patch version in use, it's a bit confusing. Though it's nice to have the rest of the message when it's not matched. But it seems like an opportunity to indicate that this is not expected usage. The first snapshot test I added captures this behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JWLee89">@JWLee89</a> on 2025-04-26 08:43</div>
            <div class="timeline-body"><blockquote>
<p>I pushed some snapshot (integration) tests for a handful of cases.</p>
</blockquote>
<p>Thank you so much for adding the snapshot (integration) tests! üôá
I will keep this in mind when working on future PRs to add integration tests when necessary.</p>
<blockquote>
<p>I think we might want to update the error messages for <code>uv run pythonX.X.X</code> (the case you called out in your description). At least when it matches the patch version in use, it's a bit confusing. Though it's nice to have the rest of the message when it's not matched. But it seems like an opportunity to indicate that this is not expected usage. The first snapshot test I added captures this behavior.</p>
</blockquote>
<p>I absolutely agree and thank you for bringing this up!
Applied: https://github.com/astral-sh/uv/pull/12201/commits/99765005f3ef2e5e4da44a83a300980bdcd49b42</p>
<p>I should have clarified about this point properly in this PR.
In my environment, I reproduced it with the following command:</p>
<pre><code class="language-bash">uv run python3.13.2
</code></pre>
<p>Results:</p>
<pre><code class="language-bash">`python3.13.2` not available in the virtual environment, which uses python `3.13.2`. Did you mean to search for a Python 3.13.2 environment with `uv run -p 3.13.2 python`?
</code></pre>
<h2>Description of update</h2>
<p>When users specify up to the patch version:</p>
<pre><code class="language-bash">uv run python3.3.3
</code></pre>
<p>I updated so that if users specify up to the patch version. E.g. <code>python3.12.x</code>, we get a error message that tells users to either use <code>uv run -p</code> or use <code>uv run</code> without the patch version (see below).</p>
<pre><code class="language-bash">error: Failed to spawn: `python3.3.3`
  Caused by: Please omit patch version. Try: `uv run python3.3`. Did you mean to search for a Python 3.3.3 environment with `uv run -p 3.3.3 python`?
</code></pre>
<p>However, if we omit patch version, we will get the following (same behavior as before):</p>
<pre><code class="language-bash">error: Failed to spawn: `python3.3`
  Caused by: `3.3` not available in the virtual environment, which uses python `3.13.2`. Did you mean to search for a Python 3.3 environment with `uv run -p 3.3 python`?
</code></pre>
<p><strong>Note</strong>: message is subject to discussion and I think after iterating together, we can come up with the finalized message soon :).
For now, I just want to emphasize that I implemented the logic to change the error message depending on whether patch version is omitted or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JWLee89">@JWLee89</a> on 2025-05-22 01:34</div>
            <div class="timeline-body"><p>Hi @jtfmumm and @zanieb ,</p>
<p>Sorry for the ping ~ I know that you are both very busy.
Just wanted to touch base and see if there are any changes / improvements that should be made to this PR üòÑ .</p>
<p>P.S. No rush, please respond only when you have time to review.</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JWLee89">@JWLee89</a> on 2025-06-09 04:32</div>
            <div class="timeline-body"><p>Hello @jtfmumm and @zanieb,</p>
<p>Just wanted to follow up and double-check if there is any other items I can add to this PR to improve it.
No rush: just a gentle followup (I know that you are both very busy).</p>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-09 11:50</div>
            <div class="timeline-body"><p>Hi @JWLee89. Thanks for your patience on this PR. We still need to make a decision on the messaging. I'll follow up with you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JWLee89">@JWLee89</a> on 2025-06-10 06:34</div>
            <div class="timeline-body"><blockquote>
<p>Hi @JWLee89. Thanks for your patience on this PR. We still need to make a decision on the messaging. I'll follow up with you.</p>
</blockquote>
<p>Hi @jtfmumm ,</p>
<p>Thank you for the update! üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JWLee89">@JWLee89</a> on 2025-08-19 03:13</div>
            <div class="timeline-body"><p>Hello @jtfmumm @zanieb ,</p>
<p>Just wanted to check if there has been any updates on decision-making for this feature.
No need to respond right away, I know that you both are very busy üòÑ .</p>
<p>Thank you!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:21 UTC
    </footer>
</body>
</html>
