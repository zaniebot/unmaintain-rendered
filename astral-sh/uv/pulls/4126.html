<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Discussion] Allow pre-loading metadata for installed dists - astral-sh/uv #4126</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Discussion] Allow pre-loading metadata for installed dists</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/4126">#4126</a>
        opened by <a href="https://github.com/aochagavia">@aochagavia</a>
        on 2024-06-07 07:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aochagavia">@aochagavia</a></div>
            <div class="timeline-body"><p>Note: this is more an issue than a PR, but since I've already made the changes in my fork, I thought I'd open a PR so you can see the code next to my explanation.</p>
<h2>Problem</h2>
<p>I'm using uv's solver in a custom environment, where distributions that are considered to be already installed are not actually present in the filesystem. Instead, I manually tell the solver about them. However, the solver tries to load the distributions' metadata from the filesystem, which causes an error (because it cannot find the <code>METADATA</code> file).</p>
<h2>Proposed solution</h2>
<p>Instead of going directly to the filesystem, we could make it possible to provide pre-loaded metadata when specifying installed dists. If absent, the solver can fall back to the filesystem, as we do today. This is what I have implemented in this PR.</p>
<h2>Additional considerations</h2>
<p>In my current implementation I focused in getting this working, so it's probably on the ugly side. If there's enough interest, I can try to rearchitect it in a way that fits the uv codebase better (though some guidance will be needed). Also, I totally understand if my proposal deviates too much from what uv is trying to achieve, so feel free to close this PR and then I'll make sure to regularly rebase my fork (this feature is a deal-breaker to me, unless I can find a workaround).</p>
<h2>Test Plan</h2>
<p>I tested this manually, but I guess we should have automated tests if we decide we want this feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-07 13:58</div>
            <div class="timeline-body"><p>Interesting. I don't have much to say about the change, it's not very invasive but we're generally pretty hesitant to pick up code that would be &quot;dead&quot; on our end.</p>
<blockquote>
<p>where distributions that are considered to be already installed are not actually present in the filesystem</p>
</blockquote>
<p>Can you share more about the use case for this? It sounds peculiar :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aochagavia">@aochagavia</a> on 2024-06-07 18:45</div>
            <div class="timeline-body"><blockquote>
<p>We're generally pretty hesitant to pick up code that would be &quot;dead&quot; on our end.</p>
</blockquote>
<p>That makes sense to me... It's probably what I myself would do as well.</p>
<blockquote>
<p>Can you share more about the use case for this? It sounds peculiar :)</p>
</blockquote>
<p>I'm prototyping a system that analyses container images, determines which pip packages are installed in a specific virtual environment, installs additional packages requested by the user, and returns a new container image. Instead of starting the container or extracting its files to disk, I'm going through the layers in-memory (they are just tar files) and extract package information as I find it (the <code>METADATA</code> and <code>direct_url.json</code> files). The idea (which still needs to be validated) is to derive container images significantly faster than with dockerfiles, in part due to new caching possibilities (e.g. each package becomes its own image layer, so you can mix and match them).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aochagavia">@aochagavia</a> on 2024-06-11 06:55</div>
            <div class="timeline-body"><p>Since this is not really useful for uv itself, I'm closing the issue. Thanks for the discussion ðŸ˜‰</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @aochagavia on 2024-06-11 06:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:37:25 UTC
    </footer>
</body>
</html>
