<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patch embedded install path for Python dylib on macOS during `python install` - astral-sh/uv #10629</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Patch embedded install path for Python dylib on macOS during <code>python install</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/10629">#10629</a>
        opened by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a>
        on 2025-01-15 11:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes #10598</p>
<h2>Test Plan</h2>
<p>Looking for input here @zanieb. How/where would you include tests for this?
More broadly: do we want a failure to perform the rename to be a hard error? Or should it start out as a warning?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @konstin on 2025-01-15 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-01-15 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/macos_dylib.rs</code>:20 on 2025-01-15 15:46</div>
            <div class="timeline-body"><p>Can we do this in a single invocation so we don't pay the overhead of invoking the tool twice? I think you should be able to match the error to determine if it failed because the command was missing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-15 15:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/python/install.rs</code>:315 on 2025-01-15 15:50</div>
            <div class="timeline-body"><p>As you mentioned, this probably shouldn't be a hard error to start. We can turn it into a warning here, or in the called function. Here seems a bit more ergonomic because in a future change, we could push it to a <code>warnings</code> list like we do for <code>errors</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-15 15:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-15 15:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/macos_dylib.rs</code>:44 on 2025-01-15 15:51</div>
            <div class="timeline-body"><p>This is not used right now, right?</p>
<p>I like the message but I think it'd be overwhelming to beginners (who probably don't care if this failed?).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-15 16:00</div>
            <div class="timeline-body"><p>Nice patch! I guess we can add a macOS-only test case for this in <code>crates/uv/tests/it/python_install.rs</code> and validate the output of otool? I'm not sure if we want to just snapshot the otool output or assert the expected substring is present / the other is not. Sometimes both is best.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-01-15 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Fix: path install name for Python's dylibs on macOS when the toolchain is installed" to "Patch embedded install path for Python dylib on macOS during `python install`" by @zanieb on 2025-01-15 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on <code>crates/uv/src/commands/python/install.rs</code>:315 on 2025-01-15 16:15</div>
            <div class="timeline-body"><p>I've done this in <a href="https://github.com/astral-sh/uv/pull/10629/commits/95d3adf851f75b53b5b52f35aee27e5e685dbe8a">95d3adf</a>
There's a bit of duplication with respect to the warning message, but since it's just two callsite it's probably acceptable. Happy to move it into the function itself if you prefer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> reviewed on 2025-01-15 16:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on <code>crates/uv-python/src/macos_dylib.rs</code>:20 on 2025-01-15 16:15</div>
            <div class="timeline-body"><p>Yes we can! Done in <a href="https://github.com/astral-sh/uv/pull/10629/commits/95d3adf851f75b53b5b52f35aee27e5e685dbe8a">95d3adf</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> reviewed on 2025-01-15 16:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on <code>crates/uv-python/src/macos_dylib.rs</code>:44 on 2025-01-15 16:16</div>
            <div class="timeline-body"><p>That was an oversight, it should have been returned on if the first command errored out.
I've streamlined the error message in <a href="https://github.com/astral-sh/uv/pull/10629/commits/95d3adf851f75b53b5b52f35aee27e5e685dbe8a">95d3adf</a>, and it will only be shown if logs are enabled.
Do you think what I used for <code>warn_user</code> is acceptable in terms of level of details and verbosity?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> reviewed on 2025-01-15 16:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-15 16:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:179 on 2025-01-15 16:23</div>
            <div class="timeline-body"><p>This seems reasonable, I like the messaging. You probably don't want to repeat the message. You could include <code>e</code> in the warning conditional on <code>tracing::enabled!(tracing::Level::DEBUG)</code> but I think it's also reasonable to just <code>debug!(&quot;{}&quot;, e)</code> and leave the warning as-is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> reviewed on 2025-01-15 16:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on <code>crates/uv-python/src/installation.rs</code>:179 on 2025-01-15 16:51</div>
            <div class="timeline-body"><p>That's a good point, I have done it in https://github.com/astral-sh/uv/pull/10629/commits/200698f801097e0b8e2079a79d10e6bb818d5623</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> reviewed on 2025-01-15 16:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on <code>crates/uv/tests/it/python_install.rs</code>:898 on 2025-01-15 16:53</div>
            <div class="timeline-body"><p>This bit is not going to fly, since it may run on multiple platforms, not just &quot;aarch64-none&quot;.
I haven't found a way to get the &quot;current&quot; platform tag though. Any pointers? @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-15 17:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:898 on 2025-01-15 17:40</div>
            <div class="timeline-body"><p>Perhaps <code>platform_key_from_env</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-01-15 19:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-15 19:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:898 on 2025-01-15 19:28</div>
            <div class="timeline-body"><p>I did this in https://github.com/astral-sh/uv/pull/10629/commits/4f2dfbabe3118fd982d20da32a08e9844d2729e0 quick so we can release it today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-15 19:28</div>
            <div class="timeline-body"><p>Thanks for taking the time to contribute and address the feedback â€” solid work :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-01-15 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-15 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on <code>crates/uv/tests/it/python_install.rs</code>:898 on 2025-01-16 05:48</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> reviewed on 2025-01-16 05:48</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:41:30 UTC
    </footer>
</body>
</html>
