<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warn when trying to `uv sync` a package without build configuration - astral-sh/uv #7420</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Warn when trying to <code>uv sync</code> a package without build configuration</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7420">#7420</a>
        opened by <a href="https://github.com/lucab">@lucab</a>
        on 2024-09-16 10:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a></div>
            <div class="timeline-body"><p>This enhances <code>uv sync</code> logic in order to detect and warn if it is trying to operate on a packaged project with entrypoints.</p>
<p>Ref: <a href="https://github.com/astral-sh/uv/issues/6998">astral-sh/uv#6998</a>#issuecomment-2329291764
Closes: <a href="https://github.com/astral-sh/uv/issues/7034">astral-sh/uv#7034</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:81 on 2024-09-16 10:05</div>
            <div class="timeline-body"><p>I&#x27;d call this a package with scripts, otherwise it&#x27;s confusable with PEP 723 scripts with metadata</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/run.rs</code>:1956 on 2024-09-16 10:08</div>
            <div class="timeline-body"><p>nit: This should be the function docstring</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:114 on 2024-09-16 10:10</div>
            <div class="timeline-body"><p>Note: <code>IgnoredAny</code> doesn&#x27;t implement <code>Eq</code>, but the trait here seemed unused and fine to drop. Alternatively, we can either 1) store TOML tables in here, or 2) fully deserialize both scripts fields.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/src/commands/project/run.rs</code>:454 on 2024-09-16 10:13</div>
            <div class="timeline-body"><p>Note: sync is performed on CLI add/remove/sync/run, but it seems to annoying to warn on each command. Thus this new warning is only displayed at <code>uv run</code> time, which should be the most effective place. But can be expanded if we prefer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-16 10:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:104 on 2024-09-16 11:23</div>
            <div class="timeline-body"><p>nit: Maybe just <code>uv_package</code>, for an <code>if_</code> function i&#x27;d have expected it returns a <code>bool</code> and not an <code>Option</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-09-16 11:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 12:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:85 on 2024-09-16 12:20</div>
            <div class="timeline-body"><p>I&#x27;d be surprised if we needed this exact combination again. I&#x27;d just add a function like <code>has_scripts</code> and <code>&amp;&amp;</code> that with <code>is_package</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 12:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:88 on 2024-09-16 12:21</div>
            <div class="timeline-body"><p>Why does this use <code>uv_package</code> instead of <code>is_package</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 12:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:83 on 2024-09-16 12:22</div>
            <div class="timeline-body"><p>Should we use <code>has_build_system</code> here now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 12:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:1970 on 2024-09-16 12:26</div>
            <div class="timeline-body"><p>How does this interact with <code>package = true</code> and <code>package = false</code>? If the user sets <code>package = true</code> we will install the scripts. Similarly, if they set <code>package = false</code> we won&#x27;t install the scripts even if there&#x27;s a build system declared.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:1985 on 2024-09-16 12:28</div>
            <div class="timeline-body"><p>We should be more specific than &quot;correctly&quot;. I&#x27;d make sure to say something about how we found scripts but they won&#x27;t be installed. If we&#x27;re only implementing this for <code>uv run</code>, we <em>could</em> be even more specific because we know if they&#x27;re trying to invoke the target and could raise the warning in a more specific case?</p>
<p>Note they also don&#x27;t need to add a build-system the call to action could be to add <code>package = true</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 12:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 12:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:454 on 2024-09-16 12:29</div>
            <div class="timeline-body"><p>I think it makes sense to omit at <code>add</code> / <code>remove</code>. We might want it at <code>sync</code>, otherwise if you sync then active the environment (instead of using <code>uv run</code>), you&#x27;ll never see it.</p>
<p>Maybe with some special-casing per <a href="https://github.com/astral-sh/uv/pull/7420">astral-sh/uv#7420</a>/files#r1761054908 we can make the warnings quieter in <code>uv run</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 12:34</div>
            <div class="timeline-body"><p>@lucab thanks for the self-review comments!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-09-16 12:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:88 on 2024-09-16 12:43</div>
            <div class="timeline-body"><p>that&#x27;s my fault, i didn&#x27;t like <code>is_</code> returning an <code>Option&lt;bool&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-16 13:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:88 on 2024-09-16 13:36</div>
            <div class="timeline-body"><p>Actually my fault, I misunderstood the condition to detect. No need to split the cases in the way I initially did.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-16 14:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/run.rs</code>:1985 on 2024-09-16 14:04</div>
            <div class="timeline-body"><p>This is now a</p>
<pre><code>Skipping scripts installation because this project is not a package. To install them, consider setting `tool.uv.package = true` or configuring a custom `build-system.`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 14:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/sync.rs</code>:2365 on 2024-09-16 14:09</div>
            <div class="timeline-body"><p>We may want a follow-up issue to enumerate which scripts we aren&#x27;t installing here, e.g. &quot;Skipping installation of script <code>entry</code> because...&quot; (depends on parsing the scripts definition)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/sync.rs</code>:81 on 2024-09-16 14:16</div>
            <div class="timeline-body"><p>I&#x27;d say:</p>
<blockquote>
<p>Skipping installation of entry points (<code>project.scripts</code>) because this project is not packaged; to install entry points, set <code>tool.uv.package = true</code> or define a <code>build-system</code></p>
</blockquote>
<p>This is relatively nuanced, so just a few notes:</p>
<ul>
<li>We want to say &quot;entry points&quot; because that&#x27;s the <a href="https://packaging.python.org/en/latest/specifications/entry-points/">official term</a> and just &quot;scripts&quot; could be confused with some <code>foo.py</code> script in the project.</li>
<li>We don&#x27;t use a trailing period in our CLI messages</li>
<li>Usually you&#x27;re just requesting use of a common build-system, &quot;custom&quot; doesn&#x27;t feel like quite the right fit</li>
<li>&quot;packaged&quot; vs &quot;is a package&quot; to match the language in the relevant <a href="https://docs.astral.sh/uv/concepts/projects/#configuring-project-packaging">docs</a></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-16 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/sync.rs</code>:2335 on 2024-09-16 14:16</div>
            <div class="timeline-body"><p>Do you think it&#x27;s worth adding a test case for <code>package = false</code> with a build system defined?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lucab">@lucab</a> on 2024-09-16 14:22</div>
            <div class="timeline-body"><p>From an out-of-band chat with @zanieb:</p>
<ul>
<li>the condition detection can be simplified as a <code>has_scripts() &amp;&amp; !is_package()</code> heuristic.</li>
<li><code>uv sync</code> is a better place for the warning for now, as <code>uv run</code> could be too annoying in the general (non-script) case.</li>
<li>this could be improved by parsing the scripts tables and key-match; that allows key-matching in <code>uv run</code> and adding more details in <code>uv sync</code>. Tracked at <a href="https://github.com/astral-sh/uv/issues/7428">astral-sh/uv#7428</a>.</li>
<li>The initial <code>uv run</code> test can stay in the codebase with a note for the future.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-16 14:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/sync.rs</code>:2335 on 2024-09-16 14:43</div>
            <div class="timeline-body"><p>Added, together with a test and a TODO for <code>uv run</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-09-16 14:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/lucab">@lucab</a> on 2024-09-16 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Warn when trying to `uv run` a package without build configuration&quot; to &quot;Warn when trying to `uv sync` a package without build configuration&quot; by <a href="https://github.com/lucab">@lucab</a> on 2024-09-16 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/lucab">@lucab</a> on 2024-09-16 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/lucab">@lucab</a> on 2024-09-16 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-16 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 15:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:48:15 UTC
    </footer>
</body>
</html>
