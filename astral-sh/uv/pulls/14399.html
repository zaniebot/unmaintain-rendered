<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow Python requests with missing segments - astral-sh/uv #14399</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow Python requests with missing segments</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/14399">#14399</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-07-01 18:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>This allows <code>PythonDownloadRequest</code> which is used for parsing general install key requests to have missing segments, which unblocks requests like <code>windows-aarch64</code> or <code>cpython-linux</code> (whereas before those would require <code>any-any-windows-aarch64</code> and <code>cpython-any-linux</code> respectively). We still require strict ordering of segments.</p>
<p>Previously, we only allowed missing segments at the end of the key.</p>
<p>This uses a state machine for parsing, which is quite a bit more complicated.</p>
<p>I&#x27;m a little hesitant about the possibility that this regresses error messages and the complexity of the implementation, but <code>uv run -p aarch64</code> seems valuable following #13724. The alternative to this would probably be to make these explicit in various places? e.g., expose <code>--python-arch</code>, <code>--python-libc</code>, and <code>--python-os</code>? Or make <code>--python-platform</code> (which already exists) accept a subset of the keys?</p>
<p>There is a possibility of regressions here, e.g., if something matches this parser it will not fallback to the <code>PythonRequest::ExecutableName</code> case and we&#x27;ve made this parser more permissive, but I think that should be quite rare?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;zb/parse key&quot; to &quot;Allow Python requests with missing segments&quot; by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-01 18:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-07-02 16:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:1626 on 2025-07-02 16:29</div>
            <div class="timeline-body"><p>I used these here as a PoC / integration test!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-02 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-07-02 16:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-python/src/downloads.rs</code>:715 on 2025-07-02 16:59</div>
            <div class="timeline-body"><p>This LGTM. Once I figured out how to read one state transition (i.e., the differing behavior based on whether the value parsed or not), I found it easy to pattern match that understanding to the other transitions. So there&#x27;s a fair bit of code, but it follows a nice repeatable structure that I find easy to digest.</p>
<p>So, nice job!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-07-02 17:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/downloads.rs</code>:715 on 2025-07-02 17:01</div>
            <div class="timeline-body"><p>&lt;3 I could document how the machine works a little</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-13 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-13 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-13 16:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:52:58 UTC
    </footer>
</body>
</html>
