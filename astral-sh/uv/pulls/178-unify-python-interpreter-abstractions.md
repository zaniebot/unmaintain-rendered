```yaml
number: 178
title: Unify python interpreter abstractions
type: pull_request
state: merged
author: konstin
labels: []
assignees: []
merged: true
base: main
head: gourgeist-use-shared-python
created_at: 2023-10-24T15:46:13Z
updated_at: 2023-10-25T20:11:37Z
url: https://github.com/astral-sh/uv/pull/178
synced_at: 2026-01-10T15:50:28Z
```

# Unify python interpreter abstractions

---

_Pull request opened by @konstin on 2023-10-24 15:46_

Previously, we had two python interpreter metadata structs, one in gourgeist and one in puffin. Both would spawn a subprocess to query overlapping metadata and both would appear in the cli crate, if you weren't careful you could even have to different base interpreters at once. This change unifies this to one set of metadata, queried and cached once.

Another effect of this crate is proper separation of python interpreter and venv. A base interpreter (such as `/usr/bin/python/`, but also pyenv and conda installed python) has a set of metadata. A venv has a root and inherits the base python metadata except for `sys.prefix`, which unlike `sys.base_prefix`, gets set to the venv root. From the root and the interpreter info we can compute the paths inside the venv. We can reuse the interpreter info of the base interpreter when creating a venv without having to query the newly created `python`.


---

_Comment by @konstin on 2023-10-24 15:46_

Current dependencies on/for this PR:
* main
  * **PR #154** <a href="https://app.graphite.dev/github/pr/astral-sh/puffin/154" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
    * **PR #138** <a href="https://app.graphite.dev/github/pr/astral-sh/puffin/138" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a> 
      * **PR #178** <a href="https://app.graphite.dev/github/pr/astral-sh/puffin/178" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ

This comment was auto-generated by [Graphite](https://app.graphite.dev/github/pr/astral-sh/puffin/178?utm_source=stack-comment).

---

_Review comment by @konstin on `crates/puffin-interpreter/src/get_interpreter_info.py`:1 on 2023-10-24 15:47_

I prefer having these as external scripts to get interpreter and tooling support on them

---

_Review comment by @konstin on `crates/puffin-interpreter/src/interpreter_info.rs`:99 on 2023-10-24 15:47_

This function is mainly copied from gourgeist which had more comprehensive error handling

---

_Review comment by @konstin on `crates/puffin-interpreter/src/virtual_env.rs`:13 on 2023-10-24 15:47_

We can also rename this `Virtualenv`

---

_Review comment by @konstin on `ruff.toml`:4 on 2023-10-24 15:48_

Time to use the formatter ;)

---

_@konstin reviewed on 2023-10-24 15:48_

---

_Review comment by @charliermarsh on `crates/puffin-interpreter/src/virtual_env.rs`:13 on 2023-10-25 04:03_

Let's do `Virtualenv`, sounds good to me.

---

_@charliermarsh reviewed on 2023-10-25 04:03_

---

_@charliermarsh reviewed on 2023-10-25 04:03_

---

_Review comment by @charliermarsh on `ruff.toml`:4 on 2023-10-25 04:03_

Gasp

---

_@charliermarsh approved on 2023-10-25 04:04_

---

_Merged by @charliermarsh on 2023-10-25 20:11_

---

_Closed by @charliermarsh on 2023-10-25 20:11_

---

_Branch deleted on 2023-10-25 20:11_

---
