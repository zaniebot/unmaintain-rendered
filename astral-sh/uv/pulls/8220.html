<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run `uv build` builds in the source distribution bucket - astral-sh/uv #8220</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Run <code>uv build</code> builds in the source distribution bucket</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/8220">#8220</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-10-15 14:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2024-10-15 14:36</div>
            <div class="timeline-body"><p>When building a source distribution to a wheels, we perform the build inside a temporary directory inside the output directory. By default, the output directory is <code>dist/</code> in the repository root. This temp dir placement allows us to move the final wheel to the output directory instead of copying it (a temp dir might be on another device, which means we need to copy instead of moving).</p>
<p>Some build backends such as hatchling traverse upwards from the current directory (the source dist build location) looking for gitignore files to consider. By adding a gitignore in <code>dist/</code> with <code>*</code>, we caused hatchling to ignore all files in our temporary build directory below it, causing empty wheels. To prevent this, we add a <code>.git</code> file as a phony git root. We are already using this trick successfully in the cache. Hatchling sees this <code>.git</code> file, considers it a boundary and does not traverse up to <code>dist/.gitignore</code>.</p>
<p>Fixes #8200</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-10-15 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2024-10-15 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @konstin on 2024-10-15 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-10-15 14:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 15:25</div>
            <div class="timeline-body"><p>Could we instead perform the builds in <code>CacheBucket::Builds</code>? I think it exists for this purpose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add a fake git root for `dist`" to "Run `uv build` builds in the source distribution bucket" by @charliermarsh on 2024-10-15 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-10-15 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-10-15 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-15 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-15 17:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:02:00 UTC
    </footer>
</body>
</html>
