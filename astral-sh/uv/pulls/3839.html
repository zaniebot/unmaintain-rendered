<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add override namespace to pyproject.toml/uv.toml - astral-sh/uv #3839</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add override namespace to pyproject.toml/uv.toml</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3839">#3839</a>
        opened by <a href="https://github.com/Di-Is">@Di-Is</a>
        on 2024-05-26 13:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Di-Is">@Di-Is</a> on 2024-05-26 13:42</div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>See #3834 .</p>
<p>This PR adds a new namespace, <code>override-dependencies</code>, to pyproject.toml/uv.toml.
This namespace assumes that the dependencies you want to override are written in the form of <code>requirements.txt</code>.</p>
<p>a example of pyproject.toml</p>
<pre><code class="language-toml">[project]
name = &quot;example&quot;
version = &quot;0.0.0&quot;
dependencies = [
  &quot;flask==3.0.0&quot;
]

[tool.uv]
override-dependencies = [
  &quot;werkzeug==2.3.0&quot;
]
</code></pre>
<p>This will improve usability by allowing you to override dependencies without having to specify the --override option when running <code>uv pip compile/install</code>.</p>
<h2>Test Plan</h2>
<p>added test to <code>crates/uv/tests/pip_compile.rs</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @Di-Is on 2024-05-26 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-05-26 13:50</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/uv/branches/Di-Is:add-override-namaspace-to-toml">CodSpeed Performance Report</a></h2>
<h3>Merging #3839 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>Di-Is:add-override-namaspace-to-toml</code> (a25f901) with <code>main</code> (1b769b0)</sub></p>
<h3>Summary</h3>
<p><code>âœ… 13</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-27 09:58</div>
            <div class="timeline-body"><p>I skimmed through the diff and it looks good. To get the tests passing you need to run <code>cargo dev generate-json-schema</code> and commit the json change. Mark your PR as ready for review and/or comment when you want a proper review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Di-Is">@Di-Is</a> on 2024-05-28 12:54</div>
            <div class="timeline-body"><p>@konstin
Thanks for the advice!
I was able to update the <code>uv.schema.json</code> successfully!</p>
<p>Over the next few days I added a feature to the output of the <code>uv pip compile</code> to show that it was overridden from the workspace configuration.</p>
<p>Here is an excerpt of the output from <code>uv pip compile</code>.</p>
<pre><code class="language-txt">    werkzeug==2.3.0
        # via.
        # --override (from workspace)
        # flask.
</code></pre>
<p>However, the implementation has become more complicated with the addition of this feature.
Please review when you have time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @Di-Is on 2024-05-28 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add override namaspace to pyproject.toml/uv.toml" to "Add override namespace to pyproject.toml/uv.toml" by @Di-Is on 2024-05-28 14:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/pep508-rs/src/origin.rs</code>:13 on 2024-05-29 14:57</div>
            <div class="timeline-body"><p>Can we call this <code>WorkspaceOverride</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/pep508-rs/src/origin.rs</code>:22 on 2024-05-29 14:58</div>
            <div class="timeline-body"><p>Can we instead attach the file containing the override?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/distribution-types/src/annotation.rs</code>:28 on 2024-05-29 14:59</div>
            <div class="timeline-body"><p>Could you write a value here instead of panicking?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-workspace/src/settings.rs</code>:40 on 2024-05-29 15:03</div>
            <div class="timeline-body"><p>Can you make this <code>Option&lt;Vec&lt;Requirement&gt;&gt;</code>? This should simplify the <code>specification.rs</code> code too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-29 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-05-30 11:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/pep508-rs/src/origin.rs</code>:22 on 2024-05-30 11:46</div>
            <div class="timeline-body"><p>I understand that multiple toml files(pyproject.toml, uv.toml) are combined to obtain an override dependency.</p>
<p>It seems difficult to keep track of which files have which overriding dependencies.</p>
<p>I'll give it a thought.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-05-30 15:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/pep508-rs/src/origin.rs</code>:13 on 2024-05-30 15:04</div>
            <div class="timeline-body"><p>I chose a more general name considering that we might also add a similar namespace to toml for constraints in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-31 09:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/pep508-rs/src/origin.rs</code>:22 on 2024-05-31 09:09</div>
            <div class="timeline-body"><p>Make sense! What i'd like to do is try to avoid explicit panics where possible. Sometimes they are unavoidable, sometimes so you restructure code so the codepath becomes unreachable, sometimes you add a dummy value, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-06-02 13:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/pep508-rs/src/origin.rs</code>:22 on 2024-06-02 13:34</div>
            <div class="timeline-body"><p>I changed to return dummy paths instead of panic.</p>
<p>https://github.com/astral-sh/uv/pull/3839/commits/766bf17dad667fe62a0f9cefd10a066183025b79#diff-a8cc5969fdef854f20c6a58c35e8727e9066c25b4625338501beda19b447ac2bR23</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-06-02 13:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/distribution-types/src/annotation.rs</code>:28 on 2024-06-02 13:36</div>
            <div class="timeline-body"><p>I changed so as not to cause panic.</p>
<p>https://github.com/astral-sh/uv/pull/3839/commits/f480a6571c4e4cac948291730acfbf1acb3af673#diff-838c9ead31fb7f2602f55cb685ca61849dffa88781386be29b84027a83b7258eR28-R30</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-06-02 13:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/uv-workspace/src/settings.rs</code>:40 on 2024-06-02 13:37</div>
            <div class="timeline-body"><p>I added the deserialization process and JsonSchema and changed the type to Vec&lt;pypi_types::Reuqirement&gt;.</p>
<h4>JsonSchema</h4>
<p>https://github.com/astral-sh/uv/pull/3839/commits/766bf17dad667fe62a0f9cefd10a066183025b79#diff-ef8d164011970bb55e80ae99198f0698f74e77faf77cfa76ed6ea650194cad3fR34</p>
<h4>Deserialization</h4>
<p>https://github.com/astral-sh/uv/pull/3839/commits/766bf17dad667fe62a0f9cefd10a066183025b79#diff-c615ba811c1d932585ca0c27d737c61469970854c4e527a9e49d73cba5bef35fR46</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-06-02 13:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/uv/src/main.rs</code>:114 on 2024-06-02 13:57</div>
            <div class="timeline-body"><p>If the flag is not set here, warnings of workspace parsing failure will not be output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-06-02 13:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/uv/src/main.rs</code>:160 on 2024-06-02 13:59</div>
            <div class="timeline-body"><p>Reflect workspace quiet flag after workspace loading.
Added new uv_warnings::disable() for this process.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Di-Is">@Di-Is</a> reviewed on 2024-06-02 14:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Di-Is">@Di-Is</a> on <code>crates/uv/src/main.rs</code>:114 on 2024-06-02 14:02</div>
            <div class="timeline-body"><p>I noticed this bug when I was creating the test.</p>
<p>If it is better to separate them into separate PRs, I will remove the relevant process and some of the tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @Di-Is on 2024-06-02 14:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/main.rs</code>:114 on 2024-06-03 09:35</div>
            <div class="timeline-body"><p>Yeah, could you create a different PR for those please?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-06-03 09:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-06-03 09:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-03 09:52</div>
            <div class="timeline-body"><p>I've removed the warnings changes in this PR to keep this to only adding <code>overrides-dependencies</code>, if you want you can make a separate PR for the warnings changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-06-03 10:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-06-03 10:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-03 13:13</div>
            <div class="timeline-body"><p>@konstin - How does this intersect with the existing overrides feature?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-03 14:23</div>
            <div class="timeline-body"><p>We chain them, so you can use both atm: https://github.com/astral-sh/uv/blob/5c776939d2e1bf388fb0beda1d1ec149ac4ae6e5/crates/uv/src/commands/pip/compile.rs#L406-L415</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-19 06:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:43:10 UTC
    </footer>
</body>
</html>
