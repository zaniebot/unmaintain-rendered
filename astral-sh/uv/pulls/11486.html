<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow `-p` to use complex Python version requests in `uv pip compile` - astral-sh/uv #11486</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow <code>-p</code> to use complex Python version requests in <code>uv pip compile</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11486">#11486</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-02-13 18:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Closes #11285
Closes https://github.com/astral-sh/uv/pull/11437</p>
<p>This changes <code>-p</code> from an alias of <code>--python-version</code> to <code>--python</code> while retaining backwards compatibility for <code>--python-version</code>-like fallback behavior when the requested version, e.g., <code>-p 3.12</code>, cannot be found.</p>
<p>This was initially implemented with a hidden <code>--python-legacy</code> flag which allows us to special case the short <code>-p</code> flag — unlike the implementation in #11437. However, after further discussion, we decided the behavior difference between <code>-p</code> and <code>--python</code> would be confusing so now <code>-p</code> is an alias for <code>--python</code> and <code>--python</code> is special-cased when a version is used.</p>
<p>Additionally, we now respect the <code>UV_PYTHON</code> environment variable, but it is ignored when <code>--python-version</code> is set. If you want different <code>--python-version</code> and <code>--python</code> values, you must do so explicitly. I considered banning this, but it is valid for e.g. <code>--python pypy --python-version 3.12</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @zanieb on 2025-02-13 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.6.0" by @zanieb on 2025-02-13 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Gankra by @zanieb on 2025-02-13 18:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2025-02-13 18:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-13 20:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/pip/compile.rs</code>:121 on 2025-02-13 20:04</div>
            <div class="timeline-body"><p>Should this be enforced in Clap? Separately, I believe we omit periods if it's a single sentence.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-13 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/pip/compile.rs</code>:135 on 2025-02-13 20:05</div>
            <div class="timeline-body"><p>So the net effect here is that we don't error if the version doesn't exist, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-02-13 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-13 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:1185 on 2025-02-13 20:05</div>
            <div class="timeline-body"><p>Why can't this just be done via <code>-p</code>? So <code>--python 3.7</code> and <code>-p 3.7</code> now behave differently?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-13 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:1185 on 2025-02-13 20:05</div>
            <div class="timeline-body"><p><em>Should</em> <code>--python 3.7</code> error if 3.7 isn't installed or available?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-13 20:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/pip/compile.rs</code>:121 on 2025-02-13 20:13</div>
            <div class="timeline-body"><p>Uhh.. I guess it can be since I moved the environment variable reading out of there. That's nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-13 20:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/pip/compile.rs</code>:135 on 2025-02-13 20:14</div>
            <div class="timeline-body"><p>Yes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-13 20:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:1185 on 2025-02-13 20:16</div>
            <div class="timeline-body"><p>It's complicated.</p>
<p><code>--python 3.7</code> continues to work as it does today — it errors if it's not found. I don't know if I want to break that behavior because it <em>does</em> matter when you're not just doing version requests, e.g., <code>--python pypy</code> needs to fail if we can't find that implementation or the tags will be wrong. Similarly, <code>--python &lt;path&gt;</code> needs to fail.</p>
<p>We could special case <code>--python &lt;version&gt;</code> in the future if we want, which (as you said) would let us drop this legacy flag. However, then there would be no way for users to enforce that we actually find that interpreter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-cli/src/lib.rs</code>:1190 on 2025-02-13 20:55</div>
            <div class="timeline-body"><p>this help heading is presumably pointless but i guess it's future-proof</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-02-13 21:03</div>
            <div class="timeline-body"><p>Always setting a great example with your test coverage :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-13 21:12</div>
            <div class="timeline-body"><p>Thanks @Gankra :)</p>
<p>For reference, I talked to @charliermarsh offline and made some more changes in https://github.com/astral-sh/uv/pull/11486/commits/24be46cb27b2a1d13040fdf7436960b874e3ad40 to special-case <code>--python</code> further so it just allows versions to be missing as mentioned in https://github.com/astral-sh/uv/pull/11486#discussion_r1955158236</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-13 21:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/pip/compile.rs</code>:243 on 2025-02-13 21:21</div>
            <div class="timeline-body"><p>Avoids warning if <code>--python</code> intentionally requested a different interpreter than <code>--python-version</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-02-13 21:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-02-13 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-02-13 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-13 21:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:42:00 UTC
    </footer>
</body>
</html>
