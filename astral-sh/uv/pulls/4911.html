<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid AND-ing multi-term specifiers in marker normalization - astral-sh/uv #4911</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid AND-ing multi-term specifiers in marker normalization</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4911">#4911</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-07-09 04:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>Given <code>python_version != &#x27;3.8&#x27; and python_version &lt; &#x27;3.10&#x27;</code>, the first term was expanded to <code>python_version &lt; &#x27;3.8&#x27;</code> and <code>python_version &gt; &#x27;3.8&#x27;</code>. We then AND&#x27;d all three terms together. We don&#x27;t seem to have a way to differentiate between the terms to AND and the terms to OR in the normalization code (it all gets flattened together), so instead this PR expands the expressions at the leaf level and then flattens them at the level above when appropriate.</p>
<p>Closes <a href="https://github.com/astral-sh/uv/issues/4910">astral-sh/uv#4910</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ibraheemdev">@ibraheemdev</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-09 04:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-09 04:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-09 04:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-09 04:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/marker.rs</code>:269 on 2024-07-09 04:43</div>
            <div class="timeline-body"><p>Painful attempt to avoid allocating a vector in the common case (a single term).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-07-09 14:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-09 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-09 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-09 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-07-09 16:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv-resolver/src/marker.rs</code>:224 on 2024-07-09 16:10</div>
            <div class="timeline-body"><p>Is one level deeper enough? Or do we have to recurse?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:46:27 UTC
    </footer>
</body>
</html>
