<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retain and respect settings in tool upgrades - astral-sh/uv #5937</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Retain and respect settings in tool upgrades</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/5937">#5937</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-08-08 21:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>We now persist the <code>ResolverInstallerOptions</code> when writing out a tool receipt. When upgrading, we grab the saved options, and merge with the command-line arguments and user-level filesystem settings (CLI &gt; receipt &gt; filesystem).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-08 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-08 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-08 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-08 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-08 21:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/tool_install.rs</code>:2520 on 2024-08-08 21:32</div>
            <div class="timeline-body"><p>I don&#x27;t know, I guess? So the receipt represents the &quot;most recent&quot; settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-08 21:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/tool_install.rs</code>:2504 on 2024-08-08 21:32</div>
            <div class="timeline-body"><p>Hard to say what the right behavior is here. We could also consider discarding the tool whenever settings differ.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-settings/src/settings.rs</code>:1252 on 2024-08-08 21:43</div>
            <div class="timeline-body"><p>We go through some effort to avoid adding <code>--upgrade</code> to tool receipts. Does that seem right? Otherwise, <code>uv tool install black --upgrade</code> saves <code>upgrade</code> in the receipt...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-08 21:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/tool_install.rs</code>:2520 on 2024-08-09 08:00</div>
            <div class="timeline-body"><p>fwiw for the lockfile we only write non-default values</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-08-09 08:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-09 13:42</div>
            <div class="timeline-body"><p>I will review this morning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-09 13:44</div>
            <div class="timeline-body"><p>Would most appreciate review of the correct / desired behaviors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-09 14:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:2434 on 2024-08-09 14:00</div>
            <div class="timeline-body"><p>You mean <code>flask</code>?</p>
<pre><code>    // Install `flask`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-09 14:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:2470 on 2024-08-09 14:01</div>
            <div class="timeline-body"><p>Aside: We should probably open an issue to define a macro for this, since it&#x27;s non-trivial and repeated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/tool_install.rs</code>:2470 on 2024-08-09 17:20</div>
            <div class="timeline-body"><p>Yeah good idea. I can do it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-09 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-09 17:23</div>
            <div class="timeline-body"><p>Sorry got half way through this then had meetings and forgot — reading now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-09 17:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-settings/src/settings.rs</code>:1252 on 2024-08-09 17:25</div>
            <div class="timeline-body"><p>Yes that would be weird.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-09 17:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:2520 on 2024-08-09 17:27</div>
            <div class="timeline-body"><p>I think updating here makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-09 17:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:2504 on 2024-08-09 17:28</div>
            <div class="timeline-body"><p>This is really tough. It seems okay to change after some user feedback. I&#x27;m leaning towards consistent <code>--upgrade</code> / <code>--reinstall</code> semantics where it is required to change the versions. This matches <code>uv pip install</code>, yes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-09 17:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/tool_install.rs</code>:2504 on 2024-08-09 17:36</div>
            <div class="timeline-body"><p>Yeah</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-09 17:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/tool_install.rs</code>:2504 on 2024-08-09 17:37</div>
            <div class="timeline-body"><p>Now that we have <code>upgrade</code>, I&#x27;m sort of open to making <code>install</code> more aggressive about replacing though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-09 17:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:2504 on 2024-08-09 17:42</div>
            <div class="timeline-body"><p>That makes sense too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-08-09 17:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-09 17:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/tool_install.rs</code>:2504 on 2024-08-09 17:59</div>
            <div class="timeline-body"><p>So we could make it replace whenever the settings or versions differ...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-09 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-09 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-09 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-08-09 18:23</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/uv/branches/charlie/index-receipt">CodSpeed Performance Report</a>
Merging #5937 will <strong>degrade performances by 11.18%</strong>
<p>Comparing <code>charlie/index-receipt</code> (4cf3560) with <code>main</code> (4df0fe9)</p>
Summary
<p><code>❌ 2</code> regressions
<code>✅ 12</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/uv/branches/charlie/index-receipt">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Benchmark | <code>main</code> | <code>charlie/index-receipt</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>wheelname_tag_compatibility[flyte-long-incompatible]</code> | 1.4 µs | 1.6 µs | -11.15% |
| ❌ | <code>wheelname_tag_compatibility[flyte-short-incompatible]</code> | 926.9 ns | 1,043.6 ns | -11.18% |</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:47:16 UTC
    </footer>
</body>
</html>
