<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combine dependency clauses with the same root - astral-sh/uv #3225</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Combine dependency clauses with the same root</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3225">#3225</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2024-04-23 20:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Simplifies dependency errors of the form <code>you require package-a and you require package-b</code> to <code>you require package-a and package-b</code>. Resolves https://github.com/astral-sh/uv/issues/1009.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-04-23 20:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/tests/pip_install_scenarios.rs</code>:369 on 2024-04-23 20:39</div>
            <div class="timeline-body"><p>This one I'm a little unsure about, but I think it's still clearer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-04-23 20:45</div>
            <div class="timeline-body"><p>@zanieb you mentioned that we might want to combine clauses within PubGrub itself. Is there a chance for false reporting with a transformation like this during formatting or does modifying PubGrub just allow for more types of simplification?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @zanieb on 2024-04-23 22:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-04-23 22:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/pip_install_scenarios.rs</code>:369 on 2024-04-23 22:37</div>
            <div class="timeline-body"><p>Hm interesting thanks for flagging. It does seem like an improvement, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:327 on 2024-04-23 22:42</div>
            <div class="timeline-body"><p>I think we should able to do this for packages other than the root as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-04-23 22:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-23 22:52</div>
            <div class="timeline-body"><p>Are you referring to https://github.com/astral-sh/uv/pull/1673#issuecomment-1951578438 or something else?</p>
<p>This looks like a really reasonable step. In contrast to #1673, this implementation seems quite safe. I don't think this could false-report.</p>
<p>I believe the alternative to handling this in the formatter is to derive a new tree with some collapsed nodes. We could look into implementing this in the default PubGrub formatter as well to improve the error messages it displays. I'm not sure we could collapse the nodes in PubGrub's resolver â€” that's more like https://github.com/astral-sh/uv/issues/1901 which requires https://github.com/pubgrub-rs/pubgrub/pull/208.</p>
<p>We may also be able to use this pattern this for other incompatibility types e.g. instead of &quot;because foo is unavailable and bar is unavailable&quot; we could say &quot;because foo and bar are unavailable&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-04-23 22:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:327 on 2024-04-23 22:53</div>
            <div class="timeline-body"><p>I'm not sure if we have scenarios covering other cases though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-23 22:54</div>
            <div class="timeline-body"><p>Nice work :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-04-24 14:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/tests/pip_install_scenarios.rs</code>:369 on 2024-04-24 14:14</div>
            <div class="timeline-body"><p>Just noticed the extra whitespace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-04-24 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv/tests/pip_install_scenarios.rs</code>:369 on 2024-04-24 14:16</div>
            <div class="timeline-body"><p>I wonder if <code>you require package-a but also package-b</code> would be better in general.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-04-24 14:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/pip_install_scenarios.rs</code>:369 on 2024-04-24 14:19</div>
            <div class="timeline-body"><p>I'm not sure that generalizes well for the &quot;proof&quot; that's being stated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-04-24 14:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:327 on 2024-04-24 14:55</div>
            <div class="timeline-body"><p>Created a scenario for that here: https://github.com/astral-sh/packse/pull/179.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-04-24 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @ibraheemdev on 2024-04-24 16:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-04-24 16:29</div>
            <div class="timeline-body"><p>Sweet! Might be worth opening some issues for those follow-ups I mentioned so we don't forget about them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @ibraheemdev on 2024-04-24 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ibraheemdev on 2024-04-24 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Eh2406">@Eh2406</a> on 2024-04-26 22:07</div>
            <div class="timeline-body"><p>Thank you so much for the progress here. Even this targeted fix is probably worth up streaming in pubgrub at some point.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:36:45 UTC
    </footer>
</body>
</html>
