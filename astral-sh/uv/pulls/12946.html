<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `uv add --bounds` to configure the version constraint - astral-sh/uv #12946</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>uv add --bounds</code> to configure the version constraint</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/12946">#12946</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2025-04-17 14:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>By default, uv uses only a lower bound in <code>uv add</code>, which avoids dependency conflicts due to upper bounds. With this PR, this cna be changed by setting a different bound kind. The bound kind can be configured in <code>uv.toml</code>, as a user preference, in <code>pyproject.toml</code>, as a project preference, or on the CLI, when adding a specific project.</p>
<p>We add two options that add an upper bound on the constraint, one for SemVer (<code>&gt;=1.2.3,&lt;2.0.0</code>, dubbed &quot;major&quot;, modeled after the SemVer caret) and another one for dependencies that make breaking changes in minor version (<code>&gt;=1.2.3,&lt;1.3.0</code>, dubbed &quot;minor&quot;, modeled after the SemVer tilde). Intuitively, the major option bumps the most significant version component, while the minor option bumps the second most significant version component. There is also an exact bounds option (<code>==1.2.3</code>), though generally we recommend setting a wider bound and using the lockfile for pinning.</p>
<p>Versions can have leading zeroes, such as <code>0.1</code> or <code>0.0.1</code>. For a single leading 0, we shift the the meaning of major and minor similar to cargo. For two or more leading zeroes, the difference between major and minor becomes inapplicable, instead both bump the most significant component:</p>
<ul>
<li>major: <code>0.1</code> -&gt; <code>&gt;=0.1,&lt;0.2</code></li>
<li>major: <code>0.0.1</code> -&gt; <code>&gt;=0.0.1,&lt;0.0.2</code></li>
<li>major: <code>0.0.1.1</code> -&gt; <code>&gt;=0.0.1.1,&lt;0.0.2.0</code></li>
<li>major: <code>0.0.0.1</code> -&gt; <code>&gt;=0.0.0.1,&lt;0.0.0.2</code></li>
<li>minor: <code>0.1</code> -&gt; <code>&gt;=0.1,&lt;0.1.1</code></li>
<li>minor: <code>0.0.1</code> -&gt; <code>&gt;=0.0.1,&lt;0.0.2</code></li>
<li>minor: <code>0.0.1.1</code> -&gt; <code>&gt;=0.0.1.1,&lt;0.0.2.0</code></li>
<li>minor: <code>0.0.0.1</code> -&gt; <code>&gt;=0.0.0.1,&lt;0.0.0.2</code></li>
</ul>
<p>For a consistent appearance, we try to preserve the number of components in the upper bound. For example, adding a version <code>2.17</code> with the major option is stored as <code>&gt;=2.17,&lt;3.0</code>. If a version uses three components and is greater than 0, both bounds will also use three components (SemVer versions always have three components). Of the top 100 PyPI packages, 8 use a non-three-component version (docutils, idna, pycparser and soupsieve with two components, packaging, pytz and tzdata with two component, CalVer and trove-classifiers with four component CalVer). Example <code>pyproject.toml</code> files with the top 100 packages: <a href="https://gist.github.com/konstin/0aaffa9ea53c4834c22759e8865409f4"><code>--bounds major</code></a> and <a href="https://gist.github.com/konstin/e77f5e990a7efe8a3c8a97c5c5b76964"><code>--bounds minor</code></a>. While many projects follow version scheme that roughly or directly matches the major or minor options, these compatibility ranges are usually not applicable for the also popular CalVer versioning.</p>
<p>For pre-release versions, there are two framings we could take: One is that pre-releases generally make no guarantees about compatibility between them and are used to introduce breaking changes, so we should pin them exactly. In many cases however, pre-release specifiers are used because a project needs a bugfix or a feature that hasn&#x27;t made it into a stable release, or because a project is compatible with the next version before a final version for that release is published. In those cases, compatibility with other packages that depend on the same library is more important, so the desired bound is the same as it would be for the stable release, except with the lower bound lowered to include pre-release.</p>
<p>The names of the bounds and the name of the flag is up for bikeshedding. Currently, the option is call <code>tool.uv.bounds</code>, but we could also move it under <code>tool.uv.edit.bounds</code>, where it would be the first/only entry.</p>
<p>Fixes #6783</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-04-17 14:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/konstin">@konstin</a> on 2025-04-21 14:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-21 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:89 on 2025-04-21 14:16</div>
            <div class="timeline-body"><p>Should this comment say when happens if the assumption is broken?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-21 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:104 on 2025-04-21 14:16</div>
            <div class="timeline-body"><p>For consistency with the others</p>
<pre><code>    /// Allow the same minor version, similar to the semver tilde, e.g., `&gt;=1.2.3,&lt;1.3.0`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-21 14:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/edit.rs</code>:11244 on 2025-04-21 14:21</div>
            <div class="timeline-body"><p>What happens if I change my bounds setting then add an existing package again?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-21 14:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/reference/settings.md</code>:645 on 2025-04-21 14:23</div>
            <div class="timeline-body"><p>I worry this feels like we&#x27;ll use these bounds in other operations. I wonder if it should be <code>default-bounds</code>? or <code>add.bounds</code>? Do you think we&#x27;ll read this setting during <code>uv upgrade</code> eventually? Would we want a separate option for that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-21 14:25</div>
            <div class="timeline-body"><p>We&#x27;ll need a small documentation section in https://docs.astral.sh/uv/concepts/projects/dependencies/ and https://docs.astral.sh/uv/concepts/projects/config/ (not sure which should link to the other yet)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-21 14:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/reference/settings.md</code>:645 on 2025-04-21 14:26</div>
            <div class="timeline-body"><p>(<code>edit.bounds</code> is okay, but I worry it won&#x27;t be obvious to users and it <em>only</em> applies to <code>add</code> edits, right?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/edit.rs</code>:11244 on 2025-04-21 15:09</div>
            <div class="timeline-body"><p>Currently, we only ever set a bound if no bound is provided on the CLI and no bound is already present. If you e.g. <code>uv add numpy</code> and then <code>uv add numpy</code> again after a new release, we don&#x27;t update the lower bound. Similarly, if you manually edit the <code>pyproject.toml</code> to <code>numpy==2.0.0</code>, <code>uv add numpy</code> does not change that bound. I&#x27;ve retained that behavior with the bounds options. I expect actually editing of bounds to shift to <code>uv upgrade</code>, so we can avoid the complexity here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-04-21 15:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-21 15:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/edit.rs</code>:11244 on 2025-04-21 15:28</div>
            <div class="timeline-body"><p>I think <code>uv add foo --bound major</code> then <code>uv add foo --bound minor</code> should mutate the bounds. Similarly, I think <code>uv add numpy --upgrade</code> should update the bounds. I could be okay with these changes happening separately, as you&#x27;re preserving some existing behavior here, but I find the existing behavior weird.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-04-21 15:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/reference/settings.md</code>:645 on 2025-04-21 15:45</div>
            <div class="timeline-body"><p><code>add.bounds</code> sounds good. I have to do the systematic research for that still, but I expect upgrade to have more complex options, such as https://docs.github.com/en/code-security/dependabot/working-with-dependabot/dependabot-options-reference#versioning-strategy--.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-04-23 13:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/reference/settings.md</code>:645 on 2025-04-23 13:24</div>
            <div class="timeline-body"><p>I&#x27;ve gone with <code>add-bounds</code> for now to avoid <code>add.bounds</code> being the only nested option besides the pip namespace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/konstin">@konstin</a> on 2025-04-25 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-25 11:38</div>
            <div class="timeline-body"><p>This should be ready now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3491 on 2025-05-02 15:05</div>
            <div class="timeline-body"><pre><code>    /// The kind of version specifier to use when adding dependencies.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3495 on 2025-05-02 15:08</div>
            <div class="timeline-body"><pre><code>    /// When adding a dependency to the project, if no constraint or URL is provided, a constraint is
    /// added based on the latest compatible version of the package. By default, a lower bound constraint
    /// is used, e.g., `&gt;=1.2.3`.
    ///
    /// When `--frozen` is provided, no resolution is performed, and dependencies are always added without
    /// constraints.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3495 on 2025-05-02 15:08</div>
            <div class="timeline-body"><p>(Sorry, hacky wrapping)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-settings/src/settings.rs</code>:2079 on 2025-05-02 15:09</div>
            <div class="timeline-body"><p>See <a href="https://github.com/astral-sh/uv/pull/12946">astral-sh/uv#12946</a>/files#r2071754289</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:112 on 2025-05-02 15:11</div>
            <div class="timeline-body"><p>Nit, very minor preference</p>
<pre><code>    /// This option is not recommended, as versions are already pinned in the uv lockfile.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:127 on 2025-05-02 15:14</div>
            <div class="timeline-body"><p>Do I need to review this closely? Should we leverage another reviewer like @BurntSushi so I can focus on the ux?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:747 on 2025-05-02 15:14</div>
            <div class="timeline-body"><p>Needs update</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:747 on 2025-05-02 15:15</div>
            <div class="timeline-body"><p>(several other occurrences too)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1670 on 2025-05-02 15:15</div>
            <div class="timeline-body"><p>&lt;3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1721 on 2025-05-02 15:16</div>
            <div class="timeline-body"><p>Here, there are spaces, but in the documentation, there wasn&#x27;t. Should the docs have a space here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1728 on 2025-05-02 15:16</div>
            <div class="timeline-body"><p>Really into this behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1720 on 2025-05-02 15:18</div>
            <div class="timeline-body"><p>Isn&#x27;t this equivalent to the major case above? <code>(&quot;0.0.1.1&quot;, &quot;&gt;=0.0.1.1, &lt;0.0.2.0&quot;),</code> a little confused.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1727 on 2025-05-02 15:19</div>
            <div class="timeline-body"><p>Should this have a trailing zero? I guess we match the original length?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1720 on 2025-05-02 15:19</div>
            <div class="timeline-body"><p>Also unsure why this lacks the trailing zero when we do for <code>major</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/add.rs</code>:99 on 2025-05-02 15:20</div>
            <div class="timeline-body"><pre><code>            &quot;The bounds option is in preview and may change in any future release.&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-05-02 15:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1727 on 2025-05-02 15:20</div>
            <div class="timeline-body"><p>yes, the design is to try to match the length in both constraints.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/add.rs</code>:99 on 2025-05-02 15:21</div>
            <div class="timeline-body"><p>or</p>
<pre><code>            &quot;The bounds option is in preview and may change without warning.&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/add.rs</code>:99 on 2025-05-02 15:21</div>
            <div class="timeline-body"><p>I guess <code>This option is in preview and may change in any future release.</code> is used elsewhere. I don&#x27;t love that messaging. We can revisit separately though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/edit.rs</code>:11863 on 2025-05-02 15:23</div>
            <div class="timeline-body"><p>Can you add tests for repeated adds with different bound requests? (even if not updated, we should have coverage)</p>
<p>Can you also add tests for a subsequent add with explicit bounds? And use of <code>--bounds</code> with explicit bounds?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1727 on 2025-05-02 15:25</div>
            <div class="timeline-body"><p>I find it a bit surprising with <code>major</code> that we include the trailing zeros, honestly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/edit.rs</code>:11863 on 2025-05-02 15:28</div>
            <div class="timeline-body"><p>We should probably still pin to an exact version if you do like... <code>uv add foo&gt;0.1 --bounds exact</code>? Otherwise, you&#x27;d have to use a constraint to do that? I guess that means I generally think we should apply <code>--bounds</code> when a constraint is provided unless <code>--raw-sources</code> is used? (we ought to rename that option to make it more generic). I imagine companies that need exact pinning in their <code>pyproject.toml</code> want to apply even when a constraint is given unless there&#x27;s some additional opt-out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-05-02 15:34</div>
            <div class="timeline-body"><p>LGTM</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-02 15:34</div>
            <div class="timeline-body"><p>Also, great PR description! It was super helpful during review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-02 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-02 15:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1727 on 2025-05-02 15:36</div>
            <div class="timeline-body"><p>I do find the example from the description compelling though</p>
<blockquote>
<p>For example, adding a version 2.17 with the major option is stored as &gt;=2.17,&lt;3.0</p>
</blockquote>
<p>(Sorry for not reading that detail at first)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-05-02 16:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/add.rs</code>:99 on 2025-05-02 16:19</div>
            <div class="timeline-body"><p>I consider the option itself rather stable, and the only major change I&#x27;d expect would be whether we change existing bounds as discussed, so I&#x27;m aiming for some messaging that&#x27;s like &quot;it works, but we might have to toggle the behavior a bit even before the next breaking release&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-05-02 16:46</div>
            <div class="timeline-body"><blockquote>
<p>While many projects follow version scheme that roughly or directly matches the major or minor options, these compatibility ranges are usually not applicable for the also popular CalVer versioning.</p>
</blockquote>
<p>For fixing that versioning, I recommend a per package configuration option in user/workspace <code>uv.toml</code>:</p>
<pre><code>add-bounds = &quot;major&quot;

[per-package-add-bounds]
tzdata = &quot;lower&quot;
</code></pre>
<p>(Yes, it also could be separate work as follow-up...)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-05-04 16:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-workspace/src/pyproject_mut.rs</code>:1720 on 2025-05-04 16:22</div>
            <div class="timeline-body"><p>fixed by adding the missing zero</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-05-04 18:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/edit.rs</code>:11863 on 2025-05-04 18:03</div>
            <div class="timeline-body"><p>I would still apply explicit bounds over the bounds preference, this way you can set <code>bounds = &quot;major&quot;</code> in the configuration and run <code>uv add numpy pandas torch==2.6.0</code>, applying the defaults except for deps for which you have more specific knowledge. It otherwise gets hard to reason about e.g. <code>uv add numpy&gt;=1 --bounds major</code>, which unintuitively would add <code>numpy&gt;=2,&lt;3</code>. That may require more work from the user in specific cases (such as when <code>foo&gt;0.1</code> is possible but wouldn&#x27;t be picked without the constraint due to preferences but you want an exact bound as your use case can&#x27;t rely on <code>uv.lock</code>).</p>
<p>Given that you usually run <code>uv add</code> once, I prefer the simpler rules (any explicit bound always beats the bounds preference) over complex rules trying to infer better bounds from between existing bounds, CLI bounds and default/explicit bounds preference from settings/CLI that require a complex mental model on the user&#x27;s end to get their desired behavior. On the other hand, I do expect some of that complexity to be part of <code>uv upgrade</code>, where we always have an existing bound and want to compute a new bound from the old bound and a latest compatible version (but without a CLI-provided constraint).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-04 18:03</div>
            <div class="timeline-body"><p>@T-256 I would expect something like that to rather go into <code>uv upgrade</code>, as <code>uv add</code> usually only happens once per package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-07 16:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/edit.rs</code>:11863 on 2025-05-07 16:47</div>
            <div class="timeline-body"><blockquote>
<p>That may require more work from the user in specific cases (such as when foo&gt;0.1 is possible but wouldn&#x27;t be picked without the constraint due to preferences but you want an exact bound as your use case can&#x27;t rely on uv.lock).</p>
</blockquote>
<p>Yeah, this is the use-case I&#x27;m worried about. I think people will be surprised by this. Would it be reasonable to implement <em>only</em> when the constraints are trivially less exact than the bounds? I see how it could be confusing in other contexts, but <code>uv add numpy&gt;=1 --bounds minor</code> and <code>uv add numpy&gt;=1 --bounds exact</code> seem easy for users to reason about. As I said before, I would expect to have to use a <code>--raw</code> flag to retain my exact constraint in this context.</p>
<p>Reflecting on your example...</p>
<blockquote>
<p><code>uv add numpy&gt;=1 --bounds major</code>, which unintuitively would add <code>numpy&gt;=2,&lt;3</code> more</p>
</blockquote>
<p>I think this not not actually unintuitive to me? It&#x27;s a bit surprising that we chose the lower bound of <code>&gt;=2</code>, but it&#x27;d be far <em>more</em> surprising to me that we&#x27;d omit the upper bound entirely after I asked for it?</p>
<blockquote>
<p>Given that you usually run uv add once</p>
</blockquote>
<p>I don&#x27;t think this is strictly true. I think this is the only logical place in our interface to change bounds on a package without doing so manually, or doing an upgrade.</p>
<p>If the alternative wasn&#x27;t that they had to literally write their constraints to a file, I might be more willing to just go with this as-is, but it&#x27;s a painful workflow</p>
<p>I&#x27;m really on the fence here, I hear that you want the rules to be simple but I&#x27;m worry it&#x27;s not handling some key use-cases. Perhaps returning to <a href="https://github.com/astral-sh/uv/pull/12946">astral-sh/uv#12946</a>#discussion_r2071852834 ... since it&#x27;s in preview perhaps we can try the simple thing and see how it goes? I just think we&#x27;ll want to be clear that this behavior may evolve.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-07 17:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/edit.rs</code>:11863 on 2025-05-07 17:00</div>
            <div class="timeline-body"><p>At the very least, if we&#x27;re going to ignore <code>--bounds</code> / <code>add-bounds</code>, we should warn when the user provides a specifier?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-05-12 18:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/edit.rs</code>:11863 on 2025-05-12 18:37</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m really on the fence here, I hear that you want the rules to be simple but I&#x27;m worry it&#x27;s not handling some key use-cases. Perhaps returning to #12946 (comment) ... since it&#x27;s in preview perhaps we can try the simple thing and see how it goes? I just think we&#x27;ll want to be clear that this behavior may evolve.</p>
</blockquote>
<p>I&#x27;m pushing back on adding the complexity as I&#x27;m not having enough motivation that we need good constraints support here. Specifically, I haven&#x27;t encountered a situation yet where I was adding a new package and it was resolved to a too-low version that could have been fixed with constraints that the user knows about without knowing the exact bounds. If we change it, we should do it consistently, e.g., change all bounds in the <code>uv add</code> CLI to constraints unless <code>--raw</code> is given. We also need to consider that the bounds preference setting can be a user level default, a project level default or CLI parameter.</p>
<p>When providing bounds, a user knows that they want a not-too-old version, without knowing the exact bounds they want. We cloud add an option to force adding the latest version with the preferred bounds (<code>--latest</code> or <code>--force-latest</code>). This would similarly highlight any dependencies conflicting with the new version while overriding lockfile preferences, serving a user who knows that they want the latest version but doesn&#x27;t know the exact range yet. More generally, we could also always hint the user when we inferred an older version, e.g., telling them that for <code>uv add foo</code> with <code>add-bounds = &quot;major&quot;</code>, we add <code>foo&gt;=5,&lt;6</code> instead of <code>foo&gt;=6,&lt;7</code>, caused by <code>bar==1.2.3</code> in the lockfile requiring <code>foo&lt;6</code>.</p>
<blockquote>
<p>At the very least, if we&#x27;re going to ignore <code>--bounds</code> / <code>add-bounds</code>, we should warn when the user provides a specifier?</p>
</blockquote>
<p>I&#x27;ve added a note when we&#x27;re using the CLI bounds over a bounds preference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-23 15:13</div>
            <div class="timeline-body"><p>@konstin I&#x27;m okay with this, but I&#x27;d like to change this message</p>
<p>https://github.com/astral-sh/uv/pull/12946/files#r2071770491</p>
<p>so that it&#x27;s not scoped to saying &quot;its configuration&quot; may change. We have more leeway with the behavior that way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-23 15:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3572 on 2025-05-23 15:14</div>
            <div class="timeline-body"><p>Should we add one line at the end that says</p>
<blockquote>
<p>This option is in preview and may change in any future release.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-23 15:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-settings/src/settings.rs</code>:2082 on 2025-05-23 15:14</div>
            <div class="timeline-body"><p>Same as <a href="https://github.com/astral-sh/uv/pull/12946">astral-sh/uv#12946</a>/files#r2104809243</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-05-23 15:16</div>
            <div class="timeline-body"><p>I have some minor requests to ensure the preview messaging is clear and allows us to change behavior here. I&#x27;m not sure the behavior when the user provides constraints makes sense to me still, but agree it seems hard to &quot;get right&quot; and that changes should be deferred until we have more signal from users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2025-05-28 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2025-05-28 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-28 13:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:51:47 UTC
    </footer>
</body>
</html>
