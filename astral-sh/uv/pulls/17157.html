<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid enforcing incorrect hash in mixed-hash settings - astral-sh/uv #17157</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid enforcing incorrect hash in mixed-hash settings</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/17157">#17157</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-12-17 02:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Right now, when we return a <code>Dist</code> from a lockfile, we concatenate all hashes for all distributions for a given package. In the case of https://github.com/astral-sh/uv/issues/17143, I think that means we'll return the SHA256 from the sdist, plus the SHA512 from the wheel. If the wheel was previously installed (i.e., it's in the cache), and we computed the SHA256 at that point in time, then <code>Hashed::has_digests</code> would return <code>true</code> because we have <em>at least</em> one SHA256. We now limit the hashes to the distribution that we expect to install.</p>
<p>Closes https://github.com/astral-sh/uv/issues/17143.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2025-12-17 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2025-12-17 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2025-12-17 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-17 02:10</div>
            <div class="timeline-body"><p>Alternatively, we can get rid of <code>has_digests</code> and just use <code>satisfies</code> when we load wheels from the cache. That would also fix this issue, though the change here felt more structurally correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-12-17 10:07</div>
            <div class="timeline-body"><p>Can you add a test for that that mixed hashes situation where there's a SHA256 here and a SHA512 there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-17 13:00</div>
            <div class="timeline-body"><p>Do you have any advice on how to do that easily?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 15:21</div>
            <div class="timeline-body"><p>A mockserver with a find links page that links to three entries in our <code>test/links</code>, one entry with SHA256, one with SHA512 and one with both.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2025-12-17 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-12-17 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-17 16:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:45:37 UTC
    </footer>
</body>
</html>
