<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow users to provide pre-defined metadata for resolution - astral-sh/uv #7442</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow users to provide pre-defined metadata for resolution</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7442">#7442</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-09-16 21:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 21:14</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR enables users to provide pre-defined static metadata for dependencies. It's intended for situations in which the user depends on a package that does <em>not</em> declare static metadata (e.g., a <code>setup.py</code>-only sdist), and that is expensive to build or even cannot be built on some architectures. For example, you might have a Linux-only dependency that can't be built on ARM -- but we need to build that package in order to generate the lockfile. By providing static metadata, the user can instruct uv to avoid building that package at all.</p>
<p>For example, to override all <code>anyio</code> versions:</p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;anyio&quot;]

[[tool.uv.dependency-metadata]]
name = &quot;anyio&quot;
requires-dist = [&quot;iniconfig&quot;]
</code></pre>
<p>Or, to override a specific version:</p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;anyio&quot;]

[[tool.uv.dependency-metadata]]
name = &quot;anyio&quot;
version = &quot;3.7.0&quot;
requires-dist = [&quot;iniconfig&quot;]
</code></pre>
<p>The current implementation uses <code>Metadata23</code> directly, so we adhere to the exact schema expected internally and defined by the standards. Any entries are treated similarly to overrides, in that we won't even look for <code>anyio@3.7.0</code> metadata in the above example. (In a way, this also enables #4422, since you could remove a dependency for a specific package, though it's probably too unwieldy to use in practice, since you'd need to redefine the <em>rest</em> of the metadata, and do that for every package that requires the package you want to omit.)</p>
<p>This is under-documented, since I want to get feedback on the core ideas and names involved.</p>
<p>Closes https://github.com/astral-sh/uv/issues/7393.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-09-16 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @charliermarsh on 2024-09-16 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-09-16 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2024-09-16 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 21:20</div>
            <div class="timeline-body"><p>It would be nice if we had some sort of <code>uv show </code>here to make it easy for users to add these... <code>uv show anyio==3.7.0</code>, then copy-paste into <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 21:25</div>
            <div class="timeline-body"><p>I'm not a fan of the name <code>[[tool.uv.static-metadata]]</code>. I want <code>[[tool.uv.metadata]]</code> but I know that's very dicey to use here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 21:39</div>
            <div class="timeline-body"><p>What do you think of <code>metadata-overrides</code>? Could <code>version</code> be optional for a blanket override?</p>
<p>(Very cool feature!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 23:02</div>
            <div class="timeline-body"><p>Yes and yes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 23:26</div>
            <div class="timeline-body"><p>Done and done. Should I go ahead and add docs here @zanieb? Any other concerns?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 23:49</div>
            <div class="timeline-body"><p>I don't have any other concerns!</p>
<p>Do we want to introduce new things like this in preview? Or just go for it? (I am leaning towards not using preview until later in uv's life)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-17 01:23</div>
            <div class="timeline-body"><p>I was thinking we'd just go for it hah.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-17 02:58</div>
            <div class="timeline-body"><p>Added docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-17 02:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>docs/concepts/resolution.md</code>:268 on 2024-09-17 02:58</div>
            <div class="timeline-body"><p>I would appreciate a read here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-17 02:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>docs/concepts/resolution.md</code>:270 on 2024-09-17 02:59</div>
            <div class="timeline-body"><p>My only complaint with the name (&quot;Metadata overrides&quot;) is that the primary goal isn't to override... It's to allow the user to provide static metadata so that we can skip builds. I think override implies changing the metadata in some way, but the goal here is just to enable users to pre-provide the true metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-17 03:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/concepts/resolution.md</code>:270 on 2024-09-17 03:21</div>
            <div class="timeline-body"><blockquote>
<p>I think override implies changing the metadata in some way, but the goal here is just to enable users to pre-provide the true metadata.</p>
</blockquote>
<p>Fair, but I think if we want to frame it that way we need to provide a way to (1) populate the metadata automatically and/or (2) validate that it matches the distribution at install time.</p>
<p>I wouldn't be upset about &quot;Dependency metadata&quot; instead if we plan to add features like (1) and (2). What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-09-17 09:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>docs/concepts/resolution.md</code>:270 on 2024-09-17 12:32</div>
            <div class="timeline-body"><p>I do want to do (1) and (2), but I probably won't do them ASAP. I don't know what the right API looks like for (1) ðŸ¤”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-17 12:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:809 on 2024-09-17 13:42</div>
            <div class="timeline-body"><p>Is this just to avoid a <code>use serde::Serialize;</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/src/lib.rs</code>:890 on 2024-09-17 13:46</div>
            <div class="timeline-body"><p>What motivated this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>docs/concepts/projects.md</code>:749 on 2024-09-17 13:49</div>
            <div class="timeline-body"><p>I think the question that comes to mind for me when reading this is, &quot;why would I want to skip building a package?&quot; The answer that comes immediately to mind is &quot;for performance,&quot; but I'm not sure that's right. I think this is most useful when building a package in some circumstances is difficult or impossible, and this provides an escape hatch. Maybe that context can be added here? Basically, say more about <em>why</em> users might want to use this feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-09-17 13:49</div>
            <div class="timeline-body"><p>This is quite the hammer. I like it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-17 13:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/lib.rs</code>:890 on 2024-09-17 13:50</div>
            <div class="timeline-body"><p>I got a Clippy warning that the future was too large, I'm not sure why it appeared here, maybe because the size of the settings struct increased. Is <code>Box::pin</code> bad?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-17 13:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>docs/concepts/resolution.md</code>:270 on 2024-09-17 13:57</div>
            <div class="timeline-body"><p>I'm now leaning towards &quot;dependency metadata&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-09-17 16:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/src/lib.rs</code>:890 on 2024-09-17 16:04</div>
            <div class="timeline-body"><p>No, not at all. That Clippy warning seems worth heeding without evidence to the contrary. Just curious.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:890 on 2024-09-17 16:14</div>
            <div class="timeline-body"><p>I've made a similar change a few times.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-17 16:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-17 17:54</div>
            <div class="timeline-body"><p>I rebranded as <code>dependency-metadata</code>. From my perspective it's good to go.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-17 18:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/concepts/projects.md</code>:756 on 2024-09-17 18:58</div>
            <div class="timeline-body"><p>Where does this come from? Can we link to the PyPI inspector or something?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-09-17 19:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-09-18 03:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-18 03:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-18 03:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:01:34 UTC
    </footer>
</body>
</html>
