<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patch pkg-config files to be relocatable - astral-sh/uv #11291</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Patch pkg-config files to be relocatable</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11291">#11291</a>
        opened by <a href="https://github.com/geofft">@geofft</a>
        on 2025-02-06 19:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/geofft">@geofft</a></div>
            <div class="timeline-body"><p>Previously, we patched pkg-config .pc files to have the absolute path to the directory where we unpack a python-build-standalone release.  As discussed in #11028, we can use ${pcfiledir} in a .pc file to indicate paths relative to the location of the file itself.</p>
<p>This change was implemented in astral-sh/python-build-standalone#507, so for newer python-build-standalone releases, we don&#x27;t need to do any patching. Optimize this case by only modifying the .pc file if an actual change is needed (which might be helpful down the line with hard links or something). For older releases, change uv&#x27;s patch to match what python-build-standalone now does.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/geofft">@geofft</a> on 2025-02-06 19:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/geofft">@geofft</a> on 2025-02-06 19:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-02-06 19:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-06 19:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/sysconfig/mod.rs</code>:352 on 2025-02-06 19:57</div>
            <div class="timeline-body"><p>Does this mean we aren&#x27;t applying this to <code>.pc</code> files that we&#x27;ve already patched? Since, in that case, I guess the RHS of the <code>=</code> would <em>not</em> be <code>/install</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-06 19:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/sysconfig/mod.rs</code>:352 on 2025-02-06 19:59</div>
            <div class="timeline-body"><p>Unrelated, but does the comment above</p>
<blockquote>
<p>// Given, e.g., <code>prefix=/install</code>, replace with <code>prefix=/real/prefix</code>.</p>
</blockquote>
<p>Need to be updated?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-06 20:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/sysconfig/mod.rs</code>:352 on 2025-02-06 20:00</div>
            <div class="timeline-body"><p>I don&#x27;t mind if we avoid patching already patched <code>.pc</code> files without <code>--reinstall</code>, though I would have to double check how the patch on reinstall behavior works in practice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/geofft">@geofft</a> reviewed on 2025-02-06 20:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-python/src/sysconfig/mod.rs</code>:352 on 2025-02-06 20:43</div>
            <div class="timeline-body"><p>Wait, does <code>--reinstall</code> not delete and re-unpack the entire directory? I don&#x27;t follow the whole flow of this code but that surprises me if so.</p>
<p>(Or do you mean that this doesn&#x27;t apply to .pc files that we patched during the python-build-standalone release process? Yes.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-06 21:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/sysconfig/mod.rs</code>:352 on 2025-02-06 21:31</div>
            <div class="timeline-body"><p>Yeah I believe <code>--reinstall</code> does delete and re-unpack the entire directory. I was referring to the case of: you run <code>uv python install 3.12</code>, and <code>3.12</code> is already installed. In that case, we <em>do</em> call through to these patch routines, but I don&#x27;t think this patch would take effect (since the already-patched <code>.pc</code> file wouldn&#x27;t match the above pattern). I defer to you two on whether that&#x27;s important (seems fine).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-06 22:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/sysconfig/mod.rs</code>:352 on 2025-02-06 22:46</div>
            <div class="timeline-body"><p>I agree it seems fine without an explicit reinstall. Thanks for clarifying the behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-02-07 22:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-07 23:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-07 23:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:50:44 UTC
    </footer>
</body>
</html>
