<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Git trees lazily on checkout - astral-sh/uv #8190</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Load Git trees lazily on checkout</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/8190">#8190</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-10-14 21:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-14 21:55</div>
            <div class="timeline-body"><p>Exploring https://github.com/astral-sh/uv/pull/3950</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @zanieb on 2024-10-14 21:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-14 22:49</div>
            <div class="timeline-body"><p>Turns out this is still really hard. Some weird behavior due to our local clone, I think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-14 23:19</div>
            <div class="timeline-body"><p>I suspect that we are doing a dynamic fetch and the promisor is the sparse local tree?</p>
<blockquote>
<p>Since almost all Git code currently expects any referenced object to be present locally and because we do not want to force every command to do a dry-run first, a fallback mechanism is added to allow Git to attempt to dynamically fetch missing objects from promisor remotes.</p>
<p>When the normal object lookup fails to find an object, Git invokes promisor_remote_get_direct() to try to get the object from a promisor remote and then retry the object lookup. This allows objects to be &quot;faulted in&quot; without complicated prediction algorithms.</p>
<p>Dynamic object fetching will only ask promisor remotes for missing objects. We assume that promisor remotes have a complete view of the repository and can satisfy all such requests.</p>
</blockquote>
<p>Which fails since https://github.com/git/git/commit/301f1e3ac1531dc3a15064a06b24fa98f02a3b78</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:13 UTC
    </footer>
</body>
</html>
