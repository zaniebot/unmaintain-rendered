<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow all arguments to be repeated in the CLI - astral-sh/uv #3259</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow all arguments to be repeated in the CLI</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/3259">#3259</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-04-25 03:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-25 03:16</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>We need to decide if we actually want to change this, but I wanted to test it out anyway.</p>
<p>Closes https://github.com/astral-sh/uv/issues/3248.</p>
<h2>Test Plan</h2>
<p>Ran <code>echo &quot;flask&quot; | cargo run pip compile - --output-file req.txt --output-file foo.txt</code>, and verified that <code>foo.txt</code> was populated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @charliermarsh on 2024-04-25 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-04-25 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @charliermarsh on 2024-04-25 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-25 03:17</div>
            <div class="timeline-body"><p>I think I'm weakly in favor given that it seems like a popular behavior. Per https://github.com/clap-rs/clap/discussions/2627, it seems like you do this in ripgrep Andrew?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-25 03:17</div>
            <div class="timeline-body"><p>I'm not yet convinced this is a better experience for the majority of users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-25 03:21</div>
            <div class="timeline-body"><p>I wasn't really sold, but it seems to be the default in most tools, and every CLI I've tested since researching this issue seems to operate this way (e.g., <code>git</code>, <code>gh</code>, and so on). Given that, I suspect that it's actually more surprising to users that it <em>doesn't</em> work than it is helpful in the rare cases that you accidentally repeat an argument.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2024-04-25 03:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-04-26 11:45</div>
            <div class="timeline-body"><p>I am loosely in favor.</p>
<p>It's true that this is enabled in ripgrep, and has been for a long time. I don't use Clap any more in ripgrep, but in the move off of it, I think it's fair to say that I've doubled down on this behavior. I think the original motivation for allowing args to override itself is to be more flexible in the face of different workflows. For example, a user might have <code>--max-columns 100</code> in their config file (or an alias). But maybe the user wants to change that to something else for a specific invocation. Without being able to override previous values, the user isn't allowed to do that.</p>
<p>Anyway, how much of this applies to <code>uv</code>? I'm not sure. I'm not sure <code>uv</code> benefits as much from being super flexible. It's hard to pick a non-contrived example, but, what's the behavior of <code>--index-strategy unsafe-any-match --index-strategy first-match</code>? Today it returns an error, but I feel like it has obvious intended semantics: the index strategy should be set to <code>first-match</code>. Now... whether that specific example will come up in the wild or not is unclear. It would probably mean having <code>--index-strategy unsafe-any-match</code> in an alias or something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-26 14:44</div>
            <div class="timeline-body"><p>My complaint is arguments where it's ambiguous if we accept multiple items, e.g.<code>--output-file</code> (as discussed in #3248) which could easily mean &quot;write to all of the provided files&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-04-26 15:25</div>
            <div class="timeline-body"><blockquote>
<p>My complaint is arguments where it's ambiguous if we accept multiple items, e.g.<code>--output-file</code> (as discussed in #3248) which could easily mean &quot;write to all of the provided files&quot;</p>
</blockquote>
<p>Yeah that is somewhat unfortunate. I think I'd still go with the flexibility though.</p>
<p>Another choice is that we could do both here: we could set this option globally (to allow most flags to override themselves) while treating ambiguous flags like <code>--output-file</code> specially. Although, how to do that using Clap isn't totally clear to me. (An obvious approach is to say that it can be used multiple times and error if it's used more than once, but then I imagine the auto-generated docs for that flag will be wrong.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-23 23:29</div>
            <div class="timeline-body"><p>I remain weakly in favor of this, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-24 13:41</div>
            <div class="timeline-body"><p>Is anyone asking for this still?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-24 13:53</div>
            <div class="timeline-body"><p>Not beyond the original ask.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2024-09-24 15:03</div>
            <div class="timeline-body"><blockquote>
<p>Is anyone asking for this still?</p>
</blockquote>
<p>I'm still very much hoping for it, and it is still behind bugs and limitations in my own project when using the optional and mostly preferred <code>uv</code> backend, where I can't currently get away with the same handling I use for overriding <code>pip</code>, <code>pip-compile</code>, and <code>pip-sync</code> options on a per-invocation basis.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2024-10-09 19:50</div>
            <div class="timeline-body"><p>Would this be any more palatable if it required explicit enabling via another flag?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2024-10-25 15:28</div>
            <div class="timeline-body"><p>What if this usage came with a warning on stderr clarifying which option is being used?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-03-03 02:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:12 UTC
    </footer>
</body>
</html>
