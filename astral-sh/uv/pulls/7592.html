<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support installing additional executables in `uv tool install` - astral-sh/uv #7592</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support installing additional executables in <code>uv tool install</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/7592">#7592</a>
        opened by <a href="https://github.com/lucab">@lucab</a>
        on 2024-09-20 17:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/lucab">@lucab</a> on 2024-09-20 17:04</div>
            <div class="timeline-body"><p>This enhances <code>uv tool install</code> in order to allow installing executables from multiple packages in a single call.</p>
<p>Closes https://github.com/astral-sh/uv/issues/6314</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3276 on 2024-09-20 17:13</div>
            <div class="timeline-body"><p>Nit: Should be <code>Vec&lt;PackageName&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3086 on 2024-09-20 17:19</div>
            <div class="timeline-body"><p>Funny, suggests we probably want to switch to a list display at some point?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3086 on 2024-09-20 17:19</div>
            <div class="timeline-body"><p>Why is it 24 uninstalled but 11 + 1 + 1 installed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3058 on 2024-09-20 17:20</div>
            <div class="timeline-body"><p>We'll probably want to collapse these and/or include the &quot;from&quot; package</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3029 on 2024-09-20 17:21</div>
            <div class="timeline-body"><p>Minor note: This is probably an expensive test because the package is big. We might want to find a smaller package to keep the test case minimal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:880 on 2024-09-20 17:21</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            // Synthesize extra dependencies by merging all additionally
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3060 on 2024-09-20 17:23</div>
            <div class="timeline-body"><p>We'll definitely want to snapshot the receipt here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-20 17:23</div>
            <div class="timeline-body"><p>Nice! This seems like a great start.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-20 17:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/tool_install.rs</code>:3086 on 2024-09-20 17:40</div>
            <div class="timeline-body"><p>I think it's a bug due to double counting the <code>ansible-core</code> executables.
Not exactly sure where that is coming from, but I think it may be due to the fact that the package appears both as an implicit dependency and as a manually specified package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-09-20 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">uv tool</span> added by @zanieb on 2024-09-20 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/tool_install.rs</code>:3086 on 2024-09-24 10:58</div>
            <div class="timeline-body"><p>Nevermind, this was a bug in my new code, fixed now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-24 10:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-24 11:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/tool_install.rs</code>:3058 on 2024-09-24 11:00</div>
            <div class="timeline-body"><p>Do you have a preference on how this should look like?
For the moment I've updated it to:</p>
<pre><code>Installed 11 additional executables from `ansible-core`: ansible, ansible-config, ansible-connection, ansible-console, ansible-doc, ansible-galaxy, ansible-inventory, ansible-playbook, ansible-pull, ansible-test, ansible-vault
Installed 1 additional executable from `ansible-lint`: ansible-lint
Installed 1 executable: ansible-community
</code></pre>
<p>I'm absolutely not sold on this being the final form.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-24 13:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3058 on 2024-09-24 13:09</div>
            <div class="timeline-body"><p>The part that stands out to me there is that it's a bit weird to say &quot;additional&quot; <em>before</em> we show the main group of executables we installed.</p>
<p>I think I'd go with whatever is decent and simple here, then revisit the output entirely. For example, I think this should probably match the style of our install commands? Like:</p>
<pre><code>Installed 13 executables
+ ansible (from ansible-core)
+ ansible-config (from ansible-core)
+ ansible-lint
+ ansible-community
...
</code></pre>
<p>If the package name matches the executable name I'd probably omit the &quot;from&quot; portion.</p>
<p>Anyway, I think that is separate from the goal here and we should avoid going down that road in this pull request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-24 13:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv-cli/src/lib.rs</code>:3276 on 2024-09-24 13:21</div>
            <div class="timeline-body"><p>Just double-checking: this field is the CLI args, other CLI fields also seems to be simpler type. Were you maybe suggesting to make this change on the <code>ToolInstallSettings</code> field instead? I think it makes sense to turn that one into a <code>BTreeSet&lt;PackageName&gt;</code> maybe, so that it is both de-duplicated and strongly typed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-24 13:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3276 on 2024-09-24 13:29</div>
            <div class="timeline-body"><p>We use <code>PackageName</code> in the CLI where we can e.g. https://github.com/astral-sh/uv/blob/63b60bc0c8425f4475adbd0ba207159694946a08/crates/uv-cli/src/lib.rs#L1878</p>
<p>I'm all for converting it to a <code>BTreeSet</code> later too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/tool_install.rs</code>:3056 on 2024-09-25 10:48</div>
            <div class="timeline-body"><p>There is a funny issue here, it seems that on Windows only there is a different sorting for the strings <code>ansible</code> and <code>ansible-&lt;whatever&gt;</code>:</p>
<pre><code class="language-diff">- Installed 11 executables from `ansible-core`: ansible, ansible-config, ansible-connection, ansible-console, ansible-doc, ansible-galaxy, ansible-inventory, ansible-playbook, ansible-pull, ansible-test, ansible-vault
+ Installed 11 executables from `ansible-core`: ansible-config, ansible-connection, ansible-console, ansible-doc, ansible-galaxy, ansible-inventory, ansible-playbook, ansible-pull, ansible-test, ansible-vault, ansible
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-25 10:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-25 12:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/tool_install.rs</code>:3029 on 2024-09-25 12:35</div>
            <div class="timeline-body"><p>Many dependencies were coming from <code>ansible-lint</code>, which is an extra package providing an additional entrypoint. I replaced that with <code>black</code>, as it covers the same scenario with fewer transitive deps.</p>
<p>If you have an idea about a better combo than <code>ansible</code> and <code>ansible-core</code>, I'll happily replace them here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-27 15:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3056 on 2024-09-27 15:33</div>
            <div class="timeline-body"><p>That's horrible :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lucab">@lucab</a> reviewed on 2024-09-27 15:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/lucab">@lucab</a> on <code>crates/uv/tests/tool_install.rs</code>:3056 on 2024-09-27 15:47</div>
            <div class="timeline-body"><p>I had to abuse CI a bit to get to the bottom of this (sorry if I flooded you with notifications).
It turns out there is a <code>.exe</code> suffix (filtered out in test output) and thus <code>ansible &lt; ansible-config(.exe) &lt; ansible.exe</code> (due to the ASCII order of <code>-</code> vs <code>.</code>).
The same suffix is also present in the receipt, making its ordering OS-dependant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-27 16:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/tool_install.rs</code>:3056 on 2024-09-27 16:02</div>
            <div class="timeline-body"><p>I'm used to Charlie force-pushing 1000 times per pull request so no worries.</p>
<p>Ah that's really interesting. Good sleuthing. I was about to suggest trimming the suffix for sorts but it looks like you're on it in https://github.com/astral-sh/uv/pull/7592/commits/0c9f450e1ccde874130e5614b410661787581044 â€” should you use the <code>std::env::consts::EXE_SUFFIX</code> const there?</p>
<p>The filtering can be quite misleading like that sometimes. I wonder if we can output an unfiltered snapshot on failure too? cc @konstin the snapshot macro master.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[WIP] Support installing additional executables in `uv tool install`" to "Support installing additional executables in `uv tool install`" by @lucab on 2024-09-30 14:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lucab">@lucab</a> on 2024-09-30 14:13</div>
            <div class="timeline-body"><p>I think this should be in a complete state now, and there are functional tests for install/upgrade/uninstall flows.</p>
<p>The main remaining thing to decide is the name of the flag, in order to finalize the PR.
My personal suggestion would be <code>--with-commands-from</code>, as it blends with existing nomenclature.
But I'm happy to go with whatever @zanieb or @charliermarsh actually prefer, just let me know here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-09-30 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @lucab on 2024-10-03 09:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-03 23:45</div>
            <div class="timeline-body"><p>Thanks! I'll try to review this tomorrow.</p>
<p>edit: I had some time to give it a quick look now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-03 23:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:3356 on 2024-10-03 23:59</div>
            <div class="timeline-body"><p>I noticed you're following &quot;install commands&quot; from the other docstrings but we say &quot;executables&quot; elsehwere in the documentation and I think I prefer that i.e.</p>
<pre><code class="language-suggestion">    /// Install executables from an additional package.
    ///
    /// May be provided multiple times.
    #[arg(long)]
    pub with_executables_from: Vec&lt;PackageName&gt;,
</code></pre>
<p>I can change the other option documentation to match.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-04 00:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/tool/install.rs</code>:413 on 2024-10-04 00:01</div>
            <div class="timeline-body"><p>Why do we force install if there are additional packages?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-10-04 00:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/tool.rs</code>:87 on 2024-10-04 00:02</div>
            <div class="timeline-body"><p>Will adding this break old tool installs, i.e., if it's missing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2025-03-26 20:01</div>
            <div class="timeline-body"><p>Anything is left here to do? from the latest review seems to be implied that it's ready.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-26 20:07</div>
            <div class="timeline-body"><p>Yeah there's still work to do here. i.e., https://github.com/astral-sh/uv/pull/7592#discussion_r1786955527 is important. I'd have to go deeper on the topic again to see if there's more. Are you interested in picking it up?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aaron-ang">@aaron-ang</a> reviewed on 2025-06-13 06:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aaron-ang">@aaron-ang</a> on <code>crates/uv-tool/src/tool.rs</code>:87 on 2025-06-13 06:07</div>
            <div class="timeline-body"><p>The only other location <code>from</code> is used is in <code>upgrade.rs</code> to collect dependency packages (excluding the main tool) that have entry points. If <code>from</code> is <code>None</code>, then only entry points from site packages are installed in <code>install_executables</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mykelalvis">@mykelalvis</a> on 2025-07-16 12:50</div>
            <div class="timeline-body"><p>Bumping this as &quot;very nice to have&quot;.  If there is testing to perform, I'm willing to help out, but my knowledge of this codebase is low and my available time is limited.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-07-30 19:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:13 UTC
    </footer>
</body>
</html>
