<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Git LFS with opt-in - astral-sh/uv #16143</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support Git LFS with opt-in</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/16143">#16143</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2025-10-06 21:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Follow up to https://github.com/astral-sh/uv/pull/15563
Closes https://github.com/astral-sh/uv/issues/13485</p>
<p>This is a first-pass at adding support for conditional support for Git LFS between git sources, initial feedback welcome.</p>
<p>e.g.</p>
<pre><code>[tool.uv.sources]
test-lfs-repo = { git = &quot;https://github.com/zanieb/test-lfs-repo.git&quot;, lfs = true }
</code></pre>
<p>For context previously a user had to set <code>UV_GIT_LFS</code> to have uv fetch lfs objects on git sources. This env var was all or nothing, meaning you must always have it set to get consistent behavior and it applied to all git sources. If you fetched lfs objects at a revision and then turned off lfs (or vice versa), the git db, corresponding checkout lfs artifacts would not be updated properly. Similarly, when git source distributions were built, there would be no distinction between sources with lfs and without lfs. Hence, it could corrupt the git, sdist, and archive caches.</p>
<p>In order to support some sources being LFS enabled and other not, this PR adds a stateful layer roughly similar to how <code>subdirectory</code> works but for <code>lfs</code> since the git database, the checkouts and the corresponding caching layers needed to be LFS aware (requested vs installed). The caches also had to isolated and treated entirely separate when handling LFS sources.</p>
<p>Summary</p>
<ul>
<li>Adds <code>lfs = true</code> or <code>lfs = false</code> to git sources in pyproject.toml</li>
<li>Added <code>lfs=true</code> query param / fragments to most relevant url structs (not parsed as user input)<ul>
<li>In the case of uv add / uv tool, <code>--lfs</code> is supported instead</li>
<li><code>UV_GIT_LFS</code> environment variable support is still functional for non-project entrypoints (e.g. uv pip)</li>
</ul>
</li>
<li><code>direct-url.json</code> now has an custom <code>git_lfs</code> entry under VcsInfo (note, this is not in the spec currently -- see caveats).</li>
<li>git database and checkouts have an different cache key as the sources should be treated effectively different for the same rev.</li>
<li>sdists cache also differ in the cache key of a built distribution if it was built using LFS enabled revisions to distinguish between non-LFS same revisions. This ensures the strong assumption for archive-v0 that an unpacked revision &quot;doesn't change sources&quot; stays valid.</li>
</ul>
<p>Caveats</p>
<ul>
<li><code>pylock.toml</code> import support has not been added via git_lfs=true, going through the spec it wasn't clear to me it's something we'd support outside of the env var (for now).</li>
<li>direct-url struct was modified by adding a non-standard <code>git_lfs</code> field under VcsInfo which may be undersirable although the PEP 610 does say <code>Additional fields that would be necessary to support such VCS SHOULD be prefixed with the VCS command name</code> which could be interpret this change as ok.</li>
<li>There will be a slight lockfile and cache churn for users that use <code>UV_GIT_LFS</code> as all git lockfile entries will get a <code>lfs=true</code> fragment. The cache version does not need an update, but LFS sources will get their own namespace under git-v0 and sdist-v9/git hence a cache-miss will occur once but this can be sufficient to label this as breaking for workflows always setting <code>UV_GIT_LFS</code>.</li>
</ul>
<h2>Test Plan</h2>
<p>Some initial tests were added. More tests likely to follow as we reach consensus on a final approach.</p>
<p>For IT test, we may want to move to use a repo under astral namespace in order to test lfs functionality.</p>
<p>Manual testing was done for common pathological cases like killing LFS fetch mid-way, uninstalling LFS after installing an sdist with it and reinstalling, fetching LFS artifacts in different commits, etc.</p>
<p>PSA: Please ignore the docker build failures as its related to depot OIDC issues.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-10-17 22:11</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/uv/branches/samypr100%3Aconditional_lfs_support?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a></h2>
<h3>Merging #16143 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>samypr100:conditional_lfs_support</code> (dc1b6ba) with <code>main</code> (5947fb0)</sub></p>
<h3>Summary</h3>
<p><code>âœ… 6</code> untouched</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @samypr100 on 2025-10-21 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2025-10-30 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/guides/tools.md</code>:148 on 2025-10-30 17:45</div>
            <div class="timeline-body"><p>Do we have a real repo for showcasing this? Not blocking but we mostly have real examples</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/concepts/projects/dependencies.md</code>:372 on 2025-10-30 17:50</div>
            <div class="timeline-body"><p>Does that show a clear error on failure? If so, this can be <code>!!! important</code>, then it doesn't need to be a warning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1804 on 2025-10-30 17:59</div>
            <div class="timeline-body"><p>This looks like it could be <code>with_lfs</code> on <code>UnresolvedRequirement</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/common/mod.rs</code>:883 on 2025-10-30 18:08</div>
            <div class="timeline-body"><p>What's the problem with reading the system gitconfig first?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/common/mod.rs</code>:918 on 2025-10-30 18:10</div>
            <div class="timeline-body"><p>We should document in the contributor docs that git lfs is required to run the tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/sync.rs</code>:13684 on 2025-10-30 18:11</div>
            <div class="timeline-body"><p>Note to self: Move to astral-sh before merging</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/sync.rs</code>:13579 on 2025-10-30 18:14</div>
            <div class="timeline-body"><p>We should run those with cache, both for test performance and to check when we reuse the cache.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-10-30 19:46</div>
            <div class="timeline-body"><p>@zanieb This should be good to go. Given the size, how would you like to approach reviewing this best? I can also do a walkthrough of any of the changes and their rationale sync or async if desired. I tried to keep the commits idependently reviewable, although GH doesn't make it easy to review that way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:209 on 2025-11-03 14:54</div>
            <div class="timeline-body"><p>This should be a named struct so <code>Option&lt;bool&gt;</code> has a name</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:468 on 2025-11-03 15:12</div>
            <div class="timeline-body"><p>Can we remove <code>PartialEq</code> and those tests? These are currently unused and when we use them, we should be explicit about whether we consider <code>Some(false)</code> equal to <code>None</code> or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git-types/src/lib.rs</code>:15 on 2025-11-03 18:17</div>
            <div class="timeline-body"><p>Do we need this to be global state, is this slow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git-types/src/lib.rs</code>:204 on 2025-11-03 18:25</div>
            <div class="timeline-body"><p>This feels slightly dangerous because it changes all instances of this type depending on the environment in a <code>TryFrom</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/common/mod.rs</code>:917 on 2025-11-03 18:50</div>
            <div class="timeline-body"><p>Are those filters from some documentation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:3972 on 2025-11-03 19:24</div>
            <div class="timeline-body"><p>Same here as for the other site where we're reading the env var, I'm a bit worried about building our requirements state from an env var, especially one that we read inline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:3967 on 2025-11-03 19:28</div>
            <div class="timeline-body"><p>If I understand the code correctly, do we track lfs as a three-state true/false/None on the <code>pyproject.toml</code> side, but then we're only tracking two state true/not-true here, so we have an asymmetry between <code>pyproject.toml</code> and <code>uv.lock</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-resolver/src/lock/export/pylock_toml.rs</code>:1440 on 2025-11-03 19:50</div>
            <div class="timeline-body"><p>We could use the tool table, but given that the spec doesn't say anything, for now it's fine to not handle LFS beyond respecting the env var.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:448 on 2025-11-03 20:00</div>
            <div class="timeline-body"><p>We don't need the string &quot;lfs&quot; here. In the other branches, we're serializing different string values, but adding a constant doesn't change the cache key.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:227 on 2025-11-03 20:08</div>
            <div class="timeline-body"><p>I'd go with 0 and 1 in the respective here for clarity. Our specific implementation puts a 0xFF between strings, but making this explicit makes us independent of the implementation state and makes it clear to all reads that <code>https://example.com/</code> with <code>lfs=true</code> and <code>https://example.com/lfs</code> have different cache keys.</p>
<p>One of the drawbacks of the PR (and this change specifically) is that we're invalidating the caches. I think that's fine, we've done that several for different buckets and features, but I want to document it for this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-installer/src/satisfies.rs</code>:192 on 2025-11-03 20:35</div>
            <div class="timeline-body"><p>This condition is failing for me locally with:</p>
<pre><code>dependencies = [
    &quot;test-lfs-repo&quot;,
]

[tool.uv.sources]
test-lfs-repo = { git = &quot;https://github.com/samypr100/test-lfs-repo&quot;, rev = &quot;657500f0703dc173ac5d68dfa1d7e8c985c84424&quot;, lfs = false }
</code></pre>
<pre><code>DEBUG Resolving despite existing lockfile due to mismatched requirements for: `debug==0.1.0`
  Requested: {Requirement { name: PackageName(&quot;test-lfs-repo&quot;), extras: [], groups: [], marker: true, source: Git { git: GitUrl { repository: DisplaySafeUrl { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;github.com&quot;)), port: None, path: &quot;/samypr100/test-lfs-repo&quot;, query: None, fragment: None }, reference: BranchOrTagOrCommit(&quot;657500f0703dc173ac5d68dfa1d7e8c985c84424&quot;), precise: None, lfs: Disabled }, subdirectory: None, url: VerbatimUrl { url: DisplaySafeUrl { scheme: &quot;git+https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;github.com&quot;)), port: None, path: &quot;/samypr100/test-lfs-repo@657500f0703dc173ac5d68dfa1d7e8c985c84424&quot;, query: None, fragment: None }, given: None } }, origin: None }}
  Existing: {Requirement { name: PackageName(&quot;test-lfs-repo&quot;), extras: [], groups: [], marker: true, source: Git { git: GitUrl { repository: DisplaySafeUrl { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;github.com&quot;)), port: None, path: &quot;/samypr100/test-lfs-repo&quot;, query: None, fragment: None }, reference: BranchOrTagOrCommit(&quot;657500f0703dc173ac5d68dfa1d7e8c985c84424&quot;), precise: None, lfs: Enabled }, subdirectory: None, url: VerbatimUrl { url: DisplaySafeUrl { scheme: &quot;git+https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;github.com&quot;)), port: None, path: &quot;/samypr100/test-lfs-repo@657500f0703dc173ac5d68dfa1d7e8c985c84424&quot;, query: None, fragment: Some(&quot;lfs=true&quot;) }, given: None } }, origin: None }}
</code></pre>
<p>It doesn't show as re-installed because we later see that it's up-to-date, but we shouldn't fail this check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git/src/git.rs</code>:466 on 2025-11-03 20:54</div>
            <div class="timeline-body"><p>Do we need both files, or can we go with the <code>.ok</code> for both checkout and LFS, and similarly retry both when it's missing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git/src/source.rs</code>:93 on 2025-11-04 02:55</div>
            <div class="timeline-body"><p>What's with the inverse case, we have <code>lfs = false</code> but the DB contains LFS artifacts from a previous checkout, how do we prevent the LFS files from still being checked out?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/tool_install.rs</code>:1863 on 2025-11-04 02:57</div>
            <div class="timeline-body"><p>We should use something smaller here, black is convenient but Git plus the black dependencies is noticeable in test suite performance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-04 02:58</div>
            <div class="timeline-body"><p>This is great work!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/guides/tools.md</code>:148 on 2025-11-04 03:05</div>
            <div class="timeline-body"><p>Indeed, I was looking for a good example but didn't find any at first. Maybe can use the one reported in https://github.com/astral-sh/uv/issues/16539 ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/concepts/projects/dependencies.md</code>:372 on 2025-11-04 03:09</div>
            <div class="timeline-body"><p>On main it does not, but now it does. I'll change to <code>!!! important</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1804 on 2025-11-04 03:15</div>
            <div class="timeline-body"><p>I went this route to kept it consistent with this other very similar function https://github.com/astral-sh/uv/blob/54596a02082762ee6b04a7f87c60d74024983d5e/crates/uv/src/commands/project/add.rs#L1204-L1286</p>
<p>Do you think we should add it to UnresolvedRequirement instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/common/mod.rs</code>:883 on 2025-11-04 03:18</div>
            <div class="timeline-body"><p>Good catch, I forgot to remove this. I was testing various configurations locally and needed to disable my system config temporarily as it was getting in the way of tests. I can re-enable it as it shouldn't be a problem in most cases given git's config resolution order.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git-types/src/lib.rs</code>:15 on 2025-11-04 03:27</div>
            <div class="timeline-body"><p>Yes, it can called 1-4 times depending on the command and cache state.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git-types/src/lib.rs</code>:204 on 2025-11-04 03:28</div>
            <div class="timeline-body"><p>Agreed, I mostly left it as is from https://github.com/astral-sh/uv/pull/16143/commits/f110cc9ee3a81f6fe52c0a4d1fcb8ddcbe39aa24</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/common/mod.rs</code>:917 on 2025-11-04 03:29</div>
            <div class="timeline-body"><p>Yes, good catch. I'll add a link.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:3972 on 2025-11-04 03:31</div>
            <div class="timeline-body"><p>I did so for backwards compatibility with users who are already leveraging <code>UV_GIT_LFS</code> to have their lockfiles properly updated. Alternatively, we can remove it and keep the lockfiles pristine regardless of <code>UV_GIT_LFS</code> envvar being set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:3967 on 2025-11-04 03:57</div>
            <div class="timeline-body"><p>This is correct. The only scenario where you can explicitly specify <code>false</code> is in <code>pyproject.toml</code>, ending up in tree-state. All other cases are two-state. The reason being that <code>false</code> in pyproject.toml is used only to prevent Git LFS initialization regardless of <code>UV_GIT_LFS</code> being set. We could have some symmetry, although I do find it odd to consider these two requirements different when they're the same in the scenario below.</p>
<pre><code>     - test-lfs-repo==0.1.0 (from git+https://github.com/samypr100/test-lfs-repo.git@657500f0703dc173ac5d68dfa1d7e8c985c84424#lfs=false)
     + test-lfs-repo==0.1.0 (from git+https://github.com/samypr100/test-lfs-repo.git@657500f0703dc173ac5d68dfa1d7e8c985c84424)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:448 on 2025-11-04 03:58</div>
            <div class="timeline-body"><p>Agreed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 03:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:227 on 2025-11-04 03:59</div>
            <div class="timeline-body"><p>Agreed on using <code>1u8</code> when <code>lfs = true</code>. I was explicitly avoiding the None/false scenario from resulting in a different cache key. In other words, when <code>lfs = false</code> under the same repo the cache-key for <code>GitRepositoryUrl</code> is the same as the cache key for <code>RepositoryUrl</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 04:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/git.rs</code>:466 on 2025-11-04 04:09</div>
            <div class="timeline-body"><p>At least from my testing we would need both files as I've managed to corrupt the cache when we don't have it. This is primarily because <code>.ok</code> can be written even when LFS fetch succeeds but the blobs may end up not being present. This can happen due to invalid filter configuration, or other reasons (e.g. uninstalling Git LFS and attempting to update the db with an lfs repo). When validation is skipped for the database we also have no guarantees that the LFS objects are present in the checkout or that they're fresh hence they additional check only on LFS-enabled sources.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 04:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/source.rs</code>:93 on 2025-11-04 04:16</div>
            <div class="timeline-body"><p>When <code>lfs = false</code> it goes into a different cache bucket, so it would not be affected by it. Unitializing/removing LFS objects didn't seem like a supported operation either.</p>
<p>The <code>db</code> for repo <code>foo</code> with <code>lfs = false</code> or <code>None</code> would go into cache bucket <code>git-v0/&lt;bucket_cache_key_a&gt;/**</code>
The <code>db</code> for repo <code>foo</code> with <code>lfs = true</code> would go into cache bucket <code>git-v0/&lt;bucket_cache_key_b&gt;/**</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-04 13:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git-types/src/lib.rs</code>:15 on 2025-11-04 13:30</div>
            <div class="timeline-body"><p>The question is like, is this slow enough that we need to use a global <code>static</code> for this? Or even better, can we parse the value in one function an pass it around? Sometimes it too much effort to do that, but we try to avoid having global state or accessing env vars in nested functions, it usually comes back to bite us later, either because it's accessed from multiple locations (we had https://github.com/astral-sh/uv/issues/16447 recently) or because you want to change something and the access is in a lot of locations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/tool_install.rs</code>:1863 on 2025-11-04 13:34</div>
            <div class="timeline-body"><p>I believe I kept it black for consistency because all the <code>tool_install.rs</code> tests use black. I added this test because I realized there were no tests for tool install using git (no lfs). Is there an alternative you'd think is better?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 13:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 13:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-installer/src/satisfies.rs</code>:192 on 2025-11-04 13:37</div>
            <div class="timeline-body"><p>Isn't this expected? I consider <code>lfs = true</code> and <code>lfs = false</code> / <code>None</code> as mostly different source trees in the same fashion as different subdirectories. While in the LFS scenario I expect no variability in pyproject.toml contents the final dist may have different sources and assets.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-04 14:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git-types/src/lib.rs</code>:15 on 2025-11-04 14:12</div>
            <div class="timeline-body"><p>Yes, when running benchmarks I saw a non-trivial slowdown. It was introduced as a function in f110cc9ee3a81f6fe52c0a4d1fcb8ddcbe39aa24, I later changed it to a global static in 5e791b7659b5ae355a41125f5012beb3f4bde270 due to the performance hit on the airflow benchmark.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-04 18:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1804 on 2025-11-04 18:54</div>
            <div class="timeline-body"><p>Fixed: https://github.com/astral-sh/uv/pull/16592</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-04 19:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/tool_install.rs</code>:1863 on 2025-11-04 19:14</div>
            <div class="timeline-body"><p>I'm also happy to consider switching to a smaller package as a separate issue â€” we can always make our own small package if we need to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/concepts/projects/dependencies.md</code>:372 on 2025-11-05 01:51</div>
            <div class="timeline-body"><p>Changed in 2c988eefd997e9b36f93d6aa9da19ee4d08481f1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1804 on 2025-11-05 01:52</div>
            <div class="timeline-body"><p>Thanks, I started fix this in 28d9182a923de989a87903d1f3349191eaf49c3d, but I'll rebase your changes and unify them</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/common/mod.rs</code>:883 on 2025-11-05 01:52</div>
            <div class="timeline-body"><p>Fixed in 2b06aefb25645eebcfa2968105194da3752b98c2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/common/mod.rs</code>:918 on 2025-11-05 01:52</div>
            <div class="timeline-body"><p>Fixed in 2b06aefb25645eebcfa2968105194da3752b98c2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/sync.rs</code>:13579 on 2025-11-05 01:53</div>
            <div class="timeline-body"><p>Fixed in ed2d9482a16051c48670882560a66fbf696d2cf1</p>
<p>The intentional on/off cache tests ended up primarily being part of edit.rs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:209 on 2025-11-05 01:53</div>
            <div class="timeline-body"><p>Fixed in aabd0706a467756d8c5f6413dc0047d72d303b66</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:468 on 2025-11-05 01:54</div>
            <div class="timeline-body"><p>Fixed in aabd0706a467756d8c5f6413dc0047d72d303b66</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:448 on 2025-11-05 01:55</div>
            <div class="timeline-body"><p>Fixed in b46a479c876e968466be73fbef10eaabda9c0e59, also deleted the else branch as it was not intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 01:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:227 on 2025-11-05 01:56</div>
            <div class="timeline-body"><p>Fixed as part of aabd0706a467756d8c5f6413dc0047d72d303b66</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 02:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1804 on 2025-11-05 02:13</div>
            <div class="timeline-body"><p>Fixed in the latest rebase to use your change https://github.com/astral-sh/uv/blob/d28be561c4e18403be8eced740d6b274dc43f2bc/crates/uv/src/commands/project/mod.rs#L1684-L1693</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 02:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/guides/tools.md</code>:148 on 2025-11-05 02:59</div>
            <div class="timeline-body"><p>Looking into the one from https://github.com/astral-sh/uv/issues/16539 and although it does rely on LFS, there's no scripts block so it doesn't make a good candidate for tools doc ðŸ˜¢</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/common/mod.rs</code>:917 on 2025-11-05 03:01</div>
            <div class="timeline-body"><p>Fixed in 2b06aefb25645eebcfa2968105194da3752b98c2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 03:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-05 03:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-resolver/src/lock/export/pylock_toml.rs</code>:1440 on 2025-11-05 03:17</div>
            <div class="timeline-body"><p>I think the right long-term approach is likely make it an explicit field in the direct-url spec via an <a href="https://discuss.python.org/t/draft-pep-amendment-to-the-pep-610-direct-url-json-data-structure/22299">amendment</a>, which then makes it easier to incorporate it officially into pylock.toml as it uses direct-url spec. More tooling would benefit by having Git LFS related metadata rather than assuming Git LFS will always run and fetch all objects when the extension is available which is sadly the common behavior I've seen in other tools. Its arguably a similar problem to git submodules exclusions problem (e.g. repo with some git submodules you want to exclude).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-10 13:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git-types/src/lib.rs</code>:15 on 2025-11-10 13:22</div>
            <div class="timeline-body"><p>Thanks for checking!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-10 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-installer/src/satisfies.rs</code>:192 on 2025-11-10 14:16</div>
            <div class="timeline-body"><p>What I meant specifically is that if I run the command in a loop, it fails this check every time:</p>
<pre><code>UV_GIT_LFS=true cargo run sync -v
</code></pre>
<p>For this case, it looks off cause we're using <code>GitLfs::from_env()</code> in the nested parsing routines, so it shouldn't disable the fast path.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-10 14:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git-types/src/lib.rs</code>:204 on 2025-11-10 14:43</div>
            <div class="timeline-body"><p>I've been looking at it some more and I don't have a better alternative to offer, changing all call sites including the serde site would be too much churn, and post-processing all requirements is way more likely to get wrong accidentally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-10 15:13</div>
            <div class="timeline-body"><p>Can we detect whether <code>git lfs</code> is installed? Currently, the error message makes it look like the repo is broken when the local machine doesn't have <code>git lfs</code> installed. If we can't easily detect it, we should hint at the possibility in the error message.</p>
<pre><code>$ uv pip install &quot;git+https://github.com/samypr100/test-lfs-repo@4e82e85f6a8b8825d614ea23c550af55b2b7738c&quot;
    Updated https://github.com/samypr100/test-lfs-repo (4e82e85f6a8b8825d614ea23c550af55b2b7738c)
  Ã— Failed to download and build `test-lfs-repo @ git+https://github.com/samypr100/test-lfs-repo@4e82e85f6a8b8825d614ea23c550af55b2b7738c#lfs=true`
  â•°â”€â–¶ The source distribution `git+https://github.com/samypr100/test-lfs-repo@4e82e85f6a8b8825d614ea23c550af55b2b7738c#lfs=true` is missing Git LFS artifacts

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-10 15:29</div>
            <div class="timeline-body"><p>I can't comment where the tests are run, but we should enable the <code>git-lfs</code> tests where we run the <code>git</code> test features, in <code>cargo-test-macos</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-10 18:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-10 18:53</div>
            <div class="timeline-body"><p>Yes, it should show up in the verbose logs as a warning. This failure can occur due to multiple scenarios, not just when Git LFS is not installed. For example, the issue could be:</p>
<ol>
<li>Git LFS may not be installed.</li>
<li>There an error fetching the LFS blobs (e.g. network or filter related).</li>
<li>The LFS blobs themselves are corrupted due to an upstream issue on the repo (e.g. remote missing object)</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-10 18:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-11-10 19:03</div>
            <div class="timeline-body"><blockquote>
<p>I can't comment where the tests are run, but we should enable the <code>git-lfs</code> tests where we run the <code>git</code> test features, in <code>cargo-test-macos</code>.</p>
</blockquote>
<p>Done in e8b48e6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-11 12:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-11 12:38</div>
            <div class="timeline-body"><p>Is there a way to detect which of those we have (CC @geofft who might know)? If not, we should make the error message more generic:</p>
<pre><code>    #[error(&quot;The source distribution `{}` is missing Git LFS artifacts. Is Git LFS installed?&quot;, _0)]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-11 12:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git/src/git.rs</code>:466 on 2025-11-11 12:50</div>
            <div class="timeline-body"><p>I'm afraid I still don't follow. As I understand it, LFS and non-LFS checkouts are always separated (due to <code>GitRepositoryUrl</code>, something we should document), so shouldn't <code>.ok</code> and <code>.ok_lfs</code> carry the same information, because depending on the bucket, we either always create one or always both?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git/src/source.rs</code>:72 on 2025-11-11 12:52</div>
            <div class="timeline-body"><p>Does the DB need to be separated by LFS/non-LFS? It seems like we double the storage this way.
CC @geofft</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/guides/tools.md</code>:148 on 2025-11-11 13:49</div>
            <div class="timeline-body"><p>I created one: https://github.com/astral-sh/lfs-cowsay</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/sync.rs</code>:13684 on 2025-11-11 13:51</div>
            <div class="timeline-body"><p>Done: https://github.com/astral-sh/test-lfs-repo</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:3967 on 2025-11-11 13:59</div>
            <div class="timeline-body"><p>I'm thinking about the case of <code>--frozen</code>: With the 2-state in <code>uv.lock</code>, <code>lfs = false</code> is respected with <code>UV_GIT_LFS=true</code> with <code>uv sync</code>, but ignore with <code>uv sync --frozen</code>.</p>
<pre><code class="language-toml">[project]
name = &quot;test&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.13&quot;

dependencies = [
  &quot;test-lfs-repo&quot;,
]

[tool.uv.sources]
test-lfs-repo = { git = &quot;https://github.com/samypr100/test-lfs-repo&quot;, rev = &quot;657500f0703dc173ac5d68dfa1d7e8c985c84424&quot;, lfs = false }
</code></pre>
<p><code>UV_GIT_LFS=true cargo run sync --frozen</code>: No Git LFS used
<code>UV_GIT_LFS=true cargo run sync --frozen</code>: Git LFS used</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-11 14:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 14:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/source.rs</code>:72 on 2025-11-11 14:54</div>
            <div class="timeline-body"><p>For context currently in main when we fetch lfs objects at a revision and then turn off lfs, the git db and the corresponding checkout lfs artifacts may not be updated properly anymore which can affect the caches.</p>
<p>Hence from my perspective since the source trees can be entirely different at every commit, I'd opted for this approach.</p>
<p>Currently we store a git repos inside a git-v0/db/**/.git. Once you initialize LFS objects on a repo there's no going back as far as I know unless you either list all the LFS objects and replace them manually with LFS placeholders (like the one in tests).
The checkouts are just a clone of the corresponding git-v0 db so they follow suit for consistency.</p>
<p>I actually started off this branch using a single cache bucket, but encountered the <a href="https://github.com/astral-sh/uv/pull/16143#discussion_r2488481580">&quot;reverting LFS objects&quot; scenario</a> and opted for a two-bucket approach instead. Happy to revisit ideas if we'd like to stick with one bucket.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 14:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-11 14:56</div>
            <div class="timeline-body"><p>I'll change the message. The actual errors are shown as a warning when --verbose is used as they're emitted currently in the uv-git crate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 15:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-installer/src/satisfies.rs</code>:192 on 2025-11-11 15:00</div>
            <div class="timeline-body"><p>~I can reproduce, I'll work towards a fix and add a test for this scenario. I noticed the lock file is returning consistent state sometimes because Git Sources are still treated as always immutable (regardless of fragment changes), which is something I missed.~</p>
<p>edit: wrong rabbithole, chasing ghosts...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-11 15:50</div>
            <div class="timeline-body"><p>Mostly for my own understanding, why 1 and not something else like 3 that wouldn't conflict with the subdirectory case? (I suppose a subdirectory won't be empty, but still)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-distribution-types/src/specified_requirement.rs</code>:112 on 2025-11-11 15:53</div>
            <div class="timeline-body"><p>Mostly for my own understanding, what is this <code>into()</code> and the one below doing? Aren't they both bools?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 15:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/git.rs</code>:466 on 2025-11-11 15:55</div>
            <div class="timeline-body"><p>Thanks, I'll update the comment to be clearer. Is below reframing better?</p>
<p><code>.ok</code> means the checkout was successful
<code>.ok_lfs</code> means that the lfs fetch was successful and that objects were fully validated</p>
<p>We can have a successful checkout with invalid objects, hence it's acceptable to have a <code>.ok</code> and a missing <code>.ok_lfs</code>.
When <code>.ok_lfs</code> is missing, a reset is needed to re-attempt to get a copy of the LFS objects.</p>
<p>Are you seeking to avoid writting <code>.ok</code> to begin with when lfs fetch was unsuccessful or when objects were not fully validated?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-git/src/git.rs</code>:466 on 2025-11-11 16:28</div>
            <div class="timeline-body"><p>I think I agree with @konstin's point here - the purpose of the cache key split is that we will never reuse an <em>existing</em> checkout for a Git LFS clone. I can see the argument if we were adding this onto existing repositories on disk, and an existing <code>.ok</code> file only indicates that a git checkout of some sort was done and doesn't indicate anything about LFS. But because we're going to create a new working tree under a new cache directory, we're not starting with any <code>.ok</code> files on user machines, and so <code>.ok</code> inside that new directory always indicates that an LFS-enabled git checkout happened successfully.</p>
<p>Did you run into cache corruption before splitting the cache keys for LFS and non-LFS? I can't see how you could get an LFS clone with <code>.ok</code> but not <code>.ok_lfs</code>, especially since you're writing those files out at the same time.</p>
<p>Also, now that I think about it, I wonder what happens if we have a non-LFS clone where the user previously had enabled LFS with the environment variable. In that case, <code>.ok</code> indicates that the checkout was done <em>with</em> LFS (i.e. with the files smudged on disk), but no further operations in that clone are going to use LFS because you're setting <code>GIT_LFS_SKIP_SMUDGE</code>. That seems like it could lead to some corruption (the sort of corruption you referred to in the PR message, basically) and I wonder if we should do something about that case, i.e., basically detect that LFS was in use previously and consider it not fresh and redo the hard reset. (The implementation might need to be clever to avoid forever paying the cost of looking for LFS in every non-LFS clone.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-git/src/source.rs</code>:72 on 2025-11-11 16:50</div>
            <div class="timeline-body"><p>If we want to, we can use the same clone for the <code>db</code> directory and split it in the <code>checkouts</code> directory, because the <code>db</code> directory has no working tree, and so its contents shouldn't differ in the LFS and non-LFS cases and it should be equally suitable for making a clone for LFS and non-LFS use.</p>
<p>The actual LFS large files are cached content-addressable in <code>.git/lfs/objects/</code> (https://github.com/git-lfs/git-lfs/blob/main/docs/spec.md). As I understand it, they're only going to get populated when the git-lfs filters are executed, i.e., they'll only be populated inside the <code>checkouts</code> directory and won't be in <code>db</code>. A good further optimization at some point would be to store them in the <code>db</code> directory, so that when you create a branch, the LFS objects that haven't changed on that branch are reused from local disk instead of re-fetched from the network.</p>
<p>(It occurs to me that we'd get that for free if we had all the checkouts be worktrees of the db instead of full clones, because then each checkout would not have its own .git directory. Maybe that's worth doing anyway.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-git/src/source.rs</code>:93 on 2025-11-11 16:51</div>
            <div class="timeline-body"><p>I think this doesn't address the case of <code>lfs = false</code> + the DB contains LFS artifacts <em>from a previous version of uv</em> because <code>UV_GIT_LFS</code> was previously set. See my comment on git.rs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-11 17:01</div>
            <div class="timeline-body"><p>I think our options are</p>
<ul>
<li>we can parse out the error from <code>git reset</code> (something like <code>smudge filter lfs failed</code> I think, unfortunately this message is localizable and there's no machine-readable status or exit code or anything)</li>
<li>we can provide our own git-lfs setup where we wrap execution of the filter in our own monitor process that reports how it went</li>
<li>on error, we can see if (we believe) <code>git-lfs</code> is on PATH and display a heuristic error message if it's not asking the user to install it</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/geofft">@geofft</a> reviewed on 2025-11-11 17:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 17:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-11 17:41</div>
            <div class="timeline-body"><p>For context, please see https://github.com/astral-sh/uv/blob/044be175f7504db9c312e9bad633a7950f2c314a/crates/uv-git/src/git.rs#L210 which already does this and shows the warning.</p>
<p>Message has been changed in 5f294d46234c9beb4e9f5a6bbc6ca7b4853df1d2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/source.rs</code>:72 on 2025-11-11 17:57</div>
            <div class="timeline-body"><p>I think it's worthwhile to re-think the clones vs worktrees, but probably out of scope for this PR? We'd also have to consider git and git-lfs versions on the client from a compatibility perspective. If I'm not mistaken, I think the current git implementation aligns more closer to cargo's implementation.</p>
<blockquote>
<p>The actual LFS large files are cached content-addressable in .git/lfs/objects/ (https://github.com/git-lfs/git-lfs/blob/main/docs/spec.md). As I understand it, they're only going to get populated when the git-lfs filters are executed, i.e., they'll only be populated inside the checkouts directory and won't be in db.</p>
</blockquote>
<p>Yes, the <code>.git/lfs/objects/</code> will have the objects (either in a successful or failed state), but I don't think this changes things unless I'm missing something based on what I had previously mentioned. My previous comment still holds that you'd end up with two types of checkouts (one with LFS, one without) as they're different source trees.</p>
<blockquote>
<p>A good further optimization at some point would be to store them in the db directory, so that when you create a branch, the LFS objects that haven't changed on that branch are reused from local disk instead of re-fetched from the network.</p>
</blockquote>
<p>The objects are not re-fetched through the network unless they were not initialized (e.g. using Git LFS 2.x) correctly as they're already stored in  <code>git-v0/db/**/.git/lfs/objects/</code> .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 17:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/geofft">@geofft</a> reviewed on 2025-11-11 18:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-git/src/source.rs</code>:72 on 2025-11-11 18:08</div>
            <div class="timeline-body"><blockquote>
<p>I think it's worthwhile to re-think the clones vs worktrees, but probably out of scope for this PR?</p>
</blockquote>
<p>Yes, I agree that changing this is out of scope for the PR. To be clear I'm fine with merging this PR with the different clones for LFS and non-LFS, and figuring out if we can avoid that later.</p>
<blockquote>
<p>The objects are not re-fetched through the network unless they were not initialized (e.g. using Git LFS 2.x) correctly as they're already stored in <code>git-v0/db/**/.git/lfs/objects/</code> .</p>
</blockquote>
<p>Aren't they in <code>git-v0/checkouts/**/.git/lfs/objects/</code>? (I can go test this and see what happens :) )</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 18:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/git.rs</code>:466 on 2025-11-11 18:14</div>
            <div class="timeline-body"><blockquote>
<p>Did you run into cache corruption before splitting the cache keys for LFS and non-LFS?</p>
</blockquote>
<p>I'll have to revisit this, the issue was more prominent when a single cache bucket was being used and its when I added it originally. I think we can get rid of the <code>.ok_lfs</code> if only if we stay with two cache buckets and change <code>.ok</code> to also mean successful LFS validation when LFS is enabled.</p>
<blockquote>
<p>Also, now that I think about it, I wonder what happens if we have a non-LFS clone where the user previously had enabled LFS with the environment variable. In that case, .ok indicates that the checkout was done with LFS (i.e. with the files smudged on disk), but no further operations in that clone are going to use LFS because you're setting GIT_LFS_SKIP_SMUDGE. That seems like it could lead to some corruption (the sort of corruption you referred to in the PR message, basically) and I wonder if we should do something about that case, i.e., basically detect that LFS was in use previously and consider it not fresh and redo the hard reset. (The implementation might need to be clever to avoid forever paying the cost of looking for LFS in every non-LFS clone.)</p>
</blockquote>
<p>Yes, I'd expect these would immediatedly switch over to the new LFS cache bucket instead. I don't think we can do anything about the fact that right now you can mess up the git cache when you do operations with UV_GIT_LFS and then removing it. I'd expect this PR would make that behavior deterministic going forward, but an old corrupted cache by mixing UV_GIT_LFS in and out is not something this PR currently fixes... although we can fix it by changing the cache-key for non-lfs buckets (effectively invalidating the old git caches entirely) which I tried to avoid.
e.g. <code>if git.lfs().enabled() { 1u8.cache_key(state);} else { 0u8.cache_key(state); }</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 18:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:3967 on 2025-11-11 18:22</div>
            <div class="timeline-body"><p>I think this is related to the issue identified in https://github.com/astral-sh/uv/pull/16143#discussion_r2514568324 which needs to be fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/specified_requirement.rs</code>:112 on 2025-11-11 18:24</div>
            <div class="timeline-body"><p>They're not both bools, <code>git.with_lfs</code> takes <code>GitLfs</code> and the <code>.into()</code> converts it accordingly.</p>
<p>I switched it to use from so it's clearer in b0361afd4c6f2b2c15aaac3bcaf22829ac97f7b7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 18:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-11 18:25</div>
            <div class="timeline-body"><p>I don't think it would matter if it's 3? I mainly kept the convention of boolean flags setting 1 or 0 on the cache state.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-11 18:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/source.rs</code>:72 on 2025-11-11 18:27</div>
            <div class="timeline-body"><blockquote>
<p>Aren't they in git-v0/checkouts/**/.git/lfs/objects/?</p>
</blockquote>
<p>They'd be in both as the checkout clones the lfs-enabled git db</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 04:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/sync.rs</code>:13684 on 2025-11-12 04:13</div>
            <div class="timeline-body"><p>The tests have been changed to use this repo, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 04:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/guides/tools.md</code>:148 on 2025-11-12 04:13</div>
            <div class="timeline-body"><p>The docs have been changed to use this repo, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 06:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/git.rs</code>:466 on 2025-11-12 06:48</div>
            <div class="timeline-body"><blockquote>
<p>I think we can get rid of the .ok_lfs if only if we stay with two cache buckets and change .ok to also mean successful LFS validation when LFS is enabled.</p>
</blockquote>
<p>The <code>.ok_lfs</code> file was removed in 7ca27c3960bf7cbc2091c72f862b4ca0ee09a3a1 with this approach. I'll be doing some more stress testing locally as well as a follow up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 07:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-installer/src/satisfies.rs</code>:192 on 2025-11-12 07:00</div>
            <div class="timeline-body"><p>@konstin I believe this should be fixed now. I failed to capture the exact commit for the fix but tl;dr the lowering changes had a bug which explained why we weren't seeing lfs state fragments propagating correctly via the environment variable. The fix helped remove other from_env calls that were no longer needed / not intended to be there. Additional checks in sync.rs tests were added to validate the integrity of the lockfile at different stages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 07:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:3967 on 2025-11-12 07:03</div>
            <div class="timeline-body"><p>I think this is fixed by https://github.com/astral-sh/uv/pull/16143#discussion_r2517137301 (I can't repro anymore)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-12 14:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-12 14:02</div>
            <div class="timeline-body"><p>The sequence is hashed in order, so you get like <code>[2, &lt;url&gt;, 0, 1]</code> or <code>[2, &lt;url&gt;, 1, &lt;url&gt;, 1]</code>, given that there's always a number there can't be a collision.</p>
<p>We should add an else-branch with 0 for future-additions-compat though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-12 14:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-12 14:06</div>
            <div class="timeline-body"><p>Can we check for <code>GIT_LFS</code> and adjust the error message accordingly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-12 14:16</div>
            <div class="timeline-body"><blockquote>
<p>We should add an else-branch with 0 for future-additions-compat though.</p>
</blockquote>
<p>Added in 0349288d4223f8c9d52412f405f9a7ffaf42f951</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 14:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 14:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-12 14:18</div>
            <div class="timeline-body"><p>Sorry, I had it originally, but misunderstood later on feedback whether we wanted to have a cache churn or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-12 14:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-12 14:30</div>
            <div class="timeline-body"><p>Right, that's why we didn't add it initially. The cache churn vs. compat is always a tough one; I'd learn towards cache invalidation to avoid problems in the future, given that we make no guarantees about the cache cross version anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>.github/workflows/ci.yml</code>:304 on 2025-11-12 14:34</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            --features python,python-managed,pypi,git,git-lfs,performance,crates-io,native-auth,apple-native \
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-12 14:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-12 14:39</div>
            <div class="timeline-body"><p>Do you mean check again if Git LFS is available in the path? Is it not sufficient that we already show this as a warning?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:208 on 2025-11-12 15:45</div>
            <div class="timeline-body"><p>nit: It doesn't do that anymore</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-13 05:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution/src/error.rs</code>:91 on 2025-11-13 05:40</div>
            <div class="timeline-body"><p>I've improved the error reporting as part of feac4215e1b944a4761957d7cc6d64c0672debea</p>
<p>e.g.</p>
<pre><code>  Ã— Failed to download and build `lfs-cowsay @ git+https://github.com/astral-sh/lfs-cowsay@44b8e65c8ecd376e4482a68b29312227879a226d#lfs=true`
  â”œâ”€â–¶ The source distribution `git+https://github.com/astral-sh/lfs-cowsay@44b8e65c8ecd376e4482a68b29312227879a226d#lfs=true` is missing Git LFS artifacts.
  â•°â”€â–¶ Is Git LFS configured? You may need to run `git lfs install`.
</code></pre>
<p>or</p>
<pre><code>  Ã— Failed to download and build `lfs-cowsay @ git+https://github.com/astral-sh/lfs-cowsay@44b8e65c8ecd376e4482a68b29312227879a226d#lfs=true`
  â”œâ”€â–¶ The source distribution `git+https://github.com/astral-sh/lfs-cowsay@44b8e65c8ecd376e4482a68b29312227879a226d#lfs=true` is missing Git LFS artifacts.
  â•°â”€â–¶ Git LFS extension not found. Ensure that Git LFS is installed and available.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-11-13 09:45</div>
            <div class="timeline-body"><p>The only remaining decision is <code>0u8.cache_key(state);</code> and probably a final read-through, otherwise it's good to go!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-11-13 12:27</div>
            <div class="timeline-body"><p>I'm taking a look at this in a little more detail. I really want to avoid churning the cache because that has an impact on non-LFS git users, and I think we can do that safely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-13 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-cache-key/src/canonical_url.rs</code>:208 on 2025-11-13 13:13</div>
            <div class="timeline-body"><p>Thanks, fixed in <a href="https://github.com/astral-sh/uv/compare/77302b16151a0f5695ef18fe3b74e28534900266..e2b1a8969407f1f7440706be4bcb4d8f79df28d0">commit</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-13 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>.github/workflows/ci.yml</code>:304 on 2025-11-13 13:13</div>
            <div class="timeline-body"><p>Thanks, fixed in <a href="https://github.com/astral-sh/uv/compare/77302b16151a0f5695ef18fe3b74e28534900266..e2b1a8969407f1f7440706be4bcb4d8f79df28d0">commit</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>docs/guides/tools.md</code>:148 on 2025-11-13 13:19</div>
            <div class="timeline-body"><p>nit: the repo name matches the command name so <code>uvx --lfs git+https://github.com/astral-sh/lfs-cowsay</code> works too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/geofft">@geofft</a> on <code>crates/uv-git/src/git.rs</code>:803 on 2025-11-13 14:12</div>
            <div class="timeline-body"><p>I don't understand this - <code>git lfs fsck</code> seems to validate LFS objects based on looking at git commit objects (or the index). It doesn't validate files in the working copy, and in any case a GitRepository has no files on disk. So, smudge/clean filters, which only apply to the working copy, should not be relevant here. What does this check do?</p>
<p>Same with the <code>GIT_LFS_SKIP_SMUDGE</code> environment variable right above - this shouldn't impact <code>git lfs fetch</code>, should it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/geofft">@geofft</a> requested changes on 2025-11-13 14:39</div>
            <div class="timeline-body"><p>OK, I think I understand the flow a little bit better:</p>
<ul>
<li>In <code>db</code>, we clone the actual remote repo and also do a <code>git lfs fetch</code> of the commit in question, which looks at the git commit object for LFS pointers, pulls down the LFS objects from the remote, and stores them in <code>.git/lfs/objects/</code> content-addressed. Files are never checked out (into the working tree) in <code>db</code>.</li>
<li>In <code>checkouts</code>, we clone the db (i.e. our origin is the db and there is no reference to the actual remote repo on the internet) and check out the specified commit. When LFS is enabled, this triggers the LFS smudge filters, which internally fetch the LFS objects from the origin, populate <code>.git/lfs/objects/</code> in the current clone (using hardlinks, thankfully), and then smudge them onto disk in the working tree.</li>
</ul>
<p>This means that it is safe to share the db between LFS and non-LFS URLs, and moreover it is safe to share the db between older versions of uv with or without <code>UV_GIT_LFS</code> set and current versions of uv. There is no working tree to have inconsistent state, and the <code>.git/lfs/objects/</code> storage is content-addressed and additive: if there's stuff there it's correct, and new stuff can be safely added without impacting other use of the repository.</p>
<p>Because of the risk of inconsistency with smudge filters in actual checkouts, I can see the argument for invalidating the cache key for both LFS and non-LFS checkouts. Also, because checkouts are hard-linked from db, their disk usage is smaller, and so I'm less concerned about leaving old/unreachable checkouts on disk than old/unreachable db clones: the wasted disk space is analogous to using another branch/ref.</p>
<p>So I would request:</p>
<ul>
<li>In the cache key used for <code>db</code>, do not record LFS-ness at all; keep the cache key the same as it was before this PR.</li>
<li>In the cache key used for <code>checkouts</code>, record both LFS-ness and non-LFS-ness (as this PR currently does).</li>
</ul>
<p>I do think it's possible to avoid changing the cache key for non-LFS checkouts (there are a few ways, to do this my actual preferred option would be to error out if it's an LFS repo as indicated by <code>.gitattributes</code> and LFS is not in use, which would force LFS repos to use the new cache key and never the old one), but I'm okay with not making that change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-11-13 16:14</div>
            <div class="timeline-body"><blockquote>
<p>So I would request:</p>
<ul>
<li>In the cache key used for <code>db</code>, do not record LFS-ness at all; keep the cache key the same as it was before this PR.</li>
<li>In the cache key used for <code>checkouts</code>, record both LFS-ness and non-LFS-ness (as this PR currently does).</li>
</ul>
</blockquote>
<p>I believe I had this before on one of the original iterations to avoid the cache churn. Are we settled this is what we want?</p>
<p>also, thoughts on this other location per your request?</p>
<p>https://github.com/astral-sh/uv/blob/e2b1a8969407f1f7440706be4bcb4d8f79df28d0/crates/uv-distribution-types/src/requirement.rs#L446-L450</p>
<p>edit: moved discussion to https://github.com/astral-sh/uv/pull/16143#discussion_r2525750175</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-14 01:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/git.rs</code>:803 on 2025-11-14 01:25</div>
            <div class="timeline-body"><p><img width="609" height="129" alt="lfs_testing" src="https://github.com/user-attachments/assets/613b1b5f-f61e-4e4c-acff-fe91280f8842" /></p>
<p>There was some degree of testing I was doing and found that validating LFS objects this way <code>fsck --objects</code> was the proper path forward for both the db and the checkouts after 3.0.2.
In other words the validation is needed to indicate whether the lfs fetch for the db cache is consistent to the oid we're working on. Same for the checkouts.
It's relevant to prevent the rountrip on initialization we may otherwise need.
Thanks for highlighting though, I realized this comment talks about filters which is in the wrong spot as you're right the filters apply on the checkout only. I'll reword for clarity of general intent/reason.</p>
<blockquote>
<p>Same with the GIT_LFS_SKIP_SMUDGE environment variable right above - this shouldn't impact git lfs fetch, should it?</p>
</blockquote>
<p>Agreed, I added this mainly as a precaution and future proofing paranoia. I'll adjust the comments to make it more clear.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-14 02:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/guides/tools.md</code>:148 on 2025-11-14 02:06</div>
            <div class="timeline-body"><p>01bb6310ffc28cdc89f8eaf61c264d069a39a592</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-14 02:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git/src/git.rs</code>:803 on 2025-11-14 02:06</div>
            <div class="timeline-body"><p>Comments clarified in c2e08262ce9c0ff554f22bd8b099aed350fe1bc3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-14 05:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-14 05:02</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>So I would request:</p>
<ul>
<li>In the cache key used for <code>db</code>, do not record LFS-ness at all; keep the cache key the same as it was before this PR.</li>
<li>In the cache key used for <code>checkouts</code>, record both LFS-ness and non-LFS-ness (as this PR currently does).</li>
</ul>
</blockquote>
<p>I believe I had this before on one of the original iterations to avoid the cache churn. Are we settled this is what we want?</p>
<p>also, thoughts on this other location per your request?</p>
<p>https://github.com/astral-sh/uv/blob/e2b1a8969407f1f7440706be4bcb4d8f79df28d0/crates/uv-distribution-types/src/requirement.rs#L446-L450</p>
</blockquote>
<p>@geofft for now, I've added this in 9b06e1c0575e6cc05b99be0e38d93aed491d782e
Let me know if there's any changes you'd like in <a href="https://github.com/astral-sh/uv/blob/e2b1a8969407f1f7440706be4bcb4d8f79df28d0/crates/uv-distribution-types/src/requirement.rs#L446-L450">uv-distribution-types/src/requirement.rs</a> as shown in the quote.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-14 05:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/guides/tools.md</code>:148 on 2025-11-14 05:15</div>
            <div class="timeline-body"><p>I've reverted this because it didn't work without stating the tool name when I was trying it out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">test:macos</span> added by @samypr100 on 2025-11-14 05:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @geofft by @samypr100 on 2025-11-17 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/geofft">@geofft</a> approved on 2025-11-18 19:28</div>
            <div class="timeline-body"><p>Thanks, and sorry for the delay in the re-review. I'm not totally following some of the code changes here but the behavior does seem to match what we want, i.e., sharing the <code>db/*</code> directory and only having separate <code>checkouts/*/*</code> directories. I might take a look at that later and send you something for review but that doesn't block merging this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/messerli-wallace">@messerli-wallace</a> approved on 2025-11-18 19:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-11-18 19:33</div>
            <div class="timeline-body"><p>There is one theoretical backwards-incompatibility here: with current uv, you only have to specify <code>UV_GIT_LFS=1</code> <em>once</em> and the checkout and built wheel gets cached with the LFS artifacts included. This PR (correctly) identifies that as a risk to cache consistency, but I think in practice it may work fine for users with git-lfs installed and configured properly, because the <code>.ok</code> file won't get created if the LFS fetch fails or otherwise leaves you in an inconsistent state, and I am worried that people might be relying on that in practice.</p>
<p>With current uv:</p>
<pre><code>$ UV_CACHE_DIR=/tmp/cache/q2-old UV_GIT_LFS=1 uvx git+https://github.com/astral-sh/lfs-cowsay -v
    Updated https://github.com/astral-sh/lfs-cowsay (44b8e65c8ecd376e4482a68b29312227879a226d)
      Built lfs-cowsay @ git+https://github.com/astral-sh/lfs-cowsay@44b8e65c8ecd376e4482a68b29312227879a226d
Installed 1 package in 2ms
6.1
$ UV_CACHE_DIR=/tmp/cache/q2-old uvx git+https://github.com/astral-sh/lfs-cowsay -v
6.1
</code></pre>
<p>With the code from this PR:</p>
<pre><code>$ UV_CACHE_DIR=/tmp/cache/q2-new UV_GIT_LFS=1 target/debug/uvx git+https://github.com/astral-sh/lfs-cowsay -v
    Updated https://github.com/astral-sh/lfs-cowsay (44b8e65c8ecd376e4482a68b29312227879a226d)
      Built lfs-cowsay @ git+https://github.com/astral-sh/lfs-cowsay@44b8e65c8ecd376e4482a68b29312227879a226d#lfs=true
Installed 1 package in 19ms
6.1
$ UV_CACHE_DIR=/tmp/cache/q2-new target/debug/uvx git+https://github.com/astral-sh/lfs-cowsay -v
      Built lfs-cowsay @ git+https://github.com/astral-sh/lfs-cowsay@44b8e65c8ecd376e4482a68b29312227879a226d
Installed 1 package in 18ms
Traceback (most recent call last):
  File &quot;/tmp/cache/q2-new/archive-v0/UHbaC9QcSG9WzgquNtN5V/bin/lfs-cowsay&quot;, line 6, in &lt;module&gt;
    from lfs_cowsay.__main__ import cli
  File &quot;/tmp/cache/q2-new/archive-v0/UHbaC9QcSG9WzgquNtN5V/lib/python3.14/site-packages/lfs_cowsay/__init__.py&quot;, line 4, in &lt;module&gt;
    from .main import (
    ...&lt;13 lines&gt;...
    )
  File &quot;/tmp/cache/q2-new/archive-v0/UHbaC9QcSG9WzgquNtN5V/lib/python3.14/site-packages/lfs_cowsay/main.py&quot;, line 4, in &lt;module&gt;
    from .characters import CHARS
  File &quot;/tmp/cache/q2-new/archive-v0/UHbaC9QcSG9WzgquNtN5V/lib/python3.14/site-packages/lfs_cowsay/characters.py&quot;, line 2
    oid sha256:4a003717d1e1997c56ef4128f54eb92c72831e44cda4e3d49e93a32ae0cc9222
               ^
SyntaxError: invalid decimal literal
</code></pre>
<p>(This does not affect <code>UV_GIT_LFS=1 uv tool install blah</code> + <code>uv tool upgrade</code>, though - we correctly persist the <code>?lfs=true</code> in the URL. It only affects two independent parses of the same git repo/commit that do not share persistent state but share the cache.)</p>
<p>Again, I don't think this is a problem in practice / don't think this should block merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:449 on 2025-11-28 13:13</div>
            <div class="timeline-body"><p>We need to remove the 0 here too, otherwise we invalidate the built wheel cache, through extra-build-requires.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git-types/src/lib.rs</code>:16 on 2025-11-28 13:36</div>
            <div class="timeline-body"><p>We need to use something like <code>parse_boolish_environment_variable</code> here, otherwise <code>UV_GIT_LFS=true</code> and <code>UV_GIT_LFS=false</code> do the same thing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-installer/src/satisfies.rs</code>:197 on 2025-11-28 13:37</div>
            <div class="timeline-body"><p>nit: We can use a <code>Display</code> impl</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/concepts/projects/dependencies.md</code>:368 on 2025-11-28 14:11</div>
            <div class="timeline-body"><p>We need something about the default, probably a different term than &quot;resolved&quot;</p>
<blockquote>
<ul>
<li>By default, Git LFS entries are not resolved</li>
</ul>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-11-28 14:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-28 22:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:449 on 2025-11-28 22:27</div>
            <div class="timeline-body"><p>Sounds good, I asked in https://github.com/astral-sh/uv/pull/16143#discussion_r2525750175 if we also wanted to remove this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git-types/src/lib.rs</code>:16 on 2025-11-28 22:30</div>
            <div class="timeline-body"><p>Fair. I kept the original behavior in case someone is relying on it with what would be a falsy value.</p>
<p>parse_boolish_environment_variable is currently in uv-settings which is quite high up in the graph, would you copy that helper or move it into some other location?</p>
<p><img width="2664" height="2536" alt="uv" src="https://github.com/user-attachments/assets/295ff8f4-f61b-4064-a3d7-8626f7dc18ba" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-28 22:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-28 22:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/concepts/projects/dependencies.md</code>:368 on 2025-11-28 22:42</div>
            <div class="timeline-body"><p>Agreed, 60f0ea8506d61d48fb04a5b089ad9aa552863183</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-28 22:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:449 on 2025-11-28 22:42</div>
            <div class="timeline-body"><p>Removed in 200b65ac53a9015ab30ea6e0845317e5bd99f847</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-28 22:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-distribution-types/src/requirement.rs</code>:447 on 2025-11-28 22:42</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/pull/16143#discussion_r2572624380</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-28 22:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git-types/src/lib.rs</code>:16 on 2025-11-28 22:51</div>
            <div class="timeline-body"><p>I changed it to at least consider empty values as false in 2377aa3a7aa0794bcd8127f883abfb88db7012b8 for the time being to align on some of the others that don't use <code>parse_boolish_environment_variable</code> yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-28 23:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-installer/src/satisfies.rs</code>:197 on 2025-11-28 23:14</div>
            <div class="timeline-body"><p>Good point, addc8ed0873968de8d6b0295bc212e498d1d3892</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-11-29 00:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-git-types/src/lib.rs</code>:16 on 2025-11-29 00:44</div>
            <div class="timeline-body"><p>I proceeded with copying the check inline in b88ff97c13a69b8aee20f3fe13d8fd8a84ed7823 as I think this is effectively the same end result</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Conditional Git LFS Support" to "Support Git LFS with opt-in" by @konstin on 2025-12-02 11:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-12-02 12:10</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2025-12-02 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-12-02 12:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Red-Eyed">@Red-Eyed</a> on 2025-12-03 06:17</div>
            <div class="timeline-body"><p>Thank you!
Having worked with LFS, and I wonder how to deal with different LFS endpoints and credentials?
For example, at work we have GitHub enterprise and external git LFS server (not github)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-12-03 14:34</div>
            <div class="timeline-body"><blockquote>
<p>Thank you! Having worked with LFS, and I wonder how to deal with different LFS endpoints and credentials? For example, at work we have GitHub enterprise and external git LFS server (not github)</p>
</blockquote>
<p>@Red-Eyed That would still be configured as part of your git configuration. Since LFS objects have the originating url on them, as long as git itself can authenticate, fetch, and materialize the objects you shouldn't have issues with uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-12-03 14:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsemet">@gsemet</a> on 2025-12-06 10:15</div>
            <div class="timeline-body"><p>Great ! Is there a way to use it when doing Â«Â uv tool install git+https//â€¦Â Â»?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-12-06 12:08</div>
            <div class="timeline-body"><blockquote>
<p>Great ! Is there a way to use it when doing Â«Â uv tool install git+https//â€¦Â Â»?</p>
</blockquote>
<p>uv tool install --lfs</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:44:57 UTC
    </footer>
</body>
</html>
