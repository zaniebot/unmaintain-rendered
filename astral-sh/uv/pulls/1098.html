<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>puffin-client: decouple serde from cached client - astral-sh/uv #1098</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>puffin-client: decouple serde from cached client</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/1098">#1098</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-01-25 16:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-25 16:34</div>
            <div class="timeline-body"><p>The motivation for this change is that I'd like to use something that
<em>isn't</em> Serde to manage serialization of cached data. Simultaneously,
we'd like to keep existing uses of Serde still working. So this change
does a bit of surgery to a <code>CachedClient</code> to remove the coupling with
Serde's serialization traits by introducing a new trait that abstracts
over the Serde operations we need.</p>
<p>We do one other little change here, which is to make deserialization be
performed in two steps: one for the envelope and then another for the
actual data. This is non-ideal for performance, but is necessary for now
I think in order to make zero-copy deserialization work. Namely, the
envelope contains a bunch of HTTP related cache data from an external
crate, and it is not possible to implement the necessary traits to make
it zero-copy deserializeable. So to work around that, we make the
envelope something that stands on its own and contains the raw bytes of
the data we're caching. It is likely that we will eventually want to
remove this two-step serialization process, but to do so and
simultaneously support zero-copy will likely require forking the
<code>http-cache-semantics</code> crate (or convincing them to optionally support
<code>rkyv</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-02-16 21:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-16 21:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:33:42 UTC
    </footer>
</body>
</html>
