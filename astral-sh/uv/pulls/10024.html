<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stable order for virtual packages - astral-sh/uv #10024</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Stable order for virtual packages</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/10024">#10024</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-12-19 10:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>uv gives priorities to packages by package name, not by virtual package (<code>PubGrubPackage</code>). pubgrub otoh when prioritizing order the virtual packages. When the order of virtual packages changes, uv changes its resolutions and error messages. This means uv was depending on implementation details of pubgrub&#x27;s prioritization caching.</p>
<p>This broke with <a href="https://github.com/pubgrub-rs/pubgrub/pull/299">pubgrub-rs/pubgrub#299</a>, which added a tiebreaker term that made pubgrub&#x27;s sorting deterministic given a deterministic ordering of allocating the packages (which happens the first time pubgrub sees a package).</p>
<p>The new custom tiebreaker decreases the difference to upstream pubgrub.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-12-19 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-12-19 15:26</div>
            <div class="timeline-body"><p>For transformers, the difference comes from <code>fsspec</code> and <code>datasets</code> being mutually incompatible. Using just the two packages as input we can coerce both versions, which now appear in different, hence the slightly larger lockfile.</p>
<pre><code>8,9c8,9
&lt; datasets==2.20.0
&lt; dill==0.3.8
---
&gt; datasets==2.14.4
&gt; dill==0.3.7
12c12
&lt; fsspec==2024.5.0
---
&gt; fsspec==2024.6.1
16c16
&lt; multiprocess==0.70.16
---
&gt; multiprocess==0.70.15
21d20
&lt; pyarrow-hotfix==0.6
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/konstin">@konstin</a> on 2024-12-19 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-12-19 16:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2024-12-20 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-12-20 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-20 09:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:49:55 UTC
    </footer>
</body>
</html>
