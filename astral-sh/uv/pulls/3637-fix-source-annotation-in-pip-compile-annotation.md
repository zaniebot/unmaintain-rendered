```yaml
number: 3637
title: "Fix source annotation in pip compile `annotation-style=line` output"
type: pull_request
state: merged
author: blueraft
labels:
  - bug
assignees: []
merged: true
base: main
head: annotate-line-fix
created_at: 2024-05-17T12:30:48Z
updated_at: 2024-05-17T14:30:51Z
url: https://github.com/astral-sh/uv/pull/3637
synced_at: 2026-01-12T16:05:46Z
```

# Fix source annotation in pip compile `annotation-style=line` output

---

_@blueraft_

## Summary

Fixes a small discrepancy between the pip compile outputs for `annotation-style=split` and `annotation-style=line` commands.

### Problem

Consider the following `pyproject.toml` file.
```sh
$ cat pyproject.toml
[project]
name = "uv_test"
dynamic = ["version"]
dependencies = ["click"]
```

Running uv pip compile with annotation-style=split on uv 0.1.44 version yields the following:
```sh
❯ uv pip compile pyproject.toml --annotation-style=split
Resolved 1 package in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml --annotation-style=split
click==8.1.7
    # via uv-test (pyproject.toml)
```

However, running uv pip compile with annotation-style=line doesn't include source info for root level dependencies.
```sh
❯ uv pip compile pyproject.toml --annotation-style=line
Resolved 1 package in 1ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml --annotation-style=line
click==8.1.7
```

With this PR:
```sh
❯ ../target/debug/uv pip compile --annotation-style=line pyproject.toml
Resolved 1 package in 6ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --annotation-style=line pyproject.toml
click==8.1.7              # via uv-test (pyproject.toml)
```

This also now matches `pip-tools` output:
```sh
❯ pip-compile --annotation-style=line pyproject.toml
#
# This file is autogenerated by pip-compile with Python 3.12
# by the following command:
#
#    pip-compile --annotation-style=line pyproject.toml
#
click==8.1.7              # via uv_test (pyproject.toml)

```

## Test Plan

`cargo test`

---

_Review requested from @charliermarsh by @charliermarsh on 2024-05-17 13:33_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-05-17 13:33_

---

_Label `bug` added by @charliermarsh on 2024-05-17 13:33_

---

_@charliermarsh approved on 2024-05-17 13:57_

Thanks!

---

_Merged by @charliermarsh on 2024-05-17 13:57_

---

_Closed by @charliermarsh on 2024-05-17 13:57_

---

_Branch deleted on 2024-05-17 14:30_

---
