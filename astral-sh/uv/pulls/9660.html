<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better build error messages - astral-sh/uv #9660</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better build error messages</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/9660">#9660</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-12-05 12:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Build failures are one of the most common user facing failures that aren&#x27;t &quot;obivous&quot; errors (such as typos) or resolver errors. Currently, they show more technical details than being focussed on this being an error in a subprocess that is either on the side of the package or - more likely - in the build environment, e.g. the user needs to install a dev package or their python version is incompatible.</p>
<p>The new error message clearly delineates the part that&#x27;s important (this is a build backend problem) from the internals (we called this hook) and is consistent about which part of the dist building stage failed. We have to calibrate the exact wording of the error message some more. Most of the implementation is working around the orphan rule, (this)error rules and trait rules, so it came out more of a refactoring than intended.</p>
<p>Example:</p>
<p><img src="https://github.com/user-attachments/assets/2bc12992-db79-4362-a444-fd0d94594b77" alt="image"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-12-05 12:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/konstin">@konstin</a> on 2024-12-05 12:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/sync.rs</code>:4961 on 2024-12-05 14:40</div>
            <div class="timeline-body"><p>Why do we identify the build backend here but not in the other case?</p>
<blockquote>
<p>Build backend failed to build wheel through <code>build_wheel</code> (exit status: 1)</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-05 14:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-05 14:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-build-frontend/src/error.rs</code>:80 on 2024-12-05 14:42</div>
            <div class="timeline-body"><p>I&#x27;d rephrase a little (applies elsewhere)</p>
<pre><code>    #[error(&quot;The build backend returned an error; this usually indicates a problem with the package or your environment.&quot;)]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-05 14:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/sync.rs</code>:766 on 2024-12-05 14:42</div>
            <div class="timeline-body"><p>I&#x27;m a little hesitant to have the hint in the error chain. Like &quot;this usually indicates a problem with the package or your environment&quot; feels more suitable <em>after</em> the error chain? Stylistically, it seems nice to have the error chain be factual and save our helpful messages for a separate section. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:7 on 2024-12-05 14:45</div>
            <div class="timeline-body"><p>Might need to rope in @BurntSushi to review this implementation detail</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-05 14:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-05 14:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:33 on 2024-12-05 14:46</div>
            <div class="timeline-body"><p><code>AnyBuildError</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-requirements/src/lib.rs</code>:59 on 2024-12-05 14:47</div>
            <div class="timeline-body"><p>Doesn&#x27;t need to happen here, but is it feasible for us to consolidate this repeated logic?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-05 14:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-05 14:50</div>
            <div class="timeline-body"><p>Would it also be feasible to explain <em>why</em> we&#x27;re building a package? Like are we doing it for install or just to read its metadata? Is that already obvious?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-05 15:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-build-frontend/src/error.rs</code>:80 on 2024-12-05 15:00</div>
            <div class="timeline-body"><p>Sorry, my edit wasn&#x27;t quite sufficient â€” Charlie would also point out since this is a single sentence (after my change :D) that it shouldn&#x27;t end in a period anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:16 on 2024-12-05 17:08</div>
            <div class="timeline-body"><p>Do you mean <code>IsBuildBackendError</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:16 on 2024-12-05 17:13</div>
            <div class="timeline-body"><p>Also, I would mention that <code>AsDynError</code> is an internal thing in <code>thiserror</code>. It took me a bit to figure that out as I was confused about it not being in <code>thiserror</code>&#x27;s public API docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:10 on 2024-12-05 17:15</div>
            <div class="timeline-body"><p>Would it be possible to spell out the concrete cycle here? I think that would aide understanding what specifically this trait is trying to do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-distribution/src/error.rs</code>:57 on 2024-12-05 17:17</div>
            <div class="timeline-body"><p>Hmmm. I believe previously, with <code>anyhow::Error</code>, this would result in printing its entire chain. But I&#x27;m not sure this new definition does? It might only emit the top of the chain when printing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:7 on 2024-12-05 17:19</div>
            <div class="timeline-body"><p>One thing that would be useful here is a little more docs like, &quot;If the orphan-rule didn&#x27;t exist, we would do ... instead.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-build-frontend/src/error.rs</code>:74 on 2024-12-05 17:21</div>
            <div class="timeline-body"><p>Same as below, but this might be dropping any chain that might have been on <code>anyhow::Error</code>? Not 100% sure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-12-05 17:23</div>
            <div class="timeline-body"><p>I think this is probably fine. At least, I don&#x27;t immediately see a simpler solution. But some extra docs (see comments) might help clear up some things.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/konstin">@konstin</a> on 2024-12-06 11:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-12-06 11:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:10 on 2024-12-06 11:50</div>
            <div class="timeline-body"><p>I&#x27;ll leave this here as context for the update later.</p>
<p><img src="https://github.com/user-attachments/assets/8d9c60a6-4747-41df-b922-6c6615ad3233" alt="image"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-12-06 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-build-frontend/src/error.rs</code>:74 on 2024-12-06 13:14</div>
            <div class="timeline-body"><p><code>AnyErrorBuild</code> preserves the chain, it passes <code>.source()</code> calls through to its wrapped type.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-12-06 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-distribution-types/src/dist_error.rs</code>:33 on 2024-12-06 13:14</div>
            <div class="timeline-body"><p>It&#x27;s more like &quot;<code>anyhow::Error</code>, but with an extra trait for build error querying on top&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-build-frontend/src/error.rs</code>:74 on 2024-12-06 13:20</div>
            <div class="timeline-body"><p>I mean its <code>Display</code> impl. The <code>Display</code> impl for a <code>Box&lt;dyn Error&gt;</code> doesn&#x27;t emit the chain. But a <code>anyhow::Error</code> will.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-12-06 13:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-12-06 13:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-build-frontend/src/error.rs</code>:74 on 2024-12-06 13:47</div>
            <div class="timeline-body"><p>afaik all the error types only show their inner message, but not the chain, over which you have to iterate manually. When testing,</p>
<pre><code>use thiserror::Error;

#[derive(Error, Debug)]
#[error(&quot;Wrapper Err&quot;)]
struct WrappedErr;

fn main() {
    let err: anyhow::Error = WrappedErr.into();
    println!(&quot;{}&quot;, err);
    println!(&quot;{}&quot;, err.context(&quot;2&quot;));
}
</code></pre>
<p>shows</p>
<pre><code>Wrapper Err
2
</code></pre>
<p>and we don&#x27;t seem to be losing and context in our snapshot tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-12-06 14:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-build-frontend/src/error.rs</code>:74 on 2024-12-06 14:07</div>
            <div class="timeline-body"><p>anyhow does show the chain, but only in alternate mode:</p>
<pre><code>use thiserror::Error;

#[derive(Error, Debug)]
#[error(&quot;Inner Err&quot;)]
struct InnerErr;

#[derive(Error, Debug)]
#[error(&quot;Wrapper Err&quot;)]
struct WrappedErr(#[source] InnerErr);

fn main() {
    let err = WrappedErr(InnerErr);
    println!(&quot;{:#}&quot;, err);
    let err: anyhow::Error = WrappedErr(InnerErr).into();
    println!(&quot;{:#}&quot;, err);
    println!(&quot;{:#}&quot;, err.context(&quot;2&quot;));
}
</code></pre>
<p>shows</p>
<pre><code>Wrapper Err
Wrapper Err: Inner Err
2: Wrapper Err: Inner Err
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/konstin">@konstin</a> on 2024-12-06 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-12-06 14:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-build-frontend/src/error.rs</code>:74 on 2024-12-06 14:12</div>
            <div class="timeline-body"><p>Ah okay, so <code>anyhow::Error</code>&#x27;s <code>Display</code> impl is the same as <code>Box&lt;dyn Error&gt;</code>. Interesting. All righty.</p>
<p>And yeah, I realize the snapshot tests indicate nothing untoward is happening here. I don&#x27;t have a full grasp of the surrounding code and I wasn&#x27;t sure how easy it would be to break something in the future. But I think you&#x27;ve demonstrated my concern is unfounded. Thank you. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/konstin">@konstin</a> on 2024-12-12 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/konstin">@konstin</a> on 2024-12-12 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-types/src/traits.rs</code>:203 on 2024-12-12 16:33</div>
            <div class="timeline-body"><p>Nice thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-12-12 16:33</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-12-17 15:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-17 15:44</div>
            <div class="timeline-body"><p>Awesome. Sorry for the delay!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-17 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-17 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-17 15:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:49:42 UTC
    </footer>
</body>
</html>
