<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use available versions to simplify unsat error reports - astral-sh/uv #547</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use available versions to simplify unsat error reports</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/547">#547</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2023-12-04 17:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Uses https://github.com/pubgrub-rs/pubgrub/pull/156 to consolidate version ranges in error reports using the actual available versions for each package.</p>
<p>Alternative to https://github.com/zanieb/pubgrub/pull/8 which implements this behavior as a method in the <code>Reporter</code> â€” here it's implemented in our custom report formatter (#521) instead which requires no upstream changes.</p>
<p>Requires https://github.com/zanieb/pubgrub/pull/11 to only retrieve the versions for packages that will be used in the report.</p>
<p>This is a work in progress. Some things to do:</p>
<ul>
<li>~We may want to allow lazy retrieval of the version maps from the formatter~</li>
<li>[x] We should probably create a separate error type for no solution instead of mixing them with other resolve errors</li>
<li>~We can probably do something smarter than creating vectors to hold the versions~</li>
<li>[x] This degrades error messages when a single version is not available, we'll need to special case that</li>
<li>[x] It seems safer to coerce the error type in <code>resolve</code> instead of <code>solve</code> if feasible</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-12-08 18:04</div>
            <div class="timeline-body"><p>With https://github.com/zanieb/pubgrub/pull/12 this does not degrade error messages anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-12-08 18:09</div>
            <div class="timeline-body"><p>Ready for review but the PubGrub changes should be merged first.</p>
<p>Additionally, we don't have a test case that's changed by this :) that is my next priority.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2023-12-08 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-08 20:05</div>
            <div class="timeline-body"><p>Request me as a reviewer if ready :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-resolver/src/error.rs</code>:89 on 2023-12-11 12:56</div>
            <div class="timeline-body"><p>I know that is an error type in pubgrub, but fwiw we don't consider this an error (it's surprisingly popular in python packaging)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:35 on 2023-12-11 12:59</div>
            <div class="timeline-body"><p>What about the following as <code>self.simplify(set)</code>?</p>
<pre><code class="language-suggestion">                    let set = if let Some(versions) = self.available_versions.get(package) {
                        set.simplify(versions.iter())
                    } else {
                        set
                    );
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-12-11 13:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-resolver/src/error.rs</code>:89 on 2023-12-11 14:53</div>
            <div class="timeline-body"><p>Great it'd probably be good to remove it then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-12-11 14:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/puffin-resolver/src/pubgrub/report.rs</code>:35 on 2023-12-11 14:54</div>
            <div class="timeline-body"><p>I can try that, it'd need to be <code>self.simplify(package, set)</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-12-11 14:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2023-12-12 23:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-12-12 23:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-12 23:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:34:50 UTC
    </footer>
</body>
</html>
