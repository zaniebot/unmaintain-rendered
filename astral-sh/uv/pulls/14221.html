<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix: Handle query parameters in wheel URLs - astral-sh/uv #14221</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix: Handle query parameters in wheel URLs</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/14221">#14221</a>
        opened by <a href="https://github.com/esafak">@esafak</a>
        on 2025-06-23 16:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/esafak">@esafak</a> on 2025-06-23 16:57</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>The <code>WheelFilename::try_from&lt;&amp;Url&gt;</code> implementation was previously passing the full last path segment of a URL (including any query parameters) to <code>WheelFilename::from_str</code>. This caused <code>from_str</code> to fail when trying to strip the <code>.whl</code> suffix because the query parameters were present at the end of the string.</p>
<p>This commit modifies <code>try_from&lt;&amp;Url&gt;</code> to correctly strip any query parameters from the extracted filename before attempting to parse it. It achieves this by finding the last <code>?</code> in the path segment and taking the substring before it.</p>
<p>Fixes #14217</p>
<h2>Test Plan</h2>
<p>Updated tests to include URLs with query parameters, ensuring the fix works as expected and doesn't introduce regressions for URLs without query parameters.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-distribution-filename/src/wheel.rs</code>:328 on 2025-06-23 17:03</div>
            <div class="timeline-body"><p>I think we also want to strip fragments (<code>#</code> at the end). There's an implementation for this in <code>URLString</code>:</p>
<pre><code class="language-rust">    /// Return the [`UrlString`] with any query parameters and fragments removed.
    pub fn base_str(&amp;self) -&gt; &amp;str {
        self.as_ref()
            .split_once('?')
            .or_else(|| self.as_ref().split_once('#'))
            .map(|(path, _)| path)
            .unwrap_or(self.as_ref())
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-06-23 17:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-06-23 17:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-distribution-filename/src/wheel.rs</code>:328 on 2025-06-23 17:25</div>
            <div class="timeline-body"><p>If you prefer, I can make this patch and merge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/esafak">@esafak</a> reviewed on 2025-06-23 17:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/esafak">@esafak</a> on <code>crates/uv-distribution-filename/src/wheel.rs</code>:328 on 2025-06-23 17:26</div>
            <div class="timeline-body"><p>Yes, please! Note that the tests don't cover that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-06-23 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-06-23 18:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-distribution-filename/src/wheel.rs</code>:328 on 2025-06-23 18:01</div>
            <div class="timeline-body"><p>It looks like this code is actually unused (https://github.com/astral-sh/uv/pull/14223) so this isn't quite the right spot. I commented back in the originating issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-06-23 18:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 07:27:35 UTC
    </footer>
</body>
</html>
