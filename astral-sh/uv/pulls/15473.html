<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Python Pin should be ignored when incompatible with project - astral-sh/uv #15473</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Global Python Pin should be ignored when incompatible with project</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/15473">#15473</a>
        opened by <a href="https://github.com/harsh-ps-2003">@harsh-ps-2003</a>
        on 2025-08-23 17:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/harsh-ps-2003">@harsh-ps-2003</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>@zanieb in #14916 found an interesting bug. Global pin is the user preference across projects, but if the project locally has a  local pin, it should be an authoritative constraint and end up with error. This avoids blocking new projects that intentionally require a newer Python version than the user’s global default. We still error on a local <code>.python-version</code> inside the project to preserve explicit, repo-scoped intent.</p>
<ul>
<li>Explicit <code>--python</code> → Always wins regardless of constraints</li>
<li>Local <code>.python-version</code> → Project-scoped, errors on conflict</li>
<li>Global <code>.python-version</code> → User preference, ignored if conflicts with project. Global pins are suggestions that can be overridden by project requirements</li>
<li>Project <code>requires-python</code> → Fallback when no pins exist</li>
</ul>
<p>Implementation :</p>
<ul>
<li>If a global <code>~/.config/uv/.python-version</code> conflicts with a project <code>requires-python</code>, we ignore the pin and use the project requirement</li>
<li>If a local project <code>.python-version</code> conflicts, we error, with guidance to update the pin</li>
<li>Explicit <code>--python</code> continues to override both</li>
</ul>
<p>Now, global pins are suggestions that can be overridden by project requirements, rather than hard constraints that block project setup.</p>
<h2>Test Plan</h2>
<p>A new has been added in <code>sync_python_version()</code> along with manual testing :</p>
<pre><code>harshps22ugp@lab:~/projects/uv$ target/debug/uv python pin --global 3.10
Pinned `/home/harshps22ugp/.config/uv/.python-version` to `3.10`
harshps22ugp@lab:~/projects/uv$ mkdir -p /tmp/uv-global-pin &amp;&amp; cd /tmp/uv-global-pin
harshps22ugp@lab:/tmp/uv-global-pin$ cat &gt; pyproject.toml &lt;&lt;'EOF'
&gt; [project]
&gt; name = &quot;project&quot;
&gt; version = &quot;0.1.0&quot;
&gt; requires-python = &quot;&gt;=3.11&quot;
&gt; dependencies = [&quot;anyio==3.7.0&quot;]
&gt; EOF
harshps22ugp@lab:/tmp/uv-global-pin$ /home/harshps22ugp/projects/uv/target/debug/uv sync
Using CPython 3.13.5
Creating virtual environment at: .venv
Resolved 4 packages in 276ms
Prepared 3 packages in 149ms
░░░░░░░░░░░░░░░░░░░░ [0/3] Installing wheels...                                                                                                               warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance.
         If the cache and target directories are on different filesystems, hardlinking may not be supported.
         If this is intentional, set `export UV_LINK_MODE=copy` or use `--link-mode=copy` to suppress this warning.
Installed 3 packages in 35ms
 + anyio==3.7.0
 + idna==3.10
 + sniffio==1.3.1
harshps22ugp@lab:/tmp/uv-global-pin$ . .venv/bin/activate
(project) harshps22ugp@lab:/tmp/uv-global-pin$ python -V
Python 3.13.5
(project) harshps22ugp@lab:/tmp/uv-global-pin$
</code></pre>
<p>No error was thrown!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 18:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1123 on 2025-08-29 18:37</div>
            <div class="timeline-body"><p>Can we put this on <code>PythonRequest</code> as <code>as_pep440_version</code> or something instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1135 on 2025-08-29 18:38</div>
            <div class="timeline-body"><p>Can we do an exhaustive match here instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 18:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 18:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1138 on 2025-08-29 18:39</div>
            <div class="timeline-body"><p>Do we need to roundtrip to a string and parse? Can't we just construct a <code>Version</code> from the u8s? I'd probably make this a <code>VersionRequest::as_version</code> utility too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 18:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1165 on 2025-08-29 18:41</div>
            <div class="timeline-body"><p>Do we need to clone here? Can you use <code>PythonVersionFile::version</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 18:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/mod.rs</code>:1196 on 2025-08-29 18:42</div>
            <div class="timeline-body"><p>This repeated else chain seems indicative of a need to refactor.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 18:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/python/find.rs</code>:98 on 2025-08-29 18:42</div>
            <div class="timeline-body"><p>I'm not sure I follow why this new comment is needed here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-29 20:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/mod.rs</code>:63 on 2025-08-29 20:01</div>
            <div class="timeline-body"><p>This import is not properly grouped</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:44:29 UTC
    </footer>
</body>
</html>
