```yaml
number: 5111
title: "pip compile: change order of check to handle exact argument first"
type: pull_request
state: merged
author: skshetry
labels:
  - bug
assignees: []
merged: true
base: main
head: fix-order-exclude
created_at: 2024-07-16T16:00:13Z
updated_at: 2024-07-16T20:43:00Z
url: https://github.com/astral-sh/uv/pull/5111
synced_at: 2026-01-12T16:06:38Z
```

# pip compile: change order of check to handle exact argument first

---

_@skshetry_

I messed up the order of checks in #5033, due to which it failed to exclude the case of `-P package`, as `arg.startswith("-P")` check came first and skipped only the first argument.

That means that, in the following command:
```console
uv pip compile --output-file pip_compile_uv_header.txt unpinned_uv.in -P attrs==18.1.0
```

The generated header would exclude `-P`, but keep `attrs==18.1.0`.

```plaintext
# This file was autogenerated by uv via the following command:
#    uv pip compile --output-file pip_compile_uv_header.txt unpinned_uv.in attrs==18.1.0
```

But we want to check for an exact match first and then only check for the case when option and value are together.

This also affected `--find-links` short option of style `-f <uri>`.


Hopefully, third times going to be a charm. ðŸ˜³ 


<!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

## Summary

<!-- What's the purpose of the change? What does it do, and why? -->

## Test Plan

<!-- How was it tested? -->

I tested locally, and also changed one snapshot test to use `-P` for variation. I don't think it's worth an extra test, but can do that for sure.



---

_@charliermarsh approved on 2024-07-16 16:44_

---

_Label `bug` added by @zanieb on 2024-07-16 16:45_

---

_Merged by @charliermarsh on 2024-07-16 16:46_

---

_Closed by @charliermarsh on 2024-07-16 16:46_

---

_Branch deleted on 2024-07-16 16:46_

---

_Comment by @charliermarsh on 2024-07-16 16:46_

Thanks! I also missed this as reviewer, all good.

---

_Comment by @avilaton on 2024-07-16 20:42_

I can feel the anxiety we all have to get this dependabot stuff merged, I coded most of that pr on my cellphone while doing other things.

---
