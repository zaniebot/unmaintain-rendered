<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use latest Pyodide version for each python version - astral-sh/uv #17372</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use latest Pyodide version for each python version</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/17372">#17372</a>
        opened by <a href="https://github.com/ryanking13">@ryanking13</a>
        on 2026-01-09 06:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ryanking13">@ryanking13</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This changes how the <code>download-metadata.json</code> file is generated for Pyodide.</p>
<p>Previously, if we have a different Pyodide version with a same Python version, the older Pyodide version is selected.</p>
<p>For example, say we have</p>
<ul>
<li>Pyodide 0.29.0 with Python 3.13.2</li>
<li>Pyodide 0.28.3 with Python 3.13.2</li>
</ul>
<p>then, pyodide 0.28.3 was stored in <code>download-metadata.json</code> as we iterate in decending order with overwriting the value that was previously written.</p>
<p>I fixed it by picking up the latest Pyodide version for each Python version.</p>
<h2>Test Plan</h2>
<p>Ran <code>uv run -- crates/uv-python/fetch-download-metadata.py</code> locally, and verified the output:</p>
<pre><code>2026-01-09 15:39:23 INFO Fetching Pyodide checksums: 0/4
2026-01-09 15:39:24 INFO Selected cpython-3.13.2-emscripten-wasm32-musl (0.29.1)
2026-01-09 15:39:24 INFO Selected cpython-3.12.7-emscripten-wasm32-musl (0.27.7)
2026-01-09 15:39:24 INFO Selected cpython-3.12.1-emscripten-wasm32-musl (0.26.4)
2026-01-09 15:39:24 INFO Selected cpython-3.11.3-emscripten-wasm32-musl (0.25.1)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @konstin on 2026-01-09 11:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-09 11:19</div>
            <div class="timeline-body"><p>CC @hoodmane</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-10 16:22</div>
            <div class="timeline-body"><p>The implementation here looks a bit different than the GraalPy and PyPy ones, e.g., they do something like</p>
<pre><code class="language-python">                # Only keep the latest pypy version of each arch/platform
                if (python_version, arch, platform) not in results:
                    results[(python_version, arch, platform)] = download
</code></pre>
<p>It's not like that's beautiful Python, but it might be nice for the pattern to be consistent? What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ryanking13">@ryanking13</a> on 2026-01-11 03:40</div>
            <div class="timeline-body"><p>@zanieb Sounds reasonable. I update the code to make it look similar to other finders.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2026-01-12 23:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2026-01-12 23:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2026-01-12 23:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2026-01-12 23:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-13 00:27:04 UTC
    </footer>
</body>
</html>
