<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Normalize specifiers by sorting - astral-sh/uv #6333</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Normalize specifiers by sorting</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6333">#6333</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-08-21 14:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2024-08-21 14:49</div>
            <div class="timeline-body"><p>We currently normalize package and extra names and drop the whitespace from version specifiers, but we were not normalizing the order of the specifiers. By sorting them we match the behavior of <code>packaging</code> and become independent of build backends reordering specifiers (#6332).</p>
<p>Surprisingly, the snapshot diff isn't large - most people were already writing sorted specifiers. Still, this will lead to observable differences in lockfiles between releases in cases where there are entries in <code>requires-dist</code> that were not previously sorted (while the total number of <code>requires-dist</code> is already small compared to the overall lockfile).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2024-08-21 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @konstin on 2024-08-21 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2024-08-21 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-08-21 15:05</div>
            <div class="timeline-body"><p>This makes sense to me, but as discussed offline, we need to decide how we want to handle changes like this where it could cause a change to the lock file contents. The most annoying manifestation likely occurs when multiple people working on the same project use different versions of <code>uv</code> to make a change to the lock file. This could result in ping-ponging. Although it's worth saying that this change doesn't impact how lock files are read, so there is a high degree of compatibility.</p>
<p>I'm inclined to merge this as a bug fix, but I think there is a big known unknown here: we have no systematic way at present of measuring the impact of a change like this. For example, if most specifiers are sorted in lock files already, then this has very limited impact and seems okay to merge. On the other hand, if this changed almost every lock file, then that kind of impact would probably demand us to manage it differently.</p>
<p>My sense though, based on the snapshot updates here, is that the impact is much closer to the limited end of the spectrum.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-08-21 15:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-08-29 21:02</div>
            <div class="timeline-body"><p>I've confirmed that <code>uv lock</code> doesn't change <code>requires-dist</code> when there aren't other changes anyway (the noop behavior remains untouched), i.e. there will only be changes to the lockfile (and could ping-pong between versions) when it gets changed anyway, and even then i expect those cases to be rare, so i'm merging this for the next release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @konstin on 2024-08-29 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-08-29 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2024-08-29 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2024-08-29 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-08-29 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-08-29 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-29 21:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:00:59 UTC
    </footer>
</body>
</html>
