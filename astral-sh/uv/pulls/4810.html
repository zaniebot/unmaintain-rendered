<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fill Python requests with platform information during automatic fetches - astral-sh/uv #4810</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fill Python requests with platform information during automatic fetches</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4810">#4810</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-07-04 15:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-04 15:31</div>
            <div class="timeline-body"><p>Closes https://github.com/astral-sh/uv/issues/4800</p>
<p>We do this during <code>install</code> â€” it's an important step to ensure the request has the platform information in it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-07-04 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-04 15:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 15:32</div>
            <div class="timeline-body"><p>Alternatively, perhaps we should be doing this a bit further down in <code>Self::fetch</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-04 15:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 15:33</div>
            <div class="timeline-body"><p>Or in <code>ManagedPythonDownload::from_request</code> to make sure we never miss it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-04 15:44</div>
            <div class="timeline-body"><p>@konstin could you check this resolves the issue on Linux please?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-07-04 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-04 15:44</div>
            <div class="timeline-body"><p>The need for a lightweight testing story for Python toolchain commands grows...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-04 17:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 17:00</div>
            <div class="timeline-body"><p>Why don't we have to do it on line 106?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-04 19:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 19:22</div>
            <div class="timeline-body"><p>We should. Great indication that we should enforce this elsewhere haha</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-04 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 20:07</div>
            <div class="timeline-body"><p>Lol</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-04 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 20:07</div>
            <div class="timeline-body"><p>Could they have distinct types?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-04 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 20:07</div>
            <div class="timeline-body"><p>Like <code>fill</code> returns a different type that you can only get by calling <code>fill</code>. That would have the benefit of making it impossible to miss while also giving us the flexibility to <code>fill</code> when we want (vs. coupling with the constructor).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-04 20:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:91 on 2024-07-04 20:20</div>
            <div class="timeline-body"><p>Yes that sounds reasonable but there are a weird amount of requests types to cast between already and I'd want to think a little more holistically if we add another.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-05 08:00</div>
            <div class="timeline-body"><p>Still failing for me:</p>
<pre><code>$ rm -rf ~/.local/share/uv/ ~/.cache/uv/ &amp;&amp; cargo run -q -- tool install --preview -p 3.12 --force black --python-preference only-managed
error: Failed to query Python interpreter at `/home/konsti/.local/share/uv/python/cpython-3.12.3-macos-aarch64-none/install/bin/python3`
  Caused by: Exec format error (os error 8)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-05 15:39</div>
            <div class="timeline-body"><p>@konstin that's because I didn't change it in the other place Charlie pointed out</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-05 21:04</div>
            <div class="timeline-body"><p>I'm gonna add and merge for now -- we can revisit if we wanna do something better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-07-05 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-05 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-05 21:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:48:47 UTC
    </footer>
</body>
</html>
