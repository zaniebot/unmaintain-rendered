<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignore arbitrary Python requests in version files - astral-sh/uv #12909</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ignore arbitrary Python requests in version files</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/12909">#12909</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-04-15 21:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Closes https://github.com/astral-sh/uv/issues/12605</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @zanieb on 2025-04-15 21:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "zb/pin arbitrary" to "Ignore arbitrary Python requests in version files" by @zanieb on 2025-04-15 21:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-15 21:12</div>
            <div class="timeline-body"><p>Arguably, we may want to roll this out in preview with a warning first? I don't know why anyone would rely on this behavior though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.7.0" by @zanieb on 2025-04-15 21:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-15 22:00</div>
            <div class="timeline-body"><p>The test failures look like a problem, I'll need to look into that. See https://github.com/astral-sh/uv/pull/12925</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-04-18 12:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-18 12:48</div>
            <div class="timeline-body"><p>We currently treat an empty version file as &quot;there is no Python pin&quot;? I think I'd find that surprising, but agree it could be fixed in a separate PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-18 12:50</div>
            <div class="timeline-body"><blockquote>
<p>Arguably, we may want to roll this out in preview with a warning first? I don't know why anyone would rely on this behavior though.</p>
</blockquote>
<p>I assume since this is on the <code>v0.7.0</code> milestone we're going to skip preview. In that case, looks good.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> approved on 2025-04-18 12:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-18 16:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-18 16:29</div>
            <div class="timeline-body"><p>Yeah, but... it is sort of reasonable if you want to stop discovery of a parent pin for some reason? I'm not sure what the use-case is for an empty file is. I would expect us to continue in <em>this</em> case where we declare a file invalid, e.g., so we fall back to the global config or whatever ‚Äî but I'm not sure if it's worth trying to implement? At the very least, this shouldn't be a regression because uv is completely unusable with <code>pyenv-virtualenv</code> today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-04-18 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-18 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-18 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-04-18 16:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-18 16:46</div>
            <div class="timeline-body"><p>Yeah that makes sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-18 16:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-18 16:47</div>
            <div class="timeline-body"><ul>
<li>#12972</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/edmorley">@edmorley</a> reviewed on 2025-04-19 11:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/edmorley">@edmorley</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-19 11:42</div>
            <div class="timeline-body"><blockquote>
<p>At the very least, this shouldn't be a regression because uv is completely unusable with <code>pyenv-virtualenv</code> today.</p>
</blockquote>
<p>Personally I think <code>pyenv-virtualenv</code>'s design choice to overload the <code>.python-version</code> file to point at a specific venv rather than specifying the actual Python version is an anti-pattern. It feels like the venv location should be stored somewhere else (or at the least, as a line in <code>.python-version</code> that's a code comment, alongside the actual version).</p>
<p>The problem with permitting <code>.python-version</code> files that contain something other than a version, is that for non-local workflows (eg GitHub Actions, production build systems eg on a PaaS), the <code>.python-version</code> venv path won't be valid, and they won't know what Python version to use. (In our Python buildpacks we validate the contents of <code>.python-version</code> and reject any that aren't a valid version.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-19 16:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-19 16:16</div>
            <div class="timeline-body"><blockquote>
<p>Personally I think pyenv-virtualenv's design choice to overload the .python-version file to point at a specific venv rather than specifying the actual Python version is an anti-pattern. It feels like the venv location should be stored somewhere else (or at the least, as a line in .python-version that's a code comment, alongside the actual version).</p>
</blockquote>
<p>I strongly agree.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-19 16:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-19 16:16</div>
            <div class="timeline-body"><p>It sounds like you're aligned with this change though? Since we're being stricter about <code>.python-version</code> file contents?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/edmorley">@edmorley</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-19 16:56</div>
            <div class="timeline-body"><p>Yeah - I was commenting mainly since it seemed like #12972 was considering relaxing the restrictions - though I probably should have commented there instead :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/edmorley">@edmorley</a> reviewed on 2025-04-19 16:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-19 19:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-19 19:13</div>
            <div class="timeline-body"><p>I think it's a matter of what we do when we encounter an invalid <code>.python-version</code> file. Here, we'll ignore an arbitrary name instead of treating it as an interpreter request ‚Äî but it'll still break discovery of a possibly correct <code>.python-version</code> file. In some sense, this is less strict, because now you can use uv with bad <code>.python-version</code> files, but... also you can't create them with uv and we won't respect them ü§∑‚Äç‚ôÄÔ∏è</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-19 19:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_find.rs</code>:284 on 2025-04-19 19:14</div>
            <div class="timeline-body"><p>In an ideal world, we'd probably error ‚Äî but I want to enable <code>pyenv-virtualenv</code> users to transition to uv for the rest of their workflow.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:42:48 UTC
    </footer>
</body>
</html>
