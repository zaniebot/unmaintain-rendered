<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Run the test suite on windows in CI - astral-sh/uv #1262</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Run the test suite on windows in CI</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/1262">#1262</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-02-06 22:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Run <code>cargo test</code> on windows in CI, pulling the switch on tier 1 windows support.</p>
<p>These changes make the bootstrap script virtually required for running the tests. This gives us consistency between and CI, but it also locks our tests to python-build-standalone and an articificial <code>PATH</code>.</p>
<p>I&#x27;ve deleted the shell bootstrap script in favor of only the python one, which also runs on windows. I&#x27;ve left the (sym)link creation of the bootstrap in place, even though it is not used by the tests anymore.</p>
<p>I&#x27;ve reactivated the three tests that would previously stack overflow by doubling their stack sizes. The stack overflows only happen in debug mode, so this is neither a user facing problem nor an actual problem with our code and this workaround seems better than optimizing our code for case that the (release) compiler can optimize much better for.</p>
<p>The handling of patch versions will be fixed in a follow-up PR.</p>
<p>Closes #1160
Closes #1161</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-02-06 22:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/ci.yml</code>:56 on 2024-02-06 22:40</div>
            <div class="timeline-body"><p>Fancy!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-08 02:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-interpreter/src/python_query.rs</code>:41 on 2024-02-08 02:56</div>
            <div class="timeline-body"><p>This should also support only a major version which was already wrong before this PR and gets fixed in the upstack PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-08 03:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>.github/workflows/ci.yml</code>:33 on 2024-02-08 03:05</div>
            <div class="timeline-body"><p>Do we want macos clippy or are we fine with ubuntu covering that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Run cargo test in windows CI&quot; to &quot;Run the test suite on windows in CI&quot; by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 03:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-08 03:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-interpreter/src/python_query.rs</code>:175 on 2024-02-08 03:13</div>
            <div class="timeline-body"><p>This test doesn&#x27;t work anymore in the way it was intended, so i&#x27;m removing it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-08 03:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin/tests/venv.rs</code>:218 on 2024-02-08 03:15</div>
            <div class="timeline-body"><p>This will be fixed by a follow-up upstack PR, i&#x27;m cutting scope on this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-08 03:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin/tests/common/mod.rs</code>:17 on 2024-02-08 03:18</div>
            <div class="timeline-body"><p>This function ~always errors (permission denied), the code it&#x27;s part of builds the test env for unix without bootstrapped pythons.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 03:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 03:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 03:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 03:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>.github/workflows/ci.yml</code>:56 on 2024-02-08 03:27</div>
            <div class="timeline-body"><p>Gasp</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-08 03:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 15:22</div>
            <div class="timeline-body"><p>I conjunction with merging this, do we want to switch the required checks to rustfmt, all clippy runs and all cargo test runs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-08 20:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin/tests/common/mod.rs</code>:17 on 2024-02-08 20:32</div>
            <div class="timeline-body"><p>Oh, so this is just to get it to compile?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-08 20:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin/tests/common/mod.rs</code>:17 on 2024-02-08 20:32</div>
            <div class="timeline-body"><p>But doesn&#x27;t <code>create_bin_with_executables</code> get called on Windows too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-08 20:33</div>
            <div class="timeline-body"><p>I&#x27;m cool with this, though not sure if @zanieb wants to look at the Python bootstrapping changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-02-08 20:39</div>
            <div class="timeline-body"><p>If <code>PUFFIN_PYTHON_PATH</code> is going to assume our internal structure we should rename it e.g. <code>PUFFIN_TEST_PYTHON_PATH</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 21:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-02-08 21:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-08 21:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:43:32 UTC
    </footer>
</body>
</html>
