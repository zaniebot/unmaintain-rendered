<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow setting proxy variables via global / user configuration - astral-sh/uv #16918</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow setting proxy variables via global / user configuration</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/16918">#16918</a>
        opened by <a href="https://github.com/seemethere">@seemethere</a>
        on 2025-12-01 22:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/seemethere">@seemethere</a> on 2025-12-01 22:24</div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>This allows users to set the HTTP, HTTPS, and no proxy variables via the configuration files like ~pyproject.toml~ and uv.toml.</p>
<p>Users can set like so:</p>
<p><code>uv.toml</code></p>
<pre><code class="language-toml">https-proxy = &quot;http://my_cool_proxy:10500&quot;
http-proxy = &quot;http://my_cool_proxy:10500&quot;
no-proxy = [
  &quot;dontproxyme.com&quot;,
  &quot;localhost&quot;,
]
</code></pre>
<p>Resolves https://github.com/astral-sh/uv/issues/9472</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>It also adds a new integration test for the proxy support in <code>uv-client</code>.</p>
<p>This was tested on some of our developer machines with our proxy setup using <code>~/.config/uv/uv.toml</code> with values like:</p>
<pre><code class="language-toml">https-proxy = &quot;http://my_cool_proxy:10500&quot;
http-proxy = &quot;http://my_cool_proxy:10500&quot;
no-proxy = [
  &quot;dontproxyme.com&quot;,
  &quot;localhost&quot;,
]

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-12-02 02:22</div>
            <div class="timeline-body"><p>~~@seemethere Thanks for the contribution, please see <a href="https://github.com/astral-sh/uv/blob/main/CONTRIBUTING.md#finding-ways-to-help">CONTRIBUTING.md</a> to help guide which issues are open to contributions.~~ (edit: initial discussions already happened in a separate medium)</p>
<p>For reference on this one, see https://github.com/astral-sh/uv/issues/9461#issuecomment-2509801588 which I believe will need to be addressed first before we can commit to a design for this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-02 03:32</div>
            <div class="timeline-body"><p>I think <code>uv.toml</code> support without <code>pyproject.toml</code> support feels reasonable? Without looking at the pull request in detail yet, I had a similar concern to @samypr100. We're generally avoiding system-level options in the <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-02 03:33</div>
            <div class="timeline-body"><p>Would that work for your use-case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seemethere">@seemethere</a> on 2025-12-02 05:08</div>
            <div class="timeline-body"><blockquote>
<p>Would that work for your use-case?</p>
</blockquote>
<p>Yup this still works for my use case!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seemethere">@seemethere</a> on 2025-12-02 05:09</div>
            <div class="timeline-body"><blockquote>
<p>I think <code>uv.toml</code> support without <code>pyproject.toml</code> support feels reasonable? Without looking at the pull request in detail yet, I had a similar concern to @samypr100. We're generally avoiding system-level options in the <code>pyproject.toml</code>.</p>
</blockquote>
<p>I'll fix this up to do that! Will ping when it's ready!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seemethere">@seemethere</a> on 2025-12-02 16:55</div>
            <div class="timeline-body"><p>Okay should be updated now errors should look like:</p>
<p><img width="1024" height="61" alt="Screenshot 2025-12-02 at 10 55 06‚ÄØAM" src="https://github.com/user-attachments/assets/fa15e379-2541-4fe1-ba2c-ef3f6132d850" /></p>
<pre><code>~/work/uv/scratch seemethere/add_proxy_configuration*
‚ùØ ../target/debug/uv sync
error: Failed to parse: `pyproject.toml`. The `http-proxy` field is not allowed in a `pyproject.toml` file. `http-proxy` is a system-level setting and should be placed in a `uv.toml` file instead.
</code></pre>
<p>Also added a test case to validate this in show_settings.rs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seemethere">@seemethere</a> on 2025-12-05 00:47</div>
            <div class="timeline-body"><p>Rebased this to fix the merge conflicts!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Allow setting proxy variables via configuration" to "Allow setting proxy variables via global / user configuration" by @seemethere on 2025-12-05 00:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 21:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-client/src/base_client.rs</code>:552 on 2025-12-09 21:26</div>
            <div class="timeline-body"><p>We can't panic on user-facing input here. We should validate these values much earlier and raise errors instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/reference/settings.md</code>:1334 on 2025-12-09 21:30</div>
            <div class="timeline-body"><p>It seems problematic to show these <code>pyproject.toml</code> examples in the settings reference if we're not going to allow it, we might need to invest in infrastructure to omit that before this can land.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 21:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 21:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-settings/src/lib.rs</code>:308 on 2025-12-09 21:33</div>
            <div class="timeline-body"><p>I started looking at this and I feel like we might need a <code>validate_pyproject_toml</code> function like <code>validate_uv_toml</code>? We won't hard deny any of these options in the <code>pyproject.toml</code> toda.</p>
<p>I'm surprised that we allow <code>allow_insecure_host</code> in the <code>pyproject.toml</code> today, which might mean my and @samypr100's points aren't really in scope for this work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-settings/src/lib.rs</code>:308 on 2025-12-09 21:38</div>
            <div class="timeline-body"><p>Related</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/15835</li>
<li>https://github.com/astral-sh/uv/issues/14500</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 21:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 21:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/reference/settings.md</code>:1334 on 2025-12-09 21:41</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/uv/pull/16918#discussion_r2604447761 though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-09 21:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-settings/src/lib.rs</code>:308 on 2025-12-09 21:42</div>
            <div class="timeline-body"><p>I think my understanding of what we weren't allowing today is wrong and it probably doesn't make sense to block this on fixing that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-12-10 01:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-settings/src/lib.rs</code>:308 on 2025-12-10 01:09</div>
            <div class="timeline-body"><blockquote>
<p>I'm surprised that we allow allow_insecure_host in the pyproject.toml today</p>
</blockquote>
<p>Gasp üòì</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seemethere">@seemethere</a> reviewed on 2025-12-10 04:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/seemethere">@seemethere</a> on <code>crates/uv-client/src/base_client.rs</code>:552 on 2025-12-10 04:41</div>
            <div class="timeline-body"><p>Okay! Added a ProxyUrl type to handle this, this should surface errors a lot better.</p>
<p>Errors (from user POV) should look like:</p>
<pre><code>invalid proxy URL scheme `ftp` in `ftp://proxy.example.com`: expected http, https, socks5, or socks5h
</code></pre>
<pre><code>invalid proxy URL: relative URL without a base
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seemethere">@seemethere</a> reviewed on 2025-12-10 04:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/seemethere">@seemethere</a> on <code>crates/uv-settings/src/lib.rs</code>:308 on 2025-12-10 04:42</div>
            <div class="timeline-body"><p>It's fine, I added a utility that should be able to allow us to do this, I can also submit a follow-up PR to not include the other ones (like insecure_host) as well if we want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-10 13:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-client/src/base_client.rs</code>:557 on 2025-12-10 13:21</div>
            <div class="timeline-body"><p>Can you explain why we're not using the <code>Proxy</code> type directly for validation? Why do we add a wrapper type?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/seemethere">@seemethere</a> on <code>crates/uv-client/src/base_client.rs</code>:557 on 2025-12-10 15:52</div>
            <div class="timeline-body"><p>The wrapper type includes a <code>Deserialize</code> implementation which <code>reqwest::Proxy</code> does not, as well the error messaging is a bit more informative than the generic <code>error building client: builder error</code> you might get from <code>reqwest</code>.</p>
<p>Happy to rework this though if we feel like it's overkill.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seemethere">@seemethere</a> reviewed on 2025-12-10 15:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-10 15:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-client/src/base_client.rs</code>:557 on 2025-12-10 15:54</div>
            <div class="timeline-body"><p>Why does it wrap <code>Url</code> instead of <code>Proxy</code>?</p>
<p>I'm just trying to understand the pattern here as something feels a bit off.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seemethere">@seemethere</a> reviewed on 2025-12-10 16:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/seemethere">@seemethere</a> on <code>crates/uv-client/src/base_client.rs</code>:557 on 2025-12-10 16:11</div>
            <div class="timeline-body"><p>I think it mostly comes down to Proxy being a suitable type for the runtime http client while being an unsuitable type for expressing user configuration.</p>
<p>I think in general what we're expressing with <code>http_proxy</code> and <code>https_proxy</code> are URLs that have routing rules expressed through their variable names.</p>
<p>We also get the benefits of inheriting some of the things from Url like <code>PartialEq</code>, <code>Serialize</code>, etc. which <code>Proxy</code> doesn't have.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seemethere">@seemethere</a> reviewed on 2025-12-10 16:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/seemethere">@seemethere</a> on <code>crates/uv-client/src/base_client.rs</code>:557 on 2025-12-10 16:14</div>
            <div class="timeline-body"><p>I do think that perhaps this would be something that should be upstreamed to reqwest since it might also be generally useful for other people too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-12-11 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-11 16:02</div>
            <div class="timeline-body"><p>I'm out sick today but my next step is to futz with this locally and propose some tweaks based on that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seemethere">@seemethere</a> on 2025-12-11 18:10</div>
            <div class="timeline-body"><blockquote>
<p>I'm out sick today but my next step is to futz with this locally and propose some tweaks based on that.</p>
</blockquote>
<p>Sounds good! I hope you feel better!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-06 00:05</div>
            <div class="timeline-body"><p>Alright sorry for the delay from the holiday time off :)</p>
<p>I've pushed a commit that does a few things</p>
<ol>
<li>Moves conversion into the <code>reqwest::Proxy</code> type into our wrapper <code>ProxyUrl</code> type to consolidate the safety logic</li>
<li>Adds curl / reqwest compatible <code>http://</code> scheme assumption</li>
<li>Adds CLI-level integration tests</li>
</ol>
<p>and I've resolved the conflict with <code>main</code>.</p>
<p>Please give it a look over and let me know if you have any questions or concerns.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seemethere">@seemethere</a> on 2026-01-06 16:40</div>
            <div class="timeline-body"><blockquote>
<p>Alright sorry for the delay from the holiday time off :)</p>
<p>I've pushed a commit that does a few things</p>
<ol>
<li>Moves conversion into the <code>reqwest::Proxy</code> type into our wrapper <code>ProxyUrl</code> type to consolidate the safety logic</li>
<li>Adds curl / reqwest compatible <code>http://</code> scheme assumption</li>
<li>Adds CLI-level integration tests</li>
</ol>
<p>and I've resolved the conflict with <code>main</code>.</p>
<p>Please give it a look over and let me know if you have any questions or concerns.</p>
</blockquote>
<p>LGTM!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2026-01-06 17:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2026-01-06 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2026-01-06 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2026-01-06 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-09 20:14</div>
            <div class="timeline-body"><p>This is live in v0.9.23.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:43:35 UTC
    </footer>
</body>
</html>
