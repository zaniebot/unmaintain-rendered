<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move parsing http retries to EnvironmentOptions - astral-sh/uv #16284</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Move parsing http retries to EnvironmentOptions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/16284">#16284</a>
        opened by <a href="https://github.com/andrey-berenda">@andrey-berenda</a>
        on 2025-10-13 15:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andrey-berenda">@andrey-berenda</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<ul>
<li>Move  parsing <code>UV_HTTP_RETRIES</code> to <code>EnvironmentOptions</code></li>
</ul>
<p>Relates https://github.com/astral-sh/uv/issues/14720</p>
<h2>Test Plan</h2>
<ul>
<li>Tests with existing tests</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/andrey-berenda">@andrey-berenda</a> on <code>crates/uv-client/src/base_client.rs</code>:287 on 2025-10-13 15:17</div>
            <div class="timeline-body"><p>I made this function public and use this
Just not to use DEFAULT_RETRIES</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/andrey-berenda">@andrey-berenda</a> on <code>crates/uv-settings/src/lib.rs</code>:639 on 2025-10-13 15:23</div>
            <div class="timeline-body"><p>I used 3 here
It should be the same as DEFAULT_RETRIES
I used 3 instead of DEFAULT_RETRIES because I do not want to add uv-client as deps here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andrey-berenda">@andrey-berenda</a> reviewed on 2025-10-13 15:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @andrey-berenda on 2025-10-13 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-10-20 11:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-settings/src/lib.rs</code>:639 on 2025-10-20 11:40</div>
            <div class="timeline-body"><p>There is already a transitive dependency from uv-settings to uv-client, so adding the dependency is effectively for free.</p>
<p><img width="1758" height="1691" alt="image" src="https://github.com/user-attachments/assets/1790d3a2-9c81-4089-913e-fb6ecf914f09" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2025-10-20 11:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-settings/src/lib.rs</code>:758 on 2025-10-20 11:48</div>
            <div class="timeline-body"><p>Can we show the actual error message from parsing instead of our generic one? This solves the error message regression.</p>
<p>After doing that, we shouldn't need those wrapper functions anymore, but can use e.g. <code>parse_integer_environment_variable::&lt;u32&gt;</code> directly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-10-20 11:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-10-20 11:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/network.rs</code>:354 on 2025-10-20 11:52</div>
            <div class="timeline-body"><p>This is the regression in the error message I mentioned in the other comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aberenda-optifino">@aberenda-optifino</a> reviewed on 2025-10-20 12:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aberenda-optifino">@aberenda-optifino</a> on <code>crates/uv-settings/src/lib.rs</code>:758 on 2025-10-20 12:13</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aberenda-optifino">@aberenda-optifino</a> on <code>crates/uv/tests/it/network.rs</code>:354 on 2025-10-20 12:13</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aberenda-optifino">@aberenda-optifino</a> reviewed on 2025-10-20 12:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-10-20 12:17</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aberenda-optifino">@aberenda-optifino</a> on 2025-10-20 13:02</div>
            <div class="timeline-body"><p>Could you please retry this?
https://github.com/astral-sh/uv/actions/runs/18651784234/job/53171692215?pr=16284
It seems only this is required to merge
@konstin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-20 14:41</div>
            <div class="timeline-body"><p>Our depot runner are affected by the AWS outage (https://status.depot.dev/), sorry for the disruption.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2025-10-21 09:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-10-21 09:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:45:02 UTC
    </footer>
</body>
</html>
