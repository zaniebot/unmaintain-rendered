<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `--dry-run` flag to `uv pip install` - astral-sh/uv #1436</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>--dry-run</code> flag to <code>uv pip install</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/1436">#1436</a>
        opened by <a href="https://github.com/JacobCoffee">@JacobCoffee</a>
        on 2024-02-16 05:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JacobCoffee">@JacobCoffee</a></div>
            <div class="timeline-body"><h2>What</h2>
<p>Adds a <code>--dry-run</code> flag that ejects out of the installation process early (but after resolution) and displays only what <em>would have</em> installed</p>
<h2>Closes</h2>
<p>Closes #1244</p>
<h2>Out of Scope</h2>
<p>I think it may be nice to include a <code>dry-run</code> flag for <code>uninstall</code> even though <code>pip</code> doesn't implement this... thinking <code>Would uninstall X packages: ...</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @JacobCoffee on 2024-02-16 05:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on 2024-02-16 07:17</div>
            <div class="timeline-body"><img width="545" alt="image" src="https://github.com/astral-sh/uv/assets/45884264/7c9b6837-85a2-4a10-9cf4-9404d048174d">

<pre><code>‚ûú ./target/debug/uv pip install litestar --dry-run
Resolved 22 packages in 584ms
Would install 22 packages
 - msgspec==0.18.6
 - rich-click==1.7.3
 - pyyaml==6.0.1
 - python-dateutil==2.8.2
 - httpcore==1.0.3
 - polyfactory==2.14.1
 - httpx==0.26.0
 - click==8.1.7
 - certifi==2024.2.2
 - anyio==4.2.0
 - h11==0.14.0
 - six==1.16.0
 - sniffio==1.3.0
 - rich==13.7.0
 - faker==23.2.0
 - litestar==2.6.1
 - mdurl==0.1.2
 - pygments==2.17.2
 - typing-extensions==4.9.0
 - multidict==6.0.5
 - idna==3.6
 - markdown-it-py==3.0.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on 2024-02-16 07:17</div>
            <div class="timeline-body"><p>Sorry if this is a bad way to get the version? It felt bad, anyway...
I'm not sure if we do or can store version at resolution time and use it in <code>dry_run</code>, <code>install</code>, <code>validate</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on 2024-02-16 07:41</div>
            <div class="timeline-body"><p>Might be cool to have a <code>dry-run</code> flag for uninstalling although not native to <code>pip</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JacobCoffee">@JacobCoffee</a> reviewed on 2024-02-16 07:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on <code>crates/uv/src/commands/pip_install.rs</code>:261 on 2024-02-16 07:54</div>
            <div class="timeline-body"><pre><code class="language-suggestion">                    &quot;+&quot;.blue(),
</code></pre>
<p>Not sure how this should look? <code>+</code> and <code>-</code> didn't seem to fit, though.. so I tried <code>~</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on 2024-02-16 07:59</div>
            <div class="timeline-body"><p>On the failing CI, I had some failures do to order in stdout there... but I'm wondering how we keep it consistent?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @JacobCoffee on 2024-02-16 07:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @zanieb on 2024-02-16 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-02-16 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-17 04:24</div>
            <div class="timeline-body"><p>Hey @JacobCoffee, thanks for the pull request! I think we'll actually want to implement this a bit differently e.g. by passing the dry run flag into <code>install</code></p>
<p>https://github.com/astral-sh/uv/blob/896ab1c54f4f4052555fa910d523f6899685eed2/crates/uv/src/commands/pip_install.rs#L477</p>
<p>then we can use our existing display which will also show which versions we would remove (and has a sorting implementation for deterministic output)</p>
<p>https://github.com/astral-sh/uv/blob/896ab1c54f4f4052555fa910d523f6899685eed2/crates/uv/src/commands/pip_install.rs#L642</p>
<p>We'll just need to tweak the <code>install</code> function to avoid doing any downloads, uninstalls, builds, or installs when the flag is set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @zanieb on 2024-02-17 04:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on 2024-02-20 23:25</div>
            <div class="timeline-body"><p>Does this look okay? also not 100% sure how to trigger re-downloads to test that bit.
Also, if it works out I can write the tests for it</p>
<pre><code>uv on Ôêò unst [üìùü§∑] via üêã colima via üéÅ v0.1.1 via Óàµ pyenv via ‚öôÔ∏è v1.75.0
‚ûú ./target/debug/uv pip install litestar --dry-run
Resolved 22 packages in 48ms
DRY RUN The following packages would be installed from local cache:
 ~ litestar==2.6.1

uv on Ôêò unst [üìùü§∑] via üêã colima via üéÅ v0.1.1 via Óàµ pyenv via ‚öôÔ∏è v1.75.0
‚ûú ./target/debug/uv pip install litestar --dry-run -n
Resolved 22 packages in 3.60s
DRY RUN The following packages would be downloaded:
 ~ litestar==2.6.1
</code></pre>
<img width="590" alt="image" src="https://github.com/astral-sh/uv/assets/45884264/cba82728-5ba3-47d8-b406-7dcac3b2a655">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-22 02:13</div>
            <div class="timeline-body"><p>I'll give this a try tomorrow!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-23 00:28</div>
            <div class="timeline-body"><p>Hey! I got a chance to play with this today. I'm thinking we should match our normal output much more closely.</p>
<img width="893" alt="Screenshot 2024-02-22 at 18 27 31" src="https://github.com/astral-sh/uv/assets/2586601/1f203b09-e49d-4936-8752-f11cb80ea055">

<p>I put up a commit for you to build off of at https://github.com/astral-sh/uv/pull/1890</p>
<p>We still need more test coverage i.e. install a dependency of a package first then dry run install what do we show? or install an old version then dry run install with <code>--upgrade</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on 2024-02-25 19:46</div>
            <div class="timeline-body"><p>Just for my notes, i am running into an issue where in testing it passes with 2 <code>$package==$version</code>, but in CLI usage i get 4 <code>====</code></p>
<pre><code>‚ûú ./target/debug/uv pip install litestar==2.0.0 --dry-run --strict
Resolved 17 packages in 974ms
Would download 2 packages
Would install 17 packages
 + anyio====4.3.0
 + litestar====2.0.0
 + faker====23.2.1
 + fast-query-parsers==1.0.3
</code></pre>
<p>But removing the <code>==</code> printer config from the <code>+</code>/<code>-</code> sections remove it from the testing :|</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-28 18:35</div>
            <div class="timeline-body"><p>@JacobCoffee I'm on vacation this week but let me know when this is ready for review again</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JacobCoffee">@JacobCoffee</a> on 2024-03-01 03:54</div>
            <div class="timeline-body"><p>sorry ive not wrapped this - i think my remaining issue is the 4 ====, but ive just had surgery so im down for a bit on my hard thinking üòÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-03 03:35</div>
            <div class="timeline-body"><p>I can give it a look! Get better :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-04 23:10</div>
            <div class="timeline-body"><p>The issue is that <code>InstalledVersion</code> which comes from cached distributions includes <code>==</code> already (fixed by https://github.com/astral-sh/uv/pull/1436/commits/fee46b34aafd1fe400f38fa7ed0517885e2a332b).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-03-04 23:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/pip_install.rs</code>:2306 on 2024-03-04 23:44</div>
            <div class="timeline-body"><p>Need to avoid panicking here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-06 02:19</div>
            <div class="timeline-body"><p>I think this is vaguely ready for review</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-03-06 02:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-03-06 02:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/pip_install.rs</code>:749 on 2024-03-06 02:21</div>
            <div class="timeline-body"><p>I believe this is redundant as it is handled before this function is called</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-03-06 02:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/pip_install.rs</code>:801 on 2024-03-06 02:21</div>
            <div class="timeline-body"><p>Formatting needs fix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-03-07 17:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-03-12 00:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "feat(pip-install): add `--dry-run` flag" to "Add `--dry-run` flag to `uv pip install`" by @zanieb on 2024-03-12 06:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-03-12 06:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-03-12 06:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-03-12 06:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:35:33 UTC
    </footer>
</body>
</html>
