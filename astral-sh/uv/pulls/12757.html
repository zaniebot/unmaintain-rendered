<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error when `tool.uv.sources` is set in system-level configuration file - astral-sh/uv #12757</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Error when <code>tool.uv.sources</code> is set in system-level configuration file</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/12757">#12757</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-04-08 19:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-08 19:41</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>I think the lack of enforcement here is an oversight. We <em>do</em> already enforce this for user-level configuration files (contrary to the issue -- at least, in my testing and from reading the code).</p>
<p>Closes https://github.com/astral-sh/uv/issues/12753.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @charliermarsh on 2025-04-08 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/orishamir">@orishamir</a> on 2025-04-08 20:05</div>
            <div class="timeline-body"><p>Hey, thank you so much for working on this! Your thoughtfulness and how much you care is incredible and highly appreciated
You mentioned user-level configuration is enforced, and after testing, I realized I misplaced <code>uv.toml</code> while testing user-level.
So you're correct</p>
<pre><code class="language-dockerfile">FROM python:3.12-slim-bookworm
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

WORKDIR /app

RUN uv init

COPY &lt;&lt;EOF /root/.config/uv/uv.toml
[sources]
doesntmatter = { index = &quot;doesnt_matter&quot;}
EOF

CMD [&quot;uv&quot;, &quot;sync&quot;]
</code></pre>
<p>Errors as it should</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/orishamir">@orishamir</a> on 2025-04-08 20:06</div>
            <div class="timeline-body"><p>Would you like me to edit the original issue? or add a note?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-08 20:12</div>
            <div class="timeline-body"><p>Wasn't this intentional? Since the system-level configuration could be shared by multiple uv versions we wanted to avoid validating it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-08 20:14</div>
            <div class="timeline-body"><p>I don't see commentary about it in https://github.com/astral-sh/uv/pull/7851</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-08 20:42</div>
            <div class="timeline-body"><blockquote>
<p>Wasn't this intentional? Since the system-level configuration could be shared by multiple uv versions we wanted to avoid validating it?</p>
</blockquote>
<p>Can you explain what you mean by &quot;avoid validating it&quot;? We validate it each way, it's just that at present, we don't error if you include fields that we'll ultimately ignore. (Also, is this different than user-level configuration?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-08 21:00</div>
            <div class="timeline-body"><blockquote>
<p>Also, is this different than user-level configuration?</p>
</blockquote>
<p>Yeah my understanding was we would expect a user to control their own uv config but at the system level erroring on unknown fields could be problematic since it's administered by someone else and needs broader compatibility.</p>
<p>It sounds like my understanding is wrong though, and we always error on unknown fields in settings files? I looked at <code>validate_uv_toml</code> and it just validates that we're not silently ignoring <em>known</em> fields that aren't supported in this file ‚Äî that's fine with me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-04-08 21:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2025-04-08 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-08 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-04-08 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-08 21:01</div>
            <div class="timeline-body"><p>üëç Agreed, makes sense.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:22 UTC
    </footer>
</body>
</html>
