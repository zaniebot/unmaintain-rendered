<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix detection of sorted dependencies when include-group is used - astral-sh/uv #13354</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix detection of sorted dependencies when include-group is used</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/13354">#13354</a>
        opened by <a href="https://github.com/RazerM">@RazerM</a>
        on 2025-05-08 19:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/RazerM">@RazerM</a> on 2025-05-08 19:44</div>
            <div class="timeline-body"><p>This follows on from #13334 to fix another case.</p>
<!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>If a dependency group contained any <code>{ include-group = &quot;...&quot; }</code> entries, the sort detection would bail out. The root cause of the problem was gating the sort detection behind <code>deps.iter().all(Value::is_str)</code>.</p>
<p>A public code search reveals that keeping include-groups at the top is by far the most common, but keeping them at the bottom isn't uncommon. In both of these cases, uv will now preserve the convention that is in use.</p>
<p>Unless I've missed it, I don't think uv supports <code>uv add</code>ing an include-group, and so that wasn't tested here.</p>
<h2>Test Plan</h2>
<p>cargo test</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @konstin on 2025-05-08 19:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2025-05-08 19:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2025-05-08 19:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-08 20:33</div>
            <div class="timeline-body"><p>(The failures are https://status.depot.dev)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-05-10 16:47</div>
            <div class="timeline-body"><p>This looks reasonable to me, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2025-05-10 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-05-10 18:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:24 UTC
    </footer>
</body>
</html>
