<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `--compile-bytecode` to `uv python install` and `uv python upgrade` to compile the standard library - astral-sh/uv #17088</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>--compile-bytecode</code> to <code>uv python install</code> and <code>uv python upgrade</code> to compile the standard library</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/17088">#17088</a>
        opened by <a href="https://github.com/EliteTK">@EliteTK</a>
        on 2025-12-11 16:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a></div>
            <div class="timeline-body">Summary
<p>Implement #16408.</p>
<p>Currently doesn&#x27;t avoid recompiling the bytecode when it is already compiled, which I initially thought could be fine but then realised that it would be annoying if you have the environment variable set.</p>
<p>Covers upgrades, installs, reinstalls, and compiling existing installs. But not certain about the UX.</p>
<p>pyodide is weird and currently gets skipped by the heuristic I came up with.</p>
Test Plan
<p>Styling of the status report was manually tested, there is a new test for testing the actual functionality.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-11 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-12-11 16:52</div>
            <div class="timeline-body">

<a href="https://codspeed.io/astral-sh/uv/branches/tk%2Fpy-install-bytecomp?utm_source=github&amp;utm_medium=comment&amp;utm_content=header">CodSpeed Performance Report</a>
Merging #17088 will <strong>not alter performance</strong>
<p>Comparing <code>tk/py-install-bytecomp</code> (cdf398c) with <code>main</code> (936da00)</p>
Summary
<p><code>âœ… 5</code> untouched</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cli/src/lib.rs</code>:5871 on 2025-12-11 17:13</div>
            <div class="timeline-body"><p>I&#x27;d put something other than &quot;critical&quot;, like &quot;For cases where first-start time is important&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cli/src/lib.rs</code>:5875 on 2025-12-11 17:15</div>
            <div class="timeline-body"><p>I wouldn&#x27;t compare to pip in a non-pip interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:445 on 2025-12-11 17:19</div>
            <div class="timeline-body"><p>Is there a specific reason to sort inside here, vs. ensuring we&#x27;re getting a fixed order from previous code?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:583 on 2025-12-11 17:21</div>
            <div class="timeline-body"><p>That&#x27;s elegant</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:519 on 2025-12-11 17:21</div>
            <div class="timeline-body"><p>@oconnor663 Since we talked about <code>.await</code>ing while another future is pending - you and @EliteTK both have a better understanding of this than me.</p>
<p>The tl;dr from that conversation is that if we await here, the download futures stall. I think we actually have to do the bytecode compilation inside the download stream and use a semaphore to limit the number of parallel stdlib compilations?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:1123 on 2025-12-11 17:25</div>
            <div class="timeline-body"><p>Is that for pyodide?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cli/src/lib.rs</code>:5872 on 2025-12-11 17:27</div>
            <div class="timeline-body"><p>Notably, also larger directory sizes, which is the reason why the pyc files are often not shipped by default</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-11 17:28</div>
            <div class="timeline-body"><p>Doesn&#x27;t that count change when we bump the patch version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/help.rs</code>:583 on 2025-12-11 17:32</div>
            <div class="timeline-body"><p>The option can be in the main options section, &quot;Installer options&quot; generally refers to things that control wheel installs, not Python installs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-11 17:34</div>
            <div class="timeline-body"><p>Looks good! Added some smaller comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-11 17:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:5872 on 2025-12-11 17:40</div>
            <div class="timeline-body"><p>Yeah this will also increase your Docker image size, so it&#x27;s a trade-off in that regard</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-11 17:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:6118 on 2025-12-11 17:40</div>
            <div class="timeline-body"><p>We should also document at https://docs.astral.sh/uv/guides/integration/docker/#compiling-bytecode</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-11 18:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:445 on 2025-12-11 18:37</div>
            <div class="timeline-body"><p>I wasn&#x27;t sure which would be better, was actually going to ask. Sounds like it should be sorted beforehand?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-11 18:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:583 on 2025-12-11 18:41</div>
            <div class="timeline-body"><p>Don&#x27;t give me too much credit, it was taken from another similar bit of uv code when I was looking around for a simple way to put an upper bound on concurrency.</p>
<p>I personally didn&#x27;t know buffer_unordered existed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:445 on 2025-12-11 18:48</div>
            <div class="timeline-body"><p>It may be that we&#x27;re already using a deterministic order that&#x27;s derived from the request? If we get a vec from the user input and don&#x27;t iterate over hash sets or hash maps, it should already be well ordered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-11 18:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-11 18:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:519 on 2025-12-11 18:56</div>
            <div class="timeline-body"><p>So it&#x27;s not quite like that, as in, <code>.await</code>ing one future here won&#x27;t stop the other one from progressing, it&#x27;s more that not actively <code>next().await</code>ing the BufferUnordered future will mean that the download futures won&#x27;t be progressed.</p>
<p>In practice this will mean for example that up to <code>currency.downloads</code> worth of futures will be started and progressed until the first of them is ready, at which point <code>.next().await</code> will complete. Now, none of the futures that are in that BufferUnordered will be polled until we <code>.next().await</code> again but the actual impact here isn&#x27;t obvious as while we&#x27;re not progressing the futures, the system will still keep accepting and buffering packets (until the buffers get full).</p>
<p>But yeah, since the compliation task can be quite long, there&#x27;s a good chance it would slow things down.</p>
<p>We could fix this locally by creating a future which just keeps doing <code>.next().await</code> and throwing the ready downloads into an async queue, and then a second future which just calls the compiler, and we could <code>join!</code> these. But there is the loop above which handles all the pre-existing installations for which we&#x27;ve requested compilation, and that won&#x27;t be included and currently actually stalls the downloads until it completes.</p>
<p>Instead, it might be best to add a wrapper which creates the queue, passes the write side to install(), passes the read side to a future which just reads from the queue and initiates bytecode compilation, and then join!s them (there are other options than join!). - I can write something quickly tomorrow morning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:1123 on 2025-12-11 18:58</div>
            <div class="timeline-body"><p>Yeah, but I realised we should also handle anything weird we might end up getting out of <code>--python-downloads-json-url</code>. Although I think maybe we should:</p>
<ul>
<li>Mention pyodide in the --help</li>
<li>Maybe silence the warning by default for pyodide</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-11 18:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-11 18:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-11 18:59</div>
            <div class="timeline-body"><p>Yes, maybe I&#x27;ll take some older python version for this test so it won&#x27;t change in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-11 20:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:445 on 2025-12-11 20:12</div>
            <div class="timeline-body"><p>I would have hoped so too; alas, it kept changing in the test.</p>
<p>I can look into why.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-12 12:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:445 on 2025-12-12 12:30</div>
            <div class="timeline-body"><p>Ah, I misidentified the source of the nondeterministic order. It wasn&#x27;t compiling the satisfied, it was compiling the downloads, the futures complete in an arbitrary order. Well anyway, once I add the wrapper to make the compilation happen in the background, I can just make it summarise compilation step once.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-12 12:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:519 on 2025-12-12 12:34</div>
            <div class="timeline-body"><p>I forgot to mention, the future itself won&#x27;t get progressed, but if the future does something like tokio::spawn then tokio will progress the spawned task, and while I can&#x27;t find anything like that in the path from this code until reqwest::Client::execute().await is called, I don&#x27;t know that reqwest doesn&#x27;t spawn tasks...</p>
<p>But either way, the compilation of satisfied things will block the downloading so it&#x27;s a good idea to add the wrapper I mention anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-14 21:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:1123 on 2025-12-14 21:13</div>
            <div class="timeline-body"><p>Given that we know the <code>ImplementationName</code>, we should match over the interpreter kind to determine whether to compile std or not. For <code>LenientImplementationName::Unknown</code> I&#x27;m not sure, given that there&#x27;s bunch of cases where I wouldn&#x27;t warn, e.g. with an env var or other implicit (future) ways that get std bytecode compile, only warning with an explicit <code>uv python install --bytecode-compile</code>, and that already requires doing something so custom we don&#x27;t know your Python interpreter kind, I tend to make this only a <code>warn!</code> instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-14 21:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-14 21:15</div>
            <div class="timeline-body"><p>I&#x27;d pick some marker that wouldn&#x27;t change when our python distribution changes, like a <code>.pyc</code> file for a Python module that usually doesn&#x27;t get imported (i.e. not <code>sys</code> and <code>os</code> cause our interpreter probing alone will bytecode compile it)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-12-14 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-15 15:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-15 15:29</div>
            <div class="timeline-body"><p>I thought about it, but the marker could stop working silently (as in, something may start using it for some unknown reason due to e.g. some change in the probing) and then the test would silently stop being a test. I think a total count is not necessarily the best metric, but as long as we pick a version of python which is old enough to never get any patch release again, it seems like it should be stable and unlikely to break if we change the interpreter probing or whatnot.</p>
<p>Alternatively, I could just compare the count of .py files to the count of .pyc files, or directly try to match them all up against each other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-15 15:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-15 15:48</div>
            <div class="timeline-body"><p>Comparing <code>.py</code> to <code>.pyc</code> files sounds like a great metric, it will catch if any std files fail to compile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-16 18:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:519 on 2025-12-16 18:16</div>
            <div class="timeline-body"><p>So I pushed <a href="https://github.com/astral-sh/uv/pull/17088">astral-sh/uv#17088</a>/changes/7cc9212051a3b6c656dc44a3821412a9a70caf10 which should address this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-16 18:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-16 18:20</div>
            <div class="timeline-body"><p>Although there are still the logs, or should I add a filter?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-17 11:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-17 11:21</div>
            <div class="timeline-body"><p>Whatever you think is best</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-17 14:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/tests/it/python_install.rs</code>:4004 on 2025-12-17 14:09</div>
            <div class="timeline-body"><p>I added a filter, on windows the counts are different.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-17 14:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv-cli/src/lib.rs</code>:5872 on 2025-12-17 14:15</div>
            <div class="timeline-body"><p>Should I add that to the other ones too? (the other bytecode compilation options, this was based on them)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-17 14:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:5872 on 2025-12-17 14:17</div>
            <div class="timeline-body"><p>It seems reasonable</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-17 14:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv-cli/src/lib.rs</code>:5872 on 2025-12-17 14:19</div>
            <div class="timeline-body"><p>Will do it as a separate PR so as to not add any more noise to this one though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-17 15:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:1123 on 2025-12-17 15:40</div>
            <div class="timeline-body"><p><code>warn!</code> or <code>warn_user!</code>?</p>
<p>As I understand it, <code>warn!</code> will only show up with --verbose?</p>
<p>Regarding <code>LenientImplementationName::Unknown</code> - we don&#x27;t support that for managed installs right now. Or at least we panic if we hit it. Not sure if you could trigger that with a custom <code>downloads.json</code>.</p>
<p>In any case, the heuristic I&#x27;ve come up with is: if the command (install or upgrade) was ran with explicit targets, warn for any targets which are unsupported (pyodide currently), otherwise if there were no explicit targets, don&#x27;t warn. Regardless of the env var or not.</p>
<p>There is now also always a separate warning if you pass that check but your stdlib is in a weird place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-17 16:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:1123 on 2025-12-17 16:28</div>
            <div class="timeline-body"><p>ok, sounds good!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-17 17:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv-cli/src/lib.rs</code>:6118 on 2025-12-17 17:09</div>
            <div class="timeline-body"><p>Not sure how far I should go, I just added this for now:</p>
<p>https://github.com/astral-sh/uv/blob/539cf72671e6a6f7ea34b277e90ee9e9ea704f72/docs/guides/integration/docker.md?plain=1#L337-L347</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-12-18 12:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cli/src/lib.rs</code>:6118 on 2025-12-18 12:25</div>
            <div class="timeline-body"><p>I&#x27;d add a note that we&#x27;re only compiling the standard library if it&#x27;s a managed Python interpreter, I don&#x27;t think people realize atm that this makes a perf difference and notably that <code>python:3</code> is slow in that regard (with the caveats in <a href="https://github.com/astral-sh/uv/issues/16378">astral-sh/uv#16378</a>, ignoring the whole story that we could compile system interpreter&#x27;s std, but only if we have permissions, unless the system interpreter already comes with pyc files (e.g. <code>debian</code> with <code>apt install python3</code> does, but <code>python:3</code> doesn&#x27;t), but that&#x27;s a discussion for a GitHub thread. Simply recommending PBS avoids this whole decision tree.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-12-18 12:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/guides/integration/docker.md</code>:335 on 2025-12-18 13:18</div>
            <div class="timeline-body"><p>I wonder if we should switch to recommending the <code>UV_COMPILE_BYTECODE</code> variable instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:6118 on 2025-12-18 13:19</div>
            <div class="timeline-body"><p>I think I&#x27;d say</p>
<blockquote>
<p>at the cost of increased installation time and image size</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>docs/guides/integration/docker.md</code>:335 on 2025-12-18 13:19</div>
            <div class="timeline-body"><p>It is recommended below that section, but I assume you mean swapping them around and recommending it first?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-18 13:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:6118 on 2025-12-18 13:21</div>
            <div class="timeline-body"><p>I think it makes sense to have Konsti&#x27;s recommendation in an admonition, e.g.,</p>
<pre><code>!!! note

     uv will only compile the standard library of _managed_ Python versions during
    `uv python install`. The distributor of unmanaged Python versions decides if the
    standard library is pre-compiled. For example, the official `python` image will not
    have a compiled standard library.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/python/install.rs</code>:1195 on 2025-12-18 13:24</div>
            <div class="timeline-body"><p>This could be pretty annoying if <code>UV_COMPILE_BYTECODE</code> is just set globally? I think we usually want <em>warnings</em> to be actionable, and this one isn&#x27;t really. I might just move this into verbose logs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/python/install.rs</code>:1219 on 2025-12-18 13:25</div>
            <div class="timeline-body"><p>What does it mean for it to have &quot;misreported its location&quot;? I don&#x27;t think this will make sense to a user. What action can they take to resolve this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/guides/integration/docker.md</code>:335 on 2025-12-18 13:27</div>
            <div class="timeline-body"><p>Ah sorry that&#x27;s not in the diff, one sec...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/guides/integration/docker.md</code>:335 on 2025-12-18 13:27</div>
            <div class="timeline-body"><p>eh this seems reasonable as-is, nevermind</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/python/install.rs</code>:1195 on 2025-12-18 13:40</div>
            <div class="timeline-body"><p>We could differentiate between explicit <code>--compile-bytecode</code> and implicit <code>UV_COMPILE_BYTECODE</code> as we just did for <code>UV_GIT_LFS</code>, I guess. Then the action is &quot;remove the flag&quot;, but it&#x27;s weird if you do</p>
<pre><code>uv python install cpython-3.12 pyodide-3.12 --compile-bytecode
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-18 13:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/python/install.rs</code>:1195 on 2025-12-18 13:42</div>
            <div class="timeline-body"><p>(also discussed a bit in <a href="https://github.com/astral-sh/uv/pull/17088">astral-sh/uv#17088</a>#discussion_r2627564730)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-18 13:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:1195 on 2025-12-18 13:45</div>
            <div class="timeline-body"><p>I had spoken about the warnings stuff with konsti yesterday, see the new commit, maybe that&#x27;s better?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2025-12-29 14:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:217 on 2025-12-29 14:17</div>
            <div class="timeline-body"><p>Should we propagate errors or just quietly log them and mark those installs as skipped?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-30 18:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-30 18:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2026-01-06 09:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:1219 on 2026-01-06 09:18</div>
            <div class="timeline-body"><p>Talk to us and/or the maintainer of that Python distribution to get that sysconfig fixed, otherwise it&#x27;s just silently broken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2026-01-06 09:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/python/install.rs</code>:217 on 2026-01-06 09:24</div>
            <div class="timeline-body"><p>I&#x27;d start with an error, there&#x27;s no known reason this would be valid to fail and we&#x27;re already most lenient in the compilation itself. As a user who decided to activate bytecode compilation in my deploy pipeline, I&#x27;d want a compilation failure to fail the pipeline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/EliteTK">@EliteTK</a> reviewed on 2026-01-06 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/EliteTK">@EliteTK</a> on <code>crates/uv/src/commands/python/install.rs</code>:217 on 2026-01-06 15:39</div>
            <div class="timeline-body"><p>Alright, I&#x27;ll leave it as is then.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2026-01-12 09:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/EliteTK">@EliteTK</a> on 2026-01-12 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/EliteTK">@EliteTK</a> on 2026-01-12 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-12 09:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:54:55 UTC
    </footer>
</body>
</html>
