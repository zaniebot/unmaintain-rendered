<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>virtualenv: determine 'site-packages' based on implementation name - astral-sh/uv #2094</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>virtualenv: determine &#x27;site-packages&#x27; based on implementation name</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/2094">#2094</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-02-29 20:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>I&#x27;m not at all sure whether this is a correct fix or not, but it does
seem to make <code>pypy</code> work in at least some cases with <code>uv</code>. Previously,
I couldn&#x27;t get it to work at all. Namely the virtualenv was created
with a <code>lib/python3.10/site-packages</code>, but whenever I did a <code>uv pip install</code> in that virtualenv, it was looking for a non-existent
<code>lib/pypy3.10/site-packages</code> directory.</p>
<p>With this PR, the workflow reported as not working in #1488 now works
for me:</p>
<pre><code>$ pypy3 --version
Python 3.10.13 (fc59e61cfbff, Jan 17 2024, 05:35:45)
[PyPy 7.3.15 with GCC 13.2.1 20230801]

$ uv venv --python $(which pypy3) --seed
Using Python 3.10.13 interpreter at: /usr/bin/pypy3
Creating virtualenv at: .venv
 + pip==24.0
 + setuptools==69.1.1
 + wheel==0.42.0
Activate with: source .venv/bin/activate

$ uv pip install &#x27;alembic==1.0.11&#x27;
Resolved 9 packages in 8ms
Installed 9 packages in 14ms
 + alembic==1.0.11
 + greenlet==3.0.3
 + mako==1.3.2
 + markupsafe==2.1.5
 + python-dateutil==2.8.2
 + python-editor==1.0.4
 + six==1.16.0
 + sqlalchemy==2.0.27
 + typing-extensions==4.10.0
</code></pre>
<p>Where as previously (current <code>main</code>), I was hitting this error:</p>
<pre><code>$ uv venv --python $(which pypy3) --seed
Using Python 3.10.13 interpreter at: /usr/bin/pypy3
Creating virtualenv at: .venv
 + pip==24.0
 + setuptools==69.1.1
 + wheel==0.42.0
Activate with: source .venv/bin/activate

$ uv pip install &#x27;alembic==1.0.11&#x27;
error: Failed to list installed packages
  Caused by: failed to read directory `/home/andrew/astral/issues/uv/i1488/.venv/lib/pypy3.10/site-packages`
  Caused by: No such file or directory (os error 2)
</code></pre>
<p>Notice though that neither outcome above matches the error reported in #1488,
so this is likely not a complete fix. There are perhaps other lurking
issues.</p>
<p>Ref #1488</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-29 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-29 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-interpreter/src/interpreter.rs</code>:438 on 2024-02-29 20:46</div>
            <div class="timeline-body"><p>I&#x27;d probably cut this part, it can exist in Git if we need it later!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-29 20:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 20:47</div>
            <div class="timeline-body"><p>I filed <a href="https://github.com/astral-sh/uv/issues/2095">astral-sh/uv#2095</a> with some more info on what I think a &quot;proper&quot; fix would look like.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-29 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-29 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-29 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-interpreter/src/interpreter.rs</code>:438 on 2024-02-29 20:58</div>
            <div class="timeline-body"><p>I deleted it in a separate commit so that it&#x27;s actually preserved in history (and did a rebase &amp; merge). Otherwise this would have only been preserved on GitHub maybe?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-02-29 20:58</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:44:01 UTC
    </footer>
</body>
</html>
