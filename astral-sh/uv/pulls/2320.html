<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `Seek` fallback for zip files - astral-sh/uv #2320</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>Seek</code> fallback for zip files</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/2320">#2320</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-03-10 02:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 02:26</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Some zip files can't be streamed; in particular, <code>rs-async-zip</code> doesn't support data descriptors right now (though it may in the future). This PR adds a fallback path for such zips that downloads the entire zip file to disk, then unzips it from disk (which gives us <code>Seek</code>).</p>
<p>Closes https://github.com/astral-sh/uv/issues/2216.</p>
<h2>Test Plan</h2>
<p><code>cargo run pip install --extra-index-url https://buf.build/gen/python hashb_foxglove_protocolbuffers_python==25.3.0.1.20240226043130+465630478360 --force-reinstall -n</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-03-10 02:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-03-10 02:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 02:33</div>
            <div class="timeline-body"><p>Somewhat torn on merging this. It's good behavior but it does add complexity, and <code>rs-async-zip</code> <em>might</em> add data descriptor support soon (TBD) -- see: https://github.com/Majored/rs-async-zip/issues/122.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 02:54</div>
            <div class="timeline-body"><p>Eh, ultimately, this is a good thing to do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 03:01</div>
            <div class="timeline-body"><p>All these Windows tests are randomly overflowing their stacks is confusing to me. This shouldn't have changed the stack at all?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-03-10 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-10 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-10 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-10 15:58</div>
            <div class="timeline-body"><blockquote>
<p>All these Windows tests are randomly overflowing their stacks is confusing to me. This shouldn't have changed the stack at all?</p>
</blockquote>
<p>Every local variable increases the stack frame size :sob:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 16:03</div>
            <div class="timeline-body"><p>Nooooo</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 16:04</div>
            <div class="timeline-body"><p>It must be <em>so</em> marginal</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-10 16:33</div>
            <div class="timeline-body"><p>debug is just super inefficient with stack space, this never happens on release</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:49:26 UTC
    </footer>
</body>
</html>
