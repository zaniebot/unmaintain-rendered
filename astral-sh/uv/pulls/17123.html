<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fix: add ad-hoc code signing for Python binaries on macOS - astral-sh/uv #17123</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fix: add ad-hoc code signing for Python binaries on macOS</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/17123">#17123</a>
        opened by <a href="https://github.com/majiayu000">@majiayu000</a>
        on 2025-12-13 10:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/majiayu000">@majiayu000</a> on 2025-12-13 10:22</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>On macOS Sequoia and later, binaries with the <code>com.apple.provenance</code> extended attribute may be rejected by Gatekeeper (SIGKILL) unless they are properly signed. This adds ad-hoc code signing to Python binaries after installation to ensure they can execute without issues.</p>
<h2>Changes</h2>
<ul>
<li>Added <code>adhoc_codesign()</code> function in <code>crates/uv-python/src/macos_dylib.rs</code></li>
<li>Added <code>MissingCodesign</code> and <code>CodesignError</code> error variants for better error handling</li>
<li>Added <code>ensure_codesigned()</code> method in <code>crates/uv-python/src/managed.rs</code></li>
<li>Updated <code>installation.rs</code> and <code>commands/python/install.rs</code> to call <code>ensure_codesigned()</code> after installation</li>
</ul>
<p>The fix applies <code>codesign --force -s -</code> to the Python executable after installation, which clears any cached Gatekeeper rejection and allows the binary to run.</p>
<h2>Test Plan</h2>
<ul>
<li>[x] <code>cargo test --package uv-python</code> - all 112 tests pass</li>
<li>[x] <code>cargo clippy --all</code> - no warnings</li>
<li>[x] <code>cargo fmt --check</code> - passes</li>
</ul>
<p>Fixes #16726
Fixes #16003</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-12-13 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-13 15:28</div>
            <div class="timeline-body"><p>I think we'll probably just sign these upstream when we distribute them with a proper key. It's plausible we should do this as an intermediate step though, thanks for the pull request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @majiayu000 on 2025-12-13 16:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:52:39 UTC
    </footer>
</body>
</html>
