<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coerce empty string values to `None` for `UV_PYTHON` env var - astral-sh/uv #7878</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Coerce empty string values to <code>None</code> for <code>UV_PYTHON</code> env var</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7878">#7878</a>
        opened by <a href="https://github.com/krishnan-chandra">@krishnan-chandra</a>
        on 2024-10-02 19:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/krishnan-chandra">@krishnan-chandra</a></div>
            <div class="timeline-body">Summary
<p>Closes #7841. If there are other env vars that would also benefit from this value parser, please let me know and I can add them to this PR.</p>
Test Plan
<p>When running the same example from the linked issue, it now works:</p>
<pre><code>UV_PYTHON= cargo run -- init x
   Compiling ...
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 29.06s
     Running `target/debug/uv init x`
Initialized project `x` at `/Users/krishnanchandra/Projects/uv/x`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-03 12:02</div>
            <div class="timeline-body"><p>It looks like this will error. Do we want it to error, or is it supposed to &quot;unset&quot; the env var? Do you know what other tools do?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-03 14:37</div>
            <div class="timeline-body"><p>I think we should silently ignore the variable if it&#x27;s empty, generally. I am curious what other tools do though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/krishnan-chandra">@krishnan-chandra</a> on 2024-10-03 15:52</div>
            <div class="timeline-body"><p>Good question. I don&#x27;t know what other tools do here but I think it feels reasonable to coerce empty strings to <code>None</code> rather than having them error out - I&#x27;m happy to make that change here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-03 16:03</div>
            <div class="timeline-body"><p>We have this pattern for <code>UV_INDEX_URL</code> -- we wrap it in a <code>Maybe</code> type, where it&#x27;s <code>Maybe::None</code> when empty. It has to be distinct from <code>Option</code> because Clap has special handling for Option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/krishnan-chandra">@krishnan-chandra</a> on 2024-10-03 21:27</div>
            <div class="timeline-body"><p>I implemented your suggestion re: <code>Maybe</code> - I think I did this properly but let me know if I didn&#x27;t.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Use `clap::builder::NonEmptyStringValueParser` for `UV_PYTHON` env var&quot; to &quot;Coerce empty string values to `None` for `UV_PYTHON` env var&quot; by <a href="https://github.com/krishnan-chandra">@krishnan-chandra</a> on 2024-10-03 21:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-10-04 11:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 11:32</div>
            <div class="timeline-body"><p>Thanks, that&#x27;s great!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 11:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-05 01:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:48:36 UTC
    </footer>
</body>
</html>
