<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add MACOSX_DEPLOYMENT_TARGET hint for macos platform wheels - astral-sh/uv #11783</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add MACOSX_DEPLOYMENT_TARGET hint for macos platform wheels</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/11783">#11783</a>
        opened by <a href="https://github.com/dcarrier">@dcarrier</a>
        on 2025-02-25 22:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>Addresses: https://github.com/astral-sh/uv/issues/10699</p>
<p>Adds a hint that the user may utilize <code>MACOSX_DEPLOYMENT_TARGET</code> to change the deployment target for macos platform wheels.</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<pre><code class="language-shell">uv git:(issue-10699) echo &quot;mlx&quot; | cargo run -- pip compile - -p 3.12 --python-platform=macos
  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because only the following versions of mlx are available:
          mlx==0.0.2
          mlx==0.0.3
          mlx==0.0.4
          mlx==0.0.5
          mlx==0.0.6
          mlx==0.0.7
          mlx==0.0.9
          mlx==0.0.10
          mlx==0.0.11
          mlx==0.1.0
          mlx==0.2.0
          mlx==0.3.0
          mlx==0.4.0
          mlx==0.5.1
          mlx==0.6.0
          mlx==0.7.0
          mlx==0.8.1
          mlx==0.9.1
          mlx==0.10.0
          mlx==0.11.1
          mlx==0.12.2
          mlx==0.13.0
          mlx==0.13.1
          mlx==0.14.0
          mlx==0.14.1
          mlx==0.15.0
          mlx==0.15.1
          mlx==0.15.2
          mlx==0.16.0
          mlx==0.16.1
          mlx==0.16.2
          mlx==0.16.3
          mlx==0.17.1
          mlx==0.17.2
          mlx==0.17.3
          mlx==0.18.0
          mlx==0.18.1
          mlx==0.19.0
          mlx==0.19.3
          mlx==0.20.0
          mlx==0.21.0
          mlx==0.21.1
          mlx==0.22.0
          mlx==0.22.1
          mlx==0.23.1
      and mlx&lt;=0.0.3 has no wheels with a matching Python ABI tag (e.g., `cp312`), we can conclude that mlx&lt;=0.0.3 cannot be used.
      And because mlx&gt;=0.0.4 has no wheels with a matching platform tag (e.g., `macosx_12_0_arm64`) and you require mlx, we can conclude that your requirements are unsatisfiable.

      hint: You require CPython 3.12 (`cp312`), but we only found wheels for `mlx` (v0.0.3) with the following Python ABI tags: `cp38`, `cp39`, `cp310`, `cp311`

      hint: Wheels are available for `mlx` (v0.23.1) on the following platforms: `manylinux_2_31_x86_64`, `macosx_13_0_arm64`, `macosx_14_0_arm64`

      hint: Use `MACOSX_DEPLOYMENT_TARGET` to set the deployment target on macos platform
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1667 on 2025-02-26 01:26</div>
            <div class="timeline-body"><p>nit: this can be <code>EnvVars::MACOSX_ _DEPLOYMENT_TARGET</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/j178">@j178</a> reviewed on 2025-02-26 01:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-26 03:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1660 on 2025-02-26 03:32</div>
            <div class="timeline-body"><p>Presumably this will show the hint even if you're not targeting macOS? Is that what we want? e.g., in the changed test <code>invalid_platform</code> the target is <code>linux</code>. Showing the hint there seems confusing, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-26 03:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/pip_compile.rs</code>:14795 on 2025-02-26 03:33</div>
            <div class="timeline-body"><p>I think we'll also need to explain the current deployment target. e.g., &quot;The current macOS deployment target is &lt;&gt;, set <code>...</code> to change the deployment target to a different version&quot;</p>
<p>Do we need to talk about how the deployment target is a minimum or a maximum? Can we use one of the target versions from the available wheels to show an example?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-26 03:33</div>
            <div class="timeline-body"><p>Cool! Thanks for contributing. I have a few questions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-02-26 03:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2025-02-26 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-02-26 22:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1667 on 2025-02-26 22:17</div>
            <div class="timeline-body"><p>Thank you, I will fix this one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-02-27 00:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1660 on 2025-02-27 00:10</div>
            <div class="timeline-body"><p>Great point, confusing indeed! I have been poking around this afternoon to find a way to filter on platform and passing in <code>ResolverEnvironment</code> looks promising.</p>
<p>Is this also what you had in mind?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-02-27 00:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv/tests/it/pip_compile.rs</code>:14795 on 2025-02-27 00:16</div>
            <div class="timeline-body"><p>This is good advice thank you. I have found using a <code>TargetTriple</code> instance is a good way to grab the current deployment target.</p>
<p>I will add that, talk about minimum and maximum, and utilize one of the <code>PlatformTags</code> to provide an example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-01 17:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1660 on 2025-03-01 17:52</div>
            <div class="timeline-body"><p>That sounds reasonable â€” looks like we use that in other hints too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcarrier">@dcarrier</a> on 2025-03-05 19:09</div>
            <div class="timeline-body"><p>Alright, in addition to the requested changes I made a few modifications.</p>
<p>Most notably:</p>
<ul>
<li>Made the macOS deployment target its own hint as it felt more ergonomic.</li>
<li>Modified <code>tag_hint</code> -&gt; <code>tag_hints</code> so we can return multiple <code>PubgrubHints</code> in the Platform scenario.</li>
<li>Added a snapshot test based on the linked issue.</li>
</ul>
<p>Hint now looks like this:</p>
<pre><code>hint: The current minimum macOS deployment target is 12.0, set environment variable MACOSX_DEPLOYMENT_TARGET to change the minimum deployment target (e.g. MACOSX_DEPLOYMENT_TARGET=13.0)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/target_triple.rs</code>:732 on 2025-03-05 23:37</div>
            <div class="timeline-body"><p>Why did you decide to change this call signature instead of unwrapping to something like <code>DEFAULT_MACOS_DEPLOYMENT_TARGET</code> at callsites?</p>
<p>This might be better, just curious if there was anything in particular that motivated it.</p>
<p>cc @charliermarsh as the owner of this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-05 23:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-05 23:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1701 on 2025-03-05 23:41</div>
            <div class="timeline-body"><p>Here you pull the current target from the environment which I presume motivates the change in https://github.com/astral-sh/uv/pull/11783/files#r1982335893 but shouldn't we be pulling this value from the failing resolution's platform target triple instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-05 23:42</div>
            <div class="timeline-body"><p>Thank you for following up on my feedback!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-05 23:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/pip_compile.rs</code>:14825 on 2025-03-05 23:43</div>
            <div class="timeline-body"><p>I still find it a bit surprising these are separate hints, as the latter is only relevant if the first is shown, correct? Can you say a bit more about why you found separate hints more ergonomic?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-05 23:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1701 on 2025-03-05 23:45</div>
            <div class="timeline-body"><p>(I'm not entirely sure this matters in practice, because the only way the deployment target can be set is via environment variable right now? But I think it could be an easy cause of a future bug)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-05 23:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-configuration/src/target_triple.rs</code>:732 on 2025-03-05 23:45</div>
            <div class="timeline-body"><p>(Noticed this was related to https://github.com/astral-sh/uv/pull/11783#discussion_r1982338343)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-03-06 00:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv/tests/it/pip_compile.rs</code>:14825 on 2025-03-06 00:07</div>
            <div class="timeline-body"><p>Yep you are correct, the macOS deployment target hint is dependent on the platform hint. I did mess around with breaking out the logic of the macOS deployment target into a separate function instead of a new PubgrubHint variant, but it didn't feel as clean in the codebase as following the variant pattern in the fmt function. It also feels nice to compose the hints at the <code>tag_hints</code> level.</p>
<p>Happy to switch it up if necessary!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-03-06 00:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv-configuration/src/target_triple.rs</code>:732 on 2025-03-06 00:14</div>
            <div class="timeline-body"><p>I liked centralizing the logic and moving the default version unwrap out of the platform constructor. It had the added benefit that it assisted with https://github.com/astral-sh/uv/pull/11783#discussion_r1982338343 as you pointed out ðŸ˜„.</p>
<p>Your suggestion is clean and would work the same. I would just change to <code>DEFAULT_MACOS_DEPLOYMENT_TARGET</code> in <code>platform()</code> unwrap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-03-06 00:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1701 on 2025-03-06 00:57</div>
            <div class="timeline-body"><p>As far as I know the environment variable is the only way to control the deployment target, correct.</p>
<p>If you donâ€™t mind, I may need some advice on the best path forward. The major / minor fields in the platform object are not included in the resolution marker env object and the originally constructed target triple is only used to create the marker.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-06 04:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1701 on 2025-03-06 04:31</div>
            <div class="timeline-body"><p>I see â€” yeah I wasn't sure if it was necessarily easy to get at. I can take a look. Charlie may also have an idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-03-06 16:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1701 on 2025-03-06 16:39</div>
            <div class="timeline-body"><p>I think what you want to do is... Iterate over <code>self.tags</code>, and find the minimum macOS major-minor on any platform tag. Then use <em>that</em> as the inferred deployment target.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-03-06 16:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-configuration/src/target_triple.rs</code>:732 on 2025-03-06 16:39</div>
            <div class="timeline-body"><p>I would probably keep this as-is and unwrap at each site. I think each site should be &quot;forced&quot; to consider the value it uses here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-03-06 16:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/pip_compile.rs</code>:14825 on 2025-03-06 16:40</div>
            <div class="timeline-body"><p>I don't know that this hint actually works today... Has anyone tried it? I think we only look at <code>MACOSX_DEPLOYMENT_TARGET</code> when <code>--python-platform</code> is specified. I wouldn't expect it to have any affect on <code>uv lock</code>, for example. We might need to change our tag inference logic to respect it first. (I could be wrong.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-03-06 16:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/pip_compile.rs</code>:14825 on 2025-03-06 16:46</div>
            <div class="timeline-body"><p>I haven't tried it, no. Interesting.</p>
<p>@dcarrier don't worry about looking into that (unless you're interested), we can explore it separately from this change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-03-07 20:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:1701 on 2025-03-07 20:04</div>
            <div class="timeline-body"><p>Thanks Charlie! I was looking into iterating over <code>self.tags</code> with one caveat: Should we actually find the max to infer the macosx deployment target?</p>
<p>It looks like we use the <code>major</code> field of Os as the top end to generate the list of platform_tag versions for anything &gt;= 11. (ex: https://github.com/astral-sh/uv/blob/main/crates/uv-platform-tags/src/tags.rs#L497)</p>
<p>This feels counterintuitive to me because MACOSX_DEPLOYMENT_TARGET specifies the minimum to be supported, but for the purposes of the hint it would make the most sense as feedback to the user.</p>
<p>Btw thanks to you and Zanie for the feedback, I feel like I am making this complicated but I want to be sure I understand what I am changing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dcarrier">@dcarrier</a> reviewed on 2025-03-07 20:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/dcarrier">@dcarrier</a> on <code>crates/uv-configuration/src/target_triple.rs</code>:732 on 2025-03-07 20:06</div>
            <div class="timeline-body"><p>Ack, I will revert these changes in favor of the call site unwrap. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-27 16:31</div>
            <div class="timeline-body"><p>Are you interested in continuing this work? Otherwise, we can try to find someone to pick it up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcarrier">@dcarrier</a> on 2025-05-28 18:36</div>
            <div class="timeline-body"><blockquote>
<p>Are you interested in continuing this work? Otherwise, we can try to find someone to pick it up.</p>
</blockquote>
<p>Hey @zanieb, thanks for checking in. Unfortunately I no longer have the cycles to work on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TaKO8Ki">@TaKO8Ki</a> on 2025-11-28 18:54</div>
            <div class="timeline-body"><p>Hi, @zanieb. I have created a pull request for taking over this pr. Could you review it when you have time? https://github.com/astral-sh/uv/pull/16553</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:42:11 UTC
    </footer>
</body>
</html>
