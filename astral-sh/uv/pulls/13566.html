<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix version json tests to work outside git checkout - astral-sh/uv #13566</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix version json tests to work outside git checkout</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/13566">#13566</a>
        opened by <a href="https://github.com/mgorny">@mgorny</a>
        on 2025-05-21 07:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/mgorny">@mgorny</a> on 2025-05-21 07:43</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fix the two version json tests to account for the possibility that uv was built outside a git checkout (e.g. from an unpacked git archive) and therefore does not have the commit info available.  This approach uses separate snapshots for the two cases, as suggested in discussion of pull request #13251.</p>
<p>Fixes #13212</p>
<h2>Test Plan</h2>
<ol>
<li><code>cargo test</code> in a git clone.</li>
<li><code>cargo clean</code>, moved <code>.git</code> away, <code>cargo test</code> again.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Gankra by @konstin on 2025-05-21 09:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Gankra by @konstin on 2025-05-21 09:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv/build.rs</code>:23 on 2025-05-21 17:13</div>
            <div class="timeline-body"><p>Doing this in a build.rs seems like an extremely heavy hammer that might mess up build caching -- can we just do this .git check in the tests themselves?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-05-21 17:15</div>
            <div class="timeline-body"><p>Oh geez, apologies, finishing this work slipped through the cracks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mgorny">@mgorny</a> reviewed on 2025-05-21 19:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mgorny">@mgorny</a> on <code>crates/uv/build.rs</code>:23 on 2025-05-21 19:07</div>
            <div class="timeline-body"><p>I suppose so, but I have no clue how to get the right path :-). I should probably mention I don't really know Cargo/Rust, and I'm just bashing things randomly until they work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv/build.rs</code>:23 on 2025-05-21 19:25</div>
            <div class="timeline-body"><p>Ah ok no prob, I'll take a quick crack at it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-05-21 19:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mgorny">@mgorny</a> reviewed on 2025-05-21 19:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mgorny">@mgorny</a> on <code>crates/uv/build.rs</code>:23 on 2025-05-21 19:46</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @Gankra on 2025-05-21 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Gankra on 2025-05-21 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @Gankra on 2025-05-21 19:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:24 UTC
    </footer>
</body>
</html>
