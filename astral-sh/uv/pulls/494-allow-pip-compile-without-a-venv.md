```yaml
number: 494
title: "Allow `pip-compile` without a venv"
type: pull_request
state: merged
author: konstin
labels:
  - enhancement
assignees: []
merged: true
base: main
head: pip-resolve-without-a-venv
created_at: 2023-11-23T10:02:32Z
updated_at: 2024-01-05T15:01:07Z
url: https://github.com/astral-sh/uv/pull/494
synced_at: 2026-01-10T15:44:44Z
```

# Allow `pip-compile` without a venv

---

_Pull request opened by @konstin on 2023-11-23 10:02_

The semantics are a bit unintuitive because `--python-version` is a preference when looking for a python version without a venv, but if we don't find that exact version we'll take `python3` and patch the markers. This will make more sense once we start provisioning python builds.

We can now resolve black with both python 3.8 and 3.12, with or without that python version being in scope. In the example below, `PATH=$HOME/.cargo/bin:/usr/bin` removes the pyenv builds and leaves only `python3`, which is python 3.11. 

```console
$ RUST_LOG=puffin::commands=debug cargo run --bin puffin -q -- pip-compile -v scripts/benchmarks/requirements/black.in --python-version py38
    0.004108s DEBUG puffin::commands::pip_compile Using Python 3.8 at /home/konsti/.local/bin/python3.8
Resolved 8 packages in 44ms
# This file was autogenerated by Puffin v0.0.1 via the following command:
#    puffin pip-compile -v scripts/benchmarks/requirements/black.in --python-version py38
black==23.11.0
[...]
platformdirs==4.0.0
    # via black
tomli==2.0.1
    # via black
typing-extensions==4.8.0
    # via black
$ PATH=$HOME/.cargo/bin:/usr/bin RUST_LOG=puffin::commands=debug cargo run --bin puffin -q -- pip-compile -v scripts/benchmarks/requirements/black.in --python-version py38
    0.004315s DEBUG puffin::commands::pip_compile Using Python 3.11 at /usr/bin/python3
Resolved 8 packages in 43ms
# This file was autogenerated by Puffin v0.0.1 via the following command:
#    puffin pip-compile -v scripts/benchmarks/requirements/black.in --python-version py38
black==23.11.0
[...]
platformdirs==4.0.0
    # via black
tomli==2.0.1
    # via black
typing-extensions==4.8.0
    # via black
```

```console
$ RUST_LOG=puffin::commands=debug cargo run --bin puffin -q -- pip-compile -v scripts/benchmarks/requirements/black.in --python-version py312
    0.004216s DEBUG puffin::commands::pip_compile Using Python 3.12 at /home/konsti/.local/bin/python3.12
Resolved 6 packages in 37ms
# This file was autogenerated by Puffin v0.0.1 via the following command:
#    puffin pip-compile -v scripts/benchmarks/requirements/black.in --python-version py312
black==23.11.0
[...]
platformdirs==4.0.0
    # via black
$ PATH=$HOME/.cargo/bin:/usr/bin RUST_LOG=puffin::commands=debug cargo run --bin puffin -q -- pip-compile -v scripts/benchmarks/requirements/black.in --python-version py312
    0.004190s DEBUG puffin::commands::pip_compile Using Python 3.11 at /usr/bin/python3
Resolved 6 packages in 39ms
# This file was autogenerated by Puffin v0.0.1 via the following command:
#    puffin pip-compile -v scripts/benchmarks/requirements/black.in --python-version py312
black==23.11.0
[...]
platformdirs==4.0.0
    # via black
```

Fixes #235.


---

_Label `enhancement` added by @konstin on 2023-11-23 10:02_

---

_Review requested from @charliermarsh by @konstin on 2023-11-23 10:02_

---

_Comment by @charliermarsh on 2023-11-24 15:30_

What happens if you're in a project with a `.venv` folder, but it isn't activated?

---

_Comment by @charliermarsh on 2023-11-24 15:30_

I'm trying to decide if I think this should work / be allowed, vs. requiring virtualenvs.

---

_Comment by @konstin on 2023-11-24 15:34_

We prefer a .venv folder over the global python installation.


I think our solution is only a compromise as long as we don't provision python builds like rye or monotrail do, so i tried not to perfect the current `--python-version` if we'll get a better solution later.

---

_Comment by @charliermarsh on 2024-01-04 04:36_

I'll review and merge this.

---

_Comment by @charliermarsh on 2024-01-05 14:44_

I am rebasing.

---

_@charliermarsh approved on 2024-01-05 14:55_

---

_Merged by @charliermarsh on 2024-01-05 15:01_

---

_Closed by @charliermarsh on 2024-01-05 15:01_

---

_Branch deleted on 2024-01-05 15:01_

---
