<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use mac version from python for linehaul information - astral-sh/uv #2509</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use mac version from python for linehaul information</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/2509">#2509</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-03-18 13:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/uv/pull/2493#pullrequestreview-1942899151.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2024-03-18 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-03-18 13:43</div>
            <div class="timeline-body"><p>Note, it's not quite just major.minor, it should include the product version from the plist as-is based on my testing with pip. os_info got this right, hence why I used it for testing üòÖ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-18 13:59</div>
            <div class="timeline-body"><p>Oh interesting, i'd need some mac user to test this then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2024-03-18 14:02</div>
            <div class="timeline-body"><p>ü§î</p>
<pre><code>Œª ~ :: python -q
&gt;&gt;&gt; import platform
&gt;&gt;&gt; platform.mac_ver()[0]
'14.4'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-03-18 14:04</div>
            <div class="timeline-body"><p>@trag1c platform.mac version can include more. You're in 14.4 which got released, so its only major.minor (currently) Once 14.4.1 gets released you'll get 14.4.1.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2024-03-18 14:06</div>
            <div class="timeline-body"><p>Yeah I'm aware (I just recently updated from 14.2.1, what a shame üò¢), but I thought you were referring to even more data than just <code>major.minor[.patch]</code> üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-03-18 14:12</div>
            <div class="timeline-body"><p>@konstin If we want to use python and be compatible, we should just use the raw output of platform.mac_ver()[0]. That should take care of the test failing right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trag1c">@trag1c</a> on 2024-03-18 14:17</div>
            <div class="timeline-body"><blockquote>
<p>Yeah I'm aware (I just recently updated from 14.2.1, what a shame üò¢), but I thought you were referring to even more data than just <code>major.minor[.patch]</code> üëç</p>
</blockquote>
<p>I'm guessing beta releases could be different ü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-18 14:32</div>
            <div class="timeline-body"><blockquote>
<p>If we want to use python and be compatible, we should just use the raw output of platform.mac_ver()[0]. That should take care of the test failing right now.</p>
</blockquote>
<p>Sounds good, though it needs a mac user as reviewer</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-18 14:36</div>
            <div class="timeline-body"><p>What do you want me to test?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-18 14:47</div>
            <div class="timeline-body"><p>As @samypr100 said, we should pass <code>platform.mac_ver()[0]</code> verbatim next to the parsed major/minor and use it in the linehaul information, but i don't have reference devices for <code>platform.mac_ver()[0]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-18 14:52</div>
            <div class="timeline-body"><p>I get</p>
<pre><code>‚ùØ python3.12 -c &quot;import platform; print(platform.mac_ver())&quot;
('14.0', ('', '', ''), 'arm64')
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-03-18 15:07</div>
            <div class="timeline-body"><p>Here's what I get on an 14.3.1 mac</p>
<pre><code>&gt;  python -c 'import platform; print(platform.mac_ver())'
 ('14.3.1', ('', '', ''), 'arm64')
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-18 17:41</div>
            <div class="timeline-body"><p>Let's just send <code>platform.mac_ver()[0]</code> for now and address problems if they come up?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-03-18 23:01</div>
            <div class="timeline-body"><p>Agreed, that's exactly what Pip does too https://github.com/pypa/pip/blob/24.0/src/pip/_internal/network/session.py#L159</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-18 23:40</div>
            <div class="timeline-body"><p>I guess this isn't trivial because we're not currently storing patch versions on <code>Platform</code>. We'd need to add <code>patch: Option&lt;u16&gt;</code> at https://github.com/astral-sh/uv/blob/c296da34bffd19d41b895bd5aa06e78d79c71bd4/crates/platform-tags/src/platform.rs#L46 and populate the value at in our retrieval script at https://github.com/astral-sh/uv/blob/ecc46c5412128df8c01409481f6f8a4b63d855d1/crates/uv-interpreter/python/get_interpreter_info.py#L473</p>
<p>I'm not sure linehaul information justifies further changes here... patch macOS versions are not used afaik. We generate platform tags based on a major minor tuple (which is why we don't bother storing the optional patch version now).</p>
<p>I think we should consider documenting this caveat and moving on?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-03-19 00:04</div>
            <div class="timeline-body"><p>@zanieb the code currently behaves as expected per #2493 and it's fully compatible with linehaul. No more changes are technically needed.
I believe this PR was to see if we could remove <code>mac_version.rs</code> introduced in #2493 and leverage the python value of <code>platform.mac_ver()[0]</code> instead (assuming it was already there retrieved in a compatible way) per question in https://github.com/astral-sh/uv/pull/2493#discussion_r1528491592.</p>
<p>Since it seems its not, I'd proposed we don't merge this change at this time to avoid sending invalid linehaul statistics which could be undesired.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-19 01:09</div>
            <div class="timeline-body"><p>I'd prefer to use all the information we're already getting from Python (as we do here). I feel like we should see if the patch version is actually important to them. It seems weird that they'd have e.g. <code>14.4</code> imply <code>14.4.0</code> in their statistics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-03-19 01:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-03-19 01:38</div>
            <div class="timeline-body"><p>Fair, I don't think their parser cares and will use the value as-is, so I think it should be ok from a parser perspective.</p>
<p>My original concern was more that it could inflate statistics a bit biased towards versions without <code>patch</code>.</p>
<p>For example, say you have a 100 users using pip and uv where 50 of them have OSX version <code>14.3</code> and 50 have OSX version <code>14.3.1</code>. The download stats would capture this subtle difference with pip where as with uv it would show 100 users on 14.3.</p>
<p>For what it's worth, they do test with osx patch versions https://github.com/pypi/linehaul-cloud-function/blob/main/tests/unit/ua/fixtures/pip.yml.</p>
<p>Worth asking @pradyunsg, as the original issue creator, does having the patch version matter in OSX in distro?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2024-03-19 14:22</div>
            <div class="timeline-body"><p>I think it's OK to not have the patch version, but I'm also not a MacOS expert.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-20 01:04</div>
            <div class="timeline-body"><p>I hope you don't mind I pushed https://github.com/astral-sh/uv/pull/2509/commits/637a9cee7643dfde27de520fa019a596fd5d4a7f in an attempt to resolve the error you were encountering.</p>
<p>We really ought to use snapshots for these lineinfo tests though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-20 09:55</div>
            <div class="timeline-body"><p>Thanks</p>
<p>I'm merging it now with the <code>&lt;major&gt;.&lt;minor&gt;</code> formatting for mac, it's easy enough to change later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-03-20 09:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-03-20 09:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-20 09:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:36:08 UTC
    </footer>
</body>
</html>
