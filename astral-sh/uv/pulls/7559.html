<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heal cache entries with missing source distributions - astral-sh/uv #7559</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Heal cache entries with missing source distributions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7559">#7559</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-09-19 19:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p><code>uv cache prune --ci</code> will remove the source distribution directory. If we then need to build a <em>different</em> wheel (e.g., you're building a package that has Python minor version-specific wheels), we fail, because we expect the source to be there.</p>
<p>Now, if the source is missing, we re-download it. It would be slightly easier to just <em>ignore</em> that revision, but that would mean we'd also lose the already-built wheels -- so if you ran against many Python versions, we'd continuously lose the cached data.</p>
<p>Closes https://github.com/astral-sh/uv/issues/7543.</p>
<h2>Test Plan</h2>
<p>We can add tests, but they <em>need</em> to build non-pure Python wheels, which tends to be expensive...</p>
<p>For reference:</p>
<pre><code class="language-console">$ cargo run venv --python 3.12
$ cargo run pip install mercurial==6.8.1 --verbose
$ cargo run cache prune --ci
$ cargo run venv --python 3.11
$ cargo run pip install mercurial==6.8.1 --verbose
</code></pre>
<p>I also did this with a local <code>.tar.gz</code> that I downloaded from PyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-09-19 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cache</span> added by @charliermarsh on 2024-09-19 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-09-19 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @charliermarsh on 2024-09-19 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @charliermarsh on 2024-09-19 19:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-09-19 19:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-19 19:42</div>
            <div class="timeline-body"><p>Ahh sorry, that test failure is correct. This isn't quite right.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-19 19:42</div>
            <div class="timeline-body"><p>Uh oh!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2024-09-19 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-19 20:15</div>
            <div class="timeline-body"><p>Ok, a bit more invasive but better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-09-19 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-19 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-19 20:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:39:41 UTC
    </footer>
</body>
</html>
