<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parses wheels WHEEL and METADATA files content as email messages - astral-sh/uv #6616</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Parses wheels WHEEL and METADATA files content as email messages</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6616">#6616</a>
        opened by <a href="https://github.com/Coruscant11">@Coruscant11</a>
        on 2024-08-25 19:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Coruscant11">@Coruscant11</a></div>
            <div class="timeline-body">

Summary
<p>Fixes: #6615
Currently, some packages are not installable with <code>uv</code>, like <code>ziglang</code> on Linux.
Everything is described in the issue! ðŸ˜„</p>


Test Plan


<p>I added a unit test for the problematic use case.
I also checked that previous unit test are still running in order to ensure the backward compatibility.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Parses wheel metadata files content as email header&quot; to &quot;Parses wheel WHEEL and METADATA files content as email message&quot; by <a href="https://github.com/Coruscant11">@Coruscant11</a> on 2024-08-25 19:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Parses wheel WHEEL and METADATA files content as email message&quot; to &quot;Parses wheels WHEEL and METADATA files content as email message&quot; by <a href="https://github.com/Coruscant11">@Coruscant11</a> on 2024-08-25 19:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Parses wheels WHEEL and METADATA files content as email message&quot; to &quot;Parses wheels WHEEL and METADATA files content as email messages&quot; by <a href="https://github.com/Coruscant11">@Coruscant11</a> on 2024-08-25 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:08</div>
            <div class="timeline-body"><p>Thanks for investigating this. It seems like a reasonable change to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:10</div>
            <div class="timeline-body"><p>Is it possible to use <code>mailparse</code> instead? Or change our uses of <code>mailparse</code> to use <code>mail-parser</code>? We already have this dependency elsewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Coruscant11">@Coruscant11</a> on 2024-08-25 20:11</div>
            <div class="timeline-body"><blockquote>
<p>Is it possible to use <code>mailparse</code> instead? Or change our uses of <code>mailparse</code> to use <code>mail-parser</code>? We already have this dependency elsewhere.</p>
</blockquote>
<p>Of course! Let me fix this quickly ðŸ˜„
Thanks for the fast review!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:12</div>
            <div class="timeline-body"><p>(It might be easiest to use <code>mailparse</code> to start, and then consider migrating to <code>mail-parser</code> in a separate PR. I honestly can&#x27;t remember why we use <code>mailparse</code> -- I think it&#x27;s just a smaller dependency -- but I&#x27;m open to switching. Take a look at <code>crates/pypi-types/src/metadata.rs</code> for an example of how we use it today... I think it&#x27;s the same problem, roughly?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Coruscant11">@Coruscant11</a> on 2024-08-25 20:25</div>
            <div class="timeline-body"><blockquote>
<p>(It might be easiest to use <code>mailparse</code> to start, and then consider migrating to <code>mail-parser</code> in a separate PR. I honestly can&#x27;t remember why we use <code>mailparse</code> -- I think it&#x27;s just a smaller dependency -- but I&#x27;m open to switching. Take a look at <code>crates/pypi-types/src/metadata.rs</code> for an example of how we use it today... I think it&#x27;s the same problem, roughly?)</p>
</blockquote>
<p>Alright! I volunteer to look into switching from <code>mailparse</code> to <code>mail-parser</code> in a future PR if you want!
But I will also look if a change is really needed in a first place, <code>mailparse</code> seems much more downloaded ðŸ˜„
But maybe <code>mail-parser</code> is faster, and seems to be heavily tested and benchmarked.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:35</div>
            <div class="timeline-body"><p>It might be fun to run a small benchmark (see, e.g., <code>crates/bench/benches/distribution_filename.rs</code>) to compare the two on some representative files :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Coruscant11">@Coruscant11</a> on 2024-08-25 20:39</div>
            <div class="timeline-body"><blockquote>
<p>It might be fun to run a small benchmark (see, e.g., <code>crates/bench/benches/distribution_filename.rs</code>) to compare the two on some representative files :)</p>
</blockquote>
<p>Thank for the link! Will use that.
I will also try to benchmark the two crates in different machines, I have x86_64 and arm64 computers, Intel, AMD, M3 Pro... can be fun!</p>
<p>If I could just trust the running time of the unit test inside <code>install-wheel-rs</code>, <code>mail-parser</code> seems around 0.008 seconds faster ðŸ˜†
Will try to check this more in details in a next PR then ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:46</div>
            <div class="timeline-body"><p>Thanks, this is much appreciated!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/install-wheel-rs/Cargo.toml</code>:36 on 2024-08-25 20:49</div>
            <div class="timeline-body"><pre><code>mailparse = { workspace = true }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-08-25 20:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-08-25 20:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 20:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/install-wheel-rs/src/wheel.rs</code>:819 on 2024-08-25 20:51</div>
            <div class="timeline-body"><p>I thought we could maybe avoid these trims now that we&#x27;re using <code>mailparse</code> but looks like whitespace is retained for the keys at least. We could probably avoid <em>allocating</em> here though if there isn&#x27;t leading / trailing whitespace. Micro-opt for the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Coruscant11">@Coruscant11</a> reviewed on 2024-08-25 20:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Coruscant11">@Coruscant11</a> on <code>crates/install-wheel-rs/src/wheel.rs</code>:819 on 2024-08-25 20:53</div>
            <div class="timeline-body"><p>Yes, the name trim can be avoided. I will update this ðŸ™‚
Should we keep it for the values?
I would say it would prevent badly formatted values like we say in the ziglang package</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Coruscant11">@Coruscant11</a> on <code>crates/install-wheel-rs/src/wheel.rs</code>:819 on 2024-08-25 20:54</div>
            <div class="timeline-body"><p>By the way, contrary to <code>mail-parser</code>, the <code>get_key()</code> function is returning a String -&gt; useless <code>to_string()</code> below</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Coruscant11">@Coruscant11</a> reviewed on 2024-08-25 20:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/install-wheel-rs/src/wheel.rs</code>:819 on 2024-08-25 20:58</div>
            <div class="timeline-body"><p>I think we should keep the trim functionality, but we can maybe avoid the extra <code>to_string</code> if there&#x27;s nothing to trim.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 20:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-25 20:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/install-wheel-rs/src/wheel.rs</code>:819 on 2024-08-25 20:59</div>
            <div class="timeline-body"><p>In other words: lets keep <code>trim</code> for both. But we <em>could</em> skip <code>.to_string</code> if <code>name == name.trim()</code>, to avoid the allocation. But maybe more trouble than it&#x27;s worth, I defer to you :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Coruscant11">@Coruscant11</a> reviewed on 2024-08-25 20:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Coruscant11">@Coruscant11</a> on <code>crates/install-wheel-rs/Cargo.toml</code>:36 on 2024-08-25 20:59</div>
            <div class="timeline-body"><p>Thanks @konstin !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Coruscant11">@Coruscant11</a> reviewed on 2024-08-25 21:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Coruscant11">@Coruscant11</a> on <code>crates/install-wheel-rs/src/wheel.rs</code>:819 on 2024-08-25 21:07</div>
            <div class="timeline-body"><p>Updated! Do you think I should extract the trim logic to an other function?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-08-25 22:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 22:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 22:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 22:31</div>
            <div class="timeline-body"><p>Looks good, thanks!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:47:47 UTC
    </footer>
</body>
</html>
