<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chore(ci): address lint findings in build-docker.yml - astral-sh/uv #15245</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>chore(ci): address lint findings in build-docker.yml</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/15245">#15245</a>
        opened by <a href="https://github.com/woodruffw">@woodruffw</a>
        on 2025-08-12 18:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a></div>
            <div class="timeline-body">Summary
<p>This re-creates #15145, with fixes following the revert in #15174.</p>
<p>The overall approach is the same, except that I&#x27;ve added an explicit permissions block to <code>docker-annotate-base</code> that should cover the needed permissions in that job.</p>
<p>(One confusion is around how that wasn&#x27;t failing before -- FWICT it was receiving the default <code>GITHUB_TOKEN</code>, which doesn&#x27;t include <code>id-token: write</code> or <code>packages: write</code>. So it <em>should</em> have been failing even before I explicitly did <code>permissions: {}</code>...)</p>
<p>Edit: Oh, I see why -- the actual release process does a <code>workflow_call</code>, so this inherits its <code>GITHUB_TOKEN</code> from <code>release.yml:custom-build-docker</code>, which in turn has the right permissions granted to it.</p>
Test Plan
<p>See what happens in CI. Plus maybe we could do a release dry-run?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-08-12 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/woodruffw">@woodruffw</a> by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-08-12 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-08-12 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-12 18:13</div>
            <div class="timeline-body"><p>Just fyi we don&#x27;t really have a release dry-run option here. We&#x27;ll run the Docker builds in the pull request, but we can&#x27;t test annotating publishes without publishing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-08-12 18:41</div>
            <div class="timeline-body"><blockquote>
<p>Just fyi we don&#x27;t really have a release dry-run option here. We&#x27;ll run the Docker builds in the pull request, but we can&#x27;t test annotating publishes without publishing.</p>
</blockquote>
<p>Gotcha, OK -- in that case I don&#x27;t have a great way to test my reusable workflow permissions theory ðŸ˜…. However, I cross-checked that the permissions are consistent here:</p>
<p>https://github.com/astral-sh/uv/blob/959c9521c8ef38d7409e6b34aa4a42097b670b6a/.github/workflows/release.yml#L112-L116</p>
<p>So I <em>think</em> this is good to go.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-08-12 18:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-12 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-12 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-12 18:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:53:33 UTC
    </footer>
</body>
</html>
