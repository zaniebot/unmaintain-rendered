<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pep508: add MarkerTree::negate - astral-sh/uv #4996</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pep508: add MarkerTree::negate</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4996">#4996</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-07-11 18:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>This does pretty much what you might expect: it takes an existing
<code>MarkerTree</code> and returns a new one that evaluates to the opposite of the
marker given for all possible marker environments. For the most part.</p>
<p>There are two main hitches here.</p>
<p>The first is that some <code>MarkerTree</code> values are nonsense. For example,
<code>&quot;foo&quot; == &quot;bar&quot;</code> and <code>sys_platform ~= &quot;linux&quot;</code>. Both such expressions
always return false today. Technically, a logical negation would imply
that they would always return true in the result. But this would imply
that negation turns nonsense into sense. We shouldn't do that. So the
negation of nonsense remains nonsense.</p>
<p>The second is that negating compatible version constraints like
<code>python_version ~= &quot;3.6&quot;</code> cannot be done in a single marker expression.
Instead, the negation is itself a disjunction of negations. In this
case, <code>python_version &lt; 3.6 or python_version != 3.6.*</code>.</p>
<p>I've added some basic tests to cover this new operation.</p>
<p>The main motivation for adding a negation operation is in service of
fixing bugs #4732, #4687, #4640 and #4992.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @BurntSushi on 2024-07-11 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ibraheemdev by @BurntSushi on 2024-07-11 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-07-11 18:25</div>
            <div class="timeline-body"><p>Nice job :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> approved on 2024-07-11 18:38</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-07-12 07:14</div>
            <div class="timeline-body"><p>Nice work, that's a very elegant solution!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2024-07-12 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-07-12 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-12 11:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:38:04 UTC
    </footer>
</body>
</html>
