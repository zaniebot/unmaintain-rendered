<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retry on &quot;too many open file&quot; errors when uninstalling Python - astral-sh/uv #17463</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Retry on &quot;too many open file&quot; errors when uninstalling Python</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/17463">#17463</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2026-01-14 14:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p><em>No description provided.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2026-01-14 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-14 14:20</div>
            <div class="timeline-body"><p>Can we try instead increasing the ulimit (https://github.com/astral-sh/uv/issues/16999#issuecomment-3641417484)? There's multiple locations where we could run into these kinds of errors, a higher limits avoids them occurring in the first place and is also more performant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-14 14:23</div>
            <div class="timeline-body"><p>What about both? I think adjusting the ulimit is scarier and I'd want to gate that with preview to start. This feels safe, though it can be less performant in the bad case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-14 14:33</div>
            <div class="timeline-body"><p>I'd start with increasing the ulimit, I've collected the precedent of other popular applications increasing the ulimit in https://github.com/astral-sh/uv/issues/16999#issuecomment-3641417484, this seems to be much more widely used than retrying. The other aspect is that these errors can occur in different parts of uv, and it could also happen that one operation opening lots of files crashes a usually less affected operation opening a file in parallel.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-14 14:45</div>
            <div class="timeline-body"><p>I still don't think I want to ship increasing the ulimit outside of preview to start and would like to unblock this clearly broken specific case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-14 14:50</div>
            <div class="timeline-body"><p>Drafting that at https://github.com/astral-sh/uv/pull/17464 (though it's not preview gated right now)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-14 14:53</div>
            <div class="timeline-body"><p>What problems do you see occurring when increasing the ulimit?</p>
<p>We know that too many file errors can occur in at least uninstall and bytecode compilation, only handling them for uninstallation and only through retry doesn't seem a robust solution to me. If we want a more immediate fix, we could also consider setting a lower parallelism limit for it based on the ulimit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-14 14:58</div>
            <div class="timeline-body"><blockquote>
<p>What problems do you see occurring when increasing the ulimit?</p>
</blockquote>
<p>There's scary stuff in the refs you linked, like</p>
<pre><code>                    // apparently, requesting too high of a number can cause other processes to not start.
                    // https://discord.com/channels/876711213126520882/1316342194176790609/1318175562367242271
                    // https://github.com/postgres/postgres/blob/fee2b3ea2ecd0da0c88832b37ac0d9f6b3bfb9a9/src/backend/storage/file/fd.c#L1072
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-14 15:08</div>
            <div class="timeline-body"><p>Fair point, we definitely want to more conservative than <code>@max(limit.max, 163840)</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-14 15:12</div>
            <div class="timeline-body"><p>They only do that for musl libc, but yeah.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-14 15:43:59 UTC
    </footer>
</body>
</html>
