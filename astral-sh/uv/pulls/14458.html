<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log the debug error trace - astral-sh/uv #14458</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Log the debug error trace</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/14458">#14458</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2025-07-04 09:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2025-07-04 09:26</div>
            <div class="timeline-body"><p>For #14425. We can see the error without <code>error(transparent)</code> applied by looking at the debug representation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2025-07-04 09:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-04 13:38</div>
            <div class="timeline-body"><p>Should this be <code>trace!</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-24 10:04</div>
            <div class="timeline-body"><p>I changed it to a trace log.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-24 11:57</div>
            <div class="timeline-body"><p>Do you feel like we still need this? I think things are working better now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-31 15:12</div>
            <div class="timeline-body"><p>I think #14996 is a good indicator that we still need tooling to debug (network) errors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-31 15:16</div>
            <div class="timeline-body"><p>What's an example of the output?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-31 15:35</div>
            <div class="timeline-body"><p>Something that's not really represented here is that we're also showing <code>error(transparent)</code> steps that are otherwise hidden. The inner anyhow error here makes the formatting odd.</p>
<pre><code>TRACE Considering retry of error: Error { kind: WrappedReqwestError(DisplaySafeUrl { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;pypi.org&quot;)), port: None, path: &quot;/simple/tqdm/&quot;, query: None, fragment: None }, WrappedReqwestError(Middleware(Request failed after 3 retries

Caused by:
    0: error sending request for url (https://pypi.org/simple/tqdm/)
    1: client error (Connect)
    2: dns error
    3: failed to lookup address information: Name or service not known))) }
</code></pre>
<p>In previous cases with only a generic IO error as output, I had to guess the origin of the error. Similarly, sometimes two variants on two enums have the same string representation. Having the exact derivation narrows this down, especially for error we can't reproduce locally.</p>
<p>The limitation is that it only works if we're in a thiserror chain, it fails when only anyhow is involved:</p>
<pre><code>TRACE Error trace: failed to remove file `/home/konsti/projects/uv/.venv/lib/python3.13/site-packages/anyio/abc/__init__.py`: Permission denied (os error 13)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-31 15:44</div>
            <div class="timeline-body"><p>This will leak credentials from the <code>DisplaySafeUrl</code>, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-31 16:20</div>
            <div class="timeline-body"><p>Good point to consider, but I don't think so?</p>
<p>https://github.com/astral-sh/uv/blob/4dd039208661f9aefc1500079e7f2598c435da37/crates/uv-redacted/src/lib.rs#L147-L176</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-31 16:26</div>
            <div class="timeline-body"><p>Oh cool, thanks for checking!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-07-31 16:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2025-07-31 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-07-31 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-07-31 17:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 06:47:14 UTC
    </footer>
</body>
</html>
