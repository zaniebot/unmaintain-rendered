<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix mirror script to handle newer metadata format. - astral-sh/uv #10050</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix mirror script to handle newer metadata format.</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/10050">#10050</a>
        opened by <a href="https://github.com/bw513">@bw513</a>
        on 2024-12-20 09:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bw513">@bw513</a></div>
            <div class="timeline-body">Summary
<p>The architecture details in <code>crates/uv-python/download-metadata.json</code> is now a dictionary with family and variant data, whereas it used to be a string. This patches the architecture filter in <code>scripts/create-python-mirror.py</code> to support both scenarios.</p>
Test Plan
<p>Tested manually using <code>uv run ./scripts/create-python-mirror.py --name cpython --arch x86_64 --os linux --from-all-history</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/nathanscain">@nathanscain</a> on <code>scripts/create-python-mirror.py</code>:94 on 2024-12-20 09:57</div>
            <div class="timeline-body"><p><code>match</code> added in 3.10 - script claims to support &gt;=3.8 in metadata at top of file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/nathanscain">@nathanscain</a> on <code>scripts/create-python-mirror.py</code>:97 on 2024-12-20 10:02</div>
            <div class="timeline-body"><p>Can&#x27;t use because of other issue with supporting 3.8 and 3.9 - but for future reference keep in mind that this does not test that the input to <code>match</code> is a string. It simply assigns str as a variable to the input - which should be flagged as reassigning over a default name.</p>
<p>To test that something is a string do:</p>
<pre><code>match x:
    case variable if isinstance(variable, str):
        print(f&quot;input was a string: {variable}&quot;)
    case _:
        print(f&quot;input was NOT a string: {x}&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nathanscain">@nathanscain</a> reviewed on 2024-12-20 10:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/nathanscain">@nathanscain</a> on <code>scripts/create-python-mirror.py</code>:98 on 2024-12-20 10:04</div>
            <div class="timeline-body"><p>per above, this line is unreachable</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nathanscain">@nathanscain</a> reviewed on 2024-12-20 10:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bw513">@bw513</a> reviewed on 2024-12-20 10:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/bw513">@bw513</a> on <code>scripts/create-python-mirror.py</code>:94 on 2024-12-20 10:58</div>
            <div class="timeline-body"><p>Thanks, I have switch away from using match :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-20 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-20 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-20 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-20 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanscain">@nathanscain</a> on 2024-12-20 13:40</div>
            <div class="timeline-body"><p>@charliermarsh is there a reason nothing in the pipeline flagged that <code>match</code> was used in a script claiming to support Python 3.8+? Are these scripts excluded from linting?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bw513">@bw513</a> on 2024-12-20 13:42</div>
            <div class="timeline-body"><p>Thank you :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:49:55 UTC
    </footer>
</body>
</html>
