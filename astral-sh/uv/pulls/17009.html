<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add GitHub Actions workflow for Rust project - astral-sh/uv #17009</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Add GitHub Actions workflow for Rust project</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/pull/17009">#17009</a>
        opened by <a href="https://github.com/pohi99999">@pohi99999</a>
        on 2025-12-06 00:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/pohi99999">@pohi99999</a> on 2025-12-06 00:49</div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<h2>Test Plan</h2>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Copilot by @pohi99999 on 2025-12-06 00:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/github-advanced-security[bot]">@github-advanced-security[bot]</a> reviewed on 2025-12-06 00:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/github-advanced-security[bot]">@github-advanced-security[bot]</a> on <code>.github/workflows/rust.yml</code>:18 on 2025-12-06 00:50</div>
            <div class="timeline-body"><p>credential persistence through GitHub Actions artifacts</p>
<p><a href="https://github.com/astral-sh/uv/security/code-scanning/187">Show more details</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:18 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>This GitHub Action should be pinned to a specific commit SHA rather than using a mutable version tag. Following the repository's security best practices, use the format:</p>
<pre><code class="language-yaml">- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
</code></pre>
<p>This prevents potential supply chain attacks where a tag could be moved to point to malicious code. All other workflows in this repository (ci.yml, publish-crates.yml, etc.) follow this pattern.</p>
<pre><code class="language-suggestion">    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:18 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>Missing Rust caching which significantly slows down CI runs. Add the Swatinem/rust-cache action after the checkout step:</p>
<pre><code class="language-yaml">- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
  with:
    persist-credentials: false
- uses: Swatinem/rust-cache@779680da715d629ac1d338a641029a2f4372abb5 # v2.8.2
  with:
    save-if: ${{ github.ref == 'refs/heads/main' }}
</code></pre>
<p>This caching strategy is consistently used in all Rust jobs in the repository's ci.yml workflow and can dramatically improve build times.</p>
<pre><code class="language-suggestion">    - uses: actions/checkout@v4
    - uses: Swatinem/rust-cache@779680da715d629ac1d338a641029a2f4372abb5 # v2.8.2
      with:
        save-if: ${{ github.ref == 'refs/heads/main' }}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:14 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>Missing timeout configuration for the build job. Without a timeout, jobs can hang indefinitely and waste CI resources. Add a timeout at the job level:</p>
<pre><code class="language-yaml">jobs:
  build:
    timeout-minutes: 10
    runs-on: ubuntu-latest
</code></pre>
<p>The repository's ci.yml workflow uses timeout-minutes consistently across all jobs (e.g., <code>timeout-minutes: 10</code> for lint and clippy jobs).</p>
<pre><code class="language-suggestion">
    timeout-minutes: 10
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:18 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>The checkout action is missing the <code>persist-credentials: false</code> security setting. This prevents the GITHUB_TOKEN from being persisted in the git config, which could be exposed in subsequent steps:</p>
<pre><code class="language-yaml">- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
  with:
    persist-credentials: false
</code></pre>
<p>This security practice is consistently applied in all workflows in this repository (ci.yml, publish-crates.yml, etc.).</p>
<pre><code class="language-suggestion">    - uses: actions/checkout@v4
      with:
        persist-credentials: false
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:10 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>[nitpick] Missing important environment variables used in the repository's CI. Consider adding these environment variables that are set in ci.yml for better reliability:</p>
<pre><code class="language-yaml">env:
  CARGO_INCREMENTAL: 0
  CARGO_NET_RETRY: 10
  CARGO_TERM_COLOR: always
  RUSTUP_MAX_RETRIES: 10
  RUST_BACKTRACE: 1
</code></pre>
<p>These variables improve CI reliability by disabling incremental compilation (not useful in CI), enabling network retries, and providing better error diagnostics.</p>
<pre><code class="language-suggestion">env:
  CARGO_INCREMENTAL: 0
  CARGO_NET_RETRY: 10
  CARGO_TERM_COLOR: always
  RUSTUP_MAX_RETRIES: 10
  RUST_BACKTRACE: 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:22 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>This workflow appears to be redundant with the existing comprehensive <code>.github/workflows/ci.yml</code> workflow, which already includes:</p>
<ul>
<li>Rust building and testing (cargo-test-linux, cargo-test-macos, cargo-test-windows jobs)</li>
<li>Clippy linting (cargo-clippy jobs)</li>
<li>Formatting checks (lint job with rustfmt)</li>
<li>Multiple platform support</li>
<li>Advanced features like cargo-nextest, Rust caching, and proper security controls</li>
</ul>
<p>The ci.yml workflow is much more comprehensive and follows the repository's established patterns. Consider whether this new workflow serves a distinct purpose, or if it should be removed to avoid maintaining duplicate CI logic.</p>
<pre><code class="language-suggestion"># (File deleted)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:11 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>Missing concurrency controls to cancel in-progress workflow runs. This wastes CI resources when multiple commits are pushed in quick succession. Add concurrency configuration after the <code>env:</code> section:</p>
<pre><code class="language-yaml">concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true
</code></pre>
<p>This pattern is used in the repository's ci.yml workflow to ensure efficient resource usage.</p>
<pre><code class="language-suggestion">
concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:20 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>The cargo build command should include the <code>--locked</code> flag to ensure builds use the exact dependency versions from Cargo.lock. This prevents unexpected behavior from dependency updates during CI:</p>
<pre><code class="language-yaml">run: cargo build --verbose --locked
</code></pre>
<p>This is a best practice for reproducible builds in CI environments.</p>
<pre><code class="language-suggestion">      run: cargo build --verbose --locked
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:22 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>[nitpick] This workflow uses <code>cargo test</code> but the repository's standard testing tool is <code>cargo-nextest</code>, which provides better performance and output formatting. Consider using cargo-nextest instead:</p>
<pre><code class="language-yaml">- name: Install cargo nextest
  uses: taiki-e/install-action@a416ddeedbd372e614cc1386e8b642692f66865e # v2.57.1
  with:
    tool: cargo-nextest
- name: Run tests
  run: cargo nextest run --verbose --workspace
</code></pre>
<p>All test jobs in ci.yml (cargo-test-linux, cargo-test-macos, cargo-test-windows) use cargo-nextest.</p>
<pre><code class="language-suggestion">    - name: Install cargo nextest
      uses: taiki-e/install-action@a416ddeedbd372e614cc1386e8b642692f66865e # v2.57.1
      with:
        tool: cargo-nextest
    - name: Run tests
      run: cargo nextest run --verbose --workspace
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/copilot-pull-request-reviewer[bot]">@copilot-pull-request-reviewer[bot]</a> reviewed on 2025-12-06 00:53</div>
            <div class="timeline-body"><h2>Pull request overview</h2>
<p>This PR adds a new GitHub Actions workflow for building and testing Rust code. However, the repository already has a comprehensive CI workflow (<code>.github/workflows/ci.yml</code>) that handles Rust building, testing, linting, and formatting across multiple platforms with advanced features and security controls.</p>
<h3>Key Observations</h3>
<ul>
<li>The new workflow duplicates functionality already present in the existing ci.yml workflow</li>
<li>Missing several security best practices (SHA-pinned actions, explicit permissions, credential persistence settings)</li>
<li>Lacks performance optimizations (Rust caching, concurrency controls) that are standard in the repository</li>
</ul>
<hr />
<p>ðŸ’¡ <a href="/astral-sh/uv/new/main/.github/instructions?filename=*.instructions.md" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Add Copilot custom instructions</a> for smarter, more guided reviews. <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" class="Link--inTextBlock" target="_blank" rel="noopener noreferrer">Learn how to get started</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Copilot">@Copilot</a> on <code>.github/workflows/rust.yml</code>:8 on 2025-12-06 00:53</div>
            <div class="timeline-body"><p>Missing explicit permissions configuration. Following security best practices, workflows should use the principle of least privilege by explicitly declaring permissions. Add after the <code>on:</code> section:</p>
<pre><code class="language-yaml">permissions: {}
</code></pre>
<p>The repository's ci.yml workflow uses <code>permissions: {}</code> to explicitly deny all permissions by default, only granting specific permissions where needed. This prevents accidental misuse of GitHub tokens.</p>
<pre><code class="language-suggestion">
permissions: {}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-12-06 01:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:31 UTC
    </footer>
</body>
</html>
