<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `fs_err` to `disallowed_method` in clippy.toml - astral-sh/uv #1950</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>fs_err</code> to <code>disallowed_method</code> in clippy.toml</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/1950">#1950</a>
        opened by <a href="https://github.com/yasufumy">@yasufumy</a>
        on 2024-02-24 12:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yasufumy">@yasufumy</a></div>
            <div class="timeline-body">Summary
<p>Resolve #1916</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/yasufumy">@yasufumy</a> on 2024-02-24 12:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-24 16:46</div>
            <div class="timeline-body"><p>Thanks for contributing! It looks like this isn&#x27;t working e.g. this is unflagged</p>
<p>https://github.com/astral-sh/uv/blob/11ed4f7183cc25a00f23e86bd264d4055645eed2/crates/install-wheel-rs/src/wheel.rs#L398</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-24 19:17</div>
            <div class="timeline-body"><p>I think it has to be a list of fully-qualified methods, rather than a module. So we&#x27;d have to like... enumerate every method in <code>fs</code>, to enforce this? Or is there a more conventional fix for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yasufumy">@yasufumy</a> on 2024-02-25 08:31</div>
            <div class="timeline-body"><p>@zanieb Thanks! I fixed my misconfiguration.</p>
<p>@charliermarsh Unfortunately, there seems to be no convenient way to do this like <code>std::fs::*</code>, so I enumerated all the methods in <code>std::fs</code> that can be replaced in <code>fs_err</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>clippy.toml</code>:11 on 2024-02-25 09:13</div>
            <div class="timeline-body"><p>What&#x27;s the motivation for disallowing these types? Are there equivalent types in <code>fs_err</code>? I see that you explicitly allow them further down.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-25 09:13</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-25 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-25 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yasufumy">@yasufumy</a> reviewed on 2024-02-25 09:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yasufumy">@yasufumy</a> on <code>clippy.toml</code>:11 on 2024-02-25 09:45</div>
            <div class="timeline-body"><p>Yes, there are equivalent types (https://docs.rs/fs-err/2.11.0/fs_err/#structs), but they do not seem to be fully compatible with types in <code>std::fs</code> (I got errors when replacing them). So I thought it would be good to use the types in <code>fs_err</code> as much as possible and explicitly allow types in <code>std::fs</code> otherwise.
But I think it might be a bit annoying to have to explicitly allow it every time we use types in <code>std::fs</code>. If so, I&#x27;ll revise it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-25 10:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>clippy.toml</code>:11 on 2024-02-25 10:07</div>
            <div class="timeline-body"><p>Let&#x27;s hear what @konstin thinks. He knows best when and where we should use <code>fs_err</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-26 14:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-git/Cargo.toml</code>:35 on 2024-02-26 14:04</div>
            <div class="timeline-body"><pre><code>fs-err = { workspace = true }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-26 14:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/Cargo.toml</code>:101 on 2024-02-26 14:04</div>
            <div class="timeline-body"><pre><code>fs-err = { workspace = true }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>clippy.toml</code>:11 on 2024-02-26 14:05</div>
            <div class="timeline-body"><p><code>std::fs::File::create</code> doesn&#x27;t tell you the filename when an error occurs, while <code>fs_err::File::create</code> does. There are case where generics are implemented on std types (e.g. <code>AutoStream</code>) so we need to &quot;downcast&quot;. I like the current solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-02-26 14:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-26 14:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>clippy.toml</code>:11 on 2024-02-26 14:08</div>
            <div class="timeline-body"><p>The clippy feature we&#x27;re missing to ban <code>std::fs</code> as a module is <a href="https://github.com/rust-lang/rust-clippy/issues/9489">rust-lang/rust-clippy#9489</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2024-02-26 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-02-26 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-26 14:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:43:55 UTC
    </footer>
</body>
</html>
