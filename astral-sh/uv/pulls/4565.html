<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enable projects to opt-out of workspace management - astral-sh/uv #4565</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enable projects to opt-out of workspace management</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4565">#4565</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-06-26 20:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-26 20:08</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>You can now add <code>managed = false</code> under <code>[tool.uv]</code> in a <code>pyproject.toml</code> to explicitly opt out of the project and workspace APIs.</p>
<p>If a project sets <code>managed = false</code>, we will (1) <em>not</em> discover it as a workspace root, and (2) <em>not</em> discover it as a workspace member (similar to using <code>exclude</code> in the workspace parent).</p>
<p>Closes https://github.com/astral-sh/uv/issues/4551.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-06-26 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2024-06-26 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-26 20:08</div>
            <div class="timeline-body"><p>Adding tests now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-06-26 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-26 20:31</div>
            <div class="timeline-body"><blockquote>
<p>The latter behavior is somewhat debatable since it creates two mechanisms for excluding packages from workspaces, and it precludes us from supporting: (1) workspace at <code>parent</code>, (2) project at <code>child</code> that is an implicit workspace but isn't part of <code>parent</code>.</p>
</blockquote>
<p>I think I spoke too soon. That can still be accomplished by adding <code>child</code> to the <code>exclude</code> list in <code>parent</code>.</p>
<p>So <code>workspace = false</code> is stronger than <code>exclude</code>: it means the project is opted out of being a workspace or part of a workspace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:306 on 2024-06-26 21:57</div>
            <div class="timeline-body"><p>Does this mean <code>anyio</code> won't be available unless a virtual environment is explicitly created? Maybe we should be printing the path to the sys executable or importing anyio here instead of printing the Python version so the snapshot demonstrates more behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-26 21:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-06-26 21:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-27 07:35</div>
            <div class="timeline-body"><p>What problem is that solving? How are other ecosystems handling this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-27 11:05</div>
            <div class="timeline-body"><p>@konstin see discussion at https://github.com/astral-sh/uv/issues/3836</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-28 21:06</div>
            <div class="timeline-body"><p>@konstin -- It's not an <em>ecosystem</em> issue, it's a <code>uv</code> issue: because we support two different APIs (project vs. pip), but we want <code>uv run</code> to useable by folks outside of projects, we need some way to indicate that a package is explicitly <em>not</em> managed by uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-01 07:27</div>
            <div class="timeline-body"><p>I see, what about calling it <code>managed = false</code> instead? It is workspace discovery in our implementation, but for a user it's just a single project they don't want uv to touch; the workspace part is an implementation detail we should not leak, while <code>managed = true</code> indicated that uv will do less (invasive) things.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-01 13:56</div>
            <div class="timeline-body"><p>Not strongly opposed, but what would it mean if <code>managed = false</code> was set alongside a <code>tool.uv.workspace</code> definition in the same <code>pyproject.toml</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-01 14:20</div>
            <div class="timeline-body"><p>Unless you have a specific use case in mind, i think we should warn as with other conflicting options</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-01 19:35</div>
            <div class="timeline-body"><p>Alright, I'm ok with it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-07-01 20:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-07-01 20:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-01 20:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-01 20:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:48:47 UTC
    </footer>
</body>
</html>
