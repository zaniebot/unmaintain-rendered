<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add UV_COMPILE_BYTECODE_TIMEOUT environment variable - astral-sh/uv #14369</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add UV_COMPILE_BYTECODE_TIMEOUT environment variable</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/14369">#14369</a>
        opened by <a href="https://github.com/adisbladis">@adisbladis</a>
        on 2025-06-30 09:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/adisbladis">@adisbladis</a></div>
            <div class="timeline-body">Summary
<p>When installing packages on <em>very</em> slow/overloaded systems it&#x27;spossible to trigger bytecode compilation timeouts, which tends to happen in environments such as Qemu (especially without KVM/virtio), but also on systems that are simply overloaded. I&#x27;ve seen this in my Nix builds if I for example am compiling a Linux kernel at the same time as a few other concurrent builds.</p>
<p>By making the bytecode compilation timeout adjustable you can work around such issues. I plan to set <code>UV_COMPILE_BYTECODE_TIMEOUT=0</code> in the <a href="https://pyproject-nix.github.io/pyproject.nix/build.html">pyproject.nix builders</a> to make them more reliable.</p>
<ul>
<li><p>Related issues</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/6105</li>
</ul>
</li>
</ul>
Test Plan
<p>Only manual testing was applied in this instance. There is no existing automated tests for bytecode compilation timeout afaict.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-30 09:34</div>
            <div class="timeline-body"><p>Are you sure you&#x27;re hitting the timeout and not the QEMU deadlock? If so, can you share a reproduction for it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adisbladis">@adisbladis</a> on 2025-06-30 11:17</div>
            <div class="timeline-body"><blockquote>
<p>Are you sure you&#x27;re hitting the timeout and not the QEMU deadlock?</p>
</blockquote>
<p>I was hitting this earlier when building a NixOS system on a laptop, no QEMU involved.
It was building a Linux kernel concurrently with a few other Nix packages, one of which was compiling Python bytecode using uv.</p>
<blockquote>
<p>If so, can you share a reproduction for it?</p>
</blockquote>
<p>It&#x27;s really hard to provide a reproduction because it only happens under very high load, and even then it&#x27;s far from reliable.
I&#x27;ve mostly observed it when I was having very high load due to many concurrent Nix builds &amp; was thermally throttled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-01 10:35</div>
            <div class="timeline-body"><p>It&#x27;s hard for us to justify adding a new flag with without a way for to reproduce why we need and to compare it with other solutions, e.g. raising the fixed timeout.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-07-11 17:26</div>
            <div class="timeline-body"><p>I don&#x27;t think we should have timeouts that can&#x27;t be configured, generally speaking. I don&#x27;t mind supporting this — if it&#x27;s a deadlock then changing the timeout won&#x27;t fix anything and we&#x27;ll have learned something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-11 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-07-11 17:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-installer/src/compile.rs</code>:102 on 2025-07-11 17:54</div>
            <div class="timeline-body"><p>We should probably error here though, I don&#x27;t think we have much precedent for warning on invalid options.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/adisbladis">@adisbladis</a> reviewed on 2025-07-16 00:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/adisbladis">@adisbladis</a> on <code>crates/uv-installer/src/compile.rs</code>:102 on 2025-07-16 00:54</div>
            <div class="timeline-body"><p>I copied this from the handling of <code>UV_HTTP_TIMEOUT</code>/<code>UV_REQUEST_TIMEOUT</code>/<code>HTTP_TIMEOUT</code>.
That might have been handled differently because of <code>HTTP_TIMEOUT</code> being more generic?</p>
<p>In any case I agree with erroring out on an invalid value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-07-16 14:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-installer/src/compile.rs</code>:99 on 2025-07-16 14:03</div>
            <div class="timeline-body"><p>Sorry I wasn&#x27;t clear — we shouldn&#x27;t panic here, we try to avoid panicking in general. We should return this as a Result::Err variant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/adisbladis">@adisbladis</a> on <code>crates/uv-installer/src/compile.rs</code>:99 on 2025-07-17 02:44</div>
            <div class="timeline-body"><p>Ok. I&#x27;ve introduced a <code>CompileError::EnvironmentError</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/adisbladis">@adisbladis</a> reviewed on 2025-07-17 02:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-07-17 13:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-17 13:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-17 13:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:52:57 UTC
    </footer>
</body>
</html>
