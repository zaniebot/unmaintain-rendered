<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>remove `source` and `version` from dependencies in lock file when unambiguous - astral-sh/uv #4513</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>remove <code>source</code> and <code>version</code> from dependencies in lock file when unambiguous</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4513">#4513</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-06-25 13:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>When there is only one distribution for a particular package name, any
dependencies (the edges in the resolution graph) that reference that
package name are completely unambiguous. Therefore, we can actually
omit their version and source information and instead derive it from
the distribution entry.</p>
<p>We add some tests to check the success and error cases. That is,
when <code>source</code> or <code>version</code> are omitted and there are more than one
corresponding distribution for the package name (i.e., it&#x27;s ambiguous),
then lock deserialization should fail.</p>
<p>Since there can be a lot of <code>distribution.dependency</code> blocks, this
change trims a lot of fat from a lock file.</p>
<p>Cargo does a similar thing here where it omits the source and version
from dependencies when their value is unambiguous.</p>
<p>Ref <a href="https://github.com/astral-sh/uv/issues/3611">astral-sh/uv#3611</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-25 13:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/ibraheemdev">@ibraheemdev</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-25 13:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-25 15:16</div>
            <div class="timeline-body"><p>Sweet!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> approved on 2024-06-25 20:22</div>
            <div class="timeline-body"><p>Nice! This cleans up the lockfile quite a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-06-26 00:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-resolver/src/lock.rs</code>:251 on 2024-06-26 10:32</div>
            <div class="timeline-body"><pre><code>            for dependencies in &amp;mut dist.optional_dependencies.values() {
</code></pre>
<p>The keys are unused in these iterations</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-06-26 11:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-26 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-26 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-26 12:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:46:07 UTC
    </footer>
</body>
</html>
