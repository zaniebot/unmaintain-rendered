<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Always¹ clear temporary directories - astral-sh/uv #437</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Always¹ clear temporary directories</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/437">#437</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-11-16 14:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Always¹ clear the temporary directories we create.</p>
<ul>
<li>Clear source dist downloads: Previously, the temporary directories would remain in the cache dir, now they are cleared properly</li>
<li>Clear wheel file downloads: Delete the <code>.whl</code> file, we only need to cache the unpacked wheel</li>
<li>Consistent handling of cache arguments: Abstract the handling for CLI cache args away, again making sure we remove the <code>--no-cache</code> temp dir.</li>
</ul>
<p>There are no more <code>into_path()</code> calls that persist <code>TempDir</code>s that i could find.</p>
<p>¹Assuming drop is run, and deleting the directory doesn't silently error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-installer/src/downloader.rs</code>:310 on 2023-11-16 17:41</div>
            <div class="timeline-body"><p>Wondering if we should split this into two enums (for Git vs. URL) so that it doesn't need to be optional?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-16 17:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-installer/src/downloader.rs</code>:278 on 2023-11-16 17:41</div>
            <div class="timeline-body"><p>Does this need to be <code>Option</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-16 17:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-16 17:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-installer/src/downloader.rs</code>:310 on 2023-11-16 17:41</div>
            <div class="timeline-body"><p>(Is there any way for <code>PhantomData</code> to help with this? I've never actually used it so I don't know what I'm talking about. \cc @BurntSushi)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-16 17:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-cache/src/cli.rs</code>:25 on 2023-11-16 17:42</div>
            <div class="timeline-body"><p>I might suggest just making a named struct for this, for clarity? That way it at least encapsulates this detail rather than requiring that callers destructure this tuple and ignore the first field.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-11-16 17:42</div>
            <div class="timeline-body"><p>Small comments but overall makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2023-11-16 17:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/puffin-installer/src/downloader.rs</code>:310 on 2023-11-16 17:50</div>
            <div class="timeline-body"><p>I don't think <code>PhantomData</code> applies here. <code>PhantomData</code> is a way of marking a type or lifetime parameter as &quot;used&quot; by a struct without actually using it. It is most frequently associated (but not universally) with <code>unsafe</code> code that is escaping or eliding type/lifetime parameters. It's also used to prescribe semantics of other types onto the containing type. For example, variance. But now we're really digging into rabbit holes here. :-)</p>
<p>As for the enum question, I would probably lean that way but hard to say if that's the right thing to do here. I think for me it would depend on how much consuming code really cares about Git vs. URL. If this is the only distinction then maybe it isn't worth it. (Sorry for my contextless generic opinion.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-16 18:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-installer/src/downloader.rs</code>:278 on 2023-11-16 18:06</div>
            <div class="timeline-body"><p>I guess it's ok for this to be optional actually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-11-16 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-16 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-16 20:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:34:44 UTC
    </footer>
</body>
</html>
