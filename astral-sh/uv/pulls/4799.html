<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove incompatible wheels from `uv.lock` - astral-sh/uv #4799</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove incompatible wheels from <code>uv.lock</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4799">#4799</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-07-04 10:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Remove wheels from the lockfile that don't match the required python version. For example, we remove <code>charset_normalizer-3.3.2-cp311-cp311-win_amd64.whl</code> when we have <code>requires-python = &quot;&gt;=3.12&quot;</code>.</p>
<p>Our snapshots barely show changes since we avoid the large binaries for which matters. Here are 3 real world <code>uv.lock</code> before/after comparisons to show the large difference:</p>
<ul>
<li><a href="https://gist.github.com/konstin/9a1ed6a32b410e250fcf4c6ea8c536a5">warehouse</a> (5677 -&gt; 4214)</li>
<li><a href="https://gist.github.com/konstin/5636281b5226f64aa44ce3244d5230cd">transformers</a> (6484 -&gt; 5816)</li>
<li><a href="https://gist.github.com/konstin/ebbd7b9474523aaa61d9a8945bc02071">github-wikidata-bot</a> (793 -&gt; 454)</li>
</ul>
<p>We only remove wheels we are certain don't match the python version and still keep those with unknown tags. We could remove even more wheels by also considering other markers, e.g. removing linux wheels for a windows-only dep, but we would trade complex, easy-to-get-wrong logic for diminishing returns.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2024-07-04 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-07-04 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @konstin on 2024-07-04 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2024-07-04 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-07-04 18:03</div>
            <div class="timeline-body"><p>Nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-07-04 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-04 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-04 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-07-08 17:40</div>
            <div class="timeline-body"><p>I love this.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:37:56 UTC
    </footer>
</body>
</html>
