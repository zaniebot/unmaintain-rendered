<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add documentation publishing workflow to standalone repo - astral-sh/uv #5081</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add documentation publishing workflow to standalone repo</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/5081">#5081</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-07-15 20:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-15 20:31</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This approach is based on https://github.com/PrefectHQ/docs. Rather than publishing docs in the uv repo, we push to an independent repo that's used solely to house the docs. In Prefect's case, this allows them to publish versioned documentation (we should do that too). For us, though, the benefit is that we can publish the Ruff and uv docs as a single site (docs.astral.sh).</p>
<p>Prefect clones the source repo and builds the documentation from the <code>docs</code> repo (i.e., the action runs in the <code>docs</code> repo). In our case, I've instead set it up such that the action runs in <code>uv</code> (and later in <code>ruff</code> too), clones the <code>docs</code> repo, and puts up a PR in that separate repo. Because of these requirements, we have to use a PAT rather than a deploy key (as PATs cannot do GitHub-specific things like create PRs -- they can only operate over the Git CLI).</p>
<p>See: https://github.com/astral-sh/docs/pull/2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-15 20:31</div>
            <div class="timeline-body"><p>This will take me 1,000 attempts to get working.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-07-15 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2024-07-15 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @charliermarsh on 2024-07-15 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2024-07-15 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-15 23:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/publish-docs.yml</code>:101 on 2024-07-15 23:42</div>
            <div class="timeline-body"><p>Using the $GITHUB_ACTOR variables here feels cleaner e.g. https://github.com/astral-sh/packse/blob/main/.github/workflows/release.yaml#L71-L72</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-15 23:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/publish-docs.yml</code>:127 on 2024-07-15 23:44</div>
            <div class="timeline-body"><p>Why login instead of just putting the token as an environment variable? This will persist to disk. Seems like a larger attack surface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-15 23:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/publish-docs.yml</code>:42 on 2024-07-15 23:44</div>
            <div class="timeline-body"><p>May be mildly confusing if we're not versioning yet</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-15 23:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/publish-docs.yml</code>:25 on 2024-07-15 23:45</div>
            <div class="timeline-body"><p>Why do we need these permissions if we're writing to another repository with a dedicated secret token?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-15 23:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>.github/workflows/publish-docs.yml</code>:25 on 2024-07-15 23:52</div>
            <div class="timeline-body"><p>Sorry, we don't, this is copied over from Prefect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-15 23:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>.github/workflows/publish-docs.yml</code>:101 on 2024-07-15 23:52</div>
            <div class="timeline-body"><p>Tell that to Prefect...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-15 23:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>.github/workflows/publish-docs.yml</code>:127 on 2024-07-15 23:54</div>
            <div class="timeline-body"><p>I seem to recall that it didn't work, but let me test again now that I removed the secondary SSH key -- that may have been the root cause.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2024-07-15 23:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-16 00:07</div>
            <div class="timeline-body"><p>Thanks @zanieb!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-07-16 04:16</div>
            <div class="timeline-body"><p>Awesome :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-07-16 13:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-16 13:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-16 13:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:43:11 UTC
    </footer>
</body>
</html>
