<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add docker builder - astral-sh/uv #238</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add docker builder</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/238">#238</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-10-30 19:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-10-30 19:16</div>
            <div class="timeline-body"><p>This docker container provides isolation of source distribution builds, whether <a href="https://pypi.org/project/nvidia-pyindex/">intended to be helpful</a> or other more or less malicious forms of host system modification.</p>
<p>Fixes #194</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-30 19:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>.dockerignore</code>:2 on 2023-10-30 19:54</div>
            <div class="timeline-body"><p>Nit: mind adding newlines to all of these files? Otherwise they'll get changed when they're next edited.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-30 19:55</div>
            <div class="timeline-body"><p>How / when is this intended to be used?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-30 20:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>builder.dockerfile</code>:12 on 2023-10-30 20:10</div>
            <div class="timeline-body"><p>Since we don't require any of the <code>ADD</code> magic we should use <code>COPY</code></p>
<pre><code class="language-suggestion">COPY rust-toolchain.toml rust-toolchain.toml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>builder.dockerfile</code>:17 on 2023-10-30 20:10</div>
            <div class="timeline-body"><p>Should we set pipefail here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-30 20:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-30 20:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>builder.dockerfile</code>:6 on 2023-10-30 20:15</div>
            <div class="timeline-body"><p>General apt-get best practice in Dockerfiles; I don't feel strongly about the formatting although I generally like to separate dependencies on new lines</p>
<pre><code class="language-suggestion">RUN apt-get update &amp;&amp; \
    apt-get install -y --no-install-recommends \
        python3 \
        python3-pip \
        python3-venv \
        build-essential \
        make \
        autoconf \
        curl \
    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-10-30 20:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>builder.dockerfile</code>:18 on 2023-10-30 20:46</div>
            <div class="timeline-body"><p>Just wondering, why modify <code>HOME</code>?</p>
<p>Should we use <code>WORKDIR</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-10-31 11:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>builder.dockerfile</code>:18 on 2023-10-31 11:27</div>
            <div class="timeline-body"><p>I wanted absolute paths in <code>PATH</code> and needed a prefix; I can also set <code>WORKDIR</code> but i think we don't need to?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-10-31 11:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>.dockerignore</code>:2 on 2023-10-31 11:28</div>
            <div class="timeline-body"><p>Good idea, found the setting</p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/a377374d-02ca-4855-af7d-973a21d8485d" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>builder.dockerfile</code>:17 on 2023-10-31 11:31</div>
            <div class="timeline-body"><p>I wouldn't bother for a development container</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-10-31 11:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-10-31 11:36</div>
            <div class="timeline-body"><blockquote>
<p>How / when is this intended to be used?</p>
</blockquote>
<p>The primary usage is when building random packages to avoid them modifying your system (https://github.com/astral-sh/puffin/issues/194#issue-1963338852), the secondary usage is that we have a shared build environment to make e.g. failures reproducible and get the same compiler versions.</p>
<p>My personal usage is by integrating this into my IDE:</p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/73288f2f-b8ee-4658-ac1e-a1a287ba61b7" alt="image" /></p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/ea5b97d6-0d86-4048-9612-fb0d6365b57b" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-31 20:43</div>
            <div class="timeline-body"><p>Is there a way we can codify usage of this in a CONTRIBUTING guide? Perhaps in a simpler way than IDE integrations, like just a <code>docker run</code> command? Otherwise adding this to the repository doesn't quite make sense to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-01 12:44</div>
            <div class="timeline-body"><p>Good idea, done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-dev/src/resolve_many.rs</code>:29 on 2023-11-01 12:44</div>
            <div class="timeline-body"><p>This is to have the example makes sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-01 12:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>CONTRIBUTING.md</code>:5 on 2023-11-01 15:46</div>
            <div class="timeline-body"><pre><code class="language-suggestion">Source distributions can run arbitrary code on build and can make unwanted modifications to your system (https://moyix.blogspot.com/2022/09/someones-been-messing-with-my-subnormals.html, https://pypi.org/project/nvidia-pyindex/), which can even occur when just resolving requirements. To prevent this, there's a Docker container you can run commands in:
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-01 15:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2023-11-01 15:47</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2023-11-02 11:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-11-02 11:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-02 11:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:50:52 UTC
    </footer>
</body>
</html>
