<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow passing custom reqwest client to RegistryClient - astral-sh/uv #15281</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow passing custom reqwest client to RegistryClient</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/15281">#15281</a>
        opened by <a href="https://github.com/nilskch">@nilskch</a>
        on 2025-08-14 14:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nilskch">@nilskch</a></div>
            <div class="timeline-body">

Summary


<p>We are using UV as a library and we would like to provide an custom reqwest client to the <code>RegistryClient</code>/<code>BaseClient</code>. We have a central place in our repo where we configure the reqwest client to our needs (certs, proxy, ...) and it is safer for us to just pass the same client to UV rather than trying to reproduce the same client config with the APIs that UV exposes.</p>
<p>Are you ok with that change?</p>
Test Plan


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/nilskch">@nilskch</a> on 2025-08-14 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-14 14:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-client/src/base_client.rs</code>:164 on 2025-08-14 14:49</div>
            <div class="timeline-body"><p>nit: missing newline here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-14 14:50</div>
            <div class="timeline-body"><p>I&#x27;m pretty wary of this change but I don&#x27;t have a strong reason to deny it. I&#x27;m mostly worried about the increased complexity in a very critical component of uv. Perhaps we could refactor this to avoid the big <code>if / else</code> branch somehow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rustlib</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-14 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nilskch">@nilskch</a> on 2025-08-14 15:24</div>
            <div class="timeline-body"><p>I moved the logic of creating the <code>raw_client</code> and <code>raw_dangerous_client</code> into a separate function.</p>
<p>I totally see your point. This would make our life much easier, but I would absolutely understand if you do not feel comfortable maintaining this change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-08-14 16:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-14 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-14 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-14 17:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:53:35 UTC
    </footer>
</body>
</html>
