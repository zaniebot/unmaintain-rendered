<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add relocatable installs to support concurrency-safe cached environments - astral-sh/uv #5509</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add relocatable installs to support concurrency-safe cached environments</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/5509">#5509</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-07-27 17:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>The idea here is similar to what we do for wheels: we create the <code>CachedEnvironment</code> in the <code>archive-v0</code> bucket, then symlink it to its content-addressed location. This ensures that we can always recreate these environments without concern for whether anyone else is accessing them.</p>
<p>Part of the challenge here is that we want the virtual environments to be relocatable, because we&#x27;re now building them in one location but persisting them in another. This requires that we write relative (rather than absolute) paths to scripts and entrypoints. The main risk with relocatable virtual environments is that the scripts and entrypoints <em>themselves</em> are not relocatable, because they use a relative shebang. But that&#x27;s fine for cached environments, which are never intended to leave the cache.</p>
<p>Closes <a href="https://github.com/astral-sh/uv/issues/5503">astral-sh/uv#5503</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-27 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-27 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-27 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-27 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-27 18:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-29 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-29 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-29 00:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:46:54 UTC
    </footer>
</body>
</html>
