<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use zlib-ng for faster decompression - astral-sh/uv #859</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use zlib-ng for faster decompression</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/859">#859</a>
        opened by <a href="https://github.com/bojanserafimov">@bojanserafimov</a>
        on 2024-01-09 20:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bojanserafimov">@bojanserafimov</a></div>
            <div class="timeline-body"><p>ty @BurntSushi for the suggestion</p>
Bench results
<p>Summary: 20-25% speedup in cases like flyte.txt and pdm-2913.txt, where compression is important. Other cases are either saturating my bandwidth or using source packages. No major regressions.</p>
scripts/bench/requirements.txt
<p>main:
Resolved 45 packages in 709ms
Downloaded 45 packages (total size: 14586813 bytes) in 438ms (rate: 31.758675 MB/sec)
Num source packages: 0
Installed 45 packages in 57ms</p>
<p>ng:
Downloaded 45 packages in 428ms</p>
black.txt (compiled from scripts/requirements/black.in)
<p>main:
Resolved 8 packages in 100ms
Downloaded 8 packages (total size: 1960918 bytes) in 129ms (rate: 14.4835825 MB/sec)
Num source packages: 0
Installed 8 packages in 22ms</p>
<p>ng:
Downloaded 8 packages in 81ms</p>
boto3.txt (compiled from scripts/requirements/boto3.in)
<p>Resolved 31 packages in 919ms
Downloaded 31 packages (total size: 39488261 bytes) in 1.52s (rate: 24.74746 MB/sec)
Num source packages: 0
Installed 31 packages in 70ms</p>
<p>ng:
Downloaded 31 packages in 1.26s</p>
dtlssocket.txt
<p>Resolved 2 packages in 182ms
Downloaded 2 packages (total size: 2066977 bytes) in 4.98s (rate: 0.395072 MB/sec)
Num source packages: 1
Installed 2 packages in 48ms</p>
<p>ng:
Downloaded 2 packages in 4.94s</p>
flyte.txt
<p>Resolved 107 packages in 1.51s
Downloaded 107 packages (total size: 1417831287 bytes) in 1m 02s (rate: 21.669163 MB/sec)
Num source packages: 0
Installed 107 packages in 338ms</p>
<p>ng:
Downloaded 107 packages in 45.64s</p>
pdm-2913.txt
<p>Resolved 13 packages in 261ms
Downloaded 13 packages (total size: 31291075 bytes) in 1.32s (rate: 22.568693 MB/sec)
Num source packages: 1
Installed 13 packages in 29ms</p>
<p>ng:
Downloaded 13 packages in 1.08s</p>
scispacy.txt
<p>Resolved 84 packages in 1.32s
Downloaded 84 packages (total size: 223013396 bytes) in 6.09s (rate: 34.916824 MB/sec)
Num source packages: 0
Installed 84 packages in 111ms</p>
<p>ng:
Downloaded 84 packages in 6.15s</p>
trio.txt
<p>Resolved 38 packages in 370ms
Downloaded 38 packages (total size: 25506995 bytes) in 739ms (rate: 32.887703 MB/sec)
Num source packages: 0
Installed 38 packages in 61ms</p>
<p>ng:
Downloaded 38 packages in 703ms</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-01-09 20:27</div>
            <div class="timeline-body"><p>That&#x27;s an excellent speedup, thanks for testing across a bunch of scenarios.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-09 20:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-09 20:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/bojanserafimov">@bojanserafimov</a> on 2024-01-09 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bojanserafimov">@bojanserafimov</a> on 2024-01-09 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-09 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-01-10 13:34</div>
            <div class="timeline-body"><p>Nice work!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bojanserafimov">@bojanserafimov</a> on 2024-01-11 16:00</div>
            <div class="timeline-body"><p>I retested this because previously I was using a debug build (see <a href="https://github.com/astral-sh/puffin/pull/856">astral-sh/puffin#856</a>#issuecomment-1884016311). The improvement is small but real</p>
<pre><code>python -m scripts.bench \
    --puffin-path ./target/release/puffin-main \
    --puffin-path ./target/release/puffin-no-zlib \
    --benchmark install-cold \
    --min-runs 100 \
    scripts/requirements/compiled/black.txt

Summary
  ./target/release/puffin-main (install-cold) ran
    1.05 Â± 0.29 times faster than ./target/release/puffin-no-zlib (install-cold)
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:43:08 UTC
    </footer>
</body>
</html>
