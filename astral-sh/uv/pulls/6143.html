<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fork every time we see a non-trivial marker (&quot;aggressive&quot; forking) - astral-sh/uv #6143</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fork every time we see a non-trivial marker (&quot;aggressive&quot; forking)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/6143">#6143</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-08-16 12:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-08-16 12:14</div>
            <div class="timeline-body"><p>This PR is a revival of #5733 on top of current <code>main</code>, as many things
have changed since #5733.</p>
<p>It is suspected that, at least at this time, we probably don't
want to switch to aggressive forking, but we may in the future. In
particular, aggressive forking does fix #4668 and #6127.
Moreover, it fixes some issues that aren't filed but for which we only
have hand-crafted artificial examples (see the <code>non-local-*</code> packse
scenarios).</p>
<p>There are two main downsides to aggressive forking:</p>
<ol>
<li>It, well, creates a lot more forks. This leads to slower resolutions
overall, sometimes dramatically so.</li>
<li>It changes the resolutions/markers in ways we don't yet fully
understand. Part of the point of this PR is to be able to look at the
snapshot diffs to see the kinds of effects it has. In some cases, the
changes are quite large and can be difficult to comprehend and reason
about.</li>
</ol>
<p>We haven't spent a ton of time on (1), but it is suspected that in the
aggressive strategy, there should still be a way to prune superfluous
forks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @BurntSushi on 2024-08-16 12:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-08-16 12:27</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/uv/branches/ag/aggressive-forking">CodSpeed Performance Report</a></h2>
<h3>Merging #6143 will <strong>degrade performances by 83.07%</strong></h3>
<p><sub>Comparing <code>ag/aggressive-forking</code> (d4fd44a) with <code>main</code> (89efe24)</sub></p>
<h3>Summary</h3>
<p><code>❌ 1</code> regressions
<code>✅ 13</code> untouched benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/uv/branches/ag/aggressive-forking">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
<h3>Benchmarks breakdown</h3>
<p>|     | Benchmark | <code>main</code> | <code>ag/aggressive-forking</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ❌ | <code>resolve_warm_jupyter_universal</code> | 321.6 ms | 1,899.6 ms | -83.07% |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-22 11:34</div>
            <div class="timeline-body"><p>I'm going to close this as it's quite stale now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-07-22 11:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 06:47:11 UTC
    </footer>
</body>
</html>
