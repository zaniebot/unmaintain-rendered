<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better trusted publishing error story - astral-sh/uv #8633</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better trusted publishing error story</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/8633">#8633</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-10-28 12:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body">Summary
<p>Trusted publishing errors are a tough problem because for security reason, PyPI won&#x27;t tell use the trusted publishing configuration for a repo and GitHub Actions doesn&#x27;t let us see arbitrary secrets either.</p>
<p>These changes handle using trusted publishing while other credentials are also set (an error) and adds a hint and an error trace when it looks like the user wanted trusted publishing, but it wasn&#x27;t configured.</p>
<p>Fixes #8223.</p>
Error messages
<p>The screenshots are from https://github.com/konstin/trusted-publishing-examples/actions/runs/11555118347. Some cases, e.g. the wrong environment and the wrong workflow name, return the same error since PyPI doesn&#x27;t give use more information for security reasions.</p>
<p>The user set the wrong workflow name, using <code>uv publish --trusted-publishing always</code>:</p>
<p><img src="https://github.com/user-attachments/assets/b150228e-eefd-4bba-bdcb-4496d2c347a0" alt="image"></p>
<p>The user set the wrong workflow name, using plain <code>uv publish</code>:</p>
<p><img src="https://github.com/user-attachments/assets/3d32c2ef-770c-4eab-be01-ac2ecf6b2b62" alt="image"></p>
<p>The user forgot the <code>id-token: write</code> permission:</p>
<p><img src="https://github.com/user-attachments/assets/541af555-caf1-4e88-933d-339ca44cfc46" alt="image"></p>
<p>The user forgot the environment:</p>
<p><img src="https://github.com/user-attachments/assets/63fdbfd0-b91d-47c2-88f6-b49ad3f4ebc8" alt="image"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-publish/src/lib.rs</code>:304 on 2024-10-28 16:20</div>
            <div class="timeline-body"><p>Would it make sense to try and combine these into one error? Otherwise, users might hit the first one, then fix it. Then hit the second one, then fix it. And so on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-10-28 16:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 20:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 20:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-28 20:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:49:03 UTC
    </footer>
</body>
</html>
