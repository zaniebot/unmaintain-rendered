<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for relative URLs in simple metadata responses - astral-sh/uv #721</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for relative URLs in simple metadata responses</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/721">#721</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-12-24 20:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR adds support for relative URLs in the simple JSON responses. We already support relative URLs for HTML responses, but the handling has been consolidated between the two. Similar to index URLs, we now store the base alongside the metadata, and use the base when resolving the URL.</p>
<p>Closes #455.</p>
<h2>Test Plan</h2>
<p><code>cargo test</code> (to test HTML indexes). Separately, I also ran <code>cargo run -p puffin-cli -- pip-compile requirements.in -n --index-url=http://localhost:3141/packages/pypi/+simple</code> on the <code>zb/relative</code> branch with <code>packse</code> running, and forced both HTML and JSON by limiting the <code>accept</code> header.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2023-12-24 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-24 20:45</div>
            <div class="timeline-body"><p>@zanieb - Any instructions for testing on <code>devpi</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-12-24 20:53</div>
            <div class="timeline-body"><p>You could use https://github.com/zanieb/packse/compare/zb/relative</p>
<p>Then <code>packse index up</code> and <code>http://localhost:3141/packages/pypi/+simple</code> as the index URL.</p>
<p>I <em>presume</em> this will use relative URLs everywhere but I'm not sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-24 20:55</div>
            <div class="timeline-body"><p>I shall try, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-24 21:39</div>
            <div class="timeline-body"><p>Worked great, thanks. Interestingly, if I send up <code>application/vnd.pypi.simple.v1+json, application/vnd.pypi.simple.v1+html;q=0.2, text/html</code>, <code>devpi</code> returns <code>HTML</code> by default. I wonder if we should &quot;prefer&quot; JSON?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-24 21:41</div>
            <div class="timeline-body"><p>Ah nevermind, I'm missing a &quot;quality&quot; parameter to indicate that we prefer JSON. Easy fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2023-12-24 21:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2023-12-26 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-12-26 14:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-12-27 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-27 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-27 13:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:34:59 UTC
    </footer>
</body>
</html>
