<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make editable installs their own test feature flag - astral-sh/uv #766</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Make editable installs their own test feature flag</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/766">#766</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-01-04 01:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>For whatever reason these fail for me with mold, and it&#x27;s not worth it to me to disable the linker.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-04 01:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-04 01:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-04 01:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-01-04 01:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-04 11:02</div>
            <div class="timeline-body"><p>Can you post the error you get?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-04 13:53</div>
            <div class="timeline-body"><pre><code>----- stderr -----
error: Failed to build editables
  Caused by: Failed to build editable: file://[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/
  Caused by: Failed to build: file://[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/
  Caused by: Build backend failed to build wheel through `build_editable()`:
--- stdout:
Running `maturin pep517 build-wheel -i /private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpQwDZR9/.venv/bin/python --compatibility off --editable`
--- stderr:
üçπ Building a mixed python/rust project
üîó Found pyo3 bindings
üêç Found CPython 3.12 at /private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpQwDZR9/.venv/bin/python
üì° Using build options features from pyproject.toml
   Compiling pyo3-build-config v0.20.0
   Compiling pyo3-ffi v0.20.0
   Compiling pyo3 v0.20.0
   Compiling maturin_editable v0.1.0 ([WORKSPACE_DIR]/scripts/editable-installs/maturin_editable)
error: linking with `clang` failed: exit status: 1
  |
  = note: env -u IPHONEOS_DEPLOYMENT_TARGET -u TVOS_DEPLOYMENT_TARGET LC_ALL=&quot;C&quot; PATH=&quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/bin:/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpQwDZR9/.venv/bin:/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/bin:[WORKSPACE_DIR]/target/release:/Users/crmarsh/.bun/bin:/opt/homebrew/sbin:/opt/homebrew/bin:/Library/Frameworks/Python.framework/Versions/3.7/bin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Users/crmarsh/.cargo/bin:/Users/crmarsh/.deno/bin:/Users/crmarsh/.poetry/bin:/Users/crmarsh/.pyenv/bin:/Users/crmarsh/bin:/opt/homebrew/bin:/Users/crmarsh/.local/bin:/Users/crmarsh/.antigen/bundles/agkozak/zsh-z:/Users/crmarsh/.antigen/bundles/zsh-users/zsh-syntax-highlighting:/Users/crmarsh/.antigen/bundles/zsh-users/zsh-autosuggestions:/Users/crmarsh/.local/bin&quot; VSLANG=&quot;1033&quot; ZERO_AR_DATE=&quot;1&quot; &quot;clang&quot; &quot;-Wl,-exported_symbols_list,/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/rustcHZzMB2/list&quot; &quot;-arch&quot; &quot;arm64&quot; &quot;/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/rustcHZzMB2/symbols.o&quot; &quot;[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/../../../target/target_install_editable/release/deps/maturin_editable.maturin_editable.ee7895962565d733-cgu.0.rcgu.o&quot; &quot;[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/../../../target/target_install_editable/release/deps/maturin_editable.maturin_editable.ee7895962565d733-cgu.1.rcgu.o&quot; &quot;[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/../../../target/target_install_editable/release/deps/maturin_editable.maturin_editable.ee7895962565d733-cgu.2.rcgu.o&quot; &quot;[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/../../../target/target_install_editable/release/deps/maturin_editable.1pghlbsr7hrzdldh.rcgu.o&quot; &quot;-L&quot; &quot;[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/../../../target/target_install_editable/release/deps&quot; &quot;-L&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libpyo3-fabb9ec73102c1e4.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libmemoffset-0be0e7ae85cfad40.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libparking_lot-a019aaa12f2dbbdb.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libparking_lot_core-402ee42bf33faf36.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libcfg_if-ebd62bc4c95f9afe.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libsmallvec-2399b34ac1bdbdc7.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/liblock_api-c829434f75dfc0e1.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libscopeguard-56416d264ff4d2a6.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libpyo3_ffi-0b0a088518af85fc.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/liblibc-2a600e5bbb3fd567.rlib&quot; &quot;[WORKSPACE_DIR]/target/target_install_editable/release/deps/libunindent-8d530f6225ed1e81.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd-b0083070c892a1db.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libpanic_unwind-8282820217d7b362.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libobject-f163e9d1987a8318.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libmemchr-350512940f04084a.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libaddr2line-e19e4ea986b9addc.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libgimli-363744fff3c4e7ba.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/librustc_demangle-e1d006f163566466.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libstd_detect-dea09910a3b22702.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libhashbrown-4802352fcc77de56.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/librustc_std_workspace_alloc-e71c86d9086176a7.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libminiz_oxide-6d82e7a8c3f5e2c7.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libadler-e66d24d044cc2029.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libunwind-46eaa7bd445cb528.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libcfg_if-3c8a48285a1e7255.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/liblibc-50e20e60add24734.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/liballoc-edb678dd3e28691a.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/librustc_std_workspace_core-3b6c10a2acaa607f.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libcore-2447397acf63b01e.rlib&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libcompiler_builtins-5816c590a0da89c2.rlib&quot; &quot;-liconv&quot; &quot;-lSystem&quot; &quot;-lc&quot; &quot;-lm&quot; &quot;-L&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib&quot; &quot;-o&quot; &quot;[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/../../../target/target_install_editable/release/deps/libmaturin_editable.dylib&quot; &quot;-Wl,-dead_strip&quot; &quot;-dynamiclib&quot; &quot;-Wl,-dylib&quot; &quot;-nodefaultlibs&quot; &quot;-undefined&quot; &quot;dynamic_lookup&quot; &quot;-Wl,-install_name,@rpath/maturin_editable.cpython-312-darwin.so&quot; &quot;-fuse-ld=/Users/crmarsh/workspace/sold/build/ld64&quot;
  = note: mold: fatal: unknown command line option: -undefined
          clang: error: linker command failed with exit code 1 (use -v to see invocation)
          

error: could not compile `maturin_editable` (lib) due to previous error
üí• maturin failed
  Caused by: Failed to build a native library through cargo
  Caused by: Cargo build finished with &quot;exit status: 101&quot;: `env -u CARGO CARGO_ENCODED_RUSTFLAGS=&quot;-C\u{1f}link-arg=-fuse-ld=/Users/crmarsh/workspace/sold/build/ld64&quot; PYO3_ENVIRONMENT_SIGNATURE=&quot;cpython-3.12-64bit&quot; PYO3_PYTHON=&quot;/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpQwDZR9/.venv/bin/python&quot; PYTHON_SYS_EXECUTABLE=&quot;/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpQwDZR9/.venv/bin/python&quot; &quot;/Users/crmarsh/.rustup/toolchains/1.75-aarch64-apple-darwin/bin/cargo&quot; &quot;rustc&quot; &quot;--features&quot; &quot;pyo3/extension-module&quot; &quot;--message-format&quot; &quot;json-render-diagnostics&quot; &quot;--manifest-path&quot; &quot;[WORKSPACE_DIR]/scripts/editable-installs/maturin_editable/Cargo.toml&quot; &quot;--release&quot; &quot;--lib&quot; &quot;--&quot; &quot;-C&quot; &quot;link-arg=-undefined&quot; &quot;-C&quot; &quot;link-arg=dynamic_lookup&quot; &quot;-C&quot; &quot;link-args=-Wl,-install_name,@rpath/maturin_editable.cpython-312-darwin.so&quot;`
Error: command [&#x27;maturin&#x27;, &#x27;pep517&#x27;, &#x27;build-wheel&#x27;, &#x27;-i&#x27;, &#x27;/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpQwDZR9/.venv/bin/python&#x27;, &#x27;--compatibility&#x27;, &#x27;off&#x27;, &#x27;--editable&#x27;] returned non-zero exit status 1
---
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-04 14:00</div>
            <div class="timeline-body"><p>That&#x27;s strange <code>-undefined dynamic_lookup</code> is required to build pyo3 native modules because we can&#x27;t link libpython and the macos toolchain otherwise complains. I&#x27;m surprised nobody reported this upstream yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-04 14:07</div>
            <div class="timeline-body"><p>Could you try the latest version of sold, this has been fixed upstream: <a href="https://github.com/bluewhalesystems/sold/issues/13">bluewhalesystems/sold#13</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-04 16:39</div>
            <div class="timeline-body"><p>@konstin - Will try!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-04 21:57</div>
            <div class="timeline-body"><p>@konstin - I now get:</p>
<pre><code>thread &#x27;sync_editable&#x27; panicked at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library/core/src/ops/function.rs:250:5:
Unexpected failure.
code=1
stderr=``````
Traceback (most recent call last):
  File \&quot;&lt;string&gt;\&quot;, line 1, in &lt;module&gt;
  File \&quot;/Users/crmarsh/workspace/puffin/scripts/editable-installs/maturin_editable/python/maturin_editable/__init__.py\&quot;, line 1, in &lt;module&gt;
    from .maturin_editable import *
ImportError: dlopen(/Users/crmarsh/workspace/puffin/scripts/editable-installs/maturin_editable/python/maturin_editable/maturin_editable.cpython-312-darwin.so, 0x0002): weak-def symbol not found \&#x27;_PyBytes_AsString\&#x27;
</code></pre>
<pre><code>command=`cd &quot;/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpPeRL51&quot; &amp;&amp; &quot;/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/.tmpPeRL51/.venv/bin/python&quot; &quot;-B&quot; &quot;-c&quot; &quot;from maturin_editable import sum_as_string, version\n\nassert version == 1, version\nassert sum_as_string(1, 2) == \&quot;3\&quot;, sum_as_string(1, 2)\n&quot;`
code=1
stdout=&quot;&quot;
stderr=```
Traceback (most recent call last):
  File \&quot;&lt;string&gt;\&quot;, line 1, in &lt;module&gt;
  File \&quot;/Users/crmarsh/workspace/puffin/scripts/editable-installs/maturin_editable/python/maturin_editable/__init__.py\&quot;, line 1, in &lt;module&gt;
    from .maturin_editable import *
ImportError: dlopen(/Users/crmarsh/workspace/puffin/scripts/editable-installs/maturin_editable/python/maturin_editable/maturin_editable.cpython-312-darwin.so, 0x0002): weak-def symbol not found \&#x27;_PyBytes_AsString\&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-05 13:35</div>
            <div class="timeline-body"><p>That&#x27;s also odd, does this python version work e.g. with <code>orjson</code>? I&#x27;ve heard things mentioned about framework builds with brew, but i don&#x27;t have a mac to test myself.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:43:02 UTC
    </footer>
</body>
</html>
