<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluate arbitrary markers to `false` - astral-sh/uv #3681</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Evaluate arbitrary markers to <code>false</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3681">#3681</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-05-20 23:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>See: https://github.com/astral-sh/uv/pull/3679#issuecomment-2121387428.</p>
<p>Closes: https://github.com/astral-sh/uv/issues/3675 (although I think we have another improvement to make there -- will file separately).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ibraheemdev by @charliermarsh on 2024-05-20 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-20 23:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/marker.rs</code>:39 on 2024-05-20 23:39</div>
            <div class="timeline-body"><p>@ibraheemdev -- is this wrong? I was trying to understand the comment here: https://github.com/astral-sh/uv/pull/3679#issuecomment-2121392361</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-20 23:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-resolver/src/marker.rs</code>:39 on 2024-05-20 23:46</div>
            <div class="timeline-body"><p>This sounds right to me fwiw</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-20 23:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/pep508-rs/src/marker.rs</code>:1348 on 2024-05-20 23:48</div>
            <div class="timeline-body"><p>If we always evaluate these to false that means that we will skip any requirement that has unknown marker expressions right? It seems like true would <em>ignore</em> the bad marker which makes more sense?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-20 23:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/pep508-rs/src/marker.rs</code>:1348 on 2024-05-20 23:49</div>
            <div class="timeline-body"><p>&quot;true and warn that it's meaningless&quot; seems like good behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/pep508-rs/src/marker.rs</code>:1348 on 2024-05-21 00:05</div>
            <div class="timeline-body"><p>I believe this was our behavior until very recently (return <code>false</code> here) and is pip's behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-21 00:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-05-21 00:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv-resolver/src/marker.rs</code>:39 on 2024-05-21 00:05</div>
            <div class="timeline-body"><p>Yes, that is correct. However, I wonder if maybe we should be pessimistic regarding forking on meaningless expressions, cc @BurntSushi.</p>
<p>Also if we do make this change, I expected a test to be failing. I think we need to check if <code>expr2</code> is <code>Arbitrary</code> as well, I can make that change in a later PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-21 00:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/pep508-rs/src/marker.rs</code>:1348 on 2024-05-21 00:08</div>
            <div class="timeline-body"><p>To be explicit: I think we should omit requirements that have invalid markers, not include them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> approved on 2024-05-21 00:10</div>
            <div class="timeline-body"><p>I agree with reverting back to our original behavior here, and fine with leaving arbitrary expression forking as an open question.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-21 00:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/marker.rs</code>:39 on 2024-05-21 00:31</div>
            <div class="timeline-body"><p>Okay, think I fixed this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-05-21 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-05-21 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-21 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-21 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-05-21 11:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-resolver/src/marker.rs</code>:39 on 2024-05-21 11:45</div>
            <div class="timeline-body"><p>I'm not fully sure. My instinct is also that we probably ought to be pessimistic on forking here. If we say two arbitrary expressions are disjoint, then we will fork. But logically speaking, if the arbitrary expressions are always false, then, well, I guess that makes sense?</p>
<p>I'm happy to let practice dictate what we do here. (So this is fine for now.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:37:06 UTC
    </footer>
</body>
</html>
