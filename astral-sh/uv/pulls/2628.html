<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add fast build profile without debuginfo - astral-sh/uv #2628</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add fast build profile without debuginfo</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/2628">#2628</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-03-22 23:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2024-03-22 23:12</div>
            <div class="timeline-body"><p>Add a compile option <code>-p fast-build</code> for a 16% incremental compile speedup (linux) at the cost of having no debuginfo.</p>
<p>After trying various rust compiler speedup suggestions, setting mold as my default linker and removing debuginfo are the only ones showing a speedup.</p>
<pre><code>hyperfine --warmup 1 --runs 3 --prepare &quot;touch crates/uv-resolver/src/resolver/mod.rs&quot; \
    &quot;cargo +nightly build --bin uv&quot; \
    &quot;cargo +nightly build --bin uv --profile fast-build&quot;
Benchmark 1: cargo +nightly build --bin uv
  Time (mean ± σ):      1.569 s ±  0.008 s    [User: 1.179 s, System: 0.369 s]
  Range (min … max):    1.560 s …  1.576 s    3 runs

Benchmark 2: cargo +nightly build --bin uv --profile fast-build
  Time (mean ± σ):      1.353 s ±  0.020 s    [User: 1.109 s, System: 0.301 s]
  Range (min … max):    1.338 s …  1.375 s    3 runs

Summary
  cargo +nightly build --bin uv --profile fast-build ran
    1.16 ± 0.02 times faster than cargo +nightly build --bin uv
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2024-03-22 23:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-23 00:02</div>
            <div class="timeline-body"><p>What's the use-case for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-23 01:20</div>
            <div class="timeline-body"><p>Should we use this in CI?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-23 07:49</div>
            <div class="timeline-body"><blockquote>
<p>What's the use-case for this?</p>
</blockquote>
<p>A faster edit-run loop, ideally</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-23 13:35</div>
            <div class="timeline-body"><p>What is the practical cost of having no debug info? (My main pushback here is: who's going to remember to set this? When should they? Should this be the default? Etc.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-25 10:37</div>
            <div class="timeline-body"><p>There were several reports recently about massive speedups for debug builds using advanced or experimental cargo options: Using the parallel frontend, the cranelift backend, static musl, etc. I found that none of them worked for us except using mold (which i have in my global configuration) and removing debuginfo.</p>
<p>This PR adds <code>-p fast-build</code> to cargo commands for a speedup when changing a file i commonly work on. No debuginfo means that tracebacks will be empty and you can't use an debugger on the artifact. Since i need either rarely i find this a free 16% speedup a good tradeoff. I made this a separate profile to avoid confusing people who expect the default debug build to have panic traceback and work with their debuggers.</p>
<blockquote>
<p>Should we use this in CI?</p>
</blockquote>
<p>We have to try! I haven't checked how much it matters for that case</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-03-25 14:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-03-25 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-25 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-03-25 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-25 20:57</div>
            <div class="timeline-body"><p>Lets give it a try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-25 20:57</div>
            <div class="timeline-body"><p>Can I make this my default somehow?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-26 11:15</div>
            <div class="timeline-body"><blockquote>
<p>Can I make this my default somehow?</p>
</blockquote>
<p>Except for aliases, i don't think so unfortunately</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:49:26 UTC
    </footer>
</body>
</html>
