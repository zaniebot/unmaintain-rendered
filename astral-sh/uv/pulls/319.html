<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Require URL dependencies to be declared upfront - astral-sh/uv #319</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Require URL dependencies to be declared upfront</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/319">#319</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-11-04 19:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>In the resolver, our current model for solving URL dependencies requires that we visit the URL dependency <em>before</em> the registry-based dependency. This PR encodes a strict requirement that all URL dependencies be declared upfront, either as requirements or constraints.</p>
<p>I wrote more about how it works and why it's necessary in documentation <a href="https://github.com/astral-sh/puffin/pull/319/files#diff-2b1c4f36af0c62a2b7bebeae9473ae083588f2a6b18a3ec52393a24266adecbbR20">here</a>. I think we could relax this constraint over time, but it requires a more sophisticated model -- and for now, I just want something that's (1) correct, (2) easy for us to reason about, and (3) easy for users to reason about.</p>
<p>As additional motivation... allowing arbitrary URL dependencies anywhere in the tree creates some really confusing situations in which I'm not even sure what the right answers are. For example, assume you declare a direct dependency on <code>Werkzeug==2.0.0</code>. You then depend on a version of Flask that depends on a version of <code>Werkzeug</code> from some arbitrary URL. You build the source distribution at that arbitrary URL, and it turns out it <em>does</em> build to a declared version of 2.0.0. What should happen? (And if it resolves to a version that <em>isn't</em> 2.0.0, what should happen <em>then</em>?) I suspect different tools handle this differently, but it must lead to a lot of &quot;silent&quot; failures. In my testing of Poetry, it seems like Poetry just ignores the URL dependency, which seems wrong, but is also a behavior we could implement in the future.</p>
<p>Closes https://github.com/astral-sh/puffin/issues/303.
Closes https://github.com/astral-sh/puffin/issues/284.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-04 19:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/pubgrub/mod.rs</code>:22 on 2023-11-04 19:51</div>
            <div class="timeline-body"><p>This was all moved into the new <code>PubGrubDependencies</code> struct (and modified).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-04 19:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/resolver.rs</code>:137 on 2023-11-04 19:52</div>
            <div class="timeline-body"><p>This isn't necessary -- we end up visiting this immediately after anyway by way of visiting the <code>Root</code> package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2023-11-04 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2023-11-04 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-04 19:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-cli/tests/snapshots/pip_compile__conflicting_direct_url_dependency.snap</code>:19 on 2023-11-04 19:55</div>
            <div class="timeline-body"><p>Bad error message, sigh...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-resolver/src/pubgrub/package.rs</code>:49 on 2023-11-05 16:59</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        /// even clear. For example, imagine that you define a direct dependency on Werkzeug, and
</code></pre>
<p>also below</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-11-05 17:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/pubgrub/package.rs</code>:49 on 2023-11-05 17:07</div>
            <div class="timeline-body"><p>FYI WerkZeug means tool in German.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-05 17:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-11-05 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-05 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-05 17:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:34:39 UTC
    </footer>
</body>
</html>
