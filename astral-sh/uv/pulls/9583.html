<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add documentation on using dependencies from private GitLab package indexes - astral-sh/uv #9583</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add documentation on using dependencies from private GitLab package indexes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/9583">#9583</a>
        opened by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a>
        on 2024-12-02 19:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rafalkrupinski">@rafalkrupinski</a></div>
            <div class="timeline-body"><p>Doc change: adding a section on using dependncies from a GitLab package index.</p>
<p>Relates to #9331</p>
<p>Could mention using explicit source configuration as GitLab may be configured as a proxy to the official PyPI, but I see other sections don't include anything more than strictly necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-12-02 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-12-03 02:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 02:22</div>
            <div class="timeline-body"><p>It might be preferred to suggest using <a href="https://docs.astral.sh/uv/configuration/environment/#uv_index_name_username">UV_INDEX_{name}_USERNAME</a> and <a href="https://docs.astral.sh/uv/configuration/environment/#uv_index_name_password">UV_INDEX_{name}_PASSWORD</a> for the credentialed pieces.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> reviewed on 2024-12-03 07:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 07:52</div>
            <div class="timeline-body"><p>Yeah, that too. With credentials but without token name in URL, uv will first try unauthroized request, receive 404 and cry uncle. I'll reword it for better clarity. Any suggestions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Raymi306">@Raymi306</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 14:13</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/blob/81569c47bfa91b24ff0712baf1c001ef9604676e/crates/uv-auth/src/middleware.rs#L148-L160</p>
<p>Are you sure the 404 is the problem?  It is explicitly one of the status codes that UV will retry with auth for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Raymi306">@Raymi306</a> reviewed on 2024-12-03 14:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> reviewed on 2024-12-03 14:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 14:24</div>
            <div class="timeline-body"><p>What I'm sure is that adding token name fixes the issue described in the linked report. Take a look at the logs I've linked there. @zanieb seems to know the underlying cause.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Raymi306">@Raymi306</a> reviewed on 2024-12-03 14:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Raymi306">@Raymi306</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 14:36</div>
            <div class="timeline-body"><p>For what it is worth I ran into a very similar issue to the one that you had in terms of uv output, and determined that a strangely configured python package index was returning 200 with no auth, and not listing any versions unless auth was provided.  I may try to implement one of the configuration options discussed in your issue and raise a PR, but I am hoping that I can get the creator of the index I need to use at work to simply fix the probable permissions issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-03 14:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 14:39</div>
            <div class="timeline-body"><p>Adding the token name fixes it because we skip trying an unauthenticated request.</p>
<p>My earlier comments were incorrect regarding the 404, thanks @Raymi306 for pointing that out â€” we will search for credentails on a 404. It looks like GitLab is actually returning an okay response? The relevant logs being:</p>
<pre><code>TRACE No credentials in cache for URL https://gitlab.com/api/v4/groups/${ID}/-/packages/pypi/simple/livity-airtable/
TRACE Attempting unauthenticated request for https://gitlab.com/api/v4/groups/${ID}/-/packages/pypi/simple/livity-airtable/
TRACE cached request https://gitlab.com/api/v4/groups/${ID}/-/packages/pypi/simple/livity-airtable/ is storable because its response has a 'public' cache-control directive
TRACE Received package metadata for: livity-airtable
TRACE Selecting candidate for livity-airtable with range * with 0 remote versions
</code></pre>
<p>Sorry for misleading you there, I'm not sure why I thought we only retried on 401..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> reviewed on 2024-12-03 15:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 15:23</div>
            <div class="timeline-body"><p>Cool, thanks for clearing it out.</p>
<blockquote>
<p>strangely configured python package index was returning 200</p>
</blockquote>
<p>Hmm, the free gitlab.com offering has only one config option in the package registry - forwarding requests to PyPI. It actually might be the issue. I'll investigate it further.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-03 15:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/guides/integration/alternative-indexes.md</code>:181 on 2024-12-03 15:32</div>
            <div class="timeline-body"><p>Thanks @rafalkrupinski!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotk">@timotk</a> on 2025-01-09 13:59</div>
            <div class="timeline-body"><p>@rafalkrupinski I would prefer the use of a <code>.netrc</code> file. Using the following command, <code>uv</code> will modify the <code>pyproject.toml</code> for you:</p>
<pre><code class="language-shell">uv add &lt;INTERNAL-PACKAGE&gt; --index gitlab=https://{GITLAB_HOST}/api/v4/projects/{PROJECT_ID}/packages/pypi/simple
</code></pre>
<p>The <code>~/.netrc</code> will look like this:</p>
<pre><code>machine myorganization.gitlab.host
login __token__
password &lt;your_token&gt;
</code></pre>
<p>or with <code>gitlab.com</code>:</p>
<pre><code>machine gitlab.com
login __token__
password &lt;your_token&gt;
</code></pre>
<p>Each user only needs to set up <code>~/.netrc</code> once. And you don't have to use environment variables.</p>
<p>I explain more <a href="https://xebia.com/blog/how-to-install-python-packages-from-an-internal-package-registry-with-uv/">here</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> on 2025-01-09 15:45</div>
            <div class="timeline-body"><p>I do need to use environment variables in CI tho</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> on 2025-01-09 16:24</div>
            <div class="timeline-body"><p>@timotk I don't see any documentation on the &quot;gitlab=&quot; part of URL. is it something new?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 17:45</div>
            <div class="timeline-body"><p>@rafalkrupinski that's part of the index API (https://docs.astral.sh/uv/configuration/indexes/)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> on 2025-01-09 18:30</div>
            <div class="timeline-body"><p>Oh, OK, it's the name of index, not kind. So does UV now know how to handle GitLab idiosyncrasies? For me it didn't work because of request forwarding in gitlab index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rafalkrupinski">@rafalkrupinski</a> on 2025-01-09 18:46</div>
            <div class="timeline-body"><p>@zanieb You just wanted to link to your barely related article, didn't you. This is off-topic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-16 14:58</div>
            <div class="timeline-body"><p>I think this is stale now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-16 14:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:40:53 UTC
    </footer>
</body>
</html>
