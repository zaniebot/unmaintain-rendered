<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: more rust in trampoline - astral-sh/uv #5750</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: more rust in trampoline</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/5750">#5750</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2024-08-03 14:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-03 14:43</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is an experimental PR to replace more unsafe calls with more rust while still trying to keep the binary size small enough. These changes roughly increase the size of the trampolines to about 40kb~. This is a alternate PR to https://github.com/astral-sh/uv/pull/5751.</p>
<p>The primary changes here include</p>
<ul>
<li>Switch to use rust path components for ease of path management</li>
<li>Leverage <code>std::process::exit</code> for process exit and cleanup</li>
<li>Use <code>std::io::Error::last_os_error</code> for IO Errors to remove <code>FormatMessage</code> complexity</li>
<li>Use <code>std::env::current_exe</code> to get the current executable instead of <code>GetModuleFileNameA</code></li>
</ul>
<h2>Test Plan</h2>
<p>Added one more existing test case to trampoline tests.
Still need to verify dunce::canonicalize is desired or not on find_python_exe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-03 14:48</div>
            <div class="timeline-body"><p>CC @konstin since you already pre-reviewed some of the changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-08-05 09:59</div>
            <div class="timeline-body"><p>On my machine the wheel goes from 11798922 bytes to 11827535 bytes, a 0.2% increase so totally fine size wise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-08-05 10:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @samypr100 on 2024-08-06 23:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-08-07 08:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-08-07 08:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-08 02:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:32:10 UTC
    </footer>
</body>
</html>
