<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change arbitrary comment in `marker.rs` - astral-sh/uv #3679</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Change arbitrary comment in <code>marker.rs</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/3679">#3679</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-05-20 23:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>My read of the code is that these are always evaluated to <code>true</code>, such that they're effectively ignored?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @charliermarsh on 2024-05-20 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2024-05-20 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @ibraheemdev by @charliermarsh on 2024-05-20 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2024-05-20 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 23:17</div>
            <div class="timeline-body"><p>I don't know if this is the right behavior though. Is it intended?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-20 23:20</div>
            <div class="timeline-body"><p>Agree with your read of the code. Also unsure which behavior makes sense. Motivated by https://github.com/astral-sh/uv/issues/3675 I presume?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 23:22</div>
            <div class="timeline-body"><p>Yeah. There's another issue though, that marker shouldn't be parsing to <code>Arbitrary</code> (it's valid) but it is currently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-20 23:24</div>
            <div class="timeline-body"><p>I think this is a bug introduced by https://github.com/astral-sh/uv/pull/3520. The old behavior was to evaluate to <code>false</code>: https://github.com/astral-sh/uv/blob/0.1.43/crates/pep508-rs/src/marker.rs#L939, except in <code>evaluate_extras_and_python_version</code>. I think @konstin pointed the documentation mistake out but I didn't fix the behavior to match the previous implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-20 23:25</div>
            <div class="timeline-body"><p>Was https://github.com/astral-sh/uv/issues/3675 a bug introduced by https://github.com/astral-sh/uv/pull/3520?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 23:25</div>
            <div class="timeline-body"><p>Oh ok. I can change it then unless you want to?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 23:26</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/issues/3675 may have been inadvertently triggered by #3520, but there's a real limitation -- we don't respect <code>in</code> with version comparators (which is technically allowed). So it's evaluating to <code>Arbitrary</code>. Perhaps this previously evaluated to <code>false</code> but now evaluates to <code>true</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 23:27</div>
            <div class="timeline-body"><p>I was gonna add support for <code>in</code> with version operators.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-20 23:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-20 23:30</div>
            <div class="timeline-body"><p>Fine with you making the change. Can also add a little comment to https://github.com/ibraheemdev/uv/blob/26e4805f1c631cc236718bbf8a2b85570da8e695/crates/uv-resolver/src/marker.rs#L38 that explains that <code>Arbitrary</code> expressions always evaluate to <code>true</code> and so cannot be disjoint.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 23:30</div>
            <div class="timeline-body"><p>Sure thing. Will tag you on review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-20 23:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:37:06 UTC
    </footer>
</body>
</html>
