<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rework --clear flag for venv command - astral-sh/uv #1824</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rework --clear flag for venv command</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/1824">#1824</a>
        opened by <a href="https://github.com/flyaroundme">@flyaroundme</a>
        on 2024-02-21 18:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/flyaroundme">@flyaroundme</a></div>
            <div class="timeline-body">

Summary
<p>Reworked the --clear flag for venv command for it not to recreate the existing virtualenv unless --clear flag is set.</p>
<p>Based on this discussion <a href="https://github.com/astral-sh/uv/issues/1472">astral-sh/uv#1472</a></p>
Test Plan
<p>Create venv using <code>uv venv</code> command. Then use <code>uv venv</code> command again without flag. Check that virtualenv is not cleared. Then use <code>uv venv --clear</code>, check that it is recreated.</p>
<pre><code>$ uv venv
Using Python 3.10.12 interpreter at /usr/bin/python3.10
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate
$ uv pip install ruff # fill virtualenv with something
Resolved 1 package in 141ms
Installed 1 package in 21ms
 + ruff==0.2.2
$ uv pip freeze # memorize the previous state of virtualenv
ruff==0.2.2
$ uv venv # without flag
Using Python 3.10.12 interpreter at /usr/bin/python3.10
Virtualenv already exists at .venv. Use --clear option to recreate
$ uv pip freeze # check that virtualenv is not cleared
ruff==0.2.2
$ uv venv --clear # with flag
Using Python 3.10.12 interpreter at /usr/bin/python3.10
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate
$ uv pip freeze # check virtualenv is cleared
$
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by <a href="https://github.com/flyaroundme">@flyaroundme</a> on 2024-02-21 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/T-256">@T-256</a> reviewed on 2024-02-22 12:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/T-256">@T-256</a> on <code>crates/uv/src/commands/venv.rs</code>:126 on 2024-02-22 12:53</div>
            <div class="timeline-body"><p>I&#x27;d rather to fail with non-zero exit code.
Also, message could be more strict since the command failing:</p>
<pre><code>Failed to create virtualenv at &#x27;{}&#x27;: Already exists.
hint: Use --clear option to force recreate new virtualenv at {}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2024-02-25 17:57</div>
            <div class="timeline-body"><p>IMO, We could also consider <code>--force</code> instead of <code>--clear</code> to also fix #1863 where target path is exists but is not venv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-22 21:16</div>
            <div class="timeline-body"><p>Quite a bit of discussion about this over in <a href="https://github.com/astral-sh/uv/pull/2548">astral-sh/uv#2548</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/flyaroundme">@flyaroundme</a> on 2024-05-02 00:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:43:50 UTC
    </footer>
</body>
</html>
