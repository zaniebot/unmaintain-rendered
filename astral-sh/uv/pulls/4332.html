<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for toolchain requests by key - astral-sh/uv #4332</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for toolchain requests by key</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4332">#4332</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-06-14 20:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Adds support for toolchain keys e.g. <code>cpython-3.11.2-macos</code> allowing you to download toolchains for specific architectures and operating systems using the format we use to uniquely identify a toolchain.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-06-14 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @zanieb on 2024-06-14 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-toolchain/src/interpreter.rs</code>:237 on 2024-06-17 08:21</div>
            <div class="timeline-body"><p>The prefix differentiates it from the implementation version</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-toolchain/src/toolchain.rs</code>:209 on 2024-06-17 08:25</div>
            <div class="timeline-body"><p>Would this currently panic if i had graalpython installed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-toolchain/src/toolchain.rs</code>:293 on 2024-06-17 08:27</div>
            <div class="timeline-body"><p>Are these <code>with_</code> methods used?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-06-17 08:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 14:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/interpreter.rs</code>:237 on 2024-06-17 14:37</div>
            <div class="timeline-body"><p>Ah that's good to know but we don't expose the <code>implementation_version</code> at the top level and I found this confusing because <code>python_version</code> meant the &quot;marker&quot; in some cases which didn't have the full version tuple. I'll think about this a bit harder though (and perhaps change it in a dedicated pull request for discussion purposes).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 14:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/toolchain.rs</code>:209 on 2024-06-17 14:38</div>
            <div class="timeline-body"><p>Probably. I need to address this before merge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 14:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/toolchain.rs</code>:293 on 2024-06-17 14:38</div>
            <div class="timeline-body"><p>Probably not, they're copied from the <code>PythonVersionRequest</code>. I'll drop them if not. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 14:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/interpreter.rs</code>:237 on 2024-06-17 14:43</div>
            <div class="timeline-body"><p>Why do we have a <code>Interpreter::python_full_version</code> method there too? It seems like that just captures the string?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-06-17 15:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-toolchain/src/interpreter.rs</code>:237 on 2024-06-17 15:40</div>
            <div class="timeline-body"><p>iirc that the method were named after PEP 508 environments, hence the <code>python_version</code> and <code>python_full_version</code> keys</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 15:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/interpreter.rs</code>:237 on 2024-06-17 15:50</div>
            <div class="timeline-body"><p>But they're the same here and different elsewhere. ü§∑‚Äç‚ôÄÔ∏è</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 15:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/interpreter.rs</code>:237 on 2024-06-17 15:50</div>
            <div class="timeline-body"><p>Reverting this change for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-06-17 16:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-toolchain/src/interpreter.rs</code>:237 on 2024-06-17 16:11</div>
            <div class="timeline-body"><p>Might totally be outdated and needs to change</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:625 on 2024-06-17 16:44</div>
            <div class="timeline-body"><p>Maybe... <code>result.map_or(true, |(_, interpreter)| request.satisfied_by_interpreter(interpreter))</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-toolchain/src/downloads.rs</code>:331 on 2024-06-17 16:46</div>
            <div class="timeline-body"><p>This is nice. I like it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-06-17 16:46</div>
            <div class="timeline-body"><p>I like this feature!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 16:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:625 on 2024-06-17 16:50</div>
            <div class="timeline-body"><p>This feels familiar :) will do</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 16:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/downloads.rs</code>:331 on 2024-06-17 16:50</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 16:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:625 on 2024-06-17 16:52</div>
            <div class="timeline-body"><p>This seems... less clear sometimes?</p>
<pre><code class="language-diff">diff --git a/crates/uv-toolchain/src/discovery.rs b/crates/uv-toolchain/src/discovery.rs
index 8dbec984..d6bb224b 100644
--- a/crates/uv-toolchain/src/discovery.rs
+++ b/crates/uv-toolchain/src/discovery.rs
@@ -619,9 +619,10 @@ pub fn find_toolchains&lt;'a&gt;(
             debug!(&quot;Searching for {request} in {sources}&quot;);
             python_interpreters(request.version(), request.implementation(), sources, cache)
                 .filter(move |result| result_satisfies_system_python(result, system))
-                .filter(|result| match result {
-                    Err(_) =&gt; true,
-                    Ok((_source, interpreter)) =&gt; request.satisfied_by_interpreter(interpreter),
+                .filter(|result| {
+                    result.as_ref().map_or(true, |(_, interpreter)| {
+                        request.satisfied_by_interpreter(interpreter)
+                    })
                 })
                 .map(|result| result.map(Toolchain::from_tuple).map(ToolchainResult::Ok))
         }),
</code></pre>
<p>Somehow it feels more verbose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 16:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/implementation.rs</code>:33 on 2024-06-17 16:53</div>
            <div class="timeline-body"><p>Is there a standard pattern or name for this? @BurntSushi</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 16:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/implementation.rs</code>:33 on 2024-06-17 16:54</div>
            <div class="timeline-body"><p>I guess the capitalized version is the &quot;display name&quot; but much more often want the lowercase string, should I be doing lowercase casts all over the place instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @zanieb on 2024-06-17 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-06-17 17:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:625 on 2024-06-17 17:00</div>
            <div class="timeline-body"><p>I think I'd still go <code>map_or</code> but honestly it's dealer's choice. I'm not <em>too much</em> of a combinator snob.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-toolchain/src/implementation.rs</code>:33 on 2024-06-17 17:05</div>
            <div class="timeline-body"><p>Hmmmmmmmmm.</p>
<p>Usually you'd have a <code>Display</code> impl here somewhere, but given that you can return a <code>&amp;'static str</code>, that's usually a bit nicer to work with.</p>
<p>If there were only one sensible string representation, then I think I'd call this <code>as_str</code>.</p>
<p>If there is a sensible &quot;default&quot; representation that should be used in almost all cases and another representation that is used less frequently, then I think I'd call the default <code>as_str</code> and the other something more descriptive, like, <code>as_str_capitalized</code> or something.</p>
<p>If there is no obvious default, I think I'd just be descriptive with both names. Like, <code>as_str_lowercase</code> and <code>as_str_capitalized</code>. Or something like that.</p>
<p>With that said, I don't mind <code>pretty</code> either.</p>
<p>Something bothers me about having one form be a concrete method and another form be a <code>From</code> impl. I can't quite articulate it, but it seems a little confusing. Like, it would be easy to see one but not the other. You could add concrete methods for both, and then add a <code>From</code> impl with whatever the &quot;default&quot; is I guess.</p>
<p>I think overall the right thing to do here depends a lot on how these are used and whether there's a clear default or whatever.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-06-17 17:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-17 17:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/implementation.rs</code>:33 on 2024-06-17 17:15</div>
            <div class="timeline-body"><p>Thanks for all the context! We do have a <code>Display</code> representation which is the lowercase name right now. I used to have <code>as_str</code> for the capitalized name but changed it. Maybe I'll change it back... I think it's probably better to consider outside this pull request though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-06-17 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-06-17 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-17 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-06-17 18:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv-toolchain/src/discovery.rs</code>:625 on 2024-06-17 18:13</div>
            <div class="timeline-body"><p>I'd prefer <code>.map(..).unwrap_or(true)</code> to <code>map_or</code>, tends to be clearer, but the <code>match</code> might end up being less verbose.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:37:34 UTC
    </footer>
</body>
</html>
