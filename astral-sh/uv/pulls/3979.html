<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: support `NO_COLOR` and `FORCE_COLOR` env vars - astral-sh/uv #3979</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: support <code>NO_COLOR</code> and <code>FORCE_COLOR</code> env vars</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3979">#3979</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2024-06-03 02:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a></div>
            <div class="timeline-body">Summary
<p>Closes #3955</p>
<p>Adds explicit support to <code>NO_COLOR</code> and <code>FORCE_COLOR</code> via GlobalSettings.</p>
<p>The order, per specs is now <code>NO_COLOR</code> &gt; <code>FORCE_COLOR</code> &gt; <code>color</code>.</p>
<p>This PR is a backup plan pending rust-cli/anstyle#192.</p>
Test Plan
<p>Tested all cases locally for now; I didn&#x27;t see existing tests for GlobalSettings parsing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-06-03 02:54</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/uv/branches/samypr100:adjust-color-settings">CodSpeed Performance Report</a>
Merging #3979 will <strong>not alter performance</strong>
<p>Comparing <code>samypr100:adjust-color-settings</code> (affba38) with <code>main</code> (40e0ddd)</p>
Summary
<p><code>âœ… 13</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-03 13:22</div>
            <div class="timeline-body"><p>Should we add <code>CLICOLOR_FORCE</code> as well so that it&#x27;s respected over the color CLI argument?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-03 13:22</div>
            <div class="timeline-body"><p>I&#x27;m fine to merge this regardless of anstream changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-06-03 18:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>crates/uv/src/cli.rs</code>:74 on 2024-06-03 18:42</div>
            <div class="timeline-body"><p>Implementation wise, I find this dubious to have hidden arguments for pulling in environment variables.  Is this a standard practiced in Ruff?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-03 19:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/cli.rs</code>:74 on 2024-06-03 19:12</div>
            <div class="timeline-body"><p>No, in Ruff IIRC we use <code>colored</code>. It detects some of these for us, and then we check for <code>FORCE_COLOR</code> with:</p>
<pre><code>// support FORCE_COLOR env var
if let Some(force_color) = std::env::var_os(&quot;FORCE_COLOR&quot;) {
    if force_color.len() &gt; 0 {
        colored::control::set_override(true);
    }
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-04 00:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/cli.rs</code>:74 on 2024-06-04 00:08</div>
            <div class="timeline-body"><p>@samypr100 - Let&#x27;s change to read these env vars directly, I think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-06-04 00:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>crates/uv/src/cli.rs</code>:74 on 2024-06-04 00:17</div>
            <div class="timeline-body"><p>I think i saw a reference to uv using anstream. The equivalent of <code>colored</code> for setting the global is https://docs.rs/anstream/latest/anstream/enum.ColorChoice.html#method.write_global</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-04 00:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/cli.rs</code>:74 on 2024-06-04 00:28</div>
            <div class="timeline-body"><p>That&#x27;s right, we use anstream in uv, but colored in Ruff!</p>
<p>We actually looked at migrating Ruff to anstream: <a href="https://github.com/astral-sh/ruff/pull/10784">astral-sh/ruff#10784</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-06-04 02:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/cli.rs</code>:74 on 2024-06-04 02:08</div>
            <div class="timeline-body"><blockquote>
<p>@samypr100 - Let&#x27;s change to read these env vars directly, I think?</p>
</blockquote>
<p>Done in 1c451f6d44c9e99b8af699e736e36dc09c17c27f</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>crates/uv/src/settings.rs</code>:54 on 2024-06-04 02:08</div>
            <div class="timeline-body"><p>NO_COLOR says it should not be an empty string.  Same with FORCE_COLOR.  CLICOLOR <em>says</em> it should just be set but the example Python code checks that its non-empty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-06-04 02:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-06-04 02:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/settings.rs</code>:54 on 2024-06-04 02:15</div>
            <div class="timeline-body"><p>Good point, I was looking at https://github.com/python/cpython/blob/3.13/Lib/_colorize.py#L53 too much</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-06-04 02:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/settings.rs</code>:54 on 2024-06-04 02:33</div>
            <div class="timeline-body"><p>affba38815b1b4535dab9a6211f211a24c316f61, is this more along the lines of what you were thinking? @epage</p>
<p>Thanks for the review btw.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-04 14:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/cli.rs</code>:74 on 2024-06-04 14:46</div>
            <div class="timeline-body"><p>Thanks Ed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-06-04 19:51</div>
            <div class="timeline-body"><p>@samypr100 - This looks good to me. Ok to merge?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/samypr100">@samypr100</a> on 2024-06-04 20:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-04 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-04 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-04 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-04 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-04 21:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-06-05 15:53</div>
            <div class="timeline-body"><p>The way I read the examples on those two pages, https://force-color.org/ http://no-color.org/  they both suggest that command line flags that turn on color should have precedence over NO_COLOR.  i.e &quot;do getopt(3) and/or config-file parsing to possibly turn color back on&quot; and so on.  Not sure if I&#x27;m confusing myself, or if there are contradicting specs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-06-05 16:18</div>
            <div class="timeline-body"><p>@bluss They&#x27;re examples, not the standard. The standard itself (the sentence at the top of the pages) doesn&#x27;t go into detail on how they are meant to interact with each other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/webknjaz">@webknjaz</a> on 2025-05-05 12:49</div>
            <div class="timeline-body"><p>@samypr100 I was trying to untangle that interaction problem because Rich happened to break some expectations and ended up getting another var called <code>TTY_COMPATIBLE</code> implemented over there: <a href="https://github.com/donatj/force-color.org/issues/8">donatj/force-color.org#8</a>#issuecomment-2850408360. If it takes off, this would be something to take into account too.</p>
<p>Does the toggle in this PR influence non-color text decorations, by the way?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:45:40 UTC
    </footer>
</body>
</html>
