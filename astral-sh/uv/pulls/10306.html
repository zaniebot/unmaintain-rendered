<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>added aarch64 build binary for windows - astral-sh/uv #10306</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>added aarch64 build binary for windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/10306">#10306</a>
        opened by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a>
        on 2025-01-05 19:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-05 19:51</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Adds an aarch64 windows build to build for windows on arm. Addresses: #1141</p>
<h2>Test Plan</h2>
<p>I build uv for windows aarch64 locally by running <code>cargo build --target aarch64-pc-windows-msvc</code>, it worked.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-05 19:57</div>
            <div class="timeline-body"><p>For some reason the &quot;Approve workflow&quot; button is missing ‚Äî some GitHub bug. I'll push an empty commit to trigger the run.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-05 19:59</div>
            <div class="timeline-body"><p><img width="1795" alt="Screenshot 2025-01-05 at 13 59 03" src="https://github.com/user-attachments/assets/cbb878e8-4547-4650-aa8c-24a10bacacc4" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-05 20:05</div>
            <div class="timeline-body"><p>@zanieb sorry about that, idk how that got there, fixed it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @charliermarsh on 2025-01-05 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">releases</span> added by @charliermarsh on 2025-01-05 20:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-05 20:09</div>
            <div class="timeline-body"><p>@zanieb
<img src="https://github.com/user-attachments/assets/dbac94f8-3ab8-4dd1-b3ea-c531d5b582c8" alt="image" />
I will remove the dev drive, and try again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-05 20:15</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/actions/runs/12622606852/job/35170731355</p>
<p><img src="https://github.com/user-attachments/assets/da8058f9-f4b8-4eac-9702-cbc19b3719e0" alt="image" /></p>
<p><code>Swatinem/rust-cache@v2</code> failed. I will try to find one compatible with windows aarch64 in the morning, if you have any pointers, let me know, thanks üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-05 20:18</div>
            <div class="timeline-body"><p>I don't think the runner has rust/cargo installed, since rustc -vV should not have failed. Is this an issue in the runner setup @zanieb?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-05 20:29</div>
            <div class="timeline-body"><p>Interesting. It looks like the aarch64 runner image is missing a bunch of the tools present on the x86_64 runners. Not much to do there but install what we need, I guess. I'd look for other people using the runner online and see if they have some standard setup we can copy.</p>
<p>(I did not have alternative image options when setting up the runner)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-05 20:33</div>
            <div class="timeline-body"><p>I tried https://github.com/dtolnay/rust-toolchain but it failed with <code>bash not found</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-05 21:36</div>
            <div class="timeline-body"><p>More context</p>
<ul>
<li>https://github.com/dtolnay/rust-toolchain/issues/124</li>
<li>https://github.com/actions/runner-images/issues/10479</li>
<li>https://github.com/dennisameling/azure-arm64-templates/blob/main/post-deployment-script.ps1</li>
<li>https://github.com/actions/runner-images/issues/768#issuecomment-2332882721</li>
<li>https://github.com/actions/partner-runner-images/issues/19</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-07 06:03</div>
            <div class="timeline-body"><p>I am trying to get clang working, its almost there, it fails while building ring, with
<code>cargo:warning=Compiler family detection failed due to error: ToolNotFound: Failed to find tool. Is `clang` installed? (see https://docs.rs/cc/latest/cc/#compile-time-requirements for help)</code></p>
<p>I had the same issue with my local, I had to add VS component for clang, I tried adding that no luck, will try again in a while.</p>
<p>Doc: https://learn.microsoft.com/en-us/visualstudio/install/workload-component-id-vs-build-tools?view=vs-2022</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-08 04:44</div>
            <div class="timeline-body"><p>I'm impressed by your perseverance :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-08 05:18</div>
            <div class="timeline-body"><p>Not sure if perseverance or sunk-cost fallacy, but thanks :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-08 06:19</div>
            <div class="timeline-body"><p><img src="https://github.com/user-attachments/assets/feeca376-bda0-43c3-a753-4596c6a0e1dc" alt="image" /></p>
<p>@zanieb 19th try is the charm üéâ Here is the run: https://github.com/astral-sh/uv/actions/runs/12664851516/job/35293615729, I downloaded the exe from:</p>
<pre><code>Artifact download URL: https://github.com/astral-sh/uv/actions/runs/12664851516/artifacts/2399688891
</code></pre>
<p>Its working fine on my snapdragon x-elite windows aarch 64:
<img src="https://github.com/user-attachments/assets/b33b0be2-0b0d-4fe2-a066-fe4a01c14ccc" alt="image" /></p>
<p>2 questions:</p>
<ol>
<li>Do we need <code>- uses: Swatinem/rust-cache@v2</code> I am assuming it had something to do with the dev directory that didn't attach with aarch64 worker, so maybe its useless? Where will the cache persist if there is no disk?</li>
<li>Why are we not doing <code>cargo build --release</code>?</li>
</ol>
<p>Let me know if there are any tests you want me to run/add to the CI! Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-08 17:12</div>
            <div class="timeline-body"><blockquote>
<p>Do we need - uses: Swatinem/rust-cache@v2 I am assuming it had something to do with the dev directory that didn't attach with aarch64 worker, so maybe its useless? Where will the cache persist if there is no disk?</p>
</blockquote>
<p>Let me look at the logs.</p>
<blockquote>
<p>Why are we not doing cargo build --release?</p>
</blockquote>
<p>This is our &quot;regular&quot; CI that runs on every pull request for testing. There's a <em>separate</em> workflow that build release binaries for distribution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-08 17:50</div>
            <div class="timeline-body"><p>@zanieb do you want me to add the tests that are there for x86 to aarch64?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-08 17:51</div>
            <div class="timeline-body"><p>@kalradivyanshu that'd be great!</p>
<p>I'm looking into making things faster over in #10402</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-08 17:53</div>
            <div class="timeline-body"><p>Yes, it currently takes 25 mins, which is insane tbh. Also I will rename the windows step to windows-x86 to match macOS naming.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 14:44</div>
            <div class="timeline-body"><p>It looks like we'll have to hold off on those failing system checks and integration tests until this runner is better supported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 14:44</div>
            <div class="timeline-body"><p>Wdyt of https://github.com/astral-sh/uv/pull/10402#issuecomment-2579012940</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-09 15:04</div>
            <div class="timeline-body"><p>@zanieb I will try to get clang to work w/o using Native desktop.</p>
<blockquote>
<p>I think it might be worth it to only use the native ARM64 runner in a release CI, Rust can use --target aarch64... just fine on x86_64 hosts and this whole &quot;&gt;10 min CI just for getting a the bare minimum setup to compile rust&quot; is kind of just burning money for no upside.</p>
</blockquote>
<p>But also, I agree with this? I feel like <code>uv</code> is mostly depend on rust, and rust toolchain is giving aarch64 support on x86 means they have tested it, so that might cut our build time by a lot? Why do you think it might lead to issues down the road?</p>
<p>Also, i ran tests yesterday, many failed, will fix those in coming days.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 17:17</div>
            <div class="timeline-body"><blockquote>
<p>But also, I agree with this? I feel like uv is mostly depend on rust, and rust toolchain is giving aarch64 support on x86 means they have tested it, so that might cut our build time by a lot? Why do you think it might lead to issues down the road?</p>
</blockquote>
<p>It might make sense to put up a separate pull request that just cross-compiles the binary then? We won't be able to test it, but at least we can say &quot;it builds&quot; in regular CI then follow by adding it tot he release process.</p>
<p>My concern with</p>
<blockquote>
<p>I think it might be worth it to only use the native ARM64 runner in a release CI</p>
</blockquote>
<p>was that if we're not testing the build in CI the same way we do for releases, we can regress accidentally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-09 17:44</div>
            <div class="timeline-body"><blockquote>
<p>It might make sense to put up a separate pull request that just cross-compiles the binary then? We won't be able to test it, but at least we can say &quot;it builds&quot; in regular CI then follow by adding it tot he release process.</p>
</blockquote>
<p>I was thinking in this PR only, we add the aarch64 build via x86, and then run all the tests on aarch64, that way, we should be good, we can say it builds and passes all the tests in aarch64?</p>
<blockquote>
<p>was that if we're not testing the build in CI the same way we do for releases, we can regress accidentally.</p>
</blockquote>
<p>This makes sense, but if all the tests pass, we can build it for release in x86 only, it will be cheaper and faster, I think microsoft is pushing for windows on ARM so a proper aarch64 runner shouldn't be far away, then we can just have build on aarch64 too.</p>
<p>If that works for you I can start testing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 18:04</div>
            <div class="timeline-body"><p>Yeah I think we're aligned here. I'm also happy to just have the cross-build working then tackle testing in follow-up pull requests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 18:04</div>
            <div class="timeline-body"><p>(I suggested a separate PR for the cross-build approach so we can retain all the history here and start fresh on the conversation for a different approach)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kalradivyanshu">@kalradivyanshu</a> on 2025-01-10 06:00</div>
            <div class="timeline-body"><p>Oh ok, makes sense, I will open the new PR, will let you know. Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-23 04:39</div>
            <div class="timeline-body"><p>Closing in favor of the cross-build at https://github.com/astral-sh/uv/pull/10540</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-23 04:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:17 UTC
    </footer>
</body>
</html>
