<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Require opt-in to use alternative Python implementations - astral-sh/uv #7650</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Require opt-in to use alternative Python implementations</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7650">#7650</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-09-23 23:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-23 23:40</div>
            <div class="timeline-body"><p>Closes #7118</p>
<p>This only really affects managed interpreters, as we exclude alternative Python implementations from the search path during the <code>VersionRequest::executable_names</code> part of discovery.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-09-23 23:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-23 23:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/discovery.rs</code>:918 on 2024-09-23 23:40</div>
            <div class="timeline-body"><p>I prefer the bool as written, it matches the style of the other ones.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-23 23:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/lib.rs</code>:1793 on 2024-09-23 23:41</div>
            <div class="timeline-body"><p>Note we don't have test coverage for this because we don't test Python discovery with managed interpreters. I'll create an issue to track infrastructure for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-09-24 00:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-24 01:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/discovery.rs</code>:1409 on 2024-09-24 01:01</div>
            <div class="timeline-body"><p>Why is <code>Any</code> true but (e.g.) <code>Version</code> and <code>Default</code> false?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-24 01:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/discovery.rs</code>:949 on 2024-09-24 01:02</div>
            <div class="timeline-body"><p>Can we include a little more info on what &quot;aren't allowed&quot; means here, and what &quot;opt-in&quot; means for alternative implementations?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-24 01:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/implementation.rs</code>:65 on 2024-09-24 01:02</div>
            <div class="timeline-body"><p>(<code>value</code> or a longer name?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/installation.rs</code>:180 on 2024-09-24 01:03</div>
            <div class="timeline-body"><p>Can we rephrase to make clear that this returns <code>false</code> for CPython, <code>true</code> for everything else? As written it sounds like it returns <code>true</code> when the installation is CPython or any other implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-24 01:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/discovery.rs</code>:956 on 2024-09-24 01:04</div>
            <div class="timeline-body"><p>I think I need this part explained. This is, like, if the executable is named <code>python</code> but it's really PyPy?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-24 01:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-24 01:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/discovery.rs</code>:1409 on 2024-09-24 01:08</div>
            <div class="timeline-body"><p>Per #7526 we want to distinguish between discovery that allows any interpreter and discovery of a good default interpreter. <code>Any</code> should never filter an interpreter. <code>Default</code> filters alternative implementations because they require opt-in. <code>Version</code> filters alternative implementations because asking for <code>3.13</code> isn't enough to select PyPy, we need <code>pypy@3.13</code> which is <code>ImplementationVersion</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-24 01:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/discovery.rs</code>:956 on 2024-09-24 01:11</div>
            <div class="timeline-body"><p>Yes, if you have PyPy on the front of your PATH as <code>python</code> or <code>python3</code> that counts as opting in, to fulfill the principle that <code>$ python</code> and <code>$ uv python find --python-preference only-system</code> should generally use the same executable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-24 01:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/discovery.rs</code>:956 on 2024-09-24 01:12</div>
            <div class="timeline-body"><p>I futzed with the commentary and implementation here a fair bit. I would kind of like to track the executable name on <code>PythonSource::SearchPath</code> and implement this logic in <code>PythonSource::allows_alternative_implementations()</code> but that would be fairly disruptive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-24 01:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/discovery.rs</code>:949 on 2024-09-24 01:13</div>
            <div class="timeline-body"><p>Note this roughly matches the commentary above about pre-releases, but neither is explained in detail. I'll see what I can do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-09-24 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/discovery.rs</code>:943 on 2024-09-24 17:28</div>
            <div class="timeline-body"><p>Oh ok, this makes sense, comment is helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-24 17:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-09-24 17:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-python/src/discovery.rs</code>:953 on 2024-09-24 17:28</div>
            <div class="timeline-body"><p>Does this need to be under <code>if first_prerelease.is_none()</code>, so we don't set it repeatedly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-09-24 17:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-09-24 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-24 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-24 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-24 17:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/discovery.rs</code>:953 on 2024-09-24 17:54</div>
            <div class="timeline-body"><p>Yes! https://github.com/astral-sh/uv/pull/7666</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:01:41 UTC
    </footer>
</body>
</html>
