<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `EXTERNALLY-MANAGED` markers to managed toolchains - astral-sh/uv #4312</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>EXTERNALLY-MANAGED</code> markers to managed toolchains</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4312">#4312</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-06-13 18:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Closes #4240</p>
<p>e.g.</p>
<pre><code>❯ cargo run -q -- pip install anyio --python &quot;/Users/zb/Library/Application Support/uv/toolchains/cpython-3.12.0-macos-aarch64-none/install/bin/python3&quot;
error: The interpreter at /Users/zb/Library/Application Support/uv/toolchains/cpython-3.12.0-macos-aarch64-none/install is externally managed, and indicates the following:

  This toolchain is managed by uv and should not be modified.

Consider creating a virtual environment with `uv venv`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-13 22:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-toolchain/src/managed.rs</code>:200 on 2024-06-13 22:59</div>
            <div class="timeline-body"><p>Should we suggest using a virtual environment? (Have you looked at any of the other externally-managed messages?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-06-13 23:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-13 23:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-toolchain/src/managed.rs</code>:299 on 2024-06-13 23:45</div>
            <div class="timeline-body"><p>Is this correct on all platforms?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-14 00:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/managed.rs</code>:200 on 2024-06-14 00:28</div>
            <div class="timeline-body"><p>I did at first but we suggest using a virtual environment in our own error message it seemed overkill. I guess they could be using <code>pip</code> but we don&#x27;t expose a central <code>bin</code> for our managed toolchains so I don&#x27;t expect them to be on the PATH.</p>
<p>There&#x27;s a Debian example over at https://packaging.python.org/en/latest/specifications/externally-managed-environments/#marking-an-interpreter-as-using-an-external-package-manager</p>
<p>I figure we could expand on this with more concrete recommendations if we need to later?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-14 00:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/managed.rs</code>:299 on 2024-06-14 00:29</div>
            <div class="timeline-body"><p>Good question.. umm... I guess I&#x27;ll need to extract a Windows one and check!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-14 00:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-toolchain/src/managed.rs</code>:299 on 2024-06-14 00:34</div>
            <div class="timeline-body"><p>I think technically you need to query the interpreter for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-14 00:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/managed.rs</code>:299 on 2024-06-14 00:40</div>
            <div class="timeline-body"><p>Technically, yep! That&#x27;s how I found out where to put it. But</p>
<ul>
<li>This struct doesn&#x27;t have access to an interpreter right now</li>
<li>It seems expensive to query Python to check for this file</li>
<li>This is just for the managed toolchains where I think we can assume a consistent structure</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-14 04:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-toolchain/src/managed.rs</code>:299 on 2024-06-14 04:18</div>
            <div class="timeline-body"><p>That makes sense. If it&#x27;s just for the managed Pythons, we may be able to make some assumptions. (Won&#x27;t we need to query Python eventually any way though?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-14 14:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/managed.rs</code>:299 on 2024-06-14 14:32</div>
            <div class="timeline-body"><p>We do but not until you &quot;use&quot; the toolchain — in <code>uv toolchain install</code> we never actually need to query the interpreter. Idk how fast the operation really needs to be since it&#x27;ll be dominated by the time it takes to download but it&#x27;s not like we&#x27;re already doing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-14 18:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-toolchain/src/managed.rs</code>:299 on 2024-06-14 18:56</div>
            <div class="timeline-body"><p>The Windows builds use <code>Lib</code> so this should be generally fine? I guess I&#x27;ll capitalize it in that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-17 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-17 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-17 15:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:45:55 UTC
    </footer>
</body>
</html>
