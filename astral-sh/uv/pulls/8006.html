<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fix: Improve compatibility with VSCode PS1 prompt - astral-sh/uv #8006</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fix: Improve compatibility with VSCode PS1 prompt</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/8006">#8006</a>
        opened by <a href="https://github.com/quodlibetor">@quodlibetor</a>
        on 2024-10-08 15:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/quodlibetor">@quodlibetor</a> on 2024-10-08 15:47</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This was previously reported in #3037, and the repro there still works -- create any venv using uv and the prompt will be <code>nameoriginalps1</code> instead of <code>(name) originalps1</code>. VSCode fixed one of the two bugs reported there.</p>
<p>The VSCode-generated activate script is pretty different from the uv-generated activate script. The most important thing seems to be that vscode's prompt takes the VIRTUAL_ENV_PROMPT directly instead of obeying PS1, from VSCodes activate script:</p>
<pre><code class="language-shell">if [ -z &quot;${VIRTUAL_ENV_DISABLE_PROMPT:-}&quot; ] ; then
    _OLD_VIRTUAL_PS1=&quot;${PS1:-}&quot;
    PS1=&quot;(.venv) ${PS1:-}&quot;
    export PS1
    VIRTUAL_ENV_PROMPT=&quot;(.venv) &quot;
    export VIRTUAL_ENV_PROMPT
fi
</code></pre>
<p>This changes uv to use VIRTUAL_ENV_PROMPT directly, which does fix vscode for me.</p>
<p>This changes uv to be different from <a href="https://github.com/pypa/virtualenv/blob/b56d09248aecf584e985956185afb6745a7daac7/src/virtualenv/activation/bash/activate.sh#L71-L75">what pypa/virtualenv does</a>, so I'm not really sure if it should be accepted or if a bug should be reported to VSCode.</p>
<h2>Test Plan</h2>
<p>I made the equivalent change in the uv-generated activate script, closed my vscode terminal, cmd-shift-p &quot;reload window&quot;, and reopened a terminal and observed it to work. Note that both closing the terminal and reloading the window seem to be required.</p>
<p>Also I have the <code>python.terminal.activateEnvironment</code> setting enabled and <code>python.terminal.activateEnvInCurrentTerminal</code> disabled (I didn't even know about the second one until right now).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @zanieb on 2024-10-08 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @zanieb on 2024-10-08 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-10-09 15:33</div>
            <div class="timeline-body"><p>Since this is only an aesthetic change, I'm fine with deviating from pypa/virtualenv here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-10-09 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-10-09 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-10-09 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-09 15:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:01:54 UTC
    </footer>
</body>
</html>
