<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Always attach URL to network errors - astral-sh/uv #8444</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Always attach URL to network errors</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/8444">#8444</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-10-22 10:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2024-10-22 10:48</div>
            <div class="timeline-body"><p>Due to the enduring problems with #8144 and related issues, I've opted for a more systemic approach and switched all reqwest errors to not use the implicit-try-fallthrough <code>#[from]</code>, but an explicit <code>#[source]</code> with a URL attached (except for when there is only one or no URL). This guarantees that we get the URL that failed, and helps identifying the responsible code path.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-10-22 10:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">network</span> added by @konstin on 2024-10-22 10:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2024-10-22 10:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @konstin on 2024-10-22 10:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-22 11:42</div>
            <div class="timeline-body"><p>It's a bit of a bummer that in all the snapshot changes here we just end up repeating the URL.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-22 11:47</div>
            <div class="timeline-body"><p>I'd prefer it if reqwest would always include the URL or otherwise have a switch to turn the optional URL off from duplication in error display, but lacking that it's better to repeat the URL than to end up with errors like https://github.com/astral-sh/uv/issues/8144#issuecomment-2426912260 that we can't trace anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-22 13:10</div>
            <div class="timeline-body"><p>Could we only attach for certain error kinds?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-10-24 02:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/it/pip_compile.rs</code>:9368 on 2024-10-24 02:21</div>
            <div class="timeline-body"><p>I think we should probably use the colon and backticks for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-10-24 02:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-25 07:57</div>
            <div class="timeline-body"><p>For just the reqwest error messages and given the opaque reqwest error type, it doesn't make sense to optimize this too much, so we accept the slight regression in the error trace for being able to fix bugs like #8144 and ensuring that we show the user the error URL.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-10-25 09:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-10-25 09:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-25 09:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:02:07 UTC
    </footer>
</body>
</html>
