<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publish: Docs for using the keyring - astral-sh/uv #8806</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Publish: Docs for using the keyring</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/8806">#8806</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-11-04 10:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>While publishing from CI is clearly the better choice, for smaller projects it may just not be worth the effort, so we also support publishing from a local machine.</p>
<p>We don't support <code>.pypirc</code>, the non-standard file that saves password as plaintext to the user home. Instead, we recommend using the keyring for local publishing, using the operating system's much more secure, mostly standardized and better queryable credential store as backend. This comes with the catch that the keyring keys by URL+username, so we need to use the horrible query string attach to tag per-project scoped tokens to a more specific URL (https://github.com/pypa/twine/issues/565).</p>
<p>Fixes #7963</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @konstin on 2024-11-04 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @konstin on 2024-11-04 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-11-04 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>docs/guides/publish.md</code>:94 on 2024-11-04 10:22</div>
            <div class="timeline-body"><pre><code class="language-suggestion">keyring set 'https://upload.pypi.org/legacy/?PACKAGE_NAME' __token__
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>docs/guides/publish.md</code>:100 on 2024-11-04 10:22</div>
            <div class="timeline-body"><pre><code class="language-suggestion">uv publish --username __token__ --keyring-provider subprocess --publish-url 'https://upload.pypi.org/legacy/?PACKAGE_NAME'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/j178">@j178</a> reviewed on 2024-11-04 10:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-11-04 10:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>docs/guides/publish.md</code>:94 on 2024-11-04 10:27</div>
            <div class="timeline-body"><p>thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cthoyt">@cthoyt</a> requested changes on 2024-11-04 14:04</div>
            <div class="timeline-body"><p>Given that the <code>?PACKAGE_NAME</code> suffix is a hack, I think it would also be beneficial to include in this guide the fact that you can have a single token for all publish URLs, and adding the hack is only an optional security precaution that allows you to have different tokens for different packages. I would suggest also including a section that says something like:</p>
<blockquote>
<p>If you don't need the added security of scoping tokens to single packages, and instead use one token for all packages, you can use the following:</p>
<pre><code class="language-shell">keyring set 'https://upload.pypi.org/legacy/' __token__
</code></pre>
<p>Then you can publish with:</p>
<pre><code class="language-shell">uv publish --username __token__ --keyring-provider subprocess --publish-url 'https://upload.pypi.org/legacy/'
</code></pre>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cthoyt">@cthoyt</a> on 2024-11-04 14:04</div>
            <div class="timeline-body"><p>Not to open up another can of worms, but what makes something standard or not? the <code>.pypirc</code> file is well-documented by the PyPA under its specifications list at https://packaging.python.org/en/latest/specifications/pypirc/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 20:21</div>
            <div class="timeline-body"><p><code>.pypirc</code> is documented by the PyPA but isn't really a standard specification (i.e., no PEP) and the PyPA is warning people not to use it. Please use https://github.com/astral-sh/uv/issues/7676 for discussion on that topic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-05 00:15</div>
            <div class="timeline-body"><p>Personally, I find it misleading that <code>.pypirc</code> is in the specifications section of packaging.python.org next to the actual authoritative specs. As zanie said it has no PEP, it was added https://github.com/pypa/packaging.python.org/pull/734 and it's a user guide and not a specification. The only mention in a PEP is a 2002(!) extension to distutils: https://github.com/python/peps/blob/0bb65f91d0eb1b087eee1c61d2bc446f421ab032/peps/pep-0301.rst?plain=1#L233.</p>
<p>I'm focussing the guide on security best practices, such as using the keyring with least-privileged tokens.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-04-28 12:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:40:28 UTC
    </footer>
</body>
</html>
