<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harden ZIP streaming to reject repeated entries and other malformed ZIP files - astral-sh/uv #15136</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Harden ZIP streaming to reject repeated entries and other malformed ZIP files</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/15136">#15136</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-08-07 13:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-07 13:54</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>uv will now reject ZIP files that meet any of the following conditions:</p>
<ul>
<li>Multiple local header entries exist for the same file with different contents.</li>
<li>A local header entry exists for a file that isn't included in the end-of-central directory record.</li>
<li>An entry exists in the end-of-central directory record that does not have a corresponding local header.</li>
<li>The ZIP file contains contents after the first end-of-central directory record.</li>
<li>The CRC32 doesn't match between the local file header and the end-of-central directory record.</li>
<li>The compressed size doesn't match between the local file header and the end-of-central directory record.</li>
<li>The uncompressed size doesn't match between the local file header and the end-of-central directory record.</li>
<li>The reported central directory offset (in the end-of-central-directory header) does not match the actual offset.</li>
<li>The reported ZIP64 end of central directory locator offset does not match the actual offset.</li>
</ul>
<p>We also validate the above for files with data descriptors, which we previously ignored.</p>
<p>Wheels from the most recent releases of the top 15,000 packages on PyPI have been confirmed to pass these checks, and PyPI will also reject ZIPs under many of the same conditions (at upload time) in the future.</p>
<p>In rare cases, this validation can be disabled by setting <code>UV_INSECURE_NO_ZIP_VALIDATION=1</code>. Any validations should be reported to the uv issue tracker and to the upstream package maintainer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2025-08-07 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @woodruffw by @charliermarsh on 2025-08-07 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2025-08-07 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">security</span> added by @charliermarsh on 2025-08-07 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2025-08-07 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv-dev/src/validate_zip.rs</code>:25 on 2025-08-07 13:57</div>
            <div class="timeline-body"><p>Nitpick, not worth blocking on: this error should probably be <code>Only archive URLs are supported</code> I think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> approved on 2025-08-07 13:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2025-08-07 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-08-07 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-07 14:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 06:47:19 UTC
    </footer>
</body>
</html>
