<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for defining credentials for uv in an environment variable - astral-sh/uv #6389</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for defining credentials for uv in an environment variable</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/6389">#6389</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-08-21 23:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Adds <code>UV_AUTH_URLS</code> which defines credentials that should be used for URLs if we make a request there.</p>
<p>This is helpful for cases where, e.g., you want to provide credentials for an index but you don't want to change the index URL semantics by setting <code>UV_INDEX_URL</code>.</p>
<p>Implemented by seeding the URL authentication cache with the value of the variable.</p>
<p>Supports things like:</p>
<ul>
<li><code>UV_AUTH_URLS=&quot;username:password@hostname&quot;</code></li>
<li><code>UV_AUTH_URLS=&quot;username@hostname&quot;</code></li>
<li><code>UV_AUTH_URLS=&quot;username:password@hostname username:password@other-hostname&quot;</code></li>
<li><code>UV_AUTH_URLS=&quot;username:password@hostname/prefix&quot;</code></li>
</ul>
<p>There's a small caveat here, that if you use an index URL like <code>foo@hostname/simple</code> and you provide a password <code>bar:password@hostname</code> â€” the password should not be used but requests to fetch wheels from a different, parent path e.g.<code>hostname/files</code> can allow use of <code>bar:password</code>. This requires #4583 to address. In the meantime, credentials should just be properly scoped.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-22 18:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:95 on 2024-08-22 18:55</div>
            <div class="timeline-body"><p>@BurntSushi recommendations here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-22 18:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:95 on 2024-08-22 18:56</div>
            <div class="timeline-body"><p>(We can't try parsing and reparse on a missing scheme error because <code>public:test@foo.com</code> treats <code>public</code> as a scheme.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-08-22 19:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-auth/src/lib.rs</code>:95 on 2024-08-22 19:01</div>
            <div class="timeline-body"><p>What's wrong with what's here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-22 20:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:95 on 2024-08-22 20:50</div>
            <div class="timeline-body"><p>Uhh, well if you do <code>http://foo</code> we don't want to support that but we'll fail by parsing <code>https://http://foo</code> which seems weird. I guess that's fine though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-22 22:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:95 on 2024-08-22 22:41</div>
            <div class="timeline-body"><p>I'll just special case http for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-22 23:07</div>
            <div class="timeline-body"><p>I want to write documentation for this and make sure it's actually solving people's problems, but the implementation is ready for review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-08-22 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-08-22 23:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2024-08-22 23:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-08-23 11:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-auth/src/lib.rs</code>:95 on 2024-08-23 11:54</div>
            <div class="timeline-body"><p>Yeah I don't have any better ideas here, especially if URL parsing is treating things as schemes that we don't want to be treated as schemes. So I'd guess you'd probably need to write a custom URL parser to deal with this in a way that is completely satisfying. Special casing <code>http</code> seems fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-auth/src/lib.rs</code>:53 on 2024-08-23 12:11</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// added to the realm-level cache to ensure that a URL with a path is not used unless a request
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv-auth/src/lib.rs</code>:87 on 2024-08-23 12:12</div>
            <div class="timeline-body"><p>Should this be a <code>warn!</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-08-23 12:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-23 12:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:87 on 2024-08-23 12:44</div>
            <div class="timeline-body"><p>Can't use our <code>warn_user</code> macros here, but we could use a warn tracing level â€” just doesn't mean much yet. Seems reasonable though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-23 12:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:87 on 2024-08-23 12:54</div>
            <div class="timeline-body"><pre><code class="language-suggestion">        warn!(&quot;Ignoring insecure URL in `UV_AUTH_URLS`: {url}&quot;);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-23 12:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:3 on 2024-08-23 12:54</div>
            <div class="timeline-body"><pre><code class="language-suggestion">use tracing::{debug, trace, warn};
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-23 12:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-auth/src/lib.rs</code>:75 on 2024-08-23 12:55</div>
            <div class="timeline-body"><pre><code class="language-suggestion">            warn!(&quot;Ignoring URL without credentials in `UV_AUTH_URLS`: {url}&quot;);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-08-26 19:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-26 19:22</div>
            <div class="timeline-body"><p>Maybe <code>UV_BASIC_AUTH_URLS</code>? Feel free to ignore though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-26 19:23</div>
            <div class="timeline-body"><p>I don't love my name, so maybe. Will consider...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on <code>crates/uv/tests/pip_install.rs</code>:3857 on 2024-09-03 11:47</div>
            <div class="timeline-body"><pre><code class="language-suggestion">fn install_package_basic_auth_from_uv_basic_auth_urls() {
</code></pre>
<p>grep and replace gone a bit too wild I guess ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mkniewallner">@mkniewallner</a> reviewed on 2024-09-03 11:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on 2024-09-03 11:50</div>
            <div class="timeline-body"><p>Since auto-merge was enabled, apart from test and <code>clippy</code> failures, is there anything preventing the merge of this PR, or was it maybe just forgotten?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/pip_install.rs</code>:3857 on 2024-09-03 17:56</div>
            <div class="timeline-body"><p>Haha thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-03 17:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-03 17:57</div>
            <div class="timeline-body"><p>I'm not getting a ton of signal about how useful it would be so it's relatively low priority.</p>
<p>More relevant though, I was on vacation and am just now noticing auto-merge failed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-03 18:00</div>
            <div class="timeline-body"><p>@zanieb -- My gut is to punt on this until we see more demand, but ultimately defer to you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on 2024-09-03 19:11</div>
            <div class="timeline-body"><blockquote>
<p>I'm not getting a ton of signal about how useful it would be so it's relatively low priority.</p>
</blockquote>
<p>Definitely not high priority IMO. Personally I can leave without it, since we can pass the entire index including credentials with <code>UV_INDEX_URL</code> and <code>UV_EXTRA_INDEX_URL</code>. So it's really just like a convenient thing to have, as I like the idea of having the index explicitly set in <code>[tool.uv]</code>. On projects where a lot of developers work on, having this explicit configuration makes things more obvious (although in fact, even without the feature, you can still explicitly set the index in <code>[tool.uv]</code> and override the entire thing with the env var, but this kinda repeats something that is already set).</p>
<p>Do you think the feature would also fit what is planned in https://github.com/astral-sh/uv/issues/171, or are we thinking about providing another mechanism to provide credentials for this other feature (e.g. what <a href="https://python-poetry.org/docs/repositories/#configuring-credentials">Poetry does</a>, where the credentials are set for a source name by including the name in the header)? If we're not sure yet, maybe we can hold off on merging this PR until the other feature is implemented, to try to come up with something that would ideally fit both use cases?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-03 19:38</div>
            <div class="timeline-body"><p>@charliermarsh is going to start working on #171 soon and I think that will probably supersede this and include a design for index credentials.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-24 16:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:39:03 UTC
    </footer>
</body>
</html>
