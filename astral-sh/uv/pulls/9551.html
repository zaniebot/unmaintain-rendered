<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix lock_requires_python_exact perf - astral-sh/uv #9551</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix lock_requires_python_exact perf</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/9551">#9551</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-12-01 11:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2024-12-01 11:00</div>
            <div class="timeline-body"><p>When running <code>lock_requires_python_exact</code>, we would download CPython 3.12.0 each time. By instead downloading CPython 3.13.0 ahead of time and passing it in, we speed the test up and avoid timeouts. Locally in pycharm, the test goes from 6.5s to 500ms.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @konstin on 2024-12-01 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @konstin on 2024-12-01 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @konstin on 2024-12-01 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-01 12:45</div>
            <div class="timeline-body"><p>Somewhat annoying that we have to download a separate Python for this test, since that too has a cost.m. I'm wondering if we should just remove this or test it via a unit test or similar.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-01 12:45</div>
            <div class="timeline-body"><p>(Good catch.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-12-01 13:26</div>
            <div class="timeline-body"><p>Agree with it being annoying, but it's a <code>warn_user_once!</code>, so not sure how to unit-test this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-01 13:43</div>
            <div class="timeline-body"><p>Should we just remove it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:3793 on 2024-12-03 15:41</div>
            <div class="timeline-body"><p>This needs the <code>python-patch</code> feature if we're going to use a specific patch version</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-03 15:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-12-03 15:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/lock.rs</code>:3793 on 2024-12-03 15:43</div>
            <div class="timeline-body"><p>(which will fix Windows)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-03 15:44</div>
            <div class="timeline-body"><p>I guess we could remove it? I don't have strong feelings.</p>
<blockquote>
<p>Somewhat annoying that we have to download a separate Python for this test, since that too has a cost.</p>
</blockquote>
<p>The cost is pretty low, but yeah not great. We should at least switch to 3.13.0 since that should have the latest distribution size reductions that 3.12.0 might not?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-12-03 15:46</div>
            <div class="timeline-body"><p>Let's go with 3.13.0, I'll update the PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-03 15:46</div>
            <div class="timeline-body"><p>Yeah we also <em>already</em> download 3.13.0, so that at least works for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-12-04 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-04 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-12-04 14:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:15 UTC
    </footer>
</body>
</html>
