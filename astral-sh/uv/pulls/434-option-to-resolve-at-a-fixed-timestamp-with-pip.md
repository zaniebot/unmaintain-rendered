```yaml
number: 434
title: "Option to resolve at a fixed timestamp with `pip-compile --exclude-newer YYYY-MM-DD`"
type: pull_request
state: merged
author: konstin
labels: []
assignees: []
merged: true
base: main
head: cutoff-option
created_at: 2023-11-16T12:07:34Z
updated_at: 2023-11-16T19:46:18Z
url: https://github.com/astral-sh/uv/pull/434
synced_at: 2026-01-10T15:50:28Z
```

# Option to resolve at a fixed timestamp with `pip-compile --exclude-newer YYYY-MM-DD`

---

_Pull request opened by @konstin on 2023-11-16 12:07_

This works by filtering out files with a more recent upload time, so if the index you use does not provide upload times, the results might be inaccurate. pypi provides upload times for all files. This is, the field is non-nullable in the warehouse schema, but the simple API PEP does not know this field.

If you have only pypi dependencies, this means deterministic, reproducible(!) resolution. We could try doing the same for git repos but it doesn't seem worth the effort, i'd recommend pinning commits since git histories are arbitrarily malleable and also if you care about reproducibility and such you such not use git dependencies but a custom index.

Timestamps are given either as RFC 3339 timestamps such as `2006-12-02T02:07:43Z` or as UTC dates in the same format such as `2006-12-02`. Dates are interpreted as including this day, i.e. until midnight UTC that day. Date only is required to make this ergonomic and midnight seems like an ergonomic choice.

In action for `pandas`:

```console
$ target/debug/puffin pip-compile --exclude-newer 2023-11-16 target/pandas.in
Resolved 6 packages in 679ms
# This file was autogenerated by Puffin v0.0.1 via the following command:
#    target/debug/puffin pip-compile --exclude-newer 2023-11-16 target/pandas.in
numpy==1.26.2
    # via pandas
pandas==2.1.3
python-dateutil==2.8.2
    # via pandas
pytz==2023.3.post1
    # via pandas
six==1.16.0
    # via python-dateutil
tzdata==2023.3
    # via pandas
$ target/debug/puffin pip-compile --exclude-newer 2022-11-16 target/pandas.in
Resolved 5 packages in 655ms
# This file was autogenerated by Puffin v0.0.1 via the following command:
#    target/debug/puffin pip-compile --exclude-newer 2022-11-16 target/pandas.in
numpy==1.23.4
    # via pandas
pandas==1.5.1
python-dateutil==2.8.2
    # via pandas
pytz==2022.6
    # via pandas
six==1.16.0
    # via python-dateutil
$ target/debug/puffin pip-compile --exclude-newer 2021-11-16 target/pandas.in
Resolved 5 packages in 594ms
# This file was autogenerated by Puffin v0.0.1 via the following command:
#    target/debug/puffin pip-compile --exclude-newer 2021-11-16 target/pandas.in
numpy==1.21.4
    # via pandas
pandas==1.3.4
python-dateutil==2.8.2
    # via pandas
pytz==2021.3
    # via pandas
six==1.16.0
    # via python-dateutil
```

---

_@konstin reviewed on 2023-11-16 12:09_

---

_Review comment by @konstin on `crates/puffin-cli/tests/pip_compile.rs`:36 on 2023-11-16 12:09_

This is the default test that all other tests are variations of, so i moved it above the error tests

---

_@konstin reviewed on 2023-11-16 12:11_

---

_Review comment by @konstin on `crates/pypi-types/src/simple_json.rs`:32 on 2023-11-16 12:11_

Moved from #428 to this PR to avoid merge conflicts

---

_Review comment by @charliermarsh on `crates/puffin-resolver/src/version_map.rs`:51 on 2023-11-16 17:47_

What would happen if we excluded-by-default, instead of including-by-default? So, if the registry doesn't provide timestamps, and the user specifies `--exclude-newer`, we omit.

---

_@charliermarsh reviewed on 2023-11-16 17:47_

---

_@charliermarsh reviewed on 2023-11-16 17:47_

---

_Review comment by @charliermarsh on `crates/puffin-cli/tests/pip_compile.rs`:1276 on 2023-11-16 17:47_

Do we not need to add this to all of the tests?

---

_@konstin reviewed on 2023-11-16 18:00_

---

_Review comment by @konstin on `crates/puffin-resolver/src/version_map.rs`:51 on 2023-11-16 18:00_

i expect registries to tend to either always or never have timestamps, so I'd expect we find no resolution

---

_@konstin reviewed on 2023-11-16 18:03_

---

_Review comment by @konstin on `crates/puffin-cli/tests/pip_compile.rs`:1276 on 2023-11-16 18:03_

If you want that, yes, but i would make a follow up PR since i don't know if it had any side effects yet

---

_@charliermarsh reviewed on 2023-11-16 18:05_

---

_Review comment by @charliermarsh on `crates/puffin-resolver/src/version_map.rs`:51 on 2023-11-16 18:05_

I think that seems like the right behavior though. At least now, while it's only used for testing, internally. I'd probably bias towards being conservative here.

---

_@charliermarsh approved on 2023-11-16 19:40_

---

_@charliermarsh reviewed on 2023-11-16 19:40_

---

_Review comment by @charliermarsh on `crates/puffin-resolver/src/version_map.rs`:51 on 2023-11-16 19:40_

(I made this change just to keep the PR moving, but feel free to push back of course.)

---

_Merged by @charliermarsh on 2023-11-16 19:46_

---

_Closed by @charliermarsh on 2023-11-16 19:46_

---

_Branch deleted on 2023-11-16 19:46_

---
