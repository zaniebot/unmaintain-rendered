<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support dotted function paths for script entrypoints - astral-sh/uv #1622</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support dotted function paths for script entrypoints</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/1622">#1622</a>
        opened by <a href="https://github.com/markmmm">@markmmm</a>
        on 2024-02-18 02:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/markmmm">@markmmm</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Some projects define an script entrypoint with a path separated by <code>.</code>.</p>
<p>For example in Invoke...</p>
<pre><code class="language-python">    entry_points={
        &quot;console_scripts&quot;: [
            &quot;invoke = invoke.main:program.run&quot;,
            &quot;inv = invoke.main:program.run&quot;,
        ]
    },
</code></pre>
<p>Before this change <code>uv</code> tried to import 'program.run' but
this is not valid, and only up to the first dot should be
imported (as <code>pip</code> does).</p>
<p>Resolves: #1573</p>
<h2>Test Plan</h2>
<ul>
<li>Added a unit test in script.rs to validate that the import_name is set correctly when the function path is dotted.</li>
<li>Ran the unit tests (<code>cargo test</code>)</li>
</ul>
<p>https://github.com/astral-sh/uv/assets/1203881/8774b281-0811-4520-b4d7-244d0f955cb7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/markmmm">@markmmm</a> on <code>crates/install-wheel-rs/src/script.rs</code>:19 on 2024-02-18 03:04</div>
            <div class="timeline-body"><p>Interestingly I forgot to add this at first (I assume it should be added) - but no test identified it.
Is there anyway to easily unit test this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/markmmm">@markmmm</a> reviewed on 2024-02-18 03:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @zanieb on 2024-02-18 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/install-wheel-rs/src/script.rs</code>:71 on 2024-02-18 15:56</div>
            <div class="timeline-body"><p>It seems that <code>import_name</code> can always be derived by the <code>function</code> name and can easily be computed (rather than be stored on <code>Script</code>. This is also what <code>distlib</code> does.</p>
<p>https://github.com/pypa/distlib/blob/1c08845b05d022692252ed45cb07e9cb9647caac/distlib/scripts.py#L239-L243</p>
<p>That's why I would remove the <code>import_name</code> field and instead add an <code>import_name</code> function on <code>Script</code> that computes the import name on the fly. This safes us one allocation (good for performance) and avoids storing redudant data.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-18 15:57</div>
            <div class="timeline-body"><p>Wow thanks. I wanted to tackle this on Monday but you beat me to it! Thank you.</p>
<p>This looks good to me and matches <code>distlib</code>'s behavior. I think it would be nice to calculate the data on the fly instead of storing it on <code>Script</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/markmmm">@markmmm</a> reviewed on 2024-02-18 23:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/markmmm">@markmmm</a> on <code>crates/install-wheel-rs/src/script.rs</code>:71 on 2024-02-18 23:16</div>
            <div class="timeline-body"><p>I did question this when implementing and went this way out of consistency (fields rather than functions)
I am not clear on how changes to the interface impact the PyO3 version of the struct.
If we move to functions - would they still be available to the Python bindings?</p>
<p>If the code switched to functions - <code>uv</code> could potentially move to a different process for working with the data (i.e. storing 1 string - and passing offsets). I am not saying we need that - but if <code>uv</code> might want to move to that way of returning these values - then easier to do so if implementation is hidden behind functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a> reviewed on 2024-02-19 09:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on <code>crates/install-wheel-rs/src/script.rs</code>:71 on 2024-02-19 09:54</div>
            <div class="timeline-body"><p>That's fair. I don't think we use the pyo3 interface today. That's why I think it's safe to ignore any concerns regarding it today.</p>
<p>I don't think we need to store any text ranges. We can return a <code>&amp;str</code> and us the same logic that you currently have in the <code>new</code> function. I applied the changes to your branch</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-02-19 10:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @MichaReiser on 2024-02-19 10:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-19 10:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markmmm">@markmmm</a> on 2024-02-19 12:46</div>
            <div class="timeline-body"><p>Thanks - looks great!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:35:37 UTC
    </footer>
</body>
</html>
