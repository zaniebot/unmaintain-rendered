<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: error on non-existent extra from lock file - astral-sh/uv #11426</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: error on non-existent extra from lock file</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11426">#11426</a>
        opened by <a href="https://github.com/mkniewallner">@mkniewallner</a>
        on 2025-02-11 20:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mkniewallner">@mkniewallner</a></div>
            <div class="timeline-body">Summary
<p>Closes #10597.</p>
<p>Recreated <a href="https://github.com/astral-sh/uv/pull/10925">astral-sh/uv#10925</a> that got closed as the base branch got merged.</p>
Test Plan
<p>Snapshot tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-11 20:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-02-11 20:53</div>
            <div class="timeline-body"><p>replicating review comment to this PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-02-11 20:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:2627 on 2025-02-11 20:54</div>
            <div class="timeline-body"><p>I&#x27;m not sure if this is the right place to handle this but I believe this isn&#x27;t our desired semantic for the case where provides_extras is undefined. We aren&#x27;t doing a lockfile version bump, so we&#x27;re still supporting provides_extras being missing.</p>
<p>Some part of this code should handle that as &quot;I don&#x27;t actually have information on if the extra is defined, and will conservatively not error, because I&#x27;m uncertain&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on <code>crates/uv-resolver/src/lock/mod.rs</code>:2627 on 2025-02-11 20:54</div>
            <div class="timeline-body"><p>Oh yeah definitely, will update the logic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mkniewallner">@mkniewallner</a> reviewed on 2025-02-11 20:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-11 20:57</div>
            <div class="timeline-body"><p>I <em>think</em> the kind of check you want is something like... &quot;if <em>no</em> package in the lockfile defines provides-extras, refuse to do the check&quot; (because you don&#x27;t want a single package missing provides-extras to falsely allow all extra names).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-11 21:02</div>
            <div class="timeline-body"><p>(also don&#x27;t worry about the  python3.13 failure, that&#x27;s fixed on main but not the feature branch aiui)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on 2025-02-11 22:05</div>
            <div class="timeline-body"><p>Thanks for the guidance and sorry for missing this case (although it was kinda obvious in retrospective :sweat_smile:). I hope <a href="https://github.com/astral-sh/uv/pull/11426">astral-sh/uv#11426</a>/commits/743258b126488a6946e0216a05e8de8e4d239294 is what you had in mind.</p>
<p>I&#x27;ve moved <code>contains_extra</code> outside of <code>Lock</code> implementation as you suggested, to avoid misusages of it, since it would be easy, otherwise, to not think about the fact that the information could be missing because of older versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/mkniewallner">@mkniewallner</a> on 2025-02-11 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-02-12 16:00</div>
            <div class="timeline-body"><p>Awesome, looks great to me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v0.6.0&quot; by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-12 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:7 on 2025-02-12 16:49</div>
            <div class="timeline-body"><p>We don&#x27;t enforce this but since this file already adheres to it, would you mind retaining:</p>
<pre><code>&lt;std&gt;

&lt;third-party&gt;

&lt;uv crates&gt;

&lt;crate::&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:250 on 2025-02-12 16:49</div>
            <div class="timeline-body"><p>Can we use <code>Either</code> here and return an iterator in each case? I suspect we can avoid this clone?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/sync.rs</code>:371 on 2025-02-12 16:50</div>
            <div class="timeline-body"><p>I&#x27;d probably move this below the settings destructure, just above &quot;// Validate that the Python version is supported by the lockfile.&quot;, since it&#x27;s semantically grouped with those operations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2025-02-12 16:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-12 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-12 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mkniewallner">@mkniewallner</a> reviewed on 2025-02-12 17:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:250 on 2025-02-12 17:32</div>
            <div class="timeline-body"><p>Oh thanks, I did want to do that but did not think about using <code>Either</code>!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-12 17:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:50:50 UTC
    </footer>
</body>
</html>
