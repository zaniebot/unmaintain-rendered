<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignore markers on requirements.txt options - astral-sh/uv #16489</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ignore markers on requirements.txt options</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/16489">#16489</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-10-29 00:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-10-29 00:04</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This matches pip's behavior. Given:</p>
<pre><code>--extra-index-url=https://download.pytorch.org/whl/cu129 ; sys_platform  != 'darwin'
</code></pre>
<p>We just ignore the marker. Previously, it was treated as part of the URL.</p>
<p>There's one difference here, which is that in pip, if you quote the entire value, they don't strip the marker -- so:</p>
<pre><code>--extra-index-url=&quot;https://download.pytorch.org/whl/cu129 ; sys_platform  != 'darwin'&quot;
</code></pre>
<p>...is treated as a verbatim URL that includes the space, semicolon, etc. For simplicity, we also strip those.</p>
<p>Closes https://github.com/astral-sh/uv/issues/16488.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @charliermarsh on 2025-10-29 00:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2025-10-29 00:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2025-10-29 00:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2025-10-29 00:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements-txt/src/lib.rs</code>:825 on 2025-10-29 10:26</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// For example, given `--index-url https://pypi.org/simple ; python_version &lt; &quot;3.8&quot;`,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements-txt/src/lib.rs</code>:826 on 2025-10-29 10:26</div>
            <div class="timeline-body"><pre><code class="language-suggestion">/// remove the trailing marker and return `https://pypi.org/simple`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements-txt/src/lib.rs</code>:841 on 2025-10-29 10:30</div>
            <div class="timeline-body"><p>In PEP 508, the whitespace needs to be between URL and semicolon (to check that the semicolon is not part of the URL), instead of after the semicolon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-29 10:41</div>
            <div class="timeline-body"><p>I see the pip-compatibility argument, but it does seem confusing that in URLs with markers the markers are silently ignored, instead of applying them conditionally them same way e.g. conflicts do.</p>
<pre><code>--extra-index-url=https://download.pytorch.org/whl/nightly/cpu ; sys_platform  == 'darwin'
--extra-index-url=https://download.pytorch.org/whl/cu129 ; sys_platform  != 'darwin'
</code></pre>
<p>Can we add a warning to indicate to the user that their requirements file doesn't do what they think it does?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-10-29 10:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-29 14:04</div>
            <div class="timeline-body"><p>I think I'd expect this to be an error outside of the <code>uv pip</code> interface and a warning in <code>uv pip</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-10-29 16:35</div>
            <div class="timeline-body"><p>Okay, I'm going to make this a warning (but not an error). An error would be breaking, and it would also require making the parsing more context-aware which doesn't seem worth the trouble right now IMO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-10-30 19:26</div>
            <div class="timeline-body"><p>Okay, I rewrote the option parsing to unify the behavior rather than split it into post-processing steps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-09 14:59</div>
            <div class="timeline-body"><p>I'm afraid of the parser rewrite but otherwise a +1</p>
<p>@konstin do you want to own reviewing that?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 06:30:36 UTC
    </footer>
</body>
</html>
