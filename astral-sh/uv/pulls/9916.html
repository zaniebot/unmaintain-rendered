<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patch additional sysconfig values such as clang at install time - astral-sh/uv #9916</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Patch additional sysconfig values such as clang at install time</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/9916">#9916</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2024-12-15 15:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a></div>
            <div class="timeline-body">Summary
<p>Minor follow up to <a href="https://github.com/astral-sh/uv/pull/9905">astral-sh/uv#9905</a> to patch <code>clang</code> with <code>cc</code>.</p>
<p>Implements the replacements used in <a href="https://github.com/bluss/sysconfigpatcher/blob/main/src/sysconfigpatcher.py#L54">sysconfigpatcher</a>, namely</p>
<pre><code>DEFAULT_VARIABLE_UPDATES = {
    &quot;CC&quot;: WordReplace(&quot;clang&quot;, &quot;cc&quot;),
    &quot;CXX&quot;: WordReplace(&quot;clang++&quot;, &quot;c++&quot;),
    &quot;BLDSHARED&quot;: WordReplace(&quot;clang&quot;, &quot;cc&quot;),
    &quot;LDSHARED&quot;: WordReplace(&quot;clang&quot;, &quot;cc&quot;),
    &quot;LDCXXSHARED&quot;: WordReplace(&quot;clang++&quot;, &quot;c++&quot;),
    &quot;LINKCC&quot;: WordReplace(&quot;clang&quot;, &quot;cc&quot;),
    &quot;AR&quot;: &quot;ar&quot;,
}
</code></pre>
Test Plan
<p>Added an additional test. Tested local python installs.</p>
<p>Related traces</p>
<pre><code>TRACE Updated `AR` from `/tools/clang-linux64/bin/llvm-ar` to `ar`
TRACE Updated `CC` from `clang -pthread` to `cc -pthread`
TRACE Updated `CXX` from `clang++ -pthread` to `c++ -pthread`
TRACE Updated `BLDSHARED` from `clang -pthread -shared -L/tools/deps/lib` to `cc -pthread -shared -L/tools/deps/lib`
TRACE Updated `LDSHARED` from `clang -pthread -shared -L/tools/deps/lib` to `cc -pthread -shared -L/tools/deps/lib`
TRACE Updated `LDCXXSHARED` from `clang++ -pthread -shared` to `c++ -pthread -shared`
TRACE Updated `LINKCC` from `clang -pthread` to `cc -pthread
</code></pre>
Pending Discussion Items
<p>https://github.com/astral-sh/uv/pull/9905#issuecomment-2543879587</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-15 16:47</div>
            <div class="timeline-body"><p>I would be surprised if we replaced <code>clang</code> with <code>cc</code> on a system with <code>clang</code> but not <code>cc</code>. Is that silly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-12-15 17:09</div>
            <div class="timeline-body"><blockquote>
<p>I would be surprised if we replaced <code>clang</code> with <code>cc</code> on a system with <code>clang</code> but not <code>cc</code>. Is that silly?</p>
</blockquote>
<p>Fair, on the other hand I rather find <code>cc</code> to be more pervasive than <code>clang</code>. Even on cases where say <code>gcc</code> is not installed but <code>clang</code> is, <code>cc</code> would often point to <code>clang</code>.</p>
<p>I think this approach would also help systems that have <code>gcc</code> installed (or others) but not <code>clang</code> as <code>cc</code> would be interopable with either, unless we really want users under all cases to have <code>clang</code> installed on their system which is harder in some environments where you can&#x27;t control the toolchains provided.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-15 18:29</div>
            <div class="timeline-body"><p>@mitsuhiko did say that this was the most impactful of the sysconfig patches so tagging him.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-16 17:02</div>
            <div class="timeline-body"><p>A relevant comment at <a href="https://github.com/indygreg/python-build-standalone/issues/210">indygreg/python-build-standalone#210</a>#issuecomment-2029007939 too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/samypr100">@samypr100</a> on 2024-12-17 02:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-12-17 02:16</div>
            <div class="timeline-body"><blockquote>
<p>A relevant comment at <a href="https://github.com/indygreg/python-build-standalone/issues/210#issuecomment-2029007939">indygreg/python-build-standalone#210 (comment)</a> too</p>
</blockquote>
<p>Good insights, at least from my perspective I see a unique distinction between <code>python-build-standalone</code> goals and uv with regards to these types of modifications. For example, I can see the strong desire in <code>python-build-standalone</code> to maintain ground truth / pristine nature of the builds (avoid modifying anything beyond what&#x27;s absolutely necessary) for a lot of reasons. Given that <code>uv</code> is a consumer of <code>python-build-standalone</code>, I think uv is the ideal place to make these type of minor modifications to the downloads in order to achieve the desired level of interopability with the end user&#x27;s system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-17 02:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-17 19:44</div>
            <div class="timeline-body"><p>What if we test for clang, and rewrite to gcc if it&#x27;s not present?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-17 19:52</div>
            <div class="timeline-body"><p>Why prefer <code>clang</code> / <code>gcc</code> over <code>cc</code>? Just wondering. I think it <em>is</em> pretty common for it to be linked?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-17 19:59</div>
            <div class="timeline-body"><p>Oh sorry. I guess <code>cc</code> is fine. What&#x27;s the problem with just using <code>cc</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-17 20:02</div>
            <div class="timeline-body"><p>Is there one? haha</p>
<p>It might break my system, I alias that to <code>cargo check</code> ðŸ˜­ but I kind of imagine build commands don&#x27;t invoke a shell.</p>
<p>I think <code>cc</code> is really reasonable, honestly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-12-17 20:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-17 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-12-17 20:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-17 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-17 20:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-08 18:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:49:51 UTC
    </footer>
</body>
</html>
