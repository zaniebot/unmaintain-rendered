<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reuse the result of `which git` - astral-sh/uv #8224</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reuse the result of <code>which git</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/8224">#8224</a>
        opened by <a href="https://github.com/j178">@j178</a>
        on 2024-10-15 16:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/j178">@j178</a> on 2024-10-15 16:18</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Cache the path to git executable in a <code>LazyLock</code> and reuse it throughout the process. This might reduce some costs on finding the git executable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @zanieb on 2024-10-15 16:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2024-10-15 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-15 16:32</div>
            <div class="timeline-body"><p>Sounds like a good idea, do you have some numbers how much overhead finding git is?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/j178">@j178</a> on 2024-10-15 17:22</div>
            <div class="timeline-body"><p>I wrote a simple script to measure the overhead of finding git. Running it 50 times reduces the time by ~39ms on my machine.</p>
<pre><code class="language-rust">use std::time::{Duration, Instant};
use std::process::Command;

fn run(git: &amp;str, n: u32) -&gt; Duration {
    let start = Instant::now();
    for _ in 0..n {
        let status = Command::new(git)
            .arg(&quot;--version&quot;)
            .stdout(std::process::Stdio::null())
            .status()
            .unwrap();
        assert!(status.success());
    }
    start.elapsed()
}

fn main() {
    let n = 50;
    let d1 = run(&quot;git&quot;, n);
    let d2 = run(&quot;/opt/homebrew/bin/git&quot;, n);
    println!(&quot;diff: {}ms&quot;, (d1 - d2).as_millis());
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/j178">@j178</a> on 2024-10-15 17:44</div>
            <div class="timeline-body"><p>The overhead depends on the path's position in <code>PATH</code>. If I move the Git path to the end (18th) of <code>PATH</code>, the reduced time can increase to approximately 500ms.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 17:45</div>
            <div class="timeline-body"><p>Looks reasonable to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-10-15 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-15 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-15 18:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:02:00 UTC
    </footer>
</body>
</html>
