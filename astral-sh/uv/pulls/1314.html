<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cli: conventionally treat `-` as &quot;read from stdin&quot; - astral-sh/uv #1314</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>cli: conventionally treat <code>-</code> as &quot;read from stdin&quot;</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/1314">#1314</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-02-15 15:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-15 15:54</div>
            <div class="timeline-body"><p>Basically, when a path to a requirements file is <code>-</code>, then we should
read its contents from <code>stdin</code> instead of the file path named <code>-</code>.</p>
<p>Fixes #1313</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @mitsuhiko by @BurntSushi on 2024-02-15 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @BurntSushi on 2024-02-15 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-02-15 15:55</div>
            <div class="timeline-body"><p>Love it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-15 15:55</div>
            <div class="timeline-body"><p>Do we need a docs change?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-fs/src/lib.rs</code>:38 on 2024-02-15 15:57</div>
            <div class="timeline-body"><p>Should this switching instead happen as a new <code>RequirementsSource</code>? (I don't feel strongly.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-15 15:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin/src/requirements.rs</code>:195 on 2024-02-15 15:58</div>
            <div class="timeline-body"><p>This should be impossible to hit, I think, since we only go down this path if the filename is exactly <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-15 15:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-02-15 16:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/puffin/src/requirements.rs</code>:195 on 2024-02-15 16:00</div>
            <div class="timeline-body"><p>That's what I figured, but I think that's more &quot;an artifact of how the current code behaves&quot; rather than &quot;a guarantee provided by the module's API.&quot; So for example, if in the future one could create a <code>PyprojectToml</code> via some other means, then the case of reading from stdin will be handled automatically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-02-15 16:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/puffin-fs/src/lib.rs</code>:38 on 2024-02-15 16:01</div>
            <div class="timeline-body"><p>I honestly don't know. It looked to me that <code>RequirementsSource</code> was more about the format than the delivery.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-15 16:07</div>
            <div class="timeline-body"><blockquote>
<p>Do we need a docs change?</p>
</blockquote>
<p>Yeah good call. Done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @BurntSushi on 2024-02-15 16:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-15 16:15</div>
            <div class="timeline-body"><p>What happens if <code>-</code> is passed multiple times?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-15 16:19</div>
            <div class="timeline-body"><blockquote>
<p>What happens if <code>-</code> is passed multiple times?</p>
</blockquote>
<p>In that case, <code>stdin</code> will be read from multiple times. But after the first read, stdin is fully consumed and so subsequent reads will return no data. In other words, it will be the equivalent of <code>cat requirements.txt | puffin pip compile - some-empty-file</code>. Since empty files are valid requirements files, it ends up just being ignored.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-15 16:21</div>
            <div class="timeline-body"><p>Other tools behave similarly:</p>
<pre><code>$ cat scripts/requirements/black.in | rg black -
black
$ cat scripts/requirements/black.in | rg black - -
&lt;stdin&gt;
1:black
$ cat scripts/requirements/black.in | rg black - - -
&lt;stdin&gt;
1:black
$ cat scripts/requirements/black.in | rg black - - - -
&lt;stdin&gt;
1:black

$ cat scripts/requirements/black.in | grep black -
black
$ cat scripts/requirements/black.in | grep black - -
(standard input):black
$ cat scripts/requirements/black.in | grep black - - -
(standard input):black
$ cat scripts/requirements/black.in | grep black - - - -
(standard input):black
</code></pre>
<p>We could potentially report an error instead, but I'm not sure if that's worth doing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-15 16:22</div>
            <div class="timeline-body"><p>Okay great. I was mostly worried that it would hang on the second stdin call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2024-02-15 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-02-15 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-15 16:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:33:43 UTC
    </footer>
</body>
</html>
