<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: Implement `--annotation-style` parameter for `uv pip compile` - astral-sh/uv #1679</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: Implement <code>--annotation-style</code> parameter for <code>uv pip compile</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/1679">#1679</a>
        opened by <a href="https://github.com/drjackild">@drjackild</a>
        on 2024-02-19 02:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/drjackild">@drjackild</a> on 2024-02-19 02:37</div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Hello there! The motivation for this feature is described here #1678</p>
<h2>Test Plan</h2>
<p>I've added unit tests and also tested this manually on my work project by comparing it to the original <code>pip-compile</code> output - it looks much like the <code>pip-compile</code> generated lock file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Implement `--annotation-style` parameter for `uv pip compile`" to "feat: Implement `--annotation-style` parameter for `uv pip compile`" by @drjackild on 2024-02-19 02:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-19 03:40</div>
            <div class="timeline-body"><p>Thanks for contributing! Welcome to the project :)</p>
<p>I'm not entirely sure we want to accept more configuration here, I'll need to check with @charliermarsh.</p>
<p>It looks like the Windows snapshots are failing. We automatically filter out some Windows-only dependencies, but it's failing since they're not separated by a newline anymore. You'll need to adjust the regex at https://github.com/astral-sh/uv/blob/ad12d97e714aefdf79267faa8c51a36d4783459c/crates/uv/tests/common/mod.rs#L261-L264</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2024-02-19 03:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/frayandy">@frayandy</a> approved on 2024-02-19 04:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/drjackild">@drjackild</a> on 2024-02-19 10:51</div>
            <div class="timeline-body"><p>@zanieb I hope you'll accept this one :) Regarding the tests - fixed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-20 04:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/resolution.rs</code>:428 on 2024-02-20 04:59</div>
            <div class="timeline-body"><p>Can you walk me through <code>line:24</code> here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-20 05:00</div>
            <div class="timeline-body"><p>I'm happy to include this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/drjackild">@drjackild</a> reviewed on 2024-02-20 09:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/drjackild">@drjackild</a> on <code>crates/uv-resolver/src/resolution.rs</code>:428 on 2024-02-20 09:29</div>
            <div class="timeline-body"><p>Sure! I'm trying to keep the same logic, as <code>pip-tools</code>, to minimize the diff in the output file. The align <code>24</code> is something they use in the <code>pip-tools</code> as a reasonable number to align the annotation comments: https://github.com/jazzband/pip-tools/blob/main/piptools/writer.py#L318 and I agree with them. Most of the time annotation will be aligned except for some extra-long dependencies.</p>
<pre><code class="language-requirements.txt">monotonic==1.6            # via analytics-python
oauthlib==2.1.0           # via pyproject.toml
opentelemetry-api==1.22.0  # via ddtrace
packaging==21.3           # via gunicorn, pyproject.toml
prompt-toolkit==3.0.43    # via click-repl
protobuf==4.25.3          # via ddsketch, ddtrace
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-20 18:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/resolution.rs</code>:428 on 2024-02-20 18:04</div>
            <div class="timeline-body"><p>Ahh okay, thank you, perfect!</p>
<p>I'm wondering if we should just put more of this method within a <code>match</code> on the annotation style. I might find the logic easier to follow, but I'd need to see it to know for sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/drjackild">@drjackild</a> reviewed on 2024-02-20 22:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/drjackild">@drjackild</a> on <code>crates/uv-resolver/src/resolution.rs</code>:428 on 2024-02-20 22:00</div>
            <div class="timeline-body"><p>Do you mean to extract <code>annotation_line</code> and <code>annotation_split</code> onto the <code>match</code> statement? I could do this, they're not very big, should be fine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/drjackild">@drjackild</a> reviewed on 2024-02-20 22:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/drjackild">@drjackild</a> on <code>crates/uv-resolver/src/resolution.rs</code>:428 on 2024-02-20 22:56</div>
            <div class="timeline-body"><p>Yeah, you're right, it's easier to read without those function calls :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/drjackild">@drjackild</a> on 2024-02-20 23:19</div>
            <div class="timeline-body"><p>I have no idea, why it's failing ðŸ¤”</p>
<p>UPD: Fixed ðŸ˜Š</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @zanieb on 2024-02-21 00:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-21 00:29</div>
            <div class="timeline-body"><p>Will review and merge tonight, hopefully.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-02-21 01:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/resolution.rs</code>:429 on 2024-02-21 02:00</div>
            <div class="timeline-body"><p>@DrJackilD -- I just tweaked this to couple the presence of the comment and separator.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-02-21 02:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-02-21 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-21 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-21 02:20</div>
            <div class="timeline-body"><p>Thank you! Great contribution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/drjackild">@drjackild</a> on 2024-02-21 11:52</div>
            <div class="timeline-body"><blockquote>
<p>Thank you! Great contribution.</p>
</blockquote>
<p>Thank you for accepting it so quick!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-21 13:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:33:43 UTC
    </footer>
</body>
</html>
