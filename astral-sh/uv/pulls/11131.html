<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve performance of uv-python crate's manylinux submodule - astral-sh/uv #11131</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve performance of uv-python crate's manylinux submodule</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11131">#11131</a>
        opened by <a href="https://github.com/cthoyt">@cthoyt</a>
        on 2025-01-31 11:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/cthoyt">@cthoyt</a> on 2025-01-31 11:09</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR makes a few performance improvements:</p>
<ol>
<li>Reduces the need to unpack and repack a <code>_GLibCVersion</code> tuple</li>
<li>Reduces the doubled call to <code>_is_compatible(arch, glibc_version)</code></li>
<li>Moves the assignment of the <code>tag</code> variable directly into the yield, reducing memory allocation in case this is never used when <code>_is_compatible(arch, glibc_version)</code> is false</li>
<li>Combines the check of the <code>glibc_version</code> being in <code>_LEGACY_MANYLINUX_MAP</code> and the assignment to the variable together. I'm not sure if this is actually better, but using the assignment expression reduces this from 4 lines to 2</li>
</ol>
<h2>Test Plan</h2>
<p>I upstreamed these changes in https://github.com/pypa/packaging/pull/869. Otherwise, I'm pretty confident this is a minor change that works the same</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-31 14:57</div>
            <div class="timeline-body"><p>Thanks for this. I'm hesitant to make changes here since the code is vendored... Personally, I'd prefer to wait for this to merge upstream.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cthoyt">@cthoyt</a> on 2025-01-31 15:03</div>
            <div class="timeline-body"><p>@charliermarsh totally agreed! I didn't realize it was vendored until after I had already made the PR... sorry for missing the README. I will watch out to see what the upstream group says, and ping you if we ever get some feedback!</p>
<p>Cheers</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-31 15:04</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @charliermarsh on 2025-01-31 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by @charliermarsh on 2025-01-31 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cthoyt">@cthoyt</a> on 2025-05-22 22:05</div>
            <div class="timeline-body"><p>FYI @charliermarsh my changes got merged into upstream! They haven't been minted into a new release yet. I'm not sure how you'd want to proceed with changing the vendored code in uv. I can check back in when the next release is made for <code>packaging</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-28 13:08</div>
            <div class="timeline-body"><p>Thanks for upstreaming!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2025-05-28 13:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2025-05-28 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-05-28 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-28 13:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:19 UTC
    </footer>
</body>
</html>
