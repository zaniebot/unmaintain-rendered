<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv-resolver: partially revert Requires-Python version narrowing - astral-sh/uv #4902</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv-resolver: partially revert Requires-Python version narrowing</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4902">#4902</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-07-08 16:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>The PR #4707 introduced the notion of &quot;version narrowing,&quot; where a
Requires-Python constraint was <em>possibly</em> narrowed whenever the
universal resolver created a fork. The version narrowing would occur
when the fork was a result of a marker expression on <code>python_version</code>
that is <em>stricter</em> than the configured <code>Requires-Python</code> (via, say,
<code>pyproject.toml</code>).</p>
<p>The crucial conceptual change made by #4707 is therefore that
<code>Requires-Python</code> is no longer an invariant configuration of resolution,
but rather a mutable constraint that can vary from fork to fork. This in
turn can result in some cases, such as in #4885, where different
versions of dependencies are selected. We aren&#x27;t sure whether we can fix
those or not, with version narrowing, so for now, we do this revert to
restore the previous behavior and we&#x27;ll try to address the version
narrowing some other time.</p>
<p>This also adds the case from #4885 as a regression test, ensuring that
we don&#x27;t break that in the future. I confirmed that with version
narrowing, this test outputs duplicate distributions. Without narrowing,
there are no duplicates.</p>
<p>Ref #4707, Fixes #4885</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-07-08 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-07-08 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-07-08 16:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-08 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-08 16:51</div>
            <div class="timeline-body"><p>Do you mind reopening the linked issue too that was closed by the PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-07-08 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-07-08 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-08 16:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:46:26 UTC
    </footer>
</body>
</html>
