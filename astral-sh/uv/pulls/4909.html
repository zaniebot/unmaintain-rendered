<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use paging for `uv help` display when available - astral-sh/uv #4909</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use paging for <code>uv help</code> display when available</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4909">#4909</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-07-08 20:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-08 20:55</div>
            <div class="timeline-body"><p>Extends https://github.com/astral-sh/uv/pull/4906</p>
<p>Adds paged display of &quot;long' help to <code>uv help</code> invocations when <code>less</code> or <code>more</code> is available.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @zanieb on 2024-07-08 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-09 00:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/help.rs</code>:234 on 2024-07-09 00:28</div>
            <div class="timeline-body"><p>Interesting this changes the default display from stderr to stdout â€” does this matter to us? It should match Cargo's behavior and seems okay to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-07-09 00:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @zanieb on 2024-07-09 00:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-07-09 00:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @zanieb on 2024-07-09 00:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>crates/uv/src/commands/help.rs</code>:90 on 2024-07-09 00:49</div>
            <div class="timeline-body"><p>Curious, is it possible to use stdin instead of relying on a temporary file for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/j178">@j178</a> reviewed on 2024-07-09 00:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-09 01:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/help.rs</code>:90 on 2024-07-09 01:35</div>
            <div class="timeline-body"><p>Quite possibly. I copied Cargo's implementation nearly wholesale here â€” I'm not sure why it's implemented that way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/j178">@j178</a> reviewed on 2024-07-09 02:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>crates/uv/src/commands/help.rs</code>:90 on 2024-07-09 02:58</div>
            <div class="timeline-body"><p>It seems that Cargo uses a temporary file because it supports displaying content using <code>man</code>, which does not handle piping from stdio. ðŸ¤”
https://github.com/rust-lang/cargo/commit/0e26eae5c1c3928e65921c40a667248338a2a92b#diff-5c9d825bb8a2ee825d064356b2f339ec5fbcc699ee617b484a703e03907884e2R54-R59</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/help.rs</code>:48 on 2024-07-09 09:01</div>
            <div class="timeline-body"><p>We should only try this if we're in a tty</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/help.rs</code>:234 on 2024-07-09 09:03</div>
            <div class="timeline-body"><p>Help output is regular is regular output that the user should read so that sounds correct to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-07-09 09:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/src/commands/help.rs</code>:48 on 2024-07-09 14:05</div>
            <div class="timeline-body"><p>Yeah, you want: https://doc.rust-lang.org/std/io/struct.Stdout.html#method.is_terminal</p>
<p>There are also flags like <code>-F</code> for <code>less</code> that may be useful here, although perhaps the expected behavior is that the pager always opens.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/src/commands/help.rs</code>:90 on 2024-07-09 14:09</div>
            <div class="timeline-body"><p>Yeah indeed, that's true if you're using <code>man</code>, although some implementations can do it via <code>-l/--local-file</code>: https://github.com/BurntSushi/ripgrep/blob/master/FAQ.md#does-ripgrep-have-a-man-page</p>
<p>However, @zanieb, we are using <code>less</code> and <code>more</code> here, and they should support streaming from stdin. Could be a follow-up PR though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/tests/help.rs</code>:234 on 2024-07-09 14:10</div>
            <div class="timeline-body"><p>Yeah I agree. <code>-h</code>, <code>--help</code> and <code>command help</code> should all write to <code>stdout</code>. But, e.g., <code>uv wat</code> should write an error to stderr.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-07-09 14:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/help.rs</code>:48 on 2024-07-09 14:12</div>
            <div class="timeline-body"><p>I don't think we <em>need</em> to check because <code>less</code> does? i.e. the test snapshots run fine and aren't in a tty</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-09 14:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-09 14:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/help.rs</code>:90 on 2024-07-09 14:13</div>
            <div class="timeline-body"><p>Makes sense to me. I'll consider switching here, it should be easy. I wondered about <code>man</code> pages but decided not to bite that off yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-07-09 14:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/src/commands/help.rs</code>:48 on 2024-07-09 14:18</div>
            <div class="timeline-body"><p>Yeah that's true, you might not need to do this if the pager checks for you. And it would be very weird for a pager to do anything other than be a <code>cat</code> when not connected to a tty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-09 14:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/help.rs</code>:90 on 2024-07-09 14:45</div>
            <div class="timeline-body"><p>Switched to a pipe</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-09 14:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/help.rs</code>:234 on 2024-07-09 14:45</div>
            <div class="timeline-body"><p>Updated to use stdout consistently</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-07-09 16:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/help.rs</code>:48 on 2024-07-09 16:56</div>
            <div class="timeline-body"><p>I think we shouldn't do a subprocess call if we don't need to, invocing another program always has it's own caveats</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-09 17:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/help.rs</code>:48 on 2024-07-09 17:05</div>
            <div class="timeline-body"><p>I guess.. Cargo does this on every <code>help</code> invocation so I'm not particularly concerned but I can change it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluetech">@bluetech</a> on 2024-07-09 17:49</div>
            <div class="timeline-body"><p>It is customary to consult the <code>PAGER</code> environment variable instead of invoking <code>less</code> or <code>more</code> directly. systemd has elaborate logic for this, though probably too complicated for uv (maybe there's a crate for this...): https://github.com/systemd/systemd/blob/1df981a74ae19513b40167c6b320c30bd166ac34/src/shared/pager.c</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-09 17:58</div>
            <div class="timeline-body"><p>@bluetech thanks for pointing that out! I probably won't address here just to keep things simple (and we're doing what Cargo does which is a reasonable starting point). I'd welcome a pull request to add support for <code>PAGER</code> though!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-07-09 18:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-07-09 18:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-09 18:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:43:10 UTC
    </footer>
</body>
</html>
