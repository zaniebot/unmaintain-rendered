<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Special case missing header build errors (on linux) - astral-sh/uv #354</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Special case missing header build errors (on linux)</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/354">#354</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-11-07 13:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2023-11-07 13:15</div>
            <div class="timeline-body"><p>One of the most common errors i observed are build failures due to missing header files. On ubuntu, this generally means that you need to install some <code>&lt;...&gt;-dev</code> package that the documentation tells you about, e.g. <a href="https://github.com/PyMySQL/mysqlclient#linux">mysqlclient</a> needs <code>default-libmysqlclient-dev</code>, <a href="https://www.psycopg.org/psycopg3/docs/basic/install.html#local-installation">some psycopg versions</a> (i remember that this was always required at some earlier point) require <code>libpq-dev</code> and pygraphviz wants <code>graphviz-dev</code>. This is quite common for many scientific packages (where conda has an advantage because they can provide those package as a dependency).</p>
<p>The error message can be completely inscrutable if you're just a python programmer (or user) and not a c programmer (example: pygraphviz):</p>
<pre><code>warning: no files found matching '*.png' under directory 'doc'
warning: no files found matching '*.txt' under directory 'doc'
warning: no files found matching '*.css' under directory 'doc'
warning: no previously-included files matching '*~' found anywhere in distribution
warning: no previously-included files matching '*.pyc' found anywhere in distribution
warning: no previously-included files matching '.svn' found anywhere in distribution
no previously-included directories found matching 'doc/build'
pygraphviz/graphviz_wrap.c:3020:10: fatal error: graphviz/cgraph.h: No such file or directory
 3020 | #include &quot;graphviz/cgraph.h&quot;
      |          ^~~~~~~~~~~~~~~~~~~
compilation terminated.
error: command '/usr/bin/gcc' failed with exit code 1
</code></pre>
<p>The only relevant part is <code>Fatal error: graphviz/cgraph.h: No such file or directory</code>. Why is this file not there and how do i get it to be there?</p>
<p>This is even harder to spot in pip's output, where it's 11 lines above the last line:</p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/7a3d7279-e7b1-4511-ab22-d0a35be5e672" alt="image" /></p>
<p>I've special cased missing headers and made sure that the last line tells you the important information: We're missing some header, please check the documentation of {package} {version} for what to install:</p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/4bbb8923-5a82-472f-ab1f-9e1471aa2896" alt="image" /></p>
<p>Scrolling up:</p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/89a2495a-e188-4288-b534-ad885ee08763" alt="image" /></p>
<p>The difference gets even clearer with a default ubuntu terminal with its 80 columns:</p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/49fb27bc-07c6-4b10-a1a1-30ec8e112438" alt="image" /></p>
<hr />
<p>Note that the situation is better for a missing compiler, there i get:</p>
<pre><code>[...]
warning: no previously-included files matching '*~' found anywhere in distribution
warning: no previously-included files matching '*.pyc' found anywhere in distribution
warning: no previously-included files matching '.svn' found anywhere in distribution
no previously-included directories found matching 'doc/build'
error: command 'gcc' failed: No such file or directory
---
</code></pre>
<p>Putting the last line into google, the first two results tell me to <code>sudo apt-get install gcc</code>, the third even tells me about <code>sudo apt install build-essential</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Special case missing header build errors" to "Special case missing header build errors (on linux)" by @konstin on 2023-11-07 13:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-07 14:30</div>
            <div class="timeline-body"><p>For comparison, here's a rust build error i just had:</p>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/02e9a59b-2e18-43fc-b475-f0148812eb9f" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-07 14:39</div>
            <div class="timeline-body"><p>Cool! These are indeed often inscrutable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-07 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/distribution/source_distribution.rs</code>:147 on 2023-11-07 15:19</div>
            <div class="timeline-body"><p>I don't think we should use <code>distribution.id()</code> here since it's just a hash of the URL for URL dependencies, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-11-07 15:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-resolver/src/distribution/source_distribution.rs</code>:147 on 2023-11-07 15:33</div>
            <div class="timeline-body"><p>oh right, do we already have something like a <code>diplay_id</code> or should i add one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-resolver/src/distribution/source_distribution.rs</code>:147 on 2023-11-07 15:34</div>
            <div class="timeline-body"><p>You could just call <code>.to_string()</code> on it for a display ID, I think? That will show <code>package==version</code> or <code>package @ URL</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-07 15:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-11-08 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-11-08 15:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-08 15:23</div>
            <div class="timeline-body"><p>@konstin - I'm merging your stuff as I approve to avoid conflicts with refactors that I'm working on now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-08 15:24</div>
            <div class="timeline-body"><p>Thanks for rebasing! Yes please merge quickly, we're getting a lot of merge conflicts otherwise</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-11-08 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-08 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-08 15:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:50:52 UTC
    </footer>
</body>
</html>
