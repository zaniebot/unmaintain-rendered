<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support `UV_WORKING_DIRECTORY` for setting `--directory` - astral-sh/uv #16125</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support <code>UV_WORKING_DIRECTORY</code> for setting <code>--directory</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/16125">#16125</a>
        opened by <a href="https://github.com/shunsock">@shunsock</a>
        on 2025-10-05 15:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shunsock">@shunsock</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>This pull request enables the <code>--directory</code> option to accept environment variable: <code>UV_DIRECTORY</code></p>
<h3>Motivation</h3>
<p>Currently, the <code>--project</code> option already supports environment variables, but --directory does not.</p>
<p>The motivation for this change is the same as for the --project option. When using this option, it‚Äôs likely that the project root and the directory containing the uv project differ. In such cases, allowing environment variables makes it easier to avoid repeatedly specifying the directory in commands or task runners.</p>
<h3>Other PRs</h3>
<ul>
<li>PR for create <code>--project</code> option: https://github.com/astral-sh/uv/pull/12327</li>
</ul>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<h3>no auto testing</h3>
<p>As with the --project option, no auto tests are included for this change.
This is because the implementation relies on Clap‚Äôs built-in attribute functionality, and testing such behavior would effectively mean testing a third-party crate, which would be redundant.</p>
<p>As long as the compiler accepts it, things should work as expected.</p>
<h3>testing manually</h3>
<p>i tested manually like <a href="https://github.com/astral-sh/uv/pull/12327">previous pull request</a></p>
<pre><code class="language-shell">$ cargo build --locked
./target/debug/uv init uv_directory

$ mkdir uv_directory

$ UV_DIRECTORY=uv_directory ./target/debug/uv sync
Using CPython 3.14.0rc3
Creating virtual environment at: .venv
Resolved 1 package in 15ms
Audited in 0.04ms

$ UV_DIRECTORY=uv_directory ./target/debug/uv run main.py
Hello from uv-directory!

$ ./target/debug/uv run main.py
error: Failed to spawn: `main.py`
  Caused by: No such file or directory (os error 2)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-06 15:36</div>
            <div class="timeline-body"><p>I think we might want this to be <code>UV_WORKING_DIRECTORY</code> if we add it? <code>UV_DIRECTORY</code> feels too ambiguous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shunsock">@shunsock</a> on 2025-10-06 16:01</div>
            <div class="timeline-body"><p>Thank you for reading. I agree with you. I'll rename it and fix the failing CI. I plan to make the changes by Thursday (JST).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shunsock">@shunsock</a> on 2025-10-06 16:27</div>
            <div class="timeline-body"><p>I rename <code>UV_DIRECTORY</code> to <code>UV_WORKING_DIRECTORY</code>, and tested.</p>
<pre><code class="language-shell">$ cargo build --locked
...
Finished `dev` profile [unoptimized + debuginfo] target(s) in 1m 06s

$ UV_WORKING_DIRECTORY=uv_directory ./target/debug/uv sync
Resolved 1 package in 12ms
Audited in 0.00ms

$ UV_WORKING_DIRECTORY=uv_directory ./target/debug/uv run main.py
Hello from uv-directory!

$ ./target/debug/uv run main.py
error: Failed to spawn: `main.py`
  Caused by: No such file or directory (os error 2)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-10-07 14:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-07 14:53</div>
            <div class="timeline-body"><p>You'll need to fix CI before this can be merged. Otherwise LGTM</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2025-10-07 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shunsock">@shunsock</a> on 2025-10-07 16:32</div>
            <div class="timeline-body"><p>I fixed CI except <a href="https://github.com/astral-sh/uv/actions/runs/18318439671/job/52165021439?pr=16125#step:11:5364">snapshot test</a> (<code>-\n</code> to <code>+\n</code>). Is there a way to update the snapshot?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shunsock">@shunsock</a> on 2025-10-08 05:32</div>
            <div class="timeline-body"><p>Thank you for updating snapshots üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "feature: option --directory allow to use environment variable" to "Support `UV_WORKING_DIRECTORY` for setting `--directory`" by @konstin on 2025-10-08 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-10-08 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-10-08 13:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:44:55 UTC
    </footer>
</body>
</html>
