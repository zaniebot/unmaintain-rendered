<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Require `--global` for removal of the global Python pin - astral-sh/uv #14169</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Require <code>--global</code> for removal of the global Python pin</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/14169">#14169</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-06-20 19:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>While reviewing <a href="https://github.com/astral-sh/uv/pull/14107">astral-sh/uv#14107</a>, @oconnor663 pointed out a bug where we allow <code>uv python pin --rm</code> to delete the global pin without the <code>--global</code> flag. I think that shouldn&#x27;t be allowed? I&#x27;m not 100% certain though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-20 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-21 19:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-python/src/version_files.rs</code>:221 on 2025-06-26 12:36</div>
            <div class="timeline-body"><p>Do we need this method or could you use a new <code>is_global()</code> method instead? (see comment below)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-python/src/version_files.rs</code>:221 on 2025-06-26 12:40</div>
            <div class="timeline-body"><p>Something like:</p>
<pre><code>  pub fn is_global(&amp;self) -&gt; bool {
      user_uv_config_dir().is_some_and(|dir| self.path == dir.join(PYTHON_VERSION_FILENAME))
  }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv/src/commands/python/pin.rs</code>:76 on 2025-06-26 12:42</div>
            <div class="timeline-body"><p>Can this be replaced with a new <code>PythonVersionFile::is_global()</code> method (see comment above)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-06-26 12:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-06-26 12:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/version_files.rs</code>:221 on 2025-06-26 12:45</div>
            <div class="timeline-body"><p>This constructor is used at https://github.com/astral-sh/uv/blob/ddab215bf937166f131e2df4c076923f27ca193c/crates/uv/src/commands/python/pin.rs#L206 to consolidate logic on where the global file is constructed.</p>
<p>We could add a <code>is_global</code> method too, but it&#x27;d just be a convenience method? I figured we could wait until there&#x27;s more than one use-case for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-06-26 12:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-python/src/version_files.rs</code>:221 on 2025-06-26 12:57</div>
            <div class="timeline-body"><p>I don&#x27;t have a strong opinion, but the condition below seemed more obscure than necessary. If we keep this method, can you mention when <code>None</code> is returned in the rustdoc?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-06-26 13:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/version_files.rs</code>:221 on 2025-06-26 13:24</div>
            <div class="timeline-body"><p>I&#x27;m happy to add the convenience method.</p>
<p>Separately, I&#x27;m still not sure how we could remove the <code>new_global</code> constructor without requiring the caller to provide the config path which is what I&#x27;m trying to avoid here so the logic is consolidated in the Python version file module. I can mention <code>None</code> in the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-06-26 14:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-python/src/version_files.rs</code>:221 on 2025-06-26 14:18</div>
            <div class="timeline-body"><p>Yeah, the constructor makes sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> approved on 2025-06-26 14:58</div>
            <div class="timeline-body"><p><code>file.path()</code> needs to be <code>self.path</code> in <code>is_global()</code> but otherwise looks good</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-26 15:12</div>
            <div class="timeline-body"><p>Thanks! That&#x27;s what I get for multitasking and pushing without <code>cargo check</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-06-26 17:11</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/uv/branches/zb%2Frm-global?runnerMode=Instrumentation">CodSpeed Instrumentation Performance Report</a>
Merging #14169 will <strong>not alter performance</strong>
<p>Comparing <code>zb/rm-global</code> (c57cc1c) with <code>release/080</code> (54eea89)</p>
Summary
<p><code>✅ 3</code> untouched benchmarks<br>
<code>⁉️ 9</code> dropped benchmarks</p>
<blockquote>
<p>:warning: <em>Please fix the performance issues or <a href="https://codspeed.io/astral-sh/uv/branches/zb%2Frm-global?runnerMode=Instrumentation">acknowledge them on CodSpeed</a>.</em></p>
</blockquote>
Benchmarks breakdown
<p>|     | Benchmark | <code>BASE</code> | <code>HEAD</code> | Change |
| --- | --------- | ----------------------- | ------------------- | ------ |
| ⁉️ | <code>build_platform_tags[burntsushi-archlinux]</code> | 278.9 µs | N/A | N/A |
| ⁉️ | <code>wheelname_parsing[flyte-long-compatible]</code> | 13.2 µs | N/A | N/A |
| ⁉️ | <code>wheelname_parsing[flyte-long-incompatible]</code> | 15.3 µs | N/A | N/A |
| ⁉️ | <code>wheelname_parsing[flyte-short-compatible]</code> | 4.9 µs | N/A | N/A |
| ⁉️ | <code>wheelname_parsing_failure[flyte-long-extension]</code> | 1.8 µs | N/A | N/A |
| ⁉️ | <code>wheelname_parsing_failure[flyte-short-extension]</code> | 1.8 µs | N/A | N/A |
| ⁉️ | <code>wheelname_tag_compatibility[flyte-long-compatible]</code> | 1.9 µs | N/A | N/A |
| ⁉️ | <code>wheelname_tag_compatibility[flyte-long-incompatible]</code> | 1.3 µs | N/A | N/A |
| ⁉️ | <code>wheelname_tag_compatibility[flyte-short-compatible]</code> | 1.6 µs | N/A | N/A |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-26 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-26 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-26 17:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:52:46 UTC
    </footer>
</body>
</html>
