<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `uv tool install --force` - astral-sh/uv #4501</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>uv tool install --force</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4501">#4501</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-06-25 00:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Adds detection of existing entry points, avoiding clobbering entry points that were installed by another tool. If we see any existing entry point collisions, we'll stop instead of overwriting them. The <code>--force</code> flag can be used to opt-in to overwriting the files; we can't use <code>-f</code> because it's taken by <code>--find-links</code> which is silly.  The <code>--force</code> flag also implies replacing a tool previously installed by uv (the environment is rebuilt).</p>
<p>Similarly, #4504 adds support for reinstalls that <em>will not</em> clobber entry points managed by other tools.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @zanieb on 2024-06-25 00:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-06-26 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-06-26 16:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-tool/src/lib.rs</code>:115 on 2024-06-26 18:40</div>
            <div class="timeline-body"><p>Nit: I don't think these typically end in a period</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-26 18:44</div>
            <div class="timeline-body"><p>Given this, how would I upgrade a tool?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-26 18:55</div>
            <div class="timeline-body"><blockquote>
<p>Given this, how would I upgrade a tool?</p>
</blockquote>
<p>We don't prefer anything about the existing environment right now. So <code>uv tool install &lt;tool&gt; --force</code> will upgrade, as will <code>uv tool install &lt;tool&gt; --reinstall</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-26 19:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-tool/src/lib.rs</code>:111 on 2024-06-26 19:05</div>
            <div class="timeline-body"><p>I have a sense that we might need to lock more aggressively, like for the duration of the command (and on a per-tool basis or something).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-26 19:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/tool/install.rs</code>:157 on 2024-06-26 19:06</div>
            <div class="timeline-body"><p>What happens if environment removal fails part-way through? The environment will be present but we won't have copied the entrypoints.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-26 19:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/lib.rs</code>:111 on 2024-06-26 19:10</div>
            <div class="timeline-body"><p>Why do we want a longer lock?</p>
<p>#4560 adds locking per tool though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-26 19:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/tool/install.rs</code>:157 on 2024-06-26 19:13</div>
            <div class="timeline-body"><p>This is during failure due to existing entry points â€” we'd just fail to display a nice error message.</p>
<p>There's a todo during environment creation though that covers your concern a little more holistically:</p>
<pre><code>    // TODO(zanieb): Build the environment in the cache directory then copy into the tool directory
    // This lets us confirm the environment is valid before removing an existing install
    let environment = installed_tools.create_environment(&amp;name, interpreter)?;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-26 19:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/lib.rs</code>:111 on 2024-06-26 19:25</div>
            <div class="timeline-body"><p>I guess if we lock over in the CLI then we can avoid modifying the executable directory concurrently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-26 19:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/lib.rs</code>:111 on 2024-06-26 19:25</div>
            <div class="timeline-body"><p>(I'd like to address this separately)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-26 19:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-tool/src/lib.rs</code>:111 on 2024-06-26 19:36</div>
            <div class="timeline-body"><p>There might be operations that happen after calling <code>remove_environment</code> that assume the tool no longer exists. Probably more common with <code>create_environment</code>: you probably assume later in the command that the environment exists. But if you're only locking when creating the environment, it could be removed immediately after. We might need to lock for the duration of the command to make it truly safe to run concurrently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-26 19:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-tool/src/lib.rs</code>:111 on 2024-06-26 19:37</div>
            <div class="timeline-body"><p>Makes sense, thanks for explaining.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-06-26 19:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-06-26 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-06-26 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-06-26 20:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:37:42 UTC
    </footer>
</body>
</html>
