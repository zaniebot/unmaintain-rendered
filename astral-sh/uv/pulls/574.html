<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove `.whl` extension for cached, unzipped wheels - astral-sh/uv #574</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remove <code>.whl</code> extension for cached, unzipped wheels</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/574">#574</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-12-05 21:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body">Summary
<p>This PR uses the wheel stem (e.g.,  <code>foo-1.2.3-py3-none-any</code>) instead of the wheel name (e.g., <code>foo-1.2.3-py3-none-any.whl</code>) when storing unzipped wheels in the cache, which removes a class of confusing issues around overwrites and directory-vs.-file collisions.</p>
<p>For now, we retain <em>both</em> the zipped and unzipped wheels in the cache, though we can easily change this by storing the zipped wheels in a temporary directory.</p>
<p>Closes <a href="https://github.com/astral-sh/puffin/issues/573">astral-sh/puffin#573</a>.</p>
Test Plan
<p>Some examples from my local cache:</p>
<img alt="Screen Shot 2023-12-05 at 4 09 55 PM" src="https://github.com/astral-sh/puffin/assets/1309177/784146aa-b080-416e-9767-40c843fe5d6a">
<img alt="Screen Shot 2023-12-05 at 4 12 14 PM" src="https://github.com/astral-sh/puffin/assets/1309177/4bc7f30f-bef3-47f1-b4e8-da9cabf87f28">
<img alt="Screen Shot 2023-12-05 at 4 09 50 PM" src="https://github.com/astral-sh/puffin/assets/1309177/25ca4944-4a06-4a08-ac85-c6f7d8b5c8ea">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Remove .whl extension for cached, unzipped wheels&quot; to &quot;Remove `.whl` extension for cached, unzipped wheels&quot; by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-05 21:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/distribution-filename/src/wheel.rs</code>:41 on 2023-12-05 21:16</div>
            <div class="timeline-body"><p>@konstin - Do you know why we do this...? This is unchanged, Git is just confused, see it in red below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-12-05 21:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-distribution/src/source_dist.rs</code>:98 on 2023-12-05 21:21</div>
            <div class="timeline-body"><p>We have to be careful with these structs because the thing at <code>target</code> may or may not exist (it&#x27;s the unzipped wheel). But we&#x27;re now planning to have semantics such that if it <em>does</em> exist, it&#x27;s respected (rather than deleted).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-12-05 22:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/distribution-filename/src/wheel.rs</code>:41 on 2023-12-05 22:07</div>
            <div class="timeline-body"><p>iirc because <code>_</code> vs <code>-</code>, but that might not be applicable anymore</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2023-12-05 22:09</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>The cache bucket docs need updating</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 22:34</div>
            <div class="timeline-body"><p>Done, good call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 22:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-05 22:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-12-05 22:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:42:50 UTC
    </footer>
</body>
</html>
