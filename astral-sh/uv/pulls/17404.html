<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broadcast WM_SETTINGCHANGE on uv tool update-shell - astral-sh/uv #17404</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Broadcast WM_SETTINGCHANGE on uv tool update-shell</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/17404">#17404</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2026-01-11 05:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/samypr100">@samypr100</a> on 2026-01-11 05:02</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Closes https://github.com/astral-sh/uv/issues/17331</p>
<p>Certain applications on windows expect to be notified when environment variables change such as conhost.exe (traditional cmd.exe host).
Without this notification conhost.exe will not pick up changes to environment variables regardless of how many times conhost.exe is re-launched after running <code>uv tool update-shell</code>.</p>
<h2>Test Plan</h2>
<p>Before this change</p>
<ol>
<li>Removed <code>%USERPROFILE%\.local\bin</code> from environment variables via UI (which sends <code>WM_SETTINGCHANGE</code>)</li>
<li>Launched <code>%SYSTEMROOT%\System32\conhost.exe</code> and attempted to run any tool preivously installed. It fails to find any.</li>
<li>Ran <code>uv tool update-shell</code>. Confirmed <code>HKEY_CURRENT_USER\Environment\Path</code> was updated in registry.</li>
<li>Launched new <code>%SYSTEMROOT%\System32\conhost.exe</code> session. <strong>Fails to find installed tools</strong>.</li>
</ol>
<p>After this change</p>
<ol>
<li>Removed <code>%USERPROFILE%\.local\bin</code> from environment variables via UI (which sends <code>WM_SETTINGCHANGE</code>)</li>
<li>Launched <code>%SYSTEMROOT%\System32\conhost.exe</code> and attempted to run any tool preivously installed. It fails to find any.</li>
<li>Ran <code>uv tool update-shell</code>. Confirmed <code>HKEY_CURRENT_USER\Environment\Path</code> was updated in registry.</li>
<li>Launched new <code>%SYSTEMROOT%\System32\conhost.exe</code> session. <strong>Finds the installed tools</strong>.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @samypr100 on 2026-01-11 05:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2026-01-11 05:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>Cargo.toml</code>:199 on 2026-01-11 05:03</div>
            <div class="timeline-body"><p>Sorted and added <code>Win32_UI_WindowsAndMessaging</code> explicitly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @samypr100 on 2026-01-11 05:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2026-01-11 13:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2026-01-11 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2026-01-11 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2026-01-11 14:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:27:10 UTC
    </footer>
</body>
</html>
