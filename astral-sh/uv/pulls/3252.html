<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concurrent progress bars - astral-sh/uv #3252</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Concurrent progress bars</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3252">#3252</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2024-04-24 20:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-04-24 20:11</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Implements concurrent progress bars. Resolves https://github.com/astral-sh/uv/issues/1209.</p>
<h2>Test Plan</h2>
<p>https://github.com/astral-sh/uv/assets/34988408/b21bdfbb-8817-4873-a65c-16c9e8c7c460</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @ibraheemdev on 2024-04-24 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2024-04-25 09:17</div>
            <div class="timeline-body"><p>could it be sorted (the largest at top)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-04-25 17:11</div>
            <div class="timeline-body"><p>@T-256 I put the largest at the bottom which looks more natural, in my opinion.</p>
<p>https://github.com/astral-sh/uv/assets/34988408/52915706-5349-48b4-82e4-a72f8b1c9846</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @ibraheemdev on 2024-04-25 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">tracing</span> added by @zanieb on 2024-04-25 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @zanieb on 2024-04-25 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-26 00:20</div>
            <div class="timeline-body"><p>The code generally looks good (well done) but need to find a bit of time to play with this myself to see if I have any feedback on the UX.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-04-30 18:20</div>
            <div class="timeline-body"><p>Just tested this on a large requirements file, I think any downloads &lt;250kb shouldn't be displayed. The output changes too fast for it to be useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-04-30 18:20</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/uv/branches/ibraheemdev:concurrent-progress-bar">CodSpeed Performance Report</a></h2>
<h3>Merging #3252 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>ibraheemdev:concurrent-progress-bar</code> (0ab84fe) with <code>main</code> (080f095)</sub></p>
<h3>Summary</h3>
<p><code>‚úÖ 13</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-04-30 18:39</div>
            <div class="timeline-body"><p>We should also probably provide a way to disable this output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-30 18:42</div>
            <div class="timeline-body"><p>We could consider making it opt-in. (That would also make it less risky to ship.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-30 18:49</div>
            <div class="timeline-body"><p>What's the risk, specifically? It seems improbable that this will break people's workflows right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-30 18:50</div>
            <div class="timeline-body"><p>We do have a preview option now though, if you really want to gate it. A dedicated setting might make sense too? but opt-in seems wrong for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-30 18:54</div>
            <div class="timeline-body"><p>I think the risk is just that it‚Äôs overly verbose for most package installs and may require tuning. I would be fine shipping it under preview so we can get feedback on the UI/UX. I haven‚Äôt had a chance to play with it myself yet though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-30 19:07</div>
            <div class="timeline-body"><p>I don't mind iterating on display ux without opt-in, it feels much safer than other changes we make and we release very often.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-03 12:56</div>
            <div class="timeline-body"><p>Is this waiting on any feedback?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-03 13:16</div>
            <div class="timeline-body"><p>Yes, from me at least - not sure if others are planning to review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-23 14:49</div>
            <div class="timeline-body"><p>I'd love to get this merged, I don't think it's great to have it hanging for weeks. Anything I can do to move this forward?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-23 14:52</div>
            <div class="timeline-body"><p>Ultimately it's on me to review. However you could test and give feedback on the UX -- it would make it higher-confidence for me if we could get more eyes and opinions on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-23 15:17</div>
            <div class="timeline-body"><p>I did test it and was happy with it but I can do more investigation.</p>
<p>@ibraheemdev can you rebase the branch?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-23 15:24</div>
            <div class="timeline-body"><p>I will review and merge today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-23 15:28</div>
            <div class="timeline-body"><p>I'll rebase. I am a little concerned about the output when you have a lot of small downloads though, e.g. https://github.com/astral-sh/uv/issues/2706#issuecomment-2115781002. Even kitty was flickering a little. We can probably buffer updates to the terminal a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-23 15:42</div>
            <div class="timeline-body"><p>If anyone has &quot;good&quot; test cases post 'em here so we have some common ground when considering the behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-23 15:42</div>
            <div class="timeline-body"><p>I'm also supportive of including an opt-out environment variable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-23 16:07</div>
            <div class="timeline-body"><p>I would still be fine making it opt-in if we want to get more feedback before stabilizing :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-23 16:56</div>
            <div class="timeline-body"><p>Testing with</p>
<pre><code>cargo run -q -- pip install anyio --reinstall --no-cache
cargo run -q -- pip install pydantic --reinstall --no-cache
cargo run -q -- pip install prefect --reinstall --no-cache
cargo run -q -- pip install pyqt5 --reinstall --no-cache
</code></pre>
<p>All good to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2024-05-23 20:16</div>
            <div class="timeline-body"><p>LGTM and as Charlie said, it could be opt-in via <code>--preview</code> and after stabilization make it default behavior. Also, as Zanie said we can have an option to opt-out from it.</p>
<blockquote>
<p>We can probably buffer updates to the terminal a bit.</p>
</blockquote>
<p>Let's get some feedback from users, then we can set this interval value with more confidence.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-23 21:42</div>
            <div class="timeline-body"><p>Should we just move behind preview to unblock the decision? @ibraheemdev do you <em>want</em> it to ship to stable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-23 22:40</div>
            <div class="timeline-body"><p>I'm fine with merging this behind preview or an opt-in flag, as long as it's accessible because it can be useful for debugging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-23 23:13</div>
            <div class="timeline-body"><p>I have a medium preference for shipping it in stable with an opt-out, but that requires a separate mechanism than <code>--preview</code> ü§∑‚Äç‚ôÄÔ∏è</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-23 23:25</div>
            <div class="timeline-body"><p>Let's just move it to <code>--preview</code> to get it unblocked I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 03:12</div>
            <div class="timeline-body"><p>I like how pip's progress bars are left-aligned and have a default width -- as-is the display is too wide IMO on my monitor:</p>
<p><img src="https://github.com/astral-sh/uv/assets/1309177/81964a17-6249-45eb-a9ea-0d9f9f1f666f" alt="Screenshot 2024-05-23 at 11 11 30‚ÄØPM" /></p>
<p><img src="https://github.com/astral-sh/uv/assets/1309177/4dd53350-1ef6-46cd-ad59-e394a0d4ba67" alt="Screenshot 2024-05-23 at 11 12 18‚ÄØPM" /></p>
<p>How hard is it to achieve something like that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 03:15</div>
            <div class="timeline-body"><p>To achieve that, I guess we'd need to put the package name above the bar, or to the right of it, to achieve consistent alignment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 03:16</div>
            <div class="timeline-body"><p>Or use a fixed size for the package name. I can play with it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 03:29</div>
            <div class="timeline-body"><p>Here's a slightly different layout. The colors are washed out in the video but it's green on dim:</p>
<p>https://github.com/astral-sh/uv/assets/1309177/b7ada082-cb52-4553-9b1c-1d2e52d1bc62</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 03:29</div>
            <div class="timeline-body"><p>Thoughts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-24 03:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-distribution/src/distribution_database.rs</code>:494 on 2024-05-24 03:31</div>
            <div class="timeline-body"><p>I feel like I'm so allergic to unwrap that I'd probably do something like:</p>
<pre><code class="language-rust">let progress = self
    .reporter
    .as_ref()
    .map(|reporter| (reporter, reporter.on_download_start(dist.name(), size)));
</code></pre>
<p>And then use <code>match self.progress</code> everywhere. What's your instinct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-distribution/src/distribution_database.rs</code>:906 on 2024-05-24 03:31</div>
            <div class="timeline-body"><p>Why not parse as <code>u64</code>? Just wondering.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-24 03:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-24 03:57</div>
            <div class="timeline-body"><p>@charliermarsh your design looks quite nice, I would be happy to switch to that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 13:58</div>
            <div class="timeline-body"><p>Sounds good, I'll merge this today. I looked at gating behind preview but honestly looks like kind of a pain haha.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 13:59</div>
            <div class="timeline-body"><p>We can add a <code>--no-progress</code> flag?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-05-24 18:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv-distribution/src/distribution_database.rs</code>:906 on 2024-05-24 18:59</div>
            <div class="timeline-body"><p>Should be <code>u64</code>, fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a> reviewed on 2024-05-24 18:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on <code>crates/uv-distribution/src/distribution_database.rs</code>:494 on 2024-05-24 18:59</div>
            <div class="timeline-body"><p>That is nicer, updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-05-27 01:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-27 01:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/itayporezky">@itayporezky</a> on 2024-05-28 20:18</div>
            <div class="timeline-body"><p>After seeing this in the release notes i was afraid it would cause <a href="https://stackoverflow.com/q/66290522">this</a>
But in my testing it didn't, so that's great :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:32:37 UTC
    </footer>
</body>
</html>
