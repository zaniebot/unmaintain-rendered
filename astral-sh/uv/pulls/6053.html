<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: introduce more docker tags for uv - astral-sh/uv #6053</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: introduce more docker tags for uv</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6053">#6053</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2024-08-13 05:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Closes https://github.com/astral-sh/uv/issues/5610</p>
<p>This PR introduces additional images with the uv/uvx binaries from scratch for both amd64/arm64 and make the mapping easy to configure by generating the Dockerfile on the fly. This approach focuses on minimizing CI time by taking advantage of dedicating a worker per mapping (20-30s~ per job).</p>
<p>This PR also fixes <code>org.opencontainers.image.version</code> for all tags (including the one from <code>scratch</code>) to contain the right release version instead of branch name <code>main</code> (default when no tag patterns are specified).</p>
<p>For example, on release <code>x.y.z</code>, this will publish the following image tags with format <code>ghcr.io/astral-sh/uv:{tag}</code> with manifests for both amd64/arm64. This also include <code>x.y</code> tags for each respective additional tag.</p>
<ul>
<li>From <strong>scratch</strong>: <code>latest</code>, <code>x.y.z</code>, <code>x.y</code> (currently being published)</li>
<li>From <strong>alpine:3.20</strong>: <code>alpine</code>, <code>alpine3.20</code>, <code>x.y.z-alpine</code>, <code>x.y.z-alpine3.20</code></li>
<li>From <strong>debian:bookworm-slim</strong>: <code>debian-slim</code>, <code>bookworm-slim</code>, <code>x.y.z-debian-slim</code>, <code>x.y.z-bookworm-slim</code></li>
<li>From <strong>buildpack-deps:bookworm</strong>: <code>debian</code>, <code>bookworm</code>, <code>x.y.z-debian</code>, <code>x.y.z-bookworm</code></li>
<li>From <strong>python:3.12-alpine</strong>: <code>python3.12-alpine</code>, <code>x.y.z-python3.12-alpine</code></li>
<li>From <strong>python:3.11-alpine</strong>: <code>python3.11-alpine</code>, <code>x.y.z-python3.11-alpine</code></li>
<li>From <strong>python:3.10-alpine</strong>: <code>python3.10-alpine</code>, <code>x.y.z-python3.10-alpine</code></li>
<li>From <strong>python:3.9-alpine</strong>: <code>python3.9-alpine</code>, <code>x.y.z-python3.9-alpine</code></li>
<li>From <strong>python:3.8-alpine</strong>: <code>python3.8-alpine</code>, <code>x.y.z-python3.8-alpine</code></li>
<li>From <strong>python:3.12-bookworm</strong>: <code>python3.12-bookworm</code>, <code>x.y.z-python3.12-bookworm</code></li>
<li>From <strong>python:3.11-bookworm</strong>: <code>python3.11-bookworm</code>, <code>x.y.z-python3.11-bookworm</code></li>
<li>From <strong>python:3.10-bookworm</strong>: <code>python3.10-bookworm</code>, <code>x.y.z-python3.10-bookworm</code></li>
<li>From <strong>python:3.9-bookworm</strong>: <code>python3.9-bookworm</code>, <code>x.y.z-python3.9-bookworm</code></li>
<li>From <strong>python:3.8-bookworm</strong>: <code>python3.8-bookworm</code>, <code>x.y.z-python3.8-bookworm</code></li>
<li>From <strong>python:3.12-slim-bookworm</strong>: <code>python3.12-bookworm-slim</code>, <code>x.y.z-python3.12-bookworm-slim</code></li>
<li>From <strong>python:3.11-slim-bookworm</strong>: <code>python3.11-bookworm-slim</code>, <code>x.y.z-python3.11-bookworm-slim</code></li>
<li>From <strong>python:3.10-slim-bookworm</strong>: <code>python3.10-bookworm-slim</code>, <code>x.y.z-python3.10-bookworm-slim</code></li>
<li>From <strong>python:3.9-slim-bookworm</strong>: <code>python3.9-bookworm-slim</code>, <code>x.y.z-python3.9-bookworm-slim</code></li>
<li>From <strong>python:3.8-slim-bookworm</strong>: <code>python3.8-bookworm-slim</code>, <code>x.y.z-python3.8-bookworm-slim</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-13 12:23</div>
            <div class="timeline-body"><p>Below is what <a href="https://github.com/astral-sh/uv/pkgs/container/uv/versions?filters%5Bversion_type%5D=tagged">https://github.com/astral-sh/uv/pkgs</a> would end up looking like with the additional tags (just for 0.2.35).</p>
<img width="560" alt="uv-tags" src="https://github.com/user-attachments/assets/2765eed0-6783-48a0-bb20-b31e8918de5c">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @samypr100 on 2024-08-13 12:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-13 13:47</div>
            <div class="timeline-body"><p>Epic! Thank you! I'll review this one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-08-13 13:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-08-13 16:53</div>
            <div class="timeline-body"><p>This looks good to me. I might play with the job names so they're more readable? but otherwise it seems great. I like the approach you took.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-13 17:06</div>
            <div class="timeline-body"><p>I would like to hear a bit more about what motivating adding quite so many tags, I was imagining a less :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">release</span> added by @zanieb on 2024-08-13 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-13 20:46</div>
            <div class="timeline-body"><blockquote>
<p>This looks good to me. I might play with the job names so they're more readable? but otherwise it seems great. I like the approach you took.</p>
</blockquote>
<p>Happy to rename the jobs, lmk</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-13 20:48</div>
            <div class="timeline-body"><blockquote>
<p>I would like to hear a bit more about what motivating adding quite so many tags, I was imagining a less :)</p>
</blockquote>
<p>I primarily mimicked supported patterns from docker hub official images for <a href="https://hub.docker.com/_/python">python</a> and general use (non-bundled python ones) and the tags they support. I considered the feedback / use cases from @konstin and yours on https://github.com/astral-sh/uv/issues/5610#issuecomment-2260503147 as well. I thought this was a good starting point.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-16 01:35</div>
            <div class="timeline-body"><p>Cool, thanks for explaining. Just waiting for consensus from more of the team here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-08-16 01:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jvacek">@jvacek</a> on 2024-08-28 09:14</div>
            <div class="timeline-body"><p>@samypr100 do you have these pushed anywhere by any chance? Would love to test them out, I could write some docs on how to implem these for GitLab</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-28 13:03</div>
            <div class="timeline-body"><blockquote>
<p>@samypr100 do you have these pushed anywhere by any chance? Would love to test them out, I could write some docs on how to implem these for GitLab</p>
</blockquote>
<p>I've published the ones I've built in https://github.com/samypr100/uv/pkgs/container/uv, but do not use these for anything official as I might delete them eventually.</p>
<p>That being said, it would very helpful if you can confirm they resolve your problem in Gitlab.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-28 13:40</div>
            <div class="timeline-body"><p>@samypr100 does this need a rebase after the other changes?</p>
<p>I might merge this for the release today. Nobody else on the team is expressing opinions...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-28 13:52</div>
            <div class="timeline-body"><blockquote>
<p>@samypr100 does this need a rebase after the other changes?</p>
<p>I might merge this for the release today. Nobody else on the team is expressing opinions...</p>
</blockquote>
<p>@zanieb It does not need a rebase, unless we also want to support tags without <code>patch</code> version (e.g. 0.3) on the additional extra images, That can be done as a follow up though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-29 02:36</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>@samypr100 does this need a rebase after the other changes?
I might merge this for the release today. Nobody else on the team is expressing opinions...</p>
</blockquote>
<p>@zanieb It does not need a rebase, unless we also want to support tags without <code>patch</code> version (e.g. 0.3) on the additional extra images, That can be done as a follow up though.</p>
</blockquote>
<p>@zanieb The latest version now also handles <code>major.minor</code> tags as well. I've also added the details of the new tags to the new docs section introduced in #6768.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jvacek">@jvacek</a> on 2024-08-29 08:51</div>
            <div class="timeline-body"><p>@samypr100 Will test, thanks!</p>
<p>Also, any chance you could introduce the same changes to ruff?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-29 17:46</div>
            <div class="timeline-body"><blockquote>
<p>@samypr100 Will test, thanks!</p>
<p>Also, any chance you could introduce the same changes to ruff?</p>
</blockquote>
<p>I can take a look at supporting after this is merged, although I don't think the python-based images make sense over there so it will likely be just distroless, alpine, and debian.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jvacek">@jvacek</a> on 2024-08-30 09:25</div>
            <div class="timeline-body"><p>I've got success on GitLab, amazing! Thanks @samypr100</p>
<p>Here's my config:</p>
<pre><code>.uv_compile:
  stage: analysis
  image:
    name: ghcr.io/samypr100/uv:0.4-python3.12-alpine
  script: &gt;
    cd $CODE_LOCATION

    if [ -z &quot;$FILES&quot; ]; then
      FILES=$(find . -iname requirements*.in -maxdepth 1)
    fi

    for file in $FILES; do
      output_file=${file%.in}.txt
      uv pip compile $file --extra-index-url $EXTRA_INDEX_URL --no-strip-extras --output-file $output_file
    done

    git diff HEAD --exit-code
</code></pre>
<p>Side note: I have to call to <code>git diff</code> to complete my use-case for checking if the requirements are compiled,  https://github.com/astral-sh/uv/issues/3021 is relevant here in my opinion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-09-03 13:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-09-03 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-03 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-09-03 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-09-04 01:52</div>
            <div class="timeline-body"><p>It worked ðŸ¥³, starting with 0.4.4 new extra docker tags have been published.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-04 02:48</div>
            <div class="timeline-body"><p>Haha oops I meant to do that release so I could watch it.. glad it worked! Thank you!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:38:51 UTC
    </footer>
</body>
</html>
