<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add comma-separated support for --extra and --group flags - astral-sh/uv #15343</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add comma-separated support for --extra and --group flags</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/15343">#15343</a>
        opened by <a href="https://github.com/yumeminami">@yumeminami</a>
        on 2025-08-18 08:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/yumeminami">@yumeminami</a> on 2025-08-18 08:01</div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>Support https://github.com/astral-sh/uv/issues/15332, Adds comma-separated support for <code>--extra</code> and <code>--group</code> flags in uv commands. Users can now specify multiple extras or groups with syntax like <code>--extra dev,test,docs</code> instead of requiring separate <code>--extra dev --extra test --extra docs</code> flags. Maintains full backward compatibility with existing individual flag usage.</p>
<h2>Test Plan</h2>
<ul>
<li>Added comprehensive unit tests covering basic comma-separated usage, mixed syntax (combinin comma-separated and individual flags), and error handling for non-existent extras/groups- Tests verify functionality across sync, export, and run commands</li>
<li>All existing tests continue to pass, ensuring backward compatibility</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paduszyk">@paduszyk</a> on 2025-08-18 12:16</div>
            <div class="timeline-body"><p>@yumeminami Thanks for dealing with it so quickly. I would only suggest to link this PR by using one of the linking <a href="https://docs.github.com/en/issues/tracking-your-work-with-issues/using-issues/linking-a-pull-request-to-an-issue#linking-a-pull-request-to-an-issue-using-a-keyword">keywords</a>, so that the community can see that somebody works on the ticket.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yumeminami">@yumeminami</a> on 2025-08-18 13:06</div>
            <div class="timeline-body"><p>@paduszyk</p>
<p>I really like this tool, so I'd like to contribute to the community.</p>
<p>I think using a comma instead of writing '--extra' or '--group' again would improve the user experience.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 15:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:4167 on 2025-08-18 15:59</div>
            <div class="timeline-body"><p>Can you move this down so it fits with the existing comment about multiples? e.g.,</p>
<pre><code>/// Multiple values may be provided with comma separated values or by repeating the flag.
</code></pre>
<p>(this applies throughout)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 17:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:4167 on 2025-08-18 17:26</div>
            <div class="timeline-body"><p>Thanks! It's not moved down though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 17:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:4167 on 2025-08-18 17:28</div>
            <div class="timeline-body"><p>i.e., it reads</p>
<pre><code>    /// Install the specified dependency group from a `pyproject.toml`.
    /// Multiple values may be provided with comma separated values or by repeating the flag.
    ///
    /// If no path is provided, the `pyproject.toml` in the working directory is used.
    ///
    /// May be provided multiple times.
</code></pre>
<p>instead of</p>
<pre><code>    /// Install the specified dependency group from a `pyproject.toml`.
    ///
    /// If no path is provided, the `pyproject.toml` in the working directory is used.
    ///
    /// Multiple values may be provided with comma separated values or by repeating the flag.
</code></pre>
<p>On re-reading though, we should probably say...</p>
<blockquote>
<p>Multiple values may be provided separated by commas or by repeating the flag.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 17:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:96 on 2025-08-18 17:28</div>
            <div class="timeline-body"><p>Can you explain why we need this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 17:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:99 on 2025-08-18 17:29</div>
            <div class="timeline-body"><p>Here we're just dropping the error that <code>GroupName::from_str</code> returns and constructing a new one? Why?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 17:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:99 on 2025-08-18 17:30</div>
            <div class="timeline-body"><p>I guess this matches <code>extra_name_with_clap_error</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yumeminami">@yumeminami</a> reviewed on 2025-08-18 18:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yumeminami">@yumeminami</a> on <code>crates/uv-cli/src/lib.rs</code>:99 on 2025-08-18 18:07</div>
            <div class="timeline-body"><p>I think <code>Invalid extra name</code> and <code>Invalid group name</code> will be more intuitive for CLI users than &quot;Not a valid package or extra name&quot; - it's more direct and context-aware.</p>
<pre><code>current output: ✗ Invalid extra name 'invalid#name': Extra names must start and end with a letter or digit and may only contain -, _, ., and alphanumeric characters
original output: ✗ Not a valid package or extra name: &quot;invalid#name&quot;. Names must start and end with a letter or digit and may only contain -, _, ., and alphanumeric characters.
</code></pre>
<p>Should we just use the original errors like <code>pip_group_name_with_clap_error</code> does?</p>
<pre><code class="language-rust">GroupName::from_str(trimmed).map_err(|err| anyhow!(&quot;{}&quot;, err))
</code></pre>
<p>This would be simpler and consistent across all functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:99 on 2025-08-18 18:11</div>
            <div class="timeline-body"><p>Thanks for explaining!</p>
<p>I would expect to use the original error. I think the problem is that the original error is bad? e.g., at</p>
<p>https://github.com/astral-sh/uv/blob/3f83390e342dcb6fccc449335c15d1255885ad20/crates/uv-normalize/src/group_name.rs#L38-L45</p>
<p>we should not just be using <code>InvalidNameError</code> because it has a generic message</p>
<p>https://github.com/astral-sh/uv/blob/3f83390e342dcb6fccc449335c15d1255885ad20/crates/uv-normalize/src/lib.rs#L111-L120</p>
<p>We should probably introduce a dedicated error variant and map the error? Or we should make <code>InvalidNameError</code> more advanced?</p>
<p>I'm fine opening an issue to track this work — this pull request doesn't make it worse.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yumeminami">@yumeminami</a> on <code>crates/uv-cli/src/lib.rs</code>:96 on 2025-08-18 18:18</div>
            <div class="timeline-body"><p>We need it because <code>PipGroupName</code> supports path-prefixed syntax like <code>&quot;pyproject.toml:dev&quot;</code> that <code>GroupName</code> doesn't handle.</p>
<ul>
<li><code>GroupName</code>: <code>&quot;dev&quot;</code>, <code>&quot;test&quot;</code></li>
<li><code>PipGroupName</code>: <code>&quot;dev&quot;</code>, <code>&quot;test&quot;</code>, <code>&quot;pyproject.toml:dev&quot;</code>, <code>&quot;path/to/pyproject.toml:test&quot;</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yumeminami">@yumeminami</a> reviewed on 2025-08-18 18:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:96 on 2025-08-18 18:21</div>
            <div class="timeline-body"><p>Why does that mean we need an extra function? I think the answer is that this implements trimming? but that could just be implemented in <code>PipGroupName::from_str</code>? I guess the question is whether we want that or not? (it seems reasonable <em>not</em> to trim there).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 18:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:1877 on 2025-08-18 18:21</div>
            <div class="timeline-body"><p>This is inconsistent with the other text.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-08-18 18:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yumeminami">@yumeminami</a> reviewed on 2025-08-18 18:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yumeminami">@yumeminami</a> on <code>crates/uv-cli/src/lib.rs</code>:99 on 2025-08-18 18:23</div>
            <div class="timeline-body"><p>how about this changes?</p>
<pre><code class="language-rust">fn name_with_clap_error&lt;T&gt;(arg: &amp;str, name_type: &amp;str) -&gt; Result&lt;T&gt;
where
    T: FromStr,
    T::Err: std::fmt::Display,
{
    let trimmed = arg.trim();
    if trimmed.is_empty() {
        return Err(anyhow!(&quot;{} cannot be empty&quot;, name_type));
    }
    T::from_str(trimmed).map_err(|err| anyhow!(&quot;{}&quot;, err))
}

fn extra_name_with_clap_error(arg: &amp;str) -&gt; Result&lt;ExtraName&gt; {
    name_with_clap_error::&lt;ExtraName&gt;(arg, &quot;Extra name&quot;)
}

fn group_name_with_clap_error(arg: &amp;str) -&gt; Result&lt;GroupName&gt; {
    name_with_clap_error::&lt;GroupName&gt;(arg, &quot;Group name&quot;)
}

fn pip_group_name_with_clap_error(arg: &amp;str) -&gt; Result&lt;PipGroupName&gt; {
    name_with_clap_error::&lt;PipGroupName&gt;(arg, &quot;Group name&quot;)
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yumeminami">@yumeminami</a> reviewed on 2025-08-18 18:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yumeminami">@yumeminami</a> on <code>crates/uv-cli/src/lib.rs</code>:1877 on 2025-08-18 18:24</div>
            <div class="timeline-body"><p>I will update all about the comment issue tomorrow, thanks your review!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yumeminami">@yumeminami</a> on <code>crates/uv-cli/src/lib.rs</code>:99 on 2025-08-18 18:27</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for explaining!</p>
<p>I would expect to use the original error. I think the problem is that the original error is bad? e.g., at</p>
<p>https://github.com/astral-sh/uv/blob/3f83390e342dcb6fccc449335c15d1255885ad20/crates/uv-normalize/src/group_name.rs#L38-L45</p>
<p>we should not just be using <code>InvalidNameError</code> because it has a generic message</p>
<p>https://github.com/astral-sh/uv/blob/3f83390e342dcb6fccc449335c15d1255885ad20/crates/uv-normalize/src/lib.rs#L111-L120</p>
<p>We should probably introduce a dedicated error variant and map the error? Or we should make <code>InvalidNameError</code> more advanced?</p>
<p>I'm fine opening an issue to track this work — this pull request doesn't make it worse.</p>
</blockquote>
<p>yeah! if we can map the error, for users who mix <code>--group</code> and <code>--extra</code>, this will make it quicker and more straightforward to see where the error occurred. I’m happy to contribute to improving the user experience.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yumeminami">@yumeminami</a> reviewed on 2025-08-18 18:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yumeminami">@yumeminami</a> reviewed on 2025-08-18 18:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/yumeminami">@yumeminami</a> on <code>crates/uv-cli/src/lib.rs</code>:96 on 2025-08-18 18:35</div>
            <div class="timeline-body"><p>I think <code>trimming</code> is more of a CLI-layer concern. The type-level <code>PipGroupName::from_str</code> should focus on pure validation logic</p>
<p>What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SeanOverton">@SeanOverton</a> approved on 2025-08-18 21:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yumeminami">@yumeminami</a> on 2025-08-19 02:02</div>
            <div class="timeline-body"><ol>
<li>I've refactored the implementation of <code>extra/group/pip_group_name_with_clap_error</code> so that their error output is consistent.</li>
<li>I've modified all related comments.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yumeminami">@yumeminami</a> on 2025-08-19 17:58</div>
            <div class="timeline-body"><p>hey! some one continue to review the pr?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-19 18:15</div>
            <div class="timeline-body"><p>There's no need to ping us again less than 24 hours after making a change, we're busy and have a lot to review.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 06:47:22 UTC
    </footer>
</body>
</html>
