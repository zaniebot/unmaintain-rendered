<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add brew specific message for `uv self update` - astral-sh/uv #16838</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add brew specific message for `uv self update`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/pull/16838">#16838</a>
        opened by <a href="https://github.com/terror">@terror</a>
        on 2025-11-24 17:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/terror">@terror</a> on 2025-11-24 17:38</div>
            <div class="timeline-body"><p>Resolves https://github.com/astral-sh/uv/issues/16833</p>
<p><code>uv self update</code> could error with a better message if it knows the user has installed it with brew. This diff adds an <code>InstallSource</code> we can use the detect where a <code>uv</code> binary comes from and augment error messages with better context. We're only adding brew for now, but it could easily be extend with other detection heuristics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 17:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/install_source.rs</code>:48 on 2025-11-24 17:46</div>
            <div class="timeline-body"><p>We could also run this command ðŸ¤”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 19:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:1235 on 2025-11-24 19:30</div>
            <div class="timeline-body"><p>I think I'd use the <code>hint: ...</code> formatting for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 19:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:1233 on 2025-11-24 19:31</div>
            <div class="timeline-body"><p>I think I'd retain the core message here, e.g., &quot;uv was installed through an external package manager and cannot update itself&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/install_source.rs</code>:44 on 2025-11-24 19:31</div>
            <div class="timeline-body"><p>Why include the URL?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 19:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 19:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:1235 on 2025-11-24 19:33</div>
            <div class="timeline-body"><p>I might have the addition of a hint be conditional on detecting which external package manager was used and keep the core message unbranched?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-24 19:34</div>
            <div class="timeline-body"><p>Running the external tool to perform the update seems interesting but can definitely happen after / separately.</p>
<p>Maybe it's worth looking at what tailscale does?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-11-24 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @zanieb on 2025-11-24 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-24 19:34</div>
            <div class="timeline-body"><p>(sorry wrong button)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 19:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 19:35</div>
            <div class="timeline-body"><p>cc @woodruffw on this approach</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/terror">@terror</a> on 2025-11-24 19:36</div>
            <div class="timeline-body"><blockquote>
<p>Running the external tool to perform the update seems interesting but can definitely happen after / separately.</p>
<p>Maybe it's worth looking at what tailscale does?</p>
</blockquote>
<p>Yeah I'll follow up with this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 19:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/install_source.rs</code>:44 on 2025-11-24 19:36</div>
            <div class="timeline-body"><p>No specific reason, just for additional context. Removed it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 19:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/lib.rs</code>:1233 on 2025-11-24 19:37</div>
            <div class="timeline-body"><p>Changed it back to the original formatting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 19:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 19:41</div>
            <div class="timeline-body"><p>Some things to note:</p>
<ul>
<li><code>OsStr</code> is case-sensitive, we may not work for case-insensitive file systems (someone would have to manually rename the path, unlikely, but something worth considering)</li>
<li>We could probably avoid allocating components and early-return, but this hyper-optimization territory</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 19:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/lib.rs</code>:1235 on 2025-11-24 19:45</div>
            <div class="timeline-body"><p>Yeah that makes sense, I pulled it this out into a constant to re-use.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 19:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/install_source.rs</code>:48 on 2025-11-24 19:46</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/uv/pull/16838#issuecomment-3572411511.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 20:23</div>
            <div class="timeline-body"><p>This approach LGTM -- there are definitely some edge cases with custom prefixes, but 99.99% of Homebrew users who use a brew installed uv should have <code>readlink -f $(which uv)</code> match <code>/&lt;prefix&gt;/Cellar/uv/...</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2025-11-24 20:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2025-11-24 20:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv/src/install_source.rs</code>:39 on 2025-11-24 20:26</div>
            <div class="timeline-body"><p>Noting: I think this works because <code>current_exe</code> returns the resolved path on macOS, but this isn't actually guaranteed to be true:</p>
<p>https://doc.rust-lang.org/std/env/fn.current_exe.html#platform-specific-behavior</p>
<pre><code>% which uv
/opt/homebrew/bin/uv
% readlink -f $(which uv)
/opt/homebrew/Cellar/uv/0.9.11/bin/uv
</code></pre>
<p>For full generality, we probably need <code>std::fs::read_link</code> or <code>std::fs::canonicalize</code> as an intermediate step here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 20:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/install_source.rs</code>:39 on 2025-11-24 20:28</div>
            <div class="timeline-body"><p>We do currently canonicalize the path in <code>from_path</code>: https://github.com/astral-sh/uv/pull/16838/files#diff-0485cb93b3da92da3ccb4e1b62ea7af254d7bdb056398364d8f0e72cc1ab4301R15-R17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2025-11-24 20:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv/src/install_source.rs</code>:39 on 2025-11-24 20:30</div>
            <div class="timeline-body"><p>My bad, I missed that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2025-11-24 20:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 20:31</div>
            <div class="timeline-body"><p>(Another alternative to this approach is to do a PATH lookup on <code>brew</code>, then match that prefix to the uncanonicalized prefix for <code>current_exe</code>. But I think this approach is cleaner and involves fewer system calls.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 20:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 20:39</div>
            <div class="timeline-body"><p>Note in the error case we're rarely concerned about performance. However, I agree we don't need to get fancy here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 20:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 20:40</div>
            <div class="timeline-body"><p>I agree the custom-prefix edge cases are possible (albeit rare); if we see reports there we could potentially add a fallback that compares against <code>brew --prefix</code> / <code>brew --cellar</code>, this would add more overhead/failure modes which is why we aren't doing it already.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 22:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:1235 on 2025-11-24 22:16</div>
            <div class="timeline-body"><p>This doesn't match our <code>hint</code> styling elsewhere, you should search for it and copy the pattern.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-11-24 22:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:1237 on 2025-11-24 22:17</div>
            <div class="timeline-body"><p>I think we'll want backticks around the command? And we usually use green for commands, I think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 22:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/lib.rs</code>:1237 on 2025-11-24 22:20</div>
            <div class="timeline-body"><p>Yah it looks like we use green elsewhere, just pushed this up :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/botantony">@botantony</a> reviewed on 2025-11-24 22:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/botantony">@botantony</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 22:30</div>
            <div class="timeline-body"><p>This approach seems good for Homebrew but I cannot say the same about other package managers . Maybe there can be <code>UV_INSTALLATION_SOURCE</code> variable that can be set at compile time to specify a package manager (f.e. binaries compiled with <code>UV_INSTALLATION_SOURCE=brew cargo build</code> print &quot;use brew upgrade uv&quot;, <code>UV_INSTALLATION_SOURCE=apt cargo build</code> prints &quot;use sudo apt upgrade uv&quot;, etc.)
And if <code>UV_INSTALLATION_SOURCE</code> is not set or invalid it fallbacks to the default message</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/terror">@terror</a> reviewed on 2025-11-24 22:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/terror">@terror</a> on <code>crates/uv/src/install_source.rs</code>:32 on 2025-11-24 22:31</div>
            <div class="timeline-body"><p>Yeah other package managers are out of scope for this PR. We should be able to add other heuristics quite easily to <code>InstallSource</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @konstin on 2025-11-26 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/terror">@terror</a> on 2025-12-04 03:29</div>
            <div class="timeline-body"><p>@zanieb Was there something else blocking this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:1239 on 2025-12-04 14:42</div>
            <div class="timeline-body"><p>This still doesn't match our usual hint styling, e.g., https://github.com/astral-sh/uv/blob/2d9fe7ca701f72b35202bd48d5758dd5b5ef12fe/crates/uv/src/commands/project/remove.rs#L470-L472</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-12-04 14:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-12-04 14:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-12-04 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-12-04 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Homebrew/homebrew-core/pulls/257541.html">Homebrew/homebrew-core#257541</a> on 2025-12-06 14:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
