<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom lock-file serialization - astral-sh/uv #3909</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Custom lock-file serialization</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3909">#3909</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2024-05-29 15:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ibraheemdev">@ibraheemdev</a></div>
            <div class="timeline-body">

Summary
<p>This PR changes the lock-file format to use inline tables for wheels and source distributions, which currently use separate tables that make the file harder to follow.</p>
<pre><code>[[distribution]]
name = &quot;typing-extensions&quot;
version = &quot;4.10.0&quot;
source = &quot;registry+https://pypi.org/simple&quot;

- [distribution.sdist]
- url = &quot;https://files.pythonhosted.org/packages/16/3a/0d26ce356c7465a19c9ea8814b960f8a36c3b0d07c323176620b7b483e44/typing_extensions-4.10.0.tar.gz&quot;
- hash = &quot;sha256:b0abd7c89e8fb96f98db18d86106ff1d90ab692004eb746cf6eda2682f91b3cb&quot;
- size = 77558
-
- [[distribution.wheel]]
- url = &quot;https://files.pythonhosted.org/packages/f9/de/dc04a3ea60b22624b51c703a84bbe0184abcd1d0b9bc8074b5d6b7ab90bb/typing_extensions-4.10.0-py3-none-any.whl&quot;
- hash = &quot;sha256:69b1a937c3a517342112fb4c6df7e72fc39a38e7891a5730ed4985b5214b5475&quot;
- size = 33926

+ sdist = { url = &quot;https://files.pythonhosted.org/packages/16/3a/0d26ce356c7465a19c9ea8814b960f8a36c3b0d07c323176620b7b483e44/typing_extensions-4.10.0.tar.gz&quot;, hash = &quot;sha256:b0abd7c89e8fb96f98db18d86106ff1d90ab692004eb746cf6eda2682f91b3cb&quot;, size = 77558 }
+ wheel = [{ url = &quot;https://files.pythonhosted.org/packages/f9/de/dc04a3ea60b22624b51c703a84bbe0184abcd1d0b9bc8074b5d6b7ab90bb/typing_extensions-4.10.0-py3-none-any.whl&quot;, hash = &quot;sha256:69b1a937c3a517342112fb4c6df7e72fc39a38e7891a5730ed4985b5214b5475&quot;, size = 33926 }]
</code></pre>
<p>The downside is that the inline-tables end up quite long and TOML doesn&#x27;t support line breaks in inline tables, yet.</p>
<p>Part of <a href="https://github.com/astral-sh/uv/issues/3611">astral-sh/uv#3611</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-29 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-05-30 13:33</div>
            <div class="timeline-body"><p>Nice!</p>
<p>I think the main question I have here is whether line breaks are inserted if there is more than one entry in the array. I think all the tests/examples currently only have one entry in these arrays, so it&#x27;s hard to tell. I know line breaks can&#x27;t be inserted in the inline tables themselves, but they can be inserted between the inline tables within the array. If there are no line breaks then we probably can&#x27;t use this approach as the lines would get absurdly long.</p>
<p>I like the <code>to_toml</code> approach here. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2024-05-30 18:39</div>
            <div class="timeline-body"><p>Still makes for very long lines, but I feel like this is an improvement on the status quo.</p>
<p>The other possibility is to keep the table arrays (not inline tables) and just indent them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-05-30 18:59</div>
            <div class="timeline-body"><a href="https://codspeed.io/astral-sh/uv/branches/ibraheemdev:lock-format">CodSpeed Performance Report</a>
Merging #3909 will <strong>not alter performance</strong>
<p>Comparing <code>ibraheemdev:lock-format</code> (8c570f1) with <code>main</code> (d3b7d80)</p>
Summary
<p><code>âœ… 13</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-30 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-05-30 19:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:45:36 UTC
    </footer>
</body>
</html>
