<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Python interpreter discovery on non-glibc hosts - astral-sh/uv #9005</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix Python interpreter discovery on non-glibc hosts</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/9005">#9005</a>
        opened by <a href="https://github.com/dead10ck">@dead10ck</a>
        on 2024-11-11 02:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/dead10ck">@dead10ck</a> on 2024-11-11 02:16</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>On Termux, uv currently fails to find any interpreter because it can't find a glibc version, because there isn't one. But the Python interpreter is still functional nonetheless.</p>
<p>So, when glibc cannot be found, simply return 0 for the version numbers and mark the interpreter as being incompatible with manylinux</p>
<p>I really don't know if this is the right way to address this, but I can attest that manual testing shows uv appears to be fully functional, at least for pip and virtualenvs.</p>
<p>Fixes #7373</p>
<h2>Test Plan</h2>
<p>I tried running the test suite, and after some tweaks, a good portion of the test suite passes as well. A significant number of tests fail, but this appears to be due to minor differences in output, like warnings about hard links not working (hard links are completely disallowed on Android), differences in the number of files removed, etc. The test suite seems to be very sensitive to minor variations in output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-11-11 04:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-python/python/get_interpreter_info.py</code>:480 on 2024-11-11 04:10</div>
            <div class="timeline-body"><p>Given the declared wheel format in PEP-738, rather than allowing passing through the glibc version as (-1, -1)/(0, 0), I wonder if it's worthwhile considering using <a href="https://docs.python.org/3/library/sys.html#sys.getandroidapilevel">sys.getandroidapilevel</a> here since it's compatible since 3.7+.</p>
<p><a href="https://peps.python.org/pep-0738/">PEP-738</a> also introduced <a href="https://docs.python.org/3/library/platform.html#platform.android_ver">platform.android_ver</a>, but sadly it's only available in 3.13.</p>
<p>e.g.</p>
<pre><code class="language-python">        elif glibc_version != (-1, -1):
            operating_system = {
                &quot;name&quot;: &quot;manylinux&quot;,
                &quot;major&quot;: glibc_version[0],
                &quot;minor&quot;: glibc_version[1],
            }
        elif hasattr(sys, &quot;getandroidapilevel&quot;):
            operating_system = {
                &quot;name&quot;: &quot;android&quot;,
                &quot;major&quot;: sys.getandroidapilevel(),
                &quot;minor&quot;: 0,
            }
        else:
            print(json.dumps({&quot;result&quot;: &quot;error&quot;, &quot;kind&quot;: &quot;libc_not_found&quot;}))
            sys.exit(0)
</code></pre>
<p>...</p>
<pre><code class="language-python">    elif os_and_arch[&quot;os&quot;][&quot;name&quot;] == &quot;android&quot;:
        manylinux_compatible = False
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @zanieb on 2024-11-13 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> requested changes on 2024-11-14 12:40</div>
            <div class="timeline-body"><p>I agree with @samypr100, we need a way to specifically check for android; we had cases where the error branch caught bugs in the past</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dead10ck">@dead10ck</a> on 2024-11-21 04:33</div>
            <div class="timeline-body"><p>Ok, I think I've done it. Manual testing seems to work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-11-21 09:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-11-21 11:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-11-21 11:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-11-21 11:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:14 UTC
    </footer>
</body>
</html>
