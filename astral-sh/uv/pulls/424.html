<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add an `UnusableDependencies` incompatibility kind and use for conflicting versions - astral-sh/uv #424</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add an <code>UnusableDependencies</code> incompatibility kind and use for conflicting versions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/424">#424</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2023-11-14 16:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-14 16:48</div>
            <div class="timeline-body"><p>Addresses https://github.com/astral-sh/puffin/issues/309#issuecomment-1792648969</p>
<p>Similar to #338 this throws an error when merging versions results in an empty set. Instead of propagating that error, we capture it and return a new dependency type of <code>Unusable</code>. Unusable dependencies are a new incompatibility kind which includes an arbitrary &quot;reason&quot; string that we present to the user. Adding a new incompatibility kind requires changes to the vendored pubgrub crate.</p>
<p>We could use this same incompatibility kind for conflicting urls as in #284 which should allow the solver to backtrack to another valid version instead of failing (see #425).</p>
<p>Unlike #383 this does not require changes to PubGrub's package mapping model. I think in the long run we'll want PubGrub to accept multiple versions per package to solve this specific issue, but we're interested in it being merged upstream first. This pull request is just using the issue as a simple case to explore adding a new incompatibility type.</p>
<p>We may or may not be able convince them to add this new incompatibility type upstream. As discussed in https://github.com/pubgrub-rs/pubgrub/issues/152, we may want a more general incompatibility kind instead which can be used for arbitrary problems. An upstream pull request has been opened for discussion at https://github.com/pubgrub-rs/pubgrub/pull/153.</p>
<p>Related to:</p>
<ul>
<li>https://github.com/pubgrub-rs/pubgrub/issues/152</li>
<li>#338</li>
<li>#383</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-14 16:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>vendor/pubgrub/src/report.rs</code>:122 on 2023-11-14 16:57</div>
            <div class="timeline-body"><p>üëÄ this is probably not quite right because we shouldn't merge the reasons here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-14 17:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>vendor/pubgrub/src/report.rs</code>:122 on 2023-11-14 17:18</div>
            <div class="timeline-body"><p>Can you say a bit more about this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-14 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>vendor/pubgrub/src/report.rs</code>:122 on 2023-11-14 17:24</div>
            <div class="timeline-body"><p>I'm not sure it matters, but this merges the two incompatibilities by taking the union of their version ranges and <em>one</em> of the reasons but if the reasons are different we should not merge them because they are distinct incompatibilities. Or.. we could merge them and say &quot;{reason} and {reason}&quot; but that seems unclear later on since you lose the reason for each range.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>vendor/pubgrub/src/report.rs</code>:192 on 2023-11-14 17:24</div>
            <div class="timeline-body"><p>This seems generic enough that it could feasibly be upstreamed ü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-14 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-14 17:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>vendor/pubgrub/src/report.rs</code>:122 on 2023-11-14 17:26</div>
            <div class="timeline-body"><p>Or we could make the reason it's own enum with its own merge semantics, but that requires encoding the set of reasons in the PubGrub crate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-11-14 18:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>vendor/pubgrub/src/internal/incompatibility.rs</code>:111 on 2023-11-14 18:11</div>
            <div class="timeline-body"><p>The line breaks here make me read this like a haiku :joy:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-14 18:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>vendor/pubgrub/src/internal/incompatibility.rs</code>:111 on 2023-11-14 18:18</div>
            <div class="timeline-body"><p>Me too haha I just kept the existing style but it's funny</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-15 00:27</div>
            <div class="timeline-body"><p>I don't understand why the numpy test is failing.</p>
<p>I'm going to look into upstreaming these changes, but I don't think it needs to block us here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2023-11-15 00:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-15 08:54</div>
            <div class="timeline-body"><p>#426 Fixes CI (See #427)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-11-15 16:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-15 18:55</div>
            <div class="timeline-body"><p>(fixed the merge conflict i created)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-15 19:48</div>
            <div class="timeline-body"><p>An upstream pull request has been opened for discussion at https://github.com/pubgrub-rs/pubgrub/pull/153.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-16 14:50</div>
            <div class="timeline-body"><p>While I intend to continue work upstream, I'd like to merge this for my own sanity?</p>
<p>Perhaps we should create a PubGrub fork instead so we can track these changes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-16 18:04</div>
            <div class="timeline-body"><p>üëç On setting up our own fork as discussed in our 1:1.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-16 19:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>Cargo.toml</code>:51 on 2023-11-16 19:58</div>
            <div class="timeline-body"><p>https://github.com/zanieb/pubgrub/pull/4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2023-11-16 19:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>vendor/pubgrub/src/report.rs</code>:192 on 2023-11-16 19:58</div>
            <div class="timeline-body"><p>See https://github.com/pubgrub-rs/pubgrub/pull/153</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2023-11-16 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-11-16 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-11-16 20:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:50:52 UTC
    </footer>
</body>
</html>
