<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv run: List available scripts when a script is not specified - astral-sh/uv #7687</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv run: List available scripts when a script is not specified</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/7687">#7687</a>
        opened by <a href="https://github.com/kakkoyun">@kakkoyun</a>
        on 2024-09-25 15:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/kakkoyun">@kakkoyun</a> on 2024-09-25 15:46</div>
            <div class="timeline-body"><p>Signed-off-by: Kemal Akkoyun <a href="mailto:kakkoyun@gmail.com">kakkoyun@gmail.com</a></p>
<h2>Summary</h2>
<p>This PR adds the ability to list available scripts in the environment
when <code>uv run</code> is invoked without any arguments.
It somewhat mimics the behavior of <code>rye run</code> command
(See https://rye.astral.sh/guide/commands/run).</p>
<p>This is an attempt to fix #4024.</p>
<h2>Test Plan</h2>
<p>I added test cases. The CI pipeline should pass.</p>
<h3>Manuel Tests</h3>
<pre><code class="language-shell">‚ùØ uv run
Provide a command or script to invoke with `uv run &lt;command&gt;` or `uv run script.py`.

The following scripts are available:

normalizer
python
python3
python3.12

See `uv run --help` for more information.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 16:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:776 on 2024-09-25 16:58</div>
            <div class="timeline-body"><p>In what cases can this occur? Should it be user-facing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 16:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:785 on 2024-09-25 16:58</div>
            <div class="timeline-body"><p>Should we handle symlinks like we do in <code>uv python list</code>? i.e. displaying &quot;/opt/homebrew/opt/python@3.12/bin/python3.12 -&gt; ../Frameworks/Python.framework/Versions/3.12/bin/python3.12&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 16:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:749 on 2024-09-25 16:59</div>
            <div class="timeline-body"><p>We should probably just display the name of the file, not the full path since we're making suggestions for <code>uv run &lt;name&gt;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 17:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:726 on 2024-09-25 17:00</div>
            <div class="timeline-body"><p>Note we use <code>user_display()</code> for all paths.</p>
<p>I'm not sure if we need this here though, we might just be able to say &quot;Available commands:&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:726 on 2024-09-25 17:00</div>
            <div class="timeline-body"><p>We also use <code>writeln!(printer.stderr(), ...)</code> instead of <code>println!</code> to respect things like the <code>--quiet</code> flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 17:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 17:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-25 17:02</div>
            <div class="timeline-body"><p>How is <code>Some(RunCommand::Empty)</code> different than <code>None</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-25 17:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/commands/project/run.rs</code>:785 on 2024-09-25 17:11</div>
            <div class="timeline-body"><p>I think we should show the filename. We don't need to be super descriptive here. Propabaly this usage flow will be like:</p>
<pre><code class="language-shell">‚ùØ cargo run -q -- run
Provide a command or script to invoke with `uv run &lt;command&gt;` or `uv run script.py`.

The following scripts are available:

python3
python3.12
python
normalizer

See `uv run --help` for more information.
</code></pre>
<pre><code class="language-shell">‚ùØ cargo run -q -- run python
No entry for terminal type &quot;xterm-256color&quot;;
using dumb terminal settings.
Python 3.12.1 (main, Jan  8 2024, 05:57:25) [Clang 17.0.6 ] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-25 17:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/commands/project/run.rs</code>:726 on 2024-09-25 17:12</div>
            <div class="timeline-body"><p>This was just for the debugging purposes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-25 17:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-25 17:14</div>
            <div class="timeline-body"><p>I'm just following the existing function signatures here. I preferred to use <code>Empty</code> since it was available rather than changing to <code>Option&lt;RunCommand&gt;</code>.</p>
<p>I'm not sure if there is a general convention/style to follow here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 17:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-25 17:20</div>
            <div class="timeline-body"><p>Isn't <code>run_command</code> already <code>Option&lt;RunCommand</code>&gt; though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-25 17:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/commands/project/run.rs</code>:776 on 2024-09-25 17:22</div>
            <div class="timeline-body"><p>This wasn't intended to land on the final version of the PR. It makes sense to keep it for debugging purposes. I will change the level.</p>
<p>Underlying could be various things that are propagated from the filesystem (e.g. insufficient permissions).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-25 17:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-25 17:33</div>
            <div class="timeline-body"><p>Not in this particular context https://github.com/astral-sh/uv/blob/26a355220d88292110f07b71269c682b33503c54/crates/uv/src/commands/project/run.rs#L52-L77</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @kakkoyun on 2024-09-25 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @kakkoyun on 2024-09-25 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 19:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-25 19:55</div>
            <div class="timeline-body"><p>Ah but it is at</p>
<p>https://github.com/astral-sh/uv/blob/106633a5e5b6c056525df92cd26d05e60fbc2e55/crates/uv/src/lib.rs#L133</p>
<p>and</p>
<p>https://github.com/astral-sh/uv/blob/106633a5e5b6c056525df92cd26d05e60fbc2e55/crates/uv/src/lib.rs#L1149</p>
<p>then we unwrap at</p>
<p>https://github.com/astral-sh/uv/blob/106633a5e5b6c056525df92cd26d05e60fbc2e55/crates/uv/src/lib.rs#L1230</p>
<p>The <code>Empty</code> variant is stale code i.e. we actually don't do this anymore</p>
<p>https://github.com/astral-sh/uv/blob/77c2496f4706a99ada9b449072a38fb4b9e1f816/crates/uv/src/commands/project/run.rs#L846-L847</p>
<p>I'd think I'd prefer to just make it an <code>Option&lt;...&gt;</code> and remove the <code>expect</code> call, but I don't feel strongly. I guess if it's an <code>Option</code> someone could make a mistake upstream while developing and we wouldn't notice? Regardless we should update the <code>RunCommand::Empty</code> documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:258 on 2024-09-25 20:05</div>
            <div class="timeline-body"><p>I think we'll want to exclude all the shell activation scripts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 20:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:261 on 2024-09-25 20:06</div>
            <div class="timeline-body"><p>We'll probably also want to exclude the <code>.exe</code> suffix since it's implied during invocation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:226 on 2024-09-25 20:07</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    Provide a command or script to invoke with `uv run &lt;command&gt;` or `uv run &lt;script&gt;.py`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:228 on 2024-09-25 20:07</div>
            <div class="timeline-body"><p>We should probably say &quot;commands&quot; here not &quot;scripts&quot; since above you suggest running a script as <code>script.py</code> and it risks user's conflating the concepts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 20:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:767 on 2024-09-25 20:09</div>
            <div class="timeline-body"><p>Should we exit with a non-zero exit code? I'm not sure but I think so?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 20:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/run.rs</code>:232 on 2024-09-25 20:10</div>
            <div class="timeline-body"><p>I think I have a minor preference for omitting the leading empty newline and listing these with the prefix <code>- </code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-25 20:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/which.rs</code>:6 on 2024-09-25 20:10</div>
            <div class="timeline-body"><p>We might want to move this to <code>uv-fs</code> instead of <code>uv-python</code> now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-26 07:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/commands/project/run.rs</code>:767 on 2024-09-26 07:24</div>
            <div class="timeline-body"><p>Let me check what we do for the <code>uv tool run</code>. But it makes sense to return an unsuccessful exit code. I favor consistency, so whatever we decide should be the same all over the board. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-26 07:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/tests/run.rs</code>:261 on 2024-09-26 07:25</div>
            <div class="timeline-body"><p>üëç I didn't know that. I need a Windows setup to test it. I will check the codebase or take your word for it üòÑ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-09-26 11:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/run.rs</code>:776 on 2024-09-26 11:09</div>
            <div class="timeline-body"><p>We should raise an error here and exit imho, or at least not make it silent: If we can't read an entry from the scripts directory, something is seriously broken about the venv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2024-09-26 11:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-26 11:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-26 11:54</div>
            <div class="timeline-body"><p>Ok, if it's deprecated. Let me check how I can refactor things. Thanks a lot for the context.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-26 11:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/commands/project/run.rs</code>:776 on 2024-09-26 11:55</div>
            <div class="timeline-body"><p>Thanks a lot for the input.</p>
<p>Alright, this aligns with other parts of the codebase. I will surface to error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-26 13:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-26 13:30</div>
            <div class="timeline-body"><p>Okay, I will change the signature and utilize the <code>Option.</code> However, I would prefer to address/explore the deprecation of <code>RunCommnad::Empty</code> in another PR. I need to make sure that the existing mechanisms need it to function internally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-26 14:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:767 on 2024-09-26 14:19</div>
            <div class="timeline-body"><p>Showing the help menu exits with code 2 right now ‚Äî I think we should be consistent with that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kakkoyun">@kakkoyun</a> reviewed on 2024-09-26 14:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kakkoyun">@kakkoyun</a> on <code>crates/uv/src/commands/project/run.rs</code>:767 on 2024-09-26 14:45</div>
            <div class="timeline-body"><p>üëç Done. I've also updated https://github.com/astral-sh/uv/pull/7641</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-26 16:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/lib.rs</code>:137 on 2024-09-26 16:58</div>
            <div class="timeline-body"><p>No problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-09-27 15:11</div>
            <div class="timeline-body"><p>LGTM!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @kakkoyun on 2024-09-27 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @kakkoyun on 2024-09-27 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-09-27 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-10-08 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-08 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-08 19:36</div>
            <div class="timeline-body"><p>Thanks @kakkoyun!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:01:43 UTC
    </footer>
</body>
</html>
