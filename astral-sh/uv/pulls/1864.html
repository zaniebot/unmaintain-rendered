<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win-Trampoline: Use Std - astral-sh/uv #1864</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Win-Trampoline: Use Std</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/1864">#1864</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-02-22 13:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR isn't intended to be merged. I mainly created it to share how far I got migrating the trampoline code to std.</p>
<p>You can build the code with <code>cargo build  --target x86_64-pc-windows-msvc</code></p>
<h2>Size</h2>
<p>This version enables the <code>panic_immediate_abort</code> in the <code>.cargo/config.toml</code> which gives us std without increasing the binary size (16.5KB). However, it means that rust aborts without printing any message whenever it encounters a panic. I don't think that's horrible per se, we can use our own <code>panic</code> function (similar to <code>eprintln</code>) but it is an unstable feature and requires us being extra careful to always use our custom panic handler (don't use <code>.unwrap</code> or <code>expect</code>)</p>
<p>The binary size increases to <code>~90KB</code> when removing said feature because rust pulls in the formatting code of (all?) std types.</p>
<h2>Open Questions</h2>
<p>I don't understand why this needs the std-feature <code>&quot;compiler-builtins-mem&quot;</code> but linking fails without it.</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 15:29</div>
            <div class="timeline-body"><p>Closing, because this is not an immediate priority. I opened https://github.com/astral-sh/uv/issues/1917 to track it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-23 15:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:35:43 UTC
    </footer>
</body>
</html>
