<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve resolver error messages referencing workspace members - astral-sh/uv #6092</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve resolver error messages referencing workspace members</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6092">#6092</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-08-14 19:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-14 19:47</div>
            <div class="timeline-body"><p>An extension of #6090 that replaces #6066.</p>
<p>In brief,</p>
<ol>
<li>Workspace member names are passed to the resolver for no solution errors</li>
<li>There is a new derivation tree pre-processing step that trims <code>NoVersion</code> incompatibilities for workspace members from the derivation tree. This avoids showing redundant clauses like <code>Because only bird==0.1.0 is available and bird==0.1.0 depends on anyio==4.3.0, we can conclude that all versions of bird depend on anyio==4.3.0.</code>. As a minor note, we use a custom incompatibility kind to mark these incompatibilities at resolution-time instead of afterwards.</li>
<li>Root dependencies on workspace members say <code>your workspace requires bird</code> rather than <code>you require bird</code></li>
<li>Workspace member package display omits the version, e.g., <code>bird</code> instead of <code>bird==0.1.0</code></li>
<li>Instead of reporting a workspace member as unusable we note that its requirements cannot be solved, e.g., <code>bird's requirements are unsatisfiable</code> instead of <code>bird cannot be used</code>.</li>
<li>Instead of saying <code>your requirements are unsatisfiable</code> we say <code>your workspace's requirements are unsatisfiable</code> when in a workspace, since we're not in a &quot;provide direct requirements&quot; paradigm.</li>
</ol>
<p>As an annoying but minor implementation detail, <code>PackageRange</code> now requires access to the <code>PubGrubReportFormatter</code> so it can determine if it is formatting a workspace member or not. We could probably improve the abstractions in the future.</p>
<p>As a follow-up, we should additional special casing for &quot;single project&quot; workspaces to avoid mention of the workspace concept in simple projects. However, it looks like this will require additional tree manipulations so I'm going to keep it separate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2024-08-14 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @zanieb on 2024-08-14 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-08-14 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-08-14 21:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @BurntSushi by @zanieb on 2024-08-14 21:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/pip_install.rs</code>:390 on 2024-08-14 23:56</div>
            <div class="timeline-body"><p>&quot;the&quot; is maybe suspect here, is it better?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-14 23:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-08-14 23:56</div>
            <div class="timeline-body"><p>Rad.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-08-14 23:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-resolver/src/pubgrub/report.rs</code>:990 on 2024-08-14 23:57</div>
            <div class="timeline-body"><p>Yeah that feels a bit off. But at least it's all contained in this file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-08-15 00:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/pip_install.rs</code>:390 on 2024-08-15 00:03</div>
            <div class="timeline-body"><p>No, sorry I should have called this out. This made it easier to consolidate some logic without changing a <em>ton</em> of snapshots. I'm planning to change it to &quot;your&quot; everywhere in a follow-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-08-15 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-08-15 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-08-15 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/uv/tests/edit.rs</code>:2582 on 2024-08-15 13:19</div>
            <div class="timeline-body"><p>This looks much nicer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-08-15 13:20</div>
            <div class="timeline-body"><p>Nice!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 13:10:13 UTC
    </footer>
</body>
</html>
