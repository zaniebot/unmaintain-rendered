<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use a 'minor' version field (`revision`) in the lockfile - astral-sh/uv #11500</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use a 'minor' version field (<code>revision</code>) in the lockfile</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/11500">#11500</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-02-14 01:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-14 01:53</div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This is an alternative to the approach we took in #11063 whereby we always included <code>provides-extra</code> and <code>requires-dist</code>, since we needed some way to differentiate between &quot;no extras&quot; and &quot;lockfile was generated by a uv version that didn't include extras&quot;.</p>
<p>Instead, this PR adds a minor version (called a &quot;revision&quot;) to the lockfile that we can use to indicate support for this feature. While lockfile version bumps are backwards-incompatible, older uv versions <em>can</em> read lockfiles with a later revision -- they just won't understand all the data.</p>
<p>In a future major version bump, we could simplify things and change the schema to use a (major, minor) format instead of these two separate fields. But this is the only way to do it that's backwards-compatible with existing uv versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-14 02:02</div>
            <div class="timeline-body"><p>I'm into it üëç I'll let @Gankra give the approving review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-14 02:05</div>
            <div class="timeline-body"><p>I think I made a mistake by suggesting that we make <code>provides-extra</code> non-optional (in order to power feature detection) -- I'm sorry about that. I don't think what I have here is <em>perfect</em>, but I do think it's less disruptive (e.g., we don't have to re-make these fields hidden-when-empty when we bump the version in the future) and closer to the principles we use throughout the format (favoring conciseness, etc.).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @charliermarsh on 2025-02-14 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Use a 'minor' version field in the lockfile" to "Use a 'minor' version field (`revision`)in the lockfile" by @charliermarsh on 2025-02-14 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Use a 'minor' version field (`revision`)in the lockfile" to "Use a 'minor' version field (`revision`) in the lockfile" by @charliermarsh on 2025-02-14 02:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2025-02-14 02:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> removed by @charliermarsh on 2025-02-14 02:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by @charliermarsh on 2025-02-14 02:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:266 on 2025-02-14 14:03</div>
            <div class="timeline-body"><p>This needs to check for the current lock.version() too, since 3.0 &gt; 2.1 (unless you want 2.100 =&gt; 3.101 to be a thing..? that seems weird.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv/tests/it/edit.rs</code>:5602 on 2025-02-14 14:05</div>
            <div class="timeline-body"><p>lmao i see our copies of cargo-insta are fighting (I'm on cargo-insta 1.42.0)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-02-14 14:06</div>
            <div class="timeline-body"><p>One potential issue but yeah this is just better! I was surprised you were happy with making it so much noisier, I wish I knew that adding the minor version would be this easy!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-14 15:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:266 on 2025-02-14 15:53</div>
            <div class="timeline-body"><p>Added in https://github.com/astral-sh/uv/pull/11500/commits/6571d2ffc4f1a320d875ea1f2e5994ad9b2fb414</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:266 on 2025-02-14 16:02</div>
            <div class="timeline-body"><p>I think this should be <code>if (lock.version(), lock.revision()) &lt; (1, 1)</code> rather than hard-coding 1?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-14 16:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-14 16:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:266 on 2025-02-14 16:03</div>
            <div class="timeline-body"><p>I think it's actually impossible to get here since we reject lockfiles that don't match the major, but you're right that we should change this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-14 16:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:266 on 2025-02-14 16:06</div>
            <div class="timeline-body"><p>Agree on both points</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-14 16:06</div>
            <div class="timeline-body"><blockquote>
<p>One potential issue but yeah this is just better! I was surprised you were happy with making it so much noisier, I wish I knew that adding the minor version would be this easy!</p>
</blockquote>
<p>Gah, yeah, I'm sorry that I went back and forth on it and made you do a bunch of extra work. The more I thought about it, the more it felt like the wrong tradeoff. I think the &quot;hard&quot; thing about adding the minor version was just figuring out what it should be called and what the schema should look like (since we need two version fields)... What we have here is <em>okay</em>, not perfect, but it's does feel like a better tradeoff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-02-14 16:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/install_target.rs</code>:266 on 2025-02-14 16:07</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/pull/11500/commits/d11e76c127da7bc40c4d0f975b9f3ba850e1e3c9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2025-02-14 16:16</div>
            <div class="timeline-body"><p>Thanks Zanie!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-02-14 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-02-14 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-02-14 16:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:20 UTC
    </footer>
</body>
</html>
