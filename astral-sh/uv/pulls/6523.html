<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>docs: Add PyTorch installation guide - astral-sh/uv #6523</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>docs: Add PyTorch installation guide</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/6523">#6523</a>
        opened by <a href="https://github.com/baggiponte">@baggiponte</a>
        on 2024-08-23 14:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/baggiponte">@baggiponte</a></div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<p>Hello there! First real docs PR for uv.</p>
<ol>
<li>I expect this will be rewritten a gazillion times to have a consistent tone with the rest of the docs, despite me trying to stick to it as best as I could. Feel free to edit!</li>
<li>I went super on the verbose mode, while also providing a callout with a TLDR on top. Scrap anything you feel it's redundant!</li>
<li>I placed the guide under <code>integrations</code> since Charlie added the FastAPI integration there.</li>
</ol>
<h2>Summary</h2>
<!-- What's the purpose of the change? What does it do, and why? -->

<p>Addresses #5945</p>
<h2>Test Plan</h2>
<!-- How was it tested? -->

<p>I just looked at the docs on the dev server of mkdocs if it looked nice.</p>
<p><strong>I could not test the commands that I wrote work</strong> outside of macOS. If someone among contributors has a Windows/Linux laptop, it should be enough, even for the GPU-supported versions: I expect the installation will just break once torch checks for CUDA (perhaps even at runtime).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-08-23 15:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @zanieb on 2024-08-23 15:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-23 15:50</div>
            <div class="timeline-body"><p>Have you considered including a way to specify package versions?
This part is the difference between uv and pip.
https://github.com/astral-sh/uv/blob/main/docs/pip/compatibility.md#local-version-identifiers</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-23 16:25</div>
            <div class="timeline-body"><blockquote>
<p>Have you considered including a way to specify package versions? This part is the difference between uv and pip. <a href="https://github.com/astral-sh/uv/blob/main/docs/pip/compatibility.md?rgh-link-date=2024-08-23T15%3A50%3A15Z#local-version-identifiers"><code>main</code>/docs/pip/compatibility.md#local-version-identifiers</a></p>
</blockquote>
<p>Like <code>uv add -- &quot;torch==2.4.0+cpu&quot;</code>? Didn't think about that: having tried on macOS, it simply fails. I just went with &quot;let's just port to uv the pip commands that the torch docs recommend&quot;. Any suggestion on how I could try that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 16:27</div>
            <div class="timeline-body"><p>This will definitely require validation from folks on other platforms. Thanks for starting though!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-23 16:43</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Have you considered including a way to specify package versions? This part is the difference between uv and pip. <a href="https://github.com/astral-sh/uv/blob/main/docs/pip/compatibility.md?rgh-link-date=2024-08-23T15%3A50%3A15Z#local-version-identifiers"><code>main</code>/docs/pip/compatibility.md#local-version-identifiers</a></p>
</blockquote>
<p>Like <code>uv add -- &quot;torch==2.4.0+cpu&quot;</code>? Didn't think about that: having tried on macOS, it simply fails. I just went with &quot;let's just port to uv the pip commands that the torch docs recommend&quot;. Any suggestion on how I could try that?</p>
</blockquote>
<p>On macOS, packages are obtained directly from PyPI, thus eliminating the need for local version identifiers.
<img src="https://github.com/user-attachments/assets/ae44cb81-cf44-4430-9cc5-7ffbcd1d1149" alt="image" />
Therefore, only on macOS, we cannot test whether the usage within the project(uv add/remove) is correct.
I don't know how to correctly provide the PyTorch version with CUDA to UV.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-23 17:10</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<blockquote>
<p>Have you considered including a way to specify package versions? This part is the difference between uv and pip. <a href="https://github.com/astral-sh/uv/blob/main/docs/pip/compatibility.md?rgh-link-date=2024-08-23T16%3A43%3A46Z#local-version-identifiers"><code>main</code>/docs/pip/compatibility.md#local-version-identifiers</a></p>
</blockquote>
<p>Like <code>uv add -- &quot;torch==2.4.0+cpu&quot;</code>? Didn't think about that: having tried on macOS, it simply fails. I just went with &quot;let's just port to uv the pip commands that the torch docs recommend&quot;. Any suggestion on how I could try that?</p>
</blockquote>
<p>On macOS, packages are obtained directly from PyPI, thus eliminating the need for local version identifiers. <img src="https://private-user-images.githubusercontent.com/48265002/361001169-ae44cb81-cf44-4430-9cc5-7ffbcd1d1149.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjQ0MzI2OTAsIm5iZiI6MTcyNDQzMjM5MCwicGF0aCI6Ii80ODI2NTAwMi8zNjEwMDExNjktYWU0NGNiODEtY2Y0NC00NDMwLTljYzUtN2ZmYmNkMWQxMTQ5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MjMlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODIzVDE2NTk1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWE3ZTI2MmRmNmMxZmVlZDRiODgxZDExMmY3ZGIzZTNkNGE0OGZkZGU1ZTEyNDRhOWFmZmQ4MmQyNmZmYzgwYTcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.C9VaT_ZuKf-oN4ifbp6nZBWe--t3dY6zeFgShdwoYk0" alt="image" /> Therefore, only on macOS, we cannot test whether the usage within the project(uv add/remove) is correct. I don't know how to correctly provide the PyTorch version with CUDA to UV.</p>
</blockquote>
<p>Exactly! That's what I wrote on the macOS section. Sorry if I wasn't being clear.</p>
<hr />
<p>I realised I can test this out on Colab for Linux ðŸ˜ˆ</p>
<ol>
<li>Go on <code>colab.new</code></li>
<li>Run:</li>
</ol>
<pre><code>!curl -LsSf https://astral.sh/uv/install.sh | sh
!source $HOME/.cargo/env bash
!/root/.cargo/bin/uv --version # doesn't find it on the $PATH, I guess I should restart the shell? idk
!/root/.cargo/bin/uv venv
</code></pre>
<p>Then:</p>
<pre><code># installs GPU cu12
!/root/.cargo/bin/uv pip install -- torch # works

# fails
!/root/.cargo/bin/uv pip install -- &quot;torch==2.4.0+cpu&quot; # fails

# works
!/root/.cargo/bin/uv pip install --extra-index-url=https://download.pytorch.org/whl/cpu -- torch
!/root/.cargo/bin/uv pip install --extra-index-url=https://download.pytorch.org/whl/cu118 -- torch
!/root/.cargo/bin/uv pip install --extra-index-url=https://download.pytorch.org/whl/cu121 -- torch
!/root/.cargo/bin/uv pip install --extra-index-url=https://download.pytorch.org/whl/cu124 -- torch
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-23 17:16</div>
            <div class="timeline-body"><p>Have uv considered adding the index-url to the pyproject.toml file when using uv add?
After adding PyTorch, when I added another package from PyPI, the lock file modified PyTorch to be installed from PyPI.
<a href="https://github.com/user-attachments/files/16731853/lockfile.zip">lockfile.zip</a>
<strong>command</strong></p>
<pre><code class="language-powershell"> uv add --extra-index-url=https://download.pytorch.org/whl/cu121 torch torchvision torchaudio --no-sync
 uv add deep-translator
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 18:02</div>
            <div class="timeline-body"><p>@FishAlchemist yes, it's on the roadmap https://github.com/astral-sh/uv/issues/171</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-23 18:10</div>
            <div class="timeline-body"><blockquote>
<p>@FishAlchemist yes, it's on the roadmap #171</p>
</blockquote>
<p>@zanieb
If it's not yet supported, it seems like we can't include the project API part in the PR's document.
After all, when the source is not PyPI, the lock file might be unexpected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-23 18:15</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>@FishAlchemist yes, it's on the roadmap #171</p>
</blockquote>
<p>@zanieb If it's not yet supported, it seems like we can't include the project API part in the PR's document. After all, when the source is not PyPI, the lock file might be unexpected.</p>
</blockquote>
<p>Uh yeah, just pushed a commit to remove all the mentions to modifying <code>pyproject.toml</code>.</p>
<p>So:</p>
<ol>
<li>We might want to give this a spin on a Windows machine to make sure it works</li>
<li>Given that currently there's no mechanism to bind a specific package to a specific source, the only thing that can be documented in the docs is to run <code>uv pip install --extra-index-url=...</code> or <code>uv add --extra-index-url=...</code>, am I right?</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-24 04:13</div>
            <div class="timeline-body"><p>@baggiponte
I think there's no problem with downloading PyTorch using &quot;uv pip install&quot; on Windows. Although I've only run CUDA 12.1, I was able to do simple tests using the installation method provided by PyTorch, just with the difference of using &quot;uv pip&quot;.
For more complex tasks, I switched to Linux because my Windows computer has insufficient memory.
As for the project, although the command can run on Windows, the locked file results are not what I expected.</p>
<p>For PyTorch, I still recommend including the specific version in the documentation. I remember seeing some issues in the past where problems only occurred when a specific version was specified, and I'm not sure if they have been fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-24 08:43</div>
            <div class="timeline-body"><blockquote>
<p>For more complex tasks, I switched to Linux because my Windows computer has insufficient memory.</p>
</blockquote>
<p>Do you think I should try and/or cover some of those?</p>
<blockquote>
<p>As for the project, although the command can run on Windows, the locked file results are not what I expected.</p>
</blockquote>
<p>Uhm, I guess this deserves an issue of its own?</p>
<blockquote>
<p>For PyTorch, I still recommend including the specific version in the documentation. I remember seeing some issues in the past where problems only occurred when a specific version was specified, and I'm not sure if they have been fixed.</p>
</blockquote>
<p>Were those issues uv-related or just generic torch version problems? Because otherwise I would not be super inclined to add this kind of recommendation to the docs.</p>
<hr />
<p>Unrelated: perhaps I could create a new repo and use github actions on various runners to see if everything works, if we need more complex installation tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-24 09:46</div>
            <div class="timeline-body"><p>@baggiponte  If  lock file doesn't have a mac wheel, I'm unsure if <code>uv sync</code> can successfully execute on a Mac.</p>
<h3>Command (uv 0.3.3 (deea6025a 2024-08-23))</h3>
<pre><code class="language-powershell">uv init torch_uv -p 3.10
# Remember to enter the directory
uv python pin 3.10
uv add --extra-index-url=https://download.pytorch.org/whl/cu121 torch --no-sync
</code></pre>
<p><strong>Note:</strong> Create on windows 11 (x86-64)</p>
<h3>Part of uv.lock for torch</h3>
<pre><code>[[package]]
name = &quot;torch&quot;
version = &quot;2.4.0+cu121&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cu121&quot; }
dependencies = [
    { name = &quot;filelock&quot; },
    { name = &quot;fsspec&quot; },
    { name = &quot;jinja2&quot; },
    { name = &quot;networkx&quot; },
    { name = &quot;nvidia-cublas-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-cupti-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-nvrtc-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-runtime-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cudnn-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cufft-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-curand-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusolver-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusparse-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nccl-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nvtx-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;sympy&quot; },
    { name = &quot;triton&quot;, marker = &quot;python_full_version &lt; '3.13' and platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;typing-extensions&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cu121/torch-2.4.0%2Bcu121-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:28bfba084dca52a06c465d7ad0f3cc372c35fc503f3eab881cc17a5fd82914e7&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu121/torch-2.4.0%2Bcu121-cp310-cp310-win_amd64.whl&quot;, hash = &quot;sha256:9244bdc160d701915ae03e14cc25c085aa11e30d711a0b64bef0ee427e04632c&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu121/torch-2.4.0%2Bcu121-cp311-cp311-linux_x86_64.whl&quot;, hash = &quot;sha256:a9fff32d365e0c74b6909480548b2e291314a204adb29b6bb6f2c6d33f8be26c&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu121/torch-2.4.0%2Bcu121-cp311-cp311-win_amd64.whl&quot;, hash = &quot;sha256:bada31485e04282b9f099da39b774484d3e4c431b7ea0df3663817295ae764e4&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu121/torch-2.4.0%2Bcu121-cp312-cp312-linux_x86_64.whl&quot;, hash = &quot;sha256:49ac55a6497ddd6d0cdd51b5ea27d8ebe20c9273077855e9c96eb0dc289f07c3&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu121/torch-2.4.0%2Bcu121-cp312-cp312-win_amd64.whl&quot;, hash = &quot;sha256:b5c27549daf5f3209da6e07607f2bb8d02712555734fcd8cd7a23703a6e7d639&quot; },
]
</code></pre>
<p><a href="https://github.com/user-attachments/files/16736078/project_source.zip">project_source.zip</a></p>
<p>According to the document:</p>
<blockquote>
<p>uv.lock is a universal or cross-platform lockfile that captures the packages that would be installed across all possible Python markers such as operating system, architecture, and Python version.</p>
</blockquote>
<p>If a uv.lock generated on Windows cannot be used on other platforms, then it is not a uv.lock as documented.
Therefore, when the documentation mentions using the Project API and depending on PyTorch, the uv.lock should conform to the documentation's specifications.
Or note that the generated lock file is not a universal file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-24 10:51</div>
            <div class="timeline-body"><p>@baggiponte
As for describing the installation method for a specific version, it's because UV installs PyTorch from sources other than PyPI, and it requires not only the version number but also the <a href="https://docs.astral.sh/uv/pip/compatibility/#local-version-identifiers">local version identifiers</a>.
Or, mentioning  <code>Local version identifiers</code> in the document might be another way to help people understand how to install a specific version.</p>
<h3>pip</h3>
<p><img src="https://github.com/user-attachments/assets/781df16f-ab46-47da-acff-307d276675c7" alt="image" /></p>
<h3>uv pip</h3>
<ul>
<li><strong>2.4.0</strong>
<img src="https://github.com/user-attachments/assets/b17322df-59c0-4cb2-825f-40515ff3c29b" alt="image" /></li>
<li><strong>2.4.0+cu121</strong>
<img src="https://github.com/user-attachments/assets/1d784833-e3d4-4662-8b2a-1b20e22c1558" alt="image" /></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-26 08:44</div>
            <div class="timeline-body"><p>Hey there, was away for the weekend. Thank you very much for the explanation ðŸ˜Š Will get back to this after work, later today.</p>
<p>In the meanwhile, to recap:</p>
<ol>
<li>I should investigate lockfiles generated by torch installation and document, at least to say that they might not be cross-platform, in this case.</li>
<li>Cover the local version identifiers differences between pip and uv.</li>
</ol>
<p>Did I get everything?</p>
<p>Thank you again for taking the time to steer me through this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-26 09:59</div>
            <div class="timeline-body"><blockquote>
<p>Hey there, was away for the weekend. Thank you very much for the explanation ðŸ˜Š Will get back to this after work, later today.</p>
<p>In the meanwhile, to recap:</p>
<ol>
<li>I should investigate lockfiles generated by torch installation and document, at least to say that they might not be cross-platform, in this case.</li>
<li>Cover the local version identifiers differences between pip and uv.</li>
</ol>
<p>Did I get everything?</p>
<p>Thank you again for taking the time to steer me through this!</p>
</blockquote>
<p>While this is generally correct, there's a potential issue when using uv add to install PyTorch.
If not configured properly, uv add might overwrite your existing PyTorch installation with a version from PyPI that lacks CUDA support, even if you previously had a GPU-accelerated version.
As I mentioned from this comment:  https://github.com/astral-sh/uv/pull/6523#issuecomment-2307497266</p>
<p><strong>Note:</strong> Since <a href="https://pypi.org/project/torch/">PyPI's PyTorch</a> offers wheels for macOS, Linux, and Windows, if we switch the source to PyPI and remove the Local version identifiers, there will be no errors. However, the version will possibly switch from CUDA to CPU only.
~~<strong>Note:</strong>  The Linux version of PyTorch <code>CUDA 12.1</code> on PyPI already supports CUDA.~~
<strong>Note:</strong>  The Linux version of PyTorch <code>CUDA 12.4</code> on PyPI already supports CUDA.
<img src="https://github.com/user-attachments/assets/ea7420cd-9fe1-4c5a-83a8-5dd1982118ba" alt="image" /></p>
<p>You're welcome. I know how frustrating these issues can be, so I wanted to save other users some time.
Providing good documentation is a great service to users, and I appreciate you taking the time to do so.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inflation">@inflation</a> on 2024-08-27 00:52</div>
            <div class="timeline-body"><p>It's pretty annoying since somehow <code>extra-index-url</code> overwrites the default index when a package with the same name but some versions missing. <code>uv</code> simply does not look at the default index for the missing version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-27 00:54</div>
            <div class="timeline-body"><p>@inflation there are details on that behavior in the <a href="https://docs.astral.sh/uv/pip/compatibility/#packages-that-exist-on-multiple-indexes">documentation</a>. Please don't complain about it in someone's pull request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inflation">@inflation</a> on 2024-08-27 01:00</div>
            <div class="timeline-body"><blockquote>
<p>@inflation there are details on that behavior in the <a href="https://docs.astral.sh/uv/pip/compatibility/#packages-that-exist-on-multiple-indexes">documentation</a>. Please don't complain about it in someone's pull request.</p>
</blockquote>
<p>This is precisely where it happens the most. Installing <code>pytorch</code> using the its index introduce the problem. <a href="https://pixi.sh/latest/advanced/channel_priority/#use-case-pytorch-and-nvidia-with-conda-forge"><code>pixi</code></a> has a similar issue and contains a nice example and explanation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seemethere">@seemethere</a> approved on 2024-09-11 20:54</div>
            <div class="timeline-body"><p>+1 from the PyTorch side!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/albanD">@albanD</a> on <code>docs/guides/integration/pytorch.md</code>:17 on 2024-09-12 17:22</div>
            <div class="timeline-body"><p>Would we be able to do this with <code>--index-url</code> instead of <code>--extra-index-url</code> throughout?
The extra version of this flag was the cause of a bad security event already for PyTorch and we would not want to repeat that here: https://pytorch.org/blog/compromised-nightly-dependency/</p>
<p>Because we do use <code>--index-url</code> for all the pip commands, you can rely on the fact that the url will contain all depedencies needed to install torch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/albanD">@albanD</a> reviewed on 2024-09-12 17:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-09-12 19:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>docs/guides/integration/pytorch.md</code>:17 on 2024-09-12 19:29</div>
            <div class="timeline-body"><p>Note we have different behavior than pip to try to avoid such issues https://docs.astral.sh/uv/pip/compatibility/#packages-that-exist-on-multiple-indexes</p>
<p>I think the real answer is that we need #171 though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/baggiponte">@baggiponte</a> reviewed on 2024-09-13 06:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/baggiponte">@baggiponte</a> on <code>docs/guides/integration/pytorch.md</code>:17 on 2024-09-13 06:21</div>
            <div class="timeline-body"><p>Uh, he has a point. I'll add a link to explain this behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-09-13 07:14</div>
            <div class="timeline-body"><p>Hello there! Sorry for disappearing, but as if it was not enough already, we got a sparkle of floods here too.</p>
<p>I edited a couple of things with the last commit I pushed.</p>
<ol>
<li>Since @albanD rightfully pointed out, I added a small callout to point to the relevant bits of the uv docs.</li>
<li>I reworked a bit the TL;DR section to make it a bit more straightforward.</li>
<li>I added a mention to #171</li>
<li>I tried to explain there might be issues with the cross-compatible lockfile. I am not sure I explained correctly what @FishAlchemist meant, though. I guess what they mean is:<ul>
<li>If someone does <code>uv add torch --extra-index-url=...</code></li>
<li>Then <code>uv add foobar</code></li>
<li>Then the pytorch version might be replaced with the PyPI one?
If so, how can I phrase this correctly?</li>
</ul>
</li>
</ol>
<p>@zanieb let me know if it makes sense, suggest edits or make them directly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-09-13 11:49</div>
            <div class="timeline-body"><p>@baggiponte
The primary issue with file locking is that the extra-index-url specified on the CLI is not written to pyproject.toml (Nor should it be written automatically). As a result, the next time you lock your dependencies, it won't remember to search the extra-index-url. Therefore, before adding PyTorch using the project API, it's recommended to manually add the extra-index-url to pyproject.toml instead of providing it on the CLI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/albanD">@albanD</a> on <code>docs/guides/integration/pytorch.md</code>:17 on 2024-09-13 15:59</div>
            <div class="timeline-body"><p>I agree the default is better. But it still sounds quite dangerous if we make a mistake (don't realize we forgot to push a version of that package on our index). Looking forward to the pinned package index!</p>
<p>Thanks for the update.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/albanD">@albanD</a> reviewed on 2024-09-13 15:59</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-09-13 16:06</div>
            <div class="timeline-body"><blockquote>
<p>@baggiponte The primary issue with file locking is that the extra-index-url specified on the CLI is not written to pyproject.toml (Nor should it be written automatically). As a result, the next time you lock your dependencies, it won't remember to search the extra-index-url. Therefore, before adding PyTorch using the project API, it's recommended to manually add the extra-index-url to pyproject.toml instead of providing it on the CLI.</p>
</blockquote>
<p>Makes perfect sense!</p>
<p>I guess it might be a good idea to mention that you should add <code>[tool.uv.sources]</code> to your pyproject. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-09-14 04:17</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>@baggiponte The primary issue with file locking is that the extra-index-url specified on the CLI is not written to pyproject.toml (Nor should it be written automatically). As a result, the next time you lock your dependencies, it won't remember to search the extra-index-url. Therefore, before adding PyTorch using the project API, it's recommended to manually add the extra-index-url to pyproject.toml instead of providing it on the CLI.</p>
</blockquote>
<p>Makes perfect sense!</p>
<p>I guess it might be a good idea to mention that you should add <code>[tool.uv.sources]</code> to your pyproject. What do you think?</p>
</blockquote>
<p>According to the documentation, version 0.4.10, [tool.uv.sources] only supports these sources.
<img src="https://github.com/user-attachments/assets/4dc75ff7-4db5-4be3-8669-855381d481ba" alt="image" />
Therefore, using [tool.uv.sources] requires you to find the sources yourself.</p>
<p>I'm trying to use extra-index-url, but as a result, there are no macOS wheels available.</p>
<pre><code class="language-toml">[tool.uv]
extra-index-url = [&quot;https://download.pytorch.org/whl/cu121&quot;]
</code></pre>
<p>I've yet to find a solution for using [tool.uv.sources] that can support Windows, Linux, macOS, and CUDA.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-09-14 15:50</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<blockquote>
<p>@baggiponte The primary issue with file locking is that the extra-index-url specified on the CLI is not written to pyproject.toml (Nor should it be written automatically). As a result, the next time you lock your dependencies, it won't remember to search the extra-index-url. Therefore, before adding PyTorch using the project API, it's recommended to manually add the extra-index-url to pyproject.toml instead of providing it on the CLI.</p>
</blockquote>
<p>Makes perfect sense!
I guess it might be a good idea to mention that you should add <code>[tool.uv.sources]</code> to your pyproject. What do you think?</p>
</blockquote>
<p>According to the documentation, version 0.4.10, [tool.uv.sources] only supports these sources. <img src="https://private-user-images.githubusercontent.com/48265002/367486491-4dc75ff7-4db5-4be3-8669-855381d481ba.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjYzMjg5MDAsIm5iZiI6MTcyNjMyODYwMCwicGF0aCI6Ii80ODI2NTAwMi8zNjc0ODY0OTEtNGRjNzVmZjctNGRiNS00YmUzLTg2NjktODU1MzgxZDQ4MWJhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA5MTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwOTE0VDE1NDMyMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWE5NTNhZjU4YTc3MzZlNzE4MmU2NzA2YjU2OWViNmU2NDZiMjUzNmI4NmIzOGQ3NTJhNzg1MjhlNzhjOGNjZGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Iwv_6ivjZ1J14oJfZqrug_IJlhZujhYR_5CW0dguXlw" alt="image" /> Therefore, using [tool.uv.sources] requires you to find the sources yourself.</p>
<p>I'm trying to use extra-index-url, but as a result, there are no macOS wheels available.</p>
<pre><code class="language-toml">[tool.uv]
extra-index-url = [&quot;https://download.pytorch.org/whl/cu121&quot;]
</code></pre>
<p>I've yet to find a solution for using [tool.uv.sources] that can support Windows, Linux, macOS, and CUDA.</p>
</blockquote>
<p>Very clear. Pushed another minor edit mentioning this. Would love to hear your feedback on the phrasing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-09-15 09:29</div>
            <div class="timeline-body"><blockquote>
<p>For example: suppose a Windows user runs uv add torch and then a Linux user runs uv sync to synchronise the lockfile. The Windows user will get CPU-only PyTorch, while the Linux user will get CUDA 12.1 PyTorch.</p>
</blockquote>
<p>@baggiponte I'm a bit worried this could be confusing, since it assumes the user hasn't given PyTorch package indexes to uv anywhere. However, this thing was never explicitly mentioned in the narrative. I'm unsure whether it's a good idea to imply it</p>
<p>As for the [tool.uv.sources] issue, it's just that I personally don't know how to use it to make PyTorch's lock files cross-platform. Therefore, I'm not sure if the current uv can make PyTorch cross-platform through it.
Therefore, it feels inappropriate that the document mentions the possibility of it not working.</p>
<p>@zanieb Can the current UV create cross-platform lockfiles for projects that depend on PyTorch?
(Capable of running across Windows, Linux, and macOS, at least under the specified CUDA version)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-20 00:13</div>
            <div class="timeline-body"><p>I think this might be unblocked by #7481 or some of the work following that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-17 16:25</div>
            <div class="timeline-body"><p>Hi everyone,</p>
<p>Since the release of <a href="https://github.com/astral-sh/uv/releases/tag/0.4.23">uv 0.4.23</a>, we might be able to start this work. Because I'm not very familiar with how to use the new features, I asked @charliermarsh  on Discord about how to write a pyproject.toml for PyTorch that supports Windows CUDA 12.1 and Linux (from PyPI) in this version. I got two examples, and I see that the lockfile can support three major platforms, but I only asked about Windows and Linux. I'm not sure if I need to write more details about macOS.</p>
<p>This is the question I asked, and it's also a personal use case for me.</p>
<h2>Conversation 1:</h2>
<blockquote>
<p>I need PyTorch 2.1.2, which requires CUDA 12.1 on my Windows system. On my Linux system, I need to install it from PyPI. I'm wondering how to write a pyproject.toml file to fulfill these requirements.
Moreover, installing PyTorch from non-PyPI sources using uv requires specifying Local version identifiers. Therefore, the PyTorch version should be 2.1.2+cu121 on Windows and 2.1.2 on Linux.</p>
</blockquote>
<p>https://discord.com/channels/1039017663004942429/1207998321562619954/1296492153576489030</p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
  &quot;torch==2.1.2+cu121 ; platform_system == 'Windows'&quot;,
  &quot;torch==2.1.2 ; platform_system != 'Windows'&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;torch-cu121&quot;, marker = &quot;platform_system == 'Windows'&quot;},
  { index = &quot;pypi&quot;, marker = &quot;platform_system != 'Windows'&quot;},
]

[[tool.uv.index]]
name = &quot;pypi&quot;
url = &quot;https://pypi.org/simple&quot;

[[tool.uv.index]]
name = &quot;torch-cu121&quot;
url = &quot;https://download.pytorch.org/whl/cu121&quot;
</code></pre>
<h2>Conversation 2 (Continue conversation 1):</h2>
<blockquote>
<p>Thank you for providing me with the example. I originally thought that if no marker was matched, UV would go to PyPI to search, but I didn't expect that I needed to explicitly specify to go to PyPI.</p>
</blockquote>
<p>https://discord.com/channels/1039017663004942429/1207998321562619954/1296500150600077322</p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
  &quot;torch==2.1.2 ; platform_system != 'Windows'&quot;,
  &quot;torch==2.1.2+cu121 ; platform_system == 'Windows'&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;torch-cu121&quot;, marker = &quot;platform_system == 'Windows'&quot;},
]

[[tool.uv.index]]
name = &quot;torch-cu121&quot;
url = &quot;https://download.pytorch.org/whl/cu121&quot;
explicit = true
</code></pre>
<p>The above examples can be used as a reference for this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-17 17:42</div>
            <div class="timeline-body"><p>Hello there! Saw the latest release with extreme joy! Might hop in the Discord to edge out the last details. I am not 100% sure I have the time to do this tonight; might be tomorrow or over the weekend. If anyone has the time, feel free to pick up where I left and bring this over the finish line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fzyzcjy">@fzyzcjy</a> on 2024-10-19 12:24</div>
            <div class="timeline-body"><p>Hi I am facing problem in macos for pytorch cpu installation (https://github.com/astral-sh/uv/issues/8358), is there any suggestions? Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-20 08:54</div>
            <div class="timeline-body"><p>Hello there! Finally have some time.</p>
<blockquote>
<h2>Conversation 2 (Continue conversation 1):</h2>
<blockquote>
<p>Thank you for providing me with the example. I originally thought that if no marker was matched, UV would go to PyPI to search, but I didn't expect that I needed to explicitly specify to go to PyPI.</p>
</blockquote>
<p><a href="https://discord.com/channels/1039017663004942429/1207998321562619954/1296500150600077322">discord.com/channels/1039017663004942429/1207998321562619954/1296500150600077322</a></p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
  &quot;torch==2.1.2 ; platform_system != 'Windows'&quot;,
  &quot;torch==2.1.2+cu121 ; platform_system == 'Windows'&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;torch-cu121&quot;, marker = &quot;platform_system == 'Windows'&quot;},
]

[[tool.uv.index]]
name = &quot;torch-cu121&quot;
url = &quot;https://download.pytorch.org/whl/cu121&quot;
explicit = true
</code></pre>
<p>The above examples can be used as a reference for this PR.</p>
</blockquote>
<p>This works for me on Python 3.10 and 3.11, but not 3.12. If I just do <code>uv add torch</code>, everything works as usual on all supported Python versions. I am on an ARM mac.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-20 09:16</div>
            <div class="timeline-body"><p>@baggiponte I noticed that PyPI's torch package is now using CUDA 12.4, but I'm unsure of the exact date and version when this change was made.
<img src="https://github.com/user-attachments/assets/958f8cc6-367d-42d4-94b5-9a658bb840ac" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-20 09:30</div>
            <div class="timeline-body"><blockquote>
<p>@baggiponte I noticed that PyPI's torch package is now using CUDA 12.4, but I'm unsure of the exact date and version when this change was made. <img src="https://private-user-images.githubusercontent.com/48265002/378172621-958f8cc6-367d-42d4-94b5-9a658bb840ac.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Mjk0MTY2MDMsIm5iZiI6MTcyOTQxNjMwMywicGF0aCI6Ii80ODI2NTAwMi8zNzgxNzI2MjEtOTU4ZjhjYzYtMzY3ZC00MmQ0LTk0YjUtOWE2NThiYjg0MGFjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDEwMjAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQxMDIwVDA5MjUwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQ3ZjgzYzM4NDc0Mjk0NmYxMWI3NDM2YmJjNThiMDg0ZmVhMTJlNWE4NWQ4NTIwOGJiZGIwYzRlZTFjZTIzNjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.FQGhH6t6Ob1NF4fMvQXLXyvLahJki6K3p8kPq2GGOpw" alt="image" /></p>
</blockquote>
<p>No actually it's dumber; torch 2.12 does not support python 3.12.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-20 09:35</div>
            <div class="timeline-body"><blockquote>
<p>No actually it's dumber; torch 2.12 does not support python 3.12.</p>
</blockquote>
<p>Version 2.1.x is not compatible with Python 3.12, therefore this behavior is expected.
https://github.com/pytorch/pytorch/blob/main/RELEASE.md#release-compatibility-matrix
<img src="https://github.com/user-attachments/assets/a94095e0-05ec-43f2-af2f-23185a0b2320" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fzyzcjy">@fzyzcjy</a> on 2024-10-20 10:01</div>
            <div class="timeline-body"><p>So is there anyone who successfully install macos torch cpu version, and could you please share your script? Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-20 10:13</div>
            <div class="timeline-body"><blockquote>
<p>So is there anyone who successfully install macos torch cpu version, and could you please share your script? Thanks!</p>
</blockquote>
<p>Ciao, this discussion is dedicated to the PR implementation. Please keep the discussion to the issue you created ðŸ˜Š (I could not reproduce your issue because I am on an ARM mac, btw.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-20 10:53</div>
            <div class="timeline-body"><p>Rewrote the thing from scratch. I am not 100% sure if the solution works in every usecase.</p>
<p>With the sample pyproject.toml that was provided, one can ensure that (for example) a macOS user installs from PyPI while Windows and Linux from <em>either</em> torch+cpu <em>or</em> torch+cu{whatever}. IIUC, there's no way to automatically install CUDA if there are drivers on the machine. Am I wrong?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fzyzcjy">@fzyzcjy</a> on 2024-10-20 13:29</div>
            <div class="timeline-body"><p>Sorry for disturbing (I originally thought this PR is about torch installation, thus also includes torch installation on macos)!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-20 13:53</div>
            <div class="timeline-body"><blockquote>
<p>Rewrote the thing from scratch. I am not 100% sure if the solution works in every usecase.</p>
<p>With the sample pyproject.toml that was provided, one can ensure that (for example) a macOS user installs from PyPI while Windows and Linux from <em>either</em> torch+cpu <em>or</em> torch+cu{whatever}. IIUC, there's no way to automatically install CUDA if there are drivers on the machine. Am I wrong?</p>
</blockquote>
<p>I'm not quite sure what you're referring to. But based on my experience with Windows, a package manager simply downloads and installs packages from the specified index and considers its job done. Installing and configuring the  drivers and system dependencies is outside its scope.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-20 14:43</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Rewrote the thing from scratch. I am not 100% sure if the solution works in every usecase.
With the sample pyproject.toml that was provided, one can ensure that (for example) a macOS user installs from PyPI while Windows and Linux from <em>either</em> torch+cpu <em>or</em> torch+cu{whatever}. IIUC, there's no way to automatically install CUDA if there are drivers on the machine. Am I wrong?</p>
</blockquote>
<p>I'm not quite sure what you're referring to. But based on my experience with Windows, a package manager simply downloads and installs packages from the specified index and considers its job done. Installing and configuring the drivers and system dependencies is outside its scope.</p>
</blockquote>
<p>Ops, sorry, was not clear enough. I did not mean to imply that uv should configure cuda drivers and such.</p>
<p>Let me know if the guide covers enough or there should be some more warnings/clarifications/recommendations :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-20 14:57</div>
            <div class="timeline-body"><p>@baggiponte Should we mention https://github.com/astral-sh/uv/issues/8358#issuecomment-2424808369?
https://github.com/pytorch/pytorch/blob/main/RELEASE.md#operating-systems
However, I haven't executed the content of the document yet. I'm only browsing it on GitHub at the moment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-21 04:01</div>
            <div class="timeline-body"><p>@fzyzcjy Since you're already here, is there anything missing from the current documents, based on your usage experience?
When using UV to process PyTorch, what kind of information would you like to know?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fzyzcjy">@fzyzcjy</a> on 2024-10-21 05:05</div>
            <div class="timeline-body"><blockquote>
<p>Since you're already here, is there anything missing from the current documents, based on your usage experience?
When using UV to process PyTorch, what kind of information would you like to know?</p>
</blockquote>
<p>Your comment in #8358 - the &quot;<code>uv add torch&lt;2.3.0</code>&quot; and the &quot;2.3.0 does not support intel chip anymore&quot; - is really helpful. If someone is using intel chip mac, I guess he or she may be beneficial from such a line in doc.</p>
<p>On the other hand, I agree it is not a <code>uv</code> issue, so not saying this in doc is also reasonable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-21 09:46</div>
            <div class="timeline-body"><p>Added the mention! :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fzyzcjy">@fzyzcjy</a> reviewed on 2024-10-21 09:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/fzyzcjy">@fzyzcjy</a> on <code>docs/guides/integration/pytorch.md</code>:167 on 2024-10-21 09:57</div>
            <div class="timeline-body"><p>Looks great! Just a nit: seems it is 2.2.x that is supported and 2.3.0 does not support (if I understand correctly)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/FishAlchemist">@FishAlchemist</a> reviewed on 2024-10-22 03:06</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on <code>docs/guides/integration/pytorch.md</code>:167 on 2024-10-22 03:06</div>
            <div class="timeline-body"><p>While the new PyTorch version isn't available on PyPI or PyTorch Index for macOS Intel, you can still get it by installing from conda.
https://anaconda.org/conda-forge/pytorch/files
<img src="https://github.com/user-attachments/assets/d2823f47-f132-4f47-827c-ddcf32986f4f" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/baggiponte">@baggiponte</a> reviewed on 2024-10-22 05:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/baggiponte">@baggiponte</a> on <code>docs/guides/integration/pytorch.md</code>:167 on 2024-10-22 05:13</div>
            <div class="timeline-body"><blockquote>
<p>Just a nit: seems it is 2.2.x that is supported and 2.3.0 does not support</p>
</blockquote>
<p>You are correct! Thanks for spotting this</p>
<blockquote>
<p>you can still get it by installing from conda.</p>
</blockquote>
<p>Interesting. I'll edit accordingly. Do we need to link to conda, and if so, what's the most useful link?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-10-22 07:21</div>
            <div class="timeline-body"><p>I also added torchvision to the example in the docs given #8344.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @zanieb on 2024-10-22 11:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-22 11:45</div>
            <div class="timeline-body"><p>I believe that @charliermarsh plans to look into PyTorch this month so I've assigned him. Great to see all the collaboration here!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 20:38</div>
            <div class="timeline-body"><p>I'm running into the same original issue as #7202 following these docs (the &quot;Distribution .. can't be installed because it doesn't have a source distribution...&quot;) error. My setup:</p>
<p>workspace pyproject.toml:</p>
<pre><code>[project]
name = &quot;workspace&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;==3.12.*&quot;
dependencies = []

[tool.uv.workspace]
members = [
    &quot;foo&quot;,
]

[tool.uv]
managed = true
override-dependencies = [
  # mediapipe wrongly depends on protobuf&lt;5
    &quot;protobuf==5.27.5&quot;,
    &quot;mediapipe==0.10.14&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cu124&quot;, marker = &quot;platform_system != 'Darwin'&quot;},
]
torchvision = [
  { index = &quot;pytorch-cu124&quot;, marker = &quot;platform_system != 'Darwin'&quot;},
]

[[tool.uv.index]]
name = &quot;pytorch-cu124&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
explicit = true
</code></pre>
<p>And <code>foo/pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;foo&quot;
version = &quot;0.0.0&quot;
dependencies = [
    &quot;torch&quot;,
    &quot;torchsde&quot;,
    &quot;torchvision&quot;,
    &quot;torchaudio&quot;,
    &quot;einops&quot;,
    &quot;transformers&gt;=4.28.1&quot;,
    &quot;tokenizers&gt;=0.13.3&quot;,
    &quot;sentencepiece&quot;,
    &quot;safetensors&gt;=0.4.2&quot;,
    &quot;aiohttp&quot;,
    &quot;pyyaml&quot;,
    &quot;Pillow&quot;,
    &quot;scipy&quot;,
    &quot;tqdm&quot;,
    &quot;psutil&quot;,
    &quot;kornia&gt;=0.7.1&quot;,
    &quot;spandrel&quot;,
    &quot;soundfile&quot;,
]
requires-python = &quot;&gt;=3.12&quot;
readme = &quot;README.md&quot;
</code></pre>
<p>Trying to run <code>uv sync --project foo</code> results in:</p>
<pre><code>error: Distribution `torch==2.5.1 @ registry+https://download.pytorch.org/whl/cu124` can't be installed because it doesn't have a source distribution or wheel for the current platform```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 20:43</div>
            <div class="timeline-body"><p>@vvuk -- Are you running on macOS or non-macOS (per the markers)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 20:49</div>
            <div class="timeline-body"><p>non-macos (Windows). I've also noticed some docs (e.g. here) have <code>platform_system != 'Darwin'</code> and others have <code>sys_platform != 'Darwin'</code> -- which is correct? Or are they interchangeable? Also perhaps odd is that a <code>uv sync</code> in the workspace root succeeds, and a lock file gets created.. but now that I look in the lock file, there's no resolution for <code>&quot;torch&quot;</code> for Windows. Just for Darwin, and for.. hmm. Not sure how to interpret this:</p>
<pre><code>[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cu124&quot; }
resolution-markers = [
    &quot;platform_machine == 'aarch64' and platform_system == 'Linux'&quot;,
    &quot;(platform_machine != 'aarch64' and platform_system != 'Darwin') or (platform_system != 'Darwin' and platform_system
 != 'Linux')&quot;,
]
...
wheels = ... linux_aarch64 ...

[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
resolution-markers = [
    &quot;platform_system == 'Darwin'&quot;,
]
...
wheels = .. macosx_11_arm64 ...
</code></pre>
<p>So looks like there was only a resolution for linux-aarch64 and for macos-arm64</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 20:52</div>
            <div class="timeline-body"><p>That's discussed at length in a few places: https://github.com/astral-sh/uv/issues/5182#issuecomment-2237858277, https://github.com/astral-sh/uv/issues/8536#issuecomment-2436123242. (There's no way for us to know if the set of wheels covers the entire space you care about.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 20:52</div>
            <div class="timeline-body"><p>You probably need to define your dependencies like:</p>
<pre><code>torch==2.5.1+cu124 ; platform_system != 'Darwin'
torch==2.5.1 ; platform_system == 'Darwin'
</code></pre>
<p>Confusingly, the wheels you want from the PyTorch index are tagged as <code>2.5.1+cu124</code> -- there are some wheels that are just <code>2.5.1</code>, but not for Windows: https://download.pytorch.org/whl/torch/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 21:02</div>
            <div class="timeline-body"><p>Yeah, I was hoping to not have to declare explicit versions; that seems to be the only workable solution though. Maybe one way to resolve this mess would be a uv config for &quot;prioritize these local tags in this order for resolution&quot;. e.g.:</p>
<pre><code>local-priority = [
   &quot;cu124 ; platform_system != 'Darwin'&quot;,
   &quot;foo ; platform_system == 'Darwin'&quot;,
   &quot;bar&quot;
]
</code></pre>
<p>To state that on non-macos, prioritize <code>+cu124</code> above any other matching version. On macOS, prioritize <code>+foo</code>. And on all platforms prioritize <code>+bar</code> above anything else. The above would also be in order, so on windows <code>+cu124</code> would be picked before <code>+bar</code>. (Maybe an optional syntax to say &quot;require cu124&quot; vs &quot;prioritize cu124&quot;, i.e. whether to pick <code>2.6.0</code> over <code>2.5.5+cu124</code> or not)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 21:03</div>
            <div class="timeline-body"><p>Yeah, it's not a great situation. I'd really love to just fix / improve the local version handling entirely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 23:21</div>
            <div class="timeline-body"><p>I'm trying with this in my workspace pyproject.toml:</p>
<pre><code>[tool.uv]
override-dependencies = [
  &quot;torch==2.5.1+cu124 ; platform_system != 'Darwin'&quot;,
  &quot;torch==2.5.1 ; platform_system == 'Darwin'&quot;,

  &quot;torchvision==0.20.1+cu124 ; platform_system != 'Darwin'&quot;,
  &quot;torchvision==0.20.1 ; platform_system == 'Darwin'&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cu124&quot;, marker = &quot;platform_system != 'Darwin'&quot; }
]
torchvision = [
  { index = &quot;pytorch-cu124&quot;, marker = &quot;platform_system != 'Darwin'&quot; }
]
</code></pre>
<p>A workspace member has a dependency on just <code>torch</code>. Running sync on windows:</p>
<pre><code>  Ã— No solution found when resolving dependencies for split (python_full_version == '3.12.*' and platform_machine == 'aarch64' and platform_system ==
  â”‚ 'Linux'):
  â•°â”€â–¶ Because there is no version of torch{platform_system != 'Darwin'}==2.5.1+cu124 and comfyui depends on torch{platform_system !=
      'Darwin'}==2.5.1+cu124, we can conclude that comfyui's requirements are unsatisfiable.
      And because your workspace requires comfyui, we can conclude that your workspace's requirements are unsatisfiable.
</code></pre>
<p>okay, I can believe there's no cuda version for aarch64. I've tried every variant I can think of and can't get a resolution, including this which I think should 100% work:</p>
<pre><code>override-dependencies = [
  &quot;torch==2.5.1+cu124 ; platform_system == 'Windows'&quot;,
  &quot;torch==2.5.1 ; platform_system != 'Windows'&quot;,
  &quot;torchvision==0.20.1+cu124 ; platform_system == 'Windows'&quot;,
  &quot;torchvision==0.20.1 ; platform_system != 'Windows'&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cu124&quot;, marker = &quot;platform_system == 'Windows'&quot; },
  # added these because I wasn't sure if sources was constraining the indexes completely, i.e.
  # it wouldn't consider any additional ones if explicit ones are specified
  { index = &quot;pytorch-cpu&quot;, marker = &quot;platform_system != 'Windows'&quot; },
]
torchvision = [
  { index = &quot;pytorch-cu124&quot;, marker = &quot;platform_system == 'Windows'&quot; },
  { index = &quot;pytorch-cpu&quot;, marker = &quot;platform_system != 'Windows'&quot; },
]

[[tool.uv.index]]
name = &quot;pytorch-cu124&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
</code></pre>
<p>I get:</p>
<pre><code>  Ã— No solution found when resolving dependencies for split (python_full_version == '3.12.*' and platform_system == 'Windows'):
  â•°â”€â–¶ Because there is no version of torch{platform_system == 'Windows'}==2.5.1+cu124 and comfyui depends on torch{platform_system ==
      'Windows'}==2.5.1+cu124, we can conclude that comfyui's requirements are unsatisfiable.
      And because your workspace requires comfyui, we can conclude that your workspace's requirements are unsatisfiable.
</code></pre>
<p>If I do <code>uv sync --no-cache -vv</code>, I actually see zero hits to the pytorch index URLs. If I remove <code>explicit = true</code>, I get further, but then I get into a mess because I'm picking up random packages from the pytorch sources that are too old, and versions inside pypi's aren't considered. If I use <code>--index-strategy unsafe-best-match</code> then I end up picking up a random package that is <em>too new</em>, and somehow exists for only one platform and so can't be found anywhere else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 23:41</div>
            <div class="timeline-body"><p>This seems to be an interaction with dependency overrides and sources; it seems like <code>tool.uv.sources</code> is not considered when something is in <code>override-dependencies</code>. If I turn my workspace into a non-virtual one:</p>
<pre><code>[project]
name = &quot;foo&quot;
version = &quot;0.0.0&quot;
dependencies = [
  &quot;torch==2.5.1+cu124 ; platform_system == 'Windows'&quot;,
  &quot;torch==2.5.1 ; platform_system != 'Windows'&quot;,
  &quot;torchaudio==2.5.1+cu124 ; platform_system == 'Windows'&quot;,
  &quot;torchaudio==2.5.1 ; platform_system != 'Windows'&quot;,
  &quot;torchvision==0.20.1+cu124 ; platform_system == 'Windows'&quot;,
  &quot;torchvision==0.20.1 ; platform_system != 'Windows'&quot;,
]
</code></pre>
<p>and don't put that in override-dependencies, and keep the uv sources to point to the cpu repo for non-windows, I can resolve. If I make dependencies generic (&quot;torch&quot;, &quot;torchaudio&quot;, &quot;torchvision&quot;) and restore the overrides, I get the same error about not being able to resolve +cu124.</p>
<p>... but if I do this (dependencies), then I'm back to a non-virtual workspace, and then I run into #5727. So, I created a dummy <code>pin-pytorch</code> package that contains just a <code>pyproject.toml</code> like above and added that to my (virtual) workspace. This seems to work!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Leon0402">@Leon0402</a> on 2024-11-01 21:15</div>
            <div class="timeline-body"><p>I am missing the following use cases in the docs:</p>
<ol>
<li>What happens if we have transitive dependencies that specify different versions of torch. Imagine one dependency with a dependency on torch CPU and one on torch CudaX. But you actually need CudaY. I think it would be quite valuable to give some detail here how the resolver behaves in such cases (even though that is not torch specific) and how to resolve potential conflicts -&gt; I have not tried that use case and I am no UV expert, so I don't really know what happens here. But I guess it goes in the direction of <code>override-dependencies</code> mentioned earlier here.</li>
<li>How can we deal with the situation that project members need different torch versions for the same platform. Imagine one person only has a CPU, but another one a GPU. Or two people need different cuda versions on the same platform. AFAIK there is no super nice solution here as we do not have cuda markers, because python cannot realiably detect this or something like this. So I imagine this needs to be solved somehow with extras or something similar. Mentioning limitations and possible solutions would be beneficial.</li>
</ol>
<p>And perhaps it would be nice to have some sort of FAQ section with common mistakes, for instance the docs specify in the beginning <code>!!! tip &quot;Supported Python versions&quot;</code>, but I think people might miss that or cannot relate the error message directly with this. So it might make sense to show explicitly the kind of error that happens, when you use an incompatible python version. I guess there are more examples for common mistakes / error messages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-01 23:51</div>
            <div class="timeline-body"><p>Perhaps a useful example https://github.com/astral-sh/uv/issues/8746#issuecomment-2452438775</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-02 03:04</div>
            <div class="timeline-body"><p>Hi everyone,
I think we need to confirm the minimum supported PyTorch version in this PR's document, and whether we should support all its target architectures.</p>
<h1>Operating Systems</h1>
<p>https://github.com/pytorch/pytorch/blob/main/RELEASE.md#operating-systems
<img src="https://github.com/user-attachments/assets/04df15fb-0b5e-4a1c-82bd-a573869d2e8f" alt="image" />
If we want to support versions below 2.3.0, such as 2.2.2, then we need to be able to install it on macOS Intel (x86-64).
Alternatively, is it outside the scope of our project API to accommodate PyTorch execution on macOS Intel(x86-64)?</p>
<h1>Release Compatibility Matrix</h1>
<p>https://github.com/pytorch/pytorch/blob/main/RELEASE.md#release-compatibility-matrix
<img src="https://github.com/user-attachments/assets/5cd0391a-10d1-42e3-9255-d7ea07124985" alt="image" />
According to the diagram above, since UV currently supports Python 3.8 as the minimum version, we only need to ensure support for PyTorch 2.0 or above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bryant1410">@bryant1410</a> reviewed on 2024-11-12 13:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/bryant1410">@bryant1410</a> on <code>docs/guides/integration/pytorch.md</code>:3 on 2024-11-12 13:43</div>
            <div class="timeline-body"><pre><code class="language-suggestion">[PyTorch](https://pytorch.org/) is a popular open-source deep learning framework that has first-class support for acceleration via GPUs. Installation, however, can be complex, as you won't find all the wheels for PyTorch on PyPI and you have to manage this through external indexes. This guide aims to help you set up a `pyproject.toml` file using `uv` [indexes features](../../configuration/indexes.md).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 18:23</div>
            <div class="timeline-body"><p>Now that we have all the pieces in place I'm going to invest in comprehensive PyTorch docs. I will fold this work into those docs -- thank you so much for writing it up. I may even merge this first, then make my PR atop it so that this is preserved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 18:57</div>
            <div class="timeline-body"><p>(These docs are really great, thank you @baggiponte.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 19:21</div>
            <div class="timeline-body"><p>I've built on this work in https://github.com/astral-sh/uv/pull/9210. This PR will merge first, then https://github.com/astral-sh/uv/pull/9210 would follow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-11-19 01:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-11-19 01:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-19 01:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:39:07 UTC
    </footer>
</body>
</html>
