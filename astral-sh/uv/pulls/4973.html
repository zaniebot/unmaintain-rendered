<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for requirements files in `uv run` - astral-sh/uv #4973</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for requirements files in <code>uv run</code></h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/4973">#4973</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-07-10 17:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Closes https://github.com/astral-sh/uv/issues/4824.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @zanieb on 2024-07-10 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @zanieb on 2024-07-10 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-10 18:58</div>
            <div class="timeline-body"><p>Terrifyingly easy to add. I want to add some more test coverage and I'm sure there are some niche behaviors I need to explore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-10 18:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:1792 on 2024-07-10 18:58</div>
            <div class="timeline-body"><p>Should we say <code>-r</code> / <code>--with-requirements</code> instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-16 17:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:66 on 2024-07-16 17:38</div>
            <div class="timeline-body"><p>Alternatively, <code>uv run -r</code> could imply <code>--isolated</code> (which might make sense but is more limiting?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-17 01:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/run.rs</code>:66 on 2024-07-17 01:26</div>
            <div class="timeline-body"><p>Am I correct that the <em>code</em> would work, and here, you just mean that semantically <code>-r foo/bar/pyproject.toml</code> <em>should</em> use <code>foo/bar</code> as the project?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-07-17 01:27</div>
            <div class="timeline-body"><p>Seems fine (it's good that it was easy!). Let's also add to <code>uv tool run</code>? What about <code>uv tool install</code>...?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 02:33</div>
            <div class="timeline-body"><p>Also closes https://github.com/astral-sh/uv/issues/4824.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-17 14:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:66 on 2024-07-17 14:55</div>
            <div class="timeline-body"><p>Yeah the code should work as-is, it's just weird since it may <em>imply</em> a change of project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-17 14:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:66 on 2024-07-17 14:56</div>
            <div class="timeline-body"><p>Like.. you should use <code>--with ./foo/bar</code> instead, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-17 15:01</div>
            <div class="timeline-body"><p>Yeah I think we need it everywhere. What do you think about names?</p>
<ul>
<li><code>--with-requirements &lt;path&gt;</code></li>
<li><code>--with-requirements-file &lt;path&gt;</code></li>
<li><code>--requirements-file &lt;path&gt;</code></li>
<li><code>--requirements &lt;path&gt;</code></li>
</ul>
<p>I think the <code>--with</code> prefix makes sense since it's important to note it's &quot;adding&quot; requirements alongside whatever else?</p>
<p>Per https://github.com/astral-sh/uv/issues/4824#issuecomment-2211971741 I think we want to support <code>--override foo==1.0.0</code> directly so maybe the constraint and override options are:</p>
<ul>
<li><code>--constraint &lt;single&gt;</code></li>
<li><code>--override &lt;single&gt;</code></li>
<li><code>--constraints &lt;path&gt;</code></li>
<li><code>--overrides &lt;path&gt;</code></li>
</ul>
<p>Do we want:</p>
<ul>
<li><code>--constraint-file</code> / <code>--override-file</code> or</li>
<li><code>--constraints-path</code> / <code>--overrides-path</code>?</li>
</ul>
<p>Here I think it's reasonable to drop the <code>--with</code> prefix because we could apply these constraints and overrides to <em>all</em> project dependencies not just those being added on top?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 15:05</div>
            <div class="timeline-body"><p>We don't accept <code>--override foo==1.0.0</code> in the <code>pip</code> API -- is it necessary to support here? It seems fine to me to be consistent with the <code>pip</code> API on those.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 15:05</div>
            <div class="timeline-body"><p>Or, at least, we definitely don't need to support that to start IMO. And if we want to support it, we should probably support it in the pip API too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-17 15:10</div>
            <div class="timeline-body"><p>Yeah I don't think that's in scope for this pull request, just want to nail down the plan so we can make sure it's coherent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 15:16</div>
            <div class="timeline-body"><p>I think I'd be ok with <code>--requirements</code>, <code>--overrides</code>, and <code>--constraints</code> (with the short options too) -- it just feels the most intuitive coming from the other APIs. <code>--with-*</code> is also ok, but we'd probably end up wanting aliases for the shorter versions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 23:12</div>
            <div class="timeline-body"><p>@zanieb - I'm happy to finish this PR if we can get consensus on the names, no trouble.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-18 15:10</div>
            <div class="timeline-body"><p>@charliermarsh I am comfortable finishing it up this week</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-07-19 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-20 01:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/run.rs</code>:313 on 2024-07-20 01:10</div>
            <div class="timeline-body"><p>Typo :D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-20 01:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/run.rs</code>:390 on 2024-07-20 01:11</div>
            <div class="timeline-body"><p>You might be able to simplify this with a <code>spec.filter(|spec| !spec.is_empty())</code> somewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-07-20 01:11</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-23 13:45</div>
            <div class="timeline-body"><p>As discussed I'll take this over and try to get it merged today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-23 16:10</div>
            <div class="timeline-body"><p>Note that we're using plural <code>--constraints</code>, <code>--requirements</code> and <code>--overrides</code> here to make room for the singular interface in the future. However, this differs from the <code>uv pip</code> interface which uses singular names to refer to files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add support for requirements files, constraints, and overrides in `uv run`" to "Add support for requirements files in `uv run`" by @charliermarsh on 2024-07-23 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-23 16:31</div>
            <div class="timeline-body"><p>We decided to narrow the scope to requirements files for now. Constraints and overrides require that we resolve <em>alongside</em> the base environment, diff the result, and install any changes into the ephemeral environment. Which is doable, but a lot more complex.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-23 16:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-cli/src/lib.rs</code>:1840 on 2024-07-23 16:33</div>
            <div class="timeline-body"><p>This seems dubious here, is it easy to disable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-23 16:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:1840 on 2024-07-23 16:34</div>
            <div class="timeline-body"><p>I don't think so...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-23 16:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/src/commands/project/run.rs</code>:320 on 2024-07-23 16:35</div>
            <div class="timeline-body"><p>This case can't occur now, right? Still worth including?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-23 16:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:1840 on 2024-07-23 16:35</div>
            <div class="timeline-body"><p>Checking</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/run.rs</code>:320 on 2024-07-23 16:36</div>
            <div class="timeline-body"><p>I figured it was worth it with a TODO. I can clarify more in the comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-23 16:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-23 16:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-cli/src/lib.rs</code>:1840 on 2024-07-23 16:43</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-07-23 16:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/src/commands/project/run.rs</code>:320 on 2024-07-23 16:44</div>
            <div class="timeline-body"><p>Removed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-07-23 16:45</div>
            <div class="timeline-body"><p>&quot;Approved&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-23 16:45</div>
            <div class="timeline-body"><p>Thanks for taking this over!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2024-07-23 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-23 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-07-23 16:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:38:03 UTC
    </footer>
</body>
</html>
