<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>disfavor aarch64 windows in its own house - astral-sh/uv #13724</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>disfavor aarch64 windows in its own house</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/13724">#13724</a>
        opened by <a href="https://github.com/Gankra">@Gankra</a>
        on 2025-05-29 22:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a></div>
            <div class="timeline-body"><p>and prefer emulated x64 windows in its stead.</p>
<p>This is preparatory work for shipping support for uv downloading and installing aarch64 (arm64) windows Pythons. We&#x27;ve <a href="https://github.com/astral-sh/python-build-standalone/pull/387">had builds for this platform ready for a while</a>, but have held back on shipping them due to a fundamental problem:</p>
<p><strong>The Python packaging ecosystem does not have strong support for aarch64 windows</strong>, e.g., not many projects build aarch64 wheels yet. The net effect of this is that, if we handed you an aarch64 python interpreter on windows, you would have to build a lot more sdists, and there&#x27;s a high chance you will simply fail to build that sdist and be sad.</p>
<p>Yes unfortunately, in this case a non-native Python interpreter simply <em>works better</em> than the native one... in terms of working at all, today. Of course, if the native interpreter works for your project, it should presumably have better performance and platform compatibility.</p>
<p>We do not want to stand in the way of progress, as ideally this situation is a temporary state of affairs as the ecosystem grows to support aarch64 windows. To enable progress, on aarch64 Windows builds of uv:</p>
<ul>
<li>We will still use a native python interpreter, e.g., if it&#x27;s at the front of your <code>PATH</code> or the only installed version.</li>
<li>If we are choosing between equally good interpreters that differ in architecture, x64 will be preferred.</li>
<li>We will emit a diagnostic on installation, and show the python request to pass to uv to force aarch64 windows to be used.</li>
<li>Will be shipping <a href="https://github.com/astral-sh/python-build-standalone/pull/387">aarch64 Windows Python downloads</a></li>
<li>Will probably add some kind of global override setting/env-var to disable this behaviour.</li>
<li>Will be shipping this behaviour in <a href="https://github.com/astral-sh/setup-uv">astral-sh/setup-uv</a></li>
</ul>
<p>We&#x27;re coordinating with Microsoft, GitHub (for the <code>setup-python</code> action), and the CPython team (for the <code>python.org</code> installers), to ensure we&#x27;re aligned on this default and the timing of toggling to prefer native distributions in the future.</p>
<p>See discussion in</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/12906</li>
</ul>
<hr>
<p>This is an alternative to</p>
<ul>
<li>#13719</li>
</ul>
<p>which uses sorting rather than filtering, as discussed in</p>
<ul>
<li>#13721</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by <a href="https://github.com/Gankra">@Gankra</a> on 2025-05-29 22:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:488 on 2025-05-29 22:24</div>
            <div class="timeline-body"><p>Why not implement this in https://github.com/astral-sh/uv/blob/546a6d017d6294712a9796630397862ba86d77ff/crates/uv-python/src/platform.rs#L40-L59 instead under a Windows cfg? Do we need the <code>self.os</code> check here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-29 22:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-29 22:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:488 on 2025-05-29 22:24</div>
            <div class="timeline-body"><p>(this just looks a lot like the logic already in <code>Arch::cmp</code> and I think it&#x27;d be easier to reason about in a single location)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-05-29 22:32</div>
            <div class="timeline-body">



<a href="https://codspeed.io/astral-sh/uv/branches/gankra%2Fdeprio-arm64-windows">CodSpeed Walltime Performance Report</a>
Merging #13724 will <strong>not alter performance</strong>
<p>Comparing <code>gankra/deprio-arm64-windows</code> (1777186) with <code>main</code> (d9b76b9)</p>
Summary
<p><code>âœ… 12</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-05-29 22:34</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-python/src/installation.rs</code>:488 on 2025-05-29 22:34</div>
            <div class="timeline-body"><p>Yeah it&#x27;s because of the os check. Not that it&#x27;s super useful now that I think about it harder, but it feels... wrong... that we would resolve a request for <code>python-3.11-darwin-any</code> to intel on arm64 windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-05-29 23:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/installation.rs</code>:488 on 2025-05-29 23:00</div>
            <div class="timeline-body"><p>Hm... it does feel wrong... but like... not a real use-case today. I worry about this being brittle. I&#x27;ll ponder this overnight.</p>
<p>It does suggest that long-term we need a dedicated <code>Platform</code> type to encapsulate both the OS and the Arch and implement <code>Ord</code> on that instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-30 07:21</div>
            <div class="timeline-body"><p>When applying this, we should make sure that we signal to the user clearly that we prefer x64_86 over aarch64 and how to revert that, both on automatic installation and on <code>uv python list</code>. (This is different from the Apple case where there was an explicit transition with a big announcement on the transparent emulation and users expected software from Intel Macs to keep working.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-30 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-05-30 13:40</div>
            <div class="timeline-body"><blockquote>
<p>When applying this, we should make sure that we signal to the user clearly that we prefer x64_86 over aarch64 and how to revert that, both on automatic installation and on uv python list</p>
</blockquote>
<p>As in uv should print messages whenever it detected it was doing this, or a public marketing campaign?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-05-30 13:42</div>
            <div class="timeline-body"><p>Also wanna note, we don&#x27;t really need to land this until we go to update to a PBS that ships arm64 windows builds, so there&#x27;s no rush to land this. I don&#x27;t think we have any reports of users installing system intel and arm64 pythons on windows and getting mad uv isn&#x27;t picking the intel one (but this PR <em>would</em> change that).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-30 15:15</div>
            <div class="timeline-body"><p>We should print a note when uv installs a managed Python interpreter that is not native and not explicitly requested as non-native by the user.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-06-13 17:51</div>
            <div class="timeline-body"><p>Pushed up a fixed impl with the requested diagnostic (zanie wanted a note, not a warning).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-06-13 18:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-python/src/platform.rs</code>:65 on 2025-06-13 18:02</div>
            <div class="timeline-body"><p>It&#x27;s a <em>little</em> weird that we do this by assigning a &quot;wrong&quot; value to <code>native</code>, maybe we should rename to <code>preferred</code>?</p>
<pre><code>        let preferred = if cfg!(all(windows, target_arch = &quot;aarch64&quot;)) {
            Arch {
                family: target_lexicon::Architecture::X86_64,
                variant: None,
            }
        } else {
            // By default, prefer the native architecture (i.e., the one matching the uv binary)
            Arch::from_env()
        };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-06-13 18:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-13 18:05</div>
            <div class="timeline-body"><p>Can we add a test case for this? Like the macOS emulated one? We don&#x27;t run the test suite on arm Windows though, so that&#x27;s kind of annoying. Maybe better as a follow-up, though we could at least write a janky integration test with a bash assertion in CI? Like <code>integration test | uv python on arm windows</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-06-13 18:08</div>
            <div class="timeline-body"><blockquote>
<p>Can we add a test case for this? Like the macOS emulated one? We don&#x27;t run the test suite on arm Windows though, so that&#x27;s kind of annoying. Maybe better as a follow-up, though we could at least write a janky integration test with a bash assertion in CI? Like integration test | uv python on arm windows?</p>
</blockquote>
<p>I was planning to explore testing more when we PR the PBS update that adds windows releases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-13 18:10</div>
            <div class="timeline-body"><p>That makes sense, though I&#x27;d double check we have existing test coverage to ensure this doesn&#x27;t &quot;break&quot; anything (we do have a couple CI jobs covering aarch64 windows)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-06-30 17:43</div>
            <div class="timeline-body"><p>Added a &quot;aarch64 on aarch64 windows&quot; smoketest to go with the &quot;x64 on aarch64&quot; one</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/Gankra">@Gankra</a> on 2025-06-30 21:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-06-30 21:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-30 21:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:52:23 UTC
    </footer>
</body>
</html>
