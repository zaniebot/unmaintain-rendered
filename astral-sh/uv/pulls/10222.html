<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv python install and uninstall now account for the UV_PYTHON env var - astral-sh/uv #10222</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv python install and uninstall now account for the UV_PYTHON env var</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/10222">#10222</a>
        opened by <a href="https://github.com/Choudhry18">@Choudhry18</a>
        on 2024-12-29 23:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Choudhry18">@Choudhry18</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Checks UV_PYTHON for version when <code>uv python install</code> or <code>uv python uninstall </code> ran</p>
<h2>Test Plan</h2>
<p>I added new snapshot tests:
uv/tests/it/python_install::python_install_with_uv_python_env that sets UV_PYTHON to and tests if that version is installed and not the latest. UV_PYTHON=3.12 uv python install would install 3.12 and not the latest version</p>
<p>uv/tests/it/python_install::python_install_with_uv_python_env_and_arg that sets the env variable and the target and tests if the target takes precedence. UV_PYTHON=3.12 uv python install 3.8 would install python 3.8</p>
<h2>Requirement Concern</h2>
<p>The order of precedence on the python install command is : target specified through cli -&gt; environment var UV_PYTHON -&gt; .python-versions if none other specified.</p>
<p>The order of precedence on the python uninstall command is: target specified through cli (required unless UV_PYTHON set) -&gt; environment var UV_PYTHON (required unless target provided in cli). As the --all arg conflicts with target it also conflicts UV_PYTHON env variable</p>
<p>closes #10128</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-12-30 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-01-01 01:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/settings.rs</code>:802 on 2025-01-01 01:38</div>
            <div class="timeline-body"><pre><code class="language-suggestion">    match std::env::var(EnvVars::UV_PYTHON) {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2025-01-01 02:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/python_install.rs</code>:887 on 2025-01-01 02:04</div>
            <div class="timeline-body"><p>Might want to move this to the contexts using .env() instead</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Choudhry18">@Choudhry18</a> reviewed on 2025-01-02 20:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Choudhry18">@Choudhry18</a> on <code>crates/uv/tests/it/python_install.rs</code>:887 on 2025-01-02 20:05</div>
            <div class="timeline-body"><p>Thank you for the review changed to using .env in tests now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @samypr100 by @Choudhry18 on 2025-01-03 10:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @zanieb on 2025-01-23 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.6.0" by @zanieb on 2025-01-23 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-23 23:25</div>
            <div class="timeline-body"><p>Hey @Choudhry18 I fixed some merge conflicts and expanded the test cases.</p>
<p>I have one comment; otherwise this looks good to me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-23 23:25</div>
            <div class="timeline-body"><p>This test failure is problematic — this needs to work still.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-23 23:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-23 23:26</div>
            <div class="timeline-body"><p>I see you mentioned this at</p>
<blockquote>
<p>As the --all arg conflicts with target it also conflicts UV_PYTHON env variable</p>
</blockquote>
<p>We might need to implement this differently to work around this. Perhaps <code>--all</code> should just override the targets?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-23 23:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Choudhry18">@Choudhry18</a> reviewed on 2025-01-28 04:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Choudhry18">@Choudhry18</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-28 04:39</div>
            <div class="timeline-body"><p>I do agree that <code>-all</code> should override targets as I don't see a case where a user would add -all argument without intending to delete all the version. So <code>all</code> should override targets set through argument or environment. Do we need to give the user a warning (I personally don't think it's needed) like:</p>
<blockquote>
<p>Setting targets with -all is redundant and just result in all managed python versions being uninstalled</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-28 06:00</div>
            <div class="timeline-body"><p>Yeah I don't think a warning is needed, it's a weird case but it seems fine to just ignore the target silently unless someone reports a confusing interaction.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-28 06:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-28 06:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-28 06:01</div>
            <div class="timeline-body"><p>Ah are you suggesting that we should remove the conflict entirely and let someone do <code>uv python uninstall foo --all</code>? I think that could be too confusing :/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Choudhry18">@Choudhry18</a> reviewed on 2025-01-28 07:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Choudhry18">@Choudhry18</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-28 07:44</div>
            <div class="timeline-body"><p>yes that is what I had in mind that if <code>--all</code> is set target shouldn't matter . I do agree invalid targets with <code>--all</code> not giving an error can be a bit confusing. Currently <code>uv python uninstall foo -all</code> doesn't really tell the user that their target is invalid it just tells them of the conflict of target with <code>--all</code></p>
<p>So what I understand is you suggest that <code>--all</code> should override target but if it target is invalid it should throw an error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-30 01:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-30 01:02</div>
            <div class="timeline-body"><p>Oh sorry I mean <code>uv python uninstall 3.11 --all</code> would be confusing too — just used <code>foo</code> as a silly example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Choudhry18">@Choudhry18</a> reviewed on 2025-01-30 07:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Choudhry18">@Choudhry18</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-30 07:10</div>
            <div class="timeline-body"><p>oh so you suggest the target set as an argument should behave differently in case of use with <code>--all</code> (throw an error citing a conflict) vs target set through the env variable should be ignored silently. Apologies that took me a minute to understand :/</p>
<p>That makes sense for usage here the only concern I have is are there any other env variable that behave like this in uv. Most of the env variable I have seen they are sort of a replacement for just having to type to argument again and again and behave exactly the same as the cli argument. So this behaving differently might be not be very idiomatic. I also might just be overthinking this one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-01-31 20:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-01-31 20:42</div>
            <div class="timeline-body"><blockquote>
<p>oh so you suggest the target set as an argument should behave differently in case of use with --all (throw an error citing a conflict) vs target set through the env variable should be ignored silently. Apologies that took me a minute to understand :/</p>
</blockquote>
<p>Yeah, that's the suggestion. No problem on the confusion.</p>
<blockquote>
<p>Most of the env variable I have seen they are sort of a replacement for just having to type to argument again and again and behave exactly the same as the cli argument. So this behaving differently might be not be very idiomatic. I also might just be overthinking this one.</p>
</blockquote>
<p>I think it's okay in this case. Though I'm not sure of the implications implementation-wise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Choudhry18">@Choudhry18</a> reviewed on 2025-02-06 07:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Choudhry18">@Choudhry18</a> on <code>crates/uv/tests/it/python_install.rs</code>:1060 on 2025-02-06 07:23</div>
            <div class="timeline-body"><p>I couldn't find a suitable way to implement  it using clap's derive API. My workaround was writing a custom validation check that is ran after the parsing and before the uninstall Settings are resolved. The implementation does get a bit ugly in order to replicate the format of the error message without using the derive API</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @zanieb on 2025-02-08 02:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-13 18:36</div>
            <div class="timeline-body"><p>I found the early-validation a bit awkward (as you noted) and moved it into the implementation.</p>
<p>I'm finding myself a little hesitant about changing the <code>uninstall</code> behavior at all now? I feel like this change would definitely be simpler if we just handled <code>UV_PYTHON</code> on <code>install</code> and left uninstall explicit?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-13 18:51</div>
            <div class="timeline-body"><p>Exploring that in https://github.com/astral-sh/uv/pull/11487</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-02-13 22:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:41:14 UTC
    </footer>
</body>
</html>
