```yaml
number: 4014
title: Fix a bug where no warning is output when parsing of workspace settings fails.
type: pull_request
state: merged
author: Di-Is
labels:
  - preview
assignees: []
merged: true
base: main
head: fix-quiet-workspace-warning
created_at: 2024-06-04T12:45:51Z
updated_at: 2024-07-13T14:05:51Z
url: https://github.com/astral-sh/uv/pull/4014
synced_at: 2026-01-10T13:42:52Z
```

# Fix a bug where no warning is output when parsing of workspace settings fails.

---

_Pull request opened by @Di-Is on 2024-06-04 12:45_

## Summary

See #4013

`uv pip ...` command loads workspace settings from pyproject.toml and uv.toml.

Although a warning is implemented to output a warning when parsing fails, it is not actually output.

https://github.com/astral-sh/uv/blob/main/crates/uv-workspace/src/workspace.rs#L38-L61

The reason is that the flag to display warnings is enabled after loading the workspace settings.

This PR turns on the warning output flag before loading the workspace.

## Test Plan

pyproject.toml for test

```toml
[project]
name = "sample"
version = "0.0.0"
dependencies = ["ruff"]

[tool.uv.pip]
# originally string type.
index-url = 1
```

command output (before modification)
```bash
uv pip compile pyproject.toml 

Resolved 1 package in 383ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml
ruff==0.4.7
    # via sample (pyproject.toml)
```

command output (after modification)

```bash
uv pip compile pyproject.toml

warning: Failed to parse `pyproject.toml`: TOML parse error at line 7, column 13
  |
7 | index-url = true
  |             ^^^^
invalid type: boolean `true`, expected a string

Resolved 1 package in 107ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml
ruff==0.4.7
    # via sample (pyproject.toml)
```

---

_@konstin approved on 2024-06-04 12:47_

Thanks

---

_Review requested from @charliermarsh by @konstin on 2024-06-04 12:47_

---

_Comment by @konstin on 2024-06-04 12:48_

CC @charliermarsh for the changes in cli-warnings handlings.

---

_@charliermarsh reviewed on 2024-06-04 13:21_

We should eventually change this to buffer and then print.

---

_Merged by @charliermarsh on 2024-06-04 13:21_

---

_Closed by @charliermarsh on 2024-06-04 13:21_

---

_Label `preview` added by @charliermarsh on 2024-06-04 13:21_

---

_Branch deleted on 2024-07-13 14:05_

---
