<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>add `excluded-dependencies` support - astral-sh/uv #13618</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>add <code>excluded-dependencies</code> support</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/13618">#13618</a>
        opened by <a href="https://github.com/CodeMan62">@CodeMan62</a>
        on 2025-05-23 14:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CodeMan62">@CodeMan62</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>Fixes #12616
adds support for <code>excluded-dependencies</code></p>
<h2>Test Plan</h2>
<p>a unit test will be added</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @CodeMan62 on 2025-05-23 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @CodeMan62 on 2025-05-26 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-26 19:50</div>
            <div class="timeline-body"><p>For this feature, we need an integration test (under <code>creates/uv/tests</code>), and we need to ensure that commands reading the venv (such as <code>uv sync --check</code> and <code>uv pip list</code>) and commands displaying dependencies (such as <code>uv tree</code>) work correctly and without warnings when dependencies are excluded, both for leaf dependencies and for dependencies with other dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-05-26 20:12</div>
            <div class="timeline-body"><blockquote>
<p>For this feature, we need an integration test (under <code>creates/uv/tests</code>), and we need to ensure that commands reading the venv (such as <code>uv sync --check</code> and <code>uv pip list</code>) and commands displaying dependencies (such as <code>uv tree</code>) work correctly and without warnings when dependencies are excluded, both for leaf dependencies and for dependencies with other dependencies.</p>
</blockquote>
<p>i am adding tests and will do remaining stuff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @zanieb on 2025-05-27 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @CodeMan62 on 2025-06-01 05:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2025-06-01 05:18</div>
            <div class="timeline-body"><!-- __CODSPEED_PERFORMANCE_REPORT_COMMENT__ -->

<!-- __CODSPEED_WALLTIME_PERFORMANCE_REPORT_COMMENT__ -->

<h2><a href="https://codspeed.io/astral-sh/uv/branches/CodeMan62%3Aexcludes-command-add">CodSpeed Walltime Performance Report</a></h2>
<h3>Merging #13618 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>CodeMan62:excludes-command-add</code> (c8991ea) with <code>main</code> (357fc91)</sub></p>
<h3>Summary</h3>
<p><code>✅ 12</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @CodeMan62 on 2025-06-01 08:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-06-01 08:45</div>
            <div class="timeline-body"><p>@konstin everything is done as you told let me know if anything still lefts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-cli/src/lib.rs</code>:1135 on 2025-06-02 08:21</div>
            <div class="timeline-body"><p>The CLI args needs descriptions like the other CLI args have.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/specification.rs</code>:63 on 2025-06-02 08:21</div>
            <div class="timeline-body"><p>type</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-static/src/env_vars.rs</code>:113 on 2025-06-02 08:22</div>
            <div class="timeline-body"><p>This needs a docstring.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-tool/src/tool.rs</code>:273 on 2025-06-02 08:23</div>
            <div class="timeline-body"><p>Why are you using <code>r#excludes</code> or <code>excludes</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:434 on 2025-06-02 08:24</div>
            <div class="timeline-body"><p>Should excludes by using the full PEP 508 syntax, or only package names? What are the pros and cons of having just the name vs. full requirements?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/pip/compile.rs</code>:244 on 2025-06-02 08:24</div>
            <div class="timeline-body"><p>Why does this use an underscore?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/project/lock_target.rs</code>:74 on 2025-06-02 08:25</div>
            <div class="timeline-body"><p>That's not excludes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/pip/operations.rs</code>:112 on 2025-06-02 08:27</div>
            <div class="timeline-body"><p>why does this use an underscore?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/lib.rs</code>:466 on 2025-06-02 08:28</div>
            <div class="timeline-body"><p>These are not overrides</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/src/commands/tool/install.rs</code>:310 on 2025-06-02 08:29</div>
            <div class="timeline-body"><p>We should not allow unnamed excludes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/specification.rs</code>:285 on 2025-06-02 08:30</div>
            <div class="timeline-body"><p>These are not groups</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv/tests/it/lock.rs</code>:1774 on 2025-06-02 08:32</div>
            <div class="timeline-body"><p>The test is failing for me:</p>
<pre><code>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: lock_project_with_excluded_dependencies
Source: crates/uv/tests/it/lock.rs:1791
────────────────────────────────────────────────────────────────────────────────
Expression: snapshot
────────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬───────────────────────────────────────────────────────────────────
    1     1 │ exit_code: 0
    2     2 │ ----- stdout -----
    3     3 │ 
    4     4 │ ----- stderr -----
    5       │-Resolved 5 packages in [TIME]
          5 │+warning: Failed to parse `pyproject.toml` during settings discovery:
          6 │+  TOML parse error at line 9, column 9
          7 │+    |
          8 │+  9 |         excluded-dependencies = [&quot;pytest&quot;]
          9 │+    |         ^^^^^^^^^^^^^^^^^^^^^
         10 │+  unknown field `excluded-dependencies`, expected one of `required-version`, `native-tls`, `offline`, `no-cache`, `cache-dir`, `preview`, `python-preference`, `python-downloads`, `concurrent-downloads`, `concurrent-builds`, `concurrent-installs`, `index`, `index-url`, `extra-index-url`, `no-index`, `find-links`, `index-strategy`, `keyring-provider`, `allow-insecure-host`, `resolution`, `prerelease`, `fork-strategy`, `dependency-metadata`, `config-settings`, `no-build-isolation`, `no-build-isolation-package`, `exclude-newer`, `link-mode`, `compile-bytecode`, `no-sources`, `upgrade`, `upgrade-package`, `reinstall`, `reinstall-package`, `no-build`, `no-build-package`, `no-binary`, `no-binary-package`, `python-install-mirror`, `pypy-install-mirror`, `python-downloads-json-url`, `publish-url`, `trusted-publishing`, `check-url`, `add-bounds`, `pip`, `cache-keys`, `override-dependencies`, `exclude-dependencies`, `constraint-dependencies`, `build-constraint-dependencies`, `environments`, `required-environments`, `conflicts`, `workspace`, `sources`, `managed`, `package`, `default-groups`, `dev-dependencies`, `build-backend`
         11 │+
         12 │+Resolved 11 packages in [TIME]
────────────┴───────────────────────────────────────────────────────────────────
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-06-02 08:33</div>
            <div class="timeline-body"><p>Please ensure that you are using the correct names for variable and in strings, that new items follow the existing docstring conventions and that the tests pass.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:434 on 2025-06-02 15:56</div>
            <div class="timeline-body"><p>I feel like we definitely only want the package name?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-06-02 15:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CodeMan62">@CodeMan62</a> reviewed on 2025-06-02 16:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on <code>crates/uv-workspace/src/pyproject.rs</code>:434 on 2025-06-02 16:17</div>
            <div class="timeline-body"><p>yes we want the package name i will change it here i am reviewing all the reviews once all will be done i will make a final commit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @zanieb on 2025-06-02 18:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CodeMan62">@CodeMan62</a> reviewed on 2025-06-06 03:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on <code>crates/uv-cli/src/lib.rs</code>:1135 on 2025-06-06 03:41</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CodeMan62">@CodeMan62</a> reviewed on 2025-06-06 03:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on <code>crates/uv-requirements/src/specification.rs</code>:285 on 2025-06-06 03:44</div>
            <div class="timeline-body"><p>my mistake but done now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CodeMan62">@CodeMan62</a> reviewed on 2025-06-06 03:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on <code>crates/uv-tool/src/tool.rs</code>:273 on 2025-06-06 03:49</div>
            <div class="timeline-body"><p>because the same things is used in overrides and others ??</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-06-11 17:28</div>
            <div class="timeline-body"><p>I want to say that only something left when the work will be completely done by my end i will request review from team</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-06-15 17:49</div>
            <div class="timeline-body"><p>everything is done by my end but I can't load these conflicts locally can help in that @konstin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-16 10:18</div>
            <div class="timeline-body"><p>To solve them, you need to update your local main branch, then either merge main into your feature branch, or rebase your branch on the main branch. This is unfortunately a complex feature and hard to get right, and it touches a lot of the codebase, so merge conflicts happen easily.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-06-16 17:02</div>
            <div class="timeline-body"><p>Thanks @konstin for this guide i will do it asap and then we will be good to go sorry for late</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-16 17:06</div>
            <div class="timeline-body"><p>How did the scope of this increase from a <code>excluded-dependencies</code> field of package names in the <code>pyproject.toml</code> to <code>--excludes</code> files and environment variables? Was that discussed somewhere I missed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-06-16 17:14</div>
            <div class="timeline-body"><p>NO this was not discussed but is this not worth having it @zanieb ??</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-16 17:18</div>
            <div class="timeline-body"><p>It's not clear to me yet. There aren't obvious use-cases for doing this from files like there are for constraints. I don't think we should increase the scope of the API without clear justification and prior discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-06-16 17:20</div>
            <div class="timeline-body"><p>i think this make sense. now please make it clear what we want here to be implemented</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CodeMan62">@CodeMan62</a> on 2025-06-18 18:47</div>
            <div class="timeline-body"><p>Hey @konstin  as @zanieb  we only want a <code>excluded-dependencies</code> field of package names in the <code>pyproject.toml</code> but this PR have alot more things so i have created another PR please review that one closing this one also one things i wanna say is incase you guys wants to <code>--excludes</code> files and environment variables please create a issue and tag me i will implement that thanks
new PR #14135</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @CodeMan62 on 2025-06-18 18:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:43:17 UTC
    </footer>
</body>
</html>
