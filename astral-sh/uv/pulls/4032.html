<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow discovery of interpereters in virtual environments activated by a shim - astral-sh/uv #4032</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow discovery of interpereters in virtual environments activated by a shim</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/pull/4032">#4032</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-06-05 00:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-05 00:12</div>
            <div class="timeline-body"><p>Closes https://github.com/astral-sh/uv/issues/4009
Closes https://github.com/astral-sh/uv/issues/2109</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-06-05 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-05 00:12</div>
            <div class="timeline-body"><p>Considering if this is the correct approach still. We should also test with the <code>pyenv-virtualenv</code> shim.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-05 00:17</div>
            <div class="timeline-body"><p>I find this implementation awkward as I only want this to be used if it's a virtual environment interpreter but we can't easily enforce that in <code>python_executables</code>. I'll probably poke at a better implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-05 00:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-interpreter/src/discovery.rs</code>:403 on 2024-06-05 00:31</div>
            <div class="timeline-body"><p>No changes to the match statement, just indented</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @zanieb on 2024-06-06 12:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-06 12:42</div>
            <div class="timeline-body"><p>I'd appreciate input on a better approach here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @charliermarsh by @zanieb on 2024-06-06 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-08 18:19</div>
            <div class="timeline-body"><p>Just confirming: still relevant to review? I know there was some back-and-forth on the issue but didn't read it deeply.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-08 18:21</div>
            <div class="timeline-body"><p>@charliermarsh yeah this is still necessary if we want to support detecting virtual environments that are only activated by an executable shim. I'm not in love with the implementation though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-08 20:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-interpreter/src/discovery.rs</code>:232 on 2024-06-08 20:14</div>
            <div class="timeline-body"><p>How do we know this is a shim?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-06-08 20:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-interpreter/src/discovery.rs</code>:396 on 2024-06-08 20:15</div>
            <div class="timeline-body"><p>What is a shim environment that isn't a virtual environment? What would appear here to fail this filter?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-08 21:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-interpreter/src/discovery.rs</code>:232 on 2024-06-08 21:35</div>
            <div class="timeline-body"><p>We don't. We're going to naively say the first executable in the path <em>might</em> be a shim then verify it during the interpreter query portion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-08 21:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-interpreter/src/discovery.rs</code>:396 on 2024-06-08 21:36</div>
            <div class="timeline-body"><p>Since we're just taking the first executable and calling it a &quot;shim environment&quot; in <code>python_executables</code> this filtering is where we check if the executable is <em>actually</em> a shim which invokes inside a virtual environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-06-08 21:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-interpreter/src/discovery.rs</code>:396 on 2024-06-08 21:37</div>
            <div class="timeline-body"><p>(this and the other review comment are my concern with this implementation, it's misleading but we do it to avoid querying the interpreter during <code>python_executables</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @zanieb on 2024-06-10 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-06-11 07:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-02-04 15:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:12 UTC
    </footer>
</body>
</html>
