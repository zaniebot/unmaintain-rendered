<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: allow passing extra config k,v pairs for pyvenv.cfg when creating a venv - astral-sh/uv #1852</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: allow passing extra config k,v pairs for pyvenv.cfg when creating a venv</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/1852">#1852</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2024-02-22 03:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/samypr100">@samypr100</a> on 2024-02-22 03:44</div>
            <div class="timeline-body"><!--
Thank you for contributing to uv! To help us out with reviewing, please consider the following:

- Does this pull request include a summary of the change? (See below.)
- Does this pull request include a descriptive title?
- Does this pull request include references to any relevant issues?
-->

<h2>Summary</h2>
<p>This modifies <code>gourgeist</code> to allow passing additional k,v pairs to add to the <code>pyvenv.cfg</code> file as proposed in #1697.
I made it allow an arbitrary set of pairs (to decouple from <code>uv</code> since this is mainly a change to <code>gourgeist</code>) , but I can slim it down to just allow just a name and version strings if that's desired.</p>
<p>The <code>pyvenv.cfg</code> will also have a <code>uv = &lt;uv-crate-version&gt;</code> when a venv is created via <code>uv venv</code> ~~and <code>uv-build = &lt;uv-build-crate-version&gt;</code> when it's created via <code>SourceBuild::setup</code>~~.</p>
<p>Example below via <code>uv venv</code>:</p>
<pre><code class="language-ini">home = ...
implementation = CPython
version_info = 3.12
include-system-site-packages = false
base-prefix = ...
base-exec-prefix = ...
base-executable = ...
uv = 0.1.6
prompt = uv
</code></pre>
<p>Open to any suggestions, thanks!</p>
<p>Closes #1697</p>
<h2>Test Plan</h2>
<p>Added new test in <code>tests/venv.rs</code> called <code>verify_pyvenv_cfg</code> to verify that it contains the right uv version string. I didn't see tests configured in <code>gourgeist</code> itself, so I didn't add any there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @samypr100 on 2024-02-22 04:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @charliermarsh on 2024-02-22 04:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @zanieb on 2024-02-22 04:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2024-02-22 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/gourgeist/src/bare.rs</code>:236 on 2024-02-22 08:39</div>
            <div class="timeline-body"><p>I think gourgeist should not be visible when used through uv, it's confusing to the user otherwise what that <code>gourgeist</code> thing is</p>
<pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/gourgeist/src/bare.rs</code>:266 on 2024-02-22 08:39</div>
            <div class="timeline-body"><p>I wouldn't should the</p>
<pre><code class="language-suggestion"></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-build/src/lib.rs</code>:332 on 2024-02-22 08:54</div>
            <div class="timeline-body"><p>I'd propose to always pass the uv version in <code>uv</code>, and use <code>uv-build</code> as a binary flag. If a package wants special behaviour for specific uv versions, it can check always check the <code>uv</code> field this way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/gourgeist/src/bare.rs</code>:248 on 2024-02-22 08:57</div>
            <div class="timeline-body"><p>This should not be an io error, can you add a variant to <code>crate::Error</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/gourgeist/src/bare.rs</code>:269 on 2024-02-22 08:57</div>
            <div class="timeline-body"><p>I'd defined our own fields first and then <code>chain()</code> the extra fields after it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/gourgeist/src/bare.rs</code>:264 on 2024-02-22 09:04</div>
            <div class="timeline-body"><p>While your at it, would you mind moving <code>prompt</code> also to this list?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> approved on 2024-02-22 09:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/gourgeist/src/bare.rs</code>:236 on 2024-02-22 13:13</div>
            <div class="timeline-body"><p>Done in 258e4034a7aec9768ce0cee8121fafa3f44bf6b5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/gourgeist/src/bare.rs</code>:266 on 2024-02-22 13:13</div>
            <div class="timeline-body"><p>Done in 258e4034a7aec9768ce0cee8121fafa3f44bf6b5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/gourgeist/src/bare.rs</code>:269 on 2024-02-22 13:13</div>
            <div class="timeline-body"><p>Done in 258e4034a7aec9768ce0cee8121fafa3f44bf6b5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 13:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/gourgeist/src/bare.rs</code>:264 on 2024-02-22 13:13</div>
            <div class="timeline-body"><p>Done in 258e4034a7aec9768ce0cee8121fafa3f44bf6b5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 13:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/gourgeist/src/bare.rs</code>:248 on 2024-02-22 13:15</div>
            <div class="timeline-body"><p>I could add to crate::Error, but return type expects <code>io::Result&lt;VenvPaths&gt;</code> instead of allowing crate::Error. Thoughts? Should the signature change?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 13:27</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-build/src/lib.rs</code>:332 on 2024-02-22 13:27</div>
            <div class="timeline-body"><p>Should I remove this instead to simplify?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 13:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv-build/src/lib.rs</code>:332 on 2024-02-22 13:30</div>
            <div class="timeline-body"><p>I removed meanwhile in 54f6891a7d99554622c5dfb937c22ee6e9b300bb if you think that's better for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-22 13:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/gourgeist/src/bare.rs</code>:248 on 2024-02-22 13:31</div>
            <div class="timeline-body"><p>Yes, it should change to <code>Result&lt;VenvPaths, Error&gt;</code> where <code>Error</code> is <code>crate::Error</code>. We have per-crate enum error types in most of uv which we use when more then one error can be returned from a function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-22 13:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/gourgeist/src/bare.rs</code>:264 on 2024-02-22 13:32</div>
            <div class="timeline-body"><p>thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">virtualenv</span> added by @zanieb on 2024-02-22 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-02-22 16:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/gourgeist/src/bare.rs</code>:248 on 2024-02-22 16:16</div>
            <div class="timeline-body"><p>Done in 64031502338b101f3993e17475c00853a9575562</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-02-22 19:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-build/src/lib.rs</code>:332 on 2024-02-22 19:39</div>
            <div class="timeline-body"><p>Either is fine by me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-02-22 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-02-22 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-22 19:39</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-02-22 19:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-02-22 21:06</div>
            <div class="timeline-body"><p>Shouldnâ€™t <code>gourgeist</code> still be there too? I am checking for that in nox (though not merged yet due to the coverage CI being broken). I can check for either one easily enough.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-22 21:13</div>
            <div class="timeline-body"><p>I think the &quot;API&quot; should be uv with gourgeist being more an implementation detail. What's your use case for checking who created the venv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-02-22 21:44</div>
            <div class="timeline-body"><p>@henryiii  Can you look for <code>uv</code> starting with <code>0.1.9</code> instead? I believe that's what you desired for <code>nox</code> based on your issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-02-22 21:45</div>
            <div class="timeline-body"><p>I can look for either one. I need to know if we need to regenerate the environment if a user changes the provider. This is especially important for uv vs. venv/virtualenv, since we are installing pip into those environments but not uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-02-22 21:48</div>
            <div class="timeline-body"><p>Technically, since it didn't matter before (unless someone switched venv or virtualenv with conda or mamba, which would have been a mess but not something very common), the mechanism is weirdly opt-in via a secret environment variable, but I think I can fix that.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:55:03 UTC
    </footer>
</body>
</html>
