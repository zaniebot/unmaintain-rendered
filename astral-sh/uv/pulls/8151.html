<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chore: unify all env vars used - astral-sh/uv #8151</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>chore: unify all env vars used</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/8151">#8151</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2024-10-12 19:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This PR declares and documents all environment variables that are used in one way or another in <code>uv</code>, either internally, or externally, or transitively under a common struct.</p>
<p>I think over time as uv has grown there's been many environment variables introduced. Its harder to know which ones exists, which ones are missing, what they're used for, or where are they used across the code. The docs only documents a handful of them, for others you'd have to dive into the code and inspect across crates to know which crates they're used on or where they're relevant.</p>
<p>This PR is a starting attempt to unify them, make it easier to discover which ones we have, and maybe unlock future posibilities in automating generating documentation for them.</p>
<p>I think we can split out into multiple structs later to better organize, but given the high influx of PR's and possibly new environment variables introduced/re-used, it would be hard to try to organize them all now into their proper namespaced struct while this is all happening given merge conflicts and/or keeping up to date.</p>
<p>I don't think this has any impact on performance as they all should still be inlined, although it may affect local build times on changes to the environment vars as more crates would likely need a rebuild. Lastly, some of them are declared but not used in the code, for example those in <code>build.rs</code>. I left them declared because I still think it's useful to at least have a reference.</p>
<p>Did I miss any? Are their initial docs cohesive?</p>
<p>Note, <code>uv-static</code> is a terrible name for a new crate, thoughts? Others considered <code>uv-vars</code>, <code>uv-consts</code>.</p>
<h2>Test Plan</h2>
<p>Existing tests</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-10-12 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/lock_scenarios.rs</code>:1 on 2024-10-12 20:07</div>
            <div class="timeline-body"><p>TODO: fix this as it's generated from templates</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-10-12 20:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/src/version.rs</code>:1 on 2024-10-12 20:19</div>
            <div class="timeline-body"><p>This seems to have been replaced by <code>crates/uv-cli/src/version.rs</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @samypr100 on 2024-10-12 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a> reviewed on 2024-10-12 23:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/samypr100">@samypr100</a> on <code>crates/uv/tests/it/lock_scenarios.rs</code>:1 on 2024-10-12 23:20</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-10-12 23:38</div>
            <div class="timeline-body"><p>Unrelated <code>uv-test-publish</code> failing seems to be due to permissions as it requires <code>id-token: write</code>, not much I can do to fix that one ðŸ˜†</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-13 08:16</div>
            <div class="timeline-body"><p>That's on my todo list, the <code>github.repository</code> check to not run this test from forks doesn't work as intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-10-14 01:58</div>
            <div class="timeline-body"><blockquote>
<p>That's on my todo list, the <code>github.repository</code> check to not run this test from forks doesn't work as intended.</p>
</blockquote>
<p>Make sense, I think we could add a <code>github.event.pull_request.head.repo.fork != true</code> check.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-14 14:46</div>
            <div class="timeline-body"><p>This generally seems good to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-14 14:49</div>
            <div class="timeline-body"><p>I'm hyped for this. I'd love to generate the environment variables reference doc from it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @zanieb on 2024-10-14 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-14 15:47</div>
            <div class="timeline-body"><blockquote>
<p>Make sense, I think we could add a github.event.pull_request.head.repo.fork != true check.</p>
</blockquote>
<p>Thanks, fixed in https://github.com/astral-sh/uv/pull/8168</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2024-10-14 21:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2024-10-14 21:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-14 21:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-10-14 22:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:40:04 UTC
    </footer>
</body>
</html>
