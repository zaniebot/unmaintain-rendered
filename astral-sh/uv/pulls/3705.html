<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initial workspace support - astral-sh/uv #3705</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Initial workspace support</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/3705">#3705</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-05-21 17:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/konstin">@konstin</a> on 2024-05-21 17:12</div>
            <div class="timeline-body"><p>Add workspace support when using <code>-r &lt;path&gt;/pyproject.toml</code> or <code>-e &lt;path&gt;</code> in the pip interface. It is limited to all-editable static-metadata workspaces, and tests only include a single main workspace, ignoring path dependencies in another workspace. This can be considered the MVP for workspace support: You can create a workspace, you can install from it, but some options and conveniences are still missing. I'll file follow-up tickets (support in lockfiles, support path deps in other workspace, #3625)</p>
<p>There is also support in <code>uv run</code>, but we need https://github.com/astral-sh/uv/issues/3700 first to properly support using different current projects in the bluejay interface, currently the resolution and therefore the lockfile depends on the current project. I'd do this change first (it's big enough already), then #3700, and then add workspace support properly to bluejay.</p>
<p>Fixes #3404</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-05-22 12:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codspeed-hq[bot]">@codspeed-hq[bot]</a> on 2024-05-22 12:40</div>
            <div class="timeline-body"><h2><a href="https://codspeed.io/astral-sh/uv/branches/konsti/workspaces">CodSpeed Performance Report</a></h2>
<h3>Merging #3705 will <strong>not alter performance</strong></h3>
<p><sub>Comparing <code>konsti/workspaces</code> (273b3f6) with <code>main</code> (89cfece)</sub></p>
<h3>Summary</h3>
<p><code>âœ… 13</code> untouched benchmarks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @konstin on 2024-05-22 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-23 11:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/specification.rs</code>:174 on 2024-05-23 11:52</div>
            <div class="timeline-body"><p>These are mostly async for consistency</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/pyproject.rs</code>:80 on 2024-05-23 23:20</div>
            <div class="timeline-body"><p>Nit: Lets avoid abbreviation (<code>Dep</code> to <code>Dependency</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/pyproject.rs</code>:413 on 2024-05-23 23:20</div>
            <div class="timeline-body"><p>Nit: &quot;reclusive&quot;, should be it be &quot;recursive&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv/tests/workspace.rs</code>:173 on 2024-05-23 23:22</div>
            <div class="timeline-body"><p>Can we just come up with an example that uses fewer, smaller packages? E.g., do we really need boltons, which is almost 200 KB?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/specification.rs</code>:154 on 2024-05-23 23:22</div>
            <div class="timeline-body"><p>Nit: &quot;exiting&quot; should be &quot;existing&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-23 23:23</div>
            <div class="timeline-body"><p>The discovery logic looks good to me. Just a few comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2024-05-24 21:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>crates/uv-requirements/src/workspace.rs</code>:32 on 2024-05-24 21:29</div>
            <div class="timeline-body"><p>I'd prefer <code>DynamicSection</code> or <code>DynamicNotAllowed</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-25 13:26</div>
            <div class="timeline-body"><blockquote>
<p>The workspace tests run fully offline using a directory index, this adds 648KB in the links directory. We could reduce this by switching back to setuptools or using even smaller deps (or just gut the existing ones). Those tests being offline makes them faster, easier to debug (no noise from the network requests) and avoids accidentally pulling a pypi package of the same name.</p>
</blockquote>
<p>@konstin - sorry for going back-and-forth on this, but can we remove all the added links and just install from PyPI? I don't think we should change our test policy in a PR like this -- we pull directly for other tests, so it seems correct here. And checking-in binaries has its own downsides and risks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-27 04:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>scripts/links/tqdm-4.66.4-py3-none-any.whl</code>:1 on 2024-05-27 04:17</div>
            <div class="timeline-body"><p>Is this still necessary?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-27 04:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/pyproject.rs</code>:580 on 2024-05-27 04:18</div>
            <div class="timeline-body"><p>When does this occur? I'm looking at this from the perspective of: what regressions could we ship that would accidentally impact users?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-27 10:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/links/tqdm-4.66.4-py3-none-any.whl</code>:1 on 2024-05-27 10:24</div>
            <div class="timeline-body"><p>Removed it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-27 10:24</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/pyproject.rs</code>:580 on 2024-05-27 10:24</div>
            <div class="timeline-body"><p>This branch is only reachable when using <code>uv.tool.sources</code> (otherwise source is <code>None</code>), so it's preview gated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2024-05-27 15:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-27 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/specification.rs</code>:1 on 2024-05-27 15:07</div>
            <div class="timeline-body"><p>Should all of this logic instead be in <code>source_tree.rs</code>, like in the source tree resolver, instead of defined here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-27 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/pyproject.rs</code>:710 on 2024-05-27 15:07</div>
            <div class="timeline-body"><p>Why unwrap when the method itself already returns <code>Result</code>? Can we be consistent here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-27 15:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/pyproject.rs</code>:580 on 2024-05-27 15:07</div>
            <div class="timeline-body"><p>Can you please expand the TODO?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-requirements/src/specification.rs</code>:1 on 2024-05-27 15:57</div>
            <div class="timeline-body"><p>What parts do you mean? If it's a larger refactoring, i'd do it in another PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2024-05-27 15:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-27 16:41</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/specification.rs</code>:1 on 2024-05-27 16:41</div>
            <div class="timeline-body"><p>I'm wondering if we shouldn't be doing <em>any</em> dependency resolution in <code>specification.rs</code> and, instead, move all requirement collection into <code>source_tree.rs</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2024-05-27 16:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/uv-requirements/src/specification.rs</code>:1 on 2024-05-27 16:42</div>
            <div class="timeline-body"><p>(Not for this PR, I suppose.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @konstin on 2024-05-28 07:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-05-28 07:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2024-05-28 07:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 14:32:38 UTC
    </footer>
</body>
</html>
