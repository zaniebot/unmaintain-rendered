<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Trusted Publishing with pyx - astral-sh/uv #17438</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support Trusted Publishing with pyx</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/pull/17438">#17438</a>
        opened by <a href="https://github.com/woodruffw">@woodruffw</a>
        on 2026-01-13 15:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>~~WIP.~~ This follows #17418 and adds a <code>PyxPublishingService</code> that speaks the pyx-specific APIs for Trusted Publishing.</p>
<p>TODOs:</p>
<ul>
<li>[x] Needs publishing integration tests (see below).</li>
<li>[x] Needs changes to <code>OidcTokenClaims</code> (these are currently GitHub-specific, they need to become an enum over various supported platforms).</li>
</ul>
<h2>Test Plan</h2>
<p>I'll add new publishing integration tests for the following scenarios:</p>
<ul>
<li>[x] Trusted Publishing between GitLab CI/CD &lt;-&gt; PyPI: #17443</li>
<li>[x] Trusted Publishing between GitHub Actions &lt;-&gt; pyx</li>
<li>[x] Trusted Publishing between GitLab CI/CD &lt;-&gt; pyx</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @woodruffw by @woodruffw on 2026-01-13 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2026-01-13 22:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>crates/uv-publish/src/trusted_publishing.rs</code>:88 on 2026-01-13 22:45</div>
            <div class="timeline-body"><p>Flagging: normally I'd consider this an anti-pattern (in terms of untagged enums taking longer to match/producing suboptimal errors on failure), but the context here <em>might</em> make it acceptable:</p>
<ol>
<li>We're in an error path on an already &quot;cold&quot; flow (uploading)</li>
<li>The overwhelming majority of users are probably using GitHub publishers, so serde won't need to backtrack for them</li>
</ol>
<p>OTOH, I could make this explicitly tagged by adding a custom <code>Deserialize</code> that peeks the <code>iss</code> and dispatches based on that. That wouldn't be hard, AFAIK there's just no way to do it with serde's derive APIs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2026-01-15 22:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>scripts/publish/test_publish.py</code>:436 on 2026-01-15 22:38</div>
            <div class="timeline-body"><p>NOTE: I've removed the previous strategy of polling the index for a &quot;fresh&quot; version to test publishing with, in favor of this &quot;timestamp&quot; strategy where we pick a monotonically increasing (but not contiguous) version.</p>
<p>The main advantage of this is that we don't need to block/retry on the index to get a fresh version, i.e. we spend less time doing something unrelated to the main test functionality itself. The downside is that the versions are a little less nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a> reviewed on 2026-01-15 22:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/woodruffw">@woodruffw</a> on <code>scripts/publish/test_publish.py</code>:794 on 2026-01-15 22:38</div>
            <div class="timeline-body"><p>The log volume was a bit extreme (and not helpful), so I've dropped it back down to <code>INFO</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by @woodruffw on 2026-01-16 03:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @zanieb by @woodruffw on 2026-01-16 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @konstin by @woodruffw on 2026-01-16 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">registry</span> added by @woodruffw on 2026-01-16 03:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>scripts/publish/test_publish.py</code>:436 on 2026-01-19 11:05</div>
            <div class="timeline-body"><p>Do we still need the <code>fresh_version_strategy</code> flag? It's not used anymore</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2026-01-19 11:05</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-19 11:22:51 UTC
    </footer>
</body>
</html>
