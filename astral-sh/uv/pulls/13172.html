<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add downloading of GraalPy - astral-sh/uv #13172</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add downloading of GraalPy</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/13172">#13172</a>
        opened by <a href="https://github.com/timfel">@timfel</a>
        on 2025-04-28 09:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>This adds GraalPy download metadata so that <code>uv python install graalpy</code> works. See https://github.com/astral-sh/uv/issues/13114</p>
<h2>Test Plan</h2>
<p>The existing integration test was changed to test this functionality.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:634 on 2025-04-28 09:45</div>
            <div class="timeline-body"><p>These checksum requests are actually sequential, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/j178">@j178</a> reviewed on 2025-04-28 09:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:634 on 2025-04-28 09:52</div>
            <div class="timeline-body"><p>Not sure tbh ðŸ˜… I figured httpx is going to sent off the requests immediately so we get <code>n</code> requests in flight in parellel and then I handle them in batches of <code>n</code> before sending the next <code>n</code> requests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-28 09:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @Gankra by @konstin on 2025-04-28 09:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from @jtfmumm by @konstin on 2025-04-28 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-04-28 09:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>crates/uv-python/src/managed.rs</code>:367 on 2025-04-28 09:58</div>
            <div class="timeline-body"><p>The overall comment is confusing now. I'm interpreting it to mean that the GraalPy executable is always <code>graalpy</code>, and otherwise, if it's Windows, the executable is <code>python.exe</code>. Is that correct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on <code>.github/workflows/ci.yml</code>:1252 on 2025-04-28 10:04</div>
            <div class="timeline-body"><p>This should be <code>--managed-python</code> instead of <code>--python-preference only-managed</code> now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtfmumm">@jtfmumm</a> reviewed on 2025-04-28 10:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-28 10:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>crates/uv-python/src/managed.rs</code>:367 on 2025-04-28 10:51</div>
            <div class="timeline-body"><p>I see the confusin comment, it's <code>graalpy.exe</code>, I'll change the comment</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>.github/workflows/ci.yml</code>:1252 on 2025-04-28 10:52</div>
            <div class="timeline-body"><p>Changed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-28 10:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/j178">@j178</a> reviewed on 2025-04-28 11:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:634 on 2025-04-28 11:33</div>
            <div class="timeline-body"><p>I think in this loop it's sending one request in one iteration, wait for it to finish, and then send the next one. So thatâ€™s sequential.</p>
<p>Instead, we could send requests in parallel using a TaskGroup, just like we did in the CPython example here:
https://github.com/astral-sh/uv/blob/b33a19689c2d39f9bf2bccb37de91b33420906b3/crates/uv-python/fetch-download-metadata.py#L321-L331.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:634 on 2025-04-28 13:14</div>
            <div class="timeline-body"><p>I went with asyncio.gather because it's much shorter - let me know if this is ok:
https://github.com/astral-sh/uv/pull/13172/files#diff-067e233b291998aa086f6fdd3ea4015249604942bd5a18f11252ddce0e5a7dafR632</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-28 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-python/src/managed.rs</code>:365 on 2025-04-28 13:32</div>
            <div class="timeline-body"><p>empty string?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-python/src/managed.rs</code>:372 on 2025-04-28 13:33</div>
            <div class="timeline-body"><p>more empty string?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>.github/workflows/ci.yml</code>:1182 on 2025-04-28 13:36</div>
            <div class="timeline-body"><p>do we want to <em>stop</em> testing not-uv-managed graalpy's? (genuine question)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-04-28 13:37</div>
            <div class="timeline-body"><p>This all <em>looks</em> right to me using the pypy implementation for comparison.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> reviewed on 2025-04-28 13:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/zanieb">@zanieb</a> on <code>.github/workflows/ci.yml</code>:1182 on 2025-04-28 13:44</div>
            <div class="timeline-body"><p>Definitely not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-28 13:45</div>
            <div class="timeline-body"><p>Thanks for contributing!</p>
<p>I'm a <em>little</em> hesitant to add GraalPy download support. We'd have to maintain it in perpetuity, and haven't really gotten asked for it by a significant number of users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-28 13:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>crates/uv-python/src/managed.rs</code>:365 on 2025-04-28 13:53</div>
            <div class="timeline-body"><p>Yes, GraalPy does not encode a version in the executable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-28 13:54</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>crates/uv-python/src/managed.rs</code>:372 on 2025-04-28 13:54</div>
            <div class="timeline-body"><p>Yes, GraalPy has neither variants nor a <code>w</code> suffix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>.github/workflows/ci.yml</code>:1182 on 2025-04-28 14:00</div>
            <div class="timeline-body"><p>ah, ok, I looked at how it's done for PyPy and adapted this test to that one. But I now see there's a <code>system-test-pypy</code>, I copied that one to <code>system-test-graalpy</code> to check that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-28 14:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timfel">@timfel</a> on 2025-04-28 14:01</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for contributing!</p>
<p>I'm a <em>little</em> hesitant to add GraalPy download support. We'd have to maintain it in perpetuity, and haven't really gotten asked for it by a significant number of users.</p>
</blockquote>
<p>I only saw https://github.com/astral-sh/uv/issues/13114 this morning and thought it'd be a good project to procrastinate on. No hard feelings if you want to reject it :-)</p>
<p>(Although tbh, and not sure if a pro or a con, but I don't see PyPy having much activity compared to GraalPy either)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paugier">@paugier</a> on 2025-04-28 19:50</div>
            <div class="timeline-body"><p>Thanks a lot @timfel!</p>
<p>@zanieb GraalPy is really a great and young project and its usage should increased, especially if it can be easily installed with UV. Moreover, it would increase consistency of UV since PyPy and GraalPy are similar projects in terms of popularity and potential :slightly_smiling_face:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-28 20:03</div>
            <div class="timeline-body"><p>@timfel you're <em>on</em> the GraalPy team right?</p>
<p>At least in my books this kind of thing is easier to stomach when the developers of the runtime are explicitly providing the support for it. Like we don't need to worry about y'all breaking this logic for fetching releases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timfel">@timfel</a> on 2025-04-28 20:38</div>
            <div class="timeline-body"><blockquote>
<p>@timfel you're <em>on</em> the GraalPy team right?</p>
</blockquote>
<p>Yes, I'm on the GraalPy team. We would make sure that this keeps working (we're running tests for uv, virtualenv, tox and more packages already in our own CI as well to catch any problems early). And if you need us to change things down the line we'd be happy to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2025-04-30 02:35</div>
            <div class="timeline-body"><p>cibuildwheel 3.0 will add GraalPy support, by the way. Maybe it will be a bit more common once it's easier to build wheels for. Though that was the argument for pypy, too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/j178">@j178</a> reviewed on 2025-04-30 03:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/j178">@j178</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:576 on 2025-04-30 03:04</div>
            <div class="timeline-body"><p>By default, this pulls in just one page of releases, which is 30 items. Does it make sense to only keep the latest 30 releases for Graalpy?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-04-30 12:26</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:576 on 2025-04-30 12:26</div>
            <div class="timeline-body"><p>Yes, GraalPy releases 2 major and 4 patch releases a year, and our support window is only 2 years so we will not support many releases back anyway, picking up 30 releases is plenty I'd say.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2025-04-30 12:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:576 on 2025-04-30 12:56</div>
            <div class="timeline-body"><p>Can you add an inline comment about that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-30 19:55</div>
            <div class="timeline-body"><p>(download-metadata-minified.json is now deleted so you can remove the changes made to it in this PR)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/timfel">@timfel</a> on <code>crates/uv-python/fetch-download-metadata.py</code>:576 on 2025-05-05 06:29</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timfel">@timfel</a> reviewed on 2025-05-05 06:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-05-06 16:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-05-06 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-05-06 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-05-07 10:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:43:02 UTC
    </footer>
</body>
</html>
