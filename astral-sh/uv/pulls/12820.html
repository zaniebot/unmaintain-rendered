<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Split UV_INDEX on all whitespace - astral-sh/uv #12820</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Split UV_INDEX on all whitespace</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/12820">#12820</a>
        opened by <a href="https://github.com/winstonallo">@winstonallo</a>
        on 2025-04-10 18:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/winstonallo">@winstonallo</a></div>
            <div class="timeline-body">Summary
<p>Closes #12806</p>
<p>Split <code>UV_INDEX</code> by any whitespace rather than only ASCII 32, which does not align with the behavior of <code>PIP_EXTRA_INDEX_URL</code> and can possibly lead to difficulties when migrating from pip to uv.</p>
<p>Clap unfortunately does not support passing multiple delimiters, writing a custom parsing function involved parsing index into a Vec&lt;Vec&gt; and flattening it afterwards in order to avoid breaking the --index command line option.</p>
<p>There might be a prettier solution I overlooked, let me know if there is anything I should change!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> approved on 2025-04-10 19:30</div>
            <div class="timeline-body"><p>Could you add a test that&#x27;s a copy of repeated_index_cli that tests the new whitespace support?</p>
<p>https://github.com/astral-sh/uv/blob/7a18e4429d6750365c2f2ad98907a90d97e67fb7/crates/uv/tests/it/edit.rs#L9948-L9956</p>
<p>(see <code>repeated_index_cli_environment_variable</code> for an example of how to set env vars in invocations -- note that it uses UV_DEFAULT_INDEX and you want UV_INDEX)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-04-10 19:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-cli/src/lib.rs</code>:929 on 2025-04-10 19:32</div>
            <div class="timeline-body"><p>Oops this looks like a mistake</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-04-10 19:35</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-cli/src/lib.rs</code>:910 on 2025-04-10 19:35</div>
            <div class="timeline-body"><p>Might be nice to add some more context here to note that this function exists because clap value_delimiter only lets you split on a single character, and we need to split on all whitespace (notably spaces OR newlines).</p>
<p>And also that the --index arguments have to have a <code>Vec&lt;Vec&lt;Maybe&lt;Index&gt;&gt;&gt;</code> because when clap parses an environment variable with <code>value_parser</code> it expects to only parse one value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/winstonallo">@winstonallo</a> reviewed on 2025-04-10 20:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/winstonallo">@winstonallo</a> on <code>crates/uv-cli/src/lib.rs</code>:929 on 2025-04-10 20:00</div>
            <div class="timeline-body"><p>Yes haha, fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/winstonallo">@winstonallo</a> on 2025-04-10 20:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-04-10 20:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-cli/src/lib.rs</code>:4910 on 2025-04-10 20:07</div>
            <div class="timeline-body"><pre><code>    // 
    // The nested Vec structure (`Vec&lt;Vec&lt;Maybe&lt;Index&gt;&gt;&gt;`) is required for clap&#x27;s
    // value parsing mechanism, which processes one value at a time, in order to handle 
    // `UV_INDEX` the same way pip handles `PIP_EXTRA_INDEX_URL`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gankra">@Gankra</a> reviewed on 2025-04-10 20:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gankra">@Gankra</a> on <code>crates/uv-cli/src/lib.rs</code>:4910 on 2025-04-10 20:08</div>
            <div class="timeline-body"><p>(This kind of detail shouldn&#x27;t be part of <code>--help</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 20:22</div>
            <div class="timeline-body"><p>Thanks for the quick ~~and evil~~ fix!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winstonallo">@winstonallo</a> on 2025-04-10 20:22</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for the quick ~and evil~ fix!</p>
</blockquote>
<p>Thank you for your quick feedback :))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-06-27 09:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:51:42 UTC
    </footer>
</body>
</html>
