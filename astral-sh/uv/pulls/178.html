<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unify python interpreter abstractions - astral-sh/uv #178</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unify python interpreter abstractions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/astral-sh/uv/pull/178">#178</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-10-24 15:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Previously, we had two python interpreter metadata structs, one in gourgeist and one in puffin. Both would spawn a subprocess to query overlapping metadata and both would appear in the cli crate, if you weren't careful you could even have to different base interpreters at once. This change unifies this to one set of metadata, queried and cached once.</p>
<p>Another effect of this crate is proper separation of python interpreter and venv. A base interpreter (such as <code>/usr/bin/python/</code>, but also pyenv and conda installed python) has a set of metadata. A venv has a root and inherits the base python metadata except for <code>sys.prefix</code>, which unlike <code>sys.base_prefix</code>, gets set to the venv root. From the root and the interpreter info we can compute the paths inside the venv. We can reuse the interpreter info of the base interpreter when creating a venv without having to query the newly created <code>python</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-10-24 15:46</div>
            <div class="timeline-body"><p>Current dependencies on/for this PR:</p>
<ul>
<li>main<ul>
<li><strong>PR #154</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/puffin/154" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #138</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/puffin/138" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a><ul>
<li><strong>PR #178</strong> <a href="https://app.graphite.dev/github/pr/astral-sh/puffin/178" target="_blank"><img src="https://static.graphite.dev/graphite-32x32-black.png" alt="Graphite" width="10px" height="10px"/></a>  ðŸ‘ˆ</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This comment was auto-generated by <a href="https://app.graphite.dev/github/pr/astral-sh/puffin/178?utm_source=stack-comment">Graphite</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-interpreter/src/get_interpreter_info.py</code>:1 on 2023-10-24 15:47</div>
            <div class="timeline-body"><p>I prefer having these as external scripts to get interpreter and tooling support on them</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-interpreter/src/interpreter_info.rs</code>:99 on 2023-10-24 15:47</div>
            <div class="timeline-body"><p>This function is mainly copied from gourgeist which had more comprehensive error handling</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>crates/puffin-interpreter/src/virtual_env.rs</code>:13 on 2023-10-24 15:47</div>
            <div class="timeline-body"><p>We can also rename this <code>Virtualenv</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/konstin">@konstin</a> on <code>ruff.toml</code>:4 on 2023-10-24 15:48</div>
            <div class="timeline-body"><p>Time to use the formatter ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a> reviewed on 2023-10-24 15:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>crates/puffin-interpreter/src/virtual_env.rs</code>:13 on 2023-10-25 04:03</div>
            <div class="timeline-body"><p>Let's do <code>Virtualenv</code>, sounds good to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-25 04:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> reviewed on 2023-10-25 04:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on <code>ruff.toml</code>:4 on 2023-10-25 04:03</div>
            <div class="timeline-body"><p>Gasp</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a> approved on 2023-10-25 04:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @charliermarsh on 2023-10-25 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-10-25 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2023-10-25 20:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:34:34 UTC
    </footer>
</body>
</html>
