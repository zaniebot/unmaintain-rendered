---
number: 6412
title: "`uv pip compile --universal` resolves to wrong `python_full_version` specifier on `python3.8`"
type: issue
state: closed
author: ungrichtepfl
labels:
  - bug
  - resolver
assignees: []
created_at: 2024-08-22T06:59:22Z
updated_at: 2024-09-03T22:41:17Z
url: https://github.com/astral-sh/uv/issues/6412
synced_at: 2026-01-10T01:24:00Z
---

# `uv pip compile --universal` resolves to wrong `python_full_version` specifier on `python3.8`

---

_Issue opened by @ungrichtepfl on 2024-08-22 06:59_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

Happens with uv version `0.3.1` on a `Ubuntu 20.04.6 LTS x86_64` machine.

Steps to reproduce.
1. Create a python3.8 virtualenv
```shell
python3.8 -m venv venv
```
2. Create `requirements.in`  
```
coverage[toml]
pandas
matplotlib
```
3. Run uv pip compile **in the virtualenv**:
```shell
uv pip compile --universal -o requirements.txt requirements.in
```
4. This generates:
```
# This file was autogenerated by uv via the following command:
#    uv pip compile --universal -o requirements-py38.txt requirements.in
contourpy==1.1.1
    # via matplotlib
coverage==7.6.1
    # via -r requirements.in
cycler==0.12.1
    # via matplotlib
fonttools==4.53.1
    # via matplotlib
importlib-resources==6.4.4 ; python_full_version < '3.10'
    # via matplotlib
kiwisolver==1.4.5
    # via matplotlib
matplotlib==3.7.5
    # via -r requirements.in
numpy==1.24.4 ; python_full_version < '3.12'
    # via
    #   contourpy
    #   matplotlib
    #   pandas
numpy==1.26.4 ; python_full_version >= '3.12'
    # via
    #   contourpy
    #   matplotlib
    #   pandas
packaging==24.1
    # via matplotlib
pandas==2.0.3
    # via -r requirements.in
pillow==10.4.0
    # via matplotlib
pyparsing==3.1.2
    # via matplotlib
python-dateutil==2.9.0.post0
    # via
    #   matplotlib
    #   pandas
pytz==2024.1
    # via pandas
six==1.16.0
    # via python-dateutil
tomli==2.0.1 ; python_full_version == '3.11'
    # via coverage
tzdata==2024.1
    # via pandas
zipp==3.20.0 ; python_full_version < '3.10'
    # via importlib-resources
```
For which the third to last entry (`tomli`) is wrong: 
```
tomli==2.0.1 ; python_full_version == '3.11'
    # via coverage
```
 `converage` needs tomli for python < 3.11.

Running the same uv binary in a **python3.9** virtualenv however, generates the correct python specifier:
```
# This file was autogenerated by uv via the following command:
#    uv pip compile --universal -o requirements-py39.txt requirements.in
contourpy==1.2.1
    # via matplotlib
coverage==7.6.1
    # via -r requirements.in
cycler==0.12.1
    # via matplotlib
fonttools==4.53.1
    # via matplotlib
importlib-resources==6.4.4 ; python_full_version < '3.10'
    # via matplotlib
kiwisolver==1.4.5
    # via matplotlib
matplotlib==3.9.2
    # via -r requirements.in
numpy==2.0.1
    # via
    #   contourpy
    #   matplotlib
    #   pandas
packaging==24.1
    # via matplotlib
pandas==2.2.2
    # via -r requirements.in
pillow==10.4.0
    # via matplotlib
pyparsing==3.1.2
    # via matplotlib
python-dateutil==2.9.0.post0
    # via
    #   matplotlib
    #   pandas
pytz==2024.1
    # via pandas
six==1.16.0
    # via python-dateutil
tomli==2.0.1 ; python_full_version <= '3.11'
    # via coverage
tzdata==2024.1
    # via pandas
zipp==3.20.0 ; python_full_version < '3.10'
    # via importlib-resources
```

Also, running it without the `--universal` flag generates a correct requirements.txt:
```
# This file was autogenerated by uv via the following command:
#    uv pip compile -o requirements.txt requirements.in
contourpy==1.1.1
    # via matplotlib
coverage==7.6.1
    # via -r requirements.in
cycler==0.12.1
    # via matplotlib
fonttools==4.53.1
    # via matplotlib
importlib-resources==6.4.4
    # via matplotlib
kiwisolver==1.4.5
    # via matplotlib
matplotlib==3.7.5
    # via -r requirements.in
numpy==1.24.4
    # via
    #   contourpy
    #   matplotlib
    #   pandas
packaging==24.1
    # via matplotlib
pandas==2.0.3
    # via -r requirements.in
pillow==10.4.0
    # via matplotlib
pyparsing==3.1.2
    # via matplotlib
python-dateutil==2.9.0.post0
    # via
    #   matplotlib
    #   pandas
pytz==2024.1
    # via pandas
six==1.16.0
    # via python-dateutil
tomli==2.0.1
    # via coverage
tzdata==2024.1
    # via pandas
zipp==3.20.0
    # via importlib-resources
```

This may be related to https://github.com/astral-sh/uv/issues/6269.


---

_Label `bug` added by @charliermarsh on 2024-08-22 12:28_

---

_Label `resolver` added by @charliermarsh on 2024-08-22 12:28_

---

_Comment by @charliermarsh on 2024-08-22 12:45_

Ok, I've confirmed this is fixed by https://github.com/astral-sh/uv/pull/6268 -- sorry about that!

---

_Comment by @charliermarsh on 2024-08-22 12:45_

\cc @BurntSushi 

---

_Assigned to @BurntSushi by @BurntSushi on 2024-08-22 15:18_

---

_Referenced in [astral-sh/uv#6268](../../astral-sh/uv/pulls/6268.md) on 2024-08-30 11:56_

---

_Closed by @BurntSushi on 2024-09-03 22:41_

---

_Closed by @BurntSushi on 2024-09-03 22:41_

---
