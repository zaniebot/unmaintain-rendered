<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>python broken in venv when uv project is on fusefs mount point - astral-sh/uv #15528</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>python broken in venv when uv project is on fusefs mount point</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15528">#15528</a>
        opened by <a href="https://github.com/mbeijen">@mbeijen</a>
        on 2025-08-26 12:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mbeijen">@mbeijen</a> on 2025-08-26 12:31</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I wanted to mount my project directory in a VM over fuse.sshfs. When I ran 'uv sync' inside the VM, <code>uv</code> tried to download python and symlink it into the venv on the fuse mount, which failed and resulted in a broken <code>python</code>. Even if I use <code>--link-mode copy</code> this does not result in a working system.</p>
<h2>how to reproduce</h2>
<p>use <code>uv</code> on my host laptop to create a new project:</p>
<pre><code>uv init --app --python=3.13 multi-issue</code></pre>
<p>create VM using multipass, mount the project directory in it, install uv and use it to sync</p>
<pre><code>multipass launch 24.04 --name multivm
multipass mount $PWD/multi-issue multivm:/home/ubuntu/multi-issue
multipass shell multivm
# inside VM
curl -LsSf https://astral.sh/uv/install.sh | sh
cd multi-issue/
~/.local/bin/uv sync </code></pre>
<p>at this point, there is a <code>.venv</code> in my project, but <code>.venv/bin/python</code> is owned by nobody and is not a file and I can't execute it:</p>
<pre><code>ubuntu@multivm:~/multi-issue$ ls -altrh .venv/bin/
ls: cannot read symbolic link '.venv/bin/python3.13': Permission denied
ls: cannot read symbolic link '.venv/bin/python3': Permission denied
ls: cannot read symbolic link '.venv/bin/python': Permission denied
total 64K
lrwxrwxrwx 1 nobody nogroup    6 Aug 26 14:21 python3.13
lrwxrwxrwx 1 nobody nogroup    6 Aug 26 14:21 python3
lrwxrwxrwx 1 nobody nogroup   82 Aug 26 14:21 python
-rw-r--r-- 1 ubuntu ubuntu  1.2K Aug 26 14:21 pydoc.bat
-rw-r--r-- 1 ubuntu ubuntu  1.7K Aug 26 14:21 deactivate.bat
-rw-r--r-- 1 ubuntu ubuntu  2.4K Aug 26 14:21 activate_this.py
-rw-r--r-- 1 ubuntu ubuntu  2.8K Aug 26 14:21 activate.ps1
-rw-r--r-- 1 ubuntu ubuntu  3.8K Aug 26 14:21 activate.nu
-rw-r--r-- 1 ubuntu ubuntu  4.2K Aug 26 14:21 activate.fish
-rw-r--r-- 1 ubuntu ubuntu  2.6K Aug 26 14:21 activate.csh
-rw-r--r-- 1 ubuntu ubuntu  2.7K Aug 26 14:21 activate.bat
-rw-r--r-- 1 ubuntu ubuntu  4.1K Aug 26 14:21 activate
drwxrwxr-x 1 ubuntu ubuntu     9 Aug 26 14:21 ..
drwxrwxr-x 1 ubuntu ubuntu    14 Aug 26 14:21 .
</code></pre>
<p>error message when trying to start python:</p>
<pre><code>ubuntu@multivm:~/multi-issue$ ~/.local/bin/uv run python
error: Failed to query Python interpreter
  Caused by: failed to canonicalize path `/home/ubuntu/multi-issue/.venv/bin/python3`: Permission denied (os error 13)
</code></pre>
<p>this is the 'verbose' log of running <code>uv sync</code>:</p>
<pre><code>ubuntu@multivm:~/multi-issue$ ~/.local/bin/uv sync --verbose
DEBUG uv 0.8.13
DEBUG Found project root: `/home/ubuntu/multi-issue`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/home/ubuntu/multi-issue`
DEBUG Reading Python requests from version file at `/home/ubuntu/multi-issue/.python-version`
DEBUG Using Python request `3.13` from version file at `.python-version`
DEBUG Checking for Python environment at: `.venv`
DEBUG Searching for Python 3.13 in managed installations or search path
DEBUG Searching for managed installations at `/home/ubuntu/.local/share/uv/python`
DEBUG Found `cpython-3.12.3-linux-x86_64-gnu` at `/usr/bin/python3` (first executable in the search path)
DEBUG Skipping interpreter at `/usr/bin/python3` from first executable in the search path: does not satisfy request `3.13`
DEBUG Acquired lock for `/home/ubuntu/.local/share/uv/python`
DEBUG Using request timeout of 30s
INFO Fetching requested Python...
DEBUG Downloading https://github.com/astral-sh/python-build-standalone/releases/download/20250818/cpython-3.13.7%2B20250818-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz
DEBUG Extracting cpython-3.13.7-20250818-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz to temporary location: /home/ubuntu/.local/share/uv/python/.temp/.tmp8A0AtX
Downloading cpython-3.13.7-linux-x86_64-gnu (download) (30.9MiB)
 Downloading cpython-3.13.7-linux-x86_64-gnu (download)
DEBUG Moving /home/ubuntu/.local/share/uv/python/.temp/.tmp8A0AtX/python to /home/ubuntu/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu
DEBUG Released lock at `/home/ubuntu/.local/share/uv/python/.lock`
Using CPython 3.13.7
Creating virtual environment at: .venv
DEBUG Assessing Python executable as base candidate: /home/ubuntu/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu/bin/python3.13
DEBUG Using base executable for virtual environment: /home/ubuntu/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu/bin/python3.13
DEBUG Released lock at `/tmp/uv-3d389f599a27af0b.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: multi-issue @ file:///home/ubuntu/multi-issue
DEBUG No workspace root found, using project root
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: &gt;=3.13
DEBUG Adding direct dependency: multi-issue*
DEBUG Searching for a compatible version of multi-issue @ file:///home/ubuntu/multi-issue (*)
DEBUG Tried 1 versions: multi-issue 1
DEBUG all marker environments resolution took 0.000s
Resolved 1 package in 2ms
DEBUG Using request timeout of 30s
Audited in 0.00ms
DEBUG Released lock at `/home/ubuntu/multi-issue/.venv/.lock`
</code></pre>
<p>If I copy the <code>pyproject.toml</code> to a different location in my vm, (i.e. not on the fuse mount) and run <code>uv sync</code> everything works just fine.</p>
<h3>Expected behaviour</h3>
<p>I would have expected <code>uv</code> to be able to create a working setup, or at least that using <code>--link-mode copy</code> would copy the interpreter, and result in a working system.</p>
<h3>Platform</h3>
<p>Ubuntu 24.04 LTS (Linux 6.14.0-28-generic x86_64 GNU/Linux)</p>
<h3>Version</h3>
<p>uv 0.8.13</p>
<h3>Python version</h3>
<p>Python 3.13.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mbeijen on 2025-08-26 12:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-26 13:00</div>
            <div class="timeline-body"><p>To clarify: the link mode is used for package installs, the Python interpreter is not copied into virtual environments on Unix.  What you'd need is for the entire Python installation to be copied into the virtual environment at which point it's no longer really a virtual environment.</p>
<p>You should skip mounting the virtual environment, e.g., as described in https://docs.astral.sh/uv/guides/integration/docker/#developing-in-a-container</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-08-26 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-08-26 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mbeijen">@mbeijen</a> on 2025-08-26 13:22</div>
            <div class="timeline-body"><p>I understand a local <code>.venv</code> on the host would potentially be invalid inside the guest. However in this case I did not create a <code>.venv</code> on the host environment. It did not exist before. I created it inside the guest, indeed it's on a fusefs filesystem.</p>
<p>I would have expected that <code>uv</code> would be able to copy python into its created <code>.venv</code> in this case, and not to create these files owned by <code>nobody</code>.</p>
<p>(also, it's not possible to mount the project file while <em>excluding</em> <code>.venv</code> in multipass... of course that is not <code>uv</code>s fault.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-26 13:49</div>
            <div class="timeline-body"><p>I see. I think you need to set the <code>UV_PYTHON_INSTALL_DIR</code> to be inside your fusefs too.</p>
<p>It's interesting it lets us construct the symlinks but not read them later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mbeijen">@mbeijen</a> on 2025-08-26 14:28</div>
            <div class="timeline-body"><blockquote>
<p>I see. I think you need to set the <code>UV_PYTHON_INSTALL_DIR</code> to be inside your fusefs too.</p>
</blockquote>
<p>Even if I set <code>UV_PYTHON_INSTALL_DIR</code>, which definitely causes my python to be stored on the fusefs, uv still fails:</p>
<pre><code>ubuntu@multivm:~$ export UV_PYTHON_INSTALL_DIR=/home/ubuntu/multi-issue/.python
ubuntu@multivm:~$ cd multi-issue/
ubuntu@multivm2:~/multi-issue$ uv sync
Using CPython 3.13.7
Creating virtual environment at: .venv
Resolved 1 package in 4ms
Audited in 0.00ms
</code></pre>
<p>the python interpreter is inside my fuse mount and ~~looks just fine~~ the symlinks there already have a problem:</p>
<pre><code>ubuntu@multivm:~/multi-issue$ ls -altrh .python/cpython-3.13.7-linux-x86_64-gnu/bin/
total 29M
lrwxrwxrwx 1 nobody nogroup   17 Aug 26 16:25 python3-config -&gt; python3.13-config
lrwxrwxrwx 1 nobody nogroup   10 Aug 26 16:25 python3 -&gt; python3.13
lrwxrwxrwx 1 nobody nogroup   10 Aug 26 16:25 python -&gt; python3.13
-rwxr-xr-x 1 ubuntu ubuntu   141 Aug 26 16:25 pydoc3.13
lrwxrwxrwx 1 nobody nogroup    9 Aug 26 16:25 pydoc3 -&gt; pydoc3.13
-rwxr-xr-x 1 ubuntu ubuntu   286 Aug 26 16:25 pip3.13
-rwxr-xr-x 1 ubuntu ubuntu   286 Aug 26 16:25 pip3
-rwxr-xr-x 1 ubuntu ubuntu   286 Aug 26 16:25 pip
-rwxr-xr-x 1 ubuntu ubuntu   156 Aug 26 16:25 idle3.13
lrwxrwxrwx 1 nobody nogroup    8 Aug 26 16:25 idle3 -&gt; idle3.13
-rwxr-xr-x 1 ubuntu ubuntu  3.2K Aug 26 16:25 python3.13-config
-rwxr-xr-x 1 ubuntu ubuntu   29M Aug 26 16:25 python3.13
drwxrwxr-x 1 ubuntu ubuntu    14 Aug 26 16:25 .
drwxrwxr-x 1 ubuntu ubuntu     6 Aug 26 16:25 ..
</code></pre>
<p>And apparently this is a feature of sshfs. I was able to resolve my issues by switching to a different mount type:</p>
<pre><code>multipass mount --type=native $PWD/multi-issue multivm:/home/ubuntu/multi-issue</code></pre>
<blockquote>
<p>It's interesting it lets us construct the symlinks but not read them later.</p>
</blockquote>
<p>Yeah, that's right ðŸ™ƒ</p>
<p>Also, I'm not sure at this point if I'd expect anything from uv -- I guess it's not really possible to do anything about this, on linux file systems its notoriously difficult to understand if they properly support symlinks afaik</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:11 UTC
    </footer>
</body>
</html>
