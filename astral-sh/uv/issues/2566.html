<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP status client error (401 Unauthorized) / (403 Forbidden) for packages hosted on a JFrog PyPI repo - astral-sh/uv #2566</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>HTTP status client error (401 Unauthorized) / (403 Forbidden) for packages hosted on a JFrog PyPI repo</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2566">#2566</a>
        opened by <a href="https://github.com/ealap">@ealap</a>
        on 2024-03-20 15:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ealap">@ealap</a> on 2024-03-20 15:13</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Similar to an issue reported at #2444, the authentication fails when trying to install packages from extra index URL pointing to a JFrog PyPI repo</p>
<pre><code class="language-shell">export UV_EXTRA_INDEX_URL=&quot;https://&lt;JFROG_USERNAME&gt;:&lt;JFROG_ACCESS_TOKEN&gt;@&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/simple&quot;
uv pip install --verbose --compile --no-cache --requirement=&quot;requirements.txt&quot; --override=&quot;override.txt&quot;

# Output
# A bunch logs like these
DEBUG No cache entry for: https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/packages/xxx/xxx/packageAAA-1.0.0.whl#sha256=xxx
DEBUG Adding authentication to already-seen URL: https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/packages/xxx/xxx/packageAAA-1.0.0.whl#sha256=xxx

# then finally 403 error
error: Failed to download: packageBBB==31.4.0
  Caused by: HTTP status client error (403 Forbidden) for url (https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/packages/xxx/xxx/packageBBB==31.4.0.whl#sha256=xxx)

# sometimes 401 error
error: Failed to download: packageCCC==2.3.0
  Caused by: HTTP status client error (401 Unauthorized) for url (https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/packages/xxx/xxx/packageCCC==2.3.0.whl#sha256=xxx)
</code></pre>
<p>uv versions where it doesn't work:</p>
<pre><code class="language-shell">uv==0.1.19
uv==0.1.22 # current latest at the time of this issue
</code></pre>
<p>The issue was fixed by on v0.1.20 likely because it has the same root cause as #2444 that was fixed by #2446). But it got broken again on v0.1.22 likely due to #2449.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-03-20 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">registry</span> added by @zanieb on 2024-03-20 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-03-20 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-21 04:24</div>
            <div class="timeline-body"><p>Can you confirm that the <code>JFROG_ARTIFACTORY_URL</code> part of the URL is consistent?</p>
<p>Are there logs like <code>No credentials found for: ...</code> and <code>Request already has an authorization header: ...</code>? Do you think you can share the full logs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ealap">@ealap</a> on 2024-03-21 10:18</div>
            <div class="timeline-body"><p>Yes, <code>JFROG_ARTIFACTORY_URL</code> is the same for all packages.</p>
<details>

<summary>Here's the install log (with redacted info)</summary>

<pre><code>DEBUG Found a virtualenv through VIRTUAL_ENV at: /home/ealap/.cache/pypoetry/virtualenvs/sample-project-L4q7N5gd-py3.10
DEBUG Probing interpreter info for: /home/ealap/.cache/pypoetry/virtualenvs/sample-project-L4q7N5gd-py3.10/bin/python
DEBUG Found Python 3.10.13 for: /home/ealap/.cache/pypoetry/virtualenvs/sample-project-L4q7N5gd-py3.10/bin/python
DEBUG Using Python 3.10.13 environment at [36m/home/ealap/.cache/pypoetry/virtualenvs/sample-project-L4q7N5gd-py3.10/bin/python[39m
DEBUG Using registry request timeout of 300s
DEBUG Solving with target Python version 3.10.13
DEBUG Adding direct dependency: sympy==1.11.0
DEBUG No cache entry for: https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/build/simple/sympy/
DEBUG Request already has an authorization header: https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/build/simple/sympy/
DEBUG Searching for a compatible version of sympy (==1.11.0)
DEBUG Selecting: sympy==1.11.0 (sympy-1.11.0-py3-none-any.whl)
DEBUG No cache entry for: https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/build/packages/packages/d0/04/66be21ceb305c66a4b326b0ae44cc4f027a43bc08cac204b48fb45bb3653/sympy-1.11.0-py3-none-any.whl#sha256=df75d738930f6fe9ebe7034e59d56698f29e85f443f743e51e47df0caccc2130
DEBUG Adding authentication to already-seen URL: https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/build/packages/packages/d0/04/66be21ceb305c66a4b326b0ae44cc4f027a43bc08cac204b48fb45bb3653/sympy-1.11.0-py3-none-any.whl#sha256=df75d738930f6fe9ebe7034e59d56698f29e85f443f743e51e47df0caccc2130
error: Failed to download: sympy==1.11.0
  Caused by: HTTP status client error (403 Forbidden) for url (https://&lt;JFROG_ARTIFACTORY_URL&gt;/api/pypi/build/packages/packages/d0/04/66be21ceb305c66a4b326b0ae44cc4f027a43bc08cac204b48fb45bb3653/sympy-1.11.0-py3-none-any.whl#sha256=df75d738930f6fe9ebe7034e59d56698f29e85f443f743e51e47df0caccc2130)
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-21 14:45</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2592.html">astral-sh/uv#2592</a> on 2024-03-21 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-03-21 17:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:25 UTC
    </footer>
</body>
</html>
