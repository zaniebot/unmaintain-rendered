<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(üéÅ) Fail and show an error when an invalid extra is requested - astral-sh/uv #2828</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>(üéÅ) Fail and show an error when an invalid extra is requested</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/2828">#2828</a>
        opened by <a href="https://github.com/KotlinIsland">@KotlinIsland</a>
        on 2024-04-05 02:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/KotlinIsland">@KotlinIsland</a></div>
            <div class="timeline-body"><pre><code class="language-console">&gt; uv --version
uv 0.1.29 (365cb16fd 2024-04-04)
&gt; uv pip install basedmypy[among] basedpyright[us]
Resolved 6 packages in 571ms
Downloaded 1 package in 19.15s
Installed 2 packages in 57.88s
 + basedmypy==2.4.0
 + basedpyright==1.9.0
</code></pre>
<p>The imposter here should have been reported and caused the installation to fail</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 02:26</div>
            <div class="timeline-body"><p>We show these warnings on compile:</p>
<pre><code>‚ùØ echo &quot;basedmypy[among]&quot; | uv pip compile -
Resolved 4 packages in 5ms
warning: The package `basedmypy==2.4.0` does not have an extra named `among`.
# This file was autogenerated by uv via the following command:
#    uv pip compile -
basedmypy==2.4.0
basedtyping==0.1.3
    # via basedmypy
mypy-extensions==1.0.0
    # via basedmypy
typing-extensions==4.10.0
    # via
    #   basedmypy
    #   basedtyping
</code></pre>
<p>(I don't think we should fail, but we should warn.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DetachHead">@DetachHead</a> on 2024-04-05 02:32</div>
            <div class="timeline-body"><p>i think it should be an error for the same reason attempting to install a package that doesn't exist is an error. i spent hours the other day trying to figure out why an extra from a package i was using wasn't working, only to find out that it wasn't even installed because i specified the wrong name. warnings are very easy to miss</p>
<p>i can't think of a case where you'd ever want to specify an invalid extra, but if there is, i guess there could be an option to warn instead of fail. but i think it should fail by default</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 02:46</div>
            <div class="timeline-body"><p>I'm undecided but prior art from pip to understand why pip warns (but doesn't error):</p>
<ul>
<li>https://github.com/pypa/pip/issues/12516</li>
<li>https://github.com/pypa/pip/issues/9736</li>
<li>https://github.com/pypa/pip/issues/7122</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-04-05 02:46</div>
            <div class="timeline-body"><p>For reference, pip itself just warns</p>
<pre><code>pip install uvicorn[xyz]
WARNING: uvicorn 0.29.0 does not provide the extra 'xyz'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 02:48</div>
            <div class="timeline-body"><p>I think part of the problem is that &quot;whether an extra exists&quot; can change over time, since extras can be added or removed. Should we backtrack to versions that <em>do</em> include an extra? If not, <code>pip install uvicorn[xyz]</code> would start failing at some point if the extra were removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 02:53</div>
            <div class="timeline-body"><p>I added the warning for <code>pip install</code> in https://github.com/astral-sh/uv/pull/2829 (but not going to close this issue until we decide whether to error).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-05 02:58</div>
            <div class="timeline-body"><p>I think erroring is reasonable, we just need to consider the implications, because it would be a divergence from pip and so could break some workflows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-04-05 02:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-04-05 03:11</div>
            <div class="timeline-body"><p>Based on the threads you linked, it seems the only legitimate middle ground I see to avoid potential issue with transitives with invalid extras is https://github.com/pypa/pip/issues/9736#issuecomment-876148583 where you'd enforce extras exists when supplied directly by the user, but don't enforce them when resolving them on transitives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KotlinIsland">@KotlinIsland</a> on 2024-04-05 03:28</div>
            <div class="timeline-body"><p>@charliermarsh Next can you do a reimplementation of python itself, all your projects make sound, well-thought out decisions that fix so many long standing issues with the ecosystem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaraco">@jaraco</a> on 2024-06-17 14:07</div>
            <div class="timeline-body"><p>To add some color to this discussion, I'm working on a build/test <a href="https://bit.ly/coherent-system">system</a> that aims to move a lot of the project configuration into tooling and infrastructure. It assumes that every project under test is going to declare any test dependencies under the <code>test</code> extra and <a href="https://github.com/coherent-oss/coherent.test/blob/b20a4025e8340a8eba801858cc48d7be9c236333/__main__.py#L13">installs them</a> when setting up to run tests.</p>
<p>Some projects, however, will have no project-specific test dependencies. In this case, the project gets built without any <code>Provides-Extra: test</code> in the metadata. I'm leaning toward having every project supply the <code>test</code> extra even when there are no dependencies, to suppress the warning under the current <code>pip install</code> technique but also satisfy a future where installers are more strict about installing them, such as this issue is proposing.</p>
<p>If you have any concerns about that approach, please comment in https://github.com/coherent-oss/coherent.test/issues/5.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karfau">@karfau</a> on 2024-06-24 07:08</div>
            <div class="timeline-body"><p>I have a setup where those extras are defined in setup.py but when running
<code>uv pip install -e '.[test]'</code>
it tells me</p>
<pre><code>warning: The package `mypackage @ file://[...]` does not have an extra named `test`.
</code></pre>
<p>and also doesn't install any dependencies other then the package itself, not even the things in <code>requirements.txt</code>.</p>
<p>This is the case since v0.2.5, it works fine in 0.2.4.</p>
<p>Let me know if this is the right thread for this message or wether I should file a new issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-24 07:09</div>
            <div class="timeline-body"><p>@karfau That looks like a regression, please file a new issue with details how to reproduce your case!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2025-05-13 14:12</div>
            <div class="timeline-body"><p>Hm, switching from <code>uv pip install -e 'pkg @ .[dev,test]'</code> to <code>uv pip install -e 'pkg @ .' -r pyproject.toml --extra=dev --extra=test</code> works, but I wouldn‚Äôt call it elegant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FelixSchwarz">@FelixSchwarz</a> on 2025-06-06 06:23</div>
            <div class="timeline-body"><p>Please, please implement this for <code>uv pip</code>. I have spent so much time finding these stupid little typos.
I recognize that this might break workflows at first so how about adding a CLI parameter (or an env variable) which triggers <code>uv pip</code> to fail on invalid extras? That way you can opt in (or opt out, depending what default you choose) easily.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zoola969">@zoola969</a> on 2025-10-30 10:41</div>
            <div class="timeline-body"><p>Would be nice to have an optional config to fail the compilation if there is a mistake with extra for some libs e.g.
<code>uv lock --fail-on-missing-extra</code></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:36 UTC
    </footer>
</body>
</html>
