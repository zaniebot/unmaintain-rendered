<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force uv to skip certain (transitive) dependencies - astral-sh/uv #9174</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Force uv to skip certain (transitive) dependencies</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9174">#9174</a>
        opened by <a href="https://github.com/chrisfougner">@chrisfougner</a>
        on 2024-11-17 23:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/chrisfougner">@chrisfougner</a> on 2024-11-17 23:00</div>
            <div class="timeline-body"><p>Is there a way to force uv to skip certain dependencies? Specifically we use docker containers <a href="https://catalog.ngc.nvidia.com/orgs/nvidia/containers/pytorch">maintained by Nvidia</a>, which come pre-installed with various python ML packages on the system level (torch, apex, amp_C, flash-attn). If I use <code>uv venv --system-site-packages</code> then I can access those dependencies, the problem is that if any package that I install has a transitive dependency on one of these packages (primarily torch), then the one installed in venv will be chosen over the system one, and things break. I'd like to be able to specify that torch for example should not be installed as a transitive dependency, but I'm not sure how to do this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielhollas">@danielhollas</a> on 2024-11-18 00:39</div>
            <div class="timeline-body"><p>It would be great to have a proper solution for this, not just a hack. We have a similar situation in our container setup, but the number of packages much larger.</p>
<p>See also discussion in #2500</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 01:14</div>
            <div class="timeline-body"><p>I think using overrides with an &quot;impossible&quot; marker is actually kind of a fine solution? The alternative is that we introduce something non-standard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 01:18</div>
            <div class="timeline-body"><p>I think this should be tracked in #4422 though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-18 01:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisfougner">@chrisfougner</a> on 2024-11-18 11:04</div>
            <div class="timeline-body"><p>Thank you both. Super helpful. The solution seems fine to me.</p>
<p>For anyone else that stubmless upon this issue. Add the following to your pyproject.toml. If you have a top-level pyproject.toml and any additional package specific ones, you should add it to the top-level pyproject.toml</p>
<pre><code>[tool.uv]
override-dependencies = [
    &quot;torch; sys_platform == 'never'&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielhollas">@danielhollas</a> on 2024-11-18 11:07</div>
            <div class="timeline-body"><p>I would just note that this is quite a  dangerous solution to the original problem, since if a package depends on a torch version that is not satisfied by the underlying environment this will result in a broken installation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11012.html">astral-sh/uv#11012</a> on 2025-01-29 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../vllm-project/vllm-spyre/issues/61.html">vllm-project/vllm-spyre#61</a> on 2025-03-27 22:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/4569.html">prefix-dev/pixi#4569</a> on 2025-09-15 20:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ahakanbaba">@ahakanbaba</a> on 2025-10-03 04:23</div>
            <div class="timeline-body"><blockquote>
<p>Thank you both. Super helpful. The solution seems fine to me.</p>
<p>For anyone else that stubmless upon this issue. Add the following to your pyproject.toml. If you have a top-level pyproject.toml and any additional package specific ones, you should add it to the top-level pyproject.toml</p>
<pre><code>[tool.uv]
override-dependencies = [
    &quot;torch; sys_platform == 'never'&quot;,
]
</code></pre>
</blockquote>
<p>This is a very reasonable workaround.
BUT, this does not work with <code>--universal</code> parameter :(</p>
<p>Instead I have written an obviously false another constraint. For example</p>
<pre><code>[tool.uv]
override-dependencies = [
    &quot;torch; python_version &lt; '3.0'&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/atiladeokegab">@atiladeokegab</a> on 2025-11-08 20:01</div>
            <div class="timeline-body"><p>thank you</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:24 UTC
    </footer>
</body>
</html>
