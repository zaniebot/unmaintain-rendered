<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic dependencies in setup.py are not considered when editing dependencies - astral-sh/uv #6822</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Dynamic dependencies in setup.py are not considered when editing dependencies</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6822">#6822</a>
        opened by <a href="https://github.com/AbdealiLoKo">@AbdealiLoKo</a>
        on 2024-08-29 16:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AbdealiLoKo">@AbdealiLoKo</a> on 2024-08-29 16:45</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Here is a reproducible example in a docker container:</p>
<pre><code class="language-bash">docker run --rm -it ubuntu:22.04
$ apt update
$ apt install -y curl
$ curl -LsSf https://astral.sh/uv/install.sh | sh
$ echo 'eval &quot;$(uv generate-shell-completion bash)&quot;' &gt;&gt; ~/.bashrc
$ source ~/.bashrc
$ uv init myapp
$ cd myapp
$ echo &quot;babel==2.15.0&quot; &gt; pinned.txt
$ echo -e &quot;from setuptools import setup\nsetup(install_requires=[i.strip() for i in open('pinned.txt', 'r').readlines()])&quot; &gt; setup.py
$ sed -i '/^dependencies/d' pyproject.toml
$ echo 'dynamic = [&quot;dependencies&quot;]' &gt;&gt; pyproject.toml
$ uv venv
$ uv pip install -e .
$ echo &quot;babel==2.16.0&quot; &gt; pinned.txt

$ uv pip install -e . -v
DEBUG uv 0.4.0
DEBUG Searching for Python interpreter in system path
DEBUG Found `cpython-3.12.5-linux-x86_64-gnu` at `/myapp/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.12.5 environment at .venv/bin/python3
DEBUG Acquired lock for `.venv`
DEBUG Requirement satisfied: babel==2.15.0  &lt;--------------------- This should have been 2.16.0
DEBUG Requirement satisfied: file:///myapp
Audited 1 package in 5ms

$ uv pip tree
myapp v0.1.0
└── babel v2.15.0
</code></pre>
<p>I expected that the second <code>uv pip install -e .</code> should have noticed that the dependencies for <code>myapp</code> have changed.
But it looks like it is not.</p>
<p>Seems related: https://github.com/astral-sh/uv/issues/2844</p>
<p>Workarounds I have seen:</p>
<ul>
<li><code>uv pip install -e . --reinstall</code></li>
<li><code>uv clean; uv pip install -e .</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-29 16:49</div>
            <div class="timeline-body"><p>You'll need to mark your package as requiring reinstallation if you want it to be reinstalled on every operation. This is documented here: https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AbdealiLoKo">@AbdealiLoKo</a> on 2024-08-29 17:41</div>
            <div class="timeline-body"><p>Sighs ... not sure how I missed that in the documentation !
Thanks for the pointer, I'll read it and try it out !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AbdealiLoKo on 2024-08-29 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AbdealiLoKo">@AbdealiLoKo</a> on 2024-08-30 04:00</div>
            <div class="timeline-body"><p>@charliermarsh was thinking about this a bit more ... is there any benefit of making a heuristic here that if a package is being installed from a local path + The package has dynamic fields in pyproject.toml -- uv would automatically reinstall it in every operation to be safe ?</p>
<ol>
<li>Local path - I assume uv already has this information</li>
<li>Dynamic fields - If the <a href="https://peps.python.org/pep-0621/#dynamic">project.dynamic</a> field is defined in pyproject.toml then we know if has dynamic fields ?</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6860.html">astral-sh/uv#6860</a> on 2024-08-30 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-10 01:44</div>
            <div class="timeline-body"><p>We have a new API whereby you can add additional files to consider when invalidating the cache. You can also include the current Git commit (i.e., invalidate whenever the SHA changes).</p>
<p>Looks like this:</p>
<pre><code class="language-toml">[tool.uv]
cache-keys = [{ file = &quot;pyproject.toml&quot; }, { file = &quot;requirements.txt&quot; }, { git = true }]
</code></pre>
<p>See: https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:21 UTC
    </footer>
</body>
</html>
