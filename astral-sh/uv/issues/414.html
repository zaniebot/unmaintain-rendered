<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't remove pip from the user's venv - astral-sh/uv #414</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Don't remove pip from the user's venv</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/414">#414</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-11-13 18:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2023-11-13 18:37</div>
            <div class="timeline-body"><p>It seems <code>pip-sync</code> currently removes pip from the user's venv, we shouldn't do that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2023-11-13 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-13 18:45</div>
            <div class="timeline-body"><p>I’m not fully convinced that we shouldn’t.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-13 18:54</div>
            <div class="timeline-body"><p>This would mean that adding a removing pip as a dependency via Puffin would no longer remove pip from your env. If you want pip in your env, should it not be a declared dependency?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-13 19:01</div>
            <div class="timeline-body"><p>If you create your venv with <code>virtualenv</code>, it has pip, setuptools and wheels since many people's workflow depend on them. When <code>puffin pip-sync</code> performs any action, it removes those, leaving the user with a pip-less venv. (This is different from a puffin-created venv, that is bare by default, but if you would ask puffin to create a venv with pip because your workflow requires it, this would lead to the same problem)</p>
<pre><code class="language-console">$ virtualenv --clear .venv
created virtual environment CPython3.10.13.final.0-64 in 47ms
  creator CPython3Posix(dest=/home/konsti/projects/puffin/.venv, clear=True, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/home/konsti/.local/share/virtualenv)
    added seed packages: pip==23.3.1, setuptools==68.2.2, wheel==0.41.3
  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
$ echo &quot;numpy&quot; &gt; numpy.in
$ target/debug/puffin pip-compile -o numpy.txt numpy.in
Resolved 1 package in 72ms
$ target/debug/puffin pip-sync numpy.txt
Uninstalled 3 packages in 11ms
Installed 1 package in 13ms
 + numpy==1.26.2
 - pip==23.3.1
 - setuptools==68.2.2
 - wheel==0.41.3
</code></pre>
<p>I like bare venvs a lot but i expect many users don't like having their pip (or setuptools) removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-13 19:22</div>
            <div class="timeline-body"><p>I do understand but if you use <code>pip</code> to modify the virtualenv, then run <code>pip-sync</code>, we're going to wipe away those changes anyway. What if instead we add a <code>pip-install</code> command with <code>pip install</code> semantics, so it doesn't remove packages but instead purely augments the virtualenv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-13 19:29</div>
            <div class="timeline-body"><p>For me, it's the difference between &quot;system packages&quot; and &quot;user packages&quot;: We don't touch system package, but we do sync user packages. Often people use pip for the hacky parts only anyway. But this has no urgency, we can keep doing this for the start and see if users even complain.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Future" by @konstin on 2023-11-13 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2023-11-13 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-13 19:56</div>
            <div class="timeline-body"><p>I suspect that it will be confusing to users. Though I am wondering if we should somehow differentiate between virtualenvs that were created by Puffin vs. those that were not, so that we can correctly remove <code>pip</code> in a Puffin-managed environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-11-13 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-14 11:22</div>
            <div class="timeline-body"><p>We can use <code>pyvenv.cfg</code> if we want to differentiate venvs by creator</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-11-30 01:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/535.html">astral-sh/uv#535</a> on 2023-12-04 04:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-04 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9860.html">astral-sh/uv#9860</a> on 2024-12-13 03:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:17 UTC
    </footer>
</body>
</html>
