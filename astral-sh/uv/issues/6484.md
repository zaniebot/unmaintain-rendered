```yaml
number: 6484
title: Git operation fails if cache exists in subsequent uv pip compile runs
type: issue
state: open
author: nth10sd
labels:
  - needs-mre
assignees: []
created_at: 2024-08-23T02:18:27Z
updated_at: 2025-07-08T02:28:39Z
url: https://github.com/astral-sh/uv/issues/6484
synced_at: 2026-01-10T01:57:14Z
```

# Git operation fails if cache exists in subsequent uv pip compile runs

---

_Issue opened by @nth10sd on 2024-08-23 02:18_

In a `requirements.in` file:

```
git+https://github.com/astral-sh/uv.git@main
```

Any pyproject.toml file should do.

Run the following:

```
uv pip compile pyproject.toml requirements.in --all-extras --no-strip-extras --no-strip-markers --universal --output-file requirements.txt ;
```

The first run should succeed, assuming the uv cache does not exist. On subsequent runs, the following occurs:

```
⠼ Resolving dependencies...                                                                                                                                                                                      error: Git operation failed
  Caused by: failed to fetch into: /home/USERNAME/.cache/uv/git-v0/db/5d8dbe36cd6ea14f
  Caused by: failed to fetch branch or tag `main`
  Caused by: process didn't exit successfully: `git fetch --force --update-head-ok 'https://github.com/astral-sh/uv.git' '+refs/tags/main:refs/remotes/origin/tags/main'` (exit status: 128)
--- stderr
fatal: couldn't find remote ref refs/tags/main
```

This issue can be bypassed by doing a `rm -rf /home/USERNAME/.cache/uv/git-v0/db/5d8dbe36cd6ea14f`.

The same issue does not seem to exist for `git+ssh` links.

---

_Comment by @nth10sd on 2024-08-23 02:20_

Oh wait, the cache seems like a red herring. I re-run the `uv pip compile` command and sometimes it works, sometimes it doesn't (without clearing the cache).

---

_Comment by @charliermarsh on 2024-08-23 02:21_

Interesting, I can't reproduce this:

![Screenshot 2024-08-22 at 10 21 42 PM](https://github.com/user-attachments/assets/483075d1-de25-41ca-b33b-2b78b3c30096)


---

_Label `needs-mre` added by @charliermarsh on 2024-08-23 02:23_

---

_Comment by @nth10sd on 2024-08-23 02:47_

```
--- stderr
fatal: couldn't find remote ref refs/tags/main
```

Ran into it again - this time, clearing the cache helped.

I can't tell if this is `uv` failing or if it's the underlying `git` command failing, or if it's the server acting up, or even my internet connection. Any clues?

---

_Comment by @charliermarsh on 2024-08-23 02:49_

Hmm... it's possible that `--verbose` gives you more information, but I'm not certain.

---

_Comment by @nth10sd on 2024-08-23 02:57_

```
DEBUG Performing a Git fetch for: https://github.com/astral-sh/uv
DEBUG failed to fetch refspec `+refs/heads/main:refs/remotes/origin/main`: process didn't exit successfully: `git fetch --force --update-head-ok 'https://github.com/astral-sh/uv' '+refs/heads/main:refs/remotes/origin/main'` (exit status: 128)
--- stderr
fatal: unable to access 'https://github.com/astral-sh/uv/': Could not resolve host: github.com

DEBUG failed to fetch refspec `+refs/tags/main:refs/remotes/origin/tags/main`: process didn't exit successfully: `git fetch --force --update-head-ok 'https://github.com/astral-sh/uv' '+refs/tags/main:refs/remotes/origin/tags/main'` (exit status: 128)
--- stderr
fatal: couldn't find remote ref refs/tags/main

error: Failed to download and build: `uv @ git+https://github.com/astral-sh/uv@main`
  Caused by: Git operation failed
  Caused by: failed to clone into: /home/USERNAME/.cache/uv/git-v0/db/5d8dbe36cd6ea14f
  Caused by: failed to fetch branch or tag `main`
  Caused by: process didn't exit successfully: `git fetch --force --update-head-ok 'https://github.com/astral-sh/uv' '+refs/tags/main:refs/remotes/origin/tags/main'` (exit status: 128)
--- stderr
fatal: couldn't find remote ref refs/tags/main
```

Hit it again. Sometimes removing the listed cache folder e.g. `5d8dbe36cd6ea14f/` works, sometimes it doesn't.

---

_Comment by @charliermarsh on 2024-08-28 18:13_

Are you still hitting this consistently?

---

_Comment by @nth10sd on 2024-08-28 18:28_

Yes, still hitting it. I'm usually removing the cache folder and retrying till I get past the issue.

---

_Comment by @steinwaywhw on 2025-07-08 02:28_

Interestingly I ran into this too. I have the following in pyproject.toml

```
fire = { git = "https://github.com/google/python-fire", rev = "master" }
```

I'm running some scripts in CI where it does `uv sync --frozen`. The first CI job would succeed, and upload a cache (via GitLab). And the subsequent job will load the cache and ran `uv sync --frozen` again.

And I see this

```
Failed to download and build `fire @
  │ git+https://github.com/google/python-fire@dba7e1d0da014e555d174225fdf5ab4c4574b18b`
  ├─▶ Git operation failed
  ╰─▶ process didn't exit successfully: `/usr/bin/git clone --no-hardlinks
      /builds/noetica-projects/data-platform/.cache/uv/git-v0/db/c43925f9ca44b9ea
      /builds/noetica-projects/data-platform/.cache/uv/git-v0/checkouts/c43925f9ca44b9ea/dba7e1d`
      (exit status: 128)
      --- stderr
      fatal: repository
      '/builds/noetica-projects/data-platform/.cache/uv/git-v0/db/c43925f9ca44b9ea'
      does not exist
```

I'm sorry that I'm not able to describe what is going on precisely and I can't provide more details easily since I don't control the CI component that I included. I can only confirm that I ran into a similar situation.

---
