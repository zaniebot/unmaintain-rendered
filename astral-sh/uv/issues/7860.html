<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FR: Ability to publish to Azure Artifacts - astral-sh/uv #7860</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>FR: Ability to publish to Azure Artifacts</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7860">#7860</a>
        opened by <a href="https://github.com/FauxPrada">@FauxPrada</a>
        on 2024-10-02 08:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/FauxPrada">@FauxPrada</a></div>
            <div class="timeline-body"><p>Hello,</p>
<p>My apologies if this is already a feature, and I&#x27;m misunderstanding how to publish.</p>
<p>The ability to publish a wheel package to Azure artifacts would be greatly welcomed. I hate using GitHub Issue&#x27;s to ask for help so I&#x27;m potentially writing this under the guise of a Feature Request.</p>
<p>At the moment <code>uv publish</code> can attempt to publish to Artifacts:</p>
<p><strong>Using:</strong>
<code>uv publish --publish-url https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/ --verbose --username VssSessionToken</code>
<strong>Gets us:</strong></p>
<pre><code>DEBUG uv 0.4.17
warning: `uv publish` is experimental and may change without warning
Publishing 4 files https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
DEBUG Using request timeout of 30s
Uploading package-2.1.0-py3-none-any.whl (27.2KiB)
DEBUG Checking keyring for credentials for VssSessionToken@https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
[Information] [CredentialProvider]VstsCredentialProvider - Acquired bearer token using &#x27;MSAL Silent&#x27;
[Information] [CredentialProvider]VstsCredentialProvider - Attempting to exchange the bearer token for an Azure DevOps session token.
DEBUG Found credentials in keyring for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
DEBUG Response code for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/: 405 Method Not Allowed
DEBUG Upload error response: {&quot;count&quot;:1,&quot;value&quot;:{&quot;Message&quot;:&quot;The requested resource does not support http method &#x27;POST&#x27;.&quot;}}
error: Failed to publish `dist\package-2.1.0-py3-none-any.whl` to https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
  Caused by: Upload failed with status code 405 Method Not Allowed: {&quot;count&quot;:1,&quot;value&quot;:{&quot;Message&quot;:&quot;The requested resource does not support http method &#x27;POST&#x27;.&quot;}}
</code></pre>
<p><strong>While alternativly:</strong>
<code>uv publish --publish-url https://VssSessionToken@pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/ --verbose</code>
<strong>Gets us</strong></p>
<pre><code>DEBUG uv 0.4.17
warning: &#x27;uv publish&#x27; is experimental and may change without warning
Publishing 4 files https://VssSessionToken@pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
DEBUG Using request timeout of 30s
Uploading package-2.1.0-py3-none-any.whl (27.2KiB)
DEBUG Checking keyring for credentials for VssSessionToken@https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
DEBUG Found credentials in keyring for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
DEBUG Response code for https://VssSessionToken@pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/: 405 Method Not Allowed
error: Failed to publish &#x27;dist\package-2.1.0-py3-none-any.whl&#x27; to https://VssSessionToken@pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/
  Caused by: The request was redirected, but redirects are not allowed when publishing, please use the canonical URL: &#x27;https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/&#x27;
</code></pre>
<p>This is with using <code>pyproject.toml</code> to configure &quot;keyring-provider&quot; and &quot;extra-index-url&quot; under <code>[tool.uv]</code> which appears to be working nicely.</p>
<pre><code>[tool.uv]
keyring-provider = &quot;subprocess&quot;
extra-index-url = [&quot;https://VssSessionToken@pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/simple/&quot;]
</code></pre>
<p>Alternativly, if anyone has any ideas on how to bodge my config into letting me upload a package to Artifacts, that would be very welcomed!</p>
<p>If this is just user-error then I&#x27;ll pretend this Issue was <em>actually</em> a Documentation idiotification Feature Request :)</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-02 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-02 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-02 15:48</div>
            <div class="timeline-body"><p>Hi! the <code>/simple/</code> url is the index url, the upload url ends with <code>/upload/</code> instead. Could you try again with that other url?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FauxPrada">@FauxPrada</a> on 2024-10-03 07:29</div>
            <div class="timeline-body"><blockquote>
<p>Hi! the <code>/simple/</code> url is the index url, the upload url ends with <code>/upload/</code> instead. Could you try again with that other url?</p>
</blockquote>
<p>OMG you&#x27;re RIGHT üëçüëçüëç</p>
<p>That&#x27;s on me for blindly copying the Twine setup link from the Azure devops docs page - without checking it was correct. Bless u</p>
<p>It works like a charm now</p>
<pre><code>uv publish --publish-url https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload --verbose --username VssSessionToken
</code></pre>
<pre><code>DEBUG uv 0.4.18
warning: `uv publish` is experimental and may change without warning
Publishing 4 files https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload
DEBUG Using request timeout of 30s
Uploading package-2.1.0-py3-none-any.whl (27.2KiB)
DEBUG Checking keyring for credentials for VssSessionToken@https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload
[Information] [CredentialProvider]VstsCredentialProvider - Acquired bearer token using &#x27;MSAL Silent&#x27;
[Information] [CredentialProvider]VstsCredentialProvider - Attempting to exchange the bearer token for an Azure DevOps session token.
DEBUG Found credentials in keyring for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload
DEBUG Response code for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload: 409 Conflict
DEBUG Upload error response: {&quot;$id&quot;:&quot;1&quot;,&quot;innerException&quot;:null,&quot;message&quot;:&quot;The feed &#x27;Feed&#x27; already contains file &#x27;package-2.1.0-py3-none-any.whl&#x27; in package &#x27;package 2.1.0&#x27;.&quot;,&quot;typeName&quot;:&quot;Microsoft.VisualStudio.Services.Packaging.Shared.WebApi.Exceptions.PackageAlreadyExistsException, Microsoft.VisualStudio.Services.Packaging.Shared.WebApi&quot;,&quot;typeKey&quot;:&quot;PackageAlreadyExistsException&quot;,&quot;errorCode&quot;:0,&quot;eventId&quot;:3000}
INFO Upload succeeded
File already exists, skipping
Uploading package-2.1.0.tar.gz (27.1KiB)
DEBUG Response code for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload: 200 OK
INFO Upload succeeded
Uploading package-2.1.1-py3-none-any.whl (34.2KiB)
DEBUG Response code for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload: 200 OK
INFO Upload succeeded
Uploading package-2.1.1.tar.gz (36.3KiB)
DEBUG Response code for https://pkgs.dev.azure.com/Company/Package/_packaging/Feed/pypi/upload: 200 OK
INFO Upload succeeded
</code></pre>
<p>You&#x27;re a gem, good PR too it&#x27;ll stop people like me coming here in future lol. I&#x27;ll let that pull close the issue. Cheers</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-08 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/benedikt-mue">@benedikt-mue</a> on 2024-11-14 15:50</div>
            <div class="timeline-body"><p>I ended up using</p>
<pre><code>uv publish --publish-url https://pkgs.dev.azure.com/{organisation}/{project}/_packaging/{feedName}/pypi/upload/ --token PAT
</code></pre>
<p>and avoiding keyring as it gave me a nasty error.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:26 UTC
    </footer>
</body>
</html>
