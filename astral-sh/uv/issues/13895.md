```yaml
number: 13895
title: 401 authentication with AWS CodeArtifact
type: issue
state: closed
author: kurt-rhee
labels:
  - bug
  - needs-mre
assignees: []
created_at: 2025-06-07T00:30:29Z
updated_at: 2025-06-09T18:56:55Z
url: https://github.com/astral-sh/uv/issues/13895
synced_at: 2026-01-10T01:57:31Z
```

# 401 authentication with AWS CodeArtifact

---

_Issue opened by @kurt-rhee on 2025-06-07 00:30_

### Summary

# Problem Statement

When attempting to add a dependency which lives inside of an AWS codeartifact package registry, authentication fails even if authentication variables are set.

## In pyproject.toml
```
# --- UV ---
[tool.uv]

[[tool.uv.index]]
name = "proximal-package-index"
url = "https://proximal-code-artifact-domain-[redacted].d.codeartifact.us-east-2.amazonaws.com/pypi/proximal-hub/simple/"

[tool.uv.sources]
proximal = { index = "proximal-package-index" }
```


## In terminal


```
username is set to `aws`
(api) kurt@Mac api % echo $UV_INDEX_PROXIMAL_PACKAGE_INDEX_PASSWORD
{
    "authorizationToken": "eyJ2ZXIiOj...[redacted]",
    "expiration": [tomorrow]
}


(api) kurt@Mac api % uv add proximal-core
  × No solution found when resolving dependencies:
  ╰─▶ Because kaleido was not found in the package registry and your project depends on
      kaleido==0.2.1, we can conclude that your project's requirements are unsatisfiable.

      hint: An index URL
      (https://proximal-code-artifact-domain-[redacted].d.codeartifact.us-east-2.amazonaws.com/pypi/proximal-hub/simple/)
      could not be queried due to a lack of valid authentication credentials (401
      Unauthorized).
  help: If you want to add the package regardless of the failed resolution, provide the
        `--frozen` flag to skip locking and syncing.
```

## AWS

![Image](https://github.com/user-attachments/assets/b99177fe-bfae-4c0e-bbdc-2e0437f2bad0)


### Platform

Darwin 24.5.0 arm64

### Version

uv 0.7.11 (Homebrew 2025-04-30)

### Python version

(api) kurt@Mac api % uv run python --version   × No solution found when resolving dependencies:   ╰─▶ Because kaleido was not found in the package registry and your project depends on       kaleido==0.2.1, we can conclude that your project's requirements are unsatisfiable.        hint: An index URL       (https://proximal-code-artifact-domain-[redacted].d.codeartifact.us-east-2.amazonaws.com/pypi/proximal-hub/simple/)       could not be queried due to a lack of valid authentication credentials (401       Unauthorized).



---

_Label `bug` added by @kurt-rhee on 2025-06-07 00:30_

---

_Comment by @charliermarsh on 2025-06-07 02:58_

Do you not need to set a username (`aws`)?

---

_Comment by @kurt-rhee on 2025-06-09 17:27_

Woops, forgot to include that information, the username is set to `aws`

---

_Comment by @charliermarsh on 2025-06-09 17:32_

Does it work as expected if you encode the credentials directly in the `pyproject.toml` (just as a test)?

---

_Assigned to @jtfmumm by @zanieb on 2025-06-09 17:42_

---

_Comment by @jtfmumm on 2025-06-09 18:02_

I'm not able to replicate this. With the following I can successfully install from AWS CodeArtifact on uv `0.7.12`.

I'm running:
```
export UV_INDEX_MY_INDEX_USERNAME=aws
export UV_INDEX_MY_INDEX_PASSWORD=$(aws codeartifact get-authorization-token --domain <domain> --domain-owner <domain-owner> --region us-east-1 --query authorizationToken --output text)
uv add a01 
```

My `pyproject.toml` is:

```
...
  [[tool.uv.index]]
  name = "my-index"
  url = "https://<DOMAIN>-<ACCOUNT_ID>.d.codeartifact.us-east-1.amazonaws.com/pypi/<REPO>/simple/"

  [tool.uv.sources]
  a01 = { index = "my-index" }
```

---

_Label `needs-mre` added by @jtfmumm on 2025-06-09 18:13_

---

_Comment by @kurt-rhee on 2025-06-09 18:53_

Something very interesting:

I only changed the two files and things are now working as expected.  The only thing that is changed between the two files is the name field which is now `test` instead of `proximal-package-index`.  I wonder if there is something that is prevent me from using `index` in the title or multiple `-` characters?

auth_aws.sh
```
export AWS_CODEARTIFACT_TOKEN="$(
    aws codeartifact get-authorization-token \
    --domain proximal-code-artifact-domain \
    --domain-owner 016997484973 \
    --query authorizationToken \
    --output text
)"

export UV_INDEX_TEST_USERNAME=aws
export UV_INDEX_TEST_PASSWORD="$AWS_CODEARTIFACT_TOKEN"
```


pyproject.toml
```
[tool.uv]
[[tool.uv.index]]
name = "test"
url = "https://proximal-code-artifact-domain-016997484973.d.codeartifact.us-east-2.amazonaws.com/pypi/proximal-hub/simple/"

[tool.uv.sources]
proximal = { index = "test" }
```


---

_Comment by @kurt-rhee on 2025-06-09 18:56_

Actually now changing it back to `proximal-package-index` and it is working.  I wonder if there was a weird caching issue on my side.  Closing this, thank you all.

---

_Closed by @kurt-rhee on 2025-06-09 18:56_

---
