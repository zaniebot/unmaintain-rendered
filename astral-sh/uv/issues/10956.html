<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean up `[tool.uv.sources]` after `uv remove --dev &lt;foo&gt;` - astral-sh/uv #10956</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Clean up `[tool.uv.sources]` after `uv remove --dev &lt;foo&gt;`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10956">#10956</a>
        opened by <a href="https://github.com/kajic">@kajic</a>
        on 2025-01-25 09:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kajic">@kajic</a> on 2025-01-25 09:18</div>
            <div class="timeline-body"><h3>Question</h3>
<p>First of all, thank you for your work on uv!</p>
<p>Working a with uv's <code>add</code> and <code>remove</code> to sometimes promote a dependency <code>foo</code> as editable (promote because it's initially listed under <code>dependencies</code>), I found that:</p>
<pre><code>uv add --dev --editable editable-foo/
</code></pre>
<p>brings in the following tables into <code>pyproject.toml</code>:</p>
<pre><code>[dependency-groups]
dev = [
    &quot;foo&quot;,
]

[tool.uv.sources]
foo= { path = &quot;editable-foo&quot;, editable = true }
</code></pre>
<p>But then, doing:</p>
<pre><code>uv remove --dev foo
</code></pre>
<p>I end up with:</p>
<pre><code>[dependency-groups]
dev = []

[tool.uv.sources]
foo = { path = &quot;editable-foo&quot;, editable = true }
</code></pre>
<p>(nit: It would have been nice to have <code>[dependency-groups]</code> go away here.)
I'm surprised that <code>foo = { path = &quot;editable-foo&quot;, editable = true }</code> hangs around. Now, for <code>editable-foo</code> not to sneak back in, I seem to have to run all subsequent <code>uv</code> commands with <code>--no-sources</code>.</p>
<p>The workaround I found is to run:</p>
<pre><code>uv remove --dev foo
uv remove foo
uv add foo
</code></pre>
<p>which brings us back almost to where we started from:</p>
<pre><code>dependencies = [
    &quot;foo&gt;=0.1.3&quot;,
]

[dependency-groups]
dev = []
</code></pre>
<p>I’m guessing <code>foo = { path = &quot;editable-foo&quot;, editable = true }</code> is left behind because of the original <code>foo</code> entry under <code>dependencies</code>, but that doesn’t seem to truly warrant keeping it around since it only got added  to track the editable version of that dependency. Is there some way to remove <code>foo = { path = &quot;editable-foo&quot;, editable = true }</code> with the initial <code>uv remove --dev foo</code> invocation?</p>
<h3>Platform</h3>
<p>Ubuntu 22.04.5 LTS</p>
<h3>Version</h3>
<p>0.5.24</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @kajic on 2025-01-25 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-25 13:29</div>
            <div class="timeline-body"><p>Hmm, this seems like the right behavior to me. These commands aren't stateful -- we can't know that you only added the editable source for the <code>--dev</code> dependency, but not the dependency in <code>[project.dependencies]</code>. We should only be removing the source if the dependency itself is no longer referenced in the <code>pyproject.toml</code>. Otherwise, we're changing the behavior and semantics of your dependencies without justification.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kajic">@kajic</a> on 2025-01-25 22:26</div>
            <div class="timeline-body"><p>That makes sense.
I suppose that this would be impossible to fix unless the new entry in [uv.tool.sources] held onto the fact that it is for foo in the dev dependency group, and not for the default foo dependency. Right now it’s ambiguous and without user intervention it’s impossible to know what the right action is (remove or keep).
However, don’t you know (at the time of invoking add) that I only added it for dev since I passed —dev? Or is that not how to think about the semantics of the —dev or —group option? I realize that since this information is not recorded in [uv.tool.sources] there’s no way to go back when remove is used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-29 20:39</div>
            <div class="timeline-body"><p>Yeah, the declared source applies to <em>all</em> mentions of the dependency, so it's not specific to the instance of the dependency in the <code>dev</code> section. Once you run <code>uv add --dev --editable editable-foo</code>, uv now considers the source to be relevant to the new and existing declarations of the dependency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-29 20:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:25 UTC
    </footer>
</body>
</html>
