```yaml
number: 7380
title: "`uv pip install` does not respect `UV_PROJECT_ENVIRONMENT`. Should it? "
type: issue
state: closed
author: nikhilweee
labels:
  - question
assignees: []
created_at: 2024-09-13T22:30:38Z
updated_at: 2024-10-21T21:53:46Z
url: https://github.com/astral-sh/uv/issues/7380
synced_at: 2026-01-10T01:57:16Z
```

# `uv pip install` does not respect `UV_PROJECT_ENVIRONMENT`. Should it? 

---

_Issue opened by @nikhilweee on 2024-09-13 22:30_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->
When `UV_PROJECT_ENVIRONMENT` is unset, `uv pip install <package>` works without activating venv
```console
$ uv venv
Using Python 3.10.12 interpreter at: /usr/bin/python3
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate
$ uv pip install requests # no need to activate venv
Resolved 5 packages in 212ms
Installed 5 packages in 20ms
 + certifi==2024.8.30
 + charset-normalizer==3.3.2
 + idna==3.8
 + requests==2.32.3
 + urllib3==2.2.3
```
When `UV_PROJECT_ENVIRONMENT` is set, `uv pip install <package>` complains about not activating venv
```console
$ export UV_PROJECT_ENVIRONMENT=venv
$ uv venv
Using Python 3.10.12 interpreter at: /usr/bin/python3
Creating virtualenv at: venv
Activate with: source venv/bin/activate
$ uv pip install requests # complains about not activating venv
error: No virtual environment found; run `uv venv` to create an environment, 
or pass `--system` to install into a non-virtual environment
```
This is with `uv` version `0.4.10`
```console
$ uv --version
uv 0.4.10
```
Should the behaviour be consistent for both cases? (I think so)





---

_Comment by @zanieb on 2024-09-13 22:43_

`UV_PROJECT_ENVIRONMENT` is only for project-level commands, not the low-level `pip` interface. Are you trying to use this in a uv-managed project or an arbitrary directory?

---

_Label `question` added by @zanieb on 2024-09-13 22:43_

---

_Comment by @nikhilweee on 2024-09-13 22:51_

Thanks for the clarification. I'm trying to run this from an arbitrary directory. If this is intended please feel free to close the issue.

---

_Comment by @maxbrunet on 2024-09-20 16:59_

In my case it is for an uv-managed project, I find it a little confusing that `uv pip` uses `.venv` by default without activation, but not `UV_PROJECT_ENVIRONMENT`

I use `uv pip` to work around packages that do not build in isolation, and this example from [the doc](https://docs.astral.sh/uv/concepts/projects/#build-isolation) does not work when `UV_PROJECT_ENVIRONMENT` is set:

```console
$ export UV_PROJECT_ENVIRONMENT=/some/other/path/to/venv
$ uv venv
$ uv pip install torch
$ uv sync --no-build-isolation-package=flash-attn
error: No virtual environment found; run `uv venv` to create an environment, or pass `--system` to install into a non-virtual environment)
```

Instead one must do:

```console
$ export UV_PROJECT_ENVIRONMENT=/some/other/path/to/venv
$ uv venv
$ VIRTUAL_ENV="${UV_PROJECT_ENVIRONMENT}" uv pip install torch
$ uv sync --no-build-isolation-package=flash-attn
```

---

_Comment by @zanieb on 2024-09-20 17:02_

We could consider having `uv pip` respect `UV_PROJECT_ENVIRONMENT` if you are in a project root, but it's pretty complicated. I think what you're doing is a reasonable workaround. Ideally we'll have better ways to declare build dependencies in the long-run so you don't need to use `uv pip`.

---

_Comment by @maxbrunet on 2024-09-20 17:03_

> Ideally we'll have better ways to declare build dependencies in the long-run so you don't need to use `uv pip`.

I would love that! ❤️

---

_Closed by @zanieb on 2024-10-21 21:53_

---

_Referenced in [astral-sh/uv#10807](../../astral-sh/uv/issues/10807.md) on 2025-05-14 06:56_

---

_Referenced in [astral-sh/uv#12987](../../astral-sh/uv/issues/12987.md) on 2025-10-21 19:33_

---
