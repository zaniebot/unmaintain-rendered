<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lazy loading of multiple paths for same dependency - astral-sh/uv #15057</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Lazy loading of multiple paths for same dependency</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15057">#15057</a>
        opened by <a href="https://github.com/lilian-delouvy">@lilian-delouvy</a>
        on 2025-08-04 13:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/lilian-delouvy">@lilian-delouvy</a> on 2025-08-04 13:21</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hello,</p>
<p>I'm working on a very specific context where I can have multiple path sources for a given dependency called common_modules.
When working locally, this dependency is located, relatively speaking to my package that we'll call &quot;teststep&quot;, in &quot;../../common_modules&quot;.
On an AzureML pipeline (on which I have no control over the folder structure - a local package will always be placed right inside my package), the path becomes &quot;./common_modules&quot;.
I tried doing this in my pyproject.toml:</p>
<pre><code>dependencies = [
    &quot;common-modules&quot;,
]

[tool.uv.sources]
common-modules = [
    { path = &quot;../../common_modules&quot;, marker = &quot;platform_system == 'Windows'&quot;, editable = true },
    { path = &quot;./common_modules&quot;, marker = &quot;platform_system != 'Windows'&quot;}
]
</code></pre>
<p>The problem is that, after doing <code>uv sync --native-tls</code>, I get the following error:</p>
<pre><code>error: Failed to generate package metadata for `common-modules==0.1.0 @ directory+common_modules`
  Caused by: Distribution not found at: file:///C:/&lt;MY_PROJECT_PATH&gt;/teststep/common_modules
</code></pre>
<p>What's happening is that uv is trying to resolve both paths, which obviously doesn't work.</p>
<p>Is there a way to specify to uv that only one of the paths is fine for the current context ? If not, do you have any suggestion ?</p>
<p>I unfortunately cannot change the folder structure.</p>
<p>EDIT:</p>
<p>I also tried using conflicts and extras, in the hope that it was possible to resolve dependencies by specifying a single extra, like this:</p>
<pre><code class="language-pyproject.toml">dependencies = []

[project.optional-dependencies]
local = [&quot;common-modules&quot;]
pipeline = [&quot;common-modules&quot;]

[tool.uv.sources]
common-modules = [
    { path = &quot;../../common_modules&quot;, editable = true, extra = &quot;local&quot; },
    { path = &quot;./common_modules&quot;, extra = &quot;pipeline&quot; }
]

[tool.uv]
package = true
conflicts = [
    [
        { extra = &quot;local&quot; },
        { extra = &quot;pipeline&quot; }
    ]
]
</code></pre>
<p>I still get an error while running <code>uv sync --native-tls --extra local</code>:</p>
<pre><code>error: Failed to generate package metadata for `common-modules==0.1.0 @ directory+common_modules`
  Caused by: Distribution not found at: file:///C:&lt;MY_PROJECT_PATH&gt;/teststep/common_modules

</code></pre>
<h3>Platform</h3>
<p>Windows (locally) and ubuntu (pipeline)</p>
<h3>Version</h3>
<p>0.7.15 (4ed9c5791 2025-06-25)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @lilian-delouvy on 2025-08-04 13:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15078.html">astral-sh/uv#15078</a> on 2025-08-05 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilian-delouvy">@lilian-delouvy</a> on 2025-08-05 08:25</div>
            <div class="timeline-body"><p>Found the solution. Using 'uv sync --extra &lt;extra_name&gt;' will never work as uv will still try to resolve both paths.
Using 'uv pip install -r pyproject.toml --extra &lt;extra_name&gt;' will work properly. I'm not sure this is the intended behaviour, so I opened a bug ticket that can be seen <a href="https://github.com/astral-sh/uv/issues/15078">here, on issue 15078</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @lilian-delouvy on 2025-08-05 08:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
