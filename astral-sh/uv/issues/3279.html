<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv does not support keyring after 0.1.32 - astral-sh/uv #3279</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv does not support keyring after 0.1.32</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3279">#3279</a>
        opened by <a href="https://github.com/mvaldi">@mvaldi</a>
        on 2024-04-26 14:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mvaldi">@mvaldi</a> on 2024-04-26 14:20</div>
            <div class="timeline-body"><p>Hi astral team, I love this repository and save me a lot of time in github actions.</p>
<p>I have a problem trying to install a private repository with gcp using uv with docker</p>
<p>This is the dockerfile that contain the error:</p>
<details>

<summary>Dockerfile with error</summary>

<pre><code class="language-dockerfile">FROM python:3.10.14-bullseye

RUN pip install -U pip &quot;uv==0.1.33&quot; -q

ARG GOOGLE_APPLICATION_CREDENTIALS_PATH=&quot;./gcp.json&quot;

COPY $GOOGLE_APPLICATION_CREDENTIALS_PATH /tmp/credentials.json
ENV GOOGLE_APPLICATION_CREDENTIALS /tmp/credentials.json

RUN uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;&amp; uv pip install --system --keyring-provider subprocess --extra-index-url https://location-python.pkg.dev/project-id/package-name/simple private-package
</code></pre>
</details>

<p>it throw the follow error</p>
<details>

<summary>Detailed error</summary>

<pre><code> =&gt; ERROR [4/4] RUN uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;  2.9s 
------                                                                                               
 &gt; [4/4] RUN uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;&amp; uv pip install --system --keyring-provider subprocess --extra-index-url https://location-python.pkg.dev/project-id/package-name/simple private-package:
2.838 error: HTTP status client error (401 Unauthorized) for url (https://location-python.pkg.dev/project-id/package-name/simple/private-package/)
------
Dockerfile:11
--------------------
   9 |     
  10 |     # RUN uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;&amp; uv pip install --system --keyring-provider subprocess --extra-index-url https://location-python.pkg.dev/project-id/package-name/simple private-package
  11 | &gt;&gt;&gt; RUN uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;&amp; uv pip install --system --keyring-provider subprocess --extra-index-url https://location-python.pkg.dev/project-id/package-name/simple private-package
  12 |     
--------------------
ERROR: failed to solve: process &quot;/bin/sh -c uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;&amp; uv pip install --system --keyring-provider subprocess --extra-index-url https://location-python.pkg.dev/project-id/package-name/simple private-repository&quot; did not complete successfully: exit code: 2
</code></pre>
</details>

<p>and this error appear for the next versions like</p>
<ul>
<li><code>0.1.33</code></li>
<li><code>0.1.34</code></li>
<li><code>0.1.35</code></li>
<li><code>0.1.36</code></li>
<li><code>0.1.37</code></li>
<li><code>0.1.38</code></li>
</ul>
<p>But if we use the uv version <code>0.1.32</code> it works</p>
<details>

<summary>Dockerfile worked</summary>

<pre><code class="language-dockerfile">FROM python:3.10.14-bullseye

RUN pip install -U pip &quot;uv==0.1.32&quot; -q

ARG GOOGLE_APPLICATION_CREDENTIALS_PATH=&quot;./gcp.json&quot;

COPY $GOOGLE_APPLICATION_CREDENTIALS_PATH /tmp/credentials.json
ENV GOOGLE_APPLICATION_CREDENTIALS /tmp/credentials.json

RUN uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;&amp; uv pip install --system --keyring-provider subprocess --extra-index-url https://location-python.pkg.dev/project-id/package-name/simple private-package
</code></pre>
</details>

<p>so, something it change and break the feature</p>
<p>Thanks you!</p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mvaldi on 2024-04-26 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @mvaldi on 2024-04-26 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-26 14:25</div>
            <div class="timeline-body"><p>Can you include the uv logs from running with <code>--verbose</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvaldi">@mvaldi</a> on 2024-04-26 14:33</div>
            <div class="timeline-body"><p>Sure!</p>
<details>

<summary>Detailed error with -v</summary>

<pre><code class="language-Dockerfile">
FROM python:3.10.14-bullseye

RUN pip install -U pip &quot;uv==0.1.33&quot; -q

ARG GOOGLE_APPLICATION_CREDENTIALS_PATH=&quot;./gcp.json&quot;

COPY $GOOGLE_APPLICATION_CREDENTIALS_PATH /tmp/credentials.json
ENV GOOGLE_APPLICATION_CREDENTIALS /tmp/credentials.json

RUN uv pip install --system keyring keyrings.google-artifactregistry-auth -q &amp;&amp; uv pip install --system --keyring-provider subprocess --extra-index-url https://location-python.pkg.dev/project-id/package-name/simple private-package -v

</code></pre>
<pre><code>1.163 DEBUG Starting interpreter discovery for default Python                     
1.163 DEBUG Cached interpreter info for Python 3.10.14, skipping probing: usr/local/bin/python3
1.163 DEBUG Using Python 3.10.14 environment at usr/local/bin/python3
1.163 DEBUG Trying to lock if free: tmp/uv-39ee7c309557c5e9.lock
1.164 DEBUG Using registry request timeout of 300s
1.164 DEBUG Solving with target Python version 3.10.14
1.164 DEBUG Adding direct dependency: private-package*
1.164 TRACE Fetching metadata for private-package from https://location-python.pkg.dev/project-id/package-name/simple/private-package/
1.165 TRACE No cache entry exists for /root/.cache/uv/simple-v7/65a3230ca73dc537/private-package.rkyv
1.165 DEBUG No cache entry for: https://location-python.pkg.dev/project-id/package-name/simple/prisma-workflows/
1.165 TRACE Sending fresh GET request for https://location-python.pkg.dev/project-id/package-name/simple/private-package/
1.165 TRACE Handling request for https://location-python.pkg.dev/project-id/package-name/simple/private-package/
1.165 TRACE No credentials on request, checking cache...
1.165 TRACE No credentials in cache.
1.165 TRACE Skipping keyring lookup for https://location-python.pkg.dev/project-id/package-name/simple/private-package/ with no username
1.165 DEBUG No credentials found for https://location-python.pkg.dev/project-id/package-name/simple/private-package/
2.091 error: HTTP status client error (401 Unauthorized) for url (https://location-python.pkg.dev/project-id/package-name/simple/private-package/)
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-26 14:36</div>
            <div class="timeline-body"><p>Hi! You need to provide a username for keyring.</p>
<p>See the <a href="https://github.com/astral-sh/uv/blob/main/CHANGELOG.md#0133">0.1.33 breaking changes</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-04-26 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvaldi">@mvaldi</a> on 2024-04-26 14:40</div>
            <div class="timeline-body"><p>wonderful! it worked, thanks you so much!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-26 14:41</div>
            <div class="timeline-body"><p>You're welcome! Sorry for the breaking change â€” it seemed incorrect for us hard-code the username for a specific service.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-04-26 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvaldi">@mvaldi</a> on 2024-04-26 17:05</div>
            <div class="timeline-body"><p>For the following people who come asking the same question, this was the solution:</p>
<p>uv pip install --system --keyring-provider subprocess --extra-index-url https://<strong><code>oauth2accesstoken@</code></strong>location-python.pkg.dev/project-id/package-name/simple private-package</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/erikdao">@erikdao</a> on 2025-01-14 13:40</div>
            <div class="timeline-body"><p>@mvaldi Thank you very much for pointing this out. It saved me!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
