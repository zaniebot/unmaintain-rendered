```yaml
number: 16312
title: "`uv`-installed Python fails on  macOS `arm64` runners: `Argument list too long`"
type: issue
state: closed
author: kdeldycke
labels:
  - bug
  - external
assignees: []
created_at: 2025-10-15T12:17:06Z
updated_at: 2025-10-18T14:19:52Z
url: https://github.com/astral-sh/uv/issues/16312
synced_at: 2026-01-10T01:57:36Z
```

# `uv`-installed Python fails on  macOS `arm64` runners: `Argument list too long`

---

_Issue opened by @kdeldycke on 2025-10-15 12:17_

### Summary

Tl;Dr: Python installed by `actions/setup-python` are working but not the Python installed by `uv`.

A project demonstrate this issue is available at: https://github.com/kdeldycke/nuitka-test/actions/runs/18527824631

### Failure on `macos-26` runner

This project is a simple *Hello World* CLI compiled with Nuitka on all major platforms (Ubuntu, macOS and Windows) and 2 different architectures (`x86_64` and `arm64`).

This is performed by a GitHub workflow available at: https://github.com/kdeldycke/nuitka-test/blob/main/.github/workflows/build.yaml

The process [works perfectly on all platforms and architectures](https://github.com/kdeldycke/nuitka-test/actions/runs/18527824631), but fail for `arm64` macOS build that relies on a Python installed by `uv`:

<img width="293" height="429" alt="Image" src="https://github.com/user-attachments/assets/caae1b34-470e-45f4-934f-cbf6d8f0dfdb" />

We get the following error:

```pytb
Traceback (most recent call last):
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/__main__.py", line 209, in <module>
    main()
    ~~~~^^
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/__main__.py", line 191, in main
    MainControl.main()
    ~~~~~~~~~~~~~~~~^^
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/MainControl.py", line 1214, in main
    _main()
    ~~~~~^^
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/MainControl.py", line 1078, in _main
    detectUsedDLLs(
    ~~~~~~~~~~~~~~^
        standalone_entry_points=getStandaloneEntryPoints(),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        ),
        ^^
    )
    ^
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/freezer/Standalone.py", line 514, in detectUsedDLLs
    _detectUsedDLLs(
    ~~~~~~~~~~~~~~~^
        standalone_entry_point=standalone_entry_point, source_dir=source_dir
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/freezer/Standalone.py", line 396, in _detectUsedDLLs
    used_dll_paths = _detectBinaryDLLs(
        is_main_executable=standalone_entry_point.kind == "executable",
    ...<6 lines>...
        update_cache=not shallNotStoreDependsExeCachedResults(),
    )
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/freezer/Standalone.py", line 168, in _detectBinaryDLLs
    return detectBinaryPathDLLsMacOS(
        original_dir=os.path.dirname(original_filename),
    ...<3 lines>...
        recursive=True,
    )
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/freezer/DllDependenciesMacOS.py", line 105, in detectBinaryPathDLLsMacOS
    stdout = getOtoolDependencyOutput(
        filename=binary_filename,
        package_specific_dirs=package_specific_dirs,
    )
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/utils/SharedLibraries.py", line 364, in getOtoolDependencyOutput
    return _getOToolCommandOutput("-L", filename, cached=True)
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/utils/SharedLibraries.py", line 348, in _getOToolCommandOutput
    _otool_output_cache[cache_key] = executeToolChecked(
                                     ~~~~~~~~~~~~~~~~~~^
        logger=postprocessing_logger,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        absence_message="The 'otool' is used to analyze dependencies on macOS and required to be found.",
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/runner/work/nuitka-test/nuitka-test/.venv/lib/python3.13/site-packages/nuitka/utils/Execution.py", line 428, in executeToolChecked
    process = subprocess.Popen(
        command,
    ...<3 lines>...
        shell=False,
    )
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/subprocess.py", line 1039, in __init__
    self._execute_child(args, executable, preexec_fn, close_fds,
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        pass_fds, cwd, env,
                        ^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
                        gid, gids, uid, umask,
                        ^^^^^^^^^^^^^^^^^^^^^^
                        start_new_session, process_group)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/subprocess.py", line 1972, in _execute_child
    raise child_exception_type(errno_num, err_msg, err_filename)
OSError: [Errno 7] Argument list too long: '/usr/bin/otool'
```

As you can see above, switching from `astral-sh/setup-uv` (`uv`-provided Python) to `actions/setup-python` (GitHub-sanctioned Python), solves the issue.

### Regression search: older macOS

[Switching the runner image from `macos-26` (`arm64`) to `macos-15` (`arm64`)](https://github.com/kdeldycke/nuitka-test/actions/runs/18455997835) does not solve the issue:

<img width="247" height="265" alt="Image" src="https://github.com/user-attachments/assets/f5672194-57ff-44d6-a040-39fe48b406cf" />

The issue is still the same, so it is not a regression introduced by a new macOS version.

### Regression search: different architecture

[Runs on `macos-15-intel` (`x86_64`) do not fail](https://github.com/kdeldycke/nuitka-test/actions/runs/18443331287), but all other `arm64` macOS version fails:

<img width="238" height="167" alt="Image" src="https://github.com/user-attachments/assets/e014165c-1486-4cd6-baca-e52762eabdfc" />

So the issue affects all macOS `arm64`.

### Regression search: older `uv`

I tried to run the same workflow against [different random version of `uv`](https://github.com/kdeldycke/nuitka-test/actions/runs/18497296250)  (i.e. `0.9.2`, `0.8.24`, `0.8.8`, `0.7.22`):

<img width="244" height="430" alt="Image" src="https://github.com/user-attachments/assets/46d833ad-137e-4989-bb5c-89afd504fdf6" />

But again: all fail on `arm64` version of macOS, but not on `x86_64`.

### Context

All dependencies have been pinned down to:
- Latest `nuitka`: 8.2.1
- Latest `uv`: 0.9.2
- Latest Python (supported by Nuitka): 3.13
- Latest `actions/setup-python`: 6.0.0
- Latest `astral-sh/setup-uv`: 7.0.0

This issue has also been reported at: https://github.com/Nuitka/Nuitka/issues/3637 , where other users are reporting the same behavior with other variation of the same message on arm64 macOS.

[Like](https://github.com/Nuitka/Nuitka/issues/3637#issuecomment-3396388704):

```pytb
FATAL: Error, call to 'install_name_tool' failed: ['/usr/bin/install_name_tool', '-add_rpath', '$ORIGIN/../..:$ORIGIN/..:$ORIGIN', 'build/WLEDVideoSync.app/Contents/MacOS/Quartz/CoreGraphics/_inlines.so'] -> b"error: /Applications/Xcode_16.4.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/install_name_tool: changing install names or rpaths can't be redone for: build/WLEDVideoSync.app/Contents/MacOS/Quartz/CoreGraphics/_inlines.so (for architecture x86_64) because larger updated load commands do not fit (the program must be relinked, and you may need to use -headerpad or -headerpad_max_install_names)".
```

```pytb
FATAL: Error, call to 'otool' failed, command line was too long: ['/usr/bin/otool', '-arch', 'arm64', '-L', '/Users/runner/work/nuitka-test/nuitka-test/__main__.dist/cli.bin']
```

CC @kayhayen, @ravizhan, @zak-45, @Kyu

### Platform

macOS `arm64` - v13 / v14 / v15 / v26

### Version

uv 0.9.2

### Python version

Python 3.13

---

_Label `bug` added by @kdeldycke on 2025-10-15 12:17_

---

_Referenced in [Nuitka/Nuitka#3637](../../Nuitka/Nuitka/issues/3637.md) on 2025-10-15 12:18_

---

_Renamed from "`uv`-installed Python fails on  macOS `arm64` runners" to "`uv`-installed Python fails on  macOS `arm64` runners: `Argument list too long`" by @kdeldycke on 2025-10-15 12:18_

---

_Comment by @kdeldycke on 2025-10-15 12:34_

Is it possible that this issue be related to: https://github.com/astral-sh/python-build-standalone/issues/783 ?

---

_Referenced in [astral-sh/python-build-standalone#783](../../astral-sh/python-build-standalone/issues/783.md) on 2025-10-15 12:34_

---

_Comment by @zanieb on 2025-10-15 20:51_

To clarify... you're using Homebrew Python according to the error traceback? So specifically the problem is that uv is invoking Python? I think I'll need a more minimal example, something succinct that captures the relevant invocation, before I can help.

---

_Comment by @zanieb on 2025-10-15 20:53_

Can you share verbose logs for your uv invocation?

---

_Comment by @kdeldycke on 2025-10-16 05:41_

OK we are trying to isolate the issue even more with the Nuitka community.

---

_Comment by @geofft on 2025-10-16 22:05_

I will look in more detail tomorrow, but on a quick glance, I see that the code in question is

```py
def getOtoolDependencyOutput(filename, package_specific_dirs):
    with withEnvironmentPathAdded("DYLD_LIBRARY_PATH", *package_specific_dirs):
        return _getOToolCommandOutput("-L", filename, cached=True)
```

The "Argument list too long" error can happen in two cases: either the actual argument list is too long, or the environment block is too big. In this particular case it looks like the argument list is pretty small (it's in your output) but there is an environment variable being set in the call. Can you find what `package_specific_dirs` is set to? If it's overly long we should figure out why.

```
$ DYLD_LIBRARY_PATH=$(python3 -c 'print("x" * 1048576)') otool -L /bin/cat
-bash: /usr/bin/otool: Argument list too long
```

(Also, I'm pretty sure `otool`'s behavior does not change with `DYLD_LIBRARY_PATH`, so maybe this line of code can just be removed, although of course that doesn't answer the question of why the variable is unreasonably big. I know `ldd`'s behavior changes with `LD_LIBRARY_PATH`, maybe this code was patterned off of that but not updated?)

---

_Comment by @kayhayen on 2025-10-17 14:35_

That totally rings a bell, sorry for needing you to point that out, I can take it from there. Indeed with Homebrew, I recently made a change where I just added all its directories for rpath resolution. Apparently not a good idea.

And indeed, I was trying to mimic what LD_LIBRARY_PATH does on other OSes.

---

_Comment by @kayhayen on 2025-10-17 14:36_

I think the difference may just be that for uv-Python there is a few more such directories than for CPython, or longer paths for them, so it's really just a stupid coincidence of being at the edge of the limit and going over it for very unrelated reasons.

---

_Label `external` added by @zanieb on 2025-10-17 14:56_

---

_Comment by @kdeldycke on 2025-10-18 14:19_

Issue has been fixed upstream in Nuitka and the fix will be available in 2.8.2.

---

_Closed by @kdeldycke on 2025-10-18 14:19_

---
