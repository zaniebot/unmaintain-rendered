<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv compile fails to find some packages when using --python-platform - astral-sh/uv #4616</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv compile fails to find some packages when using --python-platform</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4616">#4616</a>
        opened by <a href="https://github.com/jcugat">@jcugat</a>
        on 2024-06-28 13:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jcugat">@jcugat</a></div>
            <div class="timeline-body">

<p>I&#x27;m trying to freeze some dependencies that I built locally for arm64 macs, but when using <code>uv pip compile</code> with the argument <code>--python-platform=macos</code> it fails the resolution, and removing the argument works perfectly even though I&#x27;m running it from an arm64 machine.</p>
<p>Detailed steps to reproduce:</p>
<pre><code>❯ python -c &#x27;import platform;import sys;print(f&quot;{sys.platform=} {platform.machine()=}&quot;)&#x27;
sys.platform=&#x27;darwin&#x27; platform.machine()=&#x27;arm64&#x27;

❯ cat mydeps.in
ml-metadata==1.14.1.dev0

❯ la dist/ml-metadata/1.14.1.dev0/
total 37288
-rw-r--r--  1 josepc  staff    18M Jun 26 18:16 ml_metadata-1.14.1.dev0-cp38-cp38-macosx_13_0_arm64.whl

❯ uv pip compile --python-platform=macos --find-links /Users/josepc/work/python-arm64-packages/dist/ml-metadata/1.14.1.dev0/ mydeps.in -o mydeps.txt
  × No solution found when resolving dependencies:
  ╰─▶ Because ml-metadata==1.14.1.dev0 has no wheels are available with a matching platform and you require ml-metadata==1.14.1.dev0, we can conclude that the requirements are unsatisfiable.

❯ uv pip compile --find-links /Users/josepc/work/python-arm64-packages/dist/ml-metadata/1.14.1.dev0/ mydeps.in -o mydeps.txt
Resolved 6 packages in 1.62s
# This file was autogenerated by uv via the following command:
#    uv pip compile mydeps.in -o mydeps.txt
absl-py==1.4.0
    # via ml-metadata
attrs==21.4.0
    # via ml-metadata
grpcio==1.64.1
    # via ml-metadata
ml-metadata==1.14.1.dev0
    # via -r mydeps.in
protobuf==3.20.3
    # via ml-metadata
six==1.16.0
    # via ml-metadata
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-28 13:47</div>
            <div class="timeline-body"><p>Can you share the list of wheels in <code>/Users/josepc/work/python-arm64-packages/dist/ml-metadata/1.14.1.dev0/</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jcugat">@jcugat</a> on 2024-06-28 13:50</div>
            <div class="timeline-body"><p>It&#x27;s the third command I executed in my steps, do you need anything from inside the wheel?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-28 13:52</div>
            <div class="timeline-body"><p>Ah sorry, I missed it.</p>
<p>The default macOS deployment target is 12.0. So if you pass <code>--python-platform macos</code>, it tries to resolve for a minimum of macOS 12.0, but your wheel only supports 13.0 and later.</p>
<p>You can set the <code>MACOSX_DEPLOYMENT_TARGET=13.0</code> environment variable to override it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-28 13:52</div>
            <div class="timeline-body"><p>(Or, of course, you can increase the compatibility of your wheel and try to lower the minimum supported macOS version.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jcugat">@jcugat</a> on 2024-06-28 13:54</div>
            <div class="timeline-body"><p>Ah gotcha, I completely missed this env var in the documentation. Thanks for the help!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/jcugat">@jcugat</a> on 2024-06-28 13:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-28 13:55</div>
            <div class="timeline-body"><p>No prob!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-28 13:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:31:46 UTC
    </footer>
</body>
</html>
