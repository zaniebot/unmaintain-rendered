```yaml
number: 14963
title: Recommended way to use a workspace containing dependent subpackages with AWS Lambda
type: issue
state: open
author: bradenkinard-sh
labels:
  - question
  - great writeup
assignees: []
created_at: 2025-07-29T21:52:09Z
updated_at: 2025-07-31T14:00:40Z
url: https://github.com/astral-sh/uv/issues/14963
synced_at: 2026-01-10T01:57:33Z
```

# Recommended way to use a workspace containing dependent subpackages with AWS Lambda

---

_Issue opened by @bradenkinard-sh on 2025-07-29 21:52_

### Question

I'm working on a monorepo using a workspace that I am deploying to AWS Lambda. I have been following the [documentation here](https://docs.astral.sh/uv/guides/integration/aws-lambda/#workspace-support), modified to have a `packages/` directory with sub-packages `package-a` and `package-b`, giving me a project structure that looks like this:
```
.
├── app
│   ├── __init__.py
│   └── main.py
├── Dockerfile
├── packages
│   ├── package_a
│   │   ├── pyproject.toml
│   │   └── src
│   │       └── package_a
│   │           ├── __init__.py
│   │           └── py.typed
│   └── package_b
│       ├── pyproject.toml
│       └── src
│           └── package_b
│               ├── __init__.py
│               └── py.typed
├── pyproject.toml
└── uv.lock
```


I've modified the relevant target line in the Dockerfile to target the `packages/` directory:

```
# Dockerfile
...

RUN --mount=from=uv,source=/uv,target=/bin/uv \
    --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    --mount=type=bind,source=packages,target=packages \  # target is the packages directory
    uv export --frozen --no-dev --no-editable -o requirements.txt && \
    uv pip install -r requirements.txt --target "${LAMBDA_TASK_ROOT}"

...
```

When `package-a` and `package-b` are independent of each other, this seems to work fine. However, if `package-a` is a dependency of `package-b`, `package-a` is no longer discoverable as a module within the container, even though `package-b` is. Looking inside the container, `package_a-0.1.0.dist-info` exists, as does `package_b` and `package_b-0.1.0.dist-info`, but `package_a` is missing. Removing `package-a` as a dependency of `package-b` resolves the issue and both packages seem to be properly installed.

I'm assuming I am improperly handling how I specify the target in the Dockerfile (or perhaps in my configuration of the packages themselves), but its unclear to me how to make it so that all subpackages in the `package/` are properly installed and available within the container, regardless of their dependencies.

For full reproducibility I've included a simplified project [example here](https://github.com/bradenkinard-sh/uv-aws-lambda-example).

### Platform

macOS 15.5 Darwin 24.5.0 arm64

### Version

uv 0.7.13 (Homebrew 2025-06-12)

---

_Label `question` added by @bradenkinard-sh on 2025-07-29 21:52_

---

_Comment by @zanieb on 2025-07-29 23:23_

We're reading workspace sources from the `pyproject.toml` during the `uv pip install` invocation and your package is installed as editable.

The following resolves the issue:

```diff
diff --git a/Dockerfile b/Dockerfile
index c287134..a54024e 100644
--- a/Dockerfile
+++ b/Dockerfile
@@ -35,7 +35,7 @@ RUN --mount=from=uv,source=/uv,target=/bin/uv \
     --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
     --mount=type=bind,source=packages,target=packages \
     uv export --frozen --no-dev --no-editable -o requirements.txt && \
-    uv pip install -r requirements.txt --target "${LAMBDA_TASK_ROOT}"
+    uv pip install --no-sources -r requirements.txt --target "${LAMBDA_TASK_ROOT}"
 
 FROM public.ecr.aws/lambda/python:3.13
```



---

_Comment by @zanieb on 2025-07-29 23:24_

This was also reported in

- https://github.com/astral-sh/uv/issues/14617
- https://github.com/astral-sh/uv/issues/5631

It's plausible we need to change something here

---

_Label `great writeup` added by @zanieb on 2025-07-29 23:25_

---

_Comment by @bradenkinard-sh on 2025-07-31 14:00_

That fixes the problem, thank you!

---

_Referenced in [astral-sh/uv#15297](../../astral-sh/uv/issues/15297.md) on 2025-08-15 15:45_

---

_Referenced in [AllenInstitute/aibs-informatics-cdk-lib#45](../../AllenInstitute/aibs-informatics-cdk-lib/pulls/45.md) on 2025-11-06 20:25_

---
