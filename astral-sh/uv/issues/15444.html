<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv does not respect platform markers when resolving dependencies into uv.lock - astral-sh/uv #15444</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv does not respect platform markers when resolving dependencies into uv.lock</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15444">#15444</a>
        opened by <a href="https://github.com/OmegaAISP">@OmegaAISP</a>
        on 2025-08-22 05:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/OmegaAISP">@OmegaAISP</a> on 2025-08-22 05:43</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have a problem when using uv with platform-specific dependencies. In my project I use TensorRT, which only exists on x86_64 and not on Jetson (aarch64). In my pyproject.toml I added the following:</p>
<pre><code>tensorrt &gt;= 10.9.0.34; platform_machine == &quot;x86_64&quot;
</code></pre>
<p>The problem is that when I run uv lock on an aarch64 system, uv still tries to resolve tensorrt and fails with Package not found: tensorrt. It seems that uv does not respect platform markers when generating the lockfile.</p>
<p>If I generate uv.lock on x86_64 and commit it to my repository, then installation works fine on Jetson. But I cannot regenerate the lockfile on Jetson itself, which makes it impossible to have a flexible multi-platform setup. What I want is the ability to build uv.lock on either x86_64 or aarch64 and have uv correctly skip dependencies that do not match the current platform markers.</p>
<p>Right now the only workaround is to always generate the lockfile on x86 and reuse it, but this breaks workflows where I need to rebuild the lockfile on different platforms. Ideally, uv should evaluate the platform markers during resolution and not attempt to fetch packages that are excluded by them.</p>
<h3>Platform</h3>
<p>x86 and aarch64</p>
<h3>Version</h3>
<p>0.8.9</p>
<h3>Python version</h3>
<p>python 3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @OmegaAISP on 2025-08-22 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-22 08:27</div>
            <div class="timeline-body"><p>uv needs to be able to determine the metadata of tensorrt on any platform to write the lockfile. If we ignored not having the metadata on aarch64, then uv could only create a lockfile that doesn't x86_64. As tensorrt only has a source distribution, the best solution would be for tensorrt to follow PEP 643 and provide its metadata statically.</p>
<p>Can you share the full error message? The should not be a package not found error either way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-22 10:09</div>
            <div class="timeline-body"><blockquote>
<p>Ideally, uv should evaluate the platform markers during resolution and not attempt to fetch packages that are excluded by them.</p>
</blockquote>
<p>Unfortunately this isn't possible -- the lockfile applies to both platforms, and that package <em>requires</em> building in order to determine its dependencies. So we can't determine the dependencies on ARM, because the package isn't supported.</p>
<p>The best you can do, absent the package re-building with a newer version of setuptools, is (see: <a href="https://docs.astral.sh/uv/concepts/resolution/#dependency-metadata">Dependency Metadata</a>):</p>
<pre><code class="language-toml">[[tool.uv.dependency-metadata]]
name = &quot;tensorrt&quot;
version = &quot;10.13.2.6&quot;
requires-dist = [&quot;tensorrt_cu13==10.13.2.6&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-08-22 10:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2025-08-22 10:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-08-24 21:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/OmegaAISP">@OmegaAISP</a> on 2025-08-25 04:16</div>
            <div class="timeline-body"><p>Thanks for the response, everyone. I see there’s no way to avoid building that package on aarch64. Thanks again—here’s the error log:</p>
<pre><code>  × Failed to build `tensorrt-cu12==10.13.2.6`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
        File &quot;/home/user/.cache/uv/builds-v0/.tmpRVELnX/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 331, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;/home/user/.cache/uv/builds-v0/.tmpRVELnX/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 301, in _get_build_requires
          self.run_setup()
        File &quot;/home/user/.cache/uv/builds-v0/.tmpRVELnX/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 512, in run_setup
          super().run_setup(setup_script=setup_script)
        File &quot;/home/user/.cache/uv/builds-v0/.tmpRVELnX/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 317, in run_setup
          exec(code, locals())
        File &quot;&lt;string&gt;&quot;, line 71, in &lt;module&gt;
      RuntimeError: TensorRT does not currently build wheels for Tegra systems

      hint: This usually indicates a problem with the package or the build environment.
  help: `tensorrt-cu12` (v10.13.2.6) was included because `app:tensorrt` (v0.1.6.dev76+gd2f5408.d20250825) depends on `tensorrt-cu12&gt;=10.9.0.34`
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
