<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support copy or hardlink python interpreter when creating venv - astral-sh/uv #6782</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support copy or hardlink python interpreter when creating venv</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6782">#6782</a>
        opened by <a href="https://github.com/amartani">@amartani</a>
        on 2024-08-29 00:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/amartani">@amartani</a> on 2024-08-29 00:08</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Currently, when creating a venv, <code>uv</code> always symlinks the python interpreter. Example:</p>
<pre><code>$ uv venv --python=3.12 /venv
$ ls -l /venv/bin
...
lrwxrwxrwx 1 root root   25 Aug 28 23:53 python -&gt; /root/.local/share/uv/python/cpython-3.12.5-linux-aarch64-gnu/bin/python3.12
lrwxrwxrwx 1 root root    6 Aug 28 23:53 python3 -&gt; python
lrwxrwxrwx 1 root root    6 Aug 28 23:53 python3.12 -&gt; python
</code></pre>
<p>The original <code>python -m venv</code> supports either symlink or copy (with <code>--symlinks</code> / <code>--copies</code> flag). It would be great if <code>uv</code> also supported the same, similar to how <code>--link-mode</code> exists for <code>uv pip</code>.</p>
<p>My main use case is for using a docker multi-stage build where one of the stages builds the venv and then other stages can just copy the entire venv folder; example Dockerfile:</p>
<pre><code>FROM base as venv-builder

RUN uv venv --python=3.12 /venv
RUN uv pip install --python /venv/bin/python ...

FROM base as final-image

# Do other things here

COPY --from=venv-builder /venv /venv
</code></pre>
<p>This use case currently breaks as the symlink ends up pointing to a python binary that does not exist in the final image. For this use case, the ideal behavior would be that the main <code>/venv/bin/python</code> binary was copied or hardlinked from the external binary and <code>python3</code>/<code>python3.12</code> continued to be relative symlinks.</p>
<p>Tested on uv version 0.4.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-29 00:14</div>
            <div class="timeline-body"><p>This makes sense to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-08-29 01:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @charliermarsh on 2024-08-29 01:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-29 03:28</div>
            <div class="timeline-body"><p>Minor note, this is included as <code>--bundle-python</code> in @konstin's document about features we should add for Docker.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SethWen">@SethWen</a> on 2024-09-12 09:49</div>
            <div class="timeline-body"><p>Sometimes, I want to package the Python source code and the virtual environment (venv) together for direct distribution. In this case, the interpreter should not be a symbolic link, but a full copy of the original interpreter. and I hope to have an option for this.
Currently, I am using a mix of conda and pip. After this feature is added in the future, I plan to replace them with uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mweislley">@mweislley</a> on 2024-10-25 17:47</div>
            <div class="timeline-body"><p>Running into this also - basically the docker case but the applications current make use of <code>python -m venv .bundle --copies</code> and I'm not seeing any alternative apart from this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-25 17:52</div>
            <div class="timeline-body"><p>I think the alternative is you just copy over the interpreter along with the environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RayyanRiaz">@RayyanRiaz</a> on 2024-11-15 17:28</div>
            <div class="timeline-body"><p>any updates here? Would really like to have this functionality!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarijkeStein">@MarijkeStein</a> on 2025-01-07 09:45</div>
            <div class="timeline-body"><p>Me as well, please ðŸ’Ÿ</p>
<p>We use the official Docker images to setup Python environments with 'uv'.</p>
<p>But later on, we need to run the actual scripts under a different Docker image.</p>
<p>The way with having a combined image (donor 'uv' executable) does not really scale, as you would need to build one image per combination of Python interpreter version and Linux distro ðŸ™ˆ .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bennyweise">@bennyweise</a> on 2025-01-12 05:37</div>
            <div class="timeline-body"><p>+1 for this, for a different use case. Using uv virtual environments with Cursor, Cursor appears to follow the symlink and give me the wrong environment. I'm also following up to see if it's something I can fix within Cursor, but I've had no luck so far.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kaytwo">@kaytwo</a> on 2025-01-24 18:27</div>
            <div class="timeline-body"><blockquote>
<p>+1 for this, for a different use case. Using uv virtual environments with Cursor, Cursor appears to follow the symlink and give me the wrong environment. I'm also following up to see if it's something I can fix within Cursor, but I've had no luck so far.</p>
</blockquote>
<p>Same in vscode, at least for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vigilans">@Vigilans</a> on 2025-02-14 12:55</div>
            <div class="timeline-body"><p>Now with <code>uv venv --relocatable</code>, the last obstacle to a copiable virtual environment is base python's installation dir: <code>python</code> executable symlink's path and <code>home</code> field in <code>pyvenv.cfg</code>.</p>
<p>I attempted to address it in commit https://github.com/astral-sh/uv/commit/b79ab015e40f3812ee138f5180a22d4873cb6449, to use relative path for <code>python</code> symlink and <code>home</code> field, when <code>uv venv</code> is provided with:</p>
<ul>
<li>Relocatable mode: <code>--relocatable</code></li>
<li>A relative path to python installation: <code>--python &lt;../relative/path/to/python&gt;</code></li>
</ul>
<p>The <code>python</code> executable does not bring issue, however <code>home</code> in <code>pyvenv.cfg</code> does: when <code>home</code> path is relative, it is relative to <code>python</code> process's working directory, instead of the location of <code>pyvenv.cfg</code>, see https://github.com/python/cpython/issues/83650.</p>
<p>This is essentially a deal breaker. One workaround proposed in <a href="https://stackoverflow.com/questions/51989490/venv-home-key-in-pyvenv-cfg">Stack Overflow</a> suggests to modify <code>bin/activate</code> script to update <code>home</code> field when activating the environment. This may work in most circumstances, but cannot be proposed as a general solution for <code>uv</code>.  I wonder whether <code>home</code> field here will still be an issue when implementing the feature in this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vigilans">@Vigilans</a> on 2025-07-28 15:56</div>
            <div class="timeline-body"><p>Support for relative home path in <code>pyvenv.cfg</code> is now being discussed in PEP 796:</p>
<ul>
<li>https://github.com/python/peps/pull/4476</li>
<li>https://github.com/python/cpython/issues/136051</li>
</ul>
<p>Once it gets accepted, I can make a PR for https://github.com/Vigilans/uv/commit/b79ab015e40f3812ee138f5180a22d4873cb6449 to make uv venv fully portable when provided with relative python path in relocatable mode.</p>
<p>(As for the original request in this issue, <a href="https://stackoverflow.com/questions/60193899/venv-not-respecting-copies-argument#comment106469051_60193899"><code>python -m venv --copies</code> seems to be a no-op in non-windows platform</a>, and there seems to be more things than hardlinking/copying python binary alone in a python installation (e.g. include, lib, and share folder in python-build-standalone)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/raylu">@raylu</a> on 2025-10-07 05:02</div>
            <div class="timeline-body"><p>noting that this issue covers the same ground as #2103</p>
<hr />
<p>I got what I wanted with some jank: I installed a python and pretended it was a venv</p>
<pre><code class="language-sh">$ uv python install 3 -i .
$ mv cpython-3.13.7-linux-aarch64-gnu .venv
$ uv pip install jinja2
error: Broken virtual environment `/home/raylu/test/.venv`: `pyvenv.cfg` is missing
$ uv sync
 + jinja2==3.1.6
$ ls -1 .venv/lib/python3.13/site-packages
jinja2
jinja2-3.1.6.dist-info
</code></pre>
<p>so <code>uv pip install</code> thinks it's not a functional venv but <code>uv sync</code> is still happy to install my <code>pyproject.toml</code>'s dependencies. and there are no symlinks out of the directory so it works as a chroot</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/staticglobal">@staticglobal</a> on 2025-10-14 16:10</div>
            <div class="timeline-body"><blockquote>
<p>(As for the original request in this issue, <a href="https://stackoverflow.com/questions/60193899/venv-not-respecting-copies-argument#comment106469051_60193899"><code>python -m venv --copies</code> seems to be a no-op in non-windows platform</a>, and there seems to be more things than hardlinking/copying python binary alone in a python installation (e.g. include, lib, and share folder in python-build-standalone)</p>
</blockquote>
<p>This is false. On my Linux system if I run without <code>--copies</code> I get this in <code>bin</code></p>
<pre><code class="language-sh">lrwxrwxrwx 1 490 490   38 Oct 14 16:04 python -&gt; /usr/lib/python-exec/python3.13/python
lrwxrwxrwx 1 490 490    6 Oct 14 16:04 python3 -&gt; python
lrwxrwxrwx 1 490 490    6 Oct 14 16:04 python3.13 -&gt; python
</code></pre>
<p>But with <code>--copies</code> I get this:</p>
<pre><code class="language-sh">-rwxr-xr-x 1 490 490 14344 Oct 14 16:05 python
-rwxr-xr-x 1 490 490 14344 Oct 14 16:05 python3
-rwxr-xr-x 1 490 490 14344 Oct 14 16:05 python3.13
</code></pre>
<p>I'm not sure what OP's issue was in that SO post, but seems like it might have been related to <code>lib</code> vs <code>lib64</code> on his machine, not <code>bin</code>. Then commenter un-helpfully misinterpreted the python source code. A closer read will show that <code>--copies</code> is a no-op <em>on Windows platforms</em> rather than <em>non-Windows platforms</em>.</p>
<p>There is still great merit in the original request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cyber-barrista">@cyber-barrista</a> on 2025-11-16 01:55</div>
            <div class="timeline-body"><p>For anyone looking for a workaround...</p>
<p>Running</p>
<pre><code>uv venv --clear &amp;&amp; find .venv -type l -exec sh -c 'target=$(readlink -f &quot;$1&quot;); rm &quot;$1&quot;; cp -a &quot;$target&quot; &quot;$1&quot;' _ {} \;
</code></pre>
<p>instead of just</p>
<pre><code>uv venv --clear
</code></pre>
<p>does the trick</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/theis188">@theis188</a> on 2026-01-05 16:10</div>
            <div class="timeline-body"><p>+1 to this request. I'm managing a persistent venv system for ML engineers, and broken symlinks are a problem. It would be awesome to have functionality that replicates --copies from venv so that venvs don't rely on central Python interpreters.</p>
<p>@cyber-barrista, tried the above and looks like <code>lib/libpython3.11.dylib</code> was missing.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:17:07 UTC
    </footer>
</body>
</html>
