<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>md5 hashes in pip compile *.txt are not supported by pip - astral-sh/uv #4887</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>md5 hashes in pip compile *.txt are not supported by pip</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/4887">#4887</a>
        opened by <a href="https://github.com/angerrp">@angerrp</a>
        on 2024-07-08 09:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/angerrp">@angerrp</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Hello there!</p>
<p><strong>Issue:</strong>
When compiling dependencies with <code>uv pip compile requirements.in</code> we noticed that <code>uv</code> is putting <code>md5</code> hashes instead of <code>sha</code> hashes in the resulting <code>requirements.txt</code>. This is a problem as <code>pip</code> only supports <code>sha256</code>, <code>sha384</code>, <code>sha512</code> hashes.</p>
<p><strong>When does this happen:</strong>
This happens only for our private <a href="https://gemfury.com/">Gemfury</a> pypi index so my suspicion is that Gemfury responds with a <code>md5</code> hash as default instead of <code>sha</code>.</p>
<p>Could <code>uv</code> check if there is also a <code>sha</code> hash in the index's response or calculate the <code>sha</code> from the package?</p>
<p><strong>Example:</strong></p>
<pre><code>#requirements.txt
our-pkg==3.39.0 \
    --hash=md5:2427c69da75124df182f48e6d8fa7ccb
</code></pre>
<pre><code>$ pip install --require-hashes -r requirements.txt

ERROR: Invalid requirement: our-pkg==3.39.0     --hash=md5:2427c69da75124df182f48e6d8fa7ccb
pip: error: Allowed hash algorithms for --hash are sha256, sha384, sha512.
</code></pre>
<p>Version: <code>uv 0.2.22 (f5e84bbba 2024-07-07)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2024-07-08 13:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-24 00:55</div>
            <div class="timeline-body"><p>We should probably remove MD5 support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bcmyguest">@bcmyguest</a> on 2024-11-07 02:41</div>
            <div class="timeline-body"><p>Hi! This issue has been open for a while, and I can second that it's likely mostly for private repositories.</p>
<p>md5 support was added <a href="https://github.com/astral-sh/uv/issues/1547">here</a>. It seems we might need to revert that PR (I know it's not really the <em>source</em> of the problem) or provide a set of hash algorithms that are acceptable as an option with some reasonable default. FWIW <a href="https://pip.pypa.io/en/stable/topics/secure-installs/#hash-algorithms">pip doesn't allow md5 in their secure installs</a> which was the source of the original issue.</p>
<p>Would suggest using <code>sha256, sha384, sha512</code> as 'acceptable' values as they seem to be the allowed values for pip, which as I understand it is still meant to remain compatible with uv.</p>
<p>In the meantime, for those that are having this issue can use regular <code>pip-compile</code> on problem packages temporarily, but it means keeping <code>uv.lock</code> up to date which is at best a hack.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/exhuma">@exhuma</a> on 2024-12-16 10:30</div>
            <div class="timeline-body"><blockquote>
<p>We should probably remove MD5 support.</p>
</blockquote>
<p>Removing may be a bit harsh although there are very valid arguments to do so.</p>
<p>Making md5 support &quot;opt-in&quot; when generating a <code>requirements.txt</code> file would be sufficient.</p>
<p>I just tried integrating <code>uv</code> into our toolchain (we maintain about 100 Python projects) and a lot of CI jobs still use <code>pip install [...]</code> and using <code>uv</code> to generate the file made all those jobs fail because of the md5 hashes.</p>
<p>The support added in #1547 is still valid. But generating md5 hashes in requirements files... not so much :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:31 UTC
    </footer>
</body>
</html>
