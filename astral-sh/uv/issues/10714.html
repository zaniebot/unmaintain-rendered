<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv called through hatch or tox-uv writes debug to stderr - astral-sh/uv #10714</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv called through hatch or tox-uv writes debug to stderr</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10714">#10714</a>
        opened by <a href="https://github.com/JohnStokes228">@JohnStokes228</a>
        on 2025-01-17 15:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JohnStokes228">@JohnStokes228</a></div>
            <div class="timeline-body"><p>links to <a href="https://github.com/tox-dev/tox-uv/issues/156">tox-uv</a> and <a href="https://github.com/pypa/hatch/issues/1888">hatch</a> issues for posterity, same issue comes when running either tool, tox-uv bounced me here.</p>
<p>I am running [tox-uv / hatch] in an azure devops yaml pipeline via bash script. the tools themselves seem to run as expected end to end, however after completion of a successful test run, a number of debug statements are written to stderr, causing the pipeline task to fail despite an exit code of 0.
The specific statements themselves are also quite odd. whilst several are just entire debug messages like &#x27;##[error]Resolved 47 packages in 1.72s&#x27;, it also includes the names of some packages, and at times even just the packages version number (i.e. &#x27;##[error] + anyio==4.8.0&#x27;, &#x27;##[error]==2.2.1&#x27; or even &#x27;##[error] &#x27;.</p>
for context:
<ul>
<li>we run on linux self hosted agents, using ubuntu:20.04, and install uv via pip in eitehr a python 3.9 or python 3.10 environment (both produce the same outputs, due to our reliance on azure machine learning we cannot go beyond python 3.10 currently)</li>
<li>we use a fresh agent with no other installs on to install first uv, then the required packages for testing (i.e. tox, tox-uv, pytest, ...)</li>
<li>we dont see the same error when running uv commands manually in bash scripts, only when using these tools which wrap calls to uv.</li>
<li>we can write the entire output to dev/null and <strong>still</strong> hit these error messages, suggesting they may not even be being written to stderr?</li>
<li>these errors specifcally appear after the stage completes, i.e. if i were to run <code>tox</code> or <code>hatch test</code> and then follow it with echo statements, the error trace would appear after the subsequent echoes.</li>
<li>changing the rust log level to for instance trace doesnt fix the issue any further than sending to stdout / stderr does</li>
</ul>
example code:
<pre><code> pip install uv
uv pip install hatch pytest pytest-cov
RUST_LOG=trace
hatch test --all --cov --cov-report=xml --cov-report=term --randomize --junitxml=junit/test-results.xml
</code></pre>
<p>with output:</p>
<pre><code>##[debug]Exit code 0 received from tool &#x27;/bin/bash&#x27;
##[debug]STDIO streams have closed for tool &#x27;/bin/bash&#x27;
##[error]Bash wrote one or more lines to the standard error stream.
##[debug]Processed: ##vso[task.issue type=error;source=TaskInternal;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Bash wrote one or more lines to the standard error stream.
##[error]
[notice] A new release of pip is available: 23.0.1 -&gt; 24.3.1
[notice] To update, run: pip install --upgrade pip

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]
[notice] A new release of pip is available: 23.0.1 -&gt; 24.3.1
[notice] To update, run: pip install --upgrade pip

##[error]Using Python 3.9.21 environment at: /azp/_work/_tool/Python/3.9.21/x64

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Using Python 3.9.21 environment at: /azp/_work/_tool/Python/3.9.21/x64

##[error]Resolved 47 packages in 1.43s

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Resolved 47 packages in 1.43s

##[error]Prepared 28 packages in 695ms

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Prepared 28 packages in 695ms

##[error]Installed 46 packages in 39ms
...

##[error]
 + pluggy==1.5.0
 + ptyprocess==0.7.0
 + pycparser==2.22
 + pygments==2.19.1
 + rich==13.9.4
 + secretstorage==3.3.3
 + shellingham==1.5.4
 + sniffio==1.3.1
 + tomli
##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]
 + pluggy==1.5.0
 + ptyprocess==0.7.0
 + pycparser==2.22
 + pygments==2.19.1
 + rich==13.9.4
 + secretstorage==3.3.3
 + shellingham==1.5.4
 + sniffio==1.3.1
 + tomli
##[error]==2.2.1
 + tomli-w==1.2.0
 + tomlkit==0.13.2
 + trove-classifiers==2025.1.10.15
 + typing-extensions==4.12.2
 + trove-classifiers==2025.1.10.15
 + typing-extensions==4.12.2
 +
##[error] userpath==1.9.2
 + virtualenv==20.28.1
 + zipp==3.21.0
 + zstandard==
##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;] userpath==1.9.2
 + virtualenv==20.28.1
 + zipp==3.21.0
 + zstandard==
##[error]0.23.0

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]0.23.0

##[error]Creating environment: hatch-test.py3.10

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Creating environment: hatch-test.py3.10

##[error]Installing project in development mode

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Installing project in development mode

##[error]Checking dependencies

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Checking dependencies

##[error]Syncing dependencies

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Syncing dependencies

##[error]Creating environment: hatch-test.py3.9

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Creating environment: hatch-test.py3.9

##[error]Installing project in development mode

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Installing project in development mode

##[error]Checking dependencies

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Checking dependencies

##[error]Syncing dependencies

##[debug]Processed: ##vso[task.issue type=error;source=CustomerScript;correlationId=c170ade4-6893-4a7e-8644-4632f00ef966;]Syncing dependencies

##[debug]task result: Failed
##[debug]Processed: ##vso[task.complete result=Failed;done=true;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 15:59</div>
            <div class="timeline-body"><p>Perhaps you&#x27;re looking to ensure uv is invoked with the <code>--quiet</code> option? I&#x27;m not sure I follow what else could be done here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JohnStokes228">@JohnStokes228</a> on 2025-01-17 16:22</div>
            <div class="timeline-body"><p>hmmm potentially? although im not convinced this is the issue - it appears to me the logs are specifically being written somewhere other than stdout / stderr, and are being interpreted as errors when they arent. its possible running in quiet may resolve this (is there a means other than setting the rust log to &#x27;trace&#x27; as described in the docs to achieve this when uv is run by a third party tool?) but im not sure it deals with the core issue?</p>
<p>thanks very much for getting back to me so quickly though, really appreciate it man!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 16:37</div>
            <div class="timeline-body"><p>We don&#x27;t write logs anywhere but stdout / stderr. It sounds like the tool is just reporting everything in the stderr stream as <code>##[error]</code>?</p>
<pre><code>❯ uv venv
Using CPython 3.12.6
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
❯ uv pip install anyio 2&gt;stderr.txt 1&gt;stdout.txt
❯ cat stderr.txt
Resolved 4 packages in 118ms
Installed 4 packages in 6ms
 + anyio==4.8.0
 + idna==3.10
 + sniffio==1.3.1
 + typing-extensions==4.12.2
❯ cat stdout.txt
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 18:57</div>
            <div class="timeline-body"><p>It&#x27;s proper for us to write our debug logs to stderr — that&#x27;s the unix convention.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-01 19:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:46 UTC
    </footer>
</body>
</html>
