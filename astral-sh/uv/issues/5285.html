<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resolution depends on empty extra - astral-sh/uv #5285</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Resolution depends on empty extra</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/5285">#5285</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-07-22 13:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2024-07-22 13:30</div>
            <div class="timeline-body"><p>On linux with with uv 0.2.27, the resolution of the pyproject.toml below depends on whether <code>onnx = []</code> is present. The resolution should be robust to adding or removing empty extras, even more the resolution should not care about empty extras at all.</p>
<p>With <code>onnx</code>:</p>
<pre><code class="language-console">$ rm -f uv.lock &amp;&amp; uv lock --upgrade --preview -v 2&gt; a.txt &amp;&amp; wc -l uv.lock &amp;&amp; uv lock --preview -v 2&gt;b.txt &amp;&amp; wc -l uv.lock
2028 uv.lock
1949 uv.lock
</code></pre>
<p>Without <code>onnx</code>:</p>
<pre><code class="language-console">$ rm -f uv.lock &amp;&amp; uv lock --upgrade --preview -v 2&gt; a.txt &amp;&amp; wc -l uv.lock &amp;&amp; uv lock --preview -v 2&gt;b.txt &amp;&amp; wc -l uv.lock
1936 uv.lock
1936 uv.lock
</code></pre>
<pre><code class="language-toml">[project]
name = &quot;transformers&quot;
version = &quot;4.39.0.dev0&quot;
description = &quot;State-of-the-art Machine Learning for JAX, PyTorch and TensorFlow&quot;
requires-python = &quot;&gt;=3.9.0&quot;

dependencies = [
  &quot;filelock&quot;,
  &quot;huggingface-hub&gt;=0.19.3,&lt;1.0&quot;,
  &quot;numpy&gt;=1.17&quot;,
  &quot;packaging&gt;=20.0&quot;,
  &quot;pyyaml&gt;=5.1&quot;,
  &quot;regex!=2019.12.17&quot;,
  &quot;requests&quot;,
  &quot;tokenizers&gt;=0.14,&lt;0.19&quot;,
  &quot;safetensors&gt;=0.4.1&quot;,
  &quot;tqdm&gt;=4.27&quot;,
]

[project.optional-dependencies]
onnx = []
tf-cpu = [
  &quot;onnxconverter-common&quot;,
]
flax = [
  &quot;jaxlib&gt;=0.4.1,&lt;=0.4.13&quot;,
  &quot;flax&gt;=0.4.1,&lt;=0.7.0&quot;,
  &quot;optax&gt;=0.0.8,&lt;=0.1.4&quot;
]
onnxruntime = [&quot;onnxruntime&gt;=1.4.0&quot;, &quot;onnxruntime-tools&gt;=1.4.2&quot;]
ray = [&quot;ray[tune]&gt;=2.7.0&quot;]

deepspeed-testing = [
  &quot;dill&lt;0.3.5&quot;,
  &quot;datasets!=2.5.0&quot;,
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-07-22 13:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-07-22 13:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-22 13:31</div>
            <div class="timeline-body"><p>What do you mean &quot;depends on&quot;? Just that it varies?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-22 13:33</div>
            <div class="timeline-body"><p>Yes, we get different lockfiles depending on whether empty extra is present or not. No idea why this is happening, i was looking for an MRE for the transformers resolution instability but than found this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-22 13:34</div>
            <div class="timeline-body"><p>Ok, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-07-22 16:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5306.html">astral-sh/uv#5306</a> on 2024-07-22 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-22 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-22 19:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:58 UTC
    </footer>
</body>
</html>
