<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv pip compile fails to resolve packages that pip-compile resolves with internal pypi artifactory repo - astral-sh/uv #1362</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv pip compile fails to resolve packages that pip-compile resolves with internal pypi artifactory repo</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1362">#1362</a>
        opened by <a href="https://github.com/merc1031">@merc1031</a>
        on 2024-02-15 21:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/merc1031">@merc1031</a></div>
            <div class="timeline-body"><p>using pip-compile</p>
<pre><code>(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ pip-compile --index-url https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple &lt;(echo &quot;retry==0.9.2\ncelery==5.3.0\n&quot;) -o /tmp/ci2 
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.10
# by the following command:
#
#    pip-compile --index-url=https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple --output-file=/tmp/ci2 /proc/self/fd/11
#
--index-url https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple

amqp==5.2.0
    # via kombu
billiard==4.2.0
    # via celery
celery==5.3.0
    # via -r /proc/self/fd/11
click==8.1.7
    # via
    #   celery
    #   click-didyoumean
    #   click-plugins
    #   click-repl
click-didyoumean==0.3.0
    # via celery
click-plugins==1.1.1
    # via celery
click-repl==0.3.0
    # via celery
decorator==5.1.1
    # via retry
kombu==5.3.5
    # via celery
prompt-toolkit==3.0.43
    # via click-repl
py==1.11.0
    # via retry
python-dateutil==2.8.2
    # via celery
retry==0.9.2
    # via -r /proc/self/fd/11
six==1.16.0
    # via python-dateutil
tzdata==2024.1
    # via celery
vine==5.1.0
    # via
    #   amqp
    #   celery
    #   kombu
wcwidth==0.2.13
    # via prompt-toolkit
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ cat /tmp/ci2                                                                                                                                                                
#
# This file is autogenerated by pip-compile with Python 3.10
# by the following command:
#
#    pip-compile --index-url=https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple --output-file=/tmp/ci2 /proc/self/fd/11
#
--index-url https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple

amqp==5.2.0
    # via kombu
billiard==4.2.0
    # via celery
celery==5.3.0
    # via -r /proc/self/fd/11
click==8.1.7
    # via
    #   celery
    #   click-didyoumean
    #   click-plugins
    #   click-repl
click-didyoumean==0.3.0
    # via celery
click-plugins==1.1.1
    # via celery
click-repl==0.3.0
    # via celery
decorator==5.1.1
    # via retry
kombu==5.3.5
    # via celery
prompt-toolkit==3.0.43
    # via click-repl
py==1.11.0
    # via retry
python-dateutil==2.8.2
    # via celery
retry==0.9.2
    # via -r /proc/self/fd/11
six==1.16.0
    # via python-dateutil
tzdata==2024.1
    # via celery
vine==5.1.0
    # via
    #   amqp
    #   celery
    #   kombu
wcwidth==0.2.13
    # via prompt-toolkit
</code></pre>
<p>odd behaviour using uv pip compile</p>
<pre><code>(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ uv pip compile --index-url https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple --no-cache --no-deps &lt;(echo &quot;retry==0.9.2\n&quot;) -o /tmp/ci
Resolved 1 package in 150ms
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ cat /tmp/ci                                                                                                                                                                                           
# This file was autogenerated by uv v0.1.0 via the following command:
#    uv pip compile --index-url https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple --no-cache --no-deps /proc/self/fd/11 -o /tmp/ci
retry==0.9.2
(test-7) (assets-3.10.11) ➜  tools-3 git:(master) ✗ uv pip compile --index-url https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple --no-cache --no-deps &lt;(echo &quot;retry==0.9.2\ncelery==5.3.0\n&quot;) -o /tmp/ci
error: Failed to download: retry==0.9.2
  Caused by: HTTP status client error (404 Not Found) for url (https://&lt;host&gt;/artifactory/api/pypi/packages/packages/4b/0d/53aea75710af4528a25ed6837d71d117602b01946b307a3912cb3cfcbcba/retry-0.9.2-py2.py3-none-any.whl#sha256=ccddf89761fa2c726ab29391837d4327f819ea14d244c232a1d24c67a2f98606)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-15 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-15 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-15 21:45</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>How are you authenticating with the service?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/merc1031">@merc1031</a> on 2024-02-15 21:51</div>
            <div class="timeline-body"><p>We have unauthenticated read allowed.
For uploads theres a service user that is configured in a .pypirc.</p>
<p>Here it should be simply the configuration in pip config</p>
<pre><code>(assets-3.10.11) ➜  tools-3 git:(master) ✗ pip config list
global.ignore-installed=&#x27;true&#x27;
global.index=&#x27;https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple&#x27;
global.index-url=&#x27;https://&lt;host&gt;/artifactory/api/pypi/virtual-pypi/simple&#x27;
global.require-virtualenv=&#x27;True&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rcramblit">@rcramblit</a> on 2024-02-15 22:41</div>
            <div class="timeline-body"><p>I might have a related error.
I am also using an internal python registry, Sonatype Nexus, and am getting a 404 Not Found with <code>uv pip</code>.</p>
<p>I notice the URL that <code>uv pip</code> attempts to download the artifact from is different than what <code>pip</code> is getting:</p>
<p><code>pip</code>:</p>
<pre><code>Downloading https://*****/repository/python/packages/requests/2.31.0/requests-2.31.0.tar.gz
</code></pre>
<p><code>uv pip</code>:</p>
<pre><code>error: Failed to download and build: requests==2.31.0
  Caused by: HTTP status client error (404 Not Found) for url (https://*****/repository/packages/requests/2.31.0/requests-2.31.0.tar.gz ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">index</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-15 23:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesgilmorelyst">@jamesgilmorelyst</a> on 2024-02-16 14:21</div>
            <div class="timeline-body"><p>@rcramblit this issue seems to be fixed in 0.1.2 released today after testing myself. Not sure if this version also resolves the main issue of this post.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rcramblit">@rcramblit</a> on 2024-02-16 17:11</div>
            <div class="timeline-body"><p>Confirmed the issue is resolved for me - thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/merc1031">@merc1031</a> on 2024-02-16 20:11</div>
            <div class="timeline-body"><p>Confirmed as well. this bug was fixed!
I hit another one #1528 , but it seems like a new issue</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:29:14 UTC
    </footer>
</body>
</html>
