<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installer requiring glibc 2.31 (even though wheels work with 2.28) - astral-sh/uv #8549</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Installer requiring glibc 2.31 (even though wheels work with 2.28)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8549">#8549</a>
        opened by <a href="https://github.com/gaborbernat">@gaborbernat</a>
        on 2024-10-24 22:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-10-24 22:41</div>
            <div class="timeline-body"><p>When installing on a system with &lt;glibc 2.31 the installer fallbacks to the MUSL installer which is not a thing so install fails.</p>
<p>Fallbacks to MUSL because on RHEL 8:</p>
<pre><code>2024-10-24 15:00:57 |  +++ ldd --version
2024-10-24 15:00:57 |  +++ awk '-F ' '{ if (FNR&lt;=1) print $NF }'
2024-10-24 15:00:57 |  ++ _local_glibc=2.28
2024-10-24 15:00:57 |  +++ echo 2.28
2024-10-24 15:00:57 |  +++ awk -F. '{ print $1 }'
2024-10-24 15:00:57 |  ++ '[' 2 = 2 ']'
2024-10-24 15:00:57 |  +++ echo 2.28
2024-10-24 15:00:57 |  +++ awk -F. '{ print $2 }'
2024-10-24 15:00:57 |  ++ '[' 28 -ge 31 ']'
2024-10-24 15:00:57 |  ++ say 'System glibc version (`2.28'\'') is too old; checking alternatives'
2024-10-24 15:00:57 |  ++ '[' 0 = 0 ']'
2024-10-24 15:00:57 |  ++ echo 'System glibc version (`2.28'\'') is too old; checking alternatives'
2024-10-24 15:00:57 |  System glibc version (`2.28') is too old; checking alternatives
2024-10-24 15:00:57 |  ++ return 1
2024-10-24 15:00:57 |  ++ _archive=
2024-10-24 15:00:57 |  ++ '[' -n '' ']'
2024-10-24 15:00:57 |  ++ _archive=uv-x86_64-unknown-linux-musl.tar.gz
2024-10-24 15:00:57 |  ++ '[' -n uv-x86_64-unknown-linux-musl.tar.gz ']'
2024-10-24 15:00:57 |  ++ echo uv-x86_64-unknown-linux-musl.tar.gz
2024-10-24 15:00:57 |  ++ return 0
2024-10-24 15:00:57 |  + _artifact_name=uv-x86_64-unknown-linux-musl.tar.gz
2024-10-24 15:00:57 |  + local _bins
2024-10-24 15:00:57 |  + local _zip_ext
2024-10-24 15:00:57 |  + local _arch
2024-10-24 15:00:57 |  + case &quot;$_artifact_name&quot; in
2024-10-24 15:00:57 |  + _arch=x86_64-unknown-linux-musl-static


[2024-10-24T22:00:56.907Z] + curl -sSfL https://py-uv.s3.dev.x.com/uv/uv-x86_64-unknown-linux-musl.tar.gz -o /tmp/tmp.zzab088faZ/input.tar.gz
[2024-10-24T22:00:56.907Z] curl: (22) The requested URL returned error: 404
[2024-10-24T22:00:56.907Z] + say 'failed to download https://py-uv.s3.dev.x.com/uv/uv-x86_64-unknown-linux-musl.tar.gz'
</code></pre>
<p>This is even though the installer works with older glibc:</p>
<pre><code class="language-bash">‚ùØ docker run --rm -it artprod.dev.x.com/rhel8:latest
[root@2888284085b0 /]# curl https://py-uv.s3.dev.bcs.x.com/uv-x86_64-unknown-linux-gnu.tar.gz

[root@2888284085b0 /]# tar -xzvf uv.tar.gz
uv-x86_64-unknown-linux-gnu/
uv-x86_64-unknown-linux-gnu/uvx
uv-x86_64-unknown-linux-gnu/uv

[root@2888284085b0 /]# ./uv-x86_64-unknown-linux-gnu/uv --help
An extremely fast Python package manager.

Usage: uv [OPTIONS] &lt;COMMAND&gt;

Commands:
  run      Run a command or script
</code></pre>
<p>After chatting with the axodotdev team, seems this is because astral is using ubuntu 20 to build the release image, which has glibc 2.31 which then gets embeded into the installer script.</p>
<p>They have smarter glibc tracking, see https://blog.axo.dev/2024/08/glibc, but this system is not yet used by astral:</p>
<blockquote>
<p>because they use a particular &quot;hidden feature&quot; to enable some customization we haven't built in yet (around cross compilation, which we are currently working on!</p>
</blockquote>
<p>The cargo-dist team is working on solving this cross compilation gap, but that might take a bit, but we are looking at alternatives.</p>
<p>Related https://github.com/astral-sh/uv/issues/1635</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-24 22:50</div>
            <div class="timeline-body"><p>It seems like what we need here is a way to specify the glibc version ourselves, since we know it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">releases</span> added by @charliermarsh on 2024-10-24 23:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-24 23:02</div>
            <div class="timeline-body"><p>Thanks for catching this. My guess is that this has been a problem ~forever, but it's never been noticed because we just fallback to musl. But in your case, you're not mirroring the musl builds, and so it ends up as a failed install.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-06 22:06</div>
            <div class="timeline-body"><p>I believe this is now fixed by manually setting our glibc versions per-target.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-06 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-01-06 22:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:23 UTC
    </footer>
</body>
</html>
