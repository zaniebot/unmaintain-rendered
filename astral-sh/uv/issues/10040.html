<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv add &quot;uwsgi; platform_system == 'Linux'&quot;  fails when on Windows machine - astral-sh/uv #10040</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv add &quot;uwsgi; platform_system == 'Linux'&quot;  fails when on Windows machine</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10040">#10040</a>
        opened by <a href="https://github.com/jacobthetechy">@jacobthetechy</a>
        on 2024-12-19 20:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jacobthetechy">@jacobthetechy</a></div>
            <div class="timeline-body"><p>I'm very new with this package manager and I am trying to learn how to properly use it by trying to convert old projects to use <code>uv</code>.</p>
<p>I do most of my development work on Windows but deploy on Linux. Most of my projects use the <code>uwsgi</code> package but I do not want it to install on Windows.</p>
<pre><code>uv add &quot;uwsgi; platform_system == 'Linux'&quot;                   
warning: No `requires-python` value found in the workspace. Defaulting to `&gt;=3.12`.
  x Failed to build `uwsgi==2.0.28`
  |-&gt; The build backend returned an error
  `-&gt; Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit code: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
        File &quot;C:\Users\jacobthetechy\AppData\Local\uv\cache\builds-v0\.tmpUMmIEX\Lib\site-packages\setuptools\build_meta.py&quot;, line 334, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;C:\Users\jacobthetechy\AppData\Local\uv\cache\builds-v0\.tmpUMmIEX\Lib\site-packages\setuptools\build_meta.py&quot;, line 304, in _get_build_requires
          self.run_setup()
        File &quot;C:\Users\jacobthetechy\AppData\Local\uv\cache\builds-v0\.tmpUMmIEX\Lib\site-packages\setuptools\build_meta.py&quot;, line 522, in run_setup
          super().run_setup(setup_script=setup_script)
        File &quot;C:\Users\jacobthetechy\AppData\Local\uv\cache\builds-v0\.tmpUMmIEX\Lib\site-packages\setuptools\build_meta.py&quot;, line 320, in run_setup
          exec(code, locals())
        File &quot;&lt;string&gt;&quot;, line 3, in &lt;module&gt;
        File &quot;C:\Users\jacobthetechy\AppData\Local\uv\cache\sdists-v6\pypi\uwsgi\2.0.28\IcmJI-FyWg16K1hit9AeZ\src\uwsgiconfig.py&quot;, line 8, in &lt;module&gt;
          uwsgi_os = os.uname()[0]
                     ^^^^^^^^
      AttributeError: module 'os' has no attribute 'uname'. Did you mean: 'name'?

      hint: This usually indicates a problem with the package or the build environment.
  help: `uwsgi` (v2.0.28) was included because `new_project` (v0.1.0) depends on `uwsgi`
</code></pre>
<p>From this <a href="https://github.com/astral-sh/uv/issues/3308#issuecomment-2521163807">issue comment</a> I followed the build failure guided a little checked how pip would attempt to install.</p>
<pre><code>pip install --use-pep517 &quot;uwsgi; platform_system == 'Linux'&quot; 
Ignoring uwsgi: markers 'platform_system == &quot;Linux&quot;' don't match your environment
</code></pre>
<p>I expected <code>uv</code> to follow this behavior, but if there is a proper way to add <code>uwsgi</code> as a dependency without it failing on Windows I am open to learn.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-20 00:05</div>
            <div class="timeline-body"><p>If you use <code>uv add</code>, we need to resolve your dependencies for all possible environments. So we still need to resolve it, even if it's not going to be <em>installed</em> on the current platform. And in this case, that appears to mean that we have to build it.</p>
<p>You can add this to your <code>pyproject.toml</code> to skip the build and instead pre-define the metadata:</p>
<pre><code class="language-toml">[[tool.uv.dependency-metadata]]
name = &quot;uwsgi&quot;
version = &quot;2.0.28&quot;
requires-dist = []
</code></pre>
<p>See: https://docs.astral.sh/uv/concepts/resolution/#dependency-metadata</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-12-20 00:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by @charliermarsh on 2024-12-20 00:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jacobthetechy">@jacobthetechy</a> on 2024-12-20 00:46</div>
            <div class="timeline-body"><p>Okay, that makes sense. Thanks for help!</p>
<p>Is there a better/preferred method then manually adding the metadata?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-20 00:49</div>
            <div class="timeline-body"><p>The best would be if the package was updated to report static metadata via a <code>pyproject.toml</code> file, but in the absence of that, there aren't great options unfortunately!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-20 00:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:59 UTC
    </footer>
</body>
</html>
