```yaml
number: 13572
title: "`uv export` does not respect custom index setting from `[tool.uv.sources]` when exporting to `requirements.txt`"
type: issue
state: open
author: ShIRannx
labels: []
assignees: []
created_at: 2025-05-21T11:47:15Z
updated_at: 2025-09-08T16:50:58Z
url: https://github.com/astral-sh/uv/issues/13572
synced_at: 2026-01-10T01:57:31Z
```

# `uv export` does not respect custom index setting from `[tool.uv.sources]` when exporting to `requirements.txt`

---

_Issue opened by @ShIRannx on 2025-05-21 11:47_

# `uv export` does not respect custom index setting from `[tool.uv.sources]` when exporting to `requirements.txt`

## Description

When using a custom index via `[[tool.uv.index]]` and mapping it in `[tool.uv.sources]`, the `uv export` command does not include the associated source in the exported `requirements.txt`.

## Example `pyproject.toml`

```toml
[project]
dependencies = [ "example-package>=0.1.dev4" ]

[[tool.uv.index]]
name = "example"
url = "https://example.com/simple"
explicit = true

[tool.uv.sources]
example = { index = "example" }
````

## Command Used

```bash
uv export --quiet --group dev --all-extras --format requirements-txt --output-file requirements.txt
```

## Resulting `requirements.txt`

```text
example-package==$uv-resolved-version \
    --hash=sha256:... \
    --hash=sha256:...
```

## Expected Output

I expected the export to also include the index URL pointing to the custom source, e.g.:

```text
example-package @ https://example.com/packages/$uv-resolved-package.whl \
    --hash=sha256:... \
    --hash=sha256:...
```

---

_Comment by @charliermarsh on 2025-05-21 11:48_

This is working as intended. There's no way to model explicitly pinned indexes in requirements.txt -- it's just not possible, the format isn't powerful enough. You should consider `-o pylock.toml` if you want to respect pins. What you've pasted above would in theory work for the wheel file, but `example-package` will have _multiple_ files that represent the package-version (e.g., there's also a source distribution), hence multiple hashes.

---

_Comment by @doctorpangloss on 2025-05-21 15:57_

for practical purposes though, `requirements.txt` is being used to install "the right things," not to model metadata for a package manager.

So what the user wants is really: `uv export --format requirements.txt` should produce a file where `pip install -r requirements.txt` will put the same packages into `site-packages` of a venv as `uv sync` does on this machine.

---

_Comment by @NellyWhads on 2025-05-25 21:26_

I think for this use case, the user would also need to specify the environment markers for a proper slice of the locked packages as well.

---

_Referenced in [terraform-aws-modules/terraform-aws-lambda#673](../../terraform-aws-modules/terraform-aws-lambda/issues/673.md) on 2025-07-02 09:47_

---

_Comment by @rzuckerm on 2025-09-08 15:57_

I also have a use-case for this where I need to export requirements to a `requirements.txt` file and have multiple internal pypi indexes. The way `poetry export` handles this is to add these lines to the top of the `requirements.txt` file:
```
--index-url https://internal-server1/internal-server1-path-to-pypi
--extra-index-url https://internal-server1/internal-server2-path-to-pypi
```
I did this experiment:
- Create initial project with `uv init <project>`
- `cd /path/to/project`
- Add two internal indexes to the `pyproject.toml` file using `[[tool.uv.index]]`, where the first one is set to `default = true`
- Add a package from each internal index using `uv add`
- Run `uv export -q --format requirements.txt --output-file dist/requirements.txt --no-hashes --no-header --no-annotate --no-dev --no-emit-project`
- Manually add `--index-url` and `--extra-index-url` lines to the top of  `dist/requirements.txt`
- `cd /tmp`
- `virtualenv venv`
- `. venv/bin/activate`
- `pip install -r /path/to/project/dist/requirements.txt`

It seems to work: no complaints from `pip`, and downloads occur from the appropriate indexes.

---

_Comment by @konstin on 2025-09-08 16:21_

The different between the pip index support and the uv index support is that uv allows pinning an index only for a specific index, while in pip an index is always checked for all packages (with priorities).

---

_Comment by @rzuckerm on 2025-09-08 16:50_

> The different between the pip index support and the uv index support is that uv allows pinning an index only for a specific index, while in pip an index is always checked for all packages (with priorities).

I tried a similar experiment where I took the modified `requirements.txt` and used uv to create the virtualenv and install the dependencies:

- `cd /tmp`
- `uv venv /tmp/venv2`
- `. /tmp/venv2/bin/activate`
- `uv pip install -r /path/to/project/dist/requirements.txt`

That works, too, even if I clear the uv cache (`rm -rf ~/.cache/uv`) before doing the above.

---

_Referenced in [bentoml/BentoML#5466](../../bentoml/BentoML/issues/5466.md) on 2025-09-12 09:52_

---
