<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confusing error message when a constraint is the cause of not finding a version - astral-sh/uv #2065</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Confusing error message when a constraint is the cause of not finding a version</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/2065">#2065</a>
        opened by <a href="https://github.com/notatallshaw">@notatallshaw</a>
        on 2024-02-29 00:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/notatallshaw">@notatallshaw</a></div>
            <div class="timeline-body"><p>Environment: Linux Python 3.10.13 uv 0.1.12</p>
<p>Steps to reproduce:</p>
<ol>
<li><code>wget https://raw.githubusercontent.com/apache/airflow/constraints-2.3.4/constraints-3.10.txt</code></li>
<li><code>echo &quot;apache-airflow==2.3.4&quot; | uv pip compile - --constraint constraints-3.10.txt</code></li>
</ol>
<p>Error:</p>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of exceptiongroup==1.0.0rc8 and cattrs==22.1.0 depends on exceptiongroup==1.0.0rc8, we can conclude that
      cattrs==22.1.0 cannot be used.
      And because apache-airflow==2.3.4 depends on cattrs==22.1.0 and you require apache-airflow==2.3.4, we can conclude that the requirements
      are unsatisfiable.

      hint: exceptiongroup was requested with a pre-release marker (e.g., exceptiongroup==1.0.0rc8), but pre-releases weren't enabled (try:
      `--prerelease=allow`)
</code></pre>
<p>This is confusing because <code>cattrs==22.1.0</code> doesn't depend only on <code>exceptiongroup==1.0.0rc8</code> and further <code>apache-airflow==2.3.4 </code> does not depend only on <code>cattrs==22.1.0</code>, as you will see if you compie  <code>apache-airflow==2.3.4</code>  or <code>cattrs==22.1.0</code> or both of them together.</p>
<p>There is no mention that it is a user constraint which caused this failure, I beleive pip does mention when a top level user requirement or constraint caused the failure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @charliermarsh on 2024-02-29 01:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 02:15</div>
            <div class="timeline-body"><p>Ah interesting, thanks for the report!</p>
<p>I'm not entirely sure why these constraints are not represented in the resolver (and subsequently the error report).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/potiuk">@potiuk</a> on 2024-03-02 08:25</div>
            <div class="timeline-body"><p>Interesting is that while the message is confusing, the hint is correct in this case - adding <code>--prerelease allow</code> fixes the problem and gives the information why <code>uv</code> concludes that it's cattrs.</p>
<ul>
<li>root cause is that airflow constraints for 2.3.4 contain exceptiongroup==1.0.0rc8 (the constraints were generated when there was no 1.0.0 and &gt;= 1.0.0rc8 is coming from pytest actually, not cattrs)</li>
</ul>
<p>When you run the <code>pip compile</code> above with <code>--prerelease allow</code> - it will produce the right output and part of it is</p>
<pre><code>exceptiongroup==1.0.0rc8
    # via cattrs
</code></pre>
<ul>
<li>apparently <code>uv</code> <strong>thinks</strong> that it's cattrs that caused exceptiongroup problem, but in this case it's the constraint file that contributed the <code>prerelese</code> version.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-03-02 14:27</div>
            <div class="timeline-body"><p>Don't focus on the prerelease part of the error, I've reported that separately and it's already fixed: https://github.com/astral-sh/uv/issues/2063</p>
<p>After the next release of uv I'll see if I can come up with another example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-03-04 23:51</div>
            <div class="timeline-body"><p>Okay, now there's a release with the other fix my steps to reproduce don't work. Here are a new set of steps to reproduce:</p>
<p>Environment: Linux Python 3.10.13 uv 0.1.14</p>
<ol>
<li><code>wget https://raw.githubusercontent.com/apache/airflow/constraints-2.3.4/constraints-3.10.txt</code></li>
<li>Edit <code>constraints-3.10.txt</code> and replace <code>pendulum==2.1.2</code> with <code>pendulum==1.0.0</code></li>
<li><code>echo &quot;apache-airflow==2.3.4&quot; | uv pip compile - --constraint constraints-3.10.txt</code></li>
</ol>
<p>You get the error:</p>
<pre><code>$ echo &quot;apache-airflow==2.3.4&quot; | uv pip compile - --constraint constraints-3.10.txt
  × No solution found when resolving dependencies:
  ╰─▶ Because apache-airflow==2.3.4 depends on pendulum&gt;=2.0 and apache-airflow==2.3.4 depends on pendulum==1.0.0, we can conclude that apache-airflow==2.3.4 cannot be used.
      And because you require apache-airflow==2.3.4, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>The confusing part is <code>apache-airflow==2.3.4 depends on pendulum==1.0.0</code> without mentioning that <code>pendulum==1.0.0</code> comes from the constraints. It would be more confusing if pendulum was a more distant transitive dependency.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:05 UTC
    </footer>
</body>
</html>
