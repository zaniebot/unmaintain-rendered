<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build error on AIX: libc::FIONREAD: expected i32, found i64 - astral-sh/uv #15128</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Build error on AIX: libc::FIONREAD: expected i32, found i64</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15128">#15128</a>
        opened by <a href="https://github.com/mrichter-vw">@mrichter-vw</a>
        on 2025-08-07 11:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mrichter-vw">@mrichter-vw</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Mainly a bug in dependencies but to track the fix in uv itself. The libc bug will be fixed in next version. See Links down below.</p>
<pre><code># also happens by appending--release
$ cargo build --offline
[...]
   Compiling jobserver v0.1.33
error[E0308]: mismatched types
    --&gt; /data/rust/uv-0.8.5/vendor/jobserver/src/unix.rs:356:57
     |
356  |         cvt(unsafe { libc::ioctl(self.read.as_raw_fd(), libc::FIONREAD, len.as_mut_ptr()) })?;
     |                      -----------                        ^^^^^^^^^^^^^^ expected `i32`, found `i64`
     |                      |
     |                      arguments to this function are incorrect
     |
note: function defined here
    --&gt; /data/rust/uv-0.8.5/vendor/libc/src/unix/aix/mod.rs:2994:12
     |
2994 |     pub fn ioctl(fildes: c_int, request: c_int, ...) -&gt; c_int;
     |            ^^^^^
help: you can convert an `i64` to an `i32` and panic if the converted value doesn't fit
     |
356  |         cvt(unsafe { libc::ioctl(self.read.as_raw_fd(), libc::FIONREAD.try_into().unwrap(), len.as_mut_ptr()) })?;
     |                                                                       ++++++++++++++++++++

   Compiling hashbrown v0.15.4
For more information about this error, try `rustc --explain E0308`.
error: could not compile `jobserver` (lib) due to 1 previous error
warning: build failed, waiting for other jobs to finish...
</code></pre>
<ul>
<li>Issue in jobserver-rs: https://github.com/rust-lang/jobserver-rs/issues/112</li>
<li>PR in libc: https://github.com/rust-lang/libc/pull/4582</li>
</ul>
<h3>Platform</h3>
<p>AIX</p>
<h3>Version</h3>
<p>0.8.5</p>
<h3>Python version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mrichter-vw on 2025-08-07 11:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @zanieb on 2025-08-07 13:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-07 13:05</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-08-19 10:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:32:31 UTC
    </footer>
</body>
</html>
