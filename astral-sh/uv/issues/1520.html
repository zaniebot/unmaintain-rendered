<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No keyring support for authentication - astral-sh/uv #1520</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>No keyring support for authentication</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1520">#1520</a>
        opened by <a href="https://github.com/AngellusMortis">@AngellusMortis</a>
        on 2024-02-16 18:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AngellusMortis">@AngellusMortis</a> on 2024-02-16 18:05</div>
            <div class="timeline-body"><p>It appears <code>uv</code> does not have support for keyring like pip does.</p>
<p>https://pip.pypa.io/en/stable/topics/authentication/#keyring-support</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-02-16 18:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2024-02-16 18:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 18:53</div>
            <div class="timeline-body"><p>This seems reasonable. We'll need to find a Rust equivalent to https://pypi.org/project/keyring/</p>
<p>Perhaps https://github.com/hwchen/keyring-rs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AngellusMortis">@AngellusMortis</a> on 2024-02-16 18:57</div>
            <div class="timeline-body"><p>keyring is a cli app already. Probably want to add support for existing Python one first to maximize compatibility. Different auth methods need different plugins. AWS, Azure and Google Cloud each have their own plugins to use the more secure auth methods (no username/password).</p>
<p>Then you could migrate to a native only solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chris-hartfield">@chris-hartfield</a> on 2024-02-16 20:43</div>
            <div class="timeline-body"><p>Agreed that calling the cli is probably easiest.  The cli equivalent of what pip is calling in python is really simple: <code>keyring get &lt;url&gt; &lt;username_which_is_often_empty&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/judahrand">@judahrand</a> on 2024-02-21 15:01</div>
            <div class="timeline-body"><blockquote>
<p>Agreed that calling the cli is probably easiest. The cli equivalent of what pip is calling in python is really simple: <code>keyring get &lt;url&gt; &lt;username_which_is_often_empty&gt;</code></p>
</blockquote>
<p><code>pip</code> does already actually directly call the CLI tool if <code>keyring</code> isn't installed in the Python environment but is available on <code>PATH</code> or <code>--keyring-provider subprocess</code> is passed - so this behaviour would be consistent.</p>
<p>https://pip.pypa.io/en/stable/topics/authentication/#using-keyring-as-a-command-line-application</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-21 15:24</div>
            <div class="timeline-body"><p>Thanks for the details! Much appreciated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-02-21 15:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/judahrand">@judahrand</a> on 2024-02-22 08:59</div>
            <div class="timeline-body"><blockquote>
<p>This seems reasonable. We'll need to find a Rust equivalent to https://pypi.org/project/keyring/</p>
<p>Perhaps https://github.com/hwchen/keyring-rs</p>
</blockquote>
<p>I'd also discourage this approach. There are many Python plugins to <code>keyring</code> for various cloud hosted private Pypi registries (eg. Google Artifact Registry, Azure DevOps, etc). I imagine these would be incompatible with <code>keyring-rs</code> and so you'd lose a lot of the benefit of the <code>keyring</code> integration unless all of these plugins were also reimplemented.</p>
<p>https://github.com/Microsoft/artifacts-keyring
https://github.com/GoogleCloudPlatform/artifact-registry-python-tools</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BakerNet">@BakerNet</a> on 2024-03-14 00:20</div>
            <div class="timeline-body"><p>As of #2254 <code>--keyring-provider subprocess</code> is available.  It has been tested on at least two Google artifact registry projects (using <a href="https://cloud.google.com/artifact-registry/docs/python/authentication#keyring">keyrings.google-artifactregistry-auth</a> plugin) as working.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-03-14 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonataseduardo">@jonataseduardo</a> on 2024-10-08 11:55</div>
            <div class="timeline-body"><p>Sorry for continuing on this topic, but I'm trying to create a <code>uv</code> project that uses an <code>--extra-index-url</code> with Google Cloud Artifact Registry. However, it returns an error indicating that my package can't be found.  I am using <code>uv 0.4.18</code></p>
<p>Here's what I've tried so far:</p>
<pre><code>  gcloud auth application-default login --project ${PROJECT_ID}                      
  uv venv
  source .venv/bin/activate
  uv pip install keyring keyrings.google-artifactregistry-auth
  uv pip install --keyring-provider subprocess ${MY_PACKAGE} --extra-index-url https://${REGION}-python.pkg.dev/${PROJECT_ID}/${REPOSITORY_ID}/simple                            
</code></pre>
<p>Interestingly, when I use standard pip, I can install my private package without any issues. Here's the code that works:</p>
<pre><code>  gcloud auth application-default login --project ${PROJECT_ID}                      
  python -m venv .venv
  source .venv/bin/activate
  pip install keyring keyrings.google-artifactregistry-auth
  pip install ${MY_PACKAGE} --extra-index-url https://${REGION}-python.pkg.dev/${PROJECT_ID}/${REPOSITORY_ID}/simple                            
</code></pre>
<p>Am I  missing something? Any help would be appreciated!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ffissore">@ffissore</a> on 2024-10-08 13:25</div>
            <div class="timeline-body"><p>Try <code>--extra-index-url=https://oauth2accesstoken@${REGION}...</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonataseduardo">@jonataseduardo</a> on 2024-10-08 14:25</div>
            <div class="timeline-body"><blockquote>
<p>Try <code>--extra-index-url=https://oauth2accesstoken@${REGION}...</code></p>
</blockquote>
<p>Thanks, it  worked when I used this command:</p>
<pre><code>uv pip install ${MY_PACKAGE} --extra-index-url https://oauth2accesstoken:$(gcloud auth print-access-token)@${REGION}-python.pkg.dev/${PROJECT_ID}/${REPOSITORY_ID}/simple
</code></pre>
<p>Does this not defeat the purpose of using a keyring?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-08 14:31</div>
            <div class="timeline-body"><p>@jonataseduardo keyring requires a username to retrieve a password via the CLI â€” you can just provide the username in the index URL you don't need to include the token too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonataseduardo">@jonataseduardo</a> on 2024-10-08 14:52</div>
            <div class="timeline-body"><p>Sure!</p>
<p>The command</p>
<pre><code>uv pip install ${MY_PACKAGE} --keyring-provider subprocess --extra-index-url https://oauth2accesstoken@${REGION}-python.pkg.dev/${PROJECT_ID}/${REPOSITORY_ID}/simple
</code></pre>
<p>worked. I had forgotten to include the <code>--keyring-provider subprocess</code> in my last attempt.</p>
<p>It would be helpful to include something like the following in the documentation:</p>
<pre><code>  gcloud auth application-default login --project ${PROJECT_ID}                      
  uv venv
  source .venv/bin/activate
  uv pip install keyring keyrings.google-artifactregistry-auth
  uv pip install --keyring-provider subprocess ${MY_PACKAGE} --extra-index-url https://oauth2accesstoken@${REGION}-python.pkg.dev/${PROJECT_ID}/${REPOSITORY_ID}/simple                              
</code></pre>
<p>Thanks a lot!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hcoona">@hcoona</a> on 2025-02-11 00:03</div>
            <div class="timeline-body"><p>Oh gosh! I find so many places to get it work. We should update our document for it, especially that we must add an arbitrary username for the index URL to make it work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MXWest">@MXWest</a> on 2025-03-09 14:21</div>
            <div class="timeline-body"><p>Perhaps this may help someone in future. Perhaps that someone will be me.</p>
<p>I am using <code>uv 0.6.5 (Homebrew 2025-03-06)</code></p>
<p>The docs as of 9 March 2025 indicate that you should install like this:</p>
<pre><code># Pre-install keyring and Artifact Registry plugin from the public PyPI
uv tool install keyring --with keyrings.google-artifactregistry-auth

# Enable keyring authentication
export UV_KEYRING_PROVIDER=subprocess

# Set the username for the index
export UV_INDEX_PRIVATE_REGISTRY_USERNAME=oauth2accesstoken
</code></pre>
<p>This <strong>does not work</strong>.</p>
<p>I replaced the line
<code>uv tool install keyring --with keyrings.google-artifactregistry-auth</code></p>
<p>with
<code>uv pip install keyring keyrings.google-artifactregistry-auth</code></p>
<hr />
<p>Here's the full installation script I used to test out my scenario:</p>
<pre><code># Pre-install keyring and Artifact Registry plugin from the public PyPI
source venv/bin/activate
#uv tool install keyring --with keyrings.google-artifactregistry-auth
uv pip install keyring keyrings.google-artifactregistry-auth

# Enable keyring authentication
export UV_KEYRING_PROVIDER=subprocess

# Set the username for the index
export UV_INDEX_PRIVATE_REGISTRY_USERNAME=oauth2accesstoken

UV_LOG=debug uv -v pip install -r requirements.txt
</code></pre>
<p>Here's the <code>pyproject.toml</code>:</p>
<pre><code>[[tool.uv.index]]
# Optional name for the index.
name = &quot;private-registry&quot;
# Required URL for the index.
url = &quot;https://us-central1-python.pkg.dev/path-to-my-private-pypi/simple&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-09 15:38</div>
            <div class="timeline-body"><p>I'm not sure I see why <code>uv tool install</code> wouldn't work, unless you also have keyring installed in an active virtual environment and it's shadowing the global one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ridho-y">@ridho-y</a> on 2025-04-15 05:32</div>
            <div class="timeline-body"><p>@MXWest Thank you so much! Confirming this solution works for AWS CodeArtifact as well. I'm using <code>uv 0.6.2</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arthurlaquieze">@arthurlaquieze</a> on 2025-04-29 10:18</div>
            <div class="timeline-body"><p>@zanieb hey</p>
<p>I had a hard time getting it to work with <code>uv tool install</code> inside docker:</p>
<p>`
RUN uv tool install keyring --with keyrings.google-artifactregistry-auth</p>
<p>RUN --mount=type=cache,target=/root/.cache/uv <br />
--mount=type=secret,id=gcp_credentials,target=/run/secrets/gcp_credentials <br />
GOOGLE_APPLICATION_CREDENTIALS=/run/secrets/gcp_credentials <br />
UV_KEYRING_PROVIDER=subprocess <br />
UV_INDEX_INTERNAL_GAR_PYPI_USERNAME=oauth2accesstoken <br />
uv --verbose sync --frozen --no-install-project
`</p>
<p>using <code>uv:0.6.17</code> and <code>ubuntu:22.04</code> base image</p>
<p>logs :</p>
<p>2.225 DEBUG Checking keyring for credentials for oauth2accesstoken@https://europe-python.pkg.dev/.../hatchling/hatchling-1.27.0-py3-none-any.whl
2.225 WARN Failure running <code>keyring</code> command: No such file or directory (os error 2)</p>
<p>Solution I have is <strong>adding the tools directory to PATH</strong>, in my case</p>
<p><code>ENV PATH=&quot;/root/.local/bin:$PATH&quot;</code></p>
<p>I think this should be emphasized in the keyring install procedure for alternative indexes, especially for those who use this inside docker, in https://docs.astral.sh/uv/guides/integration/alternative-indexes/#authenticate-with-keyring-and-keyringsgoogle-artifactregistry-auth</p>
<p>And it could be better highlighted in the tools docs https://docs.astral.sh/uv/guides/tools/#installing-tools</p>
<p>@MXWest you can try that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-30 13:30</div>
            <div class="timeline-body"><p>This is at https://docs.astral.sh/uv/guides/integration/docker/#using-installed-tools and a warning is displayed during tool install if it's not included on the <code>PATH</code>. I'm not sure exactly where we'd want to highlight it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/herman-rogers">@herman-rogers</a> on 2025-05-16 20:20</div>
            <div class="timeline-body"><p>Not sure if it's in the docs somewhere but I was able to get this to work in a slightly different way mostly because we use google's federated identities (inside of github actions) so I couldn't use the application default credentials (and wanted it to work across envs):</p>
<pre><code class="language-sh"> uv add my_package --keyring-provider subprocess --index https://&lt;REGION&gt;-python.pkg.dev/&lt;PROJECT&gt;/&lt;LIB&gt;/simple/
</code></pre>
<p>This will add it to the uv.lock file, it also adds a index in the pyproject.toml but I removed this (I think I can just use --extra-index-url but that's what I ran first, in any case).</p>
<p>Then I setup my pyproject.toml as:</p>
<pre><code class="language-yaml">[tool.uv]
keyring-provider = &quot;subprocess&quot;
extra-index-url = [
    &quot;https://oauth2accesstoken@&lt;REGION&gt;-python.pkg.dev/&lt;PROJECT&gt;/&lt;LIB&gt;/simple/&quot;,
    &quot;https://&lt;REGION&gt;-python.pkg.dev/&lt;PROJECT&gt;/&lt;LIB&gt;/simple/&quot;
]
</code></pre>
<p>This one is a bit goofy - basically I'm just adding the keyring provider twice but Windows refused to work with only the oauth2accesstoken and Linux servers (github actions) refused to work without oauth2accesstoken. So I added both as fall backs. Mac OS and Linux didn't seem to care much for local installs.</p>
<p>Then inside of each project (and github actions) I just installed the tool which allowed me to run library syncs:</p>
<pre><code class="language-sh">uv tool install keyring --with keyrings.google-artifactregistry-auth
uv sync --all-extras --dev
</code></pre>
<p>I tried setting the environment variables above to get rid of the oauth2accesstoken section of the URLs but for whatever reason it didn't seem to like it if I had installed the google artifact library with uv add (so from the lock file). In any case this worked with federated auth + default application credentials (locally).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DevJake">@DevJake</a> on 2025-06-14 17:54</div>
            <div class="timeline-body"><p>Just chipping in to this with my Dockerfile contents, as I found this somewhat confusing as per the docs:</p>
<pre><code class="language-Dockerfile">FROM ghcr.io/astral-sh/uv:0.7.13-python3.11-bookworm-slim AS builder

WORKDIR /app

# Install build dependencies
RUN apt-get update &amp;&amp; apt-get install -y \
    build-essential \
    gcc \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

ENV PATH=&quot;/root/.local/bin:$PATH&quot;
ENV PATH=&quot;/app/.venv/bin:$PATH&quot;

# Compile the Python `.py` files to `.pyc` bytecode files
ENV UV_COMPILE_BYTECODE=1
# Copy the installed dependencies to the image, rather than linking them
ENV UV_LINK_MODE=copy
ENV UV_KEYRING_PROVIDER=subprocess
ENV UV_INDEX_INTERNAL_GAR_PYPI_USERNAME=oauth2accesstoken

RUN uv tool install keyring --with keyrings.google-artifactregistry-auth

# Install the dependencies, without modifying the lock file. Do not install the project itself
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    --mount=type=secret,id=gcp_credentials,target=/run/secrets/gcp_credentials \
    GOOGLE_APPLICATION_CREDENTIALS=/run/secrets/gcp_credentials \
    uv sync --locked --no-install-project --no-dev

COPY src pyproject.toml uv.lock README.md /app

RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=secret,id=gcp_credentials,target=/run/secrets/gcp_credentials \
    GOOGLE_APPLICATION_CREDENTIALS=/run/secrets/gcp_credentials \
    uv sync --locked --no-dev

# Reset the `uv` entrypoint
ENTRYPOINT []

CMD [&quot;your&quot;, &quot;startup&quot;, &quot;command&quot;]
</code></pre>
<p>And, this snippet from my <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;gcp&quot;
url = &quot;https://oauth2accesstoken@&lt;REGION&gt;-python.pkg.dev/&lt;PROJECT-ID&gt;/&lt;REPOSITORY-NAME&gt;/simple/&quot;


[tool.uv]
keyring-provider = &quot;subprocess&quot;
</code></pre>
<p>To build this, you'll need a GCP Service Account private key saved to a local <code>.json</code> file, for example, <code>gcp-key.json</code>:</p>
<pre><code>docker build . --secret id=gcp_credentials,src=gcp-key.json
</code></pre>
<p>I hope this is able to help someone!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:34:55 UTC
    </footer>
</body>
</html>
