<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Headache: dev dependencies (private) are resolved when not included - astral-sh/uv #10201</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Workflow Headache: dev dependencies (private) are resolved when not included</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10201">#10201</a>
        opened by <a href="https://github.com/ayjayt">@ayjayt</a>
        on 2024-12-27 17:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ayjayt">@ayjayt</a></div>
            <div class="timeline-body"><p>Hi!</p>
<p>Sometimes my dev dependencies come from private repos, and therefore they can&#x27;t be resolved in all workflows:</p>
<ul>
<li>during normal usage</li>
<li>during CI testing</li>
</ul>
<p>for example</p>
<p><code>uv</code> seems to try and resolve all dependency groups even if they&#x27;re not included. :-)</p>
<p>Just posting this here to start a discussion!</p>
<p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2024-12-27 17:58</div>
            <div class="timeline-body"><p>Dependencies in <code>dev</code> group get <a href="https://docs.astral.sh/uv/concepts/projects/dependencies/#default-groups">resolved by default</a>:</p>
<blockquote>
<p>By default, uv includes the dev dependency group in the environment (e.g., during uv run or uv sync). The default groups to include can be changed using the tool.uv.default-groups setting.</p>
<pre><code>[tool.uv]
default-groups = [&quot;dev&quot;, &quot;foo&quot;]
</code></pre>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayjayt">@ayjayt</a> on 2024-12-27 18:10</div>
            <div class="timeline-body"><p>Hi @T-256, <strong>all dependencies get <em>resolved</em> ~by default~ everytime</strong>, even if they are not actually downloaded and installed (ie <em>included</em>). This is not documented, but it is the actual implemented behavior.</p>
<p>You can test this by creating a nonsense group with a nonsense dependency and then explicitly telling it not to be installed.</p>
<pre><code># pyroject.toml

[dependency-groups]
foo = [
    &quot;bar_does_not_exists&quot;
]
</code></pre>
<p><code>uv sync --no-group foo</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 22:15</div>
            <div class="timeline-body"><p>Yeah, it&#x27;s intentional that we always resolve all groups. If you have workflows where you need to use your project without resolving those groups, you should be able to <code>uv run</code> without re-resolving, as long as you have a <code>uv.lock</code> checked in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 22:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayjayt">@ayjayt</a> on 2024-12-27 23:59</div>
            <div class="timeline-body"><p>I feel I don&#x27;t understand the implementation of <code>uv run</code> and <code>uv.lock</code> well enough to comment, but my understanding is that:</p>
<p>if there is an updated <code>uv.lock</code> checked in to the <strong>git repo</strong> , <code>uv run</code> will skip the resolving phase and use whatever is in <code>uv.lock</code>, even if the dependencies impossible to resolve were added after the <code>uv.lock</code> was checked in?</p>
<p>Is there some kind of contribution I could make to provide a solution by which certain dependency groups could be entirely ignored by <code>uv</code>?</p>
<p>Such as a</p>
<pre><code>[tool.uv]
ignore-groups = [&quot;nickelback&quot;, &quot;phish&quot;]
</code></pre>
<p>~It would also roll into my other issue: <a href="https://github.com/astral-sh/uv/issues/10200">astral-sh/uv#10200</a>#issuecomment-2564096152~</p>
<p>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schloerke">@schloerke</a> on 2025-01-22 16:28</div>
            <div class="timeline-body"><blockquote>
<p>it&#x27;s intentional that we always resolve all groups</p>
</blockquote>
<p>Maybe I&#x27;m missing something, but when calling <code>uv</code> command where I&#x27;ve explicitly asked for an extra group (<code>--group foo</code>) or to ignore a group (<code>--no-group foo</code>) then I&#x27;d expect it to only attempt to resolve those tangible groups. Only the groups required for execution should be used for dependency resolution.</p>
<p>My interpretation of the groups is that if I stated <code>uv sync --no-group foo</code> with the pyproject.toml above, I&#x27;d expect it to have the same behavior as <code>[dependency-group]</code> project file which has called <code>uv sync</code>.</p>
<p>Crafting a <code>uv.lock</code> file manually doesn&#x27;t seem like a long term solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-22 16:35</div>
            <div class="timeline-body"><p>We resolve all groups and use a shared resolution for the project (stored in <code>uv.lock</code>). Selecting groups only applies to which subset of the lockfile is synced. This is a fundamental behavior of uv — we&#x27;re not likely to change it. I understand why it&#x27;d be nice to avoid resolving those groups in some cases, but it&#x27;s not realistic for us to implement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-22 16:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayjayt">@ayjayt</a> on 2025-01-22 18:00</div>
            <div class="timeline-body"><p>Yeah I took a look at your source code and realized it would be difficult, so I switched to commenting them out.</p>
<p>I think there could be such a thing as &quot;explicit groups&quot; that would only ever been included if they were explicitly asked to be included. I think that would play nicely with the &quot;fork&quot; concepts that was recently implemented in the conflicts PR.</p>
<p>If you view your program as a pipeline from</p>
<p><code>specification (pyproject.toml)  --&gt; lock file (uv.lock) --&gt; environment (.venv)</code></p>
<p>I think that model could incorporate this idea, and the &quot;explicit groups&quot; would be ignored between any edge unless explicitly included.</p>
<p>That said, I realize you have a lot to deal with, as do I, I wish I had time to make contribution, and I appreciate the work you&#x27;ve done on the project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayjayt">@ayjayt</a> on 2025-01-22 18:06</div>
            <div class="timeline-body"><p>@schloerke I agree with you, but consider this:</p>
<p>Some development dependencies <strong>may be used by certain users or not</strong> and therefore uv, in its effort to alert the developer of conflicts, should also execute the resolution algorithm against all dependencies in order to determine where conflicts would exist within the deployment.</p>
<p>Also, the <code>uv.lock</code> is also a cache for the results of this algorithm. So it should contain all possible states.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-22 18:15</div>
            <div class="timeline-body"><p>Yeah we&#x27;d need to resolve them in combination with the other groups and project because they <em>could</em> be installed together. The main thing we could do is add support for <em>only</em> using a group in isolation — so only <code>uv sync --only-group foo</code> would be allowed.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:25 UTC
    </footer>
</body>
</html>
