<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow environment variables expansion in `pyproject.toml` - astral-sh/uv #10096</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow environment variables expansion in <code>pyproject.toml</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/10096">#10096</a>
        opened by <a href="https://github.com/ShaiAvr">@ShaiAvr</a>
        on 2024-12-22 15:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ShaiAvr">@ShaiAvr</a></div>
            <div class="timeline-body"><p>A feature I'd really like to see implemented is the ability to expand environment variables in the <code>pyproject.toml</code> file. My use-case is as follows: I am working on a library to simplify my work on other projects. In the future, I'd like to publish the library to PyPi. When I work on my projects, however, I want to use my library as a local editable dependency so I can quickly make changes and see them applied. So I have an example project with the following <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;demo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;my-lib&quot;,
]

[tool.uv.sources]
my-lib = { path = &quot;/path/to/my/library/my-lib&quot;, editable = true }
</code></pre>
<p>The problem is I am using an absolute path for my library, so I need to modify it if I work on multiple computers, and it's not something I'd want to push to GitHub. A better solution would be to have an environment variable that defines the location of the library on my local machine: <code>MY_LIB_PATH=&quot;/path/to/my/library/my-lib&quot;</code>. That way, I can define the environment variable as necessary on different machines and my <code>pyproject.toml</code> file will simply use this variable:</p>
<pre><code class="language-toml">[project]
name = &quot;demo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;my-lib&quot;,
]

[tool.uv.sources]
my-lib = { path = &quot;${MY_LIB_PATH}&quot;, editable = true }
</code></pre>
<p>This isn't possible at the moment, and I think expanding environment variables in the <code>pyproject.toml</code> file could solve my use case and other similar use cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woutervh">@woutervh</a> on 2024-12-23 13:26</div>
            <div class="timeline-body"><p>I would reference a local symlink  src/my-lib  --&gt; /absolute/path/to/my-lib</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ShaiAvr">@ShaiAvr</a> on 2024-12-24 21:55</div>
            <div class="timeline-body"><p>@woutervh I donâ€™t think a symbolic link should be uploaded to git. The contents of the link wonâ€™t be portable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-12-26 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 14:33</div>
            <div class="timeline-body"><p>Similar (but not identical) to #5734.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-12-26 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dpnova">@dpnova</a> on 2025-01-08 05:15</div>
            <div class="timeline-body"><p>would love to be able to do something like this:</p>
<pre><code class="language-toml">[tool.uv.sources]
foo = { git = &quot;https://${GITHUB_TOKEN}@github.com/fooco/foo.git&quot; }
</code></pre>
<p>edit: just saw the other discussion - perhaps more relevant than here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kwaegel">@kwaegel</a> on 2025-01-09 20:04</div>
            <div class="timeline-body"><p>I would also find this useful.</p>
<p>Context: I have a CMake projects that generates Python Protobuf bindings in an out-of-source build tree, copies over a templated <code>pyproject.toml</code> file, and builds a wheel.</p>
<p>Separately, several other Python projects needs to consume the bindings package, but there is no reliable way to use relative paths as the build tree is not under the source tree (typical for CMake projects).</p>
<p>My current options are:</p>
<ul>
<li>Copy the generated bindings directly into each project that needs to consume them via Makefile or something.</li>
<li>Copy the generated bindings back into the source tree as part of the build process, so they're in a stable location.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/coneillpj">@coneillpj</a> on 2025-05-30 13:47</div>
            <div class="timeline-body"><p>+1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tremeschin">@Tremeschin</a> on 2025-09-04 01:15</div>
            <div class="timeline-body"><p>@dpnova For private repositories it might be better to have a global <code>.gitconfig</code> redirect and keep the package source untouched as <code>https://github.com/fooco/foo.git</code>, e.g. with SSH:</p>
<pre><code class="language-ini"># ~/.gitconfig
[url &quot;ssh://git@github.com/&quot;]
insteadOf = https://github.com/
</code></pre>
<p>This way after I add the key in my agent <code>ssh-add /path/key</code> in a login, any git operation uses ssh authentication. For sure it would work with <code>[url &quot;https://&lt;TOKEN&gt;@github.com/&quot;]</code>, which gives whoever is cloning authentication <em>options</em></p>
<p>Minor side effect (or bonus), the origin url will contain the <code>ssh://</code> or <code>&lt;token&gt;@</code> part, ssh is safe because of the agent, but the token would be fully visible with <code>git remote get-url origin</code> (I guess it's no better than env vars anyway..)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dpnova">@dpnova</a> on 2025-09-04 01:41</div>
            <div class="timeline-body"><p>@Tremeschin that's a good idea - luckily I only have to worry about our devs and a github action. I'm pushing to have the lib opensourced anyway :D (sadly, structural engineering, otherwise I'd have asked you to check it out)</p>
<p>btw the main discussion on this seems to be over <a href="https://github.com/astral-sh/uv/issues/5734">here</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tremeschin">@Tremeschin</a> on 2025-09-04 02:21</div>
            <div class="timeline-body"><p>No prob @dpnova, I randomly ended up here while searching for other stuff, and knew this alt approach for your comment with many upvotes that could help others - I'm not for the original issue, but indeed it could be useful at times ðŸ™‚</p>
<hr>

<p>Anyhow, I feel like <a href="https://docs.astral.sh/uv/concepts/projects/workspaces/#workspace-layouts">workspaces</a> are what OP needs, that's a monorepo structure even if repos weakly depend on each other.</p>
<p>I currently have <code>[tool.uv.workspace] members = [&quot;meta/*&quot;]</code> in my pyproject and use <code>git clone (url) meta/(project)</code> instead of submodules for off-branch work. A symlink works here too, where <code>meta/(project) =&gt; /abs/path/project</code></p>
<p>This main repository often contains the shared library, but it can be a virtual/bare project that just includes symlinks to members to centralize a venv and <code>[project.scripts]</code>. Local setup gets trickier with decoupled projects ofc needing manual setup per system (Windows needs developer mode for non-admin symlinks also..)</p>
<p>Just saying that workspaces solves path dependencies altogether, managing envs or truly decoupled won't play well :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imLew">@imLew</a> on 2025-11-12 08:00</div>
            <div class="timeline-body"><p>I would also like to see the original suggestion added. Unpublished dependencies and different directory layouts across systems are not going to go away anytime soon. Environment variables are already a commonly used way to deal with the differences between systems and for paths in <code>pyproject.toml</code> they would offer a simple and flexible solution.</p>
<p>I also want to say that, while workspaces might solve this problem, the suggestion is still worth implementing as it solves the problem with much less friction. &quot;Put all your stuff in a mono repo&quot; is not a good solution to &quot;I want to use some code from another local repo&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vitschwilk">@vitschwilk</a> on 2025-11-12 08:33</div>
            <div class="timeline-body"><p>While I think using envs in the pyproject.toml is a nice thing, an alternative solution to the &quot;I want to use some code from another local repo&quot;-problem from @imLew would be sources-groups as described in https://github.com/astral-sh/uv/issues/7945.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imLew">@imLew</a> on 2025-11-12 10:26</div>
            <div class="timeline-body"><p>Thanks @vitschwilk, but unless I'm missing something this solves the problem only for local dependencies that can be found at a fixed relative path. My &quot;another local repo&quot; was meant as &quot;another local repo that lives in different locations on different machine&quot;, sorry, that could have been clearer.</p>
<p>FWIW I worked around my problem (different relative paths to same dep on different machines) by using a private github repo (with a deploy key) as a source (though any bare repo that's reachable from all machines would work).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vitschwilk">@vitschwilk</a> on 2025-11-12 12:52</div>
            <div class="timeline-body"><p>No, not really <em>only</em> for local dependencies. You could also use a source-group that would link to a github based install... so not local.
But I agree, you could not define a $PATH_TO_MY_REPOS variable and just use it always. But you could have a variable setup.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:01 UTC
    </footer>
</body>
</html>
