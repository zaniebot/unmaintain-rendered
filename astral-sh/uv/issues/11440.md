```yaml
number: 11440
title: "uv doesn't correctly find upstream PyPI packages via Azure DevOps public index"
type: issue
state: closed
author: thomasaarholt
labels:
  - bug
assignees: []
created_at: 2025-02-12T09:12:45Z
updated_at: 2025-02-12T11:33:20Z
url: https://github.com/astral-sh/uv/issues/11440
synced_at: 2026-01-10T01:57:26Z
```

# uv doesn't correctly find upstream PyPI packages via Azure DevOps public index

---

_Issue opened by @thomasaarholt on 2025-02-12 09:12_

### Summary

Hello! Thank you for working towards making python package management-troubles a thing of the past! ðŸš€

I observe that uv is not able to install versions of python package versions correctly from PyPI when using an Azure DevOps (ADO) package tracker backed by an upstream index (PyPI). Pip manages to find and install these packages. I have created a public ADO index to help debug this which is backed by PyPI:
[`https://pkgs.dev.azure.com/thomasaarholt/thomasaarholt-python/_packaging/thomas-python-feed/pypi/simple/`](https://pkgs.dev.azure.com/thomasaarholt/thomasaarholt-python/_packaging/thomas-python-feed/pypi/simple/) (the main page isn't useful in the browser, but you can append package names to see the versions available, e.g. [`/numpy`](https://pkgs.dev.azure.com/thomasaarholt/thomasaarholt-python/_packaging/thomas-python-feed/pypi/simple/numpy))

I _believe_ the issue is that ADO redirects from the package index on Azure Storage to [Azure Front Door](https://learn.microsoft.com/en-us/azure/frontdoor/integrate-storage-account), a caching service, and that this is what pip supports and uv does not. I am not certain that this is the root cause.


Disclaimer: I work at Microsoft as a Data Scientist, but I do not work with Azure DevOps. My opinions are my own.

### Minimal reproducible example
The repro is a little nuanced: When I run `uv pip install <package>==<version>` from my index, I get a 401 error if that unique package-version is not already added directly to the tracker via pip (not only on upstream). 

When I run pip, it succeeds and the ADO tracker adds an entry for that package version. If I _then_ run `uv pip ...`, it successfully finds that particular version.

**This means that you need to find a new unique package-version combination to test with every time you successfully install it with pip. You can see which versions of numpy (which I use as example below) are [already "in this feed" here](https://dev.azure.com/thomasaarholt/thomasaarholt-python/_artifacts/feed/thomas-python-feed/PyPI/numpy/upstreams/2.2.2).**

I have purposefully not run `pip` entry in the code below, as that would add the numpy 2.0 version to the ADO tracker. You can see all the numpy versions that should be available on the [feed/numpy page](https://pkgs.dev.azure.com/thomasaarholt/thomasaarholt-python/_packaging/thomas-python-feed/pypi/simple/numpy/).

Note that I think you require artifacts-keyring (uv docs) available in order for pip to install a new version, which in turn may need [dotnet](https://dotnet.microsoft.com/en-us/download). I find it odd that authentication is needed to reach a public tracker, mentioning this internally.

```bash
export INDEX='https://pkgs.dev.azure.com/thomasaarholt/thomasaarholt-python/_packaging/thomas-python-feed/pypi/simple/'

# Try with uv
uv venv --seed
source .venv/bin/activate.fish # or however you activate it in your shell
uv pip install artifacts-keyring # I have already made this available on tracker. keyring from uv tool did not work with pip
# !! You might also need to download the dotnet runtime (https://dotnet.microsoft.com/en-us/download) for it to work.

uv pip install numpy==2.0 --index-url=$INDEX
# error: Failed to fetch: `https://pkgs.dev.azure.com/thomasaarholt/5e230929-47ac-48ad-97db-15ab1d2aa0c5/_packaging/56fc1e3a-f592-420b-bd14-a8c967a65c28/pypi/download/numpy/2/numpy-2.0.0-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl#sha256=a7039a136017eaa92c1848152827e1424701532ca8e8967fe480fe1569dae581`
#   Caused by: HTTP status client error (401 Unauthorized) for url (https://pkgs.dev.azure.com/thomasaarholt/5e230929-47ac-48ad-97db-15ab1d2aa0c5/_packaging/56fc1e3a-f592-420b-bd14-a8c967a65c28/pypi/download/numpy/2/numpy-2.0.0-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl#sha256=a7039a136017eaa92c1848152827e1424701532ca8e8967fe480fe1569dae581)


# Try with pip
uv venv --seed
source .venv/bin/activate.fish # or however you activate it in your shell
uv pip install artifacts-keyring
pip install numpy==2.0 --index-url=$INDEX
# Successfully installed numpy-X.X.X # (This added numpy as an "official entry" to the public tracker)

# Try again with uv
uv pip install numpy==2.0 --index-url=$INDEX
# Should now work
```


### Platform

Ubuntu 20.04 AMD

### Version

uv 0.5.14

### Python version

3.11.11

---

_Label `bug` added by @thomasaarholt on 2025-02-12 09:12_

---

_Comment by @thomasaarholt on 2025-02-12 11:33_

I have just learnt more about how upstream packages work ([anonymous users cannot install from upstream sources via the ADO feed - they can only install packages that already are in the feed](https://learn.microsoft.com/en-us/azure/devops/artifacts/how-to/public-feeds-upstream-sources?view=azure-devops&tabs=python#restore-packages)).

Closing this and reopening a new issue with a more correct text, as there is still missing functionality in uv.

---

_Closed by @thomasaarholt on 2025-02-12 11:33_

---
