<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`UV_EXTRA_INDEX_URL` variable doesn't get used in `uv 0.1.44 (d417daad7 2024-05-14)`  - astral-sh/uv #3614</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>UV_EXTRA_INDEX_URL</code> variable doesn't get used in <code>uv 0.1.44 (d417daad7 2024-05-14)</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3614">#3614</a>
        opened by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a>
        on 2024-05-15 17:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-15 17:21</div>
            <div class="timeline-body"><p>This must be a change recently introduced that broke things, but today my installations from my private pypi repository are failing.</p>
<pre><code>uv pip install --extra-index-url $MY_URL requirements.txt
</code></pre>
<p>works, however</p>
<pre><code>export UV_EXTRA_INDEX_URL=MY_URL
uv pip install requirements.txt
</code></pre>
<p>doesn't work.</p>
<h3>UV Version</h3>
<pre><code>uv 0.1.44 (d417daad7 2024-05-14)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-15 17:24</div>
            <div class="timeline-body"><p>Hi! What version were you using before?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-15 17:25</div>
            <div class="timeline-body"><p>Unfortunately I can't reproduce this -- it works as expected for me on <code>main</code>. Can you please give a complete example, with a real extra index URL and requirements, along with the full error or trace that you're seeing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-15 17:26</div>
            <div class="timeline-body"><p>I can't reproduce this either, e.g.</p>
<pre><code>‚ùØ UV_EXTRA_INDEX_URL=https://astral-sh.github.io/packse/0.3.15/simple-html/ uv pip install anyio --reinstall --no-cache -v
DEBUG Found a virtualenv named .venv at: /Users/zb/workspace/uv/.venv
DEBUG Probing interpreter info for: /Users/zb/workspace/uv/.venv/bin/python
DEBUG Found Python 3.12.3 for: /Users/zb/workspace/uv/.venv/bin/python
DEBUG Using Python 3.12.3 environment at .venv/bin/python
DEBUG Trying to lock if free: .venv/.lock
DEBUG Using registry request timeout of 30s
DEBUG Solving with target Python version 3.12.3
DEBUG Adding direct dependency: anyio*
DEBUG No cache entry for: https://astral-sh.github.io/packse/0.3.15/simple-html/anyio/
DEBUG No cache entry for: https://pypi.org/simple/anyio/
DEBUG Searching for a compatible version of anyio (*)
DEBUG Selecting: anyio==4.3.0 (anyio-4.3.0-py3-none-any.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/14/fd/2f20c40b45e4fb4324834aea24bd4afdf1143390242c0b33774da0e2e34f/anyio-4.3.0-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for anyio==4.3.0: idna&gt;=2.8
DEBUG Adding transitive dependency for anyio==4.3.0: sniffio&gt;=1.1
DEBUG No cache entry for: https://astral-sh.github.io/packse/0.3.15/simple-html/idna/
DEBUG No cache entry for: https://astral-sh.github.io/packse/0.3.15/simple-html/sniffio/
DEBUG No cache entry for: https://pypi.org/simple/idna/
DEBUG Searching for a compatible version of idna (&gt;=2.8)
DEBUG Selecting: idna==3.7 (idna-3.7-py3-none-any.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/e5/3e/741d8c82801c347547f8a2a06aa57dbb1992be9e948df2ea0eda2c8b79e8/idna-3.7-py3-none-any.whl.metadata
DEBUG No cache entry for: https://pypi.org/simple/sniffio/
DEBUG Searching for a compatible version of sniffio (&gt;=1.1)
DEBUG Selecting: sniffio==1.3.1 (sniffio-1.3.1-py3-none-any.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/e9/44/75a9c9421471a6c4805dbf2356f7c181a29c1879239abab1ea2cc8f38b40/sniffio-1.3.1-py3-none-any.whl.metadata
DEBUG Tried 4 versions: anyio 1, idna 1, root 1, sniffio 1
Resolved 3 packages in 223ms
DEBUG Identified uncached requirement: anyio==4.3.0
DEBUG Identified uncached requirement: idna==3.7
DEBUG Identified uncached requirement: sniffio==1.3.1
DEBUG No cache entry for: https://files.pythonhosted.org/packages/14/fd/2f20c40b45e4fb4324834aea24bd4afdf1143390242c0b33774da0e2e34f/anyio-4.3.0-py3-none-any.whl
DEBUG No cache entry for: https://files.pythonhosted.org/packages/e5/3e/741d8c82801c347547f8a2a06aa57dbb1992be9e948df2ea0eda2c8b79e8/idna-3.7-py3-none-any.whl
DEBUG No cache entry for: https://files.pythonhosted.org/packages/e9/44/75a9c9421471a6c4805dbf2356f7c181a29c1879239abab1ea2cc8f38b40/sniffio-1.3.1-py3-none-any.whl
Downloaded 3 packages in 43ms
DEBUG Uninstalled anyio (46 files, 6 directories)
DEBUG Uninstalled idna (15 files, 2 directories)
DEBUG Uninstalled sniffio (15 files, 3 directories)
Installed 3 packages in 2ms
 - anyio==4.3.0
 + anyio==4.3.0
 - idna==3.7
 + idna==3.7
 - sniffio==1.3.1
 + sniffio==1.3.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2024-05-15 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-15 20:01</div>
            <div class="timeline-body"><p>For what it's worth, this fails on my macbook only. I tried it inside of an alpine docker image &amp; it works just fine (even with latest <code>uv</code> version)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-16 02:15</div>
            <div class="timeline-body"><p>We're both using macOS. Unfortunately we'll need more information to help here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-16 03:22</div>
            <div class="timeline-body"><p>ah, well fwiw my instance is a private instance on GCP, &amp; I have been basically using the token that I get from <code>gcloud atuh print-access-token</code></p>
<p>Here's my Makefile command:</p>
<pre><code>get_index_url:
	$(eval token := $(shell gcloud auth print-access-token))
	$(eval index_url := &quot;https://_token:$(token)@$(artifact_location)-python.pkg.dev/$(gcp_project)/$(artifact_repo)/simple&quot;)
</code></pre>
<p>&amp; then I generate a <code>uv.env</code> file like so:</p>
<pre><code>generate-uv-env-file: get_index_url
	@echo &quot;UV_EXTRA_INDEX_URL=$(index_url)&quot; &gt; uv.env
</code></pre>
<p>Unfortunately this might be a bit hard to reproduce but I'll try my best to see if I can dig any deeper, but my token has the following format (I've modified it &amp; cut it short, actual token is much longer haha):</p>
<pre><code>https://_token:ya29.c.c0AY_VpZjGo_qz6DY7Dp-3Ut-9JLbMck6pjc8lt2VezaAmewIwpbH0EN71kAGzodNlb7FQpbIGVDwYQ-wQ@my-region-python.pkg.dev/gcp-project/artifact-repository-name/simple
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/polarathene">@polarathene</a> on 2024-05-16 05:04</div>
            <div class="timeline-body"><blockquote>
<p><code>export UV_EXTRA_INDEX_URL=MY_URL</code>
<code>--extra-index-url $MY_URL</code></p>
</blockquote>
<p>Just to confirm, there's a typo there right? You have one using a variable via <code>$</code>, while the exported ENV lacks the <code>$</code> prefix to reference the value of <code>MY_URL</code> variable.</p>
<p>Try this with the above context:</p>
<pre><code class="language-bash">echo &quot;${UV_EXTRA_INDEX_URL}&quot;
echo &quot;${MY_URL}&quot;
</code></pre>
<p>Are both values the same? Since the content is not human friendly to parse, double check with a diff tool or similar to confirm.</p>
<hr />
<p>Your follow-up post has more going on with the generation of the value to <code>uv.env</code>, so likewise double check that it's the same value you had work with <code>--extra-index-url</code> option but failed when implicitly relying on the ENV. Be sure to try the computed value directly with both approaches if you haven't yet to rule out any issue related to that process, it'll help better isolate if it's an issue related to how you compute and provide the value vs shell environment.</p>
<hr />
<p>It's possible that you either have a typo issue like mentioned, or that the value is not preserved properly. You can prevent accidents for static string values by assigning to shell variables / ENV by wrapping them with single quotes like <code>MY_URL='$HOME&lt;not-an-accidental-file-redirection'</code> (<em>single quote prevents interpolating <code>$HOME</code>, while single/double quotes would prevent <code>&lt;</code> being mistaken as a redirection</em>).</p>
<p>There can be other caveats with how the shell treats your variable when you reference it or assign a value, but quote wrapping (single in this case) should ensure no hidden surprises... except for your use of <code>eval</code> (<em>I can't quite recall the gotcha there, other than it's often discouraged</em>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-16 14:02</div>
            <div class="timeline-body"><p>sorry the shell commands that I've pasted are simplified/pseudocoded but I can assure you that I'm running them correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmc-cs-mdrissi">@hmc-cs-mdrissi</a> on 2024-05-16 17:40</div>
            <div class="timeline-body"><p>I think equivalent to <a href="https://github.com/pypa/pip/issues/12706#issuecomment-2114030013">this</a>, <code>uv pip config debug</code> command to see all config settings/where they came from would help debug this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-16 18:01</div>
            <div class="timeline-body"><p>I'm happy to help with this but it requires a minimal reproduction, i.e., a set of commands we can run that reliably reproduce the issue. As-is, there isn't much we can do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-16 18:51</div>
            <div class="timeline-body"><p>@charliermarsh Yes, thank you for all your help already. Once I find sometime I'll see if I can provide a plan for you to be able to reproduce this better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-16 18:53</div>
            <div class="timeline-body"><p>@polarathene I've changed all my <code>uv pip install</code>s as follows to get around this issue in the meantime:</p>
<pre><code>uv pip install my-private-library --extra-index-url $(echo $UV_EXTRA_INDEX_URL)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-16 19:33</div>
            <div class="timeline-body"><p>Okay I found what the issue was here, though I'm still confused what exactly changed on my system that made the scripts break.</p>
<p>I need to make sure that I'm using the <code>export</code> keyword in my <code>uv.env</code> file to ensure that the set variable gets passed to subprocesses as well. I found out this fix by trying @zanieb 's format (in-lining the <code>UV_EXTRA_INDEX_URL</code> variable in the <code>uv pip install</code> command).</p>
<p><strong>Solution:</strong>
Basically, if you're not in-lining the environment variable in your <code>uv pip install</code> command, be sure to use <code>export</code>:</p>
<pre><code>export UV_EXTRA_INDEX_URL=my-url
# then in another command
uv pip install my-package
</code></pre>
<p>Before I was doing this:</p>
<pre><code>UV_EXTRA_INDEX_URL=my-url
# then in another command
uv pip install my-package
</code></pre>
<p>&amp; it wouldn't work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ArshanKhanifar">@ArshanKhanifar</a> on 2024-05-16 19:34</div>
            <div class="timeline-body"><p>Thank you all for your support, closing this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ArshanKhanifar on 2024-05-16 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-16 20:11</div>
            <div class="timeline-body"><p>Thank you for following up, I appreciate it!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:33 UTC
    </footer>
</body>
</html>
