<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install dev dependencies of transitive workspace packages when targeting a single package - astral-sh/uv #15656</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Install dev dependencies of transitive workspace packages when targeting a single package</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15656">#15656</a>
        opened by <a href="https://github.com/Spenhouet">@Spenhouet</a>
        on 2025-09-03 12:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Spenhouet">@Spenhouet</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Currently, uv sync does not install the dev dependencies of transitive workspace packages when targeting a single package.</p>
<p>Even with flags like <code>--all-extras</code> and <code>--all-groups</code>, only the dev dependencies of the specified package are installed. This behavior is acknowledged in existing issues such as <a href="https://github.com/astral-sh/uv/issues/7541">#7541</a> and <a href="https://github.com/astral-sh/uv/issues/7487">#7487</a>, but the discussed requirements are different, hence this should not be a duplicate. I could not find an existing issue specifying this use-case.
Some existing issues mention to use <code>--all-packages</code>, which we do during local development, but which we don't during CI pipeline execution. Here we only build the respective package in our monorepo (and for tests, it's dev dependencies).</p>
<h3>Example</h3>
<h4>Current Behavior</h4>
<p>Given the following package structure:</p>
<pre><code>A → B
</code></pre>
<p>Where:</p>
<ul>
<li><code>A</code> is the main application.</li>
<li><code>B</code> is a workspace package that <code>A</code> depends on.</li>
</ul>
<p>Running the command:</p>
<pre><code class="language-bash">uv sync --inexact --package A --all-extras --all-groups
</code></pre>
<p>Installs all runtime dependencies of <code>A</code> and <code>B</code> but only the dev dependencies of <code>A</code>, excluding those of <code>B</code>.</p>
<p>This seems inconsistent.</p>
<h4>Desired Behavior</h4>
<p>Running the same command should install:</p>
<ul>
<li>All runtime and dev dependencies of A.</li>
<li>All runtime and dev dependencies of B (since A depends on B).</li>
</ul>
<p>This would ensure that all necessary dependencies are available for development and testing without manual declarations in each package's <code>pyproject.toml</code>. Each workspace package should be self-enclosed in that it's own specific dependencies (also dev dependencies) should only be defined within the scope of that workspace package.</p>
<h4>Additional Context</h4>
<p>We do have general dev dependencies like <code>pytest</code>, <code>ruff</code>, ... within the root <code>pyproject.toml</code>.
But e.g. within a database related workspace package, we have an extra dev dependencies for <code>testing.postgresql</code>, which only this workspace package needs during test execution and no other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @Spenhouet on 2025-09-03 12:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-03 12:25</div>
            <div class="timeline-body"><p>I think this is intentional and consistent — I don't think a command run in the scope of a single package should include transitive development dependencies of other workspace members. Similar to how we don't include transitive development dependencies for other source tree dependencies.</p>
<p>I'm not sure I follow why A's tests depend on B's development dependencies. Can you explain that more?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @zanieb on 2025-09-03 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Spenhouet">@Spenhouet</a> on 2025-09-03 13:38</div>
            <div class="timeline-body"><p>In our Monorepo we define &quot;apps&quot; (interfaces build as docker images) and &quot;components&quot; (workspace packages used by the apps or other components).</p>
<p>An app therefore only includes the single app code and all its (transitive) components.
When building an app, we package the app and only it's components into a docker image and run tests against all.
Hence, the dev dependencies of the &quot;package&quot; and the dev dependencies of all its workspace packages need to be installed.</p>
<p>That was the idea.
Your concern made me question some assumptions I have. I will test them later and give feedback when I have a better understanding.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-03 13:53</div>
            <div class="timeline-body"><p>It's definitely plausible we should add support for that use-case somehow, but I'm not sure what approach would be best yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Spenhouet">@Spenhouet</a> on 2025-09-03 17:54</div>
            <div class="timeline-body"><p>I shortly thought that <code>--all-packages</code> might also work for us, assuming uv automatically only installs the reduced set of available packages.
But actually when I do</p>
<pre><code class="language-bash">uv sync --inexact --all-packages --all-extras --all-groups
</code></pre>
<p>within the container only containing a subset of packages of the Monorepo, I get uv errors like this:</p>
<pre><code>error: Failed to determine installation plan
  Caused by: Distribution not found at: file:///src/components/component-not-included-in-build
</code></pre>
<p>Afaik. the only option to make it work is to not manage dev dependencies via <code>[dependency-groups]</code> but instead via <code>[project.optional-dependencies]</code>. This add an extra install <code>dev</code> to all packages. Then for every package I include as dependency, I also need to add its version with dev extras again to the dev extras, creating a chain of dev extras. Then when I install with <code>--package</code> and <code>--all-extras</code> it should install the full chain of dev dependencies. Doesn't feel right.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:32:48 UTC
    </footer>
</body>
</html>
