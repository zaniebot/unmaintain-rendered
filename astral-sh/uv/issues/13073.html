<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source is ignored with extra/group when conflict table is present - astral-sh/uv #13073</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Source is ignored with extra/group when conflict table is present</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13073">#13073</a>
        opened by <a href="https://github.com/watsonjj">@watsonjj</a>
        on 2025-04-23 19:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/watsonjj">@watsonjj</a> on 2025-04-23 19:27</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I wish to specify separate package sources for different extras/groups of the same dependency. I have a &quot;dev-local&quot; group/extra which installs the dependency in editable mode from a local path, and a &quot;dev-remote&quot; group/extra which clones the package from a git repo. The conflict table avoids conflicts between the sources. However, for a private package which does not exist in a package index, it does not work.</p>
<p>I have a simple demonstration so it can be reproduced. A simple package called <code>foo</code> is created with <code>uv init</code>. Then a second package is created called <code>bar</code> which has the following pyproject.toml:</p>
<p>(both dev-local and dev-remote have the same source for the purpose of a simple demonstration)</p>
<pre><code class="language-toml">[project]
name = &quot;bar&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [&quot;foo&quot;]

[dependency-groups]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[project.optional-dependencies]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[tool.uv]
conflicts = [
    [
        { extra = &quot;dev-remote&quot; },
        { extra = &quot;dev-local&quot; },
        { group = &quot;dev-remote&quot; },
        { group = &quot;dev-local&quot; },
    ]
]

[tool.uv.sources]
&quot;foo&quot; = [
    {path = &quot;../foo&quot;, editable = true, group = &quot;dev-local&quot;},
    {path = &quot;../foo&quot;, editable = true, extra = &quot;dev-local&quot;},
    {path = &quot;../foo&quot;, editable = true, group = &quot;dev-remote&quot;},
    {path = &quot;../foo&quot;, editable = true, extra = &quot;dev-remote&quot;},
]
</code></pre>
<p>Running:</p>
<pre><code class="language-bash">$ uv sync --group dev-local

  × No solution found when resolving dependencies:
  ╰─▶ Because there are no versions of foo and your project depends on foo, we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<p>The pip interface works fine:</p>
<pre><code class="language-bash">$ uv pip compile --group dev-local pyproject.toml

Resolved 1 package in 3ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --group dev-local pyproject.toml
-e ../foo
    # via
    #   bar (pyproject.toml)
    #   bar (pyproject.toml:dev-local)
</code></pre>
<p>If I clone a package which is present in the default package index (e.g. <code>pytest</code>), and replace foo with the package in the pyproject.toml, then it works:</p>
<pre><code class="language-toml">[project]
name = &quot;bar&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [&quot;pytest&quot;]

[dependency-groups]
dev-local = [&quot;pytest&quot;]
dev-remote = [&quot;pytest&quot;]

[project.optional-dependencies]
dev-local = [&quot;pytest&quot;]
dev-remote = [&quot;pytest&quot;]

[tool.uv]
conflicts = [
    [
        { extra = &quot;dev-remote&quot; },
        { extra = &quot;dev-local&quot; },
        { group = &quot;dev-remote&quot; },
        { group = &quot;dev-local&quot; },
    ]
]

[tool.uv.sources]
&quot;pytest&quot; = [
    {path = &quot;../pytest&quot;, editable = true, group = &quot;dev-local&quot;},
    {path = &quot;../pytest&quot;, editable = true, extra = &quot;dev-local&quot;},
    {path = &quot;../pytest&quot;, editable = true, group = &quot;dev-remote&quot;},
    {path = &quot;../pytest&quot;, editable = true, extra = &quot;dev-remote&quot;},
]
</code></pre>
<pre><code class="language-bash">$ uv sync --group dev-local

Resolved 10 packages in 3.33s
      Built pytest @ file:///Users/Jason/Software/uv_issue/pytest
Prepared 7 packages in 1.90s
Installed 7 packages in 18ms
 + exceptiongroup==1.2.2
 + iniconfig==2.1.0
 + packaging==25.0
 + pluggy==1.5.0
 + pygments==2.19.1
 + pytest==8.4.0.dev459+g33b26e429 (from file:///Users/Jason/Software/uv_issue/pytest)
 + tomli==2.2.1
</code></pre>
<p>Furthermore, with the foo dependency, if I remove the conflict table and specify just a single source, then it works:</p>
<pre><code class="language-toml">[project]
name = &quot;bar&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [&quot;foo&quot;]

[dependency-groups]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[project.optional-dependencies]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[tool.uv.sources]
&quot;foo&quot; = [
    {path = &quot;../foo&quot;, editable = true, group = &quot;dev-local&quot;},
]
</code></pre>
<pre><code class="language-bash">$ uv sync --group dev-local

Resolved 2 packages in 34ms
      Built foo @ file:///Users/Jason/Software/uv_issue/foo
Prepared 1 package in 1.23s
Uninstalled 7 packages in 27ms
Installed 1 package in 2ms
 - exceptiongroup==1.2.2
 + foo==0.1.0 (from file:///Users/Jason/Software/uv_issue/foo)
 - iniconfig==2.1.0
 - packaging==25.0
 - pluggy==1.5.0
 - pygments==2.19.1
 - pytest==8.4.0.dev459+g33b26e429 (from file:///Users/Jason/Software/uv_issue/pytest)
 - tomli==2.2.1
</code></pre>
<p>I don't see why the original pyproject.toml should not work. It would be an extremely useful design. I have seen similar concepts requested in many issues, but none that point out this bug:
#9258 #12539 #11941 #9537 #7945 #11632 #12681 #12013</p>
<p>Connected to this issue, when I use a remote git url for the &quot;dev-remote&quot; group, I observe it cloning from the url even if I am using the &quot;dev-local&quot; group which uses a local path:</p>
<pre><code class="language-bash">$ UV_GIT_LFS=1 uv sync --group dev-local

    Updated https://gitlab.desy.de/corel/corel-asyncio (a97cf59862e8040bc400e708f3f6f8a1129ef81a)
  × No solution found when resolving dependencies:
  ╰─▶ Because corel-asyncio was not found in the package registry and your project depends on corel-asyncio, we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<h3>Platform</h3>
<p>macOS 13.6 amd64 (Darwin 22.6.0 x86_64)</p>
<h3>Version</h3>
<p>uv 0.6.16 (Homebrew 2025-04-22)</p>
<h3>Python version</h3>
<p>Python 3.10.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @watsonjj on 2025-04-23 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/watsonjj">@watsonjj</a> on 2025-04-23 19:31</div>
            <div class="timeline-body"><p>Potentially related to #13070</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-24 08:52</div>
            <div class="timeline-body"><p>You can fix this by removing <code>foo</code> from <code>dependencies</code> (<code>dependencies = []</code>): It is possible to do an installation without any group or extra, and in that case, foo doesn't have any associated source entry. You could also add <code>{ path = &quot;../foo&quot;, editable = true },</code> to add a source the foo base case, but I assume that errors for the real use case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/watsonjj">@watsonjj</a> on 2025-04-24 09:18</div>
            <div class="timeline-body"><p>Thanks for the reply! Indeed, removing <code>foo</code> from <code>dependencies</code> helps the resolution, but this is not ideal as foo is no longer treated as a required dependency of the package (for wheels or for other package managers).</p>
<blockquote>
<p>You could also add { path = &quot;../foo&quot;, editable = true }, to add a source the foo base case, but I assume that errors for the real use case.</p>
</blockquote>
<p>This would be the perfect solution, but it does not work if the paths are different between sources:</p>
<pre><code class="language-toml">[project]
name = &quot;bar&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [&quot;foo&quot;]

[dependency-groups]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[project.optional-dependencies]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[tool.uv]
conflicts = [
    [
        { extra = &quot;dev-remote&quot; },
        { extra = &quot;dev-local&quot; },
        { group = &quot;dev-remote&quot; },
        { group = &quot;dev-local&quot; },
    ]
]

[tool.uv.sources]
&quot;foo&quot; = [
    {path = &quot;../foo&quot;, editable = true},
    {path = &quot;../foo_local&quot;, editable = true, group = &quot;dev-local&quot;},
    {path = &quot;../foo_local&quot;, editable = true, extra = &quot;dev-local&quot;},
    {path = &quot;../foo_remote&quot;, editable = true, group = &quot;dev-remote&quot;},
    {path = &quot;../foo_remote&quot;, editable = true, extra = &quot;dev-remote&quot;},
]
</code></pre>
<pre><code class="language-bash">$ uv sync --extra dev-local

error: Requirements contain conflicting URLs for package `foo` in all marker environments:
- ../foo
- ../foo_remote
</code></pre>
<p>I suppose this would need a way to add the base case to the conflict table? Though it would be intuitive for it to work by default, as I am explicitly overriding the source with the extra.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/watsonjj">@watsonjj</a> on 2025-04-24 09:20</div>
            <div class="timeline-body"><blockquote>
<p>It is possible to do an installation without any group or extra, and in that case, foo doesn't have any associated source entry.</p>
</blockquote>
<p>But this is also true in the single-source example in my original post:</p>
<pre><code class="language-toml">[project]
name = &quot;bar&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [&quot;foo&quot;]

[dependency-groups]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[project.optional-dependencies]
dev-local = [&quot;foo&quot;]
dev-remote = [&quot;foo&quot;]

[tool.uv.sources]
&quot;foo&quot; = [
    {path = &quot;../foo&quot;, editable = true, group = &quot;dev-local&quot;},
]
</code></pre>
<p>Yet this one works.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/watsonjj">@watsonjj</a> on 2025-04-24 09:23</div>
            <div class="timeline-body"><p>Hmm, in the single-source example, the dev-local source seems to be used by default, even when not explicitly requested, even with a fresh env and cache:</p>
<pre><code class="language-bash">$ uv sync

Using CPython 3.13.2 interpreter at: /usr/local/opt/python@3.13/bin/python3.13
Creating virtual environment at: .venv
Resolved 2 packages in 27ms
      Built foo @ file:///Users/Jason/Software/uv_issue/foo
Prepared 1 package in 2.63s
Installed 1 package in 3ms
 + foo==0.1.0 (from file:///Users/Jason/Software/uv_issue/foo)
</code></pre>
<p>Is this expected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-24 12:46</div>
            <div class="timeline-body"><p>@BurntSushi do you know if that's expected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-04-24 15:31</div>
            <div class="timeline-body"><p>For <a href="https://github.com/astral-sh/uv/issues/13073#issuecomment-2826939152">this specific comment</a>, I'm not sure. Conflicts aren't involved in this case. Whether <code>dev-local</code> should be used by default in this case isn't quite clear to me. Maybe a question for @zanieb?</p>
<p>But for <a href="https://github.com/astral-sh/uv/issues/13073#issuecomment-2826933592">this comment</a>, it seems like the logic for detecting source URLs is maybe not accounting for conflicting extras? It seems like it <em>ought</em> to, but no, I don't believe I added any special code paths for that specifically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eriktaubeneck">@eriktaubeneck</a> on 2025-11-14 17:56</div>
            <div class="timeline-body"><p>I just ran into this issue and found this comment, so wanted to provide one more use case that's presumably relatively common:</p>
<p>I have <code>packageA</code> which depends on <code>packageB</code>, and often when debugging locally, I need to depend on a local and editable version of <code>packageB</code>. Ideally, I'd have a group, e.g., <code>--group local-packageB</code> which I could turn on when needed, but by default, <code>packageB</code> comes from my package manager or a git link. Most non-developer users of <code>packageA</code> will never need the local version of <code>packageB</code>. I was hoping to solve this by having two groups, using the <code>group</code> filter in the <code>[tool.uv.sources]</code> entry, and setting one group as a default, but to no avail.</p>
<p>I currently solved this by just having a commented out line in <code>[tool.uv.sources]</code> and instruction in my docs for developers.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:05 UTC
    </footer>
</body>
</html>
