<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>multiple sources for same package: local path dependency and regular dependency - astral-sh/uv #15129</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>multiple sources for same package: local path dependency and regular dependency</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15129">#15129</a>
        opened by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a>
        on 2025-08-07 11:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a> on 2025-08-07 11:54</div>
            <div class="timeline-body"><h3>Question</h3>
<p>When developing a package that depends on another local package, I can either specify the dependency as regular pypi dependency, git dependency or local path dependency</p>
<p>e.g.</p>
<pre><code>uv add my-own-lib --index myIndex   
uv add git+https://myserver/path-to-my-own-lib 
uv add ../my-own-lib 
</code></pre>
<p>For my users, I want the first option
During local developement, I often need the second or third option</p>
<p>Can I configure multiple alternative sources for the same package, while keeping one version of pyproject.toml and uv.lock?</p>
<p>I tried doing this with optional dependency groups or dev depencies, and the <a href="https://docs.astral.sh/uv/concepts/projects/config/#conflicting-dependencies">conflicting-dependencies</a> feature, but cannot get it to work, since the packages have the same name and overwrite each other.</p>
<h3>Platform</h3>
<p><em>No response</em></p>
<h3>Version</h3>
<p>uv 0.8.5 (ce3728681 2025-08-05)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @Ben-grmbl on 2025-08-07 11:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheNotary">@TheNotary</a> on 2025-09-06 19:00</div>
            <div class="timeline-body"><p>I struggled with this for a bit today.  In my situation, I had a local env and a cloud deployment, both use local dependencies, but the directory layout differed.  I wanted to have &quot;fallbacks&quot; for dependencies or a way of firing them conditionally.  But it turns out if any paths to dependencies don't exist, uv prints a fatal error.</p>
<p>Anyway, after much experimentation, I was only able to get things working by using a single relative path, and moving the production folder paths around slightly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keikoro">@keikoro</a> on 2025-09-12 14:05</div>
            <div class="timeline-body"><p>@TheNotary I believe your issue, while related, is slightly different in that you were trying to switch between different <code>paths</code> for known environments.</p>
<p>The original question, as I understood it, is about declaring different types of sources (PyPI default, custom <code>index</code>, <code>git</code>, <code>path</code>) for the same dependency in <code>pyproject.toml</code>, and being able to switch between those &quot;dynamically&quot; while a <code>uv.lock</code> file is present, which should remain unchanged (by e.g. any <code>uv sync</code> actions).</p>
<p>For which there don't seem to exist any solutions at this point.</p>
<p>The <code>dependency-groups</code> hacks I've seen won't work for main dependencies. Nor can e.g. <code>uv.toml</code> be used to drop in <code>sources</code> just for local development. And if a project is meant to be installed and/or worked on by other people, <a href="https://docs.astral.sh/uv/concepts/projects/dependencies/#multiple-sources">environment markers</a> don't make sense either.</p>
<p>I like the idea of custom environment variables to differentiate sources suggested in https://github.com/astral-sh/uv/issues/7945#issuecomment-2411769064</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheNotary">@TheNotary</a> on 2025-09-12 14:24</div>
            <div class="timeline-body"><p>Quite true, thank you for that clarification.  I didn't mean to imply that this issue was moot.  I left my work around as an aid to anyone who didn't need to support third-party consumers, but also as an admission that more support in this area would be appreciated.</p>
<p>Currently no workarounds that I've come to would apply to Ben's case, I feel it's a valid case, and if support were contributed here, it would likely benefit other use-cases wherein we have to resort to inelegant workarounds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keikoro">@keikoro</a> on 2025-09-12 18:31</div>
            <div class="timeline-body"><p>I think I've <em>finally</em> found a workaround for my use case, even if it's not persistent:</p>
<p>Like @Ben-grmbl, I want my <code>pyproject.toml</code> file to default to PyPI versions of packages. For local development, I want to be able to switch to (editable) local copies of certain dependencies (without messing with <code>uv.lock</code>, which is under version control).</p>
<p>Background:
I used to solve this via symlinks matching import package names in my working directory, e.g. <code>important_dependency</code>, which pointed to <code>/PATH/TO/important-dependency</code>, a local copy of the dependency on my system. Whenever such a symlink was present, imports would resolve to there, i.e. the symlink would override the default version installed in <code>site-packages</code> (as per the <code>pyproject.toml</code> file).</p>
<p>I wasn't able to properly replicate this by putting editable local <code>paths</code> in <code>[tool.uv.sources]</code> and alternating between using <code>uv sync</code> with <code>--locked</code> (or <code>--frozen</code>) and <code>--no-sources</code>. Dependencies would often not or only partially get reinstalled from PyPI when switching back. That aside, I generally don't like the idea of having to include <em>my</em> personal development <code>sources</code> in any &quot;official&quot; project config.</p>
<p>My solution:
With the usual symlinks in place, switch between <code>uv pip install -e</code> with local paths to replace the default PyPI versions with pointers to editable local copies and <code>uv sync --reinstall-package</code> to force reinstallation of what's defined in <code>pyproject.toml</code>. Reinstallation proved necessary to prevent <code>uv</code> from skipping dependencies when the version of the local install matches the project requirements (e.g. when I'm checked out on a branch that's based on the current version but which already has new work).</p>
<p>I.e.</p>
<pre><code class="language-console">$ uv pip install -e &quot;important-dependency @ ./important_dependency&quot; -e &quot;other-dependency @ ./other_dep&quot;
</code></pre>
<p>+</p>
<pre><code class="language-console">$ uv sync --reinstall-package important-dependency --reinstall-package other-dependency
</code></pre>
<p>In my project, I have a helper which informs me about the origins of the relevant dependencies anyway, but on the command line, a quick check using <code>uv</code> could look something like one of the following:</p>
<pre><code class="language-console">$ uv pip freeze | grep -i &quot;file&quot;
$ uv pip show important-dependency other-dependency | grep -i &quot;editable&quot;
</code></pre>
<p>When the requirements in <code>pyproject.toml</code> or the lock file change (independently of what I'm doing) and I want to pull in those changes, I'll obviously have to repeat the <code>uv pip</code> installing of those local dependencies in editable mode, but that's less of a hassle than e.g. having to worry about local-only sources or ephemeral changes making it into project config files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Capsar">@Capsar</a> on 2025-12-15 15:10</div>
            <div class="timeline-body"><p>I’m encountering a similar challenge.</p>
<p>Would it be possible for the dependency to be installed based on the order of the available sources? For example:</p>
<ol>
<li>First try to install it from <code>&quot;../local-lib/&quot;</code>.</li>
<li>If that’s not available, fall back to the Git repository.</li>
<li>If both are unavailable, finally try installing it from the (private) PyPI registry.</li>
</ol>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
