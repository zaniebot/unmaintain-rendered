<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timestamp metadata not parsed from private package index. Unexpected behavior for `--exclude-newer` option - astral-sh/uv #10394</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Timestamp metadata not parsed from private package index. Unexpected behavior for `--exclude-newer` option</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10394">#10394</a>
        opened by <a href="https://github.com/alfredocarella">@alfredocarella</a>
        on 2025-01-08 14:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alfredocarella">@alfredocarella</a> on 2025-01-08 14:08</div>
            <div class="timeline-body"><p>The package upload timestamp appears to be missing when searching a private (Azure artifacts) package index.
This prevents the option <code>--exclude-newer</code> from being used correctly.</p>
<p>Running this command
<code>uv run --verbose --no-env-file --default-index https://VssSessionToken@pkgs.dev.azure.com/my-organization/_packaging/my-feedname/pypi/simple/ --keyring-provider subprocess --exclude-newer 2025-01-06 -s minimal_script.py </code>
produces the following output:</p>
<pre><code>←[34mDEBUG←[39m uv 0.5.15 (eb6ad9a4f 2025-01-06)
Reading inline script metadata from `minimal_script.py`
DEBUG Reading Python requests from version file at `C:\Users\myuser\workspace\testfolder\.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Using Python request Python 3.12 from version file at `.python-version`
DEBUG Searching for Python 3.12 in virtual environments, managed installations, search path, or registry
DEBUG Found `cpython-3.12.4-windows-x86_64-none` at `C:/Users/myuser/workspace/testfolder/.venv\Scripts\python.exe` (active virtual environment)
DEBUG Caching via base interpreter: `C:\Users\myuser\AppData\Local\Programs\Python\Python312\python.exe`
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.4
DEBUG Solving with target Python version: &gt;=3.12.4
DEBUG Adding direct dependency: requests*
DEBUG No cache entry for: https://pkgs.dev.azure.com/my-organization/_packaging/my-feedname/pypi/simple/requests/
DEBUG No netrc file found
DEBUG Checking keyring for credentials for VssSessionToken@https://pkgs.dev.azure.com/my-organization/_packaging/my-feedname/pypi/simple/requests/
DEBUG Found credentials in keyring for https://pkgs.dev.azure.com/my-organization/_packaging/my-feedname/pypi/simple/requests/
DEBUG Searching for a compatible version of requests (*)
warning: requests-2.32.3-py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.31.0-py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.30.0-py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.29.0-py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.28.2-py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.28.1-py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.28.0-py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.27.1-py2.py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
warning: requests-2.24.0-py2.py3-none-any.whl is missing an upload date, but user provided: 2025-01-06T23:00:00Z
DEBUG No compatible version found for: requests
  × No solution found when resolving script dependencies:
  ╰─▶ Because there are no versions of requests and you require requests, we can conclude that your requirements are unsatisfiable.
</code></pre>
<p>The contents of minimal_script.py are:</p>
<pre><code># /// script
# requires-python = &quot;&gt;=3.12&quot;
# dependencies = [
#     &quot;requests&quot;,
# ]
# ///

import requests

print(f&quot;{requests.__version__ = }&quot;)

</code></pre>
<p>The script runs correctly when the option <code>--exclude-newer 2025-01-06</code> is removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-01-08 14:10</div>
            <div class="timeline-body"><p>Are there upload dates in the html or json output of azure?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alfredocarella">@alfredocarella</a> on 2025-01-08 14:25</div>
            <div class="timeline-body"><p>Yes, of course. The timestamps are present and displayed in the Azure page. Sorry I forgot to mention it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-08 14:31</div>
            <div class="timeline-body"><p>Can you include a redacted example of the HTML page or JSON response, so we can see the upload date format? E.g., for <code>https://pkgs.dev.azure.com/my-organization/_packaging/my-feedname/pypi/simple/requests/</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-01-08 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alfredocarella">@alfredocarella</a> on 2025-01-09 08:42</div>
            <div class="timeline-body"><p>I see from @charliermarsh's clarification that I may have misunderstood the first question by @konstin.</p>
<p>The page <code>https://dev.azure.com/my-organization/Python/_artifacts/feed/my-feedname/</code> shows a list with the index packages with their upload times (&quot;push dates&quot;).</p>
<p>However, the output of <code>https://pkgs.dev.azure.com/my-organization/_packaging/my-feedname/pypi/simple/requests/</code> looks like this (i.e. no upload times):</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=windows-1252&quot;&gt;&lt;title&gt;Links for requests&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Links for requests&lt;/h1&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.32.3/requests-2.32.3-py3-none-any.whl#sha256=70761cfe03c773ceb22aa2f671b4757976145175cdfca038c02654d061d6dcc6&quot; data-requires-python=&quot;&amp;gt;=3.8&quot;&gt;requests-2.32.3-py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.31/requests-2.31.0-py3-none-any.whl#sha256=58cd2187c01e70e6e26505bca751777aa9f2ee0b7f4300988b709f44e013003f&quot; data-requires-python=&quot;&amp;gt;=3.7&quot;&gt;requests-2.31.0-py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.30/requests-2.30.0-py3-none-any.whl#sha256=10e94cc4f3121ee6da529d358cdaeaff2f1c409cd377dbc72b825852f2f7e294&quot; data-requires-python=&quot;&amp;gt;=3.7&quot;&gt;requests-2.30.0-py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.29/requests-2.29.0-py3-none-any.whl#sha256=e8f3c9be120d3333921d213eef078af392fba3933ab7ed2d1cba3b56f2568c3b&quot; data-requires-python=&quot;&amp;gt;=3.7&quot;&gt;requests-2.29.0-py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.28.2/requests-2.28.2-py3-none-any.whl#sha256=64299f4909223da747622c030b781c0d7811e359c37124b4bd368fb8c6518baa&quot; data-requires-python=&quot;&amp;gt;=3.7,&amp;lt;4&quot;&gt;requests-2.28.2-py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.28.1/requests-2.28.1-py3-none-any.whl#sha256=8fefa2a1a1365bf5520aac41836fbee479da67864514bdb821f31ce07ce65349&quot; data-requires-python=&quot;&amp;gt;=3.7,&amp;lt;4&quot;&gt;requests-2.28.1-py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.28/requests-2.28.0-py3-none-any.whl#sha256=bc7861137fbce630f17b03d3ad02ad0bf978c844f3536d0edda6499dafce2b6f&quot; data-requires-python=&quot;&amp;gt;=3.7,&amp;lt;4&quot;&gt;requests-2.28.0-py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.27.1/requests-2.27.1-py2.py3-none-any.whl#sha256=f22fa1e554c9ddfd16e6e41ac79759e17be9e492b3587efa038054674760e72d&quot; data-requires-python=&quot;&amp;gt;=2.7,!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,!=3.4.*,!=3.5.*&quot;&gt;requests-2.27.1-py2.py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://pkgs.dev.azure.com/my-organization/_packaging/69bbb63b-ee6d-49c6-9931-58e60e787a3f/pypi/download/requests/2.24/requests-2.24.0-py2.py3-none-any.whl#sha256=fe75cc94a9443b9246fc7049224f75604b113c36acb93f87b80ed42c44cbb898&quot; data-requires-python=&quot;&amp;gt;=2.7,!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,!=3.4.*&quot;&gt;requests-2.24.0-py2.py3-none-any.whl&lt;/a&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-01-09 09:31</div>
            <div class="timeline-body"><p>To support <code>--exclude-newer</code>, uv needs to get the timestamps of the files from the index as <code>upload-time</code>. PyPI has this information in the JSON output (which is selected over the html output if available): https://pypi.org/simple/requests/?format=application/vnd.pypi.simple.v1+json. Without this timestamp in the azure simple API, we can't determine which files to exclude and which files to include.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @konstin on 2025-01-09 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by @konstin on 2025-01-09 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-01-09 17:24</div>
            <div class="timeline-body"><p>@alfredocarella if you are able to open a ticket with Azure these are the relevant specifications they should implement:</p>
<ul>
<li>https://packaging.python.org/en/latest/specifications/simple-repository-api/#json-serialization</li>
<li>https://packaging.python.org/en/latest/specifications/simple-repository-api/#additional-fields-for-the-simple-api-for-package-indexes</li>
</ul>
<p>Which were added in PEP 691 and PEP 700.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-13 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/herebebeasties">@herebebeasties</a> on 2025-03-24 17:17</div>
            <div class="timeline-body"><p>This is also affecting torch. Any chance we could provide a manual override in uv to workaround these issues, rather than requiring upstream publishers to fix it?
<code>warning: torch-2.6.0+cu124-cp310-cp310-linux_x86_64.whl is missing an upload date</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16813.html">astral-sh/uv#16813</a> on 2025-11-21 21:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:01 UTC
    </footer>
</body>
</html>
