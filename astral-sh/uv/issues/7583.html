<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error when pointing UV_PROJECT_ENVIRONMENT to /usr/local/ on latest UV version 0.4.13 - astral-sh/uv #7583</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Error when pointing UV_PROJECT_ENVIRONMENT to /usr/local/ on latest UV version 0.4.13</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7583">#7583</a>
        opened by <a href="https://github.com/rosssgill">@rosssgill</a>
        on 2024-09-20 12:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rosssgill">@rosssgill</a> on 2024-09-20 12:08</div>
            <div class="timeline-body"><p>Hi there,</p>
<p>I've been previously using the docker image <code>ghcr.io/astral-sh/uv:0.4.12-python3.11-bookworm-slim</code> and successfully setting <code>UV_PROJECT_ENVIRONMENT=&quot;/usr/local/&quot;</code> to point to the container's system python environment, similar to how @zanieb has done here: https://github.com/astral-sh/uv/pull/6834#issuecomment-2319253359. I noticed however that with the latest UV version <code>0.4.13</code>, for example, using <code>ghcr.io/astral-sh/uv:python3.11-bookworm-slim</code> image, this is no longer possible and during the container build I get the following error:</p>
<pre><code>[svc dev 6/8] RUN --mount=type=cache,target=/root/.cache/uv     --mount=type=bind,source=uv.lock,target=uv.lock     --mount=type=bind,source=pyproject.toml,target=pyproject.toml     --mount=type=bind,source=setup.py,target=setup.py     uv sync --frozen --no-install-project:
0.422 error: Project virtual environment directory `/usr/local/` cannot be used because it is not a virtual environment and is non-empty
</code></pre>
<p>I believe it may be related to this pull request https://github.com/astral-sh/uv/pull/7527?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-20 13:16</div>
            <div class="timeline-body"><p>Ah sorry that's an oversight from the protections we added in #7522.</p>
<p>l'll fix this right away.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-09-20 13:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-20 14:15</div>
            <div class="timeline-body"><p>I have a fix up in #7585</p>
<p>I haven't tested it yet though â€” if want to make sure it works for you that'd be helpful. I'll be adding test coverage for this functionality before merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-20 17:40</div>
            <div class="timeline-body"><p>This will be fixed in the next release (sometime today)</p>
<p>New integration test in #7591</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-20 17:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-09-20 17:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
