```yaml
number: 6621
title: "`uv run` installs transitive package that should be excluded according to markers"
type: issue
state: closed
author: edgarrmondragon
labels:
  - bug
assignees: []
created_at: 2024-08-25T23:49:53Z
updated_at: 2024-08-26T18:00:23Z
url: https://github.com/astral-sh/uv/issues/6621
synced_at: 2026-01-10T01:57:14Z
```

# `uv run` installs transitive package that should be excluded according to markers

---

_Issue opened by @edgarrmondragon on 2024-08-25 23:49_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

Similar to https://github.com/astral-sh/uv/issues/6169, but for `uv run`. With a dependency on `SQLAlchemy~=2.0.32`, the `uv.lock` seems to suggest the package should be excluded on Python 3.13 for any platform

```toml
dependencies = [
    { name = "greenlet", marker = "(python_full_version < '3.13' and platform_machine == 'AMD64') or (python_full_version < '3.13' and platform_machine == 'WIN32') or (python_full_version < '3.13' and platform_machine == 'aarch64') or (python_full_version < '3.13' and platform_machine == 'amd64') or (python_full_version < '3.13' and platform_machine == 'ppc64le') or (python_full_version < '3.13' and platform_machine == 'win32') or (python_full_version < '3.13' and platform_machine == 'x86_64')" },
    { name = "typing-extensions" },
]
```

but uv still tries to build it.

I've set up a repo to reproduce this in https://github.com/edgarrmondragon/uv-lock-greenlet-repro and got an example of the problem in https://github.com/edgarrmondragon/uv-lock-greenlet-repro/actions/runs/10550889135/job/29227556980?pr=1.

---

_Comment by @charliermarsh on 2024-08-25 23:54_

Thanks!

---

_Comment by @charliermarsh on 2024-08-26 00:04_

Ok I see the issue. Sorry!

---

_Assigned to @charliermarsh by @charliermarsh on 2024-08-26 00:07_

---

_Label `bug` added by @charliermarsh on 2024-08-26 00:07_

---

_Comment by @charliermarsh on 2024-08-26 00:13_

(Again this is specifically about 3.13 being a pre-release.)

---

_Referenced in [reservoir-data/tap-google-play#97](../../reservoir-data/tap-google-play/pulls/97.md) on 2024-08-26 15:34_

---

_Referenced in [astral-sh/uv#6646](../../astral-sh/uv/pulls/6646.md) on 2024-08-26 17:22_

---

_Closed by @charliermarsh on 2024-08-26 18:00_

---
