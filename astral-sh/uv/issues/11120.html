<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inconsistent Dependency Handling Across Systems with Different `glibc` Versions - astral-sh/uv #11120</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Inconsistent Dependency Handling Across Systems with Different `glibc` Versions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11120">#11120</a>
        opened by <a href="https://github.com/ido123net">@ido123net</a>
        on 2025-01-30 21:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ido123net">@ido123net</a> on 2025-01-30 21:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using UV to create environments on systems with different <code>glibc</code> versions (e.g., Ubuntu 22.04 and Ubuntu 18.04), packages that depend on <code>glibc</code> (like <code>paramiko</code>) do not handle the version difference gracefully.</p>
<p>In setups where environments are shared across multiple systems via NFS, an environment created on Ubuntu 22.04 functions correctly on the same OS. However, when accessed from Ubuntu 18.04 (which has a lower <code>glibc</code> version), it leads to runtime errors due to incompatible shared library dependencies. The necessary dependencies are not reinstalled or resolved during environment execution.</p>
<hr />
<h2>Steps to reproduce:</h2>
<ol>
<li>On Ubuntu 22.04 (glibc 2.35)</li>
</ol>
<pre><code class="language-sh">$ uv init example
Initialized project `example` at `/path/to/example`

$ cd example

$ cat hello.py
import paramiko
print(paramiko.__version__)

$ uv add paramiko
Resolved 7 packages in 27ms
Installed 6 packages in 202ms
 + bcrypt==4.2.1
 + cffi==1.17.1
 + cryptography==44.0.0
 + paramiko==3.5.0
 + pycparser==2.22
 + pynacl==1.5.0

$ uv run hello.py 
3.5.0
</code></pre>
<ol start="2">
<li>On Ubuntu 18.04 (glibc 2.27)</li>
</ol>
<pre><code class="language-sh">$ cd /path/to/example

$ uv run hello.py
Traceback (most recent call last):
  File &quot;/path/to/example/hello.py&quot;, line 1, in &lt;module&gt;
    import paramiko
  ...
ImportError: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.28' not found (required by /path/to/example/.venv/lib/python3.9/site-packages/cryptography/hazmat/bindings/_rust.abi3.so)
</code></pre>
<h3>Platform</h3>
<p>Ubuntu18.04, Ubuntu22.04</p>
<h3>Version</h3>
<p>uv 0.5.25</p>
<h3>Python version</h3>
<p>Python 3.9.20</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ido123net on 2025-01-30 21:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-30 21:23</div>
            <div class="timeline-body"><p>I don't think this is a uv problem, this is just the reality of using packages installed in one context in another context. Paramiko (edit: or, as Charlie subsequently pointed out, a dependency of it) chooses to build wheels that dynamically link libc, so a compatible version of libc needs to be around at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-01-30 21:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-01-30 21:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-30 21:24</div>
            <div class="timeline-body"><p>(Thanks for the clear reproduction steps though!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-30 21:24</div>
            <div class="timeline-body"><p>Hmm... Like, you're accessing the exact same virtual environment? You need different wheels when running against different glibc versions -- that virtual environment isn't seamlessly compatible across platforms. Notice that cryptography publishes wheels for 2.17 and 2.28: https://pypi.org/project/cryptography/#files. uv doesn't introspect which wheel is already-installed when you execute <code>uv run</code>. It could? I doubt any other tool does that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-30 21:24</div>
            <div class="timeline-body"><p>@zanieb I think the error is actually in cryptography.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-30 21:28</div>
            <div class="timeline-body"><p>If you install on the older Ubuntu, it should work on the newer one. Alternatively, you could request a specific <code>--python-platform</code>, e.g., one of</p>
<pre><code>x86_64-manylinux2014: An x86_64 target for the manylinux2014 platform. Equivalent to x86_64-manylinux_2_17
x86_64-manylinux_2_17: An x86_64 target for the manylinux_2_17 platform
x86_64-manylinux_2_28: An x86_64 target for the manylinux_2_28 platform
x86_64-manylinux_2_31: An x86_64 target for the manylinux_2_31 platform
x86_64-manylinux_2_32: An x86_64 target for the manylinux_2_32 platform
x86_64-manylinux_2_33: An x86_64 target for the manylinux_2_33 platform
x86_64-manylinux_2_34: An x86_64 target for the manylinux_2_34 platform
x86_64-manylinux_2_35: An x86_64 target for the manylinux_2_35 platform
x86_64-manylinux_2_36: An x86_64 target for the manylinux_2_36 platform
x86_64-manylinux_2_37: An x86_64 target for the manylinux_2_37 platform
x86_64-manylinux_2_38: An x86_64 target for the manylinux_2_38 platform
x86_64-manylinux_2_39: An x86_64 target for the manylinux_2_39 platform
x86_64-manylinux_2_40: An x86_64 target for the manylinux_2_40 platform
</code></pre>
<p>where <code>2_&lt;NUM&gt;</code> refers to the GLIBC version (ref https://peps.python.org/pep-0600/)</p>
<p>But this is only available in the lower-level <code>uv pip</code> interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-30 21:33</div>
            <div class="timeline-body"><p>We can think about how to handle this case better though, agree that user-experience is not ideal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ido123net">@ido123net</a> on 2025-01-30 21:47</div>
            <div class="timeline-body"><p>Yes, I tried to generalize the use case.</p>
<p>If I'm installing it on the older Ubuntu it works fine on the newer one. (this is actually what we are doing now).
But, I wanted something like the <code>--python-platform</code> for the <code>uv run</code> interface.</p>
<p>The use case is that we have stronger computers with newer OS to develop on, and we have many &quot;old&quot; computers which acts as controllers for some embedded HW.</p>
<p>My CI job is starts on the &quot;strong&quot; PC and distribute the jobs to the &quot;old&quot; PCs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-30 21:49</div>
            <div class="timeline-body"><p>Yeah, I think you should be able to specify your minimum-supported glibc version somehow. That would at least solve this case (though wouldn't solve the general case of, like, the platform changing from under us).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2025-01-30 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2025-01-30 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @charliermarsh on 2025-01-30 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ido123net">@ido123net</a> on 2025-01-30 21:55</div>
            <div class="timeline-body"><p>I don't know if it's better to let <code>uv-run</code> handle it on its own.</p>
<p>Maybe a better approach would be to handle it like the existing interface in <code>uv-pip</code>, using the <code>--python-platform</code> option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-30 21:56</div>
            <div class="timeline-body"><p>Yeah there are basically two options:</p>
<ol>
<li>Let users specify a minimum glibc version (or <code>--python-platform</code>) as a setting.</li>
<li>In <code>uv run</code>, look at the installed packages, and uninstall + reinstall any packages that are incompatible with the current platform.</li>
</ol>
<p>(2) would be automatic, but it would also mean that if you're sharing the environment across two incompatible machines in real-time, things would break down.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ido123net">@ido123net</a> on 2025-01-30 21:59</div>
            <div class="timeline-body"><p>Exactly, this is why I prefer (1), this way I can create the environment with the desire minimum <code>glibc</code> , and share it across all compatible environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-08-25 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-08-29 00:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:26:28 UTC
    </footer>
</body>
</html>
