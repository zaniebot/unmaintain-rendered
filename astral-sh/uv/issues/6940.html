<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spurious test failures related to Windows permissions on temporary directory - astral-sh/uv #6940</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Spurious test failures related to Windows permissions on temporary directory</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6940">#6940</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-09-02 18:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-02 18:21</div>
            <div class="timeline-body"><pre><code>running 1 test
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: uv_run_isolate
Source: E:\uv:533
───────────────────────────────────────────────────────────────────────────────
Expression: snapshot
───────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────
    0       │-success: true
    1       │-exit_code: 0
          0 │+success: false
          1 │+exit_code: 2
    2     2 │ ----- stdout -----
    3       │-Success
    4     3 │ 
    5     4 │ ----- stderr -----
    6     5 │ Using Python 3.12.[X] interpreter at: [PYTHON-3.12]
    7     6 │ Creating virtualenv at: .venv
    8     7 │ Resolved 8 packages in [TIME]
    9       │-Prepared 7 packages in [TIME]
   10       │-Installed 7 packages in [TIME]
   11       │- + albatross==0.1.0 (from file://[TEMP_DIR]/albatross-root-workspace)
   12       │- + anyio==4.3.0
   13       │- + bird-feeder==1.0.0 (from file://[TEMP_DIR]/albatross-root-workspace/packages/bird-feeder)
   14       │- + idna==3.6
   15       │- + seeds==1.0.0 (from file://[TEMP_DIR]/albatross-root-workspace/packages/seeds)
   16       │- + sniffio==1.3.1
   17       │- + tqdm==4.66.2
          8 │+error: Failed to prepare distributions
          9 │+  Caused by: Failed to fetch wheel: seeds @ file://[TEMP_DIR]/albatross-root-workspace/packages/seeds
         10 │+  Caused by: Build backend failed to build wheel through `build_editable()` with exit code: 1
         11 │+--- stdout:
         12 │+
         13 │+--- stderr:
         14 │+Traceback (most recent call last):
         15 │+  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
         16 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/build.py&quot;, line 83, in build_editable
         17 │+    return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))
         18 │+                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         19 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/interface.py&quot;, line 90, in build
         20 │+    self.metadata.validate_fields()
         21 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 259, in validate_fields
         22 │+    _ = self.version
         23 │+        ^^^^^^^^^^^^
         24 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 143, in version
         25 │+    self._version = self._get_version()
         26 │+                    ^^^^^^^^^^^^^^^^^^^
         27 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 248, in _get_version
         28 │+    from packaging.version import InvalidVersion, Version
         29 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
         30 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
         31 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
         32 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 991, in exec_module
         33 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1128, in get_code
         34 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1186, in get_data
         35 │+PermissionError: [Errno 13] Permission denied: 'E:\/uv-tmp\/[TMP]/version.py'
         36 │+---
────────────┴──────────────────────────────────────────────────────────────────
Stopped on the first failure. Run `cargo insta test` to run all snapshots.
test test_uv_run_isolate ... FAILED
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @charliermarsh on 2024-09-02 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6939.html">astral-sh/uv#6939</a> on 2024-09-02 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-03 14:47</div>
            <div class="timeline-body"><p>Duplicate of https://github.com/astral-sh/uv/issues/6789 — better title though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6789.html">astral-sh/uv#6789</a> on 2024-09-03 14:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-03 14:49</div>
            <div class="timeline-body"><p>Maybe since https://github.com/astral-sh/uv/pull/6680 ?</p>
<p>I wonder if this is a real bug that's just surfaced now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-03 14:51</div>
            <div class="timeline-body"><p>(Sorry for the dupe, thanks.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-09-05 14:21</div>
            <div class="timeline-body"><p>Shouldn't the temp dir need to be created before tests start to run?</p>
<p><code>setup-dev-drive.ps1</code> might need an adjustment to create that directory</p>
<pre><code>...
Write-Output $Volume

$Drive = &quot;$($Volume.DriveLetter):&quot;
$Tmp = &quot;$($Drive)/uv-tmp&quot;

New-Item $Tmp -ItemType Directory
...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-05 14:42</div>
            <div class="timeline-body"><p>Oh is this related to #6929 ?</p>
<p>Why would it work sometimes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-09-05 15:15</div>
            <div class="timeline-body"><p>Thats the first difference from before and after I can think about. In CI, C: drive already had a temp drive ahead of time, where as the dev drive doesn't. Assuming the errors started happening after those PRs. Given env:tmp_dir does not ensure the dir exists, I assumed this being a potential cause.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7644.html">astral-sh/uv#7644</a> on 2024-09-23 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 19:19</div>
            <div class="timeline-body"><p>Another example</p>
<pre><code>         13 │+[stderr]
         14 │+Traceback (most recent call last):
         15 │+  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
         16 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/build.py&quot;, line 83, in build_editable
         17 │+    return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))
         18 │+                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         19 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/interface.py&quot;, line 90, in build
         20 │+    self.metadata.validate_fields()
         21 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 260, in validate_fields
         22 │+    self.core.validate_fields()
         23 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 1352, in validate_fields
         24 │+    getattr(self, attribute)
         25 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 1223, in dependencies
         26 │+    self._dependencies = list(self.dependencies_complex)
         27 │+                              ^^^^^^^^^^^^^^^^^^^^^^^^^
         28 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 1174, in dependencies_complex
         29 │+    from packaging.requirements import InvalidRequirement, Requirement
         30 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/requirements.py&quot;, line 9, in &lt;module&gt;
         31 │+    from .markers import Marker, _normalize_extra_values
         32 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
         33 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
         34 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
         35 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 991, in exec_module
         36 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1128, in get_code
         37 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1186, in get_data
         38 │+PermissionError: [Errno 13] Permission denied: 'E:\/uv-tmp\/[TMP]/markers.py'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8347.html">astral-sh/uv#8347</a> on 2024-10-18 19:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8348.html">astral-sh/uv#8348</a> on 2024-10-18 22:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 22:35</div>
            <div class="timeline-body"><pre><code>Snapshot file: crates\uv\tests\it\snapshots\it__ecosystem__saleor-uv-lock-output.snap
Snapshot: saleor-uv-lock-output
Source: E:\uv:124
───────────────────────────────────────────────────────────────────────────────
Expression: snapshot
───────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────
    0       │-success: true
    1       │-exit_code: 0
          0 │+success: false
          1 │+exit_code: 1
    2     2 │ ----- stdout -----
    3     3 │ 
    4     4 │ ----- stderr -----
    5       │-Resolved 170 packages in [TIME]
          5 │+  × Failed to download and build `html2text==2024.2.26`
          6 │+  ╰─▶ Build backend failed to determine metadata through `prepare_metadata_for_build_wheel` (exit code: 1)
          7 │+
          8 │+      [stdout]
          9 │+      running dist_info
         10 │+      creating [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/html2text.egg-info
         11 │+      writing [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/PKG-INFO
         12 │+      writing dependency_links to [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/dependency_links.txt
         13 │+      writing entry points to [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/entry_points.txt
         14 │+      writing top-level names to [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/top_level.txt
         15 │+      writing manifest file '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/SOURCES.txt'
         16 │+      reading manifest file '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/SOURCES.txt'
         17 │+      reading manifest template 'MANIFEST.in'
         18 │+      adding license file 'COPYING'
         19 │+      adding license file 'AUTHORS.rst'
         20 │+      writing manifest file '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/SOURCES.txt'
         21 │+      creating '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/html2text-2024.2.26.dist-info'
         22 │+
         23 │+      [stderr]
         24 │+      error: [Errno 13] Permission denied: 'E:\/uv\/target\/ecosystem-test-caches\/saleor\/builds-v0\/[TMP]/util.py'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 22:36</div>
            <div class="timeline-body"><pre><code>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: uv_run_virtual_workspace_root
Source: E:\uv:430
───────────────────────────────────────────────────────────────────────────────
Expression: snapshot
───────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────
    0       │-success: true
    1       │-exit_code: 0
          0 │+success: false
          1 │+exit_code: 2
    2     2 │ ----- stdout -----
    3       │-Success
    4     3 │ 
    5     4 │ ----- stderr -----
    6     5 │ warning: `VIRTUAL_ENV=[VENV]/` does not match the project environment path `.venv` and will be ignored
    7     6 │ Using CPython 3.12.[X] interpreter at: [PYTHON-3.12]
    8     7 │ Creating virtual environment at: .venv
    9     8 │ Resolved 8 packages in [TIME]
   10       │-Prepared 7 packages in [TIME]
   11       │-Installed 7 packages in [TIME]
   12       │- + albatross==0.1.0 (from file://[TEMP_DIR]/albatross-virtual-workspace/packages/albatross)
   13       │- + anyio==4.3.0
   14       │- + bird-feeder==1.0.0 (from file://[TEMP_DIR]/albatross-virtual-workspace/packages/bird-feeder)
   15       │- + idna==3.6
   16       │- + seeds==1.0.0 (from file://[TEMP_DIR]/albatross-virtual-workspace/packages/seeds)
   17       │- + sniffio==1.3.1
   18       │- + tqdm==4.66.2
          9 │+error: Failed to prepare distributions
         10 │+  Caused by: Failed to fetch wheel: bird-feeder @ file://[TEMP_DIR]/albatross-virtual-workspace/packages/bird-feeder
         11 │+  Caused by: Build backend failed to build editable through `build_editable` (exit code: 1)
         12 │+
         13 │+[stderr]
         14 │+Traceback (most recent call last):
         15 │+  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
         16 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/build.py&quot;, line 83, in build_editable
         17 │+    return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))
         18 │+                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         19 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/interface.py&quot;, line 155, in build
         20 │+    artifact = version_api[version](directory, **build_data)
         21 │+               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         22 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/wheel.py&quot;, line 434, in build_editable
         23 │+    return self.build_editable_detection(directory, **build_data)
         24 │+           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         25 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/wheel.py&quot;, line 437, in build_editable_detection
         26 │+    from editables import EditableProject
         27 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
         28 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
         29 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
         30 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 991, in exec_module
         31 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1128, in get_code
         32 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1186, in get_data
         33 │+PermissionError: [Errno 13] Permission denied: 'E:\/uv-tmp\/[TMP]/__init__.py'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 22:37</div>
            <div class="timeline-body"><pre><code>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: require_hashes_find_links_no_hash-4
Source: E:\uv:4621
───────────────────────────────────────────────────────────────────────────────
Expression: snapshot
───────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────
    0       │-success: true
    1       │-exit_code: 0
          0 │+success: false
          1 │+exit_code: 2
    2     2 │ ----- stdout -----
    3     3 │ 
    4     4 │ ----- stderr -----
    5     5 │ Resolved 1 package in [TIME]
    6       │-Prepared 1 package in [TIME]
    7       │-Uninstalled 1 package in [TIME]
    8       │-Installed 1 package in [TIME]
    9       │- ~ example-a-961b4c22==1.0.0
          6 │+error: Failed to prepare distributions
          7 │+  Caused by: Failed to fetch wheel: example-a-961b4c22==1.0.0
          8 │+  Caused by: Failed to install requirements from `build-system.requires`
          9 │+  Caused by: Failed to prepare distributions
         10 │+  Caused by: Failed to fetch wheel: trove-classifiers==2024.3.3
         11 │+  Caused by: Build backend failed to build wheel through `build_wheel` (exit code: 1)
         12 │+
         13 │+[stderr]
         14 │+Traceback (most recent call last):
         15 │+  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
         16 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/build_meta.py&quot;, line 410, in build_wheel
         17 │+    return self._build_with_temp_dir(
         18 │+           ^^^^^^^^^^^^^^^^^^^^^^^^^^
         19 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/build_meta.py&quot;, line 395, in _build_with_temp_dir
         20 │+    self.run_setup()
         21 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
         22 │+    exec(code, locals())
         23 │+  File &quot;&lt;string&gt;&quot;, line 12, in &lt;module&gt;
         24 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/__init__.py&quot;, line 104, in setup
         25 │+    return distutils.core.setup(**attrs)
         26 │+           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         27 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/_distutils/core.py&quot;, line 172, in setup
         28 │+    ok = dist.parse_command_line()
         29 │+         ^^^^^^^^^^^^^^^^^^^^^^^^^
         30 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/_distutils/dist.py&quot;, line 475, in parse_command_line
         31 │+    args = self._parse_command_opts(parser, args)
         32 │+           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         33 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/dist.py&quot;, line 869, in _parse_command_opts
         34 │+    nargs = _Distribution._parse_command_opts(self, parser, args)
         35 │+            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         36 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/_distutils/dist.py&quot;, line 534, in _parse_command_opts
         37 │+    cmd_class = self.get_command_class(command)
         38 │+                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         39 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/setuptools/dist.py&quot;, line 714, in get_command_class
40 │+    self.cmdclass[command] = cmdclass = ep.load()
         41 │+                                        ^^^^^^^^^
         42 │+  File &quot;C:/hostedtoolcache/windows/Python/3.12.7/x64/Lib/importlib/metadata/__init__.py&quot;, line 205, in load
         43 │+    module = import_module(match.group('module'))
         44 │+             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         45 │+  File &quot;C:/hostedtoolcache/windows/Python/3.12.7/x64/Lib/importlib/__init__.py&quot;, line 90, in import_module
         46 │+    return _bootstrap._gcd_import(name[level:], package, level)
         47 │+           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         48 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1387, in _gcd_import
         49 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
         50 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
         51 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
         52 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 995, in exec_module
         53 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 488, in _call_with_frames_removed
         54 │+  File &quot;E:/uv-tmp\.tmpV76s9s/cache/builds-v0\.tmpZcJQUN/Lib/site-packages/wheel/bdist_wheel.py&quot;, line 27, in &lt;module&gt;
         55 │+    from .macosx_libfile import calculate_macosx_platform_tag
         56 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
         57 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
         58 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
         59 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 991, in exec_module
         60 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1128, in get_code
         61 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1186, in get_data
         62 │+PermissionError: [Errno 13] Permission denied: 'E:\/uv-tmp\\.tmpV76s9s\/cache\/builds-v0\\.tmpZcJQUN\/Lib\/site-packages\/wheel\/macosx_libfile.py'
────────────┴──────────────────────────────────────────────────────────────────
Stopped on the first failure. Run `cargo insta test` to run all snapshots.
test pip_sync::require_hashes_find_links_no_hash ... FAILED
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 22:39</div>
            <div class="timeline-body"><p>Some observations</p>
<ol>
<li>The failures are common, but not limited to the workspace tests.</li>
<li>The failures always occur during distribution builds.</li>
<li>The failures occur with both setuptools and hatchling build backends.</li>
<li>The failures are always in <code>importlib._bootstrap_external.get_data</code> reading a file to resolve an import.</li>
<li>I think the imports are always outside the standard library.</li>
<li>We don't install from source distributions in most of the test suite.</li>
<li>It seems to reproduce when multiple tests are run concurrently, but not one in a loop.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 22:44</div>
            <div class="timeline-body"><pre><code>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: lock_sources_source_tree-4
Source: E:\uv:8085
───────────────────────────────────────────────────────────────────────────────
Expression: snapshot
───────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────
    0       │-success: true
    1       │-exit_code: 0
          0 │+success: false
          1 │+exit_code: 2
    2     2 │ ----- stdout -----
    3     3 │ 
    4     4 │ ----- stderr -----
    5       │-Prepared 3 packages in [TIME]
    6       │-Installed 3 packages in [TIME]
    7       │- + anyio==0.1.0 (from file://[TEMP_DIR]/workspace/anyio)
    8       │- + project==0.1.0 (from file://[TEMP_DIR]/)
    9       │- + workspace==0.1.0 (from file://[TEMP_DIR]/workspace)
          5 │+error: Failed to prepare distributions
          6 │+  Caused by: Failed to fetch wheel: project @ file://[TEMP_DIR]/
          7 │+  Caused by: Build backend failed to build editable through `build_editable()` with exit code: 1
          8 │+--- stdout:
          9 │+
         10 │+--- stderr:
         11 │+Traceback (most recent call last):
         12 │+  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
         13 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/build.py&quot;, line 83, in build_editable
         14 │+    return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))
         15 │+                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         16 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/interface.py&quot;, line 90, in build
         17 │+    self.metadata.validate_fields()
         18 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 260, in validate_fields
         19 │+    self.core.validate_fields()
         20 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 1352, in validate_fields
         21 │+    getattr(self, attribute)
         22 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 1223, in dependencies
         23 │+    self._dependencies = list(self.dependencies_complex)
         24 │+                              ^^^^^^^^^^^^^^^^^^^^^^^^^
         25 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/core.py&quot;, line 1174, in dependencies_complex
         26 │+    from packaging.requirements import InvalidRequirement, Requirement
         27 │+  File &quot;[CACHE_DIR]/builds-v0/[TMP]/requirements.py&quot;, line 9, in &lt;module&gt;
         28 │+    from .markers import Marker, _normalize_extra_values
         29 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
         30 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
         31 │+  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
         32 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 991, in exec_module
         33 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1128, in get_code
         34 │+  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1186, in get_data
         35 │+PermissionError: [Errno 13] Permission denied: 'E:\/uv-tmp\/[TMP]/markers.py'
         36 │+---
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 22:46</div>
            <div class="timeline-body"><pre><code>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot file: crates\uv\tests\snapshots\ecosystem__saleor-uv-lock-output.snap
Snapshot: saleor-uv-lock-output
Source: E:\uv:128
───────────────────────────────────────────────────────────────────────────────
Expression: snapshot
───────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────
    0       │-success: true
    1       │-exit_code: 0
          0 │+success: false
          1 │+exit_code: 2
    2     2 │ ----- stdout -----
    3     3 │ 
    4     4 │ ----- stderr -----
    5       │-Resolved 170 packages in [TIME]
          5 │+error: Failed to download and build `rx==1.6.3`
          6 │+  Caused by: Build backend failed to determine metadata through `prepare_metadata_for_build_wheel` with exit code: 1
          7 │+--- stdout:
          8 │+running dist_info
          9 │+creating [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/Rx.egg-info
         10 │+writing [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/PKG-INFO
         11 │+writing dependency_links to [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/dependency_links.txt
         12 │+writing top-level names to [WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/top_level.txt
         13 │+writing manifest file '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/SOURCES.txt'
         14 │+reading manifest file '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/SOURCES.txt'
         15 │+adding license file 'LICENSE'
         16 │+writing manifest file '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/SOURCES.txt'
         17 │+creating '[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/Rx-1.6.3.dist-info'
         18 │+--- stderr:
         19 │+[WORKSPACE]/target/ecosystem-test-caches/saleor/builds-v0/[TMP]/dist.py:268: UserWarning: Unknown distribution option: 'test_suite'
         20 │+  warnings.warn(msg)
         21 │+error: [Errno 13] Permission denied: 'E:\/uv\/target\/ecosystem-test-caches\/saleor\/builds-v0\/[TMP]/wheelfile.py'
         22 │+---
────────────┴─────────────────────────────────────────────────────────────────
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8350.html">astral-sh/uv#8350</a> on 2024-10-18 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-20 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-20 18:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
