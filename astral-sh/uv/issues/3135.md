```yaml
number: 3135
title: Preemptively unroll recursive extras during resolution
type: issue
state: closed
author: charliermarsh
labels:
  - bug
  - performance
assignees: []
created_at: 2024-04-19T04:16:06Z
updated_at: 2024-04-24T11:51:57Z
url: https://github.com/astral-sh/uv/issues/3135
synced_at: 2026-01-10T01:57:07Z
```

# Preemptively unroll recursive extras during resolution

---

_Issue opened by @charliermarsh on 2024-04-19 04:16_

Right now, when we see a requirement with a recursive extra, we just add that as a constraint and return the set of resolved constraints. We'll later ask for the requirements for that same package with the recursive extra, return the set of resolved constraints, and continue.

This is somewhat inefficient as we "miss out" on constraints that are applied by the recursive extra that we should be able to collect earlier than we currently are.

This is roughly what happened in https://github.com/astral-sh/uv/issues/3127: there was an additional constraint that we didn't apply until much later than we should've.


---

_Label `bug` added by @charliermarsh on 2024-04-19 04:16_

---

_Label `performance` added by @charliermarsh on 2024-04-19 04:16_

---

_Comment by @charliermarsh on 2024-04-19 04:16_

It's both bug and performance, since _not_ doing this sometimes leads to use attempting to build packages that we should be able to skip (which can lead to failed resolutions).

---

_Referenced in [astral-sh/uv#3230](../../astral-sh/uv/pulls/3230.md) on 2024-04-24 01:22_

---

_Closed by @charliermarsh on 2024-04-24 11:51_

---
