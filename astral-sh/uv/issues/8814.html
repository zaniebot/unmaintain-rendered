<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow conflicting dependency groups - astral-sh/uv #8814</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow conflicting dependency groups</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8814">#8814</a>
        opened by <a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a>
        on 2024-11-04 18:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a></div>
            <div class="timeline-body"><p>I have noticed that <code>uv</code> doesn't the installation of a dependency group when there are conflicting dependency groups.</p>
<p>Example of a <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;dep-groups&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = []


[dependency-groups]
scikit = [
    &quot;scikit-learn==1.3.2&quot;
]
scikit-prev = [
    &quot;scikit-learn==1.3.1&quot;
]
</code></pre>
<p><code>uv sync --group scikit</code> returns the error:</p>
<pre><code>Creating virtual environment at: .venv
  × No solution found when resolving dependencies:
  ╰─▶ Because dep-groups:scikit depends on scikit-learn==1.3.2 and dep-groups:scikit-prev depends on
      scikit-learn==1.3.1, we can conclude that dep-groups:scikit and dep-groups:scikit-prev are incompatible.
      And because your project depends on dep-groups:scikit and dep-groups:scikit-prev, we can conclude that your
      project's requirements are unsatisfiable.
</code></pre>
<p><strong>PS</strong>:
I'm not opening this issue to say that <code>uv</code> should or should not. That's something that <a href="https://peps.python.org/pep-0735/">PEP 735</a> left for the tools to implement their own strategy (see <a href="https://peps.python.org/pep-0735/#lockfile-generation">lockfile generation</a>).
I'm opening it to provide a link to fix a typo, in my opinion, in the documentation here: https://docs.astral.sh/uv/concepts/dependencies/#dependency-groups
The issue referred to in the note concerns optional dependencies and not dependency groups.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 19:32</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/issues/6981 is intended to cover all forms of optional dependencies, including the <code>dependency-groups</code> and the <code>project.optional-dependency</code> tables. The problem we need to solve is the same in both cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 19:45</div>
            <div class="timeline-body"><p>I'll update that to reflect it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a> on 2024-11-04 19:47</div>
            <div class="timeline-body"><p>Oh I see sorry then.</p>
<p>Is there perhaps an issue or just an idea somewhere to have a clearer &quot;nomenclature&quot;? For the moment I have noticed these things:</p>
<ul>
<li>The <code>sync</code> command doesn't have an <code>--optional</code> option. If we want to install an optional dependency, we have to use the <code>--extra</code> option. Which makes sense since the &quot;groups&quot; inside the <code>optional-dependencies</code> table are called <code>extras</code>.</li>
<li>But, the <code>--extra</code> option for the <code>add</code> command is used to install the extra for a given package we want to add, and not add the package as an extra for the optional dependencies. It is explicitly specified in the manual for the <code>add</code> command to use <code>--optional</code> when we want to add an optional dependency, but I can't shake of the feeling that it's a bit confusing. I'm wondering if it'd be less confusing to unify on a same interface, either using <code>--optional</code> or <code>--extra</code>, especially since we can use dependency specifiers to install extras. <code>uv add &quot;pandas[excel]&quot;</code> is the same as <code>uv add --extra excel pandas</code></li>
<li>The error message when either two optional dependencies extras are conflicting, two dependency groups are conflicting, or at least one extra and one dependency groups are conflicting always mentions <code>dep-groups[a-conflicting-extra-or-group-name]</code></li>
</ul>
<p>But it's nothing that can't be learned! I'm just trying to pinpoint some minor things as I'm trying to get incorporate <code>uv</code> in my workflows.</p>
<p>Do you advise I close both this issue and the PR or do you think it's better if someone from your team does that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 19:56</div>
            <div class="timeline-body"><p>Thanks for pointing out the discrepancies — it's a bit tricky because we designed all the interfaces before dependency groups were available. Since we added supported for them so recently, it's not surprising that there are some rough edges. Feel free to open an issue regarding changing the interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-11-04 19:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 19:56</div>
            <div class="timeline-body"><p>Also, thanks for taking the time to contribute :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:07 UTC
    </footer>
</body>
</html>
