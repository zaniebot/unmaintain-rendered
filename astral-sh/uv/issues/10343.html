<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change in `--upgrade` behavior breaks install from private registry - astral-sh/uv #10343</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Change in `--upgrade` behavior breaks install from private registry</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10343">#10343</a>
        opened by <a href="https://github.com/samuelcolvin">@samuelcolvin</a>
        on 2025-01-07 09:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/samuelcolvin">@samuelcolvin</a> on 2025-01-07 09:24</div>
            <div class="timeline-body"><p>(Mostly for the benefits of others encountering this problem.)</p>
<p>The changes introduced in #10097 and released in <code>v0.5.15</code> have broken our workflow for installing <code>mkdocs-material</code> and <code>mkdocstrings</code> from our private registry in <a href="https://github.com/pydantic/pydantic-ai">pydantic-ai</a> - we were <a href="https://github.com/pydantic/pydantic-ai/blob/72300ae7760c51163b8932866bd95f6695d11b12/Makefile#L87-L90">using</a>:</p>
<pre><code class="language-bash">	@echo 'installing insiders packages...'
	@uv pip install -U \
		--extra-index-url https://pydantic:${PPPR_TOKEN}@pppr.pydantic.dev/simple/ \
		mkdocs-material mkdocstrings-python
</code></pre>
<p>To install the insiders version of these packages, as a result of #10097 this no longer works since the versions of those packages we have in our private registry are older than the ones already installed.</p>
<p>The work around is to uninstall the packages first, e.g. change the above to</p>
<pre><code class="language-bash">	@echo 'installing insiders packages...'
	@uv pip uninstall mkdocs-material mkdocstrings-python
	@uv pip install \
		--extra-index-url https://pydantic:${PPPR_TOKEN}@pppr.pydantic.dev/simple/ \
		mkdocs-material mkdocstrings-python
</code></pre>
<p>See https://github.com/pydantic/pydantic-ai/pull/622.</p>
<p>By the way, I'd love a better way to managing the option to install packages from a private repo üôè.</p>
<p>Feel free to close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samuelcolvin">@samuelcolvin</a> on 2025-01-07 10:08</div>
            <div class="timeline-body"><p>... Acknowledging that there's a bit of <a href="https://m.xkcd.com/1172/">XKCD 1172</a> about this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-01-07 10:35</div>
            <div class="timeline-body"><p>I think for your workflow it is proper to use <code>--reinstall</code> instead of <code>--upgrade</code>. You can also see <a href="https://github.com/astral-sh/uv/pull/10097/files#diff-4decbdad65ae6c2e77b162950bc1a15907dacaff952fcee61559704bf370fb06R2684-R2702">this example</a> from mentioned PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pydantic/pydantic-ai/pulls/624.html">pydantic/pydantic-ai#624</a> on 2025-01-07 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-01-07 11:15</div>
            <div class="timeline-body"><blockquote>
<p>See</p>
<p>https://github.com/pydantic/pydantic-ai/actions/runs/12649998415/job/35247581389</p>
<p>vs</p>
<p>https://github.com/pydantic/pydantic-ai/actions/runs/12650057969/job/35247762611</p>
<p>This is causing all packages to be reinstalled, rather than just installing the required ones which makes it slower, not a big problem in CI, but it will slow down local development, therefore I'm going to stick with what we have now.</p>
</blockquote>
<p>With https://github.com/pydantic/pydantic-ai/issues/625#issuecomment-2574982831 I think you can either add <code>--reinstall-package &lt;PKG&gt;</code> per package or use <code>--reinstall --no-deps</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pydantic/pydantic-ai/pulls/627.html">pydantic/pydantic-ai#627</a> on 2025-01-07 11:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-07 13:48</div>
            <div class="timeline-body"><p>Gah, thanks. That's a funny one -- sorry for the disruption. I think <code>--reinstall</code> is probably what you want here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-07 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @charliermarsh on 2025-01-07 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-01-07 14:21</div>
            <div class="timeline-body"><p>One question is in my mind, if in future, internal <code>mkdocs-material</code> updated it dependencies that are in conflict with original <code>mkdocs-material</code> dependencies, does still <code>--reinstall --no-deps</code> work for them?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:00 UTC
    </footer>
</body>
</html>
