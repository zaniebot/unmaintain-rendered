<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Managed Python sysconfig returns incorrect path to CC on Amazon Linux 2023 - astral-sh/uv #12901</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Managed Python sysconfig returns incorrect path to CC on Amazon Linux 2023</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12901">#12901</a>
        opened by <a href="https://github.com/nwalters512">@nwalters512</a>
        on 2025-04-15 18:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nwalters512">@nwalters512</a> on 2025-04-15 18:02</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>This simplest way to reproduce this is to build the following simple Docker image:</p>
<pre><code class="language-Dockerfile">FROM amazonlinux:2023

RUN dnf install -y gcc g++ tar

RUN curl -LO https://astral.sh/uv/install.sh \
    &amp;&amp; sh install.sh \
    &amp;&amp; rm install.sh \
    &amp;&amp; source $HOME/.local/bin/env \
    &amp;&amp; uv version \
    &amp;&amp; uv venv --python 3.10 \
    &amp;&amp; source ./.venv/bin/activate \
    &amp;&amp; python3 -c 'import sysconfig; print(sysconfig.get_config_var(&quot;CC&quot;))'
</code></pre>
<p>That ultimately logs <code>/usr/bin/aarch64-linux-gnu-gcc</code>, but on this system, the correct path is <code>/usr/bin/aarch64-amazon-linux-gcc</code>.</p>
<p>If we add the following command, we can see that <code>CC</code> indeed points at the wrong path:</p>
<pre><code class="language-sh">cat /root/.local/share/uv/python/cpython-3.10.17-linux-aarch64-gnu/lib/python3.10/_sysconfigdata__linux_aarch64-linux-gnu.py
</code></pre>
<pre><code class="language-py"># system configuration generated and used by the sysconfig module
build_time_vars = {
    # omitted for brevity...
    &quot;CC&quot;: &quot;/usr/bin/aarch64-linux-gnu-gcc&quot;,
    # omitted for brevity...
}
</code></pre>
<p>To reproduce an actual error that stems from this, build the following Docker image, which installs <code>pygraphviz</code>, which in turn needs to be built with <code>gcc</code>:</p>
<pre><code class="language-Dockerfile">FROM amazonlinux:2023

RUN dnf install -y gcc g++ tar

RUN curl -LO https://astral.sh/uv/install.sh \
    &amp;&amp; sh install.sh \
    &amp;&amp; rm install.sh \
    &amp;&amp; source $HOME/.local/bin/env \
    &amp;&amp; uv venv --python 3.10 \
    &amp;&amp; uv pip install pygraphviz==1.14
</code></pre>
<p>This ultimately fails with the following:</p>
<pre><code>error: command '/usr/bin/aarch64-linux-gnu-gcc' failed: No such file or directory
</code></pre>
<h3>Platform</h3>
<p>Amazon Linux 2023 aarch64 (Linux 6.10.14-linuxkit aarch64 GNU/Linux)</p>
<h3>Version</h3>
<p>uv 0.6.14</p>
<h3>Python version</h3>
<p>3.10.17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @nwalters512 on 2025-04-15 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../PrairieLearn/PrairieLearn/pulls/11039.html">PrairieLearn/PrairieLearn#11039</a> on 2025-04-15 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-16 13:32</div>
            <div class="timeline-body"><p>I think this is fixed by https://github.com/astral-sh/uv/pull/12239 (which I just merged)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-04-16 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nwalters512">@nwalters512</a> on 2025-04-22 18:12</div>
            <div class="timeline-body"><p>@zanieb I just tested my above repros with the latest release of <code>uv</code>.</p>
<ul>
<li>In the first example, it now logs <code>cc</code> (which I think is what I expect).</li>
<li>In the second one, I'm still seeing the same error, though this time things get further than they did before. Note that I added a step to install <code>graphviz</code> and <code>graphviz-devel</code> with <code>dnf</code>, so the full Dockerfile is now this:</li>
</ul>
<pre><code class="language-Dockerfile">FROM amazonlinux:2023

RUN dnf install -y gcc g++ tar graphviz graphviz-devel

RUN curl -LO https://astral.sh/uv/install.sh \
    &amp;&amp; sh install.sh \
    &amp;&amp; rm install.sh \
    &amp;&amp; source $HOME/.local/bin/env \
    &amp;&amp; uv venv --python 3.10 \
    &amp;&amp; uv pip install pygraphviz==1.14
</code></pre>
<p>After <code>cat</code>ing the same file in the first example, I see there are still a number of sysconfig vars that reference the path <code>/usr/bin/aarch64-linux-gnu-gcc</code>. Here's a list of them:</p>
<pre><code>&quot;BLDSHARED&quot;: &quot;/usr/bin/aarch64-linux-gnu-gcc -shared -Wl,--exclude-libs,ALL&quot;,
&quot;CONFIG_ARGS&quot;: &quot;'--build=x86_64-unknown-linux-gnu' '--host=aarch64-unknown-linux-gnu' '--prefix=/install' '--with-openssl=/tools/deps' '--with-system-expat' '--with-system-libmpdec' '--without-ensurepip' '--with-readline=editline' '--enable-shared' '--with-lto' '--with-dbmliborder=bdb' 'ac_cv_buggy_getaddrinfo=no' 'ac_cv_file__dev_ptc=no' 'ac_cv_file__dev_ptmx=no' 'ac_cv_working_tzset=yes' 'build_alias=x86_64-unknown-linux-gnu' 'host_alias=aarch64-unknown-linux-gnu' 'CC=/usr/bin/aarch64-linux-gnu-gcc' 'CFLAGS= -fPIC ' 'LDFLAGS= -Wl,--exclude-libs,ALL' 'CPPFLAGS= -fPIC ' 'PKG_CONFIG=pkg-config --static' 'PKG_CONFIG_PATH=/tools/deps/share/pkgconfig:/tools/deps/lib/pkgconfig'&quot;,
&quot;LDSHARED&quot;: &quot;/usr/bin/aarch64-linux-gnu-gcc -shared -Wl,--exclude-libs,ALL&quot;,
&quot;LINKCC&quot;: &quot;/usr/bin/aarch64-linux-gnu-gcc&quot;,
&quot;MAINCC&quot;: &quot;/usr/bin/aarch64-linux-gnu-gcc&quot;,
</code></pre>
<p>I'm unsure exactly which of these <code>pygraphziz</code> is referencing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-22 21:14</div>
            <div class="timeline-body"><p>Thanks! I can take a look at that when I'm back from vacation. Feel free to poke me if I don't reply next week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nwalters512">@nwalters512</a> on 2025-04-22 21:17</div>
            <div class="timeline-body"><p>Sorry for the ping, enjoy your time off! Definitely stop replying to this for now ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-08 20:29</div>
            <div class="timeline-body"><p>It looks like they read <code>LDSHARED</code>. I guess we need to update more variables. cc @samypr100 / @bluss</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-08 20:32</div>
            <div class="timeline-body"><p>You can unblock yourself with <code>ENV LDSHARED=&quot;cc -shared&quot;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/13441.html">astral-sh/uv#13441</a> on 2025-05-14 02:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nwalters512">@nwalters512</a> on 2025-09-12 00:26</div>
            <div class="timeline-body"><p>@zanieb I'm inclined to call this closed; I can now successfully install and build <code>pygraphviz</code> in an <code>amazonlinux:2023</code> Docker image! Note that because things now get farther, I had to add a few more things to install with <code>dnf</code>. Here's the latest, working Dockerfile:</p>
<pre><code class="language-Dockerfile">FROM amazonlinux:2023

RUN dnf install -y gcc g++ tar gzip graphviz graphviz-devel

RUN curl -LO https://astral.sh/uv/install.sh \
    &amp;&amp; sh install.sh \
    &amp;&amp; rm install.sh \
    &amp;&amp; source $HOME/.local/bin/env \
    &amp;&amp; uv venv --python 3.10 \
    &amp;&amp; uv pip install pygraphviz==1.14

</code></pre>
<p>I'll close this out, feel free to reopen if you need this to track any remaining work!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @nwalters512 on 2025-09-12 00:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-12 13:16</div>
            <div class="timeline-body"><p>Thanks for the update!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:04 UTC
    </footer>
</body>
</html>
