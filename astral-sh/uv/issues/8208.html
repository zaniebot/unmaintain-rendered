<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` with no version bound does not sufficiently update uv.lock - astral-sh/uv #8208</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv add</code> with no version bound does not sufficiently update uv.lock</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8208">#8208</a>
        opened by <a href="https://github.com/keysmashes">@keysmashes</a>
        on 2024-10-15 10:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/keysmashes">@keysmashes</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>When adding a package via <code>uv add</code> with no lower bound, a lower bound is added to the entry in pyproject.toml, but this is not included in the <code>specifier</code> of the entry added to the root package's <code>package.metadata.requires-dist</code> in uv.lock.</p>
<p>Concretely, straight after a <code>uv add typing-extensions</code>, <code>package.metadata.requires-dist</code> contains an entry like <code>{ name = &quot;typing-extensions&quot; },</code>; after a subsequent <code>uv lock</code>, this is transformed into <code>{ name = &quot;typing-extensions&quot;, specifier = &quot;&gt;=4.12.2&quot; },</code>.</p>
<p>Full example:</p>
<pre><code class="language-console">$ uv --version
uv 0.4.21
$ uv add typing-extensions
warning: Missing version constraint (e.g., a lower bound) for `typing-extensions`
Resolved 32 packages in 71ms
   Built farmer @ file:///nfs/cellgeni/ash/src/farmer
Prepared 1 package in 1.37s
Uninstalled 1 package in 38ms
Installed 1 package in 92ms
 ~ farmer==24.285 (from file:///nfs/cellgeni/ash/src/farmer)
$ uv lock --locked
Resolved 32 packages in 75ms
error: The lockfile at `uv.lock` needs to be updated, but `--locked` was provided. To update the lockfile, run `uv lock`.
$ git diff
diff --git a/pyproject.toml b/pyproject.toml
index 15c42e5..6421510 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -12,6 +12,7 @@ dependencies = [
     &quot;pydantic&gt;=2.9.1&quot;,
     &quot;python-dotenv&gt;=1.0.1&quot;,
     &quot;slack-bolt==1.20.0&quot;,
+    &quot;typing-extensions&gt;=4.12.2&quot;,
     &quot;uvicorn&gt;=0.30.6&quot;,
 ]
 license.text = &quot;AGPL-3.0-or-later&quot;
diff --git a/uv.lock b/uv.lock
index f2ab008..948b86c 100644
--- a/uv.lock
+++ b/uv.lock
@@ -196,6 +196,7 @@ dependencies = [
     { name = &quot;pydantic&quot; },
     { name = &quot;python-dotenv&quot; },
     { name = &quot;slack-bolt&quot; },
+    { name = &quot;typing-extensions&quot; },
     { name = &quot;uvicorn&quot; },
 ]

@@ -208,6 +209,7 @@ requires-dist = [
     { name = &quot;pydantic&quot;, specifier = &quot;&gt;=2.9.1&quot; },
     { name = &quot;python-dotenv&quot;, specifier = &quot;&gt;=1.0.1&quot; },
     { name = &quot;slack-bolt&quot;, specifier = &quot;==1.20.0&quot; },
+    { name = &quot;typing-extensions&quot; },
     { name = &quot;uvicorn&quot;, specifier = &quot;&gt;=0.30.6&quot; },
 ]

$ uv lock
Resolved 32 packages in 65ms
$ git diff
diff --git a/pyproject.toml b/pyproject.toml
index 15c42e5..6421510 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -12,6 +12,7 @@ dependencies = [
     &quot;pydantic&gt;=2.9.1&quot;,
     &quot;python-dotenv&gt;=1.0.1&quot;,
     &quot;slack-bolt==1.20.0&quot;,
+    &quot;typing-extensions&gt;=4.12.2&quot;,
     &quot;uvicorn&gt;=0.30.6&quot;,
 ]
 license.text = &quot;AGPL-3.0-or-later&quot;
diff --git a/uv.lock b/uv.lock
index f2ab008..5d949f5 100644
--- a/uv.lock
+++ b/uv.lock
@@ -196,6 +196,7 @@ dependencies = [
     { name = &quot;pydantic&quot; },
     { name = &quot;python-dotenv&quot; },
     { name = &quot;slack-bolt&quot; },
+    { name = &quot;typing-extensions&quot; },
     { name = &quot;uvicorn&quot; },
 ]

@@ -208,6 +209,7 @@ requires-dist = [
     { name = &quot;pydantic&quot;, specifier = &quot;&gt;=2.9.1&quot; },
     { name = &quot;python-dotenv&quot;, specifier = &quot;&gt;=1.0.1&quot; },
     { name = &quot;slack-bolt&quot;, specifier = &quot;==1.20.0&quot; },
+    { name = &quot;typing-extensions&quot;, specifier = &quot;&gt;=4.12.2&quot; },
     { name = &quot;uvicorn&quot;, specifier = &quot;&gt;=0.30.6&quot; },
 ]

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-10-15 11:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-10-15 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 13:52</div>
            <div class="timeline-body"><p>Thanks! There's some code to handle this case but apparently it's not quite right. I'll take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-15 22:59</div>
            <div class="timeline-body"><p>Oh, I'm so dumb... The relevant code is under a <code>debug_assert!</code>, so it only runs in debug builds...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-15 23:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-15 23:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:27:43 UTC
    </footer>
</body>
</html>
