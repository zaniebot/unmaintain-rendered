<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't install private repo from lock file in docker (works in pip and poetry just fine and uv sync seems to create the uv.lock file just fine - astral-sh/uv #9852</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Can't install private repo from lock file in docker (works in pip and poetry just fine and uv sync seems to create the uv.lock file just fine</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9852">#9852</a>
        opened by <a href="https://github.com/adiberk">@adiberk</a>
        on 2024-12-12 21:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adiberk">@adiberk</a> on 2024-12-12 21:24</div>
            <div class="timeline-body"><p>We have a private repo that we use in our app
I have it formatted in pyproject.toml as such</p>
<pre><code>dependencies = [
.....
    &quot;{name}&quot;,
]
[tool.uv.sources]
{name} = { git = &quot;ssh://git@github.com/.../{package_name}.git&quot;, rev = &quot;2.3.4&quot; }
</code></pre>
<p>Here is how it is formatted in requirements.txt file
<code>{name}@git+ssh://git@github.com/.../{package_name}.git@2.3.4</code>
And here is working format in poetry pyproject</p>
<pre><code>[tool.poetry.dependencies]
python = &quot;3.11.4&quot;,
{name} = { git = &quot;ssh://git@github.com/.../{package.name}.git&quot;, rev = &quot;2.3.4&quot;, extras = [
...
] }
</code></pre>
<p>I am then installing the project from the lockfile using our typical git ssh configuration process in docker (works in pip and poetry) and am left with an error via uv</p>
<pre><code> Caused by: Failed to fetch wheel: {name}} @ git+ssh://git@github.com/.../{package_name}.git@277c69b6e88a8....
</code></pre>
<p>I do have an idea as to why but cant be sure - It seems like the &quot;rev&quot; number isn't showing up in this error (it is using some other hash?). This tells me it isn't using a specific version (which I am listing in the pyproject.toml). I am not positive but maybe this is a result of how we use and tag releases?</p>
<p>If I do a uv export --no-hashes
<code>{name} @ git+ssh://git@github.com/.../{package_name}.git@277c69b6....</code>
Which is missing the rev I provided and seems to be using some other hash</p>
<p>Either way, it seems to work find in pip and poetry and could use some help figuring out how to resolve this
(command being run in dockerfile <code>uv sync --frozen --no-install-project</code>)</p>
<p>Some info on my dockerfile</p>
<pre><code>OPY --from=ghcr.io/astral-sh/uv:0.5.8 /uv /bin/uv

WORKDIR /app

RUN uv venv --relocatable

ENV LIBRARY_PATH=/lib:/usr/lib
ENV PATH=&quot;/app/.venv/bin:$PATH&quot;
ENV UV_PYTHON_INSTALL_DIR=/opt/uv/python

COPY pyproject.toml uv.lock ./
# add github.com to known hosts
.... ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts
RUN echo &quot;Environment: ${ENV}&quot;
RUN --mount=type=secret..... \
    if [ &quot;$ENV&quot; = &quot;unittest&quot; ]; then \
    echo 'Installing UT' &amp;&amp; uv sync --extra ut --frozen --no-install-project; \
    elif [ &quot;$ENV&quot; = &quot;dev&quot; ]; then \
    echo 'Installing DEV' &amp;&amp; uv sync --extra dev --frozen --no-install-project; \
    else \
    echo 'Installing REG' &amp;&amp; uv sync --frozen --no-install-project; \
    fi
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Can't install private repo from lock file in docker (works in poetry just fine)" to "Can't install private repo from lock file in docker (works in pip and poetry just fine and uv sync works fine on my local machine)" by @adiberk on 2024-12-12 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Can't install private repo from lock file in docker (works in pip and poetry just fine and uv sync works fine on my local machine)" to "Can't install private repo from lock file in docker (works in pip and poetry just fine and uv sync seems to create the uv.lock file just fine" by @adiberk on 2024-12-12 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adiberk">@adiberk</a> on 2024-12-12 22:38</div>
            <div class="timeline-body"><p>I am a bit of an idiot and my mount was incorrect (for what I was doing locally with my docker image)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @adiberk on 2024-12-12 22:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:49 UTC
    </footer>
</body>
</html>
