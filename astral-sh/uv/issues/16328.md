```yaml
number: 16328
title: Building and installing packages from a GitHub mono repo with a uv workspace
type: issue
state: open
author: klet7944
labels:
  - enhancement
  - needs-design
assignees: []
created_at: 2025-10-16T09:34:30Z
updated_at: 2025-11-04T16:02:59Z
url: https://github.com/astral-sh/uv/issues/16328
synced_at: 2026-01-10T01:57:36Z
```

# Building and installing packages from a GitHub mono repo with a uv workspace

---

_Issue opened by @klet7944 on 2025-10-16 09:34_

### Question

I have a mono repo with three separate projects in a single workspace. Let's call it project_x with the following repo structure: 
```
project-x/
├── xclient/
│   ├── src/
│   └── pyproject.toml
├── xcore/
│   ├── src/ 
│   └── pyproject.toml
├── xkit/
│   ├── -src/
│   └── pyproject.toml
└── pyproject.toml
```
xcore has xclient as a dependency. xkit has both xclient and xcore as dependency. To summarize: 
```
xcore <-- xclient

xkit <-- xclient, xcore
```

The root has a pyproject.toml to setup the uv workspace. The pyproject.toml is as follows: 
```
[tool.uv.workspace]
members = [
    "xclient",
    "xcore",
    "xkit"
]
```


The xcore/pyproject.toml and xkit/pyproject.toml adds the dependencies as workspace dependency as such: 
```
# xkit/pyproject.toml
[tool.uv.sources]
xclient = { workspace = true }
xcore = { workspace = true }

# xcore/pyproject.toml
[tool.uv.sources]
xclient = { workspace = true }

``` 

The packages in project-x are independently released as GitHub releases (with tags) and these packages are used in other projects as individual dependencies by adding the GitHub repo with the subdirectory and tag. Sample requirements.txt file is as follows in a project called project-foo: 
```
xclient @ git+https://github.com/x/project-x.git@xclient_0.1.0#subdirectory=xclient
xcore @ git+https://github.com/x/project-x.git@xcore_0.1.0#subdirectory=xcore
xkit @ git+https://github.com/x/project-x.git@xadk_0.1.0#subdirectory=xkit
```

## Observation
- I am able to use pip to build and install these dependencies in project-foo successfully. 
- However it is not possible to use uv to install these due to the workspace setup in project-x, uv fails to build and install dependencies and gives a multiple marker error for xclient. I think after the initial install of xclient and during the consequent install of xcore there are two different sources for xclient so it fails. 
- `pip install -r requirements.txt` succeeds while `uv add` and `uv run pip install -r requirements.txt` fails with the above error. 


## Question and help
How do I setup the project-x so that I could use a single environment like the workspace during development and use direct build and install from GitHub repo in project-foo with uv. I want to be able to use `uv add` and `uv sync` in project-foo. Any help on this is much appreciated. Thanks

### Platform

Windows

### Version

uv 0.8.17 (10960bc13 2025-09-10)

---

_Label `question` added by @klet7944 on 2025-10-16 09:34_

---

_Comment by @konstin on 2025-10-17 08:18_

> However it is not possible to use uv to install these due to the workspace setup in project-x, uv fails to build and install dependencies and gives a multiple marker error for xclient. I think after the initial install of xclient and during the consequent install of xcore there are two different sources for xclient so it fails.

Can you share the commands you use, the error message and ideally the verbose logs (`-v`)?

---

_Comment by @klet7944 on 2025-10-17 16:34_

@konstin see the below commands and outputs.  
 
- uv pip install
```
(.venv) PS C:\project-foo> uv pip install -r .\requirements.txt
    Updated https://github.com/x/project-x.git (bd2b4)
    Updated https://github.com/x/project-x.git (4b735)
    Updated https://github.com/x/project-x.git (4b735)
  × Failed to resolve dependencies for `xcore` (v0.1.0)
  ╰─▶ Requirements contain conflicting URLs for package `xclient`:
      - git+https://github.com/x/project-x.git@xkit_0.1.0#subdirectory=xclient
      - git+https://github.com/x/project-x.git@xclient_0.1.0#subdirectory=xclient
```

- uv add 
```
(.venv) PS C:\project-foo> uv add git+https://github.com/x/project-x.git@xclient_0.1.0#subdirectory=xclient
    Updated https://github.com/x/project-x.git (bd2b4)
Resolved 22 packages in 2ms
Audited 21 packages in 2ms
(.venv) PS C:\project-foo> uv add git+https://github.com/x/project-x.git@xcore_0.1.0#subdirectory=xcore
    Updated https://github.com/x/project-x.git (4b735)
  × Failed to resolve dependencies for `xcore` (v0.1.0)
  ╰─▶ Requirements contain conflicting URLs for package `xclient` in all marker environments:
      - git+https://github.com/x/project-x.git@xclient_0.1.0#subdirectory=xclient
      - git+https://github.com/x/project-x.git@xcore_0.1.0#subdirectory=xclient
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip
        locking and syncing.
```

These are not the original project and package names. It might be difficult for me to mask all names in the verbose output at the moment. If the verbose output is required, I might have to setup a s sample repo and share it for you to reproduce. 

---

_Comment by @konstin on 2025-10-19 09:08_

I think I see the problem now, it's the combination of two things: uv considers `[tool.uv.sources]` for git dependencies, and it requires a single URL (with a single git hash) per file. When you add `git+https://github.com/x/project-x.git@xcore_0.1.0#subdirectory=xcore`, uv looks at the sources and infers that we need `git+https://github.com/x/project-x.git@xcore_0.1.0#subdirectory=xclient` to get an xclient that matches xcore: We want both from the same Git tag so they match. But we previously saw `git+https://github.com/x/project-x.git@xclient_0.1.0#subdirectory=xclient` so there's now a conflict.

uv's assumption is that Git dependencies are for pulling in a non-release, and that if a Git dep pulls in other Git deps, their between-releases hash needs to match.

---

_Comment by @klet7944 on 2025-10-21 13:49_

@konstin I see this problem only when a workspace is defined. I think uv tries to build the package using the workspace dependencies and reaches a conflicting situation as you mentioned. 

pip install does not run into this conflict, obviously the uv specific configs does not apply to pip and dependencies already installed in the environment it is resolved first to build the packages. I think this should be the behaviour of uv without the workspace. 

Shouldn't this be case even with the workspace? I know my ask has some grey areas. But if I have already have a package installed shouldn't uv the resolve it first from the environment during building the dependency? Or an option/config to deactivate the workspace would be also perfect. I am not sure whether this violates the objective of a workspace from uv's perspective. 

---

_Comment by @konstin on 2025-10-21 14:10_

> Shouldn't this be case even with the workspace? I know my ask has some grey areas. But if I have already have a package installed shouldn't uv the resolve it first from the environment during building the dependency? Or an option/config to deactivate the workspace would be also perfect. I am not sure whether this violates the objective of a workspace from uv's perspective.

We have a `--no-sources` option, it makes sense to extend this to apply to specific dependencies only. That way you could have uv behave more similar to pip here.

---

_Label `question` removed by @konstin on 2025-10-21 14:10_

---

_Label `enhancement` added by @konstin on 2025-10-21 14:10_

---

_Label `needs-design` added by @konstin on 2025-10-21 14:10_

---

_Comment by @klet7944 on 2025-10-31 17:16_

@konstin I would like to help and contribute to this. Any pointers on how do I get involved in this? 

---

_Comment by @konstin on 2025-11-04 16:02_

I'm afraid this isn't just a code change, but about the sematics of Git depedencies. I'm not sure if Git tags a suited for distributing package in the way you describe, usually people use a registry for that.

---
