<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows: &quot;uv venv&quot; gives &quot;exit 2&quot; with tox-uv - astral-sh/uv #1636</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Windows: &quot;uv venv&quot; gives &quot;exit 2&quot; with tox-uv</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1636">#1636</a>
        opened by <a href="https://github.com/hugovk">@hugovk</a>
        on 2024-02-18 09:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hugovk">@hugovk</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Windows
uv 0.1.4
tox-uv 1.2.0</p>
<p>Using tox-uv, and running <code>python -m tox -e py -vvv</code> on Windows with CPython 3.8-3.13 and PyPy 3.10 gives an error:</p>
<pre><code>ROOT: 156 D setup logging to NOTSET on pid 8056 [tox\report.py:221]
py: 375 W venv&gt; C:\hostedtoolcache\windows\Python\3.8.10\x64\uv venv -p 3.8 D:\a\termcolor\termcolor\.tox\py\.venv [tox\tox_env\api.py:427]
py: 375 C exit 2 (0.00 seconds) D:\a\termcolor\termcolor&gt; C:\hostedtoolcache\windows\Python\3.8.10\x64\uv venv -p 3.8 D:\a\termcolor\termcolor\.tox\py\.venv [tox\execute\api.py:280]
  py: FAIL code 2 (0.00 seconds)
  evaluation failed :( (0.22 seconds)
Error: Process completed with exit code 1.
</code></pre>
<p>It passes on Ubuntu and macOS. I don't have a Windows machine, this is on CI:</p>
<p>https://github.com/hugovk/termcolor/actions/runs/7948092300/job/21697697387</p>
<p>To get the code locally:</p>
<pre><code class="language-sh">git clone https://github.com/hugovk/termcolor/
git checkout fd9f3f426449541a111560585c4230e31d2e0adf
</code></pre>
<p>Possibly a tox-uv bug?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @MichaReiser on 2024-02-18 11:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">virtualenv</span> added by @zanieb on 2024-02-18 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2024-02-18 23:06</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/issues/1310</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-02-18 23:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2024-03-04 19:26</div>
            <div class="timeline-body"><p>Reproducible on Windows with uv 0.1.14 for PyPy 3.9 and 3.10, and CPython 3.13 (via tox-uv 1.4.0):</p>
<pre><code class="language-pytb">Run python -m tox -e py -rvvv
.pkg: 4423 W remove tox env folder D:\a\termcolor\termcolor\.tox\.pkg [tox\tox_env\api.py:325]
py: 4470 W venv&gt; C:\hostedtoolcache\windows\PyPy\3.10.13\x86\Scripts\uv.exe venv -p 3.10 -v D:\a\termcolor\termcolor\.tox\py\.venv [tox\tox_env\api.py:427]
 uv_interpreter::python_query::find_requested_python request=3.10
      0.002894s   0ms DEBUG uv_interpreter::python_query Starting interpreter discovery for Python @ `3.10`
      0.003287s   0ms DEBUG uv_interpreter::interpreter Probing interpreter info for: C:\hostedtoolcache\windows\PyPy\3.10.13\x86\python3.10.exe
      0.132933s 130ms DEBUG uv_interpreter::interpreter Found Python 3.10.13 for: C:\hostedtoolcache\windows\PyPy\3.10.13\x86\python3.10.exe
Using Python 3.10.13 interpreter at: C:\hostedtoolcache\windows\PyPy\3.10.13\x86\python3.10.exe
Creating virtualenv at: D:\a\termcolor\termcolor\.tox\py\.venv
uv::venv::creation

  × Failed to create virtualenv
  ├─▶ failed to copy file from
  │   C:\hostedtoolcache\windows\PyPy\3.10.13\x86\Lib\venv\scripts\nt\python.exe
  │   to \\?\D:\a\termcolor\termcolor\.tox\py\.venv\Scripts\python.exe
  ╰─▶ The system cannot find the file specified. (os error 2)
py: 5080 C exit 1 (0.61 seconds) D:\a\termcolor\termcolor&gt; C:\hostedtoolcache\windows\PyPy\3.10.13\x86\Scripts\uv.exe venv -p 3.10 -v D:\a\termcolor\termcolor\.tox\py\.venv pid=6192 [tox\execute\api.py:280]
  py: FAIL code 1 (0.67 seconds)
  evaluation failed :( (4.67 seconds)

Error: Process completed with exit code 1.
</code></pre>
<p>https://github.com/hugovk/termcolor/actions/runs/8145079624</p>
<p>CPython 3.8-3.12 pass.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 19:32</div>
            <div class="timeline-body"><p>Thanks, let me see if I can repro with a minimal Python 3.13 run.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 19:43</div>
            <div class="timeline-body"><p>Reproduced here, thanks! https://github.com/astral-sh/uv/pull/2171</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-03-04 19:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 20:01</div>
            <div class="timeline-body"><p>First trying to figure out if we're attempting to copy from the wrong directory, or if we're copying the wrong filename.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 20:21</div>
            <div class="timeline-body"><p>@gaborbernat - Do you know if the development builds exclude the <code>venv</code> shims?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 21:02</div>
            <div class="timeline-body"><p>I figured this out, I think we're supposed to fallback to <code>venvlauncher.exe</code> if <code>python.exe</code> doesn't exist:</p>
<p>https://github.com/python/cpython/blob/d457345bbc6414db0443819290b04a9a4333313d/Lib/venv/<strong>init</strong>.py#L270C66-L270C71</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 21:36</div>
            <div class="timeline-body"><p>I asked a question about it on discuss: https://discuss.python.org/t/when-should-venv-scripts-nt-python-exe-be-present/47620</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-04 21:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 22:02</div>
            <div class="timeline-body"><p>FYI @gaborbernat -- The executable names changed in Python 3.13: https://discuss.python.org/t/when-should-venv-scripts-nt-python-exe-be-present/47620/2. I suspect virtualenv won't <em>fail</em> because it's robust to the shims not existing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2024-03-05 06:31</div>
            <div class="timeline-body"><p>Thanks for the CPython 3.13 fix!</p>
<p>This issue is also about PyPy (3.9 and 3.10), does uv need an extra fix there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-05 07:33</div>
            <div class="timeline-body"><blockquote>
<p>This issue is also about PyPy (3.9 and 3.10), does uv need an extra fix there?</p>
</blockquote>
<p>Probably — PyPy isn't officially supported right now, though we'd welcome contributions to help us get there! See #2096</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:23:44 UTC
    </footer>
</body>
</html>
