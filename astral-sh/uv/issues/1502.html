<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` does not add `extra-index-url` to the generated output file - astral-sh/uv #1502</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip compile</code> does not add <code>extra-index-url</code> to the generated output file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1502">#1502</a>
        opened by <a href="https://github.com/hofrob">@hofrob</a>
        on 2024-02-16 15:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hofrob">@hofrob</a></div>
            <div class="timeline-body"><p>I think #1143 was only about parsing it from an existing input file. Running <code>pip-compile</code> will add this flag (and probably others) to the generated output.</p>
<p>While testing <code>uv</code>, I haven&#x27;t found out how to do this or if it&#x27;s just missing.</p>
<code>uv</code>
<pre><code>uv pip compile \
    pyproject.toml \
    --output-file requirements.txt \
    --extra-index-url=https://private.example.com/pypi
</code></pre>
<p>Generates:</p>
<pre><code># This file was autogenerated by uv v0.1.2 via the following command:
#    uv pip compile pyproject.toml --output-file requirements.txt --extra-index-url=https://private.example.com/pypi
</code></pre>
<code>pip-compile</code>
<pre><code>pip-compile \
    --output-file requirements.txt \
    --extra-index-url=https://private.example.com/pypi
</code></pre>
<p>Generates:</p>
<pre><code>#
# This file is autogenerated by pip-compile with Python 3.12
# by the following command:
#
#    pip-compile --extra-index-url=https://private.example.com/pypi
#
--extra-index-url https://private.example.com/pypi
</code></pre>
<p>Adding <code>--extra-index-url ...</code> to the requirements file would allow one to run <code>uv pip sync requirements.txt</code> without having to add the cli argument.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 15:36</div>
            <div class="timeline-body"><p>Can you try passing <code>--emit-index-url</code> on the command-line?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hofrob">@hofrob</a> on 2024-02-16 15:39</div>
            <div class="timeline-body"><p>Yes, that works. It will add the default <code>index-url</code> too which makes sense. Thanks!</p>
<p>I guess this could be the default behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 15:40</div>
            <div class="timeline-body"><p>I thought it wasn&#x27;t the default in <code>pip-compile</code>, so I left it as not-the-default. I&#x27;d need to verify...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 15:41</div>
            <div class="timeline-body"><p>(Also, for whatever reason, I hid this in the CLI.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thomasaarholt">@thomasaarholt</a> on 2024-02-17 16:40</div>
            <div class="timeline-body"><p>There are two more related issues here</p>
unsupported environment variables
<p><code>uv</code> doesn&#x27;t support environment variables when the extra index url is supplied in <code>requirements.in</code> (it does work when passed via the <code>--extra-index-url</code> cli argument).
With the following <code>requirements.in</code> file:</p>
<pre><code># requirements.in
--extra-index-url https://${GEMFURY_READ_TOKEN}@repo.fury.io/oda/

numpy
</code></pre>
<pre><code>uv pip compile \
    --emit-index-url \
    requirements.in
</code></pre>
<p>generates</p>
<pre><code># This file was autogenerated by uv v0.1.3 via the following command:
#    uv pip compile --emit-index-url requirements.in
--index-url https://pypi.org/simple
--extra-index-url https://$%7BGEMFURY_READ_TOKEN%7D@repo.fury.io/oda/

numpy==1.26.4
</code></pre>
<code>uv</code> doesn&#x27;t find private packages?
<p><code>uv</code> doesn&#x27;t find our company package called <code>testy-foobar</code>, while <code>pip-compile</code> does.
With the following <code>requirements.in</code> file:</p>
<pre><code># requirements.in

testy-foobar
</code></pre>
<code>uv</code>
<pre><code>uv pip compile \
    --extra-index-url=https://${GEMFURY_READ_TOKEN}@repo.fury.io/oda/ \
    --emit-index-url \
    requirements.in
</code></pre>
<p>generates</p>
<pre><code>  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because testy-foobar was not found in the package registry and you require testy-foobar, we can conclude that the requirements are unsatisfiable.
</code></pre>
<code>pip-compile</code>
<pre><code>pip-compile \
    --extra-index-url=https://${GEMFURY_READ_TOKEN}@repo.fury.io/oda/ \
    requirements.in
</code></pre>
<p>generates</p>
<pre><code>#
# This file is autogenerated by pip-compile with Python 3.11
# by the following command:
#
#    pip-compile --extra-index-url=&#x27;https://****@repo.fury.io/oda/&#x27; requirements.in
#
--extra-index-url https://&lt;STRIPPED&gt;@repo.fury.io/oda/

asn1crypto==1.5.1
    # via snowflake-connector-python
cachetools==5.3.2
    # via google-auth
# many more packages
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nsphung">@nsphung</a> on 2024-02-19 13:22</div>
            <div class="timeline-body"><p>Furthermore, it doesn&#x27;t use/manage <code>PIP_EXTRA_INDEX_URL</code> environment variable configuration as <code>pip</code> does too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-19 17:20</div>
            <div class="timeline-body"><p>You can use <code>UV_EXTRA_INDEX_URL</code> instead. We are hesitant to read pip&#x27;s configuration directly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nsphung">@nsphung</a> on 2024-02-20 10:14</div>
            <div class="timeline-body"><p>Hello @zanieb</p>
<p>Thanks for your answer.</p>
<p>I&#x27;ve just tried adding <code>UV_EXTRA_INDEX_URL</code>. I&#x27;m using uv <code>0.1.5</code> and I have the following error still:</p>
<pre><code>  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because there is no version of mylib==2024.01.01 and you require mylib==2024.01.01, we can conclude that the requirements are
      unsatisfiable.
</code></pre>
<p><code>mylib==2024.01.01 </code> is a lib in my private pypi repository. It seems it doesn&#x27;t use <code>UV_EXTRA_INDEX_URL</code> as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-02-21 11:34</div>
            <div class="timeline-body"><blockquote>
<p>Hello @zanieb</p>
<p>Thanks for your answer.</p>
<p>I&#x27;ve just tried adding <code>UV_EXTRA_INDEX_URL</code>. I&#x27;m using uv <code>0.1.5</code> and I have the following error still:</p>
<pre><code>  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because there is no version of mylib==2024.01.01 and you require mylib==2024.01.01, we can conclude that the requirements are
      unsatisfiable.
</code></pre>
<p><code>mylib==2024.01.01 </code> is a lib in my private pypi repository. It seems it doesn&#x27;t use <code>UV_EXTRA_INDEX_URL</code> as well.</p>
</blockquote>
<p>The same here :(
Tried both with the environment variable and by passing the <code>--extra-index-url</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 00:39</div>
            <div class="timeline-body"><p>@nsphung -- Is <code>mylib</code> shadowed on PyPI? As in, is there a package on PyPI with the same name?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nsphung">@nsphung</a> on 2024-02-22 10:46</div>
            <div class="timeline-body"><p>@charliermarsh -- <code>mylib</code> is not on PyPI. It&#x27;s a private lib/dependency only available from our private pypi repo. The resolution is working well with <code>pip-compile</code> from <code>pip-tools</code> with <code>PIP_EXTRA_INDEX_URL</code> environment variable setup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hofrob">@hofrob</a> on 2024-02-22 10:48</div>
            <div class="timeline-body"><p>@nsphung The question is, is there another library on PyPI with the same name? Because this issue is separately tracked in #1377</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nsphung">@nsphung</a> on 2024-02-22 10:51</div>
            <div class="timeline-body"><p>@hofrob The answer is No. <code>mylib</code> is not using the same name as another library on PyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-28 04:30</div>
            <div class="timeline-body"><p>@thomasaarholt -- Unrelated to this issue, but heads up: if you&#x27;re using Gemfury, you need to use <code>pypi.fury.io</code> instead of <code>repo.fury.io</code> in your index URL. Gemfury relies on the User Agent to do that mapping, and we (of course) don&#x27;t send <code>pip</code> in our User Agent:</p>
<p><img src="https://github.com/astral-sh/uv/assets/1309177/258682e2-9366-49bc-9e0c-e952f401f4e9" alt="Screenshot 2024-02-27 at 9 18 01â€¯PM"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-28 04:39</div>
            <div class="timeline-body"><p>@thomasaarholt - I filed your other issue here, thanks! <a href="https://github.com/astral-sh/uv/issues/2035">astral-sh/uv#2035</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-28 04:40</div>
            <div class="timeline-body"><p>For clarity, this issue is now focused on whether we want to change our defaults around emitting index URLs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/framillien">@framillien</a> on 2024-02-28 09:30</div>
            <div class="timeline-body"><blockquote>
<p>For clarity, this issue is now focused on whether we want to change our defaults around emitting index URLs.</p>
</blockquote>
<p>On this, maybe a source of confusion come from what is a pip index we should write.</p>
<p>By defaut pip-compile write all specified indexes, but not the default one.</p>
<p>When we activate the option, all pip indexes are written including the default one. And then if we activate this option by default (We should IMHO) we may want to create a new issue to only write specified indexes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-03-04 10:24</div>
            <div class="timeline-body"><p>@charliermarsh  hello! is there any update / plan for fixing this one ? <a href="https://github.com/astral-sh/uv/issues/1502">astral-sh/uv#1502</a>#issuecomment-1959186939</p>
<p>it&#x27;s the main blocker for me ( and my team ) to replace our current slow workflow with a huge speed up from uv ðŸ˜¢</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thomasaarholt">@thomasaarholt</a> on 2024-03-04 13:12</div>
            <div class="timeline-body"><p>@iflare3g if you call <code>uv pip compile --extra-index-url=&lt;your-url&gt; --emit-index-url requirements.in</code>, then <code>requirements.txt</code> will contain it. This also works if <code>requirements.in</code> contains the extra-index-url in file itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 13:55</div>
            <div class="timeline-body"><p>@iflare3g - are you referring to the index URL emission issue, or that a package isnâ€™t being found in an alternate registry?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-03-04 13:57</div>
            <div class="timeline-body"><blockquote>
<p>@iflare3g - are you referring to the index URL emission issue, or that a package isnâ€™t being found in an alternate registry?</p>
</blockquote>
<p>Second one, package isn&#x27;t being found in private registry.
Tried via latest version of uv and still getting package not found ðŸ˜”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thomasaarholt">@thomasaarholt</a> on 2024-03-04 14:01</div>
            <div class="timeline-body"><p>i am successfully downloading and installing private packages using uv. Charlie&#x27;s tip on the updated gemfury address fixed it for me.</p>
<p>What is your full command (hiding any sensitive token), @iflare3g ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-03-04 14:32</div>
            <div class="timeline-body"><blockquote>
<p>i am successfully downloading and installjng private packages using uv. Charlie&#x27;s tip on the updated gemfury address fixed it for me.</p>
<p>What is your full command (hiding any sensitive token), @iflare3g ?</p>
</blockquote>
<p>With <code>UV_EXTRA_INDEX_URL=https://**:****@****.pkgs.visualstudio.com/_packaging/***/pypi/simple/ges/pypi/simple/</code> set
the command is just:</p>
<pre><code>uv pip compile -o src/requirements/build.txt src/requirements/build.in --emit-index-url
</code></pre>
<p>without the env var, the command is:</p>
<pre><code>uv pip compile -o src/requirements/build.txt src/requirements/build.in --emit-index-url --extra-index-url=https://**:****@****.pkgs.visualstudio.com/_packaging/***/pypi/simple/ges/pypi/simple/
</code></pre>
<p>and the result is for both:</p>
<pre><code> Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because xxx&gt;=5.0 was not found in the package registry and you require xxx&gt;=5.0, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>We use Microsoft&#x27;s DevOps Artifacts for mirroring PyPI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-04 14:36</div>
            <div class="timeline-body"><p>The only thing that knowingly doesn&#x27;t work is if you have a package that exists both in your private registry <em>and</em> on PyPI (i.e., packages with the same name), and you expect to use a version of that package from PyPI instead of your private registry. Is that the case here? Does <code>xxx</code> exist on your private registry?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-03-04 14:37</div>
            <div class="timeline-body"><blockquote>
<p>The only thing that knowingly doesn&#x27;t work is if you have a package that exists both in your private registry <em>and</em> on PyPI (i.e., packages with the same name), and you expect to use a version of that package from PyPI instead of your private registry. Is that the case here? Does <code>xxx</code> exist on your private registry?</p>
</blockquote>
<p>yup, <strong>only</strong> into private registry
it doesn&#x27;t exist at all on pypi , so no risk of naming conflicts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nsphung">@nsphung</a> on 2024-03-08 09:43</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>The only thing that knowingly doesn&#x27;t work is if you have a package that exists both in your private registry <em>and</em> on PyPI (i.e., packages with the same name), and you expect to use a version of that package from PyPI instead of your private registry. Is that the case here? Does <code>xxx</code> exist on your private registry?</p>
</blockquote>
<p>yup, <strong>only</strong> into private registry it doesn&#x27;t exist at all on pypi , so no risk of naming conflicts</p>
</blockquote>
<p>I&#x27;m waiting for this to be fixed as well. Else the resolution with <em>index-url</em> + <em>extra-index-url</em> is not working with <code>uv compile</code> vs <code>pip-compile</code> one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-03-08 13:29</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<blockquote>
<p>The only thing that knowingly doesn&#x27;t work is if you have a package that exists both in your private registry <em>and</em> on PyPI (i.e., packages with the same name), and you expect to use a version of that package from PyPI instead of your private registry. Is that the case here? Does <code>xxx</code> exist on your private registry?</p>
</blockquote>
<p>yup, <strong>only</strong> into private registry it doesn&#x27;t exist at all on pypi , so no risk of naming conflicts</p>
</blockquote>
<p>I&#x27;m waiting for this to be fixed as well. Else the resolution with <em>index-url</em> + <em>extra-index-url</em> is not working with <code>uv compile</code> vs <code>pip-compile</code> one.</p>
</blockquote>
<p>me 2, it&#x27;s the only thing that blocks me and my team to fully switch to uv and we&#x27;d like to do as soon as this will be fixed and released</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thomasaarholt">@thomasaarholt</a> on 2024-03-08 13:51</div>
            <div class="timeline-body"><p>@iflare3g, I am successfully using <code>uv</code> to install a private package called <code>fabrica-polars</code>, which only exists in a private registry. Using the following style commands:</p>
<pre><code>uv pip install --extra-index-url https://${GEMFURY_READ_TOKEN}@pypi.fury.io/oda/ fabrica-polars
</code></pre>
<p>Or with a requirements.in, I would call <code>uv pip compile --emit-index-url</code></p>
<pre><code># my requirements.in
--extra-index-url https://${GEMFURY_READ_TOKEN}@pypi.fury.io/oda/
fabrica-polars
</code></pre>
<p>Ensure that you have updated uv in the venv you are using.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-03-08 14:00</div>
            <div class="timeline-body"><blockquote>
<p>@iflare3g, I am successfully using <code>uv</code> to install a private package called <code>fabrica-polars</code>, which only exists in a private registry. Using the following style commands:</p>
<pre><code>uv pip install --extra-index-url https://${GEMFURY_READ_TOKEN}@pypi.fury.io/oda/ fabrica-polars
</code></pre>
<p>Or with a requirements.in, I would call <code>uv pip compile --emit-index-url</code></p>
<pre><code># my requirements.in
--extra-index-url https://${GEMFURY_READ_TOKEN}@pypi.fury.io/oda/
fabrica-polars
</code></pre>
<p>Ensure that you have updated uv in the venv you are using.</p>
</blockquote>
<p>Already tried with the latest one, otherwise I&#x27;d would have commented here the resolution for me.
It seems for gemfury is ok, but with Microsoft&#x27;s Azure Artifacts it doesn&#x27;t work while pip-tools or just pip with extra index url do</p>
<p>If more details are needed, I can share the verbose compile command result</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thomasaarholt">@thomasaarholt</a> on 2024-03-08 14:09</div>
            <div class="timeline-body"><p>I think it would help if you shared the exact command you are running except for any secrets, and if you stick the verbose compilation log in a gist and share that too, I&#x27;m sure that would be helpful.</p>
<p>Edit: Sorry, I see you shared it above!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-08 17:56</div>
            <div class="timeline-body"><p>@iflare3g - Do you mind following up here? <a href="https://github.com/astral-sh/uv/issues/2138">astral-sh/uv#2138</a> I think these issues are unrelated to the <code>--extra-index-url</code> emit behavior, and it&#x27;s making the thread a little hard to follow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iflare3g">@iflare3g</a> on 2024-03-08 18:01</div>
            <div class="timeline-body"><blockquote>
<p>@iflare3g - Do you mind following up here? <a href="https://github.com/astral-sh/uv/issues/2138">astral-sh/uv#2138</a> I think these issues are unrelated to the <code>--extra-index-url</code> emit behavior, and it&#x27;s making the thread a little hard to follow.</p>
</blockquote>
<p>Sure, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-27 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-27 14:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:29:31 UTC
    </footer>
</body>
</html>
