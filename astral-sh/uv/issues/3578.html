<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv venv` does not create a lib64 directory - astral-sh/uv #3578</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv venv` does not create a lib64 directory</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3578">#3578</a>
        opened by <a href="https://github.com/AtomBaf">@AtomBaf</a>
        on 2024-05-14 14:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AtomBaf">@AtomBaf</a> on 2024-05-14 14:08</div>
            <div class="timeline-body"><h1>Context</h1>
<p>Platform: linux rocky 9
uv version: <code>0.1.42</code></p>
<h1>Error when importing torch</h1>
<pre><code class="language-bash">uv venv foobar
source foobar/bin/activate
uv pip install torch
python -c &quot;import torch&quot;
&gt; ImportError: libcudnn.so.8: cannot open shared object file: No such file or directory
</code></pre>
<h1>Investigation</h1>
<p>After investigation I discovered that:</p>
<ul>
<li><code>uv venv foobar</code> does not create a <code>lib64</code> directory under the venv directory</li>
<li>installing pytorch will create a lib64 directory with some libraries (<code>nvidia*</code>)  inside it</li>
<li>in fact there will be some libraries in <code>lib</code> and some other in <code>lib64</code></li>
<li>this <code>lib64</code> is part of the <code>sys.path</code> , however, it seems not used during the import of torch thus leading to the error above</li>
<li>with a similar <code>python -m venv foobar</code> , I noticed that the <code>lib64</code> directory is created as a symlink to the <code>lib</code> directory</li>
<li>indeed, after <code>uv venv</code>, when manually symlinking, everything is fine</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 14:15</div>
            <div class="timeline-body"><p>Does <code>virtualenv</code> do this? I suspect the distro is patching the <code>venv</code> module. I'm not sure how we could know the create the symlink here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-05-14 16:09</div>
            <div class="timeline-body"><p>This is https://github.com/python/cpython/blob/b228655c227b2ca298a8ffac44d14ce3d22f6faa/Lib/venv/<strong>init</strong>.py#L135-L140 (basically, it's always created on 64-bit non-OS X POSIX)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 16:40</div>
            <div class="timeline-body"><p>Lol thank you. Will fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-05-14 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-05-14 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-05-14 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3584.html">astral-sh/uv#3584</a> on 2024-05-14 17:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-14 18:03</div>
            <div class="timeline-body"><p><code>virtualenv .venv --no-seed</code> (or with seed) doesn't create <code>lib64</code> for me (ubuntu 24.04 x86_64), <code>python -m venv</code> does:</p>
<pre><code>.venv
├── bin
│   ├── activate
│   ├── activate.csh
│   ├── activate.fish
│   ├── activate.nu
│   ├── activate.ps1
│   ├── activate_this.py
│   ├── python -&gt; /home/konsti/.pyenv/versions/3.12.3/bin/python3.12
│   ├── python3 -&gt; python
│   └── python3.12 -&gt; python
├── lib
│   └── python3.12
│       └── site-packages
│           ├── _virtualenv.pth
│           └── _virtualenv.py
└── pyvenv.cfg

5 directories, 12 files
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-14 18:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:58 UTC
    </footer>
</body>
</html>
