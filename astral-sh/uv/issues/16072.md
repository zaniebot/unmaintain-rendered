```yaml
number: 16072
title: Multiple OpenMP versions cause segfault
type: issue
state: open
author: anstadnik
labels:
  - question
assignees: []
created_at: 2025-09-30T10:46:50Z
updated_at: 2026-01-03T20:37:27Z
url: https://github.com/astral-sh/uv/issues/16072
synced_at: 2026-01-10T01:57:35Z
```

# Multiple OpenMP versions cause segfault

---

_Issue opened by @anstadnik on 2025-09-30 10:46_

### Question

When I install `pycolmap` and `torch` using uv on mac os, and run:
```python
import pycolmap
from torch import nn
```
I get a segfault, which is caused by multiple openmp versions running simultaneously.
It can be suppressed (for example, sklearn does it [link](https://github.com/scikit-learn/scikit-learn/blob/e891db8003c2e7b14f7f4e314958e31fbdc6ccc5/sklearn/__init__.py#L48-L56)), but that only suppresses the error. AFAIK, OpenMP uses some weird global shared state, and doesn't support multiple versions running at the same time.
Conda solves this issue by forcing all wheels have the same version [link](https://conda-forge.org/docs/maintainer/knowledge_base/#openmp).
Which would be the correct approach to solving this issue? I can rewrite dylibs to point to a single (homebrew) openMP, but that sounds like a terrible solution. I can suppress the error, and hope nothing breaks, and that there won't be concurrent runs of openmp. I can compile libs myself.
All of those solutions sound wrong, I hope that you can give me a more professional view on the problem as you have a lot more knowledge in those types of issues.

### Platform

Darwin 25.1.0 arm64

### Version

uv 0.8.22 (Homebrew 2025-09-23)

---

_Label `question` added by @anstadnik on 2025-09-30 10:46_

---

_Comment by @konstin on 2025-09-30 10:51_

Unfortunately, I don't think there's a good solution for this atm, as Python packaging currently can't inspect compiled into wheels such as OpenMP.

---

_Comment by @geofft on 2025-09-30 13:43_

Some background on this over at the excellent pypackaging-native site:
* https://pypackaging-native.github.io/key-issues/native-dependencies/blas_openmp/
* https://pypackaging-native.github.io/key-issues/abi/

I think at this point there's community consensus that this is a real problem but not yet consensus on how to solve it. It's not something that can be _solved_ in uv itself, in that even if it did inspect the wheels, the most uv could do you "Sorry, this combination isn't going to work, you need to compile something from source." You need actual builds of the two wheels that use the same OpenMP library. The conda ecosystem is in a better position to be able to make that happen because they do the builds, but wheels on PyPI are built by each individual project.

So one option is to ask the colmap project if they could build differently in a way that is compatible with PyTorch (or vice versa), but maybe they're doing it this way for a reason. (Or maybe they're willing to release multiple wheels, one with a built-in OpenMP and one that expects to be imported in an environment where torch is already imported, or something.)

---

_Referenced in [colmap/colmap#3477](../../colmap/colmap/issues/3477.md) on 2025-10-02 12:18_

---
