```yaml
number: 9748
title: Cannot export to requirements.txt with conflicting extras even if unused.
type: issue
state: closed
author: lengau
labels:
  - enhancement
  - help wanted
assignees: []
created_at: 2024-12-09T19:41:29Z
updated_at: 2024-12-09T22:21:24Z
url: https://github.com/astral-sh/uv/issues/9748
synced_at: 2026-01-12T15:59:58Z
```

# Cannot export to requirements.txt with conflicting extras even if unused.

---

_@lengau_

When exporting to a requirements.txt file, the export fails if conflicting extras exist in pyproject.toml, even if they aren't used.

An example `pyproject.toml`:

```toml
[project]
name = "uv-example"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.11"
dependencies = ["distro"]

[project.optional-dependencies]
a = [
    "numpy<1.20",
]
b = [
    "numpy>1.20",
]

[tool.uv]
conflicts = [
    [
        { extra = "a" },
        { extra = "b" },
    ]
]
```

## Expected behaviour:

```
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes
Using CPython 3.11.10
Resolved 3 packages in 0.45ms
# This file was autogenerated by uv via the following command:
#    uv export --no-hashes
distro==1.9.0
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a
Using CPython 3.11.10
Resolved 3 packages in 417ms
# This file was autogenerated by uv via the following command:
#    uv export --no-hashes --extra a
distro==1.9.0
numpy==1.19.5
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra b
Using CPython 3.11.10
Resolved 3 packages in 388ms
# This file was autogenerated by uv via the following command:
#    uv export --no-hashes --extra b
distro==1.9.0
numpy==2.2.0
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a --extra b
Using CPython 3.11.10
Resolved 4 packages in 362ms
error: Extras `a` and `b` are incompatible with the declared conflicts: {`uv-example[a]`, `uv-example[b]`}
```

## Actual behaviour:

```
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes
Using CPython 3.11.10
Resolved 4 packages in 0.50ms
error: Cannot represent `uv.lock` with conflicting extras or groups as `requirements.txt`
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a
Using CPython 3.11.10
Resolved 4 packages in 0.48ms
error: Cannot represent `uv.lock` with conflicting extras or groups as `requirements.txt`
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra b
Using CPython 3.11.10
Resolved 4 packages in 0.48ms
error: Cannot represent `uv.lock` with conflicting extras or groups as `requirements.txt`
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a --extra b
Using CPython 3.11.10
Resolved 4 packages in 0.50ms
error: Extras `a` and `b` are incompatible with the declared conflicts: {`uv-example[a]`, `uv-example[b]`}
```

Only the last one (where both extras are declared) appears correct to me. In the other cases, because only (0,1) of the incompatible extras is being used, the export should succeed.

---

_Comment by @charliermarsh on 2024-12-09 19:46_

Ah yeah. We can loosen this.

---

_Label `enhancement` added by @charliermarsh on 2024-12-09 19:46_

---

_Label `help wanted` added by @charliermarsh on 2024-12-09 19:46_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-12-09 21:26_

---

_Comment by @charliermarsh on 2024-12-09 22:21_

Closed by https://github.com/astral-sh/uv/pull/9751.

---

_Closed by @charliermarsh on 2024-12-09 22:21_

---
