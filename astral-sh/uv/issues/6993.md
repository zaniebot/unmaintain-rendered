```yaml
number: 6993
title: Undocumented change to workspaces?
type: issue
state: closed
author: brynbellomy
labels:
  - question
  - needs-mre
assignees: []
created_at: 2024-09-04T02:00:24Z
updated_at: 2024-10-21T21:41:14Z
url: https://github.com/astral-sh/uv/issues/6993
synced_at: 2026-01-10T01:57:15Z
```

# Undocumented change to workspaces?

---

_Issue opened by @brynbellomy on 2024-09-04 02:00_

I followed the workspaces documentation with versions 0.4.3 and 0.4.4, and it seems that importing modules from the same workspace is broken (perhaps only for certain directory structures?) in recent versions, whereas 0.3.5 worked exactly as expected.

```
- rootdir/
    - pyproject.toml (has tool.uv.workspace.members which contains 'common' and 'thing')
    - libs/
        - common/
            - pyproject.toml
            - src/
                - common/
                    - __init__.py etc
    - services/
        - thing/
            - pyproject.toml (has tool.uv.sources with common = {workspace = true})
            - some_script.py
```

`some_script.py`:
```python
import foo from common
```

command: `uv run --refresh --package=thing services/thing/some_script.py`
- v0.4.x: Module common not found
- v0.3.5: works

I've been clearing the cache at every step of the investigation, deleting `uv.lock`, re-running `uv sync`, and also using the `--refresh` flag when calling `uv run`.

One last interesting tidbit.  When I switch from 0.3.5 back up to 0.4.4, clean the cache, delete the lockfile, and then run `uv sync --package=thing`, it deletes the `common` dependency.  So for some reason, it's not even recognizing it as a dependency despite it being in the `dependencies` array, and also having a `tool.uv.sources` callout.

It looks like there were significant changes at 0.4.0, so maybe something fundamental regressed there.  I read through changelogs and docs and couldn't get to the bottom of it, though.

---

_Comment by @charliermarsh on 2024-09-04 02:05_

Is `common` declared as a dependency in `rootdir/services/thing/pyproject.toml`? Or only at the root?

---

_Label `question` added by @charliermarsh on 2024-09-04 02:21_

---

_Comment by @charliermarsh on 2024-09-04 02:21_

If you can help put together a small reproducible example I'm happy to help.

---

_Comment by @brynbellomy on 2024-09-04 03:06_

It's declared a dependency only on the leaf, not the root.  Would making it one at the root help?  And sure, I can try to put together a reproducible example.

---

_Comment by @charliermarsh on 2024-09-04 03:16_

Yeah I would only expect it to be declared as a dependency in `rootdir/services/thing/pyproject.toml`, and not in the root -- so that sounds right. Was just a guess. A small reproducible example would help a ton, thanks.

---

_Label `needs-mre` added by @zanieb on 2024-10-21 21:41_

---

_Closed by @zanieb on 2024-10-21 21:41_

---
