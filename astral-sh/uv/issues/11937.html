<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keeping extras when running `uv sync` - astral-sh/uv #11937</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Keeping extras when running <code>uv sync</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11937">#11937</a>
        opened by <a href="https://github.com/brysonwu">@brysonwu</a>
        on 2025-03-03 23:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/brysonwu">@brysonwu</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>From https://github.com/astral-sh/uv/issues/4358, my understanding is that <code>uv sync</code> removes extraneous packages by default and <code>--inexact</code> should be used to disable this behavior.</p>
<p>I have two questions regarding this:</p>
<ol>
<li>How does <code>uv</code> determine that a package is extraneous?</li>
<li>Is there any way to keep installed extras without specifying <code>--inexact</code> or re-specifying <code>--extra</code>?</li>
</ol>
<h3>Platform</h3>
<p>Linux 5.15.167.4-microsoft-standard-WSL2 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.6.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @brysonwu on 2025-03-03 23:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Keep extras when running `uv sync`" to "Keeping extras when running `uv sync`" by @brysonwu on 2025-03-03 23:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-04 14:08</div>
            <div class="timeline-body"><p>The way to think of it is that when we perform a <code>uv sync</code> (without any arguments), we find the workspace root (or the project root, if it's not a workspace) and determine its dependencies without taking into account any of its extras. Then we install the inferred list of packages, and uninstall everything else.</p>
<p>At present, there's no way to define &quot;default&quot; extras like that. I think https://github.com/astral-sh/uv/issues/8607 is the closest thing for tracking it, but there's also a PEP in progress right now that touches on the concept.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brysonwu">@brysonwu</a> on 2025-03-04 18:50</div>
            <div class="timeline-body"><p>Thank you for the explanation. So just to check my understanding, any package outside of the core package dependencies and default groups (and soon, default extras) are considered to be extraneous?</p>
<p>I wanted to clarify that default extras is not the behavior I am looking for*. I can get my desired behavior of keeping installed extras through <code>uv pip install .[extra]</code> and avoiding <code>uv sync</code>. This may be by design but IMHO, it feels unnatural to fall back to the pip interface--pip feels like an impurity in uv-land.</p>
<p>In fact, I agree with what you said in https://github.com/astral-sh/uv/issues/4358#issuecomment-2282245206. I would expect that after I install an extra, I wouldn't have to explicitly tell uv to keep it every time I run <code>uv sync</code> (either by re-specifying <code>--extra</code> or by adding <code>--inexact</code>) or when I add another extra via <code>uv sync --extra &lt;other&gt;</code>. On the contrary, I think explicitly requesting a cleanup/exact sync makes more sense.</p>
<p>IIUC, <code>--inexact</code> was picked over <code>--exact</code> because it conforms better with <code>pip sync</code> conventions. But <code>uv sync</code>'s use case is not exactly the same as <code>pip sync</code>: <code>uv sync</code> is also used for installing optional dependencies because <code>uv add</code> does not allow for self-dependencies. Whereas in pip, <code>pip install -e .[extra]</code> fills the gap of what <code>pip sync</code> cannot do.</p>
<p>*: Also, if the extra is default, why not just add it to the core package dependencies? Self-dependency is allowed in the dev dependency group.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-04 18:54</div>
            <div class="timeline-body"><blockquote>
<p>IIUC, --inexact was picked over --exact because it conforms better with pip sync conventions.</p>
</blockquote>
<p>If you use <code>uv run</code>, we use an inexact sync by default. In <code>uv sync</code>, you've... asked for a sync explicitly.. it seems pretty weird not to follow exact sync semantics there.</p>
<blockquote>
<p>I would expect that after I install an extra, I wouldn't have to explicitly tell uv to keep it every time I run uv sync (either by re-specifying --extra or by adding --inexact) or when I add another extra via uv sync --extra <other>. On the contrary, I think explicitly requesting a cleanup/exact sync makes more sense.</p>
</blockquote>
<p>While I agree this may be intuitive to start, I think making the command stateful in this way would be much more confusing to reason about.</p>
<blockquote>
<p>*: Also, if the extra is default, why not just add it to the core package dependencies?</p>
</blockquote>
<p>So you can opt-out / turn it off :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brysonwu">@brysonwu</a> on 2025-03-04 18:59</div>
            <div class="timeline-body"><blockquote>
<p>If you use uv run, we use an inexact sync by default. In uv sync, you've... asked for a sync explicitly.. it seems pretty weird not to follow exact sync semantics there.</p>
</blockquote>
<p>Yes, I understand the intention of <code>uv sync</code> now. I conflated it with the behavior I expect from something like <code>pip install -e .[extra]</code> because of:</p>
<blockquote>
<p>uv sync's use case is not exactly the same as pip sync: uv sync is also used for installing optional dependencies because uv add does not allow for self-dependencies. Whereas in pip, pip install -e .[extra] fills the gap of what pip sync cannot do.</p>
</blockquote>
<blockquote>
<p>So you can opt-out / turn it off :)</p>
</blockquote>
<p>~~Oh interesting, do you know what the opt-out mechanism would look like? I didn't catch mention of how to opt-out in https://github.com/astral-sh/uv/issues/8607~~ Probably something like <code>--no-default-extras</code> hey?</p>
<p>As always, y'all have amazing response time</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-04 19:03</div>
            <div class="timeline-body"><p>The relevant discussion on default extras is probably at https://discuss.python.org/t/pre-publish-pep-771-default-extras-for-python-software-packages/77892 for which there's a PEP describing the motivations and such https://peps.python.org/pep-0771/ â€” there's a use for default extras beyond the development workflows, where yeah <code>tool.uv.default-extras</code> and <code>--no-default-extras</code> or <code>--no-extra</code> would be the minimal interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brysonwu">@brysonwu</a> on 2025-03-04 19:21</div>
            <div class="timeline-body"><blockquote>
<p>If you use uv run, we use an inexact sync by default. In uv sync, you've... asked for a sync explicitly.. it seems pretty weird not to follow exact sync semantics there.</p>
</blockquote>
<p>For this, yes it makes perfect sense when I invoke <code>uv sync</code> by itself. But when I add another extra by calling <code>uv sync --extra &lt;other&gt;</code>, I have to remind myself to include the previous extra or add <code>--inexact</code>. This is fine for me but is causing friction with uv adoption on a project I maintain. My users work in the project repo directly (not ideal but necessary in our case) and are surprised when <code>uv sync --extra</code> removes their previously installed extra. I rationalize this expectation as the users mapping <code>pip install -e .[extra]</code> to <code>uv sync --extra</code> in their mental model.</p>
<p>Instead of making <code>uv sync</code> stateful, how about building support for <code>uv add</code>  to ephemerally install optional dependencies until the next sync, e.g. by calling <code>uv add .[extra]</code>?</p>
<p>Not a demand phrased as a question, just trying to explore the solution space. I appreciate the philosophical purity that you are trying to maintain. I can happily proceed with falling back to the pip interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-04 19:31</div>
            <div class="timeline-body"><p><code>uv add</code> is intended to modify the <code>pyproject.toml</code>, not install things. It's sort of a side-effect that it performs a sync afterwards. It's interesting to consider adding extra support there, but I worry it confuses the larger story.</p>
<p>Perhaps what I'm looking for is: why do you need to <code>uv sync</code> at all? Editor support? Can you just use <code>uv sync --all-extras</code>? Why are you syncing multiple times?</p>
<p>Not trying to challenge your workflow here, but understanding the fundamental reasons you're doing things can be helpful as we consider a holistic improvement to the behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brysonwu">@brysonwu</a> on 2025-03-04 19:53</div>
            <div class="timeline-body"><p>Yes, editor support is primarily why we need to <code>uv sync</code>.</p>
<blockquote>
<p>Can you just use uv sync --all-extras?</p>
</blockquote>
<p>We can now, but I foresee conflicting extras in the future.</p>
<blockquote>
<p>Why are you syncing multiple times?</p>
</blockquote>
<p>User works on branch A, which requires subset of extras A. After deploying branch A, user is now working on branch B and need to re-sync with subset of extras B, which sometimes intersect with subset of extras A.</p>
<blockquote>
<p>Not trying to challenge your workflow here</p>
</blockquote>
<p>No worries, I would love to challenge the current workflow but the momentum is too strong ðŸ˜” Hopefully this move to uv will contribute to improving it over time though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brysonwu">@brysonwu</a> on 2025-03-04 19:57</div>
            <div class="timeline-body"><p>Dependency groups could help organize the different subsets of required extras, but then users would need to spend effort maintaining those dependency groups and so <code>uv pip install -e .[extras]</code> would become the path of least resistance anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-04 20:03</div>
            <div class="timeline-body"><p>As a workaround, we can probably support changing the default sync behavior (inexact) via the <code>pyproject.toml</code>. It's sort of an open question how we want to expose those options to users.</p>
<p>When you're working on branches / features that require specific extras, is use of those extras generally limited to specific files or modules? Or is usage mixed in single files?</p>
<p>The long-term fix here is improved editor integration. The IDE shouldn't need a real virtual environment to power suggestions and you shouldn't need to perform manual sync, but innovation there will take time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brysonwu">@brysonwu</a> on 2025-03-04 21:05</div>
            <div class="timeline-body"><blockquote>
<p>As a workaround, we can probably support changing the default sync behavior (inexact) via the pyproject.toml</p>
</blockquote>
<p>Yes, I think that would be nice. A similar idea has crossed my mind before: configurable default arguments for uv commands similar to how pytest supports <code>addopts</code>, but maybe in a more elegant way.</p>
<blockquote>
<p>When you're working on branches / features that require specific extras, is use of those extras generally limited to specific files or modules? Or is usage mixed in single files?</p>
</blockquote>
<p>In our case, limited to specific files and modules. But do you mind elaborating on what you mean by &quot;usage mixed in single files&quot;?</p>
<blockquote>
<p>The long-term fix here is improved editor integration. The IDE shouldn't need a real virtual environment to power suggestions and you shouldn't need to perform manual sync, but innovation there will take time.</p>
</blockquote>
<p>I didn't realize this was possible--it's an interesting concept. Do you have issues / other links I can read to learn more about this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-04 21:30</div>
            <div class="timeline-body"><blockquote>
<p>But do you mind elaborating on what you mean by &quot;usage mixed in single files&quot;?</p>
</blockquote>
<p>That'd be like.. a single file with logic like</p>
<pre><code>try:
   import foo
except ImportError:
   foo = None

try:
  import bar
except ImportError:
   bar = None

if foo is not None:
  print(&quot;the foo feature is enabled&quot;)
if bar is not None:
   print(&quot;the bar feature is enabled&quot;)
</code></pre>
<blockquote>
<p>I didn't realize this was possible--it's an interesting concept. Do you have issues / other links I can read to learn more about this?</p>
</blockquote>
<p>Not yet! It's just in my head so far :) probably more on this in the future though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brysonwu">@brysonwu</a> on 2025-03-04 21:47</div>
            <div class="timeline-body"><p>Ah, I see--yea we don't have those. In any case, I'll just continue on with recommending <code>uv pip install .[extra]</code> for now. Will keep an eye out for configurable default behaviors via <code>pyproject.toml</code> if it gets decided on :)</p>
<p>Thanks for answering my questions here @charliermarsh @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @brysonwu on 2025-03-04 21:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssbarnea">@ssbarnea</a> on 2025-09-23 09:23</div>
            <div class="timeline-body"><blockquote>
<p><code>uv sync --all-extras</code></p>
</blockquote>
<p>Any chance we could at least make the <code>--all-extras</code> configurable in pyproject.toml? This would allow us to ensure that <code>uv sync</code> would also install them. Otherwise we would have to type a lot and remember about each project. We have a solution for the dependency-groups but not for the extras.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Butanium">@Butanium</a> on 2025-09-25 00:49</div>
            <div class="timeline-body"><p>having an environment variable would also be good, e.g. i deployed a streamlit app that failed because i need some extra in my project for the app</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/osma">@osma</a> on 2026-01-16 09:45</div>
            <div class="timeline-body"><p>@ssbarnea</p>
<blockquote>
<p>Any chance we could at least make the --all-extras configurable in pyproject.toml? This would allow us to ensure that uv sync would also install them. Otherwise we would have to type a lot and remember about each project. We have a solution for the dependency-groups but not for the extras.</p>
</blockquote>
<p>I'm also struggling with this, and I found a neat solution in another comment https://github.com/astral-sh/uv/issues/8607#issuecomment-2540156984. If you want to make sure <code>uv sync</code> installs a set of extras by default, you can do that by adding your own package, with the &quot;default&quot; extras, to the dev dependency group, like the &quot;litestar&quot; package does.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-16 09:59:07 UTC
    </footer>
</body>
</html>
