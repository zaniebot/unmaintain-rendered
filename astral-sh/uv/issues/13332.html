<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal resolution with `only-binary` - astral-sh/uv #13332</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Universal resolution with <code>only-binary</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13332">#13332</a>
        opened by <a href="https://github.com/tkukushkin">@tkukushkin</a>
        on 2025-05-07 16:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tkukushkin">@tkukushkin</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hello! I have a small problem with universal resolution for pymssql.</p>
<p>First circumstance:</p>
<ul>
<li><a href="https://pypi.org/project/pymssql/2.3.4/#files">pymssql==2.3.4</a> doesn't have wheels for Windows x86-64</li>
<li><a href="https://pypi.org/project/pymssql/2.3.3/#files">pymssql==2.3.3</a> doesn't have wheels for linux</li>
</ul>
<p>Second circumstance: it's not very easy to install pymssql on windows without wheels.</p>
<p>So I generate requirements.txt like that:</p>
<pre><code>echo 'pymssql' | uv pip compile --universal --only-binary pymssql -
</code></pre>
<p>but I get:</p>
<pre><code>Resolved 1 package in 589ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --universal --only-binary pymssql -
pymssql==2.3.4
</code></pre>
<p>I tried to add uv.toml with</p>
<pre><code class="language-toml">required-environments = [
  &quot;sys_platform == 'win32' and platform_machine == 'x86_64'&quot;,
  &quot;sys_platform == 'linux' and platform_machine == 'x86_64'&quot;,
]
</code></pre>
<p>but it didn't help.</p>
<p>How can I ask uv to take into consideration availability of wheels for some specific environments?</p>
<h3>Platform</h3>
<p>Darwin 24.3.0 arm64</p>
<h3>Version</h3>
<p>uv 0.7.2 (481d05d8d 2025-04-30)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @tkukushkin on 2025-05-07 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-07 16:14</div>
            <div class="timeline-body"><p>I don't think <code>uv pip compile</code> respects <code>required-environments</code>. I think you need to use a <code>pyproject.toml</code> and a <code>uv.lock</code> then <code>uv export</code> if you want a <code>requirements.txt</code> file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2025-05-07 16:30</div>
            <div class="timeline-body"><p>It's interesting that is seems <code>uv pip compile</code> respects <code>environments</code> somehow, but it generates unusable requirements.txt:</p>
<pre><code>❯ echo -e &quot;pymssql&quot; | uv pip compile --only-binary pymssql --universal --emit-build-options -
Resolved 1 package in 13ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --only-binary pymssql --universal --emit-build-options -
--only-binary pymssql

pymssql==2.3.4 ; platform_machine == 'x86_64' and sys_platform == 'win32'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-07 16:39</div>
            <div class="timeline-body"><p>I can't reproduce this on linux, it looks correct on my machine, both with and without <code>required-environments</code> in <code>uv.toml</code>:</p>
<pre><code>$ echo -e &quot;pymssql&quot; | uv pip compile --only-binary pymssql --universal --emit-build-options -
Resolved 1 package in 133ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --only-binary pymssql --universal --emit-build-options -
--only-binary pymssql

pymssql==2.3.4
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2025-05-07 16:46</div>
            <div class="timeline-body"><p>Um, I can reproduce it in docker:</p>
<pre><code>❯ docker run -it --rm --pull=always ghcr.io/astral-sh/uv:debian bash
debian: Pulling from astral-sh/uv
Digest: sha256:8f75d47049441186e0c4901f7a657decf16a03cddd3ade62ffabc6d177f0db33
Status: Image is up to date for ghcr.io/astral-sh/uv:debian
root@489fed716acc:/# uv --version
uv 0.7.2
root@489fed716acc:/# echo &quot;environments = [\&quot;sys_platform == 'win32' and platform_machine == 'x86_64'\&quot;]&quot; &gt; uv.toml
root@489fed716acc:/# echo -e &quot;pymssql&quot; | uv pip compile --only-binary pymssql --universal --emit-build-options -
Resolved 1 package in 4.93s
# This file was autogenerated by uv via the following command:
#    uv pip compile --only-binary pymssql --universal --emit-build-options -
--only-binary pymssql

pymssql==2.3.4 ; platform_machine == 'x86_64' and sys_platform == 'win32'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2025-05-07 16:48</div>
            <div class="timeline-body"><p>Oh, I see the difference, you tried with <code>required-environments</code>, but I mentioned <code>environments</code> <a href="https://github.com/astral-sh/uv/issues/13332#issuecomment-2859239908">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2025-05-07 17:02</div>
            <div class="timeline-body"><p>I just mean <code>environments</code> and <code>required-environments</code> are pretty similar in scope of use options , and if <code>uv pip compile</code> respects <code>environments</code> (even if does it wrong), it seems strange to me that <code>uv pip compile</code> doesn't respect <code>required-environments</code>.</p>
<p>I would like to use pyproject.toml, but we have requirements.in in hundreds repositories and this migration will not be so easy.
At the moment, it seems it's easier for me to just pin pymssql==2.3.2 which has all necessary wheels.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-08 20:11</div>
            <div class="timeline-body"><p>CC @charliermarsh re <code>environments</code> and <code>required-environments</code> being treated differently in <code>uv pip compile</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:31:15 UTC
    </footer>
</body>
</html>
