<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv` fails to install nvidia package `nvidia-curand-cu12==10.3.2.106` - astral-sh/uv #1454</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv</code> fails to install nvidia package <code>nvidia-curand-cu12==10.3.2.106</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1454">#1454</a>
        opened by <a href="https://github.com/strickvl">@strickvl</a>
        on 2024-02-16 08:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/strickvl">@strickvl</a></div>
            <div class="timeline-body"><p>Installing a bunch of packages from a requirements.txt file <a href="https://github.com/zenml-io/zenml/actions/runs/7928023500/job/21645472367#step:3:490">fails with the following error</a>:</p>
<pre><code>+ uv pip install -r integration-requirements.txt
Resolved 453 packages in 4.68s
Downloaded 290 packages in 41.83s
error: Failed to install: nvidia_curand_cu12-10.3.2.106-py3-none-manylinux1_x86_64.whl (nvidia-curand-cu12==10.3.2.106)
  Caused by: failed to rename file from /home/runner/_work/zenml/zenml/.venv/lib/python3.10/site-packages/.tmpOgydOs/__init__.py to /home/runner/_work/zenml/zenml/.venv/lib/python3.10/site-packages/nvidia/__init__.py
  Caused by: No such file or directory (os error 2)
</code></pre>
<p>This is all happening on self-hosted runners via Github Actions. Script works fine with pip, but with <code>uv</code> we hit this failure. Unsure whether there&#x27;s something special about this package that doesn&#x27;t work well with <code>uv</code>?</p>
<p>Running locally (on a Mac) hits this error:</p>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because nvidia-curand-cu12==10.3.2.106 is unusable because no wheels are available with a
      matching platform and you require nvidia-curand-cu12==10.3.2.106, we can conclude that the
      requirements are unsatisfiable.
</code></pre>
<p>...though this is fair enough I suppose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-16 15:15</div>
            <div class="timeline-body"><p>Sorry but I can&#x27;t figure out which command to run to try and reproduce this. Can you please provide more detail? I looked at your CI log and tried to naively run the command there:</p>
<pre><code>(.venv) [andrew@duff i1454]$ uv pip install -e .[server,templates,terraform,secrets-aws,secrets-gcp,secrets-azure,secrets-hashicorp,s3fs,gcsfs,adlfs,dev,mlstacks]
error: Failed to build editables
  Caused by: Failed to build editable: file:///home/andrew/astral/issues/uv/i1454
  Caused by: Invalid source distribution: The archive contains neither a `pyproject.toml` nor a `setup.py` file at the top level
</code></pre>
<p>And I don&#x27;t see any <code>integration-requirements.txt</code> file in the linked repo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/strickvl">@strickvl</a> on 2024-02-16 19:56</div>
            <div class="timeline-body"><p>The commands in order:</p>
<pre><code>pip install -e .[server,templates,terraform,secrets-aws,secrets-gcp,secrets-azure,secrets-hashicorp,s3fs,gcsfs,adlfs,dev,mlstacks]

ignore_integrations=&quot;feast label_studio bentoml seldon kserve pycaret skypilot_aws skypilot_gcp skypilot_azure&quot;

ignore_integrations_args=&quot;&quot;
  for integration in $ignore_integrations; do
      ignore_integrations_args=&quot;$ignore_integrations_args --ignore-integration $integration&quot;
  done

zenml integration export-requirements \
        --output-file integration-requirements.txt \
        $ignore_integrations_args

echo &quot;&quot; &gt;&gt; integration-requirements.txt
    echo &quot;pyyaml&gt;=6.0.1&quot; &gt;&gt; integration-requirements.txt

    pip install -r integration-requirements.txt
</code></pre>
<p>Our CI is basically running <a href="https://github.com/zenml-io/zenml/blob/develop/scripts/install-zenml-dev.sh">this script</a> when it sets up the environment. The script itself is executed from a workflow file <a href="https://github.com/zenml-io/zenml/blob/72dbb3176092f592239d6694611e8b58c70fc915/.github/actions/setup_environment/action.yml#L124">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-16 20:00</div>
            <div class="timeline-body"><p>It sounds like that script specifically needs to be run from the root of that repo too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 21:44</div>
            <div class="timeline-body"><p>I can see where (in the code) this is happening, but I don&#x27;t yet see how.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 22:04</div>
            <div class="timeline-body"><p>This <em>may</em> be fixed by <a href="https://github.com/astral-sh/uv/pull/1546">astral-sh/uv#1546</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 22:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 22:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 22:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 22:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 22:09</div>
            <div class="timeline-body"><p>Sorry, didn&#x27;t mean for this to close on-merge, so it still might fail -- needs to be tested after release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-17 01:49</div>
            <div class="timeline-body"><p>v0.1.3 is out now. Do you mind retrying? (It may not solve it, but it could.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/strickvl">@strickvl</a> on 2024-02-17 09:17</div>
            <div class="timeline-body"><p>@charliermarsh this seems to fix it. I hit a new error, but at least the nvidia package issue installs fine now. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/strickvl">@strickvl</a> on 2024-02-17 09:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/raayu83">@raayu83</a> on 2024-08-29 13:58</div>
            <div class="timeline-body"><p>Hi @charliermarsh ,</p>
<p>with the high level API I get a an error for this package as well (slightly different version):</p>
<pre><code>error: Failed to download `nvidia-curand-cu12==10.3.2.56`
  Caused by: Failed to unzip wheel: nvidia_curand_cu12-10.3.2.56-py3-none-manylinux1_x86_64.whl
  Caused by: an upstream reader returned an error: error decoding response body
  Caused by: error decoding response body
  Caused by: request or response body error
  Caused by: error reading a body from connection
  Caused by: peer closed connection without sending TLS close_notify: https://docs.rs/rustls/latest/rustls/manual/_03_howto/index.html#unexpected-eof
</code></pre>
<p>Should I open a new issue or should this be handled here?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:29:24 UTC
    </footer>
</body>
</html>
