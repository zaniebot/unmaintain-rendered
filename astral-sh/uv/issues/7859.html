<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torch installation instructions for different platforms - astral-sh/uv #7859</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Torch installation instructions for different platforms</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7859">#7859</a>
        opened by <a href="https://github.com/chitralverma">@chitralverma</a>
        on 2024-10-02 07:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/chitralverma">@chitralverma</a> on 2024-10-02 07:19</div>
            <div class="timeline-body"><p>Hi, coming from poetry, I am trying out uv due to poetry's super slow resolutions and bulk.</p>
<p>Our workflow is as follows,</p>
<ul>
<li>Devs develop a project on their Macs with dependency <code>sentence-transformers</code> which pulls in torch as well.</li>
<li>Macs do not have GPU, so by default, we'd like to run all development and even deployment on CPU only</li>
<li>For the final product env, where GPUs are available, we would like to have an extras flag in the project, let's say 'cuda' which pulls in GPU dependencies.</li>
</ul>
<p>In short, we'd like to use uv to create a project in which the project source code remains the same, it is developed on Mac and only pulls in CPU dependencies by default. But for the target deployment environment where GPUs are available, we should be able to deploy the same project with an extra flag that pulls in the torch's GPU dependencies as well.</p>
<p>In poetry, we were following something like <a href="https://github.com/python-poetry/poetry/issues/6409#issuecomment-2203773939">this</a>, any suggestions on how to do this uv/ rye as we are very new with this?</p>
<p>Also referencing, https://github.com/pytorch/pytorch/issues/136275</p>
<p><strong>Dev Env Details:</strong>
uv == latest, 0.4.18
python &gt;= 3.8
platform: mac, sequoia, cpu-only env</p>
<p><strong>Prod Env Details:</strong>
uv == latest, 0.4.18
python &gt;= 3.8
platform: linux, gpu env</p>
<p>cc @charliermarsh @mitsuhiko</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-02 14:56</div>
            <div class="timeline-body"><p>This is a duplicate of #5945 â€” there's a fair bit of discussion there. We're expanding support for this in https://github.com/astral-sh/uv/pull/7769.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-10-02 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-10-02 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/rye/issues/1407.html">astral-sh/rye#1407</a> on 2024-10-04 06:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chitralverma">@chitralverma</a> on 2024-10-16 09:24</div>
            <div class="timeline-body"><p>closed by #7769</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @chitralverma on 2024-10-16 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @chitralverma on 2024-10-18 09:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chitralverma">@chitralverma</a> on 2024-10-18 09:34</div>
            <div class="timeline-body"><p>@charliermarsh even though #7769 is merged, i was wondering how we can achieve the task mentioned in the description of this issue.</p>
<p>you may link index to source and source to dependency, but python markers do not support environment variables as markers and if i create an extra &quot;cuda&quot; i don't know how to specify source or index in the optional-dependencies section.</p>
<p>basically if i install my project with --extras cpu it should only pull torch from the CPU index and if i provide --extras cuda then it should pull torch from a cuda index.</p>
<p>this also brings up the question what is exactly the point of having <code>sources</code> separate from <code>indexes</code>. Won't it be easier to just have something like this?</p>
<pre><code>[project]
dependencies = [
    &quot;linetimer&gt;=0.1.5&quot;,
    &quot;numpy==1.24.1&quot;,
]
name = &quot;uv-project&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.8&quot;

[tool.uv]
managed = true
dev-dependencies = [&quot;black&gt;=24.8.0&quot;, &quot;pytest&gt;=8.3.3&quot;, &quot;ruff&gt;=0.6.8&quot;]

[project.optional-dependencies]
cuda = [
    {name = &quot;torch&gt;=2.1.0&quot;, index = &quot;pytorch-cuda&quot;, marker = &quot;sys_platform != 'darwin'&quot;},
    {name = &quot;torch&gt;=2.1.0&quot;, index = &quot;pytorch-cpu&quot;, marker = &quot;sys_platform == 'darwin'&quot;},
    &quot;sentence-transformers&quot;
]

cpu = [
    {name = &quot;torch&gt;=2.1.0&quot;, index = &quot;pytorch-cpu&quot;, marker = &quot;sys_platform != 'darwin'&quot;},
    {name = &quot;torch&gt;=2.1.0&quot;, index = &quot;pytorch-cpu&quot;, marker = &quot;sys_platform == 'darwin'&quot;},
    &quot;sentence-transformers&quot;
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cuda&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
explicit = true

[tool.uv.pip]
generate-hashes = true
universal = true

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 16:33</div>
            <div class="timeline-body"><p>@chitralverma -- The specific case around using <em>extras</em> to manage this is not supported yet, because extras aren't mutually exclusive (you could enable both <code>--extra cpu</code> and <code>--extra cuda</code> in the above example, and then you'd get a conflict). We're working on support for conflicting extras, but managing them via features like that knowingly doesn't work yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 16:34</div>
            <div class="timeline-body"><p>I'm gonna combine this issue with https://github.com/astral-sh/uv/issues/5945.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-18 16:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
