<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`RegistryClientBuilder` should support creation from `BaseClientBuilder` - astral-sh/uv #4330</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`RegistryClientBuilder` should support creation from `BaseClientBuilder`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4330">#4330</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-06-14 17:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-14 17:18</div>
            <div class="timeline-body"><p><em>No description provided.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @zanieb on 2024-06-14 17:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @zanieb on 2024-06-14 17:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielenricocahall">@danielenricocahall</a> on 2024-06-29 21:59</div>
            <div class="timeline-body"><p>I can take this one, as I'm interested in learning and contributing!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-29 22:48</div>
            <div class="timeline-body"><p>Awesome! Let me know if you want some guidance on the goals. I pointed out the problem we're trying to solve over in https://github.com/astral-sh/uv/pull/4326#discussion_r1640139844 but didn't provide much detail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielenricocahall">@danielenricocahall</a> on 2024-06-30 04:31</div>
            <div class="timeline-body"><p>Hey @zanieb ! I think I may take you up on that ðŸ˜… . I've been pondering it - we could add another field to the struct:</p>
<pre><code class="language-rust">
    base_client_builder: Option&lt;BaseClientBuilder&lt;'a&gt;&gt;

</code></pre>
<p>then do something like the following in the <code>build</code> function:</p>
<pre><code class="language-rust">        let mut builder = self.base_client_builder.unwrap_or_else(BaseClientBuilder::new);
        ...
        let client = builder
            .retries(self.retries.unwrap_or(builder.retries))
            .connectivity(self.connectivity.unwrap_or(builder.connectivity))
            .native_tls(self.native_tls.unwrap_or(builder.native_tls))
            .keyring(self.keyring.unwrap_or(builder.keyring))
            .build();
</code></pre>
<p>but I'm not sure if that's clunky or over-engineering for the duplication, so I would love your feedback (this is also my first time dabbling in Rust, so I may be trying to fit a square peg into a circular hole with this approach).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-30 06:25</div>
            <div class="timeline-body"><p>I think I'd add a <code>base_client_builder</code> field to <code>RegistryClientBuilder</code> but I wouldn't make it an <code>Option</code>. I think we'd create it immediately in <code>RegistryClientBuilder::new</code> then mutate it in the relevant helpers (e.g. when changing <code>native_tls</code>) rather than storing all that state on the <code>RegistryClientBuilder</code> directly. Does that make sense?</p>
<p>Next you can add a <code>From</code> implementation to make it easy to create a registry client builder from an existing base</p>
<pre><code class="language-rust">impl From&lt;BaseClientBuilder&gt; for RegistryClientBuilder ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielenricocahall">@danielenricocahall</a> on 2024-06-30 14:01</div>
            <div class="timeline-body"><p>Thank you! I understand now - I think I have the updates in place I can push up and make a PR soon. One gap for adding the trait is <code>RegistryClientBuilder</code> needs a <code>cache</code> and I don't believe there is a default value to use e.g;</p>
<pre><code class="language-rust">impl&lt;'a&gt; From&lt;BaseClientBuilder&lt;'a&gt;&gt; for RegistryClientBuilder&lt;'a&gt; {
    fn from(value: BaseClientBuilder) -&gt; Self {
        Self {
            index_urls: IndexUrls::default(),
            index_strategy: IndexStrategy::default(),
            cache: ..., // Unsure how to approach this unless we add a separate helper function or trait
            base_client_builder: BaseClientBuilder::default(),
            client: None,
            markers: None,
            platform: None,
        }
    }
}



</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-20 14:23</div>
            <div class="timeline-body"><p>This happened in #4729</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-08-20 14:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:47:25 UTC
    </footer>
</body>
</html>
