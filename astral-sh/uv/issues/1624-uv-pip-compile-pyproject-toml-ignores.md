```yaml
number: 1624
title: "`uv pip compile pyproject.toml` ignores dependencies declared in `setup.cfg`"
type: issue
state: closed
author: SnoopJ
labels:
  - bug
  - compatibility
assignees: []
created_at: 2024-02-18T04:44:09Z
updated_at: 2024-03-25T20:27:43Z
url: https://github.com/astral-sh/uv/issues/1624
synced_at: 2026-01-12T15:58:30Z
```

# `uv pip compile pyproject.toml` ignores dependencies declared in `setup.cfg`

---

_@SnoopJ_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

Platform: Ubuntu 20.04
`uv` version: `fef1956`

## Reproduction

### Project files
```
# pyproject.toml
[build-system]
requires = ["setuptools"]
build-backend = "setuptools.build_meta"
```

```
# setup.cfg
[options]
packages = find:
install_requires=
    numpy
```

```
# setup.py
from setuptools import setup


setup(
    name="dummypkg",
    description="A dummy package",
)
```

### `uv` invocation

NOTE: this invocation points directly to the `uv` entrypoint to work around #1623.

```
$ ~/.pyenv/versions/3.9.16/bin/uv pip compile pyproject.toml  # numpy dependency is ignored
Resolved 0 packages in 4ms
# This file was autogenerated by uv v0.1.4 via the following command:
#    uv pip compile pyproject.toml
```

### Reference `pip-compile` (7.3.0) invocation

```
$ pip-compile pyproject.toml
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.9
# by the following command:
#
#    pip-compile pyproject.toml
#
numpy==1.26.4
    # via dummypkg (pyproject.toml)
```

---

_Comment by @SnoopJ on 2024-02-18 04:52_

Note: `uv pip install` _does_ support this metadata layout, but the inconsistency is quite surprising, and this was the very first issue I ran into with `uv`.

Moving the dependency declaration into `pyproject.toml` resolves the problem, but this excludes the `setuptools` workflow and delivers poorly on a "drop-in" experience.

---

_Label `bug` added by @zanieb on 2024-02-18 08:14_

---

_Label `compatibility` added by @zanieb on 2024-02-18 08:14_

---

_Comment by @charliermarsh on 2024-02-22 03:13_

Thanks, I'll take a look at this. (Right now, we just read the dependency information directly from the `pyproject.toml`.)

---

_Assigned to @charliermarsh by @charliermarsh on 2024-02-22 03:31_

---

_Comment by @charliermarsh on 2024-02-22 04:19_

So it looks like `pip-tools` will actually perform a PEP 517 call when passed a `pyproject.toml`, to determine the dependencies for the project. That's... interesting. It's a departure from my understanding of how it worked, but we of course have the capability to do that too.

---

_Comment by @sbidoul on 2024-03-10 13:27_

This could be solved similarly to https://github.com/astral-sh/uv/pull/2029.

---

_Comment by @zanieb on 2024-03-10 15:09_

@sbidoul I don't think so, that issue uses a `dynamic` value in the pyproject.toml as a hint to reinstall. Here we need to add PEP 517 calls to determine dependencies in some cases (rather than just reading them all directly from the file), but I don't see a key suggesting they're dynamic. Although there is a key in https://github.com/astral-sh/uv/issues/1644 it doesn't seem to apply in all cases.

---

_Comment by @sbidoul on 2024-03-10 15:17_

@zanieb in this case it is the absence of a `[project]` table that signals that all metadata is dynamic and a PEP 517 metadata preparation is required to obtain it.

---

_Comment by @charliermarsh on 2024-03-10 15:18_

üëç Might be two things here: (1) making it possible to run PEP 517 hooks for these, and (2) adding detection based on whether it‚Äôs dynamic.

---

_Comment by @charliermarsh on 2024-03-22 04:31_

I'll be looking into this tomorrow.

---

_Comment by @charliermarsh on 2024-03-23 02:36_

Now in review here: https://github.com/astral-sh/uv/pull/2633. Expect it to be supported in the next release.

---

_Closed by @charliermarsh on 2024-03-25 20:27_

---
