<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't find .dist-info for package with local version string - astral-sh/uv #2424</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Can't find .dist-info for package with local version string</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2424">#2424</a>
        opened by <a href="https://github.com/jasonprado">@jasonprado</a>
        on 2024-03-13 20:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jasonprado">@jasonprado</a> on 2024-03-13 20:26</div>
            <div class="timeline-body"><p>My requirements.txt has this:</p>
<pre><code>my-package==2024.3.13+0873c15
</code></pre>
<p>When I <code>uv pip install -r requirements.txt</code>:</p>
<pre><code>error: Failed to download: my-package==2024.3.13+0873c15
  Caused by: No .dist-info directory found
</code></pre>
<p>If I expand the whl, I see this dir:</p>
<pre><code>my_package-2024.3.13_0873c15.dist-info
</code></pre>
<p>The <code>+</code> is being converted to a <code>_</code>. I suspect that is why they dist-info can't be found. There is kind of a <a href="https://discuss.python.org/t/escaping-versions-for-wheel-sdist-and-dist-info-names/5605/22">mess of Python version strings</a> where <code>+</code> is a legal part of a version string denoting a local version, but it isn't allowed in the name of the <code>.dist-info</code> dir.</p>
<p>Running version <code>0.1.18</code> in a docker Linux shell.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-03-13 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jasonprado">@jasonprado</a> on 2024-03-13 21:58</div>
            <div class="timeline-body"><p>One thing I notice is that pip is not considering the package version in looking for the `.dist-info: https://github.com/pypa/pip/blob/36823099a9cdd83261fdbc8c1d2a24fa2eea72ca/src/pip/_internal/utils/wheel.py#L60</p>
<p>But uv is: https://github.com/astral-sh/uv/blob/91597317920f8c253c8ddb84846719db92f128a4/crates/install-wheel-rs/src/metadata.rs#L69</p>
<p>Perhaps a solution for uv is asserting that there is only one <code>.dist-info</code> present and that its path starts with the canonical name of the package, like pip.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-14 01:08</div>
            <div class="timeline-body"><p>I'll take a look!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-03-14 01:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-14 01:17</div>
            <div class="timeline-body"><p>My read of the spec is that it should still retain the <code>+</code>... I can't see why not? The <code>+</code> isn't removed during version normalization as in https://packaging.python.org/en/latest/specifications/version-specifiers/#version-specifiers-normalization. But we should make our processing more lax.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-14 01:40</div>
            <div class="timeline-body"><p>Are you able to share how you're building your wheel? E.g. which tool?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-14 13:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jasonprado">@jasonprado</a> on 2024-03-15 19:20</div>
            <div class="timeline-body"><p>Thanks for submitting a fix. I'll try it out ASAP.</p>
<p>I thought I found some documentation saying that the prefix to <code>.dist-info</code> only allowed <code>_-.</code> and not <code>+</code> but I can't find that source now. We are using bazel with the <code>aspect_rules_py</code> package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jasonprado">@jasonprado</a> on 2024-03-15 20:12</div>
            <div class="timeline-body"><p>0.1.21 works in our environment at flyzipline.com. Thanks! I'll start looking at migrating over to uv soon.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:43:12 UTC
    </footer>
</body>
</html>
