<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is it possible to add more than 1 optional dependency group when using dynamic python versions? - astral-sh/uv #12924</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Is it possible to add more than 1 optional dependency group when using dynamic python versions?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12924">#12924</a>
        opened by <a href="https://github.com/dan-b-at-osh">@dan-b-at-osh</a>
        on 2025-04-16 18:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dan-b-at-osh">@dan-b-at-osh</a></div>
            <div class="timeline-body">Question
<p>I can&#x27;t add a second batch of <code>--optional</code> dependencies when using a dynamic version while building a workspace package. Is this expected error? Toy example below based on <a href="https://github.com/konstin/uv-workspace-example-cable/tree/main">this awesome repo</a> and this modified <code>pyproject.toml</code> where I&#x27;m using <code>hatch-vcs</code> to set the version.</p>
Ubuntu commands
<p>‚úÖ Successfully added <code>network</code> <code>--extras</code> of <code>requests</code>.
‚ùå Unsuccessfully attempted to add <code>moo</code> <code>--extras</code> of <code>cowsay</code>.</p>
<pre><code>$ ~/uv-workspace-example-cable$ git tag 0.1.0
$ ~/uv-workspace-example-cable$ uv add --optional network httpx
Resolved 12 packages in 950ms
      Built cable @ file:///home/azureuser/uv-workspace-example-cable
Prepared 8 packages in 552ms
Uninstalled 1 package in 0.77ms
Installed 8 packages in 1ms
 + anyio==4.9.0
 - cable==0.1.0 (from file:///home/azureuser/uv-workspace-example-cable)
 + cable==0.1.1.dev0+g2fbead2.d20250416 (from file:///home/azureuser/uv-workspace-example-cable)
 + certifi==2025.1.31
 + h11==0.14.0
 + httpcore==1.0.8
 + httpx==0.28.1
 + idna==3.10
 + sniffio==1.3.1
$ ~/uv-workspace-example-cable$ uv add --optional moo cowsay
Resolved 12 packages in 16ms
error: Extra `moo` is not defined in the project&#x27;s `optional-dependencies` table
</code></pre>
<code>pyproject.toml</code>
<pre><code>[project]
name = &quot;cable&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
authors = [
    { name = &quot;konstin&quot;, email = &quot;konstin@mailbox.org&quot; }
]
requires-python = &quot;&gt;=3.12&quot;
dependencies = []
dynamic = [&quot;version&quot;]

[project.optional-dependencies]
cli = [
    &quot;cable-cli&quot;,
]
experiments = [
    &quot;cable-experiments&quot;,
]
network = [
    &quot;httpx&gt;=0.28.1&quot;,
]

[tool.uv.sources]
cable-core = { workspace = true }
cable-cli = { workspace = true }
cable-experiments = { workspace = true }

[tool.uv.workspace]
members = [&quot;packages/*&quot;]

[build-system]
requires = [&quot;hatchling&quot;, &quot;hatch-vcs&quot;]
build-backend = &quot;hatchling.build&quot;


[tool.hatch.version]
source = &quot;vcs&quot;

[tool.uv]
cache-keys = [{ git = true }]
</code></pre>
<p>You can replace the project&#x27;s <code>pyproject.toml</code> with this one before running the provided commands to see the result. More than happy to provide any additional info you need - I&#x27;ve loved working with <code>uv</code>! Got my whole team to start using it. Can&#x27;t recommend it enough üòÅ</p>
Platform
<p>Ubuntu 20.04 Linux 5.15.0-1073-azure x86_64 GNU/Linux</p>
Version
<p>uv 0.6.14</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/dan-b-at-osh">@dan-b-at-osh</a> on 2025-04-16 18:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-16 18:49</div>
            <div class="timeline-body"><p>This <em>seems</em> like a bug? This only occurs with dynamic <code>version</code> fields?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dan-b-at-osh">@dan-b-at-osh</a> on 2025-04-16 19:07</div>
            <div class="timeline-body"><p>As far as I can tell, yes. When I reverted to manually setting my <code>version</code>, it behaved as expected immediately. I didn&#x27;t even remove <code>hatch-vcs</code> or these fields</p>
<pre><code>...
[tool.hatch.version]
source = &quot;vcs&quot;

[tool.uv]
cache-keys = [{ git = true }]
...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-16 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-16 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-17 13:26</div>
            <div class="timeline-body"><p>Oh, I think this is because of:</p>
<pre><code>[tool.uv]
cache-keys = [{ git = true }]
</code></pre>
<p>Setting <code>cache-keys</code> like that will replace the default values. You want:</p>
<pre><code>[tool.uv]
cache-keys = [{ file = &quot;pyproject.toml&quot; }, { git = true }]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dan-b-at-osh">@dan-b-at-osh</a> on 2025-04-17 13:33</div>
            <div class="timeline-body"><p>This immediately worked, thank you! Looks like I missed that part of the settings documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dan-b-at-osh">@dan-b-at-osh</a> on 2025-04-17 13:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:16 UTC
    </footer>
</body>
</html>
