<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` does not respect `build-constraint-dependencies` in workspace subpackages - astral-sh/uv #12442</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv sync` does not respect `build-constraint-dependencies` in workspace subpackages</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12442">#12442</a>
        opened by <a href="https://github.com/alex-debrecht-kcftech">@alex-debrecht-kcftech</a>
        on 2025-03-24 17:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alex-debrecht-kcftech">@alex-debrecht-kcftech</a> on 2025-03-24 17:04</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The documentation for <code>build-constraint-dependencies</code> states:</p>
<blockquote>
<p>In uv lock, uv sync, and uv run, uv will only read build-constraint-dependencies from the pyproject.toml at the workspace root, and will ignore any declarations in other workspace members or uv.toml files.</p>
</blockquote>
<p>However, when running <code>uv sync --all-packages</code> in a workspace, <code>build-constraint-dependencies</code> is not respected for dependencies of non-root packages. It seems like the correct behavior would be to apply the constraints declared in the root <code>pyproject.toml</code> (build or install) to every package in the workspace.</p>
<p>Example repository structure:</p>
<pre><code>albatross
├── packages
│   ├── bird-feeder
│   │   ├── pyproject.toml
├── pyproject.toml
</code></pre>
<p>Root <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[tool.uv.sources]
bird-feeder = { workspace = true }

[tool.uv.workspace]
members = [&quot;packages/*&quot;]

[tool.uv]
build-constraint-dependencies = [&quot;setuptools&lt;78&quot;]
</code></pre>
<p>(adding a <code>project</code> table does not change the behavior)</p>
<p>bird-feeder <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;bird-feeder&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;pyspark==3.5.3&quot;]
</code></pre>
<p><code>uv sync --all-packages -v</code> output:</p>
<pre><code>DEBUG uv 0.6.9
DEBUG Found project root: `/home/alex/test-workspace`
DEBUG Adding discovered workspace member: `/home/alex/test-workspace/packages/bird-feeder`
DEBUG Acquired lock for `/home/alex/test-workspace`
DEBUG Using Python request `&gt;=3.12` from `requires-python` metadata
warning: `VIRTUAL_ENV=/mnt/c/Users/alexander.debrecht/git/core/.venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment's Python version satisfies `&gt;=3.12`
DEBUG Released lock at `/tmp/uv-9e4d8ed9a2d92e2b.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: bird-feeder @ file:///home/alex/test-workspace/packages/bird-feeder
DEBUG Found workspace root: `/home/alex/test-workspace`
DEBUG Adding discovered workspace member: `/home/alex/test-workspace/packages/bird-feeder`
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 3 packages in 2ms
DEBUG Using request timeout of 30s
DEBUG Must revalidate requirement: pyspark
DEBUG Must revalidate requirement: py4j
DEBUG Acquired lock for `/tmp/.tmpXDJFA3/sdists-v9/pypi/pyspark/3.5.3`
DEBUG No cache entry for: https://files.pythonhosted.org/packages/10/30/a58b32568f1623aaad7db22aa9eafc4c6c194b429ff35bdc55ca2726da47/py4j-0.10.9.7-py2.py3-none-any.whl
DEBUG No cache entry for: https://files.pythonhosted.org/packages/9a/90/cb80c8cf194958ab9a3242851c62fa5aef1a0b42f2d9642f1e2eca098005/pyspark-3.5.3.tar.gz
DEBUG Downloading source distribution: pyspark==3.5.3
   Building pyspark==3.5.3
DEBUG Building: pyspark==3.5.3
DEBUG Assessing Python executable as base candidate: /home/alex/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12
DEBUG Using base executable for virtual environment: /home/alex/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.12.8
DEBUG Solving with target Python version: &gt;=3.12.8
DEBUG Adding direct dependency: setuptools&gt;=40.8.0
DEBUG No cache entry for: https://pypi.org/simple/setuptools/
...
DEBUG Searching for a compatible version of setuptools (&gt;=40.8.0)
DEBUG Selecting: setuptools==78.0.1 [compatible] (setuptools-78.0.1-py3-none-any.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/42/c8/3faed884acdb2c1f2eb353cbacdd1ee4943de89a199d1f622ebefb6170e5/setuptools-78.0.1-py3-none-any.whl.metadata
DEBUG Tried 1 versions: setuptools 1
DEBUG marker environment resolution took 0.187s
DEBUG Installing in setuptools==78.0.1 in /tmp/.tmpXDJFA3/builds-v0/.tmprOwTmX
DEBUG Must revalidate requirement: setuptools
DEBUG Downloading and building requirement for build: setuptools==78.0.1
DEBUG No cache entry for: https://files.pythonhosted.org/packages/42/c8/3faed884acdb2c1f2eb353cbacdd1ee4943de89a199d1f622ebefb6170e5/setuptools-78.0.1-py3-none-any.whl
DEBUG Installing build requirement: setuptools==78.0.1
DEBUG Creating PEP 517 build environment
...
DEBUG Released lock at `/tmp/.tmpXDJFA3/sdists-v9/pypi/pyspark/3.5.3/.lock`
  × Failed to build `pyspark==3.5.3`
  ...
  help: `pyspark` (v3.5.3) was included because `bird-feeder` (v0.0.0) depends on `pyspark`
</code></pre>
<p>The actual build error seems irrelevant, but this came up due to <a href="https://github.com/pypa/setuptools/issues/4910#issuecomment-2748734607">the breaking change in setuptools 78</a>.</p>
<h3>Platform</h3>
<p>Linux 4.4.0-22621-Microsoft x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>0.6.9</p>
<h3>Python version</h3>
<p>3.12.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @alex-debrecht-kcftech on 2025-03-24 17:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex-debrecht-kcftech">@alex-debrecht-kcftech</a> on 2025-03-24 17:09</div>
            <div class="timeline-body"><p>Adding</p>
<pre><code class="language-toml">[tool.uv]
build-constraint-dependencies = [&quot;setuptools&lt;78&quot;]
</code></pre>
<p>to the <code>bird-feeder</code> <code>pyproject.toml</code> has no effect, as documented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-03-24 17:12</div>
            <div class="timeline-body"><p>This is a duplicate of https://github.com/astral-sh/uv/issues/12441, workaround provided in https://github.com/astral-sh/uv/issues/12440</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @alex-debrecht-kcftech on 2025-03-24 17:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:44:29 UTC
    </footer>
</body>
</html>
