<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--universal` output incompatible with `requires-python` - astral-sh/uv #6031</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`--universal` output incompatible with `requires-python`</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6031">#6031</a>
        opened by <a href="https://github.com/blueraft">@blueraft</a>
        on 2024-08-12 09:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/blueraft">@blueraft</a> on 2024-08-12 09:41</div>
            <div class="timeline-body"><p>Simple MRE:</p>
<pre><code>[project]
name = &quot;foobar&quot;
version = &quot;0.1&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [&quot;networkx&quot;]
</code></pre>
<pre><code class="language-console">‚ùØ uv pip compile pyproject.toml --universal
Resolved 1 package in 16ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml --universal
networkx==3.3
    # via foobar (pyproject.toml)
</code></pre>
<p>The output is not universal since <code>networkx==3.3</code> only supports <code>&gt;=py3.10</code>.</p>
<pre><code>‚ùØ uv pip install -r requirements.txt
  √ó No solution found when resolving dependencies:
  ‚ï∞‚îÄ‚ñ∂ Because the current Python version (3.9.6) does not satisfy Python&gt;=3.10 and networkx==3.3 depends on Python&gt;=3.10, we can conclude that networkx==3.3 cannot be used.
      And because you require networkx==3.3, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>The lock file is correct though.</p>
<pre><code>‚ùØ cat uv.lock
version = 1
requires-python = &quot;&gt;=3.9&quot;

[[package]]
name = &quot;foobar&quot;
version = &quot;0.1&quot;
source = { editable = &quot;.&quot; }
dependencies = [
    { name = &quot;networkx&quot; },
]

[[package]]
name = &quot;networkx&quot;
version = &quot;3.2.1&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
sdist = { url = &quot;https://files.pythonhosted.org/packages/c4/80/a84676339aaae2f1cfdf9f418701dd634aef9cc76f708ef55c36ff39c3ca/networkx-3.2.1.tar.gz&quot;, hash = &quot;sha256:9f1bb5cf3409bf324e0a722c20bdb4c20ee39bf1c30ce8ae499c8502b0b5e0c6&quot;, size = 2073928 }
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/d5/f0/8fbc882ca80cf077f1b246c0e3c3465f7f415439bdea6b899f6b19f61f70/networkx-3.2.1-py3-none-any.whl&quot;, hash = &quot;sha256:f18c69adc97877c42332c170849c96cefa91881c99a7cb3e95b7c659ebdc1ec2&quot;, size = 1647772 },
]
</code></pre>
<p>uv 0.2.35</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-08-12 11:00</div>
            <div class="timeline-body"><p>Huh can't reproduce this anymore, I'll close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @blueraft on 2024-08-12 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-08-12 11:05</div>
            <div class="timeline-body"><p>I don't believe <code>--universal</code> reads <code>requires-python</code> from the input files, you have to specify <code>-p 3.9</code>. By default it will use the major and minor version of the current interpreter as a lower bound.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-08-12 11:11</div>
            <div class="timeline-body"><p>Oh that's why the resolution got fixed.</p>
<p>Is there a reason why it doesn't read the <code>requires-python</code> from the <code>pyproject.toml</code> file?</p>
<pre><code>      --universal                                        Perform a universal resolution, attempting to generate a single `requirements.txt` output file that is compatible with all operating systems,
                                                         architectures, and Python implementations
</code></pre>
<p>The 'and Python implementations' gives me the impression that it'd be compatible with <code>requires-python</code> in the project metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @blueraft on 2024-08-12 11:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-12 12:15</div>
            <div class="timeline-body"><p>I think we don't want <code>uv pip compile</code> to implicitly read a pyproject.toml but maybe if it's explicitly provided we <em>should</em> use the metadata? I believe we discussed this previously cc @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-12 14:36</div>
            <div class="timeline-body"><p>I'm a little hesitant to read from them but we can consider it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-08-12 16:57</div>
            <div class="timeline-body"><p>Maybe only for <code>--universal</code>, since that's a uv only thing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-12 16:58</div>
            <div class="timeline-body"><p>I think it probably does make sense to pick a Python that meets the requires-python for all provided pyproject.toml files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-08-12 17:08</div>
            <div class="timeline-body"><p>Happy to make a PR for this if you decide to support it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-08-22 01:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-02-11 20:38</div>
            <div class="timeline-body"><p>+1 for this.</p>
<p>Being able to make multi-Python-version constraints/lock files is super useful, especially when ensuring build/test reproducibility on a library project that is being tested across a matrix of Python versions and OS platforms.</p>
<p>At the moment I am keeping a clunky algorithm for determining <code>--python-version</code> from <code>requires-python</code>, but I'd rather just let <code>uv</code> handle it for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-12 16:13</div>
            <div class="timeline-body"><p>Sort of a hack, but we could special case <code>--python-version requires-python</code> ü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-02-12 23:30</div>
            <div class="timeline-body"><p>Possibly, but why not as a default behaviour? It's a sensible expectation, and <code>uv lock</code> seems be doing this already.</p>
<p>(and, perhaps more compellingly: if it's made a default behaviour, it can be represented as a falsey/unset value, rather than a special-case magic string)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-13 04:41</div>
            <div class="timeline-body"><p>Because <code>pip</code> does not read metadata from the <code>pyproject.toml</code> (as a design goal) and reading that metadata implicitly in a &quot;compatible&quot; interface would be surprising to some users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-02-13 08:47</div>
            <div class="timeline-body"><p>It's not implicit because I'm passing <code>pyproject.toml</code> as an argument, and this is a usage that is already supported in <code>pip-tools</code>. And metadata is already being read (<code>project.{,optional-}dependencies</code>), so if anything, reading 'this' metadata but not that 'that' metadata is more jarring.</p>
<p>And <code>--universal</code> is already a <code>uv</code> innovation, so I think the surprise/astonishment element is probably diminished?</p>
<p>(FWIW, I have my workaround and it's fine for the time being -- I am comfortable with holding out for an elegant solution, but alas PEP 751 is some way away and the next best 'standard' thing is constraints files. This is why I am personally trying to refine our usage of constraints files in a way that it's at near-parity with structured lockfiles.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BryceBeagle">@BryceBeagle</a> on 2026-01-06 20:38</div>
            <div class="timeline-body"><p>I'm also running into this. I tried using <code>requires-python</code> because the error message told me to, but it wasn't doing anything</p>
<pre><code>      hint: While the active Python version is 3.10, the resolution failed for
      other Python versions supported by your project. Consider limiting your
      project's supported Python versions using `requires-python`
</code></pre>
<p>There's a specific interpreter version that my requirements are incompatible with, but I'm perfectly OK with <code>uv</code> trying to ignore it entirely. Even more, passing <code>--python-version</code> to <code>uv pip compile</code> doesn't seem to be doing anything (perhaps a separate issue?)</p>
<p>As a workaround, I've found that I can use</p>
<pre><code class="language-toml">[tool.uv]
environments = [
  &quot;sys_platform == 'linux' and python_version == '3.10'&quot;,
  &quot;sys_platform == 'darwin' and python_version == '3.10'&quot;,
  &quot;sys_platform == 'linux' and python_version == '3.11'&quot;,
  # etc
]
</code></pre>
<p>in my <code>pyproject.toml</code> to fit my exact <code>--universal</code>-ish needs and avoid the fork where my constraints don't resolve properly.</p>
<p>But since <code>python-requires</code> <em>doesn't</em> work here, I think it would be a good idea to update the error message since it suggests something that doesn't work.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:17:03 UTC
    </footer>
</body>
</html>
