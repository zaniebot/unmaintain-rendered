<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow updating sources with `uv add` - astral-sh/uv #4567</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow updating sources with <code>uv add</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4567">#4567</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2024-06-26 21:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-06-26 21:25</div>
            <div class="timeline-body"><p>Follow up to https://github.com/astral-sh/uv/pull/4566, <code>uv add git+https://..foo</code> followed by <code>uv add foo --branch foo</code> should work as expected. Currently it errors. <code>cargo add</code> supports this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ibraheemdev on 2024-06-26 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @ibraheemdev on 2024-06-28 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @charliermarsh on 2024-07-29 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2024-07-29 01:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> removed by @zanieb on 2024-08-20 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/marcvanheerden">@marcvanheerden</a> on 2024-08-29 11:11</div>
            <div class="timeline-body"><p>can I try this one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-29 16:30</div>
            <div class="timeline-body"><p>@marcvanheerden feel free!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/marcvanheerden">@marcvanheerden</a> on 2024-08-30 11:24</div>
            <div class="timeline-body"><p>@ibraheemdev , just want to clarify the task for this, is this the error we want to fix?
<img src="https://github.com/user-attachments/assets/225c401e-e714-40eb-a0f1-d9ec10d190e8" alt="Screenshot 2024-08-30 at 13 21 21" /></p>
<p>I tested a similar example on cargo stable and nightly and this doesn't appear to work on cargo.
<img src="https://github.com/user-attachments/assets/abba2374-c5fe-491c-b6d0-8647e27555c0" alt="Screenshot 2024-08-30 at 13 24 03" /></p>
<p>Let me know if I misunderstood</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aditya-PS-05">@Aditya-PS-05</a> on 2024-10-25 05:42</div>
            <div class="timeline-body"><p>Is this issue solved. Can I try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sofubi">@sofubi</a> on 2024-11-13 02:35</div>
            <div class="timeline-body"><p>I gave this a look and am not sure that this is actually an issue.</p>
<p>To test I:</p>
<ul>
<li>created a new project with <code>uv init</code></li>
<li>ran <code>uv add git+https://github.com/psf/requests</code> which successfully adds <code>requests</code> with git source</li>
<li>ran <code>uv add git+https://github.com/psf/requests --branch consider_certs</code> which successfully updates the package's source info</li>
</ul>
<p>See below for the diff of my <code>pyproject.toml</code> from the first and second commands.</p>
<pre><code class="language-diff">diff --git a/pyproject.toml b/pyproject.toml
index 3f64dba..b180aa3 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -2,11 +2,11 @@
 name = &quot;updating-git-branches&quot;
 version = &quot;0.1.0&quot;
 description = &quot;Add your description here&quot;
 readme = &quot;README.md&quot;
 requires-python = &quot;&gt;=3.12&quot;
 dependencies = [
     &quot;requests&quot;,
 ]
 
 [tool.uv.sources]
-requests = { git = &quot;https://github.com/psf/requests&quot; }
+requests = { git = &quot;https://github.com/psf/requests&quot;, branch = &quot;consider_certs&quot; }

</code></pre>
<p>The following does not work (and seems expected):</p>
<pre><code class="language-sh">&gt; uv add git+https://github.com/psf/requests
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.17s
     Running `/Users/sofubi/Projects/contributing/uv/target/debug/uv add 'git+https://github.com/psf/requests'`
 Updated https://github.com/psf/requests (23540c93)
Resolved 6 packages in 14ms
Installed 5 packages in 10ms
 + certifi==2024.8.30
 + charset-normalizer==3.4.0
 + idna==3.10
 + requests==2.32.3 (from git+https://github.com/psf/requests@23540c93cac97c763fe59e843a08fa2825aa80fd)
 + urllib3==2.2.3

&gt; uv add requests --branch consider_certs
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.44s
     Running `/Users/sofubi/Projects/contributing/uv/target/debug/uv add requests --branch consider_certs`
error: `requests` did not resolve to a Git repository, but a Git reference (`--branch consider_certs`) was provided.
</code></pre>
<p>I looked at the <code>uv add --help</code> info and it specifically says that <code>--branch</code> is meant to be used when adding a package from git. The cargo functionality similarly appears to expect <code>--branch</code> to be used only when <code>--git</code> is used.</p>
<pre><code class="language-sh">Options:
  -r, --requirements &lt;REQUIREMENTS&gt;  Add all packages listed in the given `requirements.txt` files
      --dev                          Add the requirements to the development dependency group
      --optional &lt;OPTIONAL&gt;          Add the requirements to the package\'s optional dependencies for the specified extra
      --group &lt;GROUP&gt;                Add the requirements to the specified dependency group
      --editable                     Add the requirements as editable
      --raw-sources                  Add source requirements to `project.dependencies`, rather than `tool.uv.sources`
      --rev &lt;REV&gt;                    Commit to use when adding a dependency from Git
      --tag &lt;TAG&gt;                    Tag to use when adding a dependency from Git

      --branch &lt;BRANCH&gt;              Branch to use when adding a dependency from Git

      --extra &lt;EXTRA&gt;                Extras to enable for the dependency
      --no-sync                      Avoid syncing the virtual environment [env: UV_NO_SYNC=]
      --locked                       Assert that the `uv.lock` will remain unchanged [env: UV_LOCKED=]
      --frozen                       Add dependencies without re-locking the project [env: UV_FROZEN=]
      --package &lt;PACKAGE&gt;            Add the dependency to a specific package in the workspace
      --script &lt;SCRIPT&gt;              Add the dependency to the specified Python script, rather than to a project
</code></pre>
<p>If it's expected that <code>uv add requests --branch consider_certs</code> should add the branch to the existing package source then I'd be a little confused as that would really prevent users from being able to move away from using a git source and go to using something like PyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxmynter">@maxmynter</a> on 2025-04-15 13:01</div>
            <div class="timeline-body"><p>I understand the issue in the sense that we would like to support not using the full Git url but just the package name and if a git option (like <code>--branch main</code>) is provided we fallback onto an existing one (if it exists) instead of erroring.</p>
<p>I've proposed an implementation to achieve this in #12897</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-21 02:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-21 02:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:35 UTC
    </footer>
</body>
</html>
