<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Move `uv format` unformatted test file into const - astral-sh/uv #15458</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Move `uv format` unformatted test file into const</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15458">#15458</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-08-22 16:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-22 16:26</div>
            <div class="timeline-body"><blockquote>
<p>There are a lot of duplicated code among these tests (mainly, the same <code>pyproject.toml</code>, and the formatted/unformatted code snippets). I preferred to maintain the previous style and copypaste the mock data. I'm not sure what approach do you usually follow here (to extract into constants/fixtures vs always copypaste)</p>
</blockquote>
<p><em>Originally posted by @jorgehermo9 in https://github.com/astral-sh/uv/pull/15438#discussion_r2292327872</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-22 16:26</div>
            <div class="timeline-body"><p>I'd probably focus on the repeated code snippets more than the <code>pyproject.toml</code> repetition.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @zanieb on 2025-08-22 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @zanieb on 2025-08-22 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @zanieb on 2025-08-22 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15438.html">astral-sh/uv#15438</a> on 2025-08-22 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pposca">@pposca</a> on 2025-08-22 20:57</div>
            <div class="timeline-body"><p>It seems if you use assert_snapshot!(reference_value, @&quot;snapshot&quot;) to compare 2 values, you have to use a @&quot;string literal&quot;, so you cannot use a const or var there (at least, I couldn't find the way):</p>
<p>https://github.com/astral-sh/uv/blob/e6def431107dabf0a2339be5687d318631f9f503/crates/uv/tests/it/format.rs#L43C5-L53C9</p>
<p>Other option is to create 2 or 3 auxiliary functions like create_unformated_file, check_file_formated and check_file_not formated. Is that something you like?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-22 21:53</div>
            <div class="timeline-body"><p>I don't think we want to replace the snapshot with a string literal, just the file we're writing for testing?</p>
<p>We could also just simplify the file dramatically, e.g., <code>x      = 1</code> so there's less noise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pposca">@pposca</a> on 2025-08-23 09:38</div>
            <div class="timeline-body"><blockquote>
<p>Hey. Can i take this one? Please assign</p>
</blockquote>
<p>Sorry, I'm about to send a PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15468.html">astral-sh/uv#15468</a> on 2025-08-23 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pposca">@pposca</a> on 2025-08-23 09:59</div>
            <div class="timeline-body"><p>@zanieb , I find tests clearer like this, but I'm not sure if this is what you had in mind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jorgehermo9">@jorgehermo9</a> on 2025-08-23 11:05</div>
            <div class="timeline-body"><p>I really like what you did to simplify them @pposca</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-08-25 12:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
