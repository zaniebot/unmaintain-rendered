<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using a dynamic version causes the `uv-lock` pre-commit CI to fail on GitHub but pass locally. - astral-sh/uv #10167</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using a dynamic version causes the `uv-lock` pre-commit CI to fail on GitHub but pass locally.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10167">#10167</a>
        opened by <a href="https://github.com/vivodi">@vivodi</a>
        on 2024-12-26 07:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vivodi">@vivodi</a> on 2024-12-26 07:33</div>
            <div class="timeline-body"><p>Using a dynamic version causes the <code>uv-lock</code> pre-commit CI to fail on GitHub but pass locally.</p>
<p><a href="https://results.pre-commit.ci/run/github/908488856/1735199232.YKQmFkjZTOWIBNPp79iUKg">Log</a>:</p>
<pre><code>uv-lock..................................................................Failed
- hook id: uv-lock
- exit code: 2

warning: `VIRTUAL_ENV=/pc/clone/JLKubma3TtiMMhmWEG5Gxg/py_env-python3` does not match the project environment path `.venv` and will be ignored
Using CPython 3.12.7 interpreter at: /usr/bin/python3.12
error: Failed to generate package metadata for `myproject==1.0.0 @ editable+.`
  Caused by: Failed to resolve requirements from `build-system.requires`
  Caused by: No solution found when resolving: `hatchling`
  Caused by: Failed to fetch: `https://pypi.org/simple/hatchling/`
  Caused by: Could not connect, are you offline?
  Caused by: Request failed after 3 retries
  Caused by: error sending request for url (https://pypi.org/simple/hatchling/)
  Caused by: client error (Connect)
  Caused by: dns error: failed to lookup address information: Temporary failure in name resolution
  Caused by: failed to lookup address information: Temporary failure in name resolution
</code></pre>
<p>pyproject.toml:</p>
<pre><code class="language-toml">[project]
name = &quot;myproject&quot;
requires-python = &quot;&gt;=3.12&quot;
dynamic = [&quot;version&quot;]

[tool.hatch.version]
path = &quot;myproject/version.py&quot;

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
<p>.pre-commit-config.yaml:</p>
<pre><code class="language-yaml">repos:
- repo: https://github.com/astral-sh/uv-pre-commit
  rev: 0.5.11
  hooks:
    - id: uv-lock
</code></pre>
<p>Repo: https://github.com/vivodi/myproject</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Using a dynamic version causes the uv-lock pre-commit CI to fail on GitHub but pass locally." to "Using a dynamic version causes the `uv-lock` pre-commit CI to fail on GitHub but pass locally." by @vivodi on 2024-12-26 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 14:36</div>
            <div class="timeline-body"><p>I think you're looking for #7533.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-26 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vivodi">@vivodi</a> on 2024-12-26 15:05</div>
            <div class="timeline-body"><blockquote>
<p>I think you're looking for <a href="https://github.com/astral-sh/uv/issues/7533">#7533</a>.</p>
</blockquote>
<p>I don't think this issue is a duplicate of #7533. My version number is stored in a file and doesn't change automatically. Additionally, the pre-commit CI runs uv-lock <strong>without any issues locally</strong>; the error <strong>only</strong> occurs when running on GitHub.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vivodi">@vivodi</a> on 2024-12-26 15:07</div>
            <div class="timeline-body"><p>I tried downgrading the version to 0.4.x as suggested in #7533, but it didn't help. Can this issue be reopened?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 15:10</div>
            <div class="timeline-body"><p>Apologies, you're right that it's not a duplicate, but I don't know that there's anything for us to do here. It looks like the request client can't connect to <code>pypi.org</code> from your GitHub runner.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vivodi">@vivodi</a> on 2024-12-26 15:16</div>
            <div class="timeline-body"><p>I am not running it on a GitHub runner, but on the pre-commit CI server. And as long as I switch to <strong>the static version</strong>, <code>uv-lock</code> has no issues. There were no problems when using <code>poetry-lock</code> before, so I think it's an issue with <code>uv-lock</code>.</p>
<p>And this issue has been persistent, it's not a temporary network problem with the server.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 15:27</div>
            <div class="timeline-body"><p>It makes sense that it wouldn't fail when you had a static version, because there's no need to build your project. But now you have a dynamic version, so you're requiring uv to install your build dependencies and build your project. That in turn requires downloading hatchling.</p>
<p>I just don't know that there's anything we can do here if DNS is failing on the machine? It sounds like pre-commit.ci doesn't allow network access on the free tier: https://github.com/pre-commit-ci/issues/issues/80 / https://github.com/pre-commit-ci/issues/issues/47#issuecomment-804481763.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10176.html">astral-sh/uv#10176</a> on 2024-12-26 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vivodi">@vivodi</a> on 2024-12-26 18:19</div>
            <div class="timeline-body"><blockquote>
<p>It makes sense that it wouldn't fail when you had a static version, because there's no need to build your project. But now you have a dynamic version, so you're requiring uv to install your build dependencies and build your project. That in turn requires downloading hatchling.</p>
<p>I just don't know that there's anything we can do here if DNS is failing on the machine? It sounds like pre-commit.ci doesn't allow network access on the free tier: <a href="https://github.com/pre-commit-ci/issues/issues/80">pre-commit-ci/issues#80</a> / <a href="https://github.com/pre-commit-ci/issues/issues/47#issuecomment-804481763">pre-commit-ci/issues#47 (comment)</a>.</p>
</blockquote>
<p>After some research, I realized that what I really want is for <code>uv lock --locked --offline</code> to check the consistency between <code>uv.lock</code> and <code>pyproject.toml</code>, but it doesnâ€™t work for projects with dynamic versions either. See #10176</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:56 UTC
    </footer>
</body>
</html>
