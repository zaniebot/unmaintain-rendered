<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv does not recognize dependencies declared in script - astral-sh/uv #6700</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv does not recognize dependencies declared in script</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6700">#6700</a>
        opened by <a href="https://github.com/bongomachine">@bongomachine</a>
        on 2024-08-27 16:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bongomachine">@bongomachine</a></div>
            <div class="timeline-body"><p>Howdy and thanks for a great piece of software! I'm not sure if this is a bug or if I'm simply doing things wrong. Anyway..</p>
<p>When I run the following piece of python:</p>
<pre><code># /// script
# requires-python = &quot;&gt;=3.12&quot;
# dependencies = [
#     &quot;cyclonedds ==0.11.0&quot;,
# ]

# [tool.uv]
# index-strategy = &quot;unsafe-best-match&quot;

# [tool.uv.sources]
# cyclonedds = { git = &quot;https://github.com/eclipse-cyclonedds/cyclonedds-python.git&quot;, rev = &quot;080dfd4b26e4c4dc2529694ef9cf9589750360c1&quot; }

# ///


import cyclonedds as dds

print(&quot;Hello, World!&quot;)
</code></pre>
<p>With command: <code>CYCLONEDDS_HOME=~/.local uv -v run test.py</code></p>
<p>I get the following error:</p>
<pre><code>DEBUG uv 0.3.4
DEBUG No project found; searching for Python interpreter
DEBUG Searching for Python interpreter in managed installations or system path
DEBUG Searching for managed installations at `~/.local/share/uv/python`
DEBUG Found `cpython-3.12.3-linux-x86_64-gnu` at `/usr/bin/python3` (search path)
DEBUG Using Python 3.12.3 interpreter at: /usr/bin/python3
DEBUG Running `python test.py`
Traceback (most recent call last):
  File &quot;~/tmp/test.py&quot;, line 15, in &lt;module&gt;
    import cyclonedds as dds
ModuleNotFoundError: No module named 'cyclonedds'
</code></pre>
<p>However, if I run the following: <code>uv venv &amp;&amp; CYCLONEDDS_HOME=~/.local uv pip install git+https://github.com/eclipse-cyclonedds/cyclonedds-pytho n@080dfd4b26e4c4dc2529694ef9cf9589750360c1 &amp;&amp; uv run test.py</code>, everything works.</p>
<p>As stated earlier, this might be the intended behavior, but I'm not sure.</p>
<ul>
<li><p>The current uv platform.
<strong>Linux (x86_64) Ubuntu 24.04</strong></p>
</li>
<li><p>The current uv version (<code>uv --version</code>).
<strong>uv 0.3.4</strong></p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 16:54</div>
            <div class="timeline-body"><p>I agree that this should work, at least from the above description.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-27 16:55</div>
            <div class="timeline-body"><p>I presume the problem here is that we're not respecting <code>[tool.uv.sources]</code>? Or are we not installing <code>cyclonedds</code> at all? Kind of looks like the latter...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 16:55</div>
            <div class="timeline-body"><p>The problem is the break in the script -- try this:</p>
<pre><code class="language-python"># /// script
# requires-python = &quot;&gt;=3.12&quot;
# dependencies = [
#     &quot;cyclonedds ==0.11.0&quot;,
# ]
#
# [tool.uv]
# index-strategy = &quot;unsafe-best-match&quot;
#
# [tool.uv.sources]
# cyclonedds = { git = &quot;https://github.com/eclipse-cyclonedds/cyclonedds-python.git&quot;, rev = &quot;080dfd4b26e4c4dc2529694ef9cf9589750360c1&quot; }
#
# ///


import cyclonedds as dds

print(&quot;Hello, World!&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 16:55</div>
            <div class="timeline-body"><p>I need to review the spec to see what the correct behavior is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-27 16:56</div>
            <div class="timeline-body"><p>Ah gotcha... I wonder if we can / should warn here? We could document it, at least.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 16:57</div>
            <div class="timeline-body"><p>Okay, it <em>is</em> correct to reject that per the spec:</p>
<blockquote>
<p>Every line between these two lines (# /// TYPE and # ///) MUST be a comment starting with #. If there are characters after the # then the first character MUST be a space.</p>
</blockquote>
<p>But I think we should warn if we see <code># /// script</code> but don't identify a script?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bongomachine">@bongomachine</a> on 2024-08-27 17:10</div>
            <div class="timeline-body"><blockquote>
<p>The problem is the break in the script -- try this:</p>
<pre><code class="language-python"># /// script
# requires-python = &quot;&gt;=3.12&quot;
# dependencies = [
#     &quot;cyclonedds ==0.11.0&quot;,
# ]
#
# [tool.uv]
# index-strategy = &quot;unsafe-best-match&quot;
#
# [tool.uv.sources]
# cyclonedds = { git = &quot;https://github.com/eclipse-cyclonedds/cyclonedds-python.git&quot;, rev = &quot;080dfd4b26e4c4dc2529694ef9cf9589750360c1&quot; }
#
# ///


import cyclonedds as dds

print(&quot;Hello, World!&quot;)
</code></pre>
</blockquote>
<p>That worked! Thanks!</p>
<p>FYI: The break was introduced when I first ran the following command: <code>CYCLONEDDS_HOME=~/.local uv add --script test.py git+https://github.com/eclipse-cyclonedds/cyclonedds-python.git --rev 080dfd4b26e4c4dc2529694ef9cf9589750360c1</code>. (And then I added index-strategy and explicit version while debugging).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 17:13</div>
            <div class="timeline-body"><p>Ohh nice, now <em>that</em> is a bug!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-27 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-27 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-27 17:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:35 UTC
    </footer>
</body>
</html>
