<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adding a conflict causes package to not be installed - astral-sh/uv #17017</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Adding a conflict causes package to not be installed</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17017">#17017</a>
        opened by <a href="https://github.com/meastham">@meastham</a>
        on 2025-12-06 17:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/meastham">@meastham</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi,</p>
<p>I've encountered some either buggy or surprising behavior where adding a workspace package <code>foo</code> which conflicts with another package <code>bar</code> seems to cause <code>bar</code> to not be installed when I would expect it to be.</p>
<p>I put together a small repro at https://github.com/meastham/uv-conflict-repro. All of the commands are using uv 0.9.16 on Ubuntu 20.04.</p>
<p>The setup is:</p>
<ul>
<li>Workspace member packages/foo has a dependency on numpy~=1.0</li>
<li>Workspace member packages/bar has a dependency on numpy~=2.0</li>
<li>The root member has dependency groups named foo and bar which depend on packages foo and bar respectively</li>
</ul>
<p>Using group <code>bar</code> I would expect to be able to import <code>numpy</code> 2.0, but that doesn't work:</p>
<pre><code>❯ ~/latest_uv run -v --isolated --group bar python
DEBUG uv 0.9.16
DEBUG Acquired shared lock for `/home/mike.eastham/.cache/uv`
DEBUG Found project root: `/home/mike.eastham/repro`
DEBUG Found workspace root: `/home/mike.eastham/repro`
DEBUG Adding root workspace member: `/home/mike.eastham/repro`
DEBUG Adding discovered workspace member: `/home/mike.eastham/repro/packages/foo`
DEBUG Adding discovered workspace member: `/home/mike.eastham/repro/packages/bar`
DEBUG Discovered project `repro` at: /home/mike.eastham/repro
DEBUG Creating isolated virtual environment
DEBUG Reading Python requests from version file at `/home/mike.eastham/repro/.python-version`
DEBUG Using Python request `3.13` from version file at `.python-version`
DEBUG Using request timeout of 30s
DEBUG Searching for Python 3.13 in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.13.7-linux-x86_64-gnu` at `/home/mike.eastham/repro/.venv/bin/python3` (virtual environment)
DEBUG Assessing Python executable as base candidate: /home/mike.eastham/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu/bin/python3.13
DEBUG Using base executable for virtual environment: /home/mike.eastham/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu/bin/python3.13
DEBUG Acquired exclusive lock for `/home/mike.eastham/.cache/uv/builds-v0/.tmpwylVym`
warning: Declaring conflicts for packages (`package = ...`) is experimental and may change without warning. Pass `--preview-features package-conflicts` to disable this warning.
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: bar @ file:///home/mike.eastham/repro/packages/bar
DEBUG Found workspace root: `/home/mike.eastham/repro`
DEBUG Found static `pyproject.toml` for: foo @ file:///home/mike.eastham/repro/packages/foo
DEBUG Found workspace root: `/home/mike.eastham/repro`
DEBUG Found static `pyproject.toml` for: repro @ file:///home/mike.eastham/repro
DEBUG Found workspace root: `/home/mike.eastham/repro`
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 5 packages in 0.93ms
DEBUG Using request timeout of 30s
Audited in 0.00ms
DEBUG Released lock at `/home/mike.eastham/.cache/uv/builds-v0/.tmpwylVym/.lock`
DEBUG Using Python 3.13.7 interpreter at: /home/mike.eastham/.cache/uv/builds-v0/.tmpwylVym/bin/python
DEBUG Running `python`
DEBUG Spawned child 140066 in process group 140063
Python 3.13.7 (main, Aug 28 2025, 17:07:40) [Clang 20.1.4 ] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;
</code></pre>
<p>If I comment out all references to foo and the entire conflicts section like this:</p>
<pre><code>[project]
name = &quot;repro&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = []

[tool.uv.workspace]
members = [
#     &quot;packages/foo&quot;,
    &quot;packages/bar&quot;,
]

[tool.uv.sources]
# foo = { workspace = true }
bar = { workspace = true }

[dependency-groups]
bar = [
    &quot;bar&quot;,
]
# foo = [
#     &quot;foo&quot;,
# ]

# [tool.uv]
# conflicts = [
#   [
#     { package = &quot;foo&quot; },
#     { package = &quot;bar&quot; },
#   ],
# ]
</code></pre>
<p>Then I can import numpy as expected:</p>
<pre><code>❯ ~/latest_uv run -v --isolated --group bar python
DEBUG uv 0.9.16
DEBUG Acquired shared lock for `/home/mike.eastham/.cache/uv`
DEBUG Found project root: `/home/mike.eastham/repro`
DEBUG Found workspace root: `/home/mike.eastham/repro`
DEBUG Adding root workspace member: `/home/mike.eastham/repro`
DEBUG Adding discovered workspace member: `/home/mike.eastham/repro/packages/bar`
DEBUG Discovered project `repro` at: /home/mike.eastham/repro
DEBUG Creating isolated virtual environment
DEBUG Reading Python requests from version file at `/home/mike.eastham/repro/.python-version`
DEBUG Using Python request `3.13` from version file at `.python-version`
DEBUG Using request timeout of 30s
DEBUG Searching for Python 3.13 in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.13.7-linux-x86_64-gnu` at `/home/mike.eastham/repro/.venv/bin/python3` (virtual environment)
DEBUG Assessing Python executable as base candidate: /home/mike.eastham/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu/bin/python3.13
DEBUG Using base executable for virtual environment: /home/mike.eastham/.local/share/uv/python/cpython-3.13.7-linux-x86_64-gnu/bin/python3.13
DEBUG Acquired exclusive lock for `/home/mike.eastham/.cache/uv/builds-v0/.tmpiQR2QD`
DEBUG Using request timeout of 30s
DEBUG Resolving despite existing lockfile due to change in conflicting groups: `Conflicts([])` vs. `Conflicts([ConflictSet { set: {ConflictItem { package: PackageName(&quot;bar&quot;), kind: Project }, ConflictItem { package: PackageName(&quot;foo&quot;), kind: Project }} }])`
DEBUG Found static `pyproject.toml` for: bar @ file:///home/mike.eastham/repro/packages/bar
DEBUG Found static `pyproject.toml` for: repro @ file:///home/mike.eastham/repro
DEBUG Found workspace root: `/home/mike.eastham/repro`
DEBUG Found workspace root: `/home/mike.eastham/repro`
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: &gt;=3.13
DEBUG Adding direct dependency: bar*
DEBUG Adding direct dependency: repro*
DEBUG Adding direct dependency: repro:bar*
DEBUG Searching for a compatible version of bar @ file:///home/mike.eastham/repro/packages/bar (*)
DEBUG Adding direct dependency: numpy&gt;=2.0, &lt;3.dev0
DEBUG Searching for a compatible version of repro @ file:///home/mike.eastham/repro (*)
DEBUG Searching for a compatible version of repro @ file:///home/mike.eastham/repro (*)
DEBUG Adding direct dependency: repro:bar==0.1.0
DEBUG Searching for a compatible version of repro @ file:///home/mike.eastham/repro (==0.1.0)
DEBUG Adding direct dependency: bar*
DEBUG Found fresh response for: https://pypi.org/simple/numpy/
DEBUG Searching for a compatible version of numpy (&gt;=2.0, &lt;3.dev0)
DEBUG Selecting: numpy==2.3.5 [preference] (numpy-2.3.5-cp313-cp313-macosx_10_13_x86_64.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/db/69/9cde09f36da4b5a505341180a3f2e6fadc352fd4d2b7096ce9778db83f1a/numpy-2.3.5-cp313-cp313-macosx_10_13_x86_64.whl.metadata
DEBUG Tried 3 versions: bar 1, numpy 1, repro 1
DEBUG all marker environments resolution took 0.002s
Resolved 3 packages in 3ms
DEBUG Using request timeout of 30s
DEBUG Computed cache info: Timestamp(SystemTime { tv_sec: 1765039189, tv_nsec: 65798283 }), None, None, {}, {&quot;src&quot;: Some(Timestamp(Timestamp(SystemTime { tv_sec: 1765038884, tv_nsec: 453763794 })))}. Most recently modified: packages/bar/pyproject.toml
DEBUG Directory source requirement already cached: bar==0.1.0 (from file:///home/mike.eastham/repro/packages/bar)
DEBUG Registry requirement already cached: numpy==2.3.5
Installed 2 packages in 20ms
 + bar==0.1.0 (from file:///home/mike.eastham/repro/packages/bar)
 + numpy==2.3.5
DEBUG Released lock at `/home/mike.eastham/.cache/uv/builds-v0/.tmpiQR2QD/.lock`
DEBUG Using Python 3.13.7 interpreter at: /home/mike.eastham/.cache/uv/builds-v0/.tmpiQR2QD/bin/python
DEBUG Running `python`
DEBUG Spawned child 141923 in process group 141883
Python 3.13.7 (main, Aug 28 2025, 17:07:40) [Clang 20.1.4 ] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import numpy.version
&gt;&gt;&gt; numpy.version.version
'2.3.5'
&gt;&gt;&gt;
</code></pre>
<h3>Platform</h3>
<p>Ubuntu 20.04 amd64</p>
<h3>Version</h3>
<p>uv 0.9.16</p>
<h3>Python version</h3>
<p>Python 3.13.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @meastham on 2025-12-06 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-12-06 19:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:37 UTC
    </footer>
</body>
</html>
