<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>``uv tool upgrade`` is not considered a failed update when it doesn't replace executable files in windows. - astral-sh/uv #8528</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>``uv tool upgrade`` is not considered a failed update when it doesn't replace executable files in windows.</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8528">#8528</a>
        opened by <a href="https://github.com/FishAlchemist">@FishAlchemist</a>
        on 2024-10-24 14:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-24 14:36</div>
            <div class="timeline-body"><p><strong>version:</strong> uv 0.4.25 (97eb6ab4a 2024-10-21)
<strong>OS:</strong> Windows 11 x86-64
An upgrade should be considered a failure if it cannot be finished completely, enabling a retry.</p>
<ul>
<li>uv tool upgrade ruff
<img src="https://github.com/user-attachments/assets/766e63b3-071c-4401-b5ed-e66db238ea41" alt="image" /></li>
<li>ruff version
<img src="https://github.com/user-attachments/assets/cf0e0264-7198-47fb-999f-3716f078721c" alt="image" /></li>
<li>uv tool upgrade ruff
<img src="https://github.com/user-attachments/assets/3814e4dd-35a2-4fd8-918e-3ef08d3041ff" alt="image" /></li>
</ul>
<p>I suspect that the reason for the update failure is that I had Visual Studio Code open, which occupied the ruff executable file.</p>
<p>Edit:
This problem also occurs in uv 0.5.26 (5ef3d5139 2025-01-30).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-10-24 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2024-10-24 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">uv tool</span> added by @zanieb on 2024-10-24 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11134.html">astral-sh/uv#11134</a> on 2025-01-31 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-31 17:54</div>
            <div class="timeline-body"><p>This does return a non-zero exit code though, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-01-31 19:14</div>
            <div class="timeline-body"><p>@charliermarsh Of course, the value is non-zero.
<img src="https://github.com/user-attachments/assets/4bfb9830-4c77-4e1e-99a3-fe7a95bc3acf" alt="Image" /></p>
<p>Since my computer currently has ruff 0.9.4 installed (the latest version), if I want to reproduce it, I need to install the old version, and then delete the part that will affect the installation to the new version in the [tool.options] setting in uv-receipt.toml.</p>
<details><summary> uv tool upgrade ruff --verbose </summary>
<p>

<pre><code class="language-powershell">DEBUG uv 0.5.26 (5ef3d5139 2025-01-30)
DEBUG Acquired lock for `AppData\Roaming\uv\data\tools`
DEBUG Upgrading tool: `ruff`
DEBUG Checking for Python environment at `AppData\Roaming\uv\data\tools\ruff`
DEBUG Found existing environment for tool `ruff`: AppData\Roaming\uv\data\tools\ruff
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13
DEBUG Solving with target Python version: &gt;=3.13
DEBUG Adding direct dependency: ruff*
DEBUG Acquired lock for `C:\Users\[user_name]\AppData\Local\uv\cache\simple-v15\pypi\ruff.lock`
DEBUG Found stale response for: https://pypi.org/simple/ruff/
DEBUG Sending revalidation request for: https://pypi.org/simple/ruff/
DEBUG Found not-modified response for: https://pypi.org/simple/ruff/
DEBUG Released lock at `C:\Users\[user_name]\AppData\Local\uv\cache\simple-v15\pypi\ruff.lock`
DEBUG Searching for a compatible version of ruff (*)
DEBUG Found installed version of ruff==0.9.2 that satisfies *
DEBUG Found installed version of ruff==0.9.2 that satisfies *
DEBUG Selecting: ruff==0.9.4 [compatible] (ruff-0.9.4-py3-none-win_amd64.whl)
DEBUG Acquired lock for `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/12/41/2d2d2c6a72e62566f730e49254f602dfed23019c33b5b21ea8f8917315a1/ruff-0.9.4-py3-none-win_amd64.whl.metadata
DEBUG Released lock at `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Tried 1 versions: ruff 1
DEBUG marker environment resolution took 0.238s
DEBUG Requirement installed, but mismatched:
  Installed: Registry(InstalledRegistryDist { name: PackageName(&quot;ruff&quot;), version: &quot;0.9.2&quot;, path: &quot;C:\\Users\\[user_name]\\AppData\\Roaming\\uv\\data\\tools\\ruff\\Lib\\site-packages\\ruff-0.9.2.dist-info&quot;, cache_info: None })
  Requested: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: &quot;0.9.4&quot; }]), index: Some(Url { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;pypi.org&quot;)), port: None, path: &quot;/simple&quot;, query: None, fragment: None }), conflict: None }
DEBUG Must revalidate requirement: ruff
DEBUG Acquired lock for `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/12/41/2d2d2c6a72e62566f730e49254f602dfed23019c33b5b21ea8f8917315a1/ruff-0.9.4-py3-none-win_amd64.whl
DEBUG Released lock at `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Uninstalled ruff (9 files, 3 directories)
Updated ruff v0.9.2 -&gt; v0.9.4
 - ruff==0.9.2
 + ruff==0.9.4
DEBUG Removing executable: `C:/Users/[user_name]/.local/bin/ruff.exe`
WARN Failed to remove executable: `C:/Users/[user_name]/.local/bin/ruff.exe`: failed to remove file `C:/Users/[user_name]/.local/bin/ruff.exe`:  Access is denied. (os error 5)
DEBUG Installing tool executables into: .local\bin
DEBUG Looking at `.dist-info` at: AppData\Roaming\uv\data\tools\ruff\Lib\site-packages\ruff-0.9.4.dist-info
DEBUG Installing executable: `ruff.exe`
error: Failed to upgrade ruff
  Caused by: Failed to install entrypoint
  Caused by: failed to copy file from C:\Users\[user_name]\AppData\Roaming\uv\data\tools\ruff\Scripts\ruff.exe to C:\Users\[user_name]\.local\bin\ruff.exe: The process cannot access the file because it is being used by another process. (os error 32)
DEBUG Released lock at `C:\Users\[user_name]\AppData\Roaming\uv\data\tools\.lock`
</code></pre>
</p>
</details> 

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-06-16 09:15</div>
            <div class="timeline-body"><p>This issue is a bit old, so I'll go ahead and close it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @FishAlchemist on 2025-06-16 09:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14520.html">astral-sh/uv#14520</a> on 2025-07-09 14:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
