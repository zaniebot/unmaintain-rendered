<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resolution problem with pyproject.toml tool.uv.index for torch / torchcodec / torchvision - astral-sh/uv #16685</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Resolution problem with pyproject.toml tool.uv.index for torch / torchcodec / torchvision</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16685">#16685</a>
        opened by <a href="https://github.com/mscheltienne">@mscheltienne</a>
        on 2025-11-11 11:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mscheltienne">@mscheltienne</a></div>
            <div class="timeline-body">Summary
<p>With this minimal <code>pyproject.toml</code>:</p>
<pre><code>[project]
dependencies = []
description = &#x27;Test torch index.&#x27;
name = &#x27;test&#x27;
readme = &#x27;README.md&#x27;
requires-python = &#x27;&gt;=3.12&#x27;
version = &#x27;0.1.0&#x27;

[project.optional-dependencies]
cpu = [&#x27;torch&#x27;, &#x27;torchcodec&#x27;, &#x27;torchvision&#x27;]
cu128 = [&#x27;torch&#x27;, &#x27;torchcodec&#x27;, &#x27;torchvision&#x27;]

[tool.uv]
conflicts = [[{extra = &#x27;cpu&#x27;}, {extra = &#x27;cu128&#x27;}]]

[[tool.uv.index]]
explicit = true
name = &#x27;torch-cpu&#x27;
url = &#x27;https://download.pytorch.org/whl/cpu&#x27;

[[tool.uv.index]]
explicit = true
name = &#x27;torch-cu128&#x27;
url = &#x27;https://download.pytorch.org/whl/cu128&#x27;

[tool.uv.sources]
torch = [
  {extra = &#x27;cpu&#x27;, index = &#x27;torch-cpu&#x27;},
  {extra = &#x27;cu128&#x27;, index = &#x27;torch-cu128&#x27;},
]
torchcodec = [
  {extra = &#x27;cpu&#x27;, index = &#x27;torch-cpu&#x27;},
  {extra = &#x27;cu128&#x27;, index = &#x27;torch-cu128&#x27;},
]
torchvision = [
  {extra = &#x27;cpu&#x27;, index = &#x27;torch-cpu&#x27;},
  {extra = &#x27;cu128&#x27;, index = &#x27;torch-cu128&#x27;},
]
</code></pre>
<p>The command <code>uv sync --extra cpu</code> fails with:</p>
<pre><code>error: Distribution `torchvision==0.24.0 @ registry+https://download.pytorch.org/whl/cpu` can&#x27;t be installed because it doesn&#x27;t have a source distribution or wheel for the current platform

hint: You&#x27;re on Linux (`manylinux_2_42_x86_64`), but `torchvision` (v0.24.0) only has wheels for the following platforms: `manylinux_2_28_aarch64`, `macosx_11_0_arm64`; consider adding &quot;sys_platform == &#x27;linux&#x27; and platform_machine == &#x27;x86_64&#x27;&quot; to `tool.uv.required-environments` to ensure uv resolves to a version with compatible wheels
</code></pre>
<p>While running a manual venv and install of the packages works:</p>
<pre><code>‚ùØ uv venv --python 3.12
Using CPython 3.12.12 interpreter at: /usr/bin/python3.12
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
~/Downloads/test is üì¶ v0.1.0 via üêç v3.14.0 on ‚òÅÔ∏è  dandelion-admin (us-east-1) 
‚ùØ uv pip install torch torchcodec torchvision --index-url https://download.pytorch.org/whl/cpu
Resolved 14 packages in 1.29s
Prepared 3 packages in 270ms
Installed 14 packages in 386ms
 + filelock==3.19.1
 + fsspec==2025.9.0
 + jinja2==3.1.6
 + markupsafe==2.1.5
 + mpmath==1.3.0
 + networkx==3.5
 + numpy==2.3.3
 + pillow==11.3.0
 + setuptools==70.2.0
 + sympy==1.14.0
 + torch==2.9.0+cpu
 + torchcodec==0.8.1
 + torchvision==0.24.0+cpu
 + typing-extensions==4.15.0
</code></pre>
Platform
<p>Fedora 43</p>
Version
<p>uv 0.9.8</p>
Python version
<p>Python 3.13.9 or Python 3.12.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/mscheltienne">@mscheltienne</a> on 2025-11-11 11:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mscheltienne">@mscheltienne</a> on 2025-11-11 11:36</div>
            <div class="timeline-body"><p>Note that a compatible wheel does exist on the index: <a href="https://download.pytorch.org/whl/cpu/torchvision-0.24.0%2Bcpu-cp312-cp312-manylinux_2_28_x86_64.whl">https://download.pytorch.org/whl/cpu/torchvision-0.24.0%2Bcpu-cp312-cp312-manylinux_2_28_x86_64.whl</a></p>
<pre><code>‚ùØ uv pip show torchvision
Name: torchvision
Version: 0.24.0+cpu
Location: /home/mscheltienne/Downloads/test/.venv/lib/python3.12/site-packages
Requires: numpy, pillow, torch
Required-by:
</code></pre>
<p>Wheel details:</p>
<pre><code>  - Package: torchvision==0.24.0+cpu
  - Python version: 3.12 (cp312)
  - Platform: Linux x86_64
  - Glibc: manylinux_2_28 (compatible with my manylinux_2_42 system)
  - SHA256: baa37f80155a3b055911d5c2418be1e16b95bb69f671dbb0d07d67504093e23d
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lagamura">@lagamura</a> on 2025-11-16 19:39</div>
            <div class="timeline-body"><p>Faced something similar, and used the following workaround:</p>
<pre><code>[tool.uv]
required-environments = [&quot;sys_platform == &#x27;linux&#x27; and platform_machine == &#x27;x86_64&#x27;&quot;]
</code></pre>
<p>You can require multiple pairs of <code>sys_platform</code> and <code>platform_machine</code> architecture, if you want to higher the minimum supported scenarios. e.g.</p>
<pre><code>[tool.uv]
required-environments = [
    &quot;((sys_platform == &#x27;linux&#x27; and platform_machine == &#x27;x86_64&#x27;) or (sys_platform == &#x27;darwin&#x27;) or (sys_platform == &#x27;win32&#x27;))&quot;
]
</code></pre>
<p>docs ref for required_environments: https://docs.astral.sh/uv/concepts/resolution/#required-environments</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-28 14:39</div>
            <div class="timeline-body"><p>I believe this is ultimately due to <a href="https://github.com/pytorch/vision/issues/9249">pytorch/vision#9249</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-28 14:39</div>
            <div class="timeline-body"><p>In short, there&#x27;s inconsistency around the use of the <code>+cpu</code> specifier for that package and version, which is confusing the uv resolver.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-11-28 15:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:59 UTC
    </footer>
</body>
</html>
