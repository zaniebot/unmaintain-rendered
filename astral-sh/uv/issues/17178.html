<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No environment marker specific to Termux - astral-sh/uv #17178</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>No environment marker specific to Termux</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/17178">#17178</a>
        opened by <a href="https://github.com/City-of-Memphis-Wastewater">@City-of-Memphis-Wastewater</a>
        on 2025-12-18 16:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/City-of-Memphis-Wastewater">@City-of-Memphis-Wastewater</a> on 2025-12-18 16:32</div>
            <div class="timeline-body"><h1>Update:</h1>
<p>The text below has not been changed from the original issue submission.</p>
<p>The original issue version is erroneous because it makes incorrect statements about which markers are valid by PEP 508.</p>
<h2>Title change:</h2>
<p>The title has been changed for accuracy.</p>
<p>Original title: <code>uv</code> rejects valid PEP 508 markers needed for cross‑platform dependency management (Android/Termux, ARM Linux, libc detection)</p>
<p>New title: <code>uv</code> rejects all hypothetical (non-PEP 508) markers needed for cross‑platform dependency management (Android/Termux, ARM Linux, libc detection)</p>
<h2>LLM notice:</h2>
<p>The original issue text was partially generated by an LLM, which is not appropriate for this repository.</p>
<h2>The Central Question:</h2>
<p>In my pyproject.toml file, when using uv, how can i make a dev dependency explicitly avoided for Termux? I can avoid the dependency for all of Linux, but this is too broad.</p>
<hr />
<h1>Original Text:</h1>
<h1><strong>Summary</strong></h1>
<p><code>uv</code> currently rejects several valid PEP 508 environment markers that are essential for building truly cross‑platform Python packages. This makes it impossible to express platform‑specific dependencies for environments such as Android/Termux, ARM Linux, and systems using non‑glibc libcs.</p>
<p>This is not about a single dependency (e.g., Ruff). My packages support Windows, macOS, Linux (x86_64 and ARM), and Android/Termux, and require platform‑specific dependency pinning. Today, <code>uv</code> cannot represent the logic needed for that support.</p>
<hr />
<h1><strong>What I expected</strong></h1>
<p>That <code>uv</code> would accept and correctly evaluate valid PEP 508 markers, including:</p>
<ul>
<li><code>not (...)</code></li>
<li>parentheses for grouping</li>
<li><code>in [...]</code> lists</li>
<li><code>platform_libc</code></li>
<li>compound boolean expressions</li>
<li>table‑style dependency declarations with <code>markers = &quot;...&quot;</code></li>
</ul>
<p>These are accepted by <code>pip</code>, <code>setuptools</code>, <code>hatchling</code>, and other PEP 517/518‑compliant tools.</p>
<hr />
<h1><strong>What actually happens</strong></h1>
<p><code>uv</code> rejects valid PEP 508 markers with parse errors. Examples:</p>
<h3>1. <code>not</code> and parentheses</h3>
<pre><code>ruff&gt;=0.7.0 ; not (platform_system == 'Linux' and platform_machine == 'aarch64')
</code></pre>
<p>Error:</p>
<pre><code>Expected a quoted string or a valid marker name, found `not`
</code></pre>
<h3>2. <code>in [...]</code> lists</h3>
<pre><code>ruff&gt;=0.7.0 ; platform_machine not in ['aarch64', 'armv7l']
</code></pre>
<p>Error:</p>
<pre><code>Expected a quoted string or a valid marker name, found `['aarch64',`
</code></pre>
<h3>3. <code>platform_libc</code></h3>
<pre><code>ruff&gt;=0.7.0 ; platform_libc != 'bionic'
</code></pre>
<p>Error:</p>
<pre><code>Expected a quoted string or a valid marker name, found `platform_libc`
</code></pre>
<h3>4. Table‑style dependency with markers</h3>
<pre><code>ruff = { version = &quot;^0.7.0&quot;, markers = &quot;sys_platform != 'android'&quot; }
</code></pre>
<p>Error:</p>
<pre><code>Expected a quoted string or a valid marker name
</code></pre>
<p>This is valid TOML and valid PEP 508, but <code>uv</code> does not allow tables inside dependency groups.</p>
<hr />
<h1><strong>Why this matters</strong></h1>
<p>Android/Termux reports:</p>
<pre><code>sys_platform = &quot;linux&quot;
platform_system = &quot;Linux&quot;
platform_machine = &quot;aarch64&quot;
</code></pre>
<p>This is identical to many ARM Linux systems (Raspberry Pi, Ubuntu ARM, Alpine ARM, etc.).</p>
<p>The only reliable discriminator is:</p>
<ul>
<li><code>platform_libc == &quot;bionic&quot;</code> (Android)</li>
<li><code>platform_libc == &quot;glibc&quot;</code> or <code>&quot;musl&quot;</code> (Linux)</li>
</ul>
<p>But <code>uv</code> does not support <code>platform_libc</code>.</p>
<p>Because <code>uv</code> also does not support:</p>
<ul>
<li><code>not</code></li>
<li>parentheses</li>
<li><code>in</code> lists</li>
<li>table‑style dependency declarations</li>
</ul>
<p>…it becomes <strong>impossible</strong> to express any marker that excludes Android while allowing ARM Linux, or vice‑versa.</p>
<p>This breaks cross‑platform packaging for any project that needs platform‑specific dependencies.</p>
<hr />
<h1><strong>All attempted markers that failed</strong></h1>
<p>Below is the full list of platform‑specific dependency attempts that <code>uv</code> rejected. All of these are valid PEP 508 and work in pip, hatch, and setuptools:</p>
<pre><code>[dependency-groups]
dev = [
    &quot;build&gt;=1.3.0&quot;,
    &quot;pyinstaller&gt;=6.17.0&quot;,
    &quot;shiv&gt;=1.0.8&quot;,

    # Table-style dependency (valid TOML + valid PEP 508)
    #ruff = {version = &quot;^0.7.0&quot;, markers = &quot;sys_platform != 'android'&quot;},

    # Simple marker (Termux reports sys_platform=&quot;linux&quot;, so this is always true)
    #&quot;ruff&gt;=0.7.0 ; sys_platform != 'android'&quot;,

    # libc-based detection (Android uses bionic)
    #&quot;ruff&gt;=0.7.0 ; platform_libc != 'bionic'&quot;,

    # Compound boolean expression
    #&quot;ruff&gt;=0.7.0 ; not (platform_system == 'Linux' and platform_machine in ['aarch64', 'armv7l', 'armv8l'] and platform_libc == 'bionic')&quot;,

    # List membership
    #&quot;ruff&gt;=0.7.0 ; platform_machine not in ['aarch64', 'armv7l', 'armv8l']&quot;,

    &quot;pytest&gt;=8.0.0&quot;,
    &quot;pytest-cov&gt;=4.1.0&quot;,
]
</code></pre>
<p>None of these parse under <code>uv</code>.</p>
<hr />
<h1><strong>Real‑world impact</strong></h1>
<p>My project needs to:</p>
<ul>
<li>include certain dependencies only on Windows</li>
<li>exclude certain dependencies on Termux</li>
<li>include optimized wheels on ARM Linux</li>
<li>avoid building heavy packages on Android</li>
<li>support optional extras that vary by platform</li>
</ul>
<p>All of this is straightforward with PEP 508 markers in other tools.<br />
With <code>uv</code>, it is currently impossible.</p>
<hr />
<h1><strong>What would solve this</strong></h1>
<p>Implementing full PEP 508 marker support, including:</p>
<ul>
<li><code>not</code></li>
<li>parentheses</li>
<li><code>in</code> lists</li>
<li><code>platform_libc</code></li>
<li>compound boolean expressions</li>
<li>table‑style dependency entries with <code>markers = &quot;...&quot;</code></li>
</ul>
<p>This would bring <code>uv</code> in line with the rest of the Python packaging ecosystem and make it viable for serious cross‑platform packaging.</p>
<hr />
<h1><strong>Minimal reproducible example</strong></h1>
<pre><code class="language-toml">[dependency-groups]
dev = [
    &quot;ruff&gt;=0.7.0 ; platform_libc != 'bionic'&quot;,
]
</code></pre>
<p>Command:</p>
<pre><code>uv sync
</code></pre>
<p>Result:</p>
<pre><code>error: Expected a quoted string or a valid marker name, found `platform_libc`
</code></pre>
<p>This is valid PEP 508 and works in pip, hatch, and setuptools.</p>
<hr />
<h1><strong>Environment</strong></h1>
<ul>
<li>uv version: latest</li>
<li>OS: Linux (Termux), Linux (x86_64), macOS</li>
<li>Python: 3.10–3.13</li>
</ul>
<hr />
<h1><strong>Closing</strong></h1>
<p><code>uv</code> is extremely fast and promising, but without full PEP 508 marker support, it cannot be used for serious cross‑platform packaging. Android/Termux support is increasingly important in the Python ecosystem, and the current limitations make it impossible to target that platform correctly.</p>
<p>I’m happy to provide additional examples or test cases if needed.</p>
<h3>Example</h3>
<p>With full PEP 508 marker support, users could write:</p>
<pre><code class="language-toml">[dependency-groups]
dev = [
    &quot;ruff&gt;=0.7.0 ; platform_libc != 'bionic'&quot;,
]
</code></pre>
<p>On Termux:</p>
<pre><code>$ uv sync
# Ruff skipped automatically
</code></pre>
<p>On Linux ARM:</p>
<pre><code>$ uv sync
# Ruff installs normally (glibc/musl)
</code></pre>
<p>On macOS/Windows:</p>
<pre><code>$ uv sync
# Full dev toolchain installs
</code></pre>
<p>No workarounds, no manual installs, no platform‑specific scripts — just a single <code>pyproject.toml</code> that behaves correctly everywhere.</p>
<ul>
<li></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @City-of-Memphis-Wastewater on 2025-12-18 16:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 16:43</div>
            <div class="timeline-body"><p>Please do not use LLMs to generate issues: These are not valid PEP 508 markers, and the issue doesn't include the problem you're actually trying to solve.</p>
<p>If you're having a problem with termux, please describe the problem you're trying to solve in your own words. There are other users on termux (https://github.com/astral-sh/uv/issues?q=is%3Aissue%20termux), and we may be able to find you a solution with PEP 508 markers that works for you, e.g. to exclude a specific package that's not available on the platform.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @konstin on 2025-12-18 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-12-18 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv` rejects valid PEP 508 markers needed for cross‑platform dependency management (Android/Termux, ARM Linux, libc detection)" to "`uv` rejects all hypothetical (non-PEP 508) markers needed for cross‑platform dependency management (Android/Termux, ARM Linux, libc detection)" by @City-of-Memphis-Wastewater on 2025-12-18 17:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/City-of-Memphis-Wastewater">@City-of-Memphis-Wastewater</a> on 2025-12-18 17:50</div>
            <div class="timeline-body"><p>@konstin, thank you for the response.</p>
<p>My specific problem:
In my pyproject.toml file, when using uv, how can i make a dev dependency explicitly avoided for Termux? I can avoid the dependency for all of Linux, but this is too broad.</p>
<p>I am sure I am not the first person to run into this. I will comtinue to look for existing information and add URL's in the comments below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/City-of-Memphis-Wastewater">@City-of-Memphis-Wastewater</a> on 2025-12-18 18:10</div>
            <div class="timeline-body"><p>The package in question is ruff, which doesn't build from source on Termux when using  <code>uv sync</code>.  I think this is because Termux uses the bionic libc ABI, which is outside the scope of ruff handling.</p>
<p>I can install the Ruff package manager on Termux using <code>pkg install ruff</code> - Thank you, Termux maintainers.</p>
<p>I need to avoid building ruff on Termux during dependency resoluton.</p>
<p>Improving ruff and allowing it to build on Termux would be great, but is a separate issue; granular platform-based dependency resolution would be nice when using uv.</p>
<p>This could be a vanilla Python issue moreso than a uv issue, in terms of which markers are included generically. I understand that uv aims to not introduce the type of special handling we see in poetry and hatch.</p>
<p>I know that Termux has not been prioritized by  <code>astral</code> , but it would be really great for the community and would allow packages to run locally on the most possible devices if we could build cleanly for Android. It is a key goal of my organization to make all of our software available on Termux, via ELF, PYZ, and source code. Our work is municipal-government-facing, and we believe that allowing our work to run on common, cheap, local devices can help our open-source work do the most good.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/City-of-Memphis-Wastewater">@City-of-Memphis-Wastewater</a> on 2025-12-18 18:42</div>
            <div class="timeline-body"><p>Current solution for avoiding a dependency on Termux:
&quot;ruff&gt;=0.7.0 ; platform_machine != 'aarch64'&quot;</p>
<p>While this is broad, and will avoid Raspberry Pi, Ubuntu ARM servers, Alpine ARM servers, etc, it does work for my use case, because Termux is my only expected ARM environment. I was hoping to move my Docker flow to an Alpine server (would need to check if it's ARM) but otherwise this works.</p>
<p>Termux env info, relevant to PEP 508, for posterity:
sys_platform: linux
platform_system: Linux
platform_machine: aarch64
python_version: 3.12.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv` rejects all hypothetical (non-PEP 508) markers needed for cross‑platform dependency management (Android/Termux, ARM Linux, libc detection)" to "No environment marker specific to Termux" by @konstin on 2026-01-07 10:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-07 10:48</div>
            <div class="timeline-body"><p>I checked termux and couldn't find an environment marker specific to it either. This is a gap that uv can't fill: uv is bound to PEP 508, so we need to either extend PEP 508, or termux needs to change the values it sets for its environment markers. It might be worth talking to the termux maintainers about this, they may have better ideas.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @konstin on 2026-01-07 10:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
