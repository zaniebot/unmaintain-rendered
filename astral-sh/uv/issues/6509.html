<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModuleNotFoundError: No module named 'distutils' - astral-sh/uv #6509</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ModuleNotFoundError: No module named &#x27;distutils&#x27;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6509">#6509</a>
        opened by <a href="https://github.com/kdheepak">@kdheepak</a>
        on 2024-08-23 12:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kdheepak">@kdheepak</a></div>
            <div class="timeline-body"><p>When I run <code>uv add numpy</code> (after adding some other dependencies successfully), I get an &quot;No module named &#x27;distutils&#x27;&quot; error. I&#x27;ve just installed <code>uv</code> and ran <code>uv install python 3.12</code> and tried to create a new project with it.</p>
<p>I&#x27;m using the following platform:</p>
<pre><code>Platform Info:
  OS: macOS (arm64-apple-darwin22.4.0)
  CPU: 12 Ã— Apple M3 Pro
  WORD_SIZE: 64
</code></pre>
<p>Here&#x27;s my <code>uv --version</code>:</p>
<pre><code>$ uv --version
uv 0.3.2 (c5440001c 2024-08-23)
</code></pre>
<p>Here&#x27;s the error I&#x27;m getting:</p>
<pre><code>Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
  File &quot;/Users/USERNAME/.cache/uv/builds-v0/.tmpvWutaJ/lib/python3.12/site-packages/setuptools/__init__.py&quot;, line 10, in &lt;module&gt;
    import distutils.core
ModuleNotFoundError: No module named &#x27;distutils&#x27;
</code></pre>
<p>Here&#x27;s the detailed log output with <code>uv add numpy --verbose</code>:</p>
<p>https://gist.github.com/kdheepak/88fd62563e7457c0d9d17180ad907c42</p>
<p>Weirdly, <code>numpy</code> gets added to <code>pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;test-uv-prototype&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;jupyter&gt;=1.0.0&quot;,
    &quot;geopandas&gt;=1.0.1&quot;,
    &quot;hplot&quot;,
    &quot;hvplot&gt;=0.10.0&quot;,
    &quot;numpy&gt;=1.25.0&quot;,
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">projects</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 13:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 13:32</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<pre><code>DEBUG Downloading and building requirement for build: numpy==1.26.2
DEBUG No cache entry for: https://files.pythonhosted.org/packages/2a/17/1fdc154e75d24d8c20c42b71bae1b5cf752453f0fc3a2504bbb810293dd1/numpy-1.26.2-cp312-cp312-macosx_11_0_arm64.whl
DEBUG Calling `hatchling.build.get_requires_for_build_editable()`
DEBUG Calling `setuptools.build_meta:__legacy__.get_requires_for_build_wheel()`
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: numpy==1.25.0
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
  File &quot;/Users/USERNAME/.cache/uv/builds-v0/.tmpvWutaJ/lib/python3.12/site-packages/setuptools/__init__.py&quot;, line 10, in &lt;module&gt;
    import distutils.core
ModuleNotFoundError: No module named &#x27;distutils&#x27;
---
</code></pre>
<p>It&#x27;s failing to read <code>numpy</code>&#x27;s metadata here. Basically the problem is that the resolver is searching for a version of numpy compatible with your other dependencies. To do this, it needs to check the requirements of each numpy version. However, it went back to a <em>really</em> old numpy version which requires setuptools which requires distutils which isn&#x27;t provided on Python 3.12 anymore. So, in short, do <code>uv add numpy&gt;VERSION</code> where <code>VERSION</code> is some reasonable bound on the version you&#x27;re looking for. The resolver will then try more versions of other packages and either succeed, or fail with an error about why the dependencies are incompatible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">projects</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kdheepak">@kdheepak</a> on 2024-08-23 14:26</div>
            <div class="timeline-body"><p>I don&#x27;t quite understand why it picked an old version of numpy to begin with.</p>
<p>Also, I deleted the <code>uv.lock</code> file, removed <code>numpy&gt;=1.25.0</code> from the pyproject.toml (I&#x27;m not quite sure how it got in there to begin with, shouldn&#x27;t the <code>ModuleNotFoundError</code> have prevented it from being added to pyproject.toml?) and reran <code>uv add numpy</code> and it added numpy 2.1.0 now and I&#x27;m no longer getting this error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kdheepak">@kdheepak</a> on 2024-08-23 14:27</div>
            <div class="timeline-body"><p>I&#x27;m closing this issue because I&#x27;m no longer getting this error, but I&#x27;m not confident I know what happened here and how to reproduce it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/kdheepak">@kdheepak</a> on 2024-08-23 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kdheepak">@kdheepak</a> on 2024-08-23 14:28</div>
            <div class="timeline-body"><p>Thanks for the swift response!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:33:09 UTC
    </footer>
</body>
</html>
