<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[bug] Can't build Rust extensions via `pyo3` if using a `uv`-managed Python interpreter - astral-sh/uv #10598</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[bug] Can&#x27;t build Rust extensions via <code>pyo3</code> if using a <code>uv</code>-managed Python interpreter</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10598">#10598</a>
        opened by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a>
        on 2025-01-14 14:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/LukeMathWalker">@LukeMathWalker</a></div>
            <div class="timeline-body"><p>When building the extension, the following error occurs (omitting the prefixes of some paths):</p>
<pre><code>dyld[90807]: Library not loaded: /install/lib/libpython3.13.dylib
  Referenced from: &lt;A73153CF-70A5-379B-B9D3-526153D8322F&gt; repro/target/debug/deps/setup-29f3c899bfb488ef
  Reason: tried: &#x27;/install/lib/libpython3.13.dylib&#x27; (no such file), &#x27;repro/target/debug/deps/libpython3.13.dylib&#x27; (no such file), &#x27;repro/target/debug/libpython3.13.dylib&#x27; (no such file), &#x27;.rustup/toolchains/stable-aarch64-
apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libpython3.13.dylib&#x27; (no such file), &#x27;.rustup/toolchains/stable-aarch64-apple-darwin/lib/libpython3.13.dylib&#x27; (no such file), &#x27;/Users/luca/lib/libpyt
hon3.13.dylib&#x27; (no such file), &#x27;/usr/local/lib/libpython3.13.dylib&#x27; (no such file), &#x27;/usr/lib/libpython3.13.dylib&#x27; (no such file, not in dyld cache)
error: test failed, to rerun pass `--lib
</code></pre>
<p>This is on macOS, using the latest Rust toolchain and <code>uv</code> build. I uploaded a <a href="https://github.com/LukeMathWalker/uv-repro-install-lib">reproduction repository</a> to help with the investigation.</p>
<p>I originally suspected this to be an issue with <code>sysconfig</code>, but it appears to be configured correctly:</p>
<p><img alt="Image" src="https://github.com/user-attachments/assets/e79936ec-d22d-4775-8be3-d9b6761d6884"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-14 14:20</div>
            <div class="timeline-body"><p>Just to confirm: have you tried reinstalling Python (like <code>uv python install 3.13 --reinstall</code>)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 14:20</div>
            <div class="timeline-body"><p>This came up while following up on <a href="https://github.com/mainmatter/rust-python-interoperability/issues/12">a user report</a> after we ported our Rust-Python interoperability workshop from <code>rye</code> to <code>uv</code> (and for <code>rye</code> we were indeed patching <code>sysconfig</code> for a similar problem).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 14:21</div>
            <div class="timeline-body"><blockquote>
<p>Just to confirm: have you tried reinstalling Python (like <code>uv python install 3.13 --reinstall</code>)?</p>
</blockquote>
<p>I had not!
But it doesn&#x27;t seem to change the outcome (reinstall =&gt; <code>uv clean</code> =&gt; same steps =&gt; error).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-14 14:30</div>
            <div class="timeline-body"><p>@zanieb -- Any idea where this reference is?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 14:35</div>
            <div class="timeline-body"><p>If it helps, this is the configuration outputted by <code>pyo3-build-config</code> via <code>PYO3_PYTHON=&quot;${PWD}/.venv/bin/python3&quot; PYO3_PRINT_CONFIG=1 cargo t</code>:</p>
<pre><code>implementation=CPython
version=3.13
shared=true
abi3=false
lib_name=python3.13
lib_dir=/Users/luca/.local/share/uv/python/cpython-3.13.1-macos-aarch64-none/lib
executable=/Users/luca/code/scratch/repro/.venv/bin/python3
pointer_width=64
build_flags=
python_framework_prefix=
suppress_build_script_link_lines=false
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 14:36</div>
            <div class="timeline-body"><p>I don&#x27;t spot any smoking gun there since <code>lib_dir</code> is indeed pointing to the right place.
It somehow feels like the issue is the lack of that <code>lib_dir</code> in the list of paths to be searched for when looking for the <code>dylib</code> at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 14:55</div>
            <div class="timeline-body"><p>Well, it turns out that it is added to that list.
Setting <code>-vvv</code> on <code>cargo build</code>, we get the following output from <code>pyo3-ffi</code>:</p>
<pre><code>[pyo3-ffi 0.23.4] cargo:rustc-link-search=native=/Users/luca/.local/share/uv/python/cpython-3.13.1-macos-aarch64-none/lib
</code></pre>
<p>which then shows up correctly as an <code>-L</code> option in the invocation of <code>rustc</code> to compile the final binary:</p>
<pre><code> -L native=/Users/luca/.local/share/uv/python/cpython-3.13.1-macos-aarch64-none/lib`
</code></pre>
<p>but <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#dynamic-library-paths">Cargo&#x27;s documentations</a> states that:</p>
<blockquote>
<p>Search paths included from any build script with the <a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html#rustc-link-search">rustc-link-search instruction</a>. Paths outside of the target directory are removed. It is the responsibility of the user running Cargo to properly set the environment if additional libraries on the system are needed in the search path.</p>
</blockquote>
<p>So I do wonder if that&#x27;s the root cause here?
Namely, <em>something</em> must copy the <code>dylib</code> into the <code>target</code> directory (or a directory on macOS&#x27;s fallback list for dynamic library lookups) otherwise the binary won&#x27;t work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 15:20</div>
            <div class="timeline-body"><p>Interesting.</p>
<p>I wonder where the <code>/install/lib/libpython3.13.dylib</code> path is coming from?</p>
<p>The <code>rustc-link-search</code> caveat seems worth pursing. I tried using the <code>target</code> directory though ‚Äî no dice. Maybe it needs to be in a specific spot?</p>
<pre><code>‚ùØ uv python install --install-dir ./target/python 3.12
Installed Python 3.12.8 in 1.45s
 + cpython-3.12.8-macos-aarch64-none
‚ùØ PYO3_PYTHON=&quot;${PWD}/target/python/cpython-3.12.8-macos-aarch64-none/bin/python cargo t
   Compiling pyo3-build-config v0.23.4
   Compiling pyo3-macros-backend v0.23.4
   Compiling pyo3-ffi v0.23.4
   Compiling pyo3 v0.23.4
   Compiling pyo3-macros v0.23.4
   Compiling setup v0.1.0 (/Users/zb/workspace/uv-repro-install-lib)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 2.72s
     Running unittests src/lib.rs (target/debug/deps/setup-29f3c899bfb488ef)
dyld[37377]: Library not loaded: /install/lib/libpython3.12.dylib
  Referenced from: &lt;594B5A77-99FB-3942-8F15-0A487FE66DDF&gt; /Users/zb/workspace/uv-repro-install-lib/target/debug/deps/setup-29f3c899bfb488ef
  Reason: tried: &#x27;/install/lib/libpython3.12.dylib&#x27; (no such file), &#x27;/System/Volumes/Preboot/Cryptexes/OS/install/lib/libpython3.12.dylib&#x27; (no such file), &#x27;/install/lib/libpython3.12.dylib&#x27; (no such file), &#x27;/Users/zb/workspace/uv-repro-install-lib/target/debug/deps/libpython3.12.dylib&#x27; (no such file), &#x27;/Users/zb/workspace/uv-repro-install-lib/target/debug/libpython3.12.dylib&#x27; (no such file), &#x27;/Users/zb/.rustup/toolchains/stable-aarch64-apple-darwin/lib/rustlib/aarch64-apple-darwin/lib/libpython3.12.dylib&#x27; (no such file), &#x27;/Users/zb/.rustup/toolchains/stable-aarch64-apple-darwin/lib/libpython3.12.dylib&#x27; (no such file), &#x27;/Users/zb/lib/libpython3.12.dylib&#x27; (no such file), &#x27;/usr/local/lib/libpython3.12.dylib&#x27; (no such file), &#x27;/usr/lib/libpython3.12.dylib&#x27; (no such file, not in dyld cache)
error: test failed, to rerun pass `--lib`

Caused by:
  process didn&#x27;t exit successfully: `/Users/zb/workspace/uv-repro-install-lib/target/debug/deps/setup-29f3c899bfb488ef` (signal: 6, SIGABRT: process abort signal)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 15:21</div>
            <div class="timeline-body"><p>Oh hello</p>
<pre><code>‚ùØ uv python install --install-dir ./target/debug/deps/python 3.12
Installed Python 3.12.8 in 1.40s
 + cpython-3.12.8-macos-aarch64-none
‚ùØ PYO3_PYTHON=/Users/zb/workspace/uv-repro-install-lib/target/debug/deps/python/cpython-3.12.8-macos-aarch64-none/bin/python cargo t
   Compiling pyo3-build-config v0.23.4
   Compiling pyo3-ffi v0.23.4
   Compiling pyo3-macros-backend v0.23.4
   Compiling pyo3 v0.23.4
   Compiling pyo3-macros v0.23.4
   Compiling setup v0.1.0 (/Users/zb/workspace/uv-repro-install-lib)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 2.84s
     Running unittests src/lib.rs (target/debug/deps/setup-29f3c899bfb488ef)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:24</div>
            <div class="timeline-body"><p>Using this build script for the same purpose seems to do the trick too:</p>
<pre><code>use std::env::consts::{DLL_PREFIX, DLL_SUFFIX};
use std::path::PathBuf;

fn main() {
    let interpreter_config = pyo3_build_config::get();
    let lib_dir = interpreter_config
        .lib_dir
        .as_ref()
        .expect(&quot;lib_dir is not set for the Python interpreter detected by pyo3-build-config&quot;);
    let lib_name = interpreter_config
        .lib_name
        .as_ref()
        .expect(&quot;lib_name is not set for the Python interpreter detected by pyo3-build-config&quot;);
    let dll_name = format!(&quot;{DLL_PREFIX}{lib_name}{DLL_SUFFIX}&quot;);
    let dll_path = PathBuf::from(lib_dir).join(&amp;dll_name);

    let out_dir = PathBuf::from(std::env::var(&quot;OUT_DIR&quot;).expect(&quot;OUT_DIR is not set&quot;));
    std::fs::copy(dll_path, out_dir.join(dll_name)).expect(&quot;Failed to copy Python DLL&quot;);
    println!(&quot;cargo:rustc-link-search=native={}&quot;, out_dir.display());
}
</code></pre>
<p>Although it&#x27;d be nice if it wasn&#x27;t needed ü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 15:25</div>
            <div class="timeline-body"><p>I&#x27;m not sure what we could do to fix that; it seems like a pyo3 issue, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:25</div>
            <div class="timeline-body"><blockquote>
<p>The <code>rustc-link-search</code> caveat seems worth pursing. I tried using the <code>target</code> directory though ‚Äî no dice. Maybe it needs to be in a specific spot?</p>
</blockquote>
<p>I&#x27;d have to be <code>target/debug</code> (for a <code>debug</code> build). The top-level <code>target</code> directory it&#x27;s indeed not in the search path by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:28</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m not sure what we could do to fix that; it seems like a pyo3 issue, right?</p>
</blockquote>
<p>It&#x27;s unclear to me to what extent it&#x27;s a <code>pyo3</code> issue, since it doesn&#x27;t happen with &quot;stock&quot; Python.
If I don&#x27;t force the uv-managed Python interpreter, the build works and the final binary knows where to look for the dylib:</p>
<pre><code>otool -L target/debug/deps/setup-a1fe82e135076eae
target/debug/deps/setup-a1fe82e135076eae:
        /opt/homebrew/opt/python@3.13/Frameworks/Python.framework/Versions/3.13/Python (compatibility version 3.13.0, current version 3.13.0)
        /usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1345.120.2)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:31</div>
            <div class="timeline-body"><p>And I honestly have no idea why it works in that scenario, since the instruction emitted by <code>pyo3-ffi</code> looks formally identical:</p>
<pre><code>[pyo3-ffi 0.23.4] cargo:rustc-link-search=native=/opt/homebrew/opt/python@3.13/Frameworks/Python.framework/Versions/3.13/lib
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 15:31</div>
            <div class="timeline-body"><p>Fair! The crux seems to be that one of our build paths <code>/install/...</code> is being picked up from somewhere outside of <code>sysconfig</code>. Presumably this link is present in a Python binary or library and we should patch that on install too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:34</div>
            <div class="timeline-body"><blockquote>
<p>Fair! The crux seems to be that one of our build paths <code>/install/...</code> is being picked up from somewhere outside of <code>sysconfig</code>. Presumably this link is present in a Python binary or library and we should patch that on install too?</p>
</blockquote>
<p>That&#x27;s my guess, since <code>otool</code> on a <code>uv</code>-backed build outputs:</p>
<pre><code>otool -L target/debug/deps/setup-a1fe82e135076eae
target/debug/deps/setup-a1fe82e135076eae:
        /install/lib/libpython3.13.dylib (compatibility version 3.13.0, current version 3.13.0)
        /usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1345.120.2)
</code></pre>
<p>and that&#x27;s a mystery to me at the moment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:43</div>
            <div class="timeline-body"><p>I found something interesting.
For a stock Python build, <code>pyo3-ffi</code> emits:</p>
<pre><code>[pyo3 0.23.4] cargo:rustc-link-arg=-Wl,-rpath,/opt/homebrew/opt/python@3.13/Frameworks
</code></pre>
<p>while for a <code>uv</code>-Python build, we get:</p>
<pre><code>[pyo3 0.23.4] cargo:rustc-link-arg=-Wl,-rpath,
</code></pre>
<p>And that stinks.
Tracking this down into <code>pyo3-build-config</code>, it points here:</p>
<pre><code>#[cfg(feature = &quot;resolve-config&quot;)]
fn _add_python_framework_link_args(
    interpreter_config: &amp;InterpreterConfig,
    triple: &amp;Triple,
    link_libpython: bool,
    mut writer: impl std::io::Write,
) {
    if matches!(triple.operating_system, OperatingSystem::Darwin(_)) &amp;&amp; link_libpython {
        if let Some(framework_prefix) = interpreter_config.python_framework_prefix.as_ref() {
            writeln!(
                writer,
                &quot;cargo:rustc-link-arg=-Wl,-rpath,{}&quot;,
                framework_prefix
            )
            .unwrap();
        }
    }
}
</code></pre>
<p>and <code>python_framework_prefix</code> is documented as &quot;macOS Python3.framework requires special rpath handling&quot;. Looking further now üîé</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:46</div>
            <div class="timeline-body"><p>OK, I think I might have found it:</p>
<pre><code>from sysconfig import get_config_var

FRAMEWORK_PREFIX = get_config_var(&quot;PYTHONFRAMEWORKPREFIX&quot;)
</code></pre>
<p>This outputs an empty string for a <code>uv</code> build, while it&#x27;s set to &quot;/opt/homebrew/opt/python@3.13/Frameworks&quot; for a &quot;stock&quot; build.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 15:48</div>
            <div class="timeline-body"><p>This now begs the question: should <code>uv</code>-Python set that value? I&#x27;m not deep enough into <code>sysconfig</code>&#x27;s lore to know if the fix should be on the <code>pyo3</code> side or on the <code>uv</code> side.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:01</div>
            <div class="timeline-body"><p>We&#x27;re not doing a framework build of Python (it&#x27;s... different), so I think that should be empty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 16:09</div>
            <div class="timeline-body"><p>Cool, then it&#x27;s a red herring. Even more so since trying to emit that <code>&quot;cargo:rustc-link-arg=-Wl,-rpath,{}&quot;</code> instructions with various parent directories of the <code>uv</code> build doesn&#x27;t seem to help our case.
This brings us back to the root question: where is <code>/install/lib/libpython3.13.dylib</code> coming from?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:13</div>
            <div class="timeline-body"><pre><code>‚ùØ otool -L  bin/python
bin/python:
	/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 2202.0.0)
	@executable_path/../lib/libpython3.12.dylib (compatibility version 3.12.0, current version 3.12.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1336.61.1)

‚ùØ otool -L lib/libpython3.12.dylib
lib/libpython3.12.dylib:
	/install/lib/libpython3.12.dylib (compatibility version 3.12.0, current version 3.12.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1336.61.1)
	/usr/lib/libncurses.5.4.dylib (compatibility version 5.4.0, current version 5.4.0)
	/usr/lib/libpanel.5.4.dylib (compatibility version 5.4.0, current version 5.4.0)
	/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 2202.0.0)
	/usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0)
	/System/Library/Frameworks/SystemConfiguration.framework/Versions/A/SystemConfiguration (compatibility version 1.0.0, current version 1296.60.3)
	/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit (compatibility version 45.0.0, current version 2487.30.104)
	/System/Library/Frameworks/ApplicationServices.framework/Versions/A/ApplicationServices (compatibility version 1.0.0, current version 64.0.0)
	/System/Library/Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics (compatibility version 64.0.0, current version 1774.2.3)
	/System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices (compatibility version 1.0.0, current version 1226.0.0)
	/System/Library/Frameworks/CoreText.framework/Versions/A/CoreText (compatibility version 1.0.0, current version 1.0.0)
	/System/Library/Frameworks/Foundation.framework/Versions/C/Foundation (compatibility version 300.0.0, current version 2202.0.0)
	/System/Library/Frameworks/Carbon.framework/Versions/A/Carbon (compatibility version 2.0.0, current version 170.0.0)
	/System/Library/Frameworks/Cocoa.framework/Versions/A/Cocoa (compatibility version 1.0.0, current version 24.0.0)
	/System/Library/Frameworks/IOKit.framework/Versions/A/IOKit (compatibility version 1.0.0, current version 275.0.0)
	/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzCore (compatibility version 1.2.0, current version 1.11.0)
	/usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)
	/usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.12)
</code></pre>
<p>Maybe from <code>lib/libpython3.12.dylib</code> itself? kind of weird.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 16:32</div>
            <div class="timeline-body"><p>That&#x27;d be quite weird, but it&#x27;s interesting.
System Python seems to link to itself there?</p>
<pre><code>otool -L /opt/homebrew/opt/python@3.13/Frameworks/Python.framework/Versions/3.13/Python
/opt/homebrew/opt/python@3.13/Frameworks/Python.framework/Versions/3.13/Python:
        /opt/homebrew/opt/python@3.13/Frameworks/Python.framework/Versions/3.13/Python (compatibility version 3.13.0, current version 3.13.0)
        /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 2503.1.0)
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1345.120.2)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:32</div>
            <div class="timeline-body"><p>tada</p>
<pre><code>‚ùØ install_name_tool -id /Users/zb/.local/share/uv/python/cpython-3.12.6-macos-aarch64-none/lib/libpython3.12.dylib /Users/zb/.local/share/uv/python/cpython-3.12.6-macos-aarch64-none/lib/libpython3.12.dylib

‚ùØ otool -L /Users/zb/.local/share/uv/python/cpython-3.12.6-macos-aarch64-none/lib/libpython3.12.dylib
/Users/zb/.local/share/uv/python/cpython-3.12.6-macos-aarch64-none/lib/libpython3.12.dylib:
	/Users/zb/.local/share/uv/python/cpython-3.12.6-macos-aarch64-none/lib/libpython3.12.dylib (compatibility version 3.12.0, current version 3.12.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1336.61.1)
	/usr/lib/libncurses.5.4.dylib (compatibility version 5.4.0, current version 5.4.0)
	/usr/lib/libpanel.5.4.dylib (compatibility version 5.4.0, current version 5.4.0)
	/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 2202.0.0)
	/usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 228.0.0)
	/System/Library/Frameworks/SystemConfiguration.framework/Versions/A/SystemConfiguration (compatibility version 1.0.0, current version 1296.60.3)
	/System/Library/Frameworks/AppKit.framework/Versions/C/AppKit (compatibility version 45.0.0, current version 2487.30.104)
	/System/Library/Frameworks/ApplicationServices.framework/Versions/A/ApplicationServices (compatibility version 1.0.0, current version 64.0.0)
	/System/Library/Frameworks/CoreGraphics.framework/Versions/A/CoreGraphics (compatibility version 64.0.0, current version 1774.2.3)
	/System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices (compatibility version 1.0.0, current version 1226.0.0)
	/System/Library/Frameworks/CoreText.framework/Versions/A/CoreText (compatibility version 1.0.0, current version 1.0.0)
	/System/Library/Frameworks/Foundation.framework/Versions/C/Foundation (compatibility version 300.0.0, current version 2202.0.0)
	/System/Library/Frameworks/Carbon.framework/Versions/A/Carbon (compatibility version 2.0.0, current version 170.0.0)
	/System/Library/Frameworks/Cocoa.framework/Versions/A/Cocoa (compatibility version 1.0.0, current version 24.0.0)
	/System/Library/Frameworks/IOKit.framework/Versions/A/IOKit (compatibility version 1.0.0, current version 275.0.0)
	/System/Library/Frameworks/QuartzCore.framework/Versions/A/QuartzCore (compatibility version 1.2.0, current version 1.11.0)
	/usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)
	/usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.12)

‚ùØ cargo clean
     Removed 313 files, 72.4MiB total
‚ùØ PYO3_PYTHON=&quot;$(uv python find 3.12)&quot; cargo t
   Compiling target-lexicon v0.12.16
   Compiling once_cell v1.20.2
   Compiling proc-macro2 v1.0.93
   Compiling unicode-ident v1.0.14
   Compiling autocfg v1.4.0
   Compiling libc v0.2.169
   Compiling heck v0.5.0
   Compiling indoc v2.0.5
   Compiling cfg-if v1.0.0
   Compiling unindent v0.2.3
   Compiling memoffset v0.9.1
   Compiling pyo3-build-config v0.23.4
   Compiling quote v1.0.38
   Compiling syn v2.0.96
   Compiling pyo3-ffi v0.23.4
   Compiling pyo3-macros-backend v0.23.4
   Compiling pyo3 v0.23.4
   Compiling pyo3-macros v0.23.4
   Compiling setup v0.1.0 (/Users/zb/workspace/uv-repro-install-lib)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 3.77s
     Running unittests src/lib.rs (target/debug/deps/setup-29f3c899bfb488ef)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</code></pre>
<p>I guess we should try to do that at install time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:32</div>
            <div class="timeline-body"><p>AI tells me</p>
<blockquote>
<p>On macOS, dynamic libraries contain an installation path that tells the dynamic linker where to look for the library at runtime. This path is embedded in the library itself and can be different from its current location on disk. When the library is built, it&#x27;s given this install path which represents where it expects to be installed in the final system.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 16:33</div>
            <div class="timeline-body"><p>That checks out with what we are seeing I&#x27;d say.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:34</div>
            <div class="timeline-body"><p>I&#x27;d review a PR if you post it; otherwise, I&#x27;ll get to it when I have a chance.</p>
<p>I think this is a macOS-only issue, but haven&#x27;t checked.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">uv python</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-14 16:42</div>
            <div class="timeline-body"><p>Happy to give it a try‚Äîany pointer as to where I should be looking at for the installation phase?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 16:44</div>
            <div class="timeline-body"><p>It&#x27;d be a new one of these https://github.com/astral-sh/uv/blob/d2fb4c585d7882e3323082e0c80132a33a472bbf/crates/uv/src/commands/python/install.rs#L313</p>
<p>https://github.com/astral-sh/uv/blob/bec8468183c7cc1697ad1d34a5eb6087ec5c8a90/crates/uv-python/src/managed.rs#L496-L509</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LukeMathWalker">@LukeMathWalker</a> on 2025-01-15 11:02</div>
            <div class="timeline-body"><p>PR is up: <a href="https://github.com/astral-sh/uv/pull/10629">astral-sh/uv#10629</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-15 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-15 20:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:41 UTC
    </footer>
</body>
</html>
