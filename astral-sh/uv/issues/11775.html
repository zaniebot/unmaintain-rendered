<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`py run pytest` inexplicably overrides `.so` file - astral-sh/uv #11775</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>py run pytest</code> inexplicably overrides <code>.so</code> file</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11775">#11775</a>
        opened by <a href="https://github.com/nschloe">@nschloe</a>
        on 2025-02-25 09:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nschloe">@nschloe</a> on 2025-02-25 09:32</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'd like to run tests on my pyo3 Python package. To this end, I build the module</p>
<pre><code>uv venv --python=python          
uv pip install -U maturin        
uv run maturin develop --release 
</code></pre>
<p>and then run the tests:</p>
<pre><code>uv pip install -U pytest     
.venv/bin/python -m pytest 
</code></pre>
<p>This works fine. When replacing the last line with</p>
<pre><code>uv run pytest
</code></pre>
<p>the library file</p>
<pre><code>.venv/lib/python3.13/site-packages/foo/foo.cpython-313-x86_64-linux-gnu.so
</code></pre>
<p>gets replaced by an older version though.</p>
<p>MWE attached. Run <code>just build</code>, then change something in <code>src/lib.rs</code>, and watch how <code>just test</code> pulls in the old version.</p>
<p><a href="https://github.com/user-attachments/files/18961392/mwe.zip">mwe.zip</a></p>
<h3>Platform</h3>
<p>Linux 6.12.13-1-lts x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.5.9</p>
<h3>Python version</h3>
<p>Python 3.11.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @nschloe on 2025-02-25 09:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nschloe">@nschloe</a> on 2025-02-25 10:01</div>
            <div class="timeline-body"><p>Apparently, it doesn't override the <code>.so</code> file when using <code>uv run --isolated pytest</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-27 12:56</div>
            <div class="timeline-body"><p>This looks like another instance of #11390.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:56 UTC
    </footer>
</body>
</html>
