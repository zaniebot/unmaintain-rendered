<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>no-config and config-file arguments still read pyproject.toml - astral-sh/uv #12877</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>no-config and config-file arguments still read pyproject.toml</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12877">#12877</a>
        opened by <a href="https://github.com/g4borg">@g4borg</a>
        on 2025-04-14 09:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/g4borg">@g4borg</a></div>
            <div class="timeline-body">Summary
<p>I came across an issue when trying to use VS Code internal terminal, which starts up in the project directory, when using uv to automate some of my things in bashrc</p>
<p>Basically, it was reading the pyproject.toml of that project, which had no project entry, and returned with an error, even if the uv call was designed to run for a different virtual env.</p>
<p>I boiled it down to trying in the same project directory, trying all kinds of flags to make it ignore the pyproject in the current directory, with different combinations of using --no-config and --config-file:</p>
<pre><code>‚ùØ UV_NO_CONFIG=1 uv --no-config --config-file=&quot;/home/g4b/.local/python/uv.toml&quot; run python

error: No `project` table found in: `/home/g4b/projects/redacted/pyproject.toml
</code></pre>
<p>Expected according to the docs:
--no-config should ignore the pyproject.toml
--config-file should read that file and ignore pyproject.toml as well</p>
<p>Instead:
error message and uv exiting further instructions</p>
<p>Yes I did a workaround by adding &quot;cd ~/.local/python &amp;&amp; uv run ...&quot; into my script, which works for me, but I still think this might be a bug, that also should be easy to replicate by just running such commands in a directory with an empty pyproject.toml file.</p>
Platform
<p>Windows, Ubuntu 22.04 WSL</p>
Version
<p>uv 0.6.14</p>
Python version
<p>any</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/g4borg">@g4borg</a> on 2025-04-14 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-14 09:49</div>
            <div class="timeline-body"><p>Are you looking for <code>--no-project</code>? <code>--no-config</code>/<code>--config-file</code> are for uv&#x27;s configuration (things that can go into <code>uv.toml</code>), while in the example it fails at the project metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/g4borg">@g4borg</a> on 2025-04-14 13:33</div>
            <div class="timeline-body"><p>that indeed works (run --no-project), but should --no-config not as advertised skip reading config files in the current project directory?</p>
<p>Pardon me if I am confused</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-14 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-14 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TrevorBenson">@TrevorBenson</a> on 2025-05-15 21:05</div>
            <div class="timeline-body"><p>The add subcommand does not have a <code>--no-project</code> option and results in trying to find config files:</p>
<pre><code>user@host:~/testing/uv-no-config$ uv venv
Using CPython 3.13.3 interpreter at: /usr/bin/python
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
user@host:~/testing/uv-no-config$ source .venv/bin/activate
(uv-no-config) user@host:~/testing/uv-no-config$ uv add --no-config --active fastapi
error: No `pyproject.toml` found in current directory or any parent directory
</code></pre>
<p>However, if I init a project, create a subdir, add a .venv to the subdir, and then try again using <code>--no-config</code> it clearly discovers and parses the <code>pyproject.toml</code> configuration file, as it has a presumed path for the .venv:</p>
<pre><code>user@host:~/testing/uv-no-config$ uv init
Initialized project `uv-no-config`
user@host:~/testing/uv-no-config$ mkdir subdir
user@host:~/testing/uv-no-config$ cd subdir
user@host:~/testing/uv-no-config/subdir$ uv venv
Using CPython 3.13.3 interpreter at: /usr/bin/python3.13
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
user@host:~/testing/uv-no-config/subdir$ source .venv/bin/activate
(subdir) user@host:~/testing/uv-no-config/subdir$ uv add --no-config fastapi
warning: `VIRTUAL_ENV=.venv` does not match the project environment path `/home/user/testing/uv-no-config/.venv` and will be ignored; use `--active` to target the active environment instead
Using CPython 3.13.2
Creating virtual environment at: /home/user/testing/uv-no-config/.venv
Resolved 11 packages in 245ms
Installed 10 packages in 9ms
 + annotated-types==0.7.0
 + anyio==4.9.0
 + fastapi==0.115.12
 + idna==3.10
 + pydantic==2.11.4
 + pydantic-core==2.33.2
 + sniffio==1.3.1
 + starlette==0.46.2
 + typing-extensions==4.13.2
 + typing-inspection==0.4.0
</code></pre>
<p>Using <code>--active</code> with <code>--no-config</code> does work, but <strong>only</strong> when there is a project in a parent of the path.</p>
<p>I can open a feature request for <code>--no-project</code> for the add subcommand, but even then the current usage menu suggesting <code>--no-config</code> blocks discovery of <code>pyproject.toml</code> seems inaccurate, maybe it should be updated if its behavior is not considered to be a bug.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:14 UTC
    </footer>
</body>
</html>
