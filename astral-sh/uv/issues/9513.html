<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploads fail due to setuptools using wrong metadata version for license-file - astral-sh/uv #9513</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Uploads fail due to setuptools using wrong metadata version for license-file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9513">#9513</a>
        opened by <a href="https://github.com/franzhaas">@franzhaas</a>
        on 2024-11-28 18:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/franzhaas">@franzhaas</a></div>
            <div class="timeline-body"><p>Dear all,</p>
<p>I got this error when building and uploading my wheel with 0.5.5 to pypi.org.:</p>
<pre><code>Upload failed with status code 400 Bad Request. Server says: 400 license-file introduced in metadata version 2.4, not 2.1. See https://packaging.python.org/specifications/core-metadata for more information.
</code></pre>
<p>But it does work for me with 0.5.4.</p>
<p>Accoridng to the release notes, with 0.5.5 uv started to use license-file, however I did not see a mention of moving the metadata version...</p>
<p>Any ideas?</p>
<p>Thanks in advance,
Franz</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-28 19:03</div>
            <div class="timeline-body"><p>This is probably #9442: It&#x27;s correct that you can only use <code>license-file</code> with metadata of at least version 2.4, but we were missing that field in the upload payload previously so pypi&#x27;s validation didn&#x27;t work. What build backend are you using?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/franzhaas">@franzhaas</a> on 2024-11-28 19:06</div>
            <div class="timeline-body"><p>Hi Konstin,</p>
<p>I use.:</p>
<pre><code>[build-system]
requires = [&quot;setuptools&quot;, &quot;wheel&quot;, &quot;setuptools-scm&quot;]
build-backend = &quot;setuptools.build_meta&quot;
</code></pre>
<p>If it helps, the full project is located here.: https://github.com/MarketSquare/robotframework-construct</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FHU-yezi">@FHU-yezi</a> on 2024-11-29 03:24</div>
            <div class="timeline-body"><p>I got the same error with <code>uv build</code> used in building my project.</p>
<p>Here is the repo: https://github.com/FHU-yezi/sshared</p>
<p>The failed publish GitHub Action flow: https://github.com/FHU-yezi/sshared/actions/runs/12078435589/job/33682841905</p>
<p>It is a pure Python package and I got this error after updated to the latest uv version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-29 10:41</div>
            <div class="timeline-body"><p>This is a bug in setuptools: <a href="https://github.com/pypa/setuptools/issues/4759">pypa/setuptools#4759</a></p>
<p>uv unfortunately can&#x27;t do anything about this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-11-29 10:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/franzhaas">@franzhaas</a> on 2024-11-29 10:49</div>
            <div class="timeline-body"><p>Ok thanks. Any ideas how to have dynamic versioning without setuptools?</p>
<p>konsti <em><strong>@</strong></em>.***&gt; schrieb am Fr., 29. Nov. 2024, 11:42:</p>
<blockquote>
<p>This is a bug in setuptools: pypa/setuptools#4759
<a href="https://github.com/pypa/setuptools/issues/4759">pypa/setuptools#4759</a></p>
<p>uv unfortunately can&#x27;t do anything about this.</p>
<p>â€”
Reply to this email directly, view it on GitHub
<a href="https://github.com/astral-sh/uv/issues/9513#issuecomment-2507543694">astral-sh/uv#9513</a>, or
unsubscribe
<a href="https://github.com/notifications/unsubscribe-auth/ACXSBILVY5IYIXHUHCKUNST2DBAH5AVCNFSM6AAAAABSVWJU6KVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDKMBXGU2DGNRZGQ">https://github.com/notifications/unsubscribe-auth/ACXSBILVY5IYIXHUHCKUNST2DBAH5AVCNFSM6AAAAABSVWJU6KVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDKMBXGU2DGNRZGQ</a>
.
You are receiving this because you authored the thread.Message ID:
<em><strong>@</strong></em>.***&gt;</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/my1e5">@my1e5</a> on 2024-11-29 11:51</div>
            <div class="timeline-body"><p>@franzhaas <a href="https://github.com/jwodder/versioningit">versioningit</a> works with setuptools and also hatchling.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/franzhaas">@franzhaas</a> on 2024-11-29 19:12</div>
            <div class="timeline-body"><p>I did not try to upload, but when building with hatchling, I ended up using metadata 2.3... for both uv 0.5.4 and 0.5.5...</p>
<p>this might be related to this one.:
<a href="https://github.com/pypa/hatch/issues/1819">pypa/hatch#1819</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SermetPekin">@SermetPekin</a> on 2024-12-02 20:06</div>
            <div class="timeline-body"><pre><code>
[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
<p>fixed my issue. as @kbrgl suggested</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/senges">@senges</a> on 2024-12-05 08:09</div>
            <div class="timeline-body"><p>If you still want to use setuptools as build backend, a simple workaround is to explicitly provide an empty value for <code>licence-files</code> in your <code>pyproject.toml</code>:</p>
<pre><code>[tool.setuptools]
license-files = []
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-12-17 06:50</div>
            <div class="timeline-body"><p>Okay, here&#x27;s what I don&#x27;t understand...
There is is a setuptools bug, but there&#x27;s also something funky going on with uv.
I removed all mentions of license from my pyproject.toml and <code>rm -rf build dist; uv build; uv publish</code> gave me the same error. I then did <code>rm -rf build dist; python -m build . ; python -m twine upload dist/*</code> and everything works just fine. What gives?</p>
<p>Does uv build do any caching of metadata somewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FHU-yezi">@FHU-yezi</a> on 2024-12-17 07:47</div>
            <div class="timeline-body"><blockquote>
<p>Okay, here&#x27;s what I don&#x27;t understand...
Maybe this is a setuptools bug, but there&#x27;s something funky going on with uv.
I removed all mentions of license from my pyproject.toml and <code>rm -rf build dist; uv build; uv publish</code> gave me the same error. I then did <code>rm -rf build dist; python -m build . ; python -m twine upload dist/*</code> and everything works just fine. What gives?</p>
<p>Does uv build do any caching of metadata somewhere?</p>
</blockquote>
<p>Use hatchling instead of setuptools should solve this problem, you can find guide about this in uv documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-12-17 07:55</div>
            <div class="timeline-body"><p>Thanks, I understand that&#x27;s a valid workaround :-) Just based on the sequence of commands I ran, it appears there&#x27;s also some issue in uv (maybe just a caching issue?) in addition to the one in setuptools</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-12-17 08:25</div>
            <div class="timeline-body"><p>@hauntsaninja:</p>
<p>PEP 639 adds two new fields to the wheel metadata, <code>License-Expression</code> and <code>License-File</code>, with the corresponding <code>pyproject.toml</code> fields <code>license = &quot;...&quot;</code> and <code>license-files = [...]</code>. These fields are added in the new metadata version 2.4.</p>
<p>When uploading a wheel, the uploader reads the <code>METADATA</code> file from the wheel and transforms it to formdata. PyPI has recently started validating the two new metadata fields from PEP 639 in the formdata, thought PyPI does not validate the <code>METADATA</code>. Twine hasn&#x27;t implemented that PEP yet (<a href="https://github.com/pypa/twine/pull/1180">pypa/twine#1180</a>), so it does not set the new license fields in the formdata, and PyPI does not catch the invalid metadata (declaring metadata version 2.1 while using version 2.4 fields).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cdce8p">@cdce8p</a> on 2024-12-17 12:21</div>
            <div class="timeline-body"><blockquote>
<p>When uploading a wheel, the uploader reads the <code>METADATA</code> file from the wheel and transforms it to formdata. PyPI has recently started validating the two new metadata fields from PEP 639 in the formdata, thought PyPI does not validate the <code>METADATA</code>. Twine hasn&#x27;t implemented that PEP yet (<a href="https://github.com/pypa/twine/pull/1180">pypa/twine#1180</a>), so it does not set the new license fields in the formdata, and PyPI does not catch the invalid metadata (declaring metadata version 2.1 while using version 2.4 fields).</p>
</blockquote>
<p>The twine PR was just merged. It also added a carveout for setuptools to exclude <code>License-File</code> from the metadata if the version is <code>&lt;2.4</code> as to not break all projects which use setuptools. Maybe this is something which could be added to <code>uv</code> as well? https://github.com/pypa/twine/blob/main/twine/package.py#L225-L234</p>
<p>The setuptools behavior has been in place for so long at this point that it&#x27;s probably not worth changing until PEP 639 is fully implemented. I&#x27;ve PRs open for that but those depend on some other work which need to happen first and will likely still need some time.</p>
<blockquote>
<p>If you still want to use setuptools as build backend, a simple workaround is to explicitly provide an empty value for <code>licence-files</code> in your <code>pyproject.toml</code>:</p>
<p>[tool.setuptools]
license-files = []</p>
</blockquote>
<p>Yes, this is a workaround. However, I&#x27;d advise against it. It will not only remove the <code>License-File</code> metadata but also the license files from the distribution. You can include them manually via <code>MANIFEST.in</code> but they will still be excluded from the wheel (unless placed inside the project package itself).</p>
<p>The ideal case would really be a workaround added to <code>uv</code> just like in <code>twine</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PeriniM">@PeriniM</a> on 2025-01-03 12:46</div>
            <div class="timeline-body"><p>I had <a href="https://www.npmjs.com/package/@semantic-release/npm">semantic-release</a> set up and suddently it stopped working. The problem was that semrel does not support Metadata v2.4 and therefore the fix was to bump the hatchling version:</p>
<pre><code>[build-system]
requires = [&quot;hatchling==1.26.3&quot;]
build-backend = &quot;hatchling.build&quot;

</code></pre>
<p>Error screenshot:
<img src="https://github.com/user-attachments/assets/090561f1-3864-4361-b397-b146aa05ced6" alt="Image"></p>
<p>Hope it helps!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;metadata version missmatch in uv 0.5.5&quot; to &quot;Uploads fail due to setuptools using wrong metadata version for license-file&quot; by <a href="https://github.com/konstin">@konstin</a> on 2025-08-21 08:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/khaeru">@khaeru</a> on 2025-11-27 15:19</div>
            <div class="timeline-body"><blockquote>
<p>This is a bug in setuptools: <a href="https://github.com/pypa/setuptools/issues/4759">pypa/setuptools#4759</a></p>
<p>uv unfortunately can&#x27;t do anything about this.</p>
</blockquote>
<p>The upstream bug has been fixed in a new release (see <a href="https://github.com/pypa/setuptools/issues/4759">pypa/setuptools#4759</a>#issuecomment-3557496614), so perhaps this issue can be closed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2025-11-27 15:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:50 UTC
    </footer>
</body>
</html>
