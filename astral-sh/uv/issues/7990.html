<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv picks the wrong version of a package and fails (pip does not) - astral-sh/uv #7990</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv picks the wrong version of a package and fails (pip does not)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7990">#7990</a>
        opened by <a href="https://github.com/rsxdalv">@rsxdalv</a>
        on 2024-10-07 21:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rsxdalv">@rsxdalv</a> on 2024-10-07 21:46</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>uv:
https://github.com/rsxdalv/tts-generation-webui/actions/runs/11224348164/job/31200883591
pip:
https://github.com/rsxdalv/tts-generation-webui/actions/runs/11224124790/job/31200229110</p>
<p>context:
Docker image: <code>nvidia/cuda:11.8.0-devel-ubuntu22.04</code> (Python 3.10.12, uv 0.4.18)
<code>uv pip install --no-cache-dir --system setuptools torch==$TORCH_VERSION torchvision torchaudio</code>
<code>pip3 install --no-cache-dir --upgrade pip==23.3.2 setuptools</code></p>
<p>breaking point:
<code>uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements.txt</code></p>
<p>Requirements file:</p>
<pre><code>safetensors
# safetensors==0.3.1 # Until they fix it
ffmpeg-python # Apache 2.0
# gradio==3.48.0
gradio&gt;=4.1.0 # MIT License
python-dotenv==1.0.0
soundfile==0.12.1; sys_platform == 'win32' # torchaudio
# sox # torchaudio for linux
suno-bark @ git+https://github.com/rsxdalv/bark@main#egg=suno-bark # MIT License
vocos==0.1.0 # MIT License
tortoise-tts @ git+https://github.com/rsxdalv/tortoise-tts@main#egg=tortoise-tts # Apache 2.0
beartype&gt;=0.16.1 # workaround for a bug
# no longer required directly # transformers==4.36.1 # cross-compatibility
iso639-lang==2.2.3
pillow==10.3.0 # for gradio, conda fix
</code></pre>
<p>Error:</p>
<pre><code> &gt; [17/27] RUN uv pip install --no-cache-dir --system --verbose torch==2.3.1 -r requirements.txt:
6.923   File &quot;/tmp/.tmpejZquv/builds-v0/.tmpqUIi6D/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 302, in _get_build_requires
6.923     self.run_setup()
6.923   File &quot;/tmp/.tmpejZquv/builds-v0/.tmpqUIi6D/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 503, in run_setup
6.923     super().run_setup(setup_script=setup_script)
6.923   File &quot;/tmp/.tmpejZquv/builds-v0/.tmpqUIi6D/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 318, in run_setup
6.923     exec(code, locals())
6.923   File &quot;&lt;string&gt;&quot;, line 55, in &lt;module&gt;
6.923   File &quot;&lt;string&gt;&quot;, line 52, in _guard_py_ver
6.923 RuntimeError: Cannot install on Python version 3.10.12; only versions &gt;=3.6,&lt;3.10 are supported.
</code></pre>
<p>https://github.com/rsxdalv/tts-generation-webui/actions/runs/11224348164/job/31200883591#step:6:8382</p>
<p>Full dockerfile:</p>
<pre><code># Python 3.10 w/ Nvidia Cuda
FROM nvidia/cuda:11.8.0-devel-ubuntu22.04 AS env_base

# Install Pre-reqs
RUN apt-get update &amp;&amp; apt-get install --no-install-recommends -y \
    git vim nano build-essential python3-dev python3-venv python3-pip gcc g++ ffmpeg

ENV NODE_VERSION=22.9.0
RUN apt-get update &amp;&amp; apt install -y curl
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
ENV NVM_DIR=/root/.nvm
RUN . &quot;$NVM_DIR/nvm.sh&quot; &amp;&amp; nvm install ${NODE_VERSION}
RUN . &quot;$NVM_DIR/nvm.sh&quot; &amp;&amp; nvm use v${NODE_VERSION}
RUN . &quot;$NVM_DIR/nvm.sh&quot; &amp;&amp; nvm alias default v${NODE_VERSION}
ENV PATH=&quot;/root/.nvm/versions/node/v${NODE_VERSION}/bin/:${PATH}&quot;
RUN node --version
RUN npm --version

# Install uv
ADD --chmod=755 https://astral.sh/uv/install.sh /install.sh
RUN /install.sh &amp;&amp; rm /install.sh

# Define PyTorch version
ENV TORCH_VERSION=2.3.1

ENV PATH=&quot;/root/.cargo/bin:$PATH&quot;
RUN uv pip install --no-cache-dir --system setuptools torch==$TORCH_VERSION torchvision torchaudio 

# Set working directory
WORKDIR /app

# Clone the repo
RUN git clone https://github.com/rsxdalv/tts-generation-webui.git

# Set working directory to the cloned repo
WORKDIR /app/tts-generation-webui

RUN pip3 install --no-cache-dir --upgrade pip==23.3.2 setuptools

# Install all requirements
# RUN pip3 install --no-cache-dir torch==$TORCH_VERSION -r requirements.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_bark_hubert_quantizer.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_rvc.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_audiocraft_0.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_audiocraft.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_styletts2.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_vall_e.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_maha_tts.txt
RUN uv pip install --no-cache-dir --system --verbose torch==$TORCH_VERSION -r requirements_stable_audio.txt
# RUN uv pip install --no-cache-dir --system torch==$TORCH_VERSION hydra-core==1.3.2
RUN uv pip install --no-cache-dir --system torch==$TORCH_VERSION nvidia-ml-py


# add postgres &amp; run setup
# Build the React UI
RUN cd react-ui &amp;&amp; npm install &amp;&amp; npm run build

# Run the server
CMD python server.py --docker
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-07 22:21</div>
            <div class="timeline-body"><p>Hi! Thanks for all the details. Did you read the <a href="https://docs.astral.sh/uv/pip/compatibility/#local-version-identifiers">local version identifier section</a> of the pip compatibility guide?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-10-07 22:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsxdalv">@rsxdalv</a> on 2024-10-07 22:38</div>
            <div class="timeline-body"><p>Thank you, I saw some potential causes for this, it seems like it spiraled downwards towards an older version, and I suppose I can try to add an extra constraint on the version and fix everything that way.</p>
<p>On the topic of pip compatibility, it seems that pip is capable of installing packages while there's an app running while uv seems to fail, is this to be expected?
error: failed to remove file <code>.\env\Lib\site-packages\PIL/_imaging.cp310-win_amd64.pyd</code>
Caused by: Access is denied. (os error 5)
For context, I have a python app with extensions system and they currently are being installed while the app itself is running.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-08 13:15</div>
            <div class="timeline-body"><p>There's an issue for the pyd file behavior on Windows https://github.com/astral-sh/uv/issues/7918 — installation should be fine but that suggests that there's an uninstall happening?</p>
<p>Here's another issue with context on selection of old versions when there aren't constraints https://github.com/astral-sh/uv/issues/4372</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsxdalv">@rsxdalv</a> on 2024-10-08 14:44</div>
            <div class="timeline-body"><blockquote>
<p>There's an issue for the pyd file behavior on Windows #7918 — installation should be fine but that suggests that there's an uninstall happening?</p>
<p>Here's another issue with context on selection of old versions when there aren't constraints #4372</p>
</blockquote>
<p>Thanks!
Yes, exactly, it seems that the problems begin when an extension causes a reinstall, i.e., PIL &gt; 9 is ok with the app but the extension demands PIL &gt; 10 so we get a reinstall.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsxdalv">@rsxdalv</a> on 2024-10-24 12:45</div>
            <div class="timeline-body"><blockquote>
<p>Hi! Thanks for all the details. Did you read the <a href="https://docs.astral.sh/uv/pip/compatibility/#local-version-identifiers">local version identifier section</a> of the pip compatibility guide?</p>
</blockquote>
<p>I wanted to add a user story in regards to this:</p>
<pre><code class="language-bash">uv pip install --dry-run torch==2.3.0 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of torch==2.3.0 and you require torch==2.3.0, we can conclude that your requirements       
      are unsatisfiable.
</code></pre>
<p>as an end user, I don't know exactly what is the +<label> they are using. I think this time I will just try to guess it, but since the +<label> is so ingrained in python right now, there might need to be a way to help find those packages/resolve those conflicts. (After assuming that there's no pytorch 2.5.0 with Cuda 11.8, I thankfully came here to find that it's torch==2.5.0+cu118)</p>
<p>Also great job on <code>uv</code> dry run installs, when trying it with pip I had this:</p>
<pre><code>(C:\Users\admin\Desktop\one-click-installers-tts-main\tts-generation-webui\installer_files\env) C:\Users\admin\Desktop\one-click-installers-tts-main\tts-generation-webui&gt;pip install --dry-run torch==2.3.0 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
Looking in indexes: https://download.pytorch.org/whl/cu118
Collecting torch==2.3.0
  Downloading https://download.pytorch.org/whl/cu118/torch-2.3.0%2Bcu118-cp310-cp310-win_amd64.whl (2673.0 MB)
     ━━╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 0.1/2.7 GB 40.9 MB/s eta 0:01:02
ERROR: Operation cancelled by user

(C:\Users\admin\Desktop\one-click-installers-tts-main\tts-generation-webui\installer_files\env) C:\Users\admin\Desktop\one-click-installers-tts-main\tts-generation-webui&gt;pip install --dry-run torch==2.5.0 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
Looking in indexes: https://download.pytorch.org/whl/cu118
Collecting torch==2.5.0
  Downloading https://download.pytorch.org/whl/cu118/torch-2.5.0%2Bcu118-cp310-cp310-win_amd64.whl (2700.2 MB)
     ━╺━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 0.1/2.7 GB 40.9 MB/s eta 0:01:04
ERROR: Operation cancelled by user
</code></pre>
<p>Thus I can testify that <code>uv</code> is already a tool every python dev should have installed, because it's useful even when mixing with <code>pip</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-26 16:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:02 UTC
    </footer>
</body>
</html>
