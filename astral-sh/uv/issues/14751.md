```yaml
number: 14751
title: "persisting github pat in private source dependency url in `uv.lock`"
type: issue
state: open
author: giuliano-97
labels:
  - enhancement
assignees: []
created_at: 2025-07-20T12:16:36Z
updated_at: 2025-07-22T09:18:48Z
url: https://github.com/astral-sh/uv/issues/14751
synced_at: 2026-01-10T01:57:33Z
```

# persisting github pat in private source dependency url in `uv.lock`

---

_Issue opened by @giuliano-97 on 2025-07-20 12:16_

### Summary

### Description

I have a package with a private source dependency fetched from GitHub which is included like this:

```toml
[project]
name = "project-1"
version = "0.1.0"
requires-python = ">=3.13"
dependencies = [
    "my-dep @ git+https://github_pat_<GITHUB_TOKEN>@github.com/my-user/my-dep.git@0.0.1",
]
```
I have another package within the same repository that depends on `project-1` like this:

```toml
[project]
name = "subproject"
version = "0.1.0"
requires-python = ">=3.13"
dependencies = [
    "project-1",
]

[tool.uv.sources]
project-1 = { path = "../" }
```
The sub-project should be built as a docker image and one of the build steps is to resolve the project dependencies via `uv`, like this:

```Dockerfile
RUN uv venv --system-site-packages --relocatable && uv sync
```

When I run `uv lock` for `subproject`, outside of the docker build, the resulting lock file doesn't persist the github token in the URL of `my-dep`, which is a transitive dependency through `project-1`, as stated [in the documentation](https://docs.astral.sh/uv/concepts/authentication/#git-authentication). Therefore, when `uv sync` is run in the docker build it fails to resolve `my-dep`. 

My current workaround is, well, not to create a lockfile for `subproject`, but this is not ideal.

Is there a way to persist the PAT in the url of the lockfile `my-dep`? Alternatively, how would recommend achieving what I'm trying to do? 

### Additional info

OS: Linux - Ubuntu 22.04
uv version: 0.7.5

### Example

Steps to reproduce:
```
mkdir project-1
cd project-1
uv init 
uv add --raw my-dep@git+https://github_pat_<GITHUB_TOKEN>@github.com/my-user/my-dep.git@0.0.1
mkdir subproject
cd suproject
uv init --no-workspace
uv add ../
```
Resulting directory structure:
```
.
├── subproject
│   ├── main.py
│   ├── pyproject.toml
│   ├── README.md
│   └── uv.lock
├── main.py
├── pyproject.toml
├── README.md
└── uv.lock

```

EDIT:
Another workaround which I've been using is to manually add the url to the tool.uv.sources section of subproject like this:
```
[tool.uv.sources]
my-dep = { git = "https://github_pat_<GITHUB_TOKEN>@github.com/my-user/my-dep.git", rev = "0.0.1" }
```
but this is also not ideal, as every time I change my-dep in project-1 I'll have to manually update it in subproject instead of just re-running uv lock.


---

_Label `enhancement` added by @giuliano-97 on 2025-07-20 12:16_

---

_Comment by @giuliano-97 on 2025-07-22 09:18_

@zanieb 

Hi, I saw this rather old PR that seems related to this: https://github.com/astral-sh/uv/pull/1717

But I think the current behavior is to redact the credentials in the URL when creating the lock file. Do you have any input on this?
TIA

---
