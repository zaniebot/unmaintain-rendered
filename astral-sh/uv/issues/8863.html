<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv resolves to older numba version incompatible with python version - astral-sh/uv #8863</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv resolves to older numba version incompatible with python version</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8863">#8863</a>
        opened by <a href="https://github.com/MitchellAcoustics">@MitchellAcoustics</a>
        on 2024-11-06 14:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MitchellAcoustics">@MitchellAcoustics</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>When attempting to add a new dependency to a fresh env which depends on numba, it fails to install with:</p>
<pre><code class="language-bash"># uv 0.4.28 (debe67ffd 2024-10-28)
# ./.python-version 3.12
uv cache clean
uv add scikit-maad
</code></pre>
<pre><code class="language-bash">DEBUG Downloading source distribution: numba==0.53.1
DEBUG Traceback (most recent call last):
DEBUG   File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
DEBUG   File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 333, in get_requires_for_build_wheel
DEBUG     return self._get_build_requires(config_settings, requirements=[])
DEBUG            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
DEBUG   File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 303, in _get_build_requires
DEBUG     self.run_setup()
DEBUG   File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 521, in run_setup
DEBUG     super().run_setup(setup_script=setup_script)
DEBUG   File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 319, in run_setup
DEBUG     exec(code, locals())
DEBUG   File &quot;&lt;string&gt;&quot;, line 55, in &lt;module&gt;
DEBUG   File &quot;&lt;string&gt;&quot;, line 52, in _guard_py_ver
DEBUG RuntimeError: Cannot install on Python version 3.12.5; only versions &gt;=3.6,&lt;3.10 are supported.
DEBUG Released lock at `/Users/mitch/.cache/uv/sdists-v5/pypi/llvmlite/0.36.0/.lock`
DEBUG Released lock at `/Users/mitch/.cache/uv/sdists-v5/pypi/numba/0.53.1/.lock`
error: Failed to prepare distributions
  Caused by: Failed to download and build `llvmlite==0.36.0`
  Caused by: Build backend failed to determine requirements with `build_wheel()` (exit status: 1)

[stderr]
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 333, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=[])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 303, in _get_build_requires
    self.run_setup()
  File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 521, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/Users/mitch/.cache/uv/builds-v0/.tmp6ZFD4B/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 319, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 55, in &lt;module&gt;
  File &quot;&lt;string&gt;&quot;, line 52, in _guard_py_ver
RuntimeError: Cannot install on Python version 3.12.5; only versions &gt;=3.6,&lt;3.10 are supported.
</code></pre>
<p>In my case, I am trying to install <a href="https://github.com/scikit-maad/scikit-maad"><code>scikit-maad</code></a>, which (as of v1.4.3) depends on <code>resampy &gt;=0.4</code> -&gt; <code>numba&gt;=0.53</code>. From a fresh venv with uv cache cleared, this resolves to v0.53.1 with</p>
<pre><code>DEBUG Searching for a compatible version of numba (&gt;=0.53)
DEBUG Selecting: numba==0.53.1 [preference] (numba-0.53.1.tar.gz)
</code></pre>
<p>However, numba v0.53.1 is incompatible with my pinned python v3.12:</p>
<pre><code># from https://github.com/numba/numba/blob/0.53.1/setup.py
min_python_version = &quot;3.6&quot;
max_python_version = &quot;3.10&quot;  # exclusive
</code></pre>
<p>I would expect that uv would handle this when resolving - recognise numba 0.53.1 is not compatible with python 3.12 and find a newer version which is, since higher versions are allowed by both resampy and scikit-maad. I'm not sure why it considers 0.53.1 'preferred'?</p>
<p>I can confirm it's not an actual dependency conflict - clearing uv cache and doing <code>uv add numba</code> first (which sets the dependency to the latest <code>numba&gt;=0.60.0</code>), then <code>uv add scikit-maad</code> installs everything fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MitchellAcoustics">@MitchellAcoustics</a> on 2024-11-06 14:16</div>
            <div class="timeline-body"><p>Just to be extra sure, I just updated uv to v0.4.30 and still get the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-06 16:24</div>
            <div class="timeline-body"><p>Probably a duplicate of https://github.com/astral-sh/uv/issues/8157</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-06 16:26</div>
            <div class="timeline-body"><p>Yeah, there's an extensive write-up on this here: https://github.com/astral-sh/uv/issues/6281#issuecomment-2316240724</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-06 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-11-06 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MitchellAcoustics">@MitchellAcoustics</a> on 2024-11-06 16:38</div>
            <div class="timeline-body"><p>Thanks! I saw those other discussions, what I'm confused by is why the Python version constraints are not respected. My assumption would be numba 0.53 wouldn't even be considered because of its python constraints, rather than the other dependency constraints.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-06 16:42</div>
            <div class="timeline-body"><p>Are you referring to the <code>RuntimeError: Cannot install on Python version 3.12.5; only versions &gt;=3.6,&lt;3.10 are supported.</code> error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MitchellAcoustics">@MitchellAcoustics</a> on 2024-11-06 16:47</div>
            <div class="timeline-body"><p>Somewhat, but that happens when trying to install llvmlite. My impression would be that numba v0.53.1 shouldn't even be a candidate for resolving since it places an upper bound on the python version, which is then what leads to that error happening. I'm not sure when they started supporting python 3.12, but I would assume that's where the resolution would then start looking for a version compatible with the other dependencies and v0.53 wouldn't be considered. That said, I don't know anything about how dependency resolution works, so I could have an incorrect understanding!</p>
<pre><code># from https://github.com/numba/numba/blob/0.53.1/setup.py
min_python_version = &quot;3.6&quot;
max_python_version = &quot;3.10&quot;  # exclusive
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-06 16:52</div>
            <div class="timeline-body"><p>Yeah, we don't respect upper-bounds on <code>requires-python</code>. Our stance is that <code>requires-python</code> is intended to indicate minimum Python version compatibility. There's a lot of discussion around that elsewhere -- here's one reference that links to a few more: https://github.com/astral-sh/uv/issues/4022#issuecomment-2148505055</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MitchellAcoustics">@MitchellAcoustics</a> on 2024-11-06 18:00</div>
            <div class="timeline-body"><p>Thank you, that's very helpful! Now that I think about it, that sort of explicit upper bounding was exactly one of the issues I had with poetry and why I stopped using it even before uv came around.</p>
<p>I suppose I'll just set my own numba version dependency in my package, although it feels like there's a more elegant solution.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:10 UTC
    </footer>
</body>
</html>
