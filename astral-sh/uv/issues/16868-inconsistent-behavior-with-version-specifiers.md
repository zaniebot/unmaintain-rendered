```yaml
number: 16868
title: "Inconsistent behavior with version-specifiers containing 'Exclusive ordered comparison' for Post-Release versions"
type: issue
state: closed
author: LtdSauce
labels:
  - bug
  - great writeup
assignees: []
created_at: 2025-11-26T21:25:58Z
updated_at: 2025-11-28T14:50:50Z
url: https://github.com/astral-sh/uv/issues/16868
synced_at: 2026-01-10T03:23:55Z
```

# Inconsistent behavior with version-specifiers containing 'Exclusive ordered comparison' for Post-Release versions

---

_Issue opened by @LtdSauce on 2025-11-26 21:25_

### Summary

Hi!

It seems that `uv` does not correctly follow [Exclusive ordered comparison](https://packaging.python.org/en/latest/specifications/version-specifiers/#exclusive-ordered-comparison) in regards to Post-Release versions, e.g. 1.2.3.post2.

I did search all open issues for the strings `post` and `release`. Also i checked the documentation. But i could only find references to prereleases.

If i see it correctly if a package published the following versions to pypi (e.g. [hidapi](https://pypi.org/project/hidapi/#history)):
```
0.13.1
0.12.0.post2
0.12.0.post1
0.12.0
0.11.2
```
Than a version constraint of `>=0.12.0.post1, <0.12.0.post2` should resolve to `0.12.0.post1`.
But `uv` fails to recognize this apparently and considers this impossible. In the following i use `uv pip compile` to reproduce it. I already observed this with with other `uv` commands that need to resolve this as well, e.g. installing package that has a dependency that relies on a post release being picked from range. This could be seen [here](https://github.com/Nitrokey/pynitrokey/issues/707).

#### Reproducer

```bash
$ cat requirements.in
hidapi >=0.12.0.post1, <0.12.0.post2
$ uv pip compile --verbose requirements.in
DEBUG uv 0.9.13
DEBUG Acquired shared lock for `/home/ltdsauce/.cache/uv`
DEBUG Using request timeout of 30s
DEBUG Starting Python discovery for a default Python
DEBUG Looking for exact match for request a default Python
DEBUG Searching for default Python interpreter in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.13.7-linux-x86_64-gnu` at `/tmp/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.13.7 interpreter at \x1b[36m.venv/bin/python3\x1b[39m for builds
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: >=3.13.7
DEBUG Adding direct dependency: hidapiâˆ…
DEBUG No cache entry for: https://pypi.org/simple/hidapi/
  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ you require hidapi âˆ…
DEBUG Released lock at `/home/ltdsauce/.cache/uv/.lock`
```

`pip-compile` on the other hand succeeds here:
```bash
$ pip-compile --version
pip-compile, version 7.5.2
$ pip-compile
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.13
# by the following command:
#
#    pip-compile
#
hidapi==0.12.0.post1
    # via -r requirements.in

# The following packages are considered to be unsafe in a requirements file:
# setuptools
```

To show that Post-Release just seem to be entirely ignored consider the following:

```bash
$ cat requirements.in
hidapi <0.12.0.post2
$ uv pip compile --verbose requirements.in
DEBUG uv 0.9.13
DEBUG Acquired shared lock for `/home/ltdsauce/.cache/uv`
DEBUG Using request timeout of 30s
DEBUG Starting Python discovery for a default Python
DEBUG Looking for exact match for request a default Python
DEBUG Searching for default Python interpreter in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.13.7-linux-x86_64-gnu` at `/tmp/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.13.7 interpreter at \x1b[36m.venv/bin/python3\x1b[39m for builds
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: >=3.13.7
DEBUG Adding direct dependency: hidapi<0.12.0.post2
DEBUG Found fresh response for: https://pypi.org/simple/hidapi/
DEBUG Searching for a compatible version of hidapi (<0.12.0.post2)
DEBUG Selecting: hidapi==0.11.2 [compatible] (hidapi-0.11.2.tar.gz)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/29/13/391c7d076014e4763ce3b2731dd72c811a7f6030fda03149c392094f5a60/hidapi-0.11.2-cp310-cp310-macosx_10_9_x86_64.whl.metadata
DEBUG Adding transitive dependency for hidapi==0.11.2: setuptools>=19.0
DEBUG Found fresh response for: https://pypi.org/simple/setuptools/
DEBUG Searching for a compatible version of setuptools (>=19.0)
DEBUG Selecting: setuptools==80.9.0 [compatible] (setuptools-80.9.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/a3/dc/17031897dae0efacfea57dfd3a82fdd2a2aeb58e0ff71b77b87e44edc772/setuptools-80.9.0-py3-none-any.whl.metadata
DEBUG Tried 2 versions: hidapi 1, setuptools 1
DEBUG marker environment resolution took 0.002s
Resolved 2 packages in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.11.2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
DEBUG Released lock at `/home/ltdsauce/.cache/uv/.lock`
```

My assumption that `uv` might be wrong here is based on the fact that `pip-compile` (and in fact `pipx`) "correctly" gives me the version i expect. And on the following from the mentiond spec:

> The exclusive ordered comparison >V MUST NOT allow a post-release of the given version unless V itself is a post release.

As in this case `V` is a post-release and thus version resolution should consider post-releases. At least that is how i read this ðŸ‘€

#### Other comparison operators

This seems to only apply to [Exclusive ordered comparison](https://packaging.python.org/en/latest/specifications/version-specifiers/#exclusive-ordered-comparison) as [Inclusive ordered comparison](https://packaging.python.org/en/latest/specifications/version-specifiers/#inclusive-ordered-comparison), [Version matching](https://packaging.python.org/en/latest/specifications/version-specifiers/#version-matching) and [Compatible release](https://packaging.python.org/en/latest/specifications/version-specifiers/#compatible-release) seem to work as expected:

##### Inclusive ordered comparison:
```bash
$ cat requirements.in
hidapi <=0.12.0.post2
$ uv pip compile requirements.in
Resolved 2 packages in 3ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.12.0.post2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
```

##### Verion matching:
```bash
$ cat requirements.in
hidapi ==0.12.0.post2
$ uv pip compile requirements.in
Resolved 2 packages in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.12.0.post2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
```
##### Compatible release:
```bash
$ cat requirements.in
hidapi ~=0.12.0.post1
$ uv pip compile requirements.in
Resolved 2 packages in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.12.0.post2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
```

Thanks for your great work btw!

### Platform

Ubuntu 25.10 ; Linux 6.17.0-6-generic x86_64 GNU/Linux

### Version

uv 0.9.13

### Python version

Python 3.13.7

---

_Label `bug` added by @LtdSauce on 2025-11-26 21:25_

---

_Renamed from "Inconsistent behavior with PEP440 Exclusive ordered comparison for Post-Release versions" to "Inconsistent behavior with version-specifiers containing 'Exclusive ordered comparison' for Post-Release versions" by @LtdSauce on 2025-11-26 21:54_

---

_Comment by @charliermarsh on 2025-11-26 22:15_

Thanks for the report, will take a look.

---

_Comment by @charliermarsh on 2025-11-26 22:46_

It's because of our use of the sentinel "min" version (`Self::strictly_lower_than(version.with_min(Some(0)))`) which we use to properly handle pre-releases. Should be fixable but need to think on it...

---

_Assigned to @charliermarsh by @charliermarsh on 2025-11-28 13:46_

---

_Label `great writeup` added by @konstin on 2025-11-28 14:30_

---

_Closed by @charliermarsh on 2025-11-28 14:50_

---
