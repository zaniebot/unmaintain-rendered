<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating venvs from uv python installtions creates broken venvs - astral-sh/uv #8879</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Creating venvs from uv python installtions creates broken venvs</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/8879">#8879</a>
        opened by <a href="https://github.com/Olindholm">@Olindholm</a>
        on 2024-11-07 06:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Olindholm">@Olindholm</a></div>
            <div class="timeline-body"><p>I am using uv to control my python version, great stuff. I create a venv using uv <code>uv venv --python ...</code> and uv will install whatever version I requrest. Works great.</p>
<p>I am also using an internal python package which creates it&#x27;s own python venv in order to run some commands in isolation. Using regular python this works fine, but when using uv&#x27;s managed installed pythons it does not work.</p>
<p>I believe I have identified the problem being that the package creates venvs using copy, rather than symlink. The issue can be replicated the following way.</p>
<pre><code># Create a venv with uv managed version
uv venv --python 3.8
source .venv/bin/activate

# Create a venv using copy
python -m venv .venv2 --copies # This command will yield and error:
Error: Command &#x27;[&#x27;/home/username/.venv2/bin/python&#x27;, &#x27;-Im&#x27;, &#x27;ensurepip&#x27;, &#x27;--upgrade&#x27;, &#x27;--default-pip&#x27;]&#x27; returned non-zero exit status 127.

# To understand why this failed, let&#x27;s run that command ourselves
$ /home/username/.venv2/bin/python -Im ensurepip --upgrade --default-pip # This will also error:
/home/username/.venv2/bin/python: error while loading shared libraries: /home/username/.venv2/bin/../lib/libpython3.8.so.1.0: cannot open shared object file: No such file or directory
</code></pre>
<p>Note: Creating your venv using <code>--symlinks</code> flag instead, works great.</p>
<p>As I understand it, when creating venvs using copy, <code>python -m venv --copies</code> or <code>import venv; venv.create(symlinks=False)</code>, the python executable is copied, as you&#x27;d expect. But uv&#x27;s python binary is different from regular one, which has links to files which don&#x27;t get copied. Yielding the venv broken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-07 09:16</div>
            <div class="timeline-body"><p>This sounds like another case of <a href="https://github.com/indygreg/python-build-standalone/issues/380">indygreg/python-build-standalone#380</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 13:33</div>
            <div class="timeline-body"><p><code>uv venv</code> itself doesn&#x27;t support <code>--copies</code> so in some sense this isn&#x27;t a uv issue but a python-build-standalone issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-07 13:51</div>
            <div class="timeline-body"><p>Similar to <a href="https://github.com/astral-sh/uv/issues/8821">astral-sh/uv#8821</a></p>
<p>Note there&#x27;s not a clear path to solving this upstream unless we want to patch CPython runtime behavior. I think installers of the distributions may need to patch the sysconfig to fix this as described in #8429</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 13:52</div>
            <div class="timeline-body"><p>Yeah I have no idea how this would work for <code>--copies</code> since we lose all connection to the originating distribution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/jtfmumm">@jtfmumm</a> by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-10 20:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:18 UTC
    </footer>
</body>
</html>
