<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't install e.g. new `packaging` and CUDA version of torch simultaneously - astral-sh/uv #2683</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Can't install e.g. new `packaging` and CUDA version of torch simultaneously</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2683">#2683</a>
        opened by <a href="https://github.com/adzenith">@adzenith</a>
        on 2024-03-27 03:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adzenith">@adzenith</a> on 2024-03-27 03:01</div>
            <div class="timeline-body"><p>This is related to the &quot;<a href="https://github.com/astral-sh/uv/blob/main/PIP_COMPATIBILITY.md#packages-that-exist-on-multiple-indexes">Packages that exist on multiple indexes</a>&quot; in the README, to <a href="https://github.com/astral-sh/uv/issues/2542">this closed ticket</a>, and to the idea of <a href="https://github.com/astral-sh/uv/issues/171">pinning packages to repositories</a>.</p>
<p>The pip compatibility readme <a href="https://github.com/astral-sh/uv/blob/main/PIP_COMPATIBILITY.md#compatibility-with-pip-and-pip-tools">says</a> &quot;in most cases, swapping out pip install for uv pip install should 'just work'&quot; unless you &quot;stray from common pip workflows&quot;; I opened this as a new ticket because it's a specific example of not being able to get <code>uv</code> to work at all with a <code>requirements.in</code> that works with pip, and my impression is that installing a CUDA version of torch is a reasonably common workflow.</p>
<p>The issue I am facing is that <code>torch</code> specifies a bunch of packages in its CUDA <code>extra-index-url</code>, and you can also install vanilla <code>torch</code> from pip. So there's no way as far as I can see to install a new version of any of <a href="https://download.pytorch.org/whl/cu118">the packages here</a> while also installing <code>torch==2.1.2+cu118</code>. Or if there is, please let me know!</p>
<p>Newest <code>uv</code> release:</p>
<pre><code>❯ uv --version
uv 0.1.24
</code></pre>
<p>Install python-can in a venv. It depends on packaging&gt;=23.1:</p>
<pre><code>❯ uv pip install python-can==4.3.1
Resolved 5 packages in 24ms
Downloaded 4 packages in 42ms
Installed 5 packages in 9ms
 + msgpack==1.0.8
 + packaging==24.0
 + python-can==4.3.1
 + typing-extensions==4.10.0
 + wrapt==1.16.0
</code></pre>
<p>Install the CUDA version of torch, which requires this extra-index-url:</p>
<pre><code>❯ uv pip install torch==2.1.2+cu118 --extra-index-url=https://download.pytorch.org/whl/cu118
Resolved 10 packages in 143ms
Installed 10 packages in 236ms
 + filelock==3.9.0
 + fsspec==2023.4.0
 + jinja2==3.1.2
 + markupsafe==2.1.3
 + mpmath==1.3.0
 + networkx==3.2.1
 + sympy==1.12
 + torch==2.1.2+cu118
 + triton==2.1.0
 - typing-extensions==4.10.0
 + typing-extensions==4.8.0
</code></pre>
<p>Now try to compile both of these in a requirements file:</p>
<pre><code>❯ cat &lt;&lt;EOF &gt;requirements.in
python-can==4.3.1
torch==2.1.2+cu118
EOF
</code></pre>
<p>It doesn't work with the extra-index-url, because the pytorch url provides only packaging==22.0:</p>
<pre><code>❯ uv pip compile requirements.in --extra-index-url=https://download.pytorch.org/whl/cu118
  × No solution found when resolving dependencies:
  ╰─▶ Because only packaging&lt;23.1 is available and python-can==4.3.1 depends on
      packaging&gt;=23.1, we can conclude that python-can==4.3.1 cannot be used.
      And because you require python-can==4.3.1, we can conclude that the requirements are
      unsatisfiable.
</code></pre>
<p>It doesn't work with the other order either, because now we can't find our CUDA torch version:</p>
<pre><code>❯ uv pip compile requirements.in --extra-index-url=https://pypi.org/simple --extra-index-url=https://download.pytorch.org/whl/cu118
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of torch==2.1.2+cu118 and you require torch==2.1.2+cu118,
      we can conclude that the requirements are unsatisfiable.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adzenith">@adzenith</a> on 2024-03-27 04:30</div>
            <div class="timeline-body"><p>I have figured out a workaround here. I can install <code>torch</code> and <code>torchvision</code> directly from the whl urls:</p>
<pre><code>torch @ https://download.pytorch.org/whl/cu118/torch-2.1.2%2Bcu118-cp310-cp310-linux_x86_64.whl
torchvision @ https://download.pytorch.org/whl/cu118/torchvision-0.16.2%2Bcu118-cp310-cp310-linux_x86_64.whl
</code></pre>
<p>This leads to <code>uv</code> complaining that <code>torchvision</code> depends on <code>torch==2.1.2</code>, which isn't available, but I can get past that with an override file:</p>
<pre><code>torch
</code></pre>
<p>which allows for any <code>torch</code> version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-27 14:59</div>
            <div class="timeline-body"><p>Yeah, just confirming that your summary is correct, and this is somewhat unsolved beyond the workaround you described in your second post.</p>
<p>In the next version of uv, you shouldn't need the override file, since #2624 will correctly respect the local version specifier from the URL. So, you'll still need to use the direct wheel URLs, but you won't need the override.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-03 23:29</div>
            <div class="timeline-body"><p>The next version of uv will include an opt-in flag to allow this: https://github.com/astral-sh/uv/pull/2815</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-03 23:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:25 UTC
    </footer>
</body>
</html>
