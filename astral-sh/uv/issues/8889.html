<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>manylinux support is missing for riscv64 - astral-sh/uv #8889</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>manylinux support is missing for riscv64</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8889">#8889</a>
        opened by <a href="https://github.com/markdryan">@markdryan</a>
        on 2024-11-07 15:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/markdryan">@markdryan</a> on 2024-11-07 15:23</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<ul>
<li>The current uv platform: linux/riscv64</li>
<li>The current uv version (<code>uv --version</code>): uv 0.4.30 (which includes #8660)</li>
</ul>
<p>It's not currently possible to install riscv64 manylinux wheels using uv.  If I try locally with the command</p>
<pre><code>$ uv pip install PyYAML-6.0.2-cp311-cp311-manylinux_2_35_riscv64.whl 
Using Python 3.11.4 environment at /home/HOME/uv-venv
Resolved 1 package in 156ms
error: Failed to determine installation plan
  Caused by: A path dependency is incompatible with the current platform: PyYAML-6.0.2-cp311-cp311-manylinux_2_35_riscv64.whl
</code></pre>
<p>I get the error shown.   Although the manylinux container images do not yet support riscv64, auditwheel <a href="https://github.com/pypa/auditwheel/blob/main/src/auditwheel/policy/manylinux-policy.json#L446">does</a>, so it is possible to create manylinux wheels for riscv64.  These wheels can be installed by pip, but not by uv.</p>
<p>According to the auditwheel policy file for manylinux, the oldest version of manylinux that supports riscv64 is <a href="https://github.com/pypa/auditwheel/blob/main/src/auditwheel/policy/manylinux-policy.json#L326">2.31</a>.  Locally, I have tried modifying <a href="https://github.com/astral-sh/uv/blob/main/crates/uv-platform-tags/src/platform.rs#L111C12-L111C39">get_minimum_manylinux_minor</a> so that it returns 31 for riscv64.  Doing so allows the command shown above to work correctly, e.g.,</p>
<pre><code>$ uv pip install PyYAML-6.0.2-cp311-cp311-manylinux_2_35_riscv64.whl 
Using Python 3.11.4 environment at /home/HOME/uv-venv
Resolved 1 package in 165ms
Prepared 1 package in 174ms
Uninstalled 1 package in 14ms
Installed 1 package in 37ms
 - pyyaml==6.0.2
 + pyyaml==6.0.2 (from file:///home/HOME/PyYAML-6.0.2-cp311-cp311-manylinux_2_35_riscv64.whl)
</code></pre>
<p>I'd like to submit this small change to uv to enable it to install manylinux wheels on riscv64.  Would such a patch be acceptable?</p>
<p>Note, that <a href="https://riseproject.dev/">RISE</a> is currently building and distributing a small set of riscv64 binary wheels on its <a href="https://gitlab.com/riseproject/python/wheel_builder">gitlab</a>.    The majority of these wheels are manylinux_2_35 wheels and they cannot currently be installed by uv.  They can however, be installed using pip &gt;=24.1.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-11-07 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-07 15:35</div>
            <div class="timeline-body"><p>A PR to add risc64 manylinux support would be great!</p>
<p>It's totally not a requirement for the PR, but if you happen to have instructions how to test riscv things on an x86_64 or aarch64 machine, this helps the team to reproduce and debug riscv-specific problems (i've for example used qemu docker for other architectures before).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8934.html">astral-sh/uv#8934</a> on 2024-11-08 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markdryan">@markdryan</a> on 2024-11-08 12:30</div>
            <div class="timeline-body"><blockquote>
<p>'s totally not a requirement for the PR, but if you happen to have instructions how to test riscv things on an x86_64 or aarch64 machine, this helps the team to reproduce and debug riscv-specific problems (i've for example used qemu docker for other architectures before).</p>
</blockquote>
<p>I used a combination of a riscv64 container image running on an amd64 host to build the uv wheel which I then tested on a riscv64 VM running Ubuntu 23.10.   The riscv64 wheels distributed by RISE are also built and tested inside riscv64 container images running on an amd64 host.</p>
<p>A few observations.  I did try and run the uv tests in the riscv64 container image but I got a fair few failures (with and without the manylinux patch).  Some of these were timeouts and some seemed to be caused by missing riscv64 packages at PyPi.  The build of the wheel itself probably took about an hour with maturin.</p>
<p>I did try originally building and testing on a VisionFive2 (a riscv64 SBC) running Ubuntu 24.04 but the build was killed after about an hour due to an OOM error.  My VisionFive2 only has 8GB of RAM.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-11-08 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-11-08 15:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:25 UTC
    </footer>
</body>
</html>
