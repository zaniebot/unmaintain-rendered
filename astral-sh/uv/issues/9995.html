<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to unzip wheel - astral-sh/uv #9995</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to unzip wheel</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9995">#9995</a>
        opened by <a href="https://github.com/gumikola">@gumikola</a>
        on 2024-12-18 12:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gumikola">@gumikola</a> on 2024-12-18 12:48</div>
            <div class="timeline-body"><p>Hi all!</p>
<p>I have problem to install torch on Linux using this command from docs. I get this:</p>
<pre><code>&gt; uv pip install torch  --index-url https://download.pytorch.org/whl/cpu 
⠦ torch==2.5.1+cpu                                                                                                                                                      
error: Failed to unzip wheel: torch-2.5.1+cpu-cp312-cp312-linux_x86_64.whl
  Caused by: unable to locate the end of central directory record`
</code></pre>
<p>This problem not occurred when using classic pip at this same machine.</p>
<p>Environment:</p>
<ul>
<li>uv: 0.5.10</li>
<li>system: Red Hat Enterprise Linux 8.10 (Ootpa)</li>
<li>kernel: 4.18.0-553.32.1.el8_10.x86_64</li>
<li>network: Using NTML proxy to bypass corporation network. Using for this $HTTP_PROXY and $HTTPS_PROXY  environment variables.</li>
</ul>
<p>Logs with verbosity:</p>
<p>uv:</p>
<pre><code>&gt; uv pip install torch  --index-url https://download.pytorch.org/whl/cpu -vvv
    0.000032s DEBUG uv uv 0.5.10
 uv_requirements::specification::from_source source=torch
    0.000600s DEBUG uv_python::discovery Searching for default Python interpreter in virtual environments
    0.000853s DEBUG uv_python::discovery Found `cpython-3.12.8-linux-x86_64-gnu` at `/apps/home/mikguz/new_test/.venv/bin/python3` (virtual environment)
    0.000962s DEBUG uv::commands::pip::operations Using Python 3.12.8 environment at: .venv
    0.001167s DEBUG uv_fs Acquired lock for `.venv`
    0.001548s DEBUG uv::commands::pip::install At least one requirement is not satisfied: torch
 uv_client::linehaul::linehaul
    0.003313s DEBUG uv_client::base_client Using request timeout of 120s
 uv_resolver::flat_index::from_entries
 uv_resolver::resolver::solve
    0.007412s   0ms DEBUG uv_resolver::resolver Solving with installed Python version: 3.12.8
    0.007425s   0ms DEBUG uv_resolver::resolver Solving with target Python version: &gt;=3.12.8
   uv_resolver::resolver::choose_version package=root
   uv_resolver::resolver::get_dependencies_forking package=root, version=0a0.dev0
     uv_resolver::resolver::get_dependencies package=root, version=0a0.dev0
    0.007680s   0ms DEBUG uv_resolver::resolver Adding direct dependency: torch*
   uv_resolver::resolver::choose_version package=torch
 uv_resolver::resolver::process_request request=Versions torch
   uv_client::registry_client::simple_api package=torch
     uv_client::cached_client::get_cacheable_with_retry
       uv_client::cached_client::get_cacheable
         uv_client::cached_client::read_and_parse_cache file=/apps/home/mikguz/.cache/uv/simple-v14/index/e1d141a6ca947dff/torch.rkyv
 uv_resolver::resolver::process_request request=Prefetch torch *
 uv_client::cached_client::from_path_sync path=&quot;/apps/home/mikguz/.cache/uv/simple-v14/index/e1d141a6ca947dff/torch.rkyv&quot;
          0.008057s   0ms DEBUG uv_client::cached_client No cache entry for: https://download.pytorch.org/whl/cpu/torch/
         uv_client::cached_client::fresh_request url=&quot;https://download.pytorch.org/whl/cpu/torch/&quot;
         uv_client::cached_client::new_cache file=/apps/home/mikguz/.cache/uv/simple-v14/index/e1d141a6ca947dff/torch.rkyv
         uv_client::registry_client::parse_simple_api package=torch
           uv_client::html::parse url=https://download.pytorch.org/whl/cpu/torch/
   uv_resolver::version_map::from_metadata
   uv_distribution::distribution_database::get_or_build_wheel_metadata dist=torch==2.5.1+cpu
     uv_client::registry_client::wheel_metadata built_dist=torch==2.5.1+cpu
       uv_client::cached_client::get_serde_with_retry
         uv_client::cached_client::get_cacheable_with_retry
           uv_client::cached_client::get_cacheable
             uv_client::cached_client::read_and_parse_cache file=/apps/home/mikguz/.cache/uv/wheels-v3/index/e1d141a6ca947dff/torch/torch-2.5.1+cpu-cp312-cp312-linux_x86_64.msgpack
      0.749276s 741ms DEBUG uv_resolver::resolver Searching for a compatible version of torch (*)
      0.749344s 741ms DEBUG uv_resolver::resolver Selecting: torch==2.5.1+cpu [compatible] (torch-2.5.1+cpu-cp312-cp312-linux_x86_64.whl)
   uv_resolver::resolver::get_dependencies_forking package=torch, version=2.5.1+cpu
     uv_resolver::resolver::get_dependencies package=torch, version=2.5.1+cpu
 uv_client::cached_client::from_path_sync path=&quot;/apps/home/mikguz/.cache/uv/wheels-v3/index/e1d141a6ca947dff/torch/torch-2.5.1+cpu-cp312-cp312-linux_x86_64.msgpack&quot;
              0.749644s   0ms DEBUG uv_client::cached_client No cache entry for: https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp312-cp312-linux_x86_64.whl#sha256=4856f9d6925121d13c2df07aa7580b767f449dfe71ae5acde9c27535d5da4840
             uv_client::cached_client::fresh_request url=&quot;https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp312-cp312-linux_x86_64.whl#sha256=4856f9d6925121d13c2df07aa7580b767f449dfe71ae5acde9c27535d5da4840&quot;
             uv_client::cached_client::new_cache file=/apps/home/mikguz/.cache/uv/wheels-v3/index/e1d141a6ca947dff/torch/torch-2.5.1+cpu-cp312-cp312-linux_x86_64.msgpack
             uv_client::registry_client::read_metadata_range_request wheel=torch-2.5.1+cpu-cp312-cp312-linux_x86_64.whl
    0.886816s DEBUG uv_fs Released lock at `/apps/home/mikguz/new_test/.venv/.lock`
error: Failed to unzip wheel: torch-2.5.1+cpu-cp312-cp312-linux_x86_64.whl
  Caused by: unable to locate the end of central directory record
</code></pre>
<p>pip:</p>
<pre><code>&gt; pip install torch  --index-url https://download.pytorch.org/whl/cpu -v
Using pip 24.3.1 from /apps/home/mikguz/new_test/.venv/lib/python3.12/site-packages/pip (python 3.12)
Looking in indexes: https://download.pytorch.org/whl/cpu
Collecting torch
  Downloading https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp312-cp312-linux_x86_64.whl (174.6 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 174.6/174.6 MB 10.7 MB/s eta 0:00:00
Collecting filelock (from torch)
  Downloading https://download.pytorch.org/whl/filelock-3.13.1-py3-none-any.whl (11 kB)
Requirement already satisfied: typing-extensions&gt;=4.8.0 in ./.venv/lib/python3.12/site-packages (from torch) (4.9.0)
Collecting networkx (from torch)
  Downloading https://download.pytorch.org/whl/networkx-3.2.1-py3-none-any.whl (1.6 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.6/1.6 MB 20.6 MB/s eta 0:00:00
Collecting jinja2 (from torch)
  Downloading https://download.pytorch.org/whl/Jinja2-3.1.3-py3-none-any.whl (133 kB)
Collecting fsspec (from torch)
  Downloading https://download.pytorch.org/whl/fsspec-2024.2.0-py3-none-any.whl (170 kB)
Collecting setuptools (from torch)
  Downloading https://download.pytorch.org/whl/setuptools-70.0.0-py3-none-any.whl (863 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 863.4/863.4 kB 12.3 MB/s eta 0:00:00
Requirement already satisfied: sympy==1.13.1 in ./.venv/lib/python3.12/site-packages (from torch) (1.13.1)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in ./.venv/lib/python3.12/site-packages (from sympy==1.13.1-&gt;torch) (1.3.0)
Collecting MarkupSafe&gt;=2.0 (from jinja2-&gt;torch)
  Downloading https://download.pytorch.org/whl/MarkupSafe-2.1.5-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (28 kB)
Installing collected packages: setuptools, networkx, MarkupSafe, fsspec, filelock, jinja2, torch
  changing mode of /apps/home/mikguz/new_test/.venv/bin/convert-caffe2-to-onnx to 775
  changing mode of /apps/home/mikguz/new_test/.venv/bin/convert-onnx-to-caffe2 to 775
  changing mode of /apps/home/mikguz/new_test/.venv/bin/torchfrtrace to 775
  changing mode of /apps/home/mikguz/new_test/.venv/bin/torchrun to 775
Successfully installed MarkupSafe-2.1.5 filelock-3.13.1 fsspec-2024.2.0 jinja2-3.1.3 networkx-3.2.1 setuptools-70.0.0 torch-2.5.1+cpu
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-12-18 12:51</div>
            <div class="timeline-body"><p>I can't reproduce this locally, this looks like some network problem. Could it be that proxy you're using interferes with range requests?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">network</span> added by @konstin on 2024-12-18 12:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gumikola">@gumikola</a> on 2024-12-18 13:46</div>
            <div class="timeline-body"><blockquote>
<p>Could it be that proxy you're using interferes with range requests?</p>
</blockquote>
<p>Hard to say. I have now tried curl with the <code>-r</code> flag and it works.
If I understand correctly, uv download wheel not in sequence but split into parts and get these parts simultaneously using <code>Range</code> header?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-12-18 13:53</div>
            <div class="timeline-body"><p>uv is split into resolution and installation. Doing resolution, we only want the metadata of a wheel. This metadata is in a file called <code>METADATA</code> in the dist-info directory. Instead of download the whole wheel for just the resolution that we might not even env up using, we're doing range requests to just read that file out of the remove zip. To find the file in the zip, we first need to read the central directory of the zip, which here seems to fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @konstin on 2024-12-19 10:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gumikola">@gumikola</a> on 2025-07-18 12:29</div>
            <div class="timeline-body"><p>The issue does not appear in the new version (uv 0.8.0).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @gumikola on 2025-07-18 12:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
