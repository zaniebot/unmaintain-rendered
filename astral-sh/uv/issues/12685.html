<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv hides the password prompt when updating protected git dependencies - astral-sh/uv #12685</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv hides the password prompt when updating protected git dependencies</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/12685">#12685</a>
        opened by <a href="https://github.com/timinou">@timinou</a>
        on 2025-04-05 10:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/timinou">@timinou</a> on 2025-04-05 10:43</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Current uv version: 0.6.9</p>
<p>Steps:</p>
<ul>
<li>Add a protected repository to your pyproject.toml (using the scheme in <a href="https://docs.astral.sh/uv/configuration/authentication/#git-authentication">uv's Authentication page</a></li>
<li>Try running <code>uv sync</code> without having authenticated using an ssh agent (i.e. a protected git action would ask you for your SSH passphrase)</li>
<li>You will see and 'Updating' message that looks like it's hanging</li>
</ul>
<p>In reality, the prompt to enter the password is waiting for my input, but I don't see it because uv overwrites the terminal output with the 'updating' message. But if I write the passphrase in and press Return, the rest of the process will work. If I press Return directly without having inputted the password, this is what it tells me:</p>
<pre><code>   Updating ssh://git@github.com/&lt;ORG&gt;/&lt;REPO&gt;.git (&lt;REV&gt;)
   Updating ssh://git@github.com/&lt;ORG&gt;/&lt;REPO&gt;.git (&lt;REV&gt;)
   Updating ssh://git@github.com/&lt;ORG&gt;/&lt;REPO&gt;.git (&lt;REV&gt;)
√ó Failed to download and build `&lt;PRIVATE_MODULE&gt; @ git+ssh://git@github.com/&lt;ORG&gt;/&lt;REPO&gt;.git@&lt;REV&gt;#subdirectory=&lt;SUBDIR&gt;`
  ‚îú‚îÄ‚ñ∂ Git operation failed
  ‚îú‚îÄ‚ñ∂ failed to fetch into: /home/user/.cache/uv/git-v0/db/68a9919451567481
  ‚îú‚îÄ‚ñ∂ failed to fetch branch, tag, or commit `&lt;REV&gt;`
  ‚ï∞‚îÄ‚ñ∂ process didn't exit successfully: `/usr/bin/git fetch --tags --force --update-head-ok 'ssh://git@github.com/&lt;ORG&gt;/&lt;REPO&gt;.git' '+refs/heads/*:refs/remotes/origin/*' '+HEAD:refs/remotes/origin/HEAD'` (exit
      status: 128)
      --- stderr
      git@github.com: Permission denied (publickey).
      fatal: Could not read from remote repository.

      Please make sure you have the correct access rights
      and the repository exists.
</code></pre>
<p>When I input the password, it briefly shows the git 'Git passphrase' prompt then uv sync goes as normal.</p>
<p>Thank you!</p>
<h3>Platform</h3>
<p>Linux 6.13.8-zen1-1-zen x86_64 GNU/Linux (Arch btw)</p>
<h3>Version</h3>
<p>uv 0.6.9 (3d9460278 2025-03-20)</p>
<h3>Python version</h3>
<p>Python 3.12.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @timinou on 2025-04-05 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-05 14:40</div>
            <div class="timeline-body"><p>Looks like a duplicate of</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/3783</li>
<li>https://github.com/astral-sh/uv/issues/5107</li>
</ul>
<p>Which should have been fixed by</p>
<ul>
<li>https://github.com/astral-sh/uv/pull/11744</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @jtfmumm on 2025-04-11 07:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abdelq">@abdelq</a> on 2025-04-22 21:39</div>
            <div class="timeline-body"><p>@zanieb @jtfmumm  I'm on 0.6.16, fresh OS and uv install.
The mitigation assumes the user has set up GUI prompting for SSH which isn't the default.
There is no obvious error message that would lead someone to think of this.</p>
<p>Still getting &quot;Preparing packages...&quot; while waiting on multiple dependencies to be installed just like OP.</p>
<p>I personally don't believe this issue is fully resolved.</p>
<hr />
<p>Looking at the regression test. I actually think the mitigation only works for HTTPS (login with username/password) and most likely not with SSH as the prompt is not coming from <code>git</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @jtfmumm on 2025-04-23 05:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/pulls/3761.html">prefix-dev/pixi#3761</a> on 2025-05-13 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3783.html">astral-sh/uv#3783</a> on 2025-06-03 15:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/darmstrong8008">@darmstrong8008</a> on 2025-06-17 23:04</div>
            <div class="timeline-body"><p>Just chiming in to confirm this behavior is present on 0.7.13</p>
<pre><code>‚ùØ uv self update
info: Checking for updates...
success: You're on the latest version of uv (v0.7.13)
</code></pre>
<p>The ssh input prompt is silently waiting, and accepts input just fine when it reaches this point where it appears to hang. Sometimes the prompt will display momentarily before it reaches the point where <code>Resolving dependencies...</code> is drawn :</p>
<pre><code>uv pip install &quot;git+ssh://git@github.com/private/repo&quot;
  Updating ssh://git@github.com/private/repo (HEAD)
Resolving dependencies...
</code></pre>
<p>I wonder if the little animation prepended to <code>Resolving dependencies...</code> has anything to do with it, since it works fine if invoked with <code>-v</code> and nothing is being re-drawn in the cell it occupies in the terminal otherwise ü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-18 14:37</div>
            <div class="timeline-body"><p>Yeah, the spinner is what hides the prompt ‚Äî but I don't think we forward stdin so I don't know if it's usable anyway? We should find a way to disable the SSH prompt in the same way we do for the HTTPS one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/darmstrong8008">@darmstrong8008</a> on 2025-06-18 19:53</div>
            <div class="timeline-body"><p>If you're talking about the prompt I can confirm it is usable with or without the debug statements. Looks like the prompt is handled by the <code>ssh -o SendEnv=GIT_PROTOCOL ... </code> command.</p>
<p>Here is my process tree, if it helps at all:</p>
<pre><code>‚ùØ pstree -p 171502 -a
uv,171502 pip install git+ssh://git@github.com/private/repo
  |-git,171525 fetch --force --update-head-ok ssh://git@github.com/private/repo ...
  |   `-ssh,171526 -o SendEnv=GIT_PROTOCOL git@github.com git-upload-pack '/private/repo'

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nkronenfeld">@nkronenfeld</a> on 2025-10-22 18:45</div>
            <div class="timeline-body"><p>I still see this happening.</p>
<p>Using either <code>-v</code> or <code>--no-progress</code> shows the password <em>prompt</em> - but still doesn't read the password itself correctly, so I can't update any of my dependencies.</p>
<p>If it matters, my dependencies are on specific branches of private repositories.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:27 UTC
    </footer>
</body>
</html>
