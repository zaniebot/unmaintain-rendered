```yaml
number: 7346
title: "`uv build` panicing @ the modal disco in `src/commands/build.rs` "
type: issue
state: closed
author: anthonycorletti
labels:
  - bug
assignees: []
created_at: 2024-09-12T23:30:03Z
updated_at: 2024-09-13T14:52:26Z
url: https://github.com/astral-sh/uv/issues/7346
synced_at: 2026-01-10T01:57:16Z
```

# `uv build` panicing @ the modal disco in `src/commands/build.rs` 

---

_Issue opened by @anthonycorletti on 2024-09-12 23:30_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->
Hello! 

I experienced an interesting quirk when I was building images on Modal (modal.com). `uv build` fails during image creation when I define an image like so:

```python
# here's the definition
image = (
    Image.debian_slim()
    .pip_install("uv")
    .copy_local_file("pyproject.toml", "/pyproject.toml")
    .copy_local_file("uv.lock", "/uv.lock")
    .env({"UV_PROJECT_ENVIRONMENT": "/usr/local"})
    .run_commands(
        [
            "uv sync --frozen --compile-bytecode",
            "uv build",
        ]
    )
)
```

```sh
# here's the error 
=> Step 2: RUN uv build
thread 'main' panicked at /home/runner/work/uv/uv/crates/uv/src/commands/build.rs:351:45:
called `Option::unwrap()` on a `None` value
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
Terminating task due to error: failed to run builder command "uv build"

Caused by:
    container exit status: 101
╭─ Error ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
│ Image build for im-WkUYKdIswH3MiW8mLDbyFN failed with the exception:                                                                                                                                                      │
│ task exited with failure, status = exit status: 1                                                                                                                                                                         │
╰───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
```


the fix was adding a `workdir` for modal's image container builder. not sure why.


```python
image = (
    Image.debian_slim()
    .pip_install("uv")
    .workdir("/work") # <= work work work work work
    .copy_local_file("pyproject.toml", "/work/pyproject.toml")
    .copy_local_file("uv.lock", "/work/uv.lock")
    .env({"UV_PROJECT_ENVIRONMENT": "/usr/local"})
    .run_commands(
        [
            "uv sync --frozen --compile-bytecode",
            "uv build",
        ]
    )
)
```

if you'd like to view some of the example code I was using to test this, ive posted the example code here: https://github.com/anthonycorletti/modal-asgi-lifecycle-example/blob/main/app/_modal.py

not sure if this is recommended. lmk if im doing something incorrectly. thanks for all the work you do!

cc @thundergolfer 

---

_Comment by @charliermarsh on 2024-09-13 01:47_

We use the current working directory name there, but we can make it robust to that being empty -- it's just for logging / debugging. I'll fix it tomorrow.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-09-13 01:47_

---

_Label `bug` added by @charliermarsh on 2024-09-13 01:47_

---

_Referenced in [astral-sh/uv#7362](../../astral-sh/uv/pulls/7362.md) on 2024-09-13 14:35_

---

_Closed by @charliermarsh on 2024-09-13 14:52_

---

_Closed by @charliermarsh on 2024-09-13 14:52_

---
