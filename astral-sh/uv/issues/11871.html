<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync with find-links not locating wheels in the provided folder - astral-sh/uv #11871</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv sync with find-links not locating wheels in the provided folder</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/11871">#11871</a>
        opened by <a href="https://github.com/stumpylog">@stumpylog</a>
        on 2025-02-28 23:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-02-28 23:01</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hopefully not a duplicate, but I wasn't able to locate anything existing in the tracker.</p>
<p>We pre-build some packages and <code>curl</code> them into the image ahead of time so CI doesn't need to build the same thing over and over.  We're now trying to transition to <code>uv</code> and finding it doesn't seem to find those local packages.</p>
<p>The current directory:</p>
<pre><code class="language-bash">drwxr-xr-x 1 root root 4.0K Feb 28 22:52 .
drwxr-xr-x 1 root root 4.0K Feb 28 20:13 ..
-rw-r--r-- 1 root root 2.2M Feb 28 22:52 psycopg_c-3.2.4-cp312-cp312-linux_aarch64.whl
-rw-r--r-- 1 root root 2.3M Feb 28 22:52 psycopg_c-3.2.4-cp312-cp312-linux_x86_64.whl
-rw-rw-r-- 1 1000 1000 2.9K Feb 28 21:56 pyproject.toml
-rw-rw-r-- 1 1000 1000 493K Feb 28 21:46 uv.lock
-rw-r--r-- 1 root root 878K Feb 28 22:52 zxing_cpp-2.3.0-cp312-cp312-linux_aarch64.whl
-rw-r--r-- 1 root root 936K Feb 28 22:52 zxing_cpp-2.3.0-cp312-cp312-linux_x86_64.whl
</code></pre>
<p>Running this uv command:
<code>uv sync --verbose --frozen --no-dev --no-python-downloads --python-preference system --find-links ./ --no-build-package zxing-cpp --no-build-package psycopg-c</code></p>
<p>fails with
<code>error: Distribution 'psycopg-c==3.2.4 @ registry+https://pypi.org/simple\' can't be installed because it is marked as '--no-build' but has no binary distribution</code></p>
<p>I would expect uv to locate the wheel that already exists and install from it, instead of wanting to build the file again.  I have also tried moving the wheel files to a folder and providing that to <code>--find-links</code>, which did not change the behavior.</p>
<h3>Platform</h3>
<p>Debian Bookworm (slim)</p>
<h3>Version</h3>
<p>0.6.3</p>
<h3>Python version</h3>
<p>3.12.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @stumpylog on 2025-02-28 23:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-28 23:04</div>
            <div class="timeline-body"><p>Interesting, thanks. I presume we're just not invalidating the lockfile here? Does it work if you explicitly lock first with <code>uv lock --find-links ...</code> or if you put <code>find-links</code> on your <code>pyproject.toml</code>? (just to try to rule out a few things)</p>
<p>If that has no effect, can you share a MRE in a Git repository or something so we can debug?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-02-28 23:14</div>
            <div class="timeline-body"><p>I threw together a smaller version here: https://github.com/stumpylog/uv-find-links-mre.  Just a docker build should produce it.</p>
<p>Adding <code>uv lock --find-links ./</code> before the sync doesn't seem to have an effect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-01 00:20</div>
            <div class="timeline-body"><p>Hmm, this seems expected though, right? You're locking against PyPI, but then trying to sync against a different package source (your local directory).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-03-01 00:40</div>
            <div class="timeline-body"><p>It was unexpected to me.  At least the documentation seems to indicate wheel files here will be used. Nothing about where the lock source is.  This sort of thing is probably pretty common, maybe more for musl</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-01 00:44</div>
            <div class="timeline-body"><p>If you look at the error message, the way to think of it is: uv is trying to install <code>psycopg-c==3.2.4 @ registry+https://pypi.org/simple</code>, i.e., it needs to find <code>psycopg-c</code> from PyPI. So it can't be content with installing an arbitrary built <code>psycopg-c</code> that exists in a local directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-03-01 00:53</div>
            <div class="timeline-body"><p>If I'm understanding them, to do this everyone on the team would need to download the wheels to a folder, named the same and then I lock with find-links pointing there?</p>
<p>Is there any better solution?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-01 01:08</div>
            <div class="timeline-body"><p>Why do the wheels need to be downloaded? Can you not include the <code>--find-links</code> URL as a source when you lock? That would be my suggestion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-03-02 02:45</div>
            <div class="timeline-body"><p>I'd prefer to keep these downloaded only for the Docker image, rather than all users or developers.  Before I assume this is therefore intended, is there a reason why adding <code>uv lock --find-links ./</code> before the install wouldn't have updated the package source?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-02 02:58</div>
            <div class="timeline-body"><p>You'd probably need to <code>rm uv.lock</code> or use <code>--upgrade</code>? Otherwise, we won't invalidate the lock due to the addition of a source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-03-02 03:08</div>
            <div class="timeline-body"><p>Alright, I'll have to re-think this further.  Sadly it appears a Github release page doesn't work for finding links either, even if I wanted to go that route.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @stumpylog on 2025-03-02 03:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-03-02 15:25</div>
            <div class="timeline-body"><p>Sorry to keep asking questions, but why would this not attempt to pull in the wheels?  It seems to be valid, but does not get added to uv.lock in any fashion.</p>
<pre><code class="language-toml">[tool.uv.sources]
psycopg-c = [
 { url = &quot;https://github.com/paperless-ngx/builder/releases/download/psycopg-3.2.4/psycopg_c-3.2.4-cp312-cp312-linux_x86_64.whl&quot;, marker = &quot;sys_platform == 'linux' and platform_machine == 'x86_64' and python_version == '3.12'&quot; },
 { url = &quot;https://github.com/paperless-ngx/builder/releases/download/psycopg-3.2.4/psycopg_c-3.2.4-cp312-cp312-linux_aarch64.whl&quot;, marker = &quot;sys_platform == 'linux' and platform_machine == 'aarch64' and python_version == '3.12'&quot; },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-02 15:28</div>
            <div class="timeline-body"><p>It looks fine but I think I'd need a more complete example to help you out. Is <code>pyscopg-c</code> directly as a dependency in the same file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stumpylog">@stumpylog</a> on 2025-03-02 15:58</div>
            <div class="timeline-body"><p>It's not a direct dependency, it's pulled in by an extra.  The project I'm playing around with is https://github.com/stumpylog/uv-find-links-mre/blob/main/pyproject.toml</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:26 UTC
    </footer>
</body>
</html>
