<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minor Points/Suggestions on Install Script - astral-sh/uv #6304</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Minor Points/Suggestions on Install Script</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6304">#6304</a>
        opened by <a href="https://github.com/stevenwalton">@stevenwalton</a>
        on 2024-08-21 07:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/stevenwalton">@stevenwalton</a> on 2024-08-21 07:27</div>
            <div class="timeline-body"><p>I've noticed a few little things in the install script that might be worth editing and could make it easier to maintain.</p>
<p>First off, thank you for wrapping the script in main! While I still think piping into <code>sh</code> is bad, it could be worse. If you don't want to pipe into bash, this is a better alternative. Longer, but we copy paste anyways, right?</p>
<pre><code class="language-bash"> curl -SsLf  https://astral.sh/uv/install.sh -o /tmp/uv_install.sh &amp;&amp; sh /tmp/uv_install.sh 
</code></pre>
<p>First off, there's <code>#!/bin/sh</code>. A better alternative would be <a href="https://www.baeldung.com/linux/bash-shebang-lines"><code>#!/usr/bin/env bash</code></a> as it'll provide some better flexibility and respect the user's <code>$PATH</code></p>
<p>In the globals we have</p>
<pre><code class="language-bash">APP_VERSION=&quot;0.3.0&quot;
ARTIFACT_DOWNLOAD_URL=&quot;${INSATLLER_DOWNLOAD_URL:-https://github.com/astral-sh/uv/releases/download/0.3.0}&quot;
</code></pre>
<p>This is fine but will not be flexible and needs to be modified each time a version is bumped. Instead, you can do the following</p>
<pre><code class="language-bash">GIT_URL=&quot;${GIT_URL:-https://github.com/astral-sh/uv/}&quot;
APP_VERSION=&quot;${APP_VERSION:-$(curl -Ls -o /dev/null -w %{url_effective} &quot;${GIT_URL%/}/releases/latest/&quot; | rev | cut -d &quot;/&quot; -f1 | rev)}&quot;
ARTIFACT_DOWNLOAD_URL=&quot;${INSTALLER_DOWNLOAD_URL:-${GIT_URL%/}/releases/download/${APP_VERSION}}
</code></pre>
<ul>
<li>The first line allows flexibility if the Git URL changes or if someone downloads a fork they can easily use the script for theirs without needing to edit the version variable (though I think this should exist somewhere).</li>
<li>The second line defaults the version to the latest release, but also allows an override in case someone doesn't want to.</li>
<li>Third line now points to whatever version the user requested (or a complete alternative).</li>
</ul>
<p>This should then allow you to clean up <code>json_binary_aliases</code> and <code>aliases_for_binary</code> since you can do</p>
<pre><code class="language-bash"># Works on linux and OSX
regex=&quot;(.*${ARTIFACT_DOWNLOAD_URL}.*&gt;)(.*(tar.gz|zip))(&lt;/a&gt;.*$)&quot;
# Probably better to add
# IFS=$'\n'
declare -a packages=( $(curl -s &quot;${ARTIFACT_DOWNLOAD_URL//download\//}&quot; | grep -E &quot;${regex}&quot; | sed -E &quot;s@${regex}@\2@p&quot; | uniq) )
# then `unset IFS`
</code></pre>
<p>to get all the packages and then of course you can now just grep the array and get the version you want. Or since you do <code>get_architecture</code> first, you can modify the regex to include the appropriate file and probably just avoid the array in general.</p>
<p>I believe this should allow users to then have full control over versioning from the install script (might as well add a version flag while you're at it).</p>
<p>And <code>usage</code> can be fixed too.</p>
<p>I hope this can save you time when releasing new versions and simplifying the install script. Feel free to just close this issue if these are things you don't want to modify. There's some more things like this littered through the script that could make it more efficient but this should help clear a few hundred lines for you.</p>
<p>Edit: mistakenly wrote <code>/usr/bin/sh</code> instead of <code>/usr/bin/env</code>. Thanks @severen</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/severen">@severen</a> on 2024-08-21 07:36</div>
            <div class="timeline-body"><blockquote>
<p>First off, there's #!/bin/sh. A better alternative would be <a href="https://www.baeldung.com/linux/bash-shebang-lines">#!/usr/bin/sh bash</a> as it'll provide some better flexibility and respect the user's $PATH</p>
</blockquote>
<p>Did you mean <code>#!/usr/bin/env bash</code>? That's the usual idiom.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by @charliermarsh on 2024-08-21 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">installer</span> added by @charliermarsh on 2024-08-21 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">installer</span> removed by @charliermarsh on 2024-08-21 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 15:40</div>
            <div class="timeline-body"><p>Thank you! I passed these along to the Axo team -- they maintain <a href="https://github.com/axodotdev/cargo-dist">cargo-dist</a>, which we use to generate the installers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-21 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stevenwalton">@stevenwalton</a> on 2024-08-21 21:09</div>
            <div class="timeline-body"><p>@severen haha yes I did. Thanks for the catch. I'll make a quick edit.</p>
<p>@charliermarsh awesome! Lots of lost bash lore these days. I wasn't aware of that project and I'll have to check it out. And thanks for the tweets.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/axel-kah">@axel-kah</a> on 2024-10-27 21:59</div>
            <div class="timeline-body"><p>FYI: #8069 will enable redefining the github base url used to fetch github release artifacts by the script. Seems like that's part of what you requested.</p>
<p>EDIT: not quite ... #8069 is really only about the self-update feature of the distributed apps and not about the installer scripts.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:33 UTC
    </footer>
</body>
</html>
