```yaml
number: 11084
title: Installing uv in a Docker container on Raspberry Pi (ARM)
type: issue
state: open
author: carrollpaul
labels:
  - question
assignees: []
created_at: 2025-01-29T21:57:37Z
updated_at: 2025-01-30T21:03:09Z
url: https://github.com/astral-sh/uv/issues/11084
synced_at: 2026-01-10T01:57:25Z
```

# Installing uv in a Docker container on Raspberry Pi (ARM)

---

_Issue opened by @carrollpaul on 2025-01-29 21:57_

### Question

I'm trying to use `uv` in a Docker container on my Raspberry Pi. Here's the Dockerfile:
```Dockerfile
FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim

# Install the project into `/app`
WORKDIR /app

ENV UV_COMPILE_BYTECODE=1

# Copy from the cache instead of linking since it's a mounted volume
ENV UV_LINK_MODE=copy

# Install the project's dependencies using the lockfile and settings
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev

# Then, add the rest of the project source code and install it
ADD . /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# Place executables in the environment at the front of the path
ENV PATH="/app/.venv/bin:$PATH"

# Reset the entrypoint, don't invoke `uv`
ENTRYPOINT []

# Run the FastAPI application by default
CMD ["fastapi", "dev", "--host", "0.0.0.0", "src/main.py"]
```
This works fine on my Apple M1 Pro laptop and my Windows 10 PC. However, on my Pi I see this error:

```
[+] Building 1.1s (8/8) FINISHED                                                                                                                                                                                                      docker:default
 => [backend internal] load build definition from Dockerfile                                                                                                                                                                                    0.0s
 => => transferring dockerfile: 1.08kB                                                                                                                                                                                                          0.0s
 => [frontend internal] load build definition from Dockerfile                                                                                                                                                                                   0.1s
 => => transferring dockerfile: 85B                                                                                                                                                                                                             0.0s
 => ERROR [backend internal] load metadata for ghcr.io/astral-sh/uv:python3.12-bookworm-slim                                                                                                                                                    0.4s
 => [frontend internal] load metadata for docker.io/library/nginx:alpine                                                                                                                                                                        0.4s
 => [frontend internal] load .dockerignore                                                                                                                                                                                                      0.1s
 => => transferring context: 2B                                                                                                                                                                                                                 0.0s
 => [frontend internal] load build context                                                                                                                                                                                                      0.1s
 => => transferring context: 501B                                                                                                                                                                                                               0.0s
 => CACHED [frontend 1/2] FROM docker.io/library/nginx:alpine@sha256:814a8e88df978ade80e584cc5b333144b9372a8e3c98872d07137dbf3b44d0e4                                                                                                           0.0s
 => CANCELED [frontend 2/2] COPY . /usr/share/nginx/html/                                                                                                                                                                                       0.4s
------
 > [backend internal] load metadata for ghcr.io/astral-sh/uv:python3.12-bookworm-slim:
------
failed to solve: ghcr.io/astral-sh/uv:python3.12-bookworm-slim: failed to resolve source metadata for ghcr.io/astral-sh/uv:python3.12-bookworm-slim: no match for platform in manifest: not found
```
I'm guessing this has to with the Pi being an ARM CPU. Is that intuition correct? And if so, what changes can I make to use `uv` on the Pi?

### Platform

Linux 6.1.21-v8+ aarch64 GNU/Linux

### Version

uv 0.5.24

---

_Label `question` added by @carrollpaul on 2025-01-29 21:57_

---

_Comment by @zanieb on 2025-01-29 22:06_

That's surprising I think they should use the same image architecture?

Perhaps try the strategy from https://github.com/astral-sh/uv/issues/10942

---

_Comment by @carrollpaul on 2025-01-29 22:23_

This Dockerfile indeed works on the Pi!
```Dockerfile
FROM python:3.12-slim-bookworm
RUN apt update && apt install curl -y
RUN curl --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
RUN ~/.local/bin/uv version
```

---

_Comment by @carrollpaul on 2025-01-29 22:25_

But when I try that on my Mac:
```
 => ERROR [backend stage-0 4/8] RUN ~/.local/bin/uv version                                                                           0.2s
------
 > [backend stage-0 4/8] RUN ~/.local/bin/uv version:
0.184 /bin/sh: 1: /root/.local/bin/uv: not found
------
failed to solve: process "/bin/sh -c ~/.local/bin/uv version" did not complete successfully: exit code: 127
```

---

_Comment by @zanieb on 2025-01-29 22:31_

That Dockerfile runs fine on my M3 mac

```
â¯ docker build . --no-cache --progress plain
#0 building with "orbstack" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 256B done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/python:3.12-slim-bookworm
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [1/4] FROM docker.io/library/python:3.12-slim-bookworm@sha256:69ce3aed05675d284bee807e7c45e560e98db21fb1e4c670252b4ee0f2496b6d
#4 CACHED

#5 [2/4] RUN apt update && apt install curl -y
#5 0.122 
#5 0.122 WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
#5 0.122 
#5 0.173 Get:1 http://deb.debian.org/debian bookworm InRelease [151 kB]
#5 0.222 Get:2 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]
#5 0.242 Get:3 http://deb.debian.org/debian-security bookworm-security InRelease [48.0 kB]
#5 0.271 Get:4 http://deb.debian.org/debian bookworm/main arm64 Packages [8693 kB]
#5 1.053 Get:5 http://deb.debian.org/debian bookworm-updates/main arm64 Packages [13.3 kB]
#5 1.060 Get:6 http://deb.debian.org/debian-security bookworm-security/main arm64 Packages [239 kB]
#5 1.593 Fetched 9199 kB in 1s (6291 kB/s)
#5 1.593 Reading package lists...
#5 1.791 Building dependency tree...
#5 1.838 Reading state information...
#5 1.843 All packages are up to date.
#5 1.845 
#5 1.845 WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
#5 1.845 
#5 1.857 Reading package lists...
#5 2.050 Building dependency tree...
#5 2.098 Reading state information...
#5 2.157 The following additional packages will be installed:
#5 2.157   libbrotli1 libcurl4 libldap-2.5-0 libldap-common libnghttp2-14 libpsl5
#5 2.157   librtmp1 libsasl2-2 libsasl2-modules libsasl2-modules-db libssh2-1
#5 2.157   publicsuffix
#5 2.157 Suggested packages:
#5 2.157   libsasl2-modules-gssapi-mit | libsasl2-modules-gssapi-heimdal
#5 2.157   libsasl2-modules-ldap libsasl2-modules-otp libsasl2-modules-sql
#5 2.215 The following NEW packages will be installed:
#5 2.215   curl libbrotli1 libcurl4 libldap-2.5-0 libldap-common libnghttp2-14 libpsl5
#5 2.215   librtmp1 libsasl2-2 libsasl2-modules libsasl2-modules-db libssh2-1
#5 2.215   publicsuffix
#5 2.252 0 upgraded, 13 newly installed, 0 to remove and 0 not upgraded.
#5 2.252 Need to get 1770 kB of archives.
#5 2.252 After this operation, 5014 kB of additional disk space will be used.
#5 2.252 Get:1 http://deb.debian.org/debian bookworm/main arm64 libbrotli1 arm64 1.0.9-2+b6 [269 kB]
#5 2.313 Get:2 http://deb.debian.org/debian bookworm/main arm64 libsasl2-modules-db arm64 2.1.28+dfsg-10 [20.8 kB]
#5 2.314 Get:3 http://deb.debian.org/debian bookworm/main arm64 libsasl2-2 arm64 2.1.28+dfsg-10 [58.0 kB]
#5 2.322 Get:4 http://deb.debian.org/debian bookworm/main arm64 libldap-2.5-0 arm64 2.5.13+dfsg-5 [171 kB]
#5 2.347 Get:5 http://deb.debian.org/debian bookworm/main arm64 libnghttp2-14 arm64 1.52.0-1+deb12u2 [68.6 kB]
#5 2.350 Get:6 http://deb.debian.org/debian bookworm/main arm64 libpsl5 arm64 0.21.2-1 [58.6 kB]
#5 2.354 Get:7 http://deb.debian.org/debian bookworm/main arm64 librtmp1 arm64 2.4+20151223.gitfa8646d.1-2+b2 [59.4 kB]
#5 2.361 Get:8 http://deb.debian.org/debian bookworm/main arm64 libssh2-1 arm64 1.10.0-3+b1 [172 kB]
#5 2.379 Get:9 http://deb.debian.org/debian bookworm/main arm64 libcurl4 arm64 7.88.1-10+deb12u8 [365 kB]
#5 2.417 Get:10 http://deb.debian.org/debian bookworm/main arm64 curl arm64 7.88.1-10+deb12u8 [309 kB]
#5 2.443 Get:11 http://deb.debian.org/debian bookworm/main arm64 libldap-common all 2.5.13+dfsg-5 [29.3 kB]
#5 2.444 Get:12 http://deb.debian.org/debian bookworm/main arm64 libsasl2-modules arm64 2.1.28+dfsg-10 [63.1 kB]
#5 2.448 Get:13 http://deb.debian.org/debian bookworm/main arm64 publicsuffix all 20230209.2326-1 [126 kB]
#5 2.541 debconf: delaying package configuration, since apt-utils is not installed
#5 2.548 Fetched 1770 kB in 0s (7386 kB/s)
#5 2.568 Selecting previously unselected package libbrotli1:arm64.
(Reading database ... 6680 files and directories currently installed.)
#5 2.570 Preparing to unpack .../00-libbrotli1_1.0.9-2+b6_arm64.deb ...
#5 2.601 Unpacking libbrotli1:arm64 (1.0.9-2+b6) ...
#5 2.633 Selecting previously unselected package libsasl2-modules-db:arm64.
#5 2.633 Preparing to unpack .../01-libsasl2-modules-db_2.1.28+dfsg-10_arm64.deb ...
#5 2.634 Unpacking libsasl2-modules-db:arm64 (2.1.28+dfsg-10) ...
#5 2.644 Selecting previously unselected package libsasl2-2:arm64.
#5 2.645 Preparing to unpack .../02-libsasl2-2_2.1.28+dfsg-10_arm64.deb ...
#5 2.646 Unpacking libsasl2-2:arm64 (2.1.28+dfsg-10) ...
#5 2.659 Selecting previously unselected package libldap-2.5-0:arm64.
#5 2.659 Preparing to unpack .../03-libldap-2.5-0_2.5.13+dfsg-5_arm64.deb ...
#5 2.660 Unpacking libldap-2.5-0:arm64 (2.5.13+dfsg-5) ...
#5 2.677 Selecting previously unselected package libnghttp2-14:arm64.
#5 2.678 Preparing to unpack .../04-libnghttp2-14_1.52.0-1+deb12u2_arm64.deb ...
#5 2.679 Unpacking libnghttp2-14:arm64 (1.52.0-1+deb12u2) ...
#5 2.692 Selecting previously unselected package libpsl5:arm64.
#5 2.693 Preparing to unpack .../05-libpsl5_0.21.2-1_arm64.deb ...
#5 2.694 Unpacking libpsl5:arm64 (0.21.2-1) ...
#5 2.712 Selecting previously unselected package librtmp1:arm64.
#5 2.713 Preparing to unpack .../06-librtmp1_2.4+20151223.gitfa8646d.1-2+b2_arm64.deb ...
#5 2.714 Unpacking librtmp1:arm64 (2.4+20151223.gitfa8646d.1-2+b2) ...
#5 2.729 Selecting previously unselected package libssh2-1:arm64.
#5 2.730 Preparing to unpack .../07-libssh2-1_1.10.0-3+b1_arm64.deb ...
#5 2.731 Unpacking libssh2-1:arm64 (1.10.0-3+b1) ...
#5 2.751 Selecting previously unselected package libcurl4:arm64.
#5 2.751 Preparing to unpack .../08-libcurl4_7.88.1-10+deb12u8_arm64.deb ...
#5 2.753 Unpacking libcurl4:arm64 (7.88.1-10+deb12u8) ...
#5 2.778 Selecting previously unselected package curl.
#5 2.778 Preparing to unpack .../09-curl_7.88.1-10+deb12u8_arm64.deb ...
#5 2.780 Unpacking curl (7.88.1-10+deb12u8) ...
#5 2.802 Selecting previously unselected package libldap-common.
#5 2.802 Preparing to unpack .../10-libldap-common_2.5.13+dfsg-5_all.deb ...
#5 2.804 Unpacking libldap-common (2.5.13+dfsg-5) ...
#5 2.822 Selecting previously unselected package libsasl2-modules:arm64.
#5 2.822 Preparing to unpack .../11-libsasl2-modules_2.1.28+dfsg-10_arm64.deb ...
#5 2.825 Unpacking libsasl2-modules:arm64 (2.1.28+dfsg-10) ...
#5 2.838 Selecting previously unselected package publicsuffix.
#5 2.839 Preparing to unpack .../12-publicsuffix_20230209.2326-1_all.deb ...
#5 2.840 Unpacking publicsuffix (20230209.2326-1) ...
#5 2.858 Setting up libpsl5:arm64 (0.21.2-1) ...
#5 2.902 Setting up libbrotli1:arm64 (1.0.9-2+b6) ...
#5 2.905 Setting up libsasl2-modules:arm64 (2.1.28+dfsg-10) ...
#5 2.911 Setting up libnghttp2-14:arm64 (1.52.0-1+deb12u2) ...
#5 2.915 Setting up libldap-common (2.5.13+dfsg-5) ...
#5 2.923 Setting up libsasl2-modules-db:arm64 (2.1.28+dfsg-10) ...
#5 2.927 Setting up librtmp1:arm64 (2.4+20151223.gitfa8646d.1-2+b2) ...
#5 2.931 Setting up libsasl2-2:arm64 (2.1.28+dfsg-10) ...
#5 2.935 Setting up libssh2-1:arm64 (1.10.0-3+b1) ...
#5 2.939 Setting up publicsuffix (20230209.2326-1) ...
#5 2.943 Setting up libldap-2.5-0:arm64 (2.5.13+dfsg-5) ...
#5 2.948 Setting up libcurl4:arm64 (7.88.1-10+deb12u8) ...
#5 2.953 Setting up curl (7.88.1-10+deb12u8) ...
#5 2.958 Processing triggers for libc-bin (2.36-9+deb12u9) ...
#5 DONE 3.0s

#6 [3/4] RUN curl --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
#6 0.450 downloading uv 0.5.24 aarch64-unknown-linux-gnu
#6 1.710 no checksums to verify
#6 1.929 installing to /root/.local/bin
#6 1.935   uv
#6 1.936   uvx
#6 1.936 everything's installed!
#6 1.941 
#6 1.941 To add $HOME/.local/bin to your PATH, either restart your shell or run:
#6 1.941 
#6 1.941     source $HOME/.local/bin/env (sh, bash, zsh)
#6 1.941     source $HOME/.local/bin/env.fish (fish)
#6 1.941 WARNING: The following commands are shadowed by other commands in your PATH: uv uvx
#6 DONE 2.0s

#7 [4/4] RUN ~/.local/bin/uv version
#7 0.120 uv 0.5.24
#7 DONE 0.1s

#8 exporting to image
#8 exporting layers 0.1s done
#8 writing image sha256:d00be0d0ec0223cae58140bddf7bd0c658b4dbafb6a3e238e2445a7d800fd008 done
#8 DONE 0.1s
```

---

_Comment by @carrollpaul on 2025-01-29 22:34_

The Mac is my work laptop and sometimes the company VPN causes issues with SSL stuff. Is it possible that the installer didn't download in the previous step? Usually I see a certificate related error, though.

---

_Comment by @zanieb on 2025-01-29 23:15_

It seems possible? I would expect it to fail though. I don't think you can use system certs with the installer yet https://github.com/axodotdev/cargo-dist/blob/main/CHANGELOG.md#system-certificates / https://github.com/axodotdev/cargo-dist/pull/1160 â€” the native TLS support is off.

---

_Comment by @zanieb on 2025-01-29 23:16_

You should be able to `COPY` from our distroless images instead of using the installer? I don't see how that would be different on your Pi though.

---

_Comment by @carrollpaul on 2025-01-30 14:15_

Yeah, this Dockerfile gives this error:
```Dockerfile
FROM python:3.12-slim-bookworm
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

WORKDIR /app
ENV UV_COMPILE_BYTECODE=1
ENV UV_LINK_MODE=copy
# ENV PATH="/usr/local/bin:$PATH"

# 4. Install dependencies
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev

# Add application code
ADD . /app

# Install project
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# Set up environment
ENV PATH="/app/.venv/bin:$PATH"
ENTRYPOINT []
CMD ["fastapi", "dev", "--host", "0.0.0.0", "src/main.py"]
```
```
pi@raspberrypi:~/code/temp-logger $ sudo docker compose build --no-cache
[+] Building 1.1s (9/9) FINISHED                                                                                                                                                                                                      docker:default
 => [frontend internal] load build definition from Dockerfile                                                                                                                                                                                   0.0s
 => => transferring dockerfile: 85B                                                                                                                                                                                                             0.0s
 => [backend internal] load build definition from Dockerfile                                                                                                                                                                                    0.0s
 => => transferring dockerfile: 728B                                                                                                                                                                                                            0.0s
 => [frontend internal] load metadata for docker.io/library/nginx:alpine                                                                                                                                                                        0.4s
 => ERROR [backend internal] load metadata for ghcr.io/astral-sh/uv:latest                                                                                                                                                                      0.4s
 => [backend internal] load metadata for docker.io/library/python:3.12-slim-bookworm                                                                                                                                                            0.4s
 => [frontend internal] load .dockerignore                                                                                                                                                                                                      0.1s
 => => transferring context: 2B                                                                                                                                                                                                                 0.0s
 => [frontend internal] load build context                                                                                                                                                                                                      0.1s
 => => transferring context: 501B                                                                                                                                                                                                               0.0s
 => CACHED [frontend 1/2] FROM docker.io/library/nginx:alpine@sha256:814a8e88df978ade80e584cc5b333144b9372a8e3c98872d07137dbf3b44d0e4                                                                                                           0.0s
 => [frontend 2/2] COPY . /usr/share/nginx/html/                                                                                                                                                                                                0.4s
------
 > [backend internal] load metadata for ghcr.io/astral-sh/uv:latest:
------
failed to solve: ghcr.io/astral-sh/uv:latest: failed to resolve source metadata for ghcr.io/astral-sh/uv:latest: no match for platform in manifest: not found
```

---

_Comment by @carrollpaul on 2025-01-30 14:39_

Going back to the solution in [#10942](https://github.com/astral-sh/uv/issues/10942), when I use the same command you used (`docker build . --no-cache --progress plain` instead of `docker compose build`), I do indeed see the SSL error on my Mac:

```
#7 [3/5] RUN curl --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
#7 0.390 curl: (60) SSL certificate problem: unable to get local issuer certificate
#7 0.390 More details here: https://curl.se/docs/sslcerts.html
#7 0.390 
#7 0.390 curl failed to verify the legitimacy of the server and therefore could not
#7 0.390 establish a secure connection to it. To learn more about this situation and
#7 0.390 how to fix it, please visit the web page mentioned above.
#7 DONE 0.4s

#8 [4/5] RUN which uv
#8 ERROR: process "/bin/sh -c which uv" did not complete successfully: exit code: 1
```
I tried passing the `-k` flag to the curl command in the Dockerfile and got a server error:
```
#7 [3/5] RUN curl -k --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
#7 11.45 curl: (22) The requested URL returned error: 504
#7 DONE 11.5s
```
However, when I run the same curl command directly from the command line, it works:
```
âžœ  ~ curl -k --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
downloading uv 0.5.24 aarch64-apple-darwin
no checksums to verify
installing to /Users/paul.x.carroll/.local/bin
  uv
  uvx
everything's installed!
```

---

_Comment by @zanieb on 2025-01-30 14:54_

Ah it makes sense that the failure was on curl's end rather than the install script â€” then it didn't fail the comand because PIPEFAIL wasn't enabled.

> failed to solve: ghcr.io/astral-sh/uv:latest: failed to resolve source metadata for ghcr.io/astral-sh/uv:latest: no match for platform in manifest: not found

Can you get more information about the platform it's looking for? There are also tools available for listing the available platforms in the manifest.

---

_Comment by @carrollpaul on 2025-01-30 15:02_

Yes, will do. 

Just updating my latest progress. This Dockerfile prints the version fine on my Pi:
```Dockerfile
FROM python:3.12-slim-bookworm
RUN apt update && apt install curl -y
RUN curl --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
ENV PATH="/root/.local/bin/:$PATH"
RUN uv version
```
But when I add the rest of the file:
```Dockerfile
FROM python:3.12-slim-bookworm
RUN apt update && apt install curl -y
RUN curl --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
ENV PATH="/root/.local/bin/:$PATH"

WORKDIR /app
ENV UV_COMPILE_BYTECODE=1
ENV UV_LINK_MODE=copy
# ENV PATH="/usr/local/bin:$PATH"

# 4. Install dependencies
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev

# Add application code
ADD . /app

# Install project
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# Set up environment
ENV PATH="/app/.venv/bin:$PATH"
ENTRYPOINT []
CMD ["fastapi", "dev", "--host", "0.0.0.0", "src/main.py"]
```

I get a new error:
```
#9 ERROR: process "/bin/sh -c uv sync --frozen --no-install-project --no-dev" did not complete successfully: exit code: 1
------
 > [stage-0 5/7] RUN --mount=type=cache,target=/root/.cache/uv     --mount=type=bind,source=uv.lock,target=uv.lock     --mount=type=bind,source=pyproject.toml,target=pyproject.toml     uv sync --frozen --no-install-project --no-dev:
9.591       [stderr]
9.591       /root/.cache/uv/builds-v0/.tmpfqXXjR/lib/python3.12/site-packages/setuptools/_distutils/dist.py:270:
9.591       UserWarning: Unknown distribution option: 'test_suite'
9.591         warnings.warn(msg)
9.591       error: command 'gcc' failed: No such file or directory
9.591
9.591       hint: This usually indicates a problem with the package or the build
9.591       environment.
9.591   help: `httptools` (v0.6.4) was included because `backend` (v0.1.0) depends
9.591         on `uvicorn[standard]` (v0.34.0) which depends on `httptools`
------
Dockerfile:11
--------------------
  10 |     # 4. Install dependencies
  11 | >>> RUN --mount=type=cache,target=/root/.cache/uv \
  12 | >>>     --mount=type=bind,source=uv.lock,target=uv.lock \
  13 | >>>     --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
  14 | >>>     uv sync --frozen --no-install-project --no-dev
  15 |
--------------------
ERROR: failed to solve: process "/bin/sh -c uv sync --frozen --no-install-project --no-dev" did not complete successfully: exit code: 1
```

---

_Comment by @carrollpaul on 2025-01-30 15:09_

> Can you get more information about the platform it's looking for? There are also tools available for listing the available platforms in the manifest.

```sh
âžœ  ~ skopeo inspect docker://ghcr.io/astral-sh/uv:latest
FATA[0000] Error parsing manifest for image: choosing image instance: no image found in image index for architecture "arm64", variant "v8", OS "darwin"
```
```sh
âžœ  ~ skopeo inspect --raw docker://ghcr.io/astral-sh/uv:latest | jq '.manifests[] | {platform}'
{
  "platform": {
    "architecture": "amd64",
    "os": "linux"
  }
}
{
  "platform": {
    "architecture": "unknown",
    "os": "unknown"
  }
}
{
  "platform": {
    "architecture": "arm64",
    "os": "linux"
  }
}
{
  "platform": {
    "architecture": "unknown",
    "os": "unknown"
  }
}
```

---

_Comment by @zanieb on 2025-01-30 15:10_

That is a fairly standard build failure, e.g., https://docs.astral.sh/uv/reference/troubleshooting/build-failures/#command-is-not-found

Your dependency does not publish binaries for your platform apparently and you need to build it from source, but you don't have a gcc toolchain. 

---

_Comment by @carrollpaul on 2025-01-30 15:13_

Man, I thought this was what Docker was built to solve ðŸ˜…

---

_Comment by @zanieb on 2025-01-30 15:15_

This fails on my mac as well:

```
â¯ skopeo inspect docker://ghcr.io/astral-sh/uv:latest

FATA[0000] Error parsing manifest for image: choosing image instance: no image found in image index for architecture "arm64", variant "v8", OS "darwin" 
```

The following is fine though

```
â¯ docker run --pull always -it ghcr.io/astral-sh/uv:latest version
latest: Pulling from astral-sh/uv
9498d6789da1: Pull complete 
708d70ca8ab8: Pull complete 
Digest: sha256:a73176b27709bff700a1e3af498981f31a83f27552116f21ae8371445f0be710
Status: Downloaded newer image for ghcr.io/astral-sh/uv:latest
uv 0.5.25
```

Interestingly the SHA is not what's present there?

```
â¯ skopeo inspect --raw docker://ghcr.io/astral-sh/uv:latest
{
  "schemaVersion": 2,
  "mediaType": "application/vnd.oci.image.index.v1+json",
  "manifests": [
    {
      "mediaType": "application/vnd.oci.image.manifest.v1+json",
      "digest": "sha256:0d489991cdbd344718dd05b9c4fd903cb42d0e2fcecb89d46006a6834b8ab6d5",
      "size": 669,
      "platform": {
        "architecture": "amd64",
        "os": "linux"
      }
    },
    {
      "mediaType": "application/vnd.oci.image.manifest.v1+json",
      "digest": "sha256:4fab12d05b9f8a849690f381b3840fe33e08f6be5657f4c91e4e9a795990d991",
      "size": 567,
      "annotations": {
        "vnd.docker.reference.digest": "sha256:0d489991cdbd344718dd05b9c4fd903cb42d0e2fcecb89d46006a6834b8ab6d5",
        "vnd.docker.reference.type": "attestation-manifest"
      },
      "platform": {
        "architecture": "unknown",
        "os": "unknown"
      }
    },
    {
      "mediaType": "application/vnd.oci.image.manifest.v1+json",
      "digest": "sha256:c9b04e21937a72403b95984b10ae976b2d9fbda9dc03c998fa98bb87c2590d5e",
      "size": 669,
      "platform": {
        "architecture": "arm64",
        "os": "linux"
      }
    },
    {
      "mediaType": "application/vnd.oci.image.manifest.v1+json",
      "digest": "sha256:d011fcc2897a93fe4dbb19aedcbb16a0e2727755cf997df8ee2bf685caf4e700",
      "size": 567,
      "annotations": {
        "vnd.docker.reference.digest": "sha256:c9b04e21937a72403b95984b10ae976b2d9fbda9dc03c998fa98bb87c2590d5e",
        "vnd.docker.reference.type": "attestation-manifest"
      },
      "platform": {
        "architecture": "unknown",
        "os": "unknown"
      }
    }
  ],
  "annotations": {
    "org.opencontainers.image.created": "2025-01-28T21:56:26.987Z",
    "org.opencontainers.image.description": "An extremely fast Python package and project manager, written in Rust.",
    "org.opencontainers.image.licenses": "Apache-2.0",
    "org.opencontainers.image.revision": "9c07c3fc5b2c7e3e7d163e1a545d6147f63d2306",
    "org.opencontainers.image.source": "https://github.com/astral-sh/uv",
    "org.opencontainers.image.title": "uv",
    "org.opencontainers.image.url": "https://github.com/astral-sh/uv",
    "org.opencontainers.image.version": "0.5.25"
  }
}%                                                                                                                           
```

---

_Comment by @carrollpaul on 2025-01-30 15:20_

I've confused myself at this point - what are we learning from the `skopeo` queries?

---

_Comment by @zanieb on 2025-01-30 15:21_

In theory, what architectures we publish for and what platform you're looking for that it fails to find.

---

_Comment by @carrollpaul on 2025-01-30 15:27_

```
pi@raspberrypi:~/code/temp-logger/backend $ uname -m && uname -s
aarch64
Linux
```
So that's the problem - `aarch64` is not in the manifest

---

_Comment by @zanieb on 2025-01-30 15:27_

aarch64 is arm64 (confusing, I know)

---

_Comment by @carrollpaul on 2025-01-30 15:29_

Lol, so it's still a mystery why it works on Win10 and Apple silicon but not the Pi
"it" being `FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim`

---

_Comment by @zanieb on 2025-01-30 15:41_

Basically yes.

Does using `--platform linux/arm64` in your `docker build` invocation fix it?

---

_Comment by @carrollpaul on 2025-01-30 16:01_

It leads to a new error later in the Dockerfile:
```
#7 [stage-0 3/5] RUN --mount=type=cache,target=/root/.cache/uv     --mount=type=bind,source=uv.lock,target=uv.lock     --mount=type=bind,source=pyproject.toml,target=pyproject.toml     uv sync --frozen --no-install-project --no-dev
#7 ERROR: process "/bin/sh -c uv sync --frozen --no-install-project --no-dev" did not complete successfully: exit code: 159
------
 > [stage-0 3/5] RUN --mount=type=cache,target=/root/.cache/uv     --mount=type=bind,source=uv.lock,target=uv.lock     --mount=type=bind,source=pyproject.toml,target=pyproject.toml     uv sync --frozen --no-install-project --no-dev:
------
Dockerfile:19
--------------------
  18 |     # Install the project's dependencies using the lockfile and settings
  19 | >>> RUN --mount=type=cache,target=/root/.cache/uv \
  20 | >>>     --mount=type=bind,source=uv.lock,target=uv.lock \
  21 | >>>     --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
  22 | >>>     uv sync --frozen --no-install-project --no-dev
  23 |
--------------------
ERROR: failed to solve: process "/bin/sh -c uv sync --frozen --no-install-project --no-dev" did not complete successfully: exit code: 159
```

---

_Comment by @carrollpaul on 2025-01-30 21:03_

Well, ultimately this does work on the Pi. Just had to install `build-essential`.
```Dockerfile
FROM python:3.12-slim-bookworm

# Download and install uv
RUN apt update && apt install curl build-essential -y
RUN curl --proto '=https' --tlsv1.2 -LsSf https://github.com/astral-sh/uv/releases/download/0.5.24/uv-installer.sh | sh
ENV PATH="/root/.local/bin/:$PATH"

# Install the project into `/app`
WORKDIR /app

# Enable bytecode compilation
ENV UV_COMPILE_BYTECODE=1

# Copy from the cache instead of linking since it's a mounted volume
ENV UV_LINK_MODE=copy

# Install the project's dependencies using the lockfile and settings
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev

# Then, add the rest of the project source code and install it
# Installing separately from its dependencies allows optimal layer caching
ADD . /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# Place executables in the environment at the front of the path
ENV PATH="/app/.venv/bin:$PATH"

# Reset the entrypoint, don't invoke `uv`
ENTRYPOINT []

# Run the FastAPI application by default
CMD ["fastapi", "dev", "--host", "0.0.0.0", "src/main.py"]
```

```
#11 431.1 Prepared 38 packages in 7m 09s
#11 432.3 Installed 38 packages in 1.18s
```

---
