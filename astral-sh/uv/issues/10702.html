<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv downloads multiple versions of torch nightlies continuously - astral-sh/uv #10702</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv downloads multiple versions of torch nightlies continuously</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10702">#10702</a>
        opened by <a href="https://github.com/rbavery">@rbavery</a>
        on 2025-01-17 02:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rbavery">@rbavery</a> on 2025-01-17 02:19</div>
            <div class="timeline-body"><p>Apologies since I'm fairly certain this is a duplicate but I can't find the github issue after much searching.</p>
<p>When I try to install the latest torch nightly with the following toml uv endlessly downloads many ~700mb nightlies. I think it is doing so to check for compatibility and keeps downloading if the nightly version doesn't solve correctly but I'm not sure.</p>
<pre><code>[project]
authors = [
    {name = &quot;Ryan Avery&quot;, email = &quot;ryan@wherobots.com&quot;},
]
license = {text = &quot;nos&quot;}
requires-python = &quot;&lt;4.0,&gt;=3.10&quot;
dependencies = [
    &quot;httpx&lt;1.0.0,&gt;=0.26.0&quot;,
    &quot;shapely&lt;3.0.0,&gt;=2.0.2&quot;,
    &quot;geopandas&lt;1.0.0,&gt;=0.14.2&quot;,
    &quot;pystac-client&lt;1.0.0,&gt;=0.7.5&quot;,
    &quot;pystac&lt;2.0.0,&gt;=1.9.0&quot;,
    &quot;stac-model&lt;1.0,&gt;=0.2&quot;,
    &quot;tqdm&lt;5.0.0,&gt;=4.66.1&quot;,
    &quot;typer[all]&lt;1.0.0,&gt;=0.9.0&quot;,
    &quot;rich&lt;14.0.0,&gt;=13.7.0&quot;,
    &quot;boto3&lt;2.0.0,&gt;=1.34.134&quot;,
    &quot;huggingface_hub&quot;
]
name = &quot;wbc-model&quot;
version = &quot;0.1.0&quot;
description = &quot;Recipes for creating model metadata hosted for WBC users.&quot;
readme = &quot;README.md&quot;
keywords = []
classifiers = [
    &quot;Development Status :: 3 - Alpha&quot;,
    &quot;Intended Audience :: Developers&quot;,
    &quot;Operating System :: OS Independent&quot;,
    &quot;Topic :: Software Development :: Libraries :: Python Modules&quot;,
    &quot;License :: Other/Proprietary License&quot;,
    &quot;Programming Language :: Python :: 3&quot;,
    &quot;Programming Language :: Python :: 3.10&quot;,
    &quot;Programming Language :: Python :: 3.11&quot;,
    &quot;Private :: Do Not Upload&quot;,
]

[build-system]
requires = [&quot;pdm-backend&quot;]
build-backend = &quot;pdm.backend&quot;

# Keywords description https://python-poetry.org/docs/pyproject/#keywords
keywords = []  # UPDATEME with relevant keywords

# Pypi classifiers: https://pypi.org/classifiers/
classifiers = [  # UPDATEME with additional classifiers; remove last classifier to allow publishing on PyPI
  &quot;Development Status :: 3 - Alpha&quot;,
  &quot;Intended Audience :: Developers&quot;,
  &quot;Operating System :: OS Independent&quot;,
  &quot;Topic :: Software Development :: Libraries :: Python Modules&quot;,
  &quot;License :: Other/Proprietary License&quot;,
  &quot;Programming Language :: Python :: 3&quot;,
  &quot;Programming Language :: Python :: 3.10&quot;,
  &quot;Programming Language :: Python :: 3.11&quot;,
  &quot;Private :: Do Not Upload&quot;
]

[tool.uv]
dev-dependencies = [
    &quot;mypy&lt;2.0.0,&gt;=1.0.0&quot;,
    &quot;mypy-extensions&lt;1.0.0,&gt;=0.4.3&quot;,
    &quot;pre-commit&lt;3.0.0,&gt;=2.21.0&quot;,
    &quot;bandit&lt;2.0.0,&gt;=1.7.5&quot;,
    &quot;safety&lt;3.0.0,&gt;=2.3.4&quot;,
    &quot;jupyterlab&lt;5.0.0,&gt;=4.0.10&quot;,
    &quot;flake8&lt;6.0.0,&gt;=5.0.4&quot;,
    &quot;pydocstyle[toml]&lt;7.0.0,&gt;=6.2.0&quot;,
    &quot;pydoclint&lt;1.0.0,&gt;=0.3.0&quot;,
    &quot;pytest&lt;8.0.0,&gt;=7.2.1&quot;,
    &quot;pytest-html&lt;4.0.0,&gt;=3.2.0&quot;,
    &quot;pytest-cov&lt;5.0.0,&gt;=4.1.0&quot;,
    &quot;pytest-mock&lt;4.0.0,&gt;=3.10.0&quot;,
    &quot;pytest-timeout&lt;3.0.0,&gt;=2.2.0&quot;,
    &quot;pytest-benchmark&lt;5.0.0,&gt;=4.0.0&quot;,
    &quot;pytest-sugar&lt;1.0.0,&gt;=0.9.7&quot;,
    &quot;pytest-click&lt;2.0.0,&gt;=1.1.0&quot;,
    &quot;pytest-pikachu&lt;2.0.0,&gt;=1.0.0&quot;,
    &quot;coverage&lt;8.0.0,&gt;=7.3.0&quot;,
    &quot;ruff&lt;1.0.0,&gt;=0.1.7&quot;,
    &quot;hypothesis&gt;=6.122.3&quot;,
    &quot;expecttest&quot;,
]

[dependency-groups]
#if any of these start to conflict: https://docs.astral.sh/uv/concepts/projects/config/#conflicting-dependencies
satlas-solar = [
    &quot;satlas-solar==0.1.0&quot;
]
eurosat = [
    &quot;torchgeo&lt;1.0.0,&gt;=0.6.0&quot;,
    &quot;lightning&lt;3.0.0,&gt;=2.1.3&quot;,
]
torchgpu = [
  &quot;torch&quot;,
  &quot;torchvision&quot;,
  &quot;pytorch-triton&quot;,
]

# uv pays attention to index order, this is prioritized
[[tool.uv.index]]
name = &quot;pytorch-nightly-gpu&quot;
url = &quot;https://download.pytorch.org/whl/nightly/cu124&quot;
explicit = true

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-nightly-gpu&quot;, marker = &quot;platform_system != 'Darwin'&quot;}, # Add nightly source
]
torchvision = [
  { index = &quot;pytorch-nightly-gpu&quot;, marker = &quot;platform_system != 'Darwin'&quot;}, # Add nightly source
]
pytorch-triton = [
    {index = &quot;pytorch-nightly-gpu&quot;, marker = &quot;platform_system != 'Darwin'&quot;},
]
satlas-solar = { path = &quot;model-forge/satlas/solar/&quot; }

[tool.pdm.build]
includes = [
    &quot;wbc_model&quot;,
]
</code></pre>
<p>The command I'm using to sync uses the torchgpu group</p>
<pre><code>uv sync --group torchgpu --group satlas-solar
</code></pre>
<p>this is the result after a couple of minutes. uv has downloaded nightlies for each day in January and now is in December.</p>
<pre><code>→ uv sync --upgrade --group torchgpu --group satlas-solar
Using CPython 3.11.9 interpreter at: /home/rave/miniforge3/bin/python3
Creating virtual environment at: .venv
⠙ Resolving dependencies...                                                                                                                                                                                                                                                                                            warning: Missing version constraint (e.g., a lower bound) for `expecttest`
warning: Missing version constraint (e.g., a lower bound) for `torch`
warning: Missing version constraint (e.g., a lower bound) for `torchvision`
warning: Missing version constraint (e.g., a lower bound) for `pytorch-triton`
warning: Missing version constraint (e.g., a lower bound) for `huggingface-hub`
⠇ torch==2.6.0.dev20241225+cu124
torch      ------------------------------ 290.91 MiB/731.07 MiB  
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-17 02:24</div>
            <div class="timeline-body"><p>What version of uv are you on?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 03:24</div>
            <div class="timeline-body"><p>Can you add a lower bound to your torch version? Then we'll at least stop backtracking looking for a compatible version and tell you what's going on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rbavery">@rbavery</a> on 2025-01-17 17:27</div>
            <div class="timeline-body"><p>Thanks for the tips! I'm now on uv 5.20</p>
<p>I set the lower bound to <code>torch&gt;=2.6</code> since nightlies for 2.7 are out. but I get a weird error that seems to be using the wrong index even though I specified in my toml</p>
<pre><code>[[tool.uv.index]]
name = &quot;pytorch-nightly-gpu&quot;
url = &quot;https://download.pytorch.org/whl/nightly/cu124&quot;
explicit = true
</code></pre>
<pre><code>→ uv sync --upgrade --group torchgpu --group satlas-solar
⠙ Resolving dependencies...                                                     warning: Missing version constraint (e.g., a lower bound) for `expecttest`
warning: Missing version constraint (e.g., a lower bound) for `torchvision`
warning: Missing version constraint (e.g., a lower bound) for `pytorch-triton`
warning: Missing version constraint (e.g., a lower bound) for `huggingface-hub`
  × No solution found when resolving dependencies for split (sys_platform
  │ == 'darwin'):
  ╰─▶ Because only torch{sys_platform == 'darwin'}&lt;=2.5.1 is available and
      wbc-model:torchgpu depends on torch{sys_platform == 'darwin'}&gt;=2.6, we
      can conclude that wbc-model:torchgpu's requirements are unsatisfiable.
      And because your project requires wbc-model:torchgpu, we can conclude
      that your project's requirements are unsatisfiable.
</code></pre>
<p>It seems like uv is only looking at default pypi to say that only torch&lt;=2.5.1 is available. But on the nightly index, versions above 2.6 should be available, as seen above where I'm downloading torch 2.7 nightlies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-17 17:28</div>
            <div class="timeline-body"><p>Yeah, on latest versions, we shouldn't be performing those downloads -- so glad that's resolved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rbavery">@rbavery</a> on 2025-01-17 17:43</div>
            <div class="timeline-body"><p>Thanks, I'll open a new issue for the error I'm seeing above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @rbavery on 2025-01-17 17:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10718.html">astral-sh/uv#10718</a> on 2025-01-17 17:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:58 UTC
    </footer>
</body>
</html>
