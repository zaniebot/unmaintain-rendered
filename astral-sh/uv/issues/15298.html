<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV does not fall back to other indexes when package lacks platform-compatible wheels - astral-sh/uv #15298</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV does not fall back to other indexes when package lacks platform-compatible wheels</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15298">#15298</a>
        opened by <a href="https://github.com/tejal567">@tejal567</a>
        on 2025-08-15 06:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tejal567">@tejal567</a> on 2025-08-15 06:45</div>
            <div class="timeline-body"><h3>Summary</h3>
<h2>Problem Description</h2>
<p>When using multiple package indexes, UV fails to fall back to alternative indexes if a package exists in the first index but doesn't have wheels compatible with the current platform. This differs from Poetry's behavior and can cause installation failures for packages that should be available.</p>
<h2>Expected Behavior</h2>
<p>When a package exists in multiple indexes:</p>
<ol>
<li>UV finds the package in the first index</li>
<li>If that version lacks wheels for the current platform</li>
<li>UV should check other configured indexes for the same version with compatible wheels</li>
<li>UV should install from whichever index has platform-compatible wheels</li>
</ol>
<h2>Actual Behavior</h2>
<p>Currently UV:</p>
<ol>
<li>Finds the package in the first index</li>
<li>Attempts to install from that index only</li>
<li>Fails with platform compatibility error</li>
<li>Does not check other indexes for compatible wheels</li>
</ol>
<h2>Minimal Reproduction Example</h2>
<p><strong>uv.toml:</strong></p>
<pre><code class="language-toml">index-strategy = &quot;unsafe-best-match&quot;

[[index]]
name = &quot;private-repo&quot;
url = &quot;https://private-repo.company.com/simple&quot;

[[index]] 
name = &quot;pypi&quot;
url = &quot;https://pypi.org/simple/&quot;
default = true
</code></pre>
<p><strong>pyproject.toml:</strong></p>
<pre><code class="language-toml">[project]
name = &quot;test-project&quot;
dependencies = [&quot;numpy==2.2.6&quot;]
</code></pre>
<p><strong>Scenario:</strong></p>
<ul>
<li>Private repository has <code>numpy==2.2.6</code> with only Linux x86_64 wheels</li>
<li>PyPI has <code>numpy==2.2.6</code> with macOS ARM64 wheels</li>
<li>Running <code>uv sync</code> on macOS ARM64</li>
</ul>
<p><strong>Result with both indexes:</strong></p>
<pre><code>error: Distribution `numpy==2.2.6 @ registry+https://private-repo.company.com/simple` 
can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p><strong>Result with only PyPI (private repo commented out):</strong></p>
<pre><code>âœ… Successfully installed numpy==2.2.6 from PyPI (ARM64 wheels available)
</code></pre>
<p>This proves that PyPI has the compatible wheels, but UV doesn't fall back when the private repository lacks them.</p>
<h2>Comparison with Poetry</h2>
<p>Poetry handles this scenario correctly:</p>
<ul>
<li>Finds <code>numpy==2.2.6</code> in private repository</li>
<li>Detects lack of ARM64 macOS wheels</li>
<li>Automatically falls back to PyPI for the same version</li>
<li>Successfully installs compatible wheels</li>
</ul>
<h2>Impact</h2>
<p>This limits UV adoption in enterprise environments where:</p>
<ul>
<li>Private repositories contain internal packages + some public packages</li>
<li>Public packages in private repos may have limited platform support</li>
<li>Teams expect automatic fallback to public PyPI for missing platforms</li>
<li>Mixed development environments (Linux CI + macOS/Windows developers)</li>
</ul>
<p>This behavior makes UV less flexible than Poetry for enterprises with mixed repository setups and multi-platform development teams.</p>
<h3>Platform</h3>
<p>Darwin 24.6.0 arm64 (MacOS)</p>
<h3>Version</h3>
<p>uv 0.8.11 (Homebrew 2025-08-14)</p>
<h3>Python version</h3>
<p>Python 3.10.17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @tejal567 on 2025-08-15 06:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-15 10:44</div>
            <div class="timeline-body"><p>It probably makes sense to support this (when <code>unsafe-best-match</code> is set). It'd be nice to see more demand though -- I don't think it's ever come up before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-08-15 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2025-08-15 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tejal567">@tejal567</a> on 2025-08-15 14:05</div>
            <div class="timeline-body"><p>@charliermarsh ah, we would have adopted uv in our company if not for this issue.
Actually we have a private repository in which not all platform build are there. I was doing a POC to replace poetry with uv for our use case but then we encountered this road block.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mmtpo">@mmtpo</a> on 2025-08-21 10:38</div>
            <div class="timeline-body"><p>Actually, there might be quite a few users hitting this right now. For example, <code>pandas</code> currently has a discrepancy between Linux and Windows wheels: Linux/macOS wheels are published in some private mirrors, but Windows wheels lag behind. On Windows, uv resolves the Linux-only version from the first index and then fails, even though PyPI has the Windows-compatible wheels.</p>
<pre><code>error: Distribution `pandas==2.3.2 @ registry` can't be installed because it doesn't have a source distribution or wheel for the current platform 
hint: You're on Windows (`win_amd64`), but `pandas` (v2.3.2) only has wheels for the following platforms: `manylinux_2_17_aarch64`, `manylinux_2_17_x86_64`, `manylinux2014_aarch64`, `manylinux2014_x86_64`, `musllinux_1_2_aarch64`, `musllinux_1_2_x86_64`, `macosx_10_13_x86_64`, `macosx_11_0_arm64`; consider adding your platform to `tool.uv.required-environments` to ensure uv resolves to a version with compatible wheels
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-21 10:40</div>
            <div class="timeline-body"><p>Why does the private repository mirror the release only partially, instead of mirroring all files of a release?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15547.html">astral-sh/uv#15547</a> on 2025-08-27 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tejal567">@tejal567</a> on 2025-08-28 06:38</div>
            <div class="timeline-body"><p>In our company private repo actually we are only mirroring linux releases and not windows or mac build releases. So when it searches in this private repo and not find it, it raises an error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-28 07:22</div>
            <div class="timeline-body"><p>My main recommendation here would be mirroring releases fully, partial releases are difficult for a package manager to deal with in a way that is also secure.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
