<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better default for uv sync - astral-sh/uv #10934</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Better default for uv sync</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10934">#10934</a>
        opened by <a href="https://github.com/xixixao">@xixixao</a>
        on 2025-01-24 10:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/xixixao">@xixixao</a> on 2025-01-24 10:27</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm setting up a monorepo for my team. The main command that my team members have to run is:</p>
<pre><code>uv sync --all-packages --all-extras --all-groups
</code></pre>
<p>That's quite a mouthful. Either:</p>
<ol>
<li>Could we make this the default? (that might be hard when other options are desired)</li>
<li>Make the default configurable in <code>uv.toml</code>? (seems that right now only <code>uv pip</code> can be configured?)</li>
</ol>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @xixixao on 2025-01-24 10:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-24 15:53</div>
            <div class="timeline-body"><p>We allow configuring the <code>default-groups</code>. You can define a dependency group that adds your project with all of your extras.</p>
<p>I'm not sure about the <code>--all-packages</code> bit, seems reasonable to have an option for that though, e.g., <code>default-packages</code> or <code>default-workspace-members</code> or something. Hm.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-01-24 15:56</div>
            <div class="timeline-body"><p><code>default-packages</code> packages makes sense to me; I think the reason it hasn't come up much yet is that most projects have a main package that depends on the other packages, so that they implicitly get a correct default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bschoenmaeckers">@bschoenmaeckers</a> on 2025-01-24 16:40</div>
            <div class="timeline-body"><p>What is currently the default set of workspace packages that are installed when not specifying  <code>--all-packages</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-24 17:10</div>
            <div class="timeline-body"><p>The dependencies of the main package â€” perhaps you want to add the other workspace members as dependencies?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matthewadams">@matthewadams</a> on 2025-01-30 13:50</div>
            <div class="timeline-body"><p>You might be interested in https://github.com/astral-sh/uv/issues/10960</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xixixao">@xixixao</a> on 2025-02-03 09:16</div>
            <div class="timeline-body"><p>@zanieb I tried to set things up purely via adding the workspace members as dependencies to the main package, but one issue is that the workspace members' dev dependency groups are not installed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-03 14:02</div>
            <div class="timeline-body"><p>Yeah, if you have development requirements for the workspace we'd expect them to be there not in a child project. Can you share more about why you need that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xixixao">@xixixao</a> on 2025-02-03 17:35</div>
            <div class="timeline-body"><p>Many workspace member projects, and some of the dev dependencies are specific to that project. It's not a requirement, it's more for organization.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsyring">@rsyring</a> on 2025-02-21 18:23</div>
            <div class="timeline-body"><p>Using <a href="https://mise.jdx.dev/tasks/">mise tasks</a>, your users could just run <code>mise uv-sync</code> where the uv-sync script would just be <code>uv sync --all-packages --all-extras --all-groups</code>.</p>
<p>The benefit being that, if uv or the monorepo layout/commands change in the future, you can just update the task script.  All the devs can keep using <code>mise uv-sync</code> which has no doubt become reflexive for them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11797.html">astral-sh/uv#11797</a> on 2025-02-26 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11958.html">astral-sh/uv#11958</a> on 2025-03-04 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johnthagen">@johnthagen</a> on 2025-03-08 15:31</div>
            <div class="timeline-body"><p>I wanted to voice my support for <code>--all-groups</code> being the default for <code>uv sync</code>. We are looking to migrate from Poetry, Poetry does this, and I've always thought it provided the smoothest, least-surprising experience. We've already had several new team members be surprised that they added some dependencies in a dependency group and they showed up in the lock file, but are not installed with <code>uv sync</code> by default.</p>
<p>We split up our development dependencies into nicely named groups. This not only is self documenting, but it allows tools like tox/nox to install only a subset of the dependencies easily into isolated virtual environments.</p>
<pre><code class="language-toml">[dependency-groups]
nox = [
    &quot;nox-poetry&quot;
]
test = [
    &quot;pytest&quot;,
    &quot;pytest-cov&quot;,
    &quot;pytest-randomly&quot;
]
type_check = [
    &quot;mypy&quot;
]
lint = [
    &quot;ruff&quot;
]
docs = [
    &quot;mkdocs-material&quot;,
    &quot;mkdocs-htmlproofer-plugin&quot;
]
</code></pre>
<p>After reading the docs, a user can learn that the <code>dev</code> group is special and you can extend the config with:</p>
<pre><code class="language-toml">[tool.uv]
default-groups = [&quot;nox&quot;, &quot;test&quot;, &quot;type_check&quot;, &quot;lint&quot;, &quot;docs&quot;]
</code></pre>
<p>But this seems like extra boilerplate in my opinion and suffers from DRY risk of the names getting out of sync (and then dependencies silently not being installed). Given that <code>--only-group</code> and <code>--no-group</code> exist, to me the least surprising thing would be for <code>uv sync</code> to install everything by default and then allow a user to opt back out when needed.</p>
<p>The special cases of <code>dev</code> also seems strange now that we have agnostic dependency group names. I could see it making sense back when <code>uv</code> had to provide it's legacy</p>
<pre><code class="language-toml">[tool.uv]
dev-dependencies = [
  &quot;pytest&quot;
]
</code></pre>
<p>But now-adays I think moving forward it would be ideal if <code>dev</code> wasn't special and all groups were installed by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../johnthagen/python-blueprint/issues/238.html">johnthagen/python-blueprint#238</a> on 2025-03-08 15:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsyring">@rsyring</a> on 2025-03-08 15:37</div>
            <div class="timeline-body"><p>Related: https://github.com/astral-sh/uv/issues/11691</p>
<p>We also use groups for the precise reason of being able to specify which dependencies I want in tox/nox.  But we just use includes in the dev group so that the default install gets all the installed deps:</p>
<pre><code class="language-toml">dev = [
    {include-group = &quot;tests&quot;},
    {include-group = &quot;pre-commit&quot;},
    {include-group = &quot;nox&quot;},
    &quot;hatch&gt;=1.14.0&quot;,
    &quot;ruff&gt;=0.9.6&quot;,
]
# Used by nox
pre-commit = [
    'pre-commit&gt;=4.1.0',
    'pre-commit-uv&gt;=4.1.4',
]
# Used by nox
tests = [
    'pytest&gt;=8.3.4',
]
# Used by CI
nox = [
    'nox&gt;=2025.2.9',
]
</code></pre>
<p>FWIW, I don't think <code>--all-groups</code> makes as much sense as a default when you can easily use includes to make your default dev environment use whatever groups you want.</p>
<p>Not sure what I think on special casing for the dev group.  I like that it's a simpler CLI interface when adding deps from the command line.   It also matches other dependency management tools.  But having the <code>--dev</code> concept as a special case of default groups does bring some confusion IMO and gives extra command line arguments as a result.  I'd probably leave <code>--dev</code> as a special case, although I would change some things as discussed in #11691.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12067.html">astral-sh/uv#12067</a> on 2025-03-08 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 18:39</div>
            <div class="timeline-body"><p>I'd be more in favor of adding a special &quot;all&quot; key to <code>default-groups</code> (e.g., <code>default-groups = list[str] | literal[&quot;all&quot;]</code>) than changing the default here. I think, as we don't sync all <code>optional-dependencies</code> by default, it'd feel surprising to sync all <code>dependency-groups</code> by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johnthagen">@johnthagen</a> on 2025-03-08 20:59</div>
            <div class="timeline-body"><blockquote>
<p>I'd be more in favor of adding a special &quot;all&quot; key</p>
</blockquote>
<p>I like this.</p>
<p>That would be sufficient for the needs I've seen. It would be explicit and also remove the DRY issues that currently exist with duplicating group names.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 21:15</div>
            <div class="timeline-body"><p>cc @Gankra curious for your thoughts</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-03-18 15:35</div>
            <div class="timeline-body"><p>That seems super reasonable, especially since it's not syntactically ambiguous if someone has a group named &quot;all&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12289.html">astral-sh/uv#12289</a> on 2025-03-18 16:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-03-18 16:25</div>
            <div class="timeline-body"><p>Put up an implementation of that in #12289</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-03-18 19:52</div>
            <div class="timeline-body"><p><a href="https://docs.astral.sh/uv/concepts/projects/dependencies/#default-groups"><code>default-groups = &quot;all&quot;</code> is now available in uv 0.6.8</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-03-18 21:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tremeschin">@Tremeschin</a> on 2025-03-19 05:38</div>
            <div class="timeline-body"><blockquote>
<p>@zanieb: <em>I'm not sure about the <code>--all-packages</code> bit (...) e.g., <code>default-packages</code> or <code>default-workspace-members</code> or something. (...) perhaps you want to add the other workspace members as dependencies?</em></p>
</blockquote>
<p>I kind of expect all workspace members to be installed by default, as it's already an <em>explicit</em> listing through <code>members</code>?</p>
<p>Since the workspace accepts glob patterns, not always one might know all packages that will be installed - my use case is that I have a directory of meta/private/others packages on my monorepo, included as <code>members = [&quot;meta/*&quot;]</code>. The names would leak on the public <code>pyproject.toml</code> in <code>dev-dependencies</code> (DRY issues also) but <code>--all-packages</code> fixes it</p>
<p>Can we have the opt-in sugar for it as well? Can open a new issue if you'd like, thanks ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12353.html">astral-sh/uv#12353</a> on 2025-03-20 22:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:25 UTC
    </footer>
</body>
</html>
