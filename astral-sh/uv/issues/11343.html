<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add vllm` doesnt resolve dependcy - astral-sh/uv #11343</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv add vllm</code> doesnt resolve dependcy</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11343">#11343</a>
        opened by <a href="https://github.com/dipta007">@dipta007</a>
        on 2025-02-08 20:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dipta007">@dipta007</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>I have installed torch before with version 2.6.0</p>
<p>But when I add vllm, it should downgrade torch to 2.5.1 as it needs that version to work.</p>
<p>But torch is still 2.6.0, thats why vllm doesnt work.</p>
<p>Am I doing something wrong?</p>
<h3>To Reproduce: (Thanks to @notatallshaw)</h3>
<pre><code>uv init
uv add torch
uv add vllm
</code></pre>
<p>I got the following error:</p>
<pre><code>And because all of:
  vllm&gt;=0.6.4,&lt;=0.6.4.post1
  vllm&gt;=0.6.6
depend on torch==2.5.1 and torch{platform_machine != 'aarch64'}==2.5.1, we can conclude that all versions of vllm depend on one of:
  torch==2.1.2
  torch==2.2.1
  torch&gt;=2.3.0,&lt;=2.4.0
  torch==2.5.1
</code></pre>
<p>But shouldn't UV downgrade the torch when installing <code>vllm</code> as I never mentioned I need the latest torch?</p>
<h3>Platform</h3>
<p>Ubuntu 20.04</p>
<h3>Version</h3>
<p>uv 0.5.29</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dipta007 on 2025-02-08 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-02-08 22:43</div>
            <div class="timeline-body"><p>If I do the following in a clean directory:</p>
<pre><code class="language-bash">uv init
uv add torch
uv add vllm
</code></pre>
<p>I get an error that ends in:</p>
<pre><code>And because all of:
  vllm&gt;=0.6.4,&lt;=0.6.4.post1
  vllm&gt;=0.6.6
depend on torch==2.5.1 and torch{platform_machine != 'aarch64'}==2.5.1, we can conclude that all versions of vllm depend on one of:
  torch==2.1.2
  torch==2.2.1
  torch&gt;=2.3.0,&lt;=2.4.0
  torch==2.5.1
</code></pre>
<p>You will need to provide steps for someone else to reproduce.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-08 23:35</div>
            <div class="timeline-body"><p>See #9452 for more details on how to share reproduction steps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seanswyi">@seanswyi</a> on 2025-02-11 06:39</div>
            <div class="timeline-body"><blockquote>
<p>If I do the following in a clean directory:</p>
<p>uv init
uv add torch
uv add vllm
I get an error that ends in:</p>
<pre><code>And because all of:
  vllm&gt;=0.6.4,&lt;=0.6.4.post1
  vllm&gt;=0.6.6
depend on torch==2.5.1 and torch{platform_machine != 'aarch64'}==2.5.1, we can conclude that all versions of vllm depend on one of:
  torch==2.1.2
  torch==2.2.1
  torch&gt;=2.3.0,&lt;=2.4.0
  torch==2.5.1
</code></pre>
<p>You will need to provide steps for someone else to reproduce.</p>
</blockquote>
<p>How long did it take you to receive this error? I waited for nearly 5 minutes before pressing <kbd>ctrl</kdb> + <kdb>C</kbd> and it's still going.</p>
<p>As the error suggests, I had to run:</p>
<pre><code class="language-shell">uv remove torch
uv add torch==2.5.1
uv add vllm
</code></pre>
<p>but as @dipta007 points out, shouldn't uv automatically downgrade <code>torch</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-16 18:49</div>
            <div class="timeline-body"><p>Closing as we'd need more info to help here. Can always re-open.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-16 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2025-02-16 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-02-16 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dipta007">@dipta007</a> on 2025-02-16 23:58</div>
            <div class="timeline-body"><p>@charliermarsh added more information with reproducible steps, Please reopen üôè
Thanks @notatallshaw for the steps and @zanieb for the checklist</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-17 03:04</div>
            <div class="timeline-body"><p>Ahh I see. I think this won't work as you expect because the first <code>uv add torch</code> will set a lower bound in the <code>pyproject.toml</code> (intentionally):</p>
<pre><code class="language-toml">[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13.0&quot;
dependencies = [
    &quot;torch&gt;=2.6.0&quot;,
]
</code></pre>
<p><code>uv add vllm</code> won't loosen that constraint (imagine if you'd written that out by hand -- it'd be surprising for <code>uv add</code> to change it!), so it's stuck trying to resolve for the latest <code>torch</code>.</p>
<p>My suggestion would be to use <code>uv add torch vllm</code> so uv can determine those lower-bounds together?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:47 UTC
    </footer>
</body>
</html>
