<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImportError when installing a package with a dependency on another package even though the required package is installed - astral-sh/uv #2991</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ImportError when installing a package with a dependency on another package even though the required package is installed</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2991">#2991</a>
        opened by <a href="https://github.com/AlessandroPomponio">@AlessandroPomponio</a>
        on 2024-04-11 12:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlessandroPomponio">@AlessandroPomponio</a> on 2024-04-11 12:57</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<h2>Issue</h2>
<p>Hello,
I'm trying out <code>uv</code> and I'm encountering a weird error with it.</p>
<p>The package <code>pytorch-fast-transformers</code> requires <code>torch</code> to be installed. Despite it being installed in the venv and appearing when doing <code>uv pip show torch</code>, attempting to install <code>pytorch-fast-transformers</code> will result in an <code>ImportError</code>.</p>
<p>Example:</p>
<pre><code>uv venv
source .venv/bin/activate
uv pip install torch
uv pip install pytorch-fast-transformers
</code></pre>
<p>Will output the following:</p>
<pre><code>error: Failed to download and build: pytorch-fast-transformers==0.4.0
  Caused by: Failed to build: pytorch-fast-transformers==0.4.0
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 19, in &lt;module&gt;
ModuleNotFoundError: No module named 'torch'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmp2WMNKV/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 325, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=['wheel'])
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmp2WMNKV/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 295, in _get_build_requires
    self.run_setup()
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmp2WMNKV/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 487, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmp2WMNKV/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 22, in &lt;module&gt;
ImportError: PyTorch is required to install pytorch-fast-transformers. Please install your favorite version of PyTorch, we support 1.3.1, 1.5.0 and &gt;=1.6
---
</code></pre>
<blockquote>
<p>[!NOTE]<br />
Output with <code>-v</code> flag below</p>
</blockquote>
<details>

<summary>Disclose here</summary>

<pre><code>INFO Found a virtualenv through VIRTUAL_ENV at: /Users/alessandropomponio/uv-test/.venv
DEBUG Cached interpreter info for Python 3.10.12, skipping probing: .venv/bin/python
DEBUG Using Python 3.10.12 environment at .venv/bin/python
DEBUG Trying to lock if free: .venv/.lock
DEBUG Using registry request timeout of 300s
DEBUG Solving with target Python version 3.10.12
DEBUG Adding direct dependency: pytorch-fast-transformers*
TRACE Fetching metadata for pytorch-fast-transformers from https://pypi.org/simple/pytorch-fast-transformers/
TRACE cached request https://pypi.org/simple/pytorch-fast-transformers/ is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://pypi.org/simple/pytorch-fast-transformers/
TRACE Received package metadata for: pytorch-fast-transformers
TRACE selecting candidate for package pytorch-fast-transformers with range Range { segments: [(Unbounded, Unbounded)] } with 8 remote versions
TRACE found candidate for package PackageName(&quot;pytorch-fast-transformers&quot;) with range Range { segments: [(Unbounded, Unbounded)] } after 0 steps: &quot;0.4.0&quot; version
DEBUG Searching for a compatible version of pytorch-fast-transformers (*)
TRACE selecting candidate for package pytorch-fast-transformers with range Range { segments: [(Unbounded, Unbounded)] } with 8 remote versions
TRACE found candidate for package PackageName(&quot;pytorch-fast-transformers&quot;) with range Range { segments: [(Unbounded, Unbounded)] } after 0 steps: &quot;0.4.0&quot; version
DEBUG Selecting: pytorch-fast-transformers==0.4.0 (pytorch-fast-transformers-0.4.0.tar.gz)
TRACE cached request https://files.pythonhosted.org/packages/ea/bc/00f597fefeab6341114c41045c1b232c38436738e0e8eac1bc9d5e9d5962/pytorch-fast-transformers-0.4.0.tar.gz is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/ea/bc/00f597fefeab6341114c41045c1b232c38436738e0e8eac1bc9d5e9d5962/pytorch-fast-transformers-0.4.0.tar.gz
DEBUG Preparing metadata for: pytorch-fast-transformers==0.4.0
DEBUG No static `PKG-INFO` available for: pytorch-fast-transformers==0.4.0 (DynamicPkgInfo(UnsupportedMetadataVersion(&quot;2.1&quot;)))
DEBUG No static `pyproject.toml` available for: pytorch-fast-transformers==0.4.0 (MissingPyprojectToml)
DEBUG Solving with target Python version 3.10.12
DEBUG Adding direct dependency: setuptools&gt;=40.8.0
TRACE Fetching metadata for setuptools from https://pypi.org/simple/setuptools/
TRACE cached request https://pypi.org/simple/setuptools/ is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://pypi.org/simple/setuptools/
TRACE Received package metadata for: setuptools
TRACE selecting candidate for package setuptools with range Range { segments: [(Included(&quot;40.8.0&quot;), Unbounded)] } with 550 remote versions
TRACE found candidate for package PackageName(&quot;setuptools&quot;) with range Range { segments: [(Included(&quot;40.8.0&quot;), Unbounded)] } after 0 steps: &quot;69.2.0&quot; version
DEBUG Searching for a compatible version of setuptools (&gt;=40.8.0)
TRACE selecting candidate for package setuptools with range Range { segments: [(Included(&quot;40.8.0&quot;), Unbounded)] } with 550 remote versions
TRACE found candidate for package PackageName(&quot;setuptools&quot;) with range Range { segments: [(Included(&quot;40.8.0&quot;), Unbounded)] } after 0 steps: &quot;69.2.0&quot; version
DEBUG Selecting: setuptools==69.2.0 (setuptools-69.2.0-py3-none-any.whl)
TRACE cached request https://files.pythonhosted.org/packages/92/e1/1c8bb3420105e70bdf357d57dd5567202b4ef8d27f810e98bb962d950834/setuptools-69.2.0-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/92/e1/1c8bb3420105e70bdf357d57dd5567202b4ef8d27f810e98bb962d950834/setuptools-69.2.0-py3-none-any.whl.metadata
TRACE Received built distribution metadata for: setuptools==69.2.0
DEBUG Installing in setuptools==69.2.0 in /Users/alessandropomponio/Library/Caches/uv/.tmpbwwP79/.venv
DEBUG Requirement already cached: setuptools==69.2.0
DEBUG Installing build requirement: setuptools==69.2.0
DEBUG Calling `setuptools.build_meta:__legacy__.get_requires_for_build_wheel()`
error: Failed to download and build: pytorch-fast-transformers==0.4.0
  Caused by: Failed to build: pytorch-fast-transformers==0.4.0
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 19, in &lt;module&gt;
ModuleNotFoundError: No module named 'torch'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmpbwwP79/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 325, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=['wheel'])
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmpbwwP79/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 295, in _get_build_requires
    self.run_setup()
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmpbwwP79/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 487, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/Users/alessandropomponio/Library/Caches/uv/.tmpbwwP79/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 22, in &lt;module&gt;
ImportError: PyTorch is required to install pytorch-fast-transformers. Please install your favorite version of PyTorch, we support 1.3.1, 1.5.0 and &gt;=1.6
---
</code></pre>
</details>

<p>With the following, however, we can see that <code>torch</code> is correctly installed and available:</p>
<pre><code>uv pip show torch
Name: torch
Version: 2.2.2
Location: /Users/alessandropomponio/uv-test/.venv/lib/python3.10/site-packages
Requires: filelock, fsspec, jinja2, networkx, sympy, typing-extensions
Required-by:
</code></pre>
<p>Running <code>import torch</code> from an interactive <code>python</code> session also works.</p>
<h2>Details</h2>
<p>System: MacOS
Python Version: Python 3.10.12
UV Version: uv 0.1.31</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlessandroPomponio">@AlessandroPomponio</a> on 2024-04-11 12:59</div>
            <div class="timeline-body"><p>The fact that <code>setuptools</code> gets installed in a temporary venv despite being available in the currently active venv makes me think the installation process is working in isolation and ends up causing the error I encountered</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-11 14:05</div>
            <div class="timeline-body"><p>I believe you need to run with <code>--no-build-isolation</code> since <code>pytorch-fast-transformers</code> depends on Torch, but doesn't include it in its build dependencies.</p>
<p>pip also fails to install this package with <code>--use-pep517</code>, which will eventually be the default in pip (and is the default in uv today):</p>
<pre><code>❯ pip install pytorch-fast-transformers --use-pep517
Collecting pytorch-fast-transformers
  Downloading pytorch-fast-transformers-0.4.0.tar.gz (93 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 93.6/93.6 kB 4.2 MB/s eta 0:00:00
  Installing build dependencies ... done
  Getting requirements to build wheel ... error
  error: subprocess-exited-with-error

  × Getting requirements to build wheel did not run successfully.
  │ exit code: 1
  ╰─&gt; [26 lines of output]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 19, in &lt;module&gt;
      ModuleNotFoundError: No module named 'torch'

      The above exception was the direct cause of the following exception:

      Traceback (most recent call last):
        File &quot;/Users/crmarsh/.local/share/rtx/installs/python/3.12.1/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 353, in &lt;module&gt;
          main()
        File &quot;/Users/crmarsh/.local/share/rtx/installs/python/3.12.1/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 335, in main
          json_out['return_val'] = hook(**hook_input['kwargs'])
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;/Users/crmarsh/.local/share/rtx/installs/python/3.12.1/lib/python3.12/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 118, in get_requires_for_build_wheel
          return hook(config_settings)
                 ^^^^^^^^^^^^^^^^^^^^^
        File &quot;/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/pip-build-env-wn0uzfrt/overlay/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 325, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=['wheel'])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/pip-build-env-wn0uzfrt/overlay/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 295, in _get_build_requires
          self.run_setup()
        File &quot;/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/pip-build-env-wn0uzfrt/overlay/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 487, in run_setup
          super().run_setup(setup_script=setup_script)
        File &quot;/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/pip-build-env-wn0uzfrt/overlay/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
          exec(code, locals())
        File &quot;&lt;string&gt;&quot;, line 22, in &lt;module&gt;
      ImportError: PyTorch is required to install pytorch-fast-transformers. Please install your favorite version of PyTorch, we support 1.3.1, 1.5.0 and &gt;=1.6
      [end of output]

  note: This error originates from a subprocess, and is likely not a problem with pip.
error: subprocess-exited-with-error

× Getting requirements to build wheel did not run successfully.
│ exit code: 1
╰─&gt; See above for output.

note: This error originates from a subprocess, and is likely not a problem with pip.
</code></pre>
<p>Try <code>uv pip install pytorch-fast-transformers --no-build-isolation</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-04-11 14:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-11 14:08</div>
            <div class="timeline-body"><p>(Added a note here: https://github.com/astral-sh/uv/issues/2252)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlessandroPomponio">@AlessandroPomponio</a> on 2024-04-11 17:12</div>
            <div class="timeline-body"><p>Thank you very much Charlie! That was it!
Have a great day!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlessandroPomponio on 2024-04-11 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-11 17:19</div>
            <div class="timeline-body"><p>No prob :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:34:03 UTC
    </footer>
</body>
</html>
