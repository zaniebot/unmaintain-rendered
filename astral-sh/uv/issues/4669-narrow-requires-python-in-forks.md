```yaml
number: 4669
title: "Narrow `requires-python` in forks"
type: issue
state: closed
author: charliermarsh
labels:
  - bug
  - resolver
  - preview
assignees: []
created_at: 2024-06-30T21:30:07Z
updated_at: 2024-07-30T15:35:00Z
url: https://github.com/astral-sh/uv/issues/4669
synced_at: 2026-01-10T04:53:49Z
```

# Narrow `requires-python` in forks

---

_Issue opened by @charliermarsh on 2024-06-30 21:30_

I have some difficulties with `numpy` (macOS, uv 0.2.18). With a requirements.in

```
numpy >=1.26; python_version>="3.9"
numpy <1.26; python_version<"3.9"
```

I cannot univeral-lock for Python >= 3.8:

```shell
$ uv pip compile -p 3.8 --universal requirements.in
  × No solution found when resolving dependencies:
  ╰─▶ Because only the following versions of numpy{python_version >= '3.9'} are available:
          numpy{python_version >= '3.9'}<=1.26.0
          numpy{python_version >= '3.9'}==1.26.1
          numpy{python_version >= '3.9'}==1.26.2
          numpy{python_version >= '3.9'}==1.26.3
          numpy{python_version >= '3.9'}==1.26.4
          numpy{python_version >= '3.9'}==2.0.0
      and the requested Python version (3.8) does not satisfy Python>=3.9, we can conclude that any of:
          numpy{python_version >= '3.9'}>=1.26.0,<1.26.2
          numpy{python_version >= '3.9'}>1.26.2,<1.26.3
          numpy{python_version >= '3.9'}>1.26.3,<1.26.4
          numpy{python_version >= '3.9'}>1.26.4,<2.0.0
          numpy{python_version >= '3.9'}>2.0.0
       are incompatible.
      And because the requested Python version (3.8) does not satisfy Python>=3.9 and you require
      numpy{python_version >= '3.9'}>=1.26, we can conclude that the requirements are unsatisfiable.
```

_Originally posted by @davidfritzsche in https://github.com/astral-sh/uv/issues/4640#issuecomment-2198761783_
            

---

_Label `bug` added by @charliermarsh on 2024-06-30 21:30_

---

_Label `resolver` added by @charliermarsh on 2024-06-30 21:30_

---

_Label `preview` added by @charliermarsh on 2024-06-30 21:30_

---

_Comment by @charliermarsh on 2024-06-30 21:30_

My guess is that `numpy >=1.26` doesn't support Python 3.8, and we're still trying to lock for your requires-python in that branch. But in theory we could only require `requires-python >= 3.9` in the `numpy >=1.26` branch.

---

_Comment by @charliermarsh on 2024-06-30 21:36_

See also https://github.com/astral-sh/uv/issues/4668 for another variant of this issue.

---

_Comment by @charliermarsh on 2024-07-01 01:46_

I can give this a try... Important correctness issue.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-07-01 12:43_

---

_Comment by @charliermarsh on 2024-07-01 15:57_

This is pretty tricky because we build the `VersionMap` based on the Python requirement, but now the Python requirement can change in a given fork.

---

_Comment by @charliermarsh on 2024-07-01 18:23_

I have the NumPy fork working:

```
# This file was autogenerated by uv via the following command:
#    uv pip compile -p 3.7 --universal req.in
numpy==1.21.6 ; python_version < '3.9'
    # via -r req.in
numpy==2.0.0 ; python_version >= '3.9'
    # via -r req.in
```

---

_Comment by @charliermarsh on 2024-07-01 18:23_

However, `echo 'uv;python_version>="3.8"' | uv pip compile -p 3.7 --universal -` requires some more work...

---

_Closed by @charliermarsh on 2024-07-02 12:23_

---

_Closed by @charliermarsh on 2024-07-02 12:23_

---

_Comment by @BurntSushi on 2024-07-08 16:57_

With #4902 merged, it reverted the fix for this issue, so I'm re-opening.

---

_Reopened by @BurntSushi on 2024-07-08 16:57_

---

_Closed by @charliermarsh on 2024-07-30 15:35_

---
