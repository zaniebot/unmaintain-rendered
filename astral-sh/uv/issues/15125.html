<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--resolution=lowest` does not fork on requires-python - astral-sh/uv #15125</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>--resolution=lowest</code> does not fork on requires-python</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15125">#15125</a>
        opened by <a href="https://github.com/ego-thales">@ego-thales</a>
        on 2025-08-07 08:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ego-thales">@ego-thales</a> on 2025-08-07 08:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi everyone,</p>
<h3>The problem</h3>
<p>When using <code>--resolution=lowest</code>, it seems that <code>uv</code> does not try to find &quot;the lowest compatible version&quot;, it simply takes the lower bound I wrote in <code>pyproject.toml</code> and uses it blindly. It leads to failure when using an incompatible python version:</p>
<pre><code class="language-console">$ uv run --resolution=lowest -p313 pytest
Using CPython 3.13.3
Removed virtual environment at: .venv
Creating virtual environment at: .venv
error: Distribution `torch==2.3.0 @ registry+https://pypi.org/simple` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're using CPython 3.13 (`cp313`), but `torch` (v2.3.0) only has wheels with the following Python ABI tag: `cp312`
</code></pre>
<h3>Expected behaviour</h3>
<p>I would expect <code>uv</code> to figure out by itself the lowest compatible version with my python versions.</p>
<h3>Relevant context</h3>
<pre><code class="language-toml"># pyproject.toml
requires-python = &quot;&gt;=3.12, &lt;3.14&quot;
dependencies = [
    &quot;torch&gt;=2.3&quot;,
    # Adjust indirect dependencies lower bound
    &quot;filelock&gt;=3.13&quot;, # torch&lt;=2.7.1
    &quot;fsspec&gt;=2023.10&quot;, # torch&lt;=2.7.1
    &quot;networkx&gt;=3.2&quot;, # torch&lt;=2.7.1
    &quot;nvidia-nvjitlink-cu12&gt;=12.1&quot;, # torch &gt; nvidia-cusolver-cu12 &gt; nvidia-cusparse-cu12
    &quot;sympy&gt;=1.9&quot;, # torch&lt;=2.7.1
    &quot;typing-extensions&gt;=4.12&quot;, # torch&lt;=2.7.1
]
</code></pre>
<p>I'm not sure if this is a bug or if I missed the expected behaviour of <code>uv</code>. In the latter case, could you please help me understand what I should do?</p>
<p>Thanks in advance!
Élie</p>
<h3>Platform</h3>
<p>Ubuntu 22.04</p>
<h3>Version</h3>
<p>0.8.5</p>
<h3>Python version</h3>
<p>3.12/3.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ego-thales on 2025-08-07 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`--resolution=lowest` does not resolve?" to "`--resolution=lowest` does not fork on requires-python" by @konstin on 2025-08-07 09:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-07 09:57</div>
            <div class="timeline-body"><p>This missing inverted logic for <code>--resolution=lowest</code>: For the default resolution, when we see different <code>requires-python</code> value for versions, we split the resolution into two and would solve once for <code>&gt;=3.13</code> and once for <code>&lt;3.13,&gt;=3.12</code>, selecting two different versions and having wheel for both Python versions. We do this by selecting a <em>lower</em> torch version for <code>&lt;3.13,&gt;=3.12</code>. But we're missing the inverted lookup for <code>--resolution=lowest</code>: We already picked the lowest version, now we need to check for a <em>higher</em> torch version for <code>&gt;=3.13</code>.</p>
<p>As a workaround, you can set the following:</p>
<pre><code class="language-toml">[tool.uv]
required-environments = [
  &quot;python_version &gt;= '3.12' and python_version &lt; '3.12'&quot;,
  &quot;python_version &gt;= '3.13'&quot;
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ego-thales">@ego-thales</a> on 2025-08-08 08:01</div>
            <div class="timeline-body"><p>Thanks for your time and answer! Your workaround also works fine (without the typoed <code>3.12</code>).
I also realized that indirect dependencies lower bound adjustments should be made in <code>constraint-dependencies</code>, not in denepdencies directly. For future reference:</p>
<pre><code class="language-toml">[tool.uv]
# Until github.com/astral-sh/uv/issues/15125 is fixed
required-environments = [
  &quot;python_version &gt;= '3.12' and python_version &lt; '3.13'&quot;,
  &quot;python_version &gt;= '3.13'&quot;
]
# Adjust `torch` indirect dependencies lower bound for example
constraint-dependencies = [
    &quot;filelock&gt;=3.13&quot;, # torch&lt;=2.7.1
    &quot;fsspec&gt;=2023.10&quot;, # torch&lt;=2.7.1
    &quot;networkx&gt;=3.2&quot;, # torch&lt;=2.7.1
    &quot;nvidia-nvjitlink-cu12&gt;=12.1&quot;, # torch &gt; nvidia-cusolver-cu12 &gt; nvidia-cusparse-cu12
    &quot;sympy&gt;=1.9&quot;, # torch&lt;=2.7.1
    &quot;typing-extensions&gt;=4.12&quot;, # torch&lt;=2.7.1
]
</code></pre>
<p>For those wondering, <code>constraint-dependencies</code> is necessary because otherwise, <code>uv</code> would try to install <code>nvidia-nvjitlink-cu12</code> for example, even on macOS for which it does not exist.</p>
<p>All the best!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ego-thales on 2025-08-08 08:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @ego-thales on 2025-08-08 08:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ego-thales">@ego-thales</a> on 2025-08-08 09:56</div>
            <div class="timeline-body"><p>Sorry I accidentally closed while the bug is still there, even if the workaround works.</p>
<p>I also mentioned that there seems to be <a href="https://github.com/ThalesGroup/scio/issues/9">other issues</a> related to <code>--resolution=lowest</code>, but I'm not sure whether I should open a separate issue, or if it even is a bug or a misconfig from my part.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-19 12:02</div>
            <div class="timeline-body"><p>For that case, it sounds correct to have to use <code>tool.uv.required-environments</code>, at least for universal resolution. For testing <code>uv pip install --resolution=lowest</code> instead, this should not be a problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/juntyr">@juntyr</a> on 2025-12-18 20:41</div>
            <div class="timeline-body"><p>I encountered a variant of this problem when combining a lower bound <code>numpy~=2.3</code> in my pyproject.toml dependencies with <code>uv sync --resolution lowest-direct —-only-binary</code> in a Python 3.14 venv, which results in uv trying to install numpy 2.3.0, which doesn’t have 3.14 wheels (2.3.2 does). Interestingly, <code>uv pip install numpy~=2.3 --resolution lowest-direct —-only-binary</code> in a Python 3.14 venv works as expected and installs 2.3.2. The above mentioned workaround of adding required environments doesn’t work for me.</p>
<p>I’m on uv version 0.9.18.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:06 UTC
    </footer>
</body>
</html>
