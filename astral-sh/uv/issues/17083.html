<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` fails if UV_GIT_LFS=1 - astral-sh/uv #17083</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv add</code> fails if UV_GIT_LFS=1</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/17083">#17083</a>
        opened by <a href="https://github.com/kod-kristoff">@kod-kristoff</a>
        on 2025-12-11 12:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kod-kristoff">@kod-kristoff</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I can't add dependencies with <code>uv add</code>, all fails with trying to resolve the name as a Git repository.</p>
<pre><code class="language-bash">&gt; uv init uv-import
&gt; cd uv-import
&gt; uv add setuptools
error: `setuptools` did not resolve to a Git repository, but a Git extension (`--lfs`) was provided.
&gt; uv add pandas
error: `pandas` did not resolve to a Git repository, but a Git extension (`--lfs`) was provided.
</code></pre>
<p><strong>UPDATE</strong>: If I run <code>unset UV_GIT_LFS</code>, the problem is resolved.</p>
<p>With <code>-vvv</code>:</p>
<pre><code class="language-bash">&gt; uv add -vvv setuptools
DEBUG uv 0.9.17 (2b5d65e61 2025-12-09)
TRACE Checking lock for `/home/-/.cache/uv` at `/home/-/.cache/uv/.lock`
DEBUG Acquired shared lock for `/home/-/.cache/uv`
DEBUG Found project root: `/home/-/projekt/work/uv-test`
DEBUG No workspace root found, using project root
TRACE Checking lock for `/home/-/projekt/work/uv-test` at `/tmp/uv-43e8c4775b984fd5.lock`
DEBUG Acquired exclusive lock for `/home/-/projekt/work/uv-test`
DEBUG Reading Python requests from version file at `/home/-/projekt/work/uv-test/.python-version`
DEBUG Using Python request `3.11` from version file at `.python-version`
DEBUG Checking for Python environment at: `.venv`
TRACE Found cached interpreter info for Python 3.11.6, skipping query of: .venv/bin/python3
DEBUG The project environment's Python version satisfies the request: `Python 3.11`
TRACE The project environment's Python version meets the Python requirement: `&gt;=3.11`
TRACE The virtual environment's Python interpreter meets the Python preference: `prefer managed`
DEBUG Released lock at `/tmp/uv-43e8c4775b984fd5.lock`
TRACE Checking lock for `.venv` at `.venv/.lock`
DEBUG Acquired exclusive lock for `.venv`
DEBUG Released lock at `/home/-/projekt/work/uv-test/.venv/.lock`
DEBUG Released lock at `/home/-/.cache/uv/.lock`
TRACE Error trace: `setuptools` did not resolve to a Git repository, but a Git extension (`--lfs`) was provided.
error: `setuptools` did not resolve to a Git repository, but a Git extension (`--lfs`) was provided.
</code></pre>
<p><strong>Expected behavoiur</strong>: The given package is added to <code>pyproject.toml</code> and installed in <code>.venv</code>.</p>
<p><strong>Workaround</strong>: Add it manually to <code>pyproject.toml</code> and run <code>uv sync</code></p>
<h3>Platform</h3>
<p>Linux 6.17.9-arch1-1 x86_64 GNU/Linux (Arch Linux)</p>
<h3>Version</h3>
<p>uv 0.9.17 (2b5d65e61 2025-12-09)</p>
<h3>Python version</h3>
<p>Python 3.11.6, Python 3.13.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @kod-kristoff on 2025-12-11 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv add` setuptools fails, treats setuptools as Git repository" to "`uv add` fails if UV_GIT_LFS=1" by @kod-kristoff on 2025-12-11 12:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-11 14:54</div>
            <div class="timeline-body"><p>CC @samypr100</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-11 15:15</div>
            <div class="timeline-body"><p>The error comes from https://github.com/astral-sh/uv/blob/fee7f9d093b3ef20f4e86aa7f92ebe67145240f6/crates/uv-workspace/src/pyproject.rs#L1660-L1662</p>
<p>We definitely need to relax this. Maybe we need to parse <code>UV_GIT_LFS</code> separately from <code>--lfs</code> and treat a global lfs toggle as different from the non-global one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-12-11 15:52</div>
            <div class="timeline-body"><p>Agreed, in hindsight I should've not used the same env var in https://github.com/astral-sh/uv/blob/59d73fdddf7281033cd9b8f50d6e978b97db1317/crates/uv-cli/src/lib.rs#L4164</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-11 15:53</div>
            <div class="timeline-body"><p>We have our own <code>parse_boolish_environment_variable</code> and <code>EnvironmentOptions</code> struct now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @samypr100 by @samypr100 on 2025-12-12 01:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-12-15 14:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:39 UTC
    </footer>
</body>
</html>
