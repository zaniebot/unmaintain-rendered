<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support checking `uv.lock` aligns with latest changes to `pyproject.toml` - astral-sh/uv #7639</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support checking <code>uv.lock</code> aligns with latest changes to <code>pyproject.toml</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7639">#7639</a>
        opened by <a href="https://github.com/butterlyn">@butterlyn</a>
        on 2024-09-23 13:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/butterlyn">@butterlyn</a> on 2024-09-23 13:49</div>
            <div class="timeline-body"><p>Request for a feature to check that no (relevant) changes to <code>pyproject.toml</code> have been made since <code>uv.lock</code> was last updated.
For reference, this is implemented in Poetry via the command <code>poetry check --lock</code> (previously under <code>poetry lock --check</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-23 13:52</div>
            <div class="timeline-body"><p>Does <code>uv lock --locked</code> work for you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-23 14:01</div>
            <div class="timeline-body"><p>We might want to add an alias for <code>--locked</code> in the <code>uv lock</code> command ‚Äî <code>--locked</code> exists to match the rest of the commands but it's non-obvious what it means.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/butterlyn">@butterlyn</a> on 2024-09-23 14:13</div>
            <div class="timeline-body"><p>Checked <code>uv lock --locked</code>, a few points:</p>
<ul>
<li>The requested feature is not about detecting if there are possible updates to <code>uv.lock</code> file due to new releases of dependencies - it's about detecting if the <code>pyproject.toml</code> was changed since the current <code>uv.lock</code> file was created.</li>
<li>The use case would be for raising an error in a CICD pipeline or pre-commit hook to catch if a developer changed a dependency or <code>uv.sources</code> field in <code>pyproject.toml</code> but forgot to commit a corresponding new <code>uv.lock</code> to the repo.</li>
<li>The requested feature, ideally, wouldn't involve actually resolving any dependencies and could be performed in a CICD pipeline that may not have the correct connections set up to update the <code>uv.lock</code> file</li>
</ul>
<p>Currently using <code>poetry check --lock</code> in CICD pipelines, trying to migrate to uv but can't find an equivalent command.</p>
<p>I believe Poetry achieves this by hashing relevant <code>pyproject.toml</code> inputs and adding the hash to the lock file to quickly detect changes? Though I'm not entirely sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-23 14:15</div>
            <div class="timeline-body"><p>I think everything you've outlined there is also true of <code>uv lock --locked</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-23 14:18</div>
            <div class="timeline-body"><p>For example:</p>
<pre><code>‚ùØ uv lock --locked --offline
Resolved 8 packages in 1ms
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-23 14:19</div>
            <div class="timeline-body"><p>Yeah similarly:</p>
<pre><code>‚ùØ uv lock --locked --offline
Resolved 1 package in 2ms

‚ùØ uv add anyio --frozen

‚ùØ uv lock --locked --offline
Resolved 4 packages in 5ms
error: The lockfile at `uv.lock` needs to be updated, but `--locked` was provided. To update the lockfile, run `uv lock`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/butterlyn">@butterlyn</a> on 2024-09-23 14:21</div>
            <div class="timeline-body"><p>Thank you üòÑ will use <code>uv lock --locked --offline</code> in that case</p>
<p>Reading the command description (&quot;Assert that the <code>uv.lock</code> will remain unchanged&quot;), I didn't pick up that this was the intended usage... if it's outlined in the docs then I missed it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-09-23 14:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-23 14:21</div>
            <div class="timeline-body"><p>I'll follow up with some improvements here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danyeaw">@danyeaw</a> on 2024-10-06 00:12</div>
            <div class="timeline-body"><p>If I set a constraint on a dependency, like <code>dependencies = [ 'exceptiongroup&gt;=1.0.0; python_version &lt; &quot;3.11&quot;',]</code>, then running <code>uv lock --locked --offline</code> results in an error:</p>
<pre><code>Using CPython 3.12.6 interpreter at: /opt/hostedtoolcache/Python/3.12.6/x64/bin/python
  √ó No solution found when resolving dependencies:
  ‚ï∞‚îÄ‚ñ∂ Because only exceptiongroup{python_full_version &lt; '3.11'}&lt;1.0.0 is
      available and your project depends on exceptiongroup{python_full_version
      &lt; '3.11'}&gt;=1.0.0, we can conclude that your project's requirements are
      unsatisfiable.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-06 14:31</div>
            <div class="timeline-body"><p>We presume we can't query the index to discover more versions of <code>exceptiongroup</code> ‚Äî it sounds correct that we fail there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danyeaw">@danyeaw</a> on 2024-10-06 18:43</div>
            <div class="timeline-body"><p>Do I need to query / build the index somehow before running the <code>--locked --offline</code> command, then?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-06 22:38</div>
            <div class="timeline-body"><p>@danyeaw what's your goal? If the lockfile is up to date, I don't think we'll query the index and the command should succeed. If not, it'll fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danyeaw">@danyeaw</a> on 2024-10-06 22:51</div>
            <div class="timeline-body"><p>@zanieb I have one extra dependency for my project that is only applicable for older versions of Python. I want to then check the lock file integrity in CI, and it fails with the error above. The lock file is up to date.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-12-08 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-12-08 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hbelmiro">@hbelmiro</a> on 2025-12-06 00:15</div>
            <div class="timeline-body"><p>Native uv requires uv sync --locked which attempts to sync the environment. My tool performs the static check you are looking for.</p>
<p>https://github.com/hbelmiro/uv-lock-check</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:43 UTC
    </footer>
</body>
</html>
