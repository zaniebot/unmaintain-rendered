```yaml
number: 10273
title: "Better error message with `--locked` when `upgrade` is requested"
type: issue
state: open
author: sayandipdutta
labels:
  - error messages
assignees: []
created_at: 2025-01-02T16:29:08Z
updated_at: 2025-01-03T17:17:34Z
url: https://github.com/astral-sh/uv/issues/10273
synced_at: 2026-01-10T01:57:23Z
```

# Better error message with `--locked` when `upgrade` is requested

---

_Issue opened by @sayandipdutta on 2025-01-02 16:29_

## Description:
Currently, if `upgrade` is requested, `uv lock/sync --locked/--check` fails with the following error:
> error: The lockfile at `uv.lock` needs to be updated, but `--locked` was provided. To update the lockfile, run `uv lock`.

I was initially surprised by this, because I thought if no updates are available for any packages, the lockfile shouldn't need to change.\
However, [the code](https://github.com/astral-sh/uv/blob/a3307d91a355efc56df8560e6f7f243b310ec947/crates/uv/src/commands/project/lock.rs#L808) seems to suggest otherwise, or I misunderstood and it is actually a bug. I am not sure why this was done, but I guess searching the web to determine whether updates are available is not an option, or maybe it simply cannot be done. Either way, I can live with that. However, this means, it is always known that if `upgrade==true` and `--locked/--check` is provided, the command cannot succeed. So my suggestion would be to either add more specific error message or provide additional context as warning for this specific case.

## Minimum Reproducible Example:
```bash
uv init foo && cd foo && uv lock && uv lock --locked --upgrade
```
While the above is quite unlikely, the following is less so:
```shell
uv init foo && cd foo && uv lock && echo "\n[tool.uv]\nupgrade = true" >> pyproject.toml && uv lock --locked
```
```toml
# pyproject.toml
[project]
name = "foo"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.13.0"
dependencies = []

[tool.uv]
upgrade=true
```
## Actual Behavior:
```shell
Initialized project `foo` at `/home/sayandip/github/uv/foo`
Using CPython 3.13.0
Resolved 1 package in 13ms
Using CPython 3.13.0
Creating virtual environment at: .venv
Resolved 1 package in 10ms
error: The lockfile at `uv.lock` needs to be updated, but `--locked` was provided. To update the lockfile, run `uv lock`.
```

## Expected Behavior:
```shell
Initialized project `foo` at `/home/sayandip/github/uv/foo`
Using CPython 3.13.0
Resolved 1 package in 13ms
Using CPython 3.13.0
Creating virtual environment at: .venv
warning: Failed to validate existing lockfile: The lockfile needs to be updated when `upgrade` is requested. Either disable upgrade in settings, or pass `--no-upgrade`.
Resolved 1 package in 10ms
error: The lockfile at `uv.lock` needs to be updated, but `--locked` was provided. To update the lockfile, run `uv lock`.
```
Or,
```shell
Initialized project `foo` at `/home/sayandip/github/uv/foo`
Using CPython 3.13.0
Resolved 1 package in 27ms
Using CPython 3.13.0
Creating virtual environment at: .venv
error: The lockfile at `uv.lock` needs to be updated when `upgrade` is requested, either omit `--locked` to update the lockfile, or pass `--no-upgrade` to disable update.
```

## System Information:
Ubuntu 24.04.1 LTS (via WSL2 on win11)
uv 0.5.13
WSL Info:
WSL version: 2.3.26.0
Kernel version: 5.15.167.4-1
Windows version: 10.0.27764.1000

---
**NOTE:** The [docs](https://docs.astral.sh/uv/concepts/resolution/#dependency-preferences) say the following:

> .... This means that locked or installed versions will not change unless an incompatible version is requested or an upgrade is explicitly requested with `--upgrade`.

Technically, one can still interpret this as:
> locked or installed versions may or may not change if an incompatible version is requested or an upgrade is explicitly requested with `--upgrade`.

---

_Comment by @sayandipdutta on 2025-01-02 16:30_

If it is deemed as an issue and either of the solutions are acceptable, I would to be glad to contribute.

---

_Comment by @charliermarsh on 2025-01-03 15:32_

Perhaps we should just mark those options as conflicting on the CLI?

---

_Label `error messages` added by @charliermarsh on 2025-01-03 15:32_

---

_Comment by @sayandipdutta on 2025-01-03 16:38_

I thought about it, but I didn't find a way to express conflicts between Lock options and Global options. I will look again.

Edit: `upgrade=true` could be set in config file as well. So not sure what will be the best place to raise.

---

_Referenced in [astral-sh/uv#10836](../../astral-sh/uv/pulls/10836.md) on 2025-01-22 01:28_

---

_Referenced in [astral-sh/uv#1419](../../astral-sh/uv/issues/1419.md) on 2025-01-29 14:23_

---
