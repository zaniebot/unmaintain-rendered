```yaml
number: 2058
title: "`--system` didn't fallback to running environment when `uv` installed as python package."
type: issue
state: closed
author: T-256
labels:
  - compatibility
assignees: []
created_at: 2024-02-28T22:02:59Z
updated_at: 2024-05-22T16:34:26Z
url: https://github.com/astral-sh/uv/issues/2058
synced_at: 2026-01-10T01:57:04Z
```

# `--system` didn't fallback to running environment when `uv` installed as python package.

---

_Issue opened by @T-256 on 2024-02-28 22:02_

1. create a venv and install `uv` in it.
2. make sure you don't have python on the PATH.
3. cd parent-dir to prevent `.venv` detection
```shell
C:\Users\User\Desktop> uvtest\.venv\Scripts\python -m uv pip list
Package Version
------- -------
uv      0.1.12

C:\Users\User\Desktop> uvtest\.venv\Scripts\python -m uv pip list --system
error: Could not find `python.exe` through `py --list-paths` or in 'PATH'. Is Python installed?
```

Expected: Both of them should select `uvtest\.venv\Scripts\python`.

---

_Label `bug` added by @charliermarsh on 2024-02-28 22:09_

---

_Comment by @charliermarsh on 2024-02-28 22:10_

What's the use-case / motivation for invoking `uv` through `python -m uv`? (As an FYI, that will add a bunch of overhead to each invocation.)

---

_Comment by @charliermarsh on 2024-02-28 22:11_

(This looks straightforward to fix though.)

---

_Comment by @NMertsch on 2024-02-28 22:12_

```shell
$ uv pip list --help
      [...]
      --system
          List packages for the system Python.

          By default, `uv` lists packages in the currently activated virtual environment, or a virtual environment (`.venv`) located in the current working directory or any parent directory, falling back to the system Python if no virtual environment is found. The `--system` option instructs `uv` to use the first Python found in the system `PATH`.
```

I don't understand why this is a bug. From "use the first Python found in the system `PATH`" I would expect the observed behavior: Python is not in the `PATH`, so uv throws an error.

---

_Comment by @charliermarsh on 2024-02-28 22:14_

Yeah, I guess this is debatable.

Why pass system to this invocation?

---

_Comment by @T-256 on 2024-02-28 22:33_

> What's the use-case / motivation for invoking `uv` through `python -m uv`? (As an FYI, that will add a bunch of overhead to each invocation.)

Actually, this doesn't have any usecase imo. Since first command successfully found and fallback to caller, I expected `--system` should did it too.


> I don't understand why this is a bug. From "use the first Python found in the system `PATH`" I would expect the observed behavior: Python is not in the `PATH`, so uv throws an error.

Since `--system` is shorthand of `--python $(which python3)`, I think in perspective of modules run as scripts (`-m`), the `python/python3` executables are already on PATH environment.
An example from rye app that returns PATH variable:
```
> rye run hello
C:\Users\User\Desktop\New folder (2)\ttt\.venv\Scripts;C:\Program Files (x86)\Common Files\Oracle\Java\javapath;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\downlevel;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Program Files\dotnet\;C:\Program Files (x86)\NVIDIA Corporation\PhysX\Common;
```

---

_Label `bug` removed by @charliermarsh on 2024-02-28 22:44_

---

_Label `needs-design` added by @charliermarsh on 2024-02-28 22:44_

---

_Label `needs-design` removed by @charliermarsh on 2024-02-28 22:44_

---

_Label `needs-decision` added by @charliermarsh on 2024-02-28 22:44_

---

_Referenced in [astral-sh/uv#2222](../../astral-sh/uv/issues/2222.md) on 2024-03-06 00:03_

---

_Comment by @konstin on 2024-03-07 15:27_

What about we set `UV_DEFAULT_PYTHON` in the launcher and use that as precedence over `python` for the default python in uv? Many people are very used the `python -m` not only working, but being necessary to do the right thing, so i'd like to support that.

---

_Comment by @zanieb on 2024-03-07 17:48_

I suggest a similar thing in https://github.com/astral-sh/uv/issues/2222#issuecomment-1979838755

I'm not opposed to it.

---

_Assigned to @konstin by @konstin on 2024-03-10 11:03_

---

_Label `needs-decision` removed by @konstin on 2024-03-10 11:03_

---

_Label `compatibility` added by @konstin on 2024-03-10 11:03_

---

_Referenced in [astral-sh/uv#2334](../../astral-sh/uv/pulls/2334.md) on 2024-03-10 13:16_

---

_Referenced in [astral-sh/uv#2338](../../astral-sh/uv/pulls/2338.md) on 2024-03-10 13:37_

---

_Unassigned @konstin by @konstin on 2024-03-21 12:17_

---

_Referenced in [astral-sh/uv#3736](../../astral-sh/uv/pulls/3736.md) on 2024-05-22 14:14_

---

_Closed by @zanieb on 2024-05-22 16:34_

---

_Closed by @zanieb on 2024-05-22 16:34_

---
