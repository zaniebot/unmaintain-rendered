<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv add fails with gitlab index url - astral-sh/uv #10485</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv add fails with gitlab index url</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10485">#10485</a>
        opened by <a href="https://github.com/npaolini2634">@npaolini2634</a>
        on 2025-01-10 23:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/npaolini2634">@npaolini2634</a></div>
            <div class="timeline-body"><p>Hi, I love using UV, but I'm struggling with switching from uv pip to uv projects.</p>
<p>My repo depends on one package hosted on gitlab. Everything works fine when I use uv pip:
<code>uv pip install package_name --index-url https://gitlab.XXX.com/api/v4/projects/519/packages/pypi/simple</code></p>
<p>But fails if I try:
<code>uv add package_name --index-url https://gitlab.XXX.com/api/v4/projects/519/packages/pypi/simple</code></p>
<p>I've also tried --default-index instead of --index-url, unsafe-best-match index-strategy, and a variety of combinations of specifying the source/index in pyproject.toml with no success.</p>
<pre><code>Updating https://gitlab.XXX.com/api/v4/projects/519/packages/pypi/simple (HEAD)
  × Failed to download and build `package_name @ git+https://gitlab.XXX.com/api/v4/projects/519/packages/pypi/simple`
  ├─ Git operation failed
  ├─ failed to fetch into: C:\Users\user\AppData\Local\uv\cache\git-v0\db\99bb7ff362aa16f5
  ╰─ process didn't exit successfully: `C:\Program Files\Git\cmd\git.exe fetch --force --update-head-ok
      https://gitlab.XXX.com/api/v4/projects/519/packages/pypi/simple +HEAD:refs/remotes/origin/HEAD` (exit code: 128)
      --- stderr
      remote: 404 Not Found
      fatal: repository 'https://gitlab.XXX.com/api/v4/projects/519/packages/pypi/simple/' not found
</code></pre>
<p>The lack of .pypirc support is also making things difficult for publishing, but I know that's a separate issue.</p>
<p>Window 11, UV 0.5.17</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-11 00:04</div>
            <div class="timeline-body"><p>It's really weird that we're trying to fetch the dependency with <code>git</code>.</p>
<p>Can you share a simple <code>pyproject.toml</code> that reproduces the issue? Do you have a <code>tool.uv.sources</code> entry for that package?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/npaolini2634">@npaolini2634</a> on 2025-01-11 00:49</div>
            <div class="timeline-body"><p>Ahh sorry, I think I was confused by an example here:
https://docs.astral.sh/uv/concepts/projects/dependencies/#adding-dependencies</p>
<p>and had a git source reference in pyproject.toml that shouldn't have been there. Working now.</p>
<p>Thanks for the quick response though!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-11 04:01</div>
            <div class="timeline-body"><p>Good to hear!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-11 04:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-01-11 04:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:15 UTC
    </footer>
</body>
</html>
