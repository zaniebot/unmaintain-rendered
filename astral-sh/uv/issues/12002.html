<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installing NumPy starts OpenBLAS/OpenMP in the uv process - astral-sh/uv #12002</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Installing NumPy starts OpenBLAS/OpenMP in the uv process</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12002">#12002</a>
        opened by <a href="https://github.com/thormick">@thormick</a>
        on 2025-03-06 13:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thormick">@thormick</a> on 2025-03-06 13:01</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Apparently uv starts OpenMP when it installs NumPy, causing OpenMP to spin off worker threads. When running <code>uv add numpy</code> or <code>uv pip install numpy</code> separately from <code>uv run python</code> everything seems fine, but if <code>uv run python</code> also has to install <code>numpy</code> then it starts OpenBLAS/OpenMP in the <code>uv</code> process.</p>
<pre><code class="language-bash">$ uv --version
uv 0.6.4
$ mkdir uv_numpy_test
$ cd uv_numpy_test
$ uv init
Initialized project `uv-numpy-test`
$ uv add numpy
Using CPython 3.11.11
Creating virtual environment at: .venv
Resolved 2 packages in 93ms
Prepared 1 package in 530ms
Installed 1 package in 9ms
 + numpy==2.2.3
$ uv run python
Python 3.11.11 (main, Feb 12 2025, 14:51:05) [Clang 19.1.6 ] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; ^Z
[1]+  Stopped                 uv run python
$ ps Haux | egrep &quot;uv run python&quot;
thormick   25095  0.0  0.1 200464 27776 pts/6    Tl   13:12   0:00 uv run python
thormick   25095  0.0  0.1 200464 27776 pts/6    Tl   13:12   0:00 uv run python
thormick   25095  0.0  0.1 200464 27776 pts/6    Tl   13:12   0:00 uv run python
thormick   25186  0.0  0.0  12160  2560 pts/6    S+   13:14   0:00 grep -E --color=auto uv run python
$ fg
uv run python

&gt;&gt;&gt; ^D
$ uv pip uninstall numpy
Uninstalled 1 package in 7ms
 - numpy==2.2.3
$ uv run python
Installed 1 package in 17ms
Python 3.11.11 (main, Feb 12 2025, 14:51:05) [Clang 19.1.6 ] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; ^Z
[1]+  Stopped                 uv run python
$ ps Haux | egrep &quot;uv run python&quot;
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.1  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25207  0.0  0.1 776584 31744 pts/6    Tl   13:14   0:00 uv run python
thormick   25221  0.0  0.0  12160  2560 pts/6    S+   13:14   0:00 grep -E --color=auto uv run python
$
</code></pre>
<p>So, when uv installs NumPy it also loads the libraries it's shipped with, and that loads OpenBLAS, which starts OpenMP, which allocates a few megs and spawns multiprocessing worker threads (8 by default).</p>
<p>If I then do <code>import numpy</code> then I have two OpenMP threadpools running.</p>
<pre><code class="language-bash">$ fg
uv run python
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; ^Z
[1]+  Stopped                 uv run python
$ ps Haux | egrep &quot;uv run python|uv_numpy_test&quot;
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26434  0.0  0.1 776572 32000 pts/6    Tl   13:32   0:00 uv run python
thormick   26445  1.1  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26445  2.9  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26445  2.9  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26445  2.9  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26445  2.9  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26445  2.9  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26445  2.9  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26445  1.3  0.2 413704 36208 pts/6    Tl   13:32   0:00 /home/thormick/uv_numpy_test/.venv/bin/python3
thormick   26458  0.0  0.0  12172  2560 pts/6    S+   13:32   0:00 grep -E --color=auto uv run python|uv_numpy_test
$ 
</code></pre>
<p>Unlike the threads in the uv process the number of threads in the interpreter process are affected by setting the <code>OMP_NUM_THREADS</code> environment variable.</p>
<p>It's not really a problem for me, I was just tripped up by this when I was trying to get a handle on how NumPy and its dependencies operate, what resources they use and how to manage them. If it's just quirky behavior then it's no problem at all for me to live with, but since it might be something being run that shouldn't be or a lack of isolation somewhere then I wanted to report it.</p>
<h3>Platform</h3>
<p>Ubuntu 24.04.2 LTS / Linux 6.8.0-55-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>0.6.4</p>
<h3>Python version</h3>
<p>3.11.11/3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @thormick on 2025-03-06 13:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:01 UTC
    </footer>
</body>
</html>
