<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PYTHONPATH not unset in virtual environment - astral-sh/uv #15072</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PYTHONPATH not unset in virtual environment</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15072">#15072</a>
        opened by <a href="https://github.com/libRh">@libRh</a>
        on 2025-08-05 01:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/libRh">@libRh</a> on 2025-08-05 01:10</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I noticed that the current version of uv does not unset the PYTHONPATH environment variable before dispatching a subprocess with <strong>uv run</strong>.</p>
<p>This became noticeable during a migration from poetry to uv.</p>
<p>In uv, a similar behavior could be implemented in: https://github.com/astral-sh/uv/blob/main/crates/uv/src/commands/project/run.rs</p>
<pre><code>if interpreter.is_virtualenv() {
    process.env(EnvVars::VIRTUAL_ENV, interpreter.sys_prefix().as_os_str());

    // Unset PYTHONPATH to avoid system package pollution in the virtual environment
    process.env_remove(&quot;PYTHONPATH&quot;);
}
</code></pre>
<h3>Platform</h3>
<p>NixOS 25.05</p>
<h3>Version</h3>
<p>uv 0.7.22 and greater</p>
<h3>Python version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @libRh on 2025-08-05 01:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-05 01:52</div>
            <div class="timeline-body"><p>Why would we unset <code>PYTHONPATH</code>? If someone has set that, I generally think we should respect it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-08-05 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-08-05 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/libRh">@libRh</a> on 2025-08-05 02:43</div>
            <div class="timeline-body"><p>On NixOS, PYTHONPATH is set during package installation. While virtual environments aren't isolated, it's important to avoid environment pollution by default, as PYTHONPATH takes precedence and can impact reproducibility. For example, recent python versions disable site-packages by default, reinforcing the importance of isolation. Since PYTHONPATH is also used at the system level, it can lead to conflicts especially when using a python installation that differs from the system's (eg. uv pyhon llvm builds).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dmarteau">@dmarteau</a> on 2025-11-25 16:19</div>
            <div class="timeline-body"><p>PYTHONPATH is generally a user settings, unsetting it would break user configurations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-25 19:53</div>
            <div class="timeline-body"><p>Yeah I think this is out of scope for us to unset.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-11-25 19:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:10 UTC
    </footer>
</body>
</html>
