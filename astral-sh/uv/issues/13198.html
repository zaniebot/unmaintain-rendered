<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv pip puts the wrong interpreter in shebangs installed under bin - astral-sh/uv #13198</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv pip puts the wrong interpreter in shebangs installed under bin</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13198">#13198</a>
        opened by <a href="https://github.com/Alexndrrr">@Alexndrrr</a>
        on 2025-04-29 17:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Alexndrrr">@Alexndrrr</a></div>
            <div class="timeline-body">Summary
<p>Using <code>uv pip</code> to install packages in a virtual environment ends up generating invalid binaries under the bin directory, because the shebang refers to the interpreter used to create the venv, not the interpreter in the venv itself.</p>
<p>Example of issue:</p>
<pre><code>❯ uv venv --python 3.10 _venv_app --verbose
DEBUG uv 0.6.17 (Homebrew 2025-04-25)
DEBUG Using Python request `3.10` from explicit request
DEBUG Searching for Python 3.10 in managed installations or search path
DEBUG Searching for managed installations at `~/.local/share/uv/python`
DEBUG Found `cpython-3.10.16-macos-aarch64-none` at `~/.pyenv/shims/python3.10` (first executable in the search path)
Using CPython 3.10.16 interpreter at: ~/.pyenv/versions/3.10.16/bin/python3.10
Creating virtual environment at: _venv_app
DEBUG Using base executable for virtual environment: ~/.pyenv/versions/3.10.16/bin/python3.10
Activate with: source _venv_app/bin/activate

❯ uv pip install --prefix _venv_app flake8 --verbose
DEBUG uv 0.6.17 (Homebrew 2025-04-25)
DEBUG Searching for default Python interpreter in virtual environments, managed installations, or search path
DEBUG Searching for managed installations at `~/.local/share/uv/python`
DEBUG Found `cpython-3.10.16-macos-aarch64-none` at `~/.pyenv/shims/python` (first executable in the search path)
Using CPython 3.10.16 interpreter at: ~/.pyenv/versions/3.10.16/bin/python
DEBUG Using `--prefix` directory at _venv_app
DEBUG Acquired lock for `_venv_app`
DEBUG At least one requirement is not satisfied: flake8
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.10.16
DEBUG Solving with target Python version: &gt;=3.10.16
DEBUG Adding direct dependency: flake8*
DEBUG No cache entry for: https://pypi.org/simple/flake8/
DEBUG Searching for a compatible version of flake8 (*)
DEBUG Selecting: flake8==7.2.0 [compatible] (flake8-7.2.0-py2.py3-none-any.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/83/5c/0627be4c9976d56b1217cb5187b7504e7fd7d3503f8bfd312a04077bd4f7/flake8-7.2.0-py2.py3-none-any.whl.metadata
DEBUG Adding transitive dependency for flake8==7.2.0: mccabe&gt;=0.7.0, &lt;0.8.0
DEBUG Adding transitive dependency for flake8==7.2.0: pycodestyle&gt;=2.13.0, &lt;2.14.0
DEBUG Adding transitive dependency for flake8==7.2.0: pyflakes&gt;=3.3.0, &lt;3.4.0
DEBUG No cache entry for: https://pypi.org/simple/mccabe/
DEBUG No cache entry for: https://pypi.org/simple/pycodestyle/
DEBUG No cache entry for: https://pypi.org/simple/pyflakes/
DEBUG No cache entry for: https://files.pythonhosted.org/packages/15/40/b293a4fa769f3b02ab9e387c707c4cbdc34f073f945de0386107d4e669e6/pyflakes-3.3.2-py2.py3-none-any.whl.metadata
DEBUG Searching for a compatible version of mccabe (&gt;=0.7.0, &lt;0.8.0)
DEBUG Selecting: mccabe==0.7.0 [compatible] (mccabe-0.7.0-py2.py3-none-any.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/27/1a/1f68f9ba0c207934b35b86a8ca3aad8395a3d6dd7921c0686e23853ff5a9/mccabe-0.7.0-py2.py3-none-any.whl.metadata
WARN Skipping file for pycodestyle: pycodestyle-2.4.0-py3.6.egg
DEBUG No cache entry for: https://files.pythonhosted.org/packages/07/be/b00116df1bfb3e0bb5b45e29d604799f7b91dd861637e4d448b4e09e6a3e/pycodestyle-2.13.0-py2.py3-none-any.whl.metadata
DEBUG Searching for a compatible version of pycodestyle (&gt;=2.13.0, &lt;2.14.0)
DEBUG Selecting: pycodestyle==2.13.0 [compatible] (pycodestyle-2.13.0-py2.py3-none-any.whl)
DEBUG Searching for a compatible version of pyflakes (&gt;=3.3.0, &lt;3.4.0)
DEBUG Selecting: pyflakes==3.3.2 [compatible] (pyflakes-3.3.2-py2.py3-none-any.whl)
DEBUG Tried 4 versions: flake8 1, mccabe 1, pycodestyle 1, pyflakes 1
DEBUG marker environment resolution took 0.782s
Resolved 4 packages in 785ms
DEBUG Identified uncached distribution: pycodestyle==2.13.0
DEBUG Identified uncached distribution: flake8==7.2.0
DEBUG Identified uncached distribution: pyflakes==3.3.2
DEBUG Identified uncached distribution: mccabe==0.7.0
DEBUG No cache entry for: https://files.pythonhosted.org/packages/15/40/b293a4fa769f3b02ab9e387c707c4cbdc34f073f945de0386107d4e669e6/pyflakes-3.3.2-py2.py3-none-any.whl
DEBUG No cache entry for: https://files.pythonhosted.org/packages/83/5c/0627be4c9976d56b1217cb5187b7504e7fd7d3503f8bfd312a04077bd4f7/flake8-7.2.0-py2.py3-none-any.whl
DEBUG No cache entry for: https://files.pythonhosted.org/packages/07/be/b00116df1bfb3e0bb5b45e29d604799f7b91dd861637e4d448b4e09e6a3e/pycodestyle-2.13.0-py2.py3-none-any.whl
DEBUG No cache entry for: https://files.pythonhosted.org/packages/27/1a/1f68f9ba0c207934b35b86a8ca3aad8395a3d6dd7921c0686e23853ff5a9/mccabe-0.7.0-py2.py3-none-any.whl
Prepared 4 packages in 229ms
Installed 4 packages in 3ms
 + flake8==7.2.0
 + mccabe==0.7.0
 + pycodestyle==2.13.0
 + pyflakes==3.3.2
DEBUG Released lock at `_venv_app/.lock`

❯ _venv_app/bin/flake8
Traceback (most recent call last):
  File &quot;./_venv_app/bin/flake8&quot;, line 4, in &lt;module&gt;
    from flake8.main.cli import main
ModuleNotFoundError: No module named &#x27;flake8&#x27;

❯ head -n 1 _venv_app/bin/flake8
#!~/.pyenv/versions/3.10.16/bin/python
</code></pre>
<p>This seems to be related to the usage of a custom <code>--prefix</code>, because if I use the default .venv directly it works:</p>
<pre><code>❯ uv venv --verbose
DEBUG uv 0.6.17 (Homebrew 2025-04-25)
DEBUG No Python version file found in ancestors of working directory: ~/temp/uv-venv-python-issue
DEBUG Searching for default Python interpreter in managed installations or search path
DEBUG Searching for managed installations at `~/.local/share/uv/python`
DEBUG Found `cpython-3.10.16-macos-aarch64-none` at `~/.pyenv/shims/python` (first executable in the search path)
Using CPython 3.10.16 interpreter at: ~/.pyenv/versions/3.10.16/bin/python
Creating virtual environment at: .venv
DEBUG Using base executable for virtual environment: ~/.pyenv/versions/3.10.16/bin/python
Activate with: source .venv/bin/activate

❯ uv pip install --prefix .venv flake8 --verbose
DEBUG uv 0.6.17 (Homebrew 2025-04-25)
DEBUG Searching for default Python interpreter in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.10.16-macos-aarch64-none` at `~/temp/uv-venv-python-issue/.venv/bin/python3` (virtual environment)
Using CPython 3.10.16 interpreter at: .venv/bin/python3
DEBUG Using `--prefix` directory at .venv
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: flake8
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.10.16
DEBUG Solving with target Python version: &gt;=3.10.16
DEBUG Adding direct dependency: flake8*
DEBUG Found fresh response for: https://pypi.org/simple/flake8/
DEBUG Searching for a compatible version of flake8 (*)
DEBUG Selecting: flake8==7.2.0 [compatible] (flake8-7.2.0-py2.py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/83/5c/0627be4c9976d56b1217cb5187b7504e7fd7d3503f8bfd312a04077bd4f7/flake8-7.2.0-py2.py3-none-any.whl.metadata
DEBUG Adding transitive dependency for flake8==7.2.0: mccabe&gt;=0.7.0, &lt;0.8.0
DEBUG Adding transitive dependency for flake8==7.2.0: pycodestyle&gt;=2.13.0, &lt;2.14.0
DEBUG Adding transitive dependency for flake8==7.2.0: pyflakes&gt;=3.3.0, &lt;3.4.0
DEBUG Found fresh response for: https://pypi.org/simple/mccabe/
DEBUG Searching for a compatible version of mccabe (&gt;=0.7.0, &lt;0.8.0)
DEBUG Selecting: mccabe==0.7.0 [compatible] (mccabe-0.7.0-py2.py3-none-any.whl)
DEBUG Found fresh response for: https://pypi.org/simple/pycodestyle/
DEBUG Found fresh response for: https://pypi.org/simple/pyflakes/
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/27/1a/1f68f9ba0c207934b35b86a8ca3aad8395a3d6dd7921c0686e23853ff5a9/mccabe-0.7.0-py2.py3-none-any.whl.metadata
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/15/40/b293a4fa769f3b02ab9e387c707c4cbdc34f073f945de0386107d4e669e6/pyflakes-3.3.2-py2.py3-none-any.whl.metadata
DEBUG Searching for a compatible version of pycodestyle (&gt;=2.13.0, &lt;2.14.0)
DEBUG Selecting: pycodestyle==2.13.0 [compatible] (pycodestyle-2.13.0-py2.py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/07/be/b00116df1bfb3e0bb5b45e29d604799f7b91dd861637e4d448b4e09e6a3e/pycodestyle-2.13.0-py2.py3-none-any.whl.metadata
DEBUG Searching for a compatible version of pyflakes (&gt;=3.3.0, &lt;3.4.0)
DEBUG Selecting: pyflakes==3.3.2 [compatible] (pyflakes-3.3.2-py2.py3-none-any.whl)
DEBUG Tried 4 versions: flake8 1, mccabe 1, pycodestyle 1, pyflakes 1
DEBUG marker environment resolution took 0.007s
Resolved 4 packages in 11ms
DEBUG Registry requirement already cached: pycodestyle==2.13.0
DEBUG Registry requirement already cached: flake8==7.2.0
DEBUG Registry requirement already cached: pyflakes==3.3.2
DEBUG Registry requirement already cached: mccabe==0.7.0
Installed 4 packages in 5ms
 + flake8==7.2.0
 + mccabe==0.7.0
 + pycodestyle==2.13.0
 + pyflakes==3.3.2
DEBUG Released lock at `.venv/.lock`

❯ head -n 1 .venv/bin/flake8
#!~/temp/uv-venv-python-issue/.venv/bin/python3
</code></pre>
Platform
<p>Darwin 24.4.0 arm64</p>
Version
<p>uv 0.6.17 (Homebrew 2025-04-25)</p>
Python version
<p>Python 3.10.16 (via pyenv)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/Alexndrrr">@Alexndrrr</a> on 2025-04-29 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-29 18:02</div>
            <div class="timeline-body"><p>Does <code>pip</code> behave differently here? In my basic testing, it seems like it does the same thing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-29 18:03</div>
            <div class="timeline-body"><p>(What&#x27;s the motivation for using <code>--prefix</code>? Why not <code>uv init _venv_app</code> and then <code>--python _venv_app</code>?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Alexndrrr">@Alexndrrr</a> on 2025-04-29 18:14</div>
            <div class="timeline-body"><blockquote>
<p>Does <code>pip</code> behave differently here? In my basic testing, it seems like it does the same thing.</p>
</blockquote>
<p>Hmm, I can&#x27;t get pip to install it with the wrong interpreter. I&#x27;ve tried it with venvs called both <code>.venv</code> and <code>_venv_app</code> installed via <code>uv venv --seed</code> and <code>python3.10 -m venv --upgrade-deps</code> and it&#x27;s correct every time.</p>
<blockquote>
<p>(What&#x27;s the motivation for using <code>--prefix</code>? Why not <code>uv init _venv_app</code> and then <code>--python _venv_app</code>?)</p>
</blockquote>
<p>I&#x27;m working with projects designed to use <code>pip</code>, not <code>uv</code>. I&#x27;m trying to swap out some of the project commands I use to use <code>uv</code> because it&#x27;s significantly faster, but at this point I don&#x27;t have the authority yet to change the project designs to make everyone use uv.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:25 UTC
    </footer>
</body>
</html>
