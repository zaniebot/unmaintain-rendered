<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is there a setting similar to the `package-mode` in poetry? - astral-sh/uv #6434</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Is there a setting similar to the `package-mode` in poetry?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6434">#6434</a>
        opened by <a href="https://github.com/pythonweb2">@pythonweb2</a>
        on 2024-08-22 13:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pythonweb2">@pythonweb2</a> on 2024-08-22 13:37</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>uv version: 0.3.1
uv platform: linux</p>
<p>Poetry supports what they call operating modes (https://python-poetry.org/docs/basic-usage/#operating-modes), where if you are not planning on publishing your project, you can specify <code>package-mode = false</code>, which only installs the dependencies listed, but does not install the project into the virtual environment.</p>
<p>I was unable to find something like this mentioned in the docs for projects, is it unsupported or perhaps missing from the docs (or perhaps documented somewhere I couldn't see it).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-22 15:55</div>
            <div class="timeline-body"><p>We don't support this yet, but there's discussion about excluding the project from installation in various issues.</p>
<p>What's your use-case for this? Why does it matter if the project is installed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/z3z1ma">@z3z1ma</a> on 2024-08-22 23:29</div>
            <div class="timeline-body"><p>This is a blocker, or at the very least annoying. I can workaround with a shim src dir that just has an empty init.</p>
<p>Lots of people may need to manage a bunch of python dependencies outside the context of having a top-level package they themselves are trying to install. Hence why poetry created the package-mode=false. It lets everyone benefit from the lockfile, resolver, and toolchain. A simple example is https://github.com/apache/airflow which has huge adoption and use at large companies -- but there are obv tons of cases where you need to manage libraries that (may) operate in a context independent of a structured python package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 23:33</div>
            <div class="timeline-body"><p>Just to clarify, are you citing Airflow as an example of a project that is not structured as a package? Or an example of something you might use outside of a package?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/z3z1ma">@z3z1ma</a> on 2024-08-22 23:46</div>
            <div class="timeline-body"><p>The latter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/z3z1ma">@z3z1ma</a> on 2024-08-22 23:52</div>
            <div class="timeline-body"><p>More random data-oriented examples @charliermarsh</p>
<p>https://github.com/dbt-labs/dbt-core
https://github.com/TobikoData/sqlmesh
https://github.com/feast-dev/feast
https://github.com/mlflow/mlflow
https://github.com/dagster-io/dagster
https://github.com/PrefectHQ/prefect
https://github.com/dlt-hub/dlt
https://github.com/meltano/meltano</p>
<p>We can imagine all the AI / ML / data pipeline / automation  code (disparate python scripts in a repository, NOT a src application) we'd like to have lockfiles and uv tooling for.</p>
<p>EDIT: for clarity, these are all things a developer may depend on in a repo that is not otherwise structured as a python application itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-22 23:57</div>
            <div class="timeline-body"><p>It sounds like you're looking for a virtual project, which I believe we support if you enumerate everything as a development dependency? As described in https://docs.astral.sh/uv/concepts/workspaces/#workspace-roots</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/z3z1ma">@z3z1ma</a> on 2024-08-23 00:08</div>
            <div class="timeline-body"><p>No, as far as I can tell (and I just tried it) you still need a pyproject.toml somewhere in the repo with <code>project</code> defined. If not in the top level explicit root, then in the member(s) of the virtual root?</p>
<p>In all my examples, dbt or sqlmesh being really straightforward ones, you will not have a <code>src</code> directory or anything to install. But still want to manage a graph of dependencies for the repo to operate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 00:11</div>
            <div class="timeline-body"><p>Worked fine for me? Did you encounter an error?</p>
<pre><code>❯ uv init --virtual
Initialized workspace `example`
❯ uv add --dev httpx
Using Python 3.11.7
Creating virtualenv at: .venv
Resolved 7 packages in 268ms
Prepared 7 packages in 61ms
Installed 7 packages in 13ms
 + anyio==4.4.0
 + certifi==2024.7.4
 + h11==0.14.0
 + httpcore==1.0.5
 + httpx==0.27.0
 + idna==3.7
 + sniffio==1.3.1
❯ uv run python -c &quot;import httpx&quot;
❯ tree .
.
├── README.md
├── pyproject.toml
└── uv.lock

1 directory, 3 files
❯ cat pyproject.toml
[tool.uv]
dev-dependencies = [
    &quot;httpx&gt;=0.27.0&quot;,
]
[tool.uv.workspace]
members = []
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pythonweb2">@pythonweb2</a> on 2024-08-23 00:16</div>
            <div class="timeline-body"><p>My use case in particular is a Django application.</p>
<p>In some cases, it may be desired to package a django app, but in most cases, the root project will never be packaged, however a cross platform lockfile is very useful for CI pipelines, and a better workflow than pip in my opinion.</p>
<p>It looks like the virtual project may work, I will take a look into this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/z3z1ma">@z3z1ma</a> on 2024-08-23 00:17</div>
            <div class="timeline-body"><p>NVM I see, workspace members can be empty.</p>
<p>I am working with an existing project at work and trying to adapt it to <code>uv</code> so trying to grok everything from the docs. While they mention the notion of virtual root, it doesn't really describe in an obvious way that its a way to manage deps for a project which itself has no installable package. Its focused around <code>pyproject.toml</code>s in subdirectories which are themselves valid <code>project</code>s</p>
<p>That worked for me!</p>
<p>Q I suppose. Does this give us a single layer of dependencies? Whereas with the <code>project.dependencies</code> and <code>project.optional-dependencies</code> we would get to delineate combinations of deps.
<code>poetry</code> supports this in the pending PR for PEP 621 support which works fine with package-mode false (which is to say it just doesnt look for or install the package declared by <code>project.name</code> AFAICT.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/z3z1ma">@z3z1ma</a> on 2024-08-23 00:22</div>
            <div class="timeline-body"><p>I'm going to go out on a limb and say, while we can potentially achieve our goal (creating a cross-platform lockfile from pyproject.toml without a <code>src</code> package) with virtual root and empty members -- it seems obtuse if you zoom out. Like an indirect path. It's solely my gut-feel so its fine to push back.</p>
<p>BTW really excited for <code>uv</code> and thanks for all the work, today has been my breaking it in day so pardon finding and banging on this issue. But from a data / ML engineer perspective -- this is an extremely common scenario. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 00:24</div>
            <div class="timeline-body"><p>Appreciate the kind words :)</p>
<p>Personally I still feel we can do better with what we're calling &quot;virtual&quot; projects. I'm not a big fan of using virtual workspaces to solve this problem. But I'm mostly focusing on correctness issues in the immediate term so we need a bit of time to step back and think about where to improve.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 14:53</div>
            <div class="timeline-body"><p>Wrote up an idea here: https://github.com/astral-sh/uv/issues/6511</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-28 18:08</div>
            <div class="timeline-body"><p>This exists now as of <a href="https://github.com/astral-sh/uv/releases/tag/0.4.0">v0.4.0</a>!</p>
<p>Projects that omit <code>[build-system]</code> will no longer be built and installed by default. You can also set <code>tool.uv.package</code> to <code>false</code> to control the behavior explicitly, as in:</p>
<pre><code class="language-toml">[tool.uv]
package = false
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-28 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-28 18:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:21 UTC
    </footer>
</body>
</html>
