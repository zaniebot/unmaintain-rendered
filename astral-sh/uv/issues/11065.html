<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatically install and use a matching uv version to satisfy `requires-version`. - astral-sh/uv #11065</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Automatically install and use a matching uv version to satisfy `requires-version`.</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/11065">#11065</a>
        opened by <a href="https://github.com/mjpieters">@mjpieters</a>
        on 2025-01-29 14:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mjpieters">@mjpieters</a> on 2025-01-29 14:34</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We have some projects running with an older, pinned <code>uv</code> version in docker containers, but the lock file is updated by developers with the most recent <code>uv</code> version installed. This can lead to problems:</p>
<ul>
<li>0.5.19 added support for omitting dynamic package versions from the lock file. We have some projects with such dynamic versions, but locking with 0.5.19 or newer makes the lock file unreadable by older uv versions.</li>
<li>If a 0.6.x version was released with explicit backward compatibility conflicts, we'd be further up the creek without a paddle.</li>
</ul>
<p>We can set <code>required-version</code> to prevent using newer uv versions:</p>
<pre><code class="language-toml">[tool.uv]
required-version = &quot;&gt;=0.5.0,&lt;0.5.19&quot;
</code></pre>
<p>but then anyone with a newer <code>uv</code> can't update the  lockfile as <code>uv</code> currently will exit with an error when encountering a <code>required-version</code> pin that doesn't match its own version. <strong>UNLESS</strong> they use <code>uv tool run</code> to install the older <code>uv</code> version to do the work:</p>
<pre><code class="language-sh">% uv lock
error: Required uv version `&gt;=0.5.0, &lt;0.5.19` does not match the running version `0.5.25`
% uv tool run --with 'uv&gt;=0.5.0,&lt;0.5.19' uv lock
Resolved 149 packages in 994ms
</code></pre>
<p>Could <code>uv</code> do this <em>directly</em> please? Specifically, when the <code>required-version</code> requirement can't be met by the current <code>uv</code> version, <code>uv</code> finds a version of itself that <em>does</em> match the requirement and run the desired command with that version instead.</p>
<h3>Example</h3>
<p>When running <code>uv</code> with a version that doesn't satisfy the <code>required-version</code> requirements for the current project, instead of exiting with an error, <code>uv</code> finds a version of itself that does satisfy the requirements:</p>
<pre><code class="language-sh">% cd &quot;$(mktemp -d)&quot;
% uv init
Initialized project `tmp-luczgh2pmf`
% cat &gt;&gt;pyproject.toml &lt;&lt;EOF
heredoc&gt; [tool.uv]
heredoc&gt; required-version=&quot;&gt;=0.5.0,&lt;0.5.19&quot;
heredoc&gt; EOF
% uv sync   # executes as `uv tool run --with &quot;uv$(yq -r '.tool.uv.required-version // &quot;&quot;' pyproject.toml)&quot; uv sync`
Resolved 1 package in 7ms
Audited in 0.02ms
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @mjpieters on 2025-01-29 14:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Automatically install and use an older uv version to satisfy `requires-version`." to "Automatically install and use a matching uv version to satisfy `requires-version`." by @mjpieters on 2025-01-29 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mjpieters">@mjpieters</a> on 2025-01-29 14:46</div>
            <div class="timeline-body"><p>Our current work-around is to alias <code>uv</code>:</p>
<pre><code class="language-sh">alias uv='uv tool run --with &quot;uv$(yq -r '\''.tool.uv.required-version // &quot;&quot;'\'' pyproject.toml)&quot; uv'
</code></pre>
<p>(which requires that you have <a href="https://mikefarah.gitbook.io/yq#install"><code>yq</code> installed</a>, and only works if you are currently in the same directory as the <code>pyproject.toml</code> file, <em>and</em> won't work if you use <code>uv.toml</code> files).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @zanieb on 2025-01-29 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-29 14:47</div>
            <div class="timeline-body"><p>This sounds cool, but isn't something I can prioritize right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11869.html">astral-sh/uv#11869</a> on 2025-02-28 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12787.html">astral-sh/uv#12787</a> on 2025-04-09 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/juftin">@juftin</a> on 2025-04-09 20:56</div>
            <div class="timeline-body"><p>Adding an example from my duplicate issue:</p>
<h3>Example</h3>
<p>You have <code>uv==0.4.0</code> on your local machine and the following <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;example&quot;
version = &quot;1.2.3&quot;
description = &quot;Example Project Description&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11,&lt;3.12&quot;
dependencies = [
    &quot;apache-airflow==2.8.0&quot;
]

[tool.uv]
required-version = &quot;&gt;=0.6.0,&lt;0.7.0&quot;
</code></pre>
<p>Rather than raising an error that your <code>uv</code> version doesn't comply with the <code>required-version</code> when running <code>uv lock</code>, <code>uv</code> would instead essentially run <code>uvx &quot;uv&gt;=0.5.0,&lt;0.6.0&quot; lock</code></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
