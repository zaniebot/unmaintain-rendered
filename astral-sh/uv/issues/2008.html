<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv fails to install pytorch nightly - astral-sh/uv #2008</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv fails to install pytorch nightly</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2008">#2008</a>
        opened by <a href="https://github.com/gilfree">@gilfree</a>
        on 2024-02-27 09:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gilfree">@gilfree</a> on 2024-02-27 09:30</div>
            <div class="timeline-body"><p>The command:</p>
<pre><code>python3.10 -muv pip install -U --prerelease allow torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu121
</code></pre>
<p>(Run in a clean python3.10 venv, with only uv installed in it)</p>
<p>Fails to install claiming non solvable dependencies. As far as I can understand that is not the case.</p>
<p>After a long message it says:</p>
<pre><code> And because torchvision==0.18.0.dev20240222+cu121 depends on torch==2.3.0.dev20240222 and torchvision==0.18.0.dev20240226+cu121 depends on torch==2.3.0.dev20240226, we
      can conclude that all versions of torchvision depend on one of:
...
          torch==2.3.0.dev20240221
          torch==2.3.0.dev20240222
          torch==2.3.0.dev20240226

      And because only the following versions of torch are available:
          torch&lt;2.2.0.dev20231010
          torch&gt;2.2.0.dev20231010,&lt;2.3.0.dev20231225
....
         torch&gt;2.3.0.dev20240222,&lt;2.3.0.dev20240226
         torch&gt;2.3.0.dev20240226
      and you require torchvision, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>Torch 2.3.0.dev20240226 do exist: https://download.pytorch.org/whl/nightly/cu121/torch-2.3.0.dev20240226%2Bcu121-cp310-cp310-linux_x86_64.whl, and is present in the index.html</p>
<p>Platform is Ubuntu linux, uv version 0.1.11</p>
<p>Log: <a href="https://github.com/astral-sh/uv/files/14417321/log.txt">log.txt</a> (with local paths redacted by ...)</p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-27 12:12</div>
            <div class="timeline-body"><p>This <em>might</em> be a duplicate of https://github.com/astral-sh/uv/issues/1855, but I haven't investigated yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-27 16:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-27 16:12</div>
            <div class="timeline-body"><p>My impression is that it's the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 20:47</div>
            <div class="timeline-body"><p>I believe this should work in the latest release, as long as you add <code>+cu121</code> or similar to your requirements.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-18 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-03-18 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gilfree">@gilfree</a> on 2024-03-19 10:49</div>
            <div class="timeline-body"><p>Hi, @charliermarsh, thanks but that does not really solve this use case üòü</p>
<p>Its a nightly version, and not a pinned version. Where should I add +cu121? I can't set a specific version, as I have no idea what is the last released nightly version without manually inspecting the html page.</p>
<p>(pip does not require it)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-19 13:15</div>
            <div class="timeline-body"><p>Sorry, we don‚Äôt support that kind of ‚Äúlocal‚Äù version access right now. You can read more on our support here: https://github.com/astral-sh/uv/blob/main/PIP_COMPATIBILITY.md#local-version-identifiers.</p>
<p>Candidly, I‚Äôm not even sure what ‚Äútorch‚Äù without a local version tag should give you based on the spec. It seems like you could be served any suffix (+cpu, +cu118, etc.) arbitrarily and it would still be spec compliant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-19 13:43</div>
            <div class="timeline-body"><p>I'll file a separate issue to track this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gilfree">@gilfree</a> on 2024-03-19 13:49</div>
            <div class="timeline-body"><p>Hi @charliermarsh
I agree that you could be served any suffix. It is ok.</p>
<p>It is a common practice in the ML python packages space of having an index per cuda version with a local suffix. For example  https://download.pytorch.org/whl/cu121/  contains only packages with no suffix or with cu121 suffix.</p>
<p>According to my read of the spec - you should simply drop the suffix, and assume anything you find is compatible to the non suffix version. It is responsibility of the index provider to have only compatible versions. You should not do this in public indexes according to the spec, but in practice it is very common.</p>
<p>As far as I know that is the &quot;best&quot; way that was found to handle cuda dependencies, or similar cases of dependency on external packages with multiple variants in the python packaging ecosystem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-19 13:51</div>
            <div class="timeline-body"><p>Do you know why they include both the version with no suffix and the cu121 suffix, if the index is scoped in that way? (What does pip resolve to?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gilfree">@gilfree</a> on 2024-03-19 13:54</div>
            <div class="timeline-body"><p>The index contains multiple packages. Each of the is either suffixed or non suffixed. torch for example is suffixed, but torchdata or jinja2 are not. This means that you don't need to choose - you have only one option per package version and python version. Just ignoring the suffixes altogether when selecting what to install will work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-19 14:14</div>
            <div class="timeline-body"><p>Got it. Hard to map these onto a global dependency resolution context, but we'll try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2541.html">astral-sh/uv#2541</a> on 2024-03-19 15:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:57 UTC
    </footer>
</body>
</html>
