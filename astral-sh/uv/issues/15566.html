<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package Override/Dependency Replacement - astral-sh/uv #15566</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Package Override/Dependency Replacement</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15566">#15566</a>
        opened by <a href="https://github.com/qiansen1386">@qiansen1386</a>
        on 2025-08-28 08:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/qiansen1386">@qiansen1386</a> on 2025-08-28 08:23</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi Astral team,</p>
<p>We've got this internal package <code>mypymongo</code> that works just like <code>pymongo</code> (same API), but uses our own custom protocol under the hood. What would really help us is if UV could let us swap packages, like whenever some package asks for pymongo, UV would automatically use <code>mypymongo</code> instead without actually installing the original.</p>
<p>Right now we're in this awkward spot where both packages end up installed side-by-side. The behavior gets unpredictable because it depends on which package was installed last. I can't just uninstall pymongo either because packages like <code>pydantic-pymongo</code> still require it.</p>
<p>So we're stuck with this janky workaround:</p>
<pre><code class="language-shell">uv uninstall pymongo
uv run --no-sync ./bootstrap.sh
</code></pre>
<p>Some AI chatbots fabricated some syntax like</p>
<pre><code class="language-toml">[tool.uv.overrides]
# Replace any pymongo dependency with internal implementation
pymongo = { source = &quot;mypymongo&quot;, version = &quot;==0.0.5&quot; }
</code></pre>
<p>Unfortunately, none of them works. Would be awesome if something like this actually existed.
What do you think? Could this happen?</p>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @qiansen1386 on 2025-08-28 08:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-28 13:08</div>
            <div class="timeline-body"><p>While we don't support dependency replacement or elimination yet (https://github.com/astral-sh/uv/issues/4422), you can use an override with <code>pymongo; sys_platform == &quot;never&quot;</code> (https://docs.astral.sh/uv/reference/settings/#override-dependencies) to hack the removal of pymongo from your lockfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @qiansen1386 on 2025-08-29 07:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/quantitative-technologies">@quantitative-technologies</a> on 2025-09-14 03:47</div>
            <div class="timeline-body"><p>This is still installing <code>multitasking</code> in the lockfile:</p>
<pre><code class="language-console">[tool.uv]
# hack to remove from lockfile: https://github.com/astral-sh/uv/issues/15566#issuecomment-3233440761
override-dependencies = [&quot;multitask==0.0.12; sys_platform == 'never'&quot;]  

</code></pre>
<p>Did I specify incorrectly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-14 11:02</div>
            <div class="timeline-body"><p>@quantitative-technologies Please create a minimal reproducible example and open a new issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/quantitative-technologies">@quantitative-technologies</a> on 2025-09-16 00:57</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/quantitative-technologies">@quantitative-technologies</a> Please create a minimal reproducible example and open a new issue.</p>
</blockquote>
<p>It may be difficult: The reason I wanted this is because <code>multitasking</code> is causing some other strange issue, and I don't know how to simplify to a MRE. I can open a new issue without an MRE if you want, but briefly uv is failing every other time I run it. For example:</p>
<pre><code class="language-console">james@ubuntu-8gb-data-store:~/perpetual-arbitrage/scripts$ uv run python
error: Unable to uninstall `multitasking==0.0.12`. distutils-installed distributions do not include the metadata required to uninstall safely.
james@ubuntu-8gb-data-store:~/perpetual-arbitrage/scripts$ uv run python
Installed 1 package in 1ms
Python 3.12.3 (main, Aug 14 2025, 17:47:21) [GCC 13.3.0] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; quit()
james@ubuntu-8gb-data-store:~/perpetual-arbitrage/scripts$ uv run python
error: Unable to uninstall `multitasking==0.0.12`. distutils-installed distributions do not include the metadata required to uninstall safely.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-16 02:55</div>
            <div class="timeline-body"><p>A new issue is better than bumping this one, even if you can't produce an MRE. At least provide the debug logs please, as described in #9452</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/quantitative-technologies">@quantitative-technologies</a> on 2025-09-19 05:34</div>
            <div class="timeline-body"><p>Done: https://github.com/astral-sh/uv/issues/15941#issue-3432851140</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
