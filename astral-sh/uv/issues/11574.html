<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace common dependencies - astral-sh/uv #11574</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Workspace common dependencies</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11574">#11574</a>
        opened by <a href="https://github.com/Shuricks2015">@Shuricks2015</a>
        on 2025-02-17 09:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Shuricks2015">@Shuricks2015</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>I would like to use workspaces in a monorepo for easier handling and simultaneous updating of shared dependencies. The projects in my workspace are completely independent from one another and only have a set of common dependencies that I want to track &amp; update in the workspace root pyproject.toml.</p>
<p>Unfortunately the dependencies of the workspace root are not installed when I run my Dockerfile.</p>
<p>My project structure looks like this as a minimal example:
root (workspace root)
|  pyproject.toml
|  uv.lock
|  docker-compose.yml
|  project1
|  |  pyproject.toml
|  |  main.py
|  |  Dockerfile
|  project2
...</p>
<p>The example workspace root pyproject.toml:</p>
<pre><code>[project]
name = &quot;testuv&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;retry&gt;=0.9.2&quot;,
]

[tool.uv.workspace]
members = [&quot;project1&quot;, &quot;project2&quot;]
</code></pre>
<p>The example pyproject.toml of project1:</p>
<pre><code>[project]
name = &quot;project1&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;defusedxml&gt;=0.7.1&quot;,
]
</code></pre>
<p>Now when I run the following Dockerfile:</p>
<pre><code class="language-dockerfile">FROM python:3.13-slim-bookworm
# Copy over UV from their distroless image
COPY --from=ghcr.io/astral-sh/uv:0.6.0 /uv /uvx /bin/
ENV UV_COMPILE_BYTECODE=1 UV_LINK_MODE=copy

# Disable Python downloads, because we want to use the system interpreter
# across both images. If using a managed Python version, it needs to be
# copied from the build image into the final image;
ENV UV_PYTHON_DOWNLOADS=0

WORKDIR /app

RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock,ro,from=root \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml,ro \
    uv sync --frozen --no-install-workspace --no-dev

# copy over code and only the required files. Do not COPY . .
ADD . /app

RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock,ro,from=root \
    uv sync --frozen --no-dev

CMD [&quot;uv&quot;, &quot;pip&quot;, &quot;list&quot;]
</code></pre>
<p>I only have the dependency of the project1 installed, but not the dependency of the workspace root.</p>
<p><img src="https://github.com/user-attachments/assets/ef244800-e8aa-40ab-b4bf-bd0402eea14f" alt="Image" /></p>
<p>Is there a command flag that is used to also install the dependencies of the workspace root? This would make managing the common dependencies for the projects in my monorepo significantly easier.</p>
<h3>Platform</h3>
<p>Windows 11 x86_64</p>
<h3>Version</h3>
<p>uv 0.6.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @Shuricks2015 on 2025-02-17 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-18 14:36</div>
            <div class="timeline-body"><p>You need to add <code>&quot;project1&quot;</code> and <code>&quot;project2&quot;</code> as dependencies of <code>testuv</code> -- otherwise, <code>uv sync</code> is only going to install the dependencies of the workspace root. (<code>uv sync</code> here is equivalent to <code>uv sync -p testuv</code>: it syncs the package at the workspace root.)</p>
<p>Alternatively, you could use <code>uv sync --all-packages</code>, though I'd recommend making the dependencies explicit here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Shuricks2015">@Shuricks2015</a> on 2025-02-18 15:07</div>
            <div class="timeline-body"><p>Thanks for the reply. Unfortunately that does not what I want to accomplish.
After adding <code>&quot;project1&quot;</code> and <code>&quot;project2&quot;</code> to the dependencies of testuv the Dockerfile of project1 still only installs defusedxml.</p>
<p>With <code>uv sync --all-packages</code> I install the dependencies of every project/package, which I also don't want. This would lead to a bloated docker image because I don't need numpy for <code>&quot;project1&quot;</code>.</p>
<p>Maybe I should have made my goal more clear. I want to have the following packages installed after I build the above mentioned Dockerfile of <code>&quot;project1&quot;</code>:</p>
<pre><code>defusedxml&gt;=0.7.1
retry&gt;=0.9.2
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-18 15:34</div>
            <div class="timeline-body"><p>In that case, I think you would need to add the dependencies to the <code>pyproject.toml</code> in <code>project1</code>. There's no way to &quot;inherit&quot; dependencies from the workspace root like that. I guess you could do: <code>uv sync --frozen --no-dev --package testuv</code> and then <code>uv sync --frozen --no-dev --package project1 --inexact</code> (with <code>--inexact</code> to avoid removing the <code>testuv</code> dependencies). But I wouldn't consider that a recommended workflow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Shuricks2015">@Shuricks2015</a> on 2025-02-18 15:47</div>
            <div class="timeline-body"><p>Okay thanks a lot. Then I will just duplicate the common dependencies over the projects.</p>
<p>Is this &quot;inheritance&quot; of dependencies something you might add? Maybe in a similar fashion as you did it with ruff with the <code>extend</code> option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-27 13:29</div>
            <div class="timeline-body"><p>We're mostly limited by PEP 621 here, which wants dependencies to be tracked per-project. You can run <code>uv add &lt;...&gt;</code> in each member project to quickly add dependencies. If the member projects aren't distributed, one option is to have plain requirements without version bounds in the member and only keep the version bounds in the root pyproject.toml.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Shuricks2015 on 2025-03-02 13:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/luisdibdin">@luisdibdin</a> on 2025-03-04 15:07</div>
            <div class="timeline-body"><p>Would following something similar to this: <a href="url">https://docs.astral.sh/uv/guides/integration/aws-lambda/#workspace-support</a> be useful for you? So exporting the requirements.txt for the root pyproject.toml and the member pyproject.toml and then using <code>uv pip install ...</code></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:58 UTC
    </footer>
</body>
</html>
