<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document use of existing lock as preferences - astral-sh/uv #5414</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Document use of existing lock as preferences</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/5414">#5414</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-07-24 15:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>Not going to be obvious, we should discuss this in the lock file concept.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-24 15:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-25 09:38</div>
            <div class="timeline-body"><p>I&#x27;m doing some changes to preferences atm, the strategy i&#x27;m implementing is:</p>
<ul>
<li><code>uv lock &amp;&amp; uv lock</code> should always be idempotent. If it had forked before, we running the next resolution with the same forks again</li>
<li>If the requirements changed, we preserve the forks (this may be bad, we skip a change to collapse forks - but i think we don&#x27;t have good way to check for requirements changes?)</li>
<li>If something like the python version requirement changed, we resolve without preserved forks, but we use existing preferences, and first use preferences whose markers match the current resolution and then use preferences whose markers mismatch. We use the marker-mismatch-preferences in hopes that we don&#x27;t upgrade if can avoid it and we may match with a different fork this way, creating fewer diverging versions, or even better, resolve two forks identically so we can collapse them.</li>
</ul>
<p>There&#x27;s two levels to this, a surface one of &quot;We use preferences from the lockfiles and resolve those environments from the <code>environment-markers</code> field in your lockfile separately&quot; that helps you square <code>uv lock</code> with the git diff of <code>uv.lock</code> that you see and an in-depth one about how uv&#x27;s resolution works that&#x27;s relevant if you debugging, security or another detail oriented thing.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:32:14 UTC
    </footer>
</body>
</html>
