<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python file autocomplete with `uv run` on zsh with ohmyzsh - astral-sh/uv #8432</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Python file autocomplete with <code>uv run</code> on zsh with ohmyzsh</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8432">#8432</a>
        opened by <a href="https://github.com/thethomp">@thethomp</a>
        on 2024-10-21 22:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thethomp">@thethomp</a></div>
            <div class="timeline-body"><p>Howdy - this is likely just a question and not a bug, but after googling and ChatGPT-ing with no luck for quite a while, I figured I&#x27;d post here.</p>
<p>I have a standard install of ohmyzsh on my macbook and have installed <code>uv</code> and am using it a lot and love it.</p>
<p>Interestingly though, I am finding when I use <code>uv run file_i_want_to_run.py</code>, the Python file I want to run won&#x27;t autocomplete with tab the way it normally does when running things just plainly with <code>python file_i_want_to_run.py</code>.</p>
<p>I&#x27;ve enabled all the autocomplete settings that are in the docs, but those seem to only apply to internal uv/uvx commands. Is this the intended behavior or am I missing a setting somewhere perhaps? Or is this a ohmyzsh issue?</p>
<p>Appreciate any input or feedback!</p>
<p>On an Apple M3 Max. Mac OS Sonoma 14.7.
<code>uv 0.4.9 (77d278f68 2024-09-10)</code></p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 22:54</div>
            <div class="timeline-body"><p>I think we might need to setup something like https://docs.rs/clap_complete/latest/clap_complete/engine/struct.PathCompleter.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 22:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 22:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 22:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-22 01:46</div>
            <div class="timeline-body"><p>For what it&#x27;s worth, a brief attempt to add <code>add = ArgValueCompleter::new(PathCompleter::file())</code> to <code>Cmd(Vec&lt;OsString&gt;)</code> had no effect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-22 02:37</div>
            <div class="timeline-body"><p>Interesting, you turned on the unstable feature and reinstalled the completions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-22 02:40</div>
            <div class="timeline-body"><p>Yeah. I had to add <code>clap-complete</code> as a dependency too. I may well have messed something up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-22 02:46</div>
            <div class="timeline-body"><p>Oh, I just presumed that&#x27;s what we were already using for completions. I guess we&#x27;re using <a href="https://github.com/nihaals/clap-complete-command"><code>clap-complete-command</code></a> though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-22 02:47</div>
            <div class="timeline-body"><p>I think that maybe just wraps completions in a command or something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-22 02:49</div>
            <div class="timeline-body"><p>Yeah that calls through to <code>clap_complete</code>. Interesting... needs some more investigation I guess.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ruhrozz">@Ruhrozz</a> on 2024-10-23 07:22</div>
            <div class="timeline-body"><p>Same problem with <code>uv pip install -e packa&lt;tab&gt;</code> and only for zsh. Bash has no problems with it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jakehemmerle">@jakehemmerle</a> on 2024-10-24 15:30</div>
            <div class="timeline-body"><p>adding extra context, the issue is still present with the --script or -s arguments;
ie <code>uv run -s openai_bas</code> + TAB does not complete to <code>uv run -s openai_basics.py</code> as expected.
the argument itself completes fine, eg <code>uv run --sc</code> + TAB completes to <code>uv run --script </code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/simonwiles">@simonwiles</a> on 2024-10-28 22:05</div>
            <div class="timeline-body"><p>Just for avoidance of confusion, this issue doesn&#x27;t seem to be specific to Oh My Zsh -- I get the same behaviour on ZSH and I&#x27;ve never used Oh My Zsh.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/udiNur">@udiNur</a> on 2024-10-31 12:39</div>
            <div class="timeline-body"><p>for what its worth, has patch i&#x27;ve just added into .zsh (or whatever you use), working as a charm</p>
<pre><code>function py() {
    uv run $1
}
</code></pre>
<p>im use to <code>py</code> either way when im running py files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shirayu">@shirayu</a> on 2024-11-03 16:54</div>
            <div class="timeline-body"><p>I&#x27;m using this workaround in vanilla zsh. (I&#x27;m not a user of ohmyzsh)</p>
<pre><code># License: CC0

eval &quot;$(uv generate-shell-completion zsh)&quot;

_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        _arguments &#x27;*:filename:_files&#x27;
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emilioziniades">@emilioziniades</a> on 2024-11-20 16:16</div>
            <div class="timeline-body"><p>Just wanted to chime in here, as I also noticed the lack of tab completion for <code>uv run</code> and spent thirty minutes investigating.</p>
<p>TLDR: with the way <code>uv run</code> is setup currently, it&#x27;s not possible to do tab completion.</p>
<p>This is because <code>uv run</code> doesn&#x27;t only accept filepaths, although that&#x27;s the most common case. It actually accepts <em>any</em> command. So the below works:</p>
<pre><code>uv run echo &quot;hello world&quot;
</code></pre>
<p>Given that uv is using <code>clap_complete</code> for autocompletions, I reckon the correct <a href="https://docs.rs/clap/latest/clap/enum.ValueHint.html"><code>ValueHint</code></a> is probably <code>ValueHint::CommandWithArguments</code>. BUT there is currently no completion implemented for a <code>ValueHint::CommandWithArguments</code>: https://github.com/clap-rs/clap/blob/10c29ab75dfc15ae8ae7218d699de5a2b57afabe/clap_complete/src/engine/complete.rs#L349-L357</p>
<p>I think, but I stand to be corrected, that there is no good way to do tab completion for an arbitrary shell command.</p>
<p>So, in order for <code>uv run</code> to tab-complete a filename, you would have to limit the subcommand to <code>uv run [filename]</code>. Then it&#x27;s pretty trivial to setup completions. Clearly this would be a breaking change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattharrison">@mattharrison</a> on 2024-12-12 01:49</div>
            <div class="timeline-body"><p>Commenting to follow. (I&#x27;m activating bash right now to get completions)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TurtleOrangina">@TurtleOrangina</a> on 2024-12-13 18:30</div>
            <div class="timeline-body"><p>Ideally <code>uv run</code> would auto-complete all commands from <code>.venv/bin</code> as well. Typically I do things like <code>uv run ruff check</code> or <code>uv run mypy .</code> or <code>uv run my_entrypoint</code> - where my_entrypoint is an entry from [project.scripts].</p>
<p>Always using <code>uv run</code> instead of activating the environment is a great habit for avoiding errors with inconsistent python versions or dependencies, but the handicap of having no auto-complete on these commands is the main down-side of doing it consistently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shrektan">@shrektan</a> on 2024-12-22 10:16</div>
            <div class="timeline-body"><blockquote>
<p>for what its worth, has patch i&#x27;ve just added into .zsh (or whatever you use), working as a charm</p>
<pre><code>function py() {
    uv run $1
}
</code></pre>
<p>im use to <code>py</code> either way when im running py files.</p>
</blockquote>
<p>I tweaked this into the below and pasted into <code>~/.zshrc</code>. It works perfect (support arbitrage arguments).</p>
<pre><code>function uvrun() {
    uv run &quot;$@&quot;
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TurtleOrangina">@TurtleOrangina</a> on 2024-12-22 20:26</div>
            <div class="timeline-body"><blockquote>
<p>I tweaked this into the below and pasted into <code>~/.zshrc</code>. It works perfect (support arbitrage arguments).</p>
<p>function uvrun() {
uv run &quot;$@&quot;
}</p>
</blockquote>
<p>Sadly this does not work with binaries from <code>.venv/bin</code> that are currently not the $PATH yet. It works for auto-completing binaries that are already in $PATH, and directories and files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phaabe">@phaabe</a> on 2025-01-02 14:32</div>
            <div class="timeline-body"><p>same issue on <a href="https://ghostty.org/">ghostty</a>.</p>
<p>Also: using bash it seems to me that it is autocompleting paths only.
I cannot tab-autocomplete for <code>uv run python</code> .</p>
<p>I use: uv 0.5.8 on PopOS 22.04.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Galadirith">@Galadirith</a> on 2025-01-21 16:34</div>
            <div class="timeline-body"><p>Building on @shirayu great answer <a href="https://github.com/astral-sh/uv/issues/8432">astral-sh/uv#8432</a>#issuecomment-2453494736, here is a snippet that I currently use in my vanilla zsh that also enables completion of binaries under <code>.venv/bin</code>. I think not perfect but I hope useful for anyone searching for a solution</p>
<pre><code>eval &quot;$(uv generate-shell-completion zsh)&quot;

_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        local venv_binaries
        if [[ -d .venv/bin ]]; then
            venv_binaries=( ${(@f)&quot;$(_call_program files ls -1 .venv/bin 2&gt;/dev/null)&quot;} )
        fi
        
        _alternative \
            &#x27;files:filename:_files&#x27; \
            &quot;binaries:venv binary:(($venv_binaries))&quot;
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PatrickAlphaC">@PatrickAlphaC</a> on 2025-01-25 17:45</div>
            <div class="timeline-body"><p>I&#x27;d be interested in sponsoring a small bounty on this if there is interest. This would also give me an excuse to donate to <code>uv</code> in some way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baughmann">@baughmann</a> on 2025-02-01 00:53</div>
            <div class="timeline-body"><p>In case it wasn&#x27;t clear to everyone, <a href="https://github.com/vitawasalreadytaken">@vitawasalreadytaken</a> has a <a href="https://github.com/vitawasalreadytaken/dotfiles/commit/05b0baf1aec7867b2767a6184aee5ac5af480431">workaround</a> that you can plop into your <code>.zshrc</code>. This gives me <code>uv run</code> directory autocomplete using ohmyzsh</p>
<pre><code># uv
eval &quot;$(uv generate-shell-completion zsh)&quot; # you should already have these two lines
eval &quot;$(uvx --generate-shell-completion zsh)&quot;

# you will need to add the lines below
# <a href="https://github.com/astral-sh/uv/issues/8432">astral-sh/uv#8432</a>#issuecomment-2453494736
_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        _arguments &#x27;*:filename:_files&#x27;
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vitawasalreadytaken">@vitawasalreadytaken</a> on 2025-02-01 07:52</div>
            <div class="timeline-body"><blockquote>
<p>In case it wasn&#x27;t clear to everyone, <a href="https://github.com/vitawasalreadytaken">@vitawasalreadytaken</a> has a <a href="https://github.com/vitawasalreadytaken/dotfiles/commit/05b0baf1aec7867b2767a6184aee5ac5af480431">workaround</a> that you can plop into your <code>.zshrc</code>. This gives me <code>uv run</code> directory autocomplete using ohmyzsh</p>
</blockquote>
<p>@baughmann  I literally just copied @shirayu&#x27;s code posted in this thread <a href="https://github.com/astral-sh/uv/issues/8432#issuecomment-2453494736">above</a> ‚Äì all credit goes to them üôÇ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phaabe">@phaabe</a> on 2025-02-01 10:29</div>
            <div class="timeline-body"><p>The fix through .zshrc does not work for me.</p>
<p>‚ùì Anyone else?</p>
<pre><code>~ zsh
(eval):4345: command not found: compdef
(eval):131: command not found: compdef
</code></pre>
<p>Fixed this error by adding</p>
<pre><code>autoload -Uz compinit
compinit
</code></pre>
<p>‚ùå still no autocomplete for files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gandalfsaxe">@gandalfsaxe</a> on 2025-02-13 11:10</div>
            <div class="timeline-body"><p>If you have the problem of <code>command not found: compdef</code>, add this whole thing to the <code>.zshrc</code>:</p>
<pre><code># Ensure OMZ loads before any manual `compinit` calls (for the fix for uv run autocompletion right below)
export ZSH=&quot;$HOME/.oh-my-zsh&quot;
source $ZSH/oh-my-zsh.sh  # OMZ initializes compinit here

# Make `uv` work with autocomplete just like `python` - see <a href="https://github.com/astral-sh/uv/issues/8432">astral-sh/uv#8432</a>
eval &quot;$(uv generate-shell-completion zsh)&quot;

_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        local venv_binaries
        if [[ -d .venv/bin ]]; then
            venv_binaries=( ${(@f)&quot;$(_call_program files ls -1 .venv/bin 2&gt;/dev/null)&quot;} )
        fi

        _alternative \
            &#x27;files:filename:_files&#x27; \
            &quot;binaries:venv binary:(($venv_binaries))&quot;
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nkitsaini">@nkitsaini</a> on 2025-02-21 06:42</div>
            <div class="timeline-body"><p>I think the simplest way to fix this is to include pre-built completion files within uv binary similar to how <a href="https://github.com/BurntSushi/ripgrep/blob/e2362d4d5185d02fa857bf381e7bd52e66fafc73/crates/core/flags/complete/rg.zsh#L7">ripgrep does it</a>.</p>
<p>Another solution is to use dynamic completion by <code>clap_complete</code> but it is lacking a few things, most notably it can&#x27;t do partial completions. So <code>s&lt;tab&gt;</code> will complete to <code>src/ </code> (with space) instead of <code>src/</code>. So this will only partially solve the issue for zsh and make it worse for other shells. More details about this in the summary below.</p>

 Debugging summary 
<br>

<p><strong>Dynamic Completion by Clap</strong></p>
<blockquote>
<p>For what it&#x27;s worth, a brief attempt to add add = ArgValueCompleter::new(PathCompleter::file()) to Cmd(Vec) had no effect.</p>
</blockquote>
<p>It seems there were two issues:</p>
<ol>
<li><code>ArgValueCompleter</code> doesn&#x27;t apply to <code>external_subcommands</code>. Instead we need to use <a href="https://docs.rs/clap_complete/latest/clap_complete/engine/struct.SubcommandCandidates.html">SubcommandCandidates</a>.</li>
<li>since the above relies on dynamic completion we need a different source file which is generated by <a href="https://docs.rs/clap_complete/latest/clap_complete/env/index.html">CompleteEnv</a>.</li>
</ol>
<p>After these changes, it does work to some extent but there are lot of gotchas since this is a completely different way of completion. Currently all the completion logic lives in the completion files generated by <code>uv generate-shell-completion</code>, but with dynamic-completion all the logic lives in uv itself and completion file works as a small wrapper which calls into uv.</p>
<p>In little experience that I have had with <code>clap_complete</code> I don&#x27;t think dynamic completions are ready for uv&#x27;s usage yet. One can&#x27;t complain as <code>clap_complete</code> documentation is pretty clear that this is unstable feature üòÉ.</p>
<p>For example it does not support partial completions i.e. <code>s&lt;tab&gt;</code> will result in <code>src/ </code> instead of <code>src/</code> (without space). So to complete <code>src/main.py</code> you have press <code>s&lt;tab&gt;&lt;backspace&gt;&lt;tab&gt;</code>.</p>
<p>I also came across a bug in <code>PathCompleter</code> where it doesn&#x27;t respect the filter provided. So if you only want to complete files not folders using <code>PathCompleter::file()</code> it will still complete both. This one is easy fix though.</p>
<p>Similarly there might be more issues which I have not come across yet.</p>
<p><strong>Why is this an issue only on zsh</strong></p>
<p>This is mostly anecdotal, but in zsh you need to explicitly specify that you want files to included in completions, but in other shells (bash, fish) it is assumed that if no completions are present files will be used instead. So in fish it is opt-out but in zsh it is opt-in. A simple way to see this effect is to try <code>git diff &lt;tab&gt;</code> in zsh, it will not complete the files. But fish and bash will include the files.</p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/detrin">@detrin</a> on 2025-03-01 23:02</div>
            <div class="timeline-body"><p>+1</p>
<p>I would appreciate this to be solved in future. Due to this fact, I just use <code>python script.py</code> instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nkitsaini">@nkitsaini</a> on 2025-03-03 07:05</div>
            <div class="timeline-body"><p>I will look into implementing this. I am planning to go with bundling the zsh completion file at build time. Please let me know if anyone has a better solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoechenberger">@hoechenberger</a> on 2025-03-03 07:08</div>
            <div class="timeline-body"><p>How about creating a zsh plugin? Wouldn&#x27;t that, in theory, simplify things?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nkitsaini">@nkitsaini</a> on 2025-03-03 08:54</div>
            <div class="timeline-body"><p>I have not worked with zsh plugins, so please correct me if I am wrong. But if I understand correctly they can only help with registering the completion file, which is currently working as expected.</p>
<p>We need to make sure that zsh completion file that gets registered (either via plugin or a simpler <code>source</code>) specifies that <code>uv run ...</code> should also include filenames in completion.</p>
<p>Currently this file is generated by <code>clap-complete-command</code> at runtime, instead if we generate this file before-hand (with the help of <code>clap-complete-command</code>), we can fully control it with modifications on top.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hoechenberger">@hoechenberger</a> on 2025-03-03 09:33</div>
            <div class="timeline-body"><blockquote>
<p>But if I understand correctly they can only help with registering the completion file, which is currently working as expected.</p>
</blockquote>
<p>To my knowledge, plugins can do more than that, see e.g. https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/autopep8/_autopep8</p>
<p>However I&#x27;m not an expert on zsh plugins either; just wanted to point out that this <strong>might</strong> be a possible approach that was overlooked so far.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/potiuk">@potiuk</a> on 2025-03-21 22:36</div>
            <div class="timeline-body"><p>I also would love to +1 the idea of having generic auto-complete work with <code>uv run</code>.</p>
<p>I <strong>love</strong> the simplicity of workflows that <code>uv</code> came up with. @charliermarsh - &gt; we know each other in person, we talked a lot,  I listened to your podcast https://www.youtube.com/watch?v=hGFb4mMMmkE - and I wholeheartedly agree with your &quot;let&#x27;s redefine the workflow for python devs out there&quot;. And Astral with uv mostly NAIL IT.  Even today after finally merging the final step of refactoring for Airflow I proposed to swich to <code>uv</code> as the ONLY supported tooling. https://lists.apache.org/thread/88yj3qxqdmc4ony7k8nvp292m28df31c</p>
<p>But... Autocomplete for <code>uv run</code> is BADLY missing,</p>
<p>Currently, after activating the <code>.venv</code>, you could run (for airflow) <code>pytest airflow-core/tests/unit/a&lt;TAB&gt;</code> and get the test files auto-complete for you,. Which comes outside of <code>uv</code>.</p>
<p>But - I would <strong>love</strong> to be able to tell my users:</p>
<pre><code>git clone &lt;airflow repo&gt;
cd airflow
uv sync
uv run pytest airflow-core/tests/unit/&lt;TAB&gt;
</code></pre>
<p>Even if it will require the <code>uv sync</code> and <code>uv run</code> will not get it out-of-the-box, that&#x27;s fine. I think it would just be great to see the same auto-complete they would usually see after running their usual command with <code>uv run</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattrossman">@mattrossman</a> on 2025-03-28 16:02</div>
            <div class="timeline-body"><p>Was just bit by this as a new <code>uv</code> user, though I don&#x27;t use ohmyzsh, just zsh.</p>
<p>Weirdly in VSCode (which auto-activates the <code>.venv</code>), the completions work after I <code>deactivate</code> the virtual environment, and they continue to work if I <code>source .venv/bin/activate</code>. They just don&#x27;t work with the default auto-activated venv, nor in a fresh iTerm 2 session which doesn&#x27;t auto activate <code>.venv</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xtream1101">@xtream1101</a> on 2025-04-03 22:41</div>
            <div class="timeline-body"><blockquote>
<p>Weirdly in VSCode (which auto-activates the <code>.venv</code>), the completions work after I <code>deactivate</code> the virtual environment, and they continue to work if I <code>source .venv/bin/activate</code>. They just don&#x27;t work with the default auto-activated venv, nor in a fresh iTerm 2 session which doesn&#x27;t auto activate <code>.venv</code>.</p>
</blockquote>
<p>I am seeing this exact pattern as well. At least I know how to have it work as expected in vscode when I need.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jerpint">@jerpint</a> on 2025-05-02 15:47</div>
            <div class="timeline-body"><p>has anyone figured out a workaround for this in zsh? i also would love to be able to autocomplete filenames after <code>uv run python &lt;TAB&gt;/&lt;TAB&gt;/&lt;TAB&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pievalentin">@pievalentin</a> on 2025-05-03 17:26</div>
            <div class="timeline-body"><p>I would give 5$ to whoever fix this lol</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aidanmelen">@aidanmelen</a> on 2025-05-09 03:30</div>
            <div class="timeline-body"><blockquote>
<p>I would give 5$ to whoever fix this lol</p>
</blockquote>
<p>To enable shell autocompletion for uv commands, run one of the following:</p>
<p><code>echo &#x27;eval &quot;$(uv generate-shell-completion zsh)&quot;&#x27; &gt;&gt; ~/.zshrc</code></p>
<p>To enable shell autocompletion for uvx, run one of the following:</p>
<p><code>echo &#x27;eval &quot;$(uvx --generate-shell-completion zsh)&quot;&#x27; &gt;&gt; ~/.zshrc</code></p>
<p>Then restart the shell or source the shell config file.</p>
<p>source: https://docs.astral.sh/uv/getting-started/installation/#shell-autocompletion</p>
<p>cheers!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AMMullan">@AMMullan</a> on 2025-05-09 12:17</div>
            <div class="timeline-body"><p>@aidanmelen the problem people are pointing to isn&#x27;t that shell completion doesn&#x27;t work, it&#x27;s that if you try to run <strong>uv run [tab]</strong> it doesn&#x27;t autocomplete a file name. Sadly, today at least, you&#x27;re not winning the $5 üòõ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-09 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/marovira">@marovira</a> on 2025-05-09 17:07</div>
            <div class="timeline-body"><p>@pievalentin I&#x27;ve managed to &quot;fix&quot; this by adding the following code to my <code>zhsrc</code>:</p>
<pre><code>    # Fix completions for uv run.
    _uv_run_mod() {
        if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
            _arguments &#x27;*:filename:_files&#x27;
        else
            _uv &quot;$@&quot;
        fi
    }
    compdef _uv_run_mod uv
</code></pre>
<p>I&#x27;ve been driving this for a bit over a month now on several platforms and has been working without issue.
I think this was mentioned somewhere in this thread, but I figured I&#x27;d mention it again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdt-amartin">@tdt-amartin</a> on 2025-05-13 01:29</div>
            <div class="timeline-body"><p>~~I don&#x27;t know how many of you have tried this or if it&#x27;s just a fluke on my end, but I do run Oh-My-Zsh, and I found that autocomplete works just fine if you use this:~~</p>
<p><code>echo &#x27;eval &quot;$(uv --generate-shell-completion zsh)&quot;&#x27; &gt;&gt; ~/.zshrc</code></p>
<p>~~The docs are missing the leading --  for the generate command, and when I added those the completion works. Maybe it&#x27;s a typo? Maybe it&#x27;s Maybeline. I don&#x27;t know, but I was looking for what was wrong, found this thread, and noticed that small change worked for me.~~</p>
<p>This was totally mistaken and should be ignored.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markonen">@markonen</a> on 2025-05-13 06:01</div>
            <div class="timeline-body"><p>@tdt-amartin that made no difference here on my plain vanilla zsh install.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AMMullan">@AMMullan</a> on 2025-05-14 13:15</div>
            <div class="timeline-body"><p>@marovira that&#x27;s a brilliant workaround!!! You can even replace your _arguments with this to only return files with *.py (if you wanted):</p>
<pre><code>_arguments &#x27;*:filename:_files -g &quot;*.py&quot;&#x27;```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/poneding">@poneding</a> on 2025-05-28 06:08</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/pievalentin">@pievalentin</a> I&#x27;ve managed to &quot;fix&quot; this by adding the following code to my <code>zhsrc</code>:ÊàëÂ∑≤ËÆæÊ≥ïÈÄöËøáÂêëÊàëÁöÑ <code>zhsrc</code> Ê∑ªÂä†‰ª•‰∏ã‰ª£Á†ÅÊù•‚Äú‰øÆÂ§ç‚ÄùÊ≠§ÈóÆÈ¢òÔºö</p>
<pre><code># Fix completions for uv run.
_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        _arguments &#x27;*:filename:_files&#x27;
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv</code></pre>
<p>I&#x27;ve been driving this for a bit over a month now on several platforms and has been working without issue.ÊàëÂ∑≤ÁªèÂú®Â§ö‰∏™Âπ≥Âè∞‰∏äËøêË°åÂÆÉ‰∏Ä‰∏™Â§öÊúà‰∫ÜÔºåÂπ∂‰∏îËøêË°åÊ≠£Â∏∏„ÄÇ I think this was mentioned somewhere in this thread, but I figured I&#x27;d mention it again.ÊàëËÆ§‰∏∫Ëøô‰∏™Â∏ñÂ≠ê‰∏≠ÊüêÂ§ÑÊèêÂà∞ËøáËøô‰∏ÄÁÇπÔºå‰ΩÜÊàëÊÉ≥Êàë‰ºöÂÜçÊ¨°ÊèêÂèäÂÆÉ„ÄÇ</p>
</blockquote>
<p>You&#x27;re my superman</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanielYang59">@DanielYang59</a> on 2025-06-05 12:40</div>
            <div class="timeline-body"><p>In my case (zsh, MacOS 15.5, no <code>oh my zsh</code>). I have <code>autoload -Uz compinit &amp;&amp; compinit</code> in my <code>.zshrc</code> to allow autocomplete for <code>git</code>, and this seems to interfere with autocomplete <code>uv run</code>...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yoniLavi">@yoniLavi</a> on 2025-06-12 08:47</div>
            <div class="timeline-body"><p>Just combining @marovira&#x27;s solution with @AMMullan&#x27;s filtering for <code>.py</code> files (to save future visitors 10 seconds doing so):</p>
<pre><code># Fix completions for uv run to autocomplete .py files
_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        _arguments &#x27;*:filename:_files -g &quot;*.py&quot;&#x27;
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv
</code></pre>
<p>When added to .zshrc, the above works perfectly for me.
Thank you both!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jazzinghen">@Jazzinghen</a> on 2025-06-18 08:19</div>
            <div class="timeline-body"><p>I wonder if this is an issue only on MacOS. I just encountered the same on MacOS, however on my Linux machine I never encountered it. Could this be a hint?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ICHx">@ICHx</a> on 2025-06-19 22:37</div>
            <div class="timeline-body"><blockquote>
<p>Just combining <a href="https://github.com/marovira">@marovira</a>&#x27;s solution with <a href="https://github.com/AMMullan">@AMMullan</a>&#x27;s filtering for <code>.py</code> files (to save future visitors 10 seconds doing so):</p>
Fix completions for uv run to autocomplete .py files
<p>_uv_run_mod() {
if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
_arguments &#x27;<em>:filename:_files -g &quot;</em>.py&quot;&#x27;
else
_uv &quot;$@&quot;
fi
}
compdef _uv_run_mod uv</p>
<p>When added to .zshrc, the above works perfectly for me. Thank you both!</p>
</blockquote>
<p>This really helped.</p>
<p>I am on wsl omz zsh, and installed uv via homebrew</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/romanovzky">@romanovzky</a> on 2025-06-27 10:40</div>
            <div class="timeline-body"><blockquote>
<p>_uv_run_mod() {
if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
_arguments &#x27;<em>:filename:_files -g &quot;</em>.py&quot;&#x27;
else
_uv &quot;$@&quot;
fi
}
compdef _uv_run_mod uv</p>
</blockquote>
<p>This makes omz and uv work together as intended, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gergesh">@gergesh</a> on 2025-07-15 08:17</div>
            <div class="timeline-body"><p>Bumping this issue with another nicety if anyone&#x27;s interested:</p>
<pre><code>_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        # Check if any previous argument after &#x27;run&#x27; ends with .py
        if [[ ${words[3,$((CURRENT-1))]} =~ &quot;.*\.py&quot; ]]; then
            # Already have a .py file, complete any files
            _arguments &#x27;*:filename:_files&#x27;
        else
            # No .py file yet, complete only .py files
            _arguments &#x27;*:filename:_files -g &quot;*.py&quot;&#x27;
        fi
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv
</code></pre>
<p>Completes a Python file and then allows for arbitrary completion for the rest of the arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/itopaloglu83">@itopaloglu83</a> on 2025-07-20 18:03</div>
            <div class="timeline-body"><p>Wow, uv is great but not being able to auto complete the <code>uv run &lt;filename&gt;</code> is quite the paper cut.</p>
<p>~I&#x27;m also surprised that the typo in the documentation is still not fixed either.~</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-20 18:05</div>
            <div class="timeline-body"><p>I don&#x27;t think there&#x27;s a typo? <code>uv generate-shell-completion zsh</code> works just fine. The <code>--generate-shell-completion</code> variant is just an alias for backwards compatibility. They&#x27;re exactly equivalent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdt-amartin">@tdt-amartin</a> on 2025-07-21 23:20</div>
            <div class="timeline-body"><p>@charliermarsh yeah, I guess you&#x27;re write. I take it back. My bad.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tarpas">@tarpas</a> on 2025-07-23 10:15</div>
            <div class="timeline-body"><p>uvx on zsh/MacOS also breaks (the default) autocomplete</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andrewaylett">@andrewaylett</a> on 2025-08-15 22:21</div>
            <div class="timeline-body"><p><code>jj</code> uses dynamic autocomplete -- so the entire fish completion script is:</p>
<pre><code>complete -k --exclusive jj -a &#x27;(COMPLETE=fish jj -- (commandline --current-process --tokenize --cut-at-cursor) (commandline --current-token))&#x27;
</code></pre>
<p>This means jj can generate completions appropriate for the current operation and status, so if I type <code>jj log -r &lt;tab&gt;</code> then it&#x27;ll give me a list of all current revisions, like so:</p>
<pre><code>&gt; COMPLETE=fish jj -- jj log -r &quot;&quot;
main    Update pre-commit hook renovatebot/pre-commit-hooks to v41.74.2 (#853)
push-xylttmtspktr       A smidge of tidying of remark stuff
&lt;snip lots of other revisions&gt;
</code></pre>
<p>It would be <em>really nice</em> if <code>uv</code> could do something similar, enabling features along the lines of auto-completing <code>uv run &lt;tab&gt;</code> giving you a selection of the different commands available in the project, or even <code>uv run poe &lt;tab&gt;</code> giving you the completions you&#x27;d get from activating the venv and completing <code>poe &lt;tab&gt;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-15 22:36</div>
            <div class="timeline-body"><p>We&#x27;d love dynamic completions, but I&#x27;d recommend opening a new issue instead of posting here ‚Äî this issue is about how zsh completions are broken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/konstin">@konstin</a> on 2025-08-21 07:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adrianlzt">@adrianlzt</a> on 2025-09-05 06:20</div>
            <div class="timeline-body"><p>Another workaround to autocomplete *.py files and commands (I use a lot &quot;uv run ansible&quot;).
The command autocomplete is with commands already in the <code>PATH</code>, so it is dumb, and won&#x27;t autocomplete commands installed by <code>uv</code>.</p>
<pre><code>eval &quot;$(patch -i /path/uv-run-cmd-py-file.patch -o - =(uv --generate-shell-completion zsh) 2&gt; /dev/null)&quot;
</code></pre>
<p><a href="https://github.com/user-attachments/files/22166265/uv-run-cmd-py-file.patch">uv-run-cmd-py-file.patch</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/EliteTK">@EliteTK</a> by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-10 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-10 09:14</div>
            <div class="timeline-body"><p>Found a working solution. Setting <code>value_hint</code> in the right places does appear to work. Will push something today/this week.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-10 16:19</div>
            <div class="timeline-body"><p>Did some more digging and noticed that it has actually been &quot;working&quot; since <code>uv</code> 0.8.4 because <a href="https://github.com/clap-rs/clap/commit/e2aa2f07d1cd50412de51b51a7cc897e80e0b92f"><code>clap-complete</code> v4.5.53 fixed this</a> in the case we&#x27;re using it in.</p>
<p>Both the <code>uv run</code> and <code>uv tool run</code> completions now complete with <a href="https://zsh.sourceforge.io/Doc/Release/Completion-System.html#index-_005fdefault"><code>_default</code></a>.</p>
<p><code>uv tool run</code> probably shouldn&#x27;t be trying to complete anything local. That could be fixed.</p>
<p>For <code>uv run</code> we could change it to something more specific like <a href="https://zsh.sourceforge.io/Doc/Release/Completion-System.html#index-_005ffiles"><code>_files</code></a>[^1] to stop directories showing up. To complete things in the virtual environment bin directory we would need dynamic completions.</p>
<p>[^1]: There is also <a href="https://zsh.sourceforge.io/Doc/Release/Completion-System.html#index-_005fcmdambivalent"><code>_cmdambivalent</code></a>. But it&#x27;s probably not appropriate here. It would prioritise completing things in <code>$PATH</code>, then relative/absolute paths to executable files, and finally paths to any file. The <code>$PATH</code> wouldn&#x27;t contain the <code>.venv/bin</code> unless you were in the virtual environment at which point, you probably aren&#x27;t using <code>uv run</code>. To trigger local file completion you need to start a completion with an explicit <code>./</code>. Due to how this completion works the engine would refuse to complete anything non-executable if the current prefix matches an executable or directory which isn&#x27;t the best UX.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-10 17:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thedch">@thedch</a> on 2025-12-24 20:47</div>
            <div class="timeline-body"><blockquote>
<p>it has actually been &quot;working&quot; since uv 0.8.4</p>
</blockquote>
<p>Unfortunately auto completions are still not working for me:</p>
<pre><code>‚ùØ uv --version
uv 0.9.18 (Homebrew 2025-12-16)

‚ùØ echo $0
-zsh

‚ùØ uv run ./ # pressing tab here does nothing

‚ùØ ls ./ # pressing tab allows me to cycle through files in current directory
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-25 22:31</div>
            <div class="timeline-body"><p>Hey @thedch, thanks for the report, but I can&#x27;t seem to replicate this:</p>
<pre><code>$ $SHELL --version
zsh 5.9 (x86_64-apple-darwin23.0)
$ autoload -Uz compinit
$ compinit
$ typeset -f _uv | head
_uv () {
	# undefined
	builtin autoload -XUz
}
$ typeset -f _uv|grep -o &#x27;external_command:\w\+&#x27;
$ source &lt;(uv generate-shell-completion zsh)
$ typeset -f _uv|grep -o &#x27;external_command:\w\+&#x27;
external_command:_default
external_command:_default
external_command:_default
$ mkdir test; cd test; uv init
Initialized project `test`
$ uv run &lt;TAB&gt;
README.md       main.py         pyproject.toml
</code></pre>
<p>You probably already have the completions loaded so you&#x27;ll get a different output from the first typeset commands. It may be the case that you have the old completions loaded and this may fix them. In either case, let me know what output you do get.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TurtleOrangina">@TurtleOrangina</a> on 2025-12-28 08:06</div>
            <div class="timeline-body"><p>For me, auto-completing local files (e.g. uv run foo/bar/script.py) works thanks to the &quot;generate-shell-completion zsh&quot; in my .zshrc. But, auto-completing scripts that I defined in my pyproject.toml does not. E.g. <code>uv run enable-warp-drive</code> doesn&#x27;t auto-complete (but works, if enable-warp-drive is a script entry point, that exists in <code>.venv/bin</code>).</p>
<p>With pyproject.toml something like:</p>
<pre><code>### snip
[project.scripts]
enable-warp-drive = &#x27;spaceship.cli.enable_warp_drive:run&#x27;
### snip
</code></pre>
<p>It would be great if handling this was incorporated into what <code>uv generate-shell-completion</code> generates. For now, I work-around it by having this additionally in my .zshrc:</p>
<pre><code>_uv_run_mod() {
    if [[ &quot;$words[2]&quot; == &quot;run&quot; &amp;&amp; &quot;$words[CURRENT]&quot; != -* ]]; then
        local venv_binaries
        if [[ -d .venv/bin ]]; then
            venv_binaries=( ${(@f)&quot;$(_call_program files ls -1 .venv/bin 2&gt;/dev/null)&quot;} )
        fi

        _alternative \
            &#x27;files:filename:_files&#x27; \
            &quot;binaries:venv binary:(($venv_binaries))&quot;
    else
        _uv &quot;$@&quot;
    fi
}
compdef _uv_run_mod uv
</code></pre>
<p>Note that this work-around is not ideal, since it will not auto-complete when the virtual environment is not yet set up.</p>
<p>I will put this in a new issue post instead, as this thread is a bit all-over-the-place (and closed).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-28 10:24</div>
            <div class="timeline-body"><p>@TurtleOrangina This issue was just for path completion being unintentionally broken. Getting dynamic completions working is a bit more involved and is tracked here: #15325.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:57 UTC
    </footer>
</body>
</html>
