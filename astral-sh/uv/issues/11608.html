<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv run --prerelease=allow script.py` with in-line index seems to fail - astral-sh/uv #11608</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv run --prerelease=allow script.py</code> with in-line index seems to fail</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11608">#11608</a>
        opened by <a href="https://github.com/bluecoconut">@bluecoconut</a>
        on 2025-02-18 23:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bluecoconut">@bluecoconut</a> on 2025-02-18 23:00</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm trying to get inline torch-xla[tpu] to work, but keep running into issues.</p>
<p>script.py</p>
<pre><code class="language-python"># /// script
# requires-python = &quot;==3.10.*&quot;
# dependencies = [
#   &quot;torch~=2.6.0&quot;,
#   &quot;torch_xla[tpu]~=2.6.0&quot;,
# ]
#
# [[tool.uv.index]]
# url = &quot;https://storage.googleapis.com/libtpu-releases/index.html&quot;
#
# [[tool.uv.index]]
# url = &quot;https://storage.googleapis.com/libtpu-wheels/index.html&quot;
# ///

import torch
import torch_xla

print(torch_xla.__version__)
print(torch.__version__)
</code></pre>
<p>however <code>uv run --prerelease=allow script.py</code> gets an error</p>
<pre><code class="language-bash">  × No solution found when resolving script dependencies:
  ╰─▶ Because there is no version of libtpu-nightly==0.1.dev20241010+nightly.cleanup and
      torch-xla[tpu]==2.6.0 depends on libtpu-nightly==0.1.dev20241010+nightly.cleanup,
      we can conclude that torch-xla[tpu]==2.6.0 cannot be used.
      And because only torch-xla[tpu]&lt;=2.6.0 is available and you require
      torch-xla[tpu]&gt;=2.6.0, we can conclude that your requirements are unsatisfiable.
</code></pre>
<p>I created this script using</p>
<pre><code class="language-bash">uv add --index https://storage.googleapis.com/libtpu-releases/index.html --index https://storage.googleapis.com/libtpu-wheels/index.html --script example.py 'torch~=2.6.0' 'torch_xla[tpu]~=2.6.0' 
</code></pre>
<p>However, when i directly use UV in a different way (add to a lock file directly i guess)</p>
<pre><code class="language-bash">uv add torch_xla[tpu]~=2.6.0 -f https://storage.googleapis.com/libtpu-releases/index.html  -f https://storage.googleapis.com/libtpu-wheels/index.html --prerelease=allow
</code></pre>
<p>this successfully adds the dependencies to a <code>uv.lock</code></p>
<p>looking into the uv lock, i see:</p>
<pre><code class="language-toml">[[package]]
name = &quot;libtpu-nightly&quot;
version = &quot;0.1.dev20241010+nightly.cleanup&quot;
source = { registry = &quot;https://storage.googleapis.com/libtpu-releases/index.html&quot; }
wheels = [
    { url = &quot;https://storage.googleapis.com/libtpu-nightly-releases/wheels/libtpu-nightly/libtpu_nightly-0.1.dev20241010+nightly.cleanup-py3-none-any.whl&quot; },
]
</code></pre>
<p>which shows that the lock file (outside of the inline toml of scripts) correctly handled the index and worked.</p>
<p>By using the lock file, I was able to get the manual wheel, and then I was able to pin the script (so I have a very temproary workaround) where I ignore the indexes (since they don't seem to work) and simply pin the wheel.</p>
<pre><code># /// script
# requires-python = &quot;==3.10.*&quot;
# dependencies = [
#   &quot;torch~=2.6.0&quot;,
#   &quot;torch-xla[tpu]~=2.6.0&quot;,
#   &quot;libtpu-nightly @ https://storage.googleapis.com/libtpu-nightly-releases/wheels/libtpu-nightly/libtpu_nightly-0.1.dev20241010+nightly.cleanup-py3-none-any.whl&quot;
# ]
# ///
</code></pre>
<p>i don't really like doing this though, and would rather the index work as expected.</p>
<p>My only guess is that the <code>--prerelease=allow</code> flag somehow is causing this to not work, since in the documetnation there are other examples of using <code>[[tool.uv.index]]</code> sections in-line with a script.</p>
<p>(For some context, I'm trying to install based on instructions on the pytorch-xla repo https://github.com/pytorch/xla for TPU VMs, which includes the <code>pip install ... -f</code> command I'm trying to adopt into a script toml header)</p>
<h3>Platform</h3>
<p>Linux 5.19.0-1022-gcp x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.5.26</p>
<h3>Python version</h3>
<p>Python 3.13.1 (though the script im using pins to ==3.10.*)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @bluecoconut on 2025-02-18 23:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-19 00:03</div>
            <div class="timeline-body"><p>Those aren't actually indexes, they're <code>--find-links</code> entries (which are a little different and not standardized). We do support them, but you have to use a different field, like:</p>
<pre><code class="language-toml"># /// script
# requires-python = &quot;==3.10.*&quot;
# dependencies = [
#   &quot;torch~=2.6.0&quot;,
#   &quot;torch_xla[tpu]~=2.6.0&quot;,
# ]
#
# [tool.uv]
# find-links = [
#   &quot;https://storage.googleapis.com/libtpu-releases/index.html&quot;,
#   &quot;https://storage.googleapis.com/libtpu-wheels/index.html&quot;,
# ]
# ///
</code></pre>
<p>Can you give something like that a try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-02-19 00:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2025-02-19 00:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluecoconut">@bluecoconut</a> on 2025-02-19 00:13</div>
            <div class="timeline-body"><p>Aha! Beautiful. Thank you, TIL about &quot;find-links&quot; vs. &quot;index&quot;.</p>
<p>this worked wonderfully.</p>
<p>Here's the updated header that worked for me, and hopefully will save anyone else searching for something similar in the future.</p>
<pre><code># /// script
# requires-python = &quot;==3.10.*&quot;
# dependencies = [
#   &quot;torch~=2.6.0&quot;,
#   &quot;torch-xla[tpu]~=2.6.0&quot;,
# ]
# [tool.uv]
# find-links = [
#   &quot;https://storage.googleapis.com/libtpu-releases/index.html&quot;,
#   &quot;https://storage.googleapis.com/libtpu-wheels/index.html&quot;,
# ]
# prerelease = &quot;allow&quot;
# ///
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bluecoconut on 2025-02-19 00:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-19 00:17</div>
            <div class="timeline-body"><p>Awesome, thanks for following up. There's a TODO somewhere to add support for <code>--find-links</code>-style HTML pages in the <code>[[tool.uv.index]]</code> API.</p>
<p>(<code>--find-links</code> is basically a single HTML page with a bunch of links to assets, whereas with a standard registry, you have an index that tells you all the available packages, and then you can ask it to list the versions / assets for a given package.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-19 00:20</div>
            <div class="timeline-body"><p>Can we hint if there are no versions on an index that looks find-linksy?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:56 UTC
    </footer>
</body>
</html>
