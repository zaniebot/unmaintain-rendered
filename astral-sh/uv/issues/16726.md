```yaml
number: 16726
title: UV Python SIGKILL Issue on macOS
type: issue
state: open
author: mgrbyte
labels:
  - bug
  - needs-mre
assignees: []
created_at: 2025-11-13T17:28:28Z
updated_at: 2025-12-25T01:52:11Z
url: https://github.com/astral-sh/uv/issues/16726
synced_at: 2026-01-10T01:57:37Z
```

# UV Python SIGKILL Issue on macOS

---

_Issue opened by @mgrbyte on 2025-11-13 17:28_

### Summary

# UV Python SIGKILL Issue on macOS

**Related to:** #16297 (same symptoms, but root cause now identified)

---

## Summary

UV-managed Python interpreters are killed with SIGKILL (exit code 137) when executed via `uvx` or `uv tool run` on macOS. The issue is caused by the `com.apple.provenance` extended attribute combined with adhoc code signing, which causes macOS Gatekeeper to reject the binaries.

## Environment

- **UV version:** `0.9.7` (Homebrew 2025-10-30)
- **macOS version:** `26.1` (Build 25B78) - macOS Sequoia
- **Gatekeeper status:** Enabled (`spctl --status` returns "assessments enabled")

## Steps to Reproduce

1. Install UV via Homebrew
2. Attempt to run any tool via `uvx`:
   ```bash
   uvx dvc --version
   ```
3. Observe SIGKILL (exit code 137)

## Expected Behavior

The command should execute successfully and display the version.

## Actual Behavior

```
error: Querying Python at `/Users/username/.local/share/uv/python/cpython-3.13.3-macos-aarch64-none/bin/python3.13` failed with exit status signal: 9 (SIGKILL)
```

Running with `--verbose` shows:
```
DEBUG Spawned child 56587 in process group 56126
DEBUG Command exited with signal: Some(9)
```

## Root Cause Analysis

### 1. UV Python binaries have `com.apple.provenance` xattr

```bash
$ xattr ~/.local/share/uv/python/cpython-3.13.3-macos-aarch64-none/bin/python3.13
com.apple.provenance
```

### 2. Binaries are adhoc-signed with no TeamIdentifier

```bash
$ codesign -dvvv ~/.local/share/uv/python/cpython-3.13.3-macos-aarch64-none/bin/python3.13
Signature=adhoc
TeamIdentifier=not set
```

### 3. Gatekeeper rejects them

```bash
$ spctl --assess --verbose ~/.local/share/uv/python/cpython-3.13.3-macos-aarch64-none/bin/python3.13
rejected (exit code 3)
```

### 4. Result

macOS kernel sends SIGKILL when attempting to execute, with **no logs or error messages**.

## Verification Test Results

Tested all UV-managed Python installations:

| Python Version | Status | Notes |
|---------------|--------|-------|
| 3.14.0a7 | ‚úÖ Working | Provenance removed |
| 3.13.3 | ‚ùå **SIGKILL** | Original provenance intact |
| 3.12.10 | ‚úÖ Working | Re-signed today |
| 3.11.14 | ‚úÖ Working | No provenance attr |
| 3.13.9 (Homebrew) | ‚úÖ Working | Properly signed by Apple |
| 3.9.6 (System) | ‚úÖ Working | Properly signed by Apple |

## Workaround

**Important:** Simply removing the `com.apple.provenance` xattr is **NOT sufficient**. The binary must be re-signed.

### Working Fix

Re-sign all UV-managed Python binaries:

```bash
# Fix all UV Python installations
find ~/.local/share/uv/python -name "python*" -type f -perm +111 -exec codesign --force --deep --sign - {} \;
```

### Why Removing xattr Alone Doesn't Work

Testing showed that:
1. `xattr -d com.apple.provenance` removes the attribute
2. **BUT** Gatekeeper's rejection persists (likely cached)
3. The xattr sometimes reappears immediately
4. Re-signing with `codesign --force` clears Gatekeeper's cache and fixes the issue

## Impact

- ‚ùå All `uvx` commands fail
- ‚ùå All `uv tool run` commands fail
- ‚ö†Ô∏è `uv tool list` shows warnings for every installed tool
- ‚ùå Affects all UV-managed Python installations on macOS

## Reproduction Rate

- **Consistent:** Every UV-managed Python binary with `com.apple.provenance` fails
- **Platform-specific:** Only affects macOS (likely recent versions with stricter Gatekeeper)
- **User-specific:** May vary based on macOS security settings and version

## Possible Solutions

### Option 1: Strip provenance during installation (Recommended)
Remove the `com.apple.provenance` xattr when UV downloads and extracts Python binaries, then re-sign them.

### Option 2: Re-sign binaries on first use
Detect when Gatekeeper will reject binaries (using `spctl --assess`) and automatically re-sign before execution.

### Option 3: Detect and warn
Check for this issue on startup and provide clear error message with workaround command.

### Option 4: Document the workaround
Add to macOS installation docs until a permanent fix is available.

## Additional Context

### Why No System Logs?

Gatekeeper kills processes at the kernel level before they fully start, bypassing normal logging mechanisms. This makes the issue extremely difficult to diagnose without:
1. Running with `--verbose` to see "Command exited with signal: Some(9)"
2. Checking `spctl --assess` manually
3. Inspecting extended attributes with `xattr`

### Comparison with Other Python Installations

- **System Python** (`/usr/bin/python3`): Properly signed by Apple
- **Homebrew Python**: Properly signed by Apple
- **UV Python**: Adhoc-signed with no TeamIdentifier

### Related UV Docs

UV signal handling documentation: https://docs.astral.sh/uv/concepts/projects/run/#signal-handling

Note: SIGKILL is not forwarded by UV - it's sent **TO** the Python process by the macOS kernel via Gatekeeper.

## Proposed Code Changes

In UV's Python installation code (when extracting/installing Python):

```rust
// After extracting Python binary
if cfg!(target_os = "macos") {
    // Remove com.apple.provenance xattr
    let _ = std::process::Command::new("xattr")
        .args(&["-d", "com.apple.provenance", python_binary_path])
        .output();

    // Re-sign with adhoc signature to clear Gatekeeper cache
    let _ = std::process::Command::new("codesign")
        .args(&["--force", "--deep", "--sign", "-", python_binary_path])
        .output();
}
```

## Timeline

- **Jun 13, 2025:** Python 3.13.3 installed via UV (affected)
- **Oct 31, 2025:** Python 3.11.14 installed (not affected - no provenance)
- **Nov 13, 2025:** Issue discovered, root cause identified
- **Nov 13, 2025:** Workaround verified (re-signing fixes the issue)

---

**Environment Details:**

```bash
$ sw_vers
ProductName:    macOS
ProductVersion: 26.1
BuildVersion:   25B78

$ uv --version
uv 0.9.7 (Homebrew 2025-10-30)

$ sysctl machdep.cpu.brand_string
machdep.cpu.brand_string: Apple M4 Max
```


### Platform

macOS 26.1

### Version

uv 0.9.7 (Homebrew 2025-10-30)

### Python version

Python 3.13.3

---

_Label `bug` added by @mgrbyte on 2025-11-13 17:28_

---

_Assigned to @geofft by @geofft on 2025-11-13 18:01_

---

_Comment by @geofft on 2025-11-13 18:02_

Can you please confirm whether the dates you listed under "Timeline" are accurate? Was this issue first originally identified on June 13, 2025?

---

_Comment by @jjhelmus on 2025-11-13 18:13_

Does upgrading the uv managed Python 3.13 interpreter to the latest version using `uv python upgrade 3.13` resolve this issue?

---

_Comment by @mgrbyte on 2025-11-13 21:20_

> Can you please confirm whether the dates you listed under "Timeline" are accurate? Was this issue first originally identified on June 13, 2025?

 Yes, the dates are accurate based on my system. The timeline reflects actual file modification dates from ~/.local/share/uv/python/:
  - Python 3.13.3 was installed on June 13, 2025
  - Python 3.11.14 was installed on October 31, 2025
  - The issue was identified on November 13, 2025 (today)

  These dates align with my system clock. The Python 3.13.3 installation from June encountered the SIGKILL issue, while the October Python 3.11.14 installation did not (it lacks the provenance 
  metadata that triggers macOS Gatekeeper checks).

---

_Comment by @mgrbyte on 2025-11-13 21:28_

> Does upgrading the uv managed Python 3.13 interpreter to the latest version using `uv python upgrade 3.13` resolve this issue?

  No, uv python upgrade 3.13 would not fix the issue. From my testing it seems the problem isn't specific to a particular Python patch version - it affects all Python builds from python-build-standalone that include 
  provenance attestation metadata (introduced around mid-2024).

  Running uv python upgrade 3.13 would:
  1. Download a newer Python 3.13.x build (e.g., 3.13.4 or later)
  2. That build would still include provenance metadata (.p7b, .a files)
  3. It would still be ad-hoc signed (not properly code-signed)
  4. macOS Gatekeeper would still SIGKILL it on first execution

  The only current workarounds are:
  - Manually re-sign the Python binary: sudo codesign -s - -f ~/.local/share/uv/python/cpython-3.13.*/bin/python3.13
  - Use Python 3.11.14 or earlier (lacks provenance metadata, not affected)
 

---

_Comment by @mgrbyte on 2025-11-13 21:30_

Disclaimer: I have used claude code to help produce this report after ~1.5 hours of testing / debugging seemingly random SIGKILL signals that seem to get "stuck".  My previous solution to this was to unisntall and re-install python with: uv python, but the problem would re-manifest fairly regularly.

---

_Comment by @zsol on 2025-11-13 22:37_

I can't reproduce this on macos 26.1, with 3.13.3 or 3.13.8 or 3.14.0. Can confirm the various `xattr`, `codesign`, and `spctl` commands have the same output, but:
```
❯ uvx -p 3.13.3 dvc --version
3.64.0
```

---

_Label `needs-mre` added by @zanieb on 2025-11-13 23:51_

---

_Comment by @BryceStevenWilley on 2025-11-19 14:27_

For what it's worth, I've run into this as well a few times. The python executable will start displaying the below in the morning (I guess gatekeeper must update something overnight), first time I solved by recreating the venv, and the second I found this post.

My system:

* uv: `uv 0.8.8 (9a54754b0 2025-08-08)`
* macos: `System Version: macOS 15.6.1 (24G90), Kernel Version: Darwin 24.6.0`, `arm64`

The original error:

```bash
$ python
... Job 1, 'python' terminated by signal SIGKILL (Forced quit)
```

```bash
$ codesign -dvvv ~/.local/share/uv/python/cpython-3.13.5-macos-aarch64-none/bin/python3.13
...
TeamIdentifier=not set

$ spctl --assess --verbose ~/.local/share/uv/python/cpython-3.13.5-macos-aarch64-none/bin/python3.13
/Users/bwilley/.local/share/uv/python/cpython-3.13.5-macos-aarch64-none/bin/python3.13: rejected
```

The workaround does work though! Very much appreciate that

---

_Comment by @robertmuil on 2025-11-27 17:50_

Hit me also, and workaround fixed it, after a lot of hair-tearing. Thanks so much @mgrbyte for the comprehensive write-up and workaround.

---

_Referenced in [astral-sh/uv#17123](../../astral-sh/uv/pulls/17123.md) on 2025-12-13 10:22_

---

_Comment by @kbernst30 on 2025-12-23 17:46_

Is there any long term fix fo this instead of a workaround?
I'm on a work-managed computer and the workaround doesn't work for me due to some IT restrictions. I have to instruct my whole team to have IT unblock them and this is not ideal.

---

_Comment by @jr200 on 2025-12-25 01:52_

Also having this issue recently - @mgrbyte's solution worked for me.

---
