<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pytorch for rocm needs explicit installation of python-triton-rom - astral-sh/uv #10712</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Pytorch for rocm needs explicit installation of python-triton-rom</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10712">#10712</a>
        opened by <a href="https://github.com/bgs4free">@bgs4free</a>
        on 2025-01-17 14:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bgs4free">@bgs4free</a> on 2025-01-17 14:48</div>
            <div class="timeline-body"><p>For some reason, if you want to install <code>pytorch</code> from https://download.pytorch.org/whl/rocm6.2 index, it seems necessary to also explicitly install <code>python-triton-rocm</code> from the same index. Otherwise I run into</p>
<pre><code>× No solution found when resolving dependencies for split (python_full_version ==
│ '3.11.*'):
╰─▶ Because there is no version of pytorch-triton-rocm{python_full_version &lt; '3.13'
    and platform_machine == 'x86_64' and platform_system == 'Linux'}==3.1.0 and
    torch==2.5.1+rocm6.2 depends on pytorch-triton-rocm{python_full_version &lt; '3.13' and
    platform_machine == 'x86_64' and platform_system == 'Linux'}==3.1.0, we can conclude
    that torch==2.5.1+rocm6.2 cannot be used.
    And because only the following versions of torch are available:
        torch&lt;2.5.1
        torch==2.5.1+rocm6.2
    we can conclude that torch&gt;=2.5.1 cannot be used
  ...
</code></pre>
<p>Though I don't think this is a uv issue, it might be good to mention it in the docs. Could prevent some headaches.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-17 15:19</div>
            <div class="timeline-body"><p>Can you share the configuration you're using to produce this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-01-17 15:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bgs4free">@bgs4free</a> on 2025-01-17 20:07</div>
            <div class="timeline-body"><pre><code>[project]
name = &quot;myproject&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
    &quot;pytorch-triton-rocm&gt;=3.1.0&quot;, 
    &quot;torch&gt;=2.5.1&quot;
]

[tool.uv.sources]
torch = [{ index = &quot;pytorch-rocm&quot; }]
pytorch-triton-rocm = [{ index = &quot;pytorch-rocm&quot; }]

[[tool.uv.index]]
name = &quot;pytorch-rocm&quot;
url = &quot;https://download.pytorch.org/whl/rocm6.2&quot;
explicit = true
</code></pre>
<p>This way everything works fine. Once I remove <code>pytorch-triton-rocm</code> I get the error.
Somewhat unfortunate, that they named it <code>pytorch-triton-rocm</code>. No idea, why. I guess, if they just had named it <code>pytorch-triton</code>, it would have worked implicitly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-17 20:22</div>
            <div class="timeline-body"><p>This looks right to me? You need <code>pytorch-triton-rocm</code> to come from the PyTorch index (the version on PyPI is out-dated -- it's definitely not <code>3.1.0</code>), and you made that index explicit. So you have to mark that dependency as &quot;sourced from the PyTorch index&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bgs4free">@bgs4free</a> on 2025-01-17 21:40</div>
            <div class="timeline-body"><p>I know that torch for rocm needs a special variant of triton and it's not an issue with uv. But since the docs contain a section dedicated to pytorch and specifically mention rocm (though not consistently throughout), I thought it be helpful to have an example that highlights this &quot;asymmetry&quot;. Took me a moment to figure out the problem myself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bgs4free">@bgs4free</a> on 2025-01-18 10:44</div>
            <div class="timeline-body"><p>I compared the behavior with pip:</p>
<pre><code>pip install torch --index-url https://download.pytorch.org/whl/rocm6.2
</code></pre>
<p>Pip is able to resolve the transitive dependency on <code>pytorch-triton-rocm</code> with no issues. No need to install it explicitly.</p>
<p>Now I'm wondering if this might be a uv issue after all. At least pip behaves as I would have expected intuitively: look for transitive dependencies in the custom index first, then fall back on the default.</p>
<p>Btw, I'm not exactly sure, what you meant by</p>
<blockquote>
<p>So you have to mark that dependency as &quot;sourced from the PyTorch index&quot;</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 15:27</div>
            <div class="timeline-body"><p>@bgs4free -- This:</p>
<pre><code class="language-toml">[tool.uv.sources]
torch = [{ index = &quot;pytorch-rocm&quot; }]

[[tool.uv.index]]
name = &quot;pytorch-rocm&quot;
url = &quot;https://download.pytorch.org/whl/rocm6.2&quot;
explicit = true
</code></pre>
<p>The use of <code>explicit = true</code> tells uv that the PyTorch index should <em>only</em> be used for <code>torch</code>, and not for any other dependencies. It is <em>not</em> the same as pip, which does not have this behavior.</p>
<p>If you want pip's behavior, you need to use different configuration. Specifically, you'd want:</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;pytorch-rocm&quot;
url = &quot;https://download.pytorch.org/whl/rocm6.2&quot;

[tool.uv]
index-strategy = &quot;unsafe-best-match&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-18 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 15:28</div>
            <div class="timeline-body"><p>If you have more questions, it might help to read through https://docs.astral.sh/uv/configuration/indexes/ which goes through how we manage multiple indexes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bgs4free">@bgs4free</a> on 2025-01-18 20:55</div>
            <div class="timeline-body"><p>Ok, I think, I understand now. Thanks a lot.</p>
<p>So in my case, if I don't set it to <code>explicit</code>, I'd run into (in my case):</p>
<pre><code>hint: `requests` was found on https://download.pytorch.org/whl/rocm6.2, but not
      at the requested version (requests&gt;=2.32.2)
</code></pre>
<p>because it doesn't look for <code>requests</code> in the pypi index. That is to prevent dependency confusion attacks, because of the assumption, that a custom index is used internally by organizations, in which case I would definitely want that behavior. Correct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 23:17</div>
            <div class="timeline-body"><p>No problem. That's right. If you want to use pip-like behavior where it <em>does</em> check PyPI too, you'd add:</p>
<pre><code class="language-toml">[tool.uv]
index-strategy = &quot;unsafe-best-match&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/theepicflyer">@theepicflyer</a> on 2025-04-24 09:34</div>
            <div class="timeline-body"><p>Could the above be reflected in the uv guide on PyTorch? Similar to #11109</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:58 UTC
    </footer>
</body>
</html>
