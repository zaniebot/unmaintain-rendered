<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>unknown error (_ssl.c:3103) when using uv - astral-sh/uv #15327</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>unknown error (_ssl.c:3103) when using uv</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15327">#15327</a>
        opened by <a href="https://github.com/S4r4h-O">@S4r4h-O</a>
        on 2025-08-16 18:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/S4r4h-O">@S4r4h-O</a> on 2025-08-16 18:00</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi! I'm creating an app that needs to send emails, and this error occurs when I create the virtual environment with uv:</p>
<pre><code>Internal Server Error: /signup/
Traceback (most recent call last):
  File &quot;/home/sarah/Desktop/Python/myapp/.venv/lib/python3.10/site-packages/django/core/handlers/exception.py&quot;, line 55, in inner
    response = get_response(request)
  File &quot;/home/sarah/Desktop/Python/myapp/.venv/lib/python3.10/site-packages/django/core/
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
  File &quot;/home/sarah/Desktop/Python/myapp/.venv/lib/python3.10/site-packages/django/views
    return self.dispatch(request, *args, **kwargs)
  File &quot;/home/sarah/Desktop/Python/myapp/.venv/lib/python3.10/site-packages/django/views
    return handler(request, *args, **kwargs)
  File &quot;/home/sarah/Desktop/Python/myapp/.venv/lib/python3.10/site-packages/django/views
    return super().post(request, *args, **kwargs)
  File &quot;/home/sarah/Desktop/Python/myapp/.venv/lib/python3.10/site-packages/django/views/generic/edit.py&quot;, line 151, in post
    return self.form_valid(form)
  File &quot;/home/sarah/Desktop/Python/myapp/backend/src/userspace/views.py&quot;, line 58, in form_valid
    ssl_send_email(message, subject)
  File &quot;/home/sarah/Desktop/Python/myapp/backend/src/backend/emailing.py&quot;, line 34, in ssl_send_email
    with smtplib.SMTP_SSL(EMAIL_HOST, EMAIL_PORT) as server:
  File &quot;/home/sarah/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/smtplib.py&quot;, line 1047, in __init__
    context = ssl._create_stdlib_context(certfile=certfile,
  File &quot;/home/sarah/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/ssl.py&quot;, line 806, in _create_unverified_context
    context = SSLContext(protocol)
  File &quot;/home/sarah/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/ssl.py&quot;, line 496, in __new__
    self = _SSLContext.__new__(cls, protocol)
ssl.SSLError: unknown error (_ssl.c:3103)
</code></pre>
<p>However, the code is executed without issues in an environment without uv (python -m venv .venv, no uv installed in the system). I found someone else having the same issue <a href="https://github.com/pydantic/pydantic-ai/issues/1756#issuecomment-2911258724">here</a>. Let me know if you need more info.</p>
<h3>Platform</h3>
<p>Fedora 42 / Arch Linux</p>
<h3>Version</h3>
<p>0.7.13</p>
<h3>Python version</h3>
<p>3.12.11 / 3.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @S4r4h-O on 2025-08-16 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/S4r4h-O">@S4r4h-O</a> on 2025-08-16 21:44</div>
            <div class="timeline-body"><p>Yes, I'm inclined to think that this error is related to uv environment. Just tested with poetry and no issues.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckutlu">@ckutlu</a> on 2025-09-12 19:35</div>
            <div class="timeline-body"><p>I am having the same problem. I found out the following reproduces the issue:</p>
<p>mre.py</p>
<pre><code class="language-python">import urllib.request
from concurrent import futures

url = &quot;https://docs.python.org/3/objects.inv&quot;


def download() -&gt; bytes:
    req = urllib.request.Request(url)
    with urllib.request.urlopen(req) as resp:
        return resp.read()


# If uncommented, no failure.
# download()

# This fails
thread_pool = futures.ThreadPoolExecutor()
future = thread_pool.submit(download)
futures.wait([future], timeout=10)
print(future.result())
</code></pre>
<p>Running it with
<code>uvx --python 3.10.18 python mre.py</code></p>
<p>gives</p>
<details><summary>the traceback</summary>
<p>

<p>Traceback (most recent call last):
File &quot;/tmp/mre.py&quot;, line 20, in <module>
print(future.result())
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/concurrent/futures/_base.py&quot;, line 451, in result
return self.<strong>get_result()
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/concurrent/futures/_base.py&quot;, line 403, in __get_result
raise self._exception
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/concurrent/futures/thread.py&quot;, line 58, in run
result = self.fn(<em>self.args, **self.kwargs)
File &quot;/tmp/mre.py&quot;, line 9, in download
with urllib.request.urlopen(req) as resp:
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/urllib/request.py&quot;, line 216, in urlopen
return opener.open(url, data, timeout)
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/urllib/request.py&quot;, line 519, in open
response = self._open(req, data)
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/urllib/request.py&quot;, line 536, in _open
result = self._call_chain(self.handle_open, protocol, protocol +
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/urllib/request.py&quot;, line 496, in _call_chain
result = func(</em>args)
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/urllib/request.py&quot;, line 1391, in https_open
return self.do_open(http.client.HTTPSConnection, req,
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/urllib/request.py&quot;, line 1317, in do_open
h = http_class(host, timeout=req.timeout, **http_conn_args)
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/http/client.py&quot;, line 1422, in __init</strong>
context = ssl._create_default_https_context()
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/ssl.py&quot;, line 757, in create_default_context
context = SSLContext(PROTOCOL_TLS_CLIENT)
File &quot;/home/ckutlu/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/lib/python3.10/ssl.py&quot;, line 496, in <strong>new</strong>
self = _SSLContext.<strong>new</strong>(cls, protocol)
ssl.SSLError: unknown error (_ssl.c:3103)</p>
</p>
</details> 

<p>Both 3.11 and 3.12 fail similarly with slightly different tracebacks. 3.13 does not fail, i.e. <code>uvx --python 3.13 python mre.py</code> returns.</p>
<p><strong>Platform:</strong> Fedora 42
<strong>uv version:</strong> 0.8.17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zsol">@zsol</a> on 2025-09-13 09:26</div>
            <div class="timeline-body"><p>I'm unable to repro this on Ubuntu 24.04 x86_64:</p>
<pre><code>&gt; uv run --managed-python --python 3.10.18 -v repro.py
...
DEBUG Found `cpython-3.10.18-linux-x86_64-gnu` at `/home/zsol/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/bin/python3.10` (managed installations)
DEBUG Using Python 3.10.18 interpreter at: /home/zsol/.local/share/uv/python/cpython-3.10.18-linux-x86_64-gnu/bin/python3.10
...
DEBUG Command exited with code: 0
</code></pre>
<p>same story with 3.11 and 3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mkdocstrings/mkdocstrings/issues/796.html">mkdocstrings/mkdocstrings#796</a> on 2025-09-13 10:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckutlu">@ckutlu</a> on 2025-09-13 10:45</div>
            <div class="timeline-body"><p>@zsol Thanks for giving it a try! I had a feeling this had strong platform dependence as I don't remember running into this issue on my work laptop which happens to be Ubuntu 24.04 as well.</p>
<p>I noticed just by simply creating a default ssl context with <code>ssl.create_default_context</code> make the issue go away. I have little to no experience with urllib and ssl, so not sure what's happening there...</p>
<p>I ran into this issue on <code>mkdocstrings</code>, and made a hotfix PR there: https://github.com/mkdocstrings/mkdocstrings/pull/797</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-09-13 14:14</div>
            <div class="timeline-body"><p>I can reproduce this on a Fedora Docker container. Taking a look....</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @geofft by @geofft on 2025-09-13 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-09-13 14:48</div>
            <div class="timeline-body"><p>This seems specific to Fedora's /etc/openssl/openssl.cnf. In particular if I comment out the <code>config_diagnostics = 1</code> line or some other combinations of lines, it works fine.</p>
<p>I suspect this is related to openssl/openssl#23772 and the linked bugs, particularly given the mention that Fedora/RHEL &quot;heavily patch OpenSSL.&quot; There is also a Debian patch that seems related. We may need to pick up some of those patches. :(</p>
<p>There's also an argument that we should by default ignore the system's OpenSSL configuration given that we ship our own, but there's a pretty strong argument in the opposite direction that we should respect security config on the system, so I'm hesitant to do that. Regardless, until we figure out what to do here, a viable workaround to this bug is to manually ignore the system configuration, i.e.,</p>
<pre><code>OPENSSL_CONF=/dev/null uvx --python 3.10.18 python mre.py
</code></pre>
<p>works fine.</p>
<p>Given the relevance of threading and thread-safety, causing OpenSSL to initialize itself on the main thread before doing any threaded work also seems like a great workaround.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckutlu">@ckutlu</a> on 2025-09-15 10:33</div>
            <div class="timeline-body"><p>Thank you for investigating this @geofft. The <code>OPENSSL_CONF=/dev/null</code> is a nice workaround for my local use as I was running into this bug while calling <code>mkdocs</code>. I can just set the env var before running it. We also just merged the quickfix for the <code>mkdocstrings</code> library, so at least it won't be seen there.</p>
<p>I think I understand the issue a little better now and it looks like there's not much <code>uv</code> can do here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/S4r4h-O">@S4r4h-O</a> on 2025-09-15 16:28</div>
            <div class="timeline-body"><blockquote>
<p>This seems specific to Fedora's /etc/openssl/openssl.cnf. In particular if I comment out the <code>config_diagnostics = 1</code> line or some other combinations of lines, it works fine.</p>
</blockquote>
<p>I also tested on Arch and had the same results. Will try to reproduce again when I have more free time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-09-15 17:27</div>
            <div class="timeline-body"><p>I meant to say, I am guessing Arch has a similar /etc/openssl/openssl.cnf file e.g. with <code>config_diagnostics = 1</code> or something, but I haven't gotten a chance to look. If so, the same workarounds should hopefully work. (But that's a good reminder, Arch may have fewer patches so I should look at what they have.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheScreechingBagel">@TheScreechingBagel</a> on 2025-11-16 01:57</div>
            <div class="timeline-body"><p>I am having what seems to be the same issue, but what's a bit odd is I am able to replicate it with the following:</p>
<p>(Fedora 42, aarch64, uv 0.9.9)</p>
<p>minrep.py</p>
<pre><code class="language-py">import ssl

_ = ssl.create_default_context()
</code></pre>
<p><code>uvx --python 3.11.14 python minrep.py</code> fails:</p>
<details>
<summary>Traceback</summary>
```
Traceback (most recent call last):
  File "/home/bagel/Desktop/repro/minrep.py", line 3, in <module>
    _ = ssl.create_default_context()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/bagel/.local/share/uv/python/cpython-3.11.14-linux-aarch64-gnu/lib/python3.11/ssl.py", line 761, in create_default_context
    context = SSLContext(PROTOCOL_TLS_CLIENT)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/bagel/.local/share/uv/python/cpython-3.11.14-linux-aarch64-gnu/lib/python3.11/ssl.py", line 500, in __new__
    self = _SSLContext.__new__(cls, protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ssl.SSLError: [CONF: MODULE_INITIALIZATION_ERROR] module initialization error (_ssl.c:3108)
```
</details>

<p><code>uvx --python 3.13.9 python minrep.py</code> does not fail
<code>OPENSSL_CONF=/dev/null uvx --python 3.11.14 python minrep.py</code> does not fail</p>
<p>which I copied from the hotfix @ckutlu did in https://github.com/mkdocstrings/mkdocstrings/pull/797</p>
<p>P.S.
I encountered the issue while trying to use the IMAPClient library, noticing that the same issue did not occur with raw imaplib as long as I used <code>.starttls()</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16703.html">astral-sh/uv#16703</a> on 2025-11-18 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-11-18 16:23</div>
            <div class="timeline-body"><blockquote>
<p><code>uvx --python 3.13.9 python minrep.py</code> does not fail</p>
</blockquote>
<p>Fedora has Python 3.13.9 as the system Python, so I'm assuming uv is finding that one and not installing our own builds. I expect <code>uvx --managed-python --python 3.13.9 python minrep.py</code> would fail on your machine.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:11 UTC
    </footer>
</body>
</html>
