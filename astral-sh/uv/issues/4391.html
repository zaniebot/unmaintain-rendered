<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install something.whl` does not install the new version - astral-sh/uv #4391</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv pip install something.whl` does not install the new version</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/4391">#4391</a>
        opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a>
        on 2024-06-18 17:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-06-18 17:40</div>
            <div class="timeline-body"><p>When installing from a local wheel file, a newer (or generally different, since it should not matter if it's newer or older) version does not get installed since uv thinks it's already there.</p>
<p>Here are two simple wheels (just containing a package with an empty <code>__init__.py</code>) to reproduce it:</p>
<ul>
<li><a href="https://github.com/user-attachments/files/15890401/mypkg-3.3.3-py3-none-any.whl.zip">mypkg-3.3.3-py3-none-any.whl.zip</a></li>
<li><a href="https://github.com/user-attachments/files/15890402/mypkg-3.3.4-py3-none-any.whl.zip">mypkg-3.3.4-py3-none-any.whl.zip</a></li>
</ul>
<pre><code>[adrian@claptrap:/tmp/uv-bug-test/test]&gt; uv version
uv 0.2.13

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; ll ../*/dist/*.whl
-rw-r--r-- 1 adrian users 1066 Jun 18 19:34 ../v1/dist/mypkg-3.3.3-py3-none-any.whl
-rw-r--r-- 1 adrian users 1071 Jun 18 19:34 ../v2/dist/mypkg-3.3.4-py3-none-any.whl

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; uv venv
Using Python 3.12.3 interpreter at: /home/adrian/.pyenv/versions/3.12.3/bin/python3
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; source .venv/bin/activate

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; uv pip install --no-cache ../v1/dist/*.whl
Resolved 1 package in 1ms
Downloaded 1 package in 0.62ms
Installed 1 package in 0.28ms
 + mypkg==3.3.3 (from file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl)

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; uv pip install --no-cache ../v2/dist/*.whl
Resolved 1 package in 1ms
Audited 1 package in 0.04ms

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; uv pip freeze
mypkg @ file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl
</code></pre>
<p>Verbose <code>uv pip install</code> output:</p>
<details>

<pre><code>[adrian@claptrap:/tmp/uv-bug-test/test]&gt; uv pip install --no-cache --verbose ../v1/dist/*.whl
DEBUG uv 0.2.13
DEBUG Searching for Python interpreter in virtual environments
DEBUG Found cpython 3.12.3 at `/tmp/uv-bug-test/test/.venv/bin/python3` (active virtual environment)
DEBUG Using Python 3.12.3 environment at .venv/bin/python3
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.3
DEBUG Adding direct dependency: mypkg*
DEBUG Searching for a compatible version of mypkg @ file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl (*)
DEBUG Tried 1 versions: mypkg 1
Resolved 1 package in 1ms
DEBUG Identified uncached requirement: mypkg @ file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl
Downloaded 1 package in 0.63ms
Installed 1 package in 0.22ms
 + mypkg==3.3.3 (from file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl)

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; uv pip install --no-cache --verbose ../v2/dist/*.whl
DEBUG uv 0.2.13
DEBUG Searching for Python interpreter in virtual environments
DEBUG Found cpython 3.12.3 at `/tmp/uv-bug-test/test/.venv/bin/python3` (active virtual environment)
DEBUG Using Python 3.12.3 environment at .venv/bin/python3
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: file:///tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.3
DEBUG Adding direct dependency: mypkg*
DEBUG Searching for a compatible version of mypkg @ file:///tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl (*)
DEBUG Tried 1 versions: mypkg 1
Resolved 1 package in 1ms
DEBUG Requirement already installed: mypkg==3.3.3 (from file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl)
Audited 1 package in 0.03ms
</code></pre>
</details>

<hr />
<p>I don't think it's relevant, but in my real application the newer wheel also contained an updated dependency and that got installed, but the updated package itself from that wheel didn't.</p>
<details>

<pre><code>[indico@indico-sandbox:~]&gt; indico --version
Indico v3.3.3-dev+202406171640.3e1360a9ad

[indico@indico-sandbox:~]&gt; uv pip install wheels/*.whl
Resolved 138 packages in 221ms
Downloaded 1 package in 31ms
Uninstalled 1 package in 2ms
Installed 1 package in 1ms
 - urllib3==1.26.18
 + urllib3==1.26.19

[indico@indico-sandbox:~]&gt; ll wheels/*.whl
-rw-r--r--. 1 indico indico 38328151 Jun 18 16:54 wheels/indico-3.3.3.dev0+202406181653.57d770a2a9-py3-none-any.whl

[indico@indico-sandbox:~]&gt; pip freeze | grep 'indico '
indico @ file:///opt/indico/wheels/indico-3.3.3.dev0%2B202406171640.3e1360a9ad-py3-none-any.whl#sha256=8c7fe138d56f54bb6906f2bdc8de4a929c2a91709b375a801572486b34b1ab80
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv pip install something.whl` does not install newer version" to "`uv pip install something.whl` does not install the new version" by @ThiefMaster on 2024-06-18 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-06-18 17:44</div>
            <div class="timeline-body"><p>Also unrelated, but &quot;Downloaded 1 package in 0.62ms&quot; is misleading since there is no download in case of a local wheel file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-18 17:50</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/uv/issues/4011 for the download / build time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-06-18 17:52</div>
            <div class="timeline-body"><pre><code>[adrian@claptrap:/tmp/uv-bug-test/test]&gt; RUST_LOG=uv=trace uv pip install --no-cache --verbose ../v1/dist/*.whl
DEBUG uv 0.2.13
DEBUG Searching for Python interpreter in virtual environments
TRACE Querying interpreter executable at /tmp/uv-bug-test/test/.venv/bin/python3
DEBUG Found cpython 3.12.3 at `/tmp/uv-bug-test/test/.venv/bin/python3` (active virtual environment)
DEBUG Using Python 3.12.3 environment at .venv/bin/python3
TRACE Checking lock for `.venv`
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl
DEBUG Using request timeout of 30s
TRACE Performing lookahead for mypkg @ file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl
DEBUG Solving with installed Python version: 3.12.3
DEBUG Adding direct dependency: mypkg*
DEBUG Searching for a compatible version of mypkg @ file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl (*)
DEBUG Tried 1 versions: mypkg 1
Resolved 1 package in 1ms
DEBUG Identified uncached requirement: mypkg @ file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl
Downloaded 1 package in 0.60ms
Installed 1 package in 0.26ms
 + mypkg==3.3.3 (from file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl)

[adrian@claptrap:/tmp/uv-bug-test/test]&gt; RUST_LOG=uv=trace uv pip install --no-cache --verbose ../v2/dist/*.whl
DEBUG uv 0.2.13
DEBUG Searching for Python interpreter in virtual environments
TRACE Querying interpreter executable at /tmp/uv-bug-test/test/.venv/bin/python3
DEBUG Found cpython 3.12.3 at `/tmp/uv-bug-test/test/.venv/bin/python3` (active virtual environment)
DEBUG Using Python 3.12.3 environment at .venv/bin/python3
TRACE Checking lock for `.venv`
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: file:///tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl
DEBUG Using request timeout of 30s
TRACE Performing lookahead for mypkg @ file:///tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl
DEBUG Solving with installed Python version: 3.12.3
DEBUG Adding direct dependency: mypkg*
DEBUG Searching for a compatible version of mypkg @ file:///tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl (*)
DEBUG Tried 1 versions: mypkg 1
Resolved 1 package in 1ms
TRACE Comparing installed with source: Url(InstalledDirectUrlDist { name: PackageName(&quot;mypkg&quot;), version: &quot;3.3.3&quot;, direct_url: ArchiveUrl { url: &quot;file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl&quot;, archive_info: ArchiveInfo { hash: None, hashes: None }, subdirectory: None }, url: Url { scheme: &quot;file&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: None, port: None, path: &quot;/tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl&quot;, query: None, fragment: None }, editable: false, path: &quot;/tmp/uv-bug-test/test/.venv/lib/python3.12/site-packages/mypkg-3.3.3.dist-info&quot; }) Path { install_path: &quot;/tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl&quot;, lock_path: &quot;/tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl&quot;, url: VerbatimUrl { url: Url { scheme: &quot;file&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: None, port: None, path: &quot;/tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl&quot;, query: None, fragment: None }, given: Some(&quot;../v2/dist/mypkg-3.3.4-py3-none-any.whl&quot;) } }
TRACE Path mismatch: &quot;/tmp/uv-bug-test/v2/dist/mypkg-3.3.4-py3-none-any.whl&quot; vs. &quot;/tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl&quot;
DEBUG Requirement already installed: mypkg==3.3.3 (from file:///tmp/uv-bug-test/v1/dist/mypkg-3.3.3-py3-none-any.whl)
Audited 1 package in 0.07ms
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-18 17:54</div>
            <div class="timeline-body"><p>Uh interesting so at https://github.com/astral-sh/uv/blob/d8f1de61347b5dc18bfde977dc1b3c34f8a3de01/crates/uv-installer/src/satisfies.rs#L176-L185 we're detecting that these are &quot;different&quot; but we're treating that as satisfied.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-18 17:56</div>
            <div class="timeline-body"><p>cc @konstin / @charliermarsh looks like this was last touched in https://github.com/astral-sh/uv/pull/3864?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4393.html">astral-sh/uv#4393</a> on 2024-06-18 18:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-06-18 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-18 18:07</div>
            <div class="timeline-body"><p>This looks wrong. I resolved your MRE with https://github.com/astral-sh/uv/pull/4393 â€” we'll see if there's something else that was relying on this weird behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4396.html">astral-sh/uv#4396</a> on 2024-06-18 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-06-19 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-06-19 14:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:58 UTC
    </footer>
</body>
</html>
