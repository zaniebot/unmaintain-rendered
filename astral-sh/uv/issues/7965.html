<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order of entries in pyproject.toml [dependencies] defines what versions get installed.  - astral-sh/uv #7965</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Order of entries in pyproject.toml [dependencies] defines what versions get installed. </h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7965">#7965</a>
        opened by <a href="https://github.com/MatteoLacki">@MatteoLacki</a>
        on 2024-10-07 11:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MatteoLacki">@MatteoLacki</a> on 2024-10-07 11:16</div>
            <div class="timeline-body"><p>Hi,</p>
<p>I have a funny problem here, might be an application issue of course.
I run your code inside 2 independent docker containers with one common Dockerfile:</p>
<pre><code>## common Dockerfile

# Base image
FROM ubuntu:22.04

# Set up some basic utilities (example customization)
RUN apt-get update &amp;&amp; apt-get install -y curl

# Set a label (or anything to differentiate the images)
LABEL description=&quot;Ubuntu 22.04 based image 1&quot;

# Default command
CMD [&quot;bash&quot;]
</code></pre>
<p>After setting up both images, in the first one I run this:</p>
<pre><code>
cd /root
curl -LsSf https://astral.sh/uv/install.sh | sh
/root/.cargo/bin/uv --version
/root/.cargo/bin/uv venv ve_test
. ./ve_test/bin/activate
apt install git -y
git clone https://github.com/midiaIDorg/pandas_ops
cd pandas_ops
git checkout uv_problem
/root/.cargo/bin/uv pip install -e .
</code></pre>
<p>and in the second one this:</p>
<pre><code>cd /root
curl -LsSf https://astral.sh/uv/install.sh | sh
/root/.cargo/bin/uv --version
/root/.cargo/bin/uv venv ve_test
. ./ve_test/bin/activate
apt install git -y
git clone https://github.com/midiaIDorg/pandas_ops
cd pandas_ops
git checkout uv_problem_not_working
/root/.cargo/bin/uv pip install -e .
</code></pre>
<p>the only difference between the two pandas_ops branches (that's a simply repo of mine) is the order of the dependencies:
in the first container it is:</p>
<pre><code>dependencies = [
    &quot;numba&quot;,
    &quot;numpy&quot;,
    &quot;pandas&quot;,
    &quot;tqdm&quot;,
    &quot;duckdb&quot;,
]
</code></pre>
<p>and this works. on the second one, it is:</p>
<pre><code>dependencies = [
    &quot;numpy&quot;,
    &quot;numba&quot;,
    &quot;pandas&quot;,
    &quot;tqdm&quot;,
    &quot;duckdb&quot;,
]
</code></pre>
<p>and this fails. <code>numba</code> has a specific lower version of <code>numpy</code> as a dependency.
I cannot put the versions above for it would miss the point. Of course, the problem might disappear later on when numba devs catch up with numpy. But as such, it seems to be and issue with <code>uv</code> that putting a dependency of another dependency creates confusion.</p>
<p>In the first container I get:</p>
<pre><code>Resolved 11 packages in 296ms
   Built pandas-ops @ file:///root/pandas_ops
Prepared 11 packages in 15.21s
Installed 11 packages in 88ms
 + duckdb==1.1.1
 + llvmlite==0.43.0
 + numba==0.60.0
 + numpy==2.0.2
 + pandas==2.2.3
 + pandas-ops==0.0.2 (from file:///root/pandas_ops)
 + python-dateutil==2.9.0.post0
 + pytz==2024.2
 + six==1.16.0
 + tqdm==4.66.5
 + tzdata==2024.2
</code></pre>
<p>on the second one:</p>
<pre><code>error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: numba==0.53.1
  Caused by: Build backend failed to determine requirements with `build_wheel()` (exit status: 1)
--- stdout:

--- stderr:
/root/.cache/uv/sdists-v4/pypi/numba/0.53.1/yVZrZDqwUxw8GhzvANsQo/numba-0.53.1.tar.gz/versioneer.py:335: SyntaxWarning: invalid escape sequence '\s'
  LONG_VERSION_PY['git'] = '''
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/root/.cache/uv/builds-v0/.tmpfMTGFT/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 332, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=[])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/root/.cache/uv/builds-v0/.tmpfMTGFT/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 302, in _get_build_requires
    self.run_setup()
  File &quot;/root/.cache/uv/builds-v0/.tmpfMTGFT/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 503, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/root/.cache/uv/builds-v0/.tmpfMTGFT/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 318, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 50, in &lt;module&gt;
  File &quot;&lt;string&gt;&quot;, line 47, in _guard_py_ver
RuntimeError: Cannot install on Python version 3.12.6; only versions &gt;=3.6,&lt;3.10 are supported.
---
</code></pre>
<p>both are using:</p>
<pre><code>(ve_test) root@e626094d7176:~/pandas_ops# /root/.cargo/bin/uv --version
uv 0.4.18
</code></pre>
<p>Best wishes,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-08 22:44</div>
            <div class="timeline-body"><p>There's more on the general topic here: https://github.com/astral-sh/uv/issues/5161. We do rely on the order to aid in prioritization.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-08 22:45</div>
            <div class="timeline-body"><p>The Numba / NumPy thing is a common issue. If you put NumPy first, then we prioritize solving for the last version of NumPy, which leads us to backtrack to a version of Numba that does <em>not</em> include a strict upper-bound. I'd suggest adding constraints to your version specifiers if you want to ensure that uv lands on a certain solve!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-08 22:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-10-08 22:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-10-08 22:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-08 22:46</div>
            <div class="timeline-body"><p>Similar issues here https://github.com/astral-sh/uv/issues/7881 and here https://github.com/astral-sh/uv/issues/6281#issuecomment-2316240724 RE Numba.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatteoLacki">@MatteoLacki</a> on 2024-10-09 08:34</div>
            <div class="timeline-body"><p>Hi,</p>
<p>please unclose this bug report or modify the documentation.
You do write there, I quote:</p>
<p><img src="https://github.com/user-attachments/assets/6ea6468e-cf86-4bc6-ba30-9a568a53c0ec" alt="image" /></p>
<p>However, order of dependencies does not matter for pip.
If there are $n$ dependencies, there are now $n!$ possible permutations that you leave on user to check, which is likely breaking up the speed gains :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatteoLacki">@MatteoLacki</a> on 2024-10-09 08:35</div>
            <div class="timeline-body"><p>I do really really like this project, don't think I don't. It's just not working here as advertised and I hope this can be fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-09 08:39</div>
            <div class="timeline-body"><p>There are always going to be minor differences between pip and uv, and we cover them in the docs. In particular, there's a section on package priority <a href="https://docs.astral.sh/uv/pip/compatibility/#package-priority">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatteoLacki">@MatteoLacki</a> on 2024-10-09 08:49</div>
            <div class="timeline-body"><p>Hi,</p>
<p>at least on their documentation, pip people write that dependencies are topologically sorted.
In particular that means, that user order should be neglected.</p>
<p>Have a look here:
https://pip.pypa.io/en/stable/cli/pip_install/</p>
<p><img src="https://github.com/user-attachments/assets/d6303191-e45c-42d5-aff2-07f33c762422" alt="image" /></p>
<p>Maybe that could provide some solution to the problem?</p>
<p>Again, I am only trying not to make user check all of n! possibilities: think how much electricity that will save ;)</p>
<p>Best wishes,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatteoLacki">@MatteoLacki</a> on 2024-10-09 08:51</div>
            <div class="timeline-body"><p>In particular, I indeed do get the same dependencies installed with pip independent of the order in the example I posted above (numpy + numba thingie).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatteoLacki">@MatteoLacki</a> on 2024-10-09 09:20</div>
            <div class="timeline-body"><p>I also do get it that you have tons of work on your plate, and that this is not a game-breaker as such, but in the context I would still consider this being a bug, albeit one that can be handled later on...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tilde-research/activault/issues/2.html">tilde-research/activault#2</a> on 2025-06-02 19:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:22 UTC
    </footer>
</body>
</html>
