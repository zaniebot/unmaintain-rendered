<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global config file ignored on Windows - astral-sh/uv #9416</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Global config file ignored on Windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9416">#9416</a>
        opened by <a href="https://github.com/markuspi">@markuspi</a>
        on 2024-11-25 13:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/markuspi">@markuspi</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>UV does not read the configuration file in <code>%SYSTEMDRIVE%\ProgramData\uv\uv.toml</code> unless the working directory happens to be <code>%SYSTEMDRIVE%\</code>.</p>
<h3>Root Cause</h3>
<ul>
<li><p>The <code>SYSTEMDRIVE</code> environment variable consists only of a drive letter followed by a colon. There is no trailing backslash. E.g. <code>C:</code> <code>D:</code></p>
</li>
<li><p>The final path is assembled by UV as follows:</p>
<pre><code class="language-rust">let candidate = PathBuf::from(system_drive).join(&quot;ProgramData\\uv\\uv.toml&quot;);
</code></pre>
</li>
<li><p><code>candidate</code> now contains a path like this: <code>C:ProgramData\uv\uv.toml</code></p>
</li>
<li><p>Since there is no backslash between <code>C:</code> and <code>ProgramData</code>, this path is <a href="https://learn.microsoft.com/en-us/dotnet/standard/io/file-path-formats">specified</a> to be</p>
<blockquote>
<p>A <em>relative</em> path from the current directory of the C: drive.</p>
</blockquote>
<p>rather than an absolute path. UV thus only recognizes the config file if the CWD is the root of the system drive.</p>
</li>
<li><p>Inserting the missing backslash resolves the problem</p>
</li>
</ul>
<h3>Steps to reproduce:</h3>
<ol>
<li>Create file <code>%SYSTEMDRIVE%\ProgramData\uv\uv.toml</code>. For demonstration purposes, insert an invalid option</li>
</ol>
<pre><code class="language-toml">doesnotexist = true
</code></pre>
<ol start="2">
<li>Run UV from the drive root to observe parse error (as expected)</li>
</ol>
<pre><code class="language-cmd">cd %SYSTEMDRIVE%\
uv cache prune
</code></pre>
<p><code>error: Failed to parse: C:ProgramData\uv\uv.toml</code></p>
<ol start="3">
<li>Run UV from any other directory on the same drive. Observe that no parse error was thrown since the global config file was not loaded at all (bug)</li>
</ol>
<pre><code class="language-cmd">cd %SYSTEMDRIVE%\Users
uv cache prune
</code></pre>
<p><code>Pruning cache at ...</code></p>
<h3>Note</h3>
<p>Be aware that windows keeps track of working directories <em>per system drive</em>. Changing to another drive such as <code>D:/foo</code> might not reproduce the bug</p>
<h3>Version Information</h3>
<ul>
<li>UV version 0.5.4</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-11-25 23:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @zanieb on 2024-11-25 23:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-25 23:16</div>
            <div class="timeline-body"><p>Are you sure &quot;candidate now contains a path like this: C:ProgramData\uv\uv.toml&quot; is true? <code>.join</code> should use the system separator to join the paths?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-25 23:18</div>
            <div class="timeline-body"><p>It looks like this is intentionally omitted, interesting</p>
<p>https://doc.rust-lang.org/src/std/path.rs.html#1288-1289</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markuspi">@markuspi</a> on 2024-11-26 08:32</div>
            <div class="timeline-body"><p>Yeah Windows Paths are quite a mess ðŸ˜…
At least Rust's behavior of <code>.join</code> is in line with Python and Java implementations</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-11-28 00:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-28 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-28 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markuspi">@markuspi</a> on 2024-11-28 16:45</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:33 UTC
    </footer>
</body>
</html>
