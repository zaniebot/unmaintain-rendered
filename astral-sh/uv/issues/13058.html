<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv installation of deepspeed breaks after 0.6.14 - astral-sh/uv #13058</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv installation of deepspeed breaks after 0.6.14</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/13058">#13058</a>
        opened by <a href="https://github.com/mritterfigma">@mritterfigma</a>
        on 2025-04-22 17:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mritterfigma">@mritterfigma</a> on 2025-04-22 17:48</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have a project that installs <code>deepspeed==0.16.5</code>. This was working without issue, but it broke in the latest versions of uv (released within the last 24h). Pinning my uv to <code>0.6.14</code> fixes the issue.</p>
<p>I found error text like:</p>
<pre><code>12.38    Building deepspeed==0.16.5
12.43  Downloaded llguidance
12.62  Downloaded gradio
12.74  Downloaded scikit-image
13.43  Downloaded numpy
13.54  Downloaded duckdb
13.78  Downloaded wandb
14.19  Downloaded gensim
14.43  Downloaded mlflow
15.24  Downloaded scipy
15.57  Downloaded pyarrow
16.27  Downloaded opencv-python
16.39  Downloaded onnx
16.75  Downloaded bitsandbytes
17.08  Downloaded cupy-cuda12x
17.11  Downloaded ray
18.00  Downloaded plotly
18.10   × Failed to build `deepspeed==0.16.5`
18.10   ├─▶ The build backend returned an error
18.11   ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit
18.11       status: 1)
18.11 
18.11       [stdout]
18.11       [2025-04-22 17:17:57,063] [WARNING]
18.11       [real_accelerator.py:194:get_accelerator] Setting accelerator to CPU. If
18.11       you have GPU or other accelerator, we were unable to detect it.
18.11       [2025-04-22 17:17:57,075] [INFO]
18.11       [real_accelerator.py:239:get_accelerator] Setting ds_accelerator to cpu
18.11       (auto detect)
18.11       [2025-04-22 17:17:57,240] [WARNING]
18.11       [real_accelerator.py:194:get_accelerator] Setting accelerator to CPU. If
18.11       you have GPU or other accelerator, we were unable to detect it.
18.11       [2025-04-22 17:17:57,242] [INFO]
18.11       [real_accelerator.py:239:get_accelerator] Setting ds_accelerator to cpu
18.11       (auto detect)
18.11       [WARNING] Torch did not find cuda available, if cross-compiling or
18.11       running with cpu only you can ignore this message. Adding compute
18.11       capability for Pascal, Volta, and Turing (compute capabilities 6.0,
18.11       6.1, 6.2)
</code></pre>
<p>Not sure about root cause, seems to be some weird interaction between latest uv and cuda (can't find the accelerator)</p>
<h3>Platform</h3>
<p>Ubuntu 22.04</p>
<h3>Version</h3>
<p>0.6.15</p>
<h3>Python version</h3>
<p>3.11.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mritterfigma on 2025-04-22 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-22 18:34</div>
            <div class="timeline-body"><p>I'm struggling to see anything in the release that could've affected this. Where are you performing your build? Are you certain that you're not (e.g.) getting a cached build when you revert back to 0.6.14?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mritterfigma">@mritterfigma</a> on 2025-04-22 19:34</div>
            <div class="timeline-body"><p>I'm performing my build in Docker, basing off of a base image from AWS Sagemaker (https://github.com/aws/deep-learning-containers/blob/master/available_images.md#available-deep-learning-containers-images). I don't think <code>uv</code> is a red herring masking some caching problem, I think the problem is actually with <code>uv</code>, but I'm not sure how to prove that. Here is a test Dockerfile, you can toggle between uv versions and observe <code>docker build</code> succeed and then fail. Note per the link that you have to do a login to pull the base image. Not sure if the issue would repro with a different base image.</p>
<pre><code>FROM 763104351884.dkr.ecr.us-west-2.amazonaws.com/pytorch-training:2.6.0-gpu-py312-cu126-ubuntu22.04-sagemaker@sha256:5e85beba891d763fae73069cb7189feac0b1d458148ae9bcfed93deee7576cf8

# ADD https://astral.sh/uv/install.sh /uv-installer.sh &lt;--- FAILURE
ADD https://astral.sh/uv/0.6.14/install.sh /uv-installer.sh
RUN sh /uv-installer.sh &amp;&amp; rm /uv-installer.sh
ENV PATH=&quot;/root/.local/bin/:$PATH&quot;

RUN uv venv --python 3.11 /venv
ENV PATH=&quot;/venv/bin:$PATH&quot;

RUN uv pip install pip setuptools==79.0.0 wheel==0.45.1 psutil==7.0.0 --no-cache
RUN uv pip install torch==2.6.0 --no-build-isolation --no-cache
RUN DS_BUILD_CPU_ADAM=1 uv pip install --no-build-isolation --index-strategy unsafe-best-match deepspeed==0.16.5 --no-cache

</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
