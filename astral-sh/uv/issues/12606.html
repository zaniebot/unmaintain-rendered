<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add dedicated error message for conda environment.yml files - astral-sh/uv #12606</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add dedicated error message for conda environment.yml files</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12606">#12606</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-04-01 20:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-01 20:22</div>
            <div class="timeline-body"><p>If used via <code>-r</code>, we should say we don't support these?</p>
<p>See https://github.com/astral-sh/uv/issues/12596</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2025-04-01 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2025-04-01 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-01 20:23</div>
            <div class="timeline-body"><p>I'm not quite sure how we'd detect this, but we could start with an exact name match special case on parse error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/christeefy">@christeefy</a> on 2025-04-02 00:52</div>
            <div class="timeline-body"><p>I can give this a shot, @zanieb.</p>
<p>To confirm, is it correct to say that:</p>
<ul>
<li>the changes will happen somewhere within <code>src/lib.rs::run</code> of the <code>uv</code> crate?</li>
<li>on parse error, raise a dedicated error message if the filename matches <code>environment.yml</code>?</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-02 01:12</div>
            <div class="timeline-body"><p>I don't think it'd be in <code>lib.rs::run</code>, I think there we just parse a <code>PathBuf</code> into a <code>RequirementsSource</code>.  It'd be downstream where we are actually reading the requirements files?</p>
<p>I suggested special-casing the parse error because it's the &quot;safest&quot; option, we only fail if we were going to fail anyway. However, it's possible it'd be better to skip that and instead add a <code>RequirementsSource</code> variant <code>EnvironmentYml</code> which we construct when the path matches <code>environment.yml</code>. We'd then error on later, e.g., in <code>RequirementsSpecification::from_source</code>? I'm not sure without trying though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/christeefy">@christeefy</a> on 2025-04-02 12:42</div>
            <div class="timeline-body"><p>Got it! I assumed that <code>RequirementsSource.from_requirements_file</code> would be fallible, but I see now that validation is deferred until <code>RequirementsSpecification::from_source</code>, as you pointed out.</p>
<p>I'll try to implement a fix based on your suggestions, and may circle back here if I need extra clarification.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12669.html">astral-sh/uv#12669</a> on 2025-04-04 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-07 23:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-07 23:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:03 UTC
    </footer>
</body>
</html>
