<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv build --wheel doesn't seem to be installing dev-dependencies - astral-sh/uv #7154</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv build --wheel doesn't seem to be installing dev-dependencies</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7154">#7154</a>
        opened by <a href="https://github.com/alex">@alex</a>
        on 2024-09-07 03:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alex">@alex</a> on 2024-09-07 03:19</div>
            <div class="timeline-body"><p>https://github.com/pyca/cryptography/pull/11558 shows trying to take advantage of <code>uv build</code>, however CI doesn't seem happy: https://github.com/pyca/cryptography/actions/runs/10748158349/job/29811544879?pr=11558</p>
<p>Notably, when running <code>uv build -v --wheel --require-hashes --build-constraint=$BUILD_REQUIREMENTS_PATH cryptography*.tar.gz $PY_LIMITED_API -o wheelhouse/</code>:</p>
<pre><code>DEBUG uv 0.4.7
DEBUG Searching for Python interpreter in managed installations, system path, or `py` launcher
DEBUG Searching for managed installations at `C:\Users\runneradmin\AppData\Roaming\uv\python`
DEBUG Found `cpython-3.11.9-windows-x86_64-none` at `C:\hostedtoolcache\windows\Python\3.11.9\x64\python3.exe` (search path)
DEBUG Using request timeout of 30s
Building wheel from source distribution...
DEBUG Calling `maturin.build_wheel(&quot;D:\\a\\cryptography\\cryptography\\wheelhouse\\.tmpNob9dO&quot;, {&quot;build-args&quot;:&quot;--features=pyo3/abi3-py39&quot;}, None)`
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
ModuleNotFoundError: No module named 'maturin'
error: Build backend failed to build wheel through `build_wheel()` with exit code: 1
</code></pre>
<p>For whatever reason, <code>uv</code> doesn't seem to actually install <code>maturin</code>.</p>
<p>When running this same command locally (on macOS), I see output like the following:</p>
<pre><code>(cryptography) ~/p/cryptography ❯❯❯ uv build -v --wheel --require-hashes --build-constraint=.github/requirements/build-requirements.txt dist/cryptography-44.0.0.dev1.tar.gz -o wheelhouse
DEBUG uv 0.4.6 (Homebrew 2024-09-05)
DEBUG Found workspace root: `/Users/alex_gaynor/projects/cryptography`
DEBUG Adding current workspace member: `/Users/alex_gaynor/projects/cryptography`
DEBUG Searching for Python &gt;=3.7 in managed installations or system path
DEBUG Found `cpython-3.12.5-macos-aarch64-none` at `/Users/alex_gaynor/.virtualenvs/cryptography/bin/python3` (active virtual environment)
DEBUG Using request timeout of 30s
Building wheel from source distribution...
DEBUG Ignoring empty directory
DEBUG Solving with installed Python version: 3.12.5
DEBUG Solving with target Python version: &gt;=3.12.5
DEBUG Adding direct dependency: maturin&gt;=1, &lt;2
DEBUG Adding direct dependency: maturin==1.7.1
DEBUG Adding direct dependency: cffi{platform_python_implementation != 'PyPy'}&gt;=1.12
DEBUG Adding direct dependency: cffi{platform_python_implementation != 'PyPy'}==1.17.1
DEBUG Adding direct dependency: setuptools&lt;74.0.0 | &gt;74.0.0, &lt;74.1.0 | &gt;74.1.0, &lt;74.1.1 | &gt;74.1.1, &lt;74.1.2 | &gt;74.1.2
DEBUG Adding direct dependency: setuptools==73.0.1
[...]
</code></pre>
<p>Happy to test anything that'd be useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-09-07 11:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:04</div>
            <div class="timeline-body"><p>Very strange, let me think about what could be happening here...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:05</div>
            <div class="timeline-body"><p>Do you have <code>--no-build-isolation</code> set anywhere, like in a <code>pyproject.toml</code> somewhere? (You could run <code>uv build --show-settings</code> to verify.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:17</div>
            <div class="timeline-body"><p>(Poking around here: https://github.com/charliermarsh/cryptography/pull/1)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:21</div>
            <div class="timeline-body"><p>(Confirmed build isolation is <em>not</em> disabled.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2024-09-07 12:50</div>
            <div class="timeline-body"><p>Definitely not intentionally disabled! Thanks for taking a look, let me know how I can help debug this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:51</div>
            <div class="timeline-body"><p>It looks like the builder <em>thinks</em> build isolation is enabled (despite <code>--show-settings</code> not indicating as such) so something's going wrong...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2024-09-07 12:52</div>
            <div class="timeline-body"><p>AHHHHH, <code>--no-build-isolation</code> is in the <code>PY_LIMITED_API</code> variable. I assume that's causing this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2024-09-07 12:55</div>
            <div class="timeline-body"><p>And with that removed, it seems to be working now.</p>
<p>So sorry about the noise.</p>
<p>I think turning some of the debug logging you added into proper logging may help future people who are as dumb as I am.</p>
<p>Once again, very sorry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:57</div>
            <div class="timeline-body"><p>No problem at all! Glad it's not a bug at least. Though confused why <code>--show-settings</code> didn't make this clear... Maybe a bug <em>there</em>? I'll add some more logging for this regardless (and close this issue with that PR).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 13:02</div>
            <div class="timeline-body"><p>Oh sorry... Dumb of me. I'm running <code>--show-settings</code> in the first command which doesn't have the env var attached. I will add more logging though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7169.html">astral-sh/uv#7169</a> on 2024-09-07 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-07 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-07 14:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
