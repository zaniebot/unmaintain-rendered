<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Does `uv` use all extras/groups matching `dependencies_*` by default - astral-sh/uv #16118</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Does `uv` use all extras/groups matching `dependencies_*` by default</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/16118">#16118</a>
        opened by <a href="https://github.com/yarnabrina">@yarnabrina</a>
        on 2025-10-03 19:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/yarnabrina">@yarnabrina</a> on 2025-10-03 19:37</div>
            <div class="timeline-body"><h3>Question</h3>
<p>We are discussing internally to migrate to <code>uv </code>in <a href="https://github.com/sktime/sktime"><code>sktime</code></a>. Being a framework with goal being providing unifoed interface, it has a high number of soft dependencies. To maintain the framework itself, we have a very broad <code>dependencies</code> and few additional optional dependencies currently to check some compatibility tests occasionally on CI while main CI runs on latest versions. Two of these have name <code>dependencies_lowest</code> and <code>dependencies_lower</code> and while running <code>uv sync</code>, it seems <code>uv</code> is trying to install these as well.</p>
<p>Is it intended or a bug? If intended, is there a way to avoid this? I was trying with <code>conflicts</code> (once as extra and once as group) but both failed.</p>
<h3>Artefacts</h3>
<ol>
<li><code>pyproject.toml</code>: https://github.com/sktime/sktime/blob/93e6bbc28c5e8364caed8db4186186b7153d74c9/pyproject.toml</li>
<li>Traceback</li>
</ol>
<pre><code class="language-shell">  × No solution found when resolving dependencies for split (included: sktime[group:dependencies-lowest]; excluded:
  │ sktime[group:dependencies-lower]):
  ╰─▶ Because only the following versions of skforecast{python_full_version &lt; '3.13'} are available:
          skforecast{python_full_version &lt; '3.13'}&lt;=0.12.1
          skforecast{python_full_version &lt; '3.13'}==0.13.0
          skforecast{python_full_version &lt; '3.13'}==0.14.0
          skforecast{python_full_version &lt; '3.13'}&gt;0.15
      and skforecast==0.12.1 depends on scikit-learn&gt;=1.2,&lt;1.5, we can conclude that skforecast{python_full_version &lt;
      '3.13'}&gt;=0.12.1,&lt;0.13.0 depends on scikit-learn&gt;=1.2,&lt;1.5.
      And because skforecast&gt;=0.13.0,&lt;=0.14.0 depends on scikit-learn&gt;=1.2 and scikit-learn&gt;=1.2, we can conclude that
      skforecast{python_full_version &lt; '3.13'}&gt;=0.12.1,&lt;0.15 depends on scikit-learn&gt;=1.2.
      And because sktime[all-extras-pandas2] depends on skforecast{python_full_version &lt; '3.13'}&gt;=0.12.1,&lt;0.15 and
      sktime:dependencies-lowest depends on scikit-learn==0.24.0, we can conclude that sktime:dependencies-lowest and
      sktime[all-extras-pandas2] are incompatible.
      And because your project requires sktime[all-extras-pandas2] and sktime:dependencies-lowest, we can conclude that your       
      project's requirements are unsatisfiable.
</code></pre>
<ol start="3">
<li>PR: https://github.com/sktime/sktime/pull/8892</li>
</ol>
<h3>Platform</h3>
<p>Windows 11 x86_64</p>
<h3>Version</h3>
<p>0.8.22</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @yarnabrina on 2025-10-03 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../sktime/sktime/pulls/8892.html">sktime/sktime#8892</a> on 2025-10-04 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-06 10:32</div>
            <div class="timeline-body"><p>Can you use <code>uv pip install --resolution-lowest .</code> (https://docs.astral.sh/uv/reference/cli/#uv-pip-install--resolution) instead of encoding these manually? This option is meant specifically to test this case an avoid conflicts like the one you have.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yarnabrina">@yarnabrina</a> on 2025-10-06 13:34</div>
            <div class="timeline-body"><p>Thanks for the suggestion @konstin</p>
<p>@fkiraly @marrov what are your thoughts? We can try this, which will allow us to have the dynamic lowest resolution and seems easier to maintain over time. This will server the purpose of &quot;lowest&quot;, but we'll loose the &quot;lower&quot; one which I guess is good-to-have but not must-have?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-06 13:52</div>
            <div class="timeline-body"><blockquote>
<p>Two of these have name dependencies_lowest and dependencies_lower and while running uv sync, it seems uv is trying to install these as well.</p>
</blockquote>
<p>As a note, we're just trying to resolve these together to find a consistent resolution for the project — not install them. I'd expect declaring conflicts to fix the problem, if you want to go that route we can help figure out where that went wrong.</p>
<p>I think Konsti's suggestion is better though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fkiraly">@fkiraly</a> on 2025-10-06 15:40</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for the suggestion <a href="https://github.com/konstin">@konstin</a></p>
<p><a href="https://github.com/fkiraly">@fkiraly</a> <a href="https://github.com/marrov">@marrov</a> what are your thoughts? We can try this, which will allow us to have the dynamic lowest resolution and seems easier to maintain over time. This will server the purpose of &quot;lowest&quot;, but we'll loose the &quot;lower&quot; one which I guess is good-to-have but not must-have?</p>
</blockquote>
<p>This is not feasible since we also want to test intermediate states, e.g., &quot;all core dependencies as they were in July 2023&quot; or similar.</p>
<p>The &quot;lower&quot; is actually must have since it is a 2 year back horizon. Most users have already migrated away from &quot;lowest&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-06 15:43</div>
            <div class="timeline-body"><p>You can test dependencies as they were in the past using <code>--exclude-newer</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-06 16:00</div>
            <div class="timeline-body"><p>There's no native feature to constrain only core dependencies to an intermediate state, but there are some workarounds:</p>
<ul>
<li>You can declare conflicts with your existing groups (https://docs.astral.sh/uv/concepts/resolution/#conflicting-dependencies). This allows optional dependency groups that conflict, but it's very verbose and likely doesn't look like what you want to model.</li>
<li>Use <code>uv pip install . -c core_packages_frozen_2023_07_01.txt</code>. This handles it outside of <code>pyproject.toml</code> and the project interface, otoh it's simple to configure.</li>
<li>You can use <code>--exclude-newer 2023-07-01</code>, which will pin all packages to the specific date. This is the closest to modelling a user that hasn't updated since then, but it constrains all packages.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yarnabrina">@yarnabrina</a> on 2025-10-18 09:24</div>
            <div class="timeline-body"><p>Hi @konstin @zanieb thanks you for the suggestions. I personally like the <code>--exclude-newer</code> flag as it seems more generalised, but for now I've kept our existing structure and will discuss internally.</p>
<p>Can you kindly have a look at the linked PR (https://github.com/sktime/sktime/pull/8892)? This is my first migration attempt with <code>uv</code> for a big open source project as opposed to small internal POC's or fresh projects, so will really appreciate your feedbacks. If there are some other tips/tricks or general migration strategies, please let me know.</p>
<p>One related question: once we migrate to <code>uv</code> (assuming all our core devs agree), we can't enforce that all our contributors use <code>uv</code> for local environment management. If they want to contribute something new, how do we ensure that <code>uv.lock</code> is updated correctly? Is it safe/recommended to skip committing of <code>uv.lock</code> file and let it be figured out during installation itself?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-20 11:28</div>
            <div class="timeline-body"><blockquote>
<p>One related question: once we migrate to <code>uv</code> (assuming all our core devs agree), we can't enforce that all our contributors use <code>uv</code> for local environment management. If they want to contribute something new, how do we ensure that <code>uv.lock</code> is updated correctly? Is it safe/recommended to skip committing of <code>uv.lock</code> file and let it be figured out during installation itself?</p>
</blockquote>
<p>Often packages commit to specific package manager and either require contributors to use it or wrap it in e.g. a Makefile. You can enforce the lockfile is up-to-date by using <code>--locked</code> in CI. It's possible to gitignore <code>uv.lock</code> if you don't want user to have to update it and you don't need locked versions in CI.</p>
<p>You can also decouple the migration to <code>uv_build</code> from the migration to <code>uv.lock</code>, you can use each one individually with other build backends or other package managers too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yarnabrina">@yarnabrina</a> on 2025-10-21 16:39</div>
            <div class="timeline-body"><blockquote>
<p>It's possible to gitignore uv.lock if you don't want user to have to update it and you don't need locked versions in CI.</p>
</blockquote>
<p>@marrov gave that suggestion already, I think we'll go with that for now if reviewers agree for a package build backend switch. If you get some bandwidth, a review of the PR will be much appreciated.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
