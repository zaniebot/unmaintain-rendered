```yaml
number: 15394
title: "Add option for `uv export` to also support --index-url --extra-index-url in exported requirements.txt"
type: issue
state: closed
author: adychar
labels:
  - enhancement
assignees: []
created_at: 2025-08-20T16:48:54Z
updated_at: 2025-08-21T14:16:58Z
url: https://github.com/astral-sh/uv/issues/15394
synced_at: 2026-01-10T01:57:34Z
```

# Add option for `uv export` to also support --index-url --extra-index-url in exported requirements.txt

---

_Issue opened by @adychar on 2025-08-20 16:48_

### Summary

for a uv project that has a different default index or extra indexes, it would be useful to be able to export a requirements.txt which also includes those indexes as supported by the pip documentation https://pip.pypa.io/en/stable/reference/requirements-file-format/?utm_source=chatgpt.com



### Example

Given the following pyproject.toml
```[project]
name = "constraints"
version = "0.1.0"
description = "An example project"
readme = "README.md"
requires-python = ">=3.11"
dependencies = [
  "requests"
]

[[tool.uv.index]]
name = "test"
url = "https://test.pypi.org/simple/"
default = true

[[tool.uv.index]]
name = "pytorch"
url = "https://download.pytorch.org/whl/cu118"
explicit = true
```

I would expect `uv export` or `uv export --include-indexes` to result in the following requirements.txt


```
# This file was autogenerated by uv via the following command:
#    uv export
--index-url https://test.pypi.org/simple/
--extra-index-url https://download.pytorch.org/whl/cu118

requests==2.5.4.1 \
    --hash=sha256:0a2c98e46121e7507afb0edc89d342641a1fb9e8d56f7d592d4975ee6b685f9a \
    --hash=sha256:b19df51fa3e52a2bd7fc80a1ac11fb6b2f51a7c0bf31ba9ff6b5d11ea8605ae9
```

---

_Label `enhancement` added by @adychar on 2025-08-20 16:48_

---

_Comment by @jorgehermo9 on 2025-08-20 20:53_

I'm willing to contribute this!

Taking a look to the code, it seems that `uv export` exports the `uv.lock` file and not the `pyproject.toml` one. This means, in order to export the indexes in a `requirements.txt`, we need to either

1. Include the `pyproject.toml` indexes in the `uv.lock` and then export it
2. read the `pyproject.toml` in addition to the `uv.lock` when exporting, to know the used indexes

I'm not familiar with uv internals, but option 1 seems more doable, but I'm hesitant of adding a field to that lockfile just to export it to `requirements.txt` format.. I will appreciate an uv mantainer's opinion about this.

Another option would be to scan the `source` property of all packages in the `uv.lock` file 

```toml
[[package]]
name = "requests"
version = "2.5.4.1"
source = { registry = "https://test.pypi.org/simple/" }
sdist = { url = "https://test-files.pythonhosted.org/packages/6e/93/638dbb5f2c1f4120edaad4f3d45ffb1718e463733ad07d68f59e042901d6/requests-2.5.4.1.tar.gz", hash = "sha256:b19df51fa3e52a2bd7fc80a1ac11fb6b2f51a7c0bf31ba9ff6b5d11ea8605ae9", size = 448691, upload-time = "2015-03-13T21:30:03.228Z" }
wheels = [
    { url = "https://test-files.pythonhosted.org/packages/6d/00/8ed1b6ea43b10bfe28d08e6af29fd6aa5d8dab5e45ead9394a6268a2d2ec/requests-2.5.4.1-py2.py3-none-any.whl", hash = "sha256:0a2c98e46121e7507afb0edc89d342641a1fb9e8d56f7d592d4975ee6b685f9a", size = 468942, upload-time = "2015-03-13T21:29:55.769Z" },
]
```

But that way, we don't know if the index is a default index (`--index-url`) or an extra index (`--extra-index`)

  

---

_Comment by @charliermarsh on 2025-08-21 12:55_

Thanks! I think this is a duplicate of #10008. The problem (which I mentioned there) is that we can't actually output to `requirements.txt` with full fidelity (i.e., the output would sometimes be wrong) because the format isn't powerful enough to represent explicit index pinning.

---

_Closed by @charliermarsh on 2025-08-21 12:55_

---

_Comment by @adychar on 2025-08-21 14:15_

Thanks for the responses. And I understand the concern about the complete fidelity of the specific indexes. However, I don't need to pin each package to a specific index, I just need the new index's listed at the top of the requirements.txt. 

The functionality (of the index listings) would be exactly the same as the index listings in `uv pip compile pyproject.toml --emit-index-url `

The reason why I can't use that is because it generates the requirements.txt from the pyproject.toml and does not respect the lock file. As a result `uv sync` results in a different environment to that output in the generated requirements.txt file from `uv pip compile pyproject.toml --emit-index-url`

Interestingly the example pyproject.toml above results in the following file (with uv export):
```
# This file was autogenerated by uv via the following command:
#    uv export
requests==2.15.1 \
    --hash=sha256:e5659b9315a0610505e050bb7190bf6fa2ccee1ac295f2b760ef9d8a03ebbb2e \
    --hash=sha256:ff753b2196cd18b1bbeddc9dcd5c864056599f7a7d9a4fb5677e723efa2b7fb9
    # via constraints
```

Which is non functioning without any index-url as that version of requests is not available on the default pypi server.

In Summary
-`uv export` doesn't work at all with alternate indexes
- `uv pip compile pyproject.toml --emit-index-url` doesn't respect the versions in the uv.lock file 

so, currently I have to use a bash script to concatenate the indexes onto the front of the exported requirements.txt

Implementing the `--emit-index-url` option in `uv export` would at least give the above project example a change of finding the correct package. And given the option to match the hashes of the packages, this should result in an exact copy of the uv.lock environment.

Further more, if you are worried about the fidelity of the export, `uv pip compile pyproject.toml --emit-index-url` also doesn't respect any index pinning, such that the following pyproject.toml
```
[project]
name = "constraints"
version = "0.1.0"
description = "An example project"
readme = "README.md"
requires-python = ">=3.11"
dependencies = [
  "requests"
]

[tool.uv.sources]
requests = { index = "pypi-default" }

[[tool.uv.index]]
name = "test"
url = "https://test.pypi.org/simple/"
default = true

[[tool.uv.index]]
name = "pypi-default"
url = "https://pypi.org/simple/"
default = true
```

results in the following requirements.txt with `uv pip compile pyproject.toml > requirements.txt`

```
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml --emit-index-url
--index-url https://test.pypi.org/simple/

requests==2.15.1
    # via constraints (pyproject.toml)

```

which is also non-functioning as this version of requests is not available on the test.pypi.org index, yet the uv venv is fine.

Hopefully, these examples demonstrate the challenges i'm facing with a number of index issues included exporting environments when an internal index mirror is used.

I would urge you again to consider adding the `uv export --emit-index-url` option as it really would solve the majority of issues I'm having with uv.

Regards,



---
