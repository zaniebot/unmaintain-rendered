```yaml
number: 12721
title: "uv sync error: error: Distribution `xxx` can't be installed because it doesn't have a source distribution or wheel for the current platform"
type: issue
state: open
author: SimFG
labels:
  - question
assignees: []
created_at: 2025-04-07T17:22:04Z
updated_at: 2025-12-10T11:18:09Z
url: https://github.com/astral-sh/uv/issues/12721
synced_at: 2026-01-10T01:57:29Z
```

# uv sync error: error: Distribution `xxx` can't be installed because it doesn't have a source distribution or wheel for the current platform

---

_Issue opened by @SimFG on 2025-04-07 17:22_

### Summary

full log:

```
error: Distribution `pyside6==6.9.0 @ registry+https://pypi.org/simple` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're on macOS (`macosx_10_16_x86_64`), but `pyside6` (v6.9.0) only has wheels for the following platforms: `manylinux_2_28_x86_64`, `manylinux_2_39_aarch64`, `macosx_12_0_universal2`, `win_amd64`, `win_arm64`
```

If I use pip directly, it can be successfully installed, although this is not a strict match. Is there any way for me to bypass this verification, such as forcing the current system version to be successfully installed?

### Platform

mac os

### Version

uv 0.6.12

### Python version

Python 3.12.7

---

_Label `bug` added by @SimFG on 2025-04-07 17:22_

---

_Comment by @charliermarsh on 2025-04-07 17:23_

See: https://docs.astral.sh/uv/concepts/resolution/#required-environments

---

_Label `bug` removed by @charliermarsh on 2025-04-07 17:23_

---

_Label `question` added by @charliermarsh on 2025-04-07 17:23_

---

_Comment by @SimFG on 2025-04-08 02:07_

I found this document, but because I am not very familiar with the use of UV, I still don't know how to solve my problem.
@charliermarsh I would be grateful if you could help me.

---

_Comment by @SimFG on 2025-04-08 15:03_

@charliermarsh Can you give me some advice? I have tried many methods but to no avail.

---

_Comment by @charliermarsh on 2025-04-08 15:14_

Can you try using `uv add PySide6==6.5.2` instead? That includes a wheel that's compatible with your platform.

---

_Comment by @SimFG on 2025-04-08 15:16_

@charliermarsh thanks a lot, it's work. 
But how can I achieve the same effect as pip? Even if I use venv's pip installation, sync still reports an error

![Image](https://github.com/user-attachments/assets/4898e240-7855-4d8a-a163-fc9bbbf149c6)

---

_Comment by @SimFG on 2025-04-08 15:18_

One of my dependent packages requires "PySide6>=6.8.2.1"

---

_Comment by @SimFG on 2025-04-08 15:33_

I installed the package manually in the venv environment using pip, but uv still reports the same error

---

_Comment by @greg-ivrtg on 2025-12-09 16:50_

So this problem is more generic than the given package. Here is how it's triggering for me:

1. I built binary packages for some wheels and uploaded them to an internal pypi server. These match my laptop arch as darwin/aarch64
2. I try to run a `uv sync` in CI which runs on linux/x86_64, I get the above error

A few things to note:
1. A source package exists on `pypi.org` for the package
2. I have an internal package added with the environment variable `UV_INDEX=https://internal.pypi.wherever.com` which has binary wheels, but only for darwin/aarch64
3. Sync can still happen if I set `tool.uv.required-environments = "..."`, as there is a source file it can find and will download and build

So setting `required-environments` permits resolution of the sdist from the default index, while without it only the extra index URL is being discovered. This behavior persists even when `UV_INDEX_STRATEGY=unsafe-best-match` is set.

There seems to be a bug in `UV_INDEX_STRATEGY=unsafe-best-match` when a binary wheel matching the version moniker but mismatching the platform is present on an extra index, causing uv to fall back to its default behavior of `first-index` unless `required-environments` is explicitly specified in the `pypackage.toml`.

---

_Comment by @zanieb on 2025-12-09 17:06_

I don't think this is a bug. We aren't considering your current platform during universal resolution, so even with `unsafe-best-match`, the wheel on the first index satisfies the resolution.

---

_Comment by @greg-ivrtg on 2025-12-09 17:25_

Why wouldn't this be a bug?


# Scenario 1

* Default index with packages for `foo==1.0.0`
* Extra index with no packages for `foo`

Result:

Package is found in default and installed

✅ 

# Scenario 2

* Default index with packages for `foo==1.0.0`
* Extra index with packages for `foo!=1.0.0`

Result:

Package is found, but error because no version match

Resolution:

Add unsafe-best-match, and now package on default index is found

✅ 

# Scenario 3

* Default index with *sources* for `foo==1.0.0`
* Extra index with *binary-only* packages for `foo==1.0.0` but not for current platform

Result:

Package is not found, no matter what arguments are passed

Resolution:

1. Edit `pyproject.toml` field `uv.tool.required-environments` just to be able to install the packge AND set unsafe-best-match to allow searching other indexes.
2. OR Download the sdist into my extra index server

❌ 

That's a bug from any reasonable user perspective. I should be able to `uv sync` a repo with only CLI/environment variable settings when the sources are available on my configured indexes. And the semantics surrounding index-strategy in the docs is given as

```
By default, uv will stop at the first index on which a given package is available, and limit resolutions to those present on that first index (first-index). This prevents "dependency confusion" attacks, whereby an attacker can upload a malicious package under the same name to an alternate index.

May also be set with the UV_INDEX_STRATEGY environment variable.

Possible values:

    first-index: Only use results from the first index that returns a match for a given package name
    unsafe-first-match: Search for every package name across all indexes, exhausting the versions from the first index before moving on to the next
    unsafe-best-match: Search for every package name across all indexes, preferring the "best" version found. If a package version is in multiple indexes, only look at the entry for the first index
```

Based on that documentation, I should only need to configure the index-strategy setting in order to have uv resolve the source from a different index, download it, and build a wheel. But, in this edge case of wheels but no source being present on a supplemental index, I can't. I have to edit `pyproject.toml` or alter the available packages on my extra index.

---

_Comment by @greg-ivrtg on 2025-12-09 17:28_

Addendeum: `unsafe-first-match` also doesn't work in this scenario.

---

_Comment by @zanieb on 2025-12-09 18:10_

It's not a bug in the sense that I think it's working as intended. I understand you prefer different behavior, but that's not the same thing.

We don't mix files across indexes and we don't consider an index with a source distribution as "better" than an index with wheels. Maybe you want `--no-binary-package foo`?

---

_Comment by @greg-ivrtg on 2025-12-09 20:51_

OK, so I've narrowed this down even further. It's not just the presence of a wheel. It's specifically the presence of a wheel //built for a different python version// regardless of the host system.

Here is the setups I've tried.

These applied to all of the following scenarios:
* Python 3.13
* uv 0.9.13
* command: `uv add --no-cache --no-config "charset-normalizer==3.4.4"`

Here are my results.

<table>
<tr>
 <td>Index Strategy ➡️  <br />Extra Index contains ⬇️ </td>
 <td>first-index</td>
 <td>unsafe-best-match</td>
</tr>
<tr>
 <td>Source of 3.4.2</td>
 <td> ❌ </td>
 <td> ✅ </td>
</tr>
<tr>
 <td>Wheel of 3.4.4 for Python 3.14 and Windows on Arm</td>
 <td> ❌ </td>
 <td> ✅  </td>
</tr>
<tr>
  <td>Wheel of 3.4.4 for Python 3.13 and Windows on Arm</td>
  <td> ❌ </td>
  <td> ❌ </td>
</table>

It is expected that all of the left column should be ❌ , because in each case the extra index contains a mismatch in some regard. A mismatched source version, a mismatched Python tag AND platform, and a mismatched platform.

All of the right hand columns should be green, because in all 3 cases uv is being told to keep searching other indexes if it doesn't find a match in the first one. This is true for the case of an sdist only or a wheel with a different Python tag. Only when the Python tag matches and the platform mismatches does this bug arise.

Either 
1. This is a bug in the tool, because the index strategy description is clear that it will keep looking in later indexes if it can't find a match when set to `unsafe-best-match` which it fails to do when finding a matching Python-tag wheel with mismatched platform.
2. This is a bug in the tool, because it should NOT be continuing to search when a wheel with a Python tag mismatch is found.
3. It's a bug in the documentation of `unsafe-best-match` and the description for that feature needs to be greatly enhanced to make it clear that it will only keep looking in later indexes when it can't find a match for the version or the Python tag, but that a matching Python tag with mismatched architecture will NOT trigger the "keep searching" behavior.

Yes, adding `--no-binary-package charset-normalizer` does present as a workaround. However, it doesn't change that the search behavior is inconsistent and *something* is buggy. It is also undesirable because perhaps I *do* want to use a binary package, but just not one that is available on my first index. Or perhaps I don't know which package will be the one to trigger this behavior because the contents of my cache are ever evolving. While a workaround for this very specific case it does not negate the inconsistent and incorrect behavior of the index strategy resolution.

I've [created a minimum reproducer](https://github.com/greg-ivrtg/uv-sync-bug-reprodcuer) that shows the mismatched expectations above.

---

_Comment by @konstin on 2025-12-10 11:18_

I've simplified the example some more:

```toml
[project]
name = "uv-reproducer"
version = "0.1.0"
requires-python = "==3.13.*"
dependencies = [
    "charset-normalizer==3.4.4",
]

[[tool.uv.index]]
# Contains the sdist
url = "./default"
format = "flat"

[[tool.uv.index]]
# Contains the windows arm64 package
url = "./platform-mismatch"
format = "flat"

[tool.uv]
index-strategy = "unsafe-best-match"
```

The contents of the lockfile will depend on the order of the index, switching their order will switch the lockfile over.

The problem you're observing is that from the perspective of `uv.lock`, both packages are fitting for universal locking, and it just considers the first one as best.

Usually, this should be handled by `tool.uv.[required-]environments`, but they don't seem to mix with index preferences: https://github.com/astral-sh/uv/issues/17067, https://github.com/astral-sh/uv/issues/17068


---
