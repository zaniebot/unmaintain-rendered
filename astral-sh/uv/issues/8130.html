<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow setting environment variable into cache-keys - astral-sh/uv #8130</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow setting environment variable into cache-keys</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8130">#8130</a>
        opened by <a href="https://github.com/gaborbernat">@gaborbernat</a>
        on 2024-10-11 19:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-10-11 19:23</div>
            <div class="timeline-body"><p>So <code>uv sync</code> is governed by https://docs.astral.sh/uv/reference/settings/#cache-keys. Occasionally, you want to customize the build package based on environment variables (e.g., for a type checker no need to build a NPM distribution static files, but for the tests you might need).  Accordingly, we should allow including environment variables into the cache key.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-10-12 03:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-12 03:47</div>
            <div class="timeline-body"><p>That seems reasonable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2024-10-30 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 20:22</div>
            <div class="timeline-body"><p>For anyone interested, this requires adding a new variant here:</p>
<p>https://github.com/astral-sh/uv/blob/bed47d512a873ef2b2812b86a6cef231ba2c965d/crates/uv-cache-info/src/cache_info.rs#L224</p>
<p>The rest follows from there, not too hard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-10-30 20:57</div>
            <div class="timeline-body"><p>I did try going down that rabbit hole, but this quickly can becoime quite complicated, especially as the test suite is not that exhaustive ðŸ¤” so can be daunting to change a lot of the code base without that safety net ðŸ¤” I do not see a single test in this crate here https://github.com/astral-sh/uv/tree/bed47d512a873ef2b2812b86a6cef231ba2c965d/crates/uv-cache-info ðŸ¤”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 20:59</div>
            <div class="timeline-body"><p>That's because you're looking in the wrong place. We don't do much unit testing at all, uv is almost entirely tested via integration tests and snapshots. For example, here:</p>
<p>https://github.com/astral-sh/uv/blob/bed47d512a873ef2b2812b86a6cef231ba2c965d/crates/uv/tests/it/pip_install.rs#L3492</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-10-30 21:00</div>
            <div class="timeline-body"><blockquote>
<p>That's because you're looking in the wrong place. We don't do much unit testing at all, uv is almost entirely tested via integration tests and snapshots. For example, here:</p>
</blockquote>
<p>Integration tests are much slower... which in turn make development harder ðŸ˜† Having the tests far from the code does not help their discoverabilty or locallity ðŸ˜®</p>
<p>All I am saying is that I looked at the code base and what I've seen looked daunting enough to discourage me from doing it. Granted I am not a rust expert, but I think I am not horrible either. Not having a quick feedback loop when making changes (that unit tests give you), is on its own discouraging enough to stop me going any further. Or any obvious place to put my new tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-30 21:20</div>
            <div class="timeline-body"><p>These are trade-offs we're willing to accept for coverage of behavior as encountered by the user. I'm sorry you are feeling discouraged, but we have to balance test coverage with delivering value to our users. If you encounter something that you're not comfortable changing based on existing test coverage, it's reasonable practice to add tests in a separate pull request first.</p>
<p>Please understand we are a small team and get a lot of requests, this isn't a great place to debate the merits of different testing strategies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-10-30 21:24</div>
            <div class="timeline-body"><p>I totally understand, and I am not saying this as hey why are you not doing x, y. I am just pointing out what stopped me contributing when I tried to pick this up, as a feedback to the ease of contribution. In contrast I found contributing https://github.com/axodotdev/axoupdater/pull/199 much more straigh forward, but perhaps that is just a facet of that project being smaller and more focused. After all this project now has 218,281 lines of rust code, that one is only 2400.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-26 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10170.html">astral-sh/uv#10170</a> on 2024-12-26 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-26 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-26 15:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:07 UTC
    </footer>
</body>
</html>
