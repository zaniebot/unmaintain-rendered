<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create stub for `uv` in virtual environments - astral-sh/uv #1632</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Create stub for `uv` in virtual environments</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/1632">#1632</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-02-18 08:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-18 08:06</div>
            <div class="timeline-body"><p>It seems like we should probably stub <code>uv</code> into the environment by default so that you can use <code>python -m uv</code>. I'm not exactly sure what that would look like.</p>
<p><em>Originally posted by @zanieb in https://github.com/astral-sh/uv/issues/1598#issuecomment-1950259889</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-02-18 08:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SnoopJ">@SnoopJ</a> on 2024-02-18 18:01</div>
            <div class="timeline-body"><p>+1 to the idea of a stub, it seems like a fairly natural solution to #1625.</p>
<p>It seems to me that the mechanism would be to include a symlink to or copy of <code>uv</code> in the venv (gated by a flag perhaps?) and inspect <code>argv[0]</code> when doing venv detection. I believe the analogous CPython behavior that allows <code>/path/to/venv/bin/python3</code> to Just Workâ„¢ is <a href="https://github.com/python/cpython/blob/0c80da4c14d904a367968955544dd6ae58c8101c/Lib/site.py#L529-L539">scanning for a nearby <code>pyvenv.cfg</code></a> and it seems like <code>uv</code> could probably use the same process as an early step in the venv detection logic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">virtualenv</span> added by @zanieb on 2024-02-18 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-18 21:02</div>
            <div class="timeline-body"><p>We added a similar scan for the <code>pyvenv.cfg</code> in #1504</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-02-19 14:58</div>
            <div class="timeline-body"><p>(<code>pyvenv.cfg</code>, you mean?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-19 15:44</div>
            <div class="timeline-body"><p>Thanks :) fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wpk-nist-gov">@wpk-nist-gov</a> on 2024-02-23 00:25</div>
            <div class="timeline-body"><p>Playing around, I think there's workable solution (with a caveat) right now.  I did the following:</p>
<pre><code># 1. create environment using global uv
$ uv venv .venv

# 2. install uv in the venv
$ uv pip install uv

# 3. hack.  Remove uv executable, but leaves python uv interface
$ rm .venv/bin/uv

# 4. This still works. (find_uv_bin() finds my globally installed uv)
$ cd somewhere/else
$ full/path/to/.venv/bin/python -m uv pip freeze
uv==0.1.8
</code></pre>
<p>Basically, the code in <a href="https://github.com/astral-sh/uv/tree/main/python/uv">python/uv</a> is your stub.  Maybe just spin off a package <code>python-uv</code> which could be (optionally?) included when creating a venv.</p>
<p>However, regardless of step 3 (the hack), using the full path to the python doesn't work if a virtualenv is also activated.  For example (continuing from above):</p>
<pre><code>$ uv venv .venv2
$ source .venv2/bin/activate

# Now try to install to .venv using path...
$ .venv/bin/python -m uv pip install typing-extensions

# This installs into .venv2!
$ uv pip freeze
typing-extensions==4.9.0

# not in .venv
$ source .venv/bin/activate
$ uv pip freeze
uv==0.1.8
</code></pre>
<p>I'm pretty sure this is not the intended behavior.   I'm guessing a solution to #1396 will allow this to be fixed.  For example, if an option <code>--python-executable</code>  is available, then instead of searching for, and setting <code>VIRTUAL_ENV</code> variable <a href="https://github.com/astral-sh/uv/blob/main/python/uv/__main__.py">here</a>, you could simply pass  <code>f&quot;--python-executable={sys.executable}&quot;</code>.</p>
<p>I figured it made sense to add this to this issue.  Please let me know if I should start a new issue instead.</p>
<p>Thank you to all the developers for this awesome package!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @zanieb on 2024-07-01 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eabase">@eabase</a> on 2025-02-25 08:06</div>
            <div class="timeline-body"><p>I think a better solution is to tear out the .venv (file installs) from sub-directory, and instead link to a system directory for all venv installs, as they do in the <a href="https://github.com/fohrloop/venvlink/">venvlink</a> project.</p>
<p>See my proposal in #11773</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:52:25 UTC
    </footer>
</body>
</html>
