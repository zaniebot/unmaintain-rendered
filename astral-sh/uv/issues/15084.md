```yaml
number: 15084
title: Reflink failures on macOS 15.5
type: issue
state: open
author: mertdeveci5
labels:
  - bug
assignees: []
created_at: 2025-08-05T16:29:17Z
updated_at: 2025-08-05T17:28:57Z
url: https://github.com/astral-sh/uv/issues/15084
synced_at: 2026-01-10T01:57:34Z
```

# Reflink failures on macOS 15.5

---

_Issue opened by @mertdeveci5 on 2025-08-05 16:29_

### Summary

After `uv` upgrade to 0.8.4, it is throwing a warning around copy_mode. 

```
 uv run uvicorn config.asgi:application --reload
░░░░░░░░░░░░░░░░░░░░ [0/99] Installing wheels...                                             warning: Failed to clone files; falling back to full copy. This may lead to degraded performance.
         If the cache and target directories are on different filesystems, reflinking may not be supported.
         If this is intentional, set `export UV_LINK_MODE=copy` or use `--link-mode=copy` to suppress this warning.
```

This never used to happen on version 6. Bigger problem is that this is corrupting some packages with incomplete installations. 

When I stop and run the server a couple times, some of the site-packages can never be found. 

Not really sure what is happening here

### Platform

macos Darwin 24.5.0 arm64

### Version

uv 0.8.4

### Python version

3.11.8

---

_Label `bug` added by @mertdeveci5 on 2025-08-05 16:29_

---

_Comment by @zanieb on 2025-08-05 16:32_

We'll need way more details. Where's your target directory? Where's your cache? Do you have multiple file systems? Can you share verbose logs as requested in #9452 ?

---

_Comment by @mertdeveci5 on 2025-08-05 16:44_

Sure thing. You can see it below: 

System Information

  - uv version: 0.8.4 (Homebrew 2025-07-30)
  - Operating System: macOS 15.5 (24F74) - Sequoia
  - Architecture: arm64 (Apple Silicon)
  - Python: CPython 3.11.8
  - Target directory: /Users/mertdeveci5/Desktop/Code/alpha
  - Cache directory: /Users/mertdeveci5/.cache/uv
  - Filesystem: Both directories are on the same APFS volume (/dev/disk3s5)

  Issue Description

  When uv attempts to use APFS clonefile operations, it fails and falls back to copying, but the
  fallback sometimes results in corrupted package installations. This manifests as:

  1. Missing module files (e.g., ModuleNotFoundError: No module named 'h11._version')
  2. Corrupted directories in .venv (e.g., bin 2 with 65535 subdirectories)
  3. Incomplete package installations (missing subdirectories like openai/resources/)

  Verbose Logs

  DEBUG Failed to clone
  `/Users/mertdeveci5/.cache/uv/archive-v0/NFhOC022_BSCGW8TBVKDa/requests-2.32.4.dist-info` to `/User
  s/mertdeveci5/Desktop/Code/alpha/.venv/lib/python3.11/site-packages/requests-2.32.4.dist-info`,
  attempting to copy files as a fallback
  warning: Failed to clone files; falling back to full copy. This may lead to degraded performance.
           If this is intentional, set `export UV_LINK_MODE=copy` or use `--link-mode=copy` to
  suppress this warning.

  Reproduction Steps

  1. On macOS with APFS filesystem
  2. rm -rf .venv && uv venv && uv sync
  3. Run server: uv run uvicorn config.asgi:application --reload
  4. Repeat steps 2-3 multiple times
  5. Eventually, packages become corrupted with errors like:
    - ImportError: cannot import name 'ImproperlyConfigured' from 'channels.exceptions'
    - ModuleNotFoundError: No module named 'h11._version'
    - FileNotFoundError: [Errno 2] No such file or directory:
  '.venv/lib/python3.11/site-packages/openai/resources/chat'

- intermittent - first few installations often work, then corruption occur
- The corrupted directories show bizarre properties (65535 subdirectories)

What do you think? 


---

_Comment by @zanieb on 2025-08-05 17:19_

Thanks for the details. Unfortunately, I'm not sure what could be going on here. There are _a lot_ of people using uv on macOS (including most of us!) and I've never seen this before. 

Are you setting `export UV_LINK_MODE=copy` or are you saying the corrupted directories are occurring with the default settings?

I think our best path forward here is to add more logs when we encounter a reflink error so we can tell what's going on.

---

_Comment by @mertdeveci5 on 2025-08-05 17:23_

I don't set the `export UV_LINK_MODE=copy` - never did it so far and this error surfaced only today after my upgrade to 0.8.4 although not sure if they are related. I am running `uv` with default settings. Also I uninstalled and reinstlaled it as well but it keeps happening. 

Any recommendation here or any other logs you need? Claude Code also suggested that there is an incomptability issues around reflink with uv's new version and Mac - however I did not upgrade my os for a while now. 

---

_Comment by @zanieb on 2025-08-05 17:26_

I'd recommend changing the link mode to copy until we can determine the root cause of the issue.

---

_Comment by @zanieb on 2025-08-05 17:26_

We'll need to release more logs before you can do more, I think. Unless there's some system log that has information about the failed clones.

---

_Comment by @zanieb on 2025-08-05 17:28_

I guess the other thing to do would be to narrow the issue down to a specific version. Going from 0.6.x to 0.8.x is a huge range for us to try to identify the cause of a regression. You can use `uvx uv@<version>` to quickly test versions.

---

_Renamed from "Link_mode copy corruption" to "Reflink failures on macOS 15.5" by @zanieb on 2025-08-05 17:28_

---
