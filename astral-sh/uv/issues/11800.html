<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv 0.6.3 fails to install python on Windows Server 2016 - astral-sh/uv #11800</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv 0.6.3 fails to install python on Windows Server 2016</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/11800">#11800</a>
        opened by <a href="https://github.com/StephenBrown2">@StephenBrown2</a>
        on 2025-02-26 15:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/StephenBrown2">@StephenBrown2</a> on 2025-02-26 15:20</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Recently, I have seen that uv 0.6.3 has failed to install python on Windows Server 2016 (Datacenter Edition), due to an inability to rename the temp file to the venv. This is not a problem with uv 0.6.2 or 0.6.1 on Server 2016, or on Windows Server 2019 or 2022 with uv 0.6.3.</p>
<p><code>uv 0.6.3 (x86_64-pc-windows-msvc)</code> is installed.</p>
<p><code>.python-version</code> file is set to <code>&lt;3.12</code></p>
<p><code>pyproject.toml</code> has the following relevant setting:</p>
<pre><code class="language-toml">[tool.uv]
python-preference = &quot;only-managed&quot;
</code></pre>
<p>Before this is run, <code>uv sync --frozen --verbose</code> is also run, but provides no output in the logs.</p>
<p>Running <code>uv venv --verbose</code> with uv 0.6.3 on Windows Server 2016:</p>
<pre><code>    + CategoryInfo          : NotSpecified: (DEBUG uv 0.6.3 (a0b9f22a2 2025-02-24):String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
DEBUG Found project root: `C:\projects\&lt;project&gt;`
DEBUG No workspace root found, using project root
DEBUG Reading Python requests from version file at `C:\projects\&lt;project&gt;\.python-version`
DEBUG Using Python request `&lt;3.12` from version file at `.python-version`
DEBUG Searching for Python &lt;3.12 in managed installations
DEBUG Searching for managed installations at `C:\Users\vagrant\AppData\Roaming\uv\python`
DEBUG Requested Python not found, checking for available download...
DEBUG Acquired lock for `C:\Users\vagrant\AppData\Roaming\uv\python`
DEBUG Using request timeout of 30s
INFO Fetching requested Python...
Downloading cpython-3.11.11-windows-x86_64-none (24.3MiB)
DEBUG Downloading https://github.com/astral-sh/python-build-standalone/releases/download/20250212/cpython-3.11.11%2B20250212-x86_64-pc-windows-msvc-install_only_stripped.tar.gz to temporary location: C:\Users\vagrant\AppData\Roaming\uv\python\.temp\.tmpnp321E
DEBUG Extracting cpython-3.11.11%2B20250212-x86_64-pc-windows-msvc-install_only_stripped.tar.gz
 Downloaded cpython-3.11.11-windows-x86_64-none
DEBUG Moving C:\Users\vagrant\AppData\Roaming\uv\python\.temp\.tmpnp321E\python to C:\Users\vagrant\AppData\Roaming\uv\python\cpython-3.11.11-windows-x86_64-none
DEBUG Released lock at `C:\Users\vagrant\AppData\Roaming\uv\python\.lock`
  Ã— Failed to copy to:
  â”‚ C:\Users\vagrant\AppData\Roaming\uv\python\cpython-3.11.11-windows-x86_64-none
  â•°â”€â–¶ failed to rename file from
      C:\Users\vagrant\AppData\Roaming\uv\python\.temp\.tmpnp321E\python to
      C:\Users\vagrant\AppData\Roaming\uv\python\cpython-3.11.11-windows-x86_64-none:
      Incorrect function. (os error 1)
</code></pre>
<p>Information about the filesystem:</p>
<pre><code>DriveLetter FileSystemLabel FileSystem DriveType HealthStatus OperationalStatus SizeRemaining     Size
----------- --------------- ---------- --------- ------------ ----------------- -------------     ----
C           Windows 2016    NTFS       Fixed     Healthy      OK                     50.54 GB 63.66 GB
</code></pre>
<p>uv 0.6.2 on Windows 2016:</p>
<pre><code>+ uv run -m pytest test/functional $($args) 2&gt;&amp;1
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (DEBUG uv 0.6.2 (6d3614eec 2025-02-19):String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
DEBUG Found project root: `C:\projects\&lt;project&gt;`
DEBUG No workspace root found, using project root
DEBUG Discovered project `&lt;project&gt;` at: C:\projects\&lt;project&gt;
DEBUG Acquired lock for `C:\projects\&lt;project&gt;`
DEBUG Reading Python requests from version file at `C:\projects\&lt;project&gt;\.python-version`
DEBUG Using Python request `&lt;3.12` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment's Python version satisfies `&lt;3.12`
</code></pre>
<h3>Platform</h3>
<p>Windows Server 2016</p>
<h3>Version</h3>
<p>uv 0.6.3 (a0b9f22a2 2025-02-24)</p>
<h3>Python version</h3>
<p>Python 3.11 (.python-version == &lt;3.12)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @StephenBrown2 on 2025-02-26 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-26 15:38</div>
            <div class="timeline-body"><p>It looks like no download is occurring on 0.6.2? Are you in the same project?</p>
<p>Does <code>uv python install 3.12 --reinstall</code> work on 0.6.2?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-26 15:40</div>
            <div class="timeline-body"><p>Unfortunately that Windows error is very opaque and renaming is a very basic operation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/StephenBrown2">@StephenBrown2</a> on 2025-02-26 15:42</div>
            <div class="timeline-body"><p>This is grabbed from CI logs on the same project in a matrix, I'll see if I can grab the output from the <code>uv python install</code> command, but I added the <code>python-preference</code> config to the description, so uv is always downloading a new python.</p>
<pre><code class="language-yaml">    strategy:
      matrix:
        targets:
          # - macos
          # - linux
          # - windows-server
          - windows-server-2016
          - windows-server-2019
          - windows-server-2022
        uv-version:
          - '0.6.1'
          - '0.6.2'
          - '0.6.3'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/StephenBrown2">@StephenBrown2</a> on 2025-02-26 15:58</div>
            <div class="timeline-body"><p>Also, the fact that no output is given for <code>uv sync --frozen --verbose</code> is frustrating, though I didn't enable <code>$env:RUST_LOG = &quot;uv=debug&quot;</code> for that command. I'll add that as well and see if it outputs anything for 0.6.2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/StephenBrown2">@StephenBrown2</a> on 2025-02-26 16:27</div>
            <div class="timeline-body"><p>With or without <code>$env:RUST_LOG = &quot;uv=debug&quot;</code>, the following commands:</p>
<pre><code class="language-pwsh">$uvOutput = uv sync --frozen --verbose | Out-String
Write-Host &quot;uv sync --frozen --verbose output:&quot;
Write-Host $uvOutput
Write-Host &quot;-------------------------------------&quot;
$uvPython = uv python install 3.12 --reinstall | Out-String
Write-Host &quot;uv python install 3.12 --reinstall output:&quot;
Write-Host $uvPython
Write-Host &quot;-------------------------------------&quot;
</code></pre>
<p>Output the following:</p>
<pre><code class="language-txt">       uv sync --frozen --verbose output:
       
       -------------------------------------
       uv python install 3.12 --reinstall output:
       
       -------------------------------------
</code></pre>
<p>regardless of uv or windows version.</p>
<p>Windows and PowerShell are not my preferred environment, however, so I may be missing something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/StephenBrown2">@StephenBrown2</a> on 2025-03-07 15:51</div>
            <div class="timeline-body"><p>Just an update, this is still an issue with uv 0.6.5, but still only on Windows Server 2016:</p>
<pre><code>uv : Downloading cpython-3.11.11-windows-x86_64-none (24.3MiB)
       At C:\projects\jumpcloud-agent\bin\TestFunctional.ps1:7 char:3
       +   uv run -m pytest --last-failed test/functional $($args) 2&gt;&amp;1
       +   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
           + CategoryInfo          : NotSpecified: (Downloading cpy...-none (24.3MiB):String) [], RemoteException
           + FullyQualifiedErrorId : NativeCommandError
        
        
       Downloaded cpython-3.11.11-windows-x86_64-none
       
       
       error
       : Failed to copy to: C:\Users\vagrant\AppData\Roaming\uv\python\cpython-3.11.11-windows-x86_64-none
       
         
       Caused by: failed to rename file from C:\Users\vagrant\AppData\Roaming\uv\python\.temp\.tmpXMPWzf\python to C:\Users\vagrant\AppData\Roaming\uv\python\cpython-3.11.11-windows-x86_64-none: Incorrect function. (os error 1)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ufwtlsb">@ufwtlsb</a> on 2025-03-27 08:34</div>
            <div class="timeline-body"><p>i have same problem</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @zanieb on 2025-04-01 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ufwtlsb">@ufwtlsb</a> on 2025-04-13 11:16</div>
            <div class="timeline-body"><p>uv 0.6.14 is ok</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
