<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error `Dependency `packageneme` has missing `version` field but has more than one matching package` when using conflicting optional dependencies. - astral-sh/uv #11384</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Error <code>Dependency </code>packageneme<code>has missing</code>version<code> field but has more than one matching package</code> when using conflicting optional dependencies.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11384">#11384</a>
        opened by <a href="https://github.com/jenshnielsen">@jenshnielsen</a>
        on 2025-02-10 13:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jenshnielsen">@jenshnielsen</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have been trying to configure uv to allow me to have two sets of conflicting optional dependencies to allow me to easily switch between
having specific dependencies installed from pypi or editable from a local folder. However, when I try to do this, I end up with an error of the form</p>
<pre><code>error: Failed to parse `uv.lock`
  Caused by: Dependency `qcodes` has missing `version` field but has more than one matching package
</code></pre>
<p>Which I can only work around by deleting the uv.lock file.</p>
<p>To reproduce: Have a project with a dynamic version field in pyproject.toml checked out in a subfolder of the current folder.
In this case I use <a href="https://github.com/microsoft/Qcodes.git">QCoDeS</a> which I maintain but I can also reproduce the issue with other projects.</p>
<pre><code>uv init demo
</code></pre>
<p>Add</p>
<pre><code>[project.optional-dependencies]
editable = [
    &quot;qcodes&gt;=0.50.1&quot;
    ]
pypi = [
    &quot;qcodes&gt;=0.50.1&quot;
    ]

[tool.uv]

conflicts = [[
        { extra = &quot;editable&quot; },
        { extra = &quot;pypi&quot; },
         ]]

[tool.uv.sources]


qcodes = [
    { path = &quot;../qcodes&quot;, editable = true , extra = &quot;editable&quot;},
    { index=&quot;pypi&quot; , extra = &quot;pypi&quot;}
    ]


[[tool.uv.index]]
name = &quot;pypi&quot;
url = &quot;https://pypi.org/simple/&quot;
explicit = true

</code></pre>
<p>To the demo projects pyproject.toml file</p>
<p>Run</p>
<pre><code>uv sync --extra pypi
</code></pre>
<p>Correctly installs all dependencies as expected from pypi.</p>
<p>Howeverm when then running.</p>
<pre><code>uv sync --extra editable  --upgrade
</code></pre>
<p>I get</p>
<pre><code>error: Failed to parse `uv.lock`
  Caused by: Dependency `qcodes` has missing `version` field but has more than one matching package
</code></pre>
<p>Removing the uv.lock file and I can correctly install the editable version.</p>
<p>Now running</p>
<pre><code>uv sync --extra pypi  --upgrade
</code></pre>
<p>results in the same error which can then be worked around by removing the uv.lock file</p>
<h3>Platform</h3>
<p>Window 11 24H2</p>
<h3>Version</h3>
<p>uv 0.5.29 (ca73c4754 2025-02-05)</p>
<h3>Python version</h3>
<p>Python 3.13 but also reproduced using 3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @jenshnielsen on 2025-02-10 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-02-10 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-10 20:16</div>
            <div class="timeline-body"><p>I think this is just an oversight. Fixed in https://github.com/astral-sh/uv/pull/11400.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-10 20:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:49 UTC
    </footer>
</body>
</html>
