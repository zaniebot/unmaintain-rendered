<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>unexpected behaviour of uv pip install -e/-r with cython extensions - astral-sh/uv #13592</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>unexpected behaviour of uv pip install -e/-r with cython extensions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13592">#13592</a>
        opened by <a href="https://github.com/schenker">@schenker</a>
        on 2025-05-22 11:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/schenker">@schenker</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>I have the following setup and I would like to understand under which conditions cython extensions are compiled:</p>
<p><strong>hello.pyx:</strong></p>
<pre><code class="language-python">def say_hello():
    print(&quot;Hello from Cython!&quot;)
</code></pre>
<p><strong>setup.py:</strong></p>
<pre><code class="language-python">from setuptools import setup, Extension

ext_modules = [
    Extension(
        name=&quot;hello&quot;,
        sources=[&quot;hello.c&quot;],
    )
]

setup(
    name=&quot;mycythonproj&quot;,
    version=&quot;0.1&quot;,
    ext_modules=ext_modules,
)

</code></pre>
<p><strong>requirements.txt:</strong></p>
<pre><code>-e .
</code></pre>
<p>I run <code>cython hello.pyx</code> to create <code>hello.c</code>. When I then run <code>uv pip install -e .</code>, the cython extension is compiled and <code>hello.cpython-312-x86_64-linux-gnu.so</code> is created, as expected:</p>
<pre><code class="language-console">$ uv pip install -e .
Using Python 3.12.3 environment at: venv
Resolved 1 package in 307ms
      Built mycythonproj @ file:///home/schenker/workspace/cython_test_uv
Prepared 1 package in 722ms
Uninstalled 1 package in 0.16ms
Installed 1 package in 0.45ms
 ~ mycythonproj==0.1 (from file:///home/schenker/workspace/cython_test_uv)
</code></pre>
<p>When I instead run <code>uv pip install -r requirements.txt</code> in a fresh setup, no <code>.so</code> file is created, with the following output:</p>
<pre><code class="language-console">$ uv pip install -r requirements.txt 
Using Python 3.12.3 environment at: venv
Resolved 1 package in 1ms
Installed 1 package in 4ms
 + mycythonproj==0.1 (from file:///home/schenker/workspace/cython_test_uv)
</code></pre>
<h3>Platform</h3>
<p>Ubuntu 24.04.2 LTS, Linux 6.8.0-60-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.7.5, Python 3.12.3, Cython version 3.1.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @schenker on 2025-05-22 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-22 11:34</div>
            <div class="timeline-body"><p>I believe this is because we cache the build (whereas if you explicitly install with <code>uv pip install -e .</code>, we always rebuild). See: https://docs.astral.sh/uv/concepts/cache/. You can either setup cache keys for the project, or pass <code>--reinstall-package</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @schenker on 2025-05-22 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schenker">@schenker</a> on 2025-05-22 15:17</div>
            <div class="timeline-body"><p>@charliermarsh thanks for the explanation! It turned out cache keys don't solve my problem. I used the .so files of my cython extension as cache keys, so they would be rebuilt if deleted. Unfortunately the rebuilt .so file's timestamp is so recent that the cache is instantly invalidated and any subsequent installs trigger a rebuild again. A file-content based key would be handy... anyways, I will try to solve it differently.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:31:28 UTC
    </footer>
</body>
</html>
