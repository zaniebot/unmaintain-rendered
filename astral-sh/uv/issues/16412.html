<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv pip install doesn't work with :  ⁠UV_NATIVE_TLS and ⁠--native-tls -  No detection system certificates, requiring ⁠--allow-insecure-host - astral-sh/uv #16412</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv pip install doesn't work with :  ⁠UV_NATIVE_TLS and ⁠--native-tls -  No detection system certificates, requiring ⁠--allow-insecure-host</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16412">#16412</a>
        opened by <a href="https://github.com/errajibadr">@errajibadr</a>
        on 2025-10-22 16:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/errajibadr">@errajibadr</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Description:
Environment</p>
<p>uv version: 0.8.14	
Python Version: 3.12.10
Platform/Architecture: Linux aarch64 (ARM64)
Kernel: 6.10.14-linuxkit
OS Distribution: Wolfi (a minimal Linux distribution designed for containers)
Version: 20230201
(The CICD is in Debian Worker)</p>
<p>Problem</p>
<p>When using ⁠uv pip install --system, neither the ⁠UV_NATIVE_TLS environment variable nor the ⁠--native-tls flag successfully enable native TLS certificate verification.  ( uv sync works )</p>
<p>Despite properly configuring system certificates, uv fails to recognize them and only works when using ⁠--allow-insecure-host, which bypasses security.
Steps to Reproduce
1.	Copy certificates to ⁠/etc/ssl/certs 
2.	Set environment variables:
export UV_NATIVE_TLS=true
export SSL_CERT_DIR=/etc/ssl/certs
export SSL_CERT_FILE=....
3.	Attempt installation:
uv pip install --system --native-tls <package>
4.	Installation fails with certificate verification error 	
5.	Only succeeds when using:
uv pip install --system --allow-insecure-host <host> <package>
Expected Behavior
When ⁠UV_NATIVE_TLS=true or ⁠--native-tls is specified, uv should use the system's native certificate store (including certificates in ⁠/etc/ssl/certs and respecting ⁠SSL_CERT_DIR) for TLS verification.
Actual Behavior
Certificate verification fails despite:
•	Certificates being present in ⁠/etc/ssl/certs 	
•	⁠SSL_CERT_DIR environment variable being set 	
•	⁠UV_NATIVE_TLS=true being set 	
•	⁠--native-tls flag being used
The only workaround is using ⁠--allow-insecure-host, which defeats the purpose of certificate verification.
Additional Context
According to the <a href="https://docs.astral.sh/uv/concepts/authentication/certificates/">uv documentation</a>, ⁠UV_NATIVE_TLS should enable the platform's native certificate store.</p>
<p>However, this doesn't appear to be working as expected in this configuration.
Related Issues</p>
<p>Workaround
Currently forced to use ⁠--allow-insecure-host, which is not acceptable for production environments due to security implications.</p>
<h3>Platform</h3>
<p>Wolfi 20230201</p>
<h3>Version</h3>
<p>0.8.14</p>
<h3>Python version</h3>
<p>3.12.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @errajibadr on 2025-10-22 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-10-23 03:23</div>
            <div class="timeline-body"><p>Thanks, for the report. I'd be great if you can provide</p>
<p>(1) a reproduceable dockerfile showing step by step how you're adding the cert (using a dummy cert is fine) - you can generate one using something like <a href="https://github.com/FiloSottile/mkcert">mkcert</a>.
(2) the actual verbose errors (e.g. running uv with --verbose)
(3) Ideally, how the problematic cert was generated (e.g. openssl args/params/config) or any generic info you can share about the cert (algorithm, etc.)</p>
<p>I'd avoid setting <code>UV_NATIVE_TLS</code> along with either  <code>SSL_CERT_DIR</code> or <code>SSL_CERT_FILE</code> as they're mutually exclusive.</p>
<p>Sidenote, <code>uv</code> doesn't support <code>SSL_CERT_DIR</code> directly but we should probably add explicit support so as its properly supported by <code>rustls-native-certs</code> as of a few months ago.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @samypr100 on 2025-10-23 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @samypr100 on 2025-10-23 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michael-o">@michael-o</a> on 2025-11-18 17:19</div>
            <div class="timeline-body"><p>@errajibadr Your problem is 99% related to openssl-probe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-11-19 02:02</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/errajibadr">@errajibadr</a> Your problem is 99% related to openssl-probe.</p>
</blockquote>
<p>@michael-o Thanks for digging, could you provide more details as to what led you to that conclusion?</p>
<p><code>uv</code> delgates to <code>rustls-native-certs</code> which is then delegated to <code>openssl-probe</code> on unix build configurations but only when <code>--native-tls</code> is used and <code>SSL_CERT_DIR</code> or <code>SSL_CERT_FILE</code> are not set.
When <code>SSL_CERT_DIR</code> or <code>SSL_CERT_FILE</code> are set, native certs are not loaded due to <code>rustls-native-certs</code> <a href="https://github.com/rustls/rustls-native-certs/blob/3ec7d86977f04fba8d369571595b47d16c8a60f2/src/lib.rs#L118-L125">behavior</a> on this, not <code>openssl-probe</code> as a far as I can see.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michael-o">@michael-o</a> on 2026-01-09 17:08</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p><a href="https://github.com/errajibadr">@errajibadr</a> Your problem is 99% related to openssl-probe.</p>
</blockquote>
<p><a href="https://github.com/michael-o">@michael-o</a> Thanks for digging, could you provide more details as to what led you to that conclusion?</p>
<p><code>uv</code> delgates to <code>rustls-native-certs</code> which is then delegated to <code>openssl-probe</code> on unix build configurations but only when <code>--native-tls</code> is used and <code>SSL_CERT_DIR</code> or <code>SSL_CERT_FILE</code> are not set. When <code>SSL_CERT_DIR</code> or <code>SSL_CERT_FILE</code> are set, native certs are not loaded due to <code>rustls-native-certs</code> <a href="https://github.com/rustls/rustls-native-certs/blob/3ec7d86977f04fba8d369571595b47d16c8a60f2/src/lib.rs#L118-L125">behavior</a> on this, not <code>openssl-probe</code> as a far as I can see.</p>
</blockquote>
<p>openssl-probe applies heuristics to find a truststore, see https://github.com/rustls/openssl-probe/blob/4221247cfad3e77b758bf9b6e4c3d91a557c429e/src/lib.rs</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:15 UTC
    </footer>
</body>
</html>
