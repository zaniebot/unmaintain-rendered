```yaml
number: 7643
title: "`uv run --with` should not allow modifications to the `--with` environment"
type: issue
state: closed
author: charliermarsh
labels:
  - bug
assignees: []
created_at: 2024-09-23T16:07:01Z
updated_at: 2025-07-14T17:18:50Z
url: https://github.com/astral-sh/uv/issues/7643
synced_at: 2026-01-10T01:57:17Z
```

# `uv run --with` should not allow modifications to the `--with` environment

---

_Issue opened by @charliermarsh on 2024-09-23 16:07_

The `--with` dependencies use a cached environment based on the resolved dependencies. If users modify that environment, it could affect `--with` invocations in other projects.

Instead, I think we should run these commands in an empty virtual environment, with the base and `--with` environments layered atop, such that any modifications don't affect the `--with` environment.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-09-23 16:54_

---

_Label `bug` added by @charliermarsh on 2024-09-23 16:54_

---

_Comment by @charliermarsh on 2024-09-26 17:06_

I have a PR that "fixes" this by using a third empty env, but it doesn't fix Jupyter sadly since it seems to use whatever environment the binary is installed in.

---

_Unassigned @charliermarsh by @charliermarsh on 2024-09-26 17:06_

---

_Referenced in [astral-sh/uv#14447](../../astral-sh/uv/pulls/14447.md) on 2025-07-03 19:36_

---

_Comment by @charliermarsh on 2025-07-14 17:18_

Closed by https://github.com/astral-sh/uv/pull/14447; goes out in v0.8.

---

_Closed by @charliermarsh on 2025-07-14 17:18_

---
