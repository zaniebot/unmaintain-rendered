<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error when creating a lock file with disabled package management mode - astral-sh/uv #7930</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Error when creating a lock file with disabled package management mode</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/7930">#7930</a>
        opened by <a href="https://github.com/nightblure">@nightblure</a>
        on 2024-10-04 17:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nightblure">@nightblure</a> on 2024-10-04 17:08</div>
            <div class="timeline-body"><p>Hi! I finally took the time to try using this amazing tool in one of the working services but found the following problem. When I try to create a lock file with <strong>disabled package control mode</strong> (<code>package = false</code> in <em>tool.uv</em> section), I get an error:</p>
<pre><code>DEBUG uv 0.4.18 (Homebrew 2024-10-01)
DEBUG Found workspace root: `/Users/ivan/Desktop/work/pixi`
DEBUG Adding current workspace member: `/Users/ivan/Desktop/work/pixi`
DEBUG The virtual environment's Python version satisfies `Python ==3.11.*`
DEBUG Using request timeout of 30s
DEBUG Starting clean resolution
DEBUG No static `pyproject.toml` available for: pixi @ file:///Users/ivan/Desktop/work/pixi (PyprojectToml(FieldNotFound(&quot;version&quot;)))
DEBUG Acquired lock for `/Users/ivan/Library/Caches/uv/sdists-v4/path/0ecbaf84fa935616`
WARN Failed to read metadata for file: No such file or directory (os error 2)
DEBUG Preparing metadata for: pixi @ file:///Users/ivan/Desktop/work/pixi
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.11.9
DEBUG Solving with target Python version: &gt;=3.11.9
DEBUG Adding direct dependency: setuptools&gt;=40.8.0
DEBUG Found fresh response for: https://pypi.org/simple/setuptools/
DEBUG Searching for a compatible version of setuptools (&gt;=40.8.0)
DEBUG Selecting: setuptools==75.1.0 [compatible] (setuptools-75.1.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/ff/ae/f19306b5a221f6a436d8f2238d5b80925004093fa3edea59835b514d9057/setuptools-75.1.0-py3-none-any.whl.metadata
DEBUG Tried 1 versions: setuptools 1
DEBUG Split specific environment resolution took 0.002s
DEBUG Installing in setuptools==75.1.0 in /Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG
DEBUG Requirement already cached: setuptools==75.1.0
DEBUG Installing build requirement: setuptools==75.1.0
DEBUG Creating PEP 517 build environment
DEBUG Calling `setuptools.build_meta:__legacy__.get_requires_for_build_wheel()`
DEBUG Traceback (most recent call last):
DEBUG   File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
DEBUG   File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 332, in get_requires_for_build_wheel
DEBUG     return self._get_build_requires(config_settings, requirements=[])
DEBUG            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
DEBUG   File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 302, in _get_build_requires
DEBUG     self.run_setup()
DEBUG   File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 503, in run_setup
DEBUG     super().run_setup(setup_script=setup_script)
DEBUG   File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 318, in run_setup
DEBUG     exec(code, locals())
DEBUG   File &quot;&lt;string&gt;&quot;, line 23, in &lt;module&gt;
DEBUG   File &quot;&lt;string&gt;&quot;, line 18, in parse_requirements
DEBUG   File &quot;&lt;string&gt;&quot;, line 13, in read_file
DEBUG   File &quot;&lt;frozen codecs&gt;&quot;, line 918, in open
DEBUG FileNotFoundError: [Errno 2] No such file or directory: '/Users/ivan/Desktop/work/pixi/requirements.txt'
DEBUG Released lock at `/Users/ivan/Library/Caches/uv/sdists-v4/path/0ecbaf84fa935616/.lock`
error: Failed to build: `pixi @ file:///Users/ivan/Desktop/work/pixi`
  Caused by: Build backend failed to determine requirements with `build_wheel()` (exit status: 1)
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 332, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=[])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 302, in _get_build_requires
    self.run_setup()
  File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 503, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/Users/ivan/Library/Caches/uv/builds-v0/.tmp3pbodG/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 318, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 23, in &lt;module&gt;
  File &quot;&lt;string&gt;&quot;, line 18, in parse_requirements
  File &quot;&lt;string&gt;&quot;, line 13, in read_file
  File &quot;&lt;frozen codecs&gt;&quot;, line 918, in open
FileNotFoundError: [Errno 2] No such file or directory: '/Users/ivan/Desktop/work/pixi/requirements.txt'
---
</code></pre>
<p>I think this is due to the fact that I <strong>have a setup.py</strong> file in the current directory that may be accessing a requirements.txt file that does not exist. here is part of the code from setup.py:</p>
<pre><code class="language-python3">...

def parse_requirements():
    requirements_lines = [
        line.strip() for line in read_file('requirements.txt').strip().split('\n')
    ]
    return [line for line in requirements_lines if line and str.isalpha(line[0])]


REQUIREMENTS = parse_requirements()

...
</code></pre>
<p>And actually what prompted me to create this is that I specified in pyproject.toml the option to disable managing the project as a package, I assume that uv would not try to build the package, and therefore would not look into setup.py at all. My pyproject.toml:</p>
<pre><code>[tool.ruff]
target-version = &quot;py311&quot;
extend-exclude = []
line-length = 88

[tool.ruff.format]
quote-style = &quot;single&quot;

select = [
    # RULES: https://docs.astral.sh/ruff/rules/
    &quot;A&quot;,     # flake8-builtins
    &quot;B&quot;,     # flake8-bugbear
    &quot;C&quot;,     # flake8-comprehensions
    &quot;E&quot;,     # pycodestyle errors
    &quot;G&quot;,     # flake8-logging-format
    &quot;F&quot;,     # pyflakes
    &quot;I&quot;,     # isort
    &quot;N&quot;,     # PEP8 naming
    &quot;S&quot;,     # flake8-bandit
    &quot;W&quot;,     # pycodestyle warnings
    &quot;T20&quot;,   # flake8-print
    &quot;C4&quot;,    # flake8-comprehensions
    &quot;EM&quot;,    # flake8-errmsg
    &quot;UP&quot;,    # pyupgrade
    &quot;PL&quot;,    # Pylint
    &quot;PT&quot;,    # flake8-pytest-style
    &quot;ISC&quot;,   # flake8-implicit-str-concat
    &quot;ICN&quot;,   # flake8-import-conventions
    &quot;ARG&quot;,   # flake8-unused-arguments
    &quot;COM&quot;,   # flake8-commas
    &quot;FBT&quot;,   # flake8-boolean-trap
    &quot;LOG&quot;,   # flake8-logging
    &quot;SIM&quot;,   # flake8-simplify
    &quot;TRY&quot;,   # tryceratops
    &quot;PIE&quot;,   # flake8-pie
    &quot;RUF&quot;,   # Ruff-specific rules
    &quot;ASYNC&quot;, # flake8-async
]

[tool.ruff.lint.flake8-bugbear]
extend-immutable-calls = [
    &quot;fastapi.Depends&quot;,
    &quot;fastapi.params.Depends&quot;,
    &quot;fastapi.Query&quot;,
    &quot;fastapi.params.Query&quot;,
    &quot;fastapi.Body&quot;,
    &quot;fastapi.params.Body&quot;,
]

[tool.pdm]
distribution = false

[tool.pytest.ini_options]
addopts = &quot;--asyncio-mode=auto&quot;

[project]
name = &quot;pixi&quot;
dependencies = [
    &quot;pillow==10.2.0&quot;,
    &quot;requests==2.32.3&quot;,
    &quot;schedule==1.2.1&quot;,
    &quot;psycopg2-binary==2.9.9&quot;,
    &quot;pymongo==4.6.2&quot;,
    &quot;pymilvus==2.4.1&quot;,
    &quot;SQLAlchemy==2.0.31&quot;,
    &quot;fastapi==0.109.2&quot;,
    &quot;pydantic==2.6.1&quot;,
    &quot;pydantic-settings==2.1.0&quot;,
    &quot;loguru==0.7.2&quot;,
    &quot;alembic==1.13.1&quot;,
    &quot;pydash==7.0.7&quot;,
    &quot;pandas==2.2.1&quot;,
    &quot;uvicorn==0.29.0&quot;,
    &quot;PyYAML==6.0.1&quot;,
    &quot;httpx==0.27.0&quot;,
    &quot;dependency-injector==4.41.0&quot;,
]
requires-python = &quot;==3.11.*&quot;

[tool.uv]
package = false
dev-dependencies = [
    &quot;pytest==8.1.1&quot;,
    &quot;pytest-cov==5.0.0&quot;,
    &quot;pytest-asyncio==0.23.6&quot;,
    &quot;testcontainers==4.7.2&quot;,
    &quot;coverage==7.4.4&quot;,
    &quot;bump2version==1.*&quot;,
    &quot;pre-commit==3.8.*&quot;,
    &quot;Faker==25.8.0&quot;,
]
</code></pre>
<hr />
<ul>
<li>The command you invoked: <code>uv lock --verbose</code></li>
<li>The current uv platform: macOS Sequoia 15.0 (M1 cpu)</li>
<li>The current uv version (<code>uv --version</code>): <code>uv 0.4.18 (Homebrew 2024-10-01)</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-04 17:25</div>
            <div class="timeline-body"><p>The hint is here</p>
<blockquote>
<p>DEBUG No static <code>pyproject.toml</code> available for: pixi @ file:///Users/ivan/Desktop/work/pixi (PyprojectToml(FieldNotFound(&quot;version&quot;)))</p>
</blockquote>
<p>Since we can't find a <code>version</code> field in your project, we need to ask a build backend to retrieve that metadata for us.</p>
<p>We should error or something here though since <code>package = false</code> is set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-10-04 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nightblure">@nightblure</a> on 2024-10-04 17:52</div>
            <div class="timeline-body"><p>upd</p>
<p>I deleted the setup.py file and got this message in its clear form:</p>
<pre><code>ValueError: invalid pyproject.toml config: `project`.
configuration error: `project` must contain ['version'] properties
</code></pre>
<p>Could a good way out of this be a logic where uv would not ask for the version when we get option <code>package = false</code>? We may not require a version at all, or we may already manage versioning (not of a package, but of a web service in my case) using bump2version or any other utility. In PDM this is exactly how it works, because now I'm trying to switch from it to uv</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9910.html">astral-sh/uv#9910</a> on 2024-12-15 13:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:01 UTC
    </footer>
</body>
</html>
