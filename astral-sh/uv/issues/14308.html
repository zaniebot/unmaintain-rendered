<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using `tool.uv.dependency-groups` with a `uv.toml` - astral-sh/uv #14308</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using <code>tool.uv.dependency-groups</code> with a <code>uv.toml</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14308">#14308</a>
        opened by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a>
        on 2025-06-27 09:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a> on 2025-06-27 09:56</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using the below <code>pyproject.toml</code>, running <code>uv sync --all-groups</code> fails (as expected) due to</p>
<blockquote>
<p>Because the requested Python version (&gt;=3.9, &lt;4.0) does not satisfy Python&gt;=3.11 and sphinx==8.2.3 depends on Python&gt;=3.11, we can conclude that sphinx==8.2.3 cannot be used. And because test-dependency-groups:docs depends on sphinx==8.2.3 and your project requires test-dependency-groups:docs, we can conclude that your project's requirements are unsatisfiable.</p>
</blockquote>
<pre><code class="language-toml"># pyproject.toml
[project]
name = &quot;test-dependency-groups&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&lt;4.0,&gt;=3.9&quot;
dependencies = [
    &quot;requests==2.27.1; python_version == '3.9'&quot;,
    &quot;requests==2.28.1; python_version == '3.10'&quot;,
    &quot;requests==2.31.0; python_version == '3.11'&quot;,
    &quot;requests==2.32.2; python_version == '3.12'&quot;,
    &quot;requests; python_version &gt; '3.12'&quot;,
]

[dependency-groups]
docs = [
    &quot;sphinx==8.2.3&quot;,
]
</code></pre>
<p>I wanted to solve this by using <code>tool.uv.dependency-groups</code> as introduced in #13735. Indeed it works if I add it to the <code>pyproject.toml</code> like so, <code>uv</code> is indeed able to compile:</p>
<pre><code class="language-toml"># pyproject.toml
[tool.uv.dependency-groups]
docs = {requires-python = &quot;&gt;=3.11&quot;}
</code></pre>
<p>However, there are two cases that do not work as expected:</p>
<h1>Error case 1: including <code>tool.uv.dependency-groups</code> in <code>pyproject.toml</code> while <code>uv.toml</code> exists</h1>
<p>We have a <code>uv.toml</code> file for separation of concerns. When we include <code>tool.uv.dependency-groups</code> in <code>pyproject.toml</code> as the docs say and create an empty <code>uv.toml</code> file, and sync:</p>
<blockquote>
<p>warning: Found both a <code>uv.toml</code> file and a <code>[tool.uv]</code> section in an adjacent <code>pyproject.toml</code>. The <code>[tool.uv]</code> section will be ignored in favor of the <code>uv.toml</code> file.</p>
</blockquote>
<p>This still compiles successfully even though the <code>tool.uv.dependency-groups</code> section is not there. The warning message seems to indicate it would be ignored though, so I would <strong>expect this to fail</strong> like the first <code>pyproject.toml</code> <strong>without</strong> <code>[tool.uv.dependency-groups]</code>.</p>
<h1>Error case 2: including <code>dependency-groups</code> in <code>uv.toml</code></h1>
<p>We have a <code>uv.toml</code> file for separation of concerns. We include <code>dependency-groups</code> in <code>uv.toml</code> like so (and leave <code>pyproject.toml</code> as the base version):</p>
<pre><code class="language-toml"># uv.toml
[dependency-groups]
docs = {requires-python = &quot;&gt;=3.11&quot;}
</code></pre>
<p>I would <strong>expect this to succeed</strong> like the first <code>pyproject.toml</code> <strong>with</strong> <code>[tool.uv.dependency-groups]</code>. However, it fails with the same error message I mentioned first.</p>
<h1>Conclusion</h1>
<ol>
<li>The warning raised when including <code>tool.uv.dependency-groups</code> in <code>pyproject.toml</code> while <code>uv.toml</code> exists does not actually seem to be correct.</li>
<li>The error raised when including <code>dependency-groups</code> in <code>uv.toml</code> is not expected.</li>
</ol>
<h3>Platform</h3>
<p>Darwin 24.5.0 arm64</p>
<h3>Version</h3>
<p>uv 0.7.15 (4ed9c5791 2025-06-25)</p>
<h3>Python version</h3>
<p>Python 3.12.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mikeweltevrede on 2025-06-27 09:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-27 10:15</div>
            <div class="timeline-body"><p>Why are you creating the <code>uv.toml</code> next to the <code>pyproject.toml</code>, what's in that file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a> on 2025-06-27 11:02</div>
            <div class="timeline-body"><p>@konstin for separation of concerns, we like to use the <code>uv.toml</code> over the <code>pyproject.toml</code> just how we like to use <code>ruff.toml</code> and <code>.coveragerc</code> over <code>[tool.ruff]</code> and <code>[tool.coverage]</code> sections. Otherwise, it would blow up the <code>pyproject.toml</code>.</p>
<p>What we have in there, for example, is the <code>[[index]]</code> section to our corporate proxy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-27 13:37</div>
            <div class="timeline-body"><p>I don't think we support reading this from a <code>uv.toml</code>, it's project-specific metadata.</p>
<p>I am a bit confused about our merging behavior here, especially that we warn we'll ignore it but use the configuration?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "tool.uv.dependency-groups" to "Using `tool.uv.dependency-groups` with a `uv.toml`" by @zanieb on 2025-06-27 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a> on 2025-06-27 13:55</div>
            <div class="timeline-body"><p>Thanks for updating the title @zanieb. Sorry, I forgot to make it a bit concrete.</p>
<p>Indeed then the support might not be there. I am fine with putting it in the <code>pyproject.toml</code> if that is currently the only supported way but then indeed the warning should not be emitted.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Gankra by @Gankra on 2025-06-27 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-06-27 19:05</div>
            <div class="timeline-body"><ul>
<li>Case 1: #14325</li>
<li>Case 2: #14322</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a> on 2025-06-28 12:27</div>
            <div class="timeline-body"><p>@Gankra Thanks for the quick action :) I am not a Rust programmer, so the code in #14322 is not apparent to me that it would indeed allow specifying something in <code>pyproject.toml</code> while a <code>uv.toml</code> exists. Is that the case? Or would this mean that if you want to use <code>tool.uv.dependency-group</code> that you cannot use a <code>uv.toml</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-07-02 12:36</div>
            <div class="timeline-body"><p>Yeah it's intentional that you have to use <code>tool.uv.dependency-group</code> here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a> on 2025-07-04 11:36</div>
            <div class="timeline-body"><p>Alright, great. So it is still allowed to use both a <code>uv.toml</code> and <code>pyproject.toml</code> with <code>tool.uv.dependency-group</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-11 01:52</div>
            <div class="timeline-body"><p>I think what you want is a <code>uv.toml</code>, and then a <code>pyproject.toml</code> with <code>[dependency-groups]</code> (instead of <code>tool.uv.dependency-group</code>, which is effectively deprecated in favor of the standards-complaint <code>[dependency-groups]</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-07-11 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2025-07-11 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a> on 2025-07-11 16:00</div>
            <div class="timeline-body"><p>@charliermarsh I must say I am a bit surprised that a feature that was introduced only 1.5 months ago (#13735) is already deprecated right now. They also serve different purposes, where <code>tool.uv.dependency-groups</code> manages the metadata on the Python version while <code>[dependency-groups]</code> concerns libraries. But I am more than willing to move over if that would be better.</p>
<p>Could you share if there is something in the docs on how to combine</p>
<pre><code class="language-toml">[dependency-groups]
docs = [
    &quot;sphinx==8.2.3&quot;,
]
</code></pre>
<p>with</p>
<pre><code class="language-toml">[tool.uv.dependency-groups]
docs = {requires-python = &quot;&gt;=3.11&quot;}
</code></pre>
<p>One of them is a dictionary and the other is a list so it is not directly clear. Should <code>python</code> be defined like the rest of the libraries then like below, or something like that?</p>
<pre><code class="language-toml">[dependency-groups]
docs = [
    &quot;python&gt;=3.11&quot;,
    &quot;sphinx==8.2.3&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-11 16:06</div>
            <div class="timeline-body"><p>Sorry, ignore my prior comment. I was just wrong, I was misremembering <code>[tool.uv.dependency-groups]</code> as something else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikeweltevrede">@mikeweltevrede</a> on 2025-07-11 16:08</div>
            <div class="timeline-body"><p>@charliermarsh Okay, no problem ðŸ˜„ I think this is still to be marked as a bug then instead of a question?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-07-11 17:06</div>
            <div class="timeline-body"><p>Ah apologies -- what I should have said is that you must use a pyproject.toml for this setting. We consider all dependency-group and requires-python config to be &quot;project&quot; config and all &quot;project&quot; config is disallowed in uv.toml files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-07-11 17:08</div>
            <div class="timeline-body"><p>However you can still have a uv.toml file while using this setting in your pyproject.toml -- the current warning is a lie.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-07-20 22:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:03 UTC
    </footer>
</body>
</html>
