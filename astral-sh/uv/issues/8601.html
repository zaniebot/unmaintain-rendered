<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` reports no solution found when `python_version&gt;=` is used - astral-sh/uv #8601</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv sync</code> reports no solution found when <code>python_version&gt;=</code> is used</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8601">#8601</a>
        opened by <a href="https://github.com/njzjz">@njzjz</a>
        on 2024-10-27 01:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njzjz">@njzjz</a></div>
            <div class="timeline-body">

<p>Minimal reproduced <code>pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;test-uv&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [
    &#x27;jax&gt;=0.4.33;python_version&gt;=&quot;3.10&quot;&#x27;,
]
</code></pre>
<p><code>uv sync</code>:</p>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because only the following versions of jax{python_full_version &gt;= &#x27;3.10&#x27;} are available:
          jax{python_full_version &gt;= &#x27;3.10&#x27;}&lt;=0.4.33
          jax{python_full_version &gt;= &#x27;3.10&#x27;}==0.4.34
          jax{python_full_version &gt;= &#x27;3.10&#x27;}==0.4.35
      and the requested Python version (&gt;=3.9) does not satisfy Python&gt;=3.10, we can conclude that
      jax{python_full_version &gt;= &#x27;3.10&#x27;}&gt;=0.4.33 is incompatible.
      And because your project depends on jax{python_full_version &gt;= &#x27;3.10&#x27;}&gt;=0.4.33, we can conclude that your
      project&#x27;s requirements are unsatisfiable.
</code></pre>
<p>Here, I expect Python 3.9 to install nothing and Python 3.10 and above to install <code>jax&gt;=0.4.33</code>. I don&#x27;t understand uv&#x27;s logic.</p>
<p>(In the actual project, jax is an optional dependency for extra features that are only available in Python 3.10)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-27 01:54</div>
            <div class="timeline-body"><p>This is... a confusing error. Thanks for the report.</p>
<p>I don&#x27;t even understand the part that says:</p>
<blockquote>
<p>only the following versions of jax{python_full_version &gt;= &#x27;3.10&#x27;} are available:
jax{python_full_version &gt;= &#x27;3.10&#x27;}&lt;=0.4.33
jax{python_full_version &gt;= &#x27;3.10&#x27;}==0.4.34
jax{python_full_version &gt;= &#x27;3.10&#x27;}==0.4.35</p>
</blockquote>
<p>Like, why did we choose to enumerate a couple of those versions explicitly?</p>
<p>For debugging purposes... the derivation tree looks like</p>
<pre><code>Resolver derivation tree before reduction
  root==0a0.dev0 depends on test-uv*
      test-uv==0.1.0 depends on jax{python_full_version &gt;= &#x27;3.10&#x27;}&gt;=0.4.33
        no versions of Python&gt;=3.10
        no versions of jax{python_full_version &gt;= &#x27;3.10&#x27;}&gt;0.4.33, &lt;0.4.34 | &gt;0.4.34, &lt;0.4.35 | &gt;0.4.35
    no versions of test-uv&lt;0.1.0 | &gt;0.1.0
Resolver derivation tree after reduction
  test-uv==0.1.0 depends on jax{python_full_version &gt;= &#x27;3.10&#x27;}&gt;=0.4.33
    no versions of Python&gt;=3.10
    no versions of jax{python_full_version &gt;= &#x27;3.10&#x27;}&gt;0.4.33, &lt;0.4.34 | &gt;0.4.34, &lt;0.4.35 | &gt;0.4.35
</code></pre>
<p>And the <a href="https://inspector.pypi.io/project/jax/0.4.33/packages/49/48/0e32458ab7e02d75f423fe8c2ab10d7fa1aba9b314391d2659e68891912b/jax-0.4.33-py3-none-any.whl/jax-0.4.33.dist-info/METADATA#line.12"><code>Requires-Python</code> of <code>jax==0.4.33</code></a> looks fine.</p>
<p>And the verbose logs are</p>
<pre><code>❯ RUST_LOG=uv=trace uv lock -v
DEBUG uv 0.4.25 (69650e16c 2024-10-21)
TRACE Found `pyproject.toml` at: `/Users/zb/workspace/uv/pyproject.toml`
DEBUG Project is contained in non-workspace project: `/Users/zb/workspace/uv`
DEBUG Found workspace root: `/Users/zb/workspace/uv/example`
DEBUG Adding current workspace member: `/Users/zb/workspace/uv/example`
TRACE Cached interpreter info for Python 3.11.10, skipping probing: .venv/bin/python3
DEBUG The virtual environment&#x27;s Python version satisfies `Python &gt;=3.9`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: test-uv @ file:///Users/zb/workspace/uv/example
TRACE Found `pyproject.toml` at: `/Users/zb/workspace/uv/pyproject.toml`
DEBUG Project is contained in non-workspace project: `/Users/zb/workspace/uv`
DEBUG No workspace root found, using project root
TRACE Performing lookahead for test-uv @ file:///Users/zb/workspace/uv/example
DEBUG Solving with installed Python version: 3.11.10
DEBUG Solving with target Python version: &gt;=3.9
DEBUG Adding direct dependency: test-uv*
DEBUG Searching for a compatible version of test-uv @ file:///Users/zb/workspace/uv/example (*)
DEBUG Adding transitive dependency for test-uv==0.1.0: jax{python_full_version &gt;= &#x27;3.10&#x27;}&gt;=0.4.33
TRACE Fetching metadata for jax from https://pypi.org/simple/jax/
TRACE cached request https://pypi.org/simple/jax/ is storable because its response has a &#x27;public&#x27; cache-control directive
TRACE freshness lifetime found via cache-control max age setting: 600s
DEBUG Found fresh response for: https://pypi.org/simple/jax/
TRACE Received package metadata for: jax
DEBUG Searching for a compatible version of jax{python_full_version &gt;= &#x27;3.10&#x27;} (&gt;=0.4.33)
TRACE Selecting candidate for jax with range &gt;=0.4.33 with 169 remote versions
TRACE found candidate for package PackageName(&quot;jax&quot;) with range Range { segments: [(Included(&quot;0.4.33&quot;), Unbounded)] } after 1 steps: &quot;0.4.35&quot; version
DEBUG No compatible version found for: Python
DEBUG Searching for a compatible version of jax{python_full_version &gt;= &#x27;3.10&#x27;} (&gt;=0.4.33, &lt;0.4.35 | &gt;0.4.35)
TRACE Selecting candidate for jax with range &gt;=0.4.33, &lt;0.4.35 | &gt;0.4.35 with 169 remote versions
TRACE found candidate for package PackageName(&quot;jax&quot;) with range Range { segments: [(Included(&quot;0.4.33&quot;), Excluded(&quot;0.4.35&quot;)), (Excluded(&quot;0.4.35&quot;), Unbounded)] } after 2 steps: &quot;0.4.34&quot; version
DEBUG Searching for a compatible version of jax{python_full_version &gt;= &#x27;3.10&#x27;} (&gt;=0.4.33, &lt;0.4.34 | &gt;0.4.34, &lt;0.4.35 | &gt;0.4.35)
TRACE Selecting candidate for jax with range &gt;=0.4.33, &lt;0.4.34 | &gt;0.4.34, &lt;0.4.35 | &gt;0.4.35 with 169 remote versions
TRACE found candidate for package PackageName(&quot;jax&quot;) with range Range { segments: [(Included(&quot;0.4.33&quot;), Excluded(&quot;0.4.34&quot;)), (Excluded(&quot;0.4.34&quot;), Excluded(&quot;0.4.35&quot;)), (Excluded(&quot;0.4.35&quot;), Unbounded)] } after 3 steps: &quot;0.4.33&quot; version
DEBUG Searching for a compatible version of jax{python_full_version &gt;= &#x27;3.10&#x27;} (&gt;0.4.33, &lt;0.4.34 | &gt;0.4.34, &lt;0.4.35 | &gt;0.4.35)
TRACE Selecting candidate for jax with range &gt;0.4.33, &lt;0.4.34 | &gt;0.4.34, &lt;0.4.35 | &gt;0.4.35 with 169 remote versions
TRACE Exhausted all candidates for package jax with range &gt;0.4.33, &lt;0.4.34 | &gt;0.4.34, &lt;0.4.35 | &gt;0.4.35 after 169 steps
DEBUG No compatible version found for: jax{python_full_version &gt;= &#x27;3.10&#x27;}
DEBUG Searching for a compatible version of test-uv @ file:///Users/zb/workspace/uv/example (&lt;0.1.0 | &gt;0.1.0)
DEBUG No compatible version found for: test-uv
</code></pre>
<p>I think the resolver error is bogus because the resolution itself is wrong. This looks like a case where we do not fork correctly.</p>
<p>If you do:</p>
<pre><code>dependencies = [
    &#x27;jax&gt;=0.4.33;python_version&gt;=&quot;3.10&quot;&#x27;,
    &#x27;jax&gt;=0.4.33;python_version&gt;=&quot;3.10&quot;&#x27;,
]
</code></pre>
<p>it&#x27;ll force the resolver to fork here and resolution succeeds.</p>
<p>I presume this would be solved by <a href="https://github.com/astral-sh/uv/pull/6143">astral-sh/uv#6143</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-27 01:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-27 01:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-27 18:53</div>
            <div class="timeline-body"><p>It&#x27;s the same as <a href="https://github.com/astral-sh/uv/issues/4668">astral-sh/uv#4668</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-27 18:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-27 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-28 13:48</div>
            <div class="timeline-body"><p>This should &quot;just work&quot; without any workarounds in the next version (see: <a href="https://github.com/astral-sh/uv/pull/8628">astral-sh/uv#8628</a>).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:05 UTC
    </footer>
</body>
</html>
