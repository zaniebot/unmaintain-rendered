```yaml
number: 12142
title: "`uv self update` may leave uv unusable if interrupted"
type: issue
state: open
author: qin-tain
labels:
  - bug
  - help wanted
  - windows
assignees: []
created_at: 2025-03-12T19:03:55Z
updated_at: 2025-06-10T11:05:42Z
url: https://github.com/astral-sh/uv/issues/12142
synced_at: 2026-01-10T01:57:28Z
```

# `uv self update` may leave uv unusable if interrupted

---

_Issue opened by @qin-tain on 2025-03-12 19:03_

### Description:

The current update process renames `uv.exe` to `uv.exe.previous.exe` before completing. If interrupted (e.g., by network failures or manual termination), this can leave uv unusable due to an incomplete update.

### Suggested Improvement:

Ensure atomic replacement where `uv.exe` is only modified after the new version is fully validated. 

---

_Comment by @zanieb on 2025-03-12 19:37_

I'm not sure we can do an atomic replacement here because of limitations on removing currently running executables on Windows, but we can probably narrow the time in which this can fail.

---

_Label `bug` added by @zanieb on 2025-03-12 19:37_

---

_Label `help wanted` added by @zanieb on 2025-03-12 19:37_

---

_Label `windows` added by @zanieb on 2025-03-12 19:37_

---

_Comment by @Winand on 2025-03-22 09:30_

@zanieb I'm not sure if my problem belongs here, but
in theory can we check if `uvx` is not running before performing self update?
Sometimes I just forget that i've started uvx in some terminal window.
```
PS C:\Users\username> uv self update
info: Checking for updates...
error: The installation failed. Output from the installer: Downloading uv 0.6.9 (x86_64-pc-windows-msvc)
Installing to C:\Users\username\.local\bin
uv.exe
We encountered an error trying to perform the installation;
please review the error messages below.

����� �� ����� ������� ����� � 䠩�� "C:\Users\username\.local\bin\uvx.exe", ⠪ ��� ��� 䠩� �ᯮ������ ��㣨� ����ᮬ.
```

---

_Comment by @zanieb on 2025-04-01 17:09_

I'm not sure we can easily tell. I think we just need to move it to a temporary directory instead of trying to remove it. This is a Windows-specific thing though.

---

_Referenced in [astral-sh/uv#12816](../../astral-sh/uv/issues/12816.md) on 2025-04-27 13:23_

---

_Comment by @AlexBlandin on 2025-06-06 23:03_

I think "atomic replacement" here is not "true" atomic (in the concurrency primitive sense) but rather the colloquial idea that instead of immediately renaming `uv.exe` to `uv.exe.previous.exe`, simply delay that step until after the new executable is ready to replace it, and indeed to make the window for error as small as possible? I may be misunderstanding the original issue, but the general idea of "keeping things working even if they fail" does seem implicit either way.

The updater logic here follows [self-replace](https://docs.rs/self-replace/latest/self_replace/), and is an appropriate solution, but I would imagine there is some error propagation that isn't happening: if this is occurring on network errors, not just the more obvious (external) aborts that would naturally leave a mess, then clearly something is amiss. It may not be uv's fault, deferring largely to [axoupdater](https://github.com/axodotdev/axoupdater) as it does, which [should](https://github.com/axodotdev/axoupdater/blob/main/axoupdater/src/lib.rs#L484) move/rename the file back if the update fails... but clearly hasn't. Where the specific problem lies, though, I clearly haven't gleamed from my admittedly quick skim-through.

---

_Comment by @konstin on 2025-06-10 11:05_

CC @Gankra

---
