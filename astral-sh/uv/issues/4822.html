<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv toolchain installs debug Python versions - astral-sh/uv #4822</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv toolchain installs debug Python versions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4822">#4822</a>
        opened by <a href="https://github.com/gusutabopb">@gusutabopb</a>
        on 2024-07-05 06:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gusutabopb">@gusutabopb</a></div>
            <div class="timeline-body"><p>When used on Linux (Ubuntu), <code>uv toolchain</code> installs debug Python versions. This leads to some programs printing out various debug messages meant for CPython core developers, not regular Python users.</p>
<p>This can be confirmed by checking that <code>sys.abiflags</code> is <code>d</code>, which as per <a href="https://peps.python.org/pep-3149/">PEP-3149</a>, means the installed CPython was compiled with the <code>--with-pydebug</code> flag.</p>
<p>Sample debug message which shouldn&#x27;t be shown:</p>
<pre><code>Immortal Object has less refcnt than expected.
object address  : 0x7f722f0517b0
object refcount : 4294967294
object type     : 0x7f722ef28be0
object type name: bytes
object repr     : b&#x27;L&#x27;
</code></pre>
<p>Also, when building wheels (with <code>pip wheel</code>), the resulting file name contains <code>cp312d</code> instead of <code>cp312</code>. Examples:</p>
<p>With debug flag (CPython installed by <code>uv</code>)</p>
<pre><code>packagename-cp312-cp312d-linux_x86_64.whl
</code></pre>
<p>Regular CPython:</p>
<pre><code>packagename-cp312-cp312-linux_x86_64.whl
</code></pre>
<p>I was able to reproduce this using Ubuntu, but on macOS the installed toolchains did not have the <code>d</code> flag, so this issue&#x27;s impact seems limited to Linux.</p>
Steps to reproduce the issue
<ol>
<li>Install toolchain</li>
</ol>
<pre><code>&gt; uv toolchain install 3.12 --verbose
DEBUG uv 0.2.21
warning: `uv toolchain install` is experimental and may change without warning.
DEBUG Acquired lock for `/home/ubuntu/.local/share/uv/toolchains`
Looking for toolchain Python 3.12 (any-3.12-any-any-any)
Found installed toolchain `cpython-3.12.3-linux-aarch64-gnu` that satisfies Python 3.12
Requested toolchain already installed.
</code></pre>
<ol>
<li>Create/activate venv</li>
</ol>
<pre><code>&gt; uv venv --preview --python 3.12 --verbose &amp;&amp; . .venv/bin/activate.fish
DEBUG uv 0.2.21
DEBUG Searching for Python 3.12 in managed toolchains or system path
DEBUG Searching for managed toolchains at `/home/ubuntu/.local/share/uv/toolchains`
DEBUG Found managed toolchain `cpython-3.12.3-linux-aarch64-gnu`
DEBUG Found cpython 3.12.3 at `/home/ubuntu/.local/share/uv/toolchains/cpython-3.12.3-linux-aarch64-gnu/install/bin/python3` (managed toolchains)
Using Python 3.12.3 interpreter at: /home/ubuntu/.local/share/uv/toolchains/cpython-3.12.3-linux-aarch64-gnu/install/bin/python3
Creating virtualenv at: .venv
INFO Removing existing directory
Activate with: source .venv/bin/activate.fish
</code></pre>
<ol>
<li>Check <code>abiflags</code></li>
</ol>
<pre><code>python -c &#x27;import sys; print(f&quot;{sys.version=} {sys.abiflags=}&quot;)&#x27;
sys.version=&#x27;3.12.3 (main, Apr 15 2024, 17:09:34) [GCC 6.3.0 20170516]&#x27; sys.abiflags=&#x27;d&#x27;
</code></pre>
Other info
<pre><code>&gt; lsb_release -a
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 23.10
Release:	23.10
Codename:	mantic

&gt; uv --version
uv 0.2.21
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-05 12:27</div>
            <div class="timeline-body"><p>I think this is fixed by <a href="https://github.com/astral-sh/uv/pull/4775">astral-sh/uv#4775</a> (which hasnâ€™t been released IIRC).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gusutabopb">@gusutabopb</a> on 2024-07-05 14:11</div>
            <div class="timeline-body"><p>That seems to be the case indeed. I will close this issue as it&#x27;s a dupe of  #4774.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/gusutabopb">@gusutabopb</a> on 2024-07-05 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/helderco">@helderco</a> on 2024-07-05 14:12</div>
            <div class="timeline-body"><p>So this is a duplicate of <a href="https://github.com/astral-sh/uv/issues/4774">astral-sh/uv#4774</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/helderco">@helderco</a> on 2024-07-05 14:13</div>
            <div class="timeline-body"><p>@gusutabopb commented at the same time ðŸ˜„</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:31:52 UTC
    </footer>
</body>
</html>
