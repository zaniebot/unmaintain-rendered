<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv selects an unavailable onnxruntime version (1.20.1) despite it not existing on PyPI for the given platform - astral-sh/uv #11274</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv selects an unavailable onnxruntime version (1.20.1) despite it not existing on PyPI for the given platform</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11274">#11274</a>
        opened by <a href="https://github.com/markovejnovic">@markovejnovic</a>
        on 2025-02-06 08:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/markovejnovic">@markovejnovic</a> on 2025-02-06 08:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<h4>Preface</h4>
<p><em>Note: I have observed the following issue with <code>poetry</code> too. Considering I believe <code>uv</code> shares this issue with <code>poetry</code>, I am opening a ticket with <code>uv</code> too. This ticket will resemble the aforementioned https://github.com/python-poetry/poetry/issues/10151</em></p>
<p><code>uv</code> appears to select an <code>onnxruntime</code> version which is incompatible with my system. With a very minimal <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;bugs&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = []
requires-python = &quot;&gt;=3.9,&lt;4.0&quot;
dependencies = [
    &quot;onnxruntime&quot;,
]
</code></pre>
<p><code>uv</code> selects the <code>1.20.1</code> <code>onnxruntime</code> package. This is, however, incompatible with my system, as evidenced by pip index and I would expect a <code>1.19.2</code>:</p>
<pre><code>$ uv run pip index versions onnxruntime
WARNING: pip index is currently an experimental command. It may be removed/changed in a future release without prior warning.
onnxruntime (1.19.2)
Available versions: 1.19.2, 1.19.0, 1.18.1, 1.18.0, 1.17.3, 1.17.1, 1.17.0, 1.16.3, 1.16.2, 1.16.1, 1.16.0, 1.15.1, 1.15.0, 1.14.1, 1.14.0, 1.13.1, 1.12.1, 1.12.0, 1.11.1, 1.11.0, 1.10.0, 1.9.0, 1.8.1, 1.8.0, 1.7.0
</code></pre>
<p>I have attached the <a href="https://github.com/user-attachments/files/18686398/uv_lock.txt">uv.lock file</a>. Notice</p>
<pre><code class="language-toml">[[package]]
name = &quot;onnxruntime&quot;
version = &quot;1.20.1&quot;
</code></pre>
<p>I've installed <code>uv</code> as per the recommended way via the install script.</p>
<h3>Platform</h3>
<p>Rocky Linux 9.4 (Blue Onyx)</p>
<h3>Version</h3>
<p>uv 0.5.29</p>
<h3>Python version</h3>
<p>Python 3.9.18</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @markovejnovic on 2025-02-06 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-06 13:57</div>
            <div class="timeline-body"><p>You can solve this with:</p>
<pre><code class="language-toml">[project]
name = &quot;bugs&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = []
requires-python = &quot;==3.9.*&quot;
dependencies = [
    &quot;onnxruntime&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markovejnovic">@markovejnovic</a> on 2025-02-06 17:34</div>
            <div class="timeline-body"><p>Perhaps, I'll give it a shot when I'm at my computer. That being said, it does feel wrong that uv picked a version of the package that is <a href="https://pypi.org/project/onnxruntime/#files">incompatible</a> with the current working interpreter.</p>
<p>Also I would like to avoid pinning the python version in my project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-06 17:36</div>
            <div class="timeline-body"><p>Of course, but it's inherently a fairly hard problem. The package doesn't publish source distributions and has limited platform support. It's <em>impossible</em> to come up with a resolution that covers all possible platforms. This is a more narrow case, but that's why it isn't working here. We see a version that has support for at least one of the platforms you care about (i.e., platform support for Python 3.10 onward), and we choose that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-06 17:49</div>
            <div class="timeline-body"><p>(I agree the experience here should be better; just trying to explain what's going on and why it's difficult. We also don't privilege the currently-running interpreter at all, which I think is correct -- we're solving generically, ignoring your platform, Python version, etc., but also contributes here.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-06 17:57</div>
            <div class="timeline-body"><p>I kind of expected this to work:</p>
<pre><code class="language-toml">[project]
name = &quot;bugs&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = []
requires-python = &quot;&gt;=3.9,&lt;4.0&quot;
dependencies = [
    &quot;onnxruntime&quot;,
]

[tool.uv]
environments = [
    &quot;python_version == '3.9'&quot;,
    &quot;python_version &gt; '3.9'&quot;,
]
</code></pre>
<p>Which is a nicer solution in that you don't have to change your supported Python range. But it's not working as expected, so looking into that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markovejnovic">@markovejnovic</a> on 2025-02-06 19:51</div>
            <div class="timeline-body"><p>Okay so I don't think this is a uv issue. after discussing with the maintainers of poetry, I've learned that poetry relies on the python-requires value in onnxruntime's project declaration rather than which packages are actually available for my python distribution.</p>
<p>uv likely does the same and that seems like a natural and good behavior.</p>
<p>I'm closing this ticket consequently. Please refer to the poetry ticket for the exact discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @markovejnovic on 2025-02-06 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/markovejnovic">@markovejnovic</a> on 2025-02-06 19:52</div>
            <div class="timeline-body"><p>@dimbleby has kindly opened a PR to amend the issue on onnxruntime's side https://github.com/microsoft/onnxruntime/pull/23604</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:52:49 UTC
    </footer>
</body>
</html>
