<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recursive extra dependencies don't compile like pip-tools - astral-sh/uv #1987</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Recursive extra dependencies don't compile like pip-tools</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1987">#1987</a>
        opened by <a href="https://github.com/jdawang">@jdawang</a>
        on 2024-02-26 16:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jdawang">@jdawang</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Essentially the same issue as https://github.com/jazzband/pip-tools/issues/1685. When you have a recursive extras in a <code>pyproject.toml</code> for a private project, <code>uv pip compile</code> fails. If the project is uploaded to an index, then it looks in the index first, but I'd expect it to prioritize the self-reference in <code>pyproject.toml</code>.</p>
<p><strong>Info</strong></p>
<ul>
<li>Platform: macOS Sonoma 14.3</li>
<li>uv version: v0.1.10</li>
<li>command: <code>uv pip compile pyproject.toml --extra=dev</code></li>
</ul>
<p><strong>Reproducible example (from pip-tools issue)</strong></p>
<p>Minimal <code>pyproject.toml</code></p>
<pre><code class="language-toml">[project]
name = &quot;privateproject&quot;
version = &quot;0.0.1&quot;
dependencies = [
    &quot;tomli&quot;,
]

[project.optional-dependencies]
test = [
    &quot;pep517&quot;,
]
dev = [
    &quot;privateproject[test]&quot;,
]
</code></pre>
<p>With pip-tools, this is the output:</p>
<pre><code class="language-bash">❯ pip-compile pyproject.toml --extra=dev
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.10
# by the following command:
#
#    pip-compile --extra=dev pyproject.toml
#

pep517==0.13.1
    # via privateproject
privateproject[test] @ file:///...
    # via file:///...
tomli==2.0.1
    # via
    #   pep517
    #   privateproject
    #   privateproject (pyproject.toml)
</code></pre>
<p>With uv, this is the output:</p>
<pre><code class="language-bash">❯ uv pip compile pyproject.toml --extra=dev
  × No solution found when resolving dependencies:
  ╰─▶ Because privateproject[test] was not found in the package registry and privateproject depends on privateproject[test], we can conclude that
      the requirements are unsatisfiable.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-26 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-26 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 19:09</div>
            <div class="timeline-body"><p>I thought I fixed this but I'll take another look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 19:44</div>
            <div class="timeline-body"><p>Ahh this is slightly different, you're passing the <code>pyproject.toml</code> directly, I see.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 19:44</div>
            <div class="timeline-body"><p><code>echo &quot;privateproject[test] @ ./privateproject&quot; | cargo run pip compile - -n</code> works without issue, for reference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-26 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 20:44</div>
            <div class="timeline-body"><p>Fixed in the next release, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jdawang">@jdawang</a> on 2024-02-26 21:15</div>
            <div class="timeline-body"><p>Thanks for the quick fix!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:01 UTC
    </footer>
</body>
</html>
