```yaml
number: 13695
title: "`uv tool install --reinstall` does not preserve packages injected with `--with`"
type: issue
state: closed
author: GideonBear
labels:
  - enhancement
assignees: []
created_at: 2025-05-28T07:29:29Z
updated_at: 2025-07-09T10:59:30Z
url: https://github.com/astral-sh/uv/issues/13695
synced_at: 2026-01-10T01:57:31Z
```

# `uv tool install --reinstall` does not preserve packages injected with `--with`

---

_Issue opened by @GideonBear on 2025-05-28 07:29_

### Summary

I'm working on a feature for Topgrade (https://github.com/topgrade-rs/topgrade/pull/1122) that would upgrade uv's managed python (in absence of a uv-native feature). After that upgrade, it will automatically `--reinstall` all tools (by `tool list`), to un-break them. However, this will lose any injected packages installed with `--with`:
```console
$ uv tool install pre-commit --with pre-commit-uv
Resolved 11 packages in 67ms
Installed 11 packages in 10ms
 + cfgv==3.4.0
 + distlib==0.3.9
 + filelock==3.18.0
 + identify==2.6.12
 + nodeenv==1.9.1
 + platformdirs==4.3.8
 + pre-commit==4.2.0
 + pre-commit-uv==4.1.4
 + pyyaml==6.0.2
 + uv==0.7.8
 + virtualenv==20.31.2
Installed 1 executable: pre-commit
$ ls ~/.local/share/uv/tools/pre-commit/lib/python3.13/site-packages/ | rg pre_commit_uv
â€¢ <stdin> 
15:pre_commit_uv
16:pre_commit_uv-4.1.4.dist-info
17:pre_commit_uv_patch.pth
$ uv tool install --reinstall pre-commit
Resolved 9 packages in 84ms
Prepared 9 packages in 1ms
Uninstalled 11 packages in 8ms
Installed 9 packages in 7ms
 ~ cfgv==3.4.0
 ~ distlib==0.3.9
 ~ filelock==3.18.0
 ~ identify==2.6.12
 ~ nodeenv==1.9.1
 ~ platformdirs==4.3.8
 ~ pre-commit==4.2.0
 - pre-commit-uv==4.1.4
 ~ pyyaml==6.0.2
 - uv==0.7.8
 ~ virtualenv==20.31.2
Installed 1 executable: pre-commit
$ ls ~/.local/share/uv/tools/pre-commit/lib/python3.13/site-packages/ | rg pre_commit_uv
$ 
```
There is currently **no way** to retrieve the injected packages, without listing packages in the environment and injecting them all manually. (Something like `uv tool install pre-commit --with cfgv --with distlib --with identify --with nodeenv --with platformdirs --with pre-commit-uv --with pyyaml --with uv --with virtualenv` works as a workaround)

### Example

Is it acceptable to store the injected packages in `uv-receipt.toml`, so they can be kept on re-install?
Then we can either:
1. Do this by default, and print a clear warning when this happens stating that the injected package is not removed
2. Do this only when a separate flag is passed (e.g. `--include-injected` or `--inexact`)

How does this sound? I can probably implement this.

---

_Label `enhancement` added by @GideonBear on 2025-05-28 07:29_

---

_Comment by @amogus07 on 2025-07-08 21:42_

I'd like to have it work like to pipx (inject, uninject)

---

_Comment by @zanieb on 2025-07-08 22:18_

We have a native fix for Python upgrades now (#13954).

I don't think we'll change the reinstall behavior. A `uv tool list --output-format json` option would be best for cases where people are trying to build automations around tools.

We intentionally do not have `pipx inject` behaviors, as we want tool environments to be declarative and not imperatively mutated.



---

_Closed by @zanieb on 2025-07-08 22:18_

---

_Referenced in [astral-sh/uv#13633](../../astral-sh/uv/issues/13633.md) on 2025-07-09 05:25_

---

_Comment by @GideonBear on 2025-07-09 10:59_

Indeed, #13962's `with_requirements` contains this information.

---
