<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSL certificate verification paths not configured correctly when Python is installed via uv (in Red Hat UBI8 base image) - astral-sh/uv #16703</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>SSL certificate verification paths not configured correctly when Python is installed via uv (in Red Hat UBI8 base image)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16703">#16703</a>
        opened by <a href="https://github.com/winwinashwin">@winwinashwin</a>
        on 2025-11-12 11:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/winwinashwin">@winwinashwin</a> on 2025-11-12 11:58</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using uv to install and run Python inside a Red Hat UBI8-based container, the resulting Python environment does not appear to have correct SSL verification paths configured.</p>
<p>Standard HTTPS connections (e.g., via requests, aiohttp etc) fail due to missing or misconfigured CA certificates.
Inspecting the SSL configuration shows that the default verify paths are either empty or pointing to incorrect locations.</p>
<h3>MRE</h3>
<ol>
<li>Dockerfile (uv managed python)</li>
</ol>
<pre><code class="language-Dockerfile"># uv.Dockerfile

FROM redhat/ubi8:latest

COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/
ENV UV_LINK_MODE=copy

RUN echo -e 'import ssl; print(ssl.get_default_verify_paths())' &gt; /app.py

CMD [&quot;uv&quot;, &quot;run&quot;, &quot;--python&quot;, &quot;3.11.13&quot;, &quot;/app.py&quot;]
</code></pre>
<ol start="2">
<li>Dockerfile (native python)</li>
</ol>
<pre><code class="language-Dockerfile"># native.Dockerfile

FROM redhat/ubi8:latest

RUN yum update -y &amp;&amp; yum install -y python3.11 &amp;&amp; yum clean all
RUN echo -e 'import ssl; print(ssl.get_default_verify_paths())' &gt; /app.py

CMD [&quot;/usr/bin/python3.11&quot;, &quot;/app.py&quot;]
</code></pre>
<ol start="3">
<li>Build images</li>
</ol>
<pre><code class="language-bash">docker build -t uv-ssl-test:uv -f uv.Dockerfile .
docker build -t uv-ssl-test:native -f native.Dockerfile .

</code></pre>
<ol start="4">
<li>Run the examples</li>
</ol>
<pre><code class="language-bash">$ docker run --rm uv-ssl-test:uv
Downloading cpython-3.11.13-linux-x86_64-gnu (download) (28.8MiB)
 Downloading cpython-3.11.13-linux-x86_64-gnu (download)
DefaultVerifyPaths(cafile=None, capath='/etc/ssl/certs', openssl_cafile_env='SSL_CERT_FILE', openssl_cafile='/etc/ssl/cert.pem', openssl_capath_env='SSL_CERT_DIR', openssl_capath='/etc/ssl/certs')


$ docker run --rm uv-ssl-test:native
DefaultVerifyPaths(cafile='/etc/pki/tls/cert.pem', capath='/etc/pki/tls/certs', openssl_cafile_env='SSL_CERT_FILE', openssl_cafile='/etc/pki/tls/cert.pem', openssl_capath_env='SSL_CERT_DIR', openssl_capath='/etc/pki/tls/certs')
</code></pre>
<h3>Platform</h3>
<p>Linux 6.6.105+ x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.9.8</p>
<h3>Python version</h3>
<p>Python 3.11.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @winwinashwin on 2025-11-12 11:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../cleanlab/cleanlab-tlm/issues/133.html">cleanlab/cleanlab-tlm#133</a> on 2025-11-12 12:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-11-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-11-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-12 13:54</div>
            <div class="timeline-body"><p>If you install <code>python3.11</code> with yum, it installs the <code>ca-certificates</code> package as a dependency. That's the package that has all the certificates and is missing in the uv-managed Dockerfile. As an alternative, there's also the certifi package, which bundles CA certificates as a Python package instead of a yum package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winwinashwin">@winwinashwin</a> on 2025-11-12 14:18</div>
            <div class="timeline-body"><p>@konstin I ran <code>yum install -y ca-certificates &amp;&amp; update-ca-trust</code>. uv python still doesn't use the correct directories. Am I missing something?</p>
<p>I'm aware of explicitly setting <code>SSL_CERT_FILE</code> and <code>SSL_CERT_DIR</code> but I was expecting uv python to work out of the box.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-12 14:25</div>
            <div class="timeline-body"><p>I'm not too familiar with how the <code>ssl</code> module works and previously installing <code>ca-certificates</code> made it work, maybe @geofft or @jjhelmus know.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winwinashwin">@winwinashwin</a> on 2025-11-18 11:57</div>
            <div class="timeline-body"><p>@geofft @jjhelmus Any comments?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-11-18 14:53</div>
            <div class="timeline-body"><p>This is interesting. Compared to Fedora (<code>fedora:42</code>), this RHEL image does not ship the symlink /etc/ssl/cert.pem. If you do a <code>ln -s ../pki/tls/cert.pem /etc/ssl</code>, then things works fine.</p>
<p>In fact there are several symlinks in /etc/ssl in Fedora that point at /etc/pki/tls (or directly at the files the symlinks in there point to), and the RHEL image only has /etc/ssl/certs -&gt; /etc/pki/tls/certs. Furthermore, on RHEL, that directory does not contain the symlinks that  <a href="https://docs.openssl.org/3.5/man1/openssl-rehash/"><code>openssl rehash</code></a> creates. On Fedora it does. I think if it contained the hash symlinks, things would also work fine, but I haven't tested.</p>
<p>I suppose we can patch our build of OpenSSL to special-case this RHEL location and look for it, but I wonder if there's a specific reason that RHEL doesn't make all of these symlinks.</p>
<p>(... on the other hand, the fact that /etc/ssl/openssl.cnf doesn't exist is slightly convenient in that it avoids #15327)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winwinashwin">@winwinashwin</a> on 2025-11-18 15:40</div>
            <div class="timeline-body"><p>I also noticed that curl doesn't have this issue.</p>
<pre><code class="language-bash">$ curl -vvvv https://dns.google.com |&amp; grep 'CA'
*   CAfile: /etc/pki/tls/certs/ca-bundle.crt
  CApath: none
</code></pre>
<p>curl seems to be handling this at <a href="https://github.com/curl/curl/blob/80005b4c8a5743aa48f6164f5da602cd8416451d/acinclude.m4#L1195">compile time</a>.</p>
<blockquote>
<p>I suppose we can patch our build of OpenSSL to special-case this RHEL location and look for it</p>
</blockquote>
<p>So maybe this is not a bad idea?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-11-18 15:51</div>
            <div class="timeline-body"><p>That isn't surprising - the version of curl inside the RHEL image is provided by RHEL, and therefore uses the OpenSSL library, configuration, and norms from RHEL. The version of Python we install is not specific to RHEL (or Fedora or anything else); we build a single Python that's expected to work across all distributions.</p>
<p>I found https://bugzilla.redhat.com/show_bug.cgi?id=1053882 which explains why Fedora has these symlinks: they are specifically for compatibility with non-Fedora-packaged software. I do see some upstream CPython SSL folks at the very end of that thread. It looks like that bug was actually resolved relatively recently, and RHEL's ca-certificates package appears to have branched before it.</p>
<p>It does look like the UBI9 base image has these symlinks and things work:</p>
<pre><code>$ docker run --rm -it redhat/ubi9:latest
# ls -l /etc/ssl
total 0
lrwxrwxrwx 1 root root 49 Aug 19  2024 cert.pem -&gt; /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem
lrwxrwxrwx 1 root root 18 Aug 19  2024 certs -&gt; /etc/pki/tls/certs
lrwxrwxrwx 1 root root 28 Aug 19  2024 ct_log_list.cnf -&gt; /etc/pki/tls/ct_log_list.cnf
lrwxrwxrwx 1 root root 24 Aug 19  2024 openssl.cnf -&gt; /etc/pki/tls/openssl.cnf
# curl -LSsf https://astral.sh/uv/install.sh | sh
# uvx python3.14
Python 3.14.0 (main, Oct 31 2025, 23:03:06) [Clang 21.1.4 ] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import urllib.request
&gt;&gt;&gt; urllib.request.urlopen(&quot;https://astral.sh&quot;)
&lt;http.client.HTTPResponse object at 0x7fb0ca3a86a0&gt;
</code></pre>
<p>Is using the UBI9 image an option for you?</p>
<p>That said the fact that they made this change in EL9 makes me more comfortable with doing this kind of patch (i.e., there's no specific reason why RHEL wants third-party applications <em>not</em> to use this directory). It'd be kind of nice not to do a patch for older OSes but EL8 is still supported for many years....</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/python-build-standalone/issues/858.html">astral-sh/python-build-standalone#858</a> on 2025-11-18 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winwinashwin">@winwinashwin</a> on 2025-11-18 16:31</div>
            <div class="timeline-body"><blockquote>
<p>Is using the UBI9 image an option for you?</p>
</blockquote>
<p>Yup, We are actually in the process of migrating to UBI10. So this won't be an issue anymore!</p>
<p>Thank you so much for all the help and clarifications!!</p>
<p>Closing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @winwinashwin on 2025-11-18 16:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:14 UTC
    </footer>
</body>
</html>
