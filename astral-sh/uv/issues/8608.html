<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empty `UV_TOOL_DIR` and `UV_TOOL_DIR_BIN` environment variables treated differently - astral-sh/uv #8608</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Empty `UV_TOOL_DIR` and `UV_TOOL_DIR_BIN` environment variables treated differently</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8608">#8608</a>
        opened by <a href="https://github.com/NathanVaughn">@NathanVaughn</a>
        on 2024-10-27 17:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/NathanVaughn">@NathanVaughn</a> on 2024-10-27 17:23</div>
            <div class="timeline-body"><p>Hello,</p>
<p>I noticed that <code>uv</code> treats the environment variables <code>UV_TOOL_DIR</code> and <code>UV_TOOL_BIN_DIR</code> differently when they exist, but are set to blank values. I was trying to make a devcontainer with some tools pre-installed by uv in a different directory, so that the user's home directory could be cached separately as a mounted volume. Simplified Dockerfile:</p>
<pre><code class="language-dockerfile">FROM ghcr.io/astral-sh/uv:0.4.27-python3.12-bookworm

ENV UV_TOOL_DIR=/opt/uv/tools
ENV UV_TOOL_BIN_DIR=/opt/uv/tools/bin

ENV PATH=&quot;$PATH:/root/.local/bin:/opt/uv/tools/bin&quot;

RUN uv tool install cowsay

ENV UV_TOOL_DIR=&quot;&quot;
ENV UV_TOOL_BIN_DIR=&quot;&quot;
</code></pre>
<p>Running <code>unset UV_TOOL_DIR</code> doesn't do anything in this context (see <a href="https://stackoverflow.com/a/57189273/9944427">this thread</a>), so I set the environment variables to a blank value instead.</p>
<p>Now, running the following commands get this output:</p>
<pre><code class="language-bash">docker build -t test .

echo &quot;Tool dir&quot;
docker run --rm test uv tool dir
echo &quot;Tool bin dir&quot;
docker run --rm test uv tool dir --bin
</code></pre>
<pre><code class="language-bash">$ ./test.sh 
Tool dir

Tool bin dir
/root/.local/bin
</code></pre>
<p>With <code>uv tool dir</code> returning a blank value, installing or running a tool now installs it in the current directory. However, <code>uv tool dir --bin</code> does what I would expect.</p>
<p>I believe this is a bug, and <code>UV_TOOL_DIR</code> set to a blank value should be treated as unset, and default to the fallback options like <code>$HOME/.local/share/uv/tools</code> on UNIX, as described at <a href="https://docs.astral.sh/uv/reference/cli/#uv-tool-dir">https://docs.astral.sh/uv/reference/cli/#uv-tool-dir</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaby">@gaby</a> on 2024-10-27 23:22</div>
            <div class="timeline-body"><p>@NathanVaughn Do this instead:</p>
<pre><code class="language-Dockerfile">ENV UV_TOOL_DIR=
ENV UV_TOOL_BIN_DIR=
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NathanVaughn">@NathanVaughn</a> on 2024-10-27 23:25</div>
            <div class="timeline-body"><p>I tried that as well and it has the same result. The easy fix is to just redefine it back to the default like</p>
<pre><code class="language-dockerfile">ENV UV_TOOL_DIR=/root/.local/share/uv/tools
ENV UV_TOOL_BIN_DIR=/root/.local/bin
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaby">@gaby</a> on 2024-10-27 23:26</div>
            <div class="timeline-body"><p>Sounds like a bug to me then</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.5.0" by @charliermarsh on 2024-10-28 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-10-28 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "v0.5.0" by @zanieb on 2024-11-25 20:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.6.0" by @zanieb on 2024-11-25 20:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "v0.6.0" by @zanieb on 2025-02-15 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.7.0" by @zanieb on 2025-02-15 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12905.html">astral-sh/uv#12905</a> on 2025-04-15 20:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-21 19:15</div>
            <div class="timeline-body"><p>Will be fixed in #12843</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-21 19:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:19 UTC
    </footer>
</body>
</html>
