<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>priority of packages that exist on multiple indexes - astral-sh/uv #10099</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>priority of packages that exist on multiple indexes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10099">#10099</a>
        opened by <a href="https://github.com/youkaichao">@youkaichao</a>
        on 2024-12-22 17:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/youkaichao">@youkaichao</a></div>
            <div class="timeline-body"><p>Hi, I'm a developer from the https://github.com/vllm-project/vllm project, and we love <code>uv</code>! Thanks for the great project, it's really fast!</p>
<p>Recently, I'm looking into the issues https://github.com/vllm-project/vllm/issues/9244 and https://github.com/astral-sh/uv/issues/8082 .</p>
<p>To be compatible with <code>uv</code>, I have changed the way to host nightly wheels in https://github.com/vllm-project/vllm/pull/11404 . And now <code>uv pip install --pre -U vllm --extra-index-url=https://dsefy9jmd4lqu.cloudfront.net/nightly/</code> works.</p>
<p>Surprisingly, <code>uv pip install --pre vllm --extra-index-url https://dsefy9jmd4lqu.cloudfront.net/33f460b17a54acb3b6cc0b03f4a17876cff5eafd/</code> also works. It will install <code>0.6.3.dev28+g33f460b1.d20240927</code> version.</p>
<p>However, if I directly use <code>pip</code> , it does not work. <code>pip</code> tries to install the latest version <code>0.6.5</code> from pypi, ignoring the pre-released version.</p>
<p>So, my guess:</p>
<p>when I specify <code>--pre</code>, <code>uv</code> will only look for pre-released versions excluding released versions, while <code>pip</code> will only include pre-released versions but sort all versions available to determine the latest version.</p>
<p>Is this understanding correct?</p>
<p>If this is correct, I'd like to know, if the difference in behavior a desired feature or a bug that will be fixed later?</p>
<p>To be clear, I want this feature. My use case is, I want people to be able to install any dev version of vllm by simply changing the commit hash in the index, so that they can easily bisect vLLM's behavior to find the relevant commit they care about.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/youkaichao">@youkaichao</a> on 2024-12-22 17:59</div>
            <div class="timeline-body"><p>I'm using uv 0.5.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-22 18:09</div>
            <div class="timeline-body"><p>Please see https://docs.astral.sh/uv/pip/compatibility/#pre-release-compatibility â€” let me know if you still have questions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-12-22 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/youkaichao">@youkaichao</a> on 2024-12-22 18:52</div>
            <div class="timeline-body"><p>Thanks for the quick response!</p>
<p>I read the doc, but still don't understand.</p>
<p>In my case of <code>uv pip install --pre vllm --extra-index-url https://dsefy9jmd4lqu.cloudfront.net/33f460b17a54acb3b6cc0b03f4a17876cff5eafd/</code> , there are multiple released versions from pypi , and one pre-released version from the extra index url. And <code>uv</code> is doing the right thing I want, which is to use the latest pre-released version.</p>
<p>The doc you link to, seems to be related to <code>dependency resolution</code>, while I assume my question is more about selecting the top-level root package to install in the first place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/youkaichao">@youkaichao</a> on 2024-12-22 19:39</div>
            <div class="timeline-body"><p>In addition, I find another desired behavior from <code>uv</code>:</p>
<p><code>uv pip install --pre vllm -i https://dsefy9jmd4lqu.cloudfront.net/33f460b17a54acb3b6cc0b03f4a17876cff5eafd/</code> works (I'm using <code>-i</code> rather than <code>--extra-index-url</code>)</p>
<p><code>pip install --pre vllm -i https://dsefy9jmd4lqu.cloudfront.net/33f460b17a54acb3b6cc0b03f4a17876cff5eafd/</code> does not work because <code>pip</code> does not look up the default pypi index anymore.</p>
<p>So, I like the behavior of <code>uv</code> to keep the default index, so that I don't need to host packages from the default pypi index, instead I can only host my package.</p>
<p>I also want to know, is this a feature or a bug that will be fixed?</p>
<p><strong>UPDATE</strong>: I find this is not correct. <code>uv pip install --pre vllm -i https://dsefy9jmd4lqu.cloudfront.net/33f460b17a54acb3b6cc0b03f4a17876cff5eafd/</code> also fails in a new environment. Please ignore this comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-22 20:26</div>
            <div class="timeline-body"><p>Thanks! Will read through a little later and see if I can give you an answer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-22 20:41</div>
            <div class="timeline-body"><p>Ok, so I believe the behavior here is intentional.</p>
<p>The difference that you're experiencing (IIUC) is in how pip and uv treat &quot;packages that exist on multiple indexes&quot;.</p>
<p>In pip, if <code>vllm</code> exists across multiple indexes, then it will take all the versions that exist across all of those indexes, and choose the latest version. So, if you have <code>0.6.3.dev28+g33f460b1.d20240927</code> on your nightly index, but <code>0.6.5</code> on PyPI, it will always take the version from PyPI. That's also why the first index you mentioned above <em>does</em> work with pip -- the latest version is <code>0.6.6.dev48+gf1d1bf62</code> which is higher than <code>0.6.5</code>, so it &quot;beats&quot; PyPI.</p>
<p>uv operates differently. By default, we look at the indexes in order, and as soon as we find an index that includes the package, we stop, and don't check any subsequent indexes. This is a security measure (it prevents &quot;dependency confusion&quot; attacks), and can be opted-out with the <code>--index-strategy</code> setting: https://docs.astral.sh/uv/reference/settings/#index-strategy.</p>
<p>So, if <code>vllm</code> users always use <code>--extra-index-url</code> to point to the nightly index, we'll always use the nightly version of <code>vllm</code> and ignore the version from PyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-22 20:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-22 20:41</div>
            <div class="timeline-body"><p>More on this here: https://docs.astral.sh/uv/pip/compatibility/#packages-that-exist-on-multiple-indexes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-22 20:49</div>
            <div class="timeline-body"><p>By the way, thank you for putting in the effort to make vLLM work better with uv, it's awesome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/youkaichao">@youkaichao</a> on 2024-12-22 21:05</div>
            <div class="timeline-body"><p>From the doc <a href="https://docs.astral.sh/uv/pip/compatibility/#packages-that-exist-on-multiple-indexes">docs.astral.sh/uv/pip/compatibility#packages-that-exist-on-multiple-indexes</a> :</p>
<blockquote>
<p>uv's behavior is such that if a package exists on an internal index, it should always be installed from the internal index, and never from PyPI.</p>
</blockquote>
<p>this is amazing, and it is what I want! Now I can even remove the <code>--pre</code> flag, and <code>uv pip install vllm --extra-index-url https://dsefy9jmd4lqu.cloudfront.net/33f460b17a54acb3b6cc0b03f4a17876cff5eafd/</code> just works. Thank you!</p>
<p>Welcome to join our slack workspace https://slack.vllm.ai to discuss together! I do think the package distribution system needs to change, given so many new things happening in the AI area like PyTorch with cuda versions / accelerator versions. It's unfortunate that <code>pip</code> did nothing about it. I find many examples in <code>uv</code> uses pytorch as an example, and <code>uv</code> designed many features for this complicated package management, which is really attractive to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Is pre-release only a feature or a bug that will be fixed?" to "priority of packages that exist on multiple indexes" by @youkaichao on 2024-12-22 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-22 21:15</div>
            <div class="timeline-body"><blockquote>
<p>Now I can even remove the <code>--pre</code> flag, and <code>uv pip install vllm --extra-index-url https://dsefy9jmd4lqu.cloudfront.net/33f460b17a54acb3b6cc0b03f4a17876cff5eafd/</code> just works. Thank you!</p>
</blockquote>
<p>Awesome! I believe that part works because, by default, if a package <em>only</em> has pre-release versions, then we enable pre-releases. So in this case, if you provide the vLLM nightly index, and we only see the dev releases, it should &quot;just work&quot; as you said :)</p>
<p>I'll join the Slack -- thanks for the invite and the kind words!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-22 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-22 21:15</div>
            <div class="timeline-body"><p>(Closing but happy to answer questions.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:01 UTC
    </footer>
</body>
</html>
