<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build backend: `source-include` silently ignores directory without a glob pattern - astral-sh/uv #16751</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Build backend: `source-include` silently ignores directory without a glob pattern</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16751">#16751</a>
        opened by <a href="https://github.com/woodruffw">@woodruffw</a>
        on 2025-11-16 05:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-11-16 05:52</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>This is potentially PEBKAC or addressable with some documentation, but I figured I'd file it as a bug for visibility ðŸ™‚</p>
<p>TL;DR: I had a <code>[tool.uv.build-backend]</code> section like this:</p>
<pre><code class="language-toml">[tool.uv.build-backend]
source-include = [&quot;tests/&quot;]
</code></pre>
<p>I <em>expected</em> this to include the <code>tests/</code> directory in the sdist produced by <code>uv build</code>, but it didn't. This can be seen here (along with the <code>pyproject.toml</code>:</p>
<p>https://inspector.pypi.io/project/cachecontrol/0.14.4/packages/2d/f6/c972b32d80760fb79d6b9eeb0b3010a46b89c0b23cf6329417ff7886cd22/cachecontrol-0.14.4.tar.gz/</p>
<p>To fix this, I needed to add an explicit pattern:</p>
<pre><code class="language-toml">[tool.uv.build-backend]
source-include = [&quot;tests/**&quot;]
</code></pre>
<p>with that, the sdist contained the <code>tests/</code> directory (and all child files/directories) as expected.</p>
<p>See https://github.com/psf/cachecontrol/issues/396 and https://github.com/psf/cachecontrol/pull/397 for some more (but not much more) context.</p>
<p>In terms of expected behavior: I expected <code>source-include = [&quot;tests/&quot;]</code> to fully include the <code>tests/</code> directory, since my intuition is that &quot;including&quot; a directory means including it in full, even without a double-glob for &quot;collect everything.&quot; Alternatively/separately, I expected <code>uv build</code> to produce a warning that the <code>source-include</code> setting was a no-op/didn't actually include anything.</p>
<p>On the docs side, this is sort of covered by <code>source-include</code> being described as a list of &quot;glob expressions.&quot; However, since <code>tests/</code> didn't actually produce a warning/error about being an invalid glob expression, I expected it to work (for the reasons above about my intuitions with directories).</p>
<p>Ref: https://docs.astral.sh/uv/reference/settings/#build-backend_source-include</p>
<h3>Platform</h3>
<p>Darwin 24.6.0 arm64</p>
<h3>Version</h3>
<p>uv 0.9.9 (Homebrew 2025-11-12)</p>
<h3>Python version</h3>
<p>Python 3.14.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @woodruffw on 2025-11-16 05:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">build-backend</span> added by @woodruffw on 2025-11-16 05:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-17 20:46</div>
            <div class="timeline-body"><p>A warning if a literal expression doesn't match any files is good idea.</p>
<p>Picking the right glob semantics is hard, often choosing one thing that sounds like an improvement is a regression or a footgun in another case. I have to think some more about the file vs. directory case. Currently, the model is that we walk the source tree and include every path, including parents, that matches the glob, similar to git.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-11-17 20:52</div>
            <div class="timeline-body"><blockquote>
<p>A warning if a literal expression doesn't match any files is good idea.</p>
</blockquote>
<p>Sounds good!</p>
<blockquote>
<p>Currently, the model is that we walk the source tree and include every path, including parents, that matches the glob, similar to git.</p>
</blockquote>
<p>This makes sense, although git (or at least <code>gitignore</code>) <em>does</em> have the directory matching semantics I'd expect here: <code>foo/</code> in <code>gitignore</code> means &quot;ignore everything under <code>foo/</code>&quot;. FWICT, in <code>gitignore</code> these are equivalent:</p>
<pre><code>foo/
foo/**
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-11-17 21:05</div>
            <div class="timeline-body"><p>(Noting: include and exclude globs are collected and then merged into <code>GlobDirFilter</code>s, which have both a fast-path DFA and a fallback <code>GlobSet</code> internally. So tracking &quot;hits&quot; for each glob is going to be a little interesting.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:15 UTC
    </footer>
</body>
</html>
