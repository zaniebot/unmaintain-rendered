<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv generated venv doesn't install pip on windows - astral-sh/uv #3712</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv generated venv doesn&#x27;t install pip on windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3712">#3712</a>
        opened by <a href="https://github.com/jadeidev">@jadeidev</a>
        on 2024-05-21 17:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jadeidev">@jadeidev</a></div>
            <div class="timeline-body">

<p><strong>os = windows 11</strong>
<strong>shell = powershell</strong>
<strong>uv = 0.1.45</strong>
<strong>python = 3.11.4</strong></p>
<p>running <code>uv venv</code> creates the virtual env but after activating it, pip doesnt seem to work, see terminal portion in the image below:
<img src="https://github.com/astral-sh/uv/assets/32917209/4c930943-8a8d-4236-9785-e6d2029d3c29" alt="image"></p>
<p>I have also tried to create venv with python <code>python -m venv .venv-native</code> and that seems to be working:
<img src="https://github.com/astral-sh/uv/assets/32917209/aa905d22-8c78-406c-aa58-4be34d53f61e" alt="image"></p>
<p>I won&#x27;t presume that the .ps1 files are getting used but it seems that there is quite a bit of delta between the uv generated <code>activate.ps1</code> and venv generated <code>Activate.ps1</code></p>
uv <code>activate.ps1</code>
<pre><code>
$script:THIS_PATH = $myinvocation.mycommand.path
$script:BASE_DIR = Split-Path (Resolve-Path &quot;$THIS_PATH/..&quot;) -Parent

function global:deactivate([switch] $NonDestructive) {
    if (Test-Path variable:_OLD_VIRTUAL_PATH) {
        $env:PATH = $variable:_OLD_VIRTUAL_PATH
        Remove-Variable &quot;_OLD_VIRTUAL_PATH&quot; -Scope global
    }

    if (Test-Path function:_old_virtual_prompt) {
        $function:prompt = $function:_old_virtual_prompt
        Remove-Item function:\_old_virtual_prompt
    }

    if ($env:VIRTUAL_ENV) {
        Remove-Item env:VIRTUAL_ENV -ErrorAction SilentlyContinue
    }

    if ($env:VIRTUAL_ENV_PROMPT) {
        Remove-Item env:VIRTUAL_ENV_PROMPT -ErrorAction SilentlyContinue
    }

    if (!$NonDestructive) {
        # Self destruct!
        Remove-Item function:deactivate
        Remove-Item function:pydoc
    }
}

function global:pydoc {
    python -m pydoc $args
}

# unset irrelevant variables
deactivate -nondestructive

$VIRTUAL_ENV = $BASE_DIR
$env:VIRTUAL_ENV = $VIRTUAL_ENV

if (&quot;setup&quot; -ne &quot;&quot;) {
    $env:VIRTUAL_ENV_PROMPT = &quot;setup&quot;
}
else {
    $env:VIRTUAL_ENV_PROMPT = $( Split-Path $env:VIRTUAL_ENV -Leaf )
}

New-Variable -Scope global -Name _OLD_VIRTUAL_PATH -Value $env:PATH

$env:PATH = &quot;$env:VIRTUAL_ENV/Scripts;&quot; + $env:PATH
if (!$env:VIRTUAL_ENV_DISABLE_PROMPT) {
    function global:_old_virtual_prompt {
        &quot;&quot;
    }
    $function:_old_virtual_prompt = $function:prompt

    function global:prompt {
        # Add the custom prefix to the existing prompt
        $previous_prompt_value = &amp; $function:_old_virtual_prompt
        (&quot;(&quot; + $env:VIRTUAL_ENV_PROMPT + &quot;) &quot; + $previous_prompt_value)
    }
}

</code></pre>
venv <code>Activate.ps1</code>
<pre><code>function global:deactivate ([switch]$NonDestructive) {
    # Revert to original values

    # The prior prompt:
    if (Test-Path -Path Function:_OLD_VIRTUAL_PROMPT) {
        Copy-Item -Path Function:_OLD_VIRTUAL_PROMPT -Destination Function:prompt
        Remove-Item -Path Function:_OLD_VIRTUAL_PROMPT
    }

    # The prior PYTHONHOME:
    if (Test-Path -Path Env:_OLD_VIRTUAL_PYTHONHOME) {
        Copy-Item -Path Env:_OLD_VIRTUAL_PYTHONHOME -Destination Env:PYTHONHOME
        Remove-Item -Path Env:_OLD_VIRTUAL_PYTHONHOME
    }

    # The prior PATH:
    if (Test-Path -Path Env:_OLD_VIRTUAL_PATH) {
        Copy-Item -Path Env:_OLD_VIRTUAL_PATH -Destination Env:PATH
        Remove-Item -Path Env:_OLD_VIRTUAL_PATH
    }

    # Just remove the VIRTUAL_ENV altogether:
    if (Test-Path -Path Env:VIRTUAL_ENV) {
        Remove-Item -Path env:VIRTUAL_ENV
    }

    # Just remove VIRTUAL_ENV_PROMPT altogether.
    if (Test-Path -Path Env:VIRTUAL_ENV_PROMPT) {
        Remove-Item -Path env:VIRTUAL_ENV_PROMPT
    }

    # Just remove the _PYTHON_VENV_PROMPT_PREFIX altogether:
    if (Get-Variable -Name &quot;_PYTHON_VENV_PROMPT_PREFIX&quot; -ErrorAction SilentlyContinue) {
        Remove-Variable -Name _PYTHON_VENV_PROMPT_PREFIX -Scope Global -Force
    }

    # Leave deactivate function in the global namespace if requested:
    if (-not $NonDestructive) {
        Remove-Item -Path function:deactivate
    }
}

&lt;#
.Description

.Parameter ConfigDir

#&gt;
function Get-PyVenvConfig(
    [String]
    $ConfigDir
) {
    Write-Verbose &quot;Given ConfigDir=$ConfigDir, obtain values in pyvenv.cfg&quot;

    # Ensure the file exists, and issue a warning if it doesn&#x27;t (but still allow the function to continue).
    $pyvenvConfigPath = Join-Path -Resolve -Path $ConfigDir -ChildPath &#x27;pyvenv.cfg&#x27; -ErrorAction Continue

    # An empty map will be returned if no config file is found.
    $pyvenvConfig = @{ }

    if ($pyvenvConfigPath) {

        Write-Verbose &quot;File exists, parse `key = value` lines&quot;
        $pyvenvConfigContent = Get-Content -Path $pyvenvConfigPath

        $pyvenvConfigContent | ForEach-Object {
            $keyval = $PSItem -split &quot;\s*=\s*&quot;, 2
            if ($keyval[0] -and $keyval[1]) {
                $val = $keyval[1]

                # Remove extraneous quotations around a string value.
                if (&quot;&#x27;&quot;&quot;&quot;.Contains($val.Substring(0, 1))) {
                    $val = $val.Substring(1, $val.Length - 2)
                }

                $pyvenvConfig[$keyval[0]] = $val
                Write-Verbose &quot;Adding Key: &#x27;$($keyval[0])&#x27;=&#x27;$val&#x27;&quot;
            }
        }
    }
    return $pyvenvConfig
}


&lt;# Begin Activate script --------------------------------------------------- #&gt;

# Determine the containing directory of this script
$VenvExecPath = Split-Path -Parent $MyInvocation.MyCommand.Definition
$VenvExecDir = Get-Item -Path $VenvExecPath

Write-Verbose &quot;Activation script is located in path: &#x27;$VenvExecPath&#x27;&quot;
Write-Verbose &quot;VenvExecDir Fullname: &#x27;$($VenvExecDir.FullName)&quot;
Write-Verbose &quot;VenvExecDir Name: &#x27;$($VenvExecDir.Name)&quot;

# Set values required in priority: CmdLine, ConfigFile, Default
# First, get the location of the virtual environment, it might not be
# VenvExecDir if specified on the command line.
if ($VenvDir) {
    Write-Verbose &quot;VenvDir given as parameter, using &#x27;$VenvDir&#x27; to determine values&quot;
}
else {
    Write-Verbose &quot;VenvDir not given as a parameter, using parent directory name as VenvDir.&quot;
    $VenvDir = $VenvExecDir.Parent.FullName.TrimEnd(&quot;\\/&quot;)
    Write-Verbose &quot;VenvDir=$VenvDir&quot;
}

# Next, read the `pyvenv.cfg` file to determine any required value such
# as `prompt`.
$pyvenvCfg = Get-PyVenvConfig -ConfigDir $VenvDir

# Next, set the prompt from the command line, or the config file, or
# just use the name of the virtual environment folder.
if ($Prompt) {
    Write-Verbose &quot;Prompt specified as argument, using &#x27;$Prompt&#x27;&quot;
}
else {
    Write-Verbose &quot;Prompt not specified as argument to script, checking pyvenv.cfg value&quot;
    if ($pyvenvCfg -and $pyvenvCfg[&#x27;prompt&#x27;]) {
        Write-Verbose &quot;  Setting based on value in pyvenv.cfg=&#x27;$($pyvenvCfg[&#x27;prompt&#x27;])&#x27;&quot;
        $Prompt = $pyvenvCfg[&#x27;prompt&#x27;];
    }
    else {
        Write-Verbose &quot;  Setting prompt based on parent&#x27;s directory&#x27;s name. (Is the directory name passed to venv module when creating the virtual environment)&quot;
        Write-Verbose &quot;  Got leaf-name of $VenvDir=&#x27;$(Split-Path -Path $venvDir -Leaf)&#x27;&quot;
        $Prompt = Split-Path -Path $venvDir -Leaf
    }
}

Write-Verbose &quot;Prompt = &#x27;$Prompt&#x27;&quot;
Write-Verbose &quot;VenvDir=&#x27;$VenvDir&#x27;&quot;

# Deactivate any currently active virtual environment, but leave the
# deactivate function in place.
deactivate -nondestructive

# Now set the environment variable VIRTUAL_ENV, used by many tools to determine
# that there is an activated venv.
$env:VIRTUAL_ENV = $VenvDir

if (-not $Env:VIRTUAL_ENV_DISABLE_PROMPT) {

    Write-Verbose &quot;Setting prompt to &#x27;$Prompt&#x27;&quot;

    # Set the prompt to include the env name
    # Make sure _OLD_VIRTUAL_PROMPT is global
    function global:_OLD_VIRTUAL_PROMPT { &quot;&quot; }
    Copy-Item -Path function:prompt -Destination function:_OLD_VIRTUAL_PROMPT
    New-Variable -Name _PYTHON_VENV_PROMPT_PREFIX -Description &quot;Python virtual environment prompt prefix&quot; -Scope Global -Option ReadOnly -Visibility Public -Value $Prompt

    function global:prompt {
        Write-Host -NoNewline -ForegroundColor Green &quot;($_PYTHON_VENV_PROMPT_PREFIX) &quot;
        _OLD_VIRTUAL_PROMPT
    }
    $env:VIRTUAL_ENV_PROMPT = $Prompt
}

# Clear PYTHONHOME
if (Test-Path -Path Env:PYTHONHOME) {
    Copy-Item -Path Env:PYTHONHOME -Destination Env:_OLD_VIRTUAL_PYTHONHOME
    Remove-Item -Path Env:PYTHONHOME
}

# Add the venv to the PATH
Copy-Item -Path Env:PATH -Destination Env:_OLD_VIRTUAL_PATH
$Env:PATH = &quot;$VenvExecDir$([System.IO.Path]::PathSeparator)$Env:PATH&quot;

...

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;uv generated venv doesn&#x27;t activate&quot; to &quot;uv generated venv doesn&#x27;t activate on windows&quot; by <a href="https://github.com/jadeidev">@jadeidev</a> on 2024-05-21 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-21 18:01</div>
            <div class="timeline-body"><p>Hi! We don&#x27;t install pip by default (since you don&#x27;t need it when using uv). You can pass <code>--seed</code> to <code>uv venv</code> to install <code>pip</code> when creating the environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-21 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-21 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jadeidev">@jadeidev</a> on 2024-05-21 18:09</div>
            <div class="timeline-body"><p>thank you for pointing this out. In my test i tried to consider all the ways people may stumble issues</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/jadeidev">@jadeidev</a> on 2024-05-21 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;uv generated venv doesn&#x27;t activate on windows&quot; to &quot;uv generated venv doesn&#x27;t install pip on windows&quot; by <a href="https://github.com/jadeidev">@jadeidev</a> on 2024-05-21 18:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:31:12 UTC
    </footer>
</body>
</html>
