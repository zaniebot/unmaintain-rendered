```yaml
number: 16013
title: How to make git tagging a monorepo only build the affected workspace members in CI?
type: issue
state: open
author: MartyMcFlyInTheSky
labels:
  - question
assignees: []
created_at: 2025-09-24T09:59:08Z
updated_at: 2025-10-25T09:30:39Z
url: https://github.com/astral-sh/uv/issues/16013
synced_at: 2026-01-10T01:57:35Z
```

# How to make git tagging a monorepo only build the affected workspace members in CI?

---

_Issue opened by @MartyMcFlyInTheSky on 2025-09-24 09:59_

### Question

We have a monorepo containing multiple packages and libs. Now when we tag the monorepo typically all of those packages are built with the commit tag version. Since this is slow we want to change it such that only the "affected" packages are built. This means if we make direct changes to the source code of certain packages, only those would be built and released in our gitlab registry. Similarly, if a _dependency_ of A, B and C is changed, releases for A, B and C should also be built.

Is there a way to query uv which packages are affected with the changes of the last MR/PR and need rebuilding/relasing? (Also, someone might enlighten me about an even better way to do this...)

---

_Label `question` added by @MartyMcFlyInTheSky on 2025-09-24 09:59_

---

_Comment by @konstin on 2025-09-25 11:20_

There's currently no uv-native way of achieving this.

---

_Comment by @ReubenVandezande on 2025-09-30 10:17_

I use git commands to determine which packages have been modified since the last release (ie. "tag"). I specifically use this for automating my changelog, but this should also suffice for determining which packages have changed: no commits = no changes. 
`get_first_commit` and `get_tag_commit` are other functions in the module that, well, do exactly what they say.

```python

def get_release_entries(
    release_tags: list[str], location: str | Path, *, generate_all: bool = False
) -> list[str]:
    """Retrieve log entries (commits) between release tags for a given location.

    Parameters
    ----------
    release_tags : list[str]
        A list of known release tags.
    location : str | Path
        The path to the package or project location.
    generate_all : bool, optional
        If True, generates entries for all commits, not just since the last release, by default False.

    Returns
    -------
    list[str]
        All commit messages for commits between now and the last release
    """
    previous_release_commit = (
        get_first_commit() if not release_tags or generate_all else get_tag_commit(release_tags[-1])
    )
    delimiter = "|-|"
    git_command = [
        "git",
        "--no-pager",
        "log",
        "--oneline",
        f"--format=%H{delimiter}%s{delimiter}\n%(trailers)%-C()",
        f"{previous_release_commit}..HEAD",
        "--",
        f"{location!s}",
    ]

    return subprocess.run(git_command, check=True, text=True, capture_output=True).stdout
```

---

_Comment by @Spenhouet on 2025-10-25 09:30_

Maybe this helps: https://github.com/astral-sh/uv/issues/6356#issuecomment-2983217371

---
