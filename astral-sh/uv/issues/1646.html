<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `pip cache dir` - astral-sh/uv #1646</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add `pip cache dir`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1646">#1646</a>
        opened by <a href="https://github.com/hugovk">@hugovk</a>
        on 2024-02-18 14:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hugovk">@hugovk</a> on 2024-02-18 14:07</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<h1>Short version</h1>
<p>Add a cross-platform way to find out the uv cache directory (like pip has) for use on GitHub Actions.</p>
<h1>Long version</h1>
<p>If we want to cache things installed by <code>uv pip install</code> on GitHub Actions, we need to do something like this:</p>
<pre><code class="language-yaml">- uses: actions/cache@v4
  if: startsWith(runner.os, 'Linux')
  with:
    path: ~/.cache/uv
    key: ${{ runner.os }}-uv-${{ hashFiles('**/requirements.txt') }}
    restore-keys: |
      ${{ runner.os }}-uv-

- uses: actions/cache@v4
  if: startsWith(runner.os, 'macOS')
  with:
    path: ~/Library/Caches/uv
    key: ${{ runner.os }}-uv-${{ hashFiles('**/requirements.txt') }}
    restore-keys: |
      ${{ runner.os }}-uv-

- uses: actions/cache@v4
  if: startsWith(runner.os, 'Windows')
  with:
    path: ~\AppData\Local\uv\Cache
    key: ${{ runner.os }}-uv-${{ hashFiles('**/requirements.txt') }}
    restore-keys: |
      ${{ runner.os }}-uv-
</code></pre>
<p>Adapted from https://github.com/actions/cache/blob/main/examples.md#multiple-oss-in-a-workflow</p>
<p>Or:</p>
<pre><code class="language-yaml">jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        include:
        - os: ubuntu-latest
          path: ~/.cache/uv
        - os: macos-latest
          path: ~/Library/Caches/uv
        - os: windows-latest
          path: ~\AppData\Local\uv\Cache
    steps:
    - uses: actions/cache@v4
      with:
        path: ${{ matrix.path }}
        key: ${{ runner.os }}-uv-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
         ${{ runner.os }}-uv-
</code></pre>
<p>Adapted from https://github.com/actions/cache/blob/main/examples.md#multiple-oss-in-a-workflow-with-a-matrix</p>
<p>Or we may be able to choose a common directory using the <code>--cache-dir</code> flag or <code>UV_CACHE_DIR</code> environment variable.</p>
<p>Originally we had to do the same thing with pip (hence the examples at actions/cache).</p>
<p>But then pip 20.1 added a <code>pip cache dir</code> command (https://github.com/pypa/pip/issues/7350 / https://github.com/pypa/pip/pull/8095):</p>
<pre><code class="language-console">‚ùØ pip cache dir
/Users/hugo/Library/Caches/pip
</code></pre>
<p>If we add <code>uv pip cache dir</code>, we would similarly be able to simplify the config:</p>
<pre><code class="language-yaml">- name: Get uv cache dir
  id: uv-cache
  run: |
    echo &quot;dir=$(uv cache dir)&quot; &gt;&gt; $GITHUB_OUTPUT

- name: pip cache
  uses: actions/cache@v4
  with:
    path: ${{ steps.pip-cache.outputs.dir }}
    key: ${{ runner.os }}-uv-${{ hashFiles('**/requirements.txt') }}
    restore-keys: |
      ${{ runner.os }}-uv-
</code></pre>
<p>Adapted from https://github.com/actions/cache/blob/main/examples.md#using-pip-to-get-cache-location</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-18 14:27</div>
            <div class="timeline-body"><p>Yeah we should add this, it's trivial.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-02-18 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-02-18 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-18 15:08</div>
            <div class="timeline-body"><p>As part of this, I'll probably move <code>uv clean</code> to <code>uv cache clean</code>, so we can centralize the cache commands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2024-02-18 15:21</div>
            <div class="timeline-body"><p>Out of scope for this issue, could be useful to add some other <code>pip cache</code> subcommands:</p>
<pre><code class="language-console">‚ùØ pip cache --help

Usage:
  pip3 cache dir
  pip3 cache info
  pip3 cache list [&lt;pattern&gt;] [--format=[human, abspath]]
  pip3 cache remove &lt;pattern&gt;
  pip3 cache purge


Description:
  Inspect and manage pip's wheel cache.

  Subcommands:

  - dir: Show the cache directory.
  - info: Show information about the cache.
  - list: List filenames of packages stored in the cache.
  - remove: Remove one or more package from the cache.
  - purge: Remove all items from the cache.

  ``&lt;pattern&gt;`` can be a glob expression or a package name.

Cache Options:
  --format &lt;list_format&gt;      Select the output format among: human (default) or abspath
</code></pre>
<p>Especially  <code>pip cache info</code>, because we will end up with large pip and uv caches on some systems:</p>
<pre><code class="language-console">‚ùØ pip cache info
Package index page cache location (pip v23.3+): /Users/hugo/Library/Caches/pip/http-v2
Package index page cache location (older pips): /Users/hugo/Library/Caches/pip/http
Package index page cache size: 187.6 MB
Number of HTTP files: 870
Locally built wheels location: /Users/hugo/Library/Caches/pip/wheels
Locally built wheels size: 5.9 MB
Number of locally built wheels: 10
</code></pre>
<p>Shall I open a new issue for <code>pip cache info</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-18 15:27</div>
            <div class="timeline-body"><p>Yeah feel free to create a separate issue for <code>pip cache info</code>. That looks useful. (I don't think we'd attempt to mimic the exact same <em>output</em> (in terms of format, etc.), but we could report the same information.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2024-02-18 15:46</div>
            <div class="timeline-body"><p>Thanks, I created https://github.com/astral-sh/uv/issues/1655 and sneaked <code>pip cache list</code> in there too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akx">@akx</a> on 2024-02-19 12:12</div>
            <div class="timeline-body"><p>Ah, heh, related üòÅ https://github.com/actions/setup-python/pull/818</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-20 03:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-20 04:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:42:59 UTC
    </footer>
</body>
</html>
