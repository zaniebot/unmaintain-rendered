<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index: Redirect to url using basic auth with empty username doesn't work - astral-sh/uv #17343</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Index: Redirect to url using basic auth with empty username doesn't work</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/17343">#17343</a>
        opened by <a href="https://github.com/matthuisman">@matthuisman</a>
        on 2026-01-07 04:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/matthuisman">@matthuisman</a> on 2026-01-07 04:29</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Have setup a local server to redirect http://127.0.0.1:8000/{path} -&gt; http://:{jwt}@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/{path}</p>
<pre><code>DEBUG No cache entry for: http://127.0.0.1:8000/python-environment/
TRACE Sending fresh GET request for http://127.0.0.1:8000/python-environment/
TRACE Handling request for http://127.0.0.1:8000/python-environment/ with authentication policy auto
TRACE Request for http://127.0.0.1:8000/python-environment/ is unauthenticated, checking cache
TRACE No credentials in cache for URL http://127.0.0.1:8000/python-environment/
TRACE Attempting unauthenticated request for http://127.0.0.1:8000/python-environment/
DEBUG Received a cross-origin redirect. Removing sensitive headers.
DEBUG Received HTTP 302 Found. Redirecting to https://:****@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/
TRACE Handling request for https://:****@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/ with authentication policy auto
TRACE Request for https://:****@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://:eyJ2ZX.....zQ@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/
TRACE Attempting unauthenticated request for https://:****@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/
TRACE Request for https://:****@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/ failed with 401 Unauthorized, checking for credentials
TRACE No credentials in cache for realm https://jfrog.acompany.com
DEBUG No netrc file found
TRACE Checking lock for `credentials store` at `C:\Users\mhuisman\AppData\Roaming\uv\credentials\credentials.toml.lock`
DEBUG Acquired exclusive lock for `credentials store`
DEBUG Released lock at `C:\Users\mhuisman\AppData\Roaming\uv\credentials\credentials.toml.lock`
DEBUG No credentials file found at C:\Users\mhuisman\AppData\Roaming\uv\credentials\credentials.toml
TRACE Considering retry of response HTTP 401 Unauthorized for https://:eyJ2ZX....zQ@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/
TRACE Cannot retry nested reqwest error
DEBUG Released lock at `C:\Users\mhuisman\AppData\Local\Temp\.tmpxeC3q4\simple-v18\index\12a4f10a4271579f\python-environment.lock`
DEBUG Indexes search failed because of status code failure: 401 Unauthorized
TRACE Received package metadata for: python-environment
DEBUG Searching for a compatible version of python-environment (*)
TRACE Selecting candidate for python-environment with range * with 0 remote versions
DEBUG No compatible version found for: python-environment
TRACE Resolver derivation tree before reduction
term root==0a0.dev0
  root==0a0.dev0 depends on python-environment*
  python-environment not found in the package registry
TRACE Resolver derivation tree after reduction
term root==0a0.dev0
  root==0a0.dev0 depends on python-environment*
  python-environment not found in the package registry
  × No solution found when resolving dependencies:
  ╰─▶ Because python-environment was not found in the package registry and you require python-environment, we can conclude that your requirements are unsatisfiable.

      hint: An index URL (http://127.0.0.1:8000/) could not be queried due to a lack of valid authentication credentials (401 Unauthorized).
</code></pre>
<p><strong>It also exposes the sensitive token in the logs (eyJ2ZX....zQ above)</strong>
The url does work if I call it using requests or in browser with the empty username.</p>
<p>If i update my redirect test to include a username before the : it works</p>
<pre><code>DEBUG No cache entry for: http://127.0.0.1:8000/python-environment/
TRACE Sending fresh GET request for http://127.0.0.1:8000/python-environment/
TRACE Handling request for http://127.0.0.1:8000/python-environment/ with authentication policy auto
TRACE Request for http://127.0.0.1:8000/python-environment/ is unauthenticated, checking cache
TRACE No credentials in cache for URL http://127.0.0.1:8000/python-environment/
TRACE Attempting unauthenticated request for http://127.0.0.1:8000/python-environment/
DEBUG Received a cross-origin redirect. Removing sensitive headers.
DEBUG Received HTTP 302 Found. Redirecting to https://jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/
TRACE Handling request for https://mhuisman%40acompany.com:****@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/ with authentication policy auto
TRACE Request for https://mhuisman%40acompany.com:****@jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/ already contains username and password
TRACE Considering retry of response HTTP 404 Not Found for https://jfrog.acompany.com/artifactory/api/pypi/matt-test/simple/python-environment/
TRACE Cannot retry nested reqwest error
DEBUG Released lock at `C:\Users\mhuisman\AppData\Local\Temp\.tmpebVObi\simple-v18\index\12a4f10a4271579f\python-environment.lock`
TRACE Fetching metadata for python-environment from https://pypi.org/simple/python-environment/
TRACE Checking lock for `C:\Users\mhuisman\AppData\Local\Temp\.tmpebVObi\simple-v18\pypi\python-environment.lock` at `C:\Users\mhuisman\AppData\Local\Temp\.tmpebVObi\simple-v18\pypi\python-environment.lock`
DEBUG Acquired exclusive lock for `C:\Users\mhuisman\AppData\Local\Temp\.tmpebVObi\simple-v18\pypi\python-environment.lock`
TRACE No cache entry exists for C:\Users\mhuisman\AppData\Local\Temp\.tmpebVObi\simple-v18\pypi\python-environment.rkyv
DEBUG No cache entry for: https://pypi.org/simple/python-environment/
TRACE Sending fresh GET request for https://pypi.org/simple/python-environment/
TRACE Handling request for https://pypi.org/simple/python-environment/ with authentication policy auto
TRACE Request for https://pypi.org/simple/python-environment/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://pypi.org/simple/python-environment/
TRACE Attempting unauthenticated request for https://pypi.org/simple/python-environment/
TRACE Request for https://pypi.org/simple/python-environment/ failed with 404 Not Found, checking for credentials
TRACE No credentials in cache for URL https://pypi.org/simple
TRACE No credentials in cache for realm https://pypi.org
DEBUG No netrc file found
TRACE Checking lock for `credentials store` at `C:\Users\mhuisman\AppData\Roaming\uv\credentials\credentials.toml.lock`
DEBUG Acquired exclusive lock for `credentials store`
DEBUG Released lock at `C:\Users\mhuisman\AppData\Roaming\uv\credentials\credentials.toml.lock`
DEBUG No credentials file found at C:\Users\mhuisman\AppData\Roaming\uv\credentials\credentials.toml
TRACE Considering retry of response HTTP 404 Not Found for https://pypi.org/simple/python-environment/
TRACE Cannot retry nested reqwest error
DEBUG Released lock at `C:\Users\mhuisman\AppData\Local\Temp\.tmpebVObi\simple-v18\pypi\python-environment.lock`
TRACE Received package metadata for: python-environment
DEBUG Searching for a compatible version of python-environment (*)
TRACE Selecting candidate for python-environment with range * with 0 remote versions
DEBUG No compatible version found for: python-environment
TRACE Resolver derivation tree before reduction
term root==0a0.dev0
  root==0a0.dev0 depends on python-environment*
  python-environment not found in the package registry
TRACE Resolver derivation tree after reduction
term root==0a0.dev0
  root==0a0.dev0 depends on python-environment*
  python-environment not found in the package registry
  × No solution found when resolving dependencies:
  ╰─▶ Because python-environment was not found in the package registry and you require python-environment, we can conclude that your requirements are unsatisfiable.
</code></pre>
<h3>Platform</h3>
<p>Windows 11 64 bit</p>
<h3>Version</h3>
<p>uv 0.9.22 (82a6a66b8 2026-01-06)</p>
<h3>Python version</h3>
<p>3.10.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @matthuisman on 2026-01-07 04:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-07 08:41</div>
            <div class="timeline-body"><p>CC @woodruffw</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2026-01-07 12:59</div>
            <div class="timeline-body"><p>Thanks for the ping, I'll look at that credential redaction issue.</p>
<p>For that URL itself: RFC 3986's grammar doesn't seem to allow a leading colon like that, so I suspect that URL form is invalid and uv should probably reject it outright. However, I'd need to check what the WHATWG spec says as well.</p>
<p>Ref: https://www.rfc-editor.org/rfc/rfc3986#section-3.2.1</p>
<p>Edit: sorry, I misread, the RFC says alternation not concatenation. So that is indeed a valid URL.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @woodruffw by @woodruffw on 2026-01-07 15:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2026-01-07 15:21</div>
            <div class="timeline-body"><p>Noting for myself: the lack of redaction is because we send a <code>Url</code> for display, not a <code>DisplaySafeUrl</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-07 15:34</div>
            <div class="timeline-body"><p>We won't forward credentials across realms, so if you redirect from one domain to another, the credentials are not propagated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-07 15:37</div>
            <div class="timeline-body"><p>Oh, I see you're embedding the credentials in the proxy itself, nevermind my comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/17346.html">astral-sh/uv#17346</a> on 2026-01-07 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2026-01-07 15:43</div>
            <div class="timeline-body"><p>#17346 will fix the redaction.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:31 UTC
    </footer>
</body>
</html>
