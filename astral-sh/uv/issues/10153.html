<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv cache prune` doesn't remove packages from cache for deleted environments - astral-sh/uv #10153</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv cache prune</code> doesn&#x27;t remove packages from cache for deleted environments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10153">#10153</a>
        opened by <a href="https://github.com/neckbosov">@neckbosov</a>
        on 2024-12-25 08:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/neckbosov">@neckbosov</a></div>
            <div class="timeline-body"><p>Steps to reproduce:</p>
<pre><code>mkdir $HOME/uv-test &amp;&amp; cd $HOME/uv-test
export UV_CACHE_DIR=$HOME/uv-test/uv-cache
uv venv --python 3.9 ./python39env
VIRTUAL_ENV=./python39env uv pip install torch
du -hs ./uv-cache

uv venv --python 3.11 ./python311env
VIRTUAL_ENV=./python311env uv pip install torch
du -hs ./uv-cache

rm -rf ./python39env
uv cache prune
du -hs ./uv-cache
</code></pre>
<p>Expected result:
After pruning cache size will be the same as after the first installation.</p>
<p>Actual result:
<code>uv cache prune</code> doesn&#x27;t delete anything, cache size stays the same as after the second installation.</p>
<p>uv version 0.5.10, fedora linux.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;uv cache prune doesn&#x27;t remove packages from cache for deleted environments&quot; to &quot;`uv cache prune` doesn&#x27;t remove packages from cache for deleted environments&quot; by <a href="https://github.com/neckbosov">@neckbosov</a> on 2024-12-26 11:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 14:32</div>
            <div class="timeline-body"><p>What do you expect to be removed after <code>uv cache prune</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cache</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sh-shahrokhi">@sh-shahrokhi</a> on 2024-12-26 19:24</div>
            <div class="timeline-body"><blockquote>
<p>What do you expect to be removed after <code>uv cache prune</code>?</p>
</blockquote>
<p>I have the same question. I thought torch and its dependencies should be removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neckbosov">@neckbosov</a> on 2024-12-28 14:51</div>
            <div class="timeline-body"><p>I would expect all packages installed for python 3.9 to be removed because they are no longer used in any of environments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-28 15:21</div>
            <div class="timeline-body"><p>Ah, that&#x27;s not the purpose of <code>uv cache prune</code>. We can&#x27;t track &quot;which packages are used in which environments&quot;. <code>uv cache prune</code> is intended to remove items that are internally unreachable from the cache (e.g., if we built a newer version of a source distribution, we can remove the older versions).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-28 15:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/QiE2035">@QiE2035</a> on 2025-05-16 13:18</div>
            <div class="timeline-body"><p>@charliermarsh</p>
<p>[Translate from Chinese using Bing]</p>
<p>Referring to PDM, I think this can be done by adding a file on each cache item to keep track of where the cache is being used. I think this feature is still necessary to help find out which caches are no longer being used so that they can be cleaned or organized.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:23 UTC
    </footer>
</body>
</html>
