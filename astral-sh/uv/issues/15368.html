<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number of tests failing due to finding `/usr/bin/uv` - astral-sh/uv #15368</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Number of tests failing due to finding <code>/usr/bin/uv</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15368">#15368</a>
        opened by <a href="https://github.com/mgorny">@mgorny</a>
        on 2025-08-19 02:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mgorny">@mgorny</a></div>
            <div class="timeline-body">Summary
<p>On top of uv 0.8.12, I&#x27;m seeing the following test failures (compared to 0.8.6 that was the last good version):</p>
<pre><code>---- python_module::find_uv_bin_error_message stdout ----

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----

----- stderr -----
Resolved 1 package in 7ms
Prepared 1 package in 53ms
Installed 1 package in 39ms
 + uv==0.1.0 (from file:///var/tmp/portage/dev-python/uv-0.8.12/work/uv-0.8.12/scripts/packages/fake-uv)

────────────────────────────────────────────────────────────────────────────────


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----
/usr/bin/uv

----- stderr -----

────────────────────────────────────────────────────────────────────────────────

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: find_uv_bin_error_message-2
Source: crates/uv/tests/it/python_module.rs:443
────────────────────────────────────────────────────────────────────────────────
Expression: snapshot
────────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬───────────────────────────────────────────────────────────────────
    0       │-success: false
    1       │-exit_code: 1
          0 │+success: true
          1 │+exit_code: 0
    2     2 │ ----- stdout -----
          3 │+[PYTHON-BIN-3.12]/uv
    3     4 │ 
    4       │------ stderr -----
    5       │-Traceback (most recent call last):
    6       │-  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
    7       │-  File &quot;[SITE_PACKAGES]/uv/_find_uv.py&quot;, line 50, in find_uv_bin
    8       │-    raise UvNotFound(
    9       │-uv._find_uv.UvNotFound: Could not find the uv binary in any of the following locations:
   10       │- - [VENV]/[BIN]
   11       │- - [PYTHON-BIN-3.12]/
   12       │- - [SITE_PACKAGES]/[BIN]
   13       │- - [USER_SCHEME]/[BIN]
          5 │+----- stderr -----
────────────┴───────────────────────────────────────────────────────────────────
To update snapshots run `cargo insta review`
Stopped on the first failure. Run `cargo insta test` to run all snapshots.

thread &#x27;python_module::find_uv_bin_error_message&#x27; panicked at /var/tmp/portage/dev-python/uv-0.8.12/work/cargo_home/gentoo/insta-1.43.1
/src/runtime.rs:679:13:
snapshot assertion for &#x27;find_uv_bin_error_message-2&#x27; failed in line 443
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

---- python_module::find_uv_bin_prefix stdout ----

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----

----- stderr -----
Using CPython 3.12.11 interpreter at: .venv/bin/python3
Resolved 1 package in 5ms
Prepared 1 package in 89ms
Installed 1 package in 31ms
 + uv==0.1.0 (from file:///var/tmp/portage/dev-python/uv-0.8.12/work/uv-0.8.12/scripts/packages/fake-uv)

────────────────────────────────────────────────────────────────────────────────


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----
/usr/bin/uv

----- stderr -----

────────────────────────────────────────────────────────────────────────────────

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: find_uv_bin_prefix-2
Source: crates/uv/tests/it/python_module.rs:138
────────────────────────────────────────────────────────────────────────────────
Expression: snapshot
────────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬───────────────────────────────────────────────────────────────────
    0     0 │ success: true
    1     1 │ exit_code: 0
    2     2 │ ----- stdout -----
    3       │-[TEMP_DIR]/prefix/[BIN]/uv
          3 │+/usr/[BIN]/uv
    4     4 │ 
    5     5 │ ----- stderr -----
────────────┴───────────────────────────────────────────────────────────────────
To update snapshots run `cargo insta review`
Stopped on the first failure. Run `cargo insta test` to run all snapshots.

thread &#x27;python_module::find_uv_bin_prefix&#x27; panicked at /var/tmp/portage/dev-python/uv-0.8.12/work/cargo_home/gentoo/insta-1.43.1/src/ru
ntime.rs:679:13:
snapshot assertion for &#x27;find_uv_bin_prefix-2&#x27; failed in line 138

---- python_module::find_uv_bin_py38 stdout ----

thread &#x27;python_module::find_uv_bin_py38&#x27; panicked at crates/uv/tests/it/common/mod.rs:1564:17:
Could not find Python 3.8 for test

---- python_module::find_uv_bin_in_ephemeral_environment stdout ----

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----
/usr/bin/uv

----- stderr -----
Resolved 1 package in 94ms
Audited in 0.06ms
Resolved 1 package in 6ms
Prepared 1 package in 68ms
Installed 1 package in 26ms
 + uv==0.1.0 (from file:///var/tmp/portage/dev-python/uv-0.8.12/work/uv-0.8.12/scripts/packages/fake-uv)

────────────────────────────────────────────────────────────────────────────────

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: find_uv_bin_in_ephemeral_environment
Source: crates/uv/tests/it/python_module.rs:229
────────────────────────────────────────────────────────────────────────────────
Expression: snapshot
────────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬───────────────────────────────────────────────────────────────────
    0     0 │ success: true
    1     1 │ exit_code: 0
    2     2 │ ----- stdout -----
    3       │-[CACHE_DIR]/archive-v0/[HASH]/[BIN]/uv
          3 │+/usr/[BIN]/uv
    4     4 │ 
    5     5 │ ----- stderr -----
    6     6 │ Resolved 1 package in [TIME]
    7     7 │ Audited in [TIME]
────────────┴───────────────────────────────────────────────────────────────────
To update snapshots run `cargo insta review`
Stopped on the first failure. Run `cargo insta test` to run all snapshots.

thread &#x27;python_module::find_uv_bin_in_ephemeral_environment&#x27; panicked at /var/tmp/portage/dev-python/uv-0.8.12/work/cargo_home/gentoo/i
nsta-1.43.1/src/runtime.rs:679:13:
snapshot assertion for &#x27;find_uv_bin_in_ephemeral_environment&#x27; failed in line 229

---- python_module::find_uv_bin_target stdout ----

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----

----- stderr -----
Using CPython 3.12.11 interpreter at: .venv/bin/python3
Resolved 1 package in 8ms
Prepared 1 package in 65ms
Installed 1 package in 48ms
 + uv==0.1.0 (from file:///var/tmp/portage/dev-python/uv-0.8.12/work/uv-0.8.12/scripts/packages/fake-uv)

────────────────────────────────────────────────────────────────────────────────


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----
/usr/bin/uv

----- stderr -----

────────────────────────────────────────────────────────────────────────────────

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: find_uv_bin_target-2
Source: crates/uv/tests/it/python_module.rs:92
────────────────────────────────────────────────────────────────────────────────
Expression: snapshot
────────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬───────────────────────────────────────────────────────────────────
    0     0 │ success: true
    1     1 │ exit_code: 0
    2     2 │ ----- stdout -----
    3       │-[TEMP_DIR]/target/[BIN]/uv
          3 │+/usr/[BIN]/uv
    4     4 │ 
    5     5 │ ----- stderr -----
────────────┴───────────────────────────────────────────────────────────────────
To update snapshots run `cargo insta review`
Stopped on the first failure. Run `cargo insta test` to run all snapshots.

thread &#x27;python_module::find_uv_bin_target&#x27; panicked at /var/tmp/portage/dev-python/uv-0.8.12/work/cargo_home/gentoo/insta-1.43.1/src/ru
ntime.rs:679:13:
snapshot assertion for &#x27;find_uv_bin_target-2&#x27; failed in line 92

---- python_module::find_uv_bin_in_parent_of_ephemeral_environment stdout ----

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----
/usr/bin/uv

----- stderr -----
Resolved 2 packages in 89ms
Prepared 1 package in 62ms
Installed 1 package in 33ms
 + uv==0.1.0 (from file:///var/tmp/portage/dev-python/uv-0.8.12/work/uv-0.8.12/scripts/packages/fake-uv)
Resolved 3 packages in 327ms
Prepared 3 packages in 233ms
Installed 3 packages in 44ms
 + anyio==4.3.0
 + idna==3.6
 + sniffio==1.3.1

────────────────────────────────────────────────────────────────────────────────

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: find_uv_bin_in_parent_of_ephemeral_environment
Source: crates/uv/tests/it/python_module.rs:281
────────────────────────────────────────────────────────────────────────────────
Expression: snapshot
────────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬───────────────────────────────────────────────────────────────────
    0     0 │ success: true
    1     1 │ exit_code: 0
    2     2 │ ----- stdout -----
    3       │-[VENV]/[BIN]/uv
          3 │+/usr/[BIN]/uv
    4     4 │ 
    5     5 │ ----- stderr -----
    6     6 │ Resolved 2 packages in [TIME]
    7     7 │ Prepared 1 package in [TIME]
────────────┴───────────────────────────────────────────────────────────────────
To update snapshots run `cargo insta review`
Stopped on the first failure. Run `cargo insta test` to run all snapshots.

thread &#x27;python_module::find_uv_bin_in_parent_of_ephemeral_environment&#x27; panicked at /var/tmp/portage/dev-python/uv-0.8.12/work/cargo_hom
e/gentoo/insta-1.43.1/src/runtime.rs:679:13:
snapshot assertion for &#x27;find_uv_bin_in_parent_of_ephemeral_environment&#x27; failed in line 281

---- python_module::find_uv_bin_user_bin stdout ----

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----

----- stderr -----
Resolved 1 package in 6ms
Prepared 1 package in 56ms
Installed 1 package in 67ms
 + uv==0.1.0 (from file:///var/tmp/portage/dev-python/uv-0.8.12/work/uv-0.8.12/scripts/packages/fake-uv)

────────────────────────────────────────────────────────────────────────────────


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----
/var/tmp/portage/dev-python/uv-0.8.12/temp/uv/tests/.tmpHwzRLw/temp/.venv/bin/uv

----- stderr -----

────────────────────────────────────────────────────────────────────────────────


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----
/usr/bin/uv

----- stderr -----

────────────────────────────────────────────────────────────────────────────────

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: find_uv_bin_user_bin-3
Source: crates/uv/tests/it/python_module.rs:373
────────────────────────────────────────────────────────────────────────────────
Expression: snapshot
────────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬───────────────────────────────────────────────────────────────────
    0     0 │ success: true
    1     1 │ exit_code: 0
    2     2 │ ----- stdout -----
    3       │-[USER_SCHEME]/[BIN]/uv
          3 │+/usr/[BIN]/uv
    4     4 │ 
    5     5 │ ----- stderr -----
────────────┴───────────────────────────────────────────────────────────────────
To update snapshots run `cargo insta review`
Stopped on the first failure. Run `cargo insta test` to run all snapshots.

thread &#x27;python_module::find_uv_bin_user_bin&#x27; panicked at /var/tmp/portage/dev-python/uv-0.8.12/work/cargo_home/gentoo/insta-1.43.1/src/
runtime.rs:679:13:
snapshot assertion for &#x27;find_uv_bin_user_bin-3&#x27; failed in line 373


failures:
    python_module::find_uv_bin_error_message
    python_module::find_uv_bin_in_ephemeral_environment
    python_module::find_uv_bin_in_parent_of_ephemeral_environment
    python_module::find_uv_bin_prefix
    python_module::find_uv_bin_py38
    python_module::find_uv_bin_target
    python_module::find_uv_bin_user_bin

test result: FAILED^O. 2131 passed; 7 failed; 2 ignored; 0 measured; 0 filtered out; finished in 471.37s
</code></pre>
<p>This is with <code>--features git --features pypi --features python --no-default-features</code>.</p>
Platform
<p>Gentoo Linux amd64</p>
Version
<p>0.8.12</p>
Python version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/mgorny">@mgorny</a> on 2025-08-19 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-19 03:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-19 03:11</div>
            <div class="timeline-body"><p>Hm. I&#x27;m not sure if we have a great way to isolate these. We&#x27;d need to have Python report the wrong user bin directory I guess?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mgorny">@mgorny</a> on 2025-08-23 05:28</div>
            <div class="timeline-body"><p>I see a lot of paths there could evaluate to actual system/user directories where some <code>uv</code> is installed:</p>
<p>https://github.com/astral-sh/uv/blob/f1647838aed0c8be85b064e0407449ef220330cb/python/uv/_find_uv.py#L16-L36</p>
<p>But yeah, I suppose overriding some of the system vars to fake path prior to calling the function should suffice. Do you want me to give it a shot?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-23 14:39</div>
            <div class="timeline-body"><p>What would that look like, concretely?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mgorny">@mgorny</a> on 2025-08-23 14:44</div>
            <div class="timeline-body"><p>I&#x27;m guessing some random bashing of <code>sys.prefix = &quot;/dev/null&quot;</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mgorny">@mgorny</a> on 2025-08-29 04:37</div>
            <div class="timeline-body"><p>Gentle ping. Should I try with this idea?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-02 13:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:03 UTC
    </footer>
</body>
</html>
