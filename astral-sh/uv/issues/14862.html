<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync fails to find megatron.training due to incomplete package inclusion in Megatron-LM's pyproject.toml - astral-sh/uv #14862</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv sync fails to find megatron.training due to incomplete package inclusion in Megatron-LM's pyproject.toml</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/14862">#14862</a>
        opened by <a href="https://github.com/pjgao">@pjgao</a>
        on 2025-07-24 01:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pjgao">@pjgao</a> on 2025-07-24 01:38</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hi, <code>uv sync</code>  can only find <code>core</code> directory in <code>site-packages/megatron</code>, because in their pyproject.toml: https://github.com/NVIDIA/Megatron-LM/blob/main/pyproject.toml, they only include 'core' subdirectory:</p>
<pre><code class="language-toml">[tool.setuptools.packages.find]
include = [&quot;megatron.core&quot;, &quot;megatron.core.*&quot;]
</code></pre>
<p>What can I do in my pyproject.toml if my project want to import <code>megatron.training</code>?  Thanks for your kindly reply, I have testing this for daysðŸ˜­</p>
<h3>Platform</h3>
<p>ubuntu20.04</p>
<h3>Version</h3>
<p>uv 0.8.0</p>
<p>command to reproduce:</p>
<pre><code class="language-bash">mkdir test
cd test/
uv init
uv venv
source .venv/bin/activate
uv add &quot;megatron-core @ git+https://github.com/NVIDIA/Megatron-LM.git@core_r0.8.0&quot;
#(test)[xxx@localhost test]# uv add &quot;git+https://github.com/NVIDIA/Megatron-LM.git@core_r0.8.0&quot;
#    Updated https://github.com/NVIDIA/Megatron-LM.git (baf94af3c667248865f23df73b9fb8e2395e6fd0)
#Resolved 18 packages in 1.07s
#Installed 1 package in 30ms
# + megatron-core==0.8.0 (from git+https://github.com/NVIDIA/Megatron-LM.git@baf94af3c667248865f23df73b9fb8e2395e6fd0)
uv run python -c &quot;import megatron.training&quot;
#Traceback (most recent call last):
#  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
#ModuleNotFoundError: No module named 'megatron.training'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @pjgao on 2025-07-24 01:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11920.html">astral-sh/uv#11920</a> on 2025-07-24 01:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-24 02:44</div>
            <div class="timeline-body"><p>Is there a reason this module should be available? This sounds like a question for the megatron folks.</p>
<p>This reproduces when just installing the PyPI wheel too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pjgao">@pjgao</a> on 2025-07-24 03:03</div>
            <div class="timeline-body"><p>In my current workflow, I git clone https://github.com/NVIDIA/Megatron-LM.git to local,  then copy <code>megatron</code> directory to my project (I need to use <code>megatron/training</code> for pretrain gpt model), which need manual copy.
Now I want to migrate this <code>copy</code> to <code>uv</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-24 04:29</div>
            <div class="timeline-body"><p>I think you're using that package in a way that it's not designed to support. There's not a uv-native way to override its build system, unless <code>setuptools</code> allows <code>config-settings</code> to override that metadata (which seems unlikely).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pjgao">@pjgao</a> on 2025-07-24 04:50</div>
            <div class="timeline-body"><p>â€ŒDuring <code>uv sync</code>, can some additional commands be executed to perform a copy operation? This way, when users use it, they only need to run a single <code>uv sync</code> command to set up the environment. It's not must to install the <code>Megatron-LM</code>'s dependency, only it's source code is needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-24 04:53</div>
            <div class="timeline-body"><p>Not right now, no. We don't have a plugin / hook system like that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../NVIDIA/Megatron-LM/issues/1704.html">NVIDIA/Megatron-LM#1704</a> on 2025-07-24 04:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-22 15:59</div>
            <div class="timeline-body"><p>Looks like the suggestion in https://github.com/NVIDIA/Megatron-LM/issues/1704 is to use a Git dependency, which seems reasonable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-08-22 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pjgao">@pjgao</a> on 2025-08-22 23:25</div>
            <div class="timeline-body"><blockquote>
<p>Looks like the suggestion in https://github.com/NVIDIA/Megatron-LM/issues/1704 is to use a Git dependency, which seems reasonable.</p>
</blockquote>
<p>Nemo RL use 'git submodule' to add the dependency, then customize pyprpject.toml can include all megatron dorectory. One more problem is that 'git submodule' only support git 'branch', but not git 'commit id'</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
