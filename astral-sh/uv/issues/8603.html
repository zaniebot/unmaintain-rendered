<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv lock/add selects package versions not available for current platform - astral-sh/uv #8603</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv lock/add selects package versions not available for current platform</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8603">#8603</a>
        opened by <a href="https://github.com/per11235813">@per11235813</a>
        on 2024-10-27 05:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/per11235813">@per11235813</a> on 2024-10-27 05:41</div>
            <div class="timeline-body"><p>First, I would like to thank you for <code>uv</code>, it is just awesome, but I do have a problem</p>
<p>The pyqt5 package has different versions available for linux and windows, Linux:</p>
<pre><code>$ pip index versions pyqt5-qt5
pyqt5-qt5 (5.15.15)
Available versions: 5.15.15, 5.15.14, 5.15.2
</code></pre>
<p>and Windows:</p>
<pre><code>(Notes) &gt; pip index versions pyqt5-qt5
pyqt5-qt5 (5.15.2)
Available versions: 5.15.2
</code></pre>
<p>On windows <code>uv lock</code> wants to use 5.15.15, which is not available so I get a lock file that does not work on Windows. <code>uv add</code> fails with similar logic:</p>
<pre><code>&gt; uv add pyqt5-qt5            
Resolved 2 packages in 762ms
error: distribution pyqt5-qt5==5.15.15 @ registry+https://pypi.org/simple can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>Are there any way to specify a platform requirement for package selection for <code>uv lock</code> and <code>uv add</code>?</p>
<p>For now I use <code>uv pip compile</code> and <code>uv pip sync</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-27 07:55</div>
            <div class="timeline-body"><p>If you don't mind relying on different versions across platforms, you can actually use PEP 508's Environment Markers.
https://docs.astral.sh/uv/concepts/dependencies/#dependency-specifiers-pep-508</p>
<p>You can modify the pyproject.toml file like this, or include Environment Markers when using <code>uv add</code>.</p>
<pre><code class="language-toml">dependencies = [
    &quot;pyqt5-qt5==5.15.15 ; platform_system != 'Windows'&quot;,
    &quot;pyqt5-qt5==5.15.2 ; platform_system == 'Windows'&quot;,
]
</code></pre>
<p>Or do you think UV should use a version that is compatible across all platforms(Windows、Linux、Macos)?</p>
<p>Edit:
However, if your sole requirement is Windows compatibility and there's no need for cross-platform functionality, following @bluss's approach(https://github.com/astral-sh/uv/issues/8603#issuecomment-2439899569) would suffice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-10-27 08:06</div>
            <div class="timeline-body"><p>That package version has the case that 'pyqt5-qt5' has both no windows wheels and no sdist, so it can't be built from source either. A windows-only resolution of the project generates a lockfile with no artifacts at all (no sdist and no wheels)</p>
<p>Forcing only locking for windows looks like this configuration pyproject.toml - but as said, it does not help.</p>
<pre><code>[tool.uv]
environments = [&quot;platform_system == 'Windows'&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-27 18:56</div>
            <div class="timeline-body"><p>This is tracked in https://github.com/astral-sh/uv/issues/5182. I wrote a long explanation of it here: https://github.com/astral-sh/uv/issues/8536#issuecomment-2436123242. But in this case, the above solutions are correct: you can either tell the resolver to only solve for Windows, or you can tell the resolver to use different versions on Windows or non-Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-27 18:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-10-27 18:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-27 18:56</div>
            <div class="timeline-body"><p>(Happy to answer follow-ups but the core issue is tracked elsewhere.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-10-27 19:01</div>
            <div class="timeline-body"><p>I was probably going out on a confusing tangent: but my comment does not have a solution. Instead with <code>environments</code> the experience for the user is the same. It ends up in a scenario where uv could throw a warning or error - the package has no installable artifacts in the lockfile, so uv knows that resolution is 'bad'.  (Do you see what I mean - no sdist and no wheels at all in the lockfile for that package?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9711.html">astral-sh/uv#9711</a> on 2024-12-07 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9928.html">astral-sh/uv#9928</a> on 2024-12-16 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../neuroinformatics-unit/movement/pulls/683.html">neuroinformatics-unit/movement#683</a> on 2025-10-29 20:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
