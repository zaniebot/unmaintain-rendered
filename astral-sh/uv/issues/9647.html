<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync`: Distribution `markupsafe==3.0.2 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform - astral-sh/uv #9647</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv sync</code>: Distribution <code>markupsafe==3.0.2 @ registry+https://download.pytorch.org/whl/cpu</code> can't be installed because it doesn't have a source distribution or wheel for the current platform</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9647">#9647</a>
        opened by <a href="https://github.com/jfaust">@jfaust</a>
        on 2024-12-04 20:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jfaust">@jfaust</a> on 2024-12-04 20:13</div>
            <div class="timeline-body"><p>Similar to #8922, but with <code>uv sync</code>. With the following pyproject.toml:</p>
<pre><code>[project]
name = &quot;uv-repro&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [&quot;jinja2==3.1.4&quot;]

[tool.uv]
index-strategy = 'unsafe-best-match'
find-links = ['https://download.pytorch.org/whl/torch_stable.html']
extra-index-url = [
    'https://download.pytorch.org/whl/cpu',
]
</code></pre>
<p>I get:</p>
<pre><code>Resolved 3 packages in 311ms
error: Distribution `markupsafe==3.0.2 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>If I add <code>https://pypi.org/simple</code> to the beginning of the <code>extra-index-url</code> list, the problem goes away.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-04 20:17</div>
            <div class="timeline-body"><p>To confirm, I can reproduce this</p>
<pre><code>‚ùØ uv lock
Resolved 3 packages in 952ms
Removed anyio v4.6.2.post1
Removed certifi v2024.8.30
Removed example v0.1.0
Removed h11 v0.14.0
Removed httpcore v1.0.7
Removed httpx v0.28.0
Removed idna v3.10
Added jinja2 v3.1.4
Added markupsafe v3.0.2
Removed sniffio v1.3.1
Added uv-repro v0.1.0
‚ùØ uv sync
Resolved 3 packages in 407ms
error: Distribution `markupsafe==3.0.2 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>The lock entry is</p>
<pre><code class="language-toml">[[package]]
name = &quot;markupsafe&quot;
version = &quot;3.0.2&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
wheels = [
    { url = &quot;https://download.pytorch.org/whl/MarkupSafe-3.0.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl&quot;, hash = &quot;sha256:15ab75ef81add55874e7ab7055e9c397312385bd9ced94920f2802310c930396&quot; },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by @zanieb on 2024-12-04 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-04 20:21</div>
            <div class="timeline-body"><p>@charliermarsh looks like the universal resolver to account for wheels on additional indexes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-12-04 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-04 20:26</div>
            <div class="timeline-body"><p>@jfaust I think the recommendation here would be to use the new <code>index</code> APIs and be explicit about where you want your packages to come from.</p>
<p>https://docs.astral.sh/uv/guides/integration/pytorch/
https://docs.astral.sh/uv/configuration/indexes/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @zanieb on 2024-12-04 21:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jfaust">@jfaust</a> on 2024-12-04 22:12</div>
            <div class="timeline-body"><p>@zanieb Got it, that's much nicer. I'm brand new to <code>uv</code> so was just naively trying to convert a <code>requirements.txt</code>. In the repro it works great, I'll need to check a more involved example.</p>
<p>Should I close this, or would you still expect the original to have worked?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-04 22:15</div>
            <div class="timeline-body"><p>We should at least have a better error message for the original.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-14 01:56</div>
            <div class="timeline-body"><p>I'm starting to think about this problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-15 03:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joellidin">@joellidin</a> on 2025-01-10 10:07</div>
            <div class="timeline-body"><p>Hello, I am also having a similar problem. When following the <a href="https://docs.astral.sh/uv/guides/integration/pytorch/#using-a-pytorch-index">guide</a> on how to use <code>uv</code> with pytorch, I get the following error when trying to upgrade my dependencies with <code>uv sync -U</code>:</p>
<pre><code class="language-bash">error: Distribution `torch==2.5.1 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>I am pretty sure this worked before so I don't really know what have changed. I have also tried to set a marker specifically for linux but still get the issue.</p>
<pre><code class="language-toml">[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cpu&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
torchvision = [
  { index = &quot;pytorch-cpu&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/haruka0000">@haruka0000</a> on 2025-01-29 16:19</div>
            <div class="timeline-body"><p>Hello, I also encountered the same issue. I would be grateful if measures could be taken.</p>
<p>For now, I was able to resolve the issue by fixing it to &quot;markupsafe==2.1.3&quot; as shown in the following file, so I will share it.</p>
<pre><code class="language-toml">[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;numpy&gt;=2.1.2&quot;,
    &quot;torch&gt;=2.5.1&quot;,
]


[project.optional-dependencies]
rocm = [
    &quot;torch&gt;=2.1.0&quot;,
    &quot;torchvision&gt;=0.20.0&quot;,
    &quot;markupsafe==2.1.3&quot;,
]


[tool.uv.sources]
torch = [
    { index = &quot;torch-rocm&quot;, extra = &quot;rocm&quot; },
]

[[tool.uv.index]]
name = &quot;torch-rocm&quot;
url = &quot;https://download.pytorch.org/whl/rocm6.2&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lbsucceed">@lbsucceed</a> on 2025-02-03 13:25</div>
            <div class="timeline-body"><blockquote>
<p>Hello, I also encountered the same issue. I would be grateful if measures could be taken.</p>
<p>For now, I was able to resolve the issue by fixing it to &quot;markupsafe==2.1.3&quot; as shown in the following file, so I will share it.</p>
<p>[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
&quot;numpy&gt;=2.1.2&quot;,
&quot;torch&gt;=2.5.1&quot;,
]</p>
<p>[project.optional-dependencies]
rocm = [
&quot;torch&gt;=2.1.0&quot;,
&quot;torchvision&gt;=0.20.0&quot;,
&quot;markupsafe==2.1.3&quot;,
]</p>
<p>[tool.uv.sources]
torch = [
{ index = &quot;torch-rocm&quot;, extra = &quot;rocm&quot; },
]</p>
<p>[[tool.uv.index]]
name = &quot;torch-rocm&quot;
url = &quot;https://download.pytorch.org/whl/rocm6.2&quot;</p>
</blockquote>
<p>Yes, when I tried downgrading to markupsafe==2.1.5 and markupsafe==2.1.3, the error disappeared.</p>
<pre><code class="language-shell">(test) root@DESKTOP:~/test# uv add torch==2.5.0 torchvision==0.20.0 torchaudio==2.5.0 --extra-index-url https://download.pytorch.org/whl/cpu
warning: Indexes specified via `--extra-index-url` will not be persisted to the `pyproject.toml` file; use `--index` instead.
Resolved 18 packages in 2.67s
error: Distribution `markupsafe==3.0.2 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're using CPython 3.11 (`cp311`), but `markupsafe` (v3.0.2) only has wheels with the following Python implementation tag: `cp313`
(test) root@DESKTOP:~/test# uv add markupsafe==2.1.3
Resolved 2 packages in 119ms
Prepared 1 package in 152ms
Uninstalled 1 package in 0.90ms
Installed 1 package in 25ms
 - markupsafe==2.1.5
 + markupsafe==2.1.3
(test) root@DESKTOP:~/test# uv add torch==2.5.0 torchvision==0.20.0 torchaudio==2.5.0 --extra-index-url https://download.pytorch.org/whl/cpu
warning: Indexes specified via `--extra-index-url` will not be persisted to the `pyproject.toml` file; use `--index` instead.
Resolved 18 packages in 2.58s
Audited 13 packages in 0.01ms
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Chiggy-Playz">@Chiggy-Playz</a> on 2025-02-07 12:12</div>
            <div class="timeline-body"><p><strong>Edit: Seems like I've misunderstood the current issue's topic and posted something about a different issue. But I still think this could be added as a new feature to make adding explicit indexes easier. Sorry üòì</strong></p>
<p>I've noticed something and maybe there could a solution to this problem without downgrading.
All commands run in a new project built by <code>uv init</code></p>
<p>I've noticed when i run <code>uv add</code>, pyproject.toml contains the following:</p>
<pre><code class="language-toml">[project]
name = &quot;test3&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
    &quot;torch&quot;,
    &quot;torchvision&quot;,
]

[tool.uv.sources]
torch = { index = &quot;pytorch-cu124&quot; }
torchvision = { index = &quot;pytorch-cu124&quot; }

[[tool.uv.index]]
name = &quot;pytorch-cu124&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
</code></pre>
<p>And after which i get the error and hence the content is rolled back and dependencies and indexes are removed.
Now if we <a href="https://docs.astral.sh/uv/guides/integration/pytorch/">compare this to the example</a> pyproject given in toml to install pytorch, <strong>the only difference</strong> is that the pytorch source is not <em>explicit</em>.</p>
<p>So, what I did was paste the above content into the pyproject manually, add <code>explicit=true</code> to the index, delete <code>uv.lock</code> if it exists, and then run <code>uv sync</code> again. And then it worked perfectly fine!</p>
<pre><code>PS D:\VirtualEnvironments\test3&gt; uv sync
Resolved 28 packages in 3.40s
Installed 12 packages in 2.01s
 + filelock==3.17.0
 + fsspec==2025.2.0
 + jinja2==3.1.5
 + markupsafe==3.0.2
 + mpmath==1.3.0
 + networkx==3.4.2
 + numpy==2.2.2
 + pillow==11.1.0
 + sympy==1.13.1
 + torch==2.6.0+cu124
 + torchvision==0.21.0+cu124
 + typing-extensions==4.12.2
</code></pre>
<p>Proposal: Add a <code>--explicit</code> flag or maybe <code>--explicit-index</code> which will set the index as explicit?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:50 UTC
    </footer>
</body>
</html>
