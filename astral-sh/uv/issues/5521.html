<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>workspace exclude mismatch on linux vs windows - astral-sh/uv #5521</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>workspace exclude mismatch on linux vs windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5521">#5521</a>
        opened by <a href="https://github.com/bluss">@bluss</a>
        on 2024-07-28 18:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bluss">@bluss</a></div>
            <div class="timeline-body"><p>pyprojects like this:</p>
<p>pyproject-local-kernel/pyproject.toml
└── x/pyproject.toml</p>
<p>root declares</p>
<pre><code>[tool.uv.workspace]
members = []
exclude = [&quot;x&quot;, &quot;*&quot;, &quot;**&quot;]
</code></pre>
<p>The child <code>x</code> is a test package that should not be part of the workspace, but it depends on the root.</p>
<pre><code>[project]
name = &quot;x&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;pyproject-local-kernel&quot;,
]

[tool.uv.sources]
pyproject-local-kernel = { path = &quot;..&quot; }
</code></pre>
<ul>
<li>On Linux, this worked as expected and <code>uv lock</code> in the <code>x</code> package succeedes</li>
<li>On Windows it errors out with <code>Package is not included as workspace package in </code>tool.uv.workspace``</li>
</ul>
<p>It looks like it reaches different results on linux vs windows. When looking from the <code>x</code> perspective, uv thinks <code>x</code> is included in the root workspace.</p>
<p>(This bug was found by debugging on CI, so not so much extra information on windows.)
Sorry to pile on another bug.</p>

Linux CI uv lock -v

<pre><code>DEBUG uv 0.2.30
warning: `uv lock` is experimental and may change without warning
DEBUG Found workspace root `/home/runner/work/pyproject-local-kernel/pyproject-local-kernel`, but project is excluded
DEBUG Found workspace root: `/home/runner/work/pyproject-local-kernel/pyproject-local-kernel/x`
DEBUG Adding current workspace member: `/home/runner/work/pyproject-local-kernel/pyproject-local-kernel/x`
DEBUG Searching for Python &gt;=3.12 in managed installations or system path
DEBUG Searching for managed installations at `/home/runner/.local/share/uv/python`
DEBUG Found `cpython-3.10.12-linux-x86_64-gnu` at `/home/runner/.rye/shims/python3` (search path)
DEBUG Found `cpython-3.10.12-linux-x86_64-gnu` at `/home/runner/.rye/shims/python` (search path)
DEBUG Found `cpython-3.10.12-linux-x86_64-gnu` at `/usr/bin/python3` (search path)
DEBUG Found `cpython-3.10.12-linux-x86_64-gnu` at `/usr/bin/python` (search path)
DEBUG Found `cpython-3.10.12-linux-x86_64-gnu` at `/bin/python3` (search path)
DEBUG Found `cpython-3.10.12-linux-x86_64-gnu` at `/bin/python` (search path)
DEBUG Requested Python not found, checking for available download...
DEBUG Acquired lock for `/home/runner/.local/share/uv/python`
DEBUG Using request timeout of 30s
INFO Fetching requested Python...
DEBUG Downloading https://github.com/indygreg/python-build-standalone/releases/download/20240726/cpython-3.12.4%2B20240726-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz to temporary location /home/runner/.local/share/uv/python/.tmpnZpPmh
DEBUG Extracting cpython-3.12.4%2B20240726-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz
DEBUG Moving /home/runner/.local/share/uv/python/.tmpnZpPmh/python to /home/runner/.local/share/uv/python/cpython-3.12.4-linux-x86_64-gnu
Using Python 3.12.4
DEBUG Using request timeout of 30s
DEBUG Resolving with existing `uv.lock`
DEBUG Acquired lock for `/home/runner/.cache/uv/built-wheels-v3/editable/72d48d88d28d6a95`
DEBUG Preparing metadata for: x @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel/x
DEBUG No static `PKG-INFO` available for: x @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel/x (MissingPkgInfo)
DEBUG Found static `pyproject.toml` for: x @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel/x
DEBUG Found workspace root `/home/runner/work/pyproject-local-kernel/pyproject-local-kernel`, but project is excluded
DEBUG No workspace root found, using project root
warning: `uv.sources` is experimental and may change without warning
DEBUG Acquired lock for `/home/runner/.cache/uv/built-wheels-v3/path/67111aeb387f5d59`
DEBUG Preparing metadata for: pyproject-local-kernel @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel
DEBUG No static `PKG-INFO` available for: pyproject-local-kernel @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel (MissingPkgInfo)
DEBUG Found static `pyproject.toml` for: pyproject-local-kernel @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel
DEBUG Found workspace root: `/home/runner/work/pyproject-local-kernel/pyproject-local-kernel`
DEBUG Adding current workspace member: `/home/runner/work/pyproject-local-kernel/pyproject-local-kernel`
DEBUG Solving with installed Python version: 3.12.4
DEBUG Solving with target Python version: &gt;=3.12
DEBUG Adding direct dependency: x*
DEBUG Searching for a compatible version of x @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel/x (*)
DEBUG Adding transitive dependency for x==0.1.0: pyproject-local-kernel*
DEBUG Searching for a compatible version of pyproject-local-kernel @ file:///home/runner/work/pyproject-local-kernel/pyproject-local-kernel (*)
DEBUG Tried 2 versions: pyproject-local-kernel 1, x 1
DEBUG Split universal resolution took 0.000s
Resolved 2 packages in 4ms
</code></pre>



Windows CI uv lock -v

<pre><code>DEBUG uv 0.2.30
warning: `uv lock` is experimental and may change without warning
DEBUG Found workspace root `D:\a\pyproject-local-kernel\pyproject-local-kernel`, but project is excluded
DEBUG Found workspace root: `D:\a\pyproject-local-kernel\pyproject-local-kernel\x`
DEBUG Adding current workspace member: `D:\a\pyproject-local-kernel\pyproject-local-kernel\x`
DEBUG Searching for Python &gt;=3.12 in managed installations, system path, or `py` launcher
DEBUG Searching for managed installations at `C:\Users\runneradmin\AppData\Roaming\uv\data\python`
DEBUG Found `cpython-3.9.13-windows-x86_64-none` at `C:\hostedtoolcache\windows\Python\3.9.13\x64\python3.exe` (search path)
DEBUG Found `cpython-3.9.13-windows-x86_64-none` at `C:\hostedtoolcache\windows\Python\3.9.13\x64\python.exe` (search path)
DEBUG Found `cpython-3.12.4-windows-x86_64-none` at `C:\hostedtoolcache\windows\Python\3.12.4\x64\python.exe` (`py` launcher output)
Using Python 3.12.4 interpreter at: C:\hostedtoolcache\windows\Python\3.12.4\x64\python.exe
DEBUG Using request timeout of 30s
DEBUG Resolving with existing `uv.lock`
DEBUG Acquired lock for `\\?\C:\Users\runneradmin\AppData\Local\uv\cache\built-wheels-v3\editable\2a78b9ffa5c15915`
DEBUG Preparing metadata for: x @ file:///D:/a/pyproject-local-kernel/pyproject-local-kernel/x
DEBUG No static `PKG-INFO` available for: x @ file:///D:/a/pyproject-local-kernel/pyproject-local-kernel/x (MissingPkgInfo)
DEBUG Found static `pyproject.toml` for: x @ file:///D:/a/pyproject-local-kernel/pyproject-local-kernel/x
DEBUG Found workspace root: `D:\a\pyproject-local-kernel\pyproject-local-kernel`
DEBUG Adding root workspace member: `D:\a\pyproject-local-kernel\pyproject-local-kernel`
DEBUG Adding current workspace member: `D:\a\pyproject-local-kernel\pyproject-local-kernel\x`
DEBUG Resolution with `uv.lock` failed: Failed to download and build: `x @ file:///D:/a/pyproject-local-kernel/pyproject-local-kernel/x`
DEBUG Starting clean resolution
DEBUG Acquired lock for `\\?\C:\Users\runneradmin\AppData\Local\uv\cache\built-wheels-v3\editable\2a78b9ffa5c15915`
DEBUG Using cached metadata for: x @ file:///D:/a/pyproject-local-kernel/pyproject-local-kernel/x
DEBUG Found workspace root: `D:\a\pyproject-local-kernel\pyproject-local-kernel`
DEBUG Adding root workspace member: `D:\a\pyproject-local-kernel\pyproject-local-kernel`
DEBUG Adding current workspace member: `D:\a\pyproject-local-kernel\pyproject-local-kernel\x`
error: Failed to download and build: `x @ file:///D:/a/pyproject-local-kernel/pyproject-local-kernel/x`
  Caused by: Failed to parse entry for: `pyproject-local-kernel`
  Caused by: Package is not included as workspace package in `tool.uv.workspace`
</code></pre>


<p>uv 0.2.30</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;workspace mismatch on linux vs windows&quot; to &quot;workspace exclude mismatch on linux vs windows&quot; by <a href="https://github.com/bluss">@bluss</a> on 2024-07-28 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-28 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-28 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-28 19:04</div>
            <div class="timeline-body"><p>@bluss -- Please keep filing bugs, it&#x27;s super valuable and appreciated!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-28 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-07-28 19:13</div>
            <div class="timeline-body"><p>Ok good. I&#x27;d like to document the glob syntax - I think * is wildcard and ** recursive wildcard - but I didn&#x27;t quite get my understanding of it to line up with the glob crate&#x27;s docs.</p>
<p>People running into this bug by the way can in this case work around it by setting <code>[tool.uv.workspace]</code> in x&#x27;s pyproject too, then it definitely will not be assigned as a member of the parent directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-28 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-28 21:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:32:18 UTC
    </footer>
</body>
</html>
