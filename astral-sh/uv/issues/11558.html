<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pytorch cannot be installed from cpu index when opencv is also a dependency - astral-sh/uv #11558</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pytorch cannot be installed from cpu index when opencv is also a dependency</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/11558">#11558</a>
        opened by <a href="https://github.com/Dronakurl">@Dronakurl</a>
        on 2025-02-16 16:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Dronakurl">@Dronakurl</a> on 2025-02-16 16:39</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When following the <a href="https://docs.astral.sh/uv/guides/integration/pytorch/#using-a-pytorch-index">instructions on using uv with pytorch on the  astral website</a>, I encounter an error when adding opencv.</p>
<p>I get the error</p>
<pre><code>3.807 error: Distribution `torch==2.6.0 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform
3.807
3.807 hint: You're on Linux (`manylinux_2_36_x86_64`), but `torch` (v2.6.0) only has wheels for the following platform: `macosx_11_0_arm64`
</code></pre>
<p>Here is the Dockerfile with minimal example that produces this error. Without opencv-python, it works, so torch is installed.
I read #11406, but could not find anything that helps me with that.</p>
<pre><code class="language-Dockerfile">FROM ghcr.io/astral-sh/uv:0.5.24-debian-slim

COPY &lt;&lt;EOF /mre/pyproject.toml
[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;==3.12.0&quot;
dependencies = [
  &quot;torch&gt;1.13.1'&quot;,
  &quot;torchvision&gt;=0.14.1&quot;,
  &quot;opencv-python&quot;,
]

[tool.uv.sources]
torch = [{ index = &quot;pytorch-cpu&quot; }]
torchvision = [{ index = &quot;pytorch-cpu&quot; }]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
EOF

WORKDIR /mre
RUN uv  sync -U 
</code></pre>
<p>Run with
<code>docker build -t uvdebug . --progress plain --no-cache</code></p>
<h3>Platform</h3>
<p>Ubuntu 24.04, x86_64</p>
<h3>Version</h3>
<p>uv 0.6.0</p>
<h3>Python version</h3>
<p>Python 3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Dronakurl on 2025-02-16 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-16 17:02</div>
            <div class="timeline-body"><p>I fixed this on main in #11546.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-16 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-02-16 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dronakurl">@Dronakurl</a> on 2025-02-16 17:05</div>
            <div class="timeline-body"><p>Thank you very much! I missed the other issue in my search.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-16 17:05</div>
            <div class="timeline-body"><p>No worries, it's not at all obvious that it's the same issue, I just learned when debugging that it was <em>also</em> triggered by OpenCV in the end.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
