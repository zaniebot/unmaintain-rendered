```yaml
number: 15220
title: Force newest lock file format (revision = 3, upload-time=...)
type: issue
state: open
author: Ben-grmbl
labels:
  - enhancement
  - good first issue
assignees: []
created_at: 2025-08-11T13:36:40Z
updated_at: 2025-09-22T07:36:48Z
url: https://github.com/astral-sh/uv/issues/15220
synced_at: 2026-01-10T01:57:34Z
```

# Force newest lock file format (revision = 3, upload-time=...)

---

_Issue opened by @Ben-grmbl on 2025-08-11 13:36_

### Summary

We use `uv lock` as a pre-commit hook, with the newest version of uv specified in pre-commit-config.yaml.

However, we still keep getting different versions of uv.lock, depending on which developer pc which local uv version was most recently used to add a library. 
This causes many unrelated changes in the diff for uv.lock, because older uv versions apparently remove e.g. the upload-time=... sections from all hashes.

The `uv lock` from the pre-commit hook, which is version-pinned, and should always be the correct version, apparently does not rewrite the lock file, even if the format.revision do not match.

Is there a way to force `uv lock` to also check the format and revision of the lock file?

The workaround I found is e.g. 
`uv add my-test-package && uv remove my-test-package`, which seems like a terrible hack. 

### Example

`uv lock --force`
 -> Rewrite lock file in the newest format, adding revision = 3, upload-time=... for all hashes.


### Example of a uv.lock diff that resulted from commits by different developers, not detected by `uv lock`

```diff
--- a/uv.lock
+++ b/uv.lock
@@ -1,4 +1,5 @@
 version = 1
+revision = 3
 requires-python = ">=3.10"
 resolution-markers = [
     "python_full_version >= '3.12.4' and sys_platform != 'win32'",
@@ -24,9 +25,9 @@ members = [
 name = "aiohappyeyeballs"
 version = "2.4.6"
 source = { registry = "https://pypi.org/simple" }
-sdist = { url = "https://files.pythonhosted.org/packages/08/07/508f9ebba367fc3370162e53a3cfd12f5652ad79f0e0bfdf9f9847c6f159/aiohappyeyeballs-2.4.6.tar.gz", hash = "sha256:9b05052f9042985d32ecbe4b59a77ae19c006a78f1344d7fdad69d28ded3d0b0", size = 21726 }
+sdist = { url = "https://files.pythonhosted.org/packages/08/07/508f9ebba367fc3370162e53a3cfd12f5652ad79f0e0bfdf9f9847c6f159/aiohappyeyeballs-2.4.6.tar.gz", hash = "sha256:9b05052f9042985d32ecbe4b59a77ae19c006a78f1344d7fdad69d28ded3d0b0", size = 21726, upload-time = "2025-02-07T17:53:12.277Z" }
 wheels = [
-    { url = "https://files.pythonhosted.org/packages/44/4c/03fb05f56551828ec67ceb3665e5dc51638042d204983a03b0a1541475b6/aiohappyeyeballs-2.4.6-py3-none-any.whl", hash = "sha256:147ec992cf873d74f5062644332c539fcd42956dc69453fe5204195e560517e1", size = 14543 },
+    { url = "https://files.pythonhosted.org/packages/44/4c/03fb05f56551828ec67ceb3665e5dc51638042d204983a03b0a1541475b6/aiohappyeyeballs-2.4.6-py3-none-any.whl", hash = "sha256:147ec992cf873d74f5062644332c539fcd42956dc69453fe5204195e560517e1", size = 14543, upload-time = "2025-02-07T17:53:10.304Z" },
 ]
 

```

---

_Label `enhancement` added by @Ben-grmbl on 2025-08-11 13:36_

---

_Comment by @zanieb on 2025-08-11 14:32_

Adding `uv lock --force` is fine with me.

You might want to add a `required-version` for uv in your `pyproject.toml`.

---

_Label `good first issue` added by @zanieb on 2025-08-11 14:32_

---

_Comment by @swirle13 on 2025-08-12 21:13_

I'm just some passerby who happens to have experience with this on his team. I use a solution that should mitigate your core issue of devs with different versions of uv.

I use a modified version of this repo, https://github.com/a5chin/python-uv, where it sets up a dev container environment to standardize everything. So when it installs all packages and features, including uv, it's always the same version. Rebuilding of the dev container makes it quick to get everyone on the same page in case anyone has long-running containers with outdated packages.



---

_Referenced in [mint-o-badges/badgr-server#557](../../mint-o-badges/badgr-server/pulls/557.md) on 2025-08-27 07:10_

---

_Comment by @11happy on 2025-09-06 10:00_

Hii @zanieb  :) , Can I work on this ?

Thank you

---

_Comment by @zanieb on 2025-09-06 11:53_

Yep!

---

_Referenced in [astral-sh/uv#15757](../../astral-sh/uv/pulls/15757.md) on 2025-09-09 15:44_

---

_Comment by @Silvanoc on 2025-09-15 10:26_

> Adding `uv lock --force` is fine with me.
> 
> You might want to add a `required-version` for uv in your `pyproject.toml`.

Weird, I don't find any option `--force` for `uv lock`. Using UV 0.8.17.

---

_Comment by @Silvanoc on 2025-09-15 10:29_

I am having the issue in an OSS with many contributors using different UV versions. Mine using this new Lock File format revision 3 and others using the older revision 1.

Having an option like `--lock-version=1.1` would be enough for me to avoid these conflicts in such a mixed environment. Somewhere on time the whole project should migrate to revision 3 and done.

---

_Comment by @Ir1d on 2025-09-19 22:11_

same.. somehow i dont have `--force` im using `v0.8.19`

---

_Comment by @zanieb on 2025-09-20 02:13_

@Silvanoc / @Ir1d the option has not yet been added, see https://github.com/astral-sh/uv/pull/15757

---

_Comment by @zanieb on 2025-09-20 02:13_

@Silvanoc I'd recommend just adding a `tool.uv.required-version` lower bound?

---

_Comment by @Silvanoc on 2025-09-22 07:36_

> [@Silvanoc](https://github.com/Silvanoc) I'd recommend just adding a `tool.uv.required-version` lower bound?

That would force the whole community of the OSS project where I faced the issue to upgrade UV, right? I will try, since it's probably something meaningful to do, but I'm not sure I will get it accepted. Otherwise, I'll need to downgrade my UV with pipx or so.

---

_Referenced in [populationgenomics/cpg-flow#130](../../populationgenomics/cpg-flow/pulls/130.md) on 2025-09-22 22:41_

---

_Referenced in [open-edge-platform/training_extensions#4965](../../open-edge-platform/training_extensions/pulls/4965.md) on 2025-10-30 12:28_

---

_Referenced in [ciscorn/mojxml-py#61](../../ciscorn/mojxml-py/pulls/61.md) on 2025-11-10 15:34_

---
