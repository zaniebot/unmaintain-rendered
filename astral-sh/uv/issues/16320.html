<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add --active` doesn't appear to use active environment - astral-sh/uv #16320</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv add --active</code> doesn't appear to use active environment</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16320">#16320</a>
        opened by <a href="https://github.com/geophpherie">@geophpherie</a>
        on 2025-10-15 17:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/geophpherie">@geophpherie</a> on 2025-10-15 17:39</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>In the example below, I create a venv in venv1, activate it, then move out of that folder into another one that isn't a descendant of venv1. In this new folder, with venv1 still activated, I try to <code>uv add --active &lt;any_package&gt;</code> but get the error that a <code>pyproject.toml</code> is not found in the current dir or parent dir.</p>
<p>Based on the docs for --active under uv add:</p>
<blockquote>
<p>Prefer the active virtual environment over the project's virtual environment.</p>
</blockquote>
<p>I would have expected it to find the <code>pyproject.toml</code> file for my <code>venv1</code> since it is activated? Or is my interpretation there incorrect?</p>
<pre><code class="language-zsh">~ () ✘ mkdir active_test
~ () ✘ cd active_test
~/active_test () ✘ uv init venv1
Initialized project `venv1` at `/Users/jbeyer/active_test/venv1`
~/active_test () ✘ cd venv1
~/active_test/venv1 (main) ✘ uv sync
Using CPython 3.13.2
Creating virtual environment at: .venv
Resolved 1 package in 9ms
Audited in 0.04ms
~/active_test/venv1 (main) ✘ source .venv/bin/activate
(venv1) ~/active_test/venv1 (main) ✘ cd ..
(venv1) ~/active_test () ✘ mkdir novenv
(venv1) ~/active_test () ✘ cd novenv
(venv1) ~/active_test/novenv () ✘ uv add --active pandas
error: No `pyproject.toml` found in current directory or any parent directory
</code></pre>
<p><code>env</code> output shows path to venv1 as expected:</p>
<pre><code class="language-zsh">VIRTUAL_ENV=/Users/jbeyer/active_test/venv1/.venv
VIRTUAL_ENV_PROMPT=venv1
</code></pre>
<h3>Platform</h3>
<p>macOS Tahoe 26.0.1 arm64</p>
<h3>Version</h3>
<p>uv 0.9.3 (83635a6c4 2025-10-15)</p>
<h3>Python version</h3>
<p>3.13.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @geophpherie on 2025-10-15 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-15 18:27</div>
            <div class="timeline-body"><p>The <code>pyproject.toml</code> is always searched for relative to the current directory. <code>--active</code> just affects the virtual environment location, not discovery of the project itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-10-15 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-10-15 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geophpherie">@geophpherie</a> on 2025-10-15 18:38</div>
            <div class="timeline-body"><p>Ok thanks. It seems my interpretation that it would discover the project based on the active environment was incorrect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @geophpherie on 2025-10-15 21:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:09 UTC
    </footer>
</body>
</html>
