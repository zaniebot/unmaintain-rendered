<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv 0.2.36 regression - `uv pip compile --universal` gives contradictory versions of same packages - astral-sh/uv #6064</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv 0.2.36 regression - `uv pip compile --universal` gives contradictory versions of same packages</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6064">#6064</a>
        opened by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a>
        on 2024-08-13 17:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-08-13 17:52</div>
            <div class="timeline-body"><p>uv 0.2.36 can give contradictory versions of the same package with the following command:</p>
<pre><code>$ echo -e &quot;pylint\ndill==0.3.1.1&quot; | uv pip compile - --universal --python-version 3.11 --annotation-style line 2&gt;/dev/null | grep &quot;pylint==&quot;
</code></pre>
<p>In uv 0.2.35 the output is:</p>
<pre><code>pylint==2.15.8
</code></pre>
<p>In uv 0.2.36 the output is:</p>
<pre><code>pylint==2.15.8
pylint==3.2.6
</code></pre>
<p>It seems <code>pylint==3.2.6</code> is not correctly filtered out as belonging to a Python version not compatible, if we switch <code>--python-version</code> to <code>3.10</code> we can see the markers that are applied when they are relevant:</p>
<pre><code>$ echo -e &quot;pylint\ndill==0.3.1.1&quot; | uv pip compile - --universal --python-version 3.10 --annotation-style line 2&gt;/dev/null | grep &quot;pylint==&quot;
pylint==2.15.8 ; python_version &gt;= '3.11'
pylint==3.2.6 ; python_version &lt; '3.11'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-13 17:53</div>
            <div class="timeline-body"><p>Presuming this is 0.2.36?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv 0.2.26 regression - `uv pip compile --universal` gives contradictory versions of same packages" to "uv 0.2.36 regression - `uv pip compile --universal` gives contradictory versions of same packages" by @notatallshaw-gts on 2024-08-13 17:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-13 17:54</div>
            <div class="timeline-body"><p>Thanks! I think this is related to #6059.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-08-13 17:54</div>
            <div class="timeline-body"><blockquote>
<p>Presuming this is 0.2.36?</p>
</blockquote>
<p>Yeah, fixed post to correct typo</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-08-13 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by @zanieb on 2024-08-13 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-13 23:40</div>
            <div class="timeline-body"><p>Taking a look now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-13 23:46</div>
            <div class="timeline-body"><p>I think the problem here is:</p>
<ul>
<li>We end up solving an irrelevant fork (<code>python_version &lt; 3.11</code>), because we don't test for <code>requires-python</code> disjointness.</li>
<li>In the lockfile, we discard any markers that aren't relevant for the current Python version, so we throw out the markers from the irrelevant fork.</li>
</ul>
<p>If you remove that block (e.g., the whole <code>petgraph.retain_edges(|graph, edge| !graph[edge].is_false())</code>) piece, the resolution is correct:</p>
<pre><code># This file was autogenerated by uv via the following command:
#    uv pip compile req.in --universal --python-version 3.11 -n
astroid==2.13.5 ; python_version &gt;= '3.11'
    # via pylint
astroid==3.2.4 ; python_version &lt; '3.11'
    # via pylint
colorama==0.4.6 ; sys_platform == 'win32'
    # via pylint
dill==0.3.1.1
    # via
    #   -r req.in
    #   pylint
isort==5.13.2
    # via pylint
lazy-object-proxy==1.10.0 ; python_version &gt;= '3.11'
    # via astroid
mccabe==0.7.0
    # via pylint
platformdirs==4.2.2
    # via pylint
pylint==2.15.8 ; python_version &gt;= '3.11'
    # via -r req.in
pylint==3.2.6 ; python_version &lt; '3.11'
    # via -r req.in
tomlkit==0.13.0
    # via pylint
wrapt==1.16.0 ; python_version &gt;= '3.11'
    # via astroid
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-13 23:53</div>
            <div class="timeline-body"><p>I think we should remove that block from <code>graph.rs</code>, and instead ensure that all the markers we see at that point have <em>already</em> been simplified based on <code>requires-python</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6076.html">astral-sh/uv#6076</a> on 2024-08-14 01:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-15 15:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-15 15:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
