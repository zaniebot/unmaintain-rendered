<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undocumented change to workspaces? - astral-sh/uv #6993</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Undocumented change to workspaces?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6993">#6993</a>
        opened by <a href="https://github.com/brynbellomy">@brynbellomy</a>
        on 2024-09-04 02:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/brynbellomy">@brynbellomy</a> on 2024-09-04 02:00</div>
            <div class="timeline-body"><p>I followed the workspaces documentation with versions 0.4.3 and 0.4.4, and it seems that importing modules from the same workspace is broken (perhaps only for certain directory structures?) in recent versions, whereas 0.3.5 worked exactly as expected.</p>
<pre><code>- rootdir/
    - pyproject.toml (has tool.uv.workspace.members which contains 'common' and 'thing')
    - libs/
        - common/
            - pyproject.toml
            - src/
                - common/
                    - __init__.py etc
    - services/
        - thing/
            - pyproject.toml (has tool.uv.sources with common = {workspace = true})
            - some_script.py
</code></pre>
<p><code>some_script.py</code>:</p>
<pre><code class="language-python">import foo from common
</code></pre>
<p>command: <code>uv run --refresh --package=thing services/thing/some_script.py</code></p>
<ul>
<li>v0.4.x: Module common not found</li>
<li>v0.3.5: works</li>
</ul>
<p>I've been clearing the cache at every step of the investigation, deleting <code>uv.lock</code>, re-running <code>uv sync</code>, and also using the <code>--refresh</code> flag when calling <code>uv run</code>.</p>
<p>One last interesting tidbit.  When I switch from 0.3.5 back up to 0.4.4, clean the cache, delete the lockfile, and then run <code>uv sync --package=thing</code>, it deletes the <code>common</code> dependency.  So for some reason, it's not even recognizing it as a dependency despite it being in the <code>dependencies</code> array, and also having a <code>tool.uv.sources</code> callout.</p>
<p>It looks like there were significant changes at 0.4.0, so maybe something fundamental regressed there.  I read through changelogs and docs and couldn't get to the bottom of it, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-04 02:05</div>
            <div class="timeline-body"><p>Is <code>common</code> declared as a dependency in <code>rootdir/services/thing/pyproject.toml</code>? Or only at the root?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-09-04 02:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-04 02:21</div>
            <div class="timeline-body"><p>If you can help put together a small reproducible example I'm happy to help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brynbellomy">@brynbellomy</a> on 2024-09-04 03:06</div>
            <div class="timeline-body"><p>It's declared a dependency only on the leaf, not the root.  Would making it one at the root help?  And sure, I can try to put together a reproducible example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-04 03:16</div>
            <div class="timeline-body"><p>Yeah I would only expect it to be declared as a dependency in <code>rootdir/services/thing/pyproject.toml</code>, and not in the root -- so that sounds right. Was just a guess. A small reproducible example would help a ton, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @zanieb on 2024-10-21 21:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-21 21:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
