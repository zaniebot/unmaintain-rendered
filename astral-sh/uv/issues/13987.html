<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Dockerfile Mac M4 Pro] exec /app/.venv/bin/gunicorn: exec format error - astral-sh/uv #13987</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Dockerfile Mac M4 Pro] exec /app/.venv/bin/gunicorn: exec format error</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13987">#13987</a>
        opened by <a href="https://github.com/jakubbober">@jakubbober</a>
        on 2025-06-12 11:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jakubbober">@jakubbober</a></div>
            <div class="timeline-body">Summary
<p>I wanted to start using <code>uv</code> more like a pro. Before, I was simply using it exactly like <code>pip</code> by just running <code>uv pip</code> instead of <code>pip</code> for faster installs. Then, I had a Dockerfile that looked as follows:</p>
<pre><code># Use an official Python runtime as a parent image
FROM python:3.12-slim

WORKDIR /app

# Install uv
RUN pip install --no-cache-dir uv

COPY requirements.txt /app

RUN uv pip install --system --no-cache -r requirements.txt

COPY . /app

EXPOSE 8000

# Run app when the container launches
CMD [&quot;gunicorn&quot;, &quot;-b&quot;, &quot;0.0.0.0:8000&quot;, &quot;-k&quot;, &quot;uvicorn.workers.UvicornWorker&quot;, &quot;--workers&quot;, &quot;4&quot;, &quot;--threads&quot;, &quot;8&quot;, &quot;--timeout&quot;, &quot;900&quot;, &quot;endpoint:app&quot;]
</code></pre>
<p>To move away from <code>requirements.txt</code> and start using <code>uv.lock</code>, I switched my Dockerfile to the following:</p>
<pre><code># Use an official Python runtime as a parent image
FROM python:3.12-slim

WORKDIR /app

# Install uv
RUN pip install --no-cache-dir uv

COPY pyproject.toml /app
COPY uv.lock /app

RUN uv sync --locked

COPY . /app

EXPOSE 8000

ENV PATH=&quot;/app/.venv/bin:$PATH&quot;

# Run app when the container launches
CMD [&quot;gunicorn&quot;, &quot;-b&quot;, &quot;0.0.0.0:8000&quot;, &quot;-k&quot;, &quot;uvicorn.workers.UvicornWorker&quot;, &quot;--workers&quot;, &quot;4&quot;, &quot;--threads&quot;, &quot;8&quot;, &quot;--timeout&quot;, &quot;900&quot;, &quot;endpoint:app&quot;]
</code></pre>
<p>However, I&#x27;m then ending up with the following error after <code>docker-compose up</code>:</p>
<pre><code>api-1  | exec /app/.venv/bin/gunicorn: exec format error
api-1 exited with code 255
</code></pre>
<p>I also tried some more complicated Dockerfile setups like <a href="https://github.com/astral-sh/uv-docker-example">this</a> or <a href="https://depot.dev/docs/container-builds/how-to-guides/optimal-dockerfiles/python-uv-dockerfile">this</a>, but I was always ending up with the same error.</p>
<p>My hypothesis is that it&#x27;s the fault of my Mac M4 Pro, but I&#x27;m not sure what to do about it. Any help would be appreciated!</p>
Platform
<p>Darwin 24.5.0 arm64 (Mac M4 Pro)</p>
Version
<p>uv 0.7.12 (dc3fd4647 2025-06-06)</p>
Python version
<p>Python 3.12.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/jakubbober">@jakubbober</a> on 2025-06-12 11:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 13:10</div>
            <div class="timeline-body"><p>Is your <code>.venv</code> directory being mounted? That&#x27;ll break things since you&#x27;re mounting a macOS environment into a Linux container.</p>
<p>See https://docs.astral.sh/uv/guides/integration/docker/#developing-in-a-container and https://github.com/astral-sh/uv-docker-example/blob/6473a50c02f9c36dda8c29cf3e0b6fd84839d353/compose.yml#L18-L21</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-16 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jakubbober">@jakubbober</a> on 2025-07-18 23:45</div>
            <div class="timeline-body"><p>Yep, thank was the issue indeed! Solved it by adding another <code>.venv</code> volume to my docker compose, so my <code>docker-compose.yml</code> ended up looking like this:</p>
<pre><code>services:
  chat:
    build: .
    env_file:
      - .env
    ports:
      - &#x27;8000:8000&#x27;
    volumes:
      - .:/app
      - /app/.venv
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
</code></pre>
<p>Before my compose file was missing the <code>- /app/.venv</code> line, now it&#x27;s mounting the entire app separately from the environment which works.
Thanks for the help and sorry for the late reply!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:01 UTC
    </footer>
</body>
</html>
