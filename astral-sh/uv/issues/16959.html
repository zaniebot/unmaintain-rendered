<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync cannot cache the nvidia wheel packages - astral-sh/uv #16959</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv sync cannot cache the nvidia wheel packages</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16959">#16959</a>
        opened by <a href="https://github.com/pplmx">@pplmx</a>
        on 2025-12-03 09:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pplmx">@pplmx</a> on 2025-12-03 09:28</div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code class="language-bash">uv init /var/tmp/kk -p 3.12 &amp;&amp; cd /var/tmp/kk
uv add requests
uv add tensorrt-cu12 --index nv=https://pypi.nvidia.com/ --optional cu12
uv sync # it will remove the above tensorrt* packages, which is expected
uv sync --extra cu12 # it will download again, which is unexpected
</code></pre>
<h3>Platform</h3>
<p>Ubuntu 22.04.5 LTS</p>
<h3>Version</h3>
<p>uv 0.9.10</p>
<h3>Python version</h3>
<p>Python 3.12.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @pplmx on 2025-12-03 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv sync cannot cache the nvidia packages that installed by "uv add tensorrt-cu12 --index nv=https://pypi.nvidia.com/ --optional cu12"" to "uv sync cannot cache the nvidia wheel packages" by @pplmx on 2025-12-10 01:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 17:25</div>
            <div class="timeline-body"><p>That's strange, that shouldn't happen.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-17 17:27</div>
            <div class="timeline-body"><p>Are there any cache headers on that index?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 17:36</div>
            <div class="timeline-body"><p>I see this in the CLI logs (I only checked if I can reproduce, no investigation yet):</p>
<pre><code>DEBUG Identified uncached distribution: tensorrt-cu12-bindings==10.14.1.48.post1
DEBUG Identified uncached distribution: tensorrt-cu12-libs==10.14.1.48.post1
DEBUG Identified uncached distribution: cuda-toolkit==12.9.1
DEBUG Identified uncached distribution: nvidia-cuda-runtime-cu12==12.9.79
</code></pre>
<p>The headers (random file for sample) look good, they are doing both last-modified and etag:</p>
<pre><code>$ curl -I https://pypi.nvidia.com/tensorrt-cu12/tensorrt_cu12-10.7.0.tar.gz#sha256=a9d3119613aeb1c27e7157bf05b110f36b9ab4e85a84c843d4f6248e2648cff5
HTTP/2 200 
content-type: application/x-gzip
content-length: 18327
last-modified: Tue, 03 Dec 2024 07:59:22 GMT
x-amz-server-side-encryption: AES256
x-amz-version-id: null
accept-ranges: bytes
server: AmazonS3
etag: &quot;e742c9ca30dd7563337185612fce1bd2&quot;
x-amz-cf-pop: TXL52-P2
x-amz-cf-id: oDDAOX0AlaAZVKA3a1t_kZLJ-RsHGcD8sxc9zRlkC5eddbwQbhtiMg==
expires: Wed, 17 Dec 2025 17:34:30 GMT
cache-control: max-age=0, no-cache, no-store
pragma: no-cache
date: Wed, 17 Dec 2025 17:34:30 GMT
x-cdn-version: v1
x-cdn: akam
akamai-grn: 0.a741c717.1765992870.1b6d3b
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-17 17:44</div>
            <div class="timeline-body"><p>But they have no-cache and no-store on it. This seems right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-17 18:14</div>
            <div class="timeline-body"><p>I would expect this to resolve it:</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;nvidia&quot;
url = &quot;https://pypi.nvidia.com&quot;
cache-control = { api = &quot;max-age=600&quot;, files = &quot;max-age=365000000, immutable&quot; }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-12-17 18:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/17164.html">astral-sh/uv#17164</a> on 2025-12-17 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pplmx">@pplmx</a> on 2025-12-18 12:00</div>
            <div class="timeline-body"><blockquote>
<p>I would expect this to resolve it:</p>
<p>[[tool.uv.index]]
name = &quot;nvidia&quot;
url = &quot;https://pypi.nvidia.com&quot;
cache-control = { api = &quot;max-age=600&quot;, files = &quot;max-age=365000000, immutable&quot; }</p>
</blockquote>
<p>@charliermarsh
Works fine, thanks a lot!</p>
<p>Just to confirm: once #17164 is merged, the default behavior should handle this correctly, so users won’t need to explicitly set <code>cache-control</code> for the NVIDIA index anymore — is that right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 12:16</div>
            <div class="timeline-body"><p>I've also raised this with the maintainers of the nvidia index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-12-18 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pplmx">@pplmx</a> on 2025-12-19 01:56</div>
            <div class="timeline-body"><blockquote>
<p>I've also raised this with the maintainers of the nvidia index.</p>
</blockquote>
<p>Could you share the upstream issue link so we can track it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-19 12:23</div>
            <div class="timeline-body"><p>I don't think there is a public link I could share.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pplmx">@pplmx</a> on 2025-12-20 04:59</div>
            <div class="timeline-body"><blockquote>
<p>I don't think there is a public link I could share.</p>
</blockquote>
<p>Got it, thanks for the clarification! Please let us know if anything changes or if there’s an update from the maintainers.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
