<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` compiles requirements files with explicit `file:...` requirements into something which `pip` can't install - astral-sh/uv #3180</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv pip compile` compiles requirements files with explicit `file:...` requirements into something which `pip` can't install</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3180">#3180</a>
        opened by <a href="https://github.com/Julian">@Julian</a>
        on 2024-04-22 07:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Julian">@Julian</a> on 2024-04-22 07:37</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Given a <code>requirements.in</code> file containing either <code>file:.#egg=foo</code> or <code>file:/Users/Julian/Desktop/foo/#egg=foo</code>, <code>uv pip compile</code> emits a requirement which looks like a combination of the input and a PEP508 requirement, specifically <code>foo @ file:/Users/Julian/Desktop/foo/#egg=foo</code> -- but neither <code>pip</code> nor <code>pip-compile</code> can deal with such a requirement, they both blow up when seeing it.</p>
<p>E.g.:</p>
<pre><code>⊙  python3.12 -m venv venv &amp;&amp; venv/bin/python -m pip install -r &lt;(uv pip compile &lt;(printf 'file:/Users/Julian/Desktop/foo/#egg=foo\n'))                                                                                                                                       julian@Airm ●
Resolved 1 package in 17ms
ERROR: Invalid requirement: 'foo @ file:/Users/Julian/Desktop/foo/#egg=foo' (from line 3 of /dev/fd/11)
Hint: It looks like a path. File 'foo @ file:/Users/Julian/Desktop/foo/#egg=foo' does not exist.
</code></pre>
<p>~~Changing the input to instead be <code>foo @ thepath</code> obviously works correctly --~~ the history of relative paths and requirements files in pip is ... <a href="https://github.com/pypa/pip/pull/4208">&quot;interesting&quot;</a> I know, so I don't recall why I continue to use <code>file:.</code> everywhere in my packages, I'll have to see what breaks if I switch, but it seems like if <code>uv pip compile</code> is going to muck with the input anyhow that it likely should go further and change <code>file:.#egg=foo</code> to just <code>.</code> and emit <code>foo @ .</code>?</p>
<p>This is on macOS with:</p>
<pre><code>⊙  uv --version                                                                                                                                                                                                                                                                 julian@Airm
uv 0.1.35
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv pip compile` compiles requirements files with explicit `file:...#egg` requirements into something which `pip` can't install" to "`uv pip compile` compiles requirements files with explicit `file:...` requirements into something which `pip` can't install" by @Julian on 2024-04-22 07:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Julian">@Julian</a> on 2024-04-22 07:49</div>
            <div class="timeline-body"><p>Oh, I misspoke when I said <code>foo @ file:.</code> would work with pip, apparently it (still? or was reverted? I really can't follow) does not because PEP 508 only allows for &quot;real&quot; i.e. absolute file URIs, so even emitting that doesn't work with both tools.</p>
<p>I am still chasing https://github.com/pypa/pip/pull/4208 and some other tickets to remind myself what's expected to work, but I filed this at least to see if someone who already knows can tell me :)</p>
<p>EDIT: https://github.com/pypa/pip/issues/8035 and https://github.com/jazzband/pip-tools/pull/1650 seem relevant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/john-g-g">@john-g-g</a> on 2024-04-22 11:29</div>
            <div class="timeline-body"><p>I ran into the same issue, and it makes the transition from pip to uv harder. I have a <code>requirements.in</code> files which contains <code>file://some-path-to-a-wheel.whl</code>. The good news is that <code>uv pip compile</code> now supports compiling them, but the bad news is the <code>requirements.txt</code> file it compiles does not work with <code>pip install -r requirements.txt</code> because pip doesn't support the <code>name @  file://some-path-to-a-wheel.whl</code> syntax generated by <code>uv pip compile</code>. As a hacky workaround, I remove the <code>name @ </code> text in an extra step. The resulting <code>requirements.txt</code> works with both <code>uv pip compile</code> and <code>pip install</code>. Adopting uv will be easier if <code>uv pip compile</code> made it possible, perhaps with a flag, to omit the <code>name @ </code> prefix in <code>requirements.txt</code> .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-22 14:27</div>
            <div class="timeline-body"><p>Yeah pip does not support relative paths in requirements.txt. We support reading them in requirements.txt (but not pyproject.toml, since that has to follow PEP 508). So if you leverage that feature, it will knowingly compile to something pip can't install.</p>
<p>You can instead use <code>foo @ file://${PROJECT_ROOT}</code> or use some other environment variable? That's typically how folks do relative paths in pip.</p>
<p>pip and uv <em>both</em> support relative paths for <code>-e</code> (editable) installs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-04-22 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Julian">@Julian</a> on 2024-04-22 14:57</div>
            <div class="timeline-body"><p>(Thanks for the response!)</p>
<blockquote>
<p>Yeah pip does not support relative paths in requirements.txt.</p>
</blockquote>
<p>It does though doesn't it? Or do you mean to say &quot;officially&quot;? (I.e. it's hard to tell whether what works works intentionally).</p>
<p>Specifically, both of these work fine:</p>
<pre><code>⊙  python3.12 -m venv venv &amp;&amp; venv/bin/python -m pip install 'file:../Development/jsonschema#egg=jsonschema'
</code></pre>
<p>and</p>
<pre><code>⊙  uv pip install --python venv/bin/python 'file:../Development/jsonschema#egg=jsonschema'
</code></pre>
<p>Where I've told both pip and uv to install a relative path to some package.</p>
<p>What <em>doesn't</em> work, or what I was trying to communicate in the issue, was basically if you have that in a requirements file, <code>pip-compile</code> leaves it alone, but <code>uv pip compile</code> will not, it will change it to something that only works with <code>uv</code> and not with <code>pip install</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-22 15:02</div>
            <div class="timeline-body"><p>Oh sorry, so you're saying it does support <em>unnamed</em> relative requirements?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Julian">@Julian</a> on 2024-04-22 15:03</div>
            <div class="timeline-body"><p>Correct!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-22 15:53</div>
            <div class="timeline-body"><p>That's weird. Maybe we should add support over there? It seems like a bad thing to not track the name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/john-g-g">@john-g-g</a> on 2024-04-24 00:16</div>
            <div class="timeline-body"><blockquote>
<p>That's weird. Maybe we should add support over there? It seems like a bad thing to not track the name.</p>
</blockquote>
<p>That seems like the correct approach, but the <code>requirements.txt</code> incompatibility will force us to use uv everywhere we install dependencies, which is difficult. A compatible requirements syntax provides a nice abstraction layer to transition away from pip.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-24 17:41</div>
            <div class="timeline-body"><p>I think we should consider always outputting without the name when it's a relative path.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2024-04-26 17:31</div>
            <div class="timeline-body"><p>When relative paths are in the inputs and outputs, not everyone agrees on which path they ought to be relative <em>to</em>. My own opinion is that any relative path should be relative to the file it appears in. But that can be trouble when e.g. installing with pip from another working directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3593.html">astral-sh/uv#3593</a> on 2024-05-14 23:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nomelas">@Nomelas</a> on 2024-05-14 23:20</div>
            <div class="timeline-body"><p>perhaps a flag to include/exclude the name for relative paths?</p>
<p>my workaround right now is to remove the prefix after running compile, and re-add it when running it again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/rye/issues/1096.html">astral-sh/rye#1096</a> on 2024-05-20 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-05-20 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2024-05-20 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-05-20 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3682.html">astral-sh/uv#3682</a> on 2024-05-21 00:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-21 01:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Julian">@Julian</a> on 2024-05-31 09:49</div>
            <div class="timeline-body"><p>I believe this seems to have regressed (as of 0.2.2, but I see also in 0.2.5) -- but now it's <code>uv</code> generating something <em><code>uv</code> itself</em> cannot deal with rather than <code>pip</code>. Will file a follow up with fuller details.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3934.html">astral-sh/uv#3934</a> on 2024-05-31 09:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
