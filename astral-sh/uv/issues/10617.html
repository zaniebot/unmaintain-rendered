<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv run` with PyTorch dependency works inline, but not for a script - astral-sh/uv #10617</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv run` with PyTorch dependency works inline, but not for a script</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10617">#10617</a>
        opened by <a href="https://github.com/thedch">@thedch</a>
        on 2025-01-14 23:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thedch">@thedch</a> on 2025-01-14 23:16</div>
            <div class="timeline-body"><p>I read https://docs.astral.sh/uv/guides/integration/pytorch -- and I'm trying to get a script to run with a PyTorch dependency. It seems to work inline, but not with the actual script file.</p>
<pre><code>❯ uv run --python 3.12 --with &quot;torch&gt;=2.0,numpy&quot; python
Installed 11 packages in 251ms
Python 3.12.8 (main, Dec  6 2024, 19:42:06) [Clang 18.1.8 ] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import torch ; torch.__version__
'2.5.1'

❯ cat test.py
# /// script
# requires-python = &quot;&gt;=3.12&quot;
# dependencies = [
#     &quot;torch&gt;=2.0&quot;,
#     &quot;numpy&quot;,
# ]
# [[tool.uv.index]]
# name = &quot;pytorch-cpu&quot;
# url = &quot;https://download.pytorch.org/whl/cpu&quot;
# explicit = true
# ///

import torch
print(torch.__version__)

❯ uv run test.py
Reading inline script metadata from `test.py`
  × No solution found when resolving script dependencies:
  ╰─▶ Because only the following versions of torch are available:
          torch&lt;=2.0.0
          torch==2.0.1
          torch==2.1.0
          torch==2.1.1
          torch==2.1.2
          torch==2.2.0
          torch==2.2.1
          torch==2.2.2
          torch==2.3.0
          torch==2.3.1
          torch==2.4.0
          torch==2.4.1
          torch==2.5.0
          torch==2.5.1
      and torch&gt;=2.0.0,&lt;=2.4.1 has no wheels with a matching Python ABI tag, we can conclude that torch&gt;=2.0.0,&lt;=2.4.1 cannot be used.
      And because torch&gt;=2.5.0 has no wheels with a matching platform tag and you require torch&gt;=2.0, we can conclude that your requirements are unsatisfiable.

❯ uv version
uv 0.5.18 (Homebrew 2025-01-11)
</code></pre>
<p>I get the same error with or without the <code>[[tool.uv.index]]</code> bit. This is on MacOS, and I just want the CPU version, so based on my reading of the docs, this should work I believe. Let me know if I'm doing something obviously wrong or if you have any tips - thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-14 23:39</div>
            <div class="timeline-body"><p>Does passing <code>--python 3.12</code> work? It might be attempting to resolve for Python 3.13. (We have better error messages for this in the next release.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thedch">@thedch</a> on 2025-01-15 00:16</div>
            <div class="timeline-body"><p>@charliermarsh running <code>uv run test.py --python 3.12</code> unfortunately gives the same error, but changing the header to</p>
<pre><code># /// script
# requires-python = &quot;&gt;=3.12, &lt;3.13&quot;
# dependencies = [
#     &quot;torch&gt;=2.0&quot;,
#     &quot;numpy&quot;,
# ]
# ///
</code></pre>
<p>resolves the issue! Great catch, thanks so much</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @thedch on 2025-01-15 00:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-15 00:20</div>
            <div class="timeline-body"><p>Ahhh you need to put <code>--python 3.12</code> <em>before</em> <code>test.py</code>. Otherwise, it's considered an argument to <code>test.py</code>, rather than to <code>uv run</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
