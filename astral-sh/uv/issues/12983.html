<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync breaks venv if folder is called python - astral-sh/uv #12983</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv sync breaks venv if folder is called python</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12983">#12983</a>
        opened by <a href="https://github.com/GuillaumeQuenneville">@GuillaumeQuenneville</a>
        on 2025-04-19 16:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/GuillaumeQuenneville">@GuillaumeQuenneville</a> on 2025-04-19 16:55</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi,</p>
<p>I was creating python bindings for my project. I called the folder &quot;python&quot;. I also changed the project name in the .toml and the source directories so it was not that.</p>
<p>When calling uv sync it breaks the the environment by removing the execute flag from the .venv/bin/activate . I also noticed that if i do the steps seperately it also breaks the python symlink.</p>
<p>Changing the folder name fixes the issue.</p>
<h2>Steps to reproduce with uv sync</h2>
<pre><code class="language-python">mkdir python &amp;&amp; cd python
uv init
uv sync
source .venv/bin/activate
</code></pre>
<h3>Output</h3>
<pre><code class="language-bash">❯ source .venv/bin/activate
zsh: permission denied: .venv/bin/activate
❯ cat .venv/bin/activate
# Copyright (c) 2020-202x The virtualenv developers
#
# Permission is hereby granted, free of charge, to any person obtaining
... *** FILE IS FINE ***
❯ ls -al .venv/bin
total 88
drwxr-xr-x@ 14 guillaume  staff   448 19 Apr 12:35 .
drwxr-xr-x@  7 guillaume  staff   224 19 Apr 12:35 ..
-rw-r--r--@  1 guillaume  staff  4122 19 Apr 12:35 activate  &lt;- ****execute permission is gone ****
...
</code></pre>
<h2>steps with seperate venv step</h2>
<p>if you create a venv as a seperate step and then use uv sync it delete the symlink of python and replaces it with an invalid file.</p>
<pre><code>mkdir python &amp;&amp; cd python
uv init --package
uv venv
source .venv/bin/activate   # WORKS
uv sync
python 
</code></pre>
<h3>Output</h3>
<pre><code class="language-bash">❯ uv init --package
Initialized project `python`
❯ uv venv
Using CPython 3.12.8
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
❯ source .venv/bin/activate
❯ python
Python 3.12.8 (main, Dec  6 2024, 19:42:06) [Clang 18.1.8 ] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; ^D.   #THIS WORKS
❯ uv sync
Resolved 1 package in 7ms
      Built python @ file:///Users/guillaume/workspace/python
Prepared 1 package in 348ms
Installed 1 package in 0.96ms
 + python==0.1.0 (from file:///Users/guillaume/workspace/python)
❯ .venv/bin/python
zsh: exec format error: .venv/bin/python
❯ ls -al .venv/bin/
total 96
drwxr-xr-x@ 14 guillaume  staff   448 19 Apr 12:44 .
drwxr-xr-x@  7 guillaume  staff   224 19 Apr 12:44 ..
-rw-r--r--@  1 guillaume  staff  4122 19 Apr 12:44 activate.  &lt;- ****Execute permission gone****
-rw-r--r--@  1 guillaume  staff  2705 19 Apr 12:44 activate.bat
-rw-r--r--@  1 guillaume  staff  2655 19 Apr 12:44 activate.csh
-rw-r--r--@  1 guillaume  staff  4219 19 Apr 12:44 activate.fish
-rw-r--r--@  1 guillaume  staff  3904 19 Apr 12:44 activate.nu
-rw-r--r--@  1 guillaume  staff  2774 19 Apr 12:44 activate.ps1
-rw-r--r--@  1 guillaume  staff  2389 19 Apr 12:44 activate_this.py
-rw-r--r--@  1 guillaume  staff  1728 19 Apr 12:44 deactivate.bat
-rw-r--r--@  1 guillaume  staff  1215 19 Apr 12:44 pydoc.bat
-rwxr-xr-x@  1 guillaume  staff   344 19 Apr 12:44 python              &lt;- *****SYMLINK IS GONE******
lrwxr-xr-x@  1 guillaume  staff     6 19 Apr 12:44 python3 -&gt; python
lrwxr-xr-x@  1 guillaume  staff     6 19 Apr 12:44 python3.12 -&gt; python
</code></pre>
<p>I've only tested macos, and i've obviously renamed the folder so I'm not blocked. I did a quick search in the uv documentation and did not see a warning about this behaviour. Maybe the tool could detect the issue and make a warning also.</p>
<p>Thank you for your work. I love the tool.</p>
<h3>Platform</h3>
<p>macos arm64</p>
<h3>Version</h3>
<p>uv 0.6.14 (a4cec56dc 2025-04-09)</p>
<h3>Python version</h3>
<p>python 3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @GuillaumeQuenneville on 2025-04-19 16:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-19 20:21</div>
            <div class="timeline-body"><p>If you initialize a package, we add an entrypoint:</p>
<pre><code>[project.scripts]
python = &quot;python:main&quot;
</code></pre>
<p>It matches the project name, so, in this case, it's <code>python</code> and clobbers the environment's <code>python</code>.</p>
<p>Yeah we can avoid adding the entrypoint to the project this case, it's pretty niche though. Broadly, we may want to warn if you have an entrypoint name that collides with an existing one — and maybe ban entrypoints called <code>python</code> entirely? I'm sort of surprised that's even allowed in the specification.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-04-25 07:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:44:39 UTC
    </footer>
</body>
</html>
