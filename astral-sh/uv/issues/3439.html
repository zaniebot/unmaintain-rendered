<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>support uv on manylinux_2_17_aarch64 - astral-sh/uv #3439</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>support uv on manylinux_2_17_aarch64</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3439">#3439</a>
        opened by <a href="https://github.com/njzjz">@njzjz</a>
        on 2024-05-07 21:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/njzjz">@njzjz</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>While uv on other architectures only requires glibc 2.17, uv on aarch64 requires glibc 2.28.</p>
<p><img src="https://github.com/astral-sh/uv/assets/9496702/7e4a5222-d86c-40d2-baad-f3a5c45f9a81" alt="image" /></p>
<p>Installing uv in a glibc 2.17 environment is not possible.</p>
<pre><code>    Downloading uv-0.1.40.tar.gz (787 kB)
       ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 787.0/787.0 kB 21.3 MB/s eta 0:00:00
    Installing build dependencies: started
    Installing build dependencies: finished with status 'done'
    Getting requirements to build wheel: started
    Getting requirements to build wheel: finished with status 'done'
    Preparing metadata (pyproject.toml): started
    Preparing metadata (pyproject.toml): finished with status 'error'
    error: subprocess-exited-with-error
    
    × Preparing metadata (pyproject.toml) did not run successfully.
    │ exit code: 1
    ╰─&gt; [6 lines of output]
        
        Cargo, the Rust package manager, is not installed or is not on PATH.
        This package requires Rust and Cargo to compile extensions. Install it through
        the system's package manager or via https://rustup.rs/
        
        Checking for Rust toolchain....
        [end of output]
    
    note: This error originates from a subprocess, and is likely not a problem with pip.
  error: metadata-generation-failed
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-07 23:54</div>
            <div class="timeline-body"><p>We can try reducing the glibc requirement. I think we had trouble compiling on aarch manylinux_2_17 for unknown reasons.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-08 00:01</div>
            <div class="timeline-body"><p>Yeah not sure, some error compiling ring -- see here: https://github.com/astral-sh/uv/pull/3444</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">release</span> added by @charliermarsh on 2024-05-08 00:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/njzjz">@njzjz</a> on 2024-05-08 00:13</div>
            <div class="timeline-body"><blockquote>
<p>Yeah not sure, some error compiling ring -- see here: #3444</p>
</blockquote>
<p>Got it. I found the root cause is https://github.com/briansmith/ring/issues/1728</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-08 09:11</div>
            <div class="timeline-body"><p>Note that in the meantime, using the standalone installer (<code>curl -LsSf https://astral.sh/uv/install.sh | sh</code>) should work; it will fallback to the statically compiled (musl) version, which works independent of glibc version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mayeut">@mayeut</a> on 2024-05-09 08:03</div>
            <div class="timeline-body"><p>If the installer falls back to using the statically compiled version, is there any interest in providing also a dynamically link (gnu) version ?
The fact that the 2 variants are provided is misleading: one would assume it only works on one or the other no ?</p>
<p>If the statically compiled musl version  works everywhere, then why not use this one for the wheel ?</p>
<p>On aarch64 at least, the binary is smaller with musl (despite the fact that libc is statically linked) so it would be a win across the board (unless there are also performance implications): less wheels (less storage on PyPI) &amp; better compatbility as it could be tagged <code>manylinux_2_17_aarch64.musllinux_1_1_aarch64</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-09 13:37</div>
            <div class="timeline-body"><p>Separately, this is now supported: https://github.com/astral-sh/uv/pull/3444</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-09 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2024-05-14 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 14:50</div>
            <div class="timeline-body"><p>We had to revert this as it led to SSL failures (see #3576)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-05-14 15:32</div>
            <div class="timeline-body"><p>What about trying https://github.com/astral-sh/uv/issues/3439#issuecomment-2102159802?</p>
<p>This will block https://github.com/pypa/manylinux/pull/1614 (though reverting for now is the correct short term fix).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-14 16:54</div>
            <div class="timeline-body"><p>@konstin - wdyt?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-05-14 17:42</div>
            <div class="timeline-body"><p>This should be really easy to test later, I just need to use my AS machine and try it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-14 17:48</div>
            <div class="timeline-body"><p>I hope i'm understanding the suggestion correctly, but i think we can add manylinux tags to the musllinux wheels, as long as they are lower than the main manylinux image, the should only be used in this small range.</p>
<p>We could also go further and only build statically linked wheels and tag them both musllinux and manylinux, dropping the &quot;real&quot; manylinux image with dynamically linked glibc altogether.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-05-14 18:36</div>
            <div class="timeline-body"><p>Yes, it works:</p>
<pre><code class="language-bash">pipx run wheel tags --platform-tag +manylinux_2_17_aarch64.manylinux2014_aarch64 uv-0.1.43-py3-none-musllinux_1_1_aarch64.whl
</code></pre>
<p>And the following Dockerfile:</p>
<pre><code class="language-Dockerfile">ARG PYTHON_VERSION=3.11
FROM python:${PYTHON_VERSION}-slim as base

RUN apt-get update
RUN apt-get install -y curl build-essential cmake

ADD ./uv-0.1.43-py3-none-manylinux2014_aarch64.manylinux_2_17_aarch64.musllinux_1_1_aarch64.whl \
      uv-0.1.43-py3-none-manylinux2014_aarch64.manylinux_2_17_aarch64.musllinux_1_1_aarch64.whl
RUN pip install ./uv-0.1.43-py3-none-manylinux2014_aarch64.manylinux_2_17_aarch64.musllinux_1_1_aarch64.whl

ADD ./scripts/requirements/compiled/black.txt /requirements.txt

ENV RUST_LOG=trace
RUN uv pip install -r /requirements.txt --system -v
</code></pre>
<p>Works, while the previous dynamic wheel did not. This would reduce the number of wheels built and hosted, too.</p>
<p>Also checked with the manylinux image:</p>
<pre><code class="language-Dockerfile">FROM quay.io/pypa/manylinux2014_aarch64 as base

ADD ./uv-0.1.43-py3-none-manylinux2014_aarch64.manylinux_2_17_aarch64.musllinux_1_1_aarch64.whl uv-0.1.43-py3-none-manylinux2014_aarch64.manylinux_2_17_aarch64.musllinux_1_1_aarch64.whl
RUN pipx install ./uv-0.1.43-py3-none-manylinux2014_aarch64.manylinux_2_17_aarch64.musllinux_1_1_aarch64.whl

ADD ./scripts/requirements/compiled/black.txt /requirements.txt

ENV RUST_LOG=trace
RUN uv pip install --python python3.12 -r /requirements.txt -v
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-05-17 08:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:51 UTC
    </footer>
</body>
</html>
