```yaml
number: 5179
title: Lockfile-normalized marker representation
type: issue
state: closed
author: konstin
labels:
  - enhancement
  - preview
assignees: []
created_at: 2024-07-18T08:00:28Z
updated_at: 2024-08-10T03:54:55Z
url: https://github.com/astral-sh/uv/issues/5179
synced_at: 2026-01-10T01:57:11Z
```

# Lockfile-normalized marker representation

---

_Issue opened by @konstin on 2024-07-18 08:00_

We need to decide on which normalization we want for markers in the lockfile, and implement the algorithm that performs this normalization. For example, #5163 introduces:
```
(python_full_version <= '3.10' and python_version == '3.10') or (python_full_version <= '3.10' and python_version < '3.10') or (python_full_version <= '3.10' and python_version < '3.10' and python_version > '3.10') or (python_full_version <= '3.10' and python_version > '3.10') or (python_full_version > '3.10' and python_version == '3.10') or (python_full_version > '3.10' and python_version < '3.10') or (python_full_version > '3.10' and python_version < '3.10' and python_version > '3.10') or (python_full_version > '3.10' and python_version > '3.10')
```

This marker can be (completely) collapsed, in the current form it's not readable.

Since the marker representation changes the lockfile, we need a stable representation.

---

_Label `enhancement` added by @konstin on 2024-07-18 08:00_

---

_Label `preview` added by @konstin on 2024-07-18 08:00_

---

_Assigned to @ibraheemdev by @charliermarsh on 2024-07-30 15:35_

---

_Referenced in [astral-sh/uv#5898](../../astral-sh/uv/pulls/5898.md) on 2024-08-07 23:55_

---

_Referenced in [astral-sh/uv#5992](../../astral-sh/uv/issues/5992.md) on 2024-08-10 03:29_

---

_Comment by @ibraheemdev on 2024-08-10 03:46_

We now markers in a simplified DNF form. Our simplification is not perfect, but it seems to work well in practice. See https://github.com/astral-sh/uv/issues/5992 for whether we should write as CNF in some cases, but for now I think we're in a good place.

---

_Closed by @ibraheemdev on 2024-08-10 03:46_

---

_Comment by @charliermarsh on 2024-08-10 03:54_

Awesome.

---
