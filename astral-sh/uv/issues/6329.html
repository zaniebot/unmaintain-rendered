<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider adding documentation on using `uv ...` to use a `.venv` in Jupyter notebooks - astral-sh/uv #6329</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider adding documentation on using `uv ...` to use a `.venv` in Jupyter notebooks</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6329">#6329</a>
        opened by <a href="https://github.com/prrao87">@prrao87</a>
        on 2024-08-21 14:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/prrao87">@prrao87</a> on 2024-08-21 14:16</div>
            <div class="timeline-body"><p>Thank you for all the amazing updates!</p>
<p>I've successfully migrated my project workflows over to use <code>uv python</code> and <code>uv run</code>, and this works great. As a user who (sometimes) has to use Jupyter notebooks, I find it a little hard to understand how I can use uv to manage Python versions and virtual environments that are accessible from within the Jupyter notebook.</p>
<p>I did see that it's possible to use <code>uv tool</code> to achieve this in some form, but it's not clear to me how this would work.
https://github.com/astral-sh/uv/issues/4994#issuecomment-2241813473</p>
<p>When I run the command <code>uv tool run --from jupyter-core --with jupyter jupyter notebook</code>, indeed it does open a Jupyter notebook, but it's not clear if I can open a new notebook that's able to use the local virtual environment in that directory or the dependencies specified in <code>uv.lock</code>.</p>
<p>Could there be a documentation section added that explains how users can access a uv virtual environment and/or <code>uv.lock</code> from within a Jupyter notebook?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-21 14:28</div>
            <div class="timeline-body"><p>Uhm, that's a good question. I think it might be a bit tough since exposing a venv to jupyter requires ipykernel in the venv and running a specific ipykernel command [to create the kernel].</p>
<p>But on twitter there was <a href="https://x.com/strangemonad/status/1826080686203449633">this reply</a> and Charlie saying that &quot;@konstin has wanted to do this forever&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/prrao87">@prrao87</a> on 2024-08-21 14:34</div>
            <div class="timeline-body"><p>That's exactly the tweet I wanted to see, thanks for pointing it out! I hope this feature is considered, as this is, for me, is the FINAL step in completely leaving pyenv, poetry and pip and forever using uv in all my workflows. I think this is true for &gt; 90% of users, too. ðŸ˜Ž</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-08-21 14:37</div>
            <div class="timeline-body"><p>Mentioning this, because it hits pretty close to the issue..</p>
<p>I've worked on https://bluss.github.io/pyproject-local-kernel/ which basically is that support, using Uv (or Rye, or others) to define dependencies per notebook project. It's made specifically for JupyterLab (works same way in Jupyter Notebook).</p>
<p>By default when you run JupyterLab (or jupyter notebook), it runs a bundled ipykernel which has access to exactly the dependencies installed together with jupyter. You'll need to do something extra to change this.</p>
<p>If you run jupyterlab with pyproject-local-kernel:</p>
<p><code>uvx --with pyproject-local-kernel --from jupyterlab jupyter-lab</code></p>
<p>Then you have support for using uv projects to define notebook dependencies.</p>
<p>This is something that works for me/my team, we it's easy to check out notebooks from git and have separate directories (projects) with separate dependencies.
There are other ways to do it:</p>
<ul>
<li>Install a kernelspec per virtualenv (or other python env, conda, etc)</li>
<li>VS Code, already natively supports uv's <code>.venv</code>.</li>
<li><strong>Jupyterlab Desktop</strong> has a virtualenv selector built-in (but note that its selector is for Jupyter + the notebook deps together).</li>
</ul>
<p>(1) ~~uvx has the same bug/problem with jupyterlab that was already gracefully fixed for <code>uv run</code>, which is that uvx dies on Ctrl-C and leaves jupyterlab running in the background.~~ (now, of course fixed :sunglasses: )</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Consider adding documentation on using `uv tool ...` for Jupyter notebook users" to "Consider adding documentation on using `uv ...` to use a `.venv` in Jupyter notebooks" by @prrao87 on 2024-08-21 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/prrao87">@prrao87</a> on 2024-08-21 14:53</div>
            <div class="timeline-body"><p>Thanks @bluss for the ideas. Just in case anybody else stumbles across this thread, I did the following and it worked for me using Jupyter Lab:</p>
<pre><code class="language-bash"># Start project which generates .venv
uv init
# Add a sample library
uv add requests
# Add ipykernel to work with notebooks
uv add ipykernel
# Install kernelspec for the current .venv
uv run ipython kernel install --user --name=uv_test
# Run Jupyter Lab and open a new notebook using the newly created kernel `uv_test`
uvx --from jupyter-core --with jupyter jupyter lab
</code></pre>
<p>Then, I test that my <code>requests</code> module import works in the notebook, and it does:</p>
<pre><code class="language-python">import requests
</code></pre>
<p>That's a lot of steps to keep in mind, so I hope that a) this is documented somewhere, as this isn't intuitive for a lot of people, and b) the idea from the tweet linked above is implemented and that uv handles a lot of this burden for the user.
All in all, so happy we've finally reached this stage in Python packaging! ðŸŽ‰</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-08-21 14:59</div>
            <div class="timeline-body"><p>@prrao87 if you don't like to install pyproject-local-kernel (<a href="https://github.com/goerz/python-localvenv-kernel">or others</a>), the following kernelspec here might be fun to install - however I share this for fun and learning, and I would actually recommend installing a dedicated python package instead of hacking around with kernelspecs..  (That said: the python package could be one with just this exact kernelspec! The reason you want to use packages is for reproducible environments, uv style!)</p>
<p>https://bluss.github.io/pyproject-local-kernel/FAQ/#isnt-there-a-less-complicated-way-to-do-it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6334.html">astral-sh/uv#6334</a> on 2024-08-21 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lacker">@lacker</a> on 2024-09-04 22:23</div>
            <div class="timeline-body"><p>For others running into this thread, to get a uv environment working inside VSCode:</p>
<pre><code>uv add ipykernel
uv run ipython kernel install --user --name=uv
</code></pre>
<p>Then - important step - restart VSCode. Then your jupyter notebooks will have a button at the upper right to select a kernel, choose &quot;jupyter kernel&quot;, then &quot;uv&quot; will be one of the selections.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-05 16:05</div>
            <div class="timeline-body"><p>@lacker If you don't mind, I would suggest the following for <strong>VS Code and VSCodium</strong> <strong>specifically</strong>:</p>
<pre><code class="language-bash"># Create a new notebook project
# and open the directory in code
uv init my-notebook
cd my-notebook
uv add ipykernel
code .
</code></pre>
<ul>
<li>Now that the new project directory is open in code, use the action &quot;Create: New Jupyter Notebook&quot;</li>
<li>Click Select Kernel -&gt; Python Environments</li>
<li>Select the virtual environment that uv created. It will be named <code>.venv/bin/python</code> in this dropdown (or maybe <code>.venv\Scripts\python</code> on windows)</li>
</ul>
<p><img src="https://github.com/user-attachments/assets/22d80999-5394-4cab-98f5-8c67edf7631e" alt="image" /></p>
<p>Run this in the notebook to verify that the expected virtualenv is being used.</p>
<pre><code class="language-python">import sys
sys.executable
</code></pre>
<p>It will respond with a path such as <code>/home/user/my-notebook/.venv/bin/python</code> or similar.</p>
<p>You can now run commands such as <code>!uv add pandas</code> etc in the notebook to add more dependencies to the project.</p>
<p>I prefer this way - without registering kernelspecs - because it's easier to work with, also collaboratively, and scales better to many notebook projects. Let me know what you think.
Code also supports using pure python formats such as py:percent for jupyter notebooks, which are another nice way to improve collaborative work, using git etc, with jupyter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lacker">@lacker</a> on 2024-09-05 18:01</div>
            <div class="timeline-body"><p>In my situation I didn't want to open a new project just for this notebook, I had an existing (non-python) project that I wanted to run the notebook inside. But, I see that you can open from the venv directly rather than doing <code>uv run ipython kernel install</code>. You do have to restart VSCode to pick up the venv after you create the venv! (That's what I missed originally.) So, yeah I like your recommendation of opening from the venv better than creating the kernelspec.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/araichev">@araichev</a> on 2024-09-10 01:20</div>
            <div class="timeline-body"><p>So is there a way yet to run a Jupyter notebook within the UV project's virtual environment from the command line (and without VS Code)?
I use Jupyter notebooks for data pipelines within my Python projects, and this is the one missing feature stopping me from switching from Poetry to UV.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-10 02:16</div>
            <div class="timeline-body"><p>@araichev How do you do it with Poetry?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/araichev">@araichev</a> on 2024-09-10 02:51</div>
            <div class="timeline-body"><p>I don't actually do it with Poetry but with Poetry (to manage the project's dependencies) + Virtualenvwrapper (to manage project's virtual environment).</p>
<pre><code># At start of project
&gt; mkdir PROJECT_DIR
&gt; cd PROJECT_DIR
&gt; mkvirtualenv -p3.11 PROJECT_VENV
&gt; poetry add jupyter geopandas
&gt; jupyter notebook

# Can now use GeoPandas inside notebook

# Revisiting project after start
&gt; cd PROJECT_DIR
&gt; workon PROJECT_VENV
&gt; poetry add lets_plot
&gt; jupyter notebook

# Can now use GeoPandas and Lets-Plot inside notebook
</code></pre>
<p>If UV could do this by itself without Virtualenvwrapper, then i'd be sold.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-09-10 09:10</div>
            <div class="timeline-body"><blockquote>
<p>I don't actually do it with Poetry but with Poetry (to manage the project's dependencies) + Virtualenvwrapper (to manage project's virtual environment).</p>
<pre><code># At start of project
&gt; mkdir PROJECT_DIR
&gt; cd PROJECT_DIR
&gt; mkvirtualenv -p3.11 PROJECT_VENV
&gt; poetry add jupyter geopandas
&gt; jupyter notebook

# Can now use GeoPandas inside notebook

# Revisiting project after start
&gt; cd PROJECT_DIR
&gt; workon PROJECT_VENV
&gt; poetry add lets_plot
&gt; jupyter notebook

# Can now use GeoPandas and Lets-Plot inside notebook
</code></pre>
<p>If UV could do this by itself without Virtualenvwrapper, then i'd be sold.</p>
</blockquote>
<p>Yes, I do this everytime. EDIT: you don't need virtualenvwrapper, but neither you do with poetry. If you do <code>poetry/uv add jupyter</code> you should just run <code>poetry/uv run jupyter</code> to run the jupyter in the venv.</p>
<p>The thread is about something different: running jupyter without having it installed in the venv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/araichev">@araichev</a> on 2024-09-10 22:08</div>
            <div class="timeline-body"><p>Oops, my bad. Thanks for the clarification @baggiponte . I wasn't able to get <code>uv run jupyter notebook</code> to work a few weeks ago, but today, after upgrading to UV version 0.4.8, it works. Hooray!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7625.html">astral-sh/uv#7625</a> on 2024-09-22 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-09-22 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2024-09-22 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-22 18:16</div>
            <div class="timeline-body"><p>I am starting to explore and document this stuff here: https://github.com/astral-sh/uv/pull/7625</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-22 18:25</div>
            <div class="timeline-body"><p>@bluss -- Do you know of any way to enable <code>!uv add</code> et al within Jupyter within VS Code, <em>without</em> installing <code>ipykernel</code> into the project itself?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-22 19:12</div>
            <div class="timeline-body"><p>@charliermarsh jupyterlab is my primary interface to jupyter, so I don't really know Code that well, especially not the best way to do things. VS Code experts please help.</p>
<hr />
<p>Non-experimental: What do people do who are used to this? Just use the integrated terminal I guess, and initialize the project there.</p>
<p>And VS Code already offers to create a new environment when you want to select jupyter kernel. Would it be possible for them to put &quot;Create new uv project&quot; beside the venv and conda options?</p>
<p><img src="https://github.com/user-attachments/assets/1a476711-5ffd-4667-ad0a-cf96e4d7dc5e" alt="bild" /></p>
<hr />
<p>Experimental stuff follows.. I would use this as starting point for a conversation, not as a recommendation because it's not a battle tested way to work.</p>
<p>Things get funky (good and bad) if one would install and use this jupyter kernelspec file -- see <a href="https://bluss.github.io/pyproject-local-kernel/FAQ/#isnt-there-a-less-complicated-way-to-do-it">&quot;less complicated way to do it&quot;</a>. It's installed into <code>.local/share/jupyter/kernels/uvrun/kernel.json</code>. (The correct way to distribute this file is probably via PyPI, in a distribution package.)</p>
<p>You can select this kernel in VS Code. (Select Another Kernel =&gt; Jupyter Kernel =&gt; Uv Run). However I don't know what triggers it to reload the kernelspec list and how to get Uv Run to reliably show up in the kernel list the <em>first time</em> after you add the file.</p>
<p><img src="https://github.com/user-attachments/assets/a811523d-5b15-4bd1-a504-2d5565cbcea4" alt="bild" /></p>
<p>If one uses this kernel in a newly created notebook in a new directory - no pyproject.toml's above this directory, uv will launch ipykernel in an emphemeral environment. Then <code>!uv init &amp;&amp; uv add dependency</code> works. Then the user needs to restart the kernel ('Restart' button), and ipykernel execution will switch to the newly installed project. That's a load of magic :slightly_smiling_face:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7679.html">astral-sh/uv#7679</a> on 2024-09-25 06:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-26 00:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akupiectdc">@akupiectdc</a> on 2025-01-30 16:31</div>
            <div class="timeline-body"><p>Hi,</p>
<p>I know this topic is closed but as I am about to migrate from Conda - just wanted to ask if it is possible to replicate my current workflow and create some 'draft' venvs, not necessary projects, that would allow to use these venvs in some research and exploration with the use of Jupyter notebooks in Jupyter tools and VS Code.</p>
<p>An example:</p>
<ol>
<li>conda create --name sample python=3.11</li>
<li>conda activate sample</li>
<li>conda install conda-forge <packages></li>
<li>conda install conda-forge::ipykernel</li>
<li>python -m ipykernel install --user --name sample --display-name &quot;sample&quot;</li>
</ol>
<p>Of course one can use pip instead of Conda-forge channel.</p>
<p>After following these steps I can easily run notebooks with sample kernel both in Jupyter tools (f.e. Jupyter notebook command within activated venv) and the kernel is visible in VS Code in like any folder (I simply need to select the correct venv).</p>
<p>Is it replicable with uv? If so - what are the recommended steps?</p>
<p>If it should be a subject for another topic - I will create one, however I felt it might be somehow related to the OP requirements.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/manzt">@manzt</a> on 2025-02-02 05:48</div>
            <div class="timeline-body"><p>It sounds like the <a href="https://docs.astral.sh/uv/guides/integration/jupyter/">Using uv with Jupyter</a> guide likely covers your question.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
