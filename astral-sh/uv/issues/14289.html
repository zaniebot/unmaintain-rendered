<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot specify multiple uv.sources which depend on platform markers - astral-sh/uv #14289</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cannot specify multiple uv.sources which depend on platform markers</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/14289">#14289</a>
        opened by <a href="https://github.com/adstalla">@adstalla</a>
        on 2025-06-26 18:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/adstalla">@adstalla</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi all, I'm trying to build an application using pytorch which will be distributed to multiple platforms.
I'm trying to write my pyproject.toml so that it /just works/ for my team, where we develop and deploy to both x86 and aarch64.</p>
<p>I have found some prebuilt Jetson Orin wheels from dustynv over at https://forums.developer.nvidia.com/t/pytorch-for-jetson/72048</p>
<p>I have the following in my pyproject.toml:</p>
<pre><code class="language-toml">[project]
dependencies = [
    &quot;torch&gt;=2.3.0&quot;,
    &quot;torchvision&gt;=0.20.0&quot;,
]

[tool.uv]
environments = [
    &quot;sys_platform == 'linux' and platform_machine == 'x86_64'&quot;,
    &quot;sys_platform == 'linux' and platform_machine == 'aarch64'&quot;,
]
override-dependencies = [
    &quot;torch==2.3.0; platform_machine == 'aarch64'&quot;,
    &quot;torchvision&gt;=0.18.0; platform_machine == 'aarch64'&quot;,
]

[[tool.uv.index]]
name = &quot;pytorch-stable-cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true

[tool.uv.sources]
torch = { path = &quot;whl/torch-2.3.0-cp310-cp310-linux_aarch64.whl&quot;, marker = &quot;sys_platform == 'aarch64'&quot; }
torchvision = { path = &quot;whl/torchvision-0.18.0a0+6043bc2-cp310-cp310-linux_aarch64.whl&quot;, marker = &quot;sys_platform == 'aarch64'&quot; }
torch = { index = &quot;pytorch-stable-cu128&quot;, marker = &quot;sys_platform == 'x86_64'&quot; }
torchvision = { index = &quot;pytorch-stable-cu128&quot;, marker = &quot;sys_platform == 'x86_64'&quot; }
</code></pre>
<p>The gist of what I'm trying to do here is:</p>
<ul>
<li>make uv use pytorch cu128 repository for x86</li>
<li>make uv use my local prebuilt wheel for aarch64</li>
</ul>
<p>The problem with this toml of course is that I have duplicate keys in <code>tool.uv.sources</code>. For now I am mostly OK just leaving out the x86 declaration, but I'm imaging at some point I will want to add cpu only support for say <code>darwin</code> platform, etc. I feel like I'm not seeing a proper mechanism to leverage platform markers when specifying my build sources.</p>
<p>Could I get some guidance on whether I am using uv the way its intended here, and if there is a common strategy others are using to solve multi-arch pyproject configuration?</p>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @adstalla on 2025-06-26 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-26 18:13</div>
            <div class="timeline-body"><p>Can you use the <code>whl</code> directory as a flat index (https://docs.astral.sh/uv/concepts/indexes/#flat-indexes) and use (conflicting) indexes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adstalla">@adstalla</a> on 2025-06-26 19:14</div>
            <div class="timeline-body"><p>Cool I hadn't seen that feature. So if I understand correctly, this treats my whl/ directory an index. As long as my wheel file name informs uv that it supports aarch64, other platforms will fall back to the default index.</p>
<p>How would I structure my pyproject to inform uv to prefer the whl/ index first, the pytorch-stable-cu128 repository 2nd, and finally PyPi as the default fallback? I think I'm still stuck on needing multiple source targets by platform markers.</p>
<p>I suppose I could just copy wheels from pytorch-stable-cu128 and just stick to whl/ + PyPi only.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:31:56 UTC
    </footer>
</body>
</html>
