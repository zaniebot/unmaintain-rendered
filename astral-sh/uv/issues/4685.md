```yaml
number: 4685
title: "Install `azure-cli` with `uv` fails"
type: issue
state: closed
author: baggiponte
labels: []
assignees: []
created_at: 2024-07-01T09:59:57Z
updated_at: 2024-07-29T14:57:00Z
url: https://github.com/astral-sh/uv/issues/4685
synced_at: 2026-01-10T01:57:10Z
```

# Install `azure-cli` with `uv` fails

---

_Issue opened by @baggiponte on 2024-07-01 09:59_

Referencing [this](https://github.com/astral-sh/uv/issues/2252#issuecomment-1985853109) comment #2252 but also #4600: some libraries require `wheel` to compile. How should we handle this when using `uv tool install`? (`rye` has the same issue.) Example:

```bash
uv tool install azure-cli
warning: `uv tool install` is experimental and may change without warning.
⠼ azure-mgmt-advisor==2.0.1                                                                                                                                                             error: Failed to download and build `jsmin==2.2.2`
  Caused by: Failed to build: `jsmin==2.2.2`
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
error in jsmin setup command: use_2to3 is invalid.
```

---

_Comment by @konstin on 2024-07-01 10:19_

There is a problem with jsmin (jsmin 2.2.2 uses a feature that has been removed in setuptools 58.0.2 (https://setuptools.pypa.io/en/latest/history.html#v58-0-2)), but that's not the real problem here, it's shadowing something else: uv fails because we try to install an old version of azure cli because we reject newer versions due to preleases:

```
$ uv pip install azure-cli==2.61.0
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of azure-keyvault-administration==4.4.0b2 and azure-cli==2.61.0 depends on
      azure-keyvault-administration==4.4.0b2, we can conclude that azure-cli==2.61.0 cannot be used.
      And because you require azure-cli==2.61.0, we can conclude that the requirements are unsatisfiable.

      hint: azure-keyvault-administration was requested with a pre-release marker (e.g.,
      azure-keyvault-administration==4.4.0b2), but pre-releases weren't enabled (try: `--prerelease=allow`)
```

uv then goes all the way back to `azure-cli==2.0.67`, which fails due to the transitive jsmin dependency.

---

_Comment by @baggiponte on 2024-07-01 10:32_

Oh, thanks. Now I get another error:

```bash
uv tool install azure-cli --prerelease=allow
...
error: Failed to find dist-info directory `azure-cli-2.61.0.dist-info` in environment at /Users/luca/Library/Application Support/uv/tools/azure-cli
```

Will rename the issue, I guess.

EDIT: it also happens with huggingface-cli:

```
uv tool install huggingface-hub
warning: `uv tool install` is experimental and may change without warning.
Resolved 12 packages in 383ms
Prepared 2 packages in 74ms
Installed 12 packages in 18ms
 + certifi==2024.6.2
 + charset-normalizer==3.3.2
 + filelock==3.15.4
 + fsspec==2024.6.1
 + huggingface-hub==0.23.4
 + idna==3.7
 + packaging==24.1
 + pyyaml==6.0.1
 + requests==2.32.3
 + tqdm==4.66.4
 + typing-extensions==4.12.2
 + urllib3==2.2.2
error: Failed to find dist-info directory `huggingface-hub-0.23.4.dist-info` in environment at /Users/luca/Library/Application Support/uv/tools/huggingface-hub
```

---

_Renamed from "How to install tools that require `wheel`?" to "Install `azure-cli` with uv" by @baggiponte on 2024-07-01 10:32_

---

_Referenced in [astral-sh/uv#4686](../../astral-sh/uv/pulls/4686.md) on 2024-07-01 10:36_

---

_Renamed from "Install `azure-cli` with uv" to "Install `azure-cli` with `uv` fails" by @baggiponte on 2024-07-01 10:39_

---

_Comment by @baggiponte on 2024-07-01 10:39_

That was a speedy PR, wow. I wouldn't know how to rename the issue, feel free to suggest and/or close.

---

_Comment by @konstin on 2024-07-01 10:40_

The title is correct :) I'll close it through the PR

---

_Closed by @konstin on 2024-07-01 10:43_

---

_Closed by @konstin on 2024-07-01 10:43_

---

_Referenced in [astral-sh/uv#4689](../../astral-sh/uv/issues/4689.md) on 2024-07-01 12:15_

---

_Comment by @mdragoss on 2024-07-26 12:30_

I which release version this would be fixed? 0.2.29 this still fails

---

_Comment by @baggiponte on 2024-07-29 14:56_

> I which release version this would be fixed? 0.2.29 this still fails

that's odd. it works for me on the latest (and even previous ones) with `--prerelease=allow`.

---

_Referenced in [astral-sh/uv#14415](../../astral-sh/uv/issues/14415.md) on 2025-07-02 10:20_

---
