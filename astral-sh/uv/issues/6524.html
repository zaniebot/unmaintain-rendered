<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv python list` fails if a pyenv-win install is included in the windows registry - astral-sh/uv #6524</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv python list</code> fails if a pyenv-win install is included in the windows registry</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6524">#6524</a>
        opened by <a href="https://github.com/DavidCEllis">@DavidCEllis</a>
        on 2024-08-23 14:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/DavidCEllis">@DavidCEllis</a></div>
            <div class="timeline-body">

<p>If a version of python is installed via pyenv with the <code>--register</code> flag then subsequently <code>uv</code> will fail to list python installs as it attempts to query metadata of a file that does not exist.</p>
<p>It looks like this is caused because <code>uv</code> makes the assumption that <code>py --list-paths</code> will return paths with only <code>&lt;major&gt;.&lt;minor&gt;</code> version information while pyenv installs are shown with <code>&lt;major&gt;.&lt;minor&gt;.&lt;micro&gt;</code>[^1]. The regex is then capturing the <code>&lt;micro&gt;</code> part of the version as part of the path to the python executable.</p>
<p>https://github.com/astral-sh/uv/blob/bbcd10d3cc7710b8c33955b91915e8463c2b6b9b/crates/uv-python/src/py_launcher.rs#L36-L39</p>
<p>Commands:</p>
<pre><code>pyenv install 3.12.5 --register
uv python list
</code></pre>
<p>Full output:</p>
<pre><code>C:\&gt;uv --version
uv 0.3.2 (c5440001c 2024-08-23)

C:\&gt;py --list
No installed Pythons found!

C:\&gt;uv python list
cpython-3.12.5-windows-x86_64-none     &lt;download available&gt;
cpython-3.11.9-windows-x86_64-none     &lt;download available&gt;
cpython-3.10.14-windows-x86_64-none    &lt;download available&gt;
cpython-3.9.19-windows-x86_64-none     &lt;download available&gt;
cpython-3.8.19-windows-x86_64-none     &lt;download available&gt;
pypy-3.7.13-windows-x86_64-none        &lt;download available&gt;

C:\&gt;pyenv install 3.12.5 --register
:: [Info] ::  Mirror: https://www.python.org/ftp/python
:: [Installing] ::  3.12.5 ...
:: [Info] :: completed! 3.12.5

C:\&gt;py --list-paths
 -V:3.12.5 *      C:\Users\ducks\.pyenv\pyenv-win\versions\3.12.5\python.exe

C:\&gt;uv python list
error: Failed to query Python interpreter
  Caused by: failed to query metadata of file `C:\.5 *      C:\Users\ducks\.pyenv\pyenv-win\versions\3.12.5\python.exe`
  Caused by: The filename, directory name, or volume label syntax is incorrect. (os error 123)
</code></pre>
<p>Example of <code>py --list-paths</code> output with multiple versions of python installed and registered with pyenv and some regular installs.[^2]</p>
<pre><code> -V:3.13.0rc1 *   C:\Users\ducks\.pyenv\pyenv-win\versions\3.13.0rc1\python.exe
 -V:3.12.5        C:\Users\ducks\.pyenv\pyenv-win\versions\3.12.5\python.exe
 -V:3.12.5-win32  C:\Users\ducks\.pyenv\pyenv-win\versions\3.12.5-win32\python.exe
 -V:3.12          C:\Users\ducks\AppData\Local\Programs\Python\Python312\python.exe
 -V:3.12-32       C:\Users\ducks\AppData\Local\Programs\Python\Python312-32\python.exe
 -V:3.11.9        C:\Users\ducks\.pyenv\pyenv-win\versions\3.11.9\python.exe
 -V:3.10.11       C:\Users\ducks\.pyenv\pyenv-win\versions\3.10.11\python.exe
 -V:3.9.13        C:\Users\ducks\.pyenv\pyenv-win\versions\3.9.13\python.exe
 -V:3.8.10        C:\Users\ducks\.pyenv\pyenv-win\versions\3.8.10\python.exe
</code></pre>
<p>[^1]: It looks like <code>py</code> is just using the key names to get the version rather than the value of <code>Version</code> or <code>SysVersion</code> in the registry.
[^2]: This also lead to me finding out that pyenv-win registers 32bit python installs as 64bit which I&#x27;ve reported as a bug there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;&#x27;uv python list&#x27; fails if a pyenv-win install is included in the windows registry&quot; to &quot;`uv python list` fails if a pyenv-win install is included in the windows registry&quot; by <a href="https://github.com/DavidCEllis">@DavidCEllis</a> on 2024-08-23 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 14:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 14:59</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">uv python</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/konstin">@konstin</a> on 2024-08-28 11:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2024-08-29 20:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:33:10 UTC
    </footer>
</body>
</html>
