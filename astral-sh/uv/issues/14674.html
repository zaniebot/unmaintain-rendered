<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installer creates potential security hole by prepending `$PATH` - astral-sh/uv #14674</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Installer creates potential security hole by prepending `$PATH`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14674">#14674</a>
        opened by <a href="https://github.com/PaulVe2024">@PaulVe2024</a>
        on 2025-07-16 22:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/PaulVe2024">@PaulVe2024</a> on 2025-07-16 22:40</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>By default install adds <code>uv</code> and <code>uvx</code> binaries into created <code>$HOME/.local/bin</code> folder,
and prepends the folder to <code>$PATH</code></p>
<p>That means that binary put there will replace any system or user executables.</p>
<p>Search for related articles for &quot;vulnerability by possibility of replacing system binaries within $PATH&quot;
like Cybersecurity lessons: A PATH vulnerability in Windows
https://www.expressvpn.com/blog/cybersecurity-lessons-a-path-vulnerability-in-windows/</p>
<p>Unless stated reason are  given in documentation and installer log,
the installation folder MUST be appended to the <code>$PATH</code>, i.e. added to the paths list as the last.</p>
<h3>Platform</h3>
<p>any</p>
<h3>Version</h3>
<p>0.7.21</p>
<h3>Python version</h3>
<p>not related</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @PaulVe2024 on 2025-07-16 22:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-16 22:47</div>
            <div class="timeline-body"><p>cc @Gankra</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-07-19 18:10</div>
            <div class="timeline-body"><p>If I understand correctly, the ExpressVPN blog post you linked is about the risk of changing the <em>system-wide</em> PATH environment variable, which introduces a risk that actions from one user can impact another user. It <em>also</em> requires the directory that is added to have overly loose permissions (i.e., not just writable by administrator/trusted accounts). Quoting from the blog post (emphasis added):</p>
<blockquote>
<p>Suppose an administrator regularly uses a custom program (clean.bat) to do administrative operations. He adds the directory it resides in, C:tools, to the <em>system PATH</em> variable....</p>
</blockquote>
<blockquote>
<p>Users rarely change the <em>system PATH environment variable</em>, and it is even rarer for them to specify a world-writable directory there, though that is definitely possible. It is more likely that an installation process introduces a vulnerability.</p>
</blockquote>
<blockquote>
<p>To that end, we have created a simple PowerShell script which you can use to audit your system.... You can run the script as a low privilege user to see if any of the directories <em>in the system PATH</em> are writable....</p>
</blockquote>
<blockquote>
<p>You can secure yourself by removing such directories from your <em>system PATH</em>....</p>
</blockquote>
<p>The uv installer only modifies the <em>user-specific</em> PATH. The uv installer cannot modify the system PATH, because the uv installer does not require administrative rights to run.</p>
<p>The Windows installer modifies <code>HKEY_CURRENT_USER</code>, not <code>HKEY_LOCAL_MACHINE</code>:</p>
<pre><code class="language-powershell">function Add-Path($LiteralPath) {
  Write-Verbose &quot;Adding $LiteralPath to your user-level PATH&quot;

  $RegistryPath = 'registry::HKEY_CURRENT_USER\Environment'
</code></pre>
<p>The UNIX installer modifies files in the current home directory, not global files like /etc/profile or /etc/environment:</p>
<pre><code class="language-sh">add_install_dir_to_path() {
    # Edit rcfiles ($HOME/.profile) to add install_dir to $PATH
[...]
        # Find the first file in the array that exists and choose
        # that as our target to write to
        for _rcfile_relative in $_rcfiles; do
            _home=&quot;$(print_home_for_script &quot;$_rcfile_relative&quot;)&quot;
            local _rcfile=&quot;$_home/$_rcfile_relative&quot;
</code></pre>
<p>In addition, the blog post you linked does not distinguish prepending or appending to PATH. The &quot;phantom DLL hijacking&quot; attack scenario, for instance, relies on the DLL not existing at all in the system except in the malicious PATH directory (because PATH is searched <em>after</em> the standard system location for DLLs), and the diagnostic tool they provide does not report differently based on whether a directory is at the beginning or end of PATH.</p>
<p>Nonetheless, the reason for prepending to the PATH is given in the comments in the installer: <code># Prepending path in case a system-installed binary needs to be overridden</code></p>
<p>The installer intentionally shadows any <code>uv</code>, <code>uvx</code>, and <code>uvx</code> binaries installed by the system so that the updated versions get used. Furthermore, as documented, <code>uv python install</code>, <code>uv python install --preview</code>, and <code>uv tool install</code> can install other commands requested by the user, which is an explicit request from the user to use these versions in preference to any version available on the system.</p>
<p>Because this is a directory in a single user's home directory and under their own control (not world-writable), and because the PATH entry pointing to this directory is only added for that same user's account, I believe this is not a security vulnerability. No access is given which the user did not already have.</p>
<p>In order to be able to add malicious things to the directory that the installer adds to PATH, you have to <em>already</em>  have access to the user's account. See also the excellent post from Microsoft's Raymond Chen called <a href="https://devblogs.microsoft.com/oldnewthing/20060508-22/?p=31283">&quot;It rather involved being on the other side of this airtight hatchway&quot;</a>:</p>
<blockquote>
<p>It’s like saying that somebody’s home windows are insecure because a burglar could get into the house by merely unlocking and opening the windows from the inside. (But if the burglar has to get inside in order to unlock the windows…)</p>
</blockquote>
<p>Please let me know if you think my analysis is incorrect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-11-14 18:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:09 UTC
    </footer>
</body>
</html>
