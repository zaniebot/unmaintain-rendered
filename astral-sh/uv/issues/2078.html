<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for pip download command or fix &quot;Failed to download distributions&quot; error message in offline mode - astral-sh/uv #2078</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for pip download command or fix &quot;Failed to download distributions&quot; error message in offline mode</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2078">#2078</a>
        opened by <a href="https://github.com/mborus">@mborus</a>
        on 2024-02-29 10:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mborus">@mborus</a></div>
            <div class="timeline-body"><p>I've tried downloading and installing downloaded files with uv (0.1.12 (f68b2d1d5 2024-02-28)) and it seems
that pip's download functionality is not fully supported.</p>
<p>My use case: I need to install Python packages offline or with internet access filtered from a USB stick.</p>
<p>With pip I can issue this command</p>
<pre><code>python -m pip download -r requirements.txt </code></pre>
<p>and it will download all required files into a folder</p>
<p>I can then copy this folder to a target machine with filtered (or no) internet and run</p>
<pre><code>python -m pip install -r requirements.txt --no-index --find-links .</code></pre>
<p>and install.</p>
<p>The download command is not supported by uv.
The offline install syntax seems to work (I used pip to download)
but throws an error &quot;Failed to download distributions&quot; (when it shouldn't attempt downloads)</p>
<pre><code>(312_venv) C:\data\install\python312&gt;python -m uv pip install -r requirements.txt --find-links . --no-index
Resolved 225 packages in 59.80s
error: Failed to download distributions
  Caused by: Failed to unzip wheel: pandas==2.2.1
  Caused by: failed to rename file from \\?\C:\Users\&lt;removed&gt;\AppData\Local\uv\cache\.tmpMqkbVd to \\?\C:\Users\&lt;removed&gt;\AppData\Local\uv\cache\archive-v0\gG2ZOtGzn-FK9d-qIxqXW
  Caused by: Zugriff verweigert (os error 5)</code></pre>
<p>After installing with pip, the next run of uv works fine and reports</p>
<pre><code> Audited 49 packages in 199ms</code></pre>
<p>Testcase for Windows 10 to reproduce problem</p>
<p>On internet connected PC</p>
<ul>
<li>Download a fresh Python 3.12.2 for Windows and install it</li>
<li>Get requirements.txt from https://github.com/mborus/requirements-txt/blob/main/requirements_312_incomplete.txt</li>
<li>connect USB stick, from CMD.EXE move to the drive, create a folder and enter it.</li>
<li>copy the python installer there and the requirements.txt file</li>
<li>run &quot;py -3.12 -m pip download pip uv&quot;</li>
<li>run &quot;py -3.12 -m pip download -r requirements.txt&quot;</li>
</ul>
<p>On offline PC</p>
<ul>
<li>Connect USB stick</li>
<li>Install Python 3.12.2 for all Users</li>
<li>Use CMD.EXE to move inside the folder</li>
<li>create a venv and activate it</li>
<li>run &quot;python -m pip install uv pip --no-index --find-links .&quot;</li>
<li>run &quot;python -m uv pip install -r requirements.txt --no-index --find-links .&quot;</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @konstin on 2024-02-29 10:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-29 10:27</div>
            <div class="timeline-body"><p>The failed to download error is misleading, the error that renaming the file failed. Could you have the same problem about some corporate security software as in https://github.com/astral-sh/uv/issues/1491 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mborus">@mborus</a> on 2024-02-29 10:46</div>
            <div class="timeline-body"><blockquote>
<p>The failed to download error is misleading, the error that renaming the file failed. Could you have the same problem about some corporate security software as in #1491 ?</p>
</blockquote>
<p>Thanks, yes that's a good guess, because the reason why I install from downloads is to get around our firewall.
And there's strange virus scanning going on. I never had problems like this with pip in years...</p>
<p>To check I ran the whole testcase fresh and it finished without an error. So uv can install from a folder.</p>
<p>It would be nice to change the confusing error message (and to include pip's download flag) and maybe some needed retry logic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> removed by @konstin on 2024-02-29 10:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @konstin on 2024-02-29 10:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @konstin on 2024-02-29 10:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/omdaniel">@omdaniel</a> on 2024-02-29 16:46</div>
            <div class="timeline-body"><p>I am not sure the pip has the same mechanism of unziping a package and then nearly instantaneously trying to access the contents, perhaps this is a side effect of the speed of execution. My hunch is that simply retrying several times after the os send a read access error would resolve this particular issue at the expense of adding some complexity to the code for an issue that probably only effects an exceedingly small fraction of users</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-01 10:57</div>
            <div class="timeline-body"><p>I'd be fine with adding retry workarounds, but i'd need an environment to reproduce and test the fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mborus">@mborus</a> on 2024-03-01 11:20</div>
            <div class="timeline-body"><blockquote>
<p>I'd be fine with adding retry workarounds, but i'd need an environment to reproduce and test the fix.</p>
</blockquote>
<p>One work around that could help terminal users is an optional parameter that asks the user to confirm retries if uv decides that it has a file access error. I could test a fix attempt mid next week when I come in for an office workday.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johannesloibl">@johannesloibl</a> on 2024-06-05 06:42</div>
            <div class="timeline-body"><p>We have the same problem frequently on our Windows-based Gitlab runners.
Usually re-running solves the issue most of the times, but it's pretty annoying.</p>
<pre><code>error: Failed to download and build `fire==0.6.0`
  Caused by: Failed to write to the distribution cache
  Caused by: failed to rename file from \\?\D:\glb\r8ALcmRh\0\global_projects\.....\.cache\uv\built-wheels-v3\.tmpVhMjHj\fire-0.6.0 to \\?\D:\glb\r8ALcmRh\0\global_projects\.....\.cache\uv\built-wheels-v3\index\70e6dbc41e17fe7c\fire\0.6.0\-zjUg4RGmAQ8yytArRU5B\fire-0.6.0.tar.gz
  Caused by: Access is denied. (os error 5)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @konstin on 2024-07-02 09:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-04 15:27</div>
            <div class="timeline-body"><p>I think regarding the Windows problem we have #4605 / #1491 and for <code>pip download</code> we have https://github.com/astral-sh/uv/issues/3163 to track these things.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-07-04 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tleonhardt">@tleonhardt</a> on 2025-01-08 16:58</div>
            <div class="timeline-body"><p>I would very much like <code>uv</code> to have the capability to do a <code>uv pip download</code> to support some rare cases when I need to deal with installing software on systems that are not connected to the Internet or a PyPI mirror.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:07 UTC
    </footer>
</body>
</html>
