<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`find-links` or `path =` causes absolute wheel path to become relative path when creating lock file - astral-sh/uv #16602</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`find-links` or `path =` causes absolute wheel path to become relative path when creating lock file</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/16602">#16602</a>
        opened by <a href="https://github.com/marcschachtsiek">@marcschachtsiek</a>
        on 2025-11-05 17:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/marcschachtsiek">@marcschachtsiek</a> on 2025-11-05 17:17</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>This issue is effectively the complete inverse of <a href="https://github.com/astral-sh/uv/issues/6458">#6458</a>.</p>
<p>I am working on a project that is used in a cloud environment where we have some wheels in a shared folder (defined by an absolute path). Everyone has a space that they can use to work on projects so everyone may have a different repo directory and path to it (it becomes a problem when the <code>uv.lock</code> file is created in one that is fewer folders deep than the one it will be used in). There are multiple packages that have their wheels located in that shared wheels folder.</p>
<pre><code class="language-toml">dependencies = [
    &quot;package-in-wheels-folder&gt;=1.0.0&quot;
]

[tool.uv]
find-links = [
    &quot;/shared_drive/some/folders/wheels&quot;
]
</code></pre>
<p>When creating the <code>uv.lock</code> file, each of them will have their path made relative like:</p>
<pre><code class="language-toml">[[package]]
name = &quot;package-in-wheels-folder&quot;
version = &quot;1.0.0&quot;
source = { path = &quot;../../../../../../shared_drive/some/folders/wheels/&lt;wheels_file&gt;.whl&quot; }
</code></pre>
<p>If someone now wants to recreate the environment with <code>uv sync --frozen</code> and happens to be in a deeper nested folder than this, it will fail. From a more shallow one this still happens to work since extra <code>..</code> will just stay in the base directory <code>/</code>.</p>
<p>It fails as expected given the <code>uv.lock</code> file with:</p>
<pre><code>  × Failed to download `package-in-wheels-folder==1.0.0`
  ├─▶ Failed to read from the distribution cache
  ╰─▶ failed to query metadata of file
      `/remaining/bits/from/deeper/path/shared_drive/some/folders/wheels/&lt;wheels_file&gt;.whl`: No such file or directory (os error 2)
</code></pre>
<p>In this example, <code>/remaining/bits/from/deeper/path</code> is the part of the path that the repo is deeper than all of the <code>../</code> in the <code>uv.lock</code> file.</p>
<p>I realise this is quite an edge case, but nonetheless it would be useful if the <code>uv.lock</code> file respected the type of path from the <code>pyproject.toml</code> file, i.e. relative in <code>pyproject.toml</code> becomes relative in <code>uv.lock</code> (to keep <a href="https://github.com/astral-sh/uv/issues/6458">#6458</a> resolved) and if it is absolute in <code>puproject.toml</code> then it should be absolute in <code>uv.lock</code> to resolve this issue. Or perhaps some default and explicit keyword to ensure it is clear.</p>
<p>Note: the same has also been tested by explicitly setting the <code>path</code> for the package and results in the same problem.</p>
<pre><code class="language-toml">[tool.uv.sources]
package-in-wheels-folder = { path = &quot;/shared_drive/some/folders/wheels/&lt;wheels_file&gt;.whl&quot; }
</code></pre>
<h3>Platform</h3>
<p>Linux 6.8.0 (AWS) x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.9.7</p>
<h3>Python version</h3>
<p>Python 3.10.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @marcschachtsiek on 2025-11-05 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/marcschachtsiek">@marcschachtsiek</a> on 2025-11-06 09:46</div>
            <div class="timeline-body"><p>Just found <a href="https://github.com/astral-sh/uv/issues/11832">#11832</a>.</p>
<blockquote>
<p>[...] and lockfiles are intended to be committed.</p>
</blockquote>
<p>This part of the first reply is why this is an issue here, someone creating it and someone else using it from a different location with the <code>--frozen</code> flag can lead to the issue above.</p>
<blockquote>
<p>This is a useful feature, in cases with networked drives (e.g. we have an existing pip wheel cache on a networked drive) in lab enviornments, in this case absolute paths are actually more portable</p>
</blockquote>
<p>I agree with this final comment, perhaps there could be an keyword that can be used (so perhaps not <code>find-links</code>, but as a replacement for <code>path =</code>) to explicitly mark something as an absolute path.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/marcschachtsiek">@marcschachtsiek</a> on 2025-11-06 09:51</div>
            <div class="timeline-body"><p>If this is currently the expected behaviour and on purpose, perhaps this issue is becoming more of a feature request, less of a bug report.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hanslovsky">@hanslovsky</a> on 2025-11-06 15:08</div>
            <div class="timeline-body"><p>Thank you for opening this @marcschachtsiek. I have the exact same problem yesterday and was preparing a minimum example in preparation to open an issue, but you beat me to it. I am 100% interested in an existing solution, or to request this as a bug fix/feature, if it is not possible to preserve absolute paths in find-links at this time.</p>
<p>Note that I tried to set</p>
<pre><code>source = { path = &quot;/shared_drive/some/folders/wheels/&lt;wheels_file&gt;.whl&quot; }
</code></pre>
<p>manually in <code>uv.lock</code>, but subsequent <code>uv sync</code> reverted that change to a relative path.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/17122.html">astral-sh/uv#17122</a> on 2025-12-13 10:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 17:05</div>
            <div class="timeline-body"><p>The logic for relative/absolute paths is unfortunately complex because it touches a lot of parts, but I agree that we shouldn't turn explicit absolute paths to relative paths.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
