<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot install git dependency from Windows - astral-sh/uv #5491</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cannot install git dependency from Windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5491">#5491</a>
        opened by <a href="https://github.com/mcrumiller">@mcrumiller</a>
        on 2024-07-26 20:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mcrumiller">@mcrumiller</a> on 2024-07-26 20:04</div>
            <div class="timeline-body"><p>I'm trying to install a package on one of our local gitlab servers. pip succeeds whereas uv fails (url and project name redacted since it's work stuff):</p>
<p>version: <code>uv==0.2.30</code>.</p>
<pre><code>C:\&gt;python -m uv pip install git+https://&lt;url&gt;/&lt;project&gt;.git
Updating https://&lt;url&gt;/&lt;project&gt;.git (HEAD)
error: Git operation failed
  Caused by: failed to fetch into: C:\Users\&lt;username&gt;\AppData\Local\uv\cache\git-v0\db\002f1daecf4da80d
  Caused by: process didn't exit successfully: `git fetch --force --update-head-ok https://&lt;url&gt;/&lt;project&gt;.git +HEAD:refs/remotes/origin/HEAD` (exit code: 128)
--- stderr

Unhandled Exception: System.ArgumentException: Illegal characters in path.
   at System.Security.Permissions.FileIOPermission.EmulateFileIOPermissionChecks(String fullPath)
   at System.IO.Directory.InternalGetCurrentDirectory(Boolean checkHost)
   at System.Diagnostics.Process.StartWithCreateProcess(ProcessStartInfo startInfo)
   at System.Diagnostics.Process.Start()
   at Microsoft.Git.CredentialManager.Interop.Windows.WindowsEnvironment.TryLocateExecutable(String program, String&amp; path)
   at Microsoft.Git.CredentialManager.EnvironmentExtensions.LocateExecutable(IEnvironment environment, String program)
   at Microsoft.Git.CredentialManager.CommandContext..ctor()
   at Microsoft.Git.CredentialManager.Program.Main(String[] args)
bash: /dev/tty: No such device or address
error: failed to execute prompt script (exit code 1)
fatal: could not read Username for 'https://&lt;url&gt;': No such file or directory
</code></pre>
<p>However, with <code>pip</code> it succeeds:</p>
<pre><code>C:\&gt;python -m pip install git+https://&lt;url&gt;/&lt;project&gt;.git
&lt;lots of output and takes a long time&gt;
Successfully installed &lt;project&gt;
</code></pre>
<p>The funkiest character the url and project contain is the dash character <code>-</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-26 20:55</div>
            <div class="timeline-body"><p>Nothing obvious stands out to me here. Are you able to install other Git dependencies -- i.e., is it specific to this package?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2024-07-26 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mcrumiller">@mcrumiller</a> on 2024-07-26 21:13</div>
            <div class="timeline-body"><p>Ok, I think I'm going to clone the repo and re-host internally and re-attempt to install.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mcrumiller">@mcrumiller</a> on 2024-07-26 21:16</div>
            <div class="timeline-body"><p>Ok, another example: I imported/cloned <code>python-gitlab</code>, which is hosted at https://gitlab.com/python-gitlab/python-gitlab, to our internal company gitlab instance, and attempted an install.</p>
<pre><code>C:\Projects&gt;python -m uv pip install git+https://gitlab.&lt;company&gt;.net/&lt;group&gt;/python-gitlab.git
Updating https://gitlab.&lt;company&gt;.net/&lt;group&gt;&gt;/python-gitlab.git (HEAD)
error: Git operation failed
  Caused by: failed to clone into: C:\Users\&lt;username&gt;\AppData\Local\uv\cache\git-v0\db\5b5bbd451124ffaa
  Caused by: process didn't exit successfully: `git fetch --force --update-head-ok https://gitlab.&lt;company&gt;.net/&lt;group&gt;&gt;/python-gitlab.git +HEAD:refs/remotes/origin/HEAD` (exit code: 128)
--- stderr

Unhandled Exception: System.ArgumentException: Illegal characters in path.
   at System.Security.Permissions.FileIOPermission.EmulateFileIOPermissionChecks(String fullPath)
   at System.IO.Directory.InternalGetCurrentDirectory(Boolean checkHost)
   at System.Diagnostics.Process.StartWithCreateProcess(ProcessStartInfo startInfo)
   at System.Diagnostics.Process.Start()
   at Microsoft.Git.CredentialManager.Interop.Windows.WindowsEnvironment.TryLocateExecutable(String program, String&amp; path)
   at Microsoft.Git.CredentialManager.EnvironmentExtensions.LocateExecutable(IEnvironment environment, String program)
   at Microsoft.Git.CredentialManager.CommandContext..ctor()
   at Microsoft.Git.CredentialManager.Program.Main(String[] args)
bash: /dev/tty: No such device or address
error: failed to execute prompt script (exit code 1)
fatal: could not read Username for 'https://gitlab.&lt;company&gt;.net': No such file or directory
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-07-27 00:53</div>
            <div class="timeline-body"><p>Does it work if you don't use the internal clone and use the upstream one?</p>
<p>Can you run both uv and pip with <code>GIT_TRACE=1</code> and <code>GIT_CURL_VERBOSE=1</code> set and see if you spot any noticeable errors/differences?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-07-27 20:08</div>
            <div class="timeline-body"><p>Thanks, I tried it with upstream python-gitlab and it does work. Looking at the logs nothing seems odd besides the fact that it stops working during the git credential manage step in uv vs pip during the query to git credential manager. The exception leads me to think it's related to the environment being passed to credential manager between both uv vs pip.</p>
<p>Worth checking, but do you happen to have a configuration issue with your <code>PATH</code> as it's described in this blog https://jakebinstein.com/blog/illegal-characters-in-path-problem-with-windows-10/ locally?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mcrumiller">@mcrumiller</a> on 2024-07-28 17:15</div>
            <div class="timeline-body"><p>Thanks @samypr100. Unfortunately I don't seem to have any illegal chars in the path--no double-quotes,  I removed all trailing backslashes, but still no luck.</p>
<p>I'll see if I can get rust/llvm installed over the next few days to see if I can help diagnose. I appreciate the help!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mcrumiller">@mcrumiller</a> on 2024-10-08 18:00</div>
            <div class="timeline-body"><p>FYI this issue no longer exists on the latest version. Whether there was an update on our end or on yours, or in git, the issue appears to resolved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mcrumiller on 2024-10-08 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-08 21:52</div>
            <div class="timeline-body"><p>Great, thank you for following up!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:31 UTC
    </footer>
</body>
</html>
