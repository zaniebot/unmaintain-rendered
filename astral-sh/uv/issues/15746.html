<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance issues when using multiple git+ssh dependencies - astral-sh/uv #15746</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Performance issues when using multiple git+ssh dependencies</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15746">#15746</a>
        opened by <a href="https://github.com/jasondamour">@jasondamour</a>
        on 2025-09-08 23:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jasondamour">@jasondamour</a> on 2025-09-08 23:06</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><strong>Unfortunately, I believe this issue is caused by Github</strong>. However, I'd like to log a ticket here to help others find this issue.</p>
<p>Using more than ~4 git+ssh dependencies causes connections to fail. I don't have a public repro, but here is the redacted logs:
<strong>pyproject.toml</strong></p>
<pre><code>[project]
name = &quot;proj&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
requires-python = &quot;~=3.11.0&quot;
dependencies = [
    &quot;config&quot;,
    &quot;cache&quot;,
    &quot;entitlement_metadata&quot;,
    &quot;exceptions&quot;,
    &quot;aws&quot;,
    &quot;feature-flags&quot;,
    &quot;logger&quot;,
    &quot;retry&quot;,
    &quot;secrets&quot;,
    &quot;stats&quot;,
    &quot;types&quot;,
]

[tool.uv.sources]
config = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/config&quot; }
cache = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/cache&quot; }
exceptions = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/exceptions&quot; }
aws = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/aws&quot; }
feature-flags = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/feature_flags&quot; }
logger = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/logger&quot; }
retry = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/retry&quot; }
secrets = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/secrets&quot; }
stats = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/stats&quot; }
types = { git = &quot;ssh://git@github.com/org/repo&quot;, branch = &quot;main&quot;, subdirectory = &quot;backend/python/libs/types&quot; }
</code></pre>
<p><strong>error</strong></p>
<pre><code>uv lock --verbose
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
   Updating ssh://git@github.com/org/repo (main)
INFO Waiting to acquire lock for `ssh://github.com/org/repo` at `/home/vscode/.cache/uv/git-v0/locks/2c7a0873aed5bc02`
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)
    Updated ssh://git@github.com/org/repo (4e51ea059af28f6a9869c866be3525cc8ee75468)
   Updating ssh://git@github.com/org/repo (main)


  × Failed to download and build `stats @ git+ssh://git@github.com/org/repo@main#subdirectory=backend/python/libs/stats`
  ├─▶ Git operation failed
  ├─▶ failed to fetch into: /home/vscode/.cache/uv/git-v0/db/2c7a0873aed5bc02
  ├─▶ failed to fetch branch `main`
  ╰─▶ process didn't exit successfully: `/usr/local/bin/git fetch --force --update-head-ok 'ssh://git@github.com/org/repo'
      '+refs/heads/main:refs/remotes/origin/main'` (exit status: 128)
      --- stderr
      kex_exchange_identification: Connection closed by remote host
      Connection closed by 140.82.116.4 port 22
      fatal: Could not read from remote repository.

      Please make sure you have the correct access rights
      and the repository exists.
</code></pre>
<p>I don't think this is uv's fault as I can repro using ssh</p>
<pre><code>➜  for i in {1..5}; do echo &quot;Attempt $i:&quot;; ssh -o ConnectTimeout=5 -T git@github.com; echo &quot;Exit code: $?&quot;; echo &quot;---&quot;; done
Attempt 1:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 2:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 3:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 4:
Hi jasondamour! You've successfully authenticated, but GitHub does not provide shell access.
Exit code: 1
---
Attempt 5:
Connection timed out during banner exchange
Connection to 140.82.116.4 port 22 timed out
Exit code: 255
---
</code></pre>
<h3>Platform</h3>
<p>macos</p>
<h3>Version</h3>
<p>0.8.15</p>
<h3>Python version</h3>
<p>Python 3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @jasondamour on 2025-09-08 23:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jasondamour">@jasondamour</a> on 2025-09-08 23:08</div>
            <div class="timeline-body"><p>I think I've worked around the issue locally by setting <code>~/.ssh/config</code> to share connections:</p>
<pre><code>Host github.com
    ControlMaster auto
    ControlPath ~/.ssh/control:%h:%p:%r
    ControlPersist 600
</code></pre>
<p>Would this be something that UV considers automatically configuring, when a project defines many git+ssh dependencies? Or, is it definitely the responsibility of the host to manage ssh configuration? If the latter, may I add a note to UV docs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @konstin on 2025-09-09 07:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">network</span> added by @konstin on 2025-09-09 07:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zsol">@zsol</a> on 2025-09-09 07:54</div>
            <div class="timeline-body"><p>I wonder what other package managers do here, like Cargo</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sabeechen">@sabeechen</a> on 2026-01-05 18:05</div>
            <div class="timeline-body"><p>I'm not sure if its the same issue, but in my project with 7 git python dependencies over ssh, performing <code>uv sync</code> would consistently see:</p>
<pre><code class="language-bash">41.36   × Failed to download and build `&lt;my_private_repo&gt; @
41.36   │ git+ssh://git@github.com/&lt;my_company&gt;/&lt;my_private_repo&gt;.git@&lt;some_sha&gt;`
41.36   ├─▶ Git operation failed
41.36   ├─▶ failed to clone into: /root/.cache/uv/git-v0/db/&lt;some_hash&gt;
41.36   ├─▶ failed to fetch commit `&lt;some_sha&gt;`
41.36   ╰─▶ process didn't exit successfully: `/usr/bin/git fetch --force
41.36       --update-head-ok 'ssh://git@github.com/&lt;my_company&gt;/&lt;my_private_repo&gt;.git'
41.36       '+&lt;some_sha&gt;`
41.36       (exit status: 128)
41.36       --- stderr
41.36       ssh: Could not resolve hostname github.com: Temporary failure in name
41.36       resolution
41.36       fatal: Could not read from remote repository.
41.36 
41.36       Please make sure you have the correct access rights
41.36       and the repository exists.
41.36 
41.36   help: `&lt;my_private_repo&gt;` was included because `&lt;my_project&gt;` depends on
41.36         `&lt;my_private_repo&gt;`
</code></pre>
<p>for a random one of my private repo dependencies. A DNS failure instead of a connection reset. No amount of futzing with <code>~/.ssh/config</code> seemed to work, but  I was able to work around it by setting:</p>
<pre><code class="language-Dockerfile">ENV UV_CONCURRENT_DOWNLOADS=5
</code></pre>
<p>in my <code>Dockerfile</code> prior to <code>uv sync</code>, which in my case didn't seems to have a measurable impact on total  <code>uv sync</code> time.</p>
<p>Thank you @jasondamour for identifying and creating this issue, I'd spent far too long thinking assuming was broken with my local docker DNS.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-05 20:15</div>
            <div class="timeline-body"><p>It seems like we should add a separate, lower concurrency limit to Git operations that applies per domain?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-05 20:16</div>
            <div class="timeline-body"><p>Is this an ssh-only issue?</p>
<p>We could also just add a hint to that error message suggesting the proper ssh configuration?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sabeechen">@sabeechen</a> on 2026-01-05 21:57</div>
            <div class="timeline-body"><p>| Is this an ssh-only issue?</p>
<p>It would seem so to me, though I'm not knowledgeable about the <code>uv</code> internals at play  My project has a great deal more non-git+ssh dependencies and I've never seen a similar problem with any of them.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
