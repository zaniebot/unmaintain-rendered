<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overriding dependency with locally compiled *.whl - astral-sh/uv #14138</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Overriding dependency with locally compiled *.whl</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/14138">#14138</a>
        opened by <a href="https://github.com/PawelPeczek-Roboflow">@PawelPeczek-Roboflow</a>
        on 2025-06-18 19:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/PawelPeczek-Roboflow">@PawelPeczek-Roboflow</a> on 2025-06-18 19:26</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hello team.</p>
<p>I do have a question regarding the following use-case in my project:
There is a library that uses <code>opencv-python</code> and uv sync resolved into newest version <code>4.11.0.86</code> (but in general, dependency is defined in the following way <code>opencv-python&gt;=4.8.1.78</code>). For some installations of my package, I would like to have <strong>opencv compiled from sources</strong> with CUDA support included. I do have a script that creates a custom OpenCV wheel in my docker build, at the end of the script I run <code>uv pip install --system my-opencv.whl</code> and then follow with installation of remaining dependencies (<code>uv pip install --system -r pyproject.toml</code>).</p>
<p>At the end of the day I find the env in mismatched state - import of opencv is raising:</p>
<pre><code>ImportError: ERROR: recursion is detected during loading of &quot;cv2&quot; binary extensions. Check OpenCV installation.
</code></pre>
<p>Is there a way on how to reliably include locally compiled packages when installing library under uv control?</p>
<h3>Platform</h3>
<p>independent</p>
<h3>Version</h3>
<p>newesr</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @PawelPeczek-Roboflow on 2025-06-18 19:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-18 20:01</div>
            <div class="timeline-body"><p>This sounds specific to <code>opencv-python</code>, I'm not sure what uv-specific behavior would be relevant here. We support this, either, by installing the wheel separately as you are or by using a <a href="https://docs.astral.sh/uv/concepts/projects/dependencies/#path"><code>source</code></a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PawelPeczek-Roboflow">@PawelPeczek-Roboflow</a> on 2025-06-19 10:01</div>
            <div class="timeline-body"><p>thanks for the answer - was digging a little bit deeper into docs and  https://docs.astral.sh/uv/concepts/projects/sync/#partial-installations may be helpful - testing it out, will let know how it goes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PawelPeczek-Roboflow">@PawelPeczek-Roboflow</a> on 2025-06-24 09:02</div>
            <div class="timeline-body"><p>ok, it works
this is the scratch of what I did:</p>
<pre><code>RUN UV_PROJECT_ENVIRONMENT=/usr $HOME/.local/bin/uv sync --locked --no-install-package opencv-python --extra torch-jp6-cu126 --extra onnx-jp6-cu126
RUN $HOME/.local/bin/uv pip install --system /build/opencv_compilation/opencv-4.11.0/release/python_loader/dist/opencv-4.11.0-py3-none-any.whl
COPY inference_experimental/inference_exp inference_exp
RUN $HOME/.local/bin/uv build
RUN WHEEL=$(ls dist/inference_exp-*.whl) &amp;&amp; $HOME/.local/bin/uv pip install --system --no-deps &quot;${WHEEL}&quot;
</code></pre>
<p>@zanieb some suggestion regarding the convenience of usage:
I want to mention that it seems to be important to have ability for reproducible resolution of dependencies in selected env rather than venv which is not practical for my project.
The <code>UV_PROJECT_ENVIRONMENT</code> works fine, but required additional tweaks (seems like the <code>python3</code> binary is looked for, which required from me additional <code>update-alternatives</code> configs when multiple python binaries were available - so maybe <code>uv sync --system ...</code> would be more handy?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @PawelPeczek-Roboflow on 2025-06-24 09:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:04 UTC
    </footer>
</body>
</html>
