<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uvx with a lock file - astral-sh/uv #13410</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uvx with a lock file</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13410">#13410</a>
        opened by <a href="https://github.com/dimaqq">@dimaqq</a>
        on 2025-05-12 13:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dimaqq">@dimaqq</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I've just ran into a situation where <code>uvx juju-doctor --help</code> fails, but <code>checkout; uv sync; juju-doctor --help</code> works, because (I'm taking some guesses here):</p>
<ul>
<li><code>uv sync</code> uses the lock file<ul>
<li>some-entrypoint runs with specific dependencies</li>
</ul>
</li>
<li><code>uvx some-proj</code> loads the wheel<ul>
<li>wheels don't contain lock files<ul>
<li>some-entrypoint runs with newest allowed dependencies</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>There is a solution for direct deps.</p>
<p>There isn't really a solution for transient deps.</p>
<p>Writing out all the dependencies explicitly in <code>dist-info/METADATA</code> would probably be counter-productive, as that may hurt folks who use this package as a library.</p>
<h3>Example</h3>
<p>https://github.com/pallets/click/issues/2908</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @dimaqq on 2025-05-12 13:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-12 16:19</div>
            <div class="timeline-body"><p>We're interested in something like <code>uvx --locked</code>, but it's complicated because (as you said) the wheel doesn't include the lockfile. I expect we'll design something here eventually, but it's not a high priority at this time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ark-kun">@Ark-kun</a> on 2025-05-12 19:33</div>
            <div class="timeline-body"><p>I think I'm trying to do the same thing (please tell me if that's not the case), but in my case I use repo link (so uv.lock is present):</p>
<p>I have a project with <code>uv.lock</code> file. It has <code>click==8.1.8</code>.
https://github.com/Cloud-Pipelines/oasis-cli/blob/5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154/uv.lock#L77
Despite that, uv run always installs <code>click==8.2.0</code> which is a broken release.</p>
<pre><code>% uv run --refresh --exact --with git+https://github.com/Cloud-Pipelines/oasis-cli.git@5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154 python -c &quot;import click; print(click.__version__)&quot; 
    Updated https://github.com/Cloud-Pipelines/oasis-cli.git (5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154)
Installed 29 packages in 16ms
8.2.0
</code></pre>
<pre><code>% uv run --refresh --frozen --with git+https://github.com/Cloud-Pipelines/oasis-cli.git@5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154 python -c &quot;import click; print(click.__version__)&quot; 
    Updated https://github.com/Cloud-Pipelines/oasis-cli.git (5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154)
Installed 29 packages in 18ms
8.2.0
</code></pre>
<pre><code>% uv run --refresh --locked --with git+https://github.com/Cloud-Pipelines/oasis-cli.git@5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154 python -c &quot;import click; print(click.__version__)&quot; 
    Updated https://github.com/Cloud-Pipelines/oasis-cli.git (5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154)
Installed 29 packages in 18ms
8.2.0
</code></pre>
<p>This seems problematic. I've pinned everything. I'm using exact pinned SHA commit and uv.lock. And yet the package got broken over the weekend.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-12 19:37</div>
            <div class="timeline-body"><p>Yeah, we don't support that yet. Installations from remote source trees (like Git) still currently go through the fully &quot;standardized&quot; package build and install path — which does not allow for tool-specific metadata to have an effect. In that context, <code>uv run --locked</code> refers to your local lockfile. If you want to pin the dependencies of <code>oasis-cli</code>, then add it as a dependency to your project instead of using <code>--with</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimaqq">@dimaqq</a> on 2025-05-12 19:39</div>
            <div class="timeline-body"><p>My 2c: Uv run runs a dependency. The dependencies’ lock files are not used, only the dependency specifications.</p>
<p>For now, you can specify click in your pyproject.toml</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ark-kun">@Ark-kun</a> on 2025-05-12 19:45</div>
            <div class="timeline-body"><p>I guess I was just using <code>uv run --with</code> instead of <code>uvx --from</code>.
Anyways,</p>
<pre><code>uvx --from git+https://github.com/Cloud-Pipelines/oasis-cli.git@5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154 python -c &quot;import click; print(click.__version__)&quot;
    Updated https://github.com/Cloud-Pipelines/oasis-cli.git (5625f4ef1b4c6de65bee913c3cc31bf1cb1c3154)
8.2.0
</code></pre>
<blockquote>
<p>If you want to pin the dependencies of oasis-cli, then add it as a dependency to your project instead of using --with.</p>
</blockquote>
<blockquote>
<p>For now, you can specify click in your pyproject.toml</p>
</blockquote>
<p>unfortunately, there is no project. I'm basically doing <code>uvx</code>.</p>
<blockquote>
<p>Yeah, we don't support that yet. Installations from remote source trees (like Git) still currently go through the fully &quot;standardized&quot; package build and install path — which does not allow for tool-specific metadata to have an effect.</p>
</blockquote>
<p>I see. Just brainstorming. Is there any way I can let users run my app with versions pinned to prevent breakages like the ongoing clock incident?</p>
<p>https://github.com/pallets/click/issues/2908
https://github.com/fastapi/typer/discussions/1215
https://github.com/modelcontextprotocol/python-sdk/issues/688
https://github.com/ai-dynamo/dynamo/issues/1039</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-12 19:48</div>
            <div class="timeline-body"><p>Moving to https://github.com/astral-sh/uv/issues/13414</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:31:18 UTC
    </footer>
</body>
</html>
