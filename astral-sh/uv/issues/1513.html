<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't fail on incompatible file system setups - astral-sh/uv #1513</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don't fail on incompatible file system setups</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1513">#1513</a>
        opened by <a href="https://github.com/bra-fsn">@bra-fsn</a>
        on 2024-02-16 16:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bra-fsn">@bra-fsn</a> on 2024-02-16 16:58</div>
            <div class="timeline-body"><p>Consider the following scenario, where <code>/root/.cache</code> is a persistent volume in a container:</p>
<pre><code class="language-shell">docker run --rm -ti -v cachevol:/root/.cache python:3.11 bash
pip install uv
mkdir /venvs
cd /venvs
uv venv test
export VIRTUAL_ENV=/venvs/test
uv pip install nvidia-cusolver-cu12
</code></pre>
<p>Running the above gives the following error:</p>
<pre><code>error: Failed to install: nvidia_cublas_cu12-12.3.4.1-py3-none-manylinux1_x86_64.whl (nvidia-cublas-cu12==12.3.4.1)
  Caused by: failed to rename file from /venvs/test/lib/python3.11/site-packages/.tmpeSt2og/__init__.py to /venvs/test/lib/python3.11/site-packages/nvidia/__init__.py
  Caused by: No such file or directory (os error 2)
</code></pre>
<p>Using <code>uv pip install --link-mode copy nvidia-cusolver-cu12</code> works as most of the other packages, so I think on the code path, which produces the above error <code>uv</code> should fall back to the <code>copy</code> mode.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 17:05</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>I believe this is a duplicate of https://github.com/astral-sh/uv/issues/1444</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-02-16 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 17:49</div>
            <div class="timeline-body"><p>It might be a bit different, since that's on macOS and this is on Linux.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-16 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">linux</span> added by @zanieb on 2024-02-16 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> removed by @zanieb on 2024-02-16 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bra-fsn">@bra-fsn</a> on 2024-02-16 18:29</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for the report!</p>
<p>I believe this is a duplicate of #1444</p>
</blockquote>
<p>Haven't checked the code, but the other error says it's a cross device link (hardlink, which of course doesn't work between file systems), while this one is a failed rename on the same FS, so I don't think they are (exactly) the same. Might have a common root cause however.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 22:03</div>
            <div class="timeline-body"><p>This <em>may</em> be fixed by https://github.com/astral-sh/uv/pull/1546.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-16 22:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-17 01:20</div>
            <div class="timeline-body"><p>v0.1.3 is out now. Do you mind retrying? (It may not solve it, but it could.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cebtenzzre">@cebtenzzre</a> on 2024-02-17 21:21</div>
            <div class="timeline-body"><p>This is what I saw on uv 0.1.0:</p>
<pre><code>$ pip install torch
Resolved 22 packages in 527ms
Downloaded 19 packages in 1m 15s
error: Failed to install: nvidia_nvtx_cu12-12.1.105-py3-none-manylinux1_x86_64.whl (nvidia-nvtx-cu12==12.1.105)
  Caused by: failed to rename file from /home/jared/.venv/lib/python3.11/site-packages/.tmpGJtW6w/__init__.py to /home/jared/.venv/lib/python3.11/site-packages/nvidia/__init__.py
  Caused by: No such file or directory (os error 2)
</code></pre>
<p>Updating to uv 0.1.3 fixed the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-17 21:22</div>
            <div class="timeline-body"><p>Awesome. I'm going to close for now since we haven't seen this again. Will reopen if it comes up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-17 21:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:56 UTC
    </footer>
</body>
</html>
