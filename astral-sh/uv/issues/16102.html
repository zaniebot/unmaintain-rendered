<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error installing packages from private github repos when running in a git post-receive hook - astral-sh/uv #16102</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Error installing packages from private github repos when running in a git post-receive hook</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16102">#16102</a>
        opened by <a href="https://github.com/BradleyKirton">@BradleyKirton</a>
        on 2025-10-02 11:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/BradleyKirton">@BradleyKirton</a> on 2025-10-02 11:23</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi there ðŸ‘‹</p>
<p>I am trying to make use of uv to run a CLI tool  within a git post-receive hook. The CLI tool is hosted in a private github repo. I did some searching through the existing issues and found an <a href="https://github.com/astral-sh/uv/issues/13054">issue</a> which looks similar but was closed due to inactivity.</p>
<p>My post-receive hook looks like this.</p>
<pre><code class="language-console">#!/usr/bin/env bash
while read oldrev newrev ref; do
    if [[ $ref =~ .*/main$ ]];
    then
        pusher=$(git config --get remote.pushuser)
        pusher=${pusher:-$USER}

        uv tool run \
            --verbose \
            --from bou@git+ssh://git@github.com/BradleyKirton/bou.git@main \
            bou \
            build $ref $pusher
    else
        echo &quot;Ref $ref successfully received.&quot;
    fi
done
</code></pre>
<p>When the hook runs I get the following error.</p>
<pre><code class="language-console">remote:   Ã— Failed to download and build `bou @
remote:   â”‚ git+ssh://git@github.com/BradleyKirton/bou.git@main`
remote:   â”œâ”€â–¶ Git operation failed
remote:   â•°â”€â–¶ process didn't exit successfully: `/usr/lib/git-core/git rev-parse`
remote:       (exit status: 128)
remote:       --- stderr
remote:       fatal: not a git repository: '.'
</code></pre>
<p>If I manually run the hook it works.</p>
<pre><code class="language-console">echo &quot;sha sha refs/heads/main&quot; | example/repo/hooks/post-receive
</code></pre>
<h3>Platform</h3>
<p>Linux 6.16.8-arch3-1 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.8.22</p>
<h3>Python version</h3>
<p>Python 3.13.6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BradleyKirton on 2025-10-02 11:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BradleyKirton">@BradleyKirton</a> on 2025-10-02 11:30</div>
            <div class="timeline-body"><p>I have tried running <code>uv cache clean</code> and it does not make a difference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Z2h-A6n">@Z2h-A6n</a> on 2025-10-02 22:27</div>
            <div class="timeline-body"><p>I just ran into a similar error message, and found that <code>unset GIT_DIR</code> before the <code>uv</code> command (in my case <code>uv sync</code>) solved the problem. I think the issue was because the git hook is run with <code>GIT_DIR</code> set to the bare git repo in which the hook is running, and this confuses uv.</p>
<p>For context, my hook is roughly as follows, though I've removed lots of unrelated details:</p>
<pre><code class="language-bash"># ... details elided, e.g. setting $REPO_DIR, $WORKTREE_PATH, and $branch

# checkout the pushed branch in a work tree directory
git --git-dir=&quot;$REPO_DIR&quot; --work-tree=&quot;$WORKTREE_PATH&quot; checkout -f &quot;$branch&quot;

# Start a subshell so that GIT_DIR is not unset in the rest of the script.
(
    cd $WORKTREE_PATH
    unset GIT_DIR # This is what fixed my problem
    uv sync
)

# ... script continues
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BradleyKirton">@BradleyKirton</a> on 2025-10-03 08:00</div>
            <div class="timeline-body"><p>Thank you @Z2h-A6n, let me investigate this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BradleyKirton">@BradleyKirton</a> on 2025-10-03 08:12</div>
            <div class="timeline-body"><p>@Z2h-A6n your solution works ðŸ˜„</p>
<p>Thank you!</p>
<p>I will close this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BradleyKirton on 2025-10-03 08:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
