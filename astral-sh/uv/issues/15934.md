```yaml
number: 15934
title: Support read-only cache directories
type: issue
state: open
author: konstin
labels:
  - bug
assignees: []
created_at: 2025-09-18T16:47:44Z
updated_at: 2025-12-11T18:29:25Z
url: https://github.com/astral-sh/uv/issues/15934
synced_at: 2026-01-10T01:57:35Z
```

# Support read-only cache directories

---

_Issue opened by @konstin on 2025-09-18 16:47_

Currently, uv fails if a populated cache is read-only. We should not need to modify a populated cache, so we should be able to support a read-only cache.

```console
$ sudo rm -rf a
$ uv venv -c
$ UV_CACHE_DIR=a uv pip install tqdm
$ sudo chmod -R a-w a
$ uv venv -c
$ UV_CACHE_DIR=a uv pip install tqdm
error: failed to open file `a/sdists-v9/.git`: Permission denied (os error 13)
```

---

_Referenced in [astral-sh/uv#15888](../../astral-sh/uv/pulls/15888.md) on 2025-09-18 16:48_

---

_Comment by @shige-ta on 2025-09-20 12:28_

I can send a Phase-1 PR that makes UV_CACHE_DIR usable even when read-only:
– Detect RO cache and route all mutable state (indexes, temp metadata, GC markers) to a separate state dir.
– Open cache files as read-only; skip/init-free .git in sdists-*.
– Emit a one-line note instead of failing with EACCES.
This keeps caches immutable and unblocks Docker/HPC images with prewarmed RO caches. Follow-ups could add multiple cache layers (ro:ro:rw) and docs. Does that sound acceptable?

---

_Comment by @zanieb on 2025-09-20 17:46_

That sounds great, but I think fallback to a separate temporary directory for writes should be a secondary goal, if we can avoid doing it in the first pass.

---

_Label `bug` added by @zanieb on 2025-09-20 17:47_

---

_Comment by @konstin on 2025-09-23 11:46_

There are two separate items: The simpler one is allowing caches to be read-only when there are no modifications necessary, and are more complex feature where we use a separate state dir. For now, I'd focus on the first, simpler one, fixing the git permission denied error to start would be a great PR on its own.

---

_Comment by @nguu0123 on 2025-09-28 19:28_

the simpler one seems to be a good first issue, can I try implementing it @konstin ?

---

_Comment by @konstin on 2025-09-29 09:33_

Feel free to open a PR!

---

_Comment by @Oblynx on 2025-12-11 18:29_

This idea would unblock a workflow where some packages are shipped with a docker image read-only, while the user should still be able to install whatever else they want on top. Currently, the 2 ways forward are:
1. 2-layer environment: system python + venv. This is not well supported by `uv` and needs to use the `uv pip` interface instead of `uv sync` to interact with the venv. See also: https://github.com/astral-sh/uv/issues/5737
2. Completely separate venvs, with the packages downloaded 2 times and therefore double the disk footprint.

---
