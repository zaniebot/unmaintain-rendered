<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding best practices for Airgapped python packages with UV. - astral-sh/uv #13587</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Understanding best practices for Airgapped python packages with UV.</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13587">#13587</a>
        opened by <a href="https://github.com/ctagard">@ctagard</a>
        on 2025-05-21 22:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ctagard">@ctagard</a> on 2025-05-21 22:40</div>
            <div class="timeline-body"><h3>Question</h3>
<h1>Problem:</h1>
<p>We have a python package that we have built with UV, and we are trying to move this package to an air gapped system. Here is our current flow:</p>
<ol>
<li>Compile deps to requirements.txt</li>
</ol>
<pre><code class="language-bash">uv pip compile pyproject.toml -o requirements.txt
</code></pre>
<ol start="2">
<li>Download wheels for every package in the requirements.txt</li>
</ol>
<pre><code class="language-bash">uv run pip3 download -r requirements.txt -d wheels
</code></pre>
<p>We also include uv itself - as a wheel in the wheels directory:</p>
<pre><code class="language-bash">uv run pip3 wheel uv -w wheels
</code></pre>
<ol start="3">
<li>Now starts the funkiness:
If there are <em>any</em> git dependencies in our pyproject.toml, we have found that uv will ignore them when using the <code>--offline</code> flag (on the air gapped machine) and will attempt to pull from git. So - we use sed to comment them out of the pyproject.toml.</li>
</ol>
<p>Then, we build the current package:</p>
<pre><code class="language-bash">uv build --sdist --verbose
</code></pre>
<p>In our hatch build, we include the wheels directory so that it is included in the tarball.</p>
<h1>On the air gapped system:</h1>
<ol>
<li>We untar the tarball.</li>
</ol>
<pre><code class="language-bash">tar -xvf our_package.tar.gz
</code></pre>
<ol start="2">
<li>We install uv via the wheel</li>
</ol>
<pre><code class="language-bash">pip install wheels/uv-*.whl --upgrade
</code></pre>
<ol start="3">
<li>and then we instantiate a virtual environment with our python version:</li>
</ol>
<pre><code class="language-bash">uv venv --python $SYSTEM_PYTHON_VERSION
</code></pre>
<ol start="4">
<li>Finally - we install the dependencies from the wheels:</li>
</ol>
<pre><code class="language-bash">uv pip install wheels/* --offline --no-deps --no-index --find-links ./wheels
</code></pre>
<h1>Here is where the problem arises</h1>
<p>Yuck. There are several parts of this that scream that this is a bad way to do it. When we want to use this package, the only way that we could get it working was to activate the virtual environment and run commands from there. Ideally - we would like to be able to use <code>uv run</code> to be able to run stuff in our project.  The behavior that we are currently seeing is that even when passing <code>--offline --no-deps --no-index --find-links path_to_wheels</code> with <code>uv run</code> - it <em>still</em> attempts to reach out to pypi. Because we are air gapped, pypi fails and the command then fails. We have also tried <code>no-sync</code> - to no avail.</p>
<p>I am 99% sure that there is a better way to do this that we aren't thinking of - and wanted to ask.</p>
<p>The ideal situation would be that for local development, we can reach out to pypi no problem to grab updates and such. But on the air gapped system, we want to bring all the deps with us. In a perfect world - we would have one pyproject.toml that would enable this.</p>
<p>Thank y'all so much, and let me know if there is any more information I can add to help.</p>
<p>Edit: Not necessarily looking for an improvement to UV to support this - rather advice on how the maintainers or other community members would tackle this problem ðŸ˜ƒ</p>
<h3>Platform</h3>
<p>Centos 9</p>
<h3>Version</h3>
<p>uv 0.7.6 (7f3e94a09 2025-05-19)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ctagard on 2025-05-21 22:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @konstin on 2025-05-22 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2025-05-22 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hungmbs">@hungmbs</a> on 2025-06-20 07:16</div>
            <div class="timeline-body"><p>Second this. We frequently have to work in air-gapped system. Would be great if there is a way to do this, or even better, have a couple of commands to bundle/unbundle a project to be deployed in an airgapped system.</p>
<p>The latter is the ideal world, but I would love to just settle with a way to bring a <code>uv</code> project into an airgapped system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Oblynx">@Oblynx</a> on 2025-06-24 10:16</div>
            <div class="timeline-body"><p>same here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spewil">@spewil</a> on 2025-08-20 22:22</div>
            <div class="timeline-body"><p>ditto</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vdm">@vdm</a> on 2025-08-21 13:36</div>
            <div class="timeline-body"><p>#6950</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:06 UTC
    </footer>
</body>
</html>
