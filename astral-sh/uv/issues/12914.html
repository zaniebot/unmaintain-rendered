<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv python list` stopped showing non-installed PyPy exactly after 0.6.10 - astral-sh/uv #12914</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv python list` stopped showing non-installed PyPy exactly after 0.6.10</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/12914">#12914</a>
        opened by <a href="https://github.com/alexprengere">@alexprengere</a>
        on 2025-04-16 07:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alexprengere">@alexprengere</a> on 2025-04-16 07:45</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi!
I believe this is a minor regression that happened when uv went from <code>0.6.9</code> to <code>0.6.10</code> (unless I missed something in the docs or release notes).
I tested this on both Windows et Fedora (WSL2).
On <code>0.6.10</code>, <code>uv python list</code> stops listing PyPy releases that are <em>available for download</em> (this does not happen for CPython releases).</p>
<pre><code>$ uv self update 0.6.9
$ uv python list |grep -i pypy
pypy-3.11.11-linux-x86_64-gnu                     ... bin/pypy3.11
pypy-3.10.16-linux-x86_64-gnu                     ... bin/pypy3 -&gt; .../bin/pypy
pypy-3.10.16-linux-x86_64-gnu                     &lt;download available&gt;
pypy-3.9.19-linux-x86_64-gnu                      &lt;download available&gt;
pypy-3.8.16-linux-x86_64-gnu                      &lt;download available&gt;
pypy-3.7.13-linux-x86_64-gnu                      ... bin/pypy3.7 -&gt; pypy3

$ uv self update 0.6.10
$ uv python list |grep -i pypy
pypy-3.11.11-linux-x86_64-gnu                     ... bin/pypy3.11
pypy-3.10.16-linux-x86_64-gnu                     ... bin/pypy3 -&gt; .../bin/pypy
pypy-3.7.13-linux-x86_64-gnu                      ... bin/pypy3.7 -&gt; pypy3
</code></pre>
<p>This behavior is also present on the very latest version <code>0.6.14</code>.
Interestingly, forcing the interpreter show them again:</p>
<pre><code>$ uv python list pypy |grep -i pypy
pypy-3.11.11-linux-x86_64-gnu                     ... bin/pypy3.11
pypy-3.10.16-linux-x86_64-gnu                     ... bin/pypy3 -&gt; .../bin/pypy
pypy-3.10.16-linux-x86_64-gnu                     &lt;download available&gt;
pypy-3.9.19-linux-x86_64-gnu                      &lt;download available&gt;
pypy-3.8.16-linux-x86_64-gnu                      &lt;download available&gt;
pypy-3.7.13-linux-x86_64-gnu                      ... bin/pypy3.7 -&gt; pypy3
</code></pre>
<p>After digging a bit in the code, it looks like this is caused by ec499807f (reverting and building from sources works as expected).</p>
<h3>Platform</h3>
<p>Windows x86_64, Fedora (WSL)</p>
<h3>Version</h3>
<p>0.6.10</p>
<h3>Python version</h3>
<p>Python 3.9.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @alexprengere on 2025-04-16 07:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @konstin on 2025-04-16 08:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexprengere">@alexprengere</a> on 2025-04-16 08:54</div>
            <div class="timeline-body"><p>My quick analysis of the code is that when not providing any <code>request</code> <a href="https://github.com/astral-sh/uv/blob/main/crates/uv/src/commands/python/list.rs#L54">here</a> (the <code>uv python list</code> parameter), we hit <code>base_download_request.fill()?</code> <a href="https://github.com/astral-sh/uv/blob/main/crates/uv/src/commands/python/list.rs#L91">here</a> that sets <code>download_request</code> to basically <code>PythonDownloadRequest { implementation: Some(CPython) }</code> (from <a href="https://github.com/astral-sh/uv/blob/main/crates/uv-python/src/downloads.rs#L211">fill</a>, as <code>self.implementation</code> is none). So in that case only CPython downloads are shown, but I would expect all of implementations to be shown.</p>
<p>When passing <code>uv python list pypy</code>, then <code>download_request</code> is basically <code>PythonDownloadRequest { implementation: Some(PyPy) }</code>, and the PyPy downloads are shown.</p>
<p>Removing the 3 lines <a href="https://github.com/astral-sh/uv/blob/main/crates/uv-python/src/downloads.rs#L210-L212">there</a> to avoid setting implementation to CPython when calling <code>fill</code> solves this issue (not sure it this is clean). If I am on the right track I could perhaps open a PR, but if someone else is faster feel free to go ahead.</p>
<p>EDIT: I opened a PR, but it has no tests, I wanted mostly to check the CI</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12915.html">astral-sh/uv#12915</a> on 2025-04-16 09:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/j178">@j178</a> on 2025-04-17 05:15</div>
            <div class="timeline-body"><p>I added tests can showcase this in #12931</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexprengere">@alexprengere</a> on 2025-04-17 08:12</div>
            <div class="timeline-body"><p>Good catch! I believe your PR should be merged first, then I can rebase and leverage your tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-17 16:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-17 16:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:27 UTC
    </footer>
</body>
</html>
