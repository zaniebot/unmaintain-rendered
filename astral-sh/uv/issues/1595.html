<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` does not include extras in output - astral-sh/uv #1595</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv pip compile` does not include extras in output</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1595">#1595</a>
        opened by <a href="https://github.com/palfrey">@palfrey</a>
        on 2024-02-17 15:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/palfrey">@palfrey</a> on 2024-02-17 15:14</div>
            <div class="timeline-body"><p>If for example you run <code>echo &quot;celery[redis]&quot; | uv pip compile -</code> then the <code>redis</code> extra is correctly picked up and the extra requirements added to the output. However, the output will contain something like <code>celery==5.3.6</code>, not <code>celery[redis]==5.3.6</code> and pip-compile does the latter.</p>
<p>uv: 0.1.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-17 15:25</div>
            <div class="timeline-body"><p>Are there benefits to including the extra? (Asking genuinely, I thought it was fine to omit since it shouldnâ€™t affect installation given that everything is flattened.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/palfrey">@palfrey</a> on 2024-02-17 15:39</div>
            <div class="timeline-body"><p>Debatable. So, in terms of &quot;does this change what gets installed or the actual behaviour of packages&quot;, I don't think so. AFAIK packages don't have access to what extras they were installed only, and the only thing they see is &quot;is package X in my extras installed&quot;.</p>
<p>In terms of &quot;dev readability/trust&quot;, a little bit. If I told a package requirements system like <code>pip-compile</code> to compile a requirements file into a set of concrete requirements, and the extra bit goes away, I'm going to get a bit concerned.</p>
<p>There's an interesting pip-tools issue (https://github.com/jazzband/pip-tools/issues/1613) talking about whether to remove this or not, and that flags a fun case with GDAL doing things depending on the order of installation (https://github.com/jazzband/pip-tools/pull/1608#issuecomment-1087044018)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @zanieb on 2024-02-17 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SnoopJ">@SnoopJ</a> on 2024-02-18 05:21</div>
            <div class="timeline-body"><p>I personally use <code>pip-compile</code> as a way to record a canonical environment with a <em>complete record of my intent</em>. I guess you can argue that the original metadata is where the intent should live, but I find it helpful that <code>pip-compile</code> preserves the requirement, especially when comparing generated files without referring back to the originating metadata that contains the full story.</p>
<p>In lieu of filing a separate issue, I'll point out on this one that <code>uv pip compile</code> also drops environment makers like <code>sys_platform</code> and <code>python_version</code>, which is aggravating to my own workflow for the same reason: the generated file doesn't record my original intent, only the <em>outcome</em> of resolving my intent in the particular environment that ran the command. I'm not sure if that counts as a bug, actually, since installing files generated by <code>pip-compile</code> <em>can</em> vary across environments because of those markers, even if the expected workflow is that you generate your requirements file per-environment. Happy to file a separate issue if it's just noise on this one.</p>
<hr />
<p>I'd say that if <code>uv</code> decides not to support this behavior of <code>pip-compile</code> (which will continue to exist, because <code>--no-strip-extras</code> allows you to explicitly opt out of the coming change in default behavior), the difference should be documented for unsuspecting users to whom it will matter (ðŸ‘‹).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1665.html">astral-sh/uv#1665</a> on 2024-02-18 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv pip compile removes extras from the output" to "`uv pip compile` does not include extras in output" by @zanieb on 2024-02-18 21:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-02-18 22:08</div>
            <div class="timeline-body"><p>My 2c: This should certainly not be the default, pip-compile is doing the right thing by changing its default to <code>--strip-extras</code>. This ensures compatibility with constraints files, avoids pip bugs like https://github.com/pypa/pip/issues/9644, etc</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/palfrey">@palfrey</a> on 2024-02-25 20:31</div>
            <div class="timeline-body"><blockquote>
<p>My 2c: This should certainly not be the default, pip-compile is doing the right thing by changing its default to <code>--strip-extras</code>. This ensures compatibility with constraints files, avoids pip bugs like <a href="https://github.com/pypa/pip/issues/9644">pypa/pip#9644</a>, etc</p>
</blockquote>
<p>I'm not too fussed (especially given the possible change in <code>pip-tools</code>) about this being the default or not, provided there's an option to not strip them, which is my personal preference as I'd rather that and live with the possible issues from it. Also, it makes it much easier to use this as a drop-in &quot;no changes in output&quot; option from an existing pip-tools setup, and then <em>maybe</em> change the setting if I hit the issues later on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2163.html">astral-sh/uv#2163</a> on 2024-03-04 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2349.html">astral-sh/uv#2349</a> on 2024-03-11 02:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2498.html">astral-sh/uv#2498</a> on 2024-03-17 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/groodt">@groodt</a> on 2024-03-19 02:00</div>
            <div class="timeline-body"><p>One datapoint from me:
<a href="https://github.com/bazelbuild/rules_python"><code>rules_python</code></a> (a set of bazel build rules for python), presently supports <code>pip-tools compile</code> lockfiles and it relies on the extras format for constructing the transitive dependency graph. It's possible we will eventually migrate to other other formats (or a standard lockfile if that ever materializes), but in the interim, we would be unable to support <code>uv</code> users (or even directly integrate with <code>uv</code>) without a flag to enable these extra annotations. From a rules_python maintainer POV, we don't mind if they're stripped by default, but it would help a lot of existing users if they could use <code>--no-strip-extras</code> to continue using their locking workflows with bazel, while swapping to <code>uv</code> instead of <code>pip-tools</code> for lockfile generation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-19 02:34</div>
            <div class="timeline-body"><p>It's probably not too bad to add opt-in support for this. I will take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-03-19 02:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2555.html">astral-sh/uv#2555</a> on 2024-03-19 23:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-19 23:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kennethreitz">@kennethreitz</a> on 2024-07-22 14:29</div>
            <div class="timeline-body"><p>Thanks @charliermarsh I just used this functionality</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../grafana/oncall/pulls/4799.html">grafana/oncall#4799</a> on 2024-08-09 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mozilla/pontoon/pulls/3312.html">mozilla/pontoon#3312</a> on 2024-09-22 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../alphagov/notifications-api/pulls/4271.html">alphagov/notifications-api#4271</a> on 2024-11-29 13:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mc-bench/mc-bench-backend/pulls/160.html">mc-bench/mc-bench-backend#160</a> on 2025-03-17 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12543.html">astral-sh/uv#12543</a> on 2025-03-29 11:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13085.html">astral-sh/uv#13085</a> on 2025-04-24 10:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
