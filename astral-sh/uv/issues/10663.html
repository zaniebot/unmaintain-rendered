<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support (editable) sources when exporting requirements.txt when building a Docker image - astral-sh/uv #10663</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support (editable) sources when exporting requirements.txt when building a Docker image</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/10663">#10663</a>
        opened by <a href="https://github.com/tibbe">@tibbe</a>
        on 2025-01-16 00:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tibbe">@tibbe</a></div>
            <div class="timeline-body"><p>We have a monorepo with multiple libraries, some which depend on each other, and multiple executables, which depend on (some of) the libraries. We're trying to build a Docker image for AWS Lambda for each of the executables.</p>
<p>Since not all executables have compatible dependencies we cannot use a workspace as per our testing and as per https://docs.astral.sh/uv/concepts/projects/workspaces/#when-not-to-use-workspaces.</p>
<p>What we do instead is to use (editable) dependencies like so:</p>
<pre><code class="language-toml"># executable-a/pyproject.toml
[project]
name = &quot;executable-a&quot;
dependencies = [
  &quot;lib-a&quot;
]

[tool.uv.sources]
lib-a = { path = &quot;../lib-a&quot;, editable = true }
</code></pre>
<pre><code class="language-toml"># lib-a/pyproject.toml
[project]
name = &quot;lib-a&quot;
dependencies = [
  &quot;lib-b&quot;
]

[tool.uv.sources]
lib-b = { path = &quot;../lib-b&quot;, editable = true }
</code></pre>
<p>The folder structure looks something like:</p>
<pre><code>.
├── Dockerfile.a
├── Dockerfile.b
├── executable-a
├── executable-b
├── lib-a
└── lib-b
</code></pre>
<p>The reason we use editable dependencies is that we frequently need to change code in both libraries and executables at the same time and having to <code>uv sync</code> between each code change hurts the development flow.</p>
<p>What I <em>think</em> we want to do in our Docker image is something similar to https://github.com/astral-sh/uv/blob/73cade13862c88bf2d5344759e9b1b7035b63743/docs/guides/integration/aws-lambda.md, namely first installing 3rd party dependencies followed by the libraries and the executable.</p>
<p>Issues:</p>
<ul>
<li>We need an equivalent of <code>uv export --no-emit-workspace</code> for (editable) sources such that we can create a Docker layer of the 3rd party dependencies, including the 3rd party dependencies of the libraries. <code>--no-sources</code> doesn't seem to be quite it as we still do want the 3rd party dependencies of the sources.</li>
<li>We want the result to have no editable dependencies, which seems to happen even if you use <code>uv export --no-editable</code>, as long as <code>editable = true</code> is defined in <code>pyproject.toml</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tibbe">@tibbe</a> on 2025-01-16 01:01</div>
            <div class="timeline-body"><p>The reason I'm saying that <code>uv export --no-editable</code> doesn't work is that if you install the resulting <code>requirements.txt</code> using <code>uv pip install</code> you do end up with <code>*.pth</code> files with relative paths in them for the libraries.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tibbe">@tibbe</a> on 2025-01-16 01:03</div>
            <div class="timeline-body"><p>Here's the <code>export</code> command:</p>
<pre><code class="language-Dockerfile">WORKDIR /executable-a

RUN --mount=from=uv,source=/uv,target=/bin/uv \
    --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=executable-a/pyproject.toml,target=pyproject.toml \
    --mount=type=bind,source=executable-a/uv.lock,target=uv.lock \
    --mount=type=bind,source=lib-a,target=../lib-a \
    --mount=type=bind,source=lib-b,target=../lib-b \
    uv export --frozen --no-hashes --no-dev -o requirements.txt --no-editable &amp;&amp; \
    uv pip install -r requirements.txt &amp;&amp; \
    rm requirements.txt
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tibbe">@tibbe</a> on 2025-04-09 14:56</div>
            <div class="timeline-body"><p>I still have this problem. What is the best way to structure the installs of dependencies in a monorepo when a single workspace isn't possible (because we have multiple executables and we need editable installs)?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:21 UTC
    </footer>
</body>
</html>
