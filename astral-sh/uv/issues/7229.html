<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error out when using the same normalised source twice - astral-sh/uv #7229</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Error out when using the same normalised source twice</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7229">#7229</a>
        opened by <a href="https://github.com/mkniewallner">@mkniewallner</a>
        on 2024-09-09 19:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mkniewallner">@mkniewallner</a> on 2024-09-09 19:33</div>
            <div class="timeline-body"><p>When mapping dependencies to define sources, because of the TOML specification, uv will raise an error if defining the same source twice. For instance with this <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
dependencies = [&quot;python-multipart&quot;]

[tool.uv.sources]
python-multipart = { url = &quot;https://files.pythonhosted.org/packages/3d/47/444768600d9e0ebc82f8e347775d24aef8f6348cf00e9fa0e81910814e6d/python_multipart-0.0.9-py3-none-any.whl&quot; }
python-multipart = { url = &quot;https://files.pythonhosted.org/packages/c0/3e/9fbfd74e7f5b54f653f7ca99d44ceb56e718846920162165061c4c22b71a/python_multipart-0.0.8-py3-none-any.whl&quot; }
</code></pre>
<p>the following error will be raised:</p>
<pre><code class="language-console">$ uv lock
warning: Failed to parse `pyproject.toml` during settings discovery:
  TOML parse error at line 8, column 1
    |
  8 | python-multipart = { url = &quot;https://files.pythonhosted.org/packages/c0/3e/9fbfd74e7f5b54f653f7ca99d44ceb56e718846920162165061c4c22b71a/python_multipart-0.0.8-py3-none-any.whl&quot; }
    | ^
  duplicate key `python-multipart` in table `tool.uv.sources`

error: Failed to parse: `pyproject.toml`
  Caused by: TOML parse error at line 8, column 1
  |
8 | python-multipart = { url = &quot;https://files.pythonhosted.org/packages/c0/3e/9fbfd74e7f5b54f653f7ca99d44ceb56e718846920162165061c4c22b71a/python_multipart-0.0.8-py3-none-any.whl&quot; }
  | ^
duplicate key `python-multipart` in table `tool.uv.sources`
</code></pre>
<p>(btw not sure we should have both a warning and error here)</p>
<p>But while uv applies normalisation for sources (similarly to dependencies), it will not error out if defining the same source twice with different casing that would result in the same name after normalisation:</p>
<pre><code class="language-toml">[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
dependencies = [&quot;python-multipart&quot;]

[tool.uv.sources]
python-multipart = { url = &quot;https://files.pythonhosted.org/packages/3d/47/444768600d9e0ebc82f8e347775d24aef8f6348cf00e9fa0e81910814e6d/python_multipart-0.0.9-py3-none-any.whl&quot; }
python_multipart = { url = &quot;https://files.pythonhosted.org/packages/c0/3e/9fbfd74e7f5b54f653f7ca99d44ceb56e718846920162165061c4c22b71a/python_multipart-0.0.8-py3-none-any.whl&quot; }
</code></pre>
<p>Here, locking will work, and will end up choosing the latest source defined in the list (here in <code>python_multipart</code>, and if reversing the list, <code>python-multipart</code> is chosen instead).</p>
<p>Should uv also error out in this case, like it does when using the exact same casing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-09 19:39</div>
            <div class="timeline-body"><p>Yeah, I think we should probably error in both cases. Good find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-09 19:40</div>
            <div class="timeline-body"><blockquote>
<p>(btw not sure we should have both a warning and error here)</p>
</blockquote>
<p>Agree though it's somewhat annoying to fix because these happen very far apart from one another.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-09-09 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on 2024-09-09 19:45</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>(btw not sure we should have both a warning and error here)</p>
</blockquote>
<p>Agree though it's somewhat annoying to fix because these happen very far apart from one another.</p>
</blockquote>
<p>Yeah to be fair this is really just a tiny annoyance, mentioned it just because I stumbled across it ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-09 19:47</div>
            <div class="timeline-body"><p>It bothers me lol.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../renovatebot/renovate/pulls/31297.html">renovatebot/renovate#31297</a> on 2024-09-09 22:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-09-14 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7383.html">astral-sh/uv#7383</a> on 2024-09-14 03:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-14 03:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-14 03:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:22 UTC
    </footer>
</body>
</html>
