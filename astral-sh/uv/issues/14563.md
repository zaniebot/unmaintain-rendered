```yaml
number: 14563
title: uv cannot work on Windows with Astrill VPN installed
type: issue
state: closed
author: monchin
labels:
  - bug
  - windows
assignees: []
created_at: 2025-07-11T11:12:48Z
updated_at: 2025-12-10T09:58:17Z
url: https://github.com/astral-sh/uv/issues/14563
synced_at: 2026-01-10T01:57:33Z
```

# uv cannot work on Windows with Astrill VPN installed

---

_Issue opened by @monchin on 2025-07-11 11:12_

### Summary

My uv recently broke, and I don't know why.  Below are some logs
```bash
 uv tool install isort -vv
DEBUG uv 0.7.9 (13a86a23b 2025-05-30)
DEBUG Searching for default Python interpreter in managed installations, search path, or registry
DEBUG Searching for managed installations at `C:\Users\mench\AppData\Roaming\uv\python`
DEBUG Found managed installation `cpython-3.12.10-windows-x86_64-none`
TRACE Cached interpreter info for Python 3.12.10, skipping probing: C:\Users\mench\AppData\Roaming\uv\python\cpython-3.12.10-windows-x86_64-none\python.exe
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Users\mench\AppData\Roaming\uv\python\cpython-3.12.10-windows-x86_64-none\python.exe` (managed installations)
TRACE Checking lock for `C:\Users\mench\AppData\Roaming\uv\tools` at `C:\Users\mench\AppData\Roaming\uv\tools\.lock`
DEBUG Acquired lock for `C:\Users\mench\AppData\Roaming\uv\tools`
DEBUG Checking for Python environment at `C:\Users\mench\AppData\Roaming\uv\tools\isort`
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.10
DEBUG Solving with target Python version: >=3.12.10
TRACE Assigned packages:
TRACE Chose package for decision: root. remaining choices:
DEBUG Adding direct dependency: isort*
TRACE Assigned packages: root==0a0.dev0
TRACE Chose package for decision: isort. remaining choices:
TRACE Fetching metadata for isort from https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Checking lock for `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.lock` at `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.lock`
DEBUG Acquired lock for `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.lock`
TRACE No cache entry exists for C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.rkyv
DEBUG No cache entry for: https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Sending fresh GET request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Handling request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/ with authentication policy auto
TRACE Request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Attempting unauthenticated request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
```
```bash
uv add numpy -vv
DEBUG uv 0.7.9 (13a86a23b 2025-05-30)
DEBUG Found project root: `C:\Users\mench\Work\Private\tests\abb`
DEBUG No workspace root found, using project root
TRACE Checking lock for `C:\Users\mench\Work\Private\tests\abb` at `C:\Users\mench\AppData\Local\Temp\uv-37f0429431815cfc.lock`
DEBUG Acquired lock for `C:\Users\mench\Work\Private\tests\abb`
DEBUG Reading Python requests from version file at `C:\Users\mench\Work\Private\tests\abb\.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG Searching for Python 3.12 in managed installations, search path, or registry
DEBUG Searching for managed installations at `C:\Users\mench\AppData\Roaming\uv\python`
DEBUG Found managed installation `cpython-3.12.10-windows-x86_64-none`
TRACE Cached interpreter info for Python 3.12.10, skipping probing: C:\Users\mench\AppData\Roaming\uv\python\cpython-3.12.10-windows-x86_64-none\python.exe
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Users\mench\AppData\Roaming\uv\python\cpython-3.12.10-windows-x86_64-none\python.exe` (managed installations)
Using CPython 3.12.10
Creating virtual environment at: .venv
DEBUG Using base executable for virtual environment: C:\Users\mench\AppData\Roaming\uv\python\cpython-3.12.10-windows-x86_64-none\python.exe
DEBUG Released lock at `C:\Users\mench\AppData\Local\Temp\uv-37f0429431815cfc.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: abb @ file:///C:/Users/mench/Work/Private/tests/abb
DEBUG No workspace root found, using project root
TRACE Performing lookahead for abb @ file:///C:/Users/mench/Work/Private/tests/abb
DEBUG Solving with installed Python version: 3.12.10
DEBUG Solving with target Python version: >=3.12
TRACE Assigned packages:
TRACE Chose package for decision: root. remaining choices:
DEBUG Adding direct dependency: abb*
TRACE Assigned packages: root==0a0.dev0
TRACE Chose package for decision: abb. remaining choices:
DEBUG Searching for a compatible version of abb @ file:///C:/Users/mench/Work/Private/tests/abb (*)
DEBUG Adding direct dependency: numpy*
TRACE Assigned packages: root==0a0.dev0, abb==0.1.0
TRACE Chose package for decision: numpy. remaining choices:
TRACE Fetching metadata for numpy from https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/numpy/
TRACE Checking lock for `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\numpy.lock` at `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\numpy.lock`
DEBUG Acquired lock for `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\numpy.lock`
TRACE No cache entry exists for C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\numpy.rkyv
DEBUG No cache entry for: https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/numpy/
TRACE Sending fresh GET request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/numpy/
TRACE Handling request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/numpy/ with authentication policy auto
TRACE Request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/numpy/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/numpy/
TRACE Attempting unauthenticated request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/numpy/
```

My `~/.config/uv/uv.toml`:
```toml
[[index]]
url = "https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple"
default = true
```
It worked in the past, but I don't know why it doesn't work recently.

### Platform

win11

### Version

uv 0.7.9 (13a86a23b 2025-05-30)

### Python version

3.12.10

---

_Label `bug` added by @monchin on 2025-07-11 11:12_

---

_Comment by @zanieb on 2025-07-11 12:39_

Sorry but what's the error?

---

_Label `bug` removed by @zanieb on 2025-07-11 12:39_

---

_Label `question` added by @zanieb on 2025-07-11 12:39_

---

_Comment by @monchin on 2025-07-11 12:45_

> Sorry but what's the error?

Both `tool install` and `add` failed with no further information

---

_Comment by @zanieb on 2025-07-11 12:46_

That's confusing. What's the exit code? e.g., `$LASTEXITCODE`

---

_Comment by @monchin on 2025-07-11 13:54_

> That's confusing. What's the exit code? e.g., `$LASTEXITCODE`

-1073741819

I looked up in the calculator and it's C000 0005 in HEX

---

_Comment by @zanieb on 2025-07-11 15:03_

Interesting, this is the same as https://github.com/astral-sh/uv/issues/13812

It's unclear what's happening in this situation. We suspect something on Windows is killing uv.

---

_Renamed from "uv fails to work" to "uv exits with code `-1073741819` and no error message on Windows" by @zanieb on 2025-07-11 15:03_

---

_Label `question` removed by @zanieb on 2025-07-11 15:03_

---

_Label `bug` added by @zanieb on 2025-07-11 15:03_

---

_Label `windows` added by @zanieb on 2025-07-11 15:03_

---

_Comment by @zanieb on 2025-07-11 17:16_

Does it resolve if you set `UV_STACK_SIZE= 1048576`?

---

_Comment by @monchin on 2025-07-12 02:29_

> Does it resolve if you set `UV_STACK_SIZE= 1048576`?

I set it as an env var, and it doesn't work

---

_Referenced in [astral-sh/uv#14582](../../astral-sh/uv/pulls/14582.md) on 2025-07-13 02:49_

---

_Comment by @zanieb on 2025-07-13 13:22_

Thanks for checking. We're adding a way to display these errors at #14582 which should give us more details.

---

_Comment by @geofft on 2025-07-15 00:05_

Can you test with the latest version of `uv`? There's now an exception handler that hopefully will print some information.

---

_Comment by @monchin on 2025-07-15 01:42_

> Can you test with the latest version of `uv`? There's now an exception handler that hopefully will print some information.

Here's my result
```ps1
PS C:\Users\mench> $Env:RUST_BACKTRACE=1
PS C:\Users\mench> uv tool install isort -vv
DEBUG uv 0.7.21 (77c771c7f 2025-07-14)
DEBUG Searching for default Python interpreter in managed installations, search path, or registry
DEBUG Searching for managed installations at `AppData\Roaming\uv\python`
DEBUG Found managed installation `cpython-3.12.10-windows-x86_64-none`
TRACE Found cached interpreter info for Python 3.12.10, skipping query of: AppData\Roaming\uv\python\cpython-3.12.10-windows-x86_64-none\python.exe
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Users\mench\AppData\Roaming\uv\python\cpython-3.12.10-windows-x86_64-none\python.exe` (managed installations)
TRACE Checking lock for `AppData\Roaming\uv\tools` at `AppData\Roaming\uv\tools\.lock`
DEBUG Acquired lock for `AppData\Roaming\uv\tools`
DEBUG Checking for Python environment at `AppData\Roaming\uv\tools\isort`
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.10
DEBUG Solving with target Python version: >=3.12.10
TRACE Assigned packages:
TRACE Chose package for decision: root. remaining choices:
DEBUG Adding direct dependency: isort*
TRACE Assigned packages: root==0a0.dev0
TRACE Chose package for decision: isort. remaining choices:
TRACE Fetching metadata for isort from https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Checking lock for `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.lock` at `AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.lock`
DEBUG Acquired lock for `C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.lock`
TRACE No cache entry exists for C:\Users\mench\AppData\Local\uv\cache\simple-v16\index\e367fd55faf540ee\isort.rkyv
DEBUG No cache entry for: https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Sending fresh GET request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Handling request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/ with authentication policy auto
TRACE Request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
TRACE Attempting unauthenticated request for https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple/isort/
error: unhandled exception in uv, please report a bug:
code 0xC0000005 at address 0x18000c274
EXCEPTION_ACCESS_VIOLATION reading 0x1f4
rax=0000000000000000 rbx=0000000000000344 rcx=0000000000000344
rdx=0000000000000002 rsx=000003ed500400d8 rdi=00000000000001f4
rsp=000000c3a0cbe220 rbp=000000c3a0cbe350  r8=7ffffffffffffffc
 r9=0000000000000001 r10=0000000000000344 r11=0000024cff874ed8
r12=0000000000000000 r13=000003ed50310c80 r14=000003ed500400b0
r15=000003ed50120300 rip=000000018000c274 eflags=0000000000010246
stack backtrace:
   0:     0x7ff767efcdbd - <unknown>
   1:     0x7ff7680ce1e1 - <unknown>
   2:     0x7ff801bea133 - UnhandledExceptionFilter
   3:     0x7ff80428955f - strncpy
   4:     0x7ff8042467e3 - _C_specific_handler
   5:     0x7ff80428650f - _chkstk
   6:     0x7ff804194527 - RtlWow64GetCurrentCpuArea
   7:     0x7ff804285e4e - KiUserExceptionDispatcher
   8:        0x18000c274 - AuthenticateLicense
   9:        0x18001f4c2 - AuthenticateLicense
  10:        0x18000c506 - AuthenticateLicense
  11:     0x7ff767c0756f - <unknown>
  12:     0x7ff767f580b1 - <unknown>
  13:     0x7ff767d661fa - <unknown>
  14:     0x7ff767e161bb - <unknown>
  15:     0x7ff767e2a962 - <unknown>
  16:     0x7ff767e2db53 - <unknown>
  17:     0x7ff767d8e0f3 - <unknown>
  18:     0x7ff767d6b41e - <unknown>
  19:     0x7ff767dfab86 - <unknown>
  20:     0x7ff767e0ea1b - <unknown>
  21:     0x7ff767e30d5e - <unknown>
  22:     0x7ff769196bf9 - <unknown>
  23:     0x7ff76952097c - <unknown>
  24:     0x7ff767914742 - <unknown>
  25:     0x7ff767914a24 - <unknown>
  26:     0x7ff7679ea7ff - <unknown>
  27:     0x7ff76857000f - <unknown>
  28:     0x7ff76856ed04 - <unknown>
  29:     0x7ff76858d671 - <unknown>
  30:     0x7ff768689f4e - <unknown>
  31:     0x7ff768688f4b - <unknown>
  32:     0x7ff7686807cf - <unknown>
  33:     0x7ff7687c0383 - <unknown>
  34:     0x7ff76897399f - <unknown>
  35:     0x7ff768d19fc9 - <unknown>
  36:     0x7ff76894d633 - <unknown>
  37:     0x7ff7684022f0 - <unknown>
  38:     0x7ff7683ff8d1 - <unknown>
  39:     0x7ff7683d78ff - <unknown>
  40:     0x7ff76832206f - <unknown>
  41:     0x7ff768206952 - <unknown>
  42:     0x7ff76820620f - <unknown>
  43:     0x7ff769033505 - <unknown>
  44:     0x7ff769031ff1 - <unknown>
  45:     0x7ff767f1102d - <unknown>
  46:     0x7ff803c0e8d7 - BaseThreadInitThunk
  47:     0x7ff80415c34c - RtlUserThreadStart
```

---

_Comment by @monchin on 2025-07-15 02:17_

> Can you test with the latest version of `uv`? There's now an exception handler that hopefully will print some information.

I don't know what's wrong with my PC. I thought perhaps it would be helpful to compile uv from source code in debug mode, but I found that my cargo cannot work either, with just an info `syncing channel updates for 'stable-x86_64-pc-windows-msvc'`. I tried to uninstall by `rustup self uninstall`, and rerun the newest `rustup-init.exe`, it failed with no information, just like
```ps1
Current installation options:


   default host triple: x86_64-pc-windows-msvc
     default toolchain: stable (default)
               profile: default
  modify PATH variable: yes

1) Proceed with standard installation (default - just press enter)
2) Customize installation
3) Cancel installation
>

info: profile set to 'default'
info: default host triple is x86_64-pc-windows-msvc
info: syncing channel updates for 'stable-x86_64-pc-windows-msvc'
PS C:\Users\mench\Downloads> $LASTEXITCODE
-1073741819
```
My msvc is good as I tested a simple "hello world" cpp program and it ran as expected.

---

_Comment by @zanieb on 2025-07-15 12:52_

Eek.

It looks like the invalid access is in `AuthenticateLicense`? Do you have any security software installed?

You might need to use `windbg` to inspect that function to try to determine where it's coming from.

---

_Comment by @geofft on 2025-07-15 13:14_

We might be able to add filenames to the backtrace in addition to symbol names.

Wild guess, do you have Astrill VPN or some other "layered service provider" (LSP) DLL installed? Are you able to uninstall it (or do you need it to access the internet)?

---

_Comment by @monchin on 2025-07-15 13:33_

> Wild guess, do you have Astrill VPN or some other "layered service provider" (LSP) DLL installed? Are you able to uninstall it (or do you need it to access the internet)?

Yes Astrill VPN is installed on my computer. It's a little hard for me to uninstall it because it's a little troublesome that I need to submit a ticket and get my boss's approval to reinstall it.

I tried to turn off  and exit Astrill and ensure to turn off "Settings->Network and Internet->Proxy", but still the same 0xC0000005. 

Even astrill vpn is on, uv on wsl2 can work.

---

_Comment by @geofft on 2025-07-15 13:50_

OK, yeah, those both make sense sadly. Astrill installs a DLL that's going to be used whether or not the VPN is actually enabled, which hooks into the Windows networking functions. But WSL2 runs the Linux build which isn't using the Windows networking functions.

(Can you install/uninstall the LSP on your own? https://www.astrill.com/wiki/Astrill_Application:Other_menus_and_options#Hold_down_CTRL_and_click_on_Help_menu)

We'll need to figure out what to do about this, it'd be good for `uv` to work out of the box even with the Astrill LSP installed if possible. I found python-trio/trio#1659 and tokio-rs/mio#1314 which seem related, there's some talk about how to bypass LSPs in the mio issue.

---

_Comment by @monchin on 2025-07-15 16:18_


> (Can you install/uninstall the LSP on your own? https://www.astrill.com/wiki/Astrill_Application:Other_menus_and_options#Hold_down_CTRL_and_click_on_Help_menu)

I simply move `ASProxy64.dll` from `C:\Windows\System32` to somewhere else, and uv works. Thank you! 

---

_Renamed from "uv exits with code `-1073741819` and no error message on Windows" to "uv cannot work on Windows with Astrill VPN installed" by @monchin on 2025-07-17 01:33_

---

_Referenced in [astral-sh/uv#14872](../../astral-sh/uv/issues/14872.md) on 2025-07-24 15:23_

---

_Referenced in [astral-sh/uv#15302](../../astral-sh/uv/issues/15302.md) on 2025-08-15 12:18_

---

_Comment by @monchin on 2025-08-26 06:16_

Hi @zanieb  @geofft , I suddenly found that I can use uv on my win11 computer with Astrill VPN installed and normally used. I don't know what really happened, but it just works. My uv version is still 0.7.21, so I guess maybe Astrill has some updates to fix this issue. On July 25, I did update Astrill on my computer following my company's instruction. I didn't notice the version of Astrill when I raised this issue, but now its version is 3.10.

Anyway, as the issue is solved, I'll close it. For those who still got this issue, perhaps updating Astrill would help. Thank you for your help!

---

_Closed by @monchin on 2025-08-26 06:16_

---

_Comment by @SuperHuangXu on 2025-08-26 09:03_

Official customer response:
Please refer to the screenshot at the following link: https://prnt.sc/vAGewhaLHtZt for guidance. First, hold down the CTRL key on your keyboard and click on the menu we have highlighted in the screenshot.
Next, go to the Help menu and select Uninstall LSP. You can view an example screenshot here: https://prnt.sc/ZC9OEM7HjUx6[.](https://prnt.sc/ZC9OEM7HjUx6
Once the LSP is uninstalled, please restart your PC and check again.

---

_Comment by @zanieb on 2025-08-26 11:03_

Thanks for following up @monchin !

---

_Comment by @snippsat on 2025-11-13 12:25_

Only this worked for me.
Change to StealthVPN mode. Toggle Smart Mode on from the main menu.
Hold down `Ctrl` and click the main menu again and then `Help` then click `Hard exclude apps`. 
Now paste in path to `uv.exe`. eg `C:\Users\<username>\.local\bin\uv.exe`

Logout, close Astrill, then open it again and login.
Application Filter → select `Exclude these apps`
Now paste again path to `uv.exe` eg `C:\Users\<username>\.local\bin\uv.exe`

Teste `uv` again from command line 

---

_Comment by @devenliu on 2025-12-10 09:58_

> Only this worked for me. Change to StealthVPN mode. Toggle Smart Mode on from the main menu. Hold down `Ctrl` and click the main menu again and then `Help` then click `Hard exclude apps`. Now paste in path to `uv.exe`. eg `C:\Users\<username>\.local\bin\uv.exe`
> 
> Logout, close Astrill, then open it again and login. Application Filter → select `Exclude these apps` Now paste again path to `uv.exe` eg `C:\Users\<username>\.local\bin\uv.exe`
> 
> Teste `uv` again from command line


Hi @snippsat ,

Thank you so much for the helpful comment! I tried your solution, and it worked for me as well. Here's what I did:

1. Hold the Ctrl key and click on the Astrill VPN menu in the top-left corner.

2. Go to Help > Hard Exclude Apps.

3. Enter the paths for the uv.exe, uvw.exe, and uvx.exe files, for example:

  - C:\Users\<username>\.local\bin\uv.exe

  - C:\Users\<username>\.local\bin\uvw.exe

  - C:\Users\<username>\.local\bin\uvx.exe

4. Then, logout and close the Astrill VPN application.

5. Restart the Astrill VPN and log in again.

Thanks again for sharing this tip!

---
