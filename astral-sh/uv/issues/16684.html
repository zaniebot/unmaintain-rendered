<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bootstrapping problem with keyring in pyproject.toml to access internal index - astral-sh/uv #16684</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>bootstrapping problem with keyring in pyproject.toml to access internal index</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16684">#16684</a>
        opened by <a href="https://github.com/woutervh">@woutervh</a>
        on 2025-11-11 11:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woutervh">@woutervh</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code>&gt; uv --version
 v0.9.8
</code></pre>
<p>From the docs
https://docs.astral.sh/uv/guides/integration/alternative-indexes/#authenticate-with-keyring-and-keyringsgoogle-artifactregistry-auth</p>
<blockquote>
<p>uv only supports using the keyring package in <a href="https://docs.astral.sh/uv/reference/settings/#keyring-provider">subprocess mode</a>. The keyring executable must be in the PATH, i.e., installed globally or <strong>in the active environment</strong>. The keyring CLI requires a username in the URL and it must be oauth2accesstoken.</p>
</blockquote>
<p>I guess this use case is not yet supported:</p>
<ul>
<li>I want to define an internal dependency + internal index in pyproject.toml</li>
<li>I install keyring as a dev-dependency in pyproject.toml</li>
</ul>
<p>then start new venv  from scratch with this pyproject.toml:</p>
<pre><code>&gt; uv sync --only-group dev
&gt; uv sync
</code></pre>
<p>But uv does not find the executable need in .venv/bin?</p>
<p>You really need to source activate?   (which I want to avoid in my workflow)</p>
<h3>Example</h3>
<p>in pyproject.toml</p>
<pre><code>...
dependencies = [
    &quot;&lt;internal-package&gt;&quot;
]

[dependency-groups]
dev= [
     ....
    &quot;keyring&gt;=25.6.0&quot;,
    &quot;keyrings-google-artifactregistry-auth&gt;=1.1.2&quot;,
]

# Settings reference: https://docs.astral.sh/uv/reference/settings/#index
[[tool.uv.index]]
explicit = true
name = &quot;&lt;organisation&gt;&quot;
url = &quot;https://oauth2accesstoken@&lt;private-index-url&gt;/simple&quot;

</code></pre>
<p>uv sync installs keyring in the venv and then uses that to fetch internal packages</p>
<pre><code>uv sync
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @woutervh on 2025-11-11 11:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-12 16:42</div>
            <div class="timeline-body"><p>We need to hit the index to lock your dependencies, which needs to happen before syncing, so in general we cannot discover the keyring inside the virtual environment because we can't construct the environment until after using it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woutervh">@woutervh</a> on 2025-11-13 09:55</div>
            <div class="timeline-body"><blockquote>
<p>We need to hit the index to lock your dependencies, which needs to happen before syncing,</p>
</blockquote>
<p>This would apply to <em>all</em> dependencies even if you only execute this?</p>
<blockquote>
<p>uv sync --only-group dev</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-13 13:56</div>
            <div class="timeline-body"><p>Yes we resolve <em>all</em> dependencies together to create a coherent <code>uv.lock</code>, even if you're only going to install a subset.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:26 UTC
    </footer>
</body>
</html>
