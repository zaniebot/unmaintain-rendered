<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Why does `uv version --bump` sync? - astral-sh/uv #15286</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Why does `uv version --bump` sync?</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15286">#15286</a>
        opened by <a href="https://github.com/fabiopicchi">@fabiopicchi</a>
        on 2025-08-14 18:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/fabiopicchi">@fabiopicchi</a> on 2025-08-14 18:36</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I am trying to create a CD pipeline using <code>uv version --bump</code> however, it locks, which is not desirable in that scenario.</p>
<p>My dependencies are split in groups, and there is a dev dependency which is downloaded directly from a private git repository (not a Pypi repo). However, <code>uv version</code> doesn't care about groups and tries to regenerate the lock file. Since that private dependency is specified there, it will try to fetch it and fail the workflow.</p>
<p>I was wondering what is the rationale behind <code>version</code> doing a full lock. It makes sense for it to bump the package's version in the lockfile (same as it does to in pyproject.toml), but I would say the lock is not necessary. If I use <code>--frozen</code> the lock file isn't updated at all, which is not desirable as any subsequent <code>uv run</code> will update the lock file with the new version, forcing the developer to commit it without having made any explicit changes.</p>
<h3>Platform</h3>
<p>Darwin 24.6.0 arm64</p>
<h3>Version</h3>
<p>uv 0.7.21 (Homebrew 2025-07-14)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @fabiopicchi on 2025-08-14 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-14 18:40</div>
            <div class="timeline-body"><p>cc @Gankra</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-08-14 19:31</div>
            <div class="timeline-body"><p>(Note that there is also <code>--no-sync</code>, which edits the lock but does not sync.)</p>
<p>It's admittedly a pretty narrow corner-case but the concern was that a workspace can have non-trivial cyclic dependencies, such that bumping a version of your own package can actually change what version of third-party packages are installed (think: you are developing some major ecosystem package and your dev-dependencies actually depend on you).</p>
<p>I <em>think</em> there was also more narrow concerns of a developer running <code>uv version bump</code> and then running their project in a way that doesn't invoke <code>sync</code> and being confused why say, <code>mycoolapp --version</code> is yielding the wrong version (as whatever tooling they use to implement <code>--version</code> reads their yet-unsynced-pyproject.toml).</p>
<p>We could <em>potentially</em> add some kind of fast-path that detects there are no such cycles, if it's a serious issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fabiopicchi">@fabiopicchi</a> on 2025-08-14 19:59</div>
            <div class="timeline-body"><p>I see. <code>--no-sync</code> unfortunately doesn't work for me as it still tries to solve dependencies, apparently. The difference between <code>--no-sync</code> and <code>--frozen</code> is a bit subtle to me, but I use <code>--frozen</code> since it doesn't try to solve dependencies again. Semantically, they are the same to me.</p>
<p>The workspace scenario is indeed much more sophisticated than what I have. Maybe this could be triggered only if a workspace is detected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-14 20:11</div>
            <div class="timeline-body"><p><code>--no-sync</code> skips the sync portion of locking and syncing :) <code>--frozen</code> skips the locking portion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fabiopicchi">@fabiopicchi</a> on 2025-08-14 20:15</div>
            <div class="timeline-body"><p>Btw, just to clarify my use case (I was reading the question and noticed my goal was left implicit!!!). I want the lock file to be updated, but I would like it to be updated in a more mechanical way, just be replacing my package's version as in a <code>str.replace</code> (major simplification here).</p>
<p>I just don't want the dependencies to be fetched again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tigerhawkvok">@tigerhawkvok</a> on 2025-08-15 18:30</div>
            <div class="timeline-body"><p>TBH I think the no-lock-no-sync version should be default. If I'm version bumping it's usually the last step before release, the absolutely last thing I want to do is have my dependencies mutate on me.</p>
<p>It's essentially a <strong>tag</strong>, not a directive. I would argue the default case should be &quot;update all version numbers&quot; (for both the lockfile and pyproject.toml) and a flag should be required to &quot;.... and then sync&quot;. I understand the reversal of the logic is undesirable for the existing command, but perhaps a slight variant like <code>--bump-tag</code> could do as @fabiopicchi and I suggest?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-15 18:52</div>
            <div class="timeline-body"><blockquote>
<p>[...] is have my dependencies mutate on me.</p>
</blockquote>
<p>This won't happen unless your lockfile is incompatible with the version... which would be important to know. We prefer existing versions in the lockfile. We're not invalidating that constraint.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fabiopicchi">@fabiopicchi</a> on 2025-08-15 19:13</div>
            <div class="timeline-body"><p>@zanieb I guess my main problem is that the lockfile contains dev and test dependencies which are irrelevant to my build/publish flow. I would be ok with the current behaviour if there as a way to pass <code>--no-groups</code> to <code>uv version</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2025-08-18 01:19</div>
            <div class="timeline-body"><p>Related, I hand-authored a tool that rewrites the <code>version=...</code> line in our pyproject.toml files because <code>uv version</code> started complaining about resolving things and I didn't care enough to figure out what it actually wanted. We copy the entire package to a sandbox directory for parallelism safety and tried to run <code>uv version</code> on the sandbox version and it yelled at us.</p>
<p>It would be very nice if there was a way to say &quot;look, I know what I'm doing and I don't care what you think the world looks like; I just want you to update the <code>version=</code> field of this <code>pyproject.toml</code> file&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fabiopicchi">@fabiopicchi</a> on 2025-08-18 02:18</div>
            <div class="timeline-body"><blockquote>
<p>Related, I hand-authored a tool that rewrites the <code>version=...</code> line in our pyproject.toml files because <code>uv version</code> started complaining about resolving things and I didn't care enough to figure out what it actually wanted. We copy the entire package to a sandbox directory for parallelism safety and tried to run <code>uv version</code> on the sandbox version and it yelled at us.</p>
<p>It would be very nice if there was a way to say &quot;look, I know what I'm doing and I don't care what you think the world looks like; I just want you to update the <code>version=</code> field of this <code>pyproject.toml</code> file&quot;.</p>
</blockquote>
<p>... and the uv.lock file! I was actually able to achieve the behavior you described with uv version --frozen. That, unfortunately, doesn't update the uv.lock file which is a small inconvenience someone will have to take care of in a future commit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ozancaglayan">@ozancaglayan</a> on 2026-01-06 17:07</div>
            <div class="timeline-body"><p>This is so annoying in CI/CD steps where we don't install the package or the deps but we simply want to bump the version.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
