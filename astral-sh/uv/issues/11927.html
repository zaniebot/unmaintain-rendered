<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symlinking Python interpreter fails due to different filesystem - astral-sh/uv #11927</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Symlinking Python interpreter fails due to different filesystem</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11927">#11927</a>
        opened by <a href="https://github.com/Snaptraks">@Snaptraks</a>
        on 2025-03-03 16:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Snaptraks">@Snaptraks</a></div>
            <div class="timeline-body">Summary
<p>When creating a new virtual environment in a directory that is inside a different filesystem than the Python interpreter, <code>uv sync</code> fails even with link mode set as copy.</p>
<p>The way our infrastructure is set, the directory <code>smb_share/</code> inside the <code>/home/redacted/</code> is actually a CIFS mount to a Windows based file system. Creating the virtual environment fails at the linking of the Python interpreter, since the executable is inside the &quot;main&quot; file system.</p>
<p>How would I go about installing the Python executable either inside the project&#x27;s <code>.venv</code>, or on the same file system?</p>
<p>The verbose debug log when syncing the environment, if it helps:</p>
<pre><code>&gt; uv sync -v --link-mode copy
DEBUG uv 0.6.3
DEBUG Found project root: `/home/redacted/smb_share/TeamMembers/redacted/uv_project`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/home/redacted/smb_share/TeamMembers/redacted/uv_project`
DEBUG Reading Python requests from version file at `/home/francoishardy/redacted/TeamMembers/redacted/uv_project/.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG Searching for Python 3.12 in managed installations or search path
DEBUG Searching for managed installations at `/home/redacted/.local/share/uv/python`
DEBUG Skipping incompatible managed installation `cpython-3.11.11-linux-x86_64-gnu`
DEBUG Skipping incompatible managed installation `cpython-3.9.21-linux-x86_64-gnu`
DEBUG Found `cpython-3.12.4-linux-x86_64-gnu` at `/home/redacted/miniforge3/bin/python3.12` (first executable in the search path)
Using CPython 3.12.4 interpreter at: /home/redacted/miniforge3/bin/python3.12
Creating virtual environment at: .venv
DEBUG Using base executable for virtual environment: /home/redacted/miniforge3/bin/python3.12
DEBUG Released lock at `/tmp/uv-01e8608fdf1bc070.lock`
error: Operation not supported (os error 95)
</code></pre>
Platform
<p>Ubuntu 22.04.5 LTS x86_64</p>
Version
<p>uv 0.6.3</p>
Python version
<p>Python 3.12.4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/Snaptraks">@Snaptraks</a> on 2025-03-03 16:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-03 17:53</div>
            <div class="timeline-body"><blockquote>
<p>Creating the virtual environment fails at the linking of the Python interpreter, since the executable is inside the &quot;main&quot; file system.</p>
</blockquote>
<p>How are you determining this? We shouldn&#x27;t be hard-linking the Python interpreter, we always use symlinks on Unix</p>
<p>https://github.com/astral-sh/uv/blob/53d1a7aa6e6ec4cadf0272218ea7d36ef9bc9f5a/crates/uv-virtualenv/src/virtualenv.rs#L160-L184</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Snaptraks">@Snaptraks</a> on 2025-03-03 18:58</div>
            <div class="timeline-body"><p>A symlink across such file systems (the host with the usual ext4 file system) and the CIFS one (under the <code>smb_share/</code> directory in my example) returns the same OS Error 95, operation not supported.</p>
<pre><code>Python 3.12.4 | (main, Jun 17 2024, 10:23:07) [GCC 12.3.0] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; from pathlib import Path
&gt;&gt;&gt; Path(&quot;/home/redacted/smb_share/TeamMembers/redacted/uv_project/test.txt&quot;).symlink_to(Path(&quot;/home/redacted/test.txt&quot;))
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/home/redacted/miniforge3/lib/python3.12/pathlib.py&quot;, line 1386, in symlink_to
    os.symlink(target, self, target_is_directory)
OSError: [Errno 95] Operation not supported: &#x27;/home/francoishardy/test.txt&#x27; -&gt; &#x27;/home/redacted/smb_share/TeamMembers/redacted/uv_project/test.txt&#x27;
</code></pre>
<p>I figured the issue was with the Python symlink, since I get the exact same error when running <code>uv venv --python 3.12 -v</code> to change the Python version inside the virtual environment.</p>
<pre><code>&gt; uv venv --python 3.12 -v
DEBUG uv 0.6.3
DEBUG Found project root: `/home/redacted/smb_share/TeamMembers/redacted/uv_project`
DEBUG No workspace root found, using project root
DEBUG Using Python request `3.12` from explicit request
DEBUG Searching for Python 3.12 in managed installations or search path
DEBUG Searching for managed installations at `/home/redacted/.local/share/uv/python`
DEBUG Found managed installation `cpython-3.12.9-linux-x86_64-gnu`
DEBUG Found `cpython-3.12.9-linux-x86_64-gnu` at `/home/redacted/.local/share/uv/python/cpython-3.12.9-linux-x86_64-gnu/bin/python3.12` (managed installations)
Using CPython 3.12.9
Creating virtual environment at: .venv
DEBUG Assessing Python executable as base candidate: /home/redacted/.local/share/uv/python/cpython-3.12.9-linux-x86_64-gnu/bin/python3.12
DEBUG Using base executable for virtual environment: /home/redacted/.local/share/uv/python/cpython-3.12.9-linux-x86_64-gnu/bin/python3.12
uv::venv::creation

  × Failed to create virtualenv
  ╰─▶ Operation not supported (os error 95)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 19:01</div>
            <div class="timeline-body"><p>Does <code>python -m venv</code> work in that environment? That also uses symlinks, as is standard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Snaptraks">@Snaptraks</a> on 2025-03-03 19:05</div>
            <div class="timeline-body"><blockquote>
<p>Does <code>python -m venv</code> work in that environment? That also uses symlinks, as is standard.</p>
</blockquote>
<p>Sadly no, would it make it not be supported then?</p>
<pre><code>&gt; python -m venv .venv
Error: [Errno 95] Operation not supported: &#x27;lib&#x27; -&gt; &#x27;/home/redacted/smb_share/TeamMembers/redacted/uv_project/.venv/lib64&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 19:06</div>
            <div class="timeline-body"><p>Does <code>python -m venv --copies .venv</code> work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Snaptraks">@Snaptraks</a> on 2025-03-03 19:10</div>
            <div class="timeline-body"><blockquote>
<p>Does <code>python -m venv --copies .venv</code> work?</p>
</blockquote>
<p>Same error once again</p>
<pre><code>&gt; python -m venv --copies .venv
Error: [Errno 95] Operation not supported: &#x27;lib&#x27; -&gt; &#x27;/home/redacted/smb_share/TeamMembers/redacted/uv_project/.venv/lib64&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-03 19:44</div>
            <div class="timeline-body"><p>It sounds like you need <a href="https://github.com/astral-sh/uv/issues/7865">astral-sh/uv#7865</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 20:17</div>
            <div class="timeline-body"><p>I don&#x27;t think that&#x27;s sufficient (it might be necessary though). I think the error they&#x27;re seeing here is that the distro symlinks <code>lib</code> to <code>lib64</code> (<code>purelib</code> and <code>platlib</code>, or something -- can&#x27;t remember the details).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Hardlinking Python interpreter fails due to different filesystem&quot; to &quot;Symlinking Python interpreter fails due to different filesystem&quot; by <a href="https://github.com/Snaptraks">@Snaptraks</a> on 2025-03-04 14:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Snaptraks">@Snaptraks</a> on 2025-03-04 14:31</div>
            <div class="timeline-body"><p>Specifying the Python isntallation directory did not seem to fix the problem (or this is a different problem). I set the installation directory as one inside the <code>smb_share</code> / CIFS file system.</p>
<pre><code>&gt; uv python install -i /home/redacted/smb_share/TeamMembers/redacted/pycache/ --no-cache -v 3.12
DEBUG uv 0.6.3
DEBUG Reading Python requests from version file at `/home/redacted/smb_share/TeamMembers/redacted/uv_project/.python-version`
DEBUG Acquired lock for `/home/redacted/smb_share/TeamMembers/redacted/pycache/`
DEBUG No installation found for request `Python 3.12`
DEBUG Found download `cpython-3.12.9-linux-x86_64-gnu` for request `Python 3.12`
DEBUG Using request timeout of 30s
Downloading cpython-3.12.9-linux-x86_64-gnu (20.3MiB)
DEBUG Downloading https://github.com/astral-sh/python-build-standalone/releases/download/20250212/cpython-3.12.9%2B20250212-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz to temporary location: /home/redacted/smb_share/TeamMembers/redacted/pycache/.temp/.tmpMcMLar
DEBUG Extracting cpython-3.12.9%2B20250212-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz
error: Failed to install cpython-3.12.9-linux-x86_64-gnu
  Caused by: Failed to extract archive: cpython-3.12.9%2B20250212-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz
  Caused by: failed to unpack `/home/redacted/smb_share/TeamMembers/redacted/pycache/.temp/.tmpMcMLar/python/bin/2to3`
  Caused by: Operation not supported (os error 95)
DEBUG Released lock at `/home/redacted/smb_share/TeamMembers/redacted/pycache/.lock`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-04 14:34</div>
            <div class="timeline-body"><p>There are symlinks in the Python installation itself, yeah, e.g.</p>
<pre><code>❯ ls -lah /Users/zb/.local/share/uv/python/cpython-3.13.2-macos-aarch64-none/bin
total 152
drwxr-xr-x  14 zb  staff   448B Feb 24 21:28 .
drwxr-xr-x   6 zb  staff   192B Feb 24 21:28 ..
lrwxr-xr-x   1 zb  staff     8B Feb 24 21:28 idle3 -&gt; idle3.13
-rwxr-xr-x   1 zb  staff   156B Feb 24 21:28 idle3.13
-rwxr-xr-x   1 zb  staff   286B Feb 24 21:28 pip
-rwxr-xr-x   1 zb  staff   286B Feb 24 21:28 pip3
-rwxr-xr-x   1 zb  staff   286B Feb 24 21:28 pip3.13
lrwxr-xr-x   1 zb  staff     9B Feb 24 21:28 pydoc3 -&gt; pydoc3.13
-rwxr-xr-x   1 zb  staff   141B Feb 24 21:28 pydoc3.13
lrwxr-xr-x   1 zb  staff    10B Feb 24 21:28 python -&gt; python3.13
lrwxr-xr-x   1 zb  staff    10B Feb 24 21:28 python3 -&gt; python3.13
lrwxr-xr-x   1 zb  staff    17B Feb 24 21:28 python3-config -&gt; python3.13-config
-rwxr-xr-x   1 zb  staff    49K Feb 24 21:28 python3.13
-rwxr-xr-x   1 zb  staff   2.1K Feb 24 21:28 python3.13-config
</code></pre>
<p>Unfortunately this seems painful to fix. I guess we&#x27;d need to add opt-in copy fallback to the tar crate?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Snaptraks">@Snaptraks</a> on 2025-03-04 14:38</div>
            <div class="timeline-body"><p>I understand my specific usecase is very uncommon, if this is out of scope of the project I would understand and advise to move the project outside of the CIFS file system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-18 19:20</div>
            <div class="timeline-body"><p>I think we&#x27;ll consider this out of scope for now. Thanks for understanding.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-18 19:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:35 UTC
    </footer>
</body>
</html>
