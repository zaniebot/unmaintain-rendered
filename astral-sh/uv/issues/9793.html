<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerPC binary build failure &quot;relocation truncated to fit: R_PPC64_REL24&quot; - astral-sh/uv #9793</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PowerPC binary build failure &quot;relocation truncated to fit: R_PPC64_REL24&quot;</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9793">#9793</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-12-11 00:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 00:13</div>
            <div class="timeline-body"><p>The build failed during linking with</p>
<pre><code>libthread_local-14bdf71b2f8c428a.rlib(thread_local-14bdf71b2f8c428a.thread_local.9165f86b66b4614-cgu.0.rcgu.o): in function `thread_local::thread_id::get_slow':
          thread_local.9165f86b66b4614-cgu.0:(.text.unlikely._ZN12thread_local9thread_id8get_slow17h6b636cdf3f4cc69eE+0x250): relocation truncated to fit: R_PPC64_REL24 against symbol `__tls_get_addr' defined in .text.__tls_get_addr section in /usr/local/musl/bin/../lib/gcc/powerpc64le-unknown-linux-musl/11.2.0/../../../../powerpc64le-unknown-linux-musl/lib/libc.a(__tls_get_addr.lo)
          /home/runner/work/uv/uv/target/powerpc64le-unknown-linux-musl/release-no-lto/deps/libuv_installer-2b553695d2f31d2e.rlib(uv_installer-2b553695d2f31d2e.uv_installer.2988552f99df20af-cgu.04.rcgu.o): in function `std::sys::thread_local::native::lazy::Storage&lt;T,D&gt;::initialize':
          uv_installer.2988552f99df20af-cgu.04:(.text.unlikely._ZN3std3sys12thread_local6native4lazy20Storage$LT$T$C$D$GT$10initialize17hc81f5ebe44f2f56dE+0x34): relocation truncated to fit: R_PPC64_REL24 against symbol `__tls_get_addr' defined in .text.__tls_get_addr section in /usr/local/musl/bin/../lib/gcc/powerpc64le-unknown-linux-musl/11.2.0/../../../../powerpc64le-unknown-linux-musl/lib/libc.a(__tls_get_addr.lo)
          /home/runner/work/uv/uv/target/powerpc64le-unknown-linux-musl/release-no-lto/deps/libuv_installer-2b553695d2f31d2e.rlib(uv_installer-2b553695d2f31d2e.uv_installer.2988552f99df20af-cgu.10.rcgu.o): in function `rayon_core::registry::Registry::in_worker_cold':
          uv_installer.2988552f99df20af-cgu.10:(.text.unlikely._ZN10rayon_core8registry8Registry14in_worker_cold17h7266177902601b2eE+0x2c): relocation truncated to fit: R_PPC64_REL24 against symbol `__tls_get_addr' defined in .text.__tls_get_addr section in /usr/local/musl/bin/../lib/gcc/powerpc64le-unknown-linux-musl/11.2.0/../../../../powerpc64le-unknown-linux-musl/lib/libc.a(__tls_get_addr.lo)
          collect2: error: ld returned 1 exit status
</code></pre>
<p>ref https://github.com/astral-sh/uv/actions/runs/12265976138/job/34223179814?pr=9791</p>
<p>See https://stackoverflow.com/questions/10486116/what-does-this-gcc-error-relocation-truncated-to-fit-mean</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 00:13</div>
            <div class="timeline-body"><p>Attempting a fix by changing some compiler flags</p>
<ul>
<li>dffaf24b3</li>
<li>5cc430188</li>
<li>00cf29b7b</li>
<li>0c369b235</li>
<li>e579d038e</li>
<li>6f8f133c823508550db076579f888e9ac7c96b76 (I thought this one <em>had</em> to work)</li>
</ul>
<p>In most of these, I'm just trying to get the flag past Maturin in various ways. Not sure if it's working at all; e.g., the <code>rustc</code> call does not include the flags</p>
<blockquote>
<p>Caused by: Cargo build finished with &quot;exit status: 101&quot;: <code>env -u CARGO &quot;cargo&quot; &quot;rustc&quot; &quot;--profile&quot; &quot;release-no-lto&quot; &quot;--features&quot; &quot;self-update&quot; &quot;--target&quot; &quot;powerpc64le-unknown-linux-musl&quot; &quot;--message-format&quot; &quot;json-render-diagnostics&quot; &quot;--locked&quot; &quot;--manifest-path&quot; &quot;/home/runner/work/uv/uv/crates/uv/Cargo.toml&quot; &quot;--bin&quot; &quot;uv&quot; &quot;--&quot; &quot;-C&quot; &quot;strip=symbols&quot;</code></p>
</blockquote>
<p>edit: At least in some of these it looks like I was editing the <code>gnu</code> job instead of the <code>musl</code> cross job; see https://github.com/astral-sh/uv/issues/9793#issuecomment-2533439207 instead</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 01:29</div>
            <div class="timeline-body"><p>Also tried</p>
<ul>
<li>Reverting the microarchitecture change (https://github.com/astral-sh/uv/pull/9791/commits/ef59b4e98e7ba099935cc6b0ac1ea07c8abcad01)</li>
<li>Reverting the cc upgrade (https://github.com/astral-sh/uv/pull/9791/commits/61433bb6ed89b05e7625c608948b5ff2a1bda481)</li>
<li>Reverting the entire <code>cargo update</code> commit from #9712 (88f637d2e600300648df47e9aded68556d89246f)</li>
<li>Reverting the tracing update from #9566 (54f661863badbc16e0bbdf9d3f65f1d3aa799c85)</li>
<li>Reverting the <code>Cargo.lock</code> file to the previous release (20b52687f8e8bcf9bd4775a18831fc4ac538d9ae)</li>
<li>Reverting the resolver change from #9769 (c29afade8358c6bb7d4682e5faba84faaa709e86)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 01:51</div>
            <div class="timeline-body"><p>I got the compiler flags to go through, but they don't solve the issue</p>
<ul>
<li><code>-Crelocation-model=pic -Clink-args=-Wl,-z,notext</code> (https://github.com/astral-sh/uv/pull/9796/commits/0e0fd1d66ffea99fdb868d9ff413a0f29ed120ce)</li>
<li><code>-Crelocation-model=pic -Clink-args=-Wl,-z,notext -Ccode-model=large&quot;</code> (0e0fd1d66ffea99fdb868d9ff413a0f29ed120ce)</li>
<li><code>-Ctarget-feature=+crt-static</code>(3842d88427a7d7aebced59c0f826d83261aacced)</li>
<li><code>-Ccode-model=large</code> (441ca34ca80b78bc01d61a193ebda5fe309bc171)</li>
<li><code>-Clink-args=-Wl,-z,notls</code> (ca8f7b0635070d2be17527e0b3ab9c1da3fa994a)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9796.html">astral-sh/uv#9796</a> on 2024-12-11 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 02:45</div>
            <div class="timeline-body"><p>The trace suggests some sort of interaction between <code>uv-installer</code>, <code>rayon</code>, and <code>tracing-subscriber</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 02:54</div>
            <div class="timeline-body"><p>The cross-build Docker image (<code>ghcr.io/rust-cross/rust-musl-cross:powerpc64le-musl</code>) is identical</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 04:32</div>
            <div class="timeline-body"><p>I re-ran the 0.5.7 version bump CI job to see if <em>that</em> would still pass https://github.com/astral-sh/uv/actions/runs/12207650814 â€” it succeeded so sanity prevails and it is some sort of regression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 04:46</div>
            <div class="timeline-body"><p>I think the next step is to do a bisect, though I suspect we've just reached some threshold of complexity that the linker has problems with on powerpc.</p>
<p>I briefly looked at the download stats for this artifact and they're low but non-zero.</p>
<p>As a drastic step, I think we could turn of tracing for this target? But that seems pretty invasive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9810.html">astral-sh/uv#9810</a> on 2024-12-11 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-11 14:33</div>
            <div class="timeline-body"><p>We are going to drop support for now, see https://github.com/astral-sh/uv/pull/9810</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9815.html">astral-sh/uv#9815</a> on 2024-12-11 15:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Homebrew/homebrew-core/pulls/200827.html">Homebrew/homebrew-core#200827</a> on 2024-12-11 17:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:47 UTC
    </footer>
</body>
</html>
