<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv` installs package that is incompatible with environment python version - astral-sh/uv #15666</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv</code> installs package that is incompatible with environment python version</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15666">#15666</a>
        opened by <a href="https://github.com/vdyma">@vdyma</a>
        on 2025-09-03 16:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vdyma">@vdyma</a> on 2025-09-03 16:06</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have an environment with Python 3.11 (specified as <code>requires-python = &quot;~=3.11.0&quot;</code> in pyproject.toml).
One of the dependencies is: <code>&quot;ai-edge-litert&gt;=1.4.0&quot;</code>.
For some reason, <code>uv sync</code> also installs <code>backports-strenum</code> which requires python&lt;3.11.
I added to my dependencies list the following <code>&quot;backports-strenum; python_version &lt; '3.11'&quot;</code>, but this package still gets installed, even though env python version contradicts the specified marker</p>
<h3>Platform</h3>
<p>Windows 11 x86_65, WSL 2, Ubuntu 24.04</p>
<h3>Version</h3>
<p>0.8.11</p>
<h3>Python version</h3>
<p>3.11.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @vdyma on 2025-09-03 16:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-03 16:44</div>
            <div class="timeline-body"><p>Please see https://github.com/astral-sh/uv/issues/14711 (and the linked issues / discussions)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vdyma">@vdyma</a> on 2025-09-04 08:54</div>
            <div class="timeline-body"><p>Thanks for the quick response!
The linked issue describes why <code>requires-python</code> might ignore the upper bound of the python version. Can the same reasoning be applied to <code>python_version</code> markers too?
Also, if I set: <code>override-dependencies = [&quot;backports-strenum; python_version &lt; '3.11'&quot;]</code> - it works as expected and <code>backports-strenum</code> doesn't get installed in my environment. How come <code>override-dependencies</code> is stricter about specified markers?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-04 17:09</div>
            <div class="timeline-body"><p>We do respect <code>python_version</code> markers.</p>
<p>While you added <code>&quot;backports-strenum; python_version &lt; '3.11'&quot;</code> as a first-party marker, that isn't propagated to other package's dependencies, so <code>ai-edge-litert</code> still includes it as a dependency unconditional on the Python version</p>
<p>https://inspector.pypi.io/project/ai-edge-litert/1.4.0/packages/8b/4a/2efc281909c8e132aac6c8e2e27a02775405dda62c8dc21803990def0163/ai_edge_litert-1.4.0-cp310-cp310-macosx_12_0_arm64.whl/ai_edge_litert-1.4.0.dist-info/METADATA#line.26</p>
<p>Using <code>override-dependencies</code> <em>does</em> override the dependency declaration in <code>ai-edge-litert</code>, which is an appropriate fix. I'd encourage the upstream to add this marker to the dependency if the package should be usable on 3.11+ and the dependency is not required.</p>
<p>If we were to respect the upper bound on the <code>requires-python</code> in <code>backports-strenum</code>, resolution would just fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vdyma">@vdyma</a> on 2025-09-05 09:12</div>
            <div class="timeline-body"><p>Thanks for explaining. I will use <code>override-dependencies</code> as a solution then.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @vdyma on 2025-09-05 09:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:07 UTC
    </footer>
</body>
</html>
