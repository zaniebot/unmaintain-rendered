<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv add private GitHub repository with PAT on Actions fails - astral-sh/uv #11342</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv add private GitHub repository with PAT on Actions fails</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/11342">#11342</a>
        opened by <a href="https://github.com/PhilipVinc">@PhilipVinc</a>
        on 2025-02-08 15:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/PhilipVinc">@PhilipVinc</a> on 2025-02-08 15:16</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm Trying to setup a CI Workflow on GitHub Actions for a private repository that must pull another private repository. Using a Github PAT, I can make it work in pip but it fails with uv.</p>
<p>My CI.yml file is the following</p>
<pre><code class="language-yml">...
jobs:
   ...
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python ${{ matrix.python-version }} on ${{ matrix.os }}
        uses: astral-sh/setup-uv@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: Pip install packages
        run: |
          # using pip here would work, but uv fails
          uv --verbose add &quot;git+https://x-access-token:${TOKEN}@github.com/organization/private_repo&quot;
          uv sync
        env:
          TOKEN: ${{ secrets.GH_READONLY_PAT }}
</code></pre>
<p>where <code>secrets.GH_READONLY_PAT</code> is a PAT with read only access to private repos, which I tested and works correctly.</p>
<p>Running the action gives the following error</p>
<pre><code class="language-bash">DEBUG No netrc file found
DEBUG GitHub API request failed for: https://api.github.com/repos/NeuralQXLab/netket_pro/commits/HEAD (404 Not Found)
DEBUG Fetching source distribution from Git: https://github.com/NeuralQXLab/netket_pro
DEBUG Acquired lock for `[https://github.com/neuralqxlab/netket_pro`](https://github.com/neuralqxlab/netket_pro%60)
DEBUG Updating Git source `[https://github.com/NeuralQXLab/netket_pro`](https://github.com/NeuralQXLab/netket_pro%60)
   Updating https://github.com/NeuralQXLab/netket_pro (HEAD)
DEBUG Attempting GitHub fast path for: https://api.github.com/repos/NeuralQXLab/netket_pro/commits/HEAD
DEBUG Failed to check GitHub HTTP status client error (404 Not Found) for url (https://api.github.com/repos/NeuralQXLab/netket_pro/commits/HEAD)
DEBUG Performing a Git fetch for: https://github.com/NeuralQXLab/netket_pro
DEBUG Released lock at `/home/runner/actions-runner/_work/_temp/setup-uv-cache/git-v0/locks/d25fca3599406dfa`
DEBUG Reverting changes to `pyproject.toml`
DEBUG Removing `uv.lock`
  √ó Failed to download and build `netket-pro @
  ‚îÇ git+[https://github.com/NeuralQXLab/netket_pro`](https://github.com/NeuralQXLab/netket_pro%60)
  ‚îú‚îÄ‚ñ∂ Git operation failed
  ‚îú‚îÄ‚ñ∂ failed to clone into:
  ‚îÇ   /home/runner/actions-runner/_work/_temp/setup-uv-cache/git-v0/db/d25fca3599406dfa
  ‚ï∞‚îÄ‚ñ∂ process didn't exit successfully: `/usr/bin/git fetch --force
      --update-head-ok 'https://github.com/NeuralQXLab/netket_pro'
      '+HEAD:refs/remotes/origin/HEAD'` (exit status: 128)
      --- stderr
      fatal: could not read Username for 'https://github.com/': No such device
      or address
</code></pre>
<p>I tried the following things:</p>
<ul>
<li>Execute the command above on my machine, with the same token, it works.</li>
<li>Create a .netrc file in a preceding step with the token inside, but it is not used/does not solve the problem.</li>
</ul>
<p>Most interestingly, by ssh-ing in the runner if the step fails, and running exactly the same command, the command success, so I have the feeling that if the session is interactive something different is triggered</p>
<h3>Platform</h3>
<p>linux GitHub runner</p>
<h3>Version</h3>
<p>0.5.29</p>
<h3>Python version</h3>
<p>3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @PhilipVinc on 2025-02-08 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/artpelling">@artpelling</a> on 2025-03-07 10:53</div>
            <div class="timeline-body"><p>Facing the same issue. Seems related to #3783, #5107 and the fix in #11744 that was introduced in https://github.com/astral-sh/uv/releases/tag/0.6.4</p>
<p>I was facing #5107, after an upgrade to <code>0.6.5</code>, it fails with</p>
<pre><code class="language-bash">      --- stderr
      fatal: could not read Username for 'https://{REPOURL}':
      terminal prompts disabled
</code></pre>
<p>I don't mean to hijack this issue but</p>
<ul>
<li>How can I add private repos that require login?</li>
<li>How can I add a private repo with <code>ssh</code>? <code>uv add git+git@{URL}:{USERNAME}/{REPO}.git</code> gives me</li>
</ul>
<pre><code class="language-bash"> uv add git+git@{URL}:{USERNAME}/{REPO}.git
error: Failed to parse: `git+git@{URL}:{USERNAME}/{REPO}.git`
  Caused by: Expected path (`git+git@{URL}:{USERNAME}/{REPO}.git`) to end in a supported file extension: `.whl`, `.tar.gz`, `.zip`, `.tar.bz2`, `.tar.lz`, `.tar.lzma`, `.tar.xz`, `.tar.zst`, `.tar`, `.tbz`, `.tgz`, `.tlz`, or `.txz`
git+git@{URL}:{USERNAME}/{REPO}.git
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</code></pre>
<p>The docs are not so clear on this and I couldn't find any other issues on this.</p>
<p>~@PhilipVinc You could try downgrading to <code>0.6.3</code>, at least there, the prompt is not disabled (you might need to use <code>uv sync --verbose</code>).~ Sorry, I wasn't reading closely, you use an older version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yafanasiev">@yafanasiev</a> on 2025-03-19 19:24</div>
            <div class="timeline-body"><p>Seconding this one. Setting up CI when installing from other repositories in the same organization was surprisingly difficult. The Git client inside GitHub Actions definitely has required access to the source and package repository, but <code>uv</code> refuses to use that authentication for some reason. The only way I managed to make it work was</p>
<pre><code class="language-sh">git config --global url.https://${{ PAT_TOKEN_HERE }}@github.com/.insteadOf https://github.com/
</code></pre>
<p>which is not so bad of a solution, but it would be great to have a proper one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-19 22:05</div>
            <div class="timeline-body"><p>Weird, I don't understand what's going on here. We can look into this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Gankra by @Gankra on 2025-04-07 18:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @jtfmumm by @Gankra on 2025-04-10 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-11 10:39</div>
            <div class="timeline-body"><p>@PhilipVinc I've been unable to reproduce this with the latest uv. Would you mind trying again and checking if you are still encountering this problem? If you are, would you mind providing the <code>uv add -vv</code> logs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @Gankra by @Gankra on 2025-04-11 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yunik-yirifi">@yunik-yirifi</a> on 2025-04-21 09:59</div>
            <div class="timeline-body"><p>Facing similar issue with uv version <code>0.6.14</code> inside docker.</p>
<p><code>fatal: could not read Username for 'https://github.com': terminal  prompts disabled</code></p>
<p>my pyproject.toml</p>
<pre><code class="language-toml">xyz = { git = &quot;https://github.com/abc/xyz.git&quot;, rev = &quot;3207de62c52e02a55ecf536024069fd406b0bab0&quot; }
</code></pre>
<p>I am using <code>NETRC</code> file for storing the PAT github token.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2025-05-06 07:52</div>
            <div class="timeline-body"><p>I also ran into this issue with a private Gitlab server:</p>
<pre><code>‚ùØ uv sync --extra dev
   Updating https://gitlab.example.com/nnis/nnis-client-python (HEAD)                                                                                                                                                                                                                                                                                                                                                            √ó Failed to download and build `nnis-client @ git+https://gitlab.example.com/nnis/nnis-client-python`
  ‚îú‚îÄ‚ñ∂ Git operation failed
  ‚îú‚îÄ‚ñ∂ failed to clone into: /home/mbeckert/.cache/uv/git-v0/db/5485a180eb2a444a
  ‚ï∞‚îÄ‚ñ∂ process didn't exit successfully: `/usr/bin/git fetch --force --update-head-ok 'https://gitlab.example.com/nnis/nnis-client-python' '+HEAD:refs/remotes/origin/HEAD'` (exit status: 128)
      --- stderr
      Schwerwiegend: could not read Username for 'https://gitlab.example.com': terminal prompts disabled
</code></pre>
<p>I added this package to the <code>pyproject.toml</code> file:</p>
<pre><code>dependencies = [
  &quot;nnis-client@git+https://gitlab.example.com/nnis/nnis-client-python&quot;,
]
</code></pre>
<p>...that's the correct syntax, isn't it?</p>
<p>Current uv version:</p>
<pre><code>‚ùØ uv --version
uv 0.7.2
</code></pre>
<p>@zanieb Is there a workaround like <code>uv pip install ...</code> to get the cloning working via SSH?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2025-05-06 08:22</div>
            <div class="timeline-body"><p>Follow up:</p>
<p>This error message:</p>
<pre><code>process didn't exit successfully: `/usr/bin/git fetch --force --update-head-ok 'https://gitlab.example.com/nnis/nnis-client-python' '+HEAD:refs/remotes/origin/HEAD'` (exit status: 128)
</code></pre>
<p>I tried to find out what's going on here:</p>
<pre><code>‚ùØ uv venv
Using CPython 3.13.3 interpreter at: /usr/bin/python3
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate.fish

‚ùØ source .venv/bin/activate.fish

‚ùØ /usr/bin/git fetch --force --update-head-ok 'https://gitlab.example.com/nnis/nnis-client-python' '+HEAD:refs/remotes/origin/HEAD'
(english: no git repository available) Schwerwiegend: Kein Git-Repository (oder irgendein Elternverzeichnis bis zum Einh√§ngepunkt /)
Stoppe bei Dateisystemgrenze (GIT_DISCOVERY_ACROSS_FILESYSTEM nicht gesetzt).

‚ùØ git init

‚ùØ /usr/bin/git fetch --force --update-head-ok 'https://gitlab.example.com/nnis/nnis-client-python' '+HEAD:refs/remotes/origin/HEAD'
Username for 'https://gitlab.example.com': mbeckert
Password for 'https://mbeckert@gitlab.example.com': 
Warnung: Umleitung nach https://gitlab.example.com/nnis/nnis-client-python.git/
remote: Enumerating objects: 2107, done.
remote: Counting objects: 100% (525/525), done.
remote: Compressing objects: 100% (87/87), done.
remote: Total 2107 (delta 490), reused 444 (delta 438), pack-reused 1582
Empfange Objekte: 100% (2107/2107), 509.73 KiB | 3.21 MiB/s, fertig.
L√∂se Unterschiede auf: 100% (1220/1220), fertig.
Von https://gitlab.example.com/nnis/nnis-client-python
 * [neue Referenz]   HEAD       -&gt; origin/HEAD
 * [neues Tag]       0.1        -&gt; 0.1
 * [neues Tag]       0.1.2      -&gt; 0.1.2
 * [neues Tag]       0.2        -&gt; 0.2
 * [neues Tag]       1          -&gt; 1
 * [neues Tag]       2.0        -&gt; 2.0
 * [neues Tag]       2.1        -&gt; 2.1
</code></pre>
<p>When creating a git repository and entering the <code>git fetch</code> command manually I got a prompt for <code>username</code> and <code>password</code>.</p>
<p>Trying with a different directory that has been shown in the uv error message:</p>
<pre><code>‚ùØ (cd /home/mbeckert/.cache/uv/git-v0/db/5485a180eb2a444a; git status)
Auf Branch master

Noch keine Commits

nichts zu committen (erstellen/kopieren Sie Dateien und benutzen
Sie &quot;git add&quot; zum Versionieren)
</code></pre>
<p>-&gt; a git repository üëç</p>
<p>Another try with <code>--git-dir</code>:</p>
<pre><code>‚ùØ /usr/bin/git --git-dir=/home/mbeckert/.cache/uv/git-v0/db/5485a180eb2a444a fetch --force --update-head-ok 'https://gitlab.example.com/nnis/nnis-client-python' '+HEAD:refs/remotes/origin/HEAD'
(english: no git directory) Schwerwiegend: Kein Git-Repository: '/home/mbeckert/.cache/uv/git-v0/db/5485a180eb2a444a'
</code></pre>
<p>-&gt; no git repository?! ü§®</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fidhal-ht">@fidhal-ht</a> on 2025-05-13 09:11</div>
            <div class="timeline-body"><p>any fix for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/moschroe">@moschroe</a> on 2025-05-22 14:45</div>
            <div class="timeline-body"><p>Ran into this issue today using <code>0.7.6</code>. Might be related to the git subprocess not being spawned with the (entire) set of environment variables.</p>
<ul>
<li>created a custom netrc file at <code>/tmp/netrc</code> to have it be ephemeral and only in memory</li>
<li>ran <code>export NETRC=/tmp/netrc</code>, confirmed by a subsequent echo</li>
<li>Running <code>uv pip install -r requirements.txt --dry-run</code> will try to resolve deps from a private repo and will fail due to missing credentials.</li>
<li>after creating a symlink at the default location with <code>ln -vs /tmp/netrc ~/.netrc</code>, it suddenly works. Which points to <code>NETRC</code> not being set for the spawned subprocess</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/poklaassen">@poklaassen</a> on 2025-05-26 15:06</div>
            <div class="timeline-body"><p>We use the following in our Dockerfile, in combination with netrc and Docker action:</p>
<pre><code>RUN --mount=type=secret,id=GIT_AUTH_TOKEN \
    --mount=type=secret,id=GIT_ACTOR \
    GIT_AUTH_TOKEN=$(cat /run/secrets/GIT_AUTH_TOKEN) &amp;&amp; \
    GIT_ACTOR=$(cat /run/secrets/GIT_ACTOR) &amp;&amp; \
    echo &quot;machine github.com login ${GIT_ACTOR} password ${GIT_AUTH_TOKEN}&quot; &gt; ~/.netrc &amp;&amp; \
    chmod 600 ~/.netrc

RUN uv sync
RUN rm ~/.netrc
</code></pre>
<p>Action:</p>
<pre><code>- name: Build and push Docker image
  id: push
  uses: docker/build-push-action@v6
  with:
    context: .
    push: true
    tags: ${{ steps.meta.outputs.tags }}
    labels: ${{ steps.meta.outputs.labels }}
    secrets: |
      GIT_AUTH_TOKEN=${{ secrets.pat }}
      GIT_ACTOR=${{ secrets.username }}
</code></pre>
<p>For us, this works if the (classical) PAT has &quot;Full control of private repositories&quot; selected. In other cases, it complained about not having write access or the repository not existing. Fine grained tokens did not work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/0gust1">@0gust1</a> on 2025-05-26 16:51</div>
            <div class="timeline-body"><p>We also have the same problem here.
We have a similar setup as @poklaassen (docker build, <code>.netrc</code> file). Everything works fine locally (but relies on OS-based user's auth to github).
We'll try his solution and report here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/0gust1">@0gust1</a> on 2025-05-27 08:23</div>
            <div class="timeline-body"><p>In this thread, we have multiple use cases:</p>
<ol>
<li>&quot;classic&quot; install and build in a github action</li>
<li>&quot;docker build&quot; in a github action</li>
</ol>
<p>(in our context, we do both: &quot;classic&quot; to run tests and &quot;docker build&quot; to push the deployment artifacts on our private docker registry)</p>
<p><strong>classic install and build:</strong></p>
<p>using https://github.com/extractions/netrc</p>
<pre><code class="language-yaml">      - name: Set up .netrc
        uses: extractions/netrc@v2
        with:
          machine: github.com
          username: api
          password: ${{ secrets.GH_REPO_PAT }}

      - name: Install dependencies for testing
        run: |
          python -m pip install --upgrade pip uv
          uv sync --all-extras --dev

      - name: Run tests
        run: |
          uv run pytest
</code></pre>
<p><strong>This works.</strong> <code>GH_REPO_PAT</code> is a fine-grained personal access token, with <code>Read access to code and metadata</code> permission to the private repo of the dependency.</p>
<p>(to be continued)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/0gust1">@0gust1</a> on 2025-05-27 10:15</div>
            <div class="timeline-body"><p><strong>&quot;docker build&quot; in a github action</strong></p>
<p>context: the depended-on private repository is on github, and <code>GH_REPO_PAT</code> is a fine-grained personal access token, with <code>Read access to code and metadata</code> permission to the private repo of the dependency.</p>
<p>Github action:</p>
<pre><code class="language-yaml">      - name: Set up .netrc
        uses: extractions/netrc@v2
        with:
          machine: github.com
          username: api
          password: ${{ secrets.GH_REPO_PAT }}

      - name: copy netrc for docker build
         run: |
         cp ~/.netrc .netrc
         echo &quot;netrc file prepared for docker build&quot;

     # docker login, buildx, etc.

      - name: Build and push Docker image
         id: push
         uses: docker/build-push-action@v6
         with:
           context: .
           push: true
           tags: &lt;YOUR TAGS&gt;
           secret-files: netrc_pat=.netrc
</code></pre>
<p>Dockerfile:</p>
<pre><code class="language-Dockerfile">...
RUN --mount=type=secret,id=netrc_pat,target=/${USER}/.netrc,mode=0600,required=true \
    uv sync --frozen --no-dev
...
</code></pre>
<p><strong>This works too.</strong></p>
<p>PS:</p>
<p>@poklaassen :</p>
<ul>
<li>Ideally you should run your <code>uv sync</code> in the same command <code>RUN --mount=type=secret ...</code>, if not, your PAT in <code>.netrc</code> will end up in a Docker layer and will be pushed to the registry. As the netrc file is plaintext, it would be easily readable in the layer on the registry (security concern). <code>RUN --mount=type=secret</code> is a special Docker command that will prevent secret persistence in the resulting layer.</li>
<li>I have the hunch the problem you report (&quot;Fine grained tokens did not work.&quot;) may be due to the <code>login</code> value you use in your .netrc file. Try <code>api</code> ? (a PAT is already a combination of username+password)</li>
</ul>
<p>@zanieb @jtfmumm :</p>
<ul>
<li>I'm unsure the issue relates directly to <code>uv</code> itself, but maybe more a &quot;uv integration with CI/CD pipelines&quot; topic, with the &quot;private git repo installation&quot; subtopic.
These can be a bit hairy, and for now I don't know if what works for us could be directly transferrable to another sofware forge (like gitlab for example).</li>
<li>Maybe the original issue is a github action config problem or a problem with the runtime context of <code>astral-sh/setup-uv@v5</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @oconnor663 by @oconnor663 on 2025-06-02 20:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-06-04 03:54</div>
            <div class="timeline-body"><p>Looking through this and related issues, I'm aware of three generic ways to get a Personal Access Token (PAT) to <code>git</code> invocations that happen in the guts of tools like <code>uv</code>. The <strong>first way</strong> is <code>~/.netrc</code>. As folks have mentioned here, <a href="https://github.com/astral-sh/uv/issues/9576"><code>git</code> doesn't know about the <code>NETRC</code> env var</a>, and this approach interacts kind of poorly with Docker. Also no one's <em>thrilled</em> about writing secrets to disk.</p>
<p>The <strong>second way</strong> is using the <code>gh</code> command line utility, <a href="https://github.com/astral-sh/uv/issues/12368#issuecomment-2747900465">as mentioned here</a>. <code>gh</code> is installed by default in GitHub runners. It works by configuring itself as a &quot;credential helper&quot; in <code>~/.gitconfig</code>, and if it can't find a system keyring it also stores your token under <code>~/.config/gh</code> or similar. This way is the most convenient, and I recommend it if you're not sure what to do, but it only works with GitHub specifically. <a href="https://github.com/oconnor663/private_b/blob/6bd4c82b424e06f90a2b5f5b6cb04d11616f2c65/.github/workflows/ci.yml">Here's a working example.</a> The relevant lines of that <code>.github/workflows/ci.yml</code> are:</p>
<pre><code class="language-yaml">    - run: echo &quot;${{ secrets.FOO_GITHUB_TOKEN }}&quot; | gh auth login --with-token
    - run: gh auth setup-git
    - run: uv run main.py
</code></pre>
<p>The <strong>third way</strong> is to wrap the token in a trivial &quot;credential helper&quot; (<code>echo</code>) configured entirely via environment variables. This approach has the most annoying syntax, but it could be the most reliable approach if <em>multiple layers</em> of your stack that <em>don't necessarily know about each other</em> need to configure Git. It also keeps your token off the disk, and it might be easier to get it working with container barriers like Docker (i.e. using <code>--env</code>). <a href="https://github.com/oconnor663/private_b/blob/78c80a06c8a3f1c2cf029b5c774c2db125ecd31f/.github/workflows/ci.yml">Here's a working example.</a> Here are the relevant lines:</p>
<pre><code class="language-yaml">    - run: |
        export &quot;GIT_CONFIG_KEY_0=credential.https://github.com.helper&quot;
        export &quot;GIT_CONFIG_VALUE_0=!echo username=git ; echo password=${{ secrets.FOO_GITHUB_TOKEN }} ; #&quot;
        export &quot;GIT_CONFIG_COUNT=1&quot;
        uv run main.py
</code></pre>
<p>In a truly generic, &quot;who knows what other layers above and below me are doing&quot; scenario, you'd read <code>GIT_CONFIG_COUNT</code> from your own environment, name the other two variables accordingly (<code>export</code> lets you set variables with other variables in their names), and then increment the count. There's some very sensitive punctuation there; for a longer explanation see <a href="https://github.com/oconnor663/private_b/blob/78c80a06c8a3f1c2cf029b5c774c2db125ecd31f/.github/workflows/ci.yml#L17-L40">the giant comment in that file</a>.</p>
<hr />
<p>Also in case anyone finds this thread who's working PATs for the first time, for completeness, in all of these approaches you have to start by manually adding the PAT to your CI environment using GitHub's &quot;Secrets and Variables -&gt; Actions&quot; repo settings:</p>
<p><img src="https://github.com/user-attachments/assets/d8d4dad8-d573-4689-b0a2-0f45505d5a2e" alt="Image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9576.html">astral-sh/uv#9576</a> on 2025-06-04 03:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/13850.html">astral-sh/uv#13850</a> on 2025-06-04 21:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oconnor663">@oconnor663</a> on 2025-06-05 20:53</div>
            <div class="timeline-body"><p>Documented in https://github.com/astral-sh/uv/pull/13850. I didn't mention the <code>GIT_CONFIG_COUNT</code> stuff as that seems too arcane, but let me know if anyone ends up using that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @oconnor663 on 2025-06-05 20:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emrynHofmannElephant">@emrynHofmannElephant</a> on 2025-10-08 09:19</div>
            <div class="timeline-body"><p>@oconnor663</p>
<blockquote>
<p>The second way is using the gh command line utility, https://github.com/astral-sh/uv/issues/12368#issuecomment-2747900465. gh is installed by default in GitHub runners. It works by configuring itself as a &quot;credential helper&quot; in ~/.gitconfig, and if it can't find a system keyring it also stores your token under ~/.config/gh or similar. This way is the most convenient, and I recommend it if you're not sure what to do, but it only works with GitHub specifically. <a href="https://github.com/oconnor663/private_b/blob/6bd4c82b424e06f90a2b5f5b6cb04d11616f2c65/.github/workflows/ci.yml">Here's a working example.</a></p>
</blockquote>
<p>I've tried adding that to mine, but I still get the</p>
<pre><code>√ó Failed to download and build `pkg-name @
  ‚îÇ git+https://github.com/org/dep-repo@commit-ref#subdirectory=python`
  ‚îú‚îÄ‚ñ∂ Git operation failed
  ‚îú‚îÄ‚ñ∂ failed to clone into:
  ‚îÇ   /home/runner/work/_temp/setup-uv-cache/git-v0/db/...[42](https://github.com/org/base-repo/actions/runs/.../job/...#step:6:43)e6
  ‚îú‚îÄ‚ñ∂ failed to fetch commit `...[43](https://github.com/org/base-repo/actions/runs/.../job/...#step:6:44)...`
  ‚ï∞‚îÄ‚ñ∂ process didn't exit successfully: `/usr/bin/git fetch --force
      --update-head-ok 'https://github.com/org/dep-repo'
      '+...[46](https://github.com/org/base-repo/actions/runs/.../job/...#step:6:47)...'`
      (exit status: 128)
      --- stderr
      remote: Write access to repository not granted.
      fatal: unable to access 'https://github.com/org/dep-repo/':
      The requested URL returned error: 403
  help: `pkg-name` was included because `base-pkg` (v0.1.0) depends on
        `pkg-name`
</code></pre>
<p>I made a fine-grained PAT with read access - afaik it shouldn't require write access?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nshobert">@nshobert</a> on 2025-11-14 19:13</div>
            <div class="timeline-body"><p>I get basically the same output as @emrynHofmannElephant in https://github.com/astral-sh/uv/issues/11342#issuecomment-3380614617.</p>
<p>I have a PAT with read access that I store as an environment variable, which is a procedure that works with pip in my mamba environments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mia-trilo">@mia-trilo</a> on 2025-11-26 00:08</div>
            <div class="timeline-body"><p>@emrynHofmannElephant I encountered the same issue and found out that the error message was misleading. In my case, I was able to fix it by updating the token access permission. It turned out that on the fine-grained token setting, you need to set what access you want to give to the repository <em>in addition to</em> selecting the All Repository option. My error went away after I granted the token content and metadata access</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
