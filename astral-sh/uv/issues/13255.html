<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authenticate during HTTP redirects - astral-sh/uv #13255</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Authenticate during HTTP redirects</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13255">#13255</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-05-01 18:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>We previously rolled this out in</p>
<ul>
<li>https://github.com/astral-sh/uv/pull/12920</li>
</ul>
<p>to resolve</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/5595</li>
<li>https://github.com/astral-sh/uv/issues/11097</li>
</ul>
<p>but there were regressions with relative URI handling and GCP</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/13037</li>
</ul>
<p>so it was reverted in https://github.com/astral-sh/uv/pull/13041</p>
<p>then fixed and released again in</p>
<ul>
<li>https://github.com/astral-sh/uv/pull/13050</li>
</ul>
<p>but there were regressions with Azure</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/13208</li>
</ul>
<p>so it was reverted again in https://github.com/astral-sh/uv/pull/13215</p>
<p>This issue tracks resolving the outstanding issues before releasing this again. Notably</p>
<ul>
<li>The cause of the Azure problem needs to be identified, and fixed</li>
<li>We need to carefully test this change for release again</li>
<li>We should add automated testing to prevent regressions</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">tracking</span> added by @zanieb on 2025-05-01 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-05-01 18:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @jtfmumm by @jtfmumm on 2025-05-01 19:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jenshnielsen">@jenshnielsen</a> on 2025-05-02 07:21</div>
            <div class="timeline-body"><p>@zanieb @jtfmumm I am happy to test any new version of this against an azure feed. Please feel free to ping me if you can benefit from extra manual testing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joeybenamy">@joeybenamy</a> on 2025-05-02 19:46</div>
            <div class="timeline-body"><p>This issue ended up being the root cause for us when trying to download a package from a private registry.  Rolled <code>uv</code> back to <code>0.6.17</code> to work around the bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jenshnielsen">@jenshnielsen</a> on 2025-06-16 12:35</div>
            <div class="timeline-body"><p>@jtfmumm tested and seems to work correctly. See commit in #13595</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-16 12:54</div>
            <div class="timeline-body"><p>We have a new fix for authentication on redirects on #13754 that avoids the problems listed here. It would be very helpful if anyone would be willing to test that PR on their own private index (whether Azure or anything else). You could build that PR or you could also use:</p>
<pre><code>uvx -v --from &quot;uv @ git+https://github.com/astral-sh/uv@jtfm/update-redirect-handling&quot; uv add &lt;pkg-from-private-index&gt; --default-index https://&lt;username&gt;:&lt;password&gt;@&lt;private-index-url&gt;
</code></pre>
<p>filling in <code>&lt;pkg-from-private-index&gt;</code>, <code>&lt;username&gt;</code>, <code>&lt;password&gt;</code>, and <code>&lt;private-index-url&gt;</code> with your own values.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lagamura">@lagamura</a> on 2025-06-16 13:27</div>
            <div class="timeline-body"><p>Failed to fetch a package from our private JFROG artifactory with following trace:</p>
<pre><code class="language-shell">...
File &quot;$HOME/Private/.cache/uv/builds-v0/.tmpVhgdIb/lib/python3.13/site-packages/httpx/_client.py&quot;, line 825, in request
          return self.send(request, auth=auth, follow_redirects=follow_redirects)
                 ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;$HOME/Private/.cache/uv/builds-v0/.tmpVhgdIb/lib/python3.13/site-packages/httpx/_client.py&quot;, line 914, in send
          response = self._send_handling_auth(
              request,
          ...&lt;2 lines&gt;...
              history=[],
          )
        File &quot;$HOME/Private/.cache/uv/builds-v0/.tmpVhgdIb/lib/python3.13/site-packages/httpx/_client.py&quot;, line 942, in _send_handling_auth
          response = self._send_handling_redirects(
              request,
              follow_redirects=follow_redirects,
              history=history,
          )
        File &quot;$HOME/Private/.cache/uv/builds-v0/.tmpVhgdIb/lib/python3.13/site-packages/httpx/_client.py&quot;, line 979, in _send_handling_redirects
          response = self._send_single_request(request)
        File &quot;$HOME/Private/.cache/uv/builds-v0/.tmpVhgdIb/lib/python3.13/site-packages/httpx/_client.py&quot;, line 1014, in _send_single_request
          response = transport.handle_request(request)
        File &quot;$HOME/Private/.cache/uv/builds-v0/.tmpVhgdIb/lib/python3.13/site-packages/httpx/_transports/default.py&quot;, line 249, in handle_request
          with map_httpcore_exceptions():
               ~~~~~~~~~~~~~~~~~~~~~~~^^
        File &quot;$HOME/.local/share/uv/python/cpython-3.13.3-linux-x86_64-gnu/lib/python3.13/contextlib.py&quot;, line 162, in __exit__
          self.gen.throw(value)
          ~~~~~~~~~~~~~~^^^^^^^
        File &quot;$HOME/Private/.cache/uv/builds-v0/.tmpVhgdIb/lib/python3.13/site-packages/httpx/_transports/default.py&quot;, line 118, in map_httpcore_exceptions
          raise mapped_exc(message) from exc
      httpx.ConnectError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: Missing Authority Key Identifier (_ssl.c:1028)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-16 13:38</div>
            <div class="timeline-body"><p>Thank you for testing this @lagamura! Does the same command work with JFrog on uv 0.7.13? If it does, would you mind sharing the trace <code>-vv</code> logs from the failure case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lagamura">@lagamura</a> on 2025-06-16 15:25</div>
            <div class="timeline-body"><p>Changing <code>--default-index</code> to <code>--index</code> is working as expected both in <code>0.7.13</code> and <code>@jtfm</code>. In our case, that's due to our pattern pushing to the private index only the private packages with (<code>explicit = true</code>) and using pypi for the public ones to accelerate installation. That's why also previously the error occurred.</p>
<p>Trying also adding a public package <code>numpy</code> for a private <code>--default-index</code> that mirrors pypi works fine too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bra-fsn">@bra-fsn</a> on 2025-06-17 21:09</div>
            <div class="timeline-body"><blockquote>
<p>We have a new fix for authentication on redirects on <a href="https://github.com/astral-sh/uv/pull/13754">#13754</a> that avoids the problems listed here. It would be very helpful if anyone would be willing to test that PR on their own private index (whether Azure or anything else). You could build that PR or you could also use:</p>
<pre><code>uvx -v --from &quot;uv @ git+https://github.com/astral-sh/uv@jtfm/update-redirect-handling&quot; uv add &lt;pkg-from-private-index&gt; --default-index https://&lt;username&gt;:&lt;password&gt;@&lt;private-index-url&gt;
</code></pre>
<p>filling in <code>&lt;pkg-from-private-index&gt;</code>, <code>&lt;username&gt;</code>, <code>&lt;password&gt;</code>, and <code>&lt;private-index-url&gt;</code> with your own values.</p>
</blockquote>
<p>What I did:</p>
<pre><code>docker run --rm -ti python:3.12 bash
pip install 'git+https://github.com/astral-sh/uv@jtfm/update-redirect-handling'
uv pip install --system --extra-index-url https://codeartifact-proxy/$accid/us-west-2/$repo/python $pkgname
</code></pre>
<p>Still getting the same error as in:
https://github.com/astral-sh/uv/issues/11097</p>
<pre><code>Using Python 3.12.11 environment at: /usr/local
  × No solution found when resolving dependencies:
  ╰─▶ Because $pkgname was not found in the package registry and
      you require $pkgname, we can conclude that your requirements
      are unsatisfiable.
</code></pre>
<p><code>pip install</code> works just fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-18 08:28</div>
            <div class="timeline-body"><p>Thanks for testing @bra-fsn! I've commented on #11097 and have re-opened that issue, which I will work on separately.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:31:11 UTC
    </footer>
</body>
</html>
