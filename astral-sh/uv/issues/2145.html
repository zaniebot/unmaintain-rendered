<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv fails to build qcore==1.10.0 on Python 3.12, but pip is happy to - astral-sh/uv #2145</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv fails to build qcore==1.10.0 on Python 3.12, but pip is happy to</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2145">#2145</a>
        opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a>
        on 2024-03-04 06:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hauntsaninja">@hauntsaninja</a></div>
            <div class="timeline-body"><pre><code>(v312-ydmj) ~/tmp/v312 λ uv pip install 'qcore==1.10.0'
Resolved 1 package in 10ms
error: Failed to download distributions
  Caused by: Failed to fetch wheel: qcore==1.10.0
  Caused by: Failed to build: qcore==1.10.0
  Caused by: Build backend failed to build wheel through `build_wheel()`:
--- stdout:
running bdist_wheel
running build
running build_py
creating build
creating build/lib.macosx-14.3-arm64-cpython-312
creating build/lib.macosx-14.3-arm64-cpython-312/qcore
copying qcore/disallow_inheritance.py -&gt; build/lib.macosx-14.3-arm64-cpython-312/qcore
[ ... elided ... ]
copying qcore/inspection.pxd -&gt; build/lib.macosx-14.3-arm64-cpython-312/qcore
running build_ext
building 'qcore.helpers' extension
--- stderr:
error: unknown file type '.py' (from 'qcore/helpers.py')
---

(v312-ydmj) ~/tmp/v312 λ pip install 'qcore==1.10.0'
Collecting qcore==1.10.0
  Downloading qcore-1.10.0.tar.gz (53 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 53.4/53.4 kB 2.2 MB/s eta 0:00:00
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
  Installing backend dependencies ... done
  Preparing metadata (pyproject.toml) ... done
Building wheels for collected packages: qcore
  Building wheel for qcore (pyproject.toml) ... done
  Created wheel for qcore: filename=qcore-1.10.0-cp312-cp312-macosx_14_0_arm64.whl size=473177 sha256=91aa57658beb48575a877eed396f8451af7630e82a2c2912b9213272fd37e595
  Stored in directory: /Users/shantanu/Library/Caches/pip/wheels/bd/b3/b7/5f2d05e6f3e4411856f9464c742da56c2b5b34ba9fd17e6e2f
Successfully built qcore
Installing collected packages: qcore
Successfully installed qcore-1.10.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-04 06:28</div>
            <div class="timeline-body"><p>Hm, maybe this is because qcore relies on setup_requires? Not actually sure how setuptools implements that https://github.com/quora/qcore/blob/master/setup.py#L78</p>
<p>Either way, it would be nice if the error message <code>error: unknown file type '.py' (from 'qcore/helpers.py')</code> was more actionable. Any chance there's a Python traceback that uv is swallowing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-04 06:36</div>
            <div class="timeline-body"><p>Hm, maybe <code>setup_requires</code> is not related, I can repro on https://github.com/quora/qcore/pull/102 as well with <code>uv pip install &quot;qcore @ .&quot;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-04 07:04</div>
            <div class="timeline-body"><p>Okay, I think it might be something like uv install setuptools in the build environment, but does not pick up its pth path in the env?</p>
<p>I validated this hypothesis by doing:</p>
<pre><code>diff --git a/setup.py b/setup.py
index a085fbf..47f0020 100644
--- a/setup.py
+++ b/setup.py
@@ -12,6 +12,8 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+import _distutils_hack
+_distutils_hack.add_shim()
 from setuptools import setup
 from setuptools.extension import Extension
</code></pre>
<p>And this appeared to allow uv to build the package</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-04 07:05</div>
            <div class="timeline-body"><p>That shim code comes from:</p>
<pre><code>λ cat distutils-precedence.pth
import os; var = 'SETUPTOOLS_USE_DISTUTILS'; enabled = os.environ.get(var, 'local') == 'local'; enabled and __import__('_distutils_hack').add_shim(); 
</code></pre>
<pre><code>λ cat setuptools-68.2.2.dist-info/RECORD | grep pth
distutils-precedence.pth,sha256=JjjOniUA5XKl4N5_rtZmHrVp0baW_LoHsN0iPaX10iQ,151
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">macos</span> added by @konstin on 2024-03-04 09:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-04 09:13</div>
            <div class="timeline-body"><p>This seems to be mac os specific, i can't repro on linux. I've also checked that the pth file is present in the build env on linux:</p>
<pre><code>$ ls
Cython  Cython-3.0.8.dist-info  Cython.libs  cython.py  _distutils_hack  distutils-precedence.pth  pkg_resources  __pycache__  pyximport  setuptools  setuptools-69.1.1.dist-info  _virtualenv.pth  _virtualenv.py  wheel  wheel-0.42.0.dist-info
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdejager">@tdejager</a> on 2024-03-04 10:43</div>
            <div class="timeline-body"><p>Just tried this with the latest uv on a apple m1, and for me the installation is succesful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-03-04 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a> on 2024-03-04 17:13</div>
            <div class="timeline-body"><p>Note I just released a version of qcore (1.10.1) with 3.12 wheels; it's possible this bug only manifests if the package has to be built from the sdist. (1.10.0 lacked 3.12 wheels.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 02:28</div>
            <div class="timeline-body"><p>Trying to reproduce but <code>cargo run pip install 'qcore @ https://files.pythonhosted.org/packages/54/56/a74f41ae8712407f959f05d7a8c15e1d11d515b2824bd43499e063cdb465/qcore-1.10.0.tar.gz'</code> still passes for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-05 09:10</div>
            <div class="timeline-body"><p><code>uv pip install --no-cache 'qcore @ https://files.pythonhosted.org/packages/54/56/a74f41ae8712407f959f05d7a8c15e1d11d515b2824bd43499e063cdb465/qcore-1.10.0.tar.gz'</code> consistently fails for me with uv version <code>uv 0.1.14 (c525fdf2b 2024-03-04)</code> when installing to an arm64 Python 3.12.2 virtual environment on macOS 14.3.1.</p>
<p>Like konstin, I could not reproduce directly on Linux.</p>
<p>However, the thing that motivated me to open this issue is a failure on Linux in Github Actions. Note the error is different, though: https://github.com/python/typing_extensions/actions/runs/8153774375/job/22285830806?pr=348</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-05 10:08</div>
            <div class="timeline-body"><p>I tried <code>uv pip install qcore==1.10.0</code> on a <code>ubuntu</code> docker container with <code>python3.12 python3.12-dev</code> from deadsnakes and <code>build-essential</code>, but this also passed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-14 00:32</div>
            <div class="timeline-body"><p>I'm gonna close for now due to some difficulty with the repro, but can always reopen if it pops back up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-14 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-09-14 00:41</div>
            <div class="timeline-body"><p>I can still repro with <code>uvx 'uv@0.1.14' pip install --no-cache 'qcore @ https://files.pythonhosted.org/packages/54/56/a74f41ae8712407f959f05d7a8c15e1d11d515b2824bd43499e063cdb465/qcore-1.10.0.tar.gz'</code>  but not with 0.4.10, so I think we can call this fixed!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-14 00:42</div>
            <div class="timeline-body"><p>0.1.14...</p>
<p><img src="https://github.com/user-attachments/assets/aa8231b1-5029-4995-9d80-1b8e42e3d59a" alt="theres-a-name-ive-not-heard-in-many-years" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-09-14 00:46</div>
            <div class="timeline-body"><p>I think got fixed by https://github.com/astral-sh/uv/pull/2381 , so thank you konstin!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:10 UTC
    </footer>
</body>
</html>
