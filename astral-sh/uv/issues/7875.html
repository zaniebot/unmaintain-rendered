<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv changes my package version when doing &quot;uv build --sdist&quot; or &quot;uv lock&quot; - astral-sh/uv #7875</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv changes my package version when doing &quot;uv build --sdist&quot; or &quot;uv lock&quot;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7875">#7875</a>
        opened by <a href="https://github.com/cmalek">@cmalek</a>
        on 2024-10-02 17:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cmalek">@cmalek</a></div>
            <div class="timeline-body"><p>I'm using <code>uv</code> version 0.4.16.</p>
<p>We're currently in the process of switching from straight <code>pip</code> to <code>uv</code>.  We've been happily using semver for our versioning for a long time, and I'm having issues with pre-release versions and <code>uv</code></p>
<p>https://semver.org/ says about pre-release versions:</p>
<blockquote>
<p>A pre-release version MAY be denoted by appending a hyphen and a series of dot separated identifiers immediately following the patch version. Identifiers MUST comprise only ASCII alphanumerics and hyphens [0-9A-Za-z-]. Identifiers MUST NOT be empty. Numeric identifiers MUST NOT include leading zeroes. Pre-release versions have a lower precedence than the associated normal version. A pre-release version indicates that the version is unstable and might not satisfy the intended compatibility requirements as denoted by its associated normal version. Examples: 1.0.0-alpha, 1.0.0-alpha.1, 1.0.0-0.3.7, 1.0.0-x.7.z.92, 1.0.0-x-y-z.--.</p>
</blockquote>
<p>So if I have a pre-release version id named <code>dev</code> and this is the first <code>dev</code> pre-release of 0.1.0, my version would be (according to the above) <code>0.1.0-dev.1</code></p>
<p>In my <code>pyproject.toml</code>, I have:</p>
<pre><code>[project]
name = &quot;myproject&quot;
version = &quot;0.1.0-dev.1&quot;
...
</code></pre>
<p>If I do a <code>uv lock</code> I get:</p>
<pre><code>$ uv lock
Resolved xx packages in 384ms
Updated myproject v0.1.0 -&gt; v0.1.0.dev1
</code></pre>
<p>Note that it changed my version number string.  <code>uv build</code> does the same thing.</p>
<p>I have a lot of CI/CD tooling that depends on the version numbers being strict semver, and this breaks that.</p>
<p>Is this intentional?  I would prefer if it did not mess with my version numbering.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-02 18:00</div>
            <div class="timeline-body"><p>Note we follow Python <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/">version specification standards</a> which were originally defined in <a href="https://peps.python.org/pep-0440/">PEP 440.</a></p>
<p>~This looks like a bug though, as <code>-</code> should be a valid <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#pre-release-separators">separator for pre-releases</a>~</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-02 18:04</div>
            <div class="timeline-body"><p>Ah actually this is correct, as development releases are separate from pre-releases.</p>
<p>The <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#public-version-identifiers">canonical specification</a> which we <em>must</em> normalize to is:</p>
<blockquote>
<p>[N!]N(.N)*[{a|b|rc}N][.postN][.devN]</p>
</blockquote>
<p>And <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#development-release-separators">normalization for development releases</a> is as follows:</p>
<blockquote>
<p>Development releases allow a ., -, or a _ separator as well as omitting the separator all together. The normal form of this is with the . separator. This allows versions such as 1.2-dev2 or 1.2dev2 which normalize to 1.2.dev2.</p>
</blockquote>
<p>There's a note in the spec about <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#semantic-versioning">compatibility with semver</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-10-02 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cmalek">@cmalek</a> on 2024-10-02 18:06</div>
            <div class="timeline-body"><p>Egads thanks for the information!  I didn't know about PEP 440.  Seems better for me to stick to that than semver.</p>
<p>But I also agree with your observations about development releases allowing ., - or _ as separators, so it would be nice if that were supported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-02 18:08</div>
            <div class="timeline-body"><p>We do support it, but the specification says we &quot;MUST normalize&quot; to the canonical format.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cmalek">@cmalek</a> on 2024-10-02 18:09</div>
            <div class="timeline-body"><p>Thanks!  I understand now.  I'll just adjust my tooling to the normalized version string.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-02 18:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:27:27 UTC
    </footer>
</body>
</html>
