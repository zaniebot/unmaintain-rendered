<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Different python versions crashing - astral-sh/uv #16042</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Different python versions crashing</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16042">#16042</a>
        opened by <a href="https://github.com/danielpassy">@danielpassy</a>
        on 2025-09-26 17:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danielpassy">@danielpassy</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have a repo with multiple projects.
I has a pyproject.toml as it's root.</p>
<pre><code>[project]
name = &quot;daniel-passy-scripts-random&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = []
</code></pre>
<p>Inside ./projects there are many projects, one with python 3.12, the rest with 3.10</p>
<p>I used <code>uv venv env -p 3.10</code> to create the env and use <code>uv pip install</code> to install dependencies.</p>
<p>From time to time, I don't know how, I run into this issue:</p>
<pre><code> âŽ¿  Error: Traceback (most recent call last):
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/manage.py&quot;, line 22, in &lt;module&gt;
         main()
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/manage.py&quot;, line 18, in main
         execute_from_command_line(sys.argv)
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/core/management/__init__.py&quot;, line 442, in 
     execute_from_command_line
         utility.execute()
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/core/management/__init__.py&quot;, line 436, in 
     execute
         self.fetch_command(subcommand).run_from_argv(self.argv)
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/core/management/commands/test.py&quot;, line 24, in 
     run_from_argv
         super().run_from_argv(argv)
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/core/management/base.py&quot;, line 406, in 
     run_from_argv
         parser = self.create_parser(argv[0], argv[1])
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/core/management/base.py&quot;, line 370, in 
     create_parser
         self.add_arguments(parser)
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/core/management/commands/test.py&quot;, line 49, in 
     add_arguments
         test_runner_class = get_runner(settings, self.test_runner)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/test/utils.py&quot;, line 382, in get_runner
         test_runner_class = test_runner_class or settings.TEST_RUNNER
                                                  ^^^^^^^^^^^^^^^^^^^^
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/conf/__init__.py&quot;, line 81, in __getattr__
         self._setup(name)
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/conf/__init__.py&quot;, line 68, in _setup
         self._wrapped = Settings(settings_module)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/django/conf/__init__.py&quot;, line 166, in __init__
         mod = importlib.import_module(self.SETTINGS_MODULE)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
       File &quot;/home/daniel/.local/share/uv/python/cpython-3.12.10-linux-x86_64-gnu/lib/python3.12/importlib/__init__.py&quot;, line 90, in import_module
         return _bootstrap._gcd_import(name[level:], package, level)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
       File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1387, in _gcd_import
       File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
       File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
       File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
       File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 999, in exec_module
       File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 488, in _call_with_frames_removed
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/app_manager/settings.py&quot;, line 18, in &lt;module&gt;
         from app_manager import env
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/app_manager/env.py&quot;, line 3, in &lt;module&gt;
         from app_manager.utils import get_cpus_per_task
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/app_manager/utils.py&quot;, line 5, in &lt;module&gt;
         import requests
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/requests/__init__.py&quot;, line 45, in &lt;module&gt;
         from .exceptions import RequestsDependencyWarning
       File &quot;/home/daniel/projects/eva/projects/eden-foundation/env/lib/python3.12/site-packages/requests/exceptions.py&quot;, line 9, in &lt;module&gt;
         from .compat import JSONDecodeError as CompatJSONDecodeError
     ImportError: cannot import name 'JSONDecodeError' from 'requests.compat' 
</code></pre>
<p>This happened because this requests is from python 3.10 and is in the project that's using 3.12</p>
<p>I even can delete the env, recreate it, and somehow it still install the wrong request.</p>
<pre><code>&quot;&quot;&quot;
requests.compat
~~~~~~~~~~~~~~~

This module previously handled import compatibility issues
between Python 2 and Python 3. It remains for backwards
compatibility until the next major version.req  


env/lib/python3.12/site-packages/requests/compat.py
&quot;&quot;&quot;

try:
    pass
except ImportError:
    pass

import sys

# -------
# Pythons
# -------

# Syntax sugar.
_ver = sys.version_info

#: Python 2.x?
is_py2 = _ver[0] == 2

#: Python 3.x?
is_py3 = _ver[0] == 3

# json/simplejson module import resolution
has_simplejson = False
try:
    pass

    has_simplejson = True
except ImportError:
    pass

if has_simplejson:
    pass
else:
    pass

# Keep OrderedDict for backwards compatibility.

# --------------
# Legacy Imports
# --------------

builtin_str = str
str = str
bytes = bytes
basestring = (str, bytes)
numeric_types = (int, float)
integer_types = (int,)
</code></pre>
<p>FOr me to solve, delete env, run <code>uv cache clean</code>, than recreate the env
&quot;&quot;&quot;
requests.compat</p>
<pre><code>
This module previously handled import compatibility issues
between Python 2 and Python 3. It remains for backwards
compatibility until the next major version.
&quot;&quot;&quot;

try:
    import chardet
except ImportError:
    import charset_normalizer as chardet

import sys

# -------
# Pythons
# -------

# Syntax sugar.
_ver = sys.version_info

#: Python 2.x?
is_py2 = _ver[0] == 2

#: Python 3.x?
is_py3 = _ver[0] == 3

# json/simplejson module import resolution
has_simplejson = False
try:
    import simplejson as json

    has_simplejson = True
except ImportError:
    import json

if has_simplejson:
    from simplejson import JSONDecodeError
else:
    from json import JSONDecodeError

# Keep OrderedDict for backwards compatibility.
from collections import OrderedDict
from collections.abc import Callable, Mapping, MutableMapping
from http import cookiejar as cookielib
from http.cookies import Morsel
from io import StringIO

# --------------
# Legacy Imports
# --------------
from urllib.parse import (
    quote,
    quote_plus,
    unquote,
    unquote_plus,
    urldefrag,
    urlencode,
    urljoin,
    urlparse,
    urlsplit,
    urlunparse,
)
from urllib.request import (
    getproxies,
    getproxies_environment,
    parse_http_list,
    proxy_bypass,
    proxy_bypass_environment,
)

builtin_str = str
str = str
bytes = bytes
basestring = (str, bytes)
numeric_types = (int, float)
integer_types = (int,)
```
 + requests==2.31.0



Unfornately, the venv from other projects now is broken and I have to delete and uv cache clean 




### Platform

Ubuntu 22.04.5 LTS

### Version

uv 0.8.17

### Python version

Python 3.10.15 and Python 3.12.10
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @danielpassy on 2025-09-26 17:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-27 18:13</div>
            <div class="timeline-body"><p>Can you clarify which requests version is being installed that shouldn't be, and which version you expect to get instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-09-27 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-09-27 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielpassy">@danielpassy</a> on 2025-09-29 14:37</div>
            <div class="timeline-body"><p>As soon as it happens again, I'll verify.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielpassy">@danielpassy</a> on 2025-11-05 23:15</div>
            <div class="timeline-body"><p>Ok, I just happened again.
I created an env python 3.12 with <code>uv venv env -p 3.12</code>, use it, then I opened another shell into another project, and..</p>
<pre><code>Traceback (most recent call last):
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/core/management/base.py&quot;, line 412, in run_from_argv
    self.execute(*args, **cmd_options)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/core/management/commands/runserver.py&quot;, line 74, in execute
    super().execute(*args, **options)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/core/management/base.py&quot;, line 458, in execute
    output = self.handle(*args, **options)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/core/management/commands/runserver.py&quot;, line 81, in handle
    if not settings.DEBUG and not settings.ALLOWED_HOSTS:
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/conf/__init__.py&quot;, line 102, in __getattr__
    self._setup(name)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/conf/__init__.py&quot;, line 89, in _setup
    self._wrapped = Settings(settings_module)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/conf/__init__.py&quot;, line 217, in __init__
    mod = importlib.import_module(self.SETTINGS_MODULE)
  File &quot;/home/daniel/.local/share/uv/python/cpython-3.10.15-linux-x86_64-gnu/lib/python3.10/importlib/__init__.py&quot;, line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1050, in _gcd_import
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1027, in _find_and_load
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1006, in _find_and_load_unlocked
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 688, in _load_unlocked
  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 883, in exec_module
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 241, in _call_with_frames_removed
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/middleware/settings.py&quot;, line 11, in &lt;module&gt;
    from middleware import env
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/middleware/env.py&quot;, line 3, in &lt;module&gt;
    from environ import Env
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/environ/__init__.py&quot;, line 18, in &lt;module&gt;
    from .environ import *
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/environ/environ.py&quot;, line 31, in &lt;module&gt;
    from .compat import (
ImportError: cannot import name 'json' from 'environ.compat' (/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/environ/compat.py)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/manage.py&quot;, line 22, in &lt;module&gt;
    main()
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/manage.py&quot;, line 18, in main
    execute_from_command_line(sys.argv)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/core/management/__init__.py&quot;, line 442, in execute_from_command_line
    utility.execute()
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/core/management/__init__.py&quot;, line 436, in execute
    self.fetch_command(subcommand).run_from_argv(self.argv)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/core/management/base.py&quot;, line 425, in run_from_argv
    connections.close_all()
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/utils/connection.py&quot;, line 84, in close_all
    for conn in self.all(initialized_only=True):
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/utils/connection.py&quot;, line 76, in all
    return [
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/utils/connection.py&quot;, line 73, in __iter__
    return iter(self.settings)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/utils/functional.py&quot;, line 57, in __get__
    res = instance.__dict__[self.name] = self.func(instance)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/utils/connection.py&quot;, line 45, in settings
    self._settings = self.configure_settings(self._settings)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/db/utils.py&quot;, line 148, in configure_settings
    databases = super().configure_settings(databases)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/utils/connection.py&quot;, line 50, in configure_settings
    settings = getattr(django_settings, self.settings_name)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/conf/__init__.py&quot;, line 102, in __getattr__
    self._setup(name)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/conf/__init__.py&quot;, line 89, in _setup
    self._wrapped = Settings(settings_module)
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/django/conf/__init__.py&quot;, line 217, in __init__
    mod = importlib.import_module(self.SETTINGS_MODULE)
  File &quot;/home/daniel/.local/share/uv/python/cpython-3.10.15-linux-x86_64-gnu/lib/python3.10/importlib/__init__.py&quot;, line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1050, in _gcd_import
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1027, in _find_and_load
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1006, in _find_and_load_unlocked
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 688, in _load_unlocked
  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 883, in exec_module
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 241, in _call_with_frames_removed
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/middleware/settings.py&quot;, line 11, in &lt;module&gt;
    from middleware import env
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/middleware/env.py&quot;, line 3, in &lt;module&gt;
    from environ import Env
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/environ/__init__.py&quot;, line 18, in &lt;module&gt;
    from .environ import *
  File &quot;/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/environ/environ.py&quot;, line 31, in &lt;module&gt;
    from .compat import (
ImportError: cannot import name 'json' from 'environ.compat' (/home/daniel/projects/eva/projects/eden-middleware/env/lib/python3.10/site-packages/environ/compat.py)
</code></pre>
<p>the content of compat.py:</p>
<pre><code># This file is part of the django-environ.
#
# Copyright (c) 2021-2022, Serghei Iakovlev &lt;egrep@protonmail.ch&gt;
# Copyright (c) 2013-2021, Daniele Faraglia &lt;daniele.faraglia@gmail.com&gt;
#
# For the full copyright and license information, please view
# the LICENSE.txt file that was distributed with this source code.

&quot;&quot;&quot;
Django-environ allows you to utilize 12factor inspired environment
variables to configure your Django application.
&quot;&quot;&quot;

import ast
import itertools
import logging
import os
import re
import sys
import warnings
from urllib.parse import (
    parse_qs,
    ParseResult,
    quote,
    unquote,
    unquote_plus,
    urlparse,
    urlunparse,
)

from .compat import (
    DJANGO_POSTGRES,
    ImproperlyConfigured,
    json,
    PYMEMCACHE_DRIVER,
    REDIS_DRIVER,
)
</code></pre>
<p>the content of .compat</p>
<pre><code># This file is part of the django-environ.
#
# Copyright (c) 2021-2022, Serghei Iakovlev &lt;egrep@protonmail.ch&gt;
# Copyright (c) 2013-2021, Daniele Faraglia &lt;daniele.faraglia@gmail.com&gt;
#
# For the full copyright and license information, please view
# the LICENSE.txt file that was distributed with this source code.

&quot;&quot;&quot;This module handles import compatibility issues.&quot;&quot;&quot;

from importlib.util import find_spec

if find_spec('simplejson'):
    pass
else:
    pass

if find_spec('django'):
    from django import VERSION as DJANGO_VERSION
    from django.core.exceptions import ImproperlyConfigured
else:
    DJANGO_VERSION = None

    class ImproperlyConfigured(Exception):
        &quot;&quot;&quot;Django is somehow improperly configured&quot;&quot;&quot;


def choose_rediscache_driver():
    &quot;&quot;&quot;Backward compatibility for RedisCache driver.&quot;&quot;&quot;

    # django-redis library takes precedence
    if find_spec('django_redis'):
        return 'django_redis.cache.RedisCache'

    # use built-in support if Django 4+
    if DJANGO_VERSION is not None and DJANGO_VERSION &gt;= (4, 0):
        return 'django.core.cache.backends.redis.RedisCache'

    # back compatibility with redis_cache package
    return 'redis_cache.RedisCache'


def choose_postgres_driver():
    &quot;&quot;&quot;Backward compatibility for postgresql driver.&quot;&quot;&quot;
    old_django = DJANGO_VERSION is not None and DJANGO_VERSION &lt; (2, 0)
    if old_django:
        return 'django.db.backends.postgresql_psycopg2'
    return 'django.db.backends.postgresql'


def choose_pymemcache_driver():
    &quot;&quot;&quot;Backward compatibility for pymemcache.&quot;&quot;&quot;
    old_django = DJANGO_VERSION is not None and DJANGO_VERSION &lt; (3, 2)
    if old_django or not find_spec('pymemcache'):
        # The original backend choice for the 'pymemcache' scheme is
        # unfortunately 'pylibmc'.
        return 'django.core.cache.backends.memcached.PyLibMCCache'
    return 'django.core.cache.backends.memcached.PyMemcacheCache'


REDIS_DRIVER = choose_rediscache_driver()
&quot;&quot;&quot;The name of the RedisCache driver.&quot;&quot;&quot;

DJANGO_POSTGRES = choose_postgres_driver()
&quot;&quot;&quot;The name of the PostgreSQL driver.&quot;&quot;&quot;

PYMEMCACHE_DRIVER = choose_pymemcache_driver()
&quot;&quot;&quot;The name of the Pymemcache driver.&quot;&quot;&quot;

</code></pre>
<p>then:</p>
<pre><code>(env) daniel@daniel-Precision-3591:~/projects/eva/projects/eden-middleware$ uv cache clean
Clearing cache at: /home/daniel/.cache/uv
Removed 54556 files (1.4GiB)
(env) daniel@daniel-Precision-3591:~/projects/eva/projects/eden-middleware$ sudo rm -rf env
[sudo] password for daniel: 
(env) daniel@daniel-Precision-3591:~/projects/eva/projects/eden-middleware$ uv venv env -p 3.10
Using CPython 3.10.15
Creating virtual environment at: env
Activate with: source env/bin/activate
(env) daniel@daniel-Precision-3591:~/projects/eva/projects/eden-middleware$ source env/bin/activate
(env) daniel@daniel-Precision-3591:~/projects/eva/projects/eden-middleware$ uv pip install -r requirements/prod.txt 
</code></pre>
<p>suddenly my compat.py</p>
<pre><code># This file is part of the django-environ.
#
# Copyright (c) 2021-2022, Serghei Iakovlev &lt;egrep@protonmail.ch&gt;
# Copyright (c) 2013-2021, Daniele Faraglia &lt;daniele.faraglia@gmail.com&gt;
#
# For the full copyright and license information, please view
# the LICENSE.txt file that was distributed with this source code.

&quot;&quot;&quot;This module handles import compatibility issues.&quot;&quot;&quot;

from importlib.util import find_spec

if find_spec('simplejson'):
    import simplejson as json
else:
    import json

if find_spec('django'):
    from django import VERSION as DJANGO_VERSION
    from django.core.exceptions import ImproperlyConfigured
else:
    DJANGO_VERSION = None

    class ImproperlyConfigured(Exception):
        &quot;&quot;&quot;Django is somehow improperly configured&quot;&quot;&quot;


def choose_rediscache_driver():
    &quot;&quot;&quot;Backward compatibility for RedisCache driver.&quot;&quot;&quot;

    # django-redis library takes precedence
    if find_spec('django_redis'):
        return 'django_redis.cache.RedisCache'

    # use built-in support if Django 4+
    if DJANGO_VERSION is not None and DJANGO_VERSION &gt;= (4, 0):
        return 'django.core.cache.backends.redis.RedisCache'

    # back compatibility with redis_cache package
    return 'redis_cache.RedisCache'


def choose_postgres_driver():
    &quot;&quot;&quot;Backward compatibility for postgresql driver.&quot;&quot;&quot;
    old_django = DJANGO_VERSION is not None and DJANGO_VERSION &lt; (2, 0)
    if old_django:
        return 'django.db.backends.postgresql_psycopg2'
    return 'django.db.backends.postgresql'


def choose_pymemcache_driver():
    &quot;&quot;&quot;Backward compatibility for pymemcache.&quot;&quot;&quot;
    old_django = DJANGO_VERSION is not None and DJANGO_VERSION &lt; (3, 2)
    if old_django or not find_spec('pymemcache'):
        # The original backend choice for the 'pymemcache' scheme is
        # unfortunately 'pylibmc'.
        return 'django.core.cache.backends.memcached.PyLibMCCache'
    return 'django.core.cache.backends.memcached.PyMemcacheCache'


REDIS_DRIVER = choose_rediscache_driver()
&quot;&quot;&quot;The name of the RedisCache driver.&quot;&quot;&quot;

DJANGO_POSTGRES = choose_postgres_driver()
&quot;&quot;&quot;The name of the PostgreSQL driver.&quot;&quot;&quot;

PYMEMCACHE_DRIVER = choose_pymemcache_driver()
&quot;&quot;&quot;The name of the Pymemcache driver.&quot;&quot;&quot;
</code></pre>
<p>I actually did the same for python 3.12... and it got the same compact.py as in the python 3.10, I have no idea what was that weird compact.py, nor where it came from..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 15:29</div>
            <div class="timeline-body"><p>Is there maybe a tool changing those files? django-environ only has a <code>django_environ-0.12.0-py2.py3-none-any.whl</code> package, so the Python version shouldn't be the issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:01 UTC
    </footer>
</body>
</html>
