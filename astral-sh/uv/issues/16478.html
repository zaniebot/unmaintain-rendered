<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv ignores `authentication = always` when providing PIP_INDEX_URL or PIP_EXTRA_INDEX_URL - astral-sh/uv #16478</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv ignores <code>authentication = always</code> when providing PIP_INDEX_URL or PIP_EXTRA_INDEX_URL</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16478">#16478</a>
        opened by <a href="https://github.com/schulluk">@schulluk</a>
        on 2025-10-28 10:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/schulluk">@schulluk</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We use Google Cloud Artifact Registry to host our Python dependencies in 2 repositories.</p>
<p>We have a <code>/etc/uv/uv.toml</code> that specifies the keyring provider and authentication mode:</p>
<pre><code>keyring-provider = &quot;subprocess&quot;

[[index]]
name = &quot;repo&quot;
url = &quot;https://us-python.pkg.dev/${GCP_PROJECT}/${ARTIFACT_REGISTRY_REPOSITORY_A}/simple&quot;
default = true
authenticate = &quot;always&quot;
</code></pre>
<p>When we run <code>uv pip install --verbose -r requirements.txt</code> everything works.</p>
<p>But when we provide the the second repository as an environment variable or as a command-line flag, the authentication fails with</p>
<pre><code>$ uv pip install --verbose --index-url=https://us-python.pkg.dev/${GCP_PROJECT}/${ARTIFACT_REGISTRY_REPOSITORY_B}/simple -r requirements.txt

[...]
DEBUG No cache entry for: https://us-python.pkg.dev/${GCP_PROJECT}/${ARTIFACT_REGISTRY_REPOSITORY_B}/simple/six/
DEBUG No netrc file found
DEBUG Acquired lock for `credentials store`
DEBUG Released lock at `/root/.local/share/uv/credentials/credentials.toml.lock`
DEBUG No credentials file found at /root/.local/share/uv/credentials/credentials.toml
DEBUG Skipping keyring fetch for https://us-python.pkg.dev/${GCP_PROJECT}/${ARTIFACT_REGISTRY_REPOSITORY_B}/simple/six/ without username; use `authenticate = always` to force
</code></pre>
<p>We also tried to provide the keyring-provider as a command-line flag, but we couldn't find a flag that allows us specifying <code>authenticate = always</code> in the command itself.</p>
<p>The following command also fails with the authentication error:</p>
<pre><code>uv pip install --verbose --keyring-provider subprocess --index-url=https://us-python.pkg.dev/${GCP_PROJECT}/${ARTIFACT_REGISTRY_REPOSITORY_B}/simple -r requirements.txt
</code></pre>
<p>As soon as any of <code>--index-url</code>, <code>--extra-index-url</code>, <code>PIP_INDEX_URL</code>, <code>PIP_EXTRA_INDEX_URL</code>, <code>UV_INDEX_URL</code> and <code>UV_EXTRA_INDEX_URL</code> are provided, the authentication will fail.</p>
<h3>Platform</h3>
<p>Ubuntu 24.04</p>
<h3>Version</h3>
<p>0.9.5</p>
<h3>Python version</h3>
<p>Python 3.12.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @schulluk on 2025-10-28 10:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-28 15:57</div>
            <div class="timeline-body"><blockquote>
<p>We also tried to provide the keyring-provider as a command-line flag, but we couldn't find a flag that allows us specifying <code>authenticate = always</code> in the command itself.</p>
</blockquote>
<p>There's currently no CLI flag for this, to use <code>authenticate = &quot;always&quot;</code> for now you need to define the index in a TOML file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-10-28 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2025-10-28 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schulluk">@schulluk</a> on 2025-10-30 09:49</div>
            <div class="timeline-body"><p>Is it currently possible to use multiple indexes that are defined in a TOML file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-01 20:08</div>
            <div class="timeline-body"><p>Yeah you can have multiple indexes defined in the TOML file. You can add another <code>[[index]]</code> entry. (That TOML syntax means they're items in a list, so each <code>[[index]]</code> defines another index entry.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schulluk">@schulluk</a> on 2025-11-03 12:26</div>
            <div class="timeline-body"><p>Thanks for the clarification.
I knew that I can define multiple indexes, but I didn't know that <code>uv</code> will loop through all of the defined indexes automatically to find the package.</p>
<p>Currently, the following setup works:</p>
<pre><code># File: /etc/uv/uv.toml
# The following config uses the system-level syntax.
# Does also work for the ./pyproject.toml with the correct syntax.

keyring-provider = &quot;subprocess&quot;

[[index]]
name = &quot;pytorch&quot;
url = &quot;https://download.pytorch.org/whl/cu129&quot;
default = true

[[index]]
name = &quot;repoA&quot;
url = &quot;https://us-python.pkg.dev/${GCP_PROJECT}/${ARTIFACT_REGISTRY_REPOSITORY_A}/simple&quot;
authenticate = &quot;always&quot;

[[index]]
name = &quot;repoB&quot;
url = &quot;https://us-python.pkg.dev/${GCP_PROJECT}/${ARTIFACT_REGISTRY_REPOSITORY_B}/simple&quot;
authenticate = &quot;always&quot;
</code></pre>
<p>When running <code>uv pip install torch</code>, uv will first loop through all defined indexes that haven't set <code>default = true</code>. The last used index is the default one, pytorch in the example. If no default one is specified, uv defaults to PYPI servers.</p>
<p>uv uses the order of definition in the TOML file.
In my example the order of checked indexes is:</p>
<ol>
<li>repoA</li>
<li>repoB</li>
<li>pytorch</li>
</ol>
<p>without using <code>default = true</code> on index <em>pytorch</em>, the order would be:</p>
<ol>
<li>repoA</li>
<li>repoB</li>
<li>pytorch</li>
<li>pypi API</li>
</ol>
<hr />
<p>Despite this, it would be nice if the authentication could be specified as a command-line flag or that there is a default setting which can be configured in the TOML files.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:18 UTC
    </footer>
</body>
</html>
