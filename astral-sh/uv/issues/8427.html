<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv venv: Activate.ps1 script sets an invalid base directory when using UNC paths. - astral-sh/uv #8427</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv venv: Activate.ps1 script sets an invalid base directory when using UNC paths.</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8427">#8427</a>
        opened by <a href="https://github.com/NucaChance">@NucaChance</a>
        on 2024-10-21 21:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/NucaChance">@NucaChance</a> on 2024-10-21 21:15</div>
            <div class="timeline-body"><p><strong>PLATFORM:</strong></p>
<ul>
<li>Windows Server 2019</li>
<li>PowerShell 7.4.5</li>
<li>Python 3.12.4</li>
</ul>
<p><strong>UV Version:</strong>  <code>uv 0.4.25 (97eb6ab4a 2024-10-21)</code></p>
<p>This isn't <em>exactly</em> a UV bug, but to handle UNC paths the <code>activate.ps1</code> script needs to change how it resolves the path.</p>
<h2>The Issue</h2>
<p>Currently the script is using <code>Resolve-Path</code> which returns a <code>PathInfo</code> object, and passing that to <code>Split-Path</code>, causing it to be cast to a string. For whatever reason the cast contains the <code> Microsoft.PowerShell.Core\FileSystem::</code> provider information when resolving a UNC path, and Split-Path chokes on it.</p>
<h3>Test script</h3>
<p>This is just to show the behavior without running the full activate script.</p>
<pre><code class="language-test.ps1">$script:THIS_PATH = $myinvocation.mycommand.path
$script:BASE_DIR = Split-Path (Resolve-Path &quot;$THIS_PATH/..&quot;).ProviderPath -Parent

$script:ALT_BASE_DIR_1 = Split-Path (Resolve-Path &quot;$THIS_PATH/..&quot;).ProviderPath -Parent


$script:CURRENT_FILE = Get-Item $myinvocation.mycommand.path
$script:ALT_BASE_DIR_2 = $CURRENT_FILE.Directory.Parent.FullName

Write-Host &quot;Base Directory: $BASE_DIR&quot;
Write-Host &quot;Alternate Base Directory: $ALT_BASE_DIR_1&quot;
Write-Host &quot;Alternate  Alternate Base Directory: $ALT_BASE_DIR_2&quot;

</code></pre>
<p>Running the script with sanitized paths:</p>
<pre><code class="language-run-test.ps1"># Run Local to machine
PS &gt; D:\python\test\.venv\Scripts\test.ps1
Base Directory: D:\python\test\.venv
Alternate Base Directory: D:\python\test\.venv
Alternate Alternate Base Directory: D:\python\test\.venv

# Run on network share
PS &gt; \\storage.my.company.net\network_share\test-venv\.venv\Scripts\test.ps1
Base Directory: Microsoft.PowerShell.Core\FileSystem::\\storage.my.company.net\network_share\test-venv\.venv\Scripts\test.ps1
Alternate Base Directory: \\storage.my.company.net\network_share\test-venv\.venv
Alternate Alternate Base Directory: \\storage.my.company.net\network_share\test-venv\.venv

</code></pre>
<h2>Fixes</h2>
<h3>Option 1:</h3>
<p>Just specify you want the <code>.ProviderPath</code> like this:</p>
<pre><code class="language-option-1.ps1">$script:THIS_PATH = $myinvocation.mycommand.path
$script:ALT_BASE_DIR_1 = Split-Path (Resolve-Path &quot;$THIS_PATH/..&quot;).ProviderPath -Parent
</code></pre>
<h3>Option 2:</h3>
<blockquote>
<p>My personal pick</p>
</blockquote>
<p>Get the <code>[FileInfo]</code> object for the script file, and use it's properties like so:</p>
<pre><code class="language-option-2.ps1">$script:CURRENT_FILE = Get-Item $myinvocation.mycommand.path
$script:ALT_BASE_DIR_2 = $CURRENT_FILE.Directory.Parent.FullName

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv venv: Activate.ps1 script can set an invalid base directory when using UNC paths." to "uv venv: Activate.ps1 script sets an invalid base directory when using UNC paths." by @NucaChance on 2024-11-12 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NucaChance">@NucaChance</a> on 2025-10-02 15:24</div>
            <div class="timeline-body"><p>I just tried this in version <code>8.2.2</code> and it appears to be fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @NucaChance on 2025-10-02 15:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
