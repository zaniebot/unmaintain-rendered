<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test `publish::invalid_token` flake on Windows - astral-sh/uv #8535</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Test `publish::invalid_token` flake on Windows</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/8535">#8535</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-10-24 17:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-24 17:40</div>
            <div class="timeline-body"><pre><code>running 1 test
test publish::invalid_token has been running for over 60 seconds
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Snapshot Summary ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Snapshot: invalid_token
Source: E:\uv:33
───────────────────────────────────────────────────────────────────────────────
Expression: snapshot
───────────────────────────────────────────────────────────────────────────────
-old snapshot
+new results
────────────┬──────────────────────────────────────────────────────────────────
    5     5 │ warning: `uv publish` is experimental and may change without warning
    6     6 │ Publishing 1 file to https://test.pypi.org/legacy/
    7     7 │ Uploading ok-1.0.0-py3-none-any.whl ([SIZE])
    8     8 │ error: Failed to publish `../../scripts/links/ok-1.0.0-py3-none-any.whl` to https://test.pypi.org/legacy/
    9       │-  Caused by: Permission denied (status code 403 Forbidden): 403 Invalid or non-existent authentication information. See https://test.pypi.org/help/#invalid-auth for more information.
          9 │+  Caused by: Upload failed with status 403 Forbidden
         10 │+  Caused by: error decoding response body
         11 │+  Caused by: request or response body error
         12 │+  Caused by: error reading a body from connection
         13 │+  Caused by: stream error received: unspecific protocol error detected
────────────┴──────────────────────────────────────────────────────────────────
Stopped on the first failure. Run `cargo insta test` to run all snapshots.
test publish::invalid_token ... FAILED

failures:

failures:
    publish::invalid_token

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 1132 filtered out; finished in 64.83s


--- STDERR:              uv::it publish::invalid_token ---

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ Unfiltered output ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
----- stdout -----

----- stderr -----
warning: `uv publish` is experimental and may change without warning
Publishing 1 file to https://test.pypi.org/legacy/
Uploading ok-1.0.0-py3-none-any.whl (875.0B)
error: Failed to publish `..\..\scripts\links\ok-1.0.0-py3-none-any.whl` to https://test.pypi.org/legacy/
  Caused by: Upload failed with status 403 Forbidden
  Caused by: error decoding response body
  Caused by: request or response body error
  Caused by: error reading a body from connection
  Caused by: stream error received: unspecific protocol error detected

────────────────────────────────────────────────────────────────────────────────

thread 'publish::invalid_token' panicked at E:/.cargo\registry\src\index.crates.io-6f17d22bba15001f\insta-1.40.0\src\runtime.rs:548:9:
snapshot assertion for 'invalid_token' failed in line 33
</code></pre>
<p>https://github.com/astral-sh/uv/actions/runs/11503449422/attempts/1?pr=8420</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @zanieb on 2024-10-24 17:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-03 18:03</div>
            <div class="timeline-body"><p>This one is awkward because it would require retrying an error that failed with the right error code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7839.html">astral-sh/uv#7839</a> on 2024-11-03 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-27 15:58</div>
            <div class="timeline-body"><p>Failed again here: https://github.com/astral-sh/uv/actions/runs/14693636376/job/41232349959?pr=13132</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:23 UTC
    </footer>
</body>
</html>
