<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv run` adds a wrapper process that takes ~88mb RSS - astral-sh/uv #11225</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv run` adds a wrapper process that takes ~88mb RSS</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11225">#11225</a>
        opened by <a href="https://github.com/beaugunderson">@beaugunderson</a>
        on 2025-02-04 19:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/beaugunderson">@beaugunderson</a> on 2025-02-04 19:33</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We run multiple processes in Docker and have just migrated from <code>poetry</code> to <code>uv</code>. We are very sensitive to memory usage since we want to run a given number of workers within a set amount of memory. Previously we used <code>poetry run</code>, which does not create a wrapper process and has no additional memory usage. <code>uv</code> keeps <code>uv run</code> resident and forks a subprocess, so we incur ~88mb RSS by using <code>uv run</code> in comparison to <code>poetry run</code>.</p>
<p>Example of what it looks like in <code>ps</code>:</p>
<p><img src="https://github.com/user-attachments/assets/ef4a6c2b-e7d3-4c9f-95a4-5154e4adab2e" alt="Image" /></p>
<p>(88mb figure comes from production procstat monitoring, this screenshot was from local development and shows a different RSS figure)</p>
<h3>Platform</h3>
<p>docker: python:3.11-slim-bullseye</p>
<h3>Version</h3>
<p>uv 0.5.25 (Homebrew 2025-01-28)</p>
<h3>Python version</h3>
<p>Python 3.11.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @beaugunderson on 2025-02-04 19:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-04 20:08</div>
            <div class="timeline-body"><p>If you want to work around this for now, you can just run <code>uv sync</code> then activate the virtual environment or run the binary directly. It's equivalent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-04 20:09</div>
            <div class="timeline-body"><p>E.g.: <code>uv sync &amp;&amp; .venv/bin/python -m plugin runner.plugin runner</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-04 20:11</div>
            <div class="timeline-body"><p>It seems that Poetry also runs the command as a subprocess and keeps the current process around, by the way. Where are you seeing that it doesn't do so?</p>
<p>Edit: Maybe I'm misreading the Poetry code? I don't see Poetry in <code>ps</code> but the code suggests it's using a subprocess.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-02-04 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2025-02-04 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-04 20:30</div>
            <div class="timeline-body"><p>Ohh sorry I misread. Poetry only keeps it around on Windows -- on other platforms, they use <code>execvpe</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/beaugunderson">@beaugunderson</a> on 2025-02-04 20:44</div>
            <div class="timeline-body"><blockquote>
<p>If you want to work around this for now, you can just run <code>uv sync</code> then activate the virtual environment or run the binary directly. It's equivalent.</p>
</blockquote>
<p>awesome, this is the workaround we're using üôè</p>
<p>appreciate the quick response!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-04 21:07</div>
            <div class="timeline-body"><p>No problem! I'm gonna see if we can reduce the memory overhead here a bit (though in a highly memory-conscious setting, it probably makes sense to continue using that &quot;direct execution&quot; strategy). We'll also consider delegating entirely to the child process, though we lose a few things in the process (e.g., we can't show great error messages or hints).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:59 UTC
    </footer>
</body>
</html>
