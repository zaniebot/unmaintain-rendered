<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unable to activate VIRTUAL_ENV when CONDA_PREFIX exists - astral-sh/uv #2028</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unable to activate VIRTUAL_ENV when CONDA_PREFIX exists</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2028">#2028</a>
        opened by <a href="https://github.com/teepoy">@teepoy</a>
        on 2024-02-28 00:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/teepoy">@teepoy</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>I'm trying out uv, together with <a href="https://github.com/juftin/hatch-pip-compile">hatch-pip-compile</a> (and hatch). venv creation works fine, and speed is significantly faster, great!</p>
<p>Except when I try to run command with created virtual env, error raises</p>
<pre><code>(base)  test-hatch-pip-compile$ hatch run default1:python
error: Both VIRTUAL_ENV and CONDA_PREFIX are set. Please unset one of them.
</code></pre>
<p>The error message is clean, that's great, and I can fix it on my computer in 5 seconds (conda deactivate).
I just wonder if there is any difficulty makes this &quot;user action&quot; necessary?</p>
<p>Here is the hatch.toml (very likely unrelated imo since hatch is just an invoker and after I deactivated conda environment everything looks ok)</p>
<pre><code class="language-toml">[env]
requires = [
    &quot;hatch-pip-compile&quot;,
]

[envs.default]
path = &quot;.venv/default&quot;

[envs.default1]
path = &quot;.venv/default1&quot;
type = &quot;pip-compile&quot;
pip-compile-installer = &quot;uv&quot;
pip-compile-resolver = &quot;uv&quot;
</code></pre>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-02-28 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">virtualenv</span> added by @zanieb on 2024-02-28 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @zanieb on 2024-02-28 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-28 05:19</div>
            <div class="timeline-body"><p>@konstin - Thoughts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-28 09:08</div>
            <div class="timeline-body"><p>We could have <code>VIRTUAL_ENV</code> take precedence over <code>CONDA_PREFIX</code> if the <code>python</code> in PATH is from that venv; I'm not sure what behavior conda users would expect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ananis25">@ananis25</a> on 2024-03-18 14:16</div>
            <div class="timeline-body"><blockquote>
<p>We could have <code>VIRTUAL_ENV</code> take precedence over <code>CONDA_PREFIX</code> if the <code>python</code> in PATH is from that venv; I'm not sure what behavior conda users would expect.</p>
</blockquote>
<p>This'd be useful, same error came up when using Rye to set up a new project, while the global python comes from Conda.
Having a base conda/mamba env activated is useful for one-off scripts (Rye is a bit new to use everywhere).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matthewfeickert">@matthewfeickert</a> on 2024-03-19 20:58</div>
            <div class="timeline-body"><p>This also happens if you try to have <code>uv</code> be installed globally with <code>pixi</code> via <code>pixi global install uv</code>.</p>
<p>The easy alternative is just to globally install <code>uv</code> itself, but it is nice to have <code>pixi global</code> be able to manage all your tools with a <code>pixi global upgrade-all</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-03-20 17:49</div>
            <div class="timeline-body"><blockquote>
<p>We could have <code>VIRTUAL_ENV</code> take precedence over <code>CONDA_PREFIX</code> if the <code>python</code> in PATH is from that venv; I'm not sure what behavior conda users would expect.</p>
</blockquote>
<p>When conda is activated it can be considered a globally available Python, therefore when a virtual environment is activated in a conda environment it is equivalent to a virtual environment being activated when there is a system install, the virtual environment should take precedence.</p>
<p>This has come up a few of times on pip issues, I'll try and find the discussion .</p>
<p>But anecdotally when I was a heavy conda user this is what I would have expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-20 20:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:04 UTC
    </footer>
</body>
</html>
