<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`index` in uv.toml in parent directory not recognized - astral-sh/uv #10436</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>index</code> in uv.toml in parent directory not recognized</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10436">#10436</a>
        opened by <a href="https://github.com/NicholasPini">@NicholasPini</a>
        on 2025-01-09 16:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/NicholasPini">@NicholasPini</a></div>
            <div class="timeline-body"><p>I have a bunch of separated python projects. Since they all have the same private index in their pyproject.toml, I figured it is better to move the index definition to a uv.toml file in a parent directory:</p>
<pre><code># uv.toml

required-version = &quot;&gt;=0.5.16&quot;

[[index]]
name = &quot;my_index&quot;
url = &quot;...&quot;
explicit = true
</code></pre>
<pre><code># pyproject.toml

# other stuff...

[tool.uv.sources]
my_private_dependency = { index = &quot;my_index&quot; }

</code></pre>
<p>The problem is that this is not recognized by uv, it says that</p>
<pre><code>Failed to parse entry: `my_private_dependency`
  ╰─▶ Package `my_private_dependency` references an undeclared index: `my_index`
</code></pre>
<p>Note that putting the exact same index definition inside the pyproject.toml works, so the definition itself is correct.</p>
<p>Maybe indices are not supposed to go into a common uv.toml file, but I don&#x27;t get any error about <code>index</code> not being permitted in uv.toml (like I would with, for example, the <code>source</code> settings).</p>
<p>Also, the uv.toml file itsefil is read: again, if I for example put a <code>source</code> definition, I get an error saying that it is not permitted, thus uv is reading the uv.toml file as expected.</p>
<p>EDIT: Ok, after a bit more testing, the uv.toml is completely ignored. It does give an error if I add the <code>source</code> section, but otherwise it is not read at all. For example, setting <code>required-version = &quot;&gt;=0.5.17&quot;</code> doesn&#x27;t make uv fail the command (I&#x27;m using version 0.5.16). So basically the uv.toml is parent directories is completely ignored if a pyproject.toml file is present, but for some reason it complained about <code>source</code> being present.</p>
<p>EDIT2: I think I get what is happening. If there is a single <code>[tool.uv]</code> in the pyproject.toml file, the uv.toml file in parent directories is ignored. The problem is that I found no way to define <code>source</code> without using <code>[tool.uv.sources]</code>, and I&#x27;m forced to have that in the pyproject.toml file, so I think uv prevents me from using a global uv.toml as I intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-09 19:22</div>
            <div class="timeline-body"><p>You could define that as a user- or system-level configuration file, which would get merged into your configuration, e.g., at <code>~/.config/uv/uv.toml</code>. See: https://docs.astral.sh/uv/configuration/files/. But yeah, we don&#x27;t merge arbitrary configuration files in the directory hierarchy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-09 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-09 19:23</div>
            <div class="timeline-body"><p>Oh, but we do <em>not</em> allow indexes to be referenced by name that are defined outside of the current project. So the use of an explicit index like that wouldn&#x27;t work. It was an intentional decision but there&#x27;s a related issue somewhere asking for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-09 19:23</div>
            <div class="timeline-body"><p>Here it is: #9440</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-10 03:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NicholasPini">@NicholasPini</a> on 2025-01-10 09:02</div>
            <div class="timeline-body"><blockquote>
<p>You could define that as a user- or system-level configuration file, which would get merged into your configuration, e.g., at <code>~/.config/uv/uv.toml</code>. See: https://docs.astral.sh/uv/configuration/files/. But yeah, we don&#x27;t merge arbitrary configuration files in the directory hierarchy.</p>
</blockquote>
<p>I see. I understand why <code>index</code> and <code>sources</code> should not be in a global uv.toml. I think that not being able to reference a uv.toml in a parent directory is a bit of a missed opportunity for things like <code>required-version</code>. It would be nice to have a uv.toml in the root directory of a project with basic constraints and rules that all projects in the children directories must follow (like, again, <code>required-version</code>). Right now, I would need to update by hand all pyproject.toml files if I want to bump the minimum required version of uv for all projects.</p>
<p>I could define the uv.toml anyway and use the <code>--config-file</code> flag in all uv commands, possibly putting all of it in a nice justfile, but it&#x27;s a bit of a hacky approach.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:35 UTC
    </footer>
</body>
</html>
