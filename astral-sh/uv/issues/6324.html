<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extras with leading &quot;-&quot; cause optional packages to be installed. - astral-sh/uv #6324</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Extras with leading &quot;-&quot; cause optional packages to be installed.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6324">#6324</a>
        opened by <a href="https://github.com/AKuederle">@AKuederle</a>
        on 2024-08-21 13:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AKuederle">@AKuederle</a></div>
            <div class="timeline-body"><p>I tried installing one of my own packages with uv, which has, admittedly, a little weird structure when it comes to extras.</p>
<p>Namely it has two extras which are named with a leading &quot;-&quot;. See excerpt from the package Metadata below.</p>
<p>When installing the package with uv (<code>uv add tpcp</code>), both packages (<code>torch</code> and <code>tensorflow-cpu</code>) that are part of these extras will be installed.
When using just pip or poetry to install the package, the two packages are correctly skipped.</p>
<p>Packages that are part of extras (<code>optuna</code> and <code>attrs</code>) that are part of extras without leading &quot;-&quot; are correctly skipped by uv</p>
<p>Relevant part from Package metadata:</p>
<pre><code>Provides-Extra: -tensorflow
Provides-Extra: -torch-cpu
Provides-Extra: attrs
Provides-Extra: optuna
Requires-Dist: attrs (&gt;=22.1.0) ; extra == &quot;attrs&quot;
Requires-Dist: joblib (&gt;=1.3)
Requires-Dist: numpy (&gt;=1.0)
Requires-Dist: optuna (&gt;=2.10) ; extra == &quot;optuna&quot;
Requires-Dist: pandas (&gt;=1.3)
Requires-Dist: scikit-learn (&gt;=1.2.0)
Requires-Dist: tensorflow-cpu (&gt;=2.16.0) ; extra == &quot;-tensorflow&quot;
Requires-Dist: torch (&gt;=1.6.0) ; extra == &quot;-torch-cpu&quot;
Requires-Dist: tqdm (&gt;=4.62.3)
Requires-Dist: typing-extensions (&gt;=4.1.1)
</code></pre>
<p>Link to poetry managed pyproject.toml file use to create the package: https://github.com/mad-lab-fau/tpcp/blob/main/pyproject.toml</p>
<p>Based on the debug log during installation, it seems like uv simply assumes that torch and tensorflow-cpu are regular dependencies.</p>
<pre><code>DEBUG Selecting: tpcp==1.0.0 [preference] (tpcp-1.0.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/42/0b/4256fb0025215fac17ef358a8e1b0fe092cb09a02e1bf4ef52bf40a1cb6f/tpcp-1.0.0-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for tpcp==1.0.0: joblib&gt;=1.3
DEBUG Adding transitive dependency for tpcp==1.0.0: numpy&gt;=1.0
DEBUG Adding transitive dependency for tpcp==1.0.0: pandas&gt;=1.3
DEBUG Adding transitive dependency for tpcp==1.0.0: scikit-learn&gt;=1.2.0
DEBUG Adding transitive dependency for tpcp==1.0.0: tensorflow-cpu&gt;=2.16.0
DEBUG Adding transitive dependency for tpcp==1.0.0: torch&gt;=1.6.0
DEBUG Adding transitive dependency for tpcp==1.0.0: tqdm&gt;=4.62.3
DEBUG Adding transitive dependency for tpcp==1.0.0: typing-extensions&gt;=4.1.1
</code></pre>
<p>Hence, I would assume it is an issue with parsing the Metadata file.</p>
<pre><code>&gt;&gt;&gt; uv --version
uv 0.3.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 13:16</div>
            <div class="timeline-body"><p>I <em>think</em> this is a bug, I'll take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-21 13:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-21 13:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AKuederle">@AKuederle</a> on 2024-08-21 13:31</div>
            <div class="timeline-body"><p>Just realized, that this is likely related: https://github.com/astral-sh/uv/issues/6279
Missed it when looking through the issues</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 13:44</div>
            <div class="timeline-body"><p>Just confirming that this a bug on our end.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 13:47</div>
            <div class="timeline-body"><p>I'm going to merge into https://github.com/astral-sh/uv/issues/6279 to stop duplicating my comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-21 13:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:18 UTC
    </footer>
</body>
</html>
