```yaml
number: 8496
title: "regression in uv 0.4.25's TOML comment handling during uv add"
type: issue
state: closed
author: RazerM
labels:
  - bug
assignees: []
created_at: 2024-10-23T10:58:27Z
updated_at: 2024-10-23T16:14:59Z
url: https://github.com/astral-sh/uv/issues/8496
synced_at: 2026-01-10T01:57:19Z
```

# regression in uv 0.4.25's TOML comment handling during uv add

---

_Issue opened by @RazerM on 2024-10-23 10:58_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

The below issue does not happen on uv 0.4.24.

```
â¯ uv --version
uv 0.4.25 (97eb6ab4a 2024-10-21)
```

initial `pyproject.toml`:
```toml
[project]
name = "scratch"
version = "0.1.0"
requires-python = ">=3.12"
dependencies = [
  # Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec vitae
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
]
```

run
```
uv add attrs click python-gitlab rich tomlkit yarl
```

after:
```toml
[project]
name = "scratch"
version = "0.1.0"
requires-python = ">=3.12"
dependencies = [
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec vitae
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."attrs",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."click",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."python-gitlab",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."rich",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi.
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."tomlkit",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl","attrs",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl","click",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl","python-gitlab",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl","rich",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",# magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl","tomlkit",
  # magna euismod, commodo eros at, aliquam lacus. Nulla facilisi."yarl","yarl",
]
```

A more minimal example is

```toml
[project]
name = "scratch"
version = "0.1.0"
requires-python = ">=3.12"
dependencies = [
  #A
]
```

```
uv add attrs click
```

```toml
[project]
name = "scratch"
version = "0.1.0"
requires-python = ">=3.12"
dependencies = [
  #A#A#A
  #A#A
  #A"attrs",
  #A"click",
]
```


---

_Comment by @charliermarsh on 2024-10-23 11:44_

Thanks!

---

_Label `bug` added by @charliermarsh on 2024-10-23 11:44_

---

_Comment by @charliermarsh on 2024-10-23 13:39_

I'll try to fix it for today's release.

---

_Referenced in [astral-sh/uv#8504](../../astral-sh/uv/pulls/8504.md) on 2024-10-23 15:41_

---

_Closed by @charliermarsh on 2024-10-23 16:15_

---
