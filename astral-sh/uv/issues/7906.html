<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OS error 396 when using OneDrive - astral-sh/uv #7906</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>OS error 396 when using OneDrive</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7906">#7906</a>
        opened by <a href="https://github.com/Pdsantos73">@Pdsantos73</a>
        on 2024-10-03 19:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Pdsantos73">@Pdsantos73</a> on 2024-10-03 19:13</div>
            <div class="timeline-body"><p>Trying to install fastapi &quot;uv add fastapi[standard]&quot; is showing the following error:</p>
<p>error: Failed to install: certifi-2024.8.30-py3-none-any.whl (certifi==2024.8.30)
Caused by: failed to hardlink file from C:\Users\paulodo\AppData\Local\uv\cache\archive-v0\ez_A-yAgnUYbpxYugeHkX\certifi\py.typed to C:\Users\paulodo\OneDrive - Genesys Telecommunications Laboratories, Inc\DeveloperProject\Python\GenesysClould\middleware_a.venv\Lib\site-packages\certifi\py.typed
Caused by: The cloud operation cannot be performed on a file with incompatible hardlinks. (os error 396)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-03 19:41</div>
            <div class="timeline-body"><p>It looks like your cache is on a different file system than your project. Can you set <code>UV_LINK_MODE=copy</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-10-03 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cache</span> added by @zanieb on 2024-10-03 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-03 19:41</div>
            <div class="timeline-body"><p>cc @charliermarsh we might want a fallback for this specific error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pdsantos73">@Pdsantos73</a> on 2024-10-03 21:02</div>
            <div class="timeline-body"><p>Yes,</p>
<p>I included  env variable but de issues persistes
<img src="https://github.com/user-attachments/assets/1d0490ff-b339-4d77-9459-42d910b20e9a" alt="image" /></p>
<p><img src="https://github.com/user-attachments/assets/e3bb89fa-a472-4afc-9533-63fcb5f53f7d" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pdsantos73">@Pdsantos73</a> on 2024-10-03 21:06</div>
            <div class="timeline-body"><p>I placed the variable with venv activated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pdsantos73">@Pdsantos73</a> on 2024-10-03 22:57</div>
            <div class="timeline-body"><p>I recently updated UV to the latest version.
This problem only occurs in some dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pdsantos73">@Pdsantos73</a> on 2024-10-03 23:23</div>
            <div class="timeline-body"><p>I'm using:
Windows 11
uv 0.4.18 (7b55e9790 2024-10-01)
Python 3.12.6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pdsantos73">@Pdsantos73</a> on 2024-10-03 23:56</div>
            <div class="timeline-body"><p>I created a new project and managed to install it with the <strong>uv add &quot;fastapi[standard]&quot; --link-mode=copy</strong></p>
<p>It worked!!</p>
<p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/ruff/issues/13612.html">astral-sh/ruff#13612</a> on 2024-10-04 04:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-11 09:49</div>
            <div class="timeline-body"><p>I sort of doubt we can react to this error specifically, unless it maps to a clear error kind on <code>io::Error</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @zanieb on 2024-10-21 21:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-21 21:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samozturk">@samozturk</a> on 2024-10-24 09:51</div>
            <div class="timeline-body"><p>I had the same problem the solutions above didn't work for me. So I did <code>uv cache clean</code>, tried to install again. Solved the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jromal">@jromal</a> on 2024-11-29 16:11</div>
            <div class="timeline-body"><p>Unfortunately it happens very often to me. I have to clean the cache too.
It may be that I am working on Windows and many python projects are on a &quot;OneDrive&quot; folder, that is considered sometimes as a local folder but sometimes with a different very long name. OneDrive is a shit, but for space reasons I have to use it in the companies laptop.</p>
<p>Someone else having problems with OneDrive?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/delreluca">@delreluca</a> on 2024-12-03 11:23</div>
            <div class="timeline-body"><blockquote>
<p>Someone else having problems with OneDrive?</p>
</blockquote>
<p>Yes, at work I also use OneDrive and I experience this same error (os error 396). <code>uv cache clean</code> or moving the cache location fixes the problem.</p>
<p>It doesnâ€™t always happen when I use OneDrive, but I have the suspicion that creating a venv on OneDrive and <code>uv pip install</code> into it somehow taints the cache and breaks it, even if you later use a different venv,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Failed to install: certifi-2024.8.30-py3-none-any.whl " to "OS error 396 when using OneDrive" by @zanieb on 2024-12-03 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../cedanl/1cijferho/issues/12.html">cedanl/1cijferho#12</a> on 2025-04-01 07:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TJMac93">@TJMac93</a> on 2025-06-30 16:07</div>
            <div class="timeline-body"><p>@delreluca's latest comment mirrors my experience. I didn't have any issues running <code>uv add {package}</code> but after absentmindedly doing <code>uv pip install {package}</code> instead, that's when everything stopped working</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
