<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv venv` fails on Windows when using ramdisk - astral-sh/uv #5651</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv venv` fails on Windows when using ramdisk</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/5651">#5651</a>
        opened by <a href="https://github.com/Artalus">@Artalus</a>
        on 2024-07-31 13:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Artalus">@Artalus</a> on 2024-07-31 13:49</div>
            <div class="timeline-body"><p>I have a ramdisk created via <a href="https://sourceforge.net/projects/imdisk-toolkit/">ImDisk</a> that I use as a temporary directory. Apparently <code>uv</code> does not like such setup:</p>
<pre><code class="language-powershell"># uv works alright on a regular disk
PS E:\1&gt; uv venv
Using Python 3.11.3 interpreter at: C:\python\311\python3.exe
Creating virtualenv at: .venv
Activate with: .venv\Scripts\activate

# uv fails on ramdisk
PS E:\1&gt; cd r:/1
PS R:\1&gt; uv venv
thread 'main' panicked at crates\uv-fs\src\path.rs:17:10:
The current directory must be canonicalized: Os { code: 1, kind: Uncategorized, message: &quot;Incorrect function.&quot; }
stack backtrace:
   0:     0x7ff780d71fdd - &lt;unknown&gt;
   1:     0x7ff780d99cb9 - &lt;unknown&gt;
   2:     0x7ff780d6bbe1 - &lt;unknown&gt;
   3:     0x7ff780d71db6 - &lt;unknown&gt;
   4:     0x7ff780d747b8 - &lt;unknown&gt;
   5:     0x7ff780d74466 - &lt;unknown&gt;
   6:     0x7ff780d74ce8 - &lt;unknown&gt;
   7:     0x7ff780d74ba7 - &lt;unknown&gt;
   8:     0x7ff780d7294f - &lt;unknown&gt;
   9:     0x7ff780d74858 - &lt;unknown&gt;
  10:     0x7ff780ed5e84 - &lt;unknown&gt;
  11:     0x7ff780ed6320 - &lt;unknown&gt;
  12:     0x7ff780c6605b - &lt;unknown&gt;
  13:     0x7ff7800a975e - &lt;unknown&gt;
  14:     0x7ff780ed50a4 - &lt;unknown&gt;
  15:     0x7ff7800abbde - &lt;unknown&gt;
  16:     0x7ff77fa82162 - &lt;unknown&gt;
  17:     0x7ff77fa1d797 - &lt;unknown&gt;
  18:     0x7ff77fb01ddd - &lt;unknown&gt;
  19:     0x7ff77fe282ed - &lt;unknown&gt;
  20:     0x7ff77fc95bb4 - &lt;unknown&gt;
  21:     0x7ff77fe28f8a - &lt;unknown&gt;
  22:     0x7ff77fdd28ff - &lt;unknown&gt;
  23:     0x7ff78010ea1a - &lt;unknown&gt;
  24:     0x7ff77fdd4056 - &lt;unknown&gt;
  25:     0x7ff780d62c9e - &lt;unknown&gt;
  26:     0x7ff78010ea5c - &lt;unknown&gt;
  27:     0x7ff780e466bc - &lt;unknown&gt;
  28:     0x7ffb3de47374 - BaseThreadInitThunk
  29:     0x7ffb3e71cc91 - RtlUserThreadStart
PS R:\1&gt; uv version
uv 0.2.31 (48162de97 2024-07-29)

# python 3.11 works on ramdisk
PS R:\1&gt; python -m venv venv
PS R:\1&gt; ls venv/Scripts/activate
-a----        2024-07-31  05:35 PM           2049 activate
</code></pre>
<p>I am pretty sure that Python's own <code>python -m venv</code> used to have some issues with ramdisks as well - the &quot;must be canonicalized&quot; error message does ring some bells.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-31 13:52</div>
            <div class="timeline-body"><p>This comes from</p>
<p>https://github.com/astral-sh/uv/blob/24859bd3eebfe8fe50b187391e72dab91afb7093/crates/uv-fs/src/path.rs#L13-L18</p>
<p>I'm not sure <em>why</em> it must be canonicalized. Seems like we could allow that to fail... hm.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-07-31 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @zanieb on 2024-07-31 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Artalus">@Artalus</a> on 2025-02-03 15:33</div>
            <div class="timeline-body"><p>Reading through the release notes and <a href="https://github.com/astral-sh/uv/releases/tag/0.5.0"><code>0.5.0</code></a> got my attention with</p>
<blockquote>
<p>Previously, uv canonicalized the path to the Python executable when setting the Python path in created virtual environments. This behavior had several undesirable effects: it would bypass stabilized version directories (as constructed by Homebrew) and it was not consistent with the Python standard library's behavior. Now, uv uses the sys._base_executable path.</p>
</blockquote>
<p>Whether it was #8481 or not, my issue now appears to be fixed with <code>uv 0.5.26</code> installed from Scoop; both <code>uv venv</code> &amp; <code>uv pip install</code> behave as usual.
@zanieb feel free to close this issue and do with it what your workflows require.</p>
<p>Thank you for your work, I adore this little tool ðŸ’š</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-03 15:39</div>
            <div class="timeline-body"><p>Oh great! Thank you!</p>
<p>&lt;3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-02-03 15:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:20 UTC
    </footer>
</body>
</html>
