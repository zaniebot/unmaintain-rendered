<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv index feature will leak credentials to uv.lock - astral-sh/uv #8296</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv index feature will leak credentials to uv.lock</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8296">#8296</a>
        opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a>
        on 2024-10-17 17:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-10-17 17:45</div>
            <div class="timeline-body"><p>Hi,</p>
<p>Maybe I am doing things wrong, but is there a way to use the new index feature without it sending credentials to uv lock?</p>
<p>E.g.: With something like this</p>
<pre><code>[[tool.uv.index]]
name = &quot;ixname&quot;
url = &quot;https://user:password@mynexusrepo.example.com/repository/hosted/simple/&quot;

[tool.uv.sources]
mypackage = { index = &quot;ixname&quot; }

</code></pre>
<p>I will get the user and password on the index name on uv.toml</p>
<pre><code>{ name = &quot;mypackage&quot;, specifier = &quot;==5.4.1&quot;, index = &quot;https://user:password@mynexusrepo.example.com/repository/hosted/simple/&quot; },
</code></pre>
<p>Notice this won't happen to the URL portion, which remains the same after using the new syntax</p>
<pre><code>{ url = &quot;https://mynexusrepo.example.com/repository/hosted/packages/mypackage/5.4.1/...&quot;, hash = &quot;sha256:...&quot; }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-17 17:45</div>
            <div class="timeline-body"><p>Thanks, that's my mistake.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-10-17 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-10-17 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-17 21:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-10-18 12:57</div>
            <div class="timeline-body"><p>Hi @charliermarsh
Thank you for looking into it.
I did try uv 0.4.24 and I get the exact same result.</p>
<p>I believe the credentials should not be added to this portion of the uv lock file.</p>
<pre><code>{ name = &quot;mypackage&quot;, specifier = &quot;==5.4.1&quot;, index = &quot;https://user:password@mynexusrepo.example.com/repository/hosted/simple/&quot; },
</code></pre>
<p>That's why I asked if I am doing something wrong. I tend to have the credentials on dev environment, but then I can supply uv.lock as is (which didn't have credentials on it before) and the client credentials would be different for each one and passed more securely in an env variable, not on the file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-10-18 13:06</div>
            <div class="timeline-body"><p>BTW, I dislike env variables for dev environments because there is no easy cross platform way of making sure all our devs have the same env variables on bash/zsh/powershell/cmd. We end up hooking the virtualenv activate process, but it doesn't work all the time and it would be nice to only use config or dotenv files, if uv could read them.</p>
<p>That being said, would there be a way of passing these credentials other than it be stored on uv.lock, even if by env variables such</p>
<p><code>UV_INDEX_CREDENTIALS_IXNAME=foo:bar</code> ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 13:09</div>
            <div class="timeline-body"><p>Just to confirm, did you remove the <code>uv.lock</code> before locking?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 13:11</div>
            <div class="timeline-body"><p>The second thing you're describing should already be supported: https://docs.astral.sh/uv/configuration/indexes/#providing-credentials</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-10-18 13:35</div>
            <div class="timeline-body"><p>Hi @charliermarsh</p>
<p>Here is a reproductible</p>
<pre><code class="language-bash">$ uv version
uv 0.4.24
$ cat pyproject.toml
[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [
    &quot;requests&gt;=2.32.3&quot;,
]

[[tool.uv.index]]
name = &quot;myindex&quot;
url = &quot;https://redacted:redacted@redacted/repository/pypi-all/simple/&quot;
default = true

[tool.uv.sources]
requests = { index = &quot;myindex&quot; }

$ rm -rf uv.lock
$ uv lock
Resolved 6 packages in 4ms

$ git diff uv.lock
diff --git a/uv.lock b/uv.lock
index 002c212..274dc3d 100644
--- a/uv.lock
+++ b/uv.lock
@@ -103,7 +103,7 @@ dependencies = [
 ]

 [package.metadata]
-requires-dist = [{ name = &quot;requests&quot;, specifier = &quot;&gt;=2.32.3&quot; }]
+requires-dist = [{ name = &quot;requests&quot;, specifier = &quot;&gt;=2.32.3&quot;, index = &quot;https://redacted:redacted@redacted/repository/pypi-all/simple/&quot; }]

</code></pre>
<p>The key here is adding:</p>
<pre><code>[tool.uv.sources]
requests = { index = &quot;myindex&quot; }
</code></pre>
<p>I did a commit before it and one after adding it which is why the difference shows on git diff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-10-18 13:39</div>
            <div class="timeline-body"><blockquote>
<p>The second thing you're describing should already be supported: https://docs.astral.sh/uv/configuration/indexes/#providing-credentials</p>
</blockquote>
<p>Very cool! I see a typo here:</p>
<pre><code>url = &quot;https://public:koala@https://pypi-proxy.corp.dev/simple&quot;
</code></pre>
<p>There is a 2nd https:// in the middle of the url</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 13:40</div>
            <div class="timeline-body"><p>Oops, thank you.</p>
<p>(I'll try that repro in a bit.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2024-10-18 13:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 13:56</div>
            <div class="timeline-body"><p>Ok looks like I missed something here. Will fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 14:58</div>
            <div class="timeline-body"><p>Embarrassingly I had tests for this but the tests had the wrong assertion: https://github.com/astral-sh/uv/pull/8333</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-18 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-18 15:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:38:52 UTC
    </footer>
</body>
</html>
