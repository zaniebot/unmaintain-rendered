<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requesting specific Python version leads to error - astral-sh/uv #11355</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Requesting specific Python version leads to error</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11355">#11355</a>
        opened by <a href="https://github.com/ImahnShekhzadeh">@ImahnShekhzadeh</a>
        on 2025-02-09 14:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ImahnShekhzadeh">@ImahnShekhzadeh</a> on 2025-02-09 14:42</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi,</p>
<p>Following the instructions from <a href="https://docs.astral.sh/uv/concepts/python-versions/#managed-and-system-python-installations">the docs</a>, I'm trying to install Python 3.10.3 as follows:</p>
<pre><code class="language-dockerfile">FROM nvidia/cuda:12.2.2-cudnn8-devel-ubuntu22.04

RUN apt-get update &amp;&amp; apt-get install -y curl ca-certificates git &amp;&amp; \
    apt-get clean &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY setup.py .
COPY pyproject.toml .

# Install `uv` acc. to the instructions https://docs.astral.sh/uv/guides/integration/docker/#installing-uv
ADD https://astral.sh/uv/install.sh /uv-installer.sh
RUN sh /uv-installer.sh &amp;&amp; rm /uv-installer.sh
ENV PATH=&quot;/root/.local/bin/:$PATH&quot;
RUN uv self update &amp;&amp; \
    uv python install 3.10.3 &amp;&amp; \
    uv venv --python 3.10.3 &amp;&amp; \
    uv pip install -e .

# Expose network port
EXPOSE 80

RUN git config --global --add safe.directory /app
</code></pre>
<p>When building the Dockerfile via</p>
<pre><code class="language-bash">docker build -f Dockerfile -t test:0.0.1 .
</code></pre>
<p>and then running the container interactively via</p>
<pre><code class="language-bash">docker run --shm-size 512m --rm -v $(pwd):/app --gpus all -it test:0.0.1 /bin/bash
</code></pre>
<p>and then typing</p>
<pre><code class="language-bash">uv pip list --verbose
</code></pre>
<p>I get the error:</p>
<pre><code>root@482aab32b5fa:/app# uv pip list --verbose
DEBUG uv 0.5.29
DEBUG Searching for default Python interpreter in virtual environments or search path
DEBUG Failed to inspect Python interpreter from virtual environment at `.venv/bin/python3` 
error: Failed to inspect Python interpreter from virtual environment at `.venv/bin/python3`
  Caused by: Python interpreter not found at `/app/.venv/bin/python3`
</code></pre>
<p>The weird thing is that <strong>when not specifyng a minor Python version</strong>, i.e. writing</p>
<pre><code class="language-Dockerfile">RUN uv self update &amp;&amp; \
    uv python install 3.10 &amp;&amp; \
    uv venv --python 3.10 &amp;&amp; \
    uv pip install -e .
</code></pre>
<p>instead, there's no issue with the above command.</p>
<h3>Platform</h3>
<p>Ubuntu 22.04</p>
<h3>Version</h3>
<p>uv 0.5.29</p>
<h3>Python version</h3>
<p>Python 3.10.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ImahnShekhzadeh on 2025-02-09 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-09 18:09</div>
            <div class="timeline-body"><p>Seems odd! I'll tag @zanieb who has the most context here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-09 18:21</div>
            <div class="timeline-body"><p>It looks like you're mounting your working directory with <code>-v $(pwd):/app</code>, this will include the <code>.venv</code> in your current directory which overlaps with the one in the image and is broken because the <code>python3</code> symlink points to an installation that does not exist, hence the error:</p>
<pre><code>error: Failed to inspect Python interpreter from virtual environment at `.venv/bin/python3`
  Caused by: Python interpreter not found at `/app/.venv/bin/python3`
</code></pre>
<p>I don't know why it'd work when you drop the minor version.</p>
<p>You should avoid mounting <code>.venv</code>, either via <code>.dockerignore</code> or as demonstrated via an anonymous volume in https://github.com/astral-sh/uv-docker-example/blob/1c593aa32621eacd0125b55bd8d2796b86e8ea73/run.sh#L11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-02-09 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-02-09 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ImahnShekhzadeh">@ImahnShekhzadeh</a> on 2025-02-09 20:00</div>
            <div class="timeline-body"><p>Yep - adding the <code>.dockerignore</code> file and <code>.venv</code> in it solves the issue.
I first did not specify a minor version, which is why when not specifying a minor version, no error occurred.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ImahnShekhzadeh on 2025-02-09 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davideuler">@davideuler</a> on 2025-06-04 05:46</div>
            <div class="timeline-body"><p>Test if python version can be detected corrected by uv:</p>
<pre><code>/app/.venv/bin/python3 --version
/app/.venv/bin/python3 -c &quot;import sys; print(sys.version); print(sys.executable)&quot;

</code></pre>
<p>In my case, I put a sitecustomize.py at the site-packages directory, which caused the second command output extra line so that uv failed.</p>
<pre><code># /app/.venv/bin/python3 -c &quot;import sys; print(sys.version); print(sys.executable)&quot;
âœ… Gradio v5.31.0 share=True blocking active for 2 components.
3.12.8 (main, Jan 14 2025, 22:38:09) [GCC 6.3.0 20170516]
/app/.venv/bin/python3
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:35:21 UTC
    </footer>
</body>
</html>
