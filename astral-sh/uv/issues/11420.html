<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>installing git repository ignores UV_LINK_MODE, breaks on some filesystems - astral-sh/uv #11420</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>installing git repository ignores UV_LINK_MODE, breaks on some filesystems</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/11420">#11420</a>
        opened by <a href="https://github.com/PhilipVinc">@PhilipVinc</a>
        on 2025-02-11 12:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/PhilipVinc">@PhilipVinc</a> on 2025-02-11 12:53</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I am on a cluster with a distributed filesystem (beefgs) which does not support hard links.
I am trying to install a repository directly, but it fails when symlinking the repository between two locations in the uv cache directory.</p>
<p>I would assume that setting <code>UV_LINK_MODE=symlink</code> or <code>UV_LINK_MODE=copy</code> would fix the error, but it seems that the setting is not applied to the git command in this case</p>
<pre><code class="language-bash">(base) [filippo.vicentini@cholesky-login02 prova2]$ uv init --no-package
Initialized project `prova2`
(base) [filippo.vicentini@cholesky-login02 prova2]$ uv add git+https://github.com/netket/netket
error: Git operation failed
  Caused by: process didn't exit successfully: `/usr/bin/git clone --local /mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/db/292f78b3ecf26bf6 /mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/checkouts/292f78b3ecf26bf6/f1db6bb` (exit status: 128)
--- stdout
Cloning into '/mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/checkouts/292f78b3ecf26bf6/f1db6bb'...

--- stderr
fatal: failed to create link '/mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/checkouts/292f78b3ecf26bf6/f1db6bb/.git/objects/pack/pack-384b576a7a115ef20196172649a6bf2ab2b2ab8e.idx': Operation not permitted
fatal: The remote end hung up unexpectedly
(base) [filippo.vicentini@cholesky-login02 prova2]$ ^C
(base) [filippo.vicentini@cholesky-login02 prova2]$ export UV_LINK_MODE=copy
(base) [filippo.vicentini@cholesky-login02 prova2]$ uv add git+https://github.com/netket/netket
error: Git operation failed
  Caused by: process didn't exit successfully: `/usr/bin/git clone --local /mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/db/292f78b3ecf26bf6 /mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/checkouts/292f78b3ecf26bf6/f1db6bb` (exit status: 128)
--- stdout
Cloning into '/mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/checkouts/292f78b3ecf26bf6/f1db6bb'...

--- stderr
fatal: failed to create link '/mnt/beegfs/home/CPHT/filippo.vicentini/.cache/uv/git-v0/checkouts/292f78b3ecf26bf6/f1db6bb/.git/objects/pack/pack-384b576a7a115ef20196172649a6bf2ab2b2ab8e.idx': Operation not permitted
fatal: The remote end hung up unexpectedly
</code></pre>
<h3>Platform</h3>
<p>Linux 3.10.0-1062.el7.x86_64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.5.30</p>
<h3>Python version</h3>
<p>Python 3.12.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @PhilipVinc on 2025-02-11 12:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-11 13:27</div>
            <div class="timeline-body"><p>Hmm, we'll need to decide whether we want to support this. This is a link <em>within</em> the cache, which is not what <code>UV_LINK_MODE</code> is intended to affect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2025-02-11 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PhilipVinc">@PhilipVinc</a> on 2025-02-11 13:47</div>
            <div class="timeline-body"><p>I just will point out that this kind of filesystem/restriction is relatively common in academic clusters.
If you do not support this, it becomes impossible to install a git repository, which are very common to keep private research code, and we don't necessarily tag/build wheels (it's very hard to setup a private wheel depot).</p>
<p>I hope you'd consider supporting this in some way, as otherwise we'd be forced to use other tools in academic environments.
I find that uv helps students/researchers have a much more reproducible environment, and save them time, so I would hope I can keep pushing for it (but due to #7642 / #1495 it is hard...).</p>
<p>So please, do support this kind of setups!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-11 14:24</div>
            <div class="timeline-body"><p>I think it makes sense to re-try the operation with <code>--no-hardlinks</code> if it fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-02-11 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2025-02-11 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @charliermarsh on 2025-02-11 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2025-02-11 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11421.html">astral-sh/uv#11421</a> on 2025-02-11 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Gankra by @charliermarsh on 2025-02-11 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-12 00:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-12 00:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:25 UTC
    </footer>
</body>
</html>
