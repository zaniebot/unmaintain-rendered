<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`cffi` installed via uv is missing core attributes (`__version__` and `FFI`) - astral-sh/uv #17650</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>cffi</code> installed via uv is missing core attributes (<code>__version__</code> and <code>FFI</code>)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17650">#17650</a>
        opened by <a href="https://github.com/map0logo">@map0logo</a>
        on 2026-01-21 23:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/map0logo">@map0logo</a></div>
            <div class="timeline-body">Problem Description
<p>When installing <code>cffi</code> using <code>uv</code>, the resulting package is incomplete or corrupted, missing essential attributes. This causes <code>AttributeError</code> when trying to access <code>cffi.__version__</code> or <code>cffi.FFI()</code>. The same package installed via <code>pip</code> works correctly.</p>
Steps to Reproduce
<ol>
<li><p>Create a new project directory and initialize with uv:</p>
<pre><code>uv init test-cffi &amp;&amp; cd test-cffi
</code></pre>
</li>
<li><p>Install <code>cffi</code> using uv:</p>
<pre><code>uv add cffi # or uv pip install cffi
</code></pre>
</li>
<li><p>Activate the virtual environment and test:</p>
<pre><code>source .venv/bin/activate
python -c &quot;import cffi; print(cffi.__version__); print(cffi.FFI())&quot;
</code></pre>
</li>
</ol>
<p><strong>Actual Result:</strong> <code>AttributeError</code> for both <code>__version__</code> and <code>FFI</code>.</p>
<pre><code>&gt;&gt;&gt; import cffi
&gt;&gt;&gt; cffi.__version__
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module &#x27;cffi&#x27; has no attribute &#x27;__version__&#x27;
&gt;&gt;&gt; cffi.FFI()
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module &#x27;cffi&#x27; has no attribute &#x27;FFI&#x27;
</code></pre>
<p><strong>Expected Result:</strong> Version string printed and FFI object created successfully (as happens when installed with <code>pip</code>).</p>
Workaround
<pre><code>python -m venv .venv
source .venv/bin/activate
pip install cffi
</code></pre>
<pre><code>&gt;&gt;&gt; import cffi
&gt;&gt;&gt; cffi.__version__
&#x27;2.0.0&#x27;
&gt;&gt;&gt; cffi.FFI()
&lt;cffi.api.FFI object at 0x7f38075cc6e0&gt;
</code></pre>
Additional Information
<p>This appears to be a packaging/installation issue specific to <code>uv</code>, as the standard <code>pip</code> installation works correctly. The problem may be related to how <code>uv</code> handles the package&#x27;s C extensions or metadata.</p>
Platform
<p>Linux 6.6.119-1-MANJARO x86_64 GNU/Linux</p>
Version
<p>0.9.26</p>
Python version
<p>3.12.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/map0logo">@map0logo</a> on 2026-01-21 23:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/map0logo">@map0logo</a> on 2026-01-22 02:25</div>
            <div class="timeline-body"><p>This is not the case at least in Manjaro Linux and Python 3.12</p>
<p>Trying your script:</p>
<pre><code>uv init test-cffi &amp;&amp; cd test-cffi
uv add cffi
echo &quot;# shadow&quot; &gt; cffi.py
uv run python -c &quot;import cffi; print(cffi.__version__)&quot;
</code></pre>
<pre><code>Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module &#x27;cffi&#x27; has no attribute &#x27;__version__&#x27;
</code></pre>
<p>Without shadowing</p>
<pre><code>rm cffi.py
uv run python -c &quot;import cffi; print(cffi.__version__)&quot;
</code></pre>
<p>I got, again</p>
<pre><code>Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: module &#x27;cffi&#x27; has no attribute &#x27;__version__&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-22 03:40</div>
            <div class="timeline-body"><p>The problem is that this isn&#x27;t trivially reproducible</p>
<pre><code>❯ docker run -t astral/uv:bookworm bash -c &#x27;uv init -p 3.12 test-cffi &amp;&amp; cd test-cffi &amp;&amp; uv add cffi &amp;&amp; uv run -p 3.12 python -c &quot;import cffi; print(cffi.__version__); print(cffi.FFI())&quot;&#x27;
Initialized project `test-cffi` at `/test-cffi`
Using CPython 3.12.12
Creating virtual environment at: .venv
Resolved 3 packages in 264ms
Prepared 2 packages in 144ms
Installed 2 packages in 1ms
 + cffi==2.0.0
 + pycparser==3.0
2.0.0
&lt;cffi.api.FFI object at 0xffff9e483560&gt;
</code></pre>
<p>Can you reproduce in a container for us?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-22 03:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-22 03:44</div>
            <div class="timeline-body"><pre><code>❯ cat Dockerfile
FROM archlinux:latest
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/
WORKDIR /app
RUN uv init -p 3.12 test-cffi
WORKDIR /app/test-cffi
RUN uv add cffi
CMD [&quot;uv&quot;, &quot;run&quot;, &quot;-p&quot;, &quot;3.12&quot;, &quot;python&quot;, &quot;-c&quot;, &quot;import cffi; print(cffi.__version__); print(cffi.FFI())&quot;]
❯ docker build --platform linux/amd64 -t test-cffi-arch .
[+] Building 0.2s (12/12) FINISHED                                                       docker:orbstack
 =&gt; [internal] load build definition from Dockerfile                                                0.0s
 =&gt; =&gt; transferring dockerfile: 305B                                                                0.0s
 =&gt; [internal] load metadata for ghcr.io/astral-sh/uv:latest                                        0.1s
 =&gt; [internal] load metadata for docker.io/library/archlinux:latest                                 0.1s
 =&gt; [internal] load .dockerignore                                                                   0.0s
 =&gt; =&gt; transferring context: 2B                                                                     0.0s
 =&gt; FROM ghcr.io/astral-sh/uv:latest@sha256:9a23023be68b2ed09750ae636228e903a54a05ea56ed03a934d00f  0.0s
 =&gt; [stage-0 1/6] FROM docker.io/library/archlinux:latest@sha256:f5add4183c5f05abf3b65489447aee6d5  0.0s
 =&gt; CACHED [stage-0 2/6] COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/                     0.0s
 =&gt; CACHED [stage-0 3/6] WORKDIR /app                                                               0.0s
 =&gt; CACHED [stage-0 4/6] RUN uv init -p 3.12 test-cffi                                              0.0s
 =&gt; CACHED [stage-0 5/6] WORKDIR /app/test-cffi                                                     0.0s
 =&gt; CACHED [stage-0 6/6] RUN uv add cffi                                                            0.0s
 =&gt; exporting to image                                                                              0.0s
 =&gt; =&gt; exporting layers                                                                             0.0s
 =&gt; =&gt; writing image sha256:b14a099148828a240a84faa3b949fc7bd8baa184213e7cf45a5e28ab5ba85c0f        0.0s
 =&gt; =&gt; naming to docker.io/library/test-cffi-arch                                                   0.0s
❯ docker run --platform linux/amd64 -t  test-cffi-arch
2.0.0
&lt;cffi.api.FFI object at 0x7fffff833410&gt;
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-22 04:13:06 UTC
    </footer>
</body>
</html>
