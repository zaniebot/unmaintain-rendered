<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` seems to install using a different Python version than in `requires-python` - astral-sh/uv #6379</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv sync` seems to install using a different Python version than in `requires-python`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6379">#6379</a>
        opened by <a href="https://github.com/krispharper">@krispharper</a>
        on 2024-08-21 21:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/krispharper">@krispharper</a> on 2024-08-21 21:37</div>
            <div class="timeline-body"><p>I'm getting a dependency resolution failure when running <code>uv sync</code> for the first time. This is my <code>pyproject.toml</code>.</p>
<pre><code class="language-toml">[project]
name = &quot;my-project&quot;
version = &quot;1.0.0&quot;
requires-python = &quot; == 3.10.*&quot;
dependencies = [
    &quot;pandas == 1.5.*&quot;,
    &quot;internal-package == 2.*&quot;,
]

[tool.uv]
index-url = &quot;https://internal-artifactory-url&quot;  // I don't think this is relevant, but just in case, I am pulling from a different index.
</code></pre>
<p>The <code>internal-package</code> has a dependency on pandas which varies based on Python version. For <code>python &gt;= 3.12.*</code> it requires <code>pandas &gt;= 2.1.2</code>. For <code>python &lt; 3.12</code>, it requires <code>pandas &lt;= 3.0</code>.</p>
<p>When I run <code>uv sync</code>, this is the output</p>
<pre><code>× No solution found when resolving dependencies for split (python_full_version &gt;= '3.12'):
╰─▶ Because only the following versions of internal-package are available:
        internal-package&lt;2.dev0
        internal-package==2.0.206
        internal-package==2.0.207
        internal-package==2.0.208
    and because internal-package&gt;=2.0.206,&lt;=2.0.207 depends on pandas&gt;=2.1.2, we can conclude that internal-package&gt;=2.dev0,&lt;2.0.208 depends on pandas&gt;=2.1. (1)

    Because only the following versions of pandas{python_full_version &gt;= '3.12'} are available:
        pandas{python_full_version &gt;= '3.12'}&lt;=2.1.4
        pandas{python_full_version &gt;= '3.12'}&gt;=2.2.0
    and internal-package==2.0.208 depends on pandas{python_full_version &gt;= '3.12'}&gt;=2.1.2, we can conclude that internal-package==2.0.208 depends on one of:
        pandas&gt;=2.1.2,&lt;=2.1.4
        pandas&gt;=2.2.0

    And because we know from (1) that internal-package&gt;=2.dev0,&lt;2.0.208 depends on pandas&gt;=2.1, we can conclude that internal-package&gt;=2.dev0 depends on pandas&gt;=2.1.
    And because your project depends on pandas&gt;=1.5.dev0,&lt;1.6.dev0 and internal-package&gt;=2.dev0, we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<p>I am brand new to <code>uv</code>, but from the looks of this error, I think it's assuming Python 3.12 (<code>python_full_version &gt;= '3.12'</code>) instead of Python 3.10 as specified in <code>project.requires-python</code>. Do I need to set Python somewhere else?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 21:42</div>
            <div class="timeline-body"><p>By default we treat <code>requires-python</code> as a lower bound, but you can instruct uv to explicitly ignore higher Python versions with:</p>
<pre><code>[tool.uv]
environments = [&quot;python_version == 3.10&quot;]
</code></pre>
<p>Let me know if that works (or doesn't).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/krispharper">@krispharper</a> on 2024-08-21 21:54</div>
            <div class="timeline-body"><p>Hmm, that gives me</p>
<pre><code>error: Failed to parse: `pyproject.toml`
  Caused by: TOML parse error at line 12, column 16
   |
12 | environments = [&quot;python_version == 3.10&quot;]
   |                ^^^^^^^^^^^^^^^^^^^^^^^^^^
Expected a valid marker name, found '3.10'
python_version == 3.10
                  ^^^^
</code></pre>
<p>I tried <code>environments = [&quot;python_version == 3.10.*&quot;]</code> and <code>environments = [&quot;python_version == 3.10.10&quot;]</code> as well with the same results.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 21:56</div>
            <div class="timeline-body"><p>Gah, sorry: <code>environments = [&quot;python_version == '3.10'&quot;]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/krispharper">@krispharper</a> on 2024-08-21 21:59</div>
            <div class="timeline-body"><p>Nice, that worked perfectly. Thanks a bunch for your help @charliermarsh.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @krispharper on 2024-08-21 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 22:00</div>
            <div class="timeline-body"><p>No problem, glad to hear it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-08-21 22:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:47:37 UTC
    </footer>
</body>
</html>
