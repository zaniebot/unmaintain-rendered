<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv cache populate / export cache - astral-sh/uv #6323</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv cache populate / export cache</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/6323">#6323</a>
        opened by <a href="https://github.com/adriangb">@adriangb</a>
        on 2024-08-21 12:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adriangb">@adriangb</a> on 2024-08-21 12:34</div>
            <div class="timeline-body"><p>It would be nice to have the ability to pre-cache dependencies. In particular I would find this useful in a monorepo context to:</p>
<ol>
<li>Have a docker layer where I populate the cache with all dependencies.</li>
<li>In another service specific layer I do a <code>--cache-from</code> or similar from this cache layer and tell <code>uv</code> to use the cache that was built in that layer.</li>
</ol>
<p>This is important because if I have services with the following deps:</p>
<pre><code>tensorflow
some-small-package
</code></pre>
<p>And</p>
<pre><code>tensorflow
some-other-small-package
</code></pre>
<p>If I don't have a &quot;common&quot; step where I download <code>tensorflow</code> I'd end up downloading it twice (once for each service) which is wasteful. Yes you can parallelize it but IMO efficient serial &gt;&gt; inefficient parallel.</p>
<p>Alternatively something like https://github.com/python-poetry/poetry/issues/5983 and functionality in uv to populate that folder of wheels could do the trick.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cache</span> added by @charliermarsh on 2024-08-21 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @charliermarsh on 2024-08-21 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 13:35</div>
            <div class="timeline-body"><p>What's the typical mechanism that you'd use to ensure that those two layers use the same TensorFlow version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adriangb">@adriangb</a> on 2024-08-21 14:14</div>
            <div class="timeline-body"><p>Currently it's a PITA with all package managers that I know of that support monorepos.</p>
<p>Hence why I think something like:</p>
<pre><code>FROM python:3.12-slim-bullseye AS deps
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/uv
COPY uv.lock .
RUN --mount=type=cache,target=/root/.cache/uv \
  uv cache populate

FROM python:3.12-slim-bullseye AS service
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/uv
COPY . /app
RUN --mount=from=deps,source=/root/.cache/uv,target=/root/.cache/uv \
  uv install --package service
</code></pre>
<p>Would be nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-21 23:50</div>
            <div class="timeline-body"><p>I'd say this is similar in the venue/spirit of https://github.com/astral-sh/uv/issues/1681 / https://github.com/astral-sh/uv/issues/3163 as populating the cache will involve downloading and possibly a build step which is a common workflow achieved with pip wheel or download.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9345.html">astral-sh/uv#9345</a> on 2024-11-22 05:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
