<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI not being found in PATH after installing with uv in a Docker container - astral-sh/uv #10615</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>FastAPI not being found in PATH after installing with uv in a Docker container</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10615">#10615</a>
        opened by <a href="https://github.com/carrollpaul">@carrollpaul</a>
        on 2025-01-14 22:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/carrollpaul">@carrollpaul</a> on 2025-01-14 22:38</div>
            <div class="timeline-body"><p>I'm attempting to use <code>uv</code> with Docker for my hobby project. I'm following yall's <a href="https://docs.astral.sh/uv/guides/integration/docker/">guide</a> and copied the Dockerfile from the <a href="https://github.com/astral-sh/uv-docker-example">example project</a> (with the exception of changing the <code>CMD</code> to use &quot;main&quot;):</p>
<pre><code class="language-Dockerfile"># Dockerfile

FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim AS builder
ENV UV_COMPILE_BYTECODE=1 UV_LINK_MODE=copy
WORKDIR /app
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev
ADD . /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

FROM python:3.12-slim-bookworm

# Copy the application from the builder
COPY --from=builder --chown=app:app /app /app

# Place executables in the environment at the front of the path
ENV PATH=&quot;/app/.venv/bin:$PATH&quot;

# Run the FastAPI application by default
CMD [&quot;fastapi&quot;, &quot;dev&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;main&quot;]
</code></pre>
<p>Here's my <code>pyproject.toml</code>:</p>
<pre><code class="language-pyproject.toml">[project]
name = &quot;backend&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
    &quot;fastapi[standard]&gt;=0.115.6&quot;,
    &quot;pydantic-settings&gt;=2.7.1&quot;,
    &quot;sqlalchemy&gt;=2.0.37&quot;,
    &quot;uvicorn&gt;=0.34.0&quot;,
    &quot;websockets&gt;=14.1&quot;,
]

[dependency-groups]
dev = [&quot;pytest&gt;=8.3.4&quot;]

[tool.uv]
dev-dependencies = [&quot;ruff&gt;=0.6.2&quot;, &quot;fastapi-cli&gt;=0.0.5&quot;]
</code></pre>
<pre><code class="language-docker-compose.yaml"># docker-compose.yaml
services:
  backend:
    build:
      context: ./backend
    ports:
      - &quot;1234:8000&quot; # FastAPI app
      - &quot;8080:8080&quot; # TCP server
      - &quot;8765:8765&quot; # WebSocket server
    develop:
      watch:
        # Sync the working directory with the `/app` directory in the container
        - action: sync
          path: ./backend
          target: /app
          ignore:
            - ./backend/.venv/

        # Rebuild the image on changes to the `pyproject.toml`
        - action: rebuild
          path: ./pyproject.toml
    volumes:
      - ./backend/app:/app
    logging:
      driver: &quot;json-file&quot;
      options:
        max-size: &quot;200k&quot;
        max-file: &quot;10&quot;

  frontend:
    build:
      context: ./frontend
    ports:
      - &quot;1235:80&quot;
    volumes:
      - ./frontend:/usr/share/nginx/html
</code></pre>
<p>My project structure looks like this:</p>
<pre><code>.
├── backend
│   ├── main.py
│   ├── Dockerfile
│   ├── pyproject.toml
│   ├── uv.lock
│   ├── app
│   │   ├──etc...
├── frontend
│   ├── etc...
| docker-compose.yaml
| README.md
</code></pre>
<p><code>main.py</code> contains the FastAPI <code>app</code>.</p>
<p>From the root of the project I execute <code>docker compose up</code> and get this error:</p>
<blockquote>
<p>Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: &quot;fastapi&quot;: executable file not found in $PATH: unknown</p>
</blockquote>
<p>Not sure if this is a bug or a me problem (probably the latter).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 22:45</div>
            <div class="timeline-body"><p>Is the problem that you're mounting a volume over the image's virtual environment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 22:46</div>
            <div class="timeline-body"><p>Some commentary on that in https://docs.astral.sh/uv/guides/integration/docker/#developing-in-a-container and https://github.com/astral-sh/uv-docker-example/blob/a14ebc89e3a5e5b33131284968d8969ae054ed0d/run.sh#L11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carrollpaul">@carrollpaul</a> on 2025-01-14 22:49</div>
            <div class="timeline-body"><p>Ah, that seems to have something to do with it. Removing the <code>backend</code> volume from the docker-compose led to a new, separate error:</p>
<pre><code>backend-1 exited with code 1
2025-01-14 17:47:02 exec /app/.venv/bin/fastapi: no such file or directory
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 22:51</div>
            <div class="timeline-body"><p>That error usually indicates the <code>python</code> executable referenced by the virtual environment has moved and can't be found. Opaque I know, but this is the Python shebang for installing package entrypoints and we have little control. Try <code>cat /app/.venv/bin/fastapi</code> to see what it's looking for (or, if that's missing entirely I've misdiagnosed the problem).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carrollpaul">@carrollpaul</a> on 2025-01-14 22:56</div>
            <div class="timeline-body"><pre><code>backend-1   | #!/app/.venv/bin/python
backend-1   | # -*- coding: utf-8 -*-
backend-1   | import re
backend-1   | import sys
backend-1   | from fastapi.cli import main
backend-1   | if __name__ == &quot;__main__&quot;:
backend-1   |     sys.argv[0] = re.sub(r&quot;(-script\.pyw|\.exe)?$&quot;, &quot;&quot;, sys.argv[0])
backend-1   |     sys.exit(main())
backend-1 exited with code 0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 22:58</div>
            <div class="timeline-body"><p>Then <code>ls -la /app/.venv/bin/python</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carrollpaul">@carrollpaul</a> on 2025-01-14 23:01</div>
            <div class="timeline-body"><pre><code>2025-01-14 18:00:30 lrwxrwxrwx 1 root root 76 Jan 14 23:00 /app/.venv/bin/python -&gt; /root/.local/share/uv/python/cpython-3.10.16-linux-x86_64-gnu/bin/python3.10
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 23:10</div>
            <div class="timeline-body"><p>It looks like that's referring to a uv-managed interpreter, I presume it's missing and that you want to be using the python3.12 interpreter that comes with your image?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-01-14 23:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carrollpaul">@carrollpaul</a> on 2025-01-14 23:14</div>
            <div class="timeline-body"><p>Yes, that's correct</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 23:17</div>
            <div class="timeline-body"><p>It's not clear from your example why that would not be the case. Is the <code>.venv</code> in your <code>dockerignore</code> file too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carrollpaul">@carrollpaul</a> on 2025-01-14 23:20</div>
            <div class="timeline-body"><p>Ah, I had a <code>.python-version</code> file in my project with <code>3.10</code> for some reason. Removing that seems to get things working!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 23:22</div>
            <div class="timeline-body"><p>Wonderful! Feel free to ask if you have more problems.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-14 23:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carrollpaul">@carrollpaul</a> on 2025-01-14 23:26</div>
            <div class="timeline-body"><p>Thanks for your patience and assistance!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11454.html">astral-sh/uv#11454</a> on 2025-02-12 17:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:25 UTC
    </footer>
</body>
</html>
