<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unable to install `mamba-ssm` with uv - astral-sh/uv #4354</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unable to install `mamba-ssm` with uv</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4354">#4354</a>
        opened by <a href="https://github.com/kszlim">@kszlim</a>
        on 2024-06-17 02:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kszlim">@kszlim</a> on 2024-06-17 02:42</div>
            <div class="timeline-body"><pre><code class="language-shell"># in an environment with all mamba-ssm requirements installed, cuda, torch, etc.
uv pip install mamba-ssm # will fail
</code></pre>
<p>uv version:
uv 0.2.11 on linux</p>
<p>Error:</p>
<pre><code>uv pip install mamba-ssm
⠙ mamba-ssm==2.0.4                                                                                                                                                                                                                                            error: Failed to download and build `mamba-ssm==2.0.4`
  Caused by: Failed to build: `mamba-ssm==2.0.4`
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/path/to/home/.cache/uv/environments-v0/.tmpnxysd8/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 325, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=['wheel'])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/path/to/home/.cache/uv/environments-v0/.tmpnxysd8/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 295, in _get_build_requires
    self.run_setup()
  File &quot;/path/to/home/.cache/uv/environments-v0/.tmpnxysd8/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 487, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/path/to/home/.cache/uv/environments-v0/.tmpnxysd8/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
ModuleNotFoundError: No module named 'packaging'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Unable to install mamba-ssm with uv" to "Unable to install `mamba-ssm` with uv" by @kszlim on 2024-06-17 02:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kidrahahjo">@kidrahahjo</a> on 2024-06-17 03:15</div>
            <div class="timeline-body"><p>I get a similar error when I try to install with pip directly, I suspect this is unrelated to uv. But I will let the maintainers suggest</p>
<p><img src="https://github.com/astral-sh/uv/assets/44747868/0b4ffb32-da25-4e4e-95eb-0110ca1d5985" alt="image" /></p>
<p>[Update]</p>
<p>When I manually install <code>packaging</code>, <code>pip</code> works but <code>uv</code> still can't resolve packaging</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kszlim">@kszlim</a> on 2024-06-17 04:06</div>
            <div class="timeline-body"><p>I've managed to get it installed with pip before, it does require that you pip install packaging first though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-17 09:01</div>
            <div class="timeline-body"><p>For packages like this one that doesn't declare its build dependencies, you need to install <code>packaging</code> manually and use <code>--no-build-isolation</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2024-06-17 09:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/1518.html">prefix-dev/pixi#1518</a> on 2024-06-17 09:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kszlim">@kszlim</a> on 2024-06-17 09:14</div>
            <div class="timeline-body"><p>@konstin I believe that <code>packaging</code> is declared as a build dep <a href="https://github.com/state-spaces/mamba/blob/main/setup.py#L277">here</a>? But I could be misunderstanding.</p>
<p>Using uv as you've directed did manage to work for me, however, I'm trying to get it to work with <code>pixi</code>, which might need some work upstream. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-17 09:50</div>
            <div class="timeline-body"><p>The <code>install_requires</code> are declared at the bottom of the <code>setup.py</code>, but <code>packaging</code> is imported at the top, before we get to <code>install_requires</code>. The solution is to add a <code>pyproject.toml</code> with a <code>[build-system]</code> table so uv can install the dependencies of <code>setup.py</code> before running <code>setup.py</code>. You can find more information on build backends <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/#declaring-the-build-backend">here</a>, many more details about the <code>build-system</code> vs. <code>setup.py</code> and how <code>pyproject.toml</code> solves it are described in <a href="https://peps.python.org/pep-0517/">PEP 517</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-17 10:42</div>
            <div class="timeline-body"><p>See #2252 — build isolation will become the default in pip in the future too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-06-18 07:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:29 UTC
    </footer>
</body>
</html>
