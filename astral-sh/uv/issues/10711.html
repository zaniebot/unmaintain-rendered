<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`No interpreter found in search path` on nixOS - astral-sh/uv #10711</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`No interpreter found in search path` on nixOS</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/10711">#10711</a>
        opened by <a href="https://github.com/turbotimon">@turbotimon</a>
        on 2025-01-17 14:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/turbotimon">@turbotimon</a> on 2025-01-17 14:28</div>
            <div class="timeline-body"><h3>Problem</h3>
<p>It is unclear to me, why <code>uv venv</code> does not find Python 3.12 in the system path. <a href="https://docs.astral.sh/uv/concepts/python-versions/#discovery-of-python-versions">Discover of Python version</a> claims its will look in PATH. And <code>uv python find</code> does find it.</p>
<pre><code class="language-sh">$ uv venv
  × No interpreter found in search path
</code></pre>
<h3>But it should work..</h3>
<p>Here is what other commands find:</p>
<pre><code class="language-sh">$ python --version
Python 3.12.7

$ which python
/etc/profiles/per-user/erti/bin/python
# context: it's a symlink to /nix/store/542jax1lz8sfq1gqk2wrdskr334sswnx-python3-3.12.7-env/bin/python3.12

$ echo $PATH
...:/etc/profiles/per-user/erti/bin:...

$ uv python find
/nix/store/542jax1lz8sfq1gqk2wrdskr334sswnx-python3-3.12.7-env/bin/python3.12
</code></pre>
<p>(yes, i'm using nixOS)</p>
<h3>Context</h3>
<p>My config is</p>
<pre><code class="language-sh">$ cat ~/.config/uv/uv.toml
python-preference = &quot;only-system&quot;
python-downloads = &quot;manual&quot;
</code></pre>
<p>uv version is: 0.5.18</p>
<h3>Workaround</h3>
<p>This works however</p>
<pre><code class="language-sh">uv venv --python $(which python)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Question/BUG? `No interpreter found for Python 3.12 in system path`" to "Question/BUG? `No interpreter found in search path`" by @turbotimon on 2025-01-17 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Question/BUG? `No interpreter found in search path`" to "BUG? `No interpreter found in search path`" by @turbotimon on 2025-01-17 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-17 15:18</div>
            <div class="timeline-body"><p>Can you include the logs with <code>--verbose</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-01-17 15:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/turbotimon">@turbotimon</a> on 2025-01-20 09:07</div>
            <div class="timeline-body"><p>@charliermarsh sure:</p>
<pre><code class="language-sh">$ uv --verbose venv
DEBUG uv 0.5.18
DEBUG Searching for default Python interpreter in search path
DEBUG Found `cpython-3.12.8-linux-x86_64-gnu` at `/etc/profiles/per-user/erti/bin/python` (search path)
DEBUG Ignoring Python interpreter at `/nix/store/qdfm0sbv1fbribr90bakk3nizl32jc4s-python3-3.12.8-env/bin/python3.12`: system interpreter required
DEBUG Found `cpython-3.12.8-linux-x86_64-gnu` at `/etc/profiles/per-user/erti/bin/python3` (search path)
DEBUG Ignoring Python interpreter at `/nix/store/qdfm0sbv1fbribr90bakk3nizl32jc4s-python3-3.12.8-env/bin/python3.12`: system interpreter required
DEBUG Found `cpython-3.12.8-linux-x86_64-gnu` at `/etc/profiles/per-user/erti/bin/python3.12` (search path)
DEBUG Ignoring Python interpreter at `/nix/store/qdfm0sbv1fbribr90bakk3nizl32jc4s-python3-3.12.8-env/bin/python3.12`: system interpreter required
  × No interpreter found in search path

$ uv python find --verbose
DEBUG uv 0.5.18
DEBUG Searching for default Python interpreter in virtual environments or search path
DEBUG Found `cpython-3.12.8-linux-x86_64-gnu` at `/etc/profiles/per-user/erti/bin/python` (search path)
/nix/store/qdfm0sbv1fbribr90bakk3nizl32jc4s-python3-3.12.8-env/bin/python3.12
</code></pre>
<p>Why does it not count as a system interpreter? With the <code>python-preference</code> setting, I can only distinguish between <strong>system</strong> and <strong>managed</strong> (but not something like <strong>search path</strong>). Managed won't work on nixOS, so it needs to be the interpreter found in PATH.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jneem">@jneem</a> on 2025-03-13 13:21</div>
            <div class="timeline-body"><p>I'm having this same issue with uv 0.6.5. Reverting to 0.4.30 has fixed it for me; I haven't yet tried pinning down which version caused the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GrafBlutwurst">@GrafBlutwurst</a> on 2025-03-13 14:21</div>
            <div class="timeline-body"><blockquote>
<p>I'm having this same issue with uv 0.6.5. Reverting to 0.4.30 has fixed it for me; I haven't yet tried pinning down which version caused the issue.</p>
</blockquote>
<p>I pinned uv to 0.5.31 found in nixpkgs rev <code>1128e89fd5e11bb25aedbfc287733c6502202ea9</code> which solved this issue for me as well.  Some commands like <code>uv venv</code> require me to specify python explicitly with <code>uv venv --python $(which python)</code> because otherwise it wont pick up my nix python installs on PATH.</p>
<pre><code>DEBUG uv 0.5.31
DEBUG Found project root: `/home/grafblutwurst/projects/rivero/workbench/artificial_intelligence/cloned/lingvo`
DEBUG Found workspace root: `/home/grafblutwurst/projects/rivero/workbench/artificial_intelligence/cloned/lingvo`
DEBUG Adding current workspace member: `/home/grafblutwurst/projects/rivero/workbench/artificial_intelligence/cloned/lingvo`
DEBUG Adding discovered workspace member: `/home/grafblutwurst/projects/rivero/workbench/artificial_intelligence/cloned/lingvo/packages/lingvo-core`
DEBUG Adding discovered workspace member: `/home/grafblutwurst/projects/rivero/workbench/artificial_intelligence/cloned/lingvo/packages/lingvo-document`
DEBUG Adding discovered workspace member: `/home/grafblutwurst/projects/rivero/workbench/artificial_intelligence/cloned/lingvo/packages/lingvo-models`
DEBUG Using Python request `&gt;=3.11, &lt;4.0` from `requires-python` metadata
DEBUG Searching for Python &gt;=3.11, &lt;4.0 in search path
DEBUG Found `cpython-3.12.8-linux-x86_64-gnu` at `/nix/store/8abfng9bp44yw359xw29dmv70hffyb63-python3-3.12.8-env/bin/python3` (first executable in the search path)
DEBUG Ignoring Python interpreter at `/nix/store/8abfng9bp44yw359xw29dmv70hffyb63-python3-3.12.8-env/bin/python3.12`: system interpreter required
DEBUG Found `cpython-3.12.8-linux-x86_64-gnu` at `/nix/store/8abfng9bp44yw359xw29dmv70hffyb63-python3-3.12.8-env/bin/python` (search path)
DEBUG Ignoring Python interpreter at `/nix/store/8abfng9bp44yw359xw29dmv70hffyb63-python3-3.12.8-env/bin/python3.12`: system interpreter required
DEBUG Found `cpython-3.12.8-linux-x86_64-gnu` at `/nix/store/8abfng9bp44yw359xw29dmv70hffyb63-python3-3.12.8-env/bin/python3.12` (search path)
DEBUG Ignoring Python interpreter at `/nix/store/8abfng9bp44yw359xw29dmv70hffyb63-python3-3.12.8-env/bin/python3.12`: system interpreter required
  × No interpreter found for Python &gt;=3.11, &lt;4.0 in search path
</code></pre>
<p>(I have set uv to require only-system python installs). I suspect uv only accepts certain path patterns as &quot;system&quot; install locations? but I haven't figured out which ones yet</p>
<p>Other commands like <code>uv run ruff</code> fail outright due to dynamic linking. That's not an issue if just added ruff directly in my nix dev environment and that seems to do the trick.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-13 14:36</div>
            <div class="timeline-body"><p>There's relevant discussion in</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/11529</li>
<li>https://github.com/astral-sh/uv/issues/4450</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "BUG? `No interpreter found in search path`" to "`No interpreter found in search path` on nixOS" by @zanieb on 2025-03-13 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/turbotimon">@turbotimon</a> on 2025-03-13 17:07</div>
            <div class="timeline-body"><p>So, the solution for nixos appears to set <code>export UV_PYTHON=$(which python)</code> (or better in your <code>shell.nix</code>)</p>
<p>But then, the uv docs are wrong, isn't it? @zanieb  So even not a BUG in the code, still a BUG in the docs?</p>
<blockquote>
<p>When searching for a Python version, the following locations are checked:
- A Python interpreter on the PATH as python, python3, or python3.x on macOS and Linux, or python.exe on Windows.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-16 01:32</div>
            <div class="timeline-body"><p>We don't allow creating a virtual environment from an interpreter discovered in a virtual environment. This is bypassed by setting <code>UV_PYTHON</code> directly. This detail is not relevant for most consumers, and is documented in the <a href="https://docs.astral.sh/uv/reference/cli/#uv-venv--python">CLI reference</a> (i.e., <code>uv help venv</code>). We could highlight it elsewhere with a note about Nix. I'm not sure what the ideal solution is yet though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1495.html">astral-sh/uv#1495</a> on 2025-03-16 02:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jneem">@jneem</a> on 2025-03-16 08:47</div>
            <div class="timeline-body"><p>Personally, I don't think there needs to be a Nix-specific note: I'm fine with looking in Nix-specific spaces for Nix-specific documentation. I think the part that tripped me up was that the documentation isn't clear on what a &quot;system&quot; python is. In particular, the help text for <code>--python-preference</code> flag suggests that python installations can either be &quot;uv-managed&quot; or &quot;system&quot;. Since <code>/nix/store/wz0j2zi02rvnjiz37nn28h3gfdq61svz-python3-3.12.9</code> definitely isn't uv-managed, I was expecting it to count as a &quot;system&quot; python.</p>
<p>I'm not sure what the best way to address this is. It's probably not worth going into lots of detail about how <code>--python-preference</code> is implemented. Maybe it's better to discuss the interaction between <code>--python</code> and <code>--python-preference</code> instead?</p>
<p>I just went back to <code>uv help init</code> and I think one contributing factor was that the <code>--python</code> docs were very specific about what that python was used for: &quot;The Python interpreter to use to determine the minimum supported Python version.&quot; but the <code>--python-preference</code> docs were more vague: &quot;Whether to prefer uv-managed or system Python installations.&quot; I probably skipped over <code>--python</code> in favor of <code>--python-preference</code> because configuring the interpreter &quot;in general&quot; for my project sounded better than just specifying the minimum supported python version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-16 14:24</div>
            <div class="timeline-body"><p>Yeah it's an open problem to change the &quot;managed&quot; vs &quot;system&quot; language to avoid conflation with the &quot;virtual&quot; vs &quot;system&quot; concept. I think we just need to change some names, but it's lower priority (than some other workflow problems) as it's a more advanced use-case.</p>
<p>Just to be clear here:</p>
<p>The <code>--python-preference</code> determines which interpreter installation sources are allowed. <code>managed</code> is a uv-installed interpreter. <code>system</code> is any other discovered interpreter on the system.'</p>
<p>https://github.com/astral-sh/uv/blob/ef38ffbbfa43d3ba374621711c8f06045d5f2c38/crates/uv-python/src/discovery.rs#L73-L88</p>
<p>Separately, when discovering interpreters, uv separates Python interpreters found in a complete installation environment from those found in virtual environments. Interpreters in virtual environments are links to a complete environment and have some differences in behavior. Internally, we track this as an &quot;environment preference&quot;:</p>
<p>https://github.com/astral-sh/uv/blob/ef38ffbbfa43d3ba374621711c8f06045d5f2c38/crates/uv-python/src/discovery.rs#L129-L139</p>
<p>which you see in that log</p>
<p>https://github.com/astral-sh/uv/blob/ef38ffbbfa43d3ba374621711c8f06045d5f2c38/crates/uv-python/src/discovery.rs#L712-L718</p>
<p>The names here match the <code>--system</code> flag of a <code>pip install</code> operation which ignores virtual environments.</p>
<p>Hopefully that helps, obviously the names could be clearer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/turbotimon">@turbotimon</a> on 2025-03-17 11:00</div>
            <div class="timeline-body"><p>Completely agree with this sentence from <em>jneem</em> and the rest of his comment:</p>
<blockquote>
<p>Personally, I don't think there needs to be a Nix-specific note: I'm fine with looking in Nix-specific spaces for Nix-specific documentation. I think the part that tripped me up was that the documentation isn't clear on what a &quot;system&quot; python is.</p>
</blockquote>
<p>And this sentence from <em>zanieb</em> explains it quite well and way just what I missed in the docs:</p>
<blockquote>
<p>... uv separates Python interpreters found in a complete installation environment from those found in virtual environments. Interpreters in virtual environments are links to a complete environment ..</p>
</blockquote>
<p>In my opinion, the solution is to add a note similar to my proposal below to the <a href="https://docs.astral.sh/uv/concepts/python-versions/#discovery-of-python-versions">docs</a> and cli help texts. (At least it would have prevented me from creating this issue and hopefully does so for other users too):</p>
<p>```Note: uv only considers Python interpreters found in a complete installation environment as system interpreters. Links to complete environments, such as those found in virtual environments are ignored.  This can be bypassed by setting <code>UV_PYTHON</code> directly.``</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7395.html">astral-sh/uv#7395</a> on 2025-03-25 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarSoft">@MarSoft</a> on 2025-03-25 16:41</div>
            <div class="timeline-body"><p>@turbotimon, just exporting <code>UV_PYTHON</code> doesn't work as expected because it overrides the Python used even if a virtualenv is active. So this would make it impossible to use e.g. <code>uv pip install</code>.
Here is an example:</p>
<pre><code>[/tmp/env1]$ UV_PYTHON=/nix/store/lhpwdis5hkyljz1d200bj1s6g51ljq9k-python3-3.12.8/bin/python uv venv
Using CPython 3.12.8 interpreter at: /nix/store/lhpwdis5hkyljz1d200bj1s6g51ljq9k-python3-3.12.8/bin/python
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
[/tmp/env1]$ source .venv/bin/activate
(env1) [/tmp/env1]$ UV_PYTHON=/nix/store/lhpwdis5hkyljz1d200bj1s6g51ljq9k-python3-3.12.8/bin/python uv pip install pip
Using Python 3.12.8 environment at /nix/store/lhpwdis5hkyljz1d200bj1s6g51ljq9k-python3-3.12.8
error: The interpreter at /nix/store/lhpwdis5hkyljz1d200bj1s6g51ljq9k-python3-3.12.8 is externally managed, and indicates the following:

  This command has been disabled as it tries to modify the immutable
  `/nix/store` filesystem.

  To use Python with Nix and nixpkgs, have a look at the online documentation:
  &lt;https://nixos.org/manual/nixpkgs/stable/

Consider creating a virtual environment with `uv venv`.
(env1) [/tmp/env1]$ which python
/tmp/env1/.venv/bin/python
(env1) [/tmp/env1]$ uv pip install pip
Resolved 1 package in 182ms
Installed 1 package in 13ms
 + pip==25.0.1
(env1) [/tmp/env1]$ 
</code></pre>
<p>I found another solution which worked for me: I've added the desired &quot;clean&quot; python to the end of my $PATH (using <code>.bashrc</code>):</p>
<pre><code>export UV_PYTHON_PREFERENCE=only-system 
export PATH=&quot;$PATH:$(python -c 'import sys; print(sys.base_prefix)')/bin&quot;
</code></pre>
<p>As a result, <code>uv</code> ignores the &quot;env&quot; Python variant from <code>/run/current_system/sw/bin</code> and correctly finds the &quot;clean&quot; one.
Python's native <code>venv</code> does not have this problem because it uses <code>sys._base_executable</code> to find out the real Python, while <code>nixos</code> uses its own venv &quot;flavour&quot; with a wrapper binary (not a symlink).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iwinux">@iwinux</a> on 2025-06-17 06:14</div>
            <div class="timeline-body"><p>More issues with <code>uv python pin --global /path/to/nix/store</code>:</p>
<p><code>uv python find</code>: OK</p>
<pre><code class="language-sh">$ uv python find --verbose
DEBUG uv 0.7.13
DEBUG Found project root: `/home/limbo/Source/Self/uv-test`
DEBUG No workspace root found, using project root
DEBUG No Python version file found in workspace: /home/limbo/Source/Self/uv-test
DEBUG Reading Python requests from version file at `/home/limbo/.config/uv/.python-version`
DEBUG Using Python request `/nix/store/qrc496n6fsqp4p5m5h8wmw5d5jwyw5mr-python3-3.12.8/bin/python3` from version file at `/home/limbo/.config/uv/.python-version`
DEBUG Checking for Python interpreter at path `/nix/store/qrc496n6fsqp4p5m5h8wmw5d5jwyw5mr-python3-3.12.8/bin/python3`
/nix/store/qrc496n6fsqp4p5m5h8wmw5d5jwyw5mr-python3-3.12.8/bin/python3
</code></pre>
<p>However, <code>uv tool run</code> or <code>uvx</code> cannot find it. Why doesn't it read <code>~/.config/uv/.python-version</code>?</p>
<pre><code class="language-sh">$ uvx --verbose httpie
DEBUG uv 0.7.13
DEBUG Searching for default Python interpreter in managed installations or search path
DEBUG Searching for managed installations at `/home/limbo/.local/share/uv/python`
error: No interpreter found in managed installations or search path
</code></pre>
<p>Ideally there should be a way to tell uv where to find the Nix-managed Python 3 without exposing <code>python3</code> to <code>PATH</code>.</p>
<p>Related issues:</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/13577</li>
<li>https://github.com/astral-sh/uv/issues/12921</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-17 14:10</div>
            <div class="timeline-body"><blockquote>
<p>However, uv tool run or uvx cannot find it. Why doesn't it read</p>
</blockquote>
<p>I think that's just a bug / oversight.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:58 UTC
    </footer>
</body>
</html>
