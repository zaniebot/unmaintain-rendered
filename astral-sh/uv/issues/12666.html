<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strange behavior with tools.uv.sources and tools.uv.index - astral-sh/uv #12666</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Strange behavior with tools.uv.sources and tools.uv.index</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12666">#12666</a>
        opened by <a href="https://github.com/khaume">@khaume</a>
        on 2025-04-04 09:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/khaume">@khaume</a></div>
            <div class="timeline-body">Summary
<p>I&#x27;m experimenting with using our private package repository for certain packages.</p>
<p><code>pyproject.toml</code> file:</p>
<pre><code>dependencies = [
    &quot;private_package&gt;=2.7&quot;
]

[tool.uv.sources]
private_package = { index = &quot;IndexName&quot; }

[[tool.uv.index]]
name = &quot;IndexName&quot;
url = &quot;https://pkgs.dev.azure.com/company/_packaging/ArtifactName/pypi/simple/&quot;
explicit = true
</code></pre>
<p>when running <code>uv sync</code>, it complains about authorization unless I add the environment variables <code>UV_INDEX_INDEXNAME_NAME</code> and <code>UV_INDEX_INDEXNAME_PASSWORD</code>, just as expected (based on <a href="https://github.com/astral-sh/uv/issues/6421#issuecomment-2427738561">this discussion</a>) even though <code>UV_INDEX</code> is defined with a full user:password index url.
If deleting the specific tool.uv.sources and .index, it works by using the <code>UV_INDEX</code> env var to authorize (also as expected).</p>
<p>However, when I build a Docker image and run <code>uv sync</code> in the build instruction, it works when having defined <code>UV_INDEX</code>, i.e., it does not require <code>UV_INDEX_INDEXNAME_NAME</code> and <code>UV_INDEX_INDEXNAME_PASSWORD</code>.</p>
<p>This is also the case when running the resulting docker image.. Inside the container I can do <code>uv add private_package -U</code> without having the specific environment variables defined. It works if just <code>UV_INDEX</code> is defined.</p>
<p>Is this a windows/ubuntu issue or am I missing something?</p>
Platform
<p>Windows 11 / Linux 5.15</p>
Version
<p>uv 0.6.12 (e4e03833f 2025-04-02)</p>
Python version
<p>Python 3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/khaume">@khaume</a> on 2025-04-04 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-04 12:43</div>
            <div class="timeline-body"><p>Hmm, I would expect all of those flows to work if you <em>just</em> provided <code>UV_INDEX</code> with the credentials (even though <code>UV_INDEX_INDEXNAME_NAME</code> would be preferable). I wonder why it&#x27;s <em>not</em> working when running <code>uv sync</code> on your own machine? Can you share the <code>-v</code> (verbose) logs, and redact any credentials?</p>
<p>The problem with using <code>UV_INDEX</code> instead of the credential variables is that it basically defines an entirely separate index <em>without</em> <code>explicit = true</code>, so <em>other</em> packages will <em>also</em> use that index (not just <code>private_package</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-04 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-04 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/khaume">@khaume</a> on 2025-04-04 19:15</div>
            <div class="timeline-body"><p>Testing once again, I can confirm that if the <code>tool.uv.sources</code> and <code>.index</code> are defined in <code>pyproject.toml</code> then it does not work if the specific index env vars are not set, even though <code>UV_INDEX</code> is set.</p>
<p>If I remove the <code>tool.uv.sources</code> and <code>.index</code> parts of the <code>pyproject.toml</code> file, then it does work with <code>UV_INDEX</code>.</p>
<p>Here is the verbose output</p>
<pre><code>(venv) C:\Users\user\Documents\repos\project&gt;uv sync -U -v
DEBUG uv 0.6.12 (e4e03833f 2025-04-02)
DEBUG Found project root: `C:\Users\user\Documents\repos\project`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `C:\Users\user\Documents\repos\project`
DEBUG Reading Python requests from version file at `C:\Users\user\Documents\repos\project\.python-version`
DEBUG Using Python request `3.11` from version file at `.python-version`
warning: `VIRTUAL_ENV=venv` does not match the project environment path `.venv` and will be ignored; use `--active` to target the active environment instead
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment&#x27;s Python version satisfies `3.11`
DEBUG Released lock at `C:\Users\user\AppData\Local\Temp\uv-78998a54b191bd3e.lock`
DEBUG Using request timeout of 30s
DEBUG Ignoring existing lockfile due to `--upgrade`
DEBUG Found static `pyproject.toml` for: project @ file:///C:/Users/user/Documents/repos/project
DEBUG No workspace root found, using project root
DEBUG Solving with installed Python version: 3.11.9
DEBUG Solving with target Python version: &gt;=3.11
DEBUG Adding direct dependency: project*
DEBUG Searching for a compatible version of project @ file:///C:/Users/user/Documents/repos/project (*)
DEBUG Adding direct dependency: private_package&gt;=2.7
DEBUG Acquired lock for `C:\Users\user\AppData\Local\uv\cache\simple-v15\index\9ef19ba820518c37\private_package.lock`
DEBUG No cache entry for: https://pkgs.dev.azure.com/dongenergy-p/_packaging/ArtifactName/pypi/simple/private_package/
DEBUG Released lock at `C:\Users\user\AppData\Local\uv\cache\simple-v15\index\9ef19ba820518c37\private_package.lock`
DEBUG Searching for a compatible version of private_package (&gt;=2.7)
DEBUG No compatible version found for: private_package
DEBUG Recording unit propagation conflict of private_package from incompatibility of (project)
DEBUG Searching for a compatible version of project @ file:///C:/Users/user/Documents/repos/project (&lt;0.1.0 | &gt;0.1.0)
DEBUG No compatible version found for: project
  x No solution found when resolving dependencies:
  `-&gt; Because private_package was not found in the package registry and your project depends on private_package&gt;=2.7, we can conclude that your project&#x27;s requirements are unsatisfiable.

      hint: An index URL (https://pkgs.dev.azure.com/dongenergy-p/_packaging/ArtifactName/pypi/simple/) could not be queried due to a lack of valid authentication credentials (401 Unauthorized). 
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:05 UTC
    </footer>
</body>
</html>
