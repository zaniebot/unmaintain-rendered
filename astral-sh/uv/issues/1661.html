<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install` fails for dependencies on already-installed local packages - astral-sh/uv #1661</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv pip install` fails for dependencies on already-installed local packages</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1661">#1661</a>
        opened by <a href="https://github.com/charlesnicholson">@charlesnicholson</a>
        on 2024-02-18 18:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2024-02-18 18:00</div>
            <div class="timeline-body"><p>When a package depends on an editable-installed namespaced package, <code>uv pip install</code> fails saying that the already-installed package can't be found. Possibly related to string hygiene and converting <code>ns1.package1</code> to <code>ns1-package1</code>?</p>
<p>Full cloneable repro case here: https://github.com/charlesnicholson/uv-pep420-bug/tree/main
(Runs at least on macOS and maybe Linux, let me know if it's insufficient and I'll fix it up)</p>
<img width="724" alt="Screenshot 2024-02-18 at 12 58 16 PM" src="https://github.com/astral-sh/uv/assets/3010295/50b162c4-03cd-4b17-9091-058daca3ef4e">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2024-02-18 18:12</div>
            <div class="timeline-body"><p>Ah, sorry:</p>
<pre><code>❯ ./uv --version
uv 0.1.3
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2024-02-18 18:44</div>
            <div class="timeline-body"><p>Confirmed still happens on <code>0.1.4</code> (albeit with a much more soothing color scheme!):</p>
<img width="905" alt="Screenshot 2024-02-18 at 1 43 43 PM" src="https://github.com/astral-sh/uv/assets/3010295/76308b51-b871-45c3-9cfd-ee70e28369d0">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-02-18 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-20 04:41</div>
            <div class="timeline-body"><p>So, I think <code>cargo run pip install -e ns2.package2 -e ns1.package1</code> works, but installing the packages one-by-one does not. I need to think about what the right solution is here. When we go to install the second package (<code>-e ns2.package2</code>), we start by performing a resolution, to figure out the required dependencies. We don't consider the &quot;current virtual environment&quot; to be a valid package source, so we have no way of finding <code>ns1-package1</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2024-02-20 13:41</div>
            <div class="timeline-body"><p>Ah, interesting, thanks for taking a look and sharing your thoughts!</p>
<p>For context, if it's useful, the reason we incrementally <code>pip install -e</code> our various packages in order is because they're part of a larger build system that understands the dependencies between our packages and other tools. Each package has an &quot;editable install&quot; target, and for our build system to satisfy our version of <code>ns2.package2</code>'s dependencies, it needs to bring the &quot;editable-install <code>ns1.package1</code>&quot; target up-to-date first, which it does via a separate invocation of <code>pip install -e</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2024-02-20 13:50</div>
            <div class="timeline-body"><p>OTOH maybe since <code>uv</code> is so hilariously fast, there isn't really a build-time performance penalty for just always re-editable-installing our dependent packages along with the new package :-D (Transitive package dependencies make this complicated though)</p>
<p>Doing the same work with pip definitely incurs a performance penalty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2024-02-20 14:25</div>
            <div class="timeline-body"><p>I am curious, though- the venv seems like a pretty reasonable source of packages given that it holds strongly-versioned already-installed dependencies, and that's more or less its reason to exist. To my mind, it seems reasonable that <code>uv</code> would behave identically with both a unified and multiple separate invocations. I am a brand new user, though, and not the author, so I certainly don't have the context that you do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1476.html">astral-sh/uv#1476</a> on 2024-02-22 03:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1856.html">astral-sh/uv#1856</a> on 2024-02-22 05:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 05:31</div>
            <div class="timeline-body"><p>I think it's probably correct for us to fix this. It just changes a lot of assumptions -- right now, we perform a resolution that's independent of the virtual environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv pip install` fails with PEP420 namespace package dependencies" to "`uv pip install` fails when packages rely on installed, locally-derived packages" by @charliermarsh on 2024-02-22 05:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv pip install` fails when packages rely on installed, locally-derived packages" to "`uv pip install` fails for dependencies on already-installed, locally-derived packages" by @charliermarsh on 2024-02-22 05:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv pip install` fails for dependencies on already-installed, locally-derived packages" to "`uv pip install` fails for dependencies on already-installed local packages" by @charliermarsh on 2024-02-22 05:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2024-02-22 05:33</div>
            <div class="timeline-body"><p>Installing all the editable packages at once works for us.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 05:35</div>
            <div class="timeline-body"><p>Yeah, the problem is that the second install doesn't &quot;know&quot; where to find the existing editable. We need to make the resolver aware of packages that already exist in the virtual environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerw">@tylerw</a> on 2024-02-25 21:37</div>
            <div class="timeline-body"><p>Possibly related (if not, I can file a separate issue—or none at all if this is a misunderstanding on my part), when I <code>uv pip compile</code> a <code>requirements.in</code> or <code>uv pip install</code> a <code>requirements.txt</code> that has local, editable-installed modules (e.g, specified with <code>-e path/to/module</code>) they are all rebuilt and I assume cached, even if they haven't changed and don't need it. Is this avoidable?</p>
<p>For the record, this is a large monorepo with dozens of modules. The commands complete really fast and therefore it's not a huge problem, just wondering if there is a way (or possibly a different work flow) to prevent this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-25 21:39</div>
            <div class="timeline-body"><p>@tylerw -- I <em>think</em> we try to avoid rebuilding with <code>uv pip compile</code>, but we always rebuild right now in <code>uv pip install</code>. Building editables is typically pretty cheap, but I'm looking into removing that step.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2093.html">astral-sh/uv#2093</a> on 2024-02-29 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2282.html">astral-sh/uv#2282</a> on 2024-03-07 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-07 16:44</div>
            <div class="timeline-body"><p>(I intend to fix this.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2383.html">astral-sh/uv#2383</a> on 2024-03-12 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2560.html">astral-sh/uv#2560</a> on 2024-03-20 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-03-21 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2596.html">astral-sh/uv#2596</a> on 2024-03-21 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/rye/issues/813.html">astral-sh/rye#813</a> on 2024-03-24 05:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-03-28 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2726.html">astral-sh/uv#2726</a> on 2024-03-29 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-01 21:38</div>
            <div class="timeline-body"><p>Hi! Charlie tricked me into taking on this hard task instead :)</p>
<p>It should be addressed in the latest release (<a href="https://github.com/astral-sh/uv/releases/tag/0.1.27">0.1.27</a>) via #2596.</p>
<p>Let us know if you have any problems.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charlesnicholson">@charlesnicholson</a> on 2024-04-01 22:10</div>
            <div class="timeline-body"><p>So far it's great, thanks! (I'm integrating it as I type this :) )</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
