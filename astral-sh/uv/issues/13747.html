<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Behavior of the --offline flag along with cached packages from an internal pypi index seem to not work as expected - astral-sh/uv #13747</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Behavior of the --offline flag along with cached packages from an internal pypi index seem to not work as expected</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13747">#13747</a>
        opened by <a href="https://github.com/taranlu-houzz">@taranlu-houzz</a>
        on 2025-05-30 23:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/taranlu-houzz">@taranlu-houzz</a> on 2025-05-30 23:54</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The below session illustrates the issue I am running into:</p>
<ul>
<li>Install an internal package from our internal pypi server via <code>uvx</code></li>
<li>When I try to use the tool in offline mode, it works, but only if the index url matches exactly.</li>
<li>It does not seem to be possible to coax <code>uv</code> to pull the package from the cache without the correct index url, even in offline mode.</li>
</ul>
<pre><code>↓3 ~/.cache/uv
❯ eza -1 --group-directories-first --tree
.
├── interpreter-v4
│   └── a8e1654926643a11
│       └── 5ddcd655664a7e80.msgpack
├── sdists-v9
└── CACHEDIR.TAG

↓3 ~/.cache/uv
❯ uvx --python 3.11 --python-preference only-managed --index 'http://&lt;internal pypi url&gt;:8080' --prerelease allow --from &lt;internal tool package&gt; render --version
Installed 32 packages in 91ms
&lt;internal tool package&gt;: 1.0.0 (f9a69e9e6e43f917f3171631b2eebeef865673cb)

↓3 ~/.cache/uv took 22s
❯ fd &quot;&lt;internal tool package&gt;&quot;
archive-v0/Sd_1rmJ8VU52wP5IZsMpG/lib/python3.11/site-packages/&lt;internal tool package&gt;-1.0.0.dist-info/
archive-v0/nKnXCB5NKzyNdd92JBiQf/&lt;internal tool package&gt;-1.0.0.dist-info/

↓3 ~/.cache/uv
❯ uvx --offline --python 3.11 --python-preference only-managed --index 'http://&lt;internal pypi url&gt;:8080' --prerelease allow --from &lt;internal tool package&gt; render --version
&lt;internal tool package&gt;: 1.0.0 (f9a69e9e6e43f917f3171631b2eebeef865673cb)

↓3 ~/.cache/uv
❯ uvx --offline --python 3.11 --python-preference only-managed --prerelease allow --from &lt;internal tool package&gt; render --version
  × No solution found when resolving tool dependencies:
  ╰─▶ Because &lt;internal tool package&gt; was not found in the cache and you require
      &lt;internal tool package&gt;, we can conclude that your requirements are unsatisfiable.

      hint: Packages were unavailable because the network was disabled. When the network is disabled, registry
      packages may only be read from the cache.

↓3 ~/.cache/uv
❌ 1 ❯ uvx --offline --python 3.11 --python-preference only-managed --prerelease allow --from &lt;internal tool package&gt;==1.0.0 render --version
  × No solution found when resolving tool dependencies:
  ╰─▶ Because &lt;internal tool package&gt; was not found in the cache and you require
      &lt;internal tool package&gt;==1.0.0, we can conclude that your requirements are unsatisfiable.

      hint: Packages were unavailable because the network was disabled. When the network is disabled, registry
      packages may only be read from the cache.

↓3 ~/.cache/uv
❌ 1 ❯ uvx --offline --python 3.11 --python-preference only-managed --index 'http://bad-url.net:8080' --prerelease allow --from &lt;internal tool package&gt; render --version
  × No solution found when resolving tool dependencies:
  ╰─▶ Because &lt;internal tool package&gt; was not found in the cache and you require
      &lt;internal tool package&gt;, we can conclude that your requirements are unsatisfiable.

      hint: Packages were unavailable because the network was disabled. When the network is disabled, registry
      packages may only be read from the cache.

↓3 ~/.cache/uv
❌ 1 ❯ uvx --python 3.11 --python-preference only-managed --index 'http://bad-url.net:8080' --prerelease allow --from &lt;internal tool package&gt; render --version
⠇ Resolving dependencies...                                                                                           error: Failed to fetch: `http://bad-url.net:8080/&lt;internal tool package&gt;/`
  Caused by: Could not connect, are you offline?
  Caused by: Request failed after 3 retries
  Caused by: error sending request for url (http://bad-url.net:8080/&lt;internal tool package&gt;/)
  Caused by: client error (Connect)
  Caused by: dns error: failed to lookup address information: nodename nor servname provided, or not known
  Caused by: failed to lookup address information: nodename nor servname provided, or not known

↓3 ~/.cache/uv took 3s
❌ 2 ❯
</code></pre>
<h3>Platform</h3>
<p>macOS 14.7.5 (23H527)</p>
<h3>Version</h3>
<p>uv 0.7.9 (13a86a23b 2025-05-30)</p>
<h3>Python version</h3>
<p>3.11.11 (uv managed)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @taranlu-houzz on 2025-05-30 23:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10380.html">astral-sh/uv#10380</a> on 2025-05-30 23:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-02 09:13</div>
            <div class="timeline-body"><p>This is intentional: For security and reproducibility reasons, uv considers packages from different indexes as totally different packages and uv will only use a different index if explicitly asked to.</p>
<p>You can use <code>uv tool install</code> to use a tool offline after installation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-06-02 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-06-02 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @taranlu-houzz on 2025-06-06 17:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:07 UTC
    </footer>
</body>
</html>
