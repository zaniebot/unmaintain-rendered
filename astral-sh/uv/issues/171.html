<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for pinning a package to a specific index - astral-sh/uv #171</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Add support for pinning a package to a specific index</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/171">#171</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-10-23 15:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-23 15:59</div>
            <div class="timeline-body"><p>Discussed this with Armin -- pip doesn't support it, and it seems like a big problem? If you have an internal index, but also want to get some packages from PyPI, there's no way to ensure that your internal packages come from your internal index. Packages on PyPI could even shadow them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Initial release" by @charliermarsh on 2023-10-24 19:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2023-10-24 19:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2023-10-24 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-26 05:13</div>
            <div class="timeline-body"><p>https://github.com/pypa/pip/issues/8606</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-26 05:16</div>
            <div class="timeline-body"><p>https://github.com/python-poetry/poetry/issues/6713</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-26 05:34</div>
            <div class="timeline-body"><p>I don't quite understand why this is so hard (as per the pip issue), I can't tell if it's hard because it's a large conceptual change for pip specifically, if it's hard because it's pip is large and complicated and any changes are hard, or if there's inherent complexity.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-26 05:35</div>
            <div class="timeline-body"><p>Poetry's design is interesting: https://python-poetry.org/docs/repositories/. It feels a bit more complex than is necessary though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1377.html">astral-sh/uv#1377</a> on 2024-02-16 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/groodt">@groodt</a> on 2024-02-19 02:43</div>
            <div class="timeline-body"><p>Please consider dependency confusion attacks: https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610</p>
<p>Use of <code>--extra-index-url</code> as they are presently used are a security vulnerability.</p>
<p><a href="https://peps.python.org/pep-0708/">PEP 708</a> is a yet-to-be-implemented approach to improving the security posture.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-19 04:04</div>
            <div class="timeline-body"><p>I would love to implement improvements to this (like the ability to pin a dependency to a specific index)‚Ä¶ We specifically held off and implemented indexes as-is to be spec-compliant. I‚Äôll implement this as soon as it‚Äôs supported and there‚Äôs clarity on how installers should handle it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/groodt">@groodt</a> on 2024-02-19 04:16</div>
            <div class="timeline-body"><p>Makes sense.</p>
<p>I think you may receive a lot of duplicate feature requests from the folks who do misuse <code>--extra-index-url</code> and who aren't aware that it is not currently intended to be used to append additional sources of dependencies, it's purpose is to provide a set of fallback mirrors of the primary index (<code>--index-url</code>) which is PyPI in the general case.</p>
<p>We may need to consider offering some help as mentioned in the PEP to move this along.</p>
<pre><code>This PEP has been provisionally accepted, with the following required conditions before the PEP is made Final:

An implementation of the PEP in PyPI (Warehouse) including any necessary UI elements to allow project owners to set the tracking data.
An implementation of the PEP in at least one repository other than PyPI, as you can‚Äôt really test merging indexes without at least two indexes.
An implementation of the PEP in pip, which supports the intended semantics and can be used to demonstrate that the expected security benefits are achieved. This implementation will need to be ‚Äúoff by default‚Äù initially, which means that users will have to opt in to testing it. Ideally, we should collect explicit positive reports from users (both project owners and project users) who have successfully tried out the new feature, rather than just assuming that ‚Äúno news is good news‚Äù.
</code></pre>
<p>In the short-term, if you don't want to bug-for-bug implement pip, we may need to point people at alternatives like https://github.com/uranusjr/simpleindex to help them merge indexes behind the scenes on localhost. I don't think many will like it üòÇ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pawamoy">@pawamoy</a> on 2024-02-19 07:58</div>
            <div class="timeline-body"><p>@groodt can you point at official docs that confirm this use of extra index is indeed misuse? To me it fits well with local versions for example?</p>
<p>In any case, thanks for the links to simple index, this will be useful if case you're right and UV does not allow this use of extra index :) A bit sad to have to run two local servers instead of one, but that's not that bad.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-02-19 08:12</div>
            <div class="timeline-body"><blockquote>
<p>I don't quite understand why this is so hard</p>
</blockquote>
<p>From what I recall (I quickly refreshed my memory on the issue but didn‚Äôt review the details) it‚Äôs a ‚Äúdesign decision that was made a long time ago‚Äù type of complexity. Pip has built a bunch of choices on top of the ‚Äúall indexes are equal and get merged‚Äù model, and it‚Äôs hard to know what we‚Äôd need to change if we were to revisit that decision. Add to that the need for backward compatibility and it‚Äôs a much bigger question than people saying ‚Äújust pick the index I ask for‚Äù will accept.</p>
<p>For uv, I foresee the following issues:</p>
<ol>
<li>Compatibility - you‚Äôll diverge from pip in both subtle and not-so-subtle ways. This isn‚Äôt a bad thing, but your stated intention is to be compatible with pip, so you need to make choices here.</li>
<li>Being an outlier - the ‚Äúall indexes are equal‚Äù model is not just something pip does. Standards like PEP 708 are built on the idea, so you may have trouble fitting that standard into your implementation. More generally, you‚Äôll have to make a bunch of UI and design issues where there is less pre-existing experience to draw on.</li>
<li>Scope creep - people start wanting things like index priorities (‚Äúget these from piwheels when you can, but fall back to PyPI if there‚Äôs nothing at all published on piwheels‚Äù) which have their own issues.</li>
<li>You open yourself up to the idea that a package is no longer identified by just name and version - where it came from becomes important as well. This may have wider implications - for example, SBOM data might need extra information like source URL.</li>
</ol>
<p>On the plus side, you‚Äôll be offering a solution to something users have been wanting for a <em>long</em> time, and which is often characterised as a security issue. And practicality may well beat purity here.</p>
<blockquote>
<p>can you point at official docs that confirm this use of extra index is indeed misuse</p>
</blockquote>
<p>It doesn‚Äôt describe it as ‚Äúmisuse‚Äù, but the pip docs are clear that we treat all indexes as equal: ‚ÄúThere is no ordering in the locations that are searched‚Äù from <a href="https://pip.pypa.io/en/stable/cli/pip_install/">here</a>. We (pip) could add a guide-type article discussing this in more depth, but we don‚Äôt have one currently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/groodt">@groodt</a> on 2024-02-19 09:12</div>
            <div class="timeline-body"><p>There‚Äôs a small security warning in the pip docs <a href="https://pip.pypa.io/en/stable/cli/pip_install/#examples">here</a></p>
<p><code>Using this option to search for packages which are not in the main repository (such as private packages) is unsafe, per a security vulnerability called [dependency confusion](https://azure.microsoft.com/en-us/resources/3-ways-to-mitigate-risk-using-private-package-feeds/): an attacker can claim the package on the public repository in a way that will ensure it gets chosen over the private package.</code></p>
<p>There is also an in progress pip PR to make this more explicit here https://github.com/pypa/pip/issues/11694</p>
<p>Here‚Äôs a major recent dependency confusion attack that impacted PyTorch (caused by instructions to use ‚Äîextra-index-url) https://news.ycombinator.com/item?id=34202662</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pawamoy">@pawamoy</a> on 2024-02-19 09:25</div>
            <div class="timeline-body"><p>@groodt I'm not sure this is to answer my previous question (&quot;can you point at official docs that confirm this use of extra index is indeed misuse&quot;), but I was especially referring to &quot;it's purpose is to provide a set of fallback mirrors of the primary index&quot;.</p>
<p>I distinguish three use-cases for extra indexes:</p>
<ol>
<li>extend main index with additional projects (subject to dependency confusion)</li>
<li>extend specific projects in main index with additional versions (not subject to dependency confusion)</li>
<li>mirror PyPI.org</li>
</ol>
<p>My understanding of your &quot;append additional sources of dependencies&quot; was that it referred to case 2, but now I think you were speaking of case 1.</p>
<p>So, to rephrase, and given pip currently considers all indexes to be equal, is case 2 is a misuse too?</p>
<p>(Anyway, after reading PEP 708, I also agree it's the way forward and not index ordering, as I commented <a href="https://github.com/astral-sh/uv/issues/1377#issuecomment-1951948003">here</a> :+1: )</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-02-19 09:26</div>
            <div class="timeline-body"><p>Stepping back from the question of &quot;why is this so hard&quot;, @groodt is correct that PEP 708 is the better solution here. Otherwise, does the user need to specify an explicit index for the whole of their internal package's dependency tree? What if someone adds a new internal module, and forgets to add it to the list of &quot;must come from the internal index&quot; list in all of their install jobs? Are we going to consider that as &quot;user error&quot;? The torchtriton attack took exactly this form. Or an attacker could compromise a <em>public</em> dependency of your internal project.</p>
<p>Having an index pin option doesn't prevent you from needing to handle the consequences of a &quot;all distributions with the same name and version are interchangeable&quot; model. It just gives users a manual way of firefighting issues with that model.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-02-19 09:51</div>
            <div class="timeline-body"><blockquote>
<p>So, to rephrase, and given pip currently considers all indexes to be equal, is case 2 is a misuse too?</p>
</blockquote>
<p>It's not that &quot;pip considers all indexes to be equal&quot; but rather that &quot;pip considers all distributions with the same name and version to be interchangeable <em>regardless of which index they came from</em>&quot;. The difference is subtle but important. Whether case 2 is a problem depends on whether you trust the &quot;main index&quot;, just the same as with case 1. The trust issue is what's important here rather than what is &quot;considered equal&quot;[^1].</p>
<p>The <code>--extra-index-url</code> argument for pip was added long ago, in simpler times when people weren't anywhere near as worried about attackers targetting PyPI, and nobody was running multinational businesses based on Python code. Trust was generally assumed to be present, and in particular no-one was worrying about <em>relative</em> trust between indexes. Things have changed, for better or worse, and <code>--extra-index-url</code> doesn't match the new reality. This is why one of the options pip is considering is simply <em>removing</em> it, and demanding that users pick a single index and ensure that they trust that one index. That's unlikely to ever happen because the breakage would be significant, but it's absolutely an option that a new project like <code>uv</code> could (and should) consider.</p>
<p>To answer your question more explicitly, your case (2) is a &quot;misuse&quot; in the sense that it has risks (the same as case 1). The risks may not be a dependency confusion attack, but they do include compromise of the PyPI account owning of the code you're extending. Is that a more acceptable risk? Only you can decide that.</p>
<p>The point is that <em>mixing indexes with different trust levels</em>[^2] is the problem here. Even the &quot;mirror PyPI&quot; case involves a risk if the mirror is compromised.</p>
<p>[^1]: You could argue that if you don't trust two indexes equally, you don't &quot;consider them equal&quot;, I guess...
[^2]: Within the same install command, which is why pinning for a set of named packages isn't a sufficient solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pawamoy">@pawamoy</a> on 2024-02-19 11:18</div>
            <div class="timeline-body"><p>Thanks @pfmoore!</p>
<p>(Side note: I just discovered that PDM supports respecting the order of indexes: https://pdm-project.org/latest/usage/config/#respect-the-order-of-the-sources.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-02-19 11:53</div>
            <div class="timeline-body"><p>Just as an example (and yes, it's a pathological case) if you have ordering, suppose you have index1 and index2 (ordered with 1 having priority over 2). Index 1 contains A 1.0 and B 1.0, with A 1.0 depending on B. Index 2 has B 2.0. If you install A, do you get B 1.0 or B 2.0? If the answer is 1.0, why did you bother specifying index 2? If you get B 2.0, and someone now adds A 2.0 to index 2, and changes B 2.0 to depend on A &gt; 1.0, is the correct thing to upgrade A to 2.0, or downgrade B to 1.0?</p>
<p>The point here is that there's multiple possible choices, and if you don't factor index priority into the core of your resolution algorithm, you end up with a system that users won't have a good intuition about, and which might depend on implementation details. Both of which can lead to security issues. I'm not saying that PDM has such a problem - they may well have considered all of this. Just that &quot;which index did this come from&quot; is an extra axis you have to consider as part of resolution, <em>not</em> just something you can keep separate from the resolver.</p>
<p>Anyway, the key point for <code>uv</code>, and in answer to the question @charliermarsh asked above, is that <em>this</em> is why pip is still trying to work out a good answer to how we could allow users to choose which index to use at a more fine grained level than &quot;per install&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pawamoy">@pawamoy</a> on 2024-02-19 13:09</div>
            <div class="timeline-body"><blockquote>
<p>If the answer is 1.0, why did you bother specifying index 2?</p>
</blockquote>
<p>To be able to find package C, D, E, etc. :smile: In my case, all packages from index 1 take precedence, even if higher versions are available in index 2. Index 1 contains just a tiny few packages, index 2 contains all the rest (PyPI.org in my case). Well, <code>pypiserver</code> can redirect to a fall back index when a package isn't found, so a single index (the local <code>pypiserver</code> one) is enough for me, but if it didn't have this feature, I'd have to continue relying on index-url + extra-index-url, with the limitation that I cannot enforce packages to be fetched from one of the two.</p>
<p>PEP 708 will bring the same ability with finer-grain control (per-project fallback). I'll see if <code>pypiserver</code> maintainers are interested in supporting it :slightly_smiling_face:</p>
<p>Could also be interesting to know how PDM handles ordering. If @frostming wants to chime in :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-02-19 13:18</div>
            <div class="timeline-body"><blockquote>
<p>In my case, all packages from index 1 take precedence, even if higher versions are available in index 2.</p>
</blockquote>
<p>Cool, so your approach to priority is like pinning, but with the decision on whether to pin being &quot;if package A is in index 1, then pin to index 1, else fall through&quot;. That works, but it doesn't support the piwheels case where they <em>supplement</em> PyPI with wheels for the raspberry pi architecture, letting installers fall back to PyPI if the wheel isn't valid for the user's architecture (at least that's how I understand what they do...)</p>
<p>Getting into this much detail may be more than the <code>uv</code> maintainers want, though. Let's see if this is useful to them. I don't want to come across as saying that this is too hard to do - it's too hard for <em>pip</em> to easily do (which is what triggered my original comment) but <code>uv</code> may well have different priorities and choose different trade-offs. They also don't have backward compatibility to deal with (unless they want to match pip feature for feature).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1688.html">astral-sh/uv#1688</a> on 2024-02-19 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @BurntSushi on 2024-02-26 15:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-29 12:52</div>
            <div class="timeline-body"><p>@pfmoore Thank you very much for your detailed comments here. They've been <em>super</em> helpful.</p>
<p>I'd like to make a small tweak to how <code>uv</code> behaves today that will hopefully resolve at least some of the issues users are hitting (#1377, #1600, #1451) in practice, but do it in a way that doesn't make <code>uv</code> behave like <code>pip</code> (which, AIUI, is to consider all available packages from all indexes, without any guaranteed priority order).</p>
<p>So today, our implementation works by giving a preference order to the indexes made available to <code>uv</code>:</p>
<p>https://github.com/astral-sh/uv/blob/995fba8fec6ac6569e5f7ffe8d244faddef98692/crates/uv-client/src/registry_client.rs#L191-L210</p>
<p>That is, given <code>uv pip install --index-url foo --extra-index-url bar --extra-index-url quux package</code>, it will first try <code>foo</code>, then <code>bar</code> and then <code>quux</code>. Once a package is found, <code>uv</code> will stop looking for it in any other indexes. So for example, if <code>package</code> is found in <code>bar</code>, then that means it definitely wasn't found in <code>foo</code>, and it may or may not be in <code>quux</code>. We never check.</p>
<p>Since <code>--index-url</code> defaults to PyPI, that means something like <code>uv pip install --extra-index-url bar package</code> will check PyPI first for <code>package</code>, and if it's found, stop. I think this turns out to be the reverse of what the commonly desired behavior is. And while it won't address every use case, I think a nice stop-gap solution here would be to flip the preference order with respect to <code>--index-url</code> and <code>--extra-index-url</code>. That is, we check PyPI after all other extra index URLs given.</p>
<p>This will not match pip's behavior in every case, but I think it does help address some of the common cases and I think also helps to mitigate the dependency confusion concerns. That is, if <code>package</code> is in <code>bar</code>, then <code>uv</code> would completely ignore any packages named <code>bar</code> on PyPI. (Today, that's flipped. If <code>package</code> is on PyPI, then it will completely ignore any <code>package</code> on <code>bar</code>.)</p>
<p>Otherwise, I do agree that if we can get away with it, we should probably avoid encoding <code>pip</code>'s behavior of including packages from all indexes without regard to priority into <code>uv</code>. But we can certainly revisit this if my tweak above doesn't pan out.</p>
<p>And popping up a level, I do think we'll want to absolutely address the multi-registry issue by giving users more control when we build out more project management features. But I think until then, we'll probably want to avoid adding too many additional abstractions into <code>uv pip install</code> for dealing with multiple registries. And of course, I suspect we will want PEP 708 support eventually too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pawamoy">@pawamoy</a> on 2024-02-29 13:01</div>
            <div class="timeline-body"><p>Nice! Worth noting is users who want the flipped behavior can do <code>uv pip install --index-url https://private-index.com/simple --extra-index-url https://pypi.org/simple</code>, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-29 13:02</div>
            <div class="timeline-body"><blockquote>
<p>Nice! Worth noting is users who want the flipped behavior can do <code>uv pip install --index-url https://private-index.com/simple --extra-index-url https://pypi.org/simple</code>, right?</p>
</blockquote>
<p>Ah yes! I meant to call that out, but yes indeed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2083.html">astral-sh/uv#2083</a> on 2024-02-29 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vlad-ivanov-name">@vlad-ivanov-name</a> on 2024-03-01 16:04</div>
            <div class="timeline-body"><p>While setting priority is good, in many cases it's only a bandaid while a proper solution would be enforcing association between specific packages and registries. This is not something that can be fixed server side; this has to be on the client, without any fallbacks or flexible behaviours. So if a package is not found in the registry, install (or any other operation) has to fail. This is to prevent supply chain attacks -- any other behaviour creates scenarios where due to intermittent problems (e. g. network) a malicous package can be installed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-01 16:07</div>
            <div class="timeline-body"><blockquote>
<p>... while a proper solution would be enforcing association between specific packages and registries.</p>
</blockquote>
<p>I think this is roughly what I meant above with:</p>
<blockquote>
<p>And popping up a level, I do think we'll want to absolutely address the multi-registry issue by giving users more control when we build out more project management features.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vlad-ivanov-name">@vlad-ivanov-name</a> on 2024-03-01 16:23</div>
            <div class="timeline-body"><p>Thank you for the reply. Do you think this feature could be implemented in API sooner than implementing the UX for it in the command line? <code>pixi</code> recently switched to <code>uv</code> as a Python backend, and as they don't implement <code>pip</code> UX/UI, just an API that would be more detailed than the current &quot;flat&quot; package source from multiple URLs would already enable it there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2205.html">astral-sh/uv#2205</a> on 2024-03-05 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/atti92">@atti92</a> on 2024-03-05 19:31</div>
            <div class="timeline-body"><p>I have a similar problem.
<strong>CASE A:</strong></p>
<ul>
<li>Lets say you have a PKG with 1 yanked version available in UV_INDEX_URL or pypi.org</li>
<li>You have the same package in your UV_EXTRA_INDEX_URL, but with valid versions.</li>
</ul>
<ol>
<li>when PKG is a dependency of something that we try to install, it works with latest uv version. :ok:</li>
<li>trying to install the PKG directly, gives an error: :no_entry:</li>
</ol>
<pre><code>error: Missing `Content-Type` header for &lt;EXTRA_INDEX_URL&gt;/PKG
</code></pre>
<p><strong>CASE B:</strong></p>
<ul>
<li>When you have multiple indexes in UV_EXTRA_INDEX_URL and the PKG is in the first extra:</li>
</ul>
<ol>
<li>same behaviour as with just 1 extra  :no_entry:</li>
</ol>
<p><strong>CASE C:</strong></p>
<ul>
<li>When the PKG is not in the first extra, but in subsequent extra indexes:</li>
</ul>
<ol>
<li>installation is not possible, it only looks for the package in the UV_INDEX_URL  :no_entry:</li>
</ol>
<pre><code>√ó No solution found when resolving dependencies:
  ‚ï∞‚îÄ‚ñ∂ Because only PKG==0.0.0a1 is available and PKG==0.0.0a1 is unusable because it was yanked (reason: not stable), we can conclude that all versions of PKG cannot be used.
      And because you require PKG, we can conclude that the requirements are unsatisfiable.

      hint: PKG was requested with a pre-release marker (e.g., any of:
          PKG&lt;0.0.0a1
          PKG&gt;0.0.0a1
      ), but pre-releases weren't enabled (try: `--prerelease=allow`)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 19:33</div>
            <div class="timeline-body"><p>What's the case in which you're seeing <code>error: Missing </code>Content-Type<code> header for &lt;EXTRA_INDEX_URL&gt;/PKG</code>? That seems like a bug in the registry, but perhaps we can handle it gracefully.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/atti92">@atti92</a> on 2024-03-05 19:37</div>
            <div class="timeline-body"><blockquote>
<p>What's the case in which you're seeing <code>error: Missing </code>Content-Type<code> header for &lt;EXTRA_INDEX_URL&gt;/PKG</code>? That seems like a bug in the registry, but perhaps we can handle it gracefully.</p>
</blockquote>
<ul>
<li>UV_INDEX_URL is undefined.</li>
<li>UV_EXTRA_INDEX_URL points to a NEXUS instance with pypi repo</li>
</ul>
<p>It only happens if I try to install a package that is available in both pypi.org and in the nexus.
Installing packages that are only in the nexus or pypi works.
Also it only happens when installing the package directly with <code>uv pip install PKG</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 19:41</div>
            <div class="timeline-body"><p>I think you want https://github.com/astral-sh/uv/issues/1754.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/atti92">@atti92</a> on 2024-03-05 19:47</div>
            <div class="timeline-body"><p>Yes I can confirm using <code>--no-cache</code> removes the error message.</p>
<p>Do you know anything about using multiple extra-index-urls, is that supposed to work?
it only resolved the package if it was in the first one, tried --extra-index-url and env too.</p>
<p>we have multiple gitlab registries, on top of the nexus and pypi, and we need to install many packages from all the different repositories.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-05 19:56</div>
            <div class="timeline-body"><blockquote>
<p>Do you know anything about using multiple extra-index-urls, is that supposed to work?
it only resolved the package if it was in the first one, tried --extra-index-url and env too.</p>
</blockquote>
<p>See https://github.com/astral-sh/uv/pull/2083</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/atti92">@atti92</a> on 2024-03-05 20:00</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Do you know anything about using multiple extra-index-urls, is that supposed to work?
it only resolved the package if it was in the first one, tried --extra-index-url and env too.</p>
</blockquote>
<p>See #2083</p>
</blockquote>
<p>My package is only available in one of the extra-index-urls outside of index-url, but it still cannot find it, if it's not the first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-05 21:00</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<blockquote>
<p>Do you know anything about using multiple extra-index-urls, is that supposed to work?
it only resolved the package if it was in the first one, tried --extra-index-url and env too.</p>
</blockquote>
<p>See #2083</p>
</blockquote>
<p>My package is only available in one of the extra-index-urls outside of index-url, but it still cannot find it, if it's not the first.</p>
</blockquote>
<p>It might be worth opening a new issue with a repro.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/atti92">@atti92</a> on 2024-03-05 21:24</div>
            <div class="timeline-body"><p>It seems like gitlab is doing an automatic pypi lookup:
https://docs.gitlab.com/ee/user/packages/pypi_repository/#install-a-pypi-package</p>
<pre><code>In [GitLab 14.2 and later](https://gitlab.com/gitlab-org/gitlab/-/issues/233413), when a PyPI package is not found in the package registry, the request is forwarded to [pypi.org](https://pypi.org/).
</code></pre>
<p>Probably that's why it finds the yanked version again and stops looking at the subsequent extra-index-urls
gonna comment on this, as that seems the most relevant issue: https://github.com/astral-sh/uv/issues/2205</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/588.html">prefix-dev/pixi#588</a> on 2024-03-08 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2310.html">astral-sh/uv#2310</a> on 2024-03-08 22:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2377.html">astral-sh/uv#2377</a> on 2024-03-13 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2478.html">astral-sh/uv#2478</a> on 2024-03-15 19:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2542.html">astral-sh/uv#2542</a> on 2024-03-19 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2683.html">astral-sh/uv#2683</a> on 2024-03-27 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2718.html">astral-sh/uv#2718</a> on 2024-03-28 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-03 23:29</div>
            <div class="timeline-body"><p>The next version of uv will include an opt-in flag to allow users to search for packages across multiple indexes. This is less secure, but closer to pip's behavior.</p>
<p>https://github.com/astral-sh/uv/pull/2815</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vlad-ivanov-name">@vlad-ivanov-name</a> on 2024-04-04 07:39</div>
            <div class="timeline-body"><p>Since there's a flag and the logic behind it already, perhaps it could accept something like <code>--index-strategy=pin --index-pin=pytest=pypi</code> üëÄ although ideally this should go in requirement files</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2840.html">astral-sh/uv#2840</a> on 2024-04-05 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2852.html">astral-sh/uv#2852</a> on 2024-04-06 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/1373.html">prefix-dev/pixi#1373</a> on 2024-05-13 11:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/rye/issues/1082.html">astral-sh/rye#1082</a> on 2024-05-13 23:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3931.html">astral-sh/uv#3931</a> on 2024-05-31 16:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4173.html">astral-sh/uv#4173</a> on 2024-06-09 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4578.html">astral-sh/uv#4578</a> on 2024-06-27 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @BurntSushi by @konstin on 2024-07-09 12:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/rye/issues/1210.html">astral-sh/rye#1210</a> on 2024-08-10 12:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/smphhh">@smphhh</a> on 2024-08-21 13:42</div>
            <div class="timeline-body"><p>FWIW I quite like the feature in PDM that allows one to pin all packages with a specific prefix to a particular index, see: https://pdm-project.org/latest/usage/config/#specify-index-for-individual-packages. This allows easy pinning of all company internal dependencies (including transitive ones) to a private repository as long as you are able to name all the packages using some unique-enough prefix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/corleyma">@corleyma</a> on 2024-08-22 19:44</div>
            <div class="timeline-body"><p>@smphhh me too, and I've used poetry plugin to accomplish something similar.  I know it's funky but it's a big 80/20 for corporate usecases.  It solves the problem of &quot;if I pin a dependency to an index, from which index do I get the transitive dependencies?&quot; for a narrow but useful set of cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6523.html">astral-sh/uv#6523</a> on 2024-08-23 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 18:02</div>
            <div class="timeline-body"><p>Removing with <code>wish</code> label here, as we expect to implement this in <code>tool.uv.sources</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> removed by @zanieb on 2024-08-23 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">projects</span> added by @zanieb on 2024-08-23 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Feature complete" by @zanieb on 2024-08-23 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6544.html">astral-sh/uv#6544</a> on 2024-08-23 21:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6582.html">astral-sh/uv#6582</a> on 2024-08-24 13:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6421.html">astral-sh/uv#6421</a> on 2024-08-26 17:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6389.html">astral-sh/uv#6389</a> on 2024-09-03 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../renovatebot/renovate/pulls/31186.html">renovatebot/renovate#31186</a> on 2024-09-03 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colinjc">@colinjc</a> on 2024-09-05 19:07</div>
            <div class="timeline-body"><p>Current uv docs for dependencies make it sound like this feature is already available. Let to a bit of churn trying to figure out how to use it üòÖ</p>
<p>https://docs.astral.sh/uv/concepts/dependencies/</p>
<blockquote>
<p>tool.uv.sources enriches the dependency metadata with additional sources, incorporated during development. A dependency source can be a Git repository, a URL, a local path, or an <strong>alternative registry</strong>.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7149.html">astral-sh/uv#7149</a> on 2024-09-07 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7153.html">astral-sh/uv#7153</a> on 2024-09-09 01:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7245.html">astral-sh/uv#7245</a> on 2024-09-10 13:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/msabramo">@msabramo</a> on 2024-09-13 13:57</div>
            <div class="timeline-body"><p>Does uv not expand environment variables in the <code>extra-index-url</code> setting in <code>pyproject.toml</code>? I couldn't get this to work:</p>
<pre><code class="language-toml">[tool.uv]
# uv doesn't expand ARTIFACTORY_USER and ARTIFACTORY_API_TOKEN?
extra-index-url = [&quot;https://${ARTIFACTORY_USER}:${ARTIFACTORY_API_TOKEN}@pythonpackages.corp.example.com/artifactory/api/pypi/pypi-colorado-tools-snapshot/simple&quot;]
</code></pre>
<p>It <em>does</em> work if I set <code>UV_EXTRA_INDEX_URL</code> in the shell from which I invoke <code>uv</code>, presumably because the shell is expanding the environment variables.</p>
<p>And as a point of reference, we are currently using pdm and this works:</p>
<pre><code class="language-toml">[[tool.pdm.source]]
name = &quot;colorado-tools-snapshot&quot;
url = &quot;https://${ARTIFACTORY_USER}:${ARTIFACTORY_API_TOKEN}@pythonpackages.corp.example.com/artifactory/api/pypi/pypi-colorado-tools-snapshot/simple&quot;
include_packages = [&quot;venice&quot;, &quot;venice-*&quot;]
</code></pre>
<p>The packages in <code>include_packages</code> are proprietary packages, so they only exist in this internal Artifactory and not on PyPI. There's no mirroring and no choice of where to get them from; they have to come from a specific Artifactory package index.</p>
<p>Great work on uv!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vlad-ivanov-name">@vlad-ivanov-name</a> on 2024-09-13 14:03</div>
            <div class="timeline-body"><p>this is probably something that could be solved via keyring and --keyring-provider=subprocess (and is also unrelated to this issue)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-14 03:14</div>
            <div class="timeline-body"><p>Please comment on https://github.com/astral-sh/uv/issues/5734 instead for environment variable expansion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7390.html">astral-sh/uv#7390</a> on 2024-09-14 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7481.html">astral-sh/uv#7481</a> on 2024-09-18 01:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-18 04:06</div>
            <div class="timeline-body"><p>This is starting to come together in https://github.com/astral-sh/uv/pull/7481.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7496.html">astral-sh/uv#7496</a> on 2024-09-18 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-09-20 01:49</div>
            <div class="timeline-body"><blockquote>
<p>Poetry's design is interesting: https://python-poetry.org/docs/repositories/. It feels a bit more complex than is necessary though.</p>
</blockquote>
<p>Here's an interesting pattern w/ poetry I've seen used to allow local dev on osx with pytorch but also enable GPU usage on linux specifically on x86_64.</p>
<pre><code>[tool.poetry.dependencies]
...
torch = [
    ...
    { markers = &quot;sys_platform == 'darwin' and platform_machine == 'arm64'&quot;, url = &quot;https://download.pytorch.org/whl/cpu/foo_bar_cpu_wheel.whl&quot;},
    { markers = &quot;sys_platform == 'linux' and platform_machine == 'aarch64'&quot;, url = &quot;https://download.pytorch.org/whl/cpu/foo_bar_cpu_wheel.whl&quot;},
    { markers = &quot;sys_platform == 'linux' and platform_machine == 'x86_64'&quot;, url = &quot;https://download.pytorch.org/whl/cu121/foo_bar_gpu_wheel.whl&quot;}
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/groodt">@groodt</a> on 2024-09-20 23:27</div>
            <div class="timeline-body"><p>Good news! üéâ</p>
<p><a href="https://discuss.python.org/t/pep-708-extending-the-repository-api-to-mitigate-dependency-confusion-attacks/24179/94">Initial PEP 708 support has arrived on pypi</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Comfy-Org/comfy-cli/issues/189.html">Comfy-Org/comfy-cli#189</a> on 2024-09-21 09:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-15 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-15 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8253.html">astral-sh/uv#8253</a> on 2024-10-16 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/k0t3n">@k0t3n</a> on 2024-10-21 11:26</div>
            <div class="timeline-body"><p>What about CLI? Will uv support adding dependencies with custom registries via <code>uv add</code>?</p>
<p>I with I could do</p>
<pre><code class="language-shell">uv add --index internal somepackage
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gazpachoking">@gazpachoking</a> on 2024-10-21 13:54</div>
            <div class="timeline-body"><blockquote>
<p>What about CLI? Will uv support adding dependencies with custom registries via <code>uv add</code>?</p>
</blockquote>
<p>It looks like #7747 sorta does that. It doesn't allow just giving the index name though, you have to give the name and url. <code>uv add --index internal=https://internalindex.url somepackage</code> Allowing just using an existing index name would be a nice improvement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10140.html">astral-sh/uv#10140</a> on 2024-12-24 12:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypiserver/pypiserver/issues/643.html">pypiserver/pypiserver#643</a> on 2025-03-18 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Comfy-Org/comfy-cli/pulls/333.html">Comfy-Org/comfy-cli#333</a> on 2025-10-20 18:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matteius">@matteius</a> on 2025-12-15 03:55</div>
            <div class="timeline-body"><p>fwiw, this is something pipenv actually does right -- we patch pip to force index restricted packages.   I was exploring what a uv resolver backend for pipenv would look like tonight and ran across this closed issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:17 UTC
    </footer>
</body>
</html>
