<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv add doesn't adds the exact package version to pyproject.toml or to a script - astral-sh/uv #13381</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv add doesn&#x27;t adds the exact package version to pyproject.toml or to a script</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13381">#13381</a>
        opened by <a href="https://github.com/me-kell">@me-kell</a>
        on 2025-05-10 20:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/me-kell">@me-kell</a></div>
            <div class="timeline-body">Summary
<p>when adding a package (e.g. <code>requests</code>) without version with <code>uv add requests --constraints constraints.txt</code> but with the exact version specified in <code>constraints.txt</code> <code>uv</code> will add the version specified in <code>constraints.txt</code> (i.e. <code>requests==2.31.0</code>) as expected.</p>
<p>But in <code>pyproject.toml</code> it will add <code>requests&gt;=2.31.0</code> instead of <code>requests==2.31.0</code>).</p>
<p>I&#x27;d expect <code>requests==2.31.0</code> to be added in <code>pyproject.toml</code>. Is this intended? When I delete <code>.venv</code> and <code>uv.lock</code> and call <code>uv sync</code> or <code>uv lock</code> it will add a newer version of requests.</p>
<p><strong>To reproduce it</strong></p>
<pre><code>mkdir myproject
cd myproject

uv init
cat &lt;&lt;&#x27;EOF&#x27; | tee constraints.txt
requests==2.31.0
EOF
uv add requests --constraints constraints.txt
cat pyproject.toml
</code></pre>
<pre><code>[project]
name = &quot;myproject&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;requests&gt;=2.31.0&quot;,
]
</code></pre>
<p>And adding a package to a script with <code>--constraints</code> will not add any version at all:</p>
<pre><code>uv init --script myscript.py
uv add --script myscript.py requests --constraints constraints.txt

head -n 6 myscript.py
</code></pre>
<pre><code># /// script
# requires-python = &quot;&gt;=3.13&quot;
# dependencies = [
#     &quot;requests&quot;,
# ]
# ///
</code></pre>
Platform
<p>Linux 5.10.0-19-amd64 x86_64 GNU/Linux</p>
Version
<p>uv 0.7.3</p>
Python version
<p>Python 3.13.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/me-kell">@me-kell</a> on 2025-05-10 20:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-10 20:20</div>
            <div class="timeline-body"><p>Yes, this is intentional. You generally don&#x27;t want to lock versions in your <code>pyproject.toml</code> -- that&#x27;s the purpose of the lockfile. There will be a setting for this, though, introduced in <a href="https://github.com/astral-sh/uv/pull/12946">astral-sh/uv#12946</a>, and you can read <a href="https://github.com/astral-sh/uv/issues/6783">astral-sh/uv#6783</a> for more discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-10 20:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:34 UTC
    </footer>
</body>
</html>
