<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>panic in resolver during torture test - astral-sh/uv #1248</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>panic in resolver during torture test</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1248">#1248</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-02-05 01:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-05 01:01</div>
            <div class="timeline-body"><p>I've been hunting around for &quot;torture tests,&quot; so I took the top 1k pypi packages and tried to run <code>puffin pip compile</code> on them. (I had to trim down the list though because a lot of packages don't build.) In so doing, I found a panic:</p>
<pre><code>$ RUST_BACKTRACE=1 puffin-main pip compile pypi_top_1k_flat.txt -o /dev/null
⠇ nvidia-cuda-runtime-cu12==12.1.105                                                                                                                                                                                             thread 'main' panicked at crates/puffin-resolver/src/resolution.rs:175:50:
no entry found for key
stack backtrace:
⠋ azure-mgmt-documentdb==0.1.3                                                                                                                                                                                                      0: rust_begin_unwind
             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library/std/src/panicking.rs:645:5
   1: core::panicking::panic_fmt
             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library/core/src/panicking.rs:72:14
   2: core::panicking::panic_display
             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library/core/src/panicking.rs:178:5
   3: core::panicking::panic_str
             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library/core/src/panicking.rs:152:5
   4: core::option::expect_failed
             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library/core/src/option.rs:1985:5
   5: puffin_resolver::resolution::ResolutionGraph::from_state
   6: puffin_resolver::resolver::Resolver&lt;Provider&gt;::solve::{{closure}}::{{closure}}
             at ./crates/puffin-resolver/src/resolver/mod.rs:280:24
   7: puffin_resolver::resolver::Resolver&lt;Provider&gt;::solve::{{closure}}
             at ./crates/puffin-resolver/src/resolver/mod.rs:242:5
   8: &lt;futures_util::future::future::fuse::Fuse&lt;Fut&gt; as core::future::future::Future&gt;::poll
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/futures-util-0.3.30/src/future/future/fuse.rs:84:26
   9: puffin_resolver::resolver::Resolver&lt;Provider&gt;::resolve::{{closure}}::{{closure}}
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/macros/select.rs:524:49
  10: &lt;tokio::future::poll_fn::PollFn&lt;F&gt; as core::future::future::Future&gt;::poll
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/future/poll_fn.rs:58:9
  11: puffin_resolver::resolver::Resolver&lt;Provider&gt;::resolve::{{closure}}
             at ./crates/puffin-resolver/src/resolver/mod.rs:214:26
  12: puffin::commands::pip_compile::pip_compile::{{closure}}
             at ./crates/puffin/src/commands/pip_compile.rs:299:47
  13: puffin::run::{{closure}}::{{closure}}
             at ./crates/puffin/src/main.rs:731:14
  14: puffin::run::{{closure}}
             at ./crates/puffin/src/main.rs:618:1
  15: tokio::runtime::park::CachedParkThread::block_on::{{closure}}
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/park.rs:282:63
  16: tokio::runtime::coop::with_budget
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/coop.rs:107:5
  17: tokio::runtime::coop::budget
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/coop.rs:73:5
  18: tokio::runtime::park::CachedParkThread::block_on
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/park.rs:282:31
  19: tokio::runtime::context::blocking::BlockingRegionGuard::block_on
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/context/blocking.rs:66:9
  20: tokio::runtime::scheduler::multi_thread::MultiThread::block_on::{{closure}}
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/scheduler/multi_thread/mod.rs:87:13
  21: tokio::runtime::context::runtime::enter_runtime
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/context/runtime.rs:65:16
  22: tokio::runtime::scheduler::multi_thread::MultiThread::block_on
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/scheduler/multi_thread/mod.rs:86:9
  23: tokio::runtime::runtime::Runtime::block_on
             at /home/andrew/.cargo/registry/src/index.crates.io-6f17d22bba15001f/tokio-1.35.1/src/runtime/runtime.rs:350:50
  24: puffin::main
             at ./crates/puffin/src/main.rs:904:9
  25: core::ops::function::FnOnce::call_once
             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library/core/src/ops/function.rs:250:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre>
<p>I've attached the <code>~/astral/tmp/reqs/pypi_top_1k_flat.txt</code> input file.
<a href="https://github.com/astral-sh/puffin/files/14159238/pypi_top_1k_flat.txt">pypi_top_1k_flat.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2024-02-05 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "panic in resolver during tortue test" to "panic in resolver during torture test" by @AlexWaygood on 2024-02-05 12:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2377.html">astral-sh/uv#2377</a> on 2024-03-12 07:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-12 12:56</div>
            <div class="timeline-body"><p>This should be fixed by #2360.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-03-12 12:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:17 UTC
    </footer>
</body>
</html>
