```yaml
number: 10999
title: "When using `--no-sources` it seems that uv still reads some metadata from workspace packages"
type: issue
state: closed
author: potiuk
labels:
  - bug
assignees: []
created_at: 2025-01-27T18:55:08Z
updated_at: 2025-01-27T23:10:29Z
url: https://github.com/astral-sh/uv/issues/10999
synced_at: 2026-01-10T01:57:25Z
```

# When using `--no-sources` it seems that uv still reads some metadata from workspace packages

---

_Issue opened by @potiuk on 2025-01-27 18:55_

### Summary

It's related to #10991 - I found it after I tried to make Airlfow workspaces tick.

The problem is that even if `--no-sources` correctly uses actually released packaged in `pypi` instead of locally installed packages, some metadata still leaks to the `uv pip install` command,

In airflow: we have 

```toml
[tool.uv.sources]
apache-airflow-providers-openlineage = { workspace = true }
```

However I wanted to use local project to install airflow (non-editable) from sources and specific version of the openlineage provider from pypi (2.0.0).

Our provider in PyPI is released (version 2.0.0):

https://pypi.org/project/apache-airflow-providers-openlineage/2.0.0/

One of it's required dependencies is `apache-airflow-providers-common-compat>=1.3.0`

In our repo however, in the workspace package we already made the provider dependds on `apache-airflow-providers-common-compat>=1.4.0` - in preparation for the upcoming release. We do not yet whether it is going to be openlineage provider 2.1.0 or 3.0.0 - depending whether it will have some breaking changes, but we already know that it needs common.compat >= 1.4.0. So while `common.compat>=1.4.0` is already updated, the pyproject.toml of the provider stil has `2.0.0` version set - it will be bumped by the release manager at the release time:

https://github.com/apache/airflow/blob/f6b05fe243c17ffb80a4d2497fa7849f27ea507e/providers/openlineage/pyproject.toml#L60

The problem is that this `common.compat >= 1.4.0` and possibly other metadata leaks from the local workspace when `--no-sources` is used.

Running command:

```
uv pip install --system --no-sources '.[all-core]' --resolution highest \
 apache-airflow-providers-openlineage==2.0.0 \
 apache-airflow-providers-common-compat==1.3.0  [SOME MORE PROIVDERS]
```

I get this error:

```
Using Python 3.9.21 environment at: /usr/local
   Built apache-airflow @ file:///opt/airflow
  × No solution found when resolving dependencies:
  ╰─▶ Because apache-airflow-providers-openlineage==2.0.0 depends on apache-airflow-providers-common-compat>=1.4.0 and you require apache-airflow-providers-common-compat==1.3.0, we can conclude that your requirements and apache-airflow-providers-openlineage==2.0.0 are incompatible.
      And because you require apache-airflow-providers-openlineage==2.0.0, we can conclude that your requirements are unsatisfiable.```
```

Seems like the `common-compat>=1.4.0` comes from local workspace version of the package and not from `PyPI` 2.0.0 version.



### Platform

Ubuntu 22.04

### Version

0.5.24

### Python version

3.9.21

---

_Label `bug` added by @potiuk on 2025-01-27 18:55_

---

_Referenced in [astral-sh/uv#10991](../../astral-sh/uv/issues/10991.md) on 2025-01-27 18:55_

---

_Referenced in [apache/airflow#46139](../../apache/airflow/pulls/46139.md) on 2025-01-27 19:00_

---

_Assigned to @konstin by @konstin on 2025-01-27 20:03_

---

_Referenced in [astral-sh/uv#11003](../../astral-sh/uv/pulls/11003.md) on 2025-01-27 21:22_

---

_Closed by @konstin on 2025-01-27 23:10_

---
