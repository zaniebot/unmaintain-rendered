<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support for custom netrc location appears to be partially bugged. - astral-sh/uv #8413</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support for custom netrc location appears to be partially bugged.</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8413">#8413</a>
        opened by <a href="https://github.com/EdgyMeshx">@EdgyMeshx</a>
        on 2024-10-21 09:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/EdgyMeshx">@EdgyMeshx</a> on 2024-10-21 09:45</div>
            <div class="timeline-body"><p>I have multiple logins for different work projects so a single <code>.netrc</code> doesn't cover my usecase.</p>
<p>Supplying <code>NETRC=/my/custom/.netrc</code> almost works, it is picked up when checking for <code>api.github.com</code> but then seems to get ignored when fetching from <code>github.com</code>.</p>
<pre><code>$ NETRC=~/.netrc_custom uv lock -vvv                                                                                                                                                                                                                               
    0.001817s DEBUG uv uv 0.4.25
    0.002429s DEBUG uv_workspace::workspace Found workspace root: `/code/backend`
    0.002453s DEBUG uv_workspace::workspace Adding current workspace member: `/code/backend`
    0.002930s DEBUG uv::commands::project The virtual environment's Python version satisfies `Python ==3.11.*`
 uv_client::linehaul::linehaul 
    0.003258s DEBUG uv_client::base_client Using request timeout of 30s
 uv_resolver::flat_index::from_entries 
 uv_distribution::distribution_database::get_or_build_wheel_metadata dist=backend @ file:///code/backend
    0.004335s   0ms DEBUG uv_distribution::source Found static `pyproject.toml` for: backend @ file:///code/backend
    0.004688s   1ms DEBUG uv_workspace::workspace No workspace root found, using project root
 uv_distribution::distribution_database::get_or_build_wheel_metadata dist=common @ git+https://github.com/org/common.git@v0.1.1
    0.005164s   0ms DEBUG uv_git::resolver Fetching source distribution from Git: https://github.com/org/common.git
    0.005304s DEBUG uv_fs Acquired lock for `https://github.com/org/common`
 uv_git::source::fetch repository=https://github.com/org/common.git, rev=None
    0.007528s   2ms DEBUG uv_git::source Updating Git source `https://github.com/org/common.git`
    0.011735s   6ms DEBUG uv_git::git Attempting GitHub fast path for: https://api.github.com/repos/org/common/commits/v0.1.1
    0.230026s 224ms DEBUG uv_auth::middleware Checking netrc for credentials for https://api.github.com/repos/org/common/commits/v0.1.1
    0.230071s 224ms DEBUG uv_auth::middleware Found credentials in netrc file for https://api.github.com/repos/org/common/commits/v0.1.1
    0.434944s 429ms DEBUG uv_git::git Performing a Git fetch for: https://github.com/org/common.git
Username for 'https://github.com': 
</code></pre>
<p>As you can see it picks up netrc credentials for api.github.com, then fails when fetching. If I also put a <code>~/.netrc</code> with same credentials in it, it works fine at the git fetch step. So it appears that the <code>NETRC</code> environment variable is honored in one place but then ignored in the other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EdgyMeshx">@EdgyMeshx</a> on 2024-10-21 09:47</div>
            <div class="timeline-body"><p>contents of ~/.netrc_custom (and ~/.netrc when testing fallback works)</p>
<pre><code>machine github.com
login EdgyMeshx
password PAT

machine api.github.com
login EdgyMeshx
password PAT
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EdgyMeshx">@EdgyMeshx</a> on 2024-10-21 10:10</div>
            <div class="timeline-body"><p>For completeness, output when no .netrc file exists or is provided.</p>
<pre><code>    0.008606s   2ms DEBUG uv_git::source Updating Git source `https://github.com/org/common.git`
    0.012958s   6ms DEBUG uv_git::git Attempting GitHub fast path for: https://api.github.com/repos/org/common/commits/v0.1.1
    0.047237s  40ms DEBUG uv_auth::middleware No netrc file found
    0.047497s  40ms DEBUG uv_git::git failed to check github HTTP status client error (404 Not Found) for url (https://api.github.com/repos/org/common/commits/v0.1.1)
    0.047528s  40ms DEBUG uv_git::git Performing a Git fetch for: https://github.com/org/common.git
Username for 'https://github.com': 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 13:46</div>
            <div class="timeline-body"><p>Note we use a <a href="https://github.com/gribouille/netrc">library</a> to manage netrc files so I'm not sure we'll be able to fix this — you might need to reproduce and open an issue up there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by @zanieb on 2024-10-21 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EdgyMeshx">@EdgyMeshx</a> on 2024-10-21 13:55</div>
            <div class="timeline-body"><p>Wouldn't the bug somewhat lie in the way you are utilising it? It finds the supplied netrc file, then proceeds to either forget about it or not honor it the next time it is required.</p>
<p>I don't speak rust well enough to dive into how this might be occurring. If the fault ends up lying in the library you are using, you would be better equipped to raise an issue on their repository with the details of what the actual bug entails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 13:59</div>
            <div class="timeline-body"><p>So.. looking closer..</p>
<p>We don't read the <code>NETRC</code> variable ourselves, that logic is all in the library (hence my original suggestion to report he issue there).</p>
<p>Your failure is occurring during the git fetch</p>
<blockquote>
<p>uv_git::git Performing a Git fetch for: https://github.com/org/common.git</p>
</blockquote>
<p>in which we call out the <code>git</code> CLI. That's why the netrc isn't read by uv — those requests are all done outside of our HTTP client. Presumably this means that <code>git</code> doesn't support alternative <code>NETRC</code> file locations?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EdgyMeshx">@EdgyMeshx</a> on 2024-10-21 14:13</div>
            <div class="timeline-body"><p>Simple local test would seem to suggest the same:</p>
<pre><code>NETRC=~/.netrc_meshx git fetch https://github.com/org/repo.git -vvv
Username for 'https://github.com':
</code></pre>
<p>Thanks for the help, I'll look into git credentials and see if I can solve my usecase that way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @EdgyMeshx on 2024-10-21 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8441.html">astral-sh/uv#8441</a> on 2024-10-22 09:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
