<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incompatible extra with the declared conflicts error when remove a package - astral-sh/uv #12770</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incompatible extra with the declared conflicts error when remove a package</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12770">#12770</a>
        opened by <a href="https://github.com/BaoNguyen6742">@BaoNguyen6742</a>
        on 2025-04-09 03:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BaoNguyen6742">@BaoNguyen6742</a></div>
            <div class="timeline-body">Summary
<p>When removing a package after installing Pytorch using the official tutorial gives an <code>error: Extras `cpu` and `cu124` are incompatible with the declared conflicts: {`test[cpu]`, `test[cu124]`} </code></p>
<ul>
<li>Step to reproduce</li>
</ul>
<ol>
<li><p><code>uv init test -p 3.10</code></p>
</li>
<li><p>Use this config for pyproject.toml</p>
</li>
</ol>
<pre><code>[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = []


[project.optional-dependencies]
cpu = [&quot;torch==2.6.0&quot;, &quot;torchvision==0.21.0&quot;, &quot;torchaudio==2.6.0&quot;]
cu124 = [&quot;torch==2.6.0&quot;, &quot;torchvision==0.21.0&quot;, &quot;torchaudio==2.6.0&quot;]


[tool.uv]
conflicts = [[{ extra = &quot;cpu&quot; }, { extra = &quot;cu124&quot; }]]


[tool.uv.sources]
torch = [
    { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
    { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot; },
]
torchvision = [
    { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
    { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot; },
]
torchaudio = [
    { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
    { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot; },
]


[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu124&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
explicit = true

</code></pre>
<ol>
<li><p><code>uv sync --extra cu124</code></p>
</li>
<li><p><code>uv add tensorboard</code></p>
</li>
<li><p><code>uv remove tensorboard</code></p>
</li>
</ol>
<p>This return the error <code>error: Extras `cpu` and `cu124` are incompatible with the declared conflicts: {`test[cpu]`, `test[cu124]`}</code></p>
<p>Even though the package tensorboard is remove from the pyproject.toml file, it&#x27;s not actually remove and can still be seen with <code>uv pip list</code></p>
<pre><code>Package                  Version
------------------------ ------------
absl-py                  2.2.2
filelock                 3.18.0
fsspec                   2025.3.2
grpcio                   1.71.0
jinja2                   3.1.6
markdown                 3.7
markupsafe               3.0.2
mpmath                   1.3.0
networkx                 3.4.2
numpy                    2.2.4
nvidia-cublas-cu12       12.4.5.8
nvidia-cuda-cupti-cu12   12.4.127
nvidia-cuda-nvrtc-cu12   12.4.127
nvidia-cuda-runtime-cu12 12.4.127
nvidia-cudnn-cu12        9.1.0.70
nvidia-cufft-cu12        11.2.1.3
nvidia-curand-cu12       10.3.5.147
nvidia-cusolver-cu12     11.6.1.9
nvidia-cusparse-cu12     12.3.1.170
nvidia-cusparselt-cu12   0.6.2
nvidia-nccl-cu12         2.21.5
nvidia-nvjitlink-cu12    12.4.127
nvidia-nvtx-cu12         12.4.127
packaging                24.2
pillow                   11.1.0
protobuf                 6.30.2
setuptools               78.1.0
six                      1.17.0
sympy                    1.13.1
tensorboard              2.19.0
tensorboard-data-server  0.7.2
torch                    2.6.0+cu124
torchaudio               2.6.0+cu124
torchvision              0.21.0+cu124
triton                   3.2.0
typing-extensions        4.13.1
werkzeug                 3.1.3
</code></pre>
<p>The package is also still in the venv folder as when you run <code>which tensorboard</code> it return &quot;test/.venv/bin/tensorboard&quot;</p>
<p>The only way to actually remove it is to run <code>uv sync</code> since it will sync the environment with the pyproject.toml and since the package is remove in there, running <code>uv sync --extra cu124</code> will actually remove it now</p>
<pre><code>Resolved 35 packages in 0.51ms
Uninstalled 10 packages in 10ms
 - absl-py==2.2.2
 - grpcio==1.71.0
 - markdown==3.7
 - packaging==24.2
 - protobuf==6.30.2
 - setuptools==78.1.0
 - six==1.17.0
 - tensorboard==2.19.0
 - tensorboard-data-server==0.7.2
 - werkzeug==3.1.3
</code></pre>
<p>Is there any way to prevent this error as there should obviously no error when you remove this package, and I don&#x27;t have to use <code>uv sync</code> to actually remove the package</p>
Platform
<p>Linux 6.8.0-57-generic x86_64 GNU/Linux</p>
Version
<p>uv 0.7.2</p>
Python version
<p>Python 3.10.15</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BaoNguyen6742">@BaoNguyen6742</a> on 2025-04-09 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sglbl">@sglbl</a> on 2025-04-09 08:38</div>
            <div class="timeline-body"><p><img src="https://github.com/user-attachments/assets/d974a27a-1fb4-4829-8078-02f98a4cbd37" alt="Image">
I also had the same issue. Plus, now trying to add with extra changes the pyproject toml dependency to<code>&quot;torch[cpu]&gt;=2.5.1&quot;.</code>Before it wasn&#x27;t like this and it was only in <code>[project.optional-dependencies]</code> (@charliermarsh)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BaoNguyen6742">@BaoNguyen6742</a> on 2025-04-09 10:09</div>
            <div class="timeline-body"><blockquote>
<p><img src="https://github.com/user-attachments/assets/d974a27a-1fb4-4829-8078-02f98a4cbd37" alt="Image"> I also had the same issue. Plus, now trying to add with extra changes the pyproject toml dependency to<code>&quot;torch[cpu]&gt;=2.5.1&quot;.</code>Before it wasn&#x27;t like this and it was only in <code>[project.optional-dependencies]</code> (<a href="https://github.com/charliermarsh">@charliermarsh</a>)</p>
</blockquote>
<p>Can you do a <code>uv pip list</code> for me after install torch using extra like that, because in my case it&#x27;s not downloading the torch version from the Pytorch index but from Pypi which is the version that doesn&#x27;t run with Cuda</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Incompatible extra with the declared conflict error when remove a package&quot; to &quot;Incompatible extra with the declared conflicts error when remove a package&quot; by <a href="https://github.com/BaoNguyen6742">@BaoNguyen6742</a> on 2025-05-03 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rbavery">@rbavery</a> on 2025-05-10 18:28</div>
            <div class="timeline-body"><p>I&#x27;m also getting this issue, can&#x27;t remove packages but I can add them using <code>--extra cpu</code> or <code>--extra cu124</code>. My toml is below</p>
<pre><code>[project]
name = &quot;wherobots-executors-demo&quot;
version = &quot;0.1.0&quot;
description = &quot;Example repos for using executors for raster pipelines.&quot;
readme = &quot;README.md&quot;
authors = [ { name = &quot;Len Strnad&quot;, email = &quot;len@wherobots.com&quot; } ]
requires-python = &quot;&gt;=3.11&quot;
classifiers = [
  &quot;Programming Language :: Python :: 3 :: Only&quot;,
  &quot;Programming Language :: Python :: 3.11&quot;,
  &quot;Programming Language :: Python :: 3.12&quot;,
  &quot;Programming Language :: Python :: 3.13&quot;,
]

dependencies = [
  &quot;bokeh&gt;=3.1&quot;,
  &quot;boto3&gt;=1.34.131&quot;,
  &quot;branca&gt;=0.8.1&quot;,
  &quot;dask&quot;,
  &quot;distributed&quot;,
  &quot;folium&gt;=0.19.5&quot;,
  &quot;geopandas&gt;=1.0.1&quot;,
  &quot;huggingface-hub&gt;=0.28.1&quot;,
  &quot;ipykernel&gt;=6.29.5&quot;,
  &quot;ipywidgets&quot;,
  &quot;kornia&gt;=0.7.2,&lt;1&quot;,
  &quot;mapclassify&gt;=2.8.1&quot;,
  &quot;matplotlib&gt;=3.10.1&quot;,
  &quot;more-itertools&gt;=10.7&quot;,
  &quot;numpy&quot;,
  &quot;odc-algo&gt;=0.2.3&quot;,
  &quot;odc-loader&gt;=0.5.1&quot;,
  &quot;odc-stac&lt;=0.4&quot;,
  &quot;pandas&quot;,
  &quot;pillow&quot;,
  &quot;pre-commit&quot;,
  &quot;pyarrow&gt;=19.0.1&quot;,
  &quot;pystac&gt;=1.9,&lt;2&quot;,
  &quot;pystac-client&gt;=0.7.5,&lt;1&quot;,
  &quot;ray[default]&quot;,
  &quot;rustac[arrow]&gt;=0.7&quot;,
  &quot;s3fs&gt;=2025.3&quot;,
  &quot;sam2&gt;=1.1&quot;,
  &quot;scikit-image&gt;=0.22,&lt;1&quot;,
  &quot;stac-geoparquet&gt;=0.6&quot;,
  &quot;stac-model==0.2&quot;,
  &quot;tenacity&gt;=9.1.2&quot;,
  &quot;tqdm&gt;=4.67.1,&lt;5&quot;,
  &quot;transformers&gt;=4.48.2&quot;,
  &quot;wandb&gt;=0.17.3,&lt;1&quot;,
  &quot;xarray&gt;=2025.1.2&quot;,
  &quot;zarr&quot;,
]

optional-dependencies.cpu = [
  &quot;torch&gt;=2.6&quot;,
  &quot;torchvision&gt;=0.21&quot;,
]
optional-dependencies.cu124 = [
  &quot;pytorch-triton&quot;,
  &quot;torch&gt;=2.6&quot;,
  &quot;torchvision&gt;=0.21&quot;,
]

[tool.uv]
conflicts = [ [ { extra = &quot;cpu&quot; }, { extra = &quot;cu124&quot; } ] ]

[[tool.uv.index]]
name = &quot;pytorch-cu124&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot; },
]
torchvision = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot; },
]
pytorch-triton = [
  { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot; },
]

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-10 18:36</div>
            <div class="timeline-body"><p>It looks like we sync with <code>--all-extras</code> on remove, which seems like a mistake.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-10 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-18 21:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:11 UTC
    </footer>
</body>
</html>
