```yaml
number: 11937
title: "Keeping extras when running `uv sync`"
type: issue
state: closed
author: brysonwu
labels:
  - question
assignees: []
created_at: 2025-03-03T23:12:31Z
updated_at: 2025-09-25T00:49:47Z
url: https://github.com/astral-sh/uv/issues/11937
synced_at: 2026-01-10T01:57:27Z
```

# Keeping extras when running `uv sync`

---

_Issue opened by @brysonwu on 2025-03-03 23:12_

### Question

From https://github.com/astral-sh/uv/issues/4358, my understanding is that `uv sync` removes extraneous packages by default and `--inexact` should be used to disable this behavior. 

I have two questions regarding this:

1. How does `uv` determine that a package is extraneous?
2. Is there any way to keep installed extras without specifying `--inexact` or re-specifying `--extra`?

### Platform

Linux 5.15.167.4-microsoft-standard-WSL2 x86_64 GNU/Linux

### Version

uv 0.6.3

---

_Label `question` added by @brysonwu on 2025-03-03 23:12_

---

_Renamed from "Keep extras when running `uv sync`" to "Keeping extras when running `uv sync`" by @brysonwu on 2025-03-03 23:12_

---

_Comment by @charliermarsh on 2025-03-04 14:08_

The way to think of it is that when we perform a `uv sync` (without any arguments), we find the workspace root (or the project root, if it's not a workspace) and determine its dependencies without taking into account any of its extras. Then we install the inferred list of packages, and uninstall everything else.

At present, there's no way to define "default" extras like that. I think https://github.com/astral-sh/uv/issues/8607 is the closest thing for tracking it, but there's also a PEP in progress right now that touches on the concept.


---

_Comment by @brysonwu on 2025-03-04 18:50_

Thank you for the explanation. So just to check my understanding, any package outside of the core package dependencies and default groups (and soon, default extras) are considered to be extraneous?

I wanted to clarify that default extras is not the behavior I am looking for*. I can get my desired behavior of keeping installed extras through `uv pip install .[extra]` and avoiding `uv sync`. This may be by design but IMHO, it feels unnatural to fall back to the pip interface--pip feels like an impurity in uv-land.

In fact, I agree with what you said in https://github.com/astral-sh/uv/issues/4358#issuecomment-2282245206. I would expect that after I install an extra, I wouldn't have to explicitly tell uv to keep it every time I run `uv sync` (either by re-specifying `--extra` or by adding `--inexact`) or when I add another extra via `uv sync --extra <other>`. On the contrary, I think explicitly requesting a cleanup/exact sync makes more sense.

IIUC, `--inexact` was picked over `--exact` because it conforms better with `pip sync` conventions. But `uv sync`'s use case is not exactly the same as `pip sync`: `uv sync` is also used for installing optional dependencies because `uv add` does not allow for self-dependencies. Whereas in pip, `pip install -e .[extra]` fills the gap of what `pip sync` cannot do.

*: Also, if the extra is default, why not just add it to the core package dependencies? Self-dependency is allowed in the dev dependency group.

---

_Comment by @zanieb on 2025-03-04 18:54_

> IIUC, --inexact was picked over --exact because it conforms better with pip sync conventions. 

If you use `uv run`, we use an inexact sync by default. In `uv sync`, you've... asked for a sync explicitly.. it seems pretty weird not to follow exact sync semantics there.

> I would expect that after I install an extra, I wouldn't have to explicitly tell uv to keep it every time I run uv sync (either by re-specifying --extra or by adding --inexact) or when I add another extra via uv sync --extra <other>. On the contrary, I think explicitly requesting a cleanup/exact sync makes more sense.

While I agree this may be intuitive to start, I think making the command stateful in this way would be much more confusing to reason about. 

> *: Also, if the extra is default, why not just add it to the core package dependencies?

So you can opt-out / turn it off :)

---

_Comment by @brysonwu on 2025-03-04 18:59_

> If you use uv run, we use an inexact sync by default. In uv sync, you've... asked for a sync explicitly.. it seems pretty weird not to follow exact sync semantics there.

Yes, I understand the intention of `uv sync` now. I conflated it with the behavior I expect from something like `pip install -e .[extra]` because of:

> uv sync's use case is not exactly the same as pip sync: uv sync is also used for installing optional dependencies because uv add does not allow for self-dependencies. Whereas in pip, pip install -e .[extra] fills the gap of what pip sync cannot do.

> So you can opt-out / turn it off :)

~~Oh interesting, do you know what the opt-out mechanism would look like? I didn't catch mention of how to opt-out in https://github.com/astral-sh/uv/issues/8607~~ Probably something like `--no-default-extras` hey?

As always, y'all have amazing response time 

---

_Comment by @zanieb on 2025-03-04 19:03_

The relevant discussion on default extras is probably at https://discuss.python.org/t/pre-publish-pep-771-default-extras-for-python-software-packages/77892 for which there's a PEP describing the motivations and such https://peps.python.org/pep-0771/ â€” there's a use for default extras beyond the development workflows, where yeah `tool.uv.default-extras` and `--no-default-extras` or `--no-extra` would be the minimal interface.


---

_Comment by @brysonwu on 2025-03-04 19:21_

> If you use uv run, we use an inexact sync by default. In uv sync, you've... asked for a sync explicitly.. it seems pretty weird not to follow exact sync semantics there.

For this, yes it makes perfect sense when I invoke `uv sync` by itself. But when I add another extra by calling `uv sync --extra <other>`, I have to remind myself to include the previous extra or add `--inexact`. This is fine for me but is causing friction with uv adoption on a project I maintain. My users work in the project repo directly (not ideal but necessary in our case) and are surprised when `uv sync --extra` removes their previously installed extra. I rationalize this expectation as the users mapping `pip install -e .[extra]` to `uv sync --extra` in their mental model.

Instead of making `uv sync` stateful, how about building support for `uv add`  to ephemerally install optional dependencies until the next sync, e.g. by calling `uv add .[extra]`?

Not a demand phrased as a question, just trying to explore the solution space. I appreciate the philosophical purity that you are trying to maintain. I can happily proceed with falling back to the pip interface.

---

_Comment by @zanieb on 2025-03-04 19:31_

`uv add` is intended to modify the `pyproject.toml`, not install things. It's sort of a side-effect that it performs a sync afterwards. It's interesting to consider adding extra support there, but I worry it confuses the larger story.

Perhaps what I'm looking for is: why do you need to `uv sync` at all? Editor support? Can you just use `uv sync --all-extras`? Why are you syncing multiple times?

Not trying to challenge your workflow here, but understanding the fundamental reasons you're doing things can be helpful as we consider a holistic improvement to the behavior.

---

_Comment by @brysonwu on 2025-03-04 19:53_

Yes, editor support is primarily why we need to `uv sync`.

> Can you just use uv sync --all-extras?

We can now, but I foresee conflicting extras in the future.

> Why are you syncing multiple times?

User works on branch A, which requires subset of extras A. After deploying branch A, user is now working on branch B and need to re-sync with subset of extras B, which sometimes intersect with subset of extras A.

> Not trying to challenge your workflow here

No worries, I would love to challenge the current workflow but the momentum is too strong ðŸ˜” Hopefully this move to uv will contribute to improving it over time though

---

_Comment by @brysonwu on 2025-03-04 19:57_

Dependency groups could help organize the different subsets of required extras, but then users would need to spend effort maintaining those dependency groups and so `uv pip install -e .[extras]` would become the path of least resistance anyway

---

_Comment by @zanieb on 2025-03-04 20:03_

As a workaround, we can probably support changing the default sync behavior (inexact) via the `pyproject.toml`. It's sort of an open question how we want to expose those options to users.

When you're working on branches / features that require specific extras, is use of those extras generally limited to specific files or modules? Or is usage mixed in single files?

The long-term fix here is improved editor integration. The IDE shouldn't need a real virtual environment to power suggestions and you shouldn't need to perform manual sync, but innovation there will take time.

---

_Comment by @brysonwu on 2025-03-04 21:05_

> As a workaround, we can probably support changing the default sync behavior (inexact) via the pyproject.toml

Yes, I think that would be nice. A similar idea has crossed my mind before: configurable default arguments for uv commands similar to how pytest supports `addopts`, but maybe in a more elegant way.

> When you're working on branches / features that require specific extras, is use of those extras generally limited to specific files or modules? Or is usage mixed in single files?

In our case, limited to specific files and modules. But do you mind elaborating on what you mean by "usage mixed in single files"?

> The long-term fix here is improved editor integration. The IDE shouldn't need a real virtual environment to power suggestions and you shouldn't need to perform manual sync, but innovation there will take time.

I didn't realize this was possible--it's an interesting concept. Do you have issues / other links I can read to learn more about this?

---

_Comment by @zanieb on 2025-03-04 21:30_

> But do you mind elaborating on what you mean by "usage mixed in single files"?

That'd be like.. a single file with logic like

```
try:
   import foo
except ImportError:
   foo = None

try:
  import bar
except ImportError:
   bar = None

if foo is not None:
  print("the foo feature is enabled")
if bar is not None:
   print("the bar feature is enabled")
```

> I didn't realize this was possible--it's an interesting concept. Do you have issues / other links I can read to learn more about this?


Not yet! It's just in my head so far :) probably more on this in the future though.

---

_Comment by @brysonwu on 2025-03-04 21:47_

Ah, I see--yea we don't have those. In any case, I'll just continue on with recommending `uv pip install .[extra]` for now. Will keep an eye out for configurable default behaviors via `pyproject.toml` if it gets decided on :)

Thanks for answering my questions here @charliermarsh @zanieb 

---

_Closed by @brysonwu on 2025-03-04 21:47_

---

_Comment by @ssbarnea on 2025-09-23 09:23_

> `uv sync --all-extras`

Any chance we could at least make the `--all-extras` configurable in pyproject.toml? This would allow us to ensure that `uv sync` would also install them. Otherwise we would have to type a lot and remember about each project. We have a solution for the dependency-groups but not for the extras.

---

_Comment by @Butanium on 2025-09-25 00:49_

having an environment variable would also be good, e.g. i deployed a streamlit app that failed because i need some extra in my project for the app

---
