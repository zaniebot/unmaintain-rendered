<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv lock --locked and dynamic versioning collide. - astral-sh/uv #9233</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv lock --locked and dynamic versioning collide.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9233">#9233</a>
        opened by <a href="https://github.com/mjpieters">@mjpieters</a>
        on 2024-11-19 16:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mjpieters">@mjpieters</a> on 2024-11-19 16:26</div>
            <div class="timeline-body"><p>As part of our CI lint check, we validate that the lock file is current:</p>
<pre><code class="language-sh">uv lock --locked 2&gt;/dev/null || {
    echo -e '\033[0;31mThe lockfile at `uv.lock` needs to be updated. To update the lockfile, run `uv lock`\033[0m'.
    exit 1
} &gt;&amp;2
</code></pre>
<p>This project is built using <code>hatch</code>, together with the <code>hatch-vcs</code> plugin to set the version from the current git context:</p>
<pre><code class="language-toml">[project]
# ...
dynamic = [&quot;version&quot;]

[build-system]
requires = [&quot;hatchling&quot;, &quot;hatch-vcs&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.hatch.build.hooks.vcs]
version-file = &quot;_version.py&quot;

[tool.hatch.version]
source = &quot;vcs&quot;
</code></pre>
<p>This does mean that the version <strong>changes with every commit</strong>. Currently. this projects version is <code>0.15.2.dev3+g417c8ff</code>, meaning it is 3 commits away from the nearest tagged commit (which was tagged <code>v0.15.1</code>), and the current commit hash (shortened) is <code>417c8ff</code>. Once a commit is tagged for a new version (say, <code>0.16.0</code>) the project version reflects this. Thats great, because this lets our developers create a release version from a PR branch and test it against other projects simply by updating a dependency elsewhere to point to a development release.</p>
<p>However, <code>uv lock</code> puts this version in the lock file too. And so <code>uv lock --locked</code> <strong>fails for every new commit</strong>. And we could update the lock file, commit it, and... the lock file would immediately be outdated because with a new commit, there's a new commit hash and a new version, that's not going to match the lock file.</p>
<p>Is there any way we can <em>avoid</em> this problem?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/my1e5">@my1e5</a> on 2024-11-19 16:28</div>
            <div class="timeline-body"><p>Lots of discussion about this topic here:</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/7533</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-19 16:28</div>
            <div class="timeline-body"><p>Yeah let's keep the conversation over there. Right now VCS-based dynamic versions are in conflict with locking.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-19 16:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:33 UTC
    </footer>
</body>
</html>
