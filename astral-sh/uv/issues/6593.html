<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`pip` falls back to the global environment when it’s not installed in the `uv` virtual environment - astral-sh/uv #6593</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`pip` falls back to the global environment when it’s not installed in the `uv` virtual environment</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6593">#6593</a>
        opened by <a href="https://github.com/FBen3">@FBen3</a>
        on 2024-08-24 22:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/FBen3">@FBen3</a> on 2024-08-24 22:18</div>
            <div class="timeline-body"><p>platform: <code>macOS Sonoma</code>
uv version: <code>uv 0.3.1 (be17d132a 2024-08-21)</code>
reproduce:</p>
<pre><code>~/Developer/Python/virtual_envs % uv venv my-venv
Using Python 3.12.2 interpreter at: /opt/homebrew/opt/python@3.12/bin/python3.12
Creating virtualenv at: my-venv
Activate with: source my-venv/bin/activate

~/Developer/Python/virtual_envs % source my-venv/bin/activate
(my-venv) ~/Developer/Python/virtual_envs % uv pip list
(my-venv) ~/Developer/Python/virtual_envs % pip list
Package    Version
---------- ---------
certifi    2021.10.8
pip        22.1.2
setuptools 58.1.0

(my-venv) ~/Developer/Python/virtual_envs % which pip
/Library/Frameworks/Python.framework/Versions/3.10/bin/pip
</code></pre>
<p>Can someone clarify whether this is intended behaviour?</p>
<p>I would expect the virtual environments to be isolated. If <code>pip</code> isn’t installed, trying to use it should either fail outright or provide a clear message that <code>pip</code> isn’t available, instead of silently falling back to the global environment. This would improve user experience and prevent mistakenly polluting the global environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-24 22:44</div>
            <div class="timeline-body"><p>We don't install <code>pip</code> in the virtual environment. We don't really have any control over what you're seeing -- there's no <code>pip</code> on the path, so you're getting the <code>pip</code> that's already installed elsewhere. There's no explicit <code>uv</code>-<code>pip</code> interaction.</p>
<p>You can run <code>uv venv --seed</code> if you want to include <code>pip</code> in the created environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FBen3">@FBen3</a> on 2024-08-25 02:14</div>
            <div class="timeline-body"><p>Thanks for the swift reply &amp; clarification.</p>
<p>In that case it might be helpful to include a warning message:</p>
<pre><code>Warning: You are using the global pip installation. 
This virtual environment does not have pip installed. 
To avoid global installations, consider using `uv venv --seed` 
to include pip, or use `uv pip` for package management.
</code></pre>
<p><code>uv</code> could check if <code>pip</code> is being invoked in the virtual environment and then print the warning.</p>
<p>This would guard against unintentional global installations (e.g. accidentally forgetting to type <code>uv</code> before <code>uv pip install</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-25 10:46</div>
            <div class="timeline-body"><p>@FBen3
Since uv pip install works without activating a virtual environment, adding a warning seems unrealistic.
However, if we want a universal solution, perhaps pip should not be allowed to be found based on the PATH at all.
Perhaps making pip an alias for uv pip could be a solution?</p>
<p><strong>Note:</strong> I have not done any code-level research on UV. My contributions have been limited to simple documentation patches.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-25 14:07</div>
            <div class="timeline-body"><p>We're not really comfortable providing a shim for <code>pip</code> in environments (some discussion on that in https://github.com/astral-sh/uv/issues/1331) — it seems like complicated behavior for us to insert warnings when you <em>use</em> <code>pip</code>, a package we do not control.</p>
<p>If anything, this sounds like a pip issue? It should warn when being used in a virtual environment it's not installed in?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FBen3">@FBen3</a> on 2024-08-25 18:45</div>
            <div class="timeline-body"><p>If shim is inconvenient other options could be:</p>
<ol>
<li><p><strong>Hook into the Activation Script:</strong></p>
<ul>
<li><code>uv</code> could modify the activation script to include a check for <code>pip</code>. If <code>pip</code> isn't found in the virtual environment's <code>bin</code> directory, the script could add an alias or a wrapper function around <code>pip</code>. This wrapper would first check if <code>pip</code> is being run globally, and if so, it could throw a warning or error before allowing the global <code>pip</code> to execute. This ensures users are alerted before they inadvertently install packages globally.</li>
</ul>
</li>
<li><p><strong>PATH Manipulation:</strong></p>
<ul>
<li>Another approach could involve manipulating the <code>PATH</code> or setting specific environment variables upon activating the virtual environment to control whether <code>pip</code> is accessible or not. For instance, <code>uv</code> could place a &quot;fake&quot; <code>pip</code> executable in the virtual environment’s <code>bin</code> directory. This fake executable could display a warning message and suggest using <code>uv</code> for package management, helping to prevent accidental global installations.</li>
</ul>
</li>
</ol>
<p>I agree with you that <code>pip</code> itself should ideally throw a warning when it is invoked in a virtual environment where it’s not installed.</p>
<p>However, the core problem here is that <code>uv venv</code> doesn’t visibly differentiate itself from a traditional Python virtual environment, leading to situations where users might unintentionally fall back on muscle memory and type <code>pip install</code>. This can create a false sense of security, where users believe they’re working within an isolated environment but are actually installing packages globally. Addressing this with a warning mechanism would help maintain the integrity and isolation of virtual environments created by <code>uv</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-27 00:42</div>
            <div class="timeline-body"><p>I think the solution to this is <code>PIP_REQUIRE_VIRTUALENV</code> or, in a <code>pip.conf</code>:</p>
<pre><code>[global]
require-virtualenv = true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-08-27 00:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/HasanZaigam">@HasanZaigam</a> on 2025-02-19 20:31</div>
            <div class="timeline-body"><p><strong>I am working on the Railway platform or deploying my X AI agent by using the LLM and I get this error-</strong></p>
<p>✕ [stage-0  6/10] RUN --mount=type=cache,id=s/1eb2a6cc-50a7-4973-af90-a13857d8257a-/root/cache/pip,target=/root/.cache/pip python -m venv --copies /opt/venv &amp;&amp; . /opt/venv/bin/activate &amp;&amp; pip install -r requirements.txt
process &quot;/bin/bash -ol pipefail -c python -m venv --copies /opt/venv &amp;&amp; . /opt/venv/bin/activate &amp;&amp; pip install -r requirements.txt&quot; did not complete successfully: exit code: 2</p>
<p>Anybody knew, how to solve this problem.
Please help me out, to fix this error</p>
<p>@charliermarsh
@zanieb @FBen3 @FishAlchemist @alex</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-19 21:17</div>
            <div class="timeline-body"><p>@HasanZaigam Please don't bump old issues or ping a bunch of people. See #9452.</p>
<p>I can't tell you what's wrong without more information — there's no output there? It also looks like you're not even using uv?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:52:34 UTC
    </footer>
</body>
</html>
