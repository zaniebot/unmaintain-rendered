<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv tool install` does not exclude dependencies defined in `exclude_dependencies` - astral-sh/uv #17636</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv tool install</code> does not exclude dependencies defined in <code>exclude_dependencies</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17636">#17636</a>
        opened by <a href="https://github.com/FredrikBakken">@FredrikBakken</a>
        on 2026-01-21 09:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/FredrikBakken">@FredrikBakken</a></div>
            <div class="timeline-body">Summary
<p>When installing a Python project as an <code>uv tool</code> using the local path, e.g.:</p>
<pre><code>uv tool install &lt;path&gt;
</code></pre>
<p>I expect it to respect the <code>exclude-dependencies</code> list defined in the <code>pyproject.toml</code> file. However, this does not seem to be the case as I can find the excluded dependencies that were defined inside the <code>site-packages</code> path, e.g.: <code>/home/&lt;user&gt;/.local/share/uv/tools/&lt;tool-name&gt;/lib/python3.11/site-packages</code></p>
Platform
<p>Linux 6.6.87.2-microsoft-standard-WSL2 x86_64 GNU/Linux</p>
Version
<p>uv 0.9.24</p>
Python version
<p>Python 3.14.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/FredrikBakken">@FredrikBakken</a> on 2026-01-21 09:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-21 14:19</div>
            <div class="timeline-body"><p><code>exclude-dependencies</code> isn&#x27;t standard metadata and is only respected during operations within that project, not operations installing that project as a package.</p>
<p>We could consider reading it for local paths.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-21 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FredrikBakken">@FredrikBakken</a> on 2026-01-21 14:31</div>
            <div class="timeline-body"><p>Awesome, @zanieb !</p>
<p>To provide some more context to the situation - it is a CLI tool that we use to communicate with Databricks using <code>databricks-connect</code>, however, since we also have another dependency that depends on <code>pyspark</code>, we&#x27;re encountering a race condition between these two dependencies so that we have what feels like a 50/50 chance of getting a <code>AnalyzeArgument</code>-error. This is a known issue and also described here: https://docs.databricks.com/aws/en/dev-tools/databricks-connect/python/troubleshooting#conflicting-pyspark-installations</p>
<p>The solution for us has been to add <code>pyspark</code> to the <code>exclude_dependencies</code> definitions to avoid this conflict.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-21 14:57:32 UTC
    </footer>
</body>
</html>
