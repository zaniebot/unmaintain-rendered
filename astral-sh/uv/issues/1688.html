<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIP_EXTRA_INDEX_URL not used. Multiple artifacts feeds not parsed correctly. - astral-sh/uv #1688</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>PIP_EXTRA_INDEX_URL not used. Multiple artifacts feeds not parsed correctly.</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1688">#1688</a>
        opened by <a href="https://github.com/MarcSkovMadsen">@MarcSkovMadsen</a>
        on 2024-02-19 12:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MarcSkovMadsen">@MarcSkovMadsen</a> on 2024-02-19 12:31</div>
            <div class="timeline-body"><p>My team uses a <code>PIP_EXTRA_INDEX_URL</code> environment variable to point to multiple azure artifacts feeds.</p>
<p>If I try to use <code>uv</code></p>
<ul>
<li>the <code>PIP_EXTRA_INDEX_URL</code> variable seems not to be used and</li>
<li><code>--extra-index-url</code> does not work with a space separated list of artifact feeds.</li>
</ul>
<h2>Reproduce Basic Issue</h2>
<ul>
<li><code>export PIP_EXTRA_INDEX_URL=https://USER:PAT@pkgs.dev.azure.com/ORGANISATION/_packaging/FEED%40Local/pypi/simple/</code></li>
<li><code>uv pip install CUSTOM_PACKAGE</code></li>
</ul>
<pre><code class="language-bash">  × No solution found when resolving dependencies:
  ╰─▶ Because CUSTOM_PACKAGE was not found in the package registry and you require CUSTOM_PACKAGE, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>If I run</p>
<ul>
<li><code>pip install CUSTOM_PACKAGE</code> I get it installed</li>
</ul>
<h2>Issue with <code>--extra-index-url</code></h2>
<p>If I try</p>
<pre><code class="language-bash">uv pip install CUSTOM_PACKAGE --extra-index-url=$PIP_EXTRA_INDEX_URL
</code></pre>
<p>I get</p>
<pre><code class="language-bash">error: Failed to download: CUSTOM_PACKAGE==0.1.1110624
  Caused by: HTTP status client error (405 Method Not Allowed) for url (https://pkgs.dev.azure.com/ORGANISATION/_packaging/SOME_ID@ANOTHER_ID/pypi/download/CUSTOM_PACKAGE/0.1.1110624/CUSTOM_PACKAGE-0.1.1110624-py3-none-any.whl#sha256=SOME_SHA256_CODE)
</code></pre>
<p>This is the same issue as https://github.com/astral-sh/uv/issues/1371.</p>
<h2>Issue with multiple artifacts feeds</h2>
<p>In practice we use multiple azure artifacts feeds. We set <code>PIP_EXTRA_INDEX_URL</code> to a space separated list of the urls.</p>
<pre><code class="language-bash">export PIP_EXTRA_INDEX_URL=&quot;https://USER:PASSWORD@pkgs.dev.azure.com/ORGANISATION/_packaging/FEED_1%40Local/pypi/simple/ https://USER:PASSWORD@pkgs.dev.azure.com/ORGANISATION/_packaging/FEED_2/pypi/simple/&quot;
</code></pre>
<p>The <code>PIP_EXTRA_INDEX_URL</code> is again not taken into account</p>
<pre><code class="language-bash">uv pip install CUSTOM_PACKAGE
  × No solution found when resolving dependencies:
  ╰─▶ Because CUSTOM_PACKAGE was not found in the package registry and you require CUSTOM_PACKAGE, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>If I try to work around it using <code>--extra-index-url</code> i see</p>
<pre><code class="language-bash"> uv pip install CUSTOM_PACKAGE --extra-index-url=&quot;$PIP_EXTRA_INDEX_URL&quot;
error: HTTP status client error (400 Bad Request) for url (https://pkgs.dev.azure.com/ORGANISATION/_packaging/FEED_1%40Local/pypi/simple/%20https://USER:PASSWORD@pkgs.dev.azure.com/ORGANISATION/_packaging/FEED_2/pypi/simple/CUSTOM_PACKAGE/)
</code></pre>
<p>Thus <code>uv</code> does not handle multiple feeds correctly.</p>
<p>Using <code>pip</code> works</p>
<pre><code class="language-bash">pip install CUSTOM_PACKAGE --extra-index-url=&quot;$PIP_EXTRA_INDEX_URL&quot;
...
Successfully installed CUSTOM_PACKAGE-0.1.1110624.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-02-19 13:52</div>
            <div class="timeline-body"><p>FYI, for any use case other than a mirror, pip extra index url is inheriently insecure, as pip does not guarantee ordering of which index url it will read first an attacker can place a package on the other index with the same name as your internal package. This isn't theoretical, malicious packages were uploaded to PyPI that mirrored the names of packages on the pytorch index.</p>
<p>The attempt to solve this is PEP 708, but it hasn't been implemented by PyPI yet. But I would strongly advise no one use extra index url with pip unless they very specifically are hosting multiple index mirrors.</p>
<p>For uv see related discussion here: https://github.com/astral-sh/uv/issues/171</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-19 14:28</div>
            <div class="timeline-body"><p>Thanks! The env var is a duplicate of https://github.com/astral-sh/uv/issues/1535. The 401 is a duplicate of https://github.com/astral-sh/uv/issues/1458.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-19 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-02-19 14:34</div>
            <div class="timeline-body"><blockquote>
<p>The env var is a duplicate of #1535.</p>
</blockquote>
<p>FYI pip index url and pip extra index url are two different features of Pip. The latter allowing to query multiple indexes (and as I've said is inherently insecure).</p>
<p>You seem to have linked to the former and this request is about the latter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-19 14:39</div>
            <div class="timeline-body"><p>@notatallshaw - Ah sorry, I just consider it &quot;the same&quot; underlying issue, since if we add support for <code>PIP_INDEX_URL</code> via an environment variable, we'll naturally do the same for <code>PIP_EXTRA_INDEX_URL</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-02-19 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarcSkovMadsen">@MarcSkovMadsen</a> on 2024-02-19 15:54</div>
            <div class="timeline-body"><p>Thanks @charliermarsh . I don't think the two mentioned existing issues covers the &quot;Issue with multiple artifacts feeds&quot;. Would you consider and reopen if you agree. Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-19 15:59</div>
            <div class="timeline-body"><p>I can open an issue to track that — although I think the solution here is to pass <code>--extra-index-url</code> multiple times.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-19 16:01</div>
            <div class="timeline-body"><ul>
<li>https://github.com/astral-sh/uv/issues/1702</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1702.html">astral-sh/uv#1702</a> on 2024-02-19 16:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
