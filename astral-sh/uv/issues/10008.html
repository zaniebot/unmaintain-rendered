<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emit index urls in `uv export` same way as `uv pip compile --emit-index-url` - astral-sh/uv #10008</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Emit index urls in <code>uv export</code> same way as <code>uv pip compile --emit-index-url</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/10008">#10008</a>
        opened by <a href="https://github.com/Fogapod">@Fogapod</a>
        on 2024-12-18 18:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Fogapod">@Fogapod</a></div>
            <div class="timeline-body"><p>I am exporting <code>uv.lock</code> to <code>requirements.txt</code> for bazel.
I have <code>torch</code> index overrides which aren't exported and produce impossible to insall requirements file:</p>
<pre><code class="language-toml">[tool.uv.sources]
torch = [
    { index = &quot;pytorch-cpu&quot; },
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
</code></pre>
<p>results in:</p>
<pre><code>torch==2.5.1+cpu \
    --hash=sha256:4856f9d6925121d13c2df07aa7580b767f449dfe71ae5acde9c27535d5da4840 \
    --hash=sha256:a6b720410350765d3d77c01a5ce098a6c45af446284e45e87a98b8a16e7d564d
</code></pre>
<p>Looks like lock file contains index info so this should be possible:</p>
<pre><code class="language-toml">[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1+cpu&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
</code></pre>
<p>This probably isn't as simple as writing all indexes to requirements file because ordering matters. Maybe there could be a way to manually give it indexes instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ant0nsc">@ant0nsc</a> on 2024-12-20 08:09</div>
            <div class="timeline-body"><p>+1 on this issue. We have the exactly same problem with multiple indexes that contain different flavours of <code>torch</code>. It would be great to be able to export a requirements file that contains the full URL where <code>uv</code> is taking the package from.
The format of a <code>requirements.txt</code> file does support supplying the full URL: https://pip.pypa.io/en/stable/reference/requirements-file-format/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-07 19:05</div>
            <div class="timeline-body"><p>I don't think this is trivially the same as <code>uv pip compile</code> but would be interesting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @zanieb on 2025-01-07 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2025-01-07 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "feature request: emit index urls in `uv export` same way as `uv pip compile --emit-index-url`" to "Emit index urls in `uv export` same way as `uv pip compile --emit-index-url`" by @zanieb on 2025-01-07 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-02 14:20</div>
            <div class="timeline-body"><p>As a note, because this is spread out across a few threads: We can't support this because our <code>--index</code> features are not representable in <code>requirements.txt</code> files. For example, there is no way to represent index pinning or uv's index strategies. It's possible there's something we could do here, but it's an open problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/liiight">@liiight</a> on 2025-04-02 19:46</div>
            <div class="timeline-body"><p>It's understandable why <code>--index</code> feature wouldn't be implicitly representable in <code>requirements.txt</code> but that raises two questions, but if that's the case should <code>uv export</code> appear to enable the same <code>--index</code>, <code>--extra-index-url</code> or <code>--index-url</code> flags?
At the very least this is a bit confusing.</p>
<p>I would like to offer an alternative though. Like you said, index pinning is not an option in <code>requirement.txt</code>, but maybe a flag named <code>--allow-global-indexing</code> could be added to <code>uv export</code> which would allow some sort of &quot;backwards&quot; compatible exporting when required?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-02 20:48</div>
            <div class="timeline-body"><blockquote>
<p>if that's the case should uv export appear to enable the same --index, --extra-index-url or --index-url flags?</p>
</blockquote>
<p>These flags are available on all commands that may need to perform a resolution.</p>
<blockquote>
<p>maybe a flag named --allow-global-indexing could be added to uv export which would allow some sort of &quot;backwards&quot; compatible exporting when required?</p>
</blockquote>
<p>I still am not sure there's a way we can represent the desired index priority semantics.</p>
<p>I think this may broadly be fixed by PEP 517?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/liiight">@liiight</a> on 2025-04-04 04:30</div>
            <div class="timeline-body"><blockquote>
<p>These flags are available on all commands that may need to perform a resolution.</p>
</blockquote>
<p>I understand that these flags are available by default globally, but the fact that they appear to be available, yet have no affect is confusing. Maybe consider hiding them somehow from commands that they have no effect on.</p>
<blockquote>
<p>I still am not sure there's a way we can represent the desired index priority semantics.</p>
</blockquote>
<p>I imagine you're right and seeing that particular my use case is pretty straightforward, my proposed solution for a &quot;global&quot; flag is probably way too naive to represent many real world scenarios.</p>
<p>Maybe the best course of action at this time is to simply display a warning that using export will not respect the indexing priorities that is respected when using sync, since that is simply not possible, which will help reduce the element of surprise.</p>
<p>If and when enabling granular indexing is possible, then I imagine the mechanics of how to do so would be much more apparent and obvious</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kugeleis">@Kugeleis</a> on 2025-04-17 10:45</div>
            <div class="timeline-body"><p>Is there a workaround to generate a requirements.txt with entries from [tool.uv.sources]?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anton-slashm">@anton-slashm</a> on 2025-10-24 10:13</div>
            <div class="timeline-body"><blockquote>
<p>Is there a workaround to generate a requirements.txt with entries from [tool.uv.sources]?</p>
</blockquote>
<p>Try <code>uv export | uv pip install --extra-index-url https://abc.com/ -r dev/stdin</code></p>
<p>Worked for me.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:58 UTC
    </footer>
</body>
</html>
