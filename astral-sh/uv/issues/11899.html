<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better message when using aws codeartifact and token has expired - astral-sh/uv #11899</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better message when using aws codeartifact and token has expired</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11899">#11899</a>
        opened by <a href="https://github.com/waterworthd-cim">@waterworthd-cim</a>
        on 2025-03-03 02:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/waterworthd-cim">@waterworthd-cim</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We use AWS CodeArtifact as our PyPI repository. Every 12 hours the CA token expires and I have to re-auth.</p>
<p>When this happens with say poetry I get an error message, with uv I get a very misleading message, i.e.</p>
<pre><code>% uv sync
  √ó No solution found when resolving dependencies for split (python_full_version &gt;= '3.13'):
  ‚ï∞‚îÄ‚ñ∂ Because only polars[pyarrow]&lt;1.23.0 is available and your project depends on polars[pyarrow]&gt;=1.23.0, we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<p>This makes no sense - I'm using python 3.10 and &quot;only polars[pyarrow]&lt;1.23.0 is available&quot; is probable because uv has determined no version of poetry is available because the code artifact request failed due to invalid (expired) credentials.</p>
<p>Ideally it would simply bubble up the CA authentication failure exception?</p>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @waterworthd-cim on 2025-03-03 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 02:30</div>
            <div class="timeline-body"><p>Unfortunately, CodeArtifact returns a 404 when you provide invalid credentials. We have no way of differentiating &quot;The package doesn't exist on the registry&quot; from &quot;The credentials are invalid&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/waterworthd-cim">@waterworthd-cim</a> on 2025-03-03 03:43</div>
            <div class="timeline-body"><p>I get the following from poetry - it's not awesome but it's fairly clear that my credentials have expired. The main difference is the poetry says &quot;Unable to find installation candidates&quot; and uv implies there are candidates.</p>
<pre><code>Source (private): Authorization error accessing https://XXX-XXX.d.codeartifact.ap-southeast-2.amazonaws.com/pypi/pypi-cim/simple/referencing/
  - Updating botocore (1.35.97 -&gt; 1.36.6): Failed

  RuntimeError

  Unable to find installation candidates for botocore (1.36.6)

  at ~/.local/pipx/venvs/poetry/lib/python3.12/site-packages/poetry/installation/chooser.py:74 in choose_for
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 03:50</div>
            <div class="timeline-body"><p>Actually it seems like some routes are returning a 401, so now I'm confused because we do have dedicated error messages for 401s. (I think I was mixing up CodeArtifact with another registry provider when I mentioned 404s above.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-03-03 03:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 03:51</div>
            <div class="timeline-body"><p>Are you on a recent version? I get this:</p>
<pre><code>  √ó No solution found when resolving dependencies:
  ‚ï∞‚îÄ‚ñ∂ Because black was not found in the package registry and you require black, we can conclude that your requirements
      are unsatisfiable.

      hint: An index URL (https://test-XXXXXXX.d.codeartifact.us-east-2.amazonaws.com/pypi/astral/simple) could not
      be queried due to a lack of valid authentication credentials (401 Unauthorized)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @charliermarsh on 2025-03-03 03:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @charliermarsh on 2025-03-03 03:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/waterworthd-cim">@waterworthd-cim</a> on 2025-03-03 04:17</div>
            <div class="timeline-body"><p>I'm on 0.5.8 - I'll update and see if that fixes it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/waterworthd-cim">@waterworthd-cim</a> on 2025-03-03 04:19</div>
            <div class="timeline-body"><p>Oh - so I've been running an older version installed with cargo, which was hiding the newer version installed by the shell script...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 15:16</div>
            <div class="timeline-body"><p>üëç Should work as expected in newer versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-03-03 15:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:13 UTC
    </footer>
</body>
</html>
