<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pixi environment not properly detected from 0.8.18 - astral-sh/uv #16295</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pixi environment not properly detected from 0.8.18</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16295">#16295</a>
        opened by <a href="https://github.com/atonderski">@atonderski</a>
        on 2025-10-14 13:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/atonderski">@atonderski</a> on 2025-10-14 13:27</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Not sure if this is a bug or intentional but it definitely broke my workflow so I'm reporting it here.</p>
<pre><code>$ pixi run uv pip install --upgrade --system uv==0.8.18
Using Python 3.12.0 environment at: .pixi/envs/default
Resolved 1 package in 69ms
Prepared 1 package in 586ms
Uninstalled 1 package in 0.15ms
Installed 1 package in 1ms
 - uv==0.8.12
 + uv==0.8.18
$ uv pip install tqdm
error: No virtual environment found; run `uv venv` to create an environment, or pass `--system` to install into a non-virtual environment
</code></pre>
<p>but when i downgrade, it works as before, and as I expect it should work</p>
<pre><code>$ pixi run uv pip install --upgrade --system uv==0.8.17
Using Python 3.12.0 environment at: .pixi/envs/default
Resolved 1 package in 73ms
Prepared 1 package in 576ms
Uninstalled 1 package in 0.16ms
Installed 1 package in 1ms
 - uv==0.8.18
 + uv==0.8.17
$ uv pip install tqdm
Using Python 3.12.0 environment at: .pixi/envs/default
Resolved 1 package in 0.91ms
Installed 1 package in 2ms
 + tqdm==4.67.1
</code></pre>
<p>This is reproducible in a clean environment (using pixi 0.48.2)</p>
<pre><code>pixi init
pixi add python=3.12
pixi add uv=0.8.18  # or any later, tested with 0.9.2 also
pixi run uv pip install tqdm  # will complain about env
pixi add uv=0.8.17
pixi run uv pip install tqdm  # will work
</code></pre>
<h3>Platform</h3>
<p>Linux 6.12.10-76061203-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<blockquote>
<p>=0.8.18</p>
</blockquote>
<h3>Python version</h3>
<p>Python 3.12.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @atonderski on 2025-10-14 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-14 21:14</div>
            <div class="timeline-body"><p>The verbose logs are</p>
<pre><code>❯ pixi init
✔ Created /private/tmp/example/pixi.toml
❯ pixi add python=3.12
✔ Added python=3.12
❯ pixi add uv=0.8.18
✔ Added uv=0.8.18
❯ pixi run uv pip install tqdm
error: No virtual environment found; run `uv venv` to create an environment, or pass `--system` to install into a non-virtual environment
❯ pixi run uv pip install tqdm -v
DEBUG uv 0.8.18
DEBUG Searching for default Python interpreter in virtual environments
DEBUG Found `cpython-3.12.12-macos-aarch64-none` at `/private/tmp/example/.pixi/envs/default/bin/python3` (conda prefix)
DEBUG Ignoring Python interpreter at `/private/tmp/example/.pixi/envs/default/bin/python3`: system interpreter not explicitly requested
DEBUG Searching for managed installations at `/Users/zb/.local/share/uv/python`
DEBUG Found managed installation `cpython-3.14.0-macos-aarch64-none`
DEBUG Ignoring Python interpreter at `/Users/zb/.local/share/uv/python/cpython-3.14.0-macos-aarch64-none/bin/python3.14`: system interpreter not explicitly requested
DEBUG Found managed installation `cpython-3.14.0+freethreaded-macos-aarch64-none`
DEBUG Ignoring Python interpreter at `/Users/zb/.local/share/uv/python/cpython-3.14.0+freethreaded-macos-aarch64-none/bin/python3.14t`: system interpreter not explicitly requested
DEBUG Found managed installation `cpython-3.14.0rc3-macos-aarch64-none`
DEBUG Ignoring Python interpreter at `/Users/zb/.local/share/uv/python/cpython-3.14.0rc3-macos-aarch64-none/bin/python3.14`: system interpreter not explicitly requested
DEBUG Found managed installation `cpython-3.13.8-macos-aarch64-none`
DEBUG Ignoring Python interpreter at `/Users/zb/.local/share/uv/python/cpython-3.13.8-macos-aarch64-none/bin/python3.13`: system interpreter not explicitly requested
DEBUG Found `cpython-3.12.12-macos-aarch64-none` at `/private/tmp/example/.pixi/envs/default/bin/python` (first executable in the search path)
DEBUG Ignoring Python interpreter at `/private/tmp/example/.pixi/envs/default/bin/python`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/private/tmp/example/.pixi/envs/default/bin/python3`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/private/tmp/example/.pixi/envs/default/bin/python3.12`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/Users/zb/.local/bin/python3.14t`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/Users/zb/.local/bin/python3.14`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/opt/homebrew/bin/python3`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/opt/homebrew/bin/python3.11`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/opt/homebrew/bin/python3.12`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/opt/homebrew/bin/python3.13`: system interpreter not explicitly requested
DEBUG Ignoring Python interpreter at `/usr/bin/python3`: system interpreter not explicitly requested
error: No virtual environment found; run `uv venv` to create an environment, or pass `--system` to install into a non-virtual environment
</code></pre>
<p>The key being</p>
<pre><code>DEBUG Found `cpython-3.12.12-macos-aarch64-none` at `/private/tmp/example/.pixi/envs/default/bin/python3` (conda prefix)
DEBUG Ignoring Python interpreter at `/private/tmp/example/.pixi/envs/default/bin/python3`: system interpreter not explicitly requested
</code></pre>
<p>which is likely caused by https://github.com/astral-sh/uv/pull/15679</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-14 21:16</div>
            <div class="timeline-body"><p>I think this is actually correct, in that you are writing the &quot;default&quot; environment which requires the <code>--system</code> flag — the logic for determining that the environment was the default was just wrong before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/noamgot">@noamgot</a> on 2025-10-16 09:24</div>
            <div class="timeline-body"><p>Just encountered this issue on my side, glad to see that someone else opened an issue :)
@zanieb so the verdict is to use the <code>--system</code> to install in the relevant pixi (conda) environment?
My use case is similar to this pixi example: https://github.com/prefix-dev/pixi/blob/main/examples/docker/pyproject.toml</p>
<p>(it's somewhat outdated, but the idea is that I want to install a locally built package in a production environment using <code>up pip install</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-16 13:14</div>
            <div class="timeline-body"><p>Yeah, I think so. If you create and activate a non-default environment with Pixi or Conda, that opt-in is no longer required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-16 13:22</div>
            <div class="timeline-body"><p>cc @tdejager</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-10-16 13:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-10-16 13:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdejager">@tdejager</a> on 2025-10-17 15:36</div>
            <div class="timeline-body"><p>I think that marking the interpreter found at:</p>
<pre><code>DEBUG Found `cpython-3.12.12-macos-aarch64-none` at `/private/tmp/example/.pixi/envs/default/bin/python` (first executable in the search path)
DEBUG Ignoring Python interpreter at `/private/tmp/example/.pixi/envs/default/bin/python`: system interpreter not explicitly requested
</code></pre>
<p>As a system intepreter, could be incorrect.</p>
<p>To explain: like <code>uv</code> we install a version of python into what we call a prefix/environment, similar to a <code>virtualenv</code>. This environment is then activated on a <code>pixi run</code>, similar as to running an activation script in a virtual-env. Its just integrated into the command directly in pixi.</p>
<p>The <code>default</code> environment is basically the default that a user usually runs on, kind of like running <code>uv venv default</code>. So I wouldn't expect it to differ from any enviroment that can be created in pixi.</p>
<p>The question for me is that, whether or not passing in <code>--system</code> is correct depending on what is implied with a <code>--system</code> install. If this implies a global installation, then I think this a bug. If this implies a non-standalone version of python, then this may be correct. From first glance it seems incorrect though.</p>
<p>We can try fixing this in <code>uv</code> if this makes sense :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-17 15:51</div>
            <div class="timeline-body"><p>Do you feel that the <code>default</code> environment in Pixi differs from the <code>base</code> environment in Conda?</p>
<p>The intent is that you should not be able to install into unisolated environments, e.g., one that is not explicitly activated or selected, without the <code>--system</code> flag. The flag is sort of poorly named, but that's the concept underlying it.</p>
<p>There are some issues linked in https://github.com/astral-sh/uv/pull/7691 too for more context.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdejager">@tdejager</a> on 2025-10-20 12:50</div>
            <div class="timeline-body"><p>I feel that it does yeah, the <code>default</code> environment is per project and the <code>base</code> is across projects and thus your system. I think that would qualify the <code>base</code> environment as unisolated and the pixi environment as isolated. There is not a whole lot of difference to a virtual-env and a pixi-conda environment in that sense.</p>
<p>That said, looking at the linked issues, I feel that running <code>uv pip list</code> or whatever should actually prefer the uv activated venv over the <code>base</code> one. So maybe the logic needs to be rethought a bit?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-20 13:45</div>
            <div class="timeline-body"><p>Oh, actually I didn't see that the pixi environment was scoped to the project. Sorry about that.</p>
<p>The logic is definitely wrong then.</p>
<pre><code>❯ pixi run bash -c &quot;env | grep CONDA&quot;
CONDA_PREFIX=/private/tmp/example/.pixi/envs/default
CONDA_SHLVL=1
CONDA_DEFAULT_ENV=example
</code></pre>
<p>The problem is that your behavior here differs from Conda and breaks our heuristic. Specifically, the <code>CONDA_PREFIX</code> directory name differs from the <code>CONDA_DEFAULT_ENV</code> name.</p>
<p>I'm not quite sure how to repair that in a way that remains compatible with Conda. We could just special case the <code>default</code> path, but that's kind of weird.</p>
<p>You can see the whole heuristic at https://github.com/astral-sh/uv/blob/fa53a62f0b0ba264947452c42d82747c407cc8f5/crates/uv-python/src/virtualenv.rs#L80-L127</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @zanieb on 2025-10-20 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-10-20 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdejager">@tdejager</a> on 2025-10-20 14:48</div>
            <div class="timeline-body"><p>There should be <code>$CONDA_PREFIX/conda-meta/pixi</code> file that we can use to determine if its a pixi environment :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-20 14:50</div>
            <div class="timeline-body"><p>Cool that's helpful. Does Pixi ever have a Conda-style global environment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdejager">@tdejager</a> on 2025-10-20 14:51</div>
            <div class="timeline-body"><p>Not yet, you can kind of activate from a different place on your system but thats it. We'll also never have a base environment because that's a design decision we wanted to deviate from when compared to conda, i.e. it has all the downsides of a system environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-20 14:55</div>
            <div class="timeline-body"><p>Wonderful, thanks! I'll fix this then (unless you want to contribute and get to it first!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/atonderski">@atonderski</a> on 2025-10-20 15:06</div>
            <div class="timeline-body"><p>thanks guys for getting on this so quickly and happy to see you decided to fix it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-10-20 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdejager">@tdejager</a> on 2025-10-20 17:15</div>
            <div class="timeline-body"><p>If I have the time to squeeze it in this week I will :) thanks everything!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisburr">@chrisburr</a> on 2025-10-27 08:48</div>
            <div class="timeline-body"><p>I've just ran into this in the context of a custom installer that is generated using <a href="https://github.com/conda/constructor/"><code>constructor</code></a>.</p>
<p>Rather than having something pixi specific, I wonder if a better huristic for the conda base environment would be the presence of a <code>envs</code> directory in the environment's folder?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdejager">@tdejager</a> on 2025-10-27 10:19</div>
            <div class="timeline-body"><p>Good point because you can make non-global conda/micromaba environments as well. But they do move across projects more-or-less.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16585.html">astral-sh/uv#16585</a> on 2025-11-04 06:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-11-10 04:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
