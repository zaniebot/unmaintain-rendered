<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv installs incompatible wheel if `data-requires-python` isn't set  - astral-sh/uv #5475</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv installs incompatible wheel if <code>data-requires-python</code> isn&#x27;t set</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/5475">#5475</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-07-26 11:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>This bug was accidentally surfaced by packse. My local index would generate a page with missing  <code>data-requires-python</code> entry:</p>
<pre><code>    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
        &lt;head&gt;
            &lt;title&gt;Links for python-version-does-not-exist-a&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;h1&gt;Links for python-version-does-not-exist-a&lt;/h1&gt;
                 &lt;a href=&quot;/packages/python-version-does-not-exist/python_version_does_not_exist_a-1.0.0-py3-none-any.whl#sha256=bc034d134e4ecbd282692aaaa508b235cfeb0c49b4eb1d77ef86863546091a76&quot;&gt;python_version_does_not_exist_a-1.0.0-py3-none-any.whl&lt;/a&gt;&lt;br&gt;
                 &lt;a href=&quot;/packages/python-version-does-not-exist/python_version_does_not_exist_a-1.0.0.tar.gz#sha256=6a2ce117ad33c3e44a5e22eec82b81737cb43e5ac042ac103f076749d74a65da&quot;&gt;python_version_does_not_exist_a-1.0.0.tar.gz&lt;/a&gt;&lt;br&gt;
        &lt;/body&gt;
    &lt;/html&gt;
</code></pre>
<p>vs. the published entry:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta name=&quot;pypi:repository-version&quot; content=&quot;1.1&quot; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Links for python-version-does-not-exist-a&lt;/h1&gt;
    &lt;a
      href=&quot;../../files/python_version_does_not_exist_a-1.0.0-py3-none-any.whl#sha256=bc034d134e4ecbd282692aaaa508b235cfeb0c49b4eb1d77ef86863546091a76&quot;
      data-requires-python=&quot;&gt;=3.30&quot;
    &gt;
      python_version_does_not_exist_a-1.0.0-py3-none-any.whl
    &lt;/a&gt;
    &lt;br /&gt;
    &lt;a
      href=&quot;../../files/python_version_does_not_exist_a-1.0.0.tar.gz#sha256=6a2ce117ad33c3e44a5e22eec82b81737cb43e5ac042ac103f076749d74a65da&quot;
      data-requires-python=&quot;&gt;=3.30&quot;
    &gt;
      python_version_does_not_exist_a-1.0.0.tar.gz
    &lt;/a&gt;
    &lt;br /&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>The wheel itself says <code>Requires-Python: &gt;=3.30</code> in both cases, but in the first case, we would install the incompatible wheel. Specifically, this passes incorrectly:</p>
<pre><code>uv pip install python-version-does-not-exist-a==1.0.0 --index-url http://localhost:3141/simple/ --no-cache-dir --reinstall -v
</code></pre>
<p>while this fails correctly:</p>
<pre><code>uv pip install python-version-does-not-exist-a==1.0.0 --index-url https://astral-sh.github.io/packse/0.3.31/simple-html/ --no-cache-dir --reinstall -v
</code></pre>
<p>I&#x27;m not sure how to properly MRE this, but the solution is to check the METADATA for requires-python if there is no annotation from the index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-07-26 11:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-26 12:10</div>
            <div class="timeline-body"><p>This arguably seems like a bug in the index rather than in uv, hmm.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-26 12:11</div>
            <div class="timeline-body"><p>Yeah, i&#x27;m working on fixing this in packse, but i argue we should still check METADATA, at least in the same way that we check that the name of a built wheel matches the name that the user requested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-26 12:33</div>
            <div class="timeline-body"><p>pypiserver never writes <code>data-requires-python</code>: https://github.com/pypiserver/pypiserver/blob/a70b77d608cb1a86e136f7a06ab2e2b2cc871c50/pypiserver/_app.py#L314. Bug report: <a href="https://github.com/pypiserver/pypiserver/issues/296">pypiserver/pypiserver#296</a>. Stale PR: <a href="https://github.com/pypiserver/pypiserver/pull/320">pypiserver/pypiserver#320</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-26 12:33</div>
            <div class="timeline-body"><p>Makes sense. I don&#x27;t know that I&#x27;d want to check this in the resolver, but we should reject in the installer at minimum?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-27 02:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-10 01:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:32:17 UTC
    </footer>
</body>
</html>
