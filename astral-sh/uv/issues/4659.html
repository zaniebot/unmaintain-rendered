<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv tool install` should respect upgrades - astral-sh/uv #4659</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv tool install</code> should respect upgrades</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4659">#4659</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-06-30 17:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 17:06</div>
            <div class="timeline-body"><p>After running <code>cargo run tool install black==24.1.0</code>, both: (1) <code>cargo run tool install black --upgrade</code> and (2) <code>cargo run tool install black==24.2.0</code> are no-ops (&quot;Tool is already installed&quot;).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-06-30 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-06-30 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 17:08</div>
            <div class="timeline-body"><p>I can do this to familiarize myself with the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-06-30 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2024-06-30 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 22:37</div>
            <div class="timeline-body"><p>Ok this needs a bit of thought with respect to the semantics of <code>uv tool upgrade</code>, <code>uv tool install --upgrade</code>, and <code>uv tool install --reinstall</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 22:48</div>
            <div class="timeline-body"><p>Okay, here's a proposal just to give us something to workshop.</p>
<p>Given <code>uv tool install foo&lt;1.0.0 --with bar&lt;2.0.0</code>...</p>
<ul>
<li><code>uv tool install foo --reinstall</code> removes <code>bar</code> and ignores <code>&gt;=1.0.0</code> (i.e., it's as-if the tool was not installed at all).</li>
<li><code>uv tool install foo --reinstall-package foo</code> has the same sematics.</li>
<li><code>uv tool install foo --reinstall-package bar</code> reinstalls <code>bar</code> but respects the <code>&gt;=2.0.0</code> constraint.</li>
<li><code>uv tool install foo==2.0.0</code> upgrades <code>foo</code> and removes <code>bar</code> (unsure on this one).</li>
<li><code>uv tool install foo --with bar==2.0.0</code> upgrades <code>bar</code>.</li>
<li><code>uv tool install foo --with baz</code> removes <code>bar</code> and adds <code>baz</code>.</li>
<li><code>uv tool install foo --upgrade</code> upgrades <code>foo</code> and <code>bar</code>, but respects the constraints.</li>
<li><code>uv tool install foo==2.0.0 --upgrade</code> upgrades <code>foo</code> and <code>bar</code>, replacing the constraint on <code>foo</code> (unsure on this one, should <code>bar</code> be removed like in <code>uv tool install foo==2.0.0</code>).</li>
</ul>
<p>(<code>uv tool install foo --upgrade</code> and <code>uv tool upgrade foo</code> could have the same behavior.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 22:58</div>
            <div class="timeline-body"><p>Maybe the simplest framing is: if you don't pass <code>--reinstall</code>... everything is additive? So using the above example <code>uv tool install foo --with baz</code> would keep <code>foo</code> and <code>bar</code> and add <code>baz</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-01 19:24</div>
            <div class="timeline-body"><p>Another:</p>
<ul>
<li><code>uv tool install foo&lt;0.5.0</code> (so, a compatible but different requirement) would be equivalent to <code>uv tool install foo==2.0.0</code> (so, as soon as you include a requirement, it's like a reinstall).</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-07-01 22:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-02 13:07</div>
            <div class="timeline-body"><p>I'm now tempted to change the behavior to: as soon as you specify a <code>from</code> or <code>with</code> that doesn't match the receipt, we completely ignore and remove the existing receipt.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-02 14:11</div>
            <div class="timeline-body"><p>Another framing:</p>
<pre><code class="language-rust">// If the user specified `--force`, we ignore the existing receipt entirely.
//
// Otherwise, combine the requested requirements with the tool receipt. If the requirements
// changed, we allow replacement of any entrypoints.
//
// If the user specified `--reinstall` or `--upgrade`, we pass those flags to the resolver and
// also allow replacement of any entrypoints.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-02 20:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:35 UTC
    </footer>
</body>
</html>
