<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add list-scripts subcommand similar to pydoit.org or taskfile.dev - astral-sh/uv #16121</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add list-scripts subcommand similar to pydoit.org or taskfile.dev</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/16121">#16121</a>
        opened by <a href="https://github.com/scr-oath">@scr-oath</a>
        on 2025-10-03 20:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/scr-oath">@scr-oath</a> on 2025-10-03 20:33</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I use <a href="https://pydoit.org">https://pydoit.org</a> or <a href="https://taskfile.dev">https://taskfile.dev</a> in various projects as a means of declaring things that developers (or CI/CD) can do for frequent/useful tasks.</p>
<p>We recently started using or encountering uv/uvx in many places, and using console scripts to declare things to be run with <code>uv run script-name</code> e.g. It would be really nice if uv could be as helpful as other task-declaration systems by listing out the scripts and their descriptions.</p>
<p>I asked Claude Code to whip up something &quot;list-commands&quot; for my project, but it seems like this could be part of the <code>uv/uvx</code> system (converted to Rust if need be).</p>
<p>Essentially, it just examines the pyproject.toml for the commands, and then each module for its pydoc comments to pull out the first line if summary or entirety if <code>--detailed</code></p>
<pre><code class="language-python">&quot;&quot;&quot;
List available CLI commands with descriptions.

Discovers console scripts from pyproject.toml and displays their documentation.
&quot;&quot;&quot;

import click
import importlib
import inspect
import tomllib
from pathlib import Path
from typing import Optional


def get_project_root() -&gt; Path:
    &quot;&quot;&quot;Find project root by looking for pyproject.toml.&quot;&quot;&quot;
    current = Path(__file__).resolve()
    for parent in [current] + list(current.parents):
        if (parent / &quot;pyproject.toml&quot;).exists():
            return parent
    raise FileNotFoundError(&quot;Could not find pyproject.toml&quot;)


def load_console_scripts() -&gt; dict[str, str]:
    &quot;&quot;&quot;Load console scripts from pyproject.toml.&quot;&quot;&quot;
    project_root = get_project_root()
    pyproject_path = project_root / &quot;pyproject.toml&quot;

    with open(pyproject_path, &quot;rb&quot;) as f:
        config = tomllib.load(f)

    scripts = config.get(&quot;project&quot;, {}).get(&quot;scripts&quot;, {})
    return scripts


def get_command_info(module_path: str, entry_point: str) -&gt; tuple[Optional[str], Optional[str]]:
    &quot;&quot;&quot;
    Get command documentation by importing the module.

    Args:
        module_path: Module path like &quot;agentic_sales_spanner.profiling.run_profile&quot;
        entry_point: Entry point function name like &quot;main&quot;

    Returns:
        Tuple of (brief_description, full_docstring)
    &quot;&quot;&quot;
    try:
        module = importlib.import_module(module_path)
        func = getattr(module, entry_point, None)

        if func is None:
            return None, None

        # Get docstring from the function or module
        docstring = inspect.getdoc(func)
        if not docstring:
            docstring = inspect.getdoc(module)

        if not docstring:
            return &quot;No description available&quot;, None

        # Split into brief (first line) and full
        lines = docstring.strip().split(&quot;\n&quot;)
        brief = lines[0].strip()
        full = docstring.strip()

        return brief, full

    except Exception as e:
        return f&quot;Error loading: {e}&quot;, None


@click.command()
@click.option(
    &quot;--detailed&quot;,
    &quot;-d&quot;,
    is_flag=True,
    help=&quot;Show detailed descriptions for all commands&quot;
)
@click.option(
    &quot;--command&quot;,
    &quot;-c&quot;,
    type=str,
    help=&quot;Show detailed info for a specific command&quot;
)
def main(detailed: bool, command: Optional[str]):
    &quot;&quot;&quot;
    List available CLI commands with descriptions.

    Parses pyproject.toml to discover console scripts and displays their
    documentation from module/function docstrings.

    Examples:
        uv run list-commands              # Brief list of all commands
        uv run list-commands --detailed   # Detailed list of all commands
        uv run list-commands -c analyze-brief  # Details for one command
    &quot;&quot;&quot;
    try:
        scripts = load_console_scripts()
    except Exception as e:
        click.echo(f&quot;Error loading commands: {e}&quot;, err=True)
        return 1

    if not scripts:
        click.echo(&quot;No console scripts found in pyproject.toml&quot;, err=True)
        return 1

    # Filter to specific command if requested
    if command:
        if command not in scripts:
            click.echo(f&quot;Command '{command}' not found&quot;, err=True)
            click.echo(f&quot;\nAvailable commands: {', '.join(sorted(scripts.keys()))}&quot;)
            return 1
        scripts = {command: scripts[command]}
        detailed = True  # Always show details for single command

    # Show header
    if not command:
        click.echo(&quot;=&quot; * 80)
        click.echo(&quot;AVAILABLE COMMANDS&quot;)
        click.echo(&quot;=&quot; * 80)
        click.echo()

    # Collect and display commands
    commands_info = []
    for cmd_name in sorted(scripts.keys()):
        entry = scripts[cmd_name]
        module_path, entry_point = entry.split(&quot;:&quot;)
        brief, full = get_command_info(module_path, entry_point)
        commands_info.append((cmd_name, brief, full))

    if detailed:
        # Detailed format: stanzas with full docstrings
        for i, (cmd_name, brief, full) in enumerate(commands_info):
            if i &gt; 0:
                click.echo()

            click.echo(f&quot;ðŸ“¦ {cmd_name}&quot;)
            click.echo(&quot;-&quot; * 80)

            if full:
                # Format docstring nicely
                lines = full.split(&quot;\n&quot;)
                for line in lines:
                    click.echo(f&quot;  {line}&quot;)
            else:
                click.echo(f&quot;  {brief or 'No description available'}&quot;)

            click.echo()
            click.echo(f&quot;  Usage: uv run {cmd_name} [OPTIONS]&quot;)
            click.echo()
    else:
        # Brief format: table-like list
        max_cmd_len = max(len(cmd) for cmd, _, _ in commands_info)

        for cmd_name, brief, _ in commands_info:
            brief_text = brief or &quot;No description available&quot;
            # Truncate if too long
            if len(brief_text) &gt; 70:
                brief_text = brief_text[:67] + &quot;...&quot;
            click.echo(f&quot;  {cmd_name:&lt;{max_cmd_len}}  {brief_text}&quot;)

        click.echo()
        click.echo(f&quot;Total: {len(commands_info)} commands&quot;)
        click.echo()
        click.echo(&quot;Use --detailed or -d for full descriptions&quot;)
        click.echo(&quot;Use --command &lt;name&gt; or -c &lt;name&gt; for details on one command&quot;)

    return 0


if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @scr-oath on 2025-10-03 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikenerone">@mikenerone</a> on 2025-10-27 18:01</div>
            <div class="timeline-body"><p>Is this different from #5903?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
