<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv run does not use env-var in .env-file - astral-sh/uv #8862</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv run does not use env-var in .env-file</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8862">#8862</a>
        opened by <a href="https://github.com/woutervh">@woutervh</a>
        on 2024-11-06 11:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/woutervh">@woutervh</a> on 2024-11-06 11:45</div>
            <div class="timeline-body"><p>uv --version
uv 0.4.30 (61ed2a236 2024-11-04)</p>
<p>Testing .env-file support, but I can't get this to work.
Using private indexes still remains painful.</p>
<pre><code>&gt; cat .env
&gt;&gt;&gt;UV_EXTRA_INDEX_URL=&quot;https://__token__:&lt;TOKEN&gt;@gitlab.com/api/v4/groups/&lt;PROJECT_ID&gt;/-/packages/pypi/simple&quot;


&gt; uv run  --with &lt;mypackage&gt;   --verbose --env-file .env
DEBUG uv 0.4.30 (61ed2a236 2024-11-04)
DEBUG Read environment file at: `.env`
DEBUG No project found; searching for Python interpreter
DEBUG Searching for default Python interpreter in managed installations, system path, or `py` launcher
DEBUG Searching for managed installations at `...\uv\python`
DEBUG Found managed installation `cpython-3.12.5-windows-x86_64-none`
DEBUG Found `cpython-3.12.5-windows-x86_64-none` at `....\uv\python\cpython-3.12.5-windows-x86_64-none\python.exe` (managed installations)
DEBUG Using Python 3.12.5 interpreter at: ...\uv\python\cpython-3.12.5-windows-x86_64-none\python.exe
DEBUG At least one requirement is not satisfied in the base environment: &lt;mypackage&gt;
DEBUG Creating ephemeral environment
DEBUG Syncing ephemeral requirements
DEBUG Caching via interpreter: `...\uv\python\cpython-3.12.5-windows-x86_64-none\python.exe`
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.5
DEBUG Solving with target Python version: &gt;=3.12.5
DEBUG Adding direct dependency: &lt;mypackage&gt;*
DEBUG No cache entry for: https://pypi.org/simple/&lt;mypackage&gt;/
DEBUG No netrc file found
DEBUG Searching for a compatible version of &lt;mypackage&gt; (*)
DEBUG No compatible version found for: &lt;mypackage&gt;
  × No solution found when resolving `--with` dependencies:
  ╰─▶ Because &lt;mypackage&gt; was not found in the package registry and you require &lt;mypackage&gt;, we can conclude that your requirements are unsatisfiable.

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-06 15:41</div>
            <div class="timeline-body"><p>We don't read configuration for uv itself from <code>.env</code> files, the variable are passed to the subcommand called by <code>uv run</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-11-06 15:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @zanieb on 2024-11-06 15:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laermannjan">@laermannjan</a> on 2024-11-12 15:34</div>
            <div class="timeline-body"><p>Hooking on to this, since I'm also testing <code>.env</code> support and am experiencing inconsistencies. I'm not sure whether I might be misunderstanding this feature.</p>
<pre><code class="language-bash">$ uv version
uv 0.5.1 (Homebrew 2024-11-08)
</code></pre>
<p>From the documentation and https://github.com/astral-sh/uv/pull/8263 I expected that <code>uv run [COMMAND]</code> would export the env vars from <code>&lt;project_root&gt;/.env</code> if that file exists and pass them to the <code>[COMMAND]</code> (I assume that this command can be any shell command).</p>
<p>I've created a fresh project, added a <code>.env</code> and a simple script:</p>
<pre><code class="language-bash">uv init test

cd test

cat &lt;&lt;EOF &gt; .env
FOO=bar
EOF

cat &lt;&lt;EOF &gt; test.py
import os
print(os.environ.get('FOO'))
EOF
</code></pre>
<p>The steps I've taken that I had issues with</p>
<ol>
<li><code>uv run -- echo $FOO</code> displays an empty line</li>
<li><code>uv run --env-file .env -- echo $FOO</code> displays an empty line (contrary to what the docs indicate here at https://docs.astral.sh/uv/configuration/files/#env</li>
<li><code>uv run test.py</code> displays <code>None</code></li>
<li><code>uv run --env-file .env test.py</code> displays <code>bar</code> as I would have expected for all of the above</li>
</ol>
<p>Furthermore, I tried adding a private index (which is what led me down this path) by adding to my <code>pyproject.toml</code></p>
<pre><code class="language-toml">dependencies = [
    &quot;secret-project==1.2.3&quot;
]

[[tool.uv.index]]
name = &quot;secret-project&quot;
url = &quot;https://secret-project.com/simple&quot;
</code></pre>
<p>and the credentials to my <code>.env</code>:</p>
<pre><code class="language-bash">UV_INDEX_SECRET_PROJECT_USERNAME=myusername
UV_INDEX_SECRET_PROJECT_PASSWORD=mypassword
</code></pre>
<p>(as the previous steps created the venv I deleted it and cleaned the cache before moving on: <code>rm -rf .venv &amp;&amp; uv cache clean</code>)</p>
<ol>
<li><code>uv sync</code> fails with a <code>error: Failed to prepare distributions</code> caused by 401 authentication error when trying to fetch <code>secret-project</code> - I would have really liked this to work out of the box, but expected this to fail due to how the <code>.env</code> support was described.</li>
<li><code>uv run uv sync</code> and <code>uv run -- uv sync</code> both fail for the same reason as <code>1.</code>. which I didn't expect.</li>
<li><code>uv run</code> fails for the same reason as <code>1.</code> and <code>2.</code></li>
<li><code>uv run --env-file .env</code> creates the venv successfully and install <code>secret-project</code> from the private index. Note that if you had run <code>uv run --env-file .env -- echo $UV_INDEX_SECRET_PROJECT_USERNAME</code> instead, it would have also successfully created the venv, but not display the env var.</li>
</ol>
<p>So it seems to me that the env vars aren't passed to the subprocess as described and <code>uv run</code> doesn't load <code>.env</code> by default. Also it seems I cannot install/update my deps with <code>uv sync</code> in my case, but only with the workaround of using <code>uv run --env-file .env</code> to leverage it's automatic syncing.</p>
<p>Additionally, I would have expected <code>uv sync</code> to respect <code>.env</code> as well. Since I am defining the index in the project's <code>pyproject.toml</code>, I would assume that most people would like to define their credentials in the <code>.env</code> along with other their tokens. Just my two cents.</p>
<p>Please, let me know if what I described above is actually working as intended and I'm just misusing <code>uv</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-12 17:08</div>
            <div class="timeline-body"><p>Thanks for your comment. A few clarifications:</p>
<ol>
<li><code>uv run --env-file .env -- echo $FOO</code> can never work -- it's a mistake in the docs. Your shell evaluates <code>$FOO</code> there before it's passed to uv, so it's just not possible for uv to replace it in that context.</li>
<li>We don't load <code>.env</code> files by default. You must pass <code>--env-file</code>. (Do the docs say we read them by default somewhere?)</li>
<li>The <code>.env</code> file only affects the command that <code>uv run</code> runs. It doesn't affect uv itself. We may expand that in the future, but the intent in this initial implementation is that uv itself shouldn't be configured by <code>.env</code> files. So things like <code>UV_INDEX_SECRET_PROJECT_PASSWORD</code> wouldn't have any effect, but something like configuring your database port via a <code>PORT</code> variable would.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laermannjan">@laermannjan</a> on 2024-11-13 09:40</div>
            <div class="timeline-body"><p>Thanks for the quick response.</p>
<blockquote>
<p>We don't load .env files by default. You must pass --env-file. (Do the docs say we read them by default somewhere?)</p>
</blockquote>
<p>In https://github.com/astral-sh/uv/pull/8263 which is referenced in the changelog it says:</p>
<blockquote>
<p>The behaviour is as follows:</p>
<ol>
<li>uv run file.py executes file.py using the .env (if it exists).</li>
<li>[...]</li>
<li>uv run --no-env-file file.py skips reading the .env file.</li>
</ol>
</blockquote>
<p>The docs say:</p>
<blockquote>
<p>To disable dotenv loading (e.g., to override UV_ENV_FILE or the --env-file command-line argument), set the UV_NO_ENV_FILE environment variable to 1, or pass the--no-env-file flag to uv run.</p>
</blockquote>
<p>Which I interpreted as loading is enabled by default, so I can disable it like this, but I realize I probably didn't read that sentence carefully enough.</p>
<p>And in the linked PR's thread there are talks about this being an opt-out feature.</p>
<p>So all of this made me assume it would load <code>.env</code> files by default and I had to opt-out via <code>UV_NO_ENV_FILE</code> or <code>--no-env-file</code>. Having to specify <code>--env-file</code> or <code>UV_ENV_FILE</code> makes it opt-in, doesn't it?</p>
<hr />
<blockquote>
<p>The .env file only affects the command that uv run runs. It doesn't affect uv itself. We may expand that in the future, but the intent in this initial implementation is that uv itself shouldn't be configured by .env files. So things like UV_INDEX_SECRET_PROJECT_PASSWORD wouldn't have any effect, but something like configuring your database port via a PORT variable would.</p>
</blockquote>
<p>Thanks for clarifying. Having read this, I still don't understand why <code>uv run --env-file .env -- uv sync</code> wouldn't work, isn't <code>uv sync</code> the command being run by <code>uv run</code> and should be affected by the <code>.env</code> loading? Or put differently, why would <code>uv run</code>'s auto-sync work, but not the one invoked by me manually in <code>uv run --env-file .env -- uv sync</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-13 16:42</div>
            <div class="timeline-body"><p>Thanks @laermannjan. So I think the docs are generally correct -- #8263 initially merged with the behavior as opt-out, but we changed it to opt-in prior to releasing. I can see how it's confusing.</p>
<blockquote>
<p>Having read this, I still don't understand why <code>uv run --env-file .env -- uv sync</code> wouldn't work...</p>
</blockquote>
<p>I think I <em>would</em> expect this to work. Let me try it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-13 16:44</div>
            <div class="timeline-body"><p>In my testing <code>uv run --env-file .env -- uv sync --verbose</code> does work as expected. I set <code>UV_INDEX_URL=https://test.pypi.org</code> in <code>.env</code>, and the verbose logging indicates that it read from the Test PyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laermannjan">@laermannjan</a> on 2024-11-19 13:50</div>
            <div class="timeline-body"><p>Sorry for the late reply.</p>
<p>This does work as expected. I actually had set <code>UV_INDEX_SECRET_PROJECT_PASSWORD=$ANOTHER_ENV_VAR</code>, which caused the 401 error and made me believe the <code>.env</code> file wasn't loaded .<code>ANOTHER_ENV_VAR</code> was defined further up the <code>.env</code> file, which worked fine with other tools I had used, but apparently not with <code>uv</code>.</p>
<p>My bad. Thanks for troubleshooting with me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-19 14:04</div>
            <div class="timeline-body"><p>No prob, thanks for following up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9940.html">astral-sh/uv#9940</a> on 2024-12-16 22:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thanhlq">@thanhlq</a> on 2025-06-07 02:49</div>
            <div class="timeline-body"><p>For me, I got a very strange problem, when I changed variable in .env file, the uv does not reload the changed variable after a re-run i.e. uv run --env-file .env python app/api</p>
<p>I workarounded by: open a new terminal -&gt; OK</p>
<p>The point is: the same problem if I use dotenv</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-07 04:50</div>
            <div class="timeline-body"><p>@thanhlq sounds like the variable is set in your shell? We prefer variables in the current environment over environment files, so, e.g., if you do <code>export FOO=1</code> that will always override <code>FOO</code> defined in a <code>.env</code> file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LazoYoung">@LazoYoung</a> on 2025-09-01 01:37</div>
            <div class="timeline-body"><p>I'm honestly curious why uv took the opt-in approach for loading .env while Docker and others read them by default.
IMO having to run <code>uv run --env-file .env -- uv sync</code> just to sync the project with private registry doesn't look convenient at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-01 02:46</div>
            <div class="timeline-body"><p>I don't think it's that common for tools that can run arbitrary code to read <code>.env</code> credentials by default. Node and Deno do not, for example. Docker doesn't either -- you might be thinking of Docker Compose? Which is very different, since it's just injecting variables into a declarative build file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/quasipedia">@quasipedia</a> on 2025-09-25 13:09</div>
            <div class="timeline-body"><p>I'm no expert about what is common or not out there, but as a regular Joe, I find the opt-in for this feature <em>very</em> (and I really mean: <em>very</em>, I spent 20 minutes &quot;debugging why it did not work&quot;!) counter-intuitive.</p>
<p>For one I find this pattern <strong>completely redundant</strong>. I posit that the possibility to load environment variables from a <code>.env</code> file is <em>already</em> per se opt-in: no <code>.env</code> file → no env variables loaded. Having to <em>both</em> create the file <em>and</em> pass it to the command, is like having to tell somebody something and then having to reapeat it again 30 seconds later because they were not paying attention. Simply annoying and a waste of time.</p>
<p>For seconds I find it <strong>adds user friction</strong>. My expectation is to set-up my many projects only once and then run the same set of standardised commands (like <code>uv run main</code>) on all of them.  I do not want having to remember for each project I maintain whether or not that particular one needs a set of environment variables or not.</p>
<p>For thirds, if the intent is to prevent the accidental running of a series of variables meant for a different environment, I find that this patterns <strong>adds absolutely no value</strong>.  If for some project an opt-in strategy is really needed, a much more semantically meaningful way to do that would be to name the env file something else than <code>.env</code>.  Call your file <code>.env-production</code> instead, this way it will never be loaded by default and you'll be forced to pass it as a param when you are in production.</p>
<p>Just my 2¢.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ductri">@ductri</a> on 2025-11-15 20:50</div>
            <div class="timeline-body"><p>I completely agree with @quasipedia . This is a very poor design choice.
This askes users to repeatedly &quot;activate&quot; certain environment variables every time they resume their work on the project.
And I believe that a large number of projects need customize environment variables.</p>
<p>Why wouldn't we just ask users to declare these env variables once, forget about them, and run everything via the standard <code>uv run</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16926.html">astral-sh/uv#16926</a> on 2025-12-02 10:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-02 10:43</div>
            <div class="timeline-body"><p>I'm going to close this in favor of #16926 which has a bit more targeted of a topic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-12-02 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16964.html">astral-sh/uv#16964</a> on 2025-12-03 13:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:23 UTC
    </footer>
</body>
</html>
