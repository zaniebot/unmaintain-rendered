<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support https://astral.sh/uv/install.sh running as Nobody - astral-sh/uv #8242</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support https://astral.sh/uv/install.sh running as Nobody</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8242">#8242</a>
        opened by <a href="https://github.com/VirtualTim">@VirtualTim</a>
        on 2024-10-16 06:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/VirtualTim">@VirtualTim</a></div>
            <div class="timeline-body"><p>I would like to use uv as a jenkins action, similar to https://github.com/astral-sh/setup-uv.
When I'm running inside a docker container, Jenkins runs as <code>Nobody</code> (specifically <code>-u 1000:1000</code>).
<code>$HOME</code> evaluates to <code>/</code>, which I do not have permission to write to.</p>
<p>It seems like I can get things working by running:</p>
<pre><code class="language-sh">export CARGO_HOME=$WORKSPACE/cargo
export HOME=$CARGO_HOME/uv
curl -LsSf https://astral.sh/uv/install.sh | sh -s -- -v --no-modify-path
export UV_CACHE_DIR=$CARGO_HOME/.cache/uv
</code></pre>
<p>I have concerns about how future-proof this is. Is the file written to <code>$HOME/.config/uv/uv-receipt.json</code> important?
Is this likely to cause other things to break?
It would be nice if I could install this without having to temporarily modify <code>$HOME</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by @charliermarsh on 2024-10-16 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">releases</span> added by @charliermarsh on 2024-10-16 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-16 19:41</div>
            <div class="timeline-body"><p>In the next release, you should be able to set <code>UV_UNMANAGED_INSTALL</code> to the exact location you want to use, without a receipt: https://opensource.axo.dev/cargo-dist/book/installers/usage.html#receipt. It seems like a good fit for your use-case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-16 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-16 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VirtualTim">@VirtualTim</a> on 2024-10-17 04:43</div>
            <div class="timeline-body"><p>Awesome. Thanks for the quick response, and for updating the documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VirtualTim">@VirtualTim</a> on 2024-10-18 09:03</div>
            <div class="timeline-body"><p>@charliermarsh I just tried out uv 0.4.23 and 0.4.24, and I still need to modify <code>HOME</code>.
Installing like this works fine:</p>
<pre><code class="language-sh">export CARGO_HOME=$WORKSPACE/cargo
export UV_UNMANAGED_INSTALL=$CARGO_HOME/uv
export UV_CACHE_DIR=$CARGO_HOME/.cache/uv
curl -LsSf https://astral.sh/uv/install.sh | sh -s -- -v --no-modify-path
</code></pre>
<p>However when I attempt to setup a venv I get the following error:</p>
<pre><code class="language-sh">uv venv --python 3.13
  x failed to create directory `/.local/share/uv/python`
  `-&gt; Permission denied (os error 13)
</code></pre>
<p>same command with a modified <code>$HOME</code>:</p>
<pre><code class="language-sh">export HOME=$(pwd)
uv venv --python 3.13
Using CPython 3.13.0
Creating virtual environment at: .venv
</code></pre>
<p>Should I create a separate issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 18:01</div>
            <div class="timeline-body"><p>@VirtualTim -- That looks a bit different. You may need to set <code>UV_PYTHON_INSTALL_DIR</code> if you want the <code>python</code> installs to go elsewhere (see: https://docs.astral.sh/uv/configuration/environment/).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VirtualTim">@VirtualTim</a> on 2024-10-21 03:29</div>
            <div class="timeline-body"><p>I'm now running with:</p>
<pre><code class="language-sh">export UV_UNMANAGED_INSTALL=$WORKSPACE/cargo
export UV_PYTHON_INSTALL_DIR=$UV_UNMANAGED_INSTALL/python
export UV_CACHE_DIR=$CARGO_HOME/.cache/uv
export uv=$UV_UNMANAGED_INSTALL/uv
curl -LsSf https://astral.sh/uv/install.sh | sh -s -- -v

$uv venv --python 3.13
</code></pre>
<p>This all seems to work as expected.
I would have expected <code>UV_PYTHON_INSTALL_DIR</code> to default to somewhere under <code>UV_CACHE_DIR</code>.</p>
<p>It might be a good idea to add the defaults to the documentation (I also see <code>UV_UNMANAGED_INSTALL</code> is missing).</p>
<hr />
<p>On an unrelated note, I really appreciate this tool. My use-case is that I want to run tests against a cross-platform SDK. I have ~10 different platforms to test on. These tests are written in Python. Managing Python (and dependency) versions would normally be a huge headache, but now I can just run uv in my build scripts, and my environment is set up. Now updating python versions across VMs/docker images/OSs is as simple as just changing one number in a Jenkinsfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VirtualTim">@VirtualTim</a> on 2024-10-21 03:43</div>
            <div class="timeline-body"><p>Also, if you'd like, I could add a quick guide here https://docs.astral.sh/uv/guides/ on how to run as Nobody?
The guide would basically just be a copy/paste of the snippet I commented above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 13:35</div>
            <div class="timeline-body"><p>I don't think is a common enough use-case to cover in the top-level guides. I'd definitely appreciate some content on it though. If you put up a pull request with the content I can try to figure out where it fits.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:27:44 UTC
    </footer>
</body>
</html>
