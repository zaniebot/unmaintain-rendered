```yaml
number: 10617
title: "`uv run` with PyTorch dependency works inline, but not for a script"
type: issue
state: closed
author: thedch
labels: []
assignees: []
created_at: 2025-01-14T23:16:20Z
updated_at: 2025-01-15T00:20:42Z
url: https://github.com/astral-sh/uv/issues/10617
synced_at: 2026-01-10T01:57:24Z
```

# `uv run` with PyTorch dependency works inline, but not for a script

---

_Issue opened by @thedch on 2025-01-14 23:16_

I read https://docs.astral.sh/uv/guides/integration/pytorch -- and I'm trying to get a script to run with a PyTorch dependency. It seems to work inline, but not with the actual script file.

```
❯ uv run --python 3.12 --with "torch>=2.0,numpy" python
Installed 11 packages in 251ms
Python 3.12.8 (main, Dec  6 2024, 19:42:06) [Clang 18.1.8 ] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import torch ; torch.__version__
'2.5.1'

❯ cat test.py
# /// script
# requires-python = ">=3.12"
# dependencies = [
#     "torch>=2.0",
#     "numpy",
# ]
# [[tool.uv.index]]
# name = "pytorch-cpu"
# url = "https://download.pytorch.org/whl/cpu"
# explicit = true
# ///

import torch
print(torch.__version__)

❯ uv run test.py
Reading inline script metadata from `test.py`
  × No solution found when resolving script dependencies:
  ╰─▶ Because only the following versions of torch are available:
          torch<=2.0.0
          torch==2.0.1
          torch==2.1.0
          torch==2.1.1
          torch==2.1.2
          torch==2.2.0
          torch==2.2.1
          torch==2.2.2
          torch==2.3.0
          torch==2.3.1
          torch==2.4.0
          torch==2.4.1
          torch==2.5.0
          torch==2.5.1
      and torch>=2.0.0,<=2.4.1 has no wheels with a matching Python ABI tag, we can conclude that torch>=2.0.0,<=2.4.1 cannot be used.
      And because torch>=2.5.0 has no wheels with a matching platform tag and you require torch>=2.0, we can conclude that your requirements are unsatisfiable.

❯ uv version
uv 0.5.18 (Homebrew 2025-01-11)
```

I get the same error with or without the `[[tool.uv.index]]` bit. This is on MacOS, and I just want the CPU version, so based on my reading of the docs, this should work I believe. Let me know if I'm doing something obviously wrong or if you have any tips - thanks!

---

_Comment by @charliermarsh on 2025-01-14 23:39_

Does passing `--python 3.12` work? It might be attempting to resolve for Python 3.13. (We have better error messages for this in the next release.)

---

_Comment by @thedch on 2025-01-15 00:16_

@charliermarsh running `uv run test.py --python 3.12` unfortunately gives the same error, but changing the header to 

```
# /// script
# requires-python = ">=3.12, <3.13"
# dependencies = [
#     "torch>=2.0",
#     "numpy",
# ]
# ///
```

resolves the issue! Great catch, thanks so much

---

_Closed by @thedch on 2025-01-15 00:16_

---

_Comment by @charliermarsh on 2025-01-15 00:20_

Ahhh you need to put `--python 3.12` _before_ `test.py`. Otherwise, it's considered an argument to `test.py`, rather than to `uv run`.

---
