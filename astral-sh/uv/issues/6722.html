<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync --no-install-package` without pyproject.toml - astral-sh/uv #6722</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv sync --no-install-package</code> without pyproject.toml</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6722">#6722</a>
        opened by <a href="https://github.com/sbidoul">@sbidoul</a>
        on 2024-08-27 21:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbidoul">@sbidoul</a></div>
            <div class="timeline-body"><p>On the same theme as #6685 and #6573, but easier to solve?</p>
<p>Since the package name is provided on the CLI and also present in uv.lock, there should be no need to read pyproject.toml at all?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 21:15</div>
            <div class="timeline-body"><blockquote>
<p>Since the package name is provided on the CLI...</p>
</blockquote>
<p>Do you mean, if you use <code>uv sync --package</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-27 21:15</div>
            <div class="timeline-body"><p>Similar to #6573, part of the complexity is that we use the <code>pyproject.toml</code> to determine the root directory of the workspace. We'd need to use the <code>uv.lock</code> to encode this instead, just in this case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-27 21:15</div>
            <div class="timeline-body"><p>I think the thought is <code>--no-install-package my-root-package</code> (or any other package)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 21:16</div>
            <div class="timeline-body"><p>Ohh I see. I think I'd rather that we put the workspace root in <code>uv.lock</code>, and then allow <code>uv sync</code> or <code>uv sync --package</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 21:20</div>
            <div class="timeline-body"><p>Honestly it would be easy to support <code>uv sync --package</code>, and users could pass the workspace root, but I know that's a little tedious.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-08-27 21:29</div>
            <div class="timeline-body"><p>To clarify, my use case is still the dependencies-only layer of a Dockerfile.
It sill itches me a little bit to have to copy pyproject.toml in addition to uv.lock.</p>
<p><code>uv sync --no-install-package my-root-package --frozen</code> seemed quite close to it: as you mentioned in https://github.com/astral-sh/uv/issues/6573#issuecomment-2308381467 that pyproject.toml is used only to obtain the package name, I assumed it was not necessary since in the case of <code>--no-install-package</code>, the package name is known upfront from the CLI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 23:18</div>
            <div class="timeline-body"><p>Yeah it bothers me too. I think we can fix it holistically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 23:47</div>
            <div class="timeline-body"><p>I guess one challenging case is: you're workspace is rooted at <code>root</code>, and you're at <code>root/packages/foo</code>. Normally, if you ran <code>uv sync</code>, we'd sync <code>foo</code>. But if we don't have any <code>pyproject.toml</code> etc., we have no way of knowing that you're in that workspace member. So <code>uv sync --frozen</code> would have to sync the workspace root instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-28 02:00</div>
            <div class="timeline-body"><p>The other strange piece is that you lose any configuration defined in <code>pyproject.toml</code>. (Just documenting things I notice as I work on this.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-08-28 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-08-28 03:33</div>
            <div class="timeline-body"><p>Ah, and extras may also influence the design. What if, for instance, I want to seed the dependencies of my root package but only some of it's optional dependencies?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-28 12:38</div>
            <div class="timeline-body"><p>@charliermarsh that seems particularly problematic :/ we don't really want to copy all those into the lock do we?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-28 12:59</div>
            <div class="timeline-body"><blockquote>
<p>Ah, and extras may also influence the design. What if, for instance, I want to seed the dependencies of my root package but only some of it's optional dependencies?</p>
</blockquote>
<p>This would work as expected, I think, since we store this information in the lock.</p>
<blockquote>
<p>that seems particularly problematic :/ we don't really want to copy all those into the lock do we?</p>
</blockquote>
<p>No, I don't think so. The situation we're at now is we still require the root <code>pyproject.toml</code> but none of the members (as of my PR last night).</p>
<p>I think we <em>can</em> support not requiring the <code>pyproject.toml</code> at all, but users would need to copy it over if they had configuration defined in there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @zanieb on 2024-09-15 22:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/legraphista">@legraphista</a> on 2024-10-22 15:38</div>
            <div class="timeline-body"><p>To add to @sbidoul usecase:</p>
<blockquote>
<p>To clarify, my use case is still the dependencies-only layer of a Dockerfile. It sill itches me a little bit to have to copy pyproject.toml in addition to uv.lock.</p>
</blockquote>
<p>Because we need to copy the <code>pyproject.toml</code> over alongside the <code>uv.lock</code> in the Dockerfile</p>
<pre><code class="language-Dockerfile">COPY ./pyproject.toml ./pyproject.toml
COPY ./uv.lock ./uv.lock
RUN uv sync --no-install-package --no-cache --frozen --no-dev
</code></pre>
<p>every time we update the version number, the previous cached layer containing the dependencies is invalidated, even though <code>uv.lock</code> hasn't changed.</p>
<p>This is not that big deal for projects that are light on dependencies, but for projects that use ML workloads, re-installing and duplicating ~5GBs of dependencies every time the version changes is wasteful.</p>
<hr />
<p>For anyone looking for a solution in the meantime, export the dependencies to <code>requirement.txt</code> via <code>uv export</code> and use that.</p>
<pre><code class="language-shell">echo &quot;--extra-index-url https://{...}/simple&quot; &gt; requirements.txt
uv export --format requirements-txt --no-hashes --no-editable --no-dev &gt;&gt; requirements.txt
</code></pre>
<pre><code class="language-Dockerfile">COPY ./requirements.txt ./requirements.txt
RUN pip install --no-cache-dir -r ./requirements.txt
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sobolevn">@sobolevn</a> on 2025-01-14 12:46</div>
            <div class="timeline-body"><p>The solution provided by @legraphista works, but it is a bit of a hack. It also requires to add this action on <code>pre-commit</code> / build step.</p>
<p>That's one of the missing features that stops me from addopting <code>uv</code> (along side with <code>dependabot</code> support).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2025-02-04 16:22</div>
            <div class="timeline-body"><p>I can suggest a different solution which works <code>uv sync</code> natively:</p>
<ol>
<li>Set <code>project.dynamic = [&quot;version&quot;]</code>  (extend to include <a href="https://hatch.pypa.io/1.12/config/metadata/#configuring-project-metadata">other fields</a> if needed):</li>
</ol>
<pre><code class="language-toml">[project]
dynamic = [&quot;version&quot;]
</code></pre>
<ol start="2">
<li>Configure your build system (it's defined in <code>[build-system]</code>) to dynamically fill the value for this field instead of hard-coding it in <code>pyproject.toml</code>. <a href="https://hatch.pypa.io/1.12/version/#configuration">Here</a> is how this can be achieved with Hatch (<code>uv</code>'s default build system).</li>
</ol>
<pre><code class="language-toml">[tool.hatch.version]
path = &quot;src/your_lib/_version.py&quot;
</code></pre>
<p>This <code>_version.py</code> file can contain any logic for setting the <code>version</code> variable (for example, reading it from an environment variable).</p>
<hr />
<p>This will decouple <code>pyproject.toml</code> from the ever changing <code>version</code> value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sobolevn">@sobolevn</a> on 2025-02-04 16:36</div>
            <div class="timeline-body"><p>@danielgafni yes, this works for <code>version</code>, but it does not work for tools that also store configuration in <code>pyproject.toml</code> like <code>ruff</code> / <code>black</code> / etc. You can create custom files for all tools, but it requires a different layout.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2025-02-04 17:04</div>
            <div class="timeline-body"><p>Oh right. I mean some tools have their own config files (like <code>ruff.toml</code>) too, but conceptually that's still a problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/twmht">@twmht</a> on 2025-04-13 03:09</div>
            <div class="timeline-body"><blockquote>
<p>To add to <a href="https://github.com/sbidoul">@sbidoul</a> usecase:</p>
<blockquote>
<p>To clarify, my use case is still the dependencies-only layer of a Dockerfile. It sill itches me a little bit to have to copy pyproject.toml in addition to uv.lock.</p>
</blockquote>
<p>Because we need to copy the <code>pyproject.toml</code> over alongside the <code>uv.lock</code> in the Dockerfile</p>
<p>COPY ./pyproject.toml ./pyproject.toml
COPY ./uv.lock ./uv.lock
RUN uv sync --no-install-package --no-cache --frozen --no-dev
every time we update the version number, the previous cached layer containing the dependencies is invalidated, even though <code>uv.lock</code> hasn't changed.</p>
<p>This is not that big deal for projects that are light on dependencies, but for projects that use ML workloads, re-installing and duplicating ~5GBs of dependencies every time the version changes is wasteful.</p>
<p>For anyone looking for a solution in the meantime, export the dependencies to <code>requirement.txt</code> via <code>uv export</code> and use that.</p>
<p>echo &quot;--extra-index-url https://{...}/simple&quot; &gt; requirements.txt
uv export --format requirements-txt --no-hashes --no-editable --no-dev &gt;&gt; requirements.txt
COPY ./requirements.txt ./requirements.txt
RUN pip install --no-cache-dir -r ./requirements.txt</p>
</blockquote>
<p>I'm currently encountering the same problem. The version numbers in my pyproject.toml are being updated within the CI/CD pipeline. This leads to cache misses and increases the size of my Docker image with each build. Is there a way to make uv sync --frozen --no-install-project only look at uv.lock and ignore pyproject.toml?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-14 12:27</div>
            <div class="timeline-body"><p>Yeah we do want to support this. It's entirely possible, it just requires some refactoring.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaens">@jaens</a> on 2025-05-09 16:53</div>
            <div class="timeline-body"><p>It's possible to do this fully in Docker right now with a bit of duct tape, because Docker itself can also run <code>uv export</code>.</p>
<p>Example:</p>
<pre><code class="language-dockerfile">FROM ... AS base
# ... base image commands

FROM base AS uv-freeze

COPY pyproject.toml uv.lock .
RUN uv export --format requirements-txt --no-hashes --no-editable --no-dev &gt; requirements.txt &amp;&amp; \
  touch -t 202001010000 requirements.txt
  # Docker hates reproducible builds, I think

FROM base AS uv-install

COPY --from=uv-freeze requirements.txt .
RUN uv venv &amp;&amp; uv pip install --requirements=requirements.txt

# proceed with your venv...
# (either directly or if you need this workaround, probably copying it into yet another stage)
</code></pre>
<p>Might be nice to wrap this into a prettier package though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/osemenovsky">@osemenovsky</a> on 2025-09-24 15:13</div>
            <div class="timeline-body"><p>Hello, is this being worked on?
We have the same problem with the docker build cache being invalidated every time we change the version in pyproject.toml. Granted, uv is very fast so it's not a huge problem as far as build time goes, but it does take registry space and we'd like to be able to use uv without the hacks provided in this thread.
So far I'm on the fence between just generating a pyproject.toml file specifically to install dependencies and using the requirements.txt export method, but i'd rather not have to do any of those things.</p>
<p>EDIT: temporarily solved the issue by generating a dummy pyproject.toml instead of COPYing it:</p>
<pre><code class="language-Dockerfile">RUN cat &gt; pyproject.toml &lt;&lt;EOF
[project]
name = 'project-name'
dynamic = ['version']
EOF

COPY uv.lock ./
ENV UV_PROJECT_ENVIRONMENT=/usr/local
RUN uv sync --frozen --inexact
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:35 UTC
    </footer>
</body>
</html>
