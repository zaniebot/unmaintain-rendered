```yaml
number: 12746
title: "Avoid showing `Updating...` for no-op Git operations like checkout of immutable references"
type: issue
state: closed
author: sbidoul
labels:
  - help wanted
  - cache
  - cli
assignees: []
created_at: 2025-04-08T15:27:05Z
updated_at: 2025-06-15T10:46:34Z
url: https://github.com/astral-sh/uv/issues/12746
synced_at: 2026-01-12T16:01:11Z
```

# Avoid showing `Updating...` for no-op Git operations like checkout of immutable references

---

_@sbidoul_

### Summary

Assume this requirements.txt:

```
pip-test-package @ git+https://github.com/pypa/pip-test-package@5547fa909e83df8bd743d3978d6667497983a4b7
```

`uv pip install -r requirements.txt` systematically shows `Updating https://github.com/pypa/pip-test-package (5547fa909e83df8bd743d3978d6667497983a4b7)`

Since this is an immutable commit sha, I expect this to be cached and the git update to be avoided on subsequent invocations.

I am under the impression that this is a regression (possibly a couple of months old), but I am not sure. If it would help I can try to bisect.

### Platform

linux

### Version

0.6.13

### Python version

3.13.2

---

_Label `bug` added by @sbidoul on 2025-04-08 15:27_

---

_Comment by @charliermarsh on 2025-04-08 15:35_

`Updating https://github.com/pypa/pip-test-package (5547fa909e83df8bd743d3978d6667497983a4b7)` doesn't meant that it's fetching anything (necessarily). It just means that it's ensuring that the commit is checked out.

---

_Comment by @sbidoul on 2025-04-08 15:49_

Yes, it is not rebuilding, but it is reaching to the network, right? My impression is that it did not do that before. And it ~should not~ could avoid it since the commit sha is immutable and cached.

For a ~550 lines `requirements.txt` (from a `pip freeze`)  of which ~150 git refs, with a pre-installed venv and warm cache, `uv pip install -r requirements.txt --no-deps` runs in 6.8 sec. The same 400 non-git refs install in much less than one second.


---

_Comment by @sbidoul on 2025-04-08 15:54_

It also gives the feeling to be exponentially slower as it progresses through the git requirements. The presence or absence of `--no-deps` does not influence that.

---

_Comment by @charliermarsh on 2025-04-08 16:13_

No, it should not be reaching out to the network. But we can take a look.

---

_Label `cache` added by @zanieb on 2025-04-08 17:07_

---

_Label `bug` removed by @zanieb on 2025-04-08 17:07_

---

_Label `performance` added by @zanieb on 2025-04-08 17:07_

---

_Comment by @zanieb on 2025-04-08 17:09_

```
‚ùØ echo "pip-test-package @ git+https://github.com/pypa/pip-test-package@5547fa909e83df8bd743d3978d6667497983a4b7" | uv pip compile -  
...
‚ùØ echo "pip-test-package @ git+https://github.com/pypa/pip-test-package@5547fa909e83df8bd743d3978d6667497983a4b7" | uv pip compile - --offline
    Updated https://github.com/pypa/pip-test-package (5547fa909e83df8bd743d3978d6667497983a4b7)
Resolved 1 package in 27ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - --offline
pip-test-package @ git+https://github.com/pypa/pip-test-package@5547fa909e83df8bd743d3978d6667497983a4b7
```

It doesn't seem like it fetches? 

```
‚ùØ echo "pip-test-package @ git+https://github.com/pypa/pip-test-package@5547fa909e83df8bd743d3978d6667497983a4b7" | uv pip compile - --offline --no-cache
   Updating https://github.com/pypa/pip-test-package (5547fa909e83df8bd743d3978d6667497983a4b7)                                                                                                                                 √ó Failed to download and build `pip-test-package @ git+https://github.com/pypa/pip-test-package@5547fa909e83df8bd743d3978d6667497983a4b7`
  ‚îú‚îÄ‚ñ∂ Git operation failed
  ‚îú‚îÄ‚ñ∂ failed to clone into: /var/folders/6p/k5sd5z7j31b31pq4lhn0l8d80000gn/T/.tmp6bbbma/git-v0/db/298ec4ed5e011efe
  ‚îú‚îÄ‚ñ∂ failed to fetch branch, tag, or commit `5547fa909e83df8bd743d3978d6667497983a4b7`
  ‚ï∞‚îÄ‚ñ∂ Remote Git fetches are not allowed because network connectivity is disabled (i.e., with `--offline`)
```

---

_Comment by @charliermarsh on 2025-04-08 17:32_

(I think we should avoid showing "Updated" in these cases, by the way.)

---

_Comment by @zanieb on 2025-04-08 17:42_

Seems kind of annoying, but doable üëç 

---

_Label `performance` removed by @zanieb on 2025-04-08 17:42_

---

_Label `cli` added by @zanieb on 2025-04-08 17:42_

---

_Renamed from "uv pip install not caching immutable git refs" to "Avoid showing `Updating...` for no-op Git operations like checkout of immutable references" by @zanieb on 2025-04-08 17:42_

---

_Label `help wanted` added by @zanieb on 2025-04-08 17:42_

---

_Comment by @zanieb on 2025-04-08 17:43_

Happy to address the performance concern too, if you can demonstrate it.

---

_Comment by @sbidoul on 2025-04-08 19:58_

Ah, I found why it starts fast but then gets slower. Maybe it is not doing git fetches, but it seems it's doing GitHub API calls that are getting rate limited.

With `uv -v pip install -r requirements.txt --no-deps` the first tens of git requirements go fast but then I see logs like this:

```
DEBUG Transient request failure for: https://api.github.com/repos/acsone/stock-logistics-workflow/commits/de85e5a9c39f02ba7a40bbc4ac42be81b3bfa241
DEBUG GitHub API request failed for: https://api.github.com/repos/acsone/stock-logistics-workflow/commits/de85e5a9c39f02ba7a40bbc4ac42be81b3bfa241 (429 Too Many Requests)
DEBUG Fetching source distribution from Git: https://github.com/acsone/stock-logistics-workflow.git
DEBUG Acquired lock for `https://github.com/acsone/stock-logistics-workflow`
DEBUG Updating Git source `https://github.com/acsone/stock-logistics-workflow.git`
   Updating https://github.com/acsone/stock-logistics-workflow.git (de85e5a9c39f02ba7a40bbc4ac42be81b3bfa241)
    Updated https://github.com/acsone/stock-logistics-workflow.git (de85e5a9c39f02ba7a40bbc4ac42be81b3bfa241)
DEBUG Released lock at `/tmp/uvcache2/git-v0/locks/c2d863b829adef9c`
```


---

_Comment by @zanieb on 2025-04-08 20:05_

Oh interesting, we should be skipping that?

https://github.com/astral-sh/uv/blob/1ff7265e8af5b4db23d18ab4606765f2ad23809e/crates/uv-git/src/git.rs#L747-L784

---

_Comment by @zanieb on 2025-04-08 20:06_

I feel like @charliermarsh recently touched this in #10803 ‚Äî not sure if it's relevant.

---

_Comment by @zanieb on 2025-04-08 20:10_

Let's track that bug in

- #12760 

and the general problem of 429s in

- #12761 



---

_Comment by @sbidoul on 2025-06-15 10:46_

I confirm this is resolved in 0.7.13, via #13748. Thanks!

---

_Closed by @sbidoul on 2025-06-15 10:46_

---
