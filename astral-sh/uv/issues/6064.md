```yaml
number: 6064
title: "uv 0.2.36 regression - `uv pip compile --universal` gives contradictory versions of same packages"
type: issue
state: closed
author: notatallshaw-gts
labels:
  - bug
  - resolver
assignees: []
created_at: 2024-08-13T17:52:04Z
updated_at: 2024-08-15T15:50:02Z
url: https://github.com/astral-sh/uv/issues/6064
synced_at: 2026-01-10T01:57:13Z
```

# uv 0.2.36 regression - `uv pip compile --universal` gives contradictory versions of same packages

---

_Issue opened by @notatallshaw-gts on 2024-08-13 17:52_

uv 0.2.36 can give contradictory versions of the same package with the following command:
```
$ echo -e "pylint\ndill==0.3.1.1" | uv pip compile - --universal --python-version 3.11 --annotation-style line 2>/dev/null | grep "pylint=="
```

In uv 0.2.35 the output is:
```
pylint==2.15.8
```

In uv 0.2.36 the output is:
```
pylint==2.15.8
pylint==3.2.6
```

It seems `pylint==3.2.6` is not correctly filtered out as belonging to a Python version not compatible, if we switch `--python-version` to `3.10` we can see the markers that are applied when they are relevant:

```
$ echo -e "pylint\ndill==0.3.1.1" | uv pip compile - --universal --python-version 3.10 --annotation-style line 2>/dev/null | grep "pylint=="
pylint==2.15.8 ; python_version >= '3.11'
pylint==3.2.6 ; python_version < '3.11'
```

---

_Comment by @zanieb on 2024-08-13 17:53_

Presuming this is 0.2.36?

---

_Renamed from "uv 0.2.26 regression - `uv pip compile --universal` gives contradictory versions of same packages" to "uv 0.2.36 regression - `uv pip compile --universal` gives contradictory versions of same packages" by @notatallshaw-gts on 2024-08-13 17:53_

---

_Comment by @charliermarsh on 2024-08-13 17:54_

Thanks! I think this is related to #6059.

---

_Comment by @notatallshaw-gts on 2024-08-13 17:54_

> Presuming this is 0.2.36?

Yeah, fixed post to correct typo

---

_Label `bug` added by @zanieb on 2024-08-13 17:56_

---

_Label `resolver` added by @zanieb on 2024-08-13 17:56_

---

_Comment by @charliermarsh on 2024-08-13 23:40_

Taking a look now.

---

_Comment by @charliermarsh on 2024-08-13 23:46_

I think the problem here is:

- We end up solving an irrelevant fork (`python_version < 3.11`), because we don't test for `requires-python` disjointness.
- In the lockfile, we discard any markers that aren't relevant for the current Python version, so we throw out the markers from the irrelevant fork.

If you remove that block (e.g., the whole `petgraph.retain_edges(|graph, edge| !graph[edge].is_false())`) piece, the resolution is correct:

```
# This file was autogenerated by uv via the following command:
#    uv pip compile req.in --universal --python-version 3.11 -n
astroid==2.13.5 ; python_version >= '3.11'
    # via pylint
astroid==3.2.4 ; python_version < '3.11'
    # via pylint
colorama==0.4.6 ; sys_platform == 'win32'
    # via pylint
dill==0.3.1.1
    # via
    #   -r req.in
    #   pylint
isort==5.13.2
    # via pylint
lazy-object-proxy==1.10.0 ; python_version >= '3.11'
    # via astroid
mccabe==0.7.0
    # via pylint
platformdirs==4.2.2
    # via pylint
pylint==2.15.8 ; python_version >= '3.11'
    # via -r req.in
pylint==3.2.6 ; python_version < '3.11'
    # via -r req.in
tomlkit==0.13.0
    # via pylint
wrapt==1.16.0 ; python_version >= '3.11'
    # via astroid
```

---

_Comment by @charliermarsh on 2024-08-13 23:53_

I think we should remove that block from `graph.rs`, and instead ensure that all the markers we see at that point have _already_ been simplified based on `requires-python`.

---

_Referenced in [astral-sh/uv#6076](../../astral-sh/uv/pulls/6076.md) on 2024-08-14 01:00_

---

_Closed by @charliermarsh on 2024-08-15 15:50_

---

_Closed by @charliermarsh on 2024-08-15 15:50_

---
