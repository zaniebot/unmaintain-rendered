<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv freezes vcs subdirectory requirements in non-roundtrippable format - astral-sh/uv #1931</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv freezes vcs subdirectory requirements in non-roundtrippable format</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1931">#1931</a>
        opened by <a href="https://github.com/mqudsi">@mqudsi</a>
        on 2024-02-23 18:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mqudsi">@mqudsi</a> on 2024-02-23 18:53</div>
            <div class="timeline-body"><p><em>Apologies in advance if I'm missing something as I'm primarily a low-level (rust + others) dev and speaking from a position of little production Python experience here.</em></p>
<p>Installing a package via the <code>vcs+https://</code> protocol and specifying both a revision and a subdirectory results in a subsequent <code>uv pip freeze</code> output that seems to include the entry in a human-readable rather than machine-parseable format. If piped to <code>requirements.txt</code> then fed back into either <code>uv</code> or <code>pip</code> (<code>[uv] pip install -r requirements.txt</code>), this always fails to install as it does not understand the syntax.</p>
<p>Reproduction:</p>
<pre><code>uv pip install insightface@git+https://github.com/deepinsight/insightface.git#subdirectory=python-package@
01a34cd94f7b0f4a3f6c84ce4b988668ad7be329
</code></pre>
<p>Resulting in</p>
<pre><code>&gt; uv pip freeze | tee requirements.txt | grep insightface
insightface==0.7.3 (from git+https://github.com/deepinsight/insightface.git@01a34cd94f7b0f4a3f6c84ce4b988668ad7be329#subdirectory=python-package)
</code></pre>
<p>Attempting to install the generated <code>requirements.txt</code> with <code>pip</code> results in the following error:</p>
<pre><code>ERROR: Invalid requirement: 'insightface==0.7.3 (from git+https://github.com/deepinsight/insightface.git@01a34cd94f7b0f4a3f6c84ce4b988668ad7be329#subdirectory=python-package)' (from line 15 of requirements.txt)
Hint: It looks like a path. File 'insightface==0.7.3 (from git+https://github.com/deepinsight/insightface.git@01a34cd94f7b0f4a3f6c84ce4b988668ad7be329#subdirectory=python-package)' does not exist.
</code></pre>
<p>while attempting to install with <code>uv</code> also fails:</p>
<pre><code>error: Couldn't parse requirement in `requirements.txt` at position 248
  Caused by: Trailing `(from git+https://github.com/deepinsight/insightface.git@01a34cd94f7b0f4a3f6c84ce4b988668ad7be329#subdirectory=python-package)` is not allowed
insightface==0.7.3 (from git+https://github.com/deepinsight/insightface.git@01a34cd94f7b0f4a3f6c84ce4b988668ad7be329#subdirectory=python-package)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</code></pre>
<p>whereas it seems that a <code>requirements.txt</code> entry in the following format is supported by both <code>pip</code> and <code>uv pip</code>:</p>
<pre><code>insightface@git+https://github.com/deepinsight/insightface.git@01a34cd94f7b0f4a3f6c84ce4b988668ad7be329#subdirectory=python-package
</code></pre>
<p>so presumably this is what <code>uv pip freeze</code> should emit?</p>
<hr />
<p>Running <code>uv</code> v0.1.10 and <code>pip</code> v23.3.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-23 18:56</div>
            <div class="timeline-body"><p>üëç This is a bug. There's another issue for it somewhere...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-23 18:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-23 18:58</div>
            <div class="timeline-body"><p>Can't find it, so we'll just track this here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mqudsi">@mqudsi</a> on 2024-02-23 18:59</div>
            <div class="timeline-body"><p>Thanks for confirming I wasn't holding it wrong!
(fwiw I wasn't able to find anything with a quick search before creating this issue either.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-23 19:01</div>
            <div class="timeline-body"><p>I swear it's somewhere :joy: But it might be buried.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-23 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-23 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mqudsi">@mqudsi</a> on 2024-02-24 16:45</div>
            <div class="timeline-body"><p>I was going to submit a PR for this myself, but tbh would not have figured out the test harness changes you implemented in #1936. Thanks for the fix!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-24 17:50</div>
            <div class="timeline-body"><p>No prob, thanks for reporting @mqudsi!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:43:04 UTC
    </footer>
</body>
</html>
