<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bad behavior when combining `UV_PYTHON_INSTALL_MIRROR` and `--python-downloads-json-url` - astral-sh/uv #17005</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>bad behavior when combining <code>UV_PYTHON_INSTALL_MIRROR</code> and <code>--python-downloads-json-url</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17005">#17005</a>
        opened by <a href="https://github.com/MeitarR">@MeitarR</a>
        on 2025-12-05 21:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MeitarR">@MeitarR</a></div>
            <div class="timeline-body">Summary
<p><code>UV_PYTHON_INSTALL_MIRROR</code> was first. Then we added <code>python-downloads-json-url</code>.</p>
<p>If the URL is modified in the provided JSON <strong>and</strong> <code>UV_PYTHON_INSTALL_MIRROR</code> is also provided, there is an error.</p>
<pre><code>➜   ✗ cat ./a.json
{
  &quot;cpython-3.13.5-linux-x86_64-gnu&quot;: {
    &quot;name&quot;: &quot;cpython&quot;,
    &quot;arch&quot;: {
      &quot;family&quot;: &quot;x86_64&quot;,
      &quot;variant&quot;: null
    },
    &quot;os&quot;: &quot;linux&quot;,
    &quot;libc&quot;: &quot;gnu&quot;,
    &quot;major&quot;: 3,
    &quot;minor&quot;: 13,
    &quot;patch&quot;: 5,
    &quot;prerelease&quot;: &quot;&quot;,
    &quot;url&quot;: &quot;https://internal.com/20250723/cpython-3.13.5%2B20250723-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz&quot;,
    &quot;sha256&quot;: &quot;f7ac16748be2674ec14df532a3e48d0c6f215017b537f14ca3feb837dbe86292&quot;,
    &quot;variant&quot;: null,
    &quot;build&quot;: &quot;20250723&quot;
  }
}
➜  ✗ UV_PYTHON_INSTALL_MIRROR=https://asdasd.com/ uv python install 3.13.5 --python-downloads-json-url ./a.json -vv
DEBUG uv 0.9.15
TRACE Checking lock for `/home/meitar/.local/share/uv/python` at `/home/meitar/.local/share/uv/python/.lock`
DEBUG Acquired lock for `/home/meitar/.local/share/uv/python`
TRACE Found existing installation cpython-3.14.0-linux-x86_64-gnu
TRACE Found existing installation cpython-3.13.2-linux-x86_64-gnu
TRACE Found existing installation cpython-3.13.1-linux-x86_64-gnu
TRACE Found existing installation cpython-3.12.2-linux-x86_64-gnu
TRACE Found existing installation cpython-3.11.12-linux-x86_64-gnu
TRACE Found existing installation cpython-3.9.21-linux-x86_64-gnu
DEBUG Using request timeout of 30s
TRACE Found `ld` path: /lib64/ld-linux-x86-64.so.2
TRACE stdout output from `ld`: &quot;&quot;
TRACE stderr output from `ld`: &quot;/lib64/ld-linux-x86-64.so.2: missing program name\nTry &#x27;/lib64/ld-linux-x86-64.so.2 --help&#x27; for more information.\n&quot;
TRACE Tried to find musl version by running `&quot;/lib64/ld-linux-x86-64.so.2&quot;`, but failed: Could not find musl version in output of: `/lib64/ld-linux-x86-64.so.2`
TRACE Tried to find libc version from possible symlink at &quot;/lib64/ld-linux-x86-64.so.2&quot;, but failed: Failed to find glibc version in the filename of linker: `../lib/x86_64-linux-gnu/ld-linux-x86-64.so.2`
TRACE stdout output from `ld.so --version`: &quot;ld.so (Ubuntu GLIBC 2.39-0ubuntu8.6) stable release version 2.39.\nCopyright (C) 2024 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE.\n&quot;
TRACE Found manylinux 2.39 in stdout of ld.so version
DEBUG No installation found for request `3.13.5 (cpython-3.13.5-linux-x86_64-gnu)`
DEBUG Found download `cpython-3.13.5-linux-x86_64-gnu` for request `3.13.5 (cpython-3.13.5-linux-x86_64-gnu)`
TRACE Considering retry of error: Mirror(&quot;UV_PYTHON_INSTALL_MIRROR&quot;, &quot;https://internal.com/20250723/cpython-3.13.5%2B20250723-x86_64-unknown-linux-gnu-install_only_stripped.tar.gz&quot;)
TRACE Cannot retry error: Neither an IO error nor a reqwest error
error: Failed to install cpython-3.13.5-linux-x86_64-gnu
  Caused by: A mirror was provided via `UV_PYTHON_INSTALL_MIRROR`, but the URL does not match the expected format: UV_PYTHON_INSTALL_MIRROR
DEBUG Released lock at `/home/meitar/.local/share/uv/python/.lock`
</code></pre>
<p>Now I saw people leave the URL in the json as the original and use the <code>UV_PYTHON_INSTALL_MIRROR</code> to set the real URL in the offline environment.</p>
<p>I think that this is not the intended way, and probably <code>python-downloads-json-url</code> should take precedence over <code>UV_PYTHON_INSTALL_MIRROR</code> (and the value of <code>UV_PYTHON_INSTALL_MIRROR</code> should be ignored with a warning)</p>
Platform
<ul>
<li></li>
</ul>
Version
<p>0.9.15</p>
Python version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MeitarR">@MeitarR</a> on 2025-12-05 21:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:41:14 UTC
    </footer>
</body>
</html>
