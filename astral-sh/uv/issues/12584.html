<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for PEP 751 lockfiles - astral-sh/uv #12584</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for PEP 751 lockfiles</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12584">#12584</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-03-31 13:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p><a href="https://discuss.python.org/t/pep-751-one-last-time/77293/150">PEP 751</a> is officially accepted.</p>
<p>Today, the PEP 751-style <code>pylock.toml</code> files are not sufficient to replace <code>uv.lock</code>. The biggest limitation is that there&#x27;s no support for arbitrary entrypoints to the graph, because <code>pylock.toml</code> includes a fixed marker for each package entry rather than recording a graph of dependencies. Specifically, this means <code>uv run -p</code> could not be supported (i.e., we couldn&#x27;t support installing a specific subset of the graph) within the standard.</p>
<p>Notably, though, unlike <code>requirements.txt</code>, <code>pylock.toml</code> also supports extras and dependency groups by extending the PEP 508 marker syntax. So markers can now express things like &quot;this extra was enabled&quot; or &quot;this dependency group was enabled&quot;. As such, we <em>could</em> potentially use PEP 751-style <code>pylock.toml</code> files for single-member workspaces. I don&#x27;t think this is worth the complexity right now, but it is possible.</p>
<p>So for now, from uv&#x27;s perspective, we can think of PEP 751-style <code>pylock.toml</code> files as a more modern <code>requirements.txt</code>. A <code>pylock.toml</code> file captures a set of packages to install, along with the source of those packages. Unlike <code>requirements.txt</code>, the format is fully standardized, and it can also model certain pieces of information that <code>requirements.txt</code> cannot (e.g., you can specify a package as coming from a specific registry).</p>
<p>As a first step, we want to support PEP 751-style <code>pylock.toml</code> files as an export format in <code>uv export</code>, and as an installable format in <code>uv pip install</code>. Like <code>uv pip install --group</code>, we may want to see how pip chooses to support these files before implementing <code>uv pip install</code> support. This requires:</p>
<ul>
<li>Adding code to translate <code>uv.lock</code> to <code>pylock.toml</code> in <code>uv export</code>.</li>
<li>Supporting <code>pylock.toml</code> as a dependency source for <code>uv pip install</code>, or maybe <em>just</em> <code>uv pip sync</code>?</li>
<li>Extending our PEP 508 implementation to understand the new <code>extras</code> and <code>dependency-groups</code> markers.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-31 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-03-31 13:58</div>
            <div class="timeline-body"><ul>
<li><a href="https://peps.python.org/pep-0751/">PEP 751 â€“ A file format to record Python dependencies for installation reproducibility</a><ul>
<li><a href="https://peps.python.org/pep-0751/#additions-to-marker-expression-syntax">Additions to Marker Expression Syntax</a></li>
</ul>
</li>
<li><a href="https://peps.python.org/pep-0508/">PEP 508 - Dependency specification for Python Software Packages</a></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BenediktMaag">@BenediktMaag</a> on 2025-04-01 10:23</div>
            <div class="timeline-body"><p>Since this PEP contains packages.index may i propose to add functionality for uv add (--script) for the lockfile to solve #11053</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-01 12:53</div>
            <div class="timeline-body"><p>Yes, exporting to PEP 751 would solve that issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2025-04-01 14:46</div>
            <div class="timeline-body"><blockquote>
<p>The biggest limitation is that there&#x27;s no support for arbitrary entrypoints to the graph, because <code>pylock.toml</code> includes a fixed marker for each package entry rather than recording a graph of dependencies.</p>
</blockquote>
<p>Any insight why this limitation was deemed out of the scope for that PEP?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-01 14:48</div>
            <div class="timeline-body"><p>Yeah, it was discussed at length but it was ultimately decided that it was adding too much complexity for a first draft / version of the spec. uv is also the only tool that supports this IIUC which made it hard to motivate standardizing around it right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2025-04-01 14:51</div>
            <div class="timeline-body"><p>Is there an effort to work on a version 2 that would add support for it?ðŸ˜…</p>
<p>Do you have some plans on how to select when both lock files are present or what would UV lock generate by default? In the long term obviously, as this ticket says that we&#x27;ll only support it via export.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-01 14:54</div>
            <div class="timeline-body"><p>There isn&#x27;t yet, but there should be eventually. It was made fairly clear in the DPO discussion that if there <em>is</em> a Version 2 with support for these kinds of features, the expectation is that the PEP would need to be authored and driven by tooling authors (uv, Poetry, PDM, etc.).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/polothy">@polothy</a> on 2025-04-04 15:39</div>
            <div class="timeline-body"><blockquote>
<p>Supporting pylock.toml as a dependency source for uv pip install, or maybe just uv pip sync?</p>
</blockquote>
<p>Please support <code>uv pip install</code> to support the <a href="https://docs.astral.sh/uv/guides/integration/aws-lambda/#deploying-a-zip-archive">Lambda zip bundling workflow</a>. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-04 17:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/benwebber">@benwebber</a> on 2025-04-10 17:13</div>
            <div class="timeline-body"><p>We use <code>uv pip compile</code> to compile <code>requirements.txt</code> files instead of using <code>uv</code> lock files. Will it be possible to compile <code>pylock.toml</code> files directly from <code>pyproject.toml</code>, without generating a <code>uv</code> lock file and exporting it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-10 17:15</div>
            <div class="timeline-body"><p>Yeah I think so. I expect <code>uv pip compile</code> and <code>uv export</code> to both support it as an output format.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Add support for PEP 751&quot; to &quot;Add support for PEP 751 lockfiles&quot; by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-11 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-18 13:05</div>
            <div class="timeline-body"><p>The initial <code>uv export</code> support is here: <a href="https://github.com/astral-sh/uv/pull/12955">astral-sh/uv#12955</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-21 23:10</div>
            <div class="timeline-body"><p><code>uv export</code>, <code>uv pip compile</code>, <code>uv pip sync</code>, and <code>uv pip install</code> will support <code>pylock.toml</code> in the next release:</p>
<ul>
<li>https://github.com/astral-sh/uv/pull/12955</li>
<li>https://github.com/astral-sh/uv/pull/12992</li>
<li>https://github.com/astral-sh/uv/pull/13019</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-21 23:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-21 23:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-21 23:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LecrisUT">@LecrisUT</a> on 2025-11-24 16:21</div>
            <div class="timeline-body"><p>Sorry for the random comment on this closed issue, but what is the workflow with <code>PEP751</code>? It seems that <code>uv.lock</code> is still generated, but then what should we add to the git repo? Is/Can we make the <code>pylock.toml</code> be prioritized over any local <code>uv.lock</code> file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-24 16:44</div>
            <div class="timeline-body"><p><code>uv.lock</code> is a lot more powerful than <code>pylock.toml</code>, and carries a lot of required metadata required by uv. We support <code>pylock.toml</code> as output format of a resolution and as input for installation, but uv can&#x27;t make reliable incremental changes to it, for which we need <code>uv.lock</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LecrisUT">@LecrisUT</a> on 2025-11-24 16:52</div>
            <div class="timeline-body"><p>So for the time being do we have to checkout both <code>uv.lock</code> and <code>pylock.toml</code>, or is <code>pylock.toml</code> enough and we can gitignore <code>uv.lock</code>. The most important part though, if the repository updates <code>pylock.toml</code> through something like renovate, is that picked up by uv (and maybe depending on IDE support) and a re-sync is done to update the user&#x27;s <code>uv.lock</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Fak3">@Fak3</a> on 2025-12-02 16:45</div>
            <div class="timeline-body"><p>Is there any detailed info on what is missing from pylock.toml that prevents using it instead of uv.lock?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-12-02 16:51</div>
            <div class="timeline-body"><p>AFAIK workspaces is the main thing that&#x27;s not standardised yet and supported by uv.lock</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-02 17:10</div>
            <div class="timeline-body"><p>There&#x27;s a lot of resolver details that need to be preserved for being able to incrementally change an existing lockfile, this isn&#x27;t about a specific field, it&#x27;s about the resolver strategies (https://docs.astral.sh/uv/reference/internals/resolver/). We&#x27;d need to specify how a universal resolver works, including the marker forks that uv uses, the aforementioned workspaces, exclude-newer, freshness checks, the fork strategy, prerelease handling and required environments. Some that can be carried in a tool specific table, but if tools don&#x27;t have the same understanding about how resolvers work, having them edit the same <code>pylock.toml</code> leads to a lot of churn with different resolution strategies as well as conflicts over unsupported features, ultimately leading to a worse user experience than with <code>uv.lock</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:02 UTC
    </footer>
</body>
</html>
