<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyArrow Cannot Write ORC File After Building Venv with UV - astral-sh/uv #12720</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PyArrow Cannot Write ORC File After Building Venv with UV</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/12720">#12720</a>
        opened by <a href="https://github.com/kahemker">@kahemker</a>
        on 2025-04-07 16:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kahemker">@kahemker</a> on 2025-04-07 16:03</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I would like to migrate a project from conda to uv and it appears that when uv builds the environment, pyarrow can no longer write orc files that include datetimes with timezones.</p>
<p><a href="https://github.com/kahemker/pyarrow-orc-failure">I created a minimum reproducible example here.</a></p>
<p>Steps to recreate the problem.</p>
<ol>
<li>Clone the repo</li>
<li>Run uv sync to install polars and pyarrow using pyproject.toml</li>
<li>Run uv run main.py</li>
</ol>
<p>The error message is</p>
<pre><code>Traceback (most recent call last):
  File &quot;W:\code\test_pyarrow\main.py&quot;, line 21, in &lt;module&gt;
    main()
  File &quot;W:\code\test_pyarrow\main.py&quot;, line 17, in main
    writer.write(df.to_arrow().cast(table_schema))
  File &quot;W:\code\test_pyarrow\.venv\Lib\site-packages\pyarrow\orc.py&quot;, line 289, in write
    self.writer.write(table)
  File &quot;pyarrow\\_orc.pyx&quot;, line 439, in pyarrow._orc.ORCWriter.write
  File &quot;pyarrow\\error.pxi&quot;, line 92, in pyarrow.lib.check_status
pyarrow.lib.ArrowException: Unknown error: Time zone file /usr/share/zoneinfo/GMT does not exist. Please install IANA time zone database and set TZDIR env.
</code></pre>
<p>You can build the working conda environment by following these steps (again starting from the minimum reproducible example)</p>
<ol>
<li>conda env create -f environment.yml</li>
<li>conda activate test_pyarrow_conda</li>
<li>python main.py</li>
</ol>
<p>The code will terminate successfully and the test.orc.snappy file will exist in the directory.</p>
<h3>Platform</h3>
<p>Windows 10 Pro, Version 10.0.19045, 64-bit</p>
<h3>Version</h3>
<p>uv 0.6.12 (e4e03833f 2025-04-02)</p>
<h3>Python version</h3>
<p>Python 3.12.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @kahemker on 2025-04-07 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-07 20:00</div>
            <div class="timeline-body"><p>Thanks for the report. Does this work with <code>pip</code> instead of uv? / is it specific to uv-managed Python versions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kahemker">@kahemker</a> on 2025-04-09 14:54</div>
            <div class="timeline-body"><p>I don't know why I did not try that first.  I just tried to create the environment with venv and pip, same issue.</p>
<p>This must not be a UV issue.  I found some notes that pyarrow needs C++ redistributables installed on Windows and this PC appears to have out of date versions.  Maybe conda is installing that software within it's environment.</p>
<p>I will try to recreate this problem on my personal computer where I have full admin rights to add/remove software.  Will try to report back tonight</p>
<p>On Mon, Apr 7, 2025, at 4:01 PM, Zanie Blue wrote:</p>
<blockquote>
<p>Thanks for the report. Does this work with <code>pip</code> instead of uv? / is it specific to uv-managed Python versions?</p>
<p>—
Reply to this email directly, view it on GitHub <a href="https://github.com/astral-sh/uv/issues/12720#issuecomment-2784489991">https://github.com/astral-sh/uv/issues/12720#issuecomment-2784489991</a>, or unsubscribe <a href="https://github.com/notifications/unsubscribe-auth/AIMELLANTIMUMYCTW33IAUD2YLKQPAVCNFSM6AAAAAB2UAGY22VHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDOOBUGQ4DSOJZGE">https://github.com/notifications/unsubscribe-auth/AIMELLANTIMUMYCTW33IAUD2YLKQPAVCNFSM6AAAAAB2UAGY22VHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDOOBUGQ4DSOJZGE</a>.
You are receiving this because you authored the thread.Message ID: <em><strong>@</strong></em>.***&gt;</p>
<p>zanieb<em>zanieb</em> left a comment (astral-sh/uv#12720) <a href="https://github.com/astral-sh/uv/issues/12720#issuecomment-2784489991">https://github.com/astral-sh/uv/issues/12720#issuecomment-2784489991</a>
Thanks for the report. Does this work with <code>pip</code> instead of uv? / is it specific to uv-managed Python versions?</p>
<p>—
Reply to this email directly, view it on GitHub <a href="https://github.com/astral-sh/uv/issues/12720#issuecomment-2784489991">https://github.com/astral-sh/uv/issues/12720#issuecomment-2784489991</a>, or unsubscribe <a href="https://github.com/notifications/unsubscribe-auth/AIMELLANTIMUMYCTW33IAUD2YLKQPAVCNFSM6AAAAAB2UAGY22VHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDOOBUGQ4DSOJZGE">https://github.com/notifications/unsubscribe-auth/AIMELLANTIMUMYCTW33IAUD2YLKQPAVCNFSM6AAAAAB2UAGY22VHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDOOBUGQ4DSOJZGE</a>.
You are receiving this because you authored the thread.Message ID: <em><strong>@</strong></em>.***&gt;</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kahemker">@kahemker</a> on 2025-04-10 01:15</div>
            <div class="timeline-body"><p>I will report this issue to the pyarrow team, see what kinds of ideas they have.  Not really sure what is going on.  I will close this issue out now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kahemker on 2025-04-10 01:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
