<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` doesn't run setup.py unless it is manually touched/modified - astral-sh/uv #17360</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv sync</code> doesn't run setup.py unless it is manually touched/modified</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17360">#17360</a>
        opened by <a href="https://github.com/kunaltyagi">@kunaltyagi</a>
        on 2026-01-08 14:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kunaltyagi">@kunaltyagi</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I can not list extension files under <code>tool.setuptools.ext-modules</code> in <code>pyproject.toml</code> for uv to track, so I expect <code>uv sync</code> to take extra time on every call to see if <code>setup.py</code> needs to update any extension. However, even when there's work to be done, <code>uv sync</code> doesn't call <code>setup.py</code> unless I <code>touch</code>/modify it specifically.</p>
<p>Any solution/fix would be appreciated</p>
<h3>Platform</h3>
<p>Linux and Windows</p>
<h3>Version</h3>
<p>0.9.5</p>
<h3>Python version</h3>
<p>3.12.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @kunaltyagi on 2026-01-08 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2026-01-08 14:40</div>
            <div class="timeline-body"><p>Please see https://docs.astral.sh/uv/reference/settings/#cache-keys</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2026-01-08 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2026-01-08 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2026-01-08 16:04</div>
            <div class="timeline-body"><p>I don't think <code>dir</code> is working as expected. Files changed under the directory don't trigger a call to <code>setup.py</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-08 18:19</div>
            <div class="timeline-body"><p>Can you provide a minimal reproducible example for how it fails?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2026-01-14 09:04</div>
            <div class="timeline-body"><p>Let me create one</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2026-01-14 09:31</div>
            <div class="timeline-body"><details>
<summary>pyproject.toml</summary>

<pre><code class="language-toml">[project]
name = &quot;test_uv&quot;
version = &quot;0.1.0&quot;
description = &quot;Test UV&quot;
readme = &quot;README.md&quot;
requires-python = &quot;==3.12.*&quot;
dependencies = [
]
classifiers = [&quot;Private :: Do Not Upload&quot;]

[build-system]
requires = [
  &quot;cmake&quot;,
  &quot;setuptools&quot;,
]
build-backend = &quot;setuptools.build_meta&quot;

[tool.setuptools]
packages = [&quot;test_uv&quot;]

[tool.setuptools.package-dir]
test_uv = &quot;src/test_uv&quot;

[tool.uv]
cache-keys = [{ dir = &quot;csrc&quot; }, {file = &quot;setup.py&quot;}, { file = &quot;pyproject.toml&quot; }]
</code></pre>
</details>

<details>
<summary>setup.py</summary>

<pre><code class="language-py">from setuptools import Extension, setup

print(&quot;****** Start setup.py ********&quot;)

setup(
    ext_modules=[
        Extension(
            name=&quot;foo&quot;,
            sources=[&quot;csrc/foo.c&quot;],
        ),
    ]
)

print(&quot;****** End setup.py ********&quot;)
</code></pre>
</details>

<details>
<summary>Setup the structure</summary>

<pre><code class="language-bash">touch README.md
mkdir -p src/test_uv
touch src/test_uv/__init__.py
mkdir -p csrc
</code></pre>
</details>

<pre><code class="language-sh">echo &quot;&quot; &gt; csrc/foo.c # to give a simple target
uv sync # everything works
echo &quot;a&quot; &gt; csrc/foo.c # should make it not compile, BUT
uv sync # no error in ~0.1ms
touch setup.py # uv will try to compile it now
uv sync  # see errors
</code></pre>
<p>Sample output:</p>
<pre><code>k@machine:~/test_uv$ uv sync
Resolved 1 package in 1ms
      Built test-uv @ file:///home/kuntyagi/test_uv
Prepared 1 package in 773ms
Uninstalled 1 package in 0.38ms
Installed 1 package in 1ms
 ~ test-uv==0.1.0 (from file:///home/kuntyagi/test_uv)
k@machine:~/test_uv$ echo &quot;a&quot; &gt; csrc/foo.c # should make it not compile, BUT
k@machine:~/test_uv$ uv sync # no error in ~0.1ms
Resolved 1 package in 1ms
Audited 1 package in 0.13ms
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kunaltyagi">@kunaltyagi</a> on 2026-01-19 15:05</div>
            <div class="timeline-body"><p>I think this should be marked as a &quot;bug&quot; now, and not a question?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-19 15:29:23 UTC
    </footer>
</body>
</html>
