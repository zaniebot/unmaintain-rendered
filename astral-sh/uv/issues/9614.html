<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow single constraints and overrides to be passed via the CLI - astral-sh/uv #9614</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow single constraints and overrides to be passed via the CLI</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9614">#9614</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-12-03 18:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>The <code>--constraint</code> and <code>--override</code> flags should be updated to allow single constraints (in addition to the current behavior of accepting a file path), e.g., <code>--constraint &quot;foo&gt;=0.1&quot;</code>. In the <code>--constraint</code> case, this is mostly unambiguous â€” if there&#x27;s a version specifier then we can treat it as a constraint. It is possible to have a file with that name, but it seems very unlikely in practice. In the <code>--override</code> case, we do allow overriding a dependency to have <em>no</em> specifiers, e.g., <code>--override foo</code>. I&#x27;m not sure if we should allow this via this interface? It seems nice to avoid the ambiguity. Historically, we&#x27;ve avoided inspecting the file system to determine the behavior of arguments and I think that is a good goal to maintain.</p>
<p>Previous discussion at</p>
<ul>
<li>https://github.com/astral-sh/uv/pull/4973#issuecomment-2233540897</li>
<li>https://github.com/astral-sh/uv/issues/4824#issuecomment-2211971741</li>
<li>https://github.com/astral-sh/uv/pull/9547#discussion_r1866759370</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-03 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-03 18:09</div>
            <div class="timeline-body"><p>This proposal applies to both the <code>uv pip</code> interface (though it would differ from the upstream) and top-level interface (where <code>--constraint</code> and <code>--override</code> is only implemented for <code>uv tool install</code> at the moment but should be added elsewhere)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-03 18:16</div>
            <div class="timeline-body"><blockquote>
<p>It is possible to have a file with that name, but it seems very unlikely in practice</p>
</blockquote>
<p>You could always check for a file first and then fall back to see if it&#x27;s a valid version specifier (that includes an operator, e.g. <code>foo&gt;=0.1</code> not just <code>foo</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-03 18:37</div>
            <div class="timeline-body"><blockquote>
<p>You could always check for a file first and then fall back to see if it&#x27;s a valid version specifier</p>
</blockquote>
<p>This is the behavior we have historically avoided. We don&#x27;t want the CLI behavior to change based on the state of the file system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-03 18:56</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>You could always check for a file first and then fall back to see if it&#x27;s a valid version specifier</p>
</blockquote>
<p>This is the behavior we have historically avoided. We don&#x27;t want the CLI behavior to change based on the state of the file system.</p>
</blockquote>
<p>Okay but <code>constraints.txt</code> is a valid requirement ðŸ˜‰.</p>
<pre><code>&gt;&gt;&gt; from packaging.requirements import Requirement
&gt;&gt;&gt; Requirement(&#x27;constraints.txt&#x27;)
&lt;Requirement(&#x27;constraints.txt&#x27;)&gt;
</code></pre>
<p>And that is likely to be the name of a file, so I guess document this carefully on what the boundary conditions are between choosing a file or a requirement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-03 19:07</div>
            <div class="timeline-body"><blockquote>
<p>we do allow overriding a dependency to have <em>no</em> specifiers, e.g., <code>--override foo</code></p>
</blockquote>
<p>One last thing, the <a href="https://github.com/astral-sh/uv/issues/4422#issuecomment-2254182800">one use case</a> to be aware of here is when specifying an always falsey environment marker, e.g. <code>foo ; sys_platform == &#x27;never&#x27;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-03 19:16</div>
            <div class="timeline-body"><blockquote>
<p>Okay but constraints.txt is a valid requirement ðŸ˜‰.</p>
</blockquote>
<p>Yeah so that&#x27;s why I said we&#x27;d require a version specifier. A constraint without a version specifier doesn&#x27;t do anything.</p>
<blockquote>
<p>One last thing, the <a href="https://github.com/astral-sh/uv/issues/4422">astral-sh/uv#4422</a>#issuecomment-2254182800 to be aware of here is when specifying an always falsey environment marker, e.g. foo ; sys_platform == &#x27;never&#x27;.</p>
</blockquote>
<p>Good point!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-04 00:54</div>
            <div class="timeline-body"><p>Yeah, I guess we&#x27;d say: if it includes <code>;</code>, <code>=</code>, <code>&lt;</code>, or <code>&gt;</code> (and <em>not</em> <code>/</code> or <code>\</code>) we treat it as a specifier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-04 15:17</div>
            <div class="timeline-body"><blockquote>
<p>:</p>
</blockquote>
<p>Do you mean <code>;</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-04 15:18</div>
            <div class="timeline-body"><p>Yes, sorry. (Edited.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-07 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-07 22:01</div>
            <div class="timeline-body"><p>@zanieb -- Just noticed one problem here... The values are technically space-delimited, so you can do <code>UV_CONSTRAINTS=&quot;file1 file2&quot;</code> etc. That was initially for pip compatibility. But if they&#x27;re space-delimited, it becomes much harder to do this... Not impossible, but definitely harder.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-07 22:21</div>
            <div class="timeline-body"><p>Alas. I&#x27;m not sure what to do about that.</p>
<p>As a minor note, it&#x27;s <code>UV_CONSTRAINT</code>.</p>
<p>One alternative option: we could align on the name in the <code>pyproject.toml</code>, which would be <code>--dependency-constraint</code> and <code>--dependency-override</code>. I don&#x27;t love the setting name though (I find it non-obvious).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:55 UTC
    </footer>
</body>
</html>
