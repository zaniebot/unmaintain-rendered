<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync: support `--system` to not install dependencies into venv - astral-sh/uv #8085</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv sync: support <code>--system</code> to not install dependencies into venv</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/8085">#8085</a>
        opened by <a href="https://github.com/jgehrcke">@jgehrcke</a>
        on 2024-10-10 12:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jgehrcke">@jgehrcke</a></div>
            <div class="timeline-body"><p><code>uv sync</code> is documented with</p>
<blockquote>
<p>If the project virtual environment (.venv) does not exist, it will be created.</p>
</blockquote>
<p>That&#x27;s great behavior, most of the times.</p>
<p>I want to use <code>uv sync</code> to install dependencies in CI. So I wondered: how can I install into &quot;system python&quot; directly? And so I discovered the lovely discussion in <a href="https://github.com/astral-sh/uv/issues/1526">astral-sh/uv#1526</a> and was super happy to read</p>
<blockquote>
<p>Calling this complete! <code>--system</code> exists.</p>
</blockquote>
<p>Then I found that this flag does not exist for <code>uv sync</code>.</p>
<p>I have the following pretty common use case in mind for github actions:</p>
<pre><code>    - name: set up python
      uses: actions/setup-python@v5
      with:
        python-version: &quot;3.11&quot;
    - name: install uv
      uses: astral-sh/setup-uv@v3
    - name: uv-install dependencies
      shell: bash
      # Install all dependencies as defined in uv.lock.
      # Straight into current/&quot;system&quot; python, which at this point
      # is the Python installed via actions/setup-python.
      run: uv sync --system
</code></pre>
<p>What do we think?</p>
<p>I think that <a href="https://github.com/astral-sh/uv/issues/7659">astral-sh/uv#7659</a> might have a similar motivation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-10 12:15</div>
            <div class="timeline-body"><p>The top-level uv APIs don&#x27;t support the <code>--system</code> flag. You can use <a href="https://docs.astral.sh/uv/concepts/projects/#configuring-the-project-environment-path"><code>UV_PROJECT_ENVIRONMENT</code></a> if you&#x27;re committed to installing into the system Python.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-10 12:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jgehrcke">@jgehrcke</a> on 2024-10-10 12:23</div>
            <div class="timeline-body"><p>Thanks for the blazingly fast reply and your work on uv! I have been in the ecosystem since before 2010 and certainly did not follow each packaging hype. These days I find myself advocating for uv at work, it&#x27;s lovely.</p>
<blockquote>
<p>you can use <a href="https://docs.astral.sh/uv/concepts/projects/#configuring-the-project-environment-path">UV_PROJECT_ENVIRONMENT</a> if you&#x27;re committed to installing into the system Python.</p>
</blockquote>
<p>Thanks!</p>
<p>Yeah right. I looked at the environment variables.  We can also do <code>source .venv/bin/activate</code> right after <code>uv sync</code> certainly, which is what I did so far.</p>
<p>Can I ask: given the GitHub Actions workflow I have shown above: how would <em>you</em> do the third step?</p>
<p>I actually care about running <code>uv sync --locked</code>, and do not care about running the <code>uv pip</code> interface. And subsequent steps in the same github actions job should not need to activate the venv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jgehrcke">@jgehrcke</a> on 2024-10-10 14:01</div>
            <div class="timeline-body"><p>Want to connect some dots here. Related:</p>
<p>https://github.com/astral-sh/uv/issues/5964
<a href="https://github.com/astral-sh/uv/issues/7344">astral-sh/uv#7344</a>
<a href="https://github.com/astral-sh/uv/pull/6834">astral-sh/uv#6834</a></p>
<p>Someone proposed:</p>
<pre><code>ln -sf $(/path/to/target/python -c &#x27;import sys; print(sys.prefix)&#x27;) .venv 
uv sync
</code></pre>
<p>Works, but not nice.</p>
<p>Another person&#x27;s wording:</p>
<blockquote>
<p>I upvote for the optional synchronization with the host system rather than with venv-only. Not only for CI/CD</p>
</blockquote>
<p>In <a href="https://github.com/astral-sh/uv/issues/5964">astral-sh/uv#5964</a>#issuecomment-2289833609 a user answered my</p>
<blockquote>
<p>how would you do the third step?</p>
</blockquote>
<p>and they do:</p>
<pre><code>      - run: uv sync --locked --extra dev
      - run: echo &quot;$PWD/.venv/bin&quot; &gt;&gt; $GITHUB_PATH
</code></pre>
<p>So, this is very much &quot;my&quot; use case. They thought about it, and wrestled it, and decided to mutate GITHUB_PATH <strong>to affect the following steps</strong>. This is not complete &quot;virtual env activation&quot;, so I am not too happy with that either.</p>
<p>Doing <code>source .venv/bin/activate</code> in each individual subsequent step isn&#x27;t great either.</p>
<p>Setting <code>UV_PROJECT_ENVIRONMENT</code> in a way that it affects all steps: interesting challenge. If we take this route, we would set it to something like  <code>$(command -v python)/../..</code>. Looks weird, not nicely maintainable.</p>
<p>Still not quite sure which workaround I like.</p>
<p>I still think a way to tell <code>uv sync</code> to &#x27;brutally&#x27; install into system python directories would be a thought worth following.</p>
<p>I understand the caveat</p>
<blockquote>
<p>More generally, uv sync will remove packages from the environment by default. This means that if the system environment contains any packages relevant to the operation of the system (that are not dependencies of your project), uv sync will break it. I&#x27;d only use this in Docker or CI, if anywhere</p>
</blockquote>
<p>expressed in <a href="https://github.com/astral-sh/uv/pull/6834">astral-sh/uv#6834</a>#issue-2495678347 (thanks @zanieb for working on this).</p>
<p>But yeah, that&#x27;s it exactly: this is for CI, and in the context of github actions it&#x27;s often nice to have a simple/elegant solution, for adoption.</p>
<p>I want to note that maybe I am a little blind right now, maybe there <em>is</em> a reasonable way to do this today, a more or less explicit way that doesn&#x27;t require changing subsequent github action steps. Will look into this again soon.</p>
<p>Edit:</p>
<blockquote>
<p>Setting UV_PROJECT_ENVIRONMENT in a way that it affects all steps: interesting challenge</p>
</blockquote>
<p>Writing to a file <a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/store-information-in-variables#passing-values-between-steps-and-jobs-in-a-workflow"><code>GITHUB_ENV</code></a> can be used for that:</p>
<blockquote>
<p>If you generate a value in one step of a job, you can use the value in subsequent steps of the same job by assigning the value to an existing or new environment variable and then writing this to the GITHUB_ENV environment file.</p>
</blockquote>
<p>So, an additional step using a combination of <code>GITHUB_ENV</code> and <code>UV_PROJECT_ENVIRONMENT</code> will probably also work. But I will keep looking for something more elegant, ideally w/o requiring an extra step.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jgehrcke">@jgehrcke</a> on 2024-10-11 06:49</div>
            <div class="timeline-body"><p>Same problem/question, shorter GHA-focused perspective.</p>
<p>In a GitHub Actions job, after doing an <code>actions/setup-python</code> step: how can we <em>in the next step</em> install dependencies given a <code>uv.lock</code> file so that <em>in all steps thereafter</em> these dependencies are available by just invoking <code>python</code> (without modifying said subsequent steps)?</p>
<p>Edit:</p>
<p>After running <code>actions/setup-python</code> the environment variable <code>pythonLocation</code> is set globally (for subsequent steps), <a href="https://github.com/actions/setup-python/blob/main/docs/advanced-usage.md#environment-variables">docs</a>. It corresponds to <code>sys.prefix</code> (I tested that).</p>
<p>That is, this should work:</p>
<pre><code>      run: |
          export UV_PROJECT_ENVIRONMENT=&quot;${pythonLocation}&quot;
          uv sync --locked
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 22:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 22:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/memark">@memark</a> on 2024-10-25 15:43</div>
            <div class="timeline-body"><p>I&#x27;m trying to set <code>UV_PROJECT_ENVIRONMENT</code> as suggested above, but I can&#x27;t get it to work with <code>uv sync</code>.</p>
<p>Trying some different directories I get:</p>
<blockquote>
<p>error: Project virtual environment directory <code>/usr/local/bin/</code> cannot be used because because it is not a valid Python environment (no Python executable was found)</p>
</blockquote>
<blockquote>
<p>error: Project virtual environment directory <code>/usr/local/bin/python3.12</code> cannot be used because expected directory but found a file</p>
</blockquote>
<blockquote>
<p>error: Project virtual environment directory <code>/usr/local/lib/python3.12/</code> cannot be used because because it is not a valid Python environment (no Python executable was found)</p>
</blockquote>
<blockquote>
<p>error: Project virtual environment directory <code>/usr/local/lib/python3.12/site-packages</code> cannot be used because because it is not a valid Python environment (no Python executable was found)</p>
</blockquote>
<p>All of the executables and directories exist. What am I supposed to put in that env var?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-25 16:23</div>
            <div class="timeline-body"><p>@memark did you do <code>UV_PROJECT_ENVIRONMENT=/usr/local/</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/memark">@memark</a> on 2024-10-26 08:35</div>
            <div class="timeline-body"><p>@zanieb I didn&#x27;t. Until now. That works all the way. Thanks!</p>
<p>I still find the error messages a bit unhelpful then:</p>
<ul>
<li>it says <code>/usr/local/bin</code> doesn&#x27;t contain a Python executable, but it does.</li>
<li><code>/usr/local</code> doesn&#x27;t contain any executables, but works.</li>
</ul>
<p>What we really need to specify in the env var is then
&quot;a directory that contains the <code>bin</code> subdir that contains the Python executable&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-26 16:39</div>
            <div class="timeline-body"><p>We expect to receive a path to a Python environment, i.e., a directory which contains a Python environment. Generally, this is the path to a virtual environment e.g.</p>
<pre><code>â¯ tree .venv -L2
.venv
â”œâ”€â”€ CACHEDIR.TAG
â”œâ”€â”€ bin
â”‚Â Â  â”œâ”€â”€ activate
â”‚Â Â  â”œâ”€â”€ activate.bat
â”‚Â Â  â”œâ”€â”€ activate.csh
â”‚Â Â  â”œâ”€â”€ activate.fish
â”‚Â Â  â”œâ”€â”€ activate.nu
â”‚Â Â  â”œâ”€â”€ activate.ps1
â”‚Â Â  â”œâ”€â”€ activate_this.py
â”‚Â Â  â”œâ”€â”€ deactivate.bat
â”‚Â Â  â”œâ”€â”€ pydoc.bat
â”‚Â Â  â”œâ”€â”€ python -&gt; /opt/homebrew/Cellar/python@3.11/3.11.10/Frameworks/Python.framework/Versions/3.11/bin/python3.11
â”‚Â Â  â”œâ”€â”€ python3 -&gt; python
â”‚Â Â  â””â”€â”€ python3.11 -&gt; python
â”œâ”€â”€ lib
â”‚Â Â  â””â”€â”€ python3.11
â””â”€â”€ pyvenv.cfg
</code></pre>
<p>but it could be an installation environment directory</p>
<pre><code>â¯ tree -L2 /opt/homebrew/Cellar/python@3.11/3.11.10/Frameworks/Python.framework/Versions/3.11/
/opt/homebrew/Cellar/python@3.11/3.11.10/Frameworks/Python.framework/Versions/3.11/
â”œâ”€â”€ Headers -&gt; include/python3.11
â”œâ”€â”€ Python
â”œâ”€â”€ Resources
â”‚Â Â  â”œâ”€â”€ Info.plist
â”‚Â Â  â””â”€â”€ Python.app
â”œâ”€â”€ _CodeSignature
â”‚Â Â  â””â”€â”€ CodeResources
â”œâ”€â”€ bin
â”‚Â Â  â”œâ”€â”€ 2to3-3.11
â”‚Â Â  â”œâ”€â”€ idle3.11
â”‚Â Â  â”œâ”€â”€ pip3
â”‚Â Â  â”œâ”€â”€ pip3.11
â”‚Â Â  â”œâ”€â”€ pydoc3.11
â”‚Â Â  â”œâ”€â”€ python3.11
â”‚Â Â  â””â”€â”€ python3.11-config
â”œâ”€â”€ include
â”‚Â Â  â””â”€â”€ python3.11
â”œâ”€â”€ lib
â”‚Â Â  â”œâ”€â”€ libpython3.11.dylib -&gt; ../Python
â”‚Â Â  â”œâ”€â”€ pkgconfig
â”‚Â Â  â””â”€â”€ python3.11
â””â”€â”€ share
    â””â”€â”€ doc
</code></pre>
<p>In both, we&#x27;re just looking for <code>bin/python</code> (or <code>Scripts/python.exe</code> on Windows).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pnovotnak">@pnovotnak</a> on 2025-03-07 23:54</div>
            <div class="timeline-body"><p>I think a different command might be appropriate, at least in my case.</p>
<p>What brought me to this issue is that I want to install system-wide in container artifacts (basically <code>pip install</code> with no venv activated). This makes the container environment unambiguous when debugging, and because I am producing a slimed down artifact, sharing the system python doesn&#x27;t matter. Furthermore, I don&#x27;t really have any interest in having uv in the process tree in production. It might screw up signals etc.</p>
<p>What I want is to <em>add whatever is in the local environment to the system environment, tweaking versions as necessary</em>.</p>
<p>To that end, the following works, though it is a bit ugly and probably slightly slower than a built-in command:</p>
<pre><code>uv export | uv pip install -r -
</code></pre>
<p>Apologies if this is being discussed elsewhere... I dug around a bit but the issue tracker is quite busy these days ğŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 01:26</div>
            <div class="timeline-body"><p>You can also probably just get away with a virtual environment</p>
<pre><code>uv sync
export PATH=&quot;$(pwd)/.venv/bin:$PATH&quot;
</code></pre>
<p>as demoed in https://github.com/astral-sh/uv-docker-example/blob/c16a61fb3e6ab568ac58d94b73a7d79594a5d570/Dockerfile#L25-L34</p>
<p>I don&#x27;t think the virtual environment itself will add much size to your artifact, but understand the desire for zero ambiguity :)</p>
<p>Setting <code>UV_PROJECT_ENVIRONMENT</code> to the system environment should also work, without the <code>export</code> and <code>pip</code> hacks â€” no need to have uv around after that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MrCreosote">@MrCreosote</a> on 2025-05-01 22:55</div>
            <div class="timeline-body"><p>I&#x27;m trying <code>uv</code> in a new project (thanks!) and switching from <code>pipenv</code>. In <code>pipenv</code>, i habitually install deps in containers via:</p>
<pre><code>pipenv sync --system
</code></pre>
<p>It&#x27;d be nice to have the same simplicity / lack of ambiguity here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsyring">@rsyring</a> on 2025-05-23 17:39</div>
            <div class="timeline-body"><p>Here is a complete example for what I did for a project that runs on Lambda:</p>
<p><a>Important Note</a>: the Python install in this case is in <strong><code>/var/lang</code></strong> b/c it&#x27;s the Lambda image.  You&#x27;d more typically set it to <code>/usr/local</code>, see docs for <a href="https://docs.astral.sh/uv/concepts/projects/config/#project-environment-path">UV_PROJECT_ENVIRONMENT</a>.</p>
<pre><code>from public.ecr.aws/lambda/python:3.12 as app

# env
env FLASK_DEBUG=0
# System install
env UV_PROJECT_ENVIRONMENT=/var/lang/
# Optimize startup time
env UV_COMPILE_BYTECODE=1
# Hardlinks don&#x27;t work in docker images anyway, so don&#x27;t warn me or take time trying
env UV_LINK_MODE=copy

# uv install
# grab /uvx too if you need it
copy --from=ghcr.io/astral-sh/uv:latest /uv /usr/local/bin/

##  App
workdir /app

# Build / deps
copy pyproject.toml hatch.toml readme.md uv.lock .
copy src/poster/version.py src/poster/version.py
run --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev --inexact

# Source files after the build for better caching/speed when deps haven&#x27;t changed
copy src/poster src/poster
copy src/lambda_handler.py src

# The lamba runtime environment will use this dotted path as the entry point to our app when
# the lambda function is invoked.  It must be a function, it doesn&#x27;t handle class methods.
cmd [&quot;lambda_handler.entry&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pszponder">@pszponder</a> on 2025-07-27 23:25</div>
            <div class="timeline-body"><p>Adding <code>--system</code> as an option to <code>uv sync</code> would be awesome! I just ran into a situation where I am trying to dockerize my Apache Airflow application and using <code>RUN uv sync --system</code> would have been perfect!</p>
<p>For now these two lines seem to work:</p>
<pre><code>RUN uv sync --no-dev --no-cache
RUN export PATH=&quot;$(pwd)/.venv/bin:$PATH&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RodriGoncaDeeployer">@RodriGoncaDeeployer</a> on 2025-08-29 12:52</div>
            <div class="timeline-body"><p>I found myself using the following approach.</p>
<pre><code># Install python dependencies
COPY pyproject.toml uv.lock /app/
RUN uv export --format requirements.txt -o requirements.txt
RUN uv pip install --system -r requirements.txt
</code></pre>
<p>I do this in a multi stage build process, that way the requirements.txt file is ephemeral and does not interfere in my workflow.</p>
<pre><code># ---------------------------------------------------------------------------------------------------
# Stage 1: Base Build Stage
# ---------------------------------------------------------------------------------------------------
FROM python:3.13-slim AS builder

# Create the app directory
RUN mkdir /app

# Set the working directory
WORKDIR /app

# Install uv
RUN pip install --no-cache-dir uv

# Install python dependencies
COPY pyproject.toml uv.lock /app/
RUN uv export --format requirements.txt -o requirements.txt
RUN uv pip install --system -r requirements.txt

# Install playwright dependencies
RUN playwright install
RUN playwright install-deps

# ---------------------------------------------------------------------------------------------------
# Stage 2: Production Stage
# ---------------------------------------------------------------------------------------------------
FROM python:3.13-slim

# Create the app directory
RUN mkdir /app

# Set the working directory
WORKDIR /app

# Copy system dependencies
COPY --from=builder /usr /usr
COPY --from=builder /etc /etc
COPY --from=builder /root/.cache/ms-playwright /root/.cache/ms-playwright

# Copy application code
COPY . /app

# Set environment variables to optimize the Python runtime
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Specify the entrypoint to run the FastAPI app
ENTRYPOINT [&quot;gunicorn&quot;, &quot;-c&quot;, &quot;gunicorn.conf.py&quot;, &quot;main:app&quot;]

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vivodi">@vivodi</a> on 2025-09-16 13:27</div>
            <div class="timeline-body"><blockquote>
<p>I think a different command might be appropriate, at least in my case.</p>
<p>What brought me to this issue is that I want to install system-wide in container artifacts (basically <code>pip install</code> with no venv activated). This makes the container environment unambiguous when debugging, and because I am producing a slimed down artifact, sharing the system python doesn&#x27;t matter. Furthermore, I don&#x27;t really have any interest in having uv in the process tree in production. It might screw up signals etc.</p>
<p>What I want is to <em>add whatever is in the local environment to the system environment, tweaking versions as necessary</em>.</p>
<p>To that end, the following works, though it is a bit ugly and probably slightly slower than a built-in command:</p>
<pre><code>uv export | uv pip install -r -
</code></pre>
<p>Apologies if this is being discussed elsewhere... I dug around a bit but the issue tracker is quite busy these days ğŸ˜…</p>
</blockquote>
<p>I suspect what you want is</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/13129</li>
</ul>
<p>Using <code>pip install --root &lt;directory&gt; &lt;packages&gt;</code> allows the final artifact of a multi-stage Docker build to have a system environment containing only the packages you want. The issue at <a href="https://github.com/astral-sh/uv/issues/13129">astral-sh/uv#13129</a> proposes giving <code>uv sync</code> a similar capability.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:39 UTC
    </footer>
</body>
</html>
