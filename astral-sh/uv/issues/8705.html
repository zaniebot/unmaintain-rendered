<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync cannot resolve pandas and numpy dependencies even though they should be compatible - astral-sh/uv #8705</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv sync cannot resolve pandas and numpy dependencies even though they should be compatible</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8705">#8705</a>
        opened by <a href="https://github.com/mmarinriera">@mmarinriera</a>
        on 2024-10-30 18:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mmarinriera">@mmarinriera</a></div>
            <div class="timeline-body">

<ul>
<li>Command: <code>uv run</code>, <code>uv sync</code></li>
<li>Platform: MacOS Sonoma 14.6.1</li>
<li>uv version:uv 0.4.28 (debe67ffd 2024-10-28)`</li>
</ul>
<p>Hi,</p>
<p>I am working on a project that has <a href="https://github.com/jungmannlab/picasso"><code>picassosr</code></a> as a dependency. I am able to install the package and run the CLI via <code>uvx</code>,</p>
<pre><code>uvx -p 3.10 --from &quot;picasso==0.7.3&quot; picasso --help
</code></pre>
<p>and that works. However if I try to <code>uv run</code> a project that has <code>picassosr</code> as a dependency, I get a &quot;no solution found&quot; error.</p>
<p>To reproduce this behaviour, create a project with:</p>
<pre><code>uv init --app --package project
</code></pre>
<p>just add &quot;picassosr==0.7.3&quot; to <code>dependencies</code> in the <code>pyproject.toml</code>,</p>
<p>and when I run it with,</p>
<pre><code>uv run -p 3.10 project
</code></pre>
<p>I get the following output,</p>
<pre><code>% uv run -p 3.10 project
Using CPython 3.10.15
Creating virtual environment at: .venv
  × No solution found when resolving dependencies for split (python_full_version &gt;= &#x27;3.12&#x27;):
  ╰─▶ Because only the following versions of numpy{python_full_version &gt;= &#x27;3.12&#x27;} are available:
          numpy{python_full_version &gt;= &#x27;3.12&#x27;}&lt;=2.0.2
          numpy{python_full_version &gt;= &#x27;3.12&#x27;}&gt;=2.1.0
      and pandas==2.1.1 depends on numpy{python_full_version &gt;= &#x27;3.12&#x27;}&gt;=1.26.0, we can conclude that pandas==2.1.1 depends on one of:
          numpy&gt;=1.26.0,&lt;=2.0.2
          numpy&gt;=2.1.0

      And because picassosr==0.7.3 depends on numpy==1.24.3, we can conclude that pandas==2.1.1 and picassosr==0.7.3 are incompatible.
      And because picassosr==0.7.3 depends on pandas==2.1.1 and your project depends on picassosr==0.7.3, we can conclude that your project&#x27;s
      requirements are unsatisfiable.
</code></pre>
<p>(Find attached below the verbose output of the same command).</p>
<p>Running <code>uv sync</code> leads to the same error.</p>
<p>The conflict seems to be with &quot;pandas==2.1.1&quot; and &quot;numpy==1.24.3&quot;. The same error persists if I only include these two dependencies in the project.</p>
<p>This seems rather weird, since <code>uvx</code> seems to be able to solve these dependencies, and if you inspect pandas requirements, under python 3.10, &quot;numpy==1.24.3&quot; should be compatible, e.g.</p>
<pre><code>% uvx -p 3.10 --with &quot;pandas==2.1.1&quot; --with &quot;numpy==1.24.3&quot; pipdeptree
Installed 9 packages in 102ms
pandas==2.1.1
├── numpy [required: &gt;=1.22.4, installed: 1.24.3]
├── python-dateutil [required: &gt;=2.8.2, installed: 2.9.0.post0]
│   └── six [required: &gt;=1.5, installed: 1.16.0]
├── pytz [required: &gt;=2020.1, installed: 2024.2]
└── tzdata [required: &gt;=2022.1, installed: 2024.2]
pipdeptree==2.23.4
├── packaging [required: &gt;=24.1, installed: 24.1]
└── pip [required: &gt;=24.2, installed: 24.3.1]
</code></pre>
<p>I hope you can look into this issue.</p>
<p>Finally, just want to say that I and the rest of my team are very excited about the <code>uv</code> project and we are currently integrating it into our development workflow. Thank you so much for you great work! :)</p>
<p>Output of : <code>uv run -p 3.10 --verbose project</code>
<a href="https://github.com/user-attachments/files/17577262/out.txt">out.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 19:10</div>
            <div class="timeline-body"><p>Basically: this project can&#x27;t resolve on Python 3.12, but on Pandas has the following dependencies:</p>
<pre><code>Requires-Dist: numpy&gt;=1.22.4; python_version &lt; &quot;3.11&quot;
Requires-Dist: numpy&gt;=1.23.2; python_version == &quot;3.11&quot;
Requires-Dist: numpy&gt;=1.26.0; python_version &gt;= &quot;3.12&quot;
</code></pre>
<p>So on Python 3.12, Pandas requires <em>at least</em> NumPy 1.26.0 -- but you require exactly Pandas 2.1.1 and NumPy 1.24.3, so there&#x27;s no valid resolution on Python 3.12.</p>
<p>In uv, when you give us a Python requirement, we try to solve for all versions in the supported range, not <em>just</em> the current Python version.</p>
<p>One way you can work around this is to tell uv that you <em>only</em> care about Python 3.10, with:</p>
<pre><code>[tool.uv]
environments = [&quot;python_version == &#x27;3.10&#x27;&quot;]
</code></pre>
<p>That tells uv to <em>only</em> solve for Python 3.10.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-30 19:46</div>
            <div class="timeline-body"><p>And as another note, it works in <code>uvx</code> because there we only solve for a single Python version.</p>
<p>Glad you&#x27;re excited about the project :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mmarinriera">@mmarinriera</a> on 2024-10-31 10:31</div>
            <div class="timeline-body"><p>I understand now. Thanks @charliermarsh. The workaround you suggested works great.</p>
<p>I also realized that another solution would be to constrain the <code>requires-python</code> field in the <code>pyproject.toml</code> to 3.10 only, like this.</p>
<pre><code>requires-python = &quot;&gt;=3.10,&lt;3.11&quot;
</code></pre>
<p>That works too.</p>
<p>Thank you @zanieb , that was going to be my follow-up question :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 11:57</div>
            <div class="timeline-body"><p>Thanks for following up :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 11:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:09 UTC
    </footer>
</body>
</html>
