<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Specifying different dependency versions for different platforms - astral-sh/uv #9515</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Specifying different dependency versions for different platforms</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9515">#9515</a>
        opened by <a href="https://github.com/merajhashemi">@merajhashemi</a>
        on 2024-11-29 00:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/merajhashemi">@merajhashemi</a> on 2024-11-29 00:24</div>
            <div class="timeline-body"><p>Hello,
I've encountered an issue while trying to specify different versions of PyTorch for Intel macOS in my project.
Here is a minimal <code>pyproject.toml</code> that shows the issue:</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
    &quot;torch&gt;=1.13.1,&lt;2.3; sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;,
    &quot;torch&gt;=1.13.1; sys_platform != 'darwin' or platform_machine == 'arm64'&quot;,
]
</code></pre>
<p>Iâ€™m trying to make sure that Intel macOS (darwin_x86_64) uses a specific version of PyTorch as there are no new wheels available for versions 2.3 and above. But the dependency resolver seems to apply this constraint universally when generating the lock file, resulting in version 2.2.2 being installed across all platforms.</p>
<p>Is there a better way to set these conditions, maybe in a <code>tool.uv</code> section? Any tips would be super helpful!</p>
<hr />
<pre><code class="language-bash">$ uv --version
uv 0.5.5
</code></pre>
<p>Related to #8358.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-29 16:51</div>
            <div class="timeline-body"><p>I'd probably suggest something like this:</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
    &quot;torch&gt;=&lt;2.3; sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;,
    &quot;torch&gt;=2.3; sys_platform != 'darwin' or platform_machine != 'x86_64'&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-29 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/merajhashemi">@merajhashemi</a> on 2024-11-29 19:17</div>
            <div class="timeline-body"><p>Thanks @charliermarsh.
This seems to work as expected:</p>
<pre><code class="language-toml">dependencies = [
    &quot;torch&gt;1.13,&lt;2.3; sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;,
    &quot;torch&gt;=2.3; sys_platform != 'darwin' or platform_machine != 'x86_64'&quot;,
]
</code></pre>
<p>However, our library is designed to support PyTorch versions greater than 1.13 across all platforms. When we specify the dependencies as follows:</p>
<pre><code class="language-toml">dependencies = [
    &quot;torch&gt;1.13,&lt;2.3; sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;,
    &quot;torch&gt;=1.13; sys_platform != 'darwin' or platform_machine != 'x86_64'&quot;,
]
</code></pre>
<p>it still results in all platforms installing version 2.2.2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-29 19:22</div>
            <div class="timeline-body"><p>Yeah, that's intended. If you provide constraints that can be solved with fewer total versions, uv will prefer to use fewer versions. In that case, 2.2.2 satisfies both of your constraints, so uv chooses 2.2.2 rather than creating a more heterogenous environment (i.e., an environment that's <em>less</em> consistent across platforms).</p>
<p>If you're looking for a change in <em>that</em> behavior, follow https://github.com/astral-sh/uv/pull/8686 and https://github.com/astral-sh/uv/issues/7190. But uv is doing the intended thing given those constraints.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-29 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/merajhashemi">@merajhashemi</a> on 2024-11-29 20:47</div>
            <div class="timeline-body"><p>Thank you, @charliermarsh. I've just noticed that this behavior doesn't align with the pip interface. When I execute <code>uv pip install .</code> with the following dependencies:</p>
<pre><code class="language-toml">dependencies = [
    &quot;torch&gt;1.13,&lt;2.3; sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;,
    &quot;torch&gt;=1.13; sys_platform != 'darwin' or platform_machine != 'x86_64'&quot;,
]
</code></pre>
<p>it successfully installs the latest version of PyTorch on linux. Could we have other uv commands, such as <code>uv sync</code> and <code>uv lock</code>, behave similarly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9988.html">astral-sh/uv#9988</a> on 2024-12-18 03:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
