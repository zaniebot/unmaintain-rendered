<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add constraints (and overrides?) to build environments - astral-sh/uv #5561</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add constraints (and overrides?) to build environments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5561">#5561</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-07-29 14:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>We should add a <code>--build-constraints</code> that apply to the build environments.</p>
<p>See: https://github.com/astral-sh/uv/issues/5551#issuecomment-2256055975</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-07-29 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-07-29 18:27</div>
            <div class="timeline-body"><p>(Note that pip's behaviour is a little weird, only the env var affects the build environments, not the command line flag)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-29 19:54</div>
            <div class="timeline-body"><p>Oh wow, that's interesting. I'm considering providing separate API for this (like <code>--build-constraints</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2024-07-29 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/orsinium">@orsinium</a> on 2024-07-30 07:00</div>
            <div class="timeline-body"><p>In <a href="https://github.com/dephell/dephell">DepHell</a>, I used to use <a href="https://docs.python.org/3/library/ensurepip.html">ensurepip</a> with <a href="https://github.com/dephell/dephell_venvs/blob/master/dephell_venvs/_ensurepip.py">fallbacks</a> to bootstrap build venvs. It uses the setuptools and pip versions bundled with stdlib that are always the same and guaranteed to be stable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-02 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-02 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grant-zietsman">@grant-zietsman</a> on 2024-09-01 13:00</div>
            <div class="timeline-body"><p>@charliermarsh Are there any plans to make <code>--build-constraints</code> a project setting (similar to <a href="https://docs.astral.sh/uv/reference/settings/#constraint-dependencies">constraint-dependencies</a>)?</p>
<p>Currently build constraints need to be manually specified:</p>
<ul>
<li><code>--build-constraint</code> (seems exclusive to the pip interface).</li>
<li><code>UV_BUILD_CONSTRAINT</code> (seems global).</li>
</ul>
<p>Having a central project setting would be convenient (at least for the use case I have in mind).</p>
<h3>Use Case (Context)</h3>
<p>The goal is for packages (source distributions) that include protobufs to support compiling these protobufs during build while being constrained to the same major version of protobuf as required by the project into which they are being installed.</p>
<p>Constraining the version of <code>protobuf</code> both during build and via <a href="https://docs.astral.sh/uv/reference/settings/#constraint-dependencies">constraint-dependencies</a> (in the end project) <em>should</em> ensure compatibility, if these packages (source distributions) compile protobufs with <code>grpcio-tools</code> during build.</p>
<p>This should also be attainable with <a href="https://docs.astral.sh/uv/reference/settings/#no-build-isolation">no-build-isolation</a> and <a href="https://docs.astral.sh/uv/reference/settings/#no-build-isolation-package">no-build-isolation-package</a> but it  would be preferred to retain build isolation (to avoid unnecessarily constraining any other build requirements).</p>
<p>A workaround that somewhat side steps this is to compile protobufs on import.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-01 16:56</div>
            <div class="timeline-body"><p>Yeah we should add this. I'll make a separate issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-01 16:57</div>
            <div class="timeline-body"><p>Tracking here: https://github.com/astral-sh/uv/issues/6913</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:49 UTC
    </footer>
</body>
</html>
