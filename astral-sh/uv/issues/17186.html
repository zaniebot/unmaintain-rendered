<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to resolve torch with different index but same marker for conflict extras - astral-sh/uv #17186</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to resolve torch with different index but same marker for conflict extras</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17186">#17186</a>
        opened by <a href="https://github.com/hermeschen1116">@hermeschen1116</a>
        on 2025-12-19 03:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hermeschen1116">@hermeschen1116</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I tried to install cpu only version for intel and metal extras and cu130 version for only cuda extra with the configuration below.</p>
<pre><code class="language-toml">[project.optional-dependencies]
cuda = [
	&quot;onnx&gt;=1.19.1 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;onnxruntime-gpu&gt;=1.23.2 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;onnxslim&gt;=0.1.73 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
intel = [
	&quot;nncf&gt;=2.18.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;openvino&gt;=2025.3.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
metal = [
	&quot;coremltools&gt;=9.0.0 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
]

[tool.uv]
preview = true
conflicts = [
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;intel&quot; },
		{ extra = &quot;metal&quot; },
	],
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu130&quot;
url = &quot;https://download.pytorch.org/whl/cu130&quot;
explicit = true

[tool.uv.pip]
all-extras = false

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;metal&quot;, marker = &quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot; },
  { index = &quot;pytorch-cpu&quot;, extra = &quot;intel&quot; },
  { index = &quot;pytorch-cu130&quot;, extra = &quot;cuda&quot; },
]
torchvision = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;metal&quot;, marker = &quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot; },
  { index = &quot;pytorch-cpu&quot;, extra = &quot;intel&quot; },
  { index = &quot;pytorch-cu130&quot;, extra = &quot;cuda&quot; },
]
</code></pre>
<p>This config works fine on Apple silicon mac but it keep failed with this error on amd64 linux.</p>
<pre><code class="language-shell">    Updated https://ezgit.ezcon.com.tw/ai/stream-server.git (782c07f171504f98615ea02f9051a6ea9106ff9e)
    Updated https://ezgit.ezcon.com.tw/ai/utils.git (9463cbc406ff450922d17f31c2da712a11f0085c)
    Updated https://ezgit.ezcon.com.tw/ai/vlm-utils.git (1455ae16a4d0b120da22ee7d81ca1b3045b4556d)
    Updated https://ezgit.ezcon.com.tw/ai/yolo-utils.git (4ce177f94dbd44ea253c0f201daa7c7a12fdce6c)
  × Failed to resolve dependencies for `utils` (v0.1.0)
  ╰─▶ Requirements contain conflicting indexes for package `torch` in split `platform_machine == 'x86_64' and
      sys_platform == 'linux'`:
      - https://download.pytorch.org/whl/cpu
      - https://download.pytorch.org/whl/cu130
  help: `utils` (v0.1.0) was included because `tlpr[metal]` (v0.1.0) depends on `vlm-utils` (v0.1.0) which
        depends on `utils`
</code></pre>
<h3>Platform</h3>
<p>Linux 6.17.12+deb14-amd64 x86_64 GNU/Linux, Darwin 25.3.0 arm64 Darwin</p>
<h3>Version</h3>
<p>uv 0.9.18</p>
<h3>Python version</h3>
<p>Python 3.12.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @hermeschen1116 on 2025-12-19 03:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Failed to resolve torch with different index for conflict extra but same marker" to "Failed to resolve torch with different index but same marker for conflict extras" by @hermeschen1116 on 2025-12-19 03:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-19 03:16</div>
            <div class="timeline-body"><p>Can you instead try with:</p>
<pre><code class="language-toml">[tool.uv]
conflicts = [
    [
        { extra = &quot;cuda&quot; },
        { extra = &quot;intel&quot; },
    ],
    [
        { extra = &quot;cuda&quot; },
        { extra = &quot;metal&quot; },
    ],
    [
        { extra = &quot;intel&quot; },
        { extra = &quot;metal&quot; },
    ],
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-12-19 03:34</div>
            <div class="timeline-body"><p>I've tried this but not works.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-19 03:35</div>
            <div class="timeline-body"><p>Can you share the error that you hit? It resolved without issue for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-12-19 03:40</div>
            <div class="timeline-body"><p>@charliermarsh  The same as I mention in the issue.</p>
<pre><code class="language-shell"> × Failed to resolve dependencies for `utils` (v0.1.0)
  ╰─▶ Requirements contain conflicting indexes for package `torch` in split `platform_machine == 'x86_64' and sys_platform == 'linux'`:
      - https://download.pytorch.org/whl/cpu
      - https://download.pytorch.org/whl/cu130
  help: `utils` (v0.1.0) was included because `tlpr[metal]` (v0.1.0) depends on `vlm-utils` (v0.1.0) which depends on `utils`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-19 03:48</div>
            <div class="timeline-body"><p>Can you include the full pyproject.toml along with the command you ran to reproduce?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-12-19 04:03</div>
            <div class="timeline-body"><p>Okay, but it's a bit complicated. I have a main project that relies on two sub-projects which have torch and torchvision as dependencies. And these three projects all have similar extra and conflict configurations. Below are the current configurations. And I use <code>uv sync --refresh -U --reinstall --extra {{ platform_specific_extra_name }}</code>. And there's no problem executing the command with sub-project configurations.</p>
<p>Here is the sub project 1</p>
<pre><code class="language-toml">requires-python = &quot;&gt;=3.12&quot;
dependencies = [
	&quot;transformers[hf-xet]&gt;=4.55.4&quot;,
	&quot;utils[model,server]&quot;,
]

[dependency-groups]
dev = [
	&quot;utils[test]&quot;
]

[project.optional-dependencies]
cuda = [
	&quot;flash-attn&gt;=2.8.3 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;unsloth&gt;=2024.8 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
export = [
	&quot;huggingface-hub[hf-xet]&gt;=0.36.0&quot;,
	&quot;tqdm&gt;=4.67.1&quot;,
]
intel = [
	&quot;openvino&gt;=2025.4 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;optimum[nncf,openvino]&gt;=2.0.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;pillow&gt;=12.0.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
metal = [
	&quot;mlx-vlm&gt;=0.3.3 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
]

[project.scripts]
&quot;vlm_utils.server&quot; = &quot;vlm_utils.server.CLI:launch&quot;
&quot;vlm_utils.export_mlx&quot; = &quot;vlm_utils.export.MLXConverter:convert&quot;
&quot;vlm_utils.export_ov&quot; = &quot;vlm_utils.export.OVConverter:convert&quot;

[build-system]
requires = [&quot;Nuitka[build-wheel]&quot;, &quot;toml&quot;, &quot;tqdm&quot;]
build-backend = &quot;nuitka.distutils.Build&quot;

[tool.uv]
preview = true
conflicts = [
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;intel&quot; },
	],
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;metal&quot; },
	],
	[
		{ extra = &quot;intel&quot; },
		{ extra = &quot;metal&quot; },
	]
]
environments = [
	&quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
exclude-dependencies = [&quot;opencv-python&quot;, &quot;openvino-telemetry&quot;, &quot;uvicorn&quot;]
prerelease = &quot;allow&quot;
required-environments = [
	&quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]

[tool.uv.extra-build-dependencies]
flash-attn = [&quot;ninja&quot;, &quot;numpy&quot;, &quot;packaging&quot;, &quot;torch&quot;]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu130&quot;
url = &quot;https://download.pytorch.org/whl/cu130&quot;
explicit = true

[tool.uv.pip]
all-extras = false
no-build-isolation-package = [&quot;flash-attn&quot;]

[tool.uv.sources]
torch = [
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;metal&quot;, marker = &quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot; },
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;intel&quot; },
	{ index = &quot;pytorch-cu130&quot;, extra = &quot;cuda&quot; },
]
torchvision = [
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;metal&quot;, marker = &quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot; },
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;intel&quot; },
	{ index = &quot;pytorch-cu130&quot;, extra = &quot;cuda&quot; },
]
utils = { git = &quot;https://ezgit.ezcon.com.tw/ai/utils.git&quot;, branch = &quot;dev&quot; }
</code></pre>
<p>And the sub project 2</p>
<pre><code class="language-toml">requires-python = &quot;&gt;=3.12&quot;
dependencies = [
	&quot;ultralytics&gt;=8.3.217&quot;,
	&quot;utils[server]&quot;,
]

[dependency-groups]
dev = [
	&quot;utils[test]&quot;,
]

[project.scripts]
&quot;yolo_utils.server&quot; = &quot;yolo_utils.server.CLI:launch&quot;
&quot;yolo_utils.tune&quot; = &quot;yolo_utils.train.HyperparameterTuner:tune&quot;
&quot;yolo_utils.train&quot; = &quot;yolo_utils.train.Trainer:train&quot;
&quot;yolo_utils.eval&quot; = &quot;yolo_utils.train.Evaluator:eval&quot;

[project.optional-dependencies]
cuda = [
	&quot;onnx&gt;=1.19.1 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;onnxruntime-gpu&gt;=1.23.2 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;onnxslim&gt;=0.1.73 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
intel = [
	&quot;nncf&gt;=2.18.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;openvino&gt;=2025.3.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
metal = [
	&quot;coremltools&gt;=9.0.0 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;torch&gt;=2.9 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;torchvision&gt;=0.24.0 ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
]
train = [
    &quot;tqdm&gt;=4.67.1&quot;,
    &quot;wandb[media]&gt;=0.23.0&quot;,
]

[build-system]
requires = [&quot;Nuitka[build-wheel]&quot;, &quot;toml&quot;, &quot;tqdm&quot;]
build-backend = &quot;nuitka.distutils.Build&quot;

[tool.setuptools.package-data]
&quot;yolo_utils&quot; = [&quot;assets/yolo11n.pt&quot;]

[tool.uv]
preview = true
conflicts = [
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;intel&quot; },
	],
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;metal&quot; },
	],
	[
		{ extra = &quot;intel&quot; },
		{ extra = &quot;metal&quot; },
	]
]
environments = [
	&quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
exclude-dependencies = [&quot;opencv-python&quot;, &quot;openvino-telemetry&quot;, &quot;uvicorn&quot;]
required-environments = [
	&quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu130&quot;
url = &quot;https://download.pytorch.org/whl/cu130&quot;
explicit = true

[tool.uv.pip]
all-extras = false

[tool.uv.sources]
torch = [
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;metal&quot;, marker = &quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot; },
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;intel&quot; },
	{ index = &quot;pytorch-cu130&quot;, extra = &quot;cuda&quot; },
]
torchvision = [
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;metal&quot;, marker = &quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot; },
	{ index = &quot;pytorch-cpu&quot;, extra = &quot;intel&quot; },
	{ index = &quot;pytorch-cu130&quot;, extra = &quot;cuda&quot; },
]
utils = { git = &quot;https://ezgit.ezcon.com.tw/ai/utils.git&quot;, branch = &quot;dev&quot;}
</code></pre>
<p>Then main project</p>
<pre><code class="language-toml">[project.optional-dependencies]
cuda = [
	&quot;vlm-utils[cuda] ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;yolo-utils[cuda] ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
intel = [
	&quot;vlm-utils[intel] ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
	&quot;yolo-utils[intel] ; platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
metal = [
	&quot;vlm-utils[metal] ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;yolo-utils[metal] ; platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
]

[project.scripts]
&quot;tlpr.server&quot; = &quot;tlpr.CLI:launch&quot;
&quot;tlpr.stream&quot; = &quot;tlpr.CLI:launch_stream_service&quot;
&quot;tlpr.detection&quot; = &quot;tlpr.CLI:launch_detection_service&quot;
&quot;tlpr.recognition&quot; = &quot;tlpr.CLI:launch_recognition_service&quot;

[build-system]
requires = [&quot;Nuitka[build-wheel]&quot;, &quot;toml&quot;, &quot;tqdm&quot;]
build-backend = &quot;nuitka.distutils.Build&quot;

[tool.setuptools.package-data]
&quot;tlpr&quot; = [&quot;templates/*.html&quot;, &quot;assets/**/**/*&quot;]

[tool.uv]
preview = true
conflicts = [
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;intel&quot; },
	],
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;metal&quot; },
	],
	[
		{ extra = &quot;intel&quot; },
		{ extra = &quot;metal&quot; },
	]
]
environments = [
	&quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]
exclude-dependencies = [&quot;opencv-python&quot;, &quot;uvicorn&quot;]
required-environments = [
	&quot;platform_machine == 'arm64' and sys_platform == 'darwin'&quot;,
	&quot;platform_machine == 'x86_64' and sys_platform == 'linux'&quot;,
]

[tool.uv.extra-build-dependencies]
flash-attn = [&quot;ninja&quot;, &quot;numpy&quot;, &quot;packaging&quot;, &quot;torch&quot;]

[tool.uv.pip]
all-extras = false

[tool.uv.sources]
stream-server = { git = &quot;https://ezgit.ezcon.com.tw/ai/stream-server.git&quot; }
utils = { git = &quot;https://ezgit.ezcon.com.tw/ai/utils.git&quot;, branch = &quot;dev&quot; }
vlm-utils = { git = &quot;https://ezgit.ezcon.com.tw/ai/vlm-utils.git&quot;, branch = &quot;dev&quot; }
yolo-utils = { git = &quot;https://ezgit.ezcon.com.tw/ai/yolo-utils.git&quot;, branch = &quot;dev&quot; }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-19 18:37</div>
            <div class="timeline-body"><p>Do those three pyproject.toml projects depend on one another?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-12-20 00:58</div>
            <div class="timeline-body"><p>Main project depends on project 1 and 2. Project 1 and 2 has no problem resolving torch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-20 02:50</div>
            <div class="timeline-body"><p>If the main project is <code>foo</code>, and it depends on <code>bar</code> and <code>baz</code>, you need to enumerate all the conflicts:</p>
<pre><code class="language-toml">[tool.uv]
conflicts = [
  # foo[cpu] vs foo[cu128]
  [
    { extra = &quot;cpu&quot; },
    { extra = &quot;cu128&quot; },
  ],
  # foo[cpu] vs bar[cu128]
  [
    { extra = &quot;cpu&quot; },
    { package = &quot;bar&quot;, extra = &quot;cu128&quot; },
  ],
  # foo[cu128] vs bar[cpu]
  [
    { extra = &quot;cu128&quot; },
    { package = &quot;bar&quot;, extra = &quot;cpu&quot; },
  ],
  # foo[cpu] vs baz[cu128]
  [
    { extra = &quot;cpu&quot; },
    { package = &quot;baz&quot;, extra = &quot;cu128&quot; },
  ],
  # foo[cu128] vs baz[cpu]
  [
    { extra = &quot;cu128&quot; },
    { package = &quot;baz&quot;, extra = &quot;cpu&quot; },
  ],
  # bar[cpu] vs baz[cu128]
  [
    { package = &quot;bar&quot;, extra = &quot;cpu&quot; },
    { package = &quot;baz&quot;, extra = &quot;cu128&quot; },
  ],
  # bar[cu128] vs baz[cpu]
  [
    { package = &quot;bar&quot;, extra = &quot;cu128&quot; },
    { package = &quot;baz&quot;, extra = &quot;cpu&quot; },
  ],
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-12-22 02:06</div>
            <div class="timeline-body"><p>@charliermarsh Hello, I tried to configure the conflict as below but uv can still not resolve the conflict index for different extras on Linux. And I'm not sure if this is enough to cover all the cases as the number of conflict extras is increasing. To make 3 extras which conflict with each other, we need to enumerate 3 cases, but for this case, I think there are 27 cases to enumerate if my calculation is correct.</p>
<pre><code class="language-toml">conflicts = [
	# tlpr[cuda] vs tlpr[intel]
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;intel&quot; },
	],
	# tlpr[cuda] vs yolo-utils[intel]
	[
		{ extra = &quot;cuda&quot; },
		{ package = &quot;yolo-utils&quot;, extra = &quot;intel&quot; },
	],
	# tlpr[cuda] vs vlm-utils[intel]
	[
		{ extra = &quot;cuda&quot; },
		{ package = &quot;vlm-utils&quot;, extra = &quot;intel&quot; },
	],
	# tlpr[cuda] vs tlpr[metal]
	[
		{ extra = &quot;cuda&quot; },
		{ extra = &quot;metal&quot; },
	],
	# tlpr[cuda] vs yolo-utils[metal]
	[
		{ extra = &quot;cuda&quot; },
		{ package = &quot;yolo-utils&quot;, extra = &quot;metal&quot; },
	],
	# tlpr[cuda] vs vlm-utils[metal]
	[
		{ extra = &quot;cuda&quot; },
		{ package = &quot;vlm-utils&quot;, extra = &quot;metal&quot; },
	],
	# tlpr[intel] vs tlpr[metal]
	[
		{ extra = &quot;intel&quot; },
		{ extra = &quot;metal&quot; },
	],
	# tlpr[intel] vs yolo-utils[metal]
	[
		{ extra = &quot;intel&quot; },
		{ package = &quot;yolo-utils&quot;, extra = &quot;metal&quot; },
	],
	# tlpr[intel] vs vlm-utils[metal]
	[
		{ extra = &quot;intel&quot; },
		{ package = &quot;vlm-utils&quot;, extra = &quot;metal&quot; },
	]
]
</code></pre>
<p>And the error message.</p>
<pre><code class="language-shell">  × Failed to resolve dependencies for `vlm-utils` (v0.1.0)
  ╰─▶ Requirements contain conflicting indexes for package `torch` in split `platform_machine == 'x86_64' and sys_platform == 'linux'`:
      - https://download.pytorch.org/whl/cpu
      - https://download.pytorch.org/whl/cu130
  help: `vlm-utils` (v0.1.0) was included because `tlpr[intel]` (v0.1.0) depends on `vlm-utils`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hermeschen1116">@hermeschen1116</a> on 2025-12-22 02:37</div>
            <div class="timeline-body"><p>I tried to explicitly define torch and torchvision again and set override packages so that I don't need to enumerate all the cases but uv now get torch from pypi not the index I specified.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:43 UTC
    </footer>
</body>
</html>
