<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using uv with GraalPy causes some packages to fail to install - astral-sh/uv #16037</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using uv with GraalPy causes some packages to fail to install</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16037">#16037</a>
        opened by <a href="https://github.com/AmaseCocoa">@AmaseCocoa</a>
        on 2025-09-26 09:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AmaseCocoa">@AmaseCocoa</a> on 2025-09-26 09:21</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>GraalPy appears to <a href="https://github.com/oracle/graalpython/blob/736336c7a609a137fe054d5e2421852aa6b34459/graalpython/lib-graalpython/patches/pip-24.3.1.patch">apply its own patches to pip</a> to ensure compatibility with certain libraries. As a result, when attempting to install some libraries with uv, they may not install correctly.</p>
<p>logs:</p>
<p><a href="https://github.com/user-attachments/files/22557069/logs_pip.txt">patched pip log (for example)</a>
<a href="https://github.com/user-attachments/files/22557068/logs_uv.txt">logs by uv</a></p>
<h2>How to Reproduce</h2>
<p>Here we use the cffi library.</p>
<ul>
<li><code>uv add cffi</code><ul>
<li>Returned compile error</li>
</ul>
</li>
<li><code>pip install cffi</code>  (in GraalPy environment)<ul>
<li>Installed correctly</li>
</ul>
</li>
</ul>
<p>Git Repository: https://github.com/AmaseCocoa/uv-mre-001</p>
<p>files (can't updated lockfile and pyproject because, not installed correctly.)</p>
<p>pyproject.toml:</p>
<pre><code class="language-toml">[project]
name = &quot;mre&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = []
</code></pre>
<p>uv.lock</p>
<pre><code>version = 1
revision = 3
requires-python = &quot;&gt;=3.11&quot;

[[package]]
name = &quot;mre&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
</code></pre>
<p>.python-version</p>
<pre><code>graalpy-3.11-any-any-any
</code></pre>
<h3>Platform</h3>
<p>Fedora 42 (Linux 6.16.3-200.fc42.x86_64 x86_64 GNU/Linux)</p>
<h3>Version</h3>
<p>uv 0.8.22</p>
<h3>Python version</h3>
<p>GraalPy 3.11.7 (Oracle GraalVM Native 24.2.2)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AmaseCocoa on 2025-09-26 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-26 09:28</div>
            <div class="timeline-body"><p>While we like to increase compatibility with GraalPy, we can't add external indexes besides PyPI by default in the same way that GraalPy does as it's a third party resource. Can you use <code>--extra-index-url https://www.graalvm.org/python/wheels/</code> as workaround?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AmaseCocoa">@AmaseCocoa</a> on 2025-09-26 09:53</div>
            <div class="timeline-body"><blockquote>
<p>While we like to increase compatibility with GraalPy, we can't add external indexes besides PyPI by default in the same way that GraalPy does as it's a third party resource. Can you use <code>--extra-index-url https://www.graalvm.org/python/wheels/</code> as workaround?</p>
</blockquote>
<p>It appears GraalPy wheel repository isn't includes cffi... I still have same errors...</p>
<p>Upon reviewing the patch applied to the aforementioned pip package, it was confirmed that GraalPy not only retrieves and uses the modified Wheel from the index, but also fetches the patch from the graalpython GitHub repository and uses it to modify the files.</p>
<p>To address this issue, if you are using GraalPy, you may need a solution that involves applying patches downloaded from GitHub as needed, similar to pip for GraalPy. However, I am not sure if this is the best approach for uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timfel">@timfel</a> on 2025-09-27 12:33</div>
            <div class="timeline-body"><p>we are actively upstreaming any patches for graalpy compatibility that we can and are asking packages to publish graalpy wheels. unfortunately, this is a process that just takes a while. we are also going to publish more packages to our own index in the meanwhile, so that there's at least the workaround with the extra index</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:12 UTC
    </footer>
</body>
</html>
