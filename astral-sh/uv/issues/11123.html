<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to build: a package that installs with pip --use-pep517 - astral-sh/uv #11123</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to build: a package that installs with pip --use-pep517</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11123">#11123</a>
        opened by <a href="https://github.com/severance26">@severance26</a>
        on 2025-01-30 23:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/severance26">@severance26</a> on 2025-01-30 23:49</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Installation of a private repo fails in uv, succeeds in pip.</p>
<p>Attempt with uv:</p>
<pre><code>(ntb-scripts) joey@debian:~/repo/nautobot/ntb-scripts$ uv add example-app --index gitlab=https://token:****@gitlab.com/api/v4/projects/666/packages/pypi/simple
Resolved 13 packages in 744ms
  × Failed to build `example-app @ file:///home/joey/repo/nautobot/ntb-scripts`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta.build_editable` failed (exit status: 1)

      [stdout]
      running egg_info

      [stderr]
      error: error in 'egg_base' option: 'src' does not exist or is not a directory

      hint: This usually indicates a problem with the package or the build environment.
</code></pre>
<p>src does exist in the directory, obviously.</p>
<p>Here is the pip attempt:</p>
<pre><code>(venv) joey@debian:~/repo/test$ pip install --use-pep517 example-app --no-deps --index-url https://token:****gitlab.com/api/v4/projects/666/packages/pypi/simple
Looking in indexes: https://token:****@gitlab.com/api/v4/projects/666/packages/pypi/simple
Collecting example-app
  Using cached https://gitlab.com/api/v4/projects/666/packages/pypi/files/65fe38e/handler_nautobot-1.0.0-py3-none-any.whl (3.1 kB)
Installing collected packages: example-app
Successfully installed example-app-1.0.0
</code></pre>
<p>The directions on the uv webpage are pretty lengthy and making a Dockerfile for all this is time-prohibitive for me. However, I believe the pyproject.toml file should be enough for this, since the package installs in pip without issue.</p>
<pre><code>[build-system]
requires = [&quot;setuptools&gt;=61.0&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = &quot;example-app&quot;
version = &quot;1.0.0&quot;
description = &quot;Example App.&quot;
requires-python = &quot;&gt;=3.11&quot;
classifiers = [
    &quot;Programming Language :: Python :: 3&quot;,
    &quot;Operating System :: OS Independent&quot;,
]
dependencies = [
    &quot;requests&quot;
]

# Development dependencies
[project.optional-dependencies]
dev = [
    &quot;coverage==7.6.1&quot;,
    &quot;isort&quot;,
    &quot;mypy&gt;=1.8.0&quot;,
    &quot;types-requests&quot;    
    # Add other type stubs as needed
]

# setuptools configuration:
[tool.setuptools.packages.find]
where = [&quot;src&quot;]

[tool.setuptools.package-data]
&quot;handler_name&quot; = [&quot;py.typed&quot;]  # defines package as typed when imported by workflow

# Mypy global options:
[tool.mypy]
python_version = &quot;3.11&quot;
warn_return_any = true
warn_unused_configs = true

# Ruff configuration
[tool.ruff]
line-length = 120
target-version = &quot;py311&quot;

[tool.ruff.lint]
select = [&quot;PL&quot;]
ignore = [&quot;PLR&quot;, &quot;PLW&quot;]
</code></pre>
<p>The code inside of the root folder is in src/example_app.</p>
<h3>Platform</h3>
<p>Debian 12</p>
<h3>Version</h3>
<p>0.5.25</p>
<h3>Python version</h3>
<p>3.11.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @severance26 on 2025-01-30 23:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-31 02:33</div>
            <div class="timeline-body"><p>Unfortunately I can't reproduce this. I just copied your <code>pyproject.toml</code>, and then created <code>src/example_app/__init__.py</code>.</p>
<pre><code>❯ uv sync
Using CPython 3.13.1
Creating virtual environment at: .venv
Resolved 12 packages in 198ms
   Built example-app @ file:///Users/crmarsh/workspace/puffin/foo
Prepared 2 packages in 502ms
Installed 6 packages in 3ms
 + certifi==2025.1.31
 + charset-normalizer==3.4.1
 + example-app==1.0.0 (from file:///Users/crmarsh/workspace/puffin/foo)
 + idna==3.10
 + requests==2.32.3
 + urllib3==2.3.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-01-31 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-01-31 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-31 02:35</div>
            <div class="timeline-body"><p>What is <code>example-app</code> in your comment? Is that a different project than <code>ntb-scripts</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-31 02:36</div>
            <div class="timeline-body"><p>I get that error if I remove the <code>src</code> directory. Is that your problem?</p>
<pre><code>❯ uv sync --python 3.11 --reinstall -n
Resolved 12 packages in 0.43ms
  × Failed to build `example-app @ file:///Users/crmarsh/workspace/puffin/foo`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta.build_editable` failed (exit status: 1)

      [stdout]
      running egg_info

      [stderr]
      error: error in 'egg_base' option: 'src' does not exist or is not a directory

      hint: This usually indicates a problem with the package or the build environment.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/severance26">@severance26</a> on 2025-01-31 12:59</div>
            <div class="timeline-body"><blockquote>
<p>What is <code>example-app</code> in your comment? Is that a different project than <code>ntb-scripts</code>?</p>
</blockquote>
<p>Its the same, just trying to whitewash the example.</p>
<blockquote>
<p>I get that error if I remove the src directory. Is that your problem?</p>
</blockquote>
<p>No, I most certainly have the src directory in there, its the same package thats installing with pip. It is also unittested and a template that I use often. I've never had trouble with it (pip, poetry) until attempting to install one of my own (uv-built) handlers with <code>uv add</code>.</p>
<p>This weekend I will try to make a Dockerfile of it, or otherwise fine a way around (a friend suggested moving away from uv add), and update or close this thread.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-31 14:33</div>
            <div class="timeline-body"><p>It doesn't need to be a complete Dockerfile. Even just a Git repository that I can clone is fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/severance26">@severance26</a> on 2025-01-31 15:15</div>
            <div class="timeline-body"><p>I am unable to reproduce this outside of this one package. I just built a test package with the same structure and it succeeded. Will have to re-evaluate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @severance26 on 2025-01-31 15:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:59 UTC
    </footer>
</body>
</html>
