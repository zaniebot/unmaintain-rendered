<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support PyPy - astral-sh/uv #2096</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Support PyPy</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2096">#2096</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-02-29 20:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 20:58</div>
            <div class="timeline-body"><p>Right now, <code>uv</code> does not officially support PyPy. It might work, and we've done a few things to enable it, like:</p>
<ul>
<li>https://github.com/astral-sh/uv/pull/1028</li>
<li>https://github.com/astral-sh/uv/pull/1785</li>
<li>https://github.com/astral-sh/uv/pull/2094</li>
</ul>
<p>But we're likely missing a bunch of stuff, like:</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/2095</li>
<li>https://github.com/astral-sh/uv/issues/2092</li>
<li>https://github.com/astral-sh/uv/issues/2490</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2024-02-29 20:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">pypy</span> added by @charliermarsh on 2024-02-29 20:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 20:59</div>
            <div class="timeline-body"><p>Not prioritizing this immediately, but it should happen, and I'd welcome contributors and PRs around it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @konstin on 2024-03-01 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python/typing_extensions/pulls/348.html">python/typing_extensions#348</a> on 2024-03-04 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1636.html">astral-sh/uv#1636</a> on 2024-03-05 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypa/build/pulls/751.html">pypa/build#751</a> on 2024-03-06 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1802.html">astral-sh/uv#1802</a> on 2024-03-07 21:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2490.html">astral-sh/uv#2490</a> on 2024-03-16 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wimglenn">@wimglenn</a> on 2024-03-18 01:43</div>
            <div class="timeline-body"><p>Might be a helpful data-point here - uv seems to select a wheel which it shouldn't when running with PyPy.</p>
<pre><code>$ uv --version 
uv 0.1.21 (e9c12c52f 2024-03-14)
$ python3 -VV
Python 3.10.13 (fc59e61cfbff, Jan 15 2024, 14:31:34)
[PyPy 7.3.15 with GCC Apple LLVM 15.0.0 (clang-1500.1.0.2.5)]
</code></pre>
<p>Example reproducer:</p>
<pre><code>$ cat reqs.in 
psycopg2-binary; implementation_name == 'cpython'
psycopg2; implementation_name != 'cpython'
$ uv pip compile reqs.in -v
DEBUG Starting interpreter discovery for active Python
DEBUG Found a virtualenv through VIRTUAL_ENV at: /private/tmp/p/.venv
DEBUG Probing interpreter info for: /private/tmp/p/.venv/bin/python
DEBUG Found Python 3.10.13 for: /private/tmp/p/.venv/bin/python
DEBUG Using Python 3.10.13 interpreter at /private/tmp/p/.venv/bin/python for builds
DEBUG Using registry request timeout of 300s
DEBUG Solving with target Python version 3.10.13
DEBUG Adding direct dependency: psycopg2*
DEBUG No cache entry for: https://pypi.org/simple/psycopg2/
DEBUG No credentials found for: https://pypi.org/simple/psycopg2/
DEBUG Searching for a compatible version of psycopg2 (*)
DEBUG Selecting: psycopg2==2.9.9 (psycopg2-2.9.9-cp310-cp310-win32.whl)
DEBUG No cache entry for: https://files.pythonhosted.org/packages/a2/14/2767d963915f957c07f5d4c3d9c5c9a407415289f5cde90b82cb3e8c2a12/psycopg2-2.9.9-cp310-cp310-win32.whl.metadata
DEBUG No credentials found for: https://files.pythonhosted.org/packages/a2/14/2767d963915f957c07f5d4c3d9c5c9a407415289f5cde90b82cb3e8c2a12/psycopg2-2.9.9-cp310-cp310-win32.whl.metadata
Resolved 1 package in 370ms
# This file was autogenerated by uv via the following command:
#    uv pip compile reqs.in
psycopg2==2.9.9
</code></pre>
<p>This wheel is unsupported (CPython, windows) and pip (pypy, macOS) would not consider it:</p>
<pre><code>$ pip install https://files.pythonhosted.org/packages/a2/14/2767d963915f957c07f5d4c3d9c5c9a407415289f5cde90b82cb3e8c2a12/psycopg2-2.9.9-cp310-cp310-win32.whl
ERROR: psycopg2-2.9.9-cp310-cp310-win32.whl is not a supported wheel on this platform.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 01:44</div>
            <div class="timeline-body"><p>Can you just confirm that the Python in your virtualenv there is PyPy too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wimglenn">@wimglenn</a> on 2024-03-18 01:51</div>
            <div class="timeline-body"><p>Yes, it is:</p>
<pre><code>$ ls -l .venv/bin 
total 48248
-rw-r--r--  1 wim  wheel      9033 Mar 17 20:25 Activate.ps1
-rw-r--r--  1 wim  wheel      1989 Mar 17 20:25 activate
-rw-r--r--  1 wim  wheel       915 Mar 17 20:25 activate.csh
-rw-r--r--  1 wim  wheel      2195 Mar 17 20:25 activate.fish
-rwxr-xr-x  1 wim  wheel       235 Mar 17 20:33 pip
-rwxr-xr-x  1 wim  wheel       235 Mar 17 20:33 pip3
-rwxr-xr-x  1 wim  wheel       235 Mar 17 20:33 pip3.10
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 pypy -&gt; pypy3
lrwxr-xr-x  1 wim  wheel        20 Mar 17 20:25 pypy3 -&gt; /usr/local/bin/pypy3
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 python -&gt; pypy3
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 python3 -&gt; pypy3
lrwxr-xr-x  1 wim  wheel         5 Mar 17 20:25 python3.10 -&gt; pypy3
-rwxr-xr-x  1 wim  wheel  24665448 Mar 17 20:26 uv
</code></pre>
<p>I created it with <code>/usr/local/bin/pypy3 -m venv .venv</code> and activated it, then installed uv within env.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:01</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:04</div>
            <div class="timeline-body"><p>Oh sorry, to be clear, we let the resolver use incompatible wheels during resolution for the purpose of fetching metadata. So this is fine and intended. The only problem would be if we then <em>installed</em> that wheel with <code>pip sync</code> or <code>pip install</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wimglenn">@wimglenn</a> on 2024-03-18 02:15</div>
            <div class="timeline-body"><p>Hmm, <em>is</em> that really fine? As far as I'm aware, there's no promise that the dependencies specified in the wheel metadata are correct for other environments. It should possible, at least in theory, for <code>mypkg-1.2.3-cp310-cp310-win32.whl</code> to have different dependencies than a <code>pp310-none-any</code> tagged wheel, or even a <code>mypkg-1.2.3.tar.gz</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:22</div>
            <div class="timeline-body"><p>It's an assumption we make in dependency resolution. Poetry and other tools make the same assumption. It's not standardized or guaranteed. There's discussion around it here: https://discuss.python.org/t/lock-files-again-but-this-time-w-sdists/46593/274. There's also some data on it here: https://discuss.python.org/t/insights-into-how-poetry-lock-works-cross-platform/17846/23. At least on PyPI, there are about 700 (out of 523,405) that ship with wheels with different metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2024-03-18 02:31</div>
            <div class="timeline-body"><p>Would it be sufficiently complex to assume that each wheel has different metadata?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:36</div>
            <div class="timeline-body"><p>Not really. It's just an optimization.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wimglenn">@wimglenn</a> on 2024-03-18 02:42</div>
            <div class="timeline-body"><p>Those discuss links are very informative, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:43</div>
            <div class="timeline-body"><p>(If anyone's looking to continue discussing the wheel metadata usage, I humbly request that we do so in a new issue.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/olliemath">@olliemath</a> on 2024-08-16 09:59</div>
            <div class="timeline-body"><p>I noticed that this seems to work pretty well now (I recently installed a large project with &gt;150 requirements under pypy) - what's left to do on this front? Or is it mostly about battle testing various edge cases (e.g. the metadata mismatch)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> removed by @charliermarsh on 2024-08-16 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-16 12:33</div>
            <div class="timeline-body"><p>We might be missing some edge cases around the exact virtualenv executables that are created on various platforms, but I think this is good enough that we can close it, and follow-up on any remaining issues separately as they come up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-16 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-16 12:33</div>
            <div class="timeline-body"><p>(I consider PyPy supported.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ua-parser/uap-python/issues/102.html">ua-parser/uap-python#102</a> on 2025-01-01 10:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michealroberts">@michealroberts</a> on 2025-05-23 06:50</div>
            <div class="timeline-body"><p>This is great.</p>
<p>Sorry to be that dumb monkey, but are there any usage guides on how to use pypy with uv, can we just use:</p>
<pre><code>uv run pypy ...
</code></pre>
<p>as a drop in replacement for</p>
<pre><code>uv run python
</code></pre>
<p>Or am I over simplifying things ...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2025-05-23 07:54</div>
            <div class="timeline-body"><p>You can use <code>--python</code> to say which Python yo use:</p>
<pre><code class="language-sh">uv run --python pypy3 myscript.py
</code></pre>
<p>https://docs.astral.sh/uv/guides/scripts/#using-different-python-versions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michealroberts">@michealroberts</a> on 2025-05-23 09:47</div>
            <div class="timeline-body"><p>@hugovk Cool, and we would install pypy3 with uv or ... into the .venv ... ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2025-05-23 11:10</div>
            <div class="timeline-body"><p>You don't need to worry about it: if you don't already have pypy3 installed, uv will fetch it for you and just use it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michealroberts">@michealroberts</a> on 2025-05-23 11:14</div>
            <div class="timeline-body"><p>Magic ðŸª„ thanks @hugovk Hugo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michealroberts">@michealroberts</a> on 2025-06-12 15:42</div>
            <div class="timeline-body"><p>Note to future me that Google's this in 3-6 months time ... PyPy is only supported up to version 3.11.1. ðŸ˜­</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michealroberts">@michealroberts</a> on 2025-06-12 15:50</div>
            <div class="timeline-body"><p>@hugovk Would you happen to know the steps to use JIT enabled Python with uv? Would this:</p>
<pre><code class="language-python">PYTHON_JIT=1 uv run python bases/observatory/lraq/core.py
</code></pre>
<p>or this</p>
<pre><code class="language-python">uv run python -X jit=1 bases/observatory/lraq/core.py
</code></pre>
<p>Just &quot;work&quot; ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hugovk">@hugovk</a> on 2025-06-13 09:11</div>
            <div class="timeline-body"><p>I've not tried it, let's ask @zanieb.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-13 10:18</div>
            <div class="timeline-body"><p>uv spawns a python subprocess, so all env vars and python args should work just like the do with regular python. Note that by default we're running astral's Python distributions (https://github.com/astral-sh/python-build-standalone), so you may need to check https://gregoryszorc.com/docs/python-build-standalone/main/quirks.html.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-13 13:35</div>
            <div class="timeline-body"><p>Yes since https://github.com/astral-sh/python-build-standalone/pull/538 <code>PYTHON_JIT=1</code> should work. We should take further questions out of this thread, as this is about PyPy support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michealroberts">@michealroberts</a> on 2025-06-16 15:24</div>
            <div class="timeline-body"><p>Agree, thanks @zanieb.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ua-parser/uap-python/issues/272.html">ua-parser/uap-python#272</a> on 2025-08-02 10:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python/pyperformance/pulls/425.html">python/pyperformance#425</a> on 2025-10-26 09:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
