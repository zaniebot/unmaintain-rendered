<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv does not respect `python_requires` in setup.cfg - astral-sh/uv #2192</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv does not respect <code>python_requires</code> in setup.cfg</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2192">#2192</a>
        opened by <a href="https://github.com/danielhollas">@danielhollas</a>
        on 2024-03-05 02:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danielhollas">@danielhollas</a></div>
            <div class="timeline-body"><p>In the <a href="https://github.com/aiidalab/aiidalab-widgets-base/">aiidalab-widgets-base</a> package, we have a mostly empty <code>pyproject.toml</code> that only contains the build-backed section (and some tools-related sections). The dependencies are specified in <code>setup.cfg</code>, including the minimum python version, which is currently 3.9 as of version <code>aiidalab-widgets-base==2.2.0a0</code>.</p>
<p>When running on the system with python 3.8, installing this version from PyPI indeed fails</p>
<pre><code>$ uv pip install aiidalab-widgets-base==2.2.0a0
  × No solution found when resolving dependencies:
  ╰─▶ Because the current Python version (3.8.10) does not satisfy Python&gt;=3.9
      and aiidalab-widgets-base==2.2.0a0 depends on Python&gt;=3.9, we can
      conclude that aiidalab-widgets-base==2.2.0a0 cannot be used.
      And because you require aiidalab-widgets-base==2.2.0a0, we can conclude
      that the requirements are unsatisfiable.
</code></pre>
<p>However, when I try to build and install the package directly from the repo, the installation proceeds &quot;without issues&quot;.</p>
<pre><code>$ git clone https://github.com/aiidalab/aiidalab-widgets-base &amp;&amp; cd aiidalab-widgets-base
$ uv venv
$ uv pip install -e .
   Built file:///home/hollas/temp/uv-test/aiidalab-widgets-base                                                                                                                                                    Built 1 editable in 537ms
Resolved 163 packages in 119ms
Installed 163 packages in 53ms
 + aiida-core==2.3.1
 + aiidalab==23.3.2
 + aiidalab-eln==0.1.2
 + aiidalab-widgets-base==2.2.0a0 (from file:///home/hollas/temp/uv-test/aiidalab-widgets-base)
 + aio-pika==6.8.1
...
...
...
</code></pre>
<p>Installation with <code>pip</code> fails (as it should)</p>
<pre><code>$ python -m pip --require-virtualenv install -e .
Obtaining file:///home/hollas/aiidalab-widgets-base
  Installing build dependencies ... done
  Checking if build backend supports build_editable ... done
  Getting requirements to build editable ... done
  Preparing editable metadata (pyproject.toml) ... done
Requirement already satisfied: PyCifRW~=4.4 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (4.4.6)
Requirement already satisfied: aiida-core&lt;3,&gt;=2.1 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (2.3.1)
Requirement already satisfied: aiidalab&gt;=21.11.2 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (23.3.2)
Requirement already satisfied: aiidalab-eln&gt;=0.1.2,~=0.1 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (0.1.2)
Requirement already satisfied: ansi2html~=1.6 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (1.9.1)
Requirement already satisfied: ase~=3.18 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (3.22.1)
Requirement already satisfied: bokeh~=2.0 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (2.4.3)
Requirement already satisfied: humanfriendly~=10.0 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (10.0)
Requirement already satisfied: ipytree~=0.2 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (0.2.2)
Requirement already satisfied: traitlets~=5.9.0 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (5.9.0)
Requirement already satisfied: ipywidgets~=7.7 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (7.7.4)
Requirement already satisfied: widgetsnbextension&lt;3.6.3 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (3.6.2)
Requirement already satisfied: more-itertools~=8.0 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (8.14.0)
Requirement already satisfied: pymysql~=0.9 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (0.10.1)
Requirement already satisfied: nglview~=3.0 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (3.0.8)
Requirement already satisfied: spglib&lt;3,&gt;=1.14 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (2.3.1)
Requirement already satisfied: vapory~=0.1.2 in ./.venv/lib/python3.8/site-packages (from aiidalab_widgets_base==2.1.0) (0.1.2)
INFO: pip is looking at multiple versions of aiidalab-widgets-base to determine which version is compatible with other requirements. This could take a while.
ERROR: Package &#x27;aiidalab-widgets-base&#x27; requires a different Python: 3.8.10 not in &#x27;&gt;=3.9&#x27;
</code></pre>
<ul>
<li>OS: <code>uname -a</code> Linux 5.15.0-97-generic 107~20.04.1-Ubuntu SMP Fri Feb 9 14:20:11 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux</li>
<li>Python version: 3.8.10</li>
<li>uv version: 0.1.14</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 02:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 02:15</div>
            <div class="timeline-body"><p>I wonder how you&#x27;re supposed to enforce this, given that you can&#x27;t get the <code>Requires-Python</code> until you build the package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 02:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielhollas">@danielhollas</a> on 2024-03-05 02:28</div>
            <div class="timeline-body"><p>Yeah. The last two lines from the <code>pip</code> output posted above indeed seem to only stop after resolving other requirements...</p>
<pre><code>INFO: pip is looking at multiple versions of aiidalab-widgets-base to determine which version is compatible with other requirements. This could take a while.
ERROR: Package &#x27;aiidalab-widgets-base&#x27; requires a different Python: 3.8.10 not in &#x27;&gt;=3.9&#x27;
</code></pre>
<p>Interestingly, when I try to run <code>pip install aiidalab-widgets-base==2.0.0a0</code> into a venv that already has this package installed (via <code>uv</code>), it will happily declare that the requirement is already satisfied and proceeds with the rest.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 02:29</div>
            <div class="timeline-body"><p>Yeah I think we need to build the package, then validate against the built metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielhollas">@danielhollas</a> on 2024-03-05 02:50</div>
            <div class="timeline-body"><p>The number of corner cases y&#x27;all need to deal with is insane --- thanks for all the work! :love_letter:</p>
<p>Just a note that AWB install on GHA went from 1m10s for pip (with cache!) to 11s (without caching). :tada:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 03:44</div>
            <div class="timeline-body"><p>That&#x27;s awesome :)</p>
<p>By the way, if you run with <code>--strict</code>, I confirmed that we will warn after-the-fact:</p>
<pre><code>Built 1 editable in 474ms
Resolved 2 packages in 1ms
Installed 2 packages in 1ms
 + iniconfig==2.0.0
 + setuptools-editable==0.1.0 (from file:///Users/crmarsh/workspace/puffin/scripts/editable-installs/setuptools_editable)
warning: The package `setuptools-editable` requires Python &lt;3.8, but `3.12.1` is installed.
</code></pre>
<p>But we should add this validation at install time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielhollas">@danielhollas</a> on 2024-03-05 04:08</div>
            <div class="timeline-body"><blockquote>
<p>By the way, if you run with --strict, I confirmed that we will warn after-the-fact:</p>
</blockquote>
<p>Cool! Funny, I&#x27;ve just found out about <code>--strict</code> an hour ago, and was a bit surprised that it&#x27;s not a default, since I believe pip does this (or something similar at least) by default. If that&#x27;s something that&#x27;s up for discussion I&#x27;m happy to open an issue with more info / motivating cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 04:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:30:15 UTC
    </footer>
</body>
</html>
