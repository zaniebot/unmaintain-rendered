```yaml
number: 11940
title: "uv python list doesn't recognize foreign-arch installs as installed"
type: issue
state: open
author: geofft
labels:
  - bug
assignees: []
created_at: 2025-03-04T01:46:41Z
updated_at: 2025-09-03T17:56:43Z
url: https://github.com/astral-sh/uv/issues/11940
synced_at: 2026-01-10T01:57:27Z
```

# uv python list doesn't recognize foreign-arch installs as installed

---

_Issue opened by @geofft on 2025-03-04 01:46_

### Summary

```
$ uv python install
Installed Python 3.13.2 in 1.62s
 + cpython-3.13.2-linux-aarch64-gnu
$ uv python install cpython-3.13.2-linux-x86_64-gnu
Installed Python 3.13.2 in 1.66s
 + cpython-3.13.2-linux-x86_64-gnu
$ uv python list --all-versions --all-arches --all-platforms | grep cpython-3.13.2-linux
cpython-3.13.2-linux-x86_64_v4-gnu                     <download available>
cpython-3.13.2-linux-x86_64_v3-gnu                     <download available>
cpython-3.13.2-linux-x86_64_v2-gnu                     <download available>
cpython-3.13.2-linux-x86_64-gnu                        <download available>
cpython-3.13.2-linux-s390x-gnu                         <download available>
cpython-3.13.2-linux-riscv64gc-gnu                     <download available>
cpython-3.13.2-linux-powerpc64le-gnu                   <download available>
cpython-3.13.2-linux-armv7-gnueabihf                   <download available>
cpython-3.13.2-linux-armv7-gnueabi                     <download available>
cpython-3.13.2-linux-aarch64-gnu                       /root/.local/share/uv/python/cpython-3.13.2-linux-aarch64-gnu/bin/python3.13
$ uv python list --only-installed --all-versions --all-arches --all-platforms 
cpython-3.13.2-linux-aarch64-gnu    /root/.local/share/uv/python/cpython-3.13.2-linux-aarch64-gnu/bin/python3.13
$ uv python install cpython-3.13.2-linux-x86_64-gnu
$ ls ~/.local/share/uv/python
cpython-3.13.2-linux-aarch64-gnu  cpython-3.13.2-linux-x86_64-gnu
```

### Platform

NixOS 24.05

### Version

uv 0.6.4

### Python version

3.13

---

_Label `bug` added by @geofft on 2025-03-04 01:46_

---

_Comment by @zanieb on 2025-03-04 01:55_

Is this Python interpreter intended to be usable for some reason (i.e., transparently emulated)?

---

_Comment by @geofft on 2025-03-04 02:09_

Yeah, I was going to turn on Rosetta (this is a Linux VM on an ARM Mac, and [Apple provides a binfmt-misc handler](https://developer.apple.com/documentation/virtualization/running-intel-binaries-in-linux-vms-with-rosetta)), but also it'd be nice if we could support `--only-binary` installs into a completely unrunnable Python? I guess that doesn't work at the moment because

```
$ uv venv -p cpython-3.13.2-linux-x86_64-gnu /tmp/xe
  × Failed to query Python interpreter at `/root/.local/share/uv/python/cpython-3.13.2-linux-x86_64-gnu/bin/python3.13`
  ╰─▶ Exec format error (os error 8)
```

I do get the same behaior of `uv python list` once I enable Rosetta but I can now create a venv.

---

_Comment by @zanieb on 2025-03-04 02:47_

> Yeah, I was going to turn on Rosetta (this is a Linux VM on an ARM Mac, and [Apple provides a binfmt-misc handler](https://developer.apple.com/documentation/virtualization/running-intel-binaries-in-linux-vms-with-rosetta))

Dear goodness, I'm not sure how we're going to detect that case.

>  Also it'd be nice if we could support --only-binary installs into a completely unrunnable Python?

We rely on the Python interpreter to report platform tags, as attempting to assume platform tags from the outside is fraught with problems.

> I do get the same behaior of uv python list once I enable Rosetta but I can now create a venv.

This should be fixable. I think we filter the installed managed interpreters by platform before querying them, but we can attempt to query them all regardless of architecture.

---

_Comment by @zanieb on 2025-03-04 02:49_

Specifically, we may just want to remove https://github.com/astral-sh/uv/blob/db4ab9dc8aecd9c4deaffd6036304aae70d93791/crates/uv-python/src/managed.rs#L253-L254

---

_Comment by @geofft on 2025-03-04 03:27_

> > Yeah, I was going to turn on Rosetta (this is a Linux VM on an ARM Mac, and [Apple provides a binfmt-misc handler](https://developer.apple.com/documentation/virtualization/running-intel-binaries-in-linux-vms-with-rosetta))
> 
> Dear goodness, I'm not sure how we're going to detect that case.

One way would be to see if the ELF interpreter exists, and assume that if (e.g.) /lib64/ld-linux-x86_64.so.1 exists it's because someone wants to at least try to run those. This may not help for static musl builds etc. though.

On Linux I guess you can do it without any attempted execs by looking at /proc/sys/fs/binfmt_misc/* (which is world-readable) and seeing if a known ELF header for the platform (or even the actual Python binary in question) would match the magic/mask:

```
$ cat /proc/sys/fs/binfmt_misc/rosetta
enabled
interpreter /var/lib/rosetta/rosetta
flags: POCF
offset 0
magic 7f454c4602010100000000000000000002003e00
mask fffffffffffefe00fffffffffffffffffeffffff
$ xxd -l20 ~/.local/share/uv/python/*x86*/bin/python3
00000000: 7f45 4c46 0201 0100 0000 0000 0000 0000  .ELF............
00000010: 0200 3e00                                ..>.
```

This should work for qemu-user, Rosetta, FEX-Emu, etc. (You also separately need to know what the native CPU can support on its own, like i386 on x86-64, but that seems like an easier problem. Note that [cargo-dist's platform.rs](https://github.com/axodotdev/cargo-dist/blob/main/cargo-dist/src/platform.rs) does this and also has some heuristics for Mac Rosetta, though not for Linux Rosetta.)

But, more simply, clearly uv "knows" that this installation has been installed, in that asking to install again is a no-op; I just think `uv python list` should be consistent with that.

> 
> > Also it'd be nice if we could support --only-binary installs into a completely unrunnable Python?
> 
> We rely on the Python interpreter to report platform tags, as attempting to assume platform tags from the outside is fraught with problems.

For the python-build-standalone builds in particular, can we not trust ourselves about what they are and what platform tags they support? Would we just need to record this somewhere declarative? (I understand the need to query, like, a system Python.)

---

_Referenced in [astral-sh/uv#13471](../../astral-sh/uv/issues/13471.md) on 2025-05-15 14:31_

---

_Comment by @marcelroed on 2025-09-03 17:03_

With `uv` version `0.8.15` on Linux, I'm getting a related issue leading to `uv python list` failing. It works until there is some cross-platform installation in the directory. I'm doing this in order to build cross-platform libraries.

```sh
marcel@fred:~$ uv python list
cpython-3.14.0rc2-linux-x86_64-gnu                 <download available>
cpython-3.14.0rc2+freethreaded-linux-x86_64-gnu    <download available>
cpython-3.13.7-linux-x86_64-gnu                    <download available>
cpython-3.13.7+freethreaded-linux-x86_64-gnu       <download available>
cpython-3.13.5-linux-x86_64-gnu                    .local/share/uv/python/cpython-3.13.5-linux-x86_64-gnu/bin/python3.13
cpython-3.12.11-linux-x86_64-gnu                   .local/share/uv/python/cpython-3.12.11-linux-x86_64-gnu/bin/python3.12
cpython-3.12.3-linux-x86_64-gnu                    /usr/bin/python3.12
cpython-3.12.3-linux-x86_64-gnu                    /usr/bin/python3 -> python3.12
cpython-3.11.13-linux-x86_64-gnu                   .local/share/uv/python/cpython-3.11.13-linux-x86_64-gnu/bin/python3.11
cpython-3.10.18-linux-x86_64-gnu                   <download available>
cpython-3.9.23-linux-x86_64-gnu                    <download available>
cpython-3.8.20-linux-x86_64-gnu                    <download available>
pypy-3.11.13-linux-x86_64-gnu                      <download available>
pypy-3.10.16-linux-x86_64-gnu                      <download available>
pypy-3.9.19-linux-x86_64-gnu                       <download available>
pypy-3.8.16-linux-x86_64-gnu                       <download available>
graalpy-3.11.0-linux-x86_64-gnu                    <download available>
graalpy-3.10.0-linux-x86_64-gnu                    <download available>
graalpy-3.8.5-linux-x86_64-gnu                     <download available>
```
```sh
marcel@fred:~$ uv python install cpython-3.13.7-macos-aarch64-none
Installed Python 3.13.7 in 316ms
 + cpython-3.13.7-macos-aarch64-none (python3.13)
```
```sh
marcel@fred:~$ uv python list
error: Failed to inspect Python interpreter from first executable in the search path at `.local/bin/python3.13`
  Caused by: Failed to query Python interpreter at `/home/marcel/.local/bin/python3.13`
  Caused by: Exec format error (os error 8)
```

---

_Referenced in [astral-sh/uv#15667](../../astral-sh/uv/issues/15667.md) on 2025-09-03 17:56_

---

_Comment by @zanieb on 2025-09-03 17:56_

Thanks @marcelroed! That looks like a separate bug. I opened https://github.com/astral-sh/uv/issues/15667 to track it.

---
