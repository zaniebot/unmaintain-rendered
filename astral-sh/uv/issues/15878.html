<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set `UV_CACHE_DIR` for different drives - astral-sh/uv #15878</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Set `UV_CACHE_DIR` for different drives</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15878">#15878</a>
        opened by <a href="https://github.com/5hayanB">@5hayanB</a>
        on 2025-09-15 16:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/5hayanB">@5hayanB</a> on 2025-09-15 16:33</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have a drive mounted at <code>/mnt</code> while the default <code>uv</code> cache directory is at <code>~/.cache/uv</code>. I was installing <code>pytest</code> at the <code>/mnt</code> mounted drive but was met with the following warning.</p>
<pre><code>warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance.
         If the cache and target directories are on different filesystems, hardlinking may not be supported.
         If this is intentional, set `export UV_LINK_MODE=copy` or use `--link-mode=copy` to suppress this warning.
</code></pre>
<p>I stumbled on <a href="https://github.com/astral-sh/uv/issues/7285">this issue</a> and saw the <a href="https://github.com/astral-sh/uv/issues/7285#issuecomment-2910917037">recommended approach</a>. It would be a convenient feature to set individual <code>uv</code> cache directory for each mounted drive without having to export the <code>UV_CACHE_DIR</code> env variable or passing the <code>--cache-dir</code> option to an invocation command every time. I think it could be implemented by adding entries of the cache directories for each drive in the user or system level configuration files (i.e. <code>~/.config/uv/uv.toml</code> or <code>/etc/uv/uv.toml</code>).</p>
<h3>Example</h3>
<p>Invoking a <code>uv pip install pytest</code> on a different drive will not show the following error.</p>
<pre><code>warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance.
         If the cache and target directories are on different filesystems, hardlinking may not be supported.
         If this is intentional, set `export UV_LINK_MODE=copy` or use `--link-mode=copy` to suppress this warning.
</code></pre>
<p><code>uv</code> would search the user or system level configuration file for an entry of a cache directory for the drive it is being invoked in and use that directory for its cache related usage.</p>
<h3>Before</h3>
<pre><code>❯ uv pip install pytest
Resolved 5 packages in 119ms
░░░░░░░░░░░░░░░░░░░░ [0/5] Installing wheels...                                                                                                                                                                      warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance.
         If the cache and target directories are on different filesystems, hardlinking may not be supported.
         If this is intentional, set `export UV_LINK_MODE=copy` or use `--link-mode=copy` to suppress this warning.
Installed 5 packages in 52ms
 + iniconfig==2.1.0
 + packaging==25.0
 + pluggy==1.6.0
 + pygments==2.19.2
 + pytest==8.4.2
</code></pre>
<h3>After</h3>
<pre><code>❯ uv pip install pytest
Resolved 5 packages in 250ms
Prepared 5 packages in 282ms
Installed 5 packages in 8ms
 + iniconfig==2.1.0
 + packaging==25.0
 + pluggy==1.6.0
 + pygments==2.19.2
 + pytest==8.4.2
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @5hayanB on 2025-09-15 16:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-15 16:46</div>
            <div class="timeline-body"><p>The trick will be coming up with a reasonable scheme for configuring this. I think we want to map some prefix path to a cache path, e.g., <code>UV_CACHE_DIR=/mnt/foo=/mnt/foo/.cache,/mnt/bar=/mnt/bar/.cache</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @zanieb on 2025-09-15 16:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
