<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow the `--python` flag in `uv pip install` to take the location of a venv - astral-sh/uv #3060</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow the <code>--python</code> flag in <code>uv pip install</code> to take the location of a venv</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3060">#3060</a>
        opened by <a href="https://github.com/pfmoore">@pfmoore</a>
        on 2024-04-16 10:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pfmoore">@pfmoore</a></div>
            <div class="timeline-body"><p>Pip allows you to install into a given virtual environment using <code>pip install --python /path/to/.venv ...</code>. This is a minor convenince feature because it lets you specify the environment without needing to consider the platform difference of where the interpreter is located <code>bin/python</code> or <code>Scripts/python.exe</code></p>
<p>Could <code>uv</code> add the same feature?</p>
<p>(From a brief scan of the code, it appears that this would simply involve an extra branch in <code>find_python::find_requested_python</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-16 13:13</div>
            <div class="timeline-body"><p>This seems reasonable to me but may have some nuances. There&#x27;s some relevant discussion in <a href="https://github.com/astral-sh/uv/issues/1795">astral-sh/uv#1795</a> where we are unclear about how to select a Python interpreter found in a virtual environment.</p>
<p>For my own notes, we&#x27;d probably want to track this in the design at #2386</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-16 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-16 13:17</div>
            <div class="timeline-body"><p>Yeah this seems reasonable to support. I think it should be straightforwardish? If we&#x27;re passed a directory, assume it&#x27;s a virtualenv, in which case the Python must be at <code>.venv/bin/python</code> or <code>.venv/Scripts/python.exe</code> depending on the platform.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-04-16 13:35</div>
            <div class="timeline-body"><blockquote>
<p>This seems reasonable to me but may have some nuances.</p>
</blockquote>
<p>I don&#x27;t think so - if the argument to <code>--python</code> is a directory, look for <code>&lt;supplied_dir&gt;/bin/python</code> (on Unix) or <code>&lt;supplied_dir&gt;/Scripts/python.exe</code> (on Windows)[^1] and use that in its place. We only do this if the user explicitly supplies <code>--python</code>, so there&#x27;s no implication on the environment discovery code.</p>
<p>#1795 is about <code>uv venv</code> - I wasn&#x27;t thinking of this for <code>uv venv</code> but even so, I don&#x27;t think it will make a difference. The same code still runs, we just pre-process the <code>--python</code> argument value.</p>
<blockquote>
<p>If we&#x27;re passed a directory, assume it&#x27;s a virtualenv, in which case the Python must be at .venv/bin/python or .venv/Scripts/python.exe depending on the platform.</p>
</blockquote>
<p>Yep, that&#x27;s what pip does. I&#x27;m happy to try to contribute a PR if you&#x27;d like. I&#x27;m pretty new at Rust, though, so it could take me a little while to set things up. And I&#x27;ve no experience writing tests in Rust, so I may need some help there.</p>
<p>[^1]: I&#x27;d actually check both, just to cover things like Cygwin.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-16 13:38</div>
            <div class="timeline-body"><p>Ah I missed that this was <em>just</em> for <code>pip install</code> that seems really straight-forward.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-04-16 14:58</div>
            <div class="timeline-body"><p>There <em>is</em> an interesting nuance here, though. <code>python -m pip install -p .venv ...</code> currently means &quot;search for a Python executable called <code>.venv</code> in <code>PATH</code>&quot;, because the path search is triggered by the lack of a separator in the value. Changing that would be a behaviour change (although I&#x27;d have trouble imagining someone calling their virtual environment <code>python.exe</code>, so it&#x27;s unlikely to matter in practice).</p>
<p>I&#x27;d propose the following behaviour:</p>
<ol>
<li>Check for a version number as at present.</li>
<li>Otherwise, if the <code>--python</code> value is a path to an existing file, use that as the interpreter.</li>
<li>If it&#x27;s a directory, assume it&#x27;s a venv and use the venv interpreter.</li>
<li>Otherwise, if it contains a path separator, fail with an error.</li>
<li>Finally (a filename with no path part) try a search on <code>PATH</code>.</li>
</ol>
<p>Does this sound reasonable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-16 15:00</div>
            <div class="timeline-body"><p>Yeah, it does sound reasonable to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-04-16 15:28</div>
            <div class="timeline-body"><p>I&#x27;ve had a go at writing a PR: <a href="https://github.com/astral-sh/uv/pull/3064">astral-sh/uv#3064</a> It&#x27;s very basic, so feel free to ignore it if you prefer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-16 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-25 14:35</div>
            <div class="timeline-body"><p>@pfmoore when you say path separator here... do you mean <code>PATH</code> separator or file system path separator? lol</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-04-25 14:48</div>
            <div class="timeline-body"><p>Sorry, I meant <code>/</code> on Unix, and <code>\</code> or <code>/</code> on Windows - so <em>filesystem</em> separator (<code>os.sep</code>/<code>os.altsep</code>, rather than <code>os.pathsep</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-25 14:53</div>
            <div class="timeline-body"><p>Great thanks I figured so :) Might want to error on both even.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pfmoore">@pfmoore</a> on 2024-04-25 15:12</div>
            <div class="timeline-body"><p>At the end of the day, anything that isn&#x27;t an executable on <code>$PATH</code> will fail with an error anyway, so this is mostly an optimisation to fail fast on things that can&#x27;t possibly be the name of a Python interpreter.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:30:49 UTC
    </footer>
</body>
</html>
