```yaml
number: 4420
title: "uv pip compile of in file containing `--no-binary {pkg}` does not include that directive in requirements.txt"
type: issue
state: closed
author: philvarner
labels:
  - enhancement
  - compatibility
assignees: []
created_at: 2024-06-19T21:51:44Z
updated_at: 2024-06-24T12:25:02Z
url: https://github.com/astral-sh/uv/issues/4420
synced_at: 2026-01-10T01:57:09Z
```

# uv pip compile of in file containing `--no-binary {pkg}` does not include that directive in requirements.txt

---

_Issue opened by @philvarner on 2024-06-19 21:51_

This seems to be intended to be supported based on PR/issues:

- https://github.com/astral-sh/uv/pull/2680
- https://github.com/astral-sh/uv/issues/1461
- https://github.com/astral-sh/uv/issues/1687

Running this version of uv on arm64 / Apple Silicon / MacOS with Python 3.10.12

```
$ uv --version
uv 0.2.13 (fa6ed3410 2024-06-18)
```

with this requirements.in file:

```
rasterio~=1.3.10 --no-binary=rasterio
```

the uv pip compile command gives an error:

```
$ uv pip compile --strip-extras -U --no-emit-package setuptools requirements.in -o requirements.txt
error: Expected '--hash', found '"--no-binary=rasterio"' at requirements.in:1:18
```

---

_Renamed from "Error with `--no-binary`, even though it's supposed to be supported" to "Error with pip compile with `--no-binary`, even though it's supposed to be supported" by @philvarner on 2024-06-19 21:52_

---

_Comment by @zanieb on 2024-06-19 21:57_

Hi! These need to be on separate lines e.g.

```
rasterio~=1.3.10
--no-binary rasterio
```

---

_Label `question` added by @zanieb on 2024-06-19 21:57_

---

_Comment by @philvarner on 2024-06-19 22:16_

@zanieb Ah, great, that worked, thanks! I'll submit a PR to add that to the compatibility document, as pip-compile accepts it on the same line and two of the examples in the tickets I linked also did that.

---

_Closed by @philvarner on 2024-06-19 22:16_

---

_Reopened by @philvarner on 2024-06-19 22:26_

---

_Comment by @philvarner on 2024-06-19 22:27_

@zanieb  I spoke too soon -- I don't get the error when It's on a separate line, but the output `requirements.txt` file is missing `--no-binary rasterio`

---

_Comment by @zanieb on 2024-06-19 22:47_

Hm interesting I don't think we echo _any_ settings to the output file. I confirmed this does happen with `pip compile`

```
--index-url https://test.pypi.org/simple/
attrs~=23.2.0
```

```
❯ uv tool run --from pip-tools -- pip-compile requirements.in
warning: `uv tool run` is experimental and may change without warning.
Resolved 8 packages in 4ms
Installed 8 packages in 20ms
 + build==1.2.1
 + click==8.1.7
 + packaging==24.1
 + pip==24.0
 + pip-tools==7.4.1
 + pyproject-hooks==1.1.0
 + setuptools==70.1.0
 + wheel==0.43.0
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.12
# by the following command:
#
#    pip-compile requirements.in
#
--index-url https://test.pypi.org/simple/

attrs==23.2.0
    # via -r requirements.in
```

but not uv.

We'll see what Charlie says — I am not familiar with the intent here.


---

_Comment by @notatallshaw on 2024-06-20 15:49_

`--index-url` has an `--emit-index-url` option that defaults different between uv and pip-tools: https://github.com/astral-sh/uv/blob/main/PIP_COMPATIBILITY.md#pip-compile-defaults

FYI this is not an issue for my use case, the motivator of that PR, because the packages I want pip compile to resolve on don't have a binary version (wheels), so I don't need to specifiy `--no-binary` at install time, only at compile time when I am using it in combination with `--only-binary :all:`.

But perhaps @philvarner has a use case where there is a wheel and they don't want to install it?

---

_Comment by @zanieb on 2024-06-20 15:53_

Ah thanks for clarifying that, forgot about that default difference.

I feel like we need to emit these for correctness during installations since the `.txt` lock format doesn't distinguish between wheels and source distributions? Following the pattern of our other flags, maybe we need a `--emit-build-options` option.

---

_Renamed from "Error with pip compile with `--no-binary`, even though it's supposed to be supported" to "uv pip compile of in file containing `--no-binary {pkg}` does not include that directive in requirements.txt" by @philvarner on 2024-06-21 16:37_

---

_Comment by @charliermarsh on 2024-06-23 16:00_

It looks like `pip-compile` has `--no-emit-options`/`--emit-options`. We can add that? Or `--emit-build-options` is fine.

---

_Label `question` removed by @charliermarsh on 2024-06-23 16:00_

---

_Label `enhancement` added by @charliermarsh on 2024-06-23 16:00_

---

_Label `compatibility` added by @charliermarsh on 2024-06-23 16:00_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-06-23 17:20_

---

_Referenced in [astral-sh/uv#4463](../../astral-sh/uv/pulls/4463.md) on 2024-06-24 00:33_

---

_Closed by @charliermarsh on 2024-06-24 12:25_

---

_Closed by @charliermarsh on 2024-06-24 12:25_

---

_Referenced in [techmatters/terraso-backend#1616](../../techmatters/terraso-backend/pulls/1616.md) on 2025-02-27 05:32_

---

_Referenced in [home-operations/containers#361](../../home-operations/containers/pulls/361.md) on 2025-04-18 15:34_

---
