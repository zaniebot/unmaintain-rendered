<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unexpected: uv works offline initially, but fails after 5-10 minutes - astral-sh/uv #14754</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unexpected: uv works offline initially, but fails after 5-10 minutes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14754">#14754</a>
        opened by <a href="https://github.com/ajfriend">@ajfriend</a>
        on 2025-07-20 17:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ajfriend">@ajfriend</a></div>
            <div class="timeline-body">Summary
<p>I&#x27;m new to <code>uv</code>, and so far it has been great. Thanks! But in true &quot;If You Give a Mouse a Cookie&quot; fashion, I&#x27;ve got an additional request :)</p>
<p>I&#x27;m often working without an internet connection, and it would be great if I could depend on <code>uv</code>&#x27;s package caching to build a project from scratch.</p>
<p>However, as I&#x27;ve played with it, it seems like this behavior only works for about 5--10 minutes after going offline, and fails afterwards with an error like:</p>
<pre><code>Using CPython 3.13.5
Creating virtual environment at: .venv
‚†∏ uv-offline-test==0.1.0                                                                  error: Failed to fetch: `https://pypi.org/simple/pytest/`
  Caused by: Request failed after 3 retries
  Caused by: error sending request for url (https://pypi.org/simple/pytest/)
  Caused by: client error (Connect)
  Caused by: dns error
  Caused by: failed to lookup address information: nodename nor servname provided, or not known
</code></pre>
<p>I&#x27;ve got a minimal example repo with reproduction instructions at: https://github.com/ajfriend/uv_offline_test</p>
<p>(Normally, I might not delete the <code>.venv</code> or delete the lockfile, but it would be nice to not be afraid of doing these things, especially since they <strong>do work</strong> for about 10 minutes, currently.)</p>
<p>This behavior was surprising/unexpected to me since things worked initially offline, but failed later in the day. I had to do some experimentation to determine that the threshold was about 10 minutes. (In at least one test, it happened after 5 minutes, so it might be variable?)</p>
<p>I&#x27;m guessing this is due to some cache expiration policy? What&#x27;s the reasoning behind the current 10 minutes, and would it be possible to extend it, or provide an option to do so? Would it make sense to defer/delay the cache expiration if <code>uv</code> notices that it is offline?</p>
<p>Thanks!</p>
Platform
<p>Darwin 24.5.0 arm64</p>
Version
<p>uv 0.8.0 (0b2357294 2025-07-17)</p>
Python version
<p>Python 3.13.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ajfriend">@ajfriend</a> on 2025-07-20 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-20 17:09</div>
            <div class="timeline-body"><p>10 minutes is the expiration time in PyPI cache headers. Have you used <code>--offline</code>? We won&#x27;t revalidate requests then.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-20 17:10</div>
            <div class="timeline-body"><p>Related <a href="https://github.com/astral-sh/uv/issues/10380">astral-sh/uv#10380</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ajfriend">@ajfriend</a> on 2025-07-20 18:43</div>
            <div class="timeline-body"><p>Thanks for the quick response!</p>
<p>Using <code>--offline</code> does mostly work for my use case, but I agree with the comment in <a href="https://github.com/astral-sh/uv/issues/10380">astral-sh/uv#10380</a>: having a <code>--best-effort</code> or &quot;Online with Fallback&quot; mode would be ideal. Personally, I&#x27;d probably use such a flag as the default in my workflows, so I don‚Äôt have to change depending on whether I‚Äôm online or not.</p>
<p>I also understand the motivation to respect PyPI cache headers, but there feels like a bit of a discontinuity in the user experience: If I keep my existing environment, everything continues to work using stale cache. But if I try to recreate the exact same state from scratch (even using only previously-cached packages) I get penalized just because the metadata is &quot;too old&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-21 01:47</div>
            <div class="timeline-body"><p>üëç Closing in favor of <a href="https://github.com/astral-sh/uv/issues/10380">astral-sh/uv#10380</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-21 01:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ajfriend">@ajfriend</a> on 2025-07-21 03:32</div>
            <div class="timeline-body"><p>üëç</p>
<p>For my future reference, the <code>UV_OFFLINE</code> environment variable is probably the easiest way to toggle this behavior.</p>
<p>E.g., justfile syntax:</p>
<pre><code>export UV_OFFLINE := &quot;1&quot;
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:32 UTC
    </footer>
</body>
</html>
