<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit handling of hashes in the lockfile - astral-sh/uv #4924</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Audit handling of hashes in the lockfile</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4924">#4924</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-07-09 11:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Audit our handling of hashes. Some hashes are generated. Some are retrieved from registries. Sometimes hashes should not be used (path dependencies) where as sometimes they should (registry dependencies).</p>
<p>I think there are three main issues here:</p>
<p>First is that hashes come from two places: one place is the registry itself. Another place is by hashes we compute ourselves. Which hashes do we use in the lock file? Does it matter? Which <em>should</em> we use?</p>
<p>Second is that we often have multiple hashes available for any given artifact. Do we need to store all of them in the lock file? Or can we just pick the &quot;best&quot; one?</p>
<p>Third is whether we are doing any hash checking. I don't <em>think</em> we are today. But we probably should be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Audit our handling of hashes. Some hashes are generated. Some are retrieved from registries. Sometimes hashes should not be used (path dependencies) where as sometimes they should (registry dependencies)." to "Audit handling of hashes in the lockfile" by @konstin on 2024-07-09 11:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-07-09 11:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-16 18:23</div>
            <div class="timeline-body"><p>I can answer all of these questions (regarding what we do today) if helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-16 19:14</div>
            <div class="timeline-body"><p>Do you expect that we have to change the lockfile (schema) for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-16 19:17</div>
            <div class="timeline-body"><p>I think we need to make hashes optional for registry-based distributions. I can't remember if it's optional today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-07-17 01:25</div>
            <div class="timeline-body"><p>If we make them optional in the lock file, then we won't be able to do hash checking. Are we okay with that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 01:28</div>
            <div class="timeline-body"><p>We can still hash-check the distributions for which we <em>do</em> have hashes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-07-17 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-17 16:57</div>
            <div class="timeline-body"><blockquote>
<p>First is that hashes come from two places: one place is the registry itself. Another place is by hashes we compute ourselves. Which hashes do we use in the lock file? Does it matter? Which should we use?</p>
</blockquote>
<p>I think we should follow the strategy we already use today: if from the registry, we use the registry-provided hashes; if from a direct URL, we compute the hash ourselves. If the registry lacks hashes, we don't include any hashes (and warn the user).</p>
<blockquote>
<p>Second is that we often have multiple hashes available for any given artifact. Do we need to store all of them in the lock file? Or can we just pick the &quot;best&quot; one?</p>
</blockquote>
<p>I think we should just store the &quot;best&quot; one to save space. I'll verify that we're doing this today.</p>
<blockquote>
<p>Third is whether we are doing any hash checking. I don't think we are today. But we probably should be.</p>
</blockquote>
<p>We aren't. I think we should add &quot;verify any hashes that exist, but don't require them&quot; (so that we can still interoperate with registries that lack hashes).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-17 23:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:32 UTC
    </footer>
</body>
</html>
