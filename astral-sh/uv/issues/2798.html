<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install` and `uv pip sync` both perform each uninstall twice causing the second one to fail - astral-sh/uv #2798</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv pip install` and `uv pip sync` both perform each uninstall twice causing the second one to fail</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2798">#2798</a>
        opened by <a href="https://github.com/Daverball">@Daverball</a>
        on 2024-04-03 07:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Daverball">@Daverball</a> on 2024-04-03 07:05</div>
            <div class="timeline-body"><p>I'm running into some really strange behavior where running <code>uv pip install</code> causes each package to be uninstalled twice, causing a missing RECORD file error on the second uninstall. Considering I'm not passing <code>--reinstall</code> it shouldn't even do a single uninstall.</p>
<p>As far as I can tell it doesn't cause any real issues and is still a lot faster than pip this way, but it is very noisy.</p>
<p>I'm on Linux x86_64 (OpenSUSE Tumbleweed) with uv 0.1.28</p>
<p><code>uv pip install uv --verbose</code></p>
<details><summary>Details</summary>
<p>

<pre><code>INFO Found a virtualenv through VIRTUAL_ENV at: /home/david/git/ocqms/venv
DEBUG Cached interpreter info for Python 3.10.14, skipping probing: venv/bin/python
DEBUG Using Python 3.10.14 environment at venv/bin/python
DEBUG Using registry request timeout of 300s
DEBUG Solving with target Python version 3.10.14
DEBUG Adding direct dependency: uv*
DEBUG Found fresh response for: https://pypi.org/simple/uv/
DEBUG Ignoring installed versions of uv: multiple distributions found
DEBUG Searching for a compatible version of uv (*)
DEBUG Ignoring installed versions of uv: multiple distributions found
DEBUG Selecting: uv==0.1.28 (uv-0.1.28-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/bf/23/e65d0f8cd4d9904a82a616c265bb30ccc802b16226b964e9f668da26dc2b/uv-0.1.28-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata
Resolved 1 package in 2ms
DEBUG Preserving seed package: pip==23.0.1
DEBUG Preserving seed package: setuptools==69.2.0
DEBUG Preserving seed package: pip==23.0.1
DEBUG Preserving seed package: setuptools==69.2.0
DEBUG Uninstalled uv (11 files, 3 directories)
warning: Failed to uninstall package at venv/lib64/python3.10/site-packages/uv-0.1.28.dist-info due to missing RECORD file. Installation may result in an incomplete environment.
Installed 1 package in 63ms
 - uv==0.1.28
 - uv==0.1.28
 + uv==0.1.28
</code></pre>
</p>
</details> 

<p>To me it looks like uv gets confused by there being both a <code>lib</code> and <code>lib64</code> folder, the latter of which is a symbolic link to the former. As soon as I remove the symbolic link <code>uv</code> starts to behave normally. Having <code>lib64</code> as an alias for <code>lib</code> inside virtual environments is an OpenSUSE thing as far as I am aware.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-03 14:16</div>
            <div class="timeline-body"><p>Oh interesting. Thanks for raising!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-04-03 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2024-04-03 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-03 14:17</div>
            <div class="timeline-body"><p>@zanieb - Perhaps when we iterate over <code>site_packages</code>, we filter out symlinks, not just duplicate paths...?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2806.html">astral-sh/uv#2806</a> on 2024-04-03 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-03 14:44</div>
            <div class="timeline-body"><p>@Daverball I put up https://github.com/astral-sh/uv/pull/2806 if you want to give it a try â€” I'm having a hard time constructing a test case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-04-11 22:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @zanieb by @charliermarsh on 2024-04-11 22:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-11 22:09</div>
            <div class="timeline-body"><p>I was able to reproduce in a container.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3002.html">astral-sh/uv#3002</a> on 2024-04-11 23:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-11 23:54</div>
            <div class="timeline-body"><p>Fixed (with a test) in https://github.com/astral-sh/uv/pull/3002.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-12 21:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
