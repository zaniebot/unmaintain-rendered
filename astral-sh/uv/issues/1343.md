```yaml
number: 1343
title: "`uv pip compile` does not annotate direct dependencies e.g. `via -r requirements.in`"
type: issue
state: closed
author: ThiefMaster
labels:
  - compatibility
assignees: []
created_at: 2024-02-15T21:05:31Z
updated_at: 2024-05-09T22:12:13Z
url: https://github.com/astral-sh/uv/issues/1343
synced_at: 2026-01-10T01:57:01Z
```

# `uv pip compile` does not annotate direct dependencies e.g. `via -r requirements.in`

---

_Issue opened by @ThiefMaster on 2024-02-15 21:05_

I found this kind pretty useful to immediately see which entries in `requirements.txt` come from direct dependencies, and to also see which ones are both direct and transitive ones.

To reproduce:

- Clone https://github.com/indico/indico/ (or get the `requirements*` files)
- Run `uv pip compile requirements.in -o requirements.txt`
- See the (partial) diff below:

```diff
diff --git a/requirements.txt b/requirements.txt
index e376581100..b2eae90d3f 100644
--- a/requirements.txt
+++ b/requirements.txt
@@ -1,40 +1,26 @@
-#
-# This file is autogenerated by pip-compile with Python 3.9
-# by the following command:
-#
-#    pip-compile --strip-extras
-#
+# This file was autogenerated by uv v0.1.0 via the following command:
+#    uv pip compile requirements.in -o requirements.txt
 alembic==1.12.1
-    # via
-    #   -r requirements.in
-    #   flask-migrate
+    # via flask-migrate
 amqp==5.2.0
     # via kombu
 asttokens==2.4.1
     # via
     #   sentry-sdk
     #   stack-data
-async-timeout==4.0.3
-    # via redis
 attrs==23.1.0
     # via
     #   jsonschema
     #   referencing
 authlib==1.2.1
-    # via -r requirements.in
 babel==2.13.1
-    # via
-    #   -r requirements.in
-    #   flask-babel
+    # via flask-babel
 bcrypt==4.0.1
-    # via -r requirements.in
 billiard==4.2.0
     # via celery
 bleach==6.1.0
-    # via -r requirements.in
[...]
```

---

_Comment by @ThiefMaster on 2024-02-15 21:12_

Especially while this tool is new it also makes it MUCH harder to compare output from pip-tools and uv, since there's lots of noise in the diff from this.

---

_Comment by @ThiefMaster on 2024-02-15 21:35_

Not removing it would also allow for something similar to ruff's ecosystem checks. Not sure if such checks exist atm (I found some issues related to them but no actual code)...

---

_Label `compatibility` added by @charliermarsh on 2024-02-15 21:36_

---

_Referenced in [astral-sh/ruff-pre-commit#68](../../astral-sh/ruff-pre-commit/pulls/68.md) on 2024-02-15 22:45_

---

_Referenced in [inventree/InvenTree#6499](../../inventree/InvenTree/pulls/6499.md) on 2024-02-16 19:52_

---

_Referenced in [python-trio/trio#2958](../../python-trio/trio/pulls/2958.md) on 2024-02-16 23:49_

---

_Referenced in [astral-sh/uv#1665](../../astral-sh/uv/issues/1665.md) on 2024-02-18 20:00_

---

_Referenced in [astral-sh/uv#1797](../../astral-sh/uv/issues/1797.md) on 2024-02-21 06:35_

---

_Comment by @jzmiller1 on 2024-02-23 20:02_

The lack of the -r requirements.in in the output has been a blocker on using uv to replace pip-compile in some projects I work on.  Glad to see this already on the radar.

---

_Referenced in [astral-sh/uv#2160](../../astral-sh/uv/issues/2160.md) on 2024-03-04 16:01_

---

_Referenced in [astral-sh/uv#2162](../../astral-sh/uv/issues/2162.md) on 2024-03-04 16:55_

---

_Renamed from "`uv pip compile` removes `via -r requirements.in`" to "`uv pip compile` does not annotate direct dependencies e.g. `via -r requirements.in`" by @zanieb on 2024-03-04 16:59_

---

_Referenced in [edgarrmondragon/citric#1115](../../edgarrmondragon/citric/pulls/1115.md) on 2024-03-08 00:11_

---

_Comment by @Djailla on 2024-03-25 15:17_

Hello @charliermarsh do you have an update on this issue ?

Thanks a lot !

---

_Referenced in [astral-sh/uv#3066](../../astral-sh/uv/issues/3066.md) on 2024-04-16 16:32_

---

_Comment by @palfrey on 2024-04-21 20:30_

FYI, I'm (slowly) having a bit of of a poke at this one. @charliermarsh I'm assuming you'd be interested in PRs for this one right?

---

_Comment by @charliermarsh on 2024-04-21 21:30_

Yeah happily. Let me know if you run into issues or have questions.

---

_Referenced in [astral-sh/uv#3269](../../astral-sh/uv/pulls/3269.md) on 2024-04-25 20:29_

---

_Comment by @palfrey on 2024-04-25 21:02_

@charliermarsh (and anyone else interested): https://github.com/astral-sh/uv/pull/3269 is a first draft at this. It has the major redeeming feature that it works (i.e. does the requested item here), but there's a stack of unresolved questions in the PR that need figuring out.

Also, it's needed some fairly chunky changes overall, and there's probably at least _some_ stylistic changes that are wanted (although I tried to keep to the same style as the surrounding code)!

---

_Closed by @charliermarsh on 2024-05-09 03:19_

---

_Comment by @charliermarsh on 2024-05-09 14:43_

Will be supported in the next version thanks to @palfrey.

---

_Comment by @matmair on 2024-05-09 22:12_

Thank you @palfrey - this will make dependabot updates so much less annoying

---
