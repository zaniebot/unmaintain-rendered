<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two versions of numpy installed at the same time - astral-sh/uv #11442</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Two versions of numpy installed at the same time</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11442">#11442</a>
        opened by <a href="https://github.com/Ramlaoui">@Ramlaoui</a>
        on 2025-02-12 11:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Ramlaoui">@Ramlaoui</a> on 2025-02-12 11:29</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hello! Thanks for adding the functionality for conflicting dependencies. I have an issue however with Numpy, where the two conflicting versions are being installed and the older one is used when I boot up Python.</p>
<p>Here is my <code>pyproject.toml</code> file:</p>
<pre><code class="language-toml">[project]
readme = &quot;README.md&quot;
authors = []
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
    &quot;hydra-core&gt;=1.3.2&quot;,
    &quot;rich&gt;=13.9.4&quot;,
    &quot;torch&gt;=2.4.0&quot;,
    &quot;tqdm&gt;=4.67.1&quot;,
    &quot;pandas&gt;=2.2.3&quot;,
    &quot;pymatgen&gt;=2024.11.13&quot;,
    &quot;datasets&gt;=3.2.0&quot;,
    &quot;lightning&gt;=2.5.0.post0&quot;,
    &quot;mlflow&gt;=2.20.1&quot;,
    &quot;ase&gt;=3.24.0&quot;,
    &quot;torch_geometric&gt;=2.4.0&quot;,
    # Linux dependencies
    &quot;pyg-lib&gt;=0.4.0; sys_platform != 'darwin'&quot;,
    &quot;torch_scatter==2.1.2+pt24cu124; sys_platform != 'darwin'&quot;,
    &quot;torch-sparse==0.6.18+pt24cu124; sys_platform != 'darwin'&quot;,
    &quot;torch-cluster==1.6.3+pt24cu124; sys_platform != 'darwin'&quot;,
    &quot;torch-spline-conv==1.2.2+pt24cu124; sys_platform != 'darwin'&quot;,
    # macOS dependencies
    &quot;torch_scatter==2.1.2; sys_platform == 'darwin'&quot;,
    &quot;torch-sparse==0.6.18; sys_platform == 'darwin'&quot;,
    &quot;torch-cluster==1.6.3; sys_platform == 'darwin'&quot;,
    &quot;torch-spline-conv==1.2.2; sys_platform == 'darwin'&quot;,
]

[build-system]
requires = [&quot;hatchling&quot;, &quot;setuptools&quot;]
build-backend = &quot;hatchling.build&quot;

[project.optional-dependencies]
compile = [
    &quot;pyg-lib&gt;=0.4.0&quot;
]
fairchem = [
    &quot;fairchem-core&gt;=1.4.0&quot;,
    &quot;pyg-lib&gt;=0.4.0&quot;,
    &quot;e3nn&gt;=0.5.0&quot;,
    &quot;numpy==1.26.4&quot;,
]
mace = [
    &quot;mace-torch&gt;=0.3.10&quot;,
    &quot;pyg-lib&gt;=0.4.0&quot;,
    &quot;e3nn==0.4.4&quot;,
    &quot;numpy==2.2.2&quot;,
]

[tool.uv.sources]
pyg_lib = [{ git = &quot;https://github.com/pyg-team/pyg-lib.git&quot;, marker = &quot;sys_platform == 'darwin'&quot; }]
torch = [
    { index = &quot;torch-cu124&quot;, marker = &quot;sys_platform != 'darwin'&quot; },
    { index = &quot;torch-cpu&quot;, marker = &quot;sys_platform == 'darwin'&quot; },
]

[[tool.uv.index]]
name = &quot;torch-cu124&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
explicit = true

[[tool.uv.index]]
name = &quot;torch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[tool.uv]
dev-dependencies = [
    &quot;ipython&gt;=8.29.0&quot;,
    &quot;ipdb&gt;=0.13.13&quot;,
    &quot;ruff&gt;=0.7.1&quot;,
    &quot;pytest&gt;=8.3&quot;,
    &quot;shibuya&gt;=2024.10.15&quot;,
    &quot;sphinx-autoapi&gt;=3.3.2&quot;,
    &quot;sphinx-autodoc-typehints&gt;=2.5.0&quot;,
    &quot;sphinx-code-include&gt;=1.4.0&quot;,
    &quot;sphinx-copybutton&gt;=0.5.2&quot;,
    &quot;sphinx-design&gt;=0.6.1&quot;,
    &quot;sphinx-math-dollar&gt;=1.2.1&quot;,
    &quot;sphinxawesome-theme&gt;=5.3.2&quot;,
    &quot;pre-commit&gt;=4.0.1&quot;,
    &quot;beautifulsoup4&gt;=4.12.3&quot;,
    &quot;lxml&gt;=5.3.0&quot;,
    &quot;requests&gt;=2.32.3&quot;,
]
# these packages use torch, so we need to build them in the same environment
no-build-isolation-package = [&quot;pyg-lib&quot;, &quot;torch-scatter&quot;, &quot;torch-sparse&quot;, &quot;torch-cluster&quot;, &quot;torch-spline-conv&quot;]
find-links = [
  &quot;https://data.pyg.org/whl/torch-2.4.0+cu124.html&quot;,
  &quot;https://data.pyg.org/whl/torch-2.4.0+cpu.html&quot;,
]
conflicts = [
    # Conflict with e3nn and numpy
    [
        { extra = &quot;fairchem&quot; },
        { extra = &quot;mace&quot; },
    ]
]

[tool.ruff.lint]
extend-select = [&quot;I&quot;]
</code></pre>
<p>The problem is that when I run</p>
<pre><code class="language-bash">$ uv sync
$ uv sync --extra mace
</code></pre>
<p>I get both numpy versions:</p>
<pre><code class="language-bash"> ~ numpy==1.26.4
 ~ numpy==2.2.2
</code></pre>
<p>And they get reinstalled every time I do <code>uv sync --extra mace</code>.</p>
<pre><code class="language-bash">Python 3.11.9 (main, Apr  2 2024, 08:25:04) [Clang 15.0.0 (clang-1500.3.9.4)]
Type 'copyright', 'credits' or 'license' for more information
IPython 8.32.0 -- An enhanced Interactive Python. Type '?' for help.

[ins] In [1]: import numpy
numpy
[ins] In [2]: numpy.__version__
Out[2]: '1.26.4'
</code></pre>
<p>Thanks!</p>
<h3>Platform</h3>
<p>macOS 14 arm64</p>
<h3>Version</h3>
<p>uv 0.5.29 (ca73c4754 2025-02-05)</p>
<h3>Python version</h3>
<p>Python 3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Ramlaoui on 2025-02-12 11:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @konstin on 2025-02-12 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-12 13:13</div>
            <div class="timeline-body"><p>Are you able to share your <code>uv.lock</code>, too?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-02-12 13:14</div>
            <div class="timeline-body"><p>OK, so I was able to reproduce this, but your <code>pyproject.toml</code> as given didn't work for me. I had to add a <code>name</code> and <code>version</code> to your <code>[project]</code> section. I also had to remove your <code>[build-system]</code> <em>and</em> manually install <code>setuptools</code> into the environment. Once I did that, I could see two different versions of <code>numpy</code> being installed:</p>
<pre><code>$ rm -rf uv.lock .venv &amp;&amp; uv-0.5.29 venv &amp;&amp; uv-0.5.29 pip install setuptools &amp;&amp; uv-0.5.29 sync -p3.12 --extra mace 2&gt;&amp;1 | rg numpy
Using CPython 3.13.0
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
Resolved 1 package in 2ms
Installed 1 package in 14ms
 + setuptools==75.8.0
 + numpy==1.26.4
 + numpy==2.2.2
</code></pre>
<p>I wondered if #11323 fixed this, so I ran with <code>uv 0.5.30</code> (the latest release, where as it looks like you're using <code>0.5.29</code>):</p>
<pre><code>$ rm -rf uv.lock .venv &amp;&amp; uv venv &amp;&amp; uv pip install setuptools &amp;&amp; uv sync -p3.12 --extra mace 2&gt;&amp;1 | rg numpy
Using CPython 3.13.0
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
Resolved 1 package in 18ms
Installed 1 package in 13ms
 + setuptools==75.8.0
 + numpy==2.2.2
</code></pre>
<p>And indeed, it looks like this bug has been fixed. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-02-12 13:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-02-12 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @BurntSushi on 2025-02-12 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ramlaoui">@Ramlaoui</a> on 2025-02-12 14:16</div>
            <div class="timeline-body"><p>Amazing, thanks a lot!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:00 UTC
    </footer>
</body>
</html>
