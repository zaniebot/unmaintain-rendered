```yaml
number: 6417
title: "`uv cache prune` causes self update to fail"
type: issue
state: closed
author: weihenglim
labels:
  - bug
  - windows
assignees: []
created_at: 2024-08-22T09:42:23Z
updated_at: 2024-08-23T02:04:58Z
url: https://github.com/astral-sh/uv/issues/6417
synced_at: 2026-01-10T01:57:14Z
```

# `uv cache prune` causes self update to fail

---

_Issue opened by @weihenglim on 2024-08-22 09:42_

On Windows, running `uv cache prune` removes `uv-receipt.json` from the cache, which leads to `uv` being unable to self update:
 ```cmd
>uv cache prune -v
DEBUG uv 0.3.0
Pruning cache at: C:\Users\User\AppData\Local\uv
DEBUG Removing dangling cache entry: C:\Users\User\AppData\Local\uv\uv-receipt.json
Removed 1 file (253B)

>uv self update -v
DEBUG uv 0.3.0
DEBUG no receipt found; assuming uv was installed via a package manager
warning: Self-update is only available for uv binaries installed via the standalone installation scripts.
```

---

_Label `bug` added by @konstin on 2024-08-22 10:15_

---

_Label `windows` added by @konstin on 2024-08-22 10:15_

---

_Comment by @charliermarsh on 2024-08-22 12:29_

Ohh, thanks. That's interesting.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-08-22 12:40_

---

_Comment by @charliermarsh on 2024-08-22 13:09_

Did you move the cache at all? I think the cache by default is at `C:\Users\User\AppData\Local\uv\cache`.

---

_Comment by @weihenglim on 2024-08-22 13:16_

No, nothing was configured. Just tested a fresh install on another Windows 11 machine and the cache directory defaults to `AppData\Local\uv` as well.
```cmd
>powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
Downloading uv 0.3.1 (x86_64-pc-windows-msvc)
Installing to C:\Users\Admin\.cargo\bin
  uv.exe
  uvx.exe
everything's installed!

>uv cache dir -v
DEBUG uv 0.3.1
C:\Users\Admin\AppData\Local\uv
```


---

_Comment by @charliermarsh on 2024-08-22 13:19_

Ahh sorry, I think the cache directory changed slightly in v0.3.0.

---

_Comment by @charliermarsh on 2024-08-22 13:20_

(But in a backwards-compatible way, so my machine was still using the previous location.)

---

_Comment by @weihenglim on 2024-08-22 13:27_

As a temporary workaround, manually moving all the files (except `uv-receipt.json`) to `AppData\Local\uv\cache` seems to fix the issue (and `uv cache dir` properly detects the new cache location)

---

_Comment by @charliermarsh on 2024-08-22 17:03_

Yeah, that makes sense. Will fix though.

---

_Referenced in [astral-sh/uv#6482](../../astral-sh/uv/pulls/6482.md) on 2024-08-23 01:21_

---

_Closed by @charliermarsh on 2024-08-23 02:04_

---

_Closed by @charliermarsh on 2024-08-23 02:04_

---

_Referenced in [astral-sh/uv#6774](../../astral-sh/uv/issues/6774.md) on 2024-10-27 02:22_

---
