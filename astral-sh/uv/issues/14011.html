<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` not respecting pinned package version - astral-sh/uv #14011</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv add` not respecting pinned package version</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/14011">#14011</a>
        opened by <a href="https://github.com/seh-dev">@seh-dev</a>
        on 2025-06-12 22:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/seh-dev">@seh-dev</a> on 2025-06-12 22:51</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Summary:
despite having a pinned <code>numpy==2.2.3</code> version defined in our <code>pyproject.toml</code> and <code>uv.lock</code> file, when a new package with an unbounded <code>numpy&gt;=1.11.0</code> dependency version is specified, <code>uv</code> still appears to be trying to retrieve the latest <code>numpy==2.3.0</code> version which has no wheels available on AL2 (corresponding numpy issue: https://github.com/numpy/numpy/issues/29150)</p>
<p>for whatever reason <code>uv</code> tries to <code>build</code> <code>numpy==2.3.0</code>, which fails due to an incompatible <code>gcc</code> version, resulting in the whole <code>add</code> or <code>sync</code> operation to fail prematurely, despite the pinned <code>2.2.3</code> version existing and being a valid version for the project.</p>
<h4>Behavior</h4>
<p>running</p>
<pre><code class="language-bash">uv add numpy==2.2.3
uv add reverse-geocoder==1.5.1
</code></pre>
<p>fails because numpy <code>2.3.0</code> can't be built.</p>
<h4>Expected Behavior</h4>
<p>The operation uses the pinned version of <code>numpy</code>, or at least falls back gracefully to this version if building a newer version fails</p>
<p>Here's the MRE using the AL2 docker file:</p>
<pre><code class="language-bash">$ docker run -it --rm amazonlinux:2 /bin/bash
# yum update -y
# yum install -y tar gzip gcc clang python3-pip
# curl -LsSf https://astral.sh/uv/install.sh | sh
# uv --version
# # uv 0.7.12
# mkdir test &amp;&amp; cd test
# uv init
# uv add numpy==2.2.3
# uv add reverse-geocoder==1.5.1
  x Failed to download and build `reverse-geocoder==1.5.1`
  |-&gt; Failed to install requirements from `build-system.requires`
  |-&gt; Failed to build `numpy==2.3.0`
  |-&gt; The build backend returned an error
  `-&gt; Call to `mesonpy.build_wheel` failed (exit status: 1)

      [stdout]
      + /root/.cache/uv/builds-v0/.tmp8TTmGH/bin/python /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/vendored-meson/meson/meson.py setup
      /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-dksjqaqm -Dbuildtype=release
      -Db_ndebug=if-release -Db_vscrt=md --native-file=/root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-dksjqaqm/meson-python-native-file.ini
      The Meson build system
      Version: 1.6.1
      Source dir: /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src
      Build dir: /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-dksjqaqm
      Build type: native build
      Project name: NumPy
      Project version: 2.3.0
      C compiler for the host machine: cc (gcc 7.3.1 &quot;cc (GCC) 7.3.1 20180712 (Red Hat 7.3.1-17)&quot;)
      C linker for the host machine: cc ld.bfd 2.29.1-31
      C++ compiler for the host machine: c++ (gcc 7.3.1 &quot;c++ (GCC) 7.3.1 20180712 (Red Hat 7.3.1-17)&quot;)
      C++ linker for the host machine: c++ ld.bfd 2.29.1-31
      Cython compiler for the host machine: cython (cython 3.1.2)
      Host machine cpu family: x86_64
      Host machine cpu: x86_64

      ../meson.build:28:4: ERROR: Problem encountered: NumPy requires GCC &gt;= 9.3

      A full log can be found at /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-dksjqaqm/meson-logs/meson-log.txt

      hint: This usually indicates a problem with the package or the build environment.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.
</code></pre>
<h3>Additional Information</h3>
<p>Installing <code>reverse-geocoder</code> via <code>pip</code> works, but via <code>uv pip</code> does not.</p>
<pre><code class="language-bash"># pip3 install reverse-geocoder
WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.
Collecting reverse-geocoder
  Downloading reverse_geocoder-1.5.1.tar.gz (2.2 MB)
     |████████████████████████████████| 2.2 MB 5.8 MB/s 
Collecting numpy&gt;=1.11.0
  Using cached numpy-1.21.6-cp37-cp37m-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (15.7 MB)
Collecting scipy&gt;=0.17.1
  Downloading scipy-1.7.3-cp37-cp37m-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (38.1 MB)
     |████████████████████████████████| 38.1 MB 24.2 MB/s 
Using legacy 'setup.py install' for reverse-geocoder, since package 'wheel' is not installed.
Installing collected packages: numpy, scipy, reverse-geocoder
    Running setup.py install for reverse-geocoder ... done
Successfully installed numpy-1.21.6 reverse-geocoder-1.5.1 scipy-1.7.3
</code></pre>
<pre><code class="language-bash"># uv pip install reverse-geocoder
  x Failed to download and build `reverse-geocoder==1.5.1`
  |-&gt; Failed to install requirements from `build-system.requires`
  |-&gt; Failed to build `numpy==2.3.0`
  |-&gt; The build backend returned an error
  `-&gt; Call to `mesonpy.build_wheel` failed (exit status: 1)

      [stdout]
      + /root/.cache/uv/builds-v0/.tmpKI9YfE/bin/python /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/vendored-meson/meson/meson.py setup
      /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-mzm0i2zc -Dbuildtype=release
      -Db_ndebug=if-release -Db_vscrt=md --native-file=/root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-mzm0i2zc/meson-python-native-file.ini
      The Meson build system
      Version: 1.6.1
      Source dir: /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src
      Build dir: /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-mzm0i2zc
      Build type: native build
      Project name: NumPy
      Project version: 2.3.0
      C compiler for the host machine: cc (gcc 7.3.1 &quot;cc (GCC) 7.3.1 20180712 (Red Hat 7.3.1-17)&quot;)
      C linker for the host machine: cc ld.bfd 2.29.1-31
      C++ compiler for the host machine: c++ (gcc 7.3.1 &quot;c++ (GCC) 7.3.1 20180712 (Red Hat 7.3.1-17)&quot;)
      C++ linker for the host machine: c++ ld.bfd 2.29.1-31
      Cython compiler for the host machine: cython (cython 3.1.2)
      Host machine cpu family: x86_64
      Host machine cpu: x86_64

      ../meson.build:28:4: ERROR: Problem encountered: NumPy requires GCC &gt;= 9.3

      A full log can be found at /root/.cache/uv/sdists-v9/pypi/numpy/2.3.0/A-oyixwjPXghkYgyLarjK/src/.mesonpy-mzm0i2zc/meson-logs/meson-log.txt

      hint: This usually indicates a problem with the package or the build environment.
</code></pre>
<h3>Platform</h3>
<p>Amazon Linux 2 (Linux 6.8.0-1029-aws x86_64 GNU/Linux)</p>
<h3>Version</h3>
<p>0.7.12</p>
<h3>Python version</h3>
<p>3.13.4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @seh-dev on 2025-06-12 22:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 23:01</div>
            <div class="timeline-body"><pre><code>  x Failed to download and build `reverse-geocoder==1.5.1`
  |-&gt; Failed to install requirements from `build-system.requires`
  |-&gt; Failed to build `numpy==2.3.0`
</code></pre>
<p>It looks like <code>reverse-geocoder</code> requires <code>numpy</code> as a build requirement, which is installed in an isolated environment to build the parent package so the resolver does not consider the dependencies of your project.</p>
<p>You could try to apply a constraint on the build dependency, to prefer a different numpy version https://docs.astral.sh/uv/reference/settings/#build-constraint-dependencies</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 23:02</div>
            <div class="timeline-body"><p>It looks like that would work, since they don't pin a particular numpy version in their build requires https://inspector.pypi.io/project/reverse-geocoder/1.5.1/packages/0b/0f/b7d5d4b36553731f11983e19e1813a1059ad0732c5162c01b3220c927d31/reverse_geocoder-1.5.1.tar.gz/reverse_geocoder-1.5.1/setup.py#line.27</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 23:03</div>
            <div class="timeline-body"><p>We're working on preferring build dependencies that are coherent with your project dependencies, but it's complicated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-06-12 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-06-12 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seh-dev">@seh-dev</a> on 2025-06-13 17:14</div>
            <div class="timeline-body"><p>Thanks for all the information! That should work as a workaround for our current case.</p>
<p>If graceful fallbacks on build-errors or a more direct solution suing the project dependencies are too complicated, I still might humbly suggest adding a log if there's a build error to have the user consider adding build-constraint-dependency docs; in this case, the suggested <code>--frozen</code> flag didn't help resolve the issue or lead to any relevant docs that could have helped diagnose and fix the issue independently.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:04 UTC
    </footer>
</body>
</html>
