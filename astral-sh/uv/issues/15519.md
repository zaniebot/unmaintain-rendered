```yaml
number: 15519
title: Offline uv sync still requires dev dependencies and attempts PyPI fetches with --frozen --no-index
type: issue
state: open
author: JunYanOOO
labels:
  - question
assignees: []
created_at: 2025-08-25T16:25:52Z
updated_at: 2025-09-10T13:29:02Z
url: https://github.com/astral-sh/uv/issues/15519
synced_at: 2026-01-10T01:57:34Z
```

# Offline uv sync still requires dev dependencies and attempts PyPI fetches with --frozen --no-index

---

_Issue opened by @JunYanOOO on 2025-08-25 16:25_

### Question

### Summary
When preparing an offline production install, uv sync appears to (a) include the dev dependency group even though I set [tool.uv].default-groups = [], and (b) with --frozen --no-index --find-links=./wheelhouse, it still attempts to fetch from PyPI instead of resolving only from the local wheelhouse.


`pyproject.toml`

```
[project]
name = "test"
version = "0.1.0"
requires-python = "==3.12.11"
dependencies = [
    "flask==3.1.1",
    "redis==6.2.0",
]

[dependency-groups]
dev = [
    "pytest>=8.4.1",
]

[tool.uv]
default-groups = []
```

For production, I pre-download wheels into ./wheelhouse (including Flask/Redis) and want to exclude all dev deps (e.g., pytest) from the sync.

1. Create a project with the pyproject.toml above.
2. Download required wheels in ./wheelhouse.
`uvx pip wheel --only-binary=:all: -r requirements.txt -w wheelhouse`
4. In an offline production machine, run:`uv sync --no-index --find-links=./wheelhouse`
4. Observe resolution error mentioning pytest from the dev group:
```
Using CPython 3.12.11
Creating virtual environment at: .venv
  × No solution found when resolving dependencies:
  ╰─▶ Because pytest was not found in the provided package locations and test:dev depends on pytest>=8.4.1,
      we can conclude that test:dev's requirements are unsatisfiable.
      And because your project requires test:dev, we can conclude that your project's requirements are
      unsatisfiable.
```
5. Now try the frozen, offline installation:
`uv sync --no-index --find-links=./wheelhouse --frozen`
6. It attempts a network fetch from PyPI:
```
  × Failed to download `flask==3.1.1`
  ├─▶ Failed to fetch:
  │   `https://files.pythonhosted.org/packages/3d/68/9d4508e893976286d2ead7f8f571314af6c2037af34853a30fd769c02e9d/flask-3.1.1-py3-none-any.whl`
  ├─▶ Request failed after 3 retries
  ├─▶ error sending request for url
  │   (https://files.pythonhosted.org/packages/3d/68/9d4508e893976286d2ead7f8f571314af6c2037af34853a30fd769c02e9d/flask-3.1.1-py3-none-any.whl)
  ├─▶ client error (Connect)
  ├─▶ dns error
  ╰─▶ failed to lookup address information: Temporary failure in name resolution
  help: `flask` (v3.1.1) was included because `test` (v0.1.0) depends on `flask`
```

### Questions

1. Is disabling default groups via `default-groups = []` intended to exclude `dev` by default during uv `sync`?
2. Should `--no-index` + `--find-links` be honored during `--frozen` syncs so that no network access is attempted?
3. What is the recommended, fully-offline workflow to sync production deps from a local wheelhouse without including any dev groups?

### Platform

Ubuntu 22.04

### Version

uv 0.8.2

---

_Label `question` added by @JunYanOOO on 2025-08-25 16:25_

---

_Comment by @charliermarsh on 2025-08-25 16:32_

> Observe resolution error mentioning pytest from the dev group

I think this part makes sense, because generating `uv.lock` requires that we resolve _all_ dependencies, even those that won't ultimately be included. So to generate or validate a `uv.lock`, we need to resolve the dev dependencies. To avoid that, you need to use `--frozen`, which skips lockfile validation.

> It attempts a network fetch from PyPI

This part is indeed confusing user behavior but I'm unsure on whether it's correct. `--no-index` and `--frozen` should probably be considered an error? Because `--no-index` would require us to re-resolve the `uv.lock`, but `--frozen` tells us to use it as-is. I guess we could arguably show a clearer error like: "The lockfile requires us to fetch from an index, but you told us to use `--no-index`". I don't think the use of `--no-index --frozen` can work though.

> What is the recommended, fully-offline workflow to sync production deps from a local wheelhouse without including any dev groups?

I don't know if we have a perfect answer here right now. Typically I think you'd `uv sync` to populate a cache, then rely on the cache rather than syncing a local wheelhouse.


---

_Comment by @JunYanOOO on 2025-08-26 03:17_

> I don't know if we have a perfect answer here right now. Typically I think you'd uv sync to populate a cache, then rely on the cache rather than syncing a local wheelhouse.

Just to confirm: are you suggesting that I pre-populate uv’s cache on a development machine (with internet access), then copy that cache to the production host and have production rely on it—rather than syncing from a local wheelhouse—so uv sync can run fully offline (and without the dev group)? 



---

_Comment by @detlefla on 2025-09-10 10:17_

I'm running into the same problem. I tried to get the dependencies from `uv pip list` and/or `uv tree` and use these to populate the wheelhouse. The platform-irrelevant dependencies aren't listed there but are required by `uv add`.

Copying the lockfile to the production machine creates other problems, BTW: `uv.lock` contains the pathname of the wheelhouse, and this has to be identical on the production machine then. Or I must tweak `uv.lock` whose format is not a public interface (AFAICT).

Or could we manipulate the lockfile and remove all irrelevant dependencies? No good feelings about that here.

---

_Comment by @zanieb on 2025-09-10 13:29_

@detlefla the issue here is about using `--no-index` with `--frozen` which you shouldn't do as they're conflicting options (uv should error in the future). Could you open a new issue with more details? (Unless you're doing that same thing)

---
