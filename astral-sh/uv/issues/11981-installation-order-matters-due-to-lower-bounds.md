---
number: 11981
title: "Installation order matters due to lower bounds generated by `uv add`"
type: issue
state: open
author: hoechenberger
labels:
  - question
  - error messages
assignees: []
created_at: 2025-03-05T16:12:45Z
updated_at: 2025-03-06T12:34:28Z
url: https://github.com/astral-sh/uv/issues/11981
synced_at: 2026-01-10T01:25:13Z
---

# Installation order matters due to lower bounds generated by `uv add`

---

_Issue opened by @hoechenberger on 2025-03-05 16:12_

### Question

Hello, today at work we were running into a peculiar issue. It's not a bug _per se,_ but something that gave us a bit of a headache.

In a situation where we couldn't `uv add` all dependencies in a single call, the lower bounds added to `pyproject.toml` through the first call made it impossible to add another dependency in subsequent calls:

First call:
```shell
‚ùØ uv init -p 3.13 test
Initialized project `test` at `/private/tmp/test`
‚ùØ cd test
‚ùØ uv add numpy
Using CPython 3.13.1
Creating virtual environment at: .venv
Resolved 2 packages in 127ms
Prepared 1 package in 204ms
Installed 1 package in 15ms
 + numpy==2.2.3
```

Second call:
```shell
‚ùØ uv add --dev numba
Resolved 5 packages in 293ms
  √ó Failed to build `numba==0.53.1`
  ‚îú‚îÄ‚ñ∂ The build backend returned an error
  ‚ï∞‚îÄ‚ñ∂ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File "<string>", line 14, in <module>
          requires = get_requires_for_build({})
        File
      "/Users/richardhochenberger/Library/Caches/uv/builds-v0/.tmpGkijwM/lib/python3.13/site-packages/setuptools/build_meta.py",
      line 334, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File
      "/Users/richardhochenberger/Library/Caches/uv/builds-v0/.tmpGkijwM/lib/python3.13/site-packages/setuptools/build_meta.py",
      line 304, in _get_build_requires
          self.run_setup()
          ~~~~~~~~~~~~~~^^
        File
      "/Users/richardhochenberger/Library/Caches/uv/builds-v0/.tmpGkijwM/lib/python3.13/site-packages/setuptools/build_meta.py",
      line 522, in run_setup
          super().run_setup(setup_script=setup_script)
          ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File
      "/Users/richardhochenberger/Library/Caches/uv/builds-v0/.tmpGkijwM/lib/python3.13/site-packages/setuptools/build_meta.py",
      line 320, in run_setup
          exec(code, locals())
          ~~~~^^^^^^^^^^^^^^^^
        File "<string>", line 50, in <module>
        File "<string>", line 47, in _guard_py_ver
      RuntimeError: Cannot install on Python version 3.13.1; only versions >=3.6,<3.10 are
      supported.

      hint: This usually indicates a problem with the package or the build environment.
  help: `numba` (v0.53.1) was included because `test:dev` (v0.1.0) depends on `numba`
```
The latest version of `numba` is actually 0.61.0; `uv` is backtracking to using version `0.53.1`, which doesn't support Python 3.13.

Third call, explicitly requesting `numba==0.61`:
```shell
‚ùØ uv add --dev "numba==0.61"
  √ó No solution found when resolving dependencies:
  ‚ï∞‚îÄ‚ñ∂ Because numba==0.61.0 depends on numpy>=1.24,<2.2 and test:dev depends on numba==0.61, we can
      conclude that test:dev depends on numpy>=1.24,<2.2.
      And because your project depends on numpy>=2.2.3, we can conclude that your project and
      test:dev are incompatible.
      And because your project requires your project and test:dev, we can conclude that your
      project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen`
        flag to skip locking and syncing.
```
Numba 0.61 only supports NumPy up to 2.1.

Obviously, after lowering the NumPy version requirement in `pyproject.toml` to 2.1, the `numba` installation succeeds.

It also succeeds if I install both packages, `numpy` and `numba`, in a single invocation of `uv add`.

However, in the above example, I had to split `uv add` into two separate calls since I wanted to add `numba` to the `dev` dependency group.

I know that this behavior is most probably intentional, and what we've seen in the second call may be due to a `numba` packaging bug (forgetting to set an upper bound for NumPy). But to make things work, we now either have to do:

```shell
‚ùØ uv add "numpy<=2.1"
‚ùØ uv add --dev numba
```
or, if we want to avoid having to explicitly set upper bounds:

```shell
‚ùØ uv add --dev numba
‚ùØ uv add numpy
```

But this isn't something we can always ensure when working on an "organically evolving" project ‚Äì¬†we would like to add dependencies in any order, at any time.

I would have preferred if `uv` had offered to downgrade the `numpy` requirement in order to accommodate my explicit request for `numba`.

### Platform

macOS Sequoia 15.3.1, arm64

### Version

uv 0.6.4 (04db70662 2025-03-03)

---

_Label `question` added by @hoechenberger on 2025-03-05 16:12_

---

_Comment by @zanieb on 2025-03-05 21:51_

Tricky. Thanks for the report. I'm not sure what we can do here.

cc @konstin presumably you'd find this interesting

---

_Comment by @konstin on 2025-03-06 08:21_

That's tricky.

One option would be improving the error message by noting that we're backtracking on the recently added package, which is likely wrong.

---

_Label `error messages` added by @konstin on 2025-03-06 08:21_

---

_Comment by @hoechenberger on 2025-03-06 09:15_

I think this would already help a bunch, yes!

Still wouldn't solve the problem that "order matters" though üòï

---

_Comment by @hoechenberger on 2025-03-06 12:33_

FWIW, `uv pip install` behaves more the way I would expect (and prefer):

```shell
‚ùØ uv init -p 3.13 test && cd test && uv venv && uv pip install numpy && uv pip install numba
Initialized project `test` at `/private/tmp/test`
Using CPython 3.13.1
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
Resolved 1 package in 140ms
Installed 1 package in 23ms
 + numpy==2.2.3
Resolved 3 packages in 176ms
Uninstalled 1 package in 56ms
Installed 3 packages in 21ms
 + llvmlite==0.44.0
 + numba==0.61.0
 - numpy==2.2.3
 + numpy==2.1.3
```

Of course, I know it doesn't respect any dependencies in `pyproject.toml` or a lock file; but the general flow ‚Äì user explicitly requests a package, so we downgrade conflicting ones ‚Äì feels natural to me. It didn't need to backtrack on `numba`.


---

_Referenced in [astral-sh/uv#12126](../../astral-sh/uv/issues/12126.md) on 2025-03-12 01:46_

---
