<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv creates a new directory with a new .venv instead of using the .venv in the project root - astral-sh/uv #15170</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv creates a new directory with a new .venv instead of using the .venv in the project root</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15170">#15170</a>
        opened by <a href="https://github.com/dwschulze">@dwschulze</a>
        on 2025-08-08 17:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dwschulze">@dwschulze</a></div>
            <div class="timeline-body"><p>From a linux terminal (no VIRTUAL_ENV set):</p>
<p>$ ls -lad .venv
drwxrwxr-x 5 dean dean 4096 Jul 27 13:55 .venv
$ uv run pytest tests/test_train_bpe.py
error: Failed to spawn: <code>pytest</code>
Caused by: No such file or directory (os error 2)
$ uv run --active pytest tests/test_train_bpe.py
error: Failed to spawn: <code>pytest</code>
Caused by: No such file or directory (os error 2)</p>
<p>$ uv -v run pytest tests/test_train_bpe.py
DEBUG uv 0.8.3
DEBUG Found project root: <code>/home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics</code>
DEBUG No workspace root found, using project root
DEBUG Discovered project <code>cs336-basics</code> at: /home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics
DEBUG Acquired lock for <code>/home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics</code>
DEBUG No Python version file found in workspace: /home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics
DEBUG Using Python request <code>&gt;=3.11</code> from <code>requires-python</code> metadata
DEBUG Checking for Python environment at: <code>.venv</code>
DEBUG The project environment&#x27;s Python version satisfies the request: <code>Python &gt;=3.11</code>
DEBUG Released lock at <code>/tmp/uv-3709aa3b51281ab9.lock</code>
DEBUG Acquired lock for <code>.venv</code>
DEBUG Using request timeout of 30s
DEBUG Found static <code>pyproject.toml</code> for: cs336-basics @ file:///home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics
DEBUG No workspace root found, using project root
DEBUG Existing <code>uv.lock</code> satisfies workspace requirements
Resolved 70 packages in 1ms
DEBUG Using request timeout of 30s
DEBUG Computed cache info: Some(Timestamp(SystemTime { tv_sec: 1754669305, tv_nsec: 777821987 })), None, None, {}, {&quot;src&quot;: None}
DEBUG Requirement already installed: cs336-basics==1.0.3 (from file:///home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics)
DEBUG Requirement already installed: einops==0.8.1
DEBUG Requirement already installed: einx==0.3.0
DEBUG Requirement already installed: jaxtyping==0.3.1
DEBUG Requirement already installed: numpy==2.2.4
DEBUG Requirement already installed: psutil==7.0.0
DEBUG Requirement already installed: pytest==8.3.5
DEBUG Requirement already installed: regex==2024.11.6
DEBUG Requirement already installed: submitit==1.5.2
DEBUG Requirement already installed: tiktoken==0.9.0
DEBUG Requirement already installed: torch==2.6.0
DEBUG Requirement already installed: tqdm==4.67.1
DEBUG Requirement already installed: transformers==4.55.0
DEBUG Requirement already installed: wandb==0.19.9
DEBUG Requirement already installed: frozendict==2.4.6
DEBUG Requirement already installed: sympy==1.13.1
DEBUG Requirement already installed: wadler-lindig==0.1.4
DEBUG Requirement already installed: iniconfig==2.1.0
DEBUG Requirement already installed: packaging==24.2
DEBUG Requirement already installed: pluggy==1.5.0
DEBUG Requirement already installed: cloudpickle==3.1.1
DEBUG Requirement already installed: typing-extensions==4.13.1
DEBUG Requirement already installed: requests==2.32.3
DEBUG Requirement already installed: filelock==3.18.0
DEBUG Requirement already installed: fsspec==2025.3.2
DEBUG Requirement already installed: jinja2==3.1.6
DEBUG Requirement already installed: networkx==3.4.2
DEBUG Requirement already installed: nvidia-cublas-cu12==12.4.5.8
DEBUG Requirement already installed: nvidia-cuda-cupti-cu12==12.4.127
DEBUG Requirement already installed: nvidia-cuda-nvrtc-cu12==12.4.127
DEBUG Requirement already installed: nvidia-cuda-runtime-cu12==12.4.127
DEBUG Requirement already installed: nvidia-cudnn-cu12==9.1.0.70
DEBUG Requirement already installed: nvidia-cufft-cu12==11.2.1.3
DEBUG Requirement already installed: nvidia-curand-cu12==10.3.5.147
DEBUG Requirement already installed: nvidia-cusolver-cu12==11.6.1.9
DEBUG Requirement already installed: nvidia-cusparse-cu12==12.3.1.170
DEBUG Requirement already installed: nvidia-cusparselt-cu12==0.6.2
DEBUG Requirement already installed: nvidia-nccl-cu12==2.21.5
DEBUG Requirement already installed: nvidia-nvjitlink-cu12==12.4.127
DEBUG Requirement already installed: nvidia-nvtx-cu12==12.4.127
DEBUG Requirement already installed: setuptools==78.1.0
DEBUG Requirement already installed: triton==3.2.0
DEBUG Requirement already installed: huggingface-hub==0.34.4
DEBUG Requirement already installed: pyyaml==6.0.2
DEBUG Requirement already installed: safetensors==0.6.2
DEBUG Requirement already installed: tokenizers==0.21.4
DEBUG Requirement already installed: click==8.1.8
DEBUG Requirement already installed: docker-pycreds==0.4.0
DEBUG Requirement already installed: gitpython==3.1.44
DEBUG Requirement already installed: platformdirs==4.3.7
DEBUG Requirement already installed: protobuf==5.29.4
DEBUG Requirement already installed: pydantic==2.11.3
DEBUG Requirement already installed: sentry-sdk==2.25.1
DEBUG Requirement already installed: setproctitle==1.3.5
DEBUG Requirement already installed: mpmath==1.3.0
DEBUG Requirement already installed: certifi==2025.1.31
DEBUG Requirement already installed: charset-normalizer==3.4.1
DEBUG Requirement already installed: idna==3.10
DEBUG Requirement already installed: urllib3==2.3.0
DEBUG Requirement already installed: markupsafe==3.0.2
DEBUG Requirement already installed: hf-xet==1.1.7
DEBUG Requirement already installed: six==1.17.0
DEBUG Requirement already installed: gitdb==4.0.12
DEBUG Requirement already installed: annotated-types==0.7.0
DEBUG Requirement already installed: pydantic-core==2.33.1
DEBUG Requirement already installed: typing-inspection==0.4.0
DEBUG Requirement already installed: smmap==5.0.2
Audited 67 packages in 0.21ms
DEBUG Released lock at <code>/home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics/.venv/.lock</code>
DEBUG Using Python 3.13.5 interpreter at: /home/dean/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics/.venv/bin/python3
DEBUG Running <code>pytest tests/test_train_bpe.py</code>
error: Failed to spawn: <code>pytest</code>
Caused by: No such file or directory (os error 2)</p>
Summary
<ol>
<li>uv is creating .venv at ~/courses/stanford/stanford.cs336.2025.spring/assignment1-basics/.venv</li>
<li>But your working directory is ~/courses/stanford/stanford.cs336.2025.spring/src/assignment1-basics/</li>
<li>There&#x27;s no pyproject.toml in the parent directories that would explain this behavior</li>
<li>PyCharm is setting VIRTUAL_ENV to the wrong path, which suggests it&#x27;s also confused about the project structure</li>
</ol>
<p>This happens each time I run a uv command in a terminal in Pycharm which has VIRTUAL_ENV set to the wrong directory (which doesn&#x27;t even exist) shown in step 1.</p>
<p>$ uv run python --version
warning: <code>VIRTUAL_ENV=/home/dean/courses/stanford/stanford.cs336.2025.spring/assignment1-basics/.venv</code> does not match the project environment path <code>.venv</code> and will be ignored; use <code>--active</code> to target the active environment instead
Python 3.13.5
$ uv run --active python --version
Using CPython 3.13.5 interpreter at: /usr/bin/python3.13
Creating virtual environment at: /home/dean/courses/stanford/stanford.cs336.2025.spring/assignment1-basics/.venv
Installed 67 packages in 183ms
Python 3.13.5</p>
<p>$ uv --version
uv 0.8.3
$ uname -a
Linux hpvictus 6.8.0-65-generic #68~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Tue Jul 15 18:06:34 UTC 2 x86_64 x86_64 x86_64 GNU/Linux</p>
Platform
<p>Ubuntu 22.04 amd64</p>
Version
<p>uv 0.8.3</p>
Python version
<p>3.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dwschulze">@dwschulze</a> on 2025-08-08 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-08 17:48</div>
            <div class="timeline-body"><p>See #9452 we need verbose logs and a reproducible example please.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dwschulze">@dwschulze</a> on 2025-08-08 17:58</div>
            <div class="timeline-body"><p>Here&#x27;s what happens in a Pycharm terminal which somehow has VIRTUAL_ENV set to a non existant directory:</p>
<p>$ uv run python --version
warning: <code>VIRTUAL_ENV=/home/dean/courses/stanford/stanford.cs336.2025.spring/assignment1-basics/.venv</code> does not match the project environment path <code>.venv</code> and will be ignored; use <code>--active</code> to target the active environment instead
Python 3.13.5
$ uv run --active python --version
Using CPython 3.13.5 interpreter at: /usr/bin/python3.13
Creating virtual environment at: /home/dean/courses/stanford/stanford.cs336.2025.spring/assignment1-basics/.venv
Installed 67 packages in 183ms
Python 3.13.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-08 19:08</div>
            <div class="timeline-body"><p>I don&#x27;t know what you&#x27;re asking.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dwschulze">@dwschulze</a> on 2025-08-08 21:00</div>
            <div class="timeline-body"><p>One issue is that there is no pytest binary.  I can use -m pytest instead so that isn&#x27;t really a problem.</p>
<p>uv run used to create a directory ../../assignment1/.venv and copy the local .venv to it.  That only seemed to happen in pycharm.  For some reason terminals in pycharm all have a VIRTUAL_ENV set to ../../assignment1/.venv which didn&#x27;t exist.  uv run would create that directory.  This only was a problem in pycharm and I can&#x27;t figure out where pycharm is getting VIRTUAL_ENV.</p>
<p>THis may be a pycharm issue.  I&#x27;ll close it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dwschulze">@dwschulze</a> on 2025-08-08 21:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:55 UTC
    </footer>
</body>
</html>
