<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv with pytorch &amp; huggingface toolchain - astral-sh/uv #9307</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv with pytorch &amp; huggingface toolchain</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9307">#9307</a>
        opened by <a href="https://github.com/maxstrobel">@maxstrobel</a>
        on 2024-11-21 10:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/maxstrobel">@maxstrobel</a></div>
            <div class="timeline-body"><p>Hello,
thanks a lot for this tool - a great user experience, real appreciate it!</p>
<p>I found the new pytorch guides that you provided - very helpful.</p>
<p>However, I think I'm facing some issues - my guess would be that packages with dependencies to torch overwrite the resolved packages that are added via extras.</p>
<pre><code class="language-bash">$ uv version
uv 0.5.4 (c62c83c37 2024-11-20)
</code></pre>
<hr />
<h2>Initial empty test project</h2>
<pre><code class="language-toml">pyproject.toml

[project]
name = &quot;test-proj&quot;
version = &quot;0.1.0&quot;
description = &quot;Test project&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = []
</code></pre>
<pre><code class="language-toml">version = 1
requires-python = &quot;&gt;=3.11&quot;

[[package]]
name = &quot;gen-ai&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }

[package.metadata]

[package.metadata.requires-dev]
dev = []
</code></pre>
<hr />
<h2>Adding Pytorch</h2>
<p>Via <a href="https://github.com/astral-sh/uv/blob/main/docs/guides/integration/pytorch.md#configuring-accelerators-with-optional-dependencies">Configuring accelerators with optional dependencies
</a></p>
<pre><code class="language-toml">pyproject.toml

[project]
name = &quot;test-proj&quot;
version = &quot;0.1.0&quot;
description = &quot;Test project&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = []
optional-dependencies = { cpu = [&quot;torch&gt;=2.5.1&quot;], cu118 = [&quot;torch&gt;=2.5.1&quot;] }

[tool.uv]
conflicts = [[{ extra = &quot;cpu&quot; }, { extra = &quot;cu118&quot; }]]
[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
[[tool.uv.index]]
name = &quot;pytorch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true
[tool.uv.sources]
torch = [
    { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { index = &quot;pytorch-cu118&quot;, extra = &quot;cu118&quot; },
]
</code></pre>
<pre><code class="language-toml">uv.lock
version = 1
requires-python = &quot;&gt;=3.11&quot;
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
]
conflicts = [[
    { package = &quot;test-proj&quot;, extra = &quot;cpu&quot; },
    { package = &quot;test-proj&quot;, extra = &quot;cu118&quot; },
]]

...

[package.optional-dependencies]
cpu = [
    { name = &quot;torch&quot;, version = &quot;2.5.1&quot;, source = { registry = &quot;https://pypi.org/simple&quot; }, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;torch&quot;, version = &quot;2.5.1+cpu&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }, marker = &quot;platform_system != 'Darwin'&quot; },
]
cu118 = [
    { name = &quot;torch&quot;, version = &quot;2.5.1+cu118&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cu118&quot; } },
]

[package.metadata]
requires-dist = [
    { name = &quot;torch&quot;, marker = &quot;platform_system == 'Darwin' and extra == 'cpu'&quot;, specifier = &quot;&gt;=2.5.1&quot; },
    { name = &quot;torch&quot;, marker = &quot;platform_system != 'Darwin' and extra == 'cpu'&quot;, specifier = &quot;&gt;=2.5.1&quot;, index = &quot;https://download.pytorch.org/whl/cpu&quot;, conflict = { package = &quot;test-proj&quot;, extra = &quot;cpu&quot; } },
    { name = &quot;torch&quot;, marker = &quot;extra == 'cu118'&quot;, specifier = &quot;&gt;=2.5.1&quot;, index = &quot;https://download.pytorch.org/whl/cu118&quot;, conflict = { package = &quot;test-proj&quot;, extra = &quot;cu118&quot; } },
]

[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;fsspec&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;jinja2&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;networkx&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot; },
    { name = &quot;sympy&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
]
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/d0/db/5d9cbfbc7968d79c5c09a0bc0bc3735da079f2fd07cc10498a62b320a480/torch-2.5.1-cp311-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:31f8c39660962f9ae4eeec995e3049b5492eb7360dd4f07377658ef4d728fa4c&quot;, size = 63884466 },
    { url = &quot;https://files.pythonhosted.org/packages/57/6c/bf52ff061da33deb9f94f4121fde7ff3058812cb7d2036c97bc167793bd1/torch-2.5.1-cp312-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:8c712df61101964eb11910a846514011f0b6f5920c55dbf567bff8a34163d5b1&quot;, size = 63858109 },
]

[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1+cpu&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;fsspec&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;jinja2&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;networkx&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot; },
    { name = &quot;sympy&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp311-cp311-linux_x86_64.whl&quot;, hash = &quot;sha256:07d7c9e069123d5af08b0cf0013d74f680b2d8be7d9e2cf561a52c90c55d9409&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp311-cp311-win_amd64.whl&quot;, hash = &quot;sha256:81531d4d5ca74163dc9574b87396531e546a60cceb6253303c7db6a21e867fdf&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp312-cp312-linux_x86_64.whl&quot;, hash = &quot;sha256:4856f9d6925121d13c2df07aa7580b767f449dfe71ae5acde9c27535d5da4840&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp312-cp312-win_amd64.whl&quot;, hash = &quot;sha256:a6b720410350765d3d77c01a5ce098a6c45af446284e45e87a98b8a16e7d564d&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.5.1%2Bcpu-cp313-cp313-linux_x86_64.whl&quot;, hash = &quot;sha256:5dbbdf83caa90d0bcaa50e4933ca424889133b35226db79000877d4ec5d9ea37&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1+cu118&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cu118&quot; }
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot; },
    { name = &quot;fsspec&quot; },
    { name = &quot;jinja2&quot; },
    { name = &quot;networkx&quot; },
    { name = &quot;nvidia-cublas-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-cupti-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-nvrtc-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-runtime-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cudnn-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cufft-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-curand-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusolver-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusparse-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nccl-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nvtx-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12'&quot; },
    { name = &quot;sympy&quot; },
    { name = &quot;triton&quot;, marker = &quot;python_full_version &lt; '3.13' and platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;typing-extensions&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp311-cp311-linux_x86_64.whl&quot;, hash = &quot;sha256:c3a3fa09578e1acb76236dc3056ac67ac2f991d9214ab54ec440c4a1427cf016&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp311-cp311-win_amd64.whl&quot;, hash = &quot;sha256:7e09af36c3d0bf8e6554cacae794f9fcd348d096e21f8be1dd42ed3bc48b4e2f&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp312-cp312-linux_x86_64.whl&quot;, hash = &quot;sha256:f4c3ae93c72e8b725b510c3bc5b9dd5437f6740a66c3cc3bb1a19f177c3baef4&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp312-cp312-win_amd64.whl&quot;, hash = &quot;sha256:3edf97d9b0a17e3f764a511ed084e866c086af76c9d489cc51d5edb77ca7c936&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp313-cp313-linux_x86_64.whl&quot;, hash = &quot;sha256:60c1d1b522ea534a17e1ac60a0dc542ed578c45c84d63dc1528febbd1a0f5953&quot; },
]

...
</code></pre>
<hr />
<h2>Adding <code>transformers</code> (or <code>accelerate</code> should also work)</h2>
<pre><code class="language-bash">uv add transformers
</code></pre>
<pre><code class="language-toml">pyproject.toml

[project]
name = &quot;test-proj&quot;
version = &quot;0.1.0&quot;
description = &quot;Test project&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
    &quot;transformers&gt;=4.46.3&quot;,
]
optional-dependencies = { cpu = [&quot;torch&gt;=2.5.1&quot;], cu118 = [&quot;torch&gt;=2.5.1&quot;] }

[tool.uv]
conflicts = [[{ extra = &quot;cpu&quot; }, { extra = &quot;cu118&quot; }]]
[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
[[tool.uv.index]]
name = &quot;pytorch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true
[tool.uv.sources]
torch = [
    { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { index = &quot;pytorch-cu118&quot;, extra = &quot;cu118&quot; },
]
</code></pre>
<pre><code class="language-toml">uv.lock

version = 1
requires-python = &quot;&gt;=3.11&quot;
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
]
conflicts = [[
    { package = &quot;test-proj&quot;, extra = &quot;cpu&quot; },
    { package = &quot;test-proj&quot;, extra = &quot;cu118&quot; },
]]

...

[package.optional-dependencies]
cpu = [
    { name = &quot;torch&quot;, version = &quot;2.5.1&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;torch&quot;, version = &quot;2.5.1&quot;, source = { registry = &quot;https://pypi.org/simple&quot; }, marker = &quot;platform_system == 'Darwin'&quot; },
]
cu118 = [
    { name = &quot;torch&quot;, version = &quot;2.5.1+cu118&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cu118&quot; } },
]

...

[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;fsspec&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;jinja2&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;networkx&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;nvidia-cublas-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-cupti-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-nvrtc-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-runtime-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cudnn-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cufft-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-curand-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusolver-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusparse-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nccl-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nvjitlink-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nvtx-cu12&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot; },
    { name = &quot;sympy&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system != 'Darwin'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.5.1-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl&quot;, hash = &quot;sha256:d5b3203f191bc40783c99488d2e776dcf93ac431a59491d627a1ca5b3ae20b22&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.5.1-cp312-cp312-manylinux_2_17_aarch64.manylinux2014_aarch64.whl&quot;, hash = &quot;sha256:36d1be99281b6f602d9639bd0af3ee0006e7aab16f6718d86f709d395b6f262c&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;fsspec&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;jinja2&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;networkx&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot; },
    { name = &quot;sympy&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
]
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/d0/db/5d9cbfbc7968d79c5c09a0bc0bc3735da079f2fd07cc10498a62b320a480/torch-2.5.1-cp311-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:31f8c39660962f9ae4eeec995e3049b5492eb7360dd4f07377658ef4d728fa4c&quot;, size = 63884466 },
    { url = &quot;https://files.pythonhosted.org/packages/57/6c/bf52ff061da33deb9f94f4121fde7ff3058812cb7d2036c97bc167793bd1/torch-2.5.1-cp312-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:8c712df61101964eb11910a846514011f0b6f5920c55dbf567bff8a34163d5b1&quot;, size = 63858109 },
]

[[package]]
name = &quot;torch&quot;
version = &quot;2.5.1+cu118&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cu118&quot; }
resolution-markers = [
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system != 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &lt; '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
    &quot;python_full_version &gt;= '3.12' and platform_system == 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot; },
    { name = &quot;fsspec&quot; },
    { name = &quot;jinja2&quot; },
    { name = &quot;networkx&quot; },
    { name = &quot;nvidia-cublas-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-cupti-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-nvrtc-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cuda-runtime-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cudnn-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cufft-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-curand-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusolver-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-cusparse-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nccl-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;nvidia-nvtx-cu11&quot;, marker = &quot;platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12'&quot; },
    { name = &quot;sympy&quot; },
    { name = &quot;triton&quot;, marker = &quot;python_full_version &lt; '3.13' and platform_machine == 'x86_64' and platform_system == 'Linux'&quot; },
    { name = &quot;typing-extensions&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp311-cp311-linux_x86_64.whl&quot;, hash = &quot;sha256:c3a3fa09578e1acb76236dc3056ac67ac2f991d9214ab54ec440c4a1427cf016&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp311-cp311-win_amd64.whl&quot;, hash = &quot;sha256:7e09af36c3d0bf8e6554cacae794f9fcd348d096e21f8be1dd42ed3bc48b4e2f&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp312-cp312-linux_x86_64.whl&quot;, hash = &quot;sha256:f4c3ae93c72e8b725b510c3bc5b9dd5437f6740a66c3cc3bb1a19f177c3baef4&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp312-cp312-win_amd64.whl&quot;, hash = &quot;sha256:3edf97d9b0a17e3f764a511ed084e866c086af76c9d489cc51d5edb77ca7c936&quot; },
    { url = &quot;https://download.pytorch.org/whl/cu118/torch-2.5.1%2Bcu118-cp313-cp313-linux_x86_64.whl&quot;, hash = &quot;sha256:60c1d1b522ea534a17e1ac60a0dc542ed578c45c84d63dc1528febbd1a0f5953&quot; },
]

...
</code></pre>
<hr />
<h1>Summary</h1>
<p>before adding <code>transformers</code>:</p>
<pre><code class="language-toml">uv.lock

[package.optional-dependencies]
cpu = [
    { name = &quot;torch&quot;, version = &quot;2.5.1&quot;, source = { registry = &quot;https://pypi.org/simple&quot; }, marker = &quot;platform_system == 'Darwin'&quot; },
    { name = &quot;torch&quot;, version = &quot;2.5.1+cpu&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }, marker = &quot;platform_system != 'Darwin'&quot; },
]
cu118 = [
    { name = &quot;torch&quot;, version = &quot;2.5.1+cu118&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cu118&quot; } },
]
</code></pre>
<p>after adding <code>transformers</code>:</p>
<pre><code class="language-toml">uv.lock

[package.optional-dependencies]
cpu = [
    { name = &quot;torch&quot;, version = &quot;2.5.1&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }, marker = &quot;platform_system != 'Darwin'&quot; },
    { name = &quot;torch&quot;, version = &quot;2.5.1&quot;, source = { registry = &quot;https://pypi.org/simple&quot; }, marker = &quot;platform_system == 'Darwin'&quot; },
]
cu118 = [
    { name = &quot;torch&quot;, version = &quot;2.5.1+cu118&quot;, source = { registry = &quot;https://download.pytorch.org/whl/cu118&quot; } },
]
</code></pre>
<p>So basically the <code>+cpu</code> version specifier is removed, which will break the installation of CPU only version.</p>
<hr />
<p>PS:</p>
<p>If torch is added via <a href="https://github.com/astral-sh/uv/blob/main/docs/guides/integration/pytorch.md#configuring-accelerators-with-environment-markers">environment markers</a>, it seems to be stable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxstrobel">@maxstrobel</a> on 2024-11-21 10:18</div>
            <div class="timeline-body"><p>Seems that @mbignotti was a little bit faster than me filling the issue - looks like this one is a duplicate of https://github.com/astral-sh/uv/issues/9306, or the other way round.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 13:57</div>
            <div class="timeline-body"><p>I believe this is actually the same as #9289, so let's track there. Thanks for the clear write-up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-21 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-11-21 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 13:58</div>
            <div class="timeline-body"><p>I believe the general issue lies in having dependencies that depend on a package that's listed multiple times, across conflicting groups.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:28 UTC
    </footer>
</body>
</html>
