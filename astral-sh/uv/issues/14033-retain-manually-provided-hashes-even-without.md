---
number: 14033
title: "Retain manually provided hashes even without `--generate-hashes`"
type: issue
state: open
author: keith
labels:
  - enhancement
assignees: []
created_at: 2025-06-13T17:14:58Z
updated_at: 2025-06-18T09:32:30Z
url: https://github.com/astral-sh/uv/issues/14033
synced_at: 2026-01-10T01:25:41Z
---

# Retain manually provided hashes even without `--generate-hashes`

---

_Issue opened by @keith on 2025-06-13 17:14_

### Summary

If you are not able to enable `--generate-hashes` when using `pip compile`, you may still want some explicit wheel URLs to have hashes attached.


### Example

For example if you have this `requirements.in`:

```
requests @ https://files.pythonhosted.org/packages/26/ff/c71b3943bebdd9f7ceb9e137296370587eb0b33fe2eb3732ae168bc45204/requests-2.7.0-py2.py3-none-any.whl \
  --hash=sha256:20f976cdce02a42b69ce80e9e03897a51814b36d448b37288546086ebc473146
```

And you run:

```
% uv --version
uv 0.7.13

% uv pip compile requirements.in -o requirements.txt --no-strip-markers --no-strip-extras
Resolved 1 package in 1ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in -o requirements.txt --no-strip-markers --no-strip-extras
requests @ https://files.pythonhosted.org/packages/26/ff/c71b3943bebdd9f7ceb9e137296370587eb0b33fe2eb3732ae168bc45204/requests-2.7.0-py2.py3-none-any.whl
    # via -r requirements.in
```

the manually provided hash is stripped. I think there's an argument to be made for keeping that hash since it was provided manually. I totally understand if that would be too confusing given the matrix of options here. Thanks for considering!

---

_Label `enhancement` added by @keith on 2025-06-13 17:15_

---

_Comment by @konstin on 2025-06-13 17:57_

> If you are not able to enable --generate-hashes when using pip compile

What's blocking you from using it?

---

_Comment by @keith on 2025-06-13 17:59_

ha yes, I omitted that since it's not the fault of UV but the fault of our code that consumes the files. I hope to fix it soon

---

_Comment by @keith on 2025-06-13 23:53_

actually after a bit more debugging, the issue there is more difficult to workaround than i expected. the issue is my actual case is pytorch, so i have multiple indexes, and if i generate hashes uv is finding deps from 1 index, but then later when i consume the requirements.txt file, the consumer is finding the deps from the other index, and the shas then mismatch. I think ideally I would fix this by using uv's index selection, but since my tools consume requirements.txt files, that might be a non-starter atm.

---

_Comment by @konstin on 2025-06-18 09:32_

uv currently expects that indexes and files at resolve time are the same at resolve time as at install time. We're relaxing the index URL requirement (https://github.com/astral-sh/uv/pull/11782), but knowing the files at resolve time is a security, we need to ensure that we've seen and locked the files at resolve time so install time has the same files.

---
