<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path resolution for packages from filepath are inconsistent - astral-sh/uv #9327</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Path resolution for packages from filepath are inconsistent</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9327">#9327</a>
        opened by <a href="https://github.com/Tibiritabara">@Tibiritabara</a>
        on 2024-11-21 16:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Tibiritabara">@Tibiritabara</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>I have a project called <code>main-project</code> on the next route</p>
<p><code>$HOME/project/main/apps/current-app</code></p>
<p>This project uses two libraries on disk, on the <code>$HOME/project/libs/</code> path. These libs are:</p>
<p><code>$HOME/project/main/libs/dep1</code>
<code>$HOME/project/main/libs/dep2</code></p>
<p>These libraries are specified on the <code>current-app</code> project as dependencies like this:</p>
<pre><code class="language-toml">...
dependencies = [
    &quot;dep1 @ file:///${PROJECT_ROOT}/../../libs/dep2&quot;,
    &quot;dep2 @ file:///${PROJECT_ROOT}/../../libs/dep1&quot;,
]
...
</code></pre>
<p>For some odd reason, it resolves the next path: <code>file:///$HOME/project/main/apps/dep2</code>, despite having exited the <code>apps</code> folder on the path definition.</p>
<p>UV Is unable to calculate the right path. For some reason, it is unable to exit the <code>apps</code> folder, and enter the <code>libs</code> folder, despite the route being correct.</p>
<p>I am currently working on a MacOS m2 machine with Python 3.12.</p>
<p>After more testing, I notice that the issue happens with the <code>main</code> folder. Whenever I replace the <code>main</code> folder name in the route, it resolves correctly.</p>
<p>I have also tested setting relative paths with <code>uv.tools.source</code>, and reached the same conclusion. The folder named <code>main</code> causes the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a> on 2024-11-21 18:29</div>
            <div class="timeline-body"><p>Hi!</p>
<p>I can't seem to recreate the issue. Maybe the issue comes from naming the mismatch between <code>dep_{i}</code> and the path which is for <code>dep_{j}</code>? What <code>uv</code> version are you using?</p>
<p>Doing works:</p>
<pre><code class="language-toml">[project]
name = &quot;current-app&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;dep1 @ file:///${PROJECT_ROOT}/../../libs/dep1&quot;,
    &quot;dep2 @ file:///${PROJECT_ROOT}/../../libs/dep2&quot;,
]
</code></pre>
<p>Working directory:</p>
<pre><code>.
├── apps
│   └── current-app
│       ├── README.md
│       ├── hello.py
│       ├── pyproject.toml
│       ├── uv.lock
└── libs
    ├── dep1
    │   ├── README.md
    │   ├── hello.py
    │   └── pyproject.toml
    └── dep2
        ├── README.md
        ├── hello.py
        └── pyproject.toml
</code></pre>
<p>Running <code>uv sync</code> in <code>current-app</code>:</p>
<pre><code>Using CPython 3.13.0
Creating virtual environment at: .venv
Resolved 3 packages in 9ms
   Built dep1 @ file:///Users/.../main/libs/dep1
   Built dep2 @ file:///Users/.../main/libs/dep2
Prepared 2 packages in 653ms
Installed 2 packages in 1ms
 + dep1==0.1.0 (from file:///Users/.../main/libs/dep1)
 + dep2==0.1.0 (from file:///Users/.../main/libs/dep2)
</code></pre>
<p>Platform: Sequoia 15.1.1 (M1)
CPython: 3.13.0
uv: 0.5.4 (c62c83c37 2024-11-20)</p>
<p>I tried with CPython 3.12.7 as well and it seems to be working fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tibiritabara">@Tibiritabara</a> on 2024-11-21 21:36</div>
            <div class="timeline-body"><p>Thank you so much for the quick answer. I found the issue: <code>dep1</code> depends on <code>dep2</code>. On <code>dep1</code>, I pointed to <code>dep2</code>using the project root notation on the <code>dependencies</code></p>
<pre><code class="language-toml">dependencies = [
    &quot;dep2 @ file:///${PROJECT_ROOT}/../dep2&quot;,
]
</code></pre>
<p>then on <code>current_app</code> I added <code>dep1</code> and <code>dep2</code> as dependencies. There I wrote the next <code>dependencies</code>:</p>
<pre><code class="language-toml">dependencies = [
    &quot;dep1 @ file:///${PROJECT_ROOT}/../../dep1&quot;,
    &quot;dep2 @ file:///${PROJECT_ROOT}/../../dep2&quot;,
]
</code></pre>
<p>Apparently when <code>uv</code> installs the dependencies, it finds a conflict as the route is defined in two different files differently. It takes the route defined on the <code>pyproject.toml</code> of <code>dep1</code>, ignoring the path redefinition on <code>current_app</code></p>
<p>I do not know if this is expected behavior or not, but I managed to fix the problem using the relative file paths on the <code>[tool.uv.sources]</code> block and removing the <code>@</code> notation from the dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Tibiritabara on 2024-11-21 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @Tibiritabara on 2024-11-21 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-21 21:43</div>
            <div class="timeline-body"><p>My recommendation for such cases is using <code>tool.uv.sources</code> to set the deps to a relative path (https://docs.astral.sh/uv/concepts/projects/dependencies/#path). <code>project.dependencies</code> doesn't properly support relative paths, and the <code>tool.uv.sources</code> allows uv to handle relative paths correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-22 00:52</div>
            <div class="timeline-body"><p>I'm not sure, but the thing you pasted here is incorrect:</p>
<pre><code>dependencies = [
    &quot;dep1 @ file:///${PROJECT_ROOT}/../../libs/dep2&quot;,
    &quot;dep2 @ file:///${PROJECT_ROOT}/../../libs/dep1&quot;,
]
</code></pre>
<p>The dependencies are inverted.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-22 01:03</div>
            <div class="timeline-body"><p>I think what you're seeing is that <code>PROJECT_ROOT</code> is just the current working directory. It's not tied to the project. You should definitely use <code>tool.uv.sources</code> if you want to do this kind of relative pathing across dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-22 01:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:29 UTC
    </footer>
</body>
</html>
