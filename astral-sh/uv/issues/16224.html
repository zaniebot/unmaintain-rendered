<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency version markers are not being resolved as expected - astral-sh/uv #16224</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Dependency version markers are not being resolved as expected</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16224">#16224</a>
        opened by <a href="https://github.com/skraeven">@skraeven</a>
        on 2025-10-10 08:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/skraeven">@skraeven</a> on 2025-10-10 08:50</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Given this pyproject.toml:</p>
<pre><code>[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
description = &quot;bar&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;htmlmin;python_version&lt;'3.13'&quot;,
]
</code></pre>
<p>running <code>uv sync</code> will fail, due to &quot;cgi&quot; which was removed in python 3.13:</p>
<pre><code>      ModuleNotFoundError: No module named 'cgi'

      hint: This error likely indicates that `htmlmin@0.1.12` depends on `cgi`, but doesn't declare it as a build dependency. If `htmlmin` is a
      first-party package, consider adding `cgi` to its `build-system.requires`. Otherwise, either add it to your `pyproject.toml` under:

      [tool.uv.extra-build-dependencies]
      htmlmin = [&quot;cgi&quot;]

      or `uv pip install cgi` into the environment and re-run with `--no-build-isolation`.
  help: `htmlmin` (v0.1.12) was included because `foo` (v0.1.0) depends on `htmlmin`
</code></pre>
<p>One workaround that I found:</p>
<pre><code>uv python pin 3.12
uv sync
uv python pin 3.13
uv sync
</code></pre>
<p>Then sync will complete for 3.13 without issues.</p>
<h3>Platform</h3>
<p>Ubuntu 24.04</p>
<h3>Version</h3>
<p>0.9.1</p>
<h3>Python version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @skraeven on 2025-10-10 08:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-10-21 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-10-21 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-21 13:21</div>
            <div class="timeline-body"><p>To build a lockfile that works for both 3.12 and 3.13, uv needs to know the dependencies of htmlmin. The package doesn't five us this information statically: There's no wheel, no <code>pyproject.toml</code> and no modern reliable metadata in the source distribution. For those cases, uv needs to build the package to extract the metadata. This build fails with the current default Python version (3.13), and only succeed when using 3.12 as default Python instead. The best solution to this is htmlmin providing static metadata which skips the build altogether.</p>
<p>A smaller workaround:</p>
<pre><code>uv lock -p 3.12
uv sync -p 3.13
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-10-28 23:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
