<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Install (-e .) Ignores Version from requirements.txt - astral-sh/uv #8410</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Editable Install (-e .) Ignores Version from requirements.txt</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8410">#8410</a>
        opened by <a href="https://github.com/tzurgross">@tzurgross</a>
        on 2024-10-21 09:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tzurgross">@tzurgross</a></div>
            <div class="timeline-body"><p>When using <code>uv pip install -e .</code>, uv installs an incorrect version of <code>smart_open</code> (7.0.5), even though requirements.txt specifies <code>smart_open==6.4.0</code>. This issue does not occur when running either <code>uv pip install .</code> or <code>pip install -e .</code>, where the correct version (6.4.0) is installed as expected.</p>
<p>Expected behavior: <code>uv pip install -e .</code> should respect the version specified in requirements.txt.
Observed behavior: <code>uv pip install -e .</code> installs <code>smart_open==7.0.5</code>, despite requirements.txt specifying <code>smart_open==6.4.0</code>.</p>
<p>Platform: <code>Darwin 23.6.0 arm64</code>
uv version: <code>0.4.24</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tzurgross">@tzurgross</a> on 2024-10-21 09:21</div>
            <div class="timeline-body"><p>The issue doesn't reproduce when running without cache: <code>uv pip install --no-cache-dir -e .</code>
so it's probably related to having cached versions of smart-open.</p>
<p>Still, the pinned version in requirements.txt should take precedence even with cache enabled, and installing without cache is significantly slower (which is the main reason we moved from pip to uv).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-21 14:40</div>
            <div class="timeline-body"><p>I would need a minimal reproduction to help here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2024-10-21 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tzurgross">@tzurgross</a> on 2024-10-22 09:30</div>
            <div class="timeline-body"><p>@charliermarsh wasn't easy as I thought, but i've managed to reproduce the issue in the following manner:</p>
<ul>
<li>create a minimal project with setup.py and requirements.txt file.</li>
<li>set <code>smart_open==7.0.5</code> in requirements.txt.</li>
<li>install the project (<code>-e .</code>).</li>
<li>change the requirement to <code>smart_open==6.4.0</code>.</li>
<li>install the project again using uv - nothing changed.</li>
<li>install using pip - <code>smart_open</code> version changes to <code>6.4.0</code>.</li>
<li>install using uv again - <code>smart_open</code> version changes back to <code>7.0.5</code>.</li>
</ul>
<p>i've created a bash script for easier reproduction:</p>
<pre><code>#!/bin/bash

PROJECT_DIR=&quot;minimal_repro&quot;

mkdir -p &quot;$PROJECT_DIR/my_package&quot;

cat &lt;&lt;EOL &gt; &quot;$PROJECT_DIR/setup.py&quot;
from setuptools import setup, find_packages
import os

def read_requirements(filename: str) -&gt; list:
    with open(os.path.join(os.path.dirname(__file__), filename)) as f:
        return f.read().splitlines()

setup(
    name=&quot;my_package&quot;,
    version=&quot;0.1&quot;,
    packages=find_packages(),
    install_requires=read_requirements(&quot;requirements.txt&quot;),
)
EOL

cat &lt;&lt;EOL &gt; &quot;$PROJECT_DIR/requirements.txt&quot;
smart_open==7.0.5
EOL

touch &quot;$PROJECT_DIR/my_package/__init__.py&quot;

cd &quot;$PROJECT_DIR&quot; &amp;&amp; python -m venv venv &amp;&amp; source venv/bin/activate &amp;&amp; pip3 install uv
</code></pre>
<p>then:</p>
<pre><code>cd minimal_repro/
source venv/bin/activate
uv pip install -e .
</code></pre>
<p>running <code>pip freeze | grep smart-open</code> should print <code>smart-open==7.0.5</code>.</p>
<p>then:</p>
<pre><code>cat &quot;smart_open==6.4.0&quot; &gt; requirements.txt
uv pip install -e .
</code></pre>
<p>running <code>pip freeze | grep smart-open</code> should still print <code>smart-open==7.0.5</code>.</p>
<p>then:</p>
<pre><code>pip install -e .
</code></pre>
<p>running <code>pip freeze | grep smart-open</code> should now print <code>smart-open==6.4.0</code>.</p>
<p>running <code>uv pip install -e .</code> will revert back to <code>smart-open==7.0.5</code>.</p>
<p>i would expect <code>-e .</code> to act the same as pip.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tzurgross">@tzurgross</a> on 2024-10-22 09:34</div>
            <div class="timeline-body"><p>btw, this doesn't reproduce when installing without <code>-e</code>, or not using requirements.txt along with setup.py (in case the requirements are listed directly in setup.py, it works as expected).</p>
<p>so:</p>
<ul>
<li><code>uv pip install .</code> is good.</li>
<li><code>uv pip install -r requirements.txt</code> is good.</li>
<li><code>uv pip install -e .</code> is good only if not going through requirements.txt file, which is not our case.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-22 18:57</div>
            <div class="timeline-body"><p>It looks like your project effectively has dynamic metadata, since you're reading the list of requirements from an external source. uv will only rebuild the project if the <code>setup.py</code> changes, but you're relying on an external file. You can add a <code>cache-key</code> to the project to tell uv to <em>also</em> watch <code>requirements.txt</code>, or run with <code>--reinstall</code>. Check out the docs here: https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @charliermarsh on 2024-10-22 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-10-22 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @tzurgross on 2024-12-15 10:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:27:50 UTC
    </footer>
</body>
</html>
