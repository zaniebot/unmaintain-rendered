<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>create-python-mirror has many download failures - astral-sh/uv #17135</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>create-python-mirror has many download failures</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/17135">#17135</a>
        opened by <a href="https://github.com/keestux">@keestux</a>
        on 2025-12-15 15:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/keestux">@keestux</a> on 2025-12-15 15:28</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><code>create-python-mirror.py</code> has a problem to download all requested files without error.</p>
<pre><code class="language-sh">$ uv run --script ./scripts/create-python-mirror.py --name cpython --arch x86_64 --os linux --target /MIRRORS/misc-mirrors/python-standalone
...
Downloading:  59%|██████████████████████████▍                  | 881/1502 [12:09&lt;05:56,  1.74file/s]2025-12-15 16:10:21,429 - ERROR - Failed to download https://github.com/astral-sh/python-build-standalone/releases/download/20220502/cpython-3.9.12%2B20220502-x86_64_v4-unknown-linux-gnu-install_only.tar.gz: 
Downloading: 100%|████████████████████████████████████████████| 1502/1502 [21:11&lt;00:00,  1.18file/s]
Successfully downloaded: 1435 files.
Failed downloads:
- https://github.com/astral-sh/python-build-standalone/releases/download/20221106/cpython-3.10.8%2B20221106-x86_64-unknown-linux-gnu-install_only.tar.gz: 
- https://github.com/astral-sh/python-build-standalone/releases/download/20251209/cpython-3.14.2%2B20251209-x86_64_v3-unknown-linux-gnu-debug-full.tar.zst: 
...
</code></pre>
<p>If i run the command again it may (or may not) download the missing files.</p>
<h3>Platform</h3>
<p>Linux 6.8.0-52-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.8.14</p>
<h3>Python version</h3>
<p>Python 3.13.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @keestux on 2025-12-15 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keestux">@keestux</a> on 2025-12-15 15:52</div>
            <div class="timeline-body"><p>If I run the command again, it may succeed.</p>
<p>Besides, the script does not return an error (exit code non zero) if it failed some downloads.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-16 09:04</div>
            <div class="timeline-body"><p>We should add retries on network errors to the script.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keestux">@keestux</a> on 2025-12-16 09:32</div>
            <div class="timeline-body"><p>@konstin Do you happen to know why I don't see the <code>str(e)</code> in the output? I just see the url</p>
<pre><code class="language-txt">Downloading:   9%|████▏                                          | 13/144 [00:05&lt;00:31,  4.21file/s]2025-12-15 07:08:33,864 - ERROR - Failed to download https://github.com/astral-sh/python-build-standalone/releases/download/20251202/cpython-3.14.1%2B20251202-x86_64-pc-windows-msvc-install_only_stripped.tar.gz: 
</code></pre>
<pre><code class="language-python">    except Exception as e:
        error_msg = f&quot;Failed to download {url}: {str(e)}&quot;
        logger.error(error_msg)
        errors.append((url, str(e)))
        progress_bar.update(1)
        return False
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-16 10:13</div>
            <div class="timeline-body"><p>Not sure, maybe tqdm is removing something? Otherwise you could set a breakpoint in the line and inspect <code>e</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keestux">@keestux</a> on 2025-12-17 14:52</div>
            <div class="timeline-body"><p>What I've seen so far is that the <code>Exception</code>'s were <code>ConnectTimeout</code> and <code>ReadTimeout</code>. The default seems to be 5 seconds [1].</p>
<p>Perhaps we can set the timeout to 30s, or something.</p>
<pre><code class="language-patch">@@ -207,7 +207,7 @@ async def download_files(
     urls: Set[Tuple[str, Optional[str]]], target: Path, max_concurrent: int
 ):
     &quot;&quot;&quot;Download files with a limit on concurrent downloads using httpx.&quot;&quot;&quot;
-    async with httpx.AsyncClient(follow_redirects=True) as client:
+    async with httpx.AsyncClient(follow_redirects=True, timeout=30.0) as client:
         progress_bar = tqdm(total=len(urls), desc=&quot;Downloading&quot;, unit=&quot;file&quot;)
         sem = asyncio.Semaphore(max_concurrent)
         errors: List[Tuple[str, str]] = []  # To collect errors
</code></pre>
<p>[1] https://www.python-httpx.org/advanced/timeouts/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 15:23</div>
            <div class="timeline-body"><p>A higher default timeout makes sense for large and parallel downloads, we can add that to the script.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
