<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv run uninstalls ssh:// packages that are in dependencie list - astral-sh/uv #13828</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv run uninstalls ssh:// packages that are in dependencie list</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/13828">#13828</a>
        opened by <a href="https://github.com/gertcuykens">@gertcuykens</a>
        on 2025-06-04 00:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gertcuykens">@gertcuykens</a> on 2025-06-04 00:55</div>
            <div class="timeline-body"><h3>Summary</h3>
<pre><code>uv pip install &quot;.[tests]&quot;
    Updated ssh://****@github.com/gertcuykens/jwt.git (da2448149c05e08bdfbad6aeaddf1f0a
    Updated ssh://****@github.com/gertcuykens/cms.git (90f999b11aed01981399a0d67b76b4a4                                                                               
Resolved 78 packages in 1.74s
      Built as2 @ file:///Users/gertcuykens/as2
Prepared 1 package in 873ms
Uninstalled 3 packages in 3ms
Installed 3 packages in 3ms
 ~ as2==0.1.0 (from file:///Users/gertcuykens/as2)
 - cms==0.1.0 (from git+ssh://****@github.com/gertcuykens/cms.git@35f8c5d3fb36bf5a8cd84bd494391d9b33bd0fc4)
 + cms==0.1.0 (from git+ssh://****@github.com/gertcuykens/cms.git@90f999b11aed01981399a0d67b76b4a40c3698ea)
 - jwt==0.1.0 (from git+ssh://****@github.com/gertcuykens/jwt.git@dc78c0aef49f00731903bcc139d733e3707fa1f4)
 + jwt==0.1.0 (from git+ssh://****@github.com/gertcuykens/jwt.git@da2448149c05e08bdfbad6aeaddf1f0ad2466e45)
</code></pre>
<p>everything fine when I run <code>./tests/msg.py</code> it works in my loaded venv. But as soon I use uv run without --no-sync it removes the external libs in .venv leaving only the meta egg info.</p>
<pre><code>uv run ./tests/msg.py
Built as2 @ file:///Users/gertcuykens/as2
Uninstalled 3 packages in 16ms
Installed 3 packages in 3ms
</code></pre>
<p>To fix this i have to reinstall using <code>uv pip install &quot;.[tests]&quot;</code></p>
<p>My toml file looks like this</p>
<pre><code>dependencies = [
    &quot;fastapi[all]&quot;,
    &quot;cryptography&quot;,
    &quot;asn1crypto&quot;,
    &quot;opentelemetry-api&quot;,
    &quot;opentelemetry-sdk&quot;,
    &quot;opentelemetry-exporter-otlp&quot;,
    &quot;opentelemetry-instrumentation-httpx&quot;,
    &quot;pydantic&quot;,
    &quot;pydantic-settings&quot;,
    &quot;cms @ git+ssh://git@github.com/gertcuykens/cms.git@main&quot;,
    &quot;jwt @ git+ssh://git@github.com/gertcuykens/jwt.git@main&quot;
]

[project.optional-dependencies]
tests = [
    &quot;pytest-asyncio&quot;,
    &quot;pytest-cov&quot;,
    &quot;httpx&quot;,
    &quot;argon2-cffi&quot;,
    &quot;blake3&quot;,
    &quot;typer&quot;
]
</code></pre>
<h3>Platform</h3>
<p>Darwin 24.5.0 arm64</p>
<h3>Version</h3>
<p>uv 0.7.9 (13a86a23b 2025-05-30)</p>
<h3>Python version</h3>
<p>Python 3.13.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @gertcuykens on 2025-06-04 00:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-04 00:59</div>
            <div class="timeline-body"><p>Is your lockfile locked to different commits? You might want to run <code>uv lock --upgrade-package cms</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gertcuykens">@gertcuykens</a> on 2025-06-04 01:12</div>
            <div class="timeline-body"><p><code>uv lock --upgrade-package cms</code>
ok that worked like magic... thanks</p>
<p>The contents of the lock file regarding cms was</p>
<pre><code>[[package]]
name = &quot;cms&quot;
version = &quot;0.1.0&quot;
source = { git = &quot;ssh://git@github.com/gertcuykens/cms.git?rev=main#35f8c5d3fb36bf5a8cd84bd494391d9b33bd0fc4&quot; }
dependencies = [
    { name = &quot;argon2-cffi&quot; },
    { name = &quot;asn1crypto&quot; },
    { name = &quot;blake3&quot; },
    { name = &quot;cryptography&quot; },
    { name = &quot;pydantic&quot; },
    { name = &quot;pytest-asyncio&quot; },
    { name = &quot;pytest-cov&quot; },
]
</code></pre>
<p>So the question then boils down to why does <code>uv pip install</code> doesn't care about the lock file and <code>uv run</code> does or why does <code>uv pip install</code> didn't update the lock file? Did i miss it somewhere in the uv documentation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-04 07:40</div>
            <div class="timeline-body"><p>The <code>uv pip</code> commands, like <code>pip</code>, don't use any lockfile, but what they get passed on the CLI and do a resolution from that. <code>uv run</code>/<code>uv sync</code>/etc. do use the lockfile on the other hand.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gertcuykens">@gertcuykens</a> on 2025-06-04 12:58</div>
            <div class="timeline-body"><p>ok that makes sense, but I think a error or info message should have been shown here right? After <code>Installed 3 pack...</code> like pip install shows what version is in use</p>
<pre><code>uv run ./tests/msg.py
Built as2 @ file:///Users/gertcuykens/as2
Uninstalled 3 packages in 16ms
Installed 3 packages in 3ms
</code></pre>
<p>PS when i run it after fixing the uv.lock it actually does and shows it every time</p>
<pre><code>    Updated ssh://****@github.com/gertcuykens/cms.git (90f999b11aed01981399a0d67b76b4a4
    Updated ssh://****@github.com/gertcuykens/jwt.git (da2448149c05e08bdfbad6aeaddf1f0a                                                                               
Uninstalled 1 package in 10ms
Installed 1 package in 4ms
</code></pre>
<p>So i believe there is a state where uv run silently ignores a error when something goes wrong as in a commit that isn't working anymore (as in force pushed) ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-04 13:23</div>
            <div class="timeline-body"><p>No, that's expected. We don't show the full list of changes in <code>uv run</code>, we only show you a summary. You can run <code>uv sync</code> if you want to see the complete changelog.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gertcuykens">@gertcuykens</a> on 2025-06-04 13:35</div>
            <div class="timeline-body"><p>Ok closing the issue then as expected behaviour and not a bug. But still my gut feeling is telling me some error internally was ignored when the commit from the uv lock turned out to point to something non existing or to something broken that was force pushed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @gertcuykens on 2025-06-04 13:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:28 UTC
    </footer>
</body>
</html>
