<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support for PEP 725 - external (runtime) dependencies with user defineable helper - astral-sh/uv #14889</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support for PEP 725 - external (runtime) dependencies with user defineable helper</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/14889">#14889</a>
        opened by <a href="https://github.com/CarliJoy">@CarliJoy</a>
        on 2025-07-25 10:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/CarliJoy">@CarliJoy</a> on 2025-07-25 10:49</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><a href="https://peps.python.org/pep-0725/">PEP 725</a> drafts an easy way to define external dependencies.</p>
<p>Even though it is still a draft, the metadata field for external runtime dependencies is <a href="https://packaging.python.org/en/latest/specifications/core-metadata/#requires-external-multiple-use">already defined</a>.</p>
<p>Still, the problem of ensuring an external program is installed is very hard.
It is very OS-dependent and may require superuser permission for installations.</p>
<p>So I don't see that this is within the scope of <code>uv</code> to handle this kind of problem.</p>
<p>But I would like <code>uv</code> to call a user-definable external helper that takes care of this task.</p>
<h3>Example</h3>
<p>My suggestion is the following:</p>
<p>When installing packages, <code>uv</code> should do the following:</p>
<ul>
<li>Collect all external dependencies [^1]. If none are found, stop here.</li>
<li>Check if an external dependency manager is defined.<ul>
<li>If not, warn the user that the collected external dependencies might be missing.</li>
<li>If yes, simply call the external dependency manager with all collected external dependencies. If the manager fails, fail the installation. Do not hide the output of the manager from the user.</li>
</ul>
</li>
</ul>
<p>It is important that the manager is called exactly once with all dependencies in order to resolve or stop on potential conflicts.</p>
<p>The external dependency manager should:</p>
<ul>
<li>Check if all external dependencies are met and exit if yes.</li>
<li>If not, try to install them; if it fails, exit as failure with a meaningful message.</li>
<li>Given PEP 725 succeeds, the dependency manager could also delegate its task to sub-managers based on <code>scheme:type/namespace</code>.</li>
</ul>
<p>This proposal:</p>
<ul>
<li>allows users to handle their external dependencies (i.e. with a system package manager or <a href="https://github.com/astral-sh/uv/issues/1703">conda</a>) as they desire</li>
<li>uses existing standards and at the same time prepares for a new one [^2]</li>
<li>is future-safe: once there is a good general external dependency manager, <code>uv</code> could just define it as default</li>
</ul>
<p><strong>Personal Background:</strong>
In my organisation, we are planning to migrate from <code>conda</code> to wheels and <code>uv</code>. There are only two non-wheel-compatible dependencies that still should be handled by <code>conda</code>.
So my idea was to use the <code>Requires-External</code> field to define them with a custom PURL and create a post-installation helper that reads the metadata and installs the required dependencies.
My co-workers would prefer one command to run, so I thought about wrapping <code>uv</code> but then thought: Well, that is actually something that would be much easier and more performant if implemented in <code>uv</code>.</p>
<p>[^1]: Currently only runtime dependencies. In the future, maybe external build dependencies, once they are defined properly. So currently, this would mean only extracting all <code>Requires-External</code> fields from the metadata of all packages.
[^2]: As handling of external dependencies will be implemented only for <code>Requires-External</code> and delegated to an external helper, <code>uv</code> is fully within the specs. The only thing to consider is that <code>uv</code> should resolve <a href="https://peps.python.org/pep-0725/#dependency-specifiers">dependency specifiers</a> within <code>Requires-External</code>, even though it is not yet part of the spec.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @CarliJoy on 2025-07-25 10:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Support for PEP 725 - external (runtime) dependencies with user definable helper" to "Support for PEP 725 - external (runtime) dependencies with user defineable helper" by @CarliJoy on 2025-07-25 11:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @zanieb on 2025-07-25 12:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-25 12:59</div>
            <div class="timeline-body"><p>I'm pretty interested in external dependency support, but we'll need to do some significant design before we can pursue adding something like this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @zanieb on 2025-07-25 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CarliJoy">@CarliJoy</a> on 2025-07-28 14:18</div>
            <div class="timeline-body"><p>Could you explain a bit more what design means in detail?</p>
<p>Can externals help with this or is the a process you do internally?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaimergp">@jaimergp</a> on 2025-07-30 16:28</div>
            <div class="timeline-body"><p>Hello folks, just a note on behalf of the PEP 725 authors!</p>
<p>We are about to submit a revised version of the PEP at some point within the next two weeks. You can see <a href="https://github.com/rgommers/peps/blob/main/peps/pep-0725.rst">the current status in this fork</a>. It contains a substantial amount of changes wrt the version available at https://peps.python.org/pep-0725/. Some highlights:</p>
<ul>
<li>The introduction of <code>dep:</code> as a <code>pkg:</code> derivative to improve ergonomics</li>
<li><code>Requires-External</code> being deprecated in favor of <code>Requires-External-Dep</code>.</li>
<li>An accompanying PEP with the specifics of cross-ecosystem mappings for external dependencies (<a href="https://github.com/rgommers/peps/blob/pep-name-mapping/peps/pep-9999.rst">draft in this branch</a>, no number assigned yet). Currently undergoing a small revision process to get it up-to-date with the latest developments.</li>
</ul>
<p>A few supporting libraries and projects have been added to demo the usefulness of the PEP, which you can also check in the following repositories:</p>
<ul>
<li><a href="https://github.com/jaimergp/pyproject-external">pyproject-external</a>: Proof of concept CLI (plus a Python API) to interact with <a href="https://peps.python.org/pep-0725/">PEP 725</a> [external] metadata and the associated mappings.</li>
<li><a href="https://github.com/rgommers/external-deps-build">external-deps-build</a>: CI workflows to build popular PyPI packages patched with the necessary [external] metadata.</li>
<li><a href="https://github.com/jaimergp/external-metadata-mappings">external-metadata-mappings</a>: Schemas, registries and mappings to support [external] metadata for different ecosystems and package managers.</li>
</ul>
<p>Let us know if there's anything else you'd like to know about it and how we can help/collaborate!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaimergp">@jaimergp</a> on 2025-09-22 16:18</div>
            <div class="timeline-body"><p>As promised (although a bit later than expected), we have now published:</p>
<ul>
<li><a href="https://discuss.python.org/t/pep-725-specifying-external-dependencies-in-pyproject-toml-round-2/103890/2">An update to PEP 725</a></li>
<li>A new, complementary <a href="https://discuss.python.org/t/pep-804-an-external-dependency-registry-and-name-mapping-mechanism/103891">PEP 804: An external dependency registry and name mapping mechanism</a></li>
</ul>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:04 UTC
    </footer>
</body>
</html>
