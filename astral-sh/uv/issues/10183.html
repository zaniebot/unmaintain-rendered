<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>setup-uv is broken for uv version 0.5.12 - astral-sh/uv #10183</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>setup-uv is broken for uv version 0.5.12</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10183">#10183</a>
        opened by <a href="https://github.com/ekzhu">@ekzhu</a>
        on 2024-12-26 22:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ekzhu">@ekzhu</a> on 2024-12-26 22:56</div>
            <div class="timeline-body"><p>See the failing CI build: https://github.com/microsoft/autogen/actions/runs/12508932257/job/34897740078</p>
<p>It works locally with uv version 0.5.12.</p>
<p>Previous version 0.5.11 also works on setup-uv@v5 in CI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 22:58</div>
            <div class="timeline-body"><p>Thanks, I'll take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 23:13</div>
            <div class="timeline-body"><p>Ah ok, this is a result of a change I made in this release that modifies how we write metadata for &quot;projects that don't have a <code>[project]</code> table&quot;, and it looks like you're using that in <code>autogen/python</code>. We've considered those legacy for a while, so I thought it was fine to ship it in a patch release. I'm sorry for the disruption. You can run <code>uv lock</code> to update the lockfile. It should attempt to preserve as many versions as possible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ekzhu">@ekzhu</a> on 2024-12-26 23:32</div>
            <div class="timeline-body"><p>Thanks for the quick response. I ran <code>uv lock</code> but it did not fix it.</p>
<p>We would like to update from the legacy usage. So we should include <code>[project]</code> in our <code>autogen/python/project.toml</code> file correct?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 23:38</div>
            <div class="timeline-body"><p>Yeah, this would be the most up-to-date configuration:</p>
<pre><code class="language-diff">diff --git a/python/pyproject.toml b/python/pyproject.toml
index 5829a09a..af13101d 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -1,8 +1,10 @@
-[tool.uv.workspace]
-members = [&quot;packages/*&quot;]
+[project]
+name = &quot;autogen&quot;
+version = &quot;0.0.1&quot;
+dependencies = []

-[tool.uv]
-dev-dependencies = [
+[dependency-groups]
+dev = [
     &quot;pyright==1.1.389&quot;,
     &quot;mypy==1.13.0&quot;,
     &quot;ruff==0.4.8&quot;,
@@ -22,6 +24,9 @@ dev-dependencies = [
     &quot;tomli&quot;,
 ]

+[tool.uv.workspace]
+members = [&quot;packages/*&quot;]
+
 [tool.uv.sources]
 autogen-core = { workspace = true }
 autogen-ext = { workspace = true }
</code></pre>
<p><code>[dependency-groups]</code> was recently standardized, so you can now use that in lieu of <code>[tool.uv.dev-dependencies]</code>, but it's not a required change -- just optional.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 23:38</div>
            <div class="timeline-body"><p>(Running <code>uvx uv@0.5.12 lock</code> followed by <code>uvx uv@0.5.12 lock --locked</code> does succeed for me, though.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jackgerrits">@jackgerrits</a> on 2024-12-26 23:55</div>
            <div class="timeline-body"><p>Thanks so much for explaining how we can fix our setup. Definitely didn't intend to be out of date and are very happy to move forward</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 13:41</div>
            <div class="timeline-body"><p>Oh, no worries! Happy to help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-27 13:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jackgerrits">@jackgerrits</a> on 2024-12-27 15:35</div>
            <div class="timeline-body"><p>@charliermarsh After upgrading our workspace <code>pyproject.toml</code>, it seems like a <code>uv sync</code> in the root workspace directory is no longer installing all workspace packages into the created virtual environment. Is this an expected change?</p>
<p>~~Is there a way to cause the <code>uv sync</code> to install all workspace packages?~~ Found it: <code>--all-packages</code></p>
<p>I confirmed before and after changing the workspace definition per <a href="https://github.com/astral-sh/uv/issues/10183#issuecomment-2563171567">this</a> comment using both uv 5.11 and 5.13.</p>
<p>Is it because the workspace is now a &quot;project&quot;, and it is only installing that &quot;project&quot; and no longer transitively all projects in the workspace?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jackgerrits">@jackgerrits</a> on 2024-12-27 15:38</div>
            <div class="timeline-body"><p>It seems I now need to pass <code>--all-packages</code> to get all packages installed. We're we relying on some implicit weirdness before to get all the packages installed?</p>
<p>This definitely feels reasonable, but I know some of our users are going to get tripped up by it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 16:01</div>
            <div class="timeline-body"><p>Yeah that's right -- if you use a <code>pyproject.toml</code> without a <code>[project]</code> table, then the default behavior is to install all members. But once it's a package, the default is to install that package's dependencies.</p>
<p>So, you have a few options:</p>
<ol>
<li>Add all the packages in <code>packages/</code> as dependencies.</li>
</ol>
<pre><code class="language-diff">diff --git a/python/pyproject.toml b/python/pyproject.toml
index 5829a09a..6e774066 100644
--- a/python/pyproject.toml
+++ b/python/pyproject.toml
@@ -1,3 +1,17 @@
+[project]
+name = &quot;autogen&quot;
+version = &quot;0.0.1&quot;
+dependnecies = [
+    &quot;agbench&quot;,
+    &quot;autogen-agentchat&quot;,
+    &quot;autogen-core&quot;,
+    &quot;autogen-ext&quot;,
+    &quot;autogen-magentic-one&quot;,
+    &quot;autogen-studio&quot;,
+    &quot;autogen-test-utils&quot;,
+    &quot;component-schema-gen&quot;,
+]
+
 [tool.uv.workspace]
 members = [&quot;packages/*&quot;]
 
@@ -23,10 +37,14 @@ dev-dependencies = [
 ]
 
 [tool.uv.sources]
+agbench = { workspace = true }
+autogen-agentchat = { workspace = true }
 autogen-core = { workspace = true }
 autogen-ext = { workspace = true }
-autogen-agentchat = { workspace = true }
+autogen-magentic-one = { workspace = true }
+autogen-studio = { workspace = true }
 autogen-test-utils = { workspace = true }
+component-schema-gen = { workspace = true }
 
 [tool.ruff]
 line-length = 120
</code></pre>
<ol start="2">
<li><p>Pass <code>--all-packages</code>.</p>
</li>
<li><p>Skip adding <code>[project]</code> for now. We'll probably make these non-<code>[project]</code> projects more first-class in the future, since PEP 735 explicitly added support for them. So, it's ok if you want to leave it as-is. It's mostly that we've historically discouraged them, and they have some odd behaviors right now that we want to fix up over time.</p>
</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jackgerrits">@jackgerrits</a> on 2024-12-27 16:11</div>
            <div class="timeline-body"><p>Thanks so much for the explanation all makes complete sense to me. I'd prefer to be working with what's best supported by uv and since this workspace package is solely for dev work convenience (which is a big deal. uv's workspace support is a massive feature IMO) its not a big deal at all to change if we need to.</p>
<p>Option 1 seems the best for our use case at the moment. Thanks again for the support here!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 16:17</div>
            <div class="timeline-body"><p>No worries, I'm always happy to help especially when people are so friendly. Ask any time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jackgerrits">@jackgerrits</a> on 2024-12-27 16:27</div>
            <div class="timeline-body"><p>We really appreciate your super fast and helpful responses! Seriously love the work you and the team do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jackgerrits">@jackgerrits</a> on 2024-12-27 16:36</div>
            <div class="timeline-body"><p>One more question. I have a dev dependency group in both the root workspace package and several of the packages in the workspace. It seems if I use <code>--all-packages</code> then the dev dependency group is installed for each package in workspace. But,
if I go the route of <a href="https://github.com/astral-sh/uv/issues/10183#issuecomment-2563831350"><code>1.</code></a> above, then the dev dependency group of transitive packages is not installed. Understandable, since now they are simple dependencies and you wouldn't want dev deps installed in this instance normally. However, is there a way to define the root workspace package to also cause all workspace package dev dependencies to be installed too?</p>
<p>If not, I think I'll just collapse all dev dependencies into the root package rather than splitting them per package.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:30:21 UTC
    </footer>
</body>
</html>
