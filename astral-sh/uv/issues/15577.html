<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&quot;uv pip install *** --compile-bytecode&quot; fails with obscure message - astral-sh/uv #15577</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>&quot;uv pip install *** --compile-bytecode&quot; fails with obscure message</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15577">#15577</a>
        opened by <a href="https://github.com/mrmathematica">@mrmathematica</a>
        on 2025-08-28 23:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mrmathematica">@mrmathematica</a> on 2025-08-28 23:20</div>
            <div class="timeline-body"><h3>Summary</h3>
<ol>
<li>We run python and uv in containners. Python comes the following site.getsitepackages(): '/usr/local/lib64/python3.12/site-packages', '/usr/local/lib/python3.12/site-packages', '/usr/lib64/python3.12/site-packages', '/usr/lib/python3.12/site-packages'.</li>
<li>'/usr/local/lib64/python3.12/site-packages' folder doesn't exist by default (This is after we run <code>dnf install python3.12</code> on ubi8 base image). If calling &quot;uv pip install&quot; with some binary package, it will be created and the binary package will be installed into there.</li>
<li>In this case we want to call &quot;uv pip install some-pure-python-package --bytecode-compile&quot;. I can confirm, if calling &quot;uv pip install some-pure-python-package&quot;, the pacakge will be installed into '/usr/local/lib/python3.12/site-packages', and '/usr/local/lib64/python3.12/site-packages' won't be created.</li>
<li>calling &quot;uv pip install some-pure-python-package --bytecode-compile&quot; fails with obscure message:</li>
</ol>
<p>error: Failed to bytecode-compile Python file in: /usr/local/lib64/python3.12/site-packages
Caused by: Failed to start Python interpreter to run compile script</p>
<p>It took me more then half a day, to finally figure out the error is because '/usr/local/lib64/python3.12/site-packages' doesn't exist, and the packages are being installed into '/usr/local/lib/python3.12/site-packages'. In this case, I think uv should gracefully taking care the situation, either to create an empty '/usr/local/lib/python3.12/site-packages' folder, or not fail anyway.</p>
<h3>Platform</h3>
<p>Redhat ubi8 base image</p>
<h3>Version</h3>
<p>0.8.13</p>
<h3>Python version</h3>
<p>Python 3.12.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mrmathematica on 2025-08-28 23:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-28 23:59</div>
            <div class="timeline-body"><p>Are you able to provide a minimal reproduction, e.g. with a Dockerfile?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-08-28 23:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mrmathematica">@mrmathematica</a> on 2025-08-29 01:21</div>
            <div class="timeline-body"><p>Yes, this is my Dockerfile</p>
<pre><code>FROM registry.access.redhat.com/ubi8/ubi:latest

# Install python
RUN dnf install -y python3.12 python3.12-devel curl ca-certificates \
    &amp;&amp; dnf clean all

# Install uv and link it to /usr/local/bin
RUN curl -LsSf https://astral.sh/uv/install.sh | sh \
    &amp;&amp; ln -s /root/.local/bin/uv /usr/local/bin/uv

# Install 'six' using uv and compile bytecode
RUN uv pip install --system six --compile-bytecode

CMD [&quot;/bin/bash&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @charliermarsh on 2025-08-31 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-31 14:33</div>
            <div class="timeline-body"><p>Thanks! That reproduces for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-08-31 14:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:26:54 UTC
    </footer>
</body>
</html>
