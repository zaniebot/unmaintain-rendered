```yaml
number: 12650
title: "Running `uv` in a read-only docker-like filesystem"
type: issue
state: closed
author: tgrohens
labels:
  - question
assignees: []
created_at: 2025-04-03T13:00:40Z
updated_at: 2025-04-03T14:19:35Z
url: https://github.com/astral-sh/uv/issues/12650
synced_at: 2026-01-10T01:57:29Z
```

# Running `uv` in a read-only docker-like filesystem

---

_Issue opened by @tgrohens on 2025-04-03 13:00_

### Question

Hi,

I'm using `uv` to manage a project that I would like to run in an HPC environment, by packaging it within a [charliecloud](https://hpc.github.io/charliecloud/) (Docker-like) read-only image.

I've followed the [using uv with Docker](https://docs.astral.sh/uv/guides/integration/docker/) doc page and come up with the following Dockerfile (using a toy package as example):

```
FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim
RUN apt-get update
RUN apt-get -y install git

# Clone the package
WORKDIR /usr/src
RUN git clone https://github.com/tgrohens/test_cowsay.git

# Install Python environment
WORKDIR /usr/src/test_cowsay
RUN uv sync --frozen
RUN uv pip install .
# note that charliecloud does not support the CMD command
```

If I build this into an image named `cowsay.sqfs` and try to run the project from outside the image with a simple `uv run` like so:
```
$ ch-run cowsay.sqfs --cd=/usr/src/test_cowsay -- uv run test_cowsay hello
```

I get (maybe expectedly):
```
error: failed to open file `/root/.cache/uv/sdists-v9/.git`: Read-only file system (os error 30)
```

I can also run the image with a temporary overlay filesystem:
```
$ ch-run cowsay.sqfs --write-fake --cd=/usr/src/test_cowsay -- uv run test_cowsay hello
```

In that case, I get (maybe also expectedly since there are multiple filesystems involved):
```
      Built test-cowsay @ file:///usr/src/test_cowsay
  Ã— Failed to build `test-cowsay @ file:///usr/src/test_cowsay`
  â”œâ”€â–¶ Failed to write to the distribution cache
  â•°â”€â–¶ failed to rename file from /root/.cache/uv/.tmpcZhUM8 to
      /root/.cache/uv/archive-v0/aXKPSjE2NUpWA24hZCKqY: Cross-device link (os error 18)
```

Am I missing anything here or is this a usecase that's not supported yet?
Cheers,

### Platform

Debian bookworm slim Linux 6.1.0-28-arm64 

### Version

uv 0.6.12

---

_Label `question` added by @tgrohens on 2025-04-03 13:00_

---

_Comment by @zanieb on 2025-04-03 13:27_

Have you tried creating a writable mount for the cache directory specifically? You could also try `--no-cache` and create a writable mount at `/tmp`?

---

_Comment by @tgrohens on 2025-04-03 13:54_

Thanks for the suggestion!
I hadn't tried that, but it gives me another error within the `.venv` directory this time:
```
error: failed to remove file `/usr/src/test_cowsay/.venv/lib/python3.12/site-packages/../../../bin/test_cowsay`: Read-only file system (os error 30)
```

With the overlay fs:
```
error: failed to remove directory `/usr/src/test_cowsay/.venv/lib/python3.12/site-packages/test_cowsay-0.1.0.dist-info`: I/O error (os error 5)
```

---

_Comment by @zanieb on 2025-04-03 14:01_

You may want `uv run --no-sync` so we don't attempt to update the environment.

Regarding...

```
RUN uv sync --frozen
RUN uv pip install .
```

Why do you do a `pip install` operation after syncing?

---

_Comment by @tgrohens on 2025-04-03 14:19_

Using both `--no-sync` and `--no-cache` works, thank you!
As for using `uv pip install`, I must have thought this was needed at some point but it works just fine without it.

Thanks for the great support ðŸš€ !

---

_Closed by @tgrohens on 2025-04-03 14:19_

---

_Referenced in [ThePhaseless/Byparr#249](../../ThePhaseless/Byparr/issues/249.md) on 2025-09-28 05:06_

---
