<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Why might `uv` in a Windows container make a .venv with a `Lib` that cannot be copied? - astral-sh/uv #7723</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Why might `uv` in a Windows container make a .venv with a `Lib` that cannot be copied?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/7723">#7723</a>
        opened by <a href="https://github.com/doctorpangloss">@doctorpangloss</a>
        on 2024-09-26 19:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/doctorpangloss">@doctorpangloss</a> on 2024-09-26 19:16</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<pre><code>FROM mcr.microsoft.com/windows/server:10.0.20348.1970 AS build
USER ContainerAdministrator

ARG PIP_DISABLE_PIP_VERSION_CHECK=1
ARG PIP_NO_CACHE_DIR=1

RUN powershell -NoProfile -ExecutionPolicy Bypass -Command &quot;[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))&quot;
RUN choco install -y --no-progress python --version=3.11.9
RUN choco install -y --no-progress git cmake

WORKDIR C:/

RUN powershell -c &quot;irm https://astral.sh/uv/install.ps1 | iex&quot;
RUN uv venv --seed
RUN C:/.venv/scripts/activate.bat

# Copy from the cache instead of linking since it's a mounted volume
ENV UV_LINK_MODE=copy
...

FROM mcr.microsoft.com/windows/server:10.0.20348.1970 AS final
USER ContainerAdministrator
COPY --link --from=build C:/Python311 C:/Python311
COPY --link --from=build C:/.venv C:/.venv
</code></pre>
<p>leads to:</p>
<pre><code>Step 47/57 : COPY --link --from=build C:/.venv C:/.venv
COPY failed: open \\?\Volume{187fc7e0-9270-488a-9d90-06f9ad730fd4}\.venv\Lib: Access is denied.
</code></pre>
<p>Does <code>UV_LINK_MODE</code> interact with <code>uv venv</code> ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-26 19:38</div>
            <div class="timeline-body"><p>Are you looking for the <code>--relocatable</code> flag? I believe the link mode only affects package installation not handling of the Python interpreter in a virtual environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-09-26 19:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 22:03</div>
            <div class="timeline-body"><p>Related https://github.com/astral-sh/uv-docker-example/pull/15</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:56 UTC
    </footer>
</body>
</html>
