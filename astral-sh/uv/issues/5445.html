<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installing into a virtualenv on Windows fails when the location changes - astral-sh/uv #5445</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Installing into a virtualenv on Windows fails when the location changes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5445">#5445</a>
        opened by <a href="https://github.com/ak-gupta">@ak-gupta</a>
        on 2024-07-25 14:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ak-gupta">@ak-gupta</a> on 2024-07-25 14:44</div>
            <div class="timeline-body"><p>Hi there!</p>
<p><code>uv</code> is awesome, but we're running into an issue with installing into a virtualenv on Windows. If I run</p>
<pre><code class="language-bash">uv pip install --python=/path/to/python
</code></pre>
<p>I sometimes get an error message similar to the following:</p>
<pre><code>RuntimeError: Unable to run the following command: 

 uv pip install --python=C:\Users\RUNNER~1\AppData\Local\Temp\tmp3hg_0oka\.edgetest\core\Scripts\python .[tests]
WARNING  venv:__init__.py:165 Actual environment location may have moved due to redirects, links or junctions.
  Requested location: &quot;C:\Users\RUNNER~1\AppData\Local\Temp\tmp3hg_0oka\.edgetest\lower_env\Scripts\python.exe&quot;
  Actual location:    &quot;C:\Users\runneradmin\AppData\Local\Temp\tmp3hg_0oka\.edgetest\lower_env\Scripts\python.exe&quot;
</code></pre>
<p>this is running on GitHub Actions using <code>windows-latest</code> and <code>uv</code> version 0.2.28. If curious, the error log is in the job from <a href="https://github.com/capitalone/edgetest/pull/81">this PR</a>. Any help is greatly appreciated!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 14:47</div>
            <div class="timeline-body"><p>Thanks, that's an interesting one. Those are indeed aliases for one another. Let me see why it's failing...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 14:51</div>
            <div class="timeline-body"><p>In <code>utils.py</code>, can you modify the exception to include all of <code>stdout</code> and <code>stderr</code>? The directory mismatch <em>may</em> be the problem, but it's also just a warning and so not the immediate cause of the failure.</p>
<p>https://github.com/capitalone/edgetest/blob/8ac71cdb26516e2120745934febc724732ab0e8d/edgetest/utils.py#L46</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-07-25 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ak-gupta">@ak-gupta</a> on 2024-07-25 15:52</div>
            <div class="timeline-body"><p>Thanks for the quick reply! I updated the logging and got this output:</p>
<pre><code>WARNING  venv:__init__.py:158 Actual environment location may have moved due to redirects, links or junctions.
  Requested location: &quot;C:\Users\RUNNER~1\AppData\Local\Temp\tmp3l_vmwg8\.edgetest\core\Scripts\python.exe&quot;
  Actual location:    &quot;C:\Users\runneradmin\AppData\Local\Temp\tmp3l_vmwg8\.edgetest\core\Scripts\python.exe&quot;
ERROR    edgetest.core:core.py:178 Unable to install the local package into core
Traceback (most recent call last):
  File &quot;D:\a\edgetest\edgetest\edgetest\core.py&quot;, line 171, in setup
    _run_command(
  File &quot;D:\a\edgetest\edgetest\edgetest\utils.py&quot;, line 46, in _run_command
    raise RuntimeError(
RuntimeError: Unable to run the following command: 

 uv pip install --python=C:\Users\RUNNER~1\AppData\Local\Temp\tmp3l_vmwg8\.edgetest\core\Scripts\python .[tests] 

Returned the following stdout: 

  

Returned the following stderr: 

 error: No virtual or system environment found for path `.edgetest\core\Scripts\python`

</code></pre>
<p>Just to note -- our current code uses <code>pip</code> with commands equivalent to</p>
<pre><code class="language-bash">C:\Users\RUNNER~1\AppData\Local\Temp\tmp3l_vmwg8\.edgetest\core\Scripts\python -m pip install .[tests]
</code></pre>
<p>since I haven't changed the logic for finding the virtual environment</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 16:28</div>
            <div class="timeline-body"><p>Thanks! Just to confirm, is <code>.edgetest\core</code> a virtual environment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ak-gupta">@ak-gupta</a> on 2024-07-25 17:02</div>
            <div class="timeline-body"><p>Yes! Essentially our package creates a series of virtual environments, upgrades core dependencies to the latest available version, then runs testing to see if the current library is compatible with upgraded dependencies. For this example, we're using <code>venv.EnvBuilder(Path.cwd() / &quot;.edgetest&quot; / &quot;core&quot;, with_pip=False)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 17:21</div>
            <div class="timeline-body"><p>I think it needs to be <code>python.exe</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 17:22</div>
            <div class="timeline-body"><p>That may not matter here though. One sec.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 17:25</div>
            <div class="timeline-body"><p>Ok yeah tracing the code, I think that might be the problem here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ak-gupta">@ak-gupta</a> on 2024-07-25 17:26</div>
            <div class="timeline-body"><p>Ah. Let me try that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 17:26</div>
            <div class="timeline-body"><p>We can probably be robust to it, but can you try changing to add the <code>.exe</code> extension on your end?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-07-25 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ak-gupta">@ak-gupta</a> on 2024-07-25 17:27</div>
            <div class="timeline-body"><p>Yep, I'll push up a change and see if that fixes the issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ak-gupta">@ak-gupta</a> on 2024-07-25 17:44</div>
            <div class="timeline-body"><p>The <code>.exe</code> extension fixed the issue! Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 17:44</div>
            <div class="timeline-body"><p>Stellar. @zanieb do you think we should be robust to this? I.e., passing <code>--python .edgetest\core\Scripts\python</code> without the <code>.exe</code> suffix? (We detect that it's a &quot;file&quot; path, but we later fail to find the file.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-25 18:00</div>
            <div class="timeline-body"><p>I'll just fix it, easy and will be a common footgun.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-25 18:01</div>
            <div class="timeline-body"><p>Seems okay to infer the <code>.exe</code> on Windows, yeah.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5456.html">astral-sh/uv#5456</a> on 2024-07-25 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-25 20:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:31 UTC
    </footer>
</body>
</html>
