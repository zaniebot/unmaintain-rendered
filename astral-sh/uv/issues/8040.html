<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>add `[tool.pyright]` section when `uv init` - astral-sh/uv #8040</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>add `[tool.pyright]` section when `uv init`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8040">#8040</a>
        opened by <a href="https://github.com/bnjox">@bnjox</a>
        on 2024-10-09 09:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bnjox">@bnjox</a> on 2024-10-09 09:24</div>
            <div class="timeline-body"><p>can we add this block when we do <code>uv init</code></p>
<pre><code class="language-toml">[tool.pyright]
venvPath = &quot;.&quot;
venv = &quot;.venv&quot;
</code></pre>
<ul>
<li>It helps avoid creating a pyrightconfig file for small <em>(or all)</em> projects</li>
<li>Helps avoid always adding it manually or creating the pyrightconfig file to add extra config.</li>
</ul>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/my1e5">@my1e5</a> on 2024-10-09 10:57</div>
            <div class="timeline-body"><p>If you have a specific configuration you want to use, you can set up a command. For example</p>
<pre><code>$ uv init foo &amp;&amp; cd foo &amp;&amp; echo $'\n[tool.pyright]\nvenvPath = &quot;.&quot;\nvenv = &quot;.venv&quot;' &gt;&gt; pyproject.toml
</code></pre>
<p>You could put this as a command in a <code> .zshrc</code> or <code>.bashrc</code> file</p>
<pre><code>init_uv_pyright() {
    uv init &quot;$1&quot; &amp;&amp; cd &quot;$1&quot; &amp;&amp; echo $'\n[tool.pyright]\nvenvPath = &quot;.&quot;\nvenv = &quot;.venv&quot;\n' &gt;&gt; pyproject.toml
}
</code></pre>
<p>then run</p>
<pre><code>$ init_uv_pyright foo
</code></pre>
<pre><code>$ cat pyproject.toml
[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = []

[tool.pyright]
venvPath = &quot;.&quot;
venv = &quot;.venv&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bnjox">@bnjox</a> on 2024-10-09 11:02</div>
            <div class="timeline-body"><p>that could work, but having to setup a custom script just for that is a lot.
what if the tool could either make an option or add it in like we had for the build backend (previously)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MikeHart85">@MikeHart85</a> on 2024-10-13 09:52</div>
            <div class="timeline-body"><p>Assuming you want correct lsp library resolution in your editor, try activating the venv before starting the editor:</p>
<pre><code class="language-sh">$ . .venv/bin/activate
(venv) $ nvim .
</code></pre>
<p>Doing it this way has the added benefit that pyright also correctly resolves standard library imports, particularly when a non-system Python install is being used:</p>
<pre><code class="language-sh">$ uv init --python=3.8
$ uv sync
$ nvim pyproject.toml  # your tool.pyright edit
$ nvim hello.py
</code></pre>
<pre><code class="language-py">from pathlib import Path  # try go definition on Path
</code></pre>
<p>You'll find it either resolves to the system Python library version or, more likely, the typeshed-fallback pyi that pyright ships with. Either way, this will give partially incorrect hints for that Python version.</p>
<p>If you activate the venv instead, <strong>without</strong> edits to pyproject.toml, it will correctly resolve to <code>~/.local/share/uv/[...]/lib/python3.8/pathlib.py</code>.</p>
<p>Adding this config block to pyproject.toml would break correct resolution for everyone collaborating on the project, even if they activate their venv before starting their editor.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-10-13 11:33</div>
            <div class="timeline-body"><p>@MikeHart85 I think that you're right this is a &quot;bug&quot; in pyright, but I can't find that it's tracked. The fork basedpyright has an issue tracking this.</p>
<p>I think VS Code doesn't need this setting because it configures the LSP with pythonPath or extraPaths instead.</p>
<p>I use neovim and have decided to do the same thing - configure basedpyright with pythonPath/extraPaths per project dynamically - detect a local .venv and query that python for its paths, and use that. That both removes the need for the venv/venvPath configuration, has no need for venv activation, and fixes that bug with jump-to-definition on standard library items.</p>
<p>It's more complicated, but it also allows correct include paths with multiple projects open in the same editor instance.</p>
<p>@sparrowsl: I think the venv/venvPath settings are good, better than requiring environment activation, but IMO just a stepping stone on the way to a fully satisfactory configuration. Even better is to not need those settings at all..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MikeHart85">@MikeHart85</a> on 2024-10-13 15:23</div>
            <div class="timeline-body"><p>Yeah, it definitely smells like a pyright bug. It has everything it needs to figure out the correct location with venvPath/venv set, but just doesn't.</p>
<p>Neovim users could also consider https://github.com/linux-cultist/venv-selector.nvim, which has no trouble finding the .venv that <code>uv</code> generates, and remembers which venv to use on a per project basis. However, it currently has the same problem as setting the venPath/venv in pyproject.toml, presumably because it effectively does the same thing and so runs into the same pyright bug.</p>
<p>Perhaps it could be updated to set pythonPath/extraPaths instead, as you suggest. But that feels like a workaround for a bug that shouldn't exist. Really, it's up to based/pyright to fix this properly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2024-10-14 08:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-16 09:23</div>
            <div class="timeline-body"><p>We try to avoid adding configuration for external tools in uv. There are some workarounds in this thread, otherwise I recommend raising this with pyright.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-10-16 09:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tmcw/indiepixel/pulls/18.html">tmcw/indiepixel#18</a> on 2025-02-09 16:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
