<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>unsafe-best-match: unexpected best-version selection with multiple indexes - astral-sh/uv #12123</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>unsafe-best-match: unexpected best-version selection with multiple indexes</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12123">#12123</a>
        opened by <a href="https://github.com/UmerAhmad">@UmerAhmad</a>
        on 2025-03-11 23:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/UmerAhmad">@UmerAhmad</a></div>
            <div class="timeline-body">Summary
<p>hey folks,</p>
<p>I found that when using unsafe-best-match with multiple indexes, there was a case where behavior for candidacy of &quot;best-version&quot; across the combined set of candidate versions was a bit unintuitive, and that ordering of the indexes mattered.</p>
<p>For example with a package that has both a wheel and a sdist, if the repository with the sdist appeared first (in extra-index) and the wheel as a fallback (default), it would attempt to build the sdist and error. However, if the ordering of the indexes was swapped, it would work due to resolving to the wheel. This isn&#x27;t an issue for us as our repositories are purposed so as long as the ordering is correct it&#x27;ll behave correctly, but I assumed &quot;best-version&quot; candidacy would include default uv behavior of prioritizing a wheel where it can across the combined set of candidate versions (i.e similar for a single repository search with multiple versions of the same package), and make it index ordering agnostic.</p>
Platform
<p>macOS 15 arm64</p>
Version
<p>uv 0.6.1</p>
Python version
<p>3.10.x</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/UmerAhmad">@UmerAhmad</a> on 2025-03-11 23:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-11 23:14</div>
            <div class="timeline-body"><p>Just to clarify, in this case, were the sdist and wheel for the same version of the package?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/UmerAhmad">@UmerAhmad</a> on 2025-03-11 23:20</div>
            <div class="timeline-body"><p>yep! for a bit more context, specifically supplying a pinned.txt with all the versions pinned and using:</p>
<p>&quot;uv pip sync pinned.txt --index-strategy unsafe-best-match&quot;</p>
<p>I found that the ordering of the environment variables (of the indexes) was what the command was dependent on in differentiating to build vs finding the wheel</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-12 22:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-12 22:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-12 23:04</div>
            <div class="timeline-body"><p>Yeah this is interesting... I&#x27;m undecided on whether we should change anything here, but we should at least consider it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/UmerAhmad">@UmerAhmad</a> on 2025-03-13 02:12</div>
            <div class="timeline-body"><p>thanks for taking a look! yeah I was unsure whether this was intentional or not, but definitely something to be aware of when using it.</p>
<p>also, wanted to say as a new user - onboarding with &amp; using UV overall has been phenomenal. really appreciate the work being done here!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-13 02:15</div>
            <div class="timeline-body"><p>Thank you so much! üôá‚Äç‚ôÇ</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:44 UTC
    </footer>
</body>
</html>
