```yaml
number: 6249
title: "`requires-dist` sorting is unstable"
type: issue
state: closed
author: konstin
labels:
  - bug
  - preview
assignees: []
created_at: 2024-08-20T13:04:17Z
updated_at: 2024-08-20T17:11:58Z
url: https://github.com/astral-sh/uv/issues/6249
synced_at: 2026-01-10T01:57:13Z
```

# `requires-dist` sorting is unstable

---

_Issue opened by @konstin on 2024-08-20 13:04_

When i run:
```shell
rm uv.lock 
uv lock
git commit -m "lock" uv.lock
uv lock --upgrade
```

in transformers, i see a diff afterwards that has no content changes, but differences in `requires-dist` sources:

```diff
diff --git a/uv.lock b/uv.lock
index 5ee8fd7..c28fcec 100644
--- a/uv.lock
+++ b/uv.lock
@@ -5704,9 +5704,9 @@ requires-dist = [
     { name = "beautifulsoup4", marker = "extra == 'deepspeed-testing'" },
     { name = "beautifulsoup4", marker = "extra == 'dev-dependencies'" },
     { name = "codecarbon", marker = "extra == 'all'", specifier = "==1.2.0" },
-    { name = "codecarbon", marker = "extra == 'codecarbon'", specifier = "==1.2.0" },
     { name = "codecarbon", marker = "extra == 'dev-dependencies'", specifier = "==1.2.0" },
     { name = "codecarbon", marker = "extra == 'docs'", specifier = "==1.2.0" },
+    { name = "codecarbon", marker = "extra == 'codecarbon'", specifier = "==1.2.0" },
     { name = "cookiecutter", marker = "extra == 'deepspeed-testing'", specifier = "==1.7.3" },
     { name = "cookiecutter", marker = "extra == 'dev-dependencies'", specifier = "==1.7.3" },
     { name = "cookiecutter", marker = "extra == 'modelcreation'", specifier = "==1.7.3" },
@@ -5746,8 +5746,8 @@ requires-dist = [
     { name = "hf-doc-builder", marker = "extra == 'dev-dependencies'" },
     { name = "hf-doc-builder", marker = "extra == 'dev-dependencies'", specifier = ">=0.3.0" },
     { name = "hf-doc-builder", marker = "extra == 'docs'" },
-    { name = "hf-doc-builder", marker = "extra == 'docs-specific'" },
     { name = "hf-doc-builder", marker = "extra == 'quality'", specifier = ">=0.3.0" },
+    { name = "hf-doc-builder", marker = "extra == 'docs-specific'" },
     { name = "huggingface-hub", specifier = "<1.0,>=0.19.3" },
     { name = "huggingface-hub", marker = "extra == 'torchhub'", specifier = "<1.0,>=0.19.3" },
     { name = "importlib-metadata", marker = "extra == 'torchhub'" },
[...]
```

We should instead create a stable sorting.

---

_Label `bug` added by @konstin on 2024-08-20 13:04_

---

_Label `preview` added by @konstin on 2024-08-20 13:04_

---

_Assigned to @konstin by @konstin on 2024-08-20 13:04_

---

_Referenced in [astral-sh/uv#6253](../../astral-sh/uv/pulls/6253.md) on 2024-08-20 14:57_

---

_Closed by @konstin on 2024-08-20 17:11_

---

_Closed by @konstin on 2024-08-20 17:11_

---
