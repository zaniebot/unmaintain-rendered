<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uv can't build if I do have a private repo declared - astral-sh/uv #13452</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Uv can't build if I do have a private repo declared</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/13452">#13452</a>
        opened by <a href="https://github.com/gervaila">@gervaila</a>
        on 2025-05-14 14:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gervaila">@gervaila</a> on 2025-05-14 14:30</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I do have a problem with this feature our CI was working before and now it's broken.
I publish my built package to a private repository but I don't need it for building.
When I try to build, uv tries to look for hatchling inside my private repository and can't find it because it's not authenticated.
Here's my pyproject.toml</p>
<pre><code>[project]
name = &quot;x&quot;
version = &quot;1.5.0&quot;

requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;httpx&gt;=0.28.1&quot;,
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[[tool.uv.index]]
name = &quot;gcp&quot;
url = &quot;https://europe-west1-python.pkg.dev/xx/xx/simple/&quot;
publish-url = &quot;https://europe-west1-python.pkg.dev/xx/xx/&quot;
</code></pre>
<p>And here's the error I get :</p>
<pre><code> Building source distribution...
  × Failed to build
  │ `/home/runner/work/xx/xx`
  ├─▶ Failed to resolve requirements from `build-system.requires`
  ├─▶ No solution found when resolving: `hatchling`
  ╰─▶ Because hatchling was not found in the package registry and you require
      hatchling, we can conclude that your requirements are unsatisfiable.
      hint: An index URL
      (https://europe-west1-python.pkg.dev/xx/xx/simple/)
      could not be queried due to a lack of valid authentication credentials
      (401 Unauthorized).
</code></pre>
<p>I don't really want to authenticate during the build step and I don't think it's usefull, how can I change my pyproject.toml to make it work ?</p>
<h3>Platform</h3>
<p>github runner</p>
<h3>Version</h3>
<p>uv 0.7.3</p>
<h3>Python version</h3>
<p>python 3.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @gervaila on 2025-05-14 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gervaila">@gervaila</a> on 2025-05-14 14:31</div>
            <div class="timeline-body"><p>here's probably the root cause of my problem : <a href="https://github.com/astral-sh/uv/pull/12805">12805</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @jtfmumm by @konstin on 2025-05-14 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-05-14 15:29</div>
            <div class="timeline-body"><p>One approach you could take here is to pass <code>--index https://pypi.org/simple/</code> to <code>uv build</code> in order to give PyPI priority over your private index. Then it should find <code>hatchling</code> there before needing to search your index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @jtfmumm on 2025-05-14 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @jtfmumm on 2025-05-14 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-15 02:34</div>
            <div class="timeline-body"><p>This is intentional: uv <em>should</em> fail if it can't connect to your registry; otherwise, we'd silently fall-through in cases where you actually <em>want</em> to get packages from the registry, and you'd end up installing packages from PyPI that you <em>thought</em> were coming from your registry.</p>
<p>If you want to fall back regardless (i.e., restore the prior behavior and accept the risks):</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;gcp&quot;
url = &quot;https://europe-west1-python.pkg.dev/xx/xx/simple/&quot;
publish-url = &quot;https://europe-west1-python.pkg.dev/xx/xx/&quot;
ignore-error-codes = [401, 403]
</code></pre>
<p>Alternatively, you can pass <code>--index https://pypi.org/simple/</code> to <code>uv build</code> as @jtfmumm mentioned, and we'll check PyPI first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-05-15 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gervaila">@gervaila</a> on 2025-05-15 07:09</div>
            <div class="timeline-body"><p>Great ! it works, thanks !
I would love to see a feature where there's a distinction between an index you intend to publish to and one where you want to get package from, but that's another topic.
Thank you for your help !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-05-15 07:13</div>
            <div class="timeline-body"><p><a href="https://docs.astral.sh/uv/guides/package/#publishing-your-package">You can configure a distinct URL for publishing</a>. Is that what you mean?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gervaila">@gervaila</a> on 2025-05-15 08:55</div>
            <div class="timeline-body"><p>Yes, that's exactly what I was looking for ! thanks again</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ketozhang">@ketozhang</a> on 2025-06-05 17:51</div>
            <div class="timeline-body"><p>Added #13856 issue, but focus more on this feature further complicates local development of packages.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
