<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Why do libraries requirements start failing when specifying python version in `uv run`? - astral-sh/uv #7730</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Why do libraries requirements start failing when specifying python version in <code>uv run</code>?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7730">#7730</a>
        opened by <a href="https://github.com/gitgithan">@gitgithan</a>
        on 2024-09-27 05:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gitgithan">@gitgithan</a></div>
            <div class="timeline-body"><p>demo.py tweaked from docs with more prints:</p>
<pre><code>import requests
from rich.pretty import pprint
import sys

print(sys.version)

import importlib.metadata

rich_version = importlib.metadata.version(&quot;rich&quot;)
print(&quot;Rich Version: &quot;, rich_version)

resp = requests.get(&quot;https://peps.python.org/api/peps.json&quot;)
data = resp.json()
pprint([(k, v[&quot;title&quot;]) for k, v in data.items()][:10])
</code></pre>
<p>Successful command: <code>uv run test_uv/demo.py </code>
Failed command: <code>uv run --python 3.10 test_uv/demo.py</code></p>
<p>Successful Output:</p>
<pre><code>3.8.10 (default, Nov 22 2023, 10:22:35) 
[GCC 9.4.0]
Rich Version:  13.7.1
[
│   ('1', 'PEP Purpose and Guidelines'),
│   ('2', 'Procedure for Adding New Modules'),
│   ('3', 'Guidelines for Handling Bug Reports'),
│   ('4', 'Deprecation of Standard Modules'),
│   ('5', 'Guidelines for Language Evolution'),
│   ('6', 'Bug Fix Releases'),
│   ('7', 'Style Guide for C Code'),
│   ('8', 'Style Guide for Python Code'),
│   ('9', 'Sample Plaintext PEP Template'),
│   ('10', 'Voting Guidelines')
]
</code></pre>
<p>Failed Output:</p>
<pre><code>Traceback (most recent call last):
  File &quot;/home/hanqi/code/test_search/test_uv/demo.py&quot;, line 2, in &lt;module&gt;
    from rich.pretty import pprint
ModuleNotFoundError: No module named 'rich'
</code></pre>
<p>I had to do <code>uv run --with rich --with requests --python 3.10 test_uv/demo.py</code>
to get</p>
<pre><code>3.10.14 (main, Apr  6 2024, 18:45:05) [GCC 9.4.0]
Rich Version:  13.8.1
[
│   ('1', 'PEP Purpose and Guidelines'),
│   ('2', 'Procedure for Adding New Modules'),
│   ('3', 'Guidelines for Handling Bug Reports'),
│   ('4', 'Deprecation of Standard Modules'),
│   ('5', 'Guidelines for Language Evolution'),
│   ('6', 'Bug Fix Releases'),
│   ('7', 'Style Guide for C Code'),
│   ('8', 'Style Guide for Python Code'),
│   ('9', 'Sample Plaintext PEP Template'),
│   ('10', 'Voting Guidelines')
]
</code></pre>
<hr />
<p><strong>Questions</strong></p>
<ol>
<li>Why does adding --python make uv stop creating temporary vm with all requirements automatically installed?</li>
<li>My <code>demo.py</code> has no  <code># /// script</code> section so how did <code>uv run</code> even work without --with in the 1st success case?</li>
<li>Why was the default python used by <code>uv run</code> 3.8.10?</li>
</ol>
<ul>
<li>I read https://docs.astral.sh/uv/concepts/python-versions/#discovery-of-python-versions but have trouble mapping 3.8.10 to 1 of the 3 bullet points. Is that the right place to look? I see <code>uv python find</code> returns <code>/usr/bin/python3</code> and <code>/usr/bin/python3 -V</code> is <code>Python 3.8.10</code></li>
</ul>
<p>Here is <code>uv python list --only-installed</code>:</p>
<pre><code>cpython-3.13.0rc2-linux-x86_64-gnu    /home/hanqi/.local/share/uv/python/cpython-3.13.0rc2-linux-x86_64-gnu/bin/python3 -&gt; python3.13
cpython-3.10.14-linux-x86_64-gnu      /usr/bin/python3.10
cpython-3.10.14-linux-x86_64-gnu      /usr/bin/python -&gt; /etc/alternatives/python
cpython-3.10.14-linux-x86_64-gnu      /bin/python3.10
cpython-3.10.14-linux-x86_64-gnu      /bin/python -&gt; /etc/alternatives/python
cpython-3.8.10-linux-x86_64-gnu       /usr/bin/python3.8
cpython-3.8.10-linux-x86_64-gnu       /usr/bin/python3 -&gt; python3.8
cpython-3.8.10-linux-x86_64-gnu       /bin/python3.8
cpython-3.8.10-linux-x86_64-gnu       /bin/python3 -&gt; python3.8
</code></pre>
<p>uv platform: WSL2
uv version: uv 0.4.15</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-27 12:29</div>
            <div class="timeline-body"><p>If you do <code>uv run --python 3.10 test_uv/demo.py</code>, we likely had to create a virtual environment to satisfy that Python version, but there's nothing telling us to install those dependencies, so they're not present. The first case may have succeeded as <code>uv run</code> will use the <code>.venv</code> in the current directory by default. Perhaps it contained those dependencies already.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-09-27 12:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-28 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-09-28 19:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:27:22 UTC
    </footer>
</body>
</html>
