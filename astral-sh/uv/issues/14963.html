<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommended way to use a workspace containing dependent subpackages with AWS Lambda - astral-sh/uv #14963</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Recommended way to use a workspace containing dependent subpackages with AWS Lambda</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/14963">#14963</a>
        opened by <a href="https://github.com/bradenkinard-sh">@bradenkinard-sh</a>
        on 2025-07-29 21:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bradenkinard-sh">@bradenkinard-sh</a></div>
            <div class="timeline-body">Question
<p>I&#x27;m working on a monorepo using a workspace that I am deploying to AWS Lambda. I have been following the <a href="https://docs.astral.sh/uv/guides/integration/aws-lambda/#workspace-support">documentation here</a>, modified to have a <code>packages/</code> directory with sub-packages <code>package-a</code> and <code>package-b</code>, giving me a project structure that looks like this:</p>
<pre><code>.
├── app
│   ├── __init__.py
│   └── main.py
├── Dockerfile
├── packages
│   ├── package_a
│   │   ├── pyproject.toml
│   │   └── src
│   │       └── package_a
│   │           ├── __init__.py
│   │           └── py.typed
│   └── package_b
│       ├── pyproject.toml
│       └── src
│           └── package_b
│               ├── __init__.py
│               └── py.typed
├── pyproject.toml
└── uv.lock
</code></pre>
<p>I&#x27;ve modified the relevant target line in the Dockerfile to target the <code>packages/</code> directory:</p>
<pre><code># Dockerfile
...

RUN --mount=from=uv,source=/uv,target=/bin/uv \
    --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    --mount=type=bind,source=packages,target=packages \  # target is the packages directory
    uv export --frozen --no-dev --no-editable -o requirements.txt &amp;&amp; \
    uv pip install -r requirements.txt --target &quot;${LAMBDA_TASK_ROOT}&quot;

...
</code></pre>
<p>When <code>package-a</code> and <code>package-b</code> are independent of each other, this seems to work fine. However, if <code>package-a</code> is a dependency of <code>package-b</code>, <code>package-a</code> is no longer discoverable as a module within the container, even though <code>package-b</code> is. Looking inside the container, <code>package_a-0.1.0.dist-info</code> exists, as does <code>package_b</code> and <code>package_b-0.1.0.dist-info</code>, but <code>package_a</code> is missing. Removing <code>package-a</code> as a dependency of <code>package-b</code> resolves the issue and both packages seem to be properly installed.</p>
<p>I&#x27;m assuming I am improperly handling how I specify the target in the Dockerfile (or perhaps in my configuration of the packages themselves), but its unclear to me how to make it so that all subpackages in the <code>package/</code> are properly installed and available within the container, regardless of their dependencies.</p>
<p>For full reproducibility I&#x27;ve included a simplified project <a href="https://github.com/bradenkinard-sh/uv-aws-lambda-example">example here</a>.</p>
Platform
<p>macOS 15.5 Darwin 24.5.0 arm64</p>
Version
<p>uv 0.7.13 (Homebrew 2025-06-12)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/bradenkinard-sh">@bradenkinard-sh</a> on 2025-07-29 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-29 23:23</div>
            <div class="timeline-body"><p>We&#x27;re reading workspace sources from the <code>pyproject.toml</code> during the <code>uv pip install</code> invocation and your package is installed as editable.</p>
<p>The following resolves the issue:</p>
<pre><code>diff --git a/Dockerfile b/Dockerfile
index c287134..a54024e 100644
--- a/Dockerfile
+++ b/Dockerfile
@@ -35,7 +35,7 @@ RUN --mount=from=uv,source=/uv,target=/bin/uv \
     --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
     --mount=type=bind,source=packages,target=packages \
     uv export --frozen --no-dev --no-editable -o requirements.txt &amp;&amp; \
-    uv pip install -r requirements.txt --target &quot;${LAMBDA_TASK_ROOT}&quot;
+    uv pip install --no-sources -r requirements.txt --target &quot;${LAMBDA_TASK_ROOT}&quot;
 
 FROM public.ecr.aws/lambda/python:3.13
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-29 23:24</div>
            <div class="timeline-body"><p>This was also reported in</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/14617</li>
<li>https://github.com/astral-sh/uv/issues/5631</li>
</ul>
<p>It&#x27;s plausible we need to change something here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-29 23:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bradenkinard-sh">@bradenkinard-sh</a> on 2025-07-31 14:00</div>
            <div class="timeline-body"><p>That fixes the problem, thank you!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:45 UTC
    </footer>
</body>
</html>
