```yaml
number: 4567
title: "Allow updating sources with `uv add`"
type: issue
state: closed
author: ibraheemdev
labels:
  - enhancement
  - good first issue
  - help wanted
assignees: []
created_at: 2024-06-26T21:25:04Z
updated_at: 2025-04-21T02:58:39Z
url: https://github.com/astral-sh/uv/issues/4567
synced_at: 2026-01-10T01:57:10Z
```

# Allow updating sources with `uv add`

---

_Issue opened by @ibraheemdev on 2024-06-26 21:25_

Follow up to https://github.com/astral-sh/uv/pull/4566, `uv add git+https://..foo` followed by `uv add foo --branch foo` should work as expected. Currently it errors. `cargo add` supports this.

---

_Label `preview` added by @ibraheemdev on 2024-06-26 21:25_

---

_Label `enhancement` added by @ibraheemdev on 2024-06-28 16:50_

---

_Label `good first issue` added by @charliermarsh on 2024-07-29 01:12_

---

_Label `help wanted` added by @charliermarsh on 2024-07-29 01:12_

---

_Label `preview` removed by @zanieb on 2024-08-20 18:22_

---

_Comment by @marcvanheerden on 2024-08-29 11:11_

can I try this one?

---

_Comment by @zanieb on 2024-08-29 16:30_

@marcvanheerden feel free!

---

_Comment by @marcvanheerden on 2024-08-30 11:24_

@ibraheemdev , just want to clarify the task for this, is this the error we want to fix?
![Screenshot 2024-08-30 at 13 21 21](https://github.com/user-attachments/assets/225c401e-e714-40eb-a0f1-d9ec10d190e8)

I tested a similar example on cargo stable and nightly and this doesn't appear to work on cargo.
![Screenshot 2024-08-30 at 13 24 03](https://github.com/user-attachments/assets/abba2374-c5fe-491c-b6d0-8647e27555c0)

Let me know if I misunderstood

---

_Comment by @Aditya-PS-05 on 2024-10-25 05:42_

Is this issue solved. Can I try?

---

_Comment by @sofubi on 2024-11-13 02:35_

I gave this a look and am not sure that this is actually an issue.

To test I:
- created a new project with `uv init`
- ran `uv add git+https://github.com/psf/requests` which successfully adds `requests` with git source
- ran `uv add git+https://github.com/psf/requests --branch consider_certs` which successfully updates the package's source info

See below for the diff of my `pyproject.toml` from the first and second commands. 

```diff
diff --git a/pyproject.toml b/pyproject.toml
index 3f64dba..b180aa3 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -2,11 +2,11 @@
 name = "updating-git-branches"
 version = "0.1.0"
 description = "Add your description here"
 readme = "README.md"
 requires-python = ">=3.12"
 dependencies = [
     "requests",
 ]
 
 [tool.uv.sources]
-requests = { git = "https://github.com/psf/requests" }
+requests = { git = "https://github.com/psf/requests", branch = "consider_certs" }

```

The following does not work (and seems expected):

```sh
> uv add git+https://github.com/psf/requests
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.17s
     Running `/Users/sofubi/Projects/contributing/uv/target/debug/uv add 'git+https://github.com/psf/requests'`
 Updated https://github.com/psf/requests (23540c93)
Resolved 6 packages in 14ms
Installed 5 packages in 10ms
 + certifi==2024.8.30
 + charset-normalizer==3.4.0
 + idna==3.10
 + requests==2.32.3 (from git+https://github.com/psf/requests@23540c93cac97c763fe59e843a08fa2825aa80fd)
 + urllib3==2.2.3

> uv add requests --branch consider_certs
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.44s
     Running `/Users/sofubi/Projects/contributing/uv/target/debug/uv add requests --branch consider_certs`
error: `requests` did not resolve to a Git repository, but a Git reference (`--branch consider_certs`) was provided.
```

I looked at the `uv add --help` info and it specifically says that `--branch` is meant to be used when adding a package from git. The cargo functionality similarly appears to expect `--branch` to be used only when `--git` is used.

```sh
Options:
  -r, --requirements <REQUIREMENTS>  Add all packages listed in the given `requirements.txt` files
      --dev                          Add the requirements to the development dependency group
      --optional <OPTIONAL>          Add the requirements to the package\'s optional dependencies for the specified extra
      --group <GROUP>                Add the requirements to the specified dependency group
      --editable                     Add the requirements as editable
      --raw-sources                  Add source requirements to `project.dependencies`, rather than `tool.uv.sources`
      --rev <REV>                    Commit to use when adding a dependency from Git
      --tag <TAG>                    Tag to use when adding a dependency from Git

      --branch <BRANCH>              Branch to use when adding a dependency from Git

      --extra <EXTRA>                Extras to enable for the dependency
      --no-sync                      Avoid syncing the virtual environment [env: UV_NO_SYNC=]
      --locked                       Assert that the `uv.lock` will remain unchanged [env: UV_LOCKED=]
      --frozen                       Add dependencies without re-locking the project [env: UV_FROZEN=]
      --package <PACKAGE>            Add the dependency to a specific package in the workspace
      --script <SCRIPT>              Add the dependency to the specified Python script, rather than to a project
```

If it's expected that `uv add requests --branch consider_certs` should add the branch to the existing package source then I'd be a little confused as that would really prevent users from being able to move away from using a git source and go to using something like PyPI.

---

_Referenced in [astral-sh/uv#12897](../../astral-sh/uv/pulls/12897.md) on 2025-04-15 12:57_

---

_Comment by @maxmynter on 2025-04-15 13:01_

I understand the issue in the sense that we would like to support not using the full Git url but just the package name and if a git option (like `--branch main`) is provided we fallback onto an existing one (if it exists) instead of erroring. 

I've proposed an implementation to achieve this in #12897 

---

_Closed by @charliermarsh on 2025-04-21 02:58_

---

_Closed by @charliermarsh on 2025-04-21 02:58_

---
