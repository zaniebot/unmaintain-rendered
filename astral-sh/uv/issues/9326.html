<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`~` Tildes in environment variables not expanded before use - astral-sh/uv #9326</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>~</code> Tildes in environment variables not expanded before use</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9326">#9326</a>
        opened by <a href="https://github.com/fynnsu">@fynnsu</a>
        on 2024-11-21 15:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/fynnsu">@fynnsu</a> on 2024-11-21 15:58</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<pre><code class="language-bash">export UV_CACHE_DIR=&quot;~/uv_cache&quot;
# Use uv
uv venv
uv pip install numpy
</code></pre>
<p>Will produce a subfolder <code>'~'</code> with <code>'uv_cache'</code> in it instead of expanding to <code>/home/user/uv_cache</code> when used.</p>
<p>Note: Since shells will often expand the tildes themselves this may not often be a problem. In the above example, using <code>export UV_CACHE_DIR=~/uv_cache</code> (without the &quot;&quot;), works as my shell expands the <code>~</code> before setting the env variable.</p>
<p>I ran into this issue because I was trying to use <code>astral-sh/setup-uv</code> with <code>cache-local-path: ~/.uv_cache</code> which then is used to set <code>UV_CACHE_DIR</code>. Unfortunately here, whether I include the &quot;&quot; or not, the env variable gets set with the <code>~</code> giving me the wrong cache dir.</p>
<p>I think it would be useful to support <code>~</code> at the start of paths for <code>UV_CACHE_DIR</code> and other similar path environment variables (untested but I'm guessing they have the same limitation).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fynnsu">@fynnsu</a> on 2024-11-21 16:31</div>
            <div class="timeline-body"><p>This is potentially related to #9327.
Doing something similar with env variables</p>
<pre><code class="language-bash">export UV_CACHE_DIR=/home/user/path/../path/cache
uv venv
</code></pre>
<p>results in</p>
<pre><code>error: failed to create directory `/home/user/path/../path/cache`
  Caused by: Operation not supported (os error 45)
</code></pre>
<p>Ideally there would be path resolution on all paths provided by the user (env variables, configuration files, cli args)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-21 16:58</div>
            <div class="timeline-body"><p>I don't think I agree that we should expand this <code>~</code> in inputs, I don't think that's standard for most tools? As a simple example,<code>gh</code> clones into a <code>~</code> directory in the current folder:</p>
<pre><code>$ gh repo clone zanieb/uv &quot;~/test&quot;
$ tree . -L 2
.
└── ~
    └── test
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-21 16:58</div>
            <div class="timeline-body"><p>I do think <code>astral-sh/setup-uv</code> should expand the <code>~</code> though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 16:58</div>
            <div class="timeline-body"><p>Yeah I don't think Cargo does that either. Maybe the GitHub Action should be expanding it though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fynnsu">@fynnsu</a> on 2024-11-21 17:32</div>
            <div class="timeline-body"><p>Okay I will open an issue in <code>astral-sh</code> for this. Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @fynnsu on 2024-11-21 17:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:49 UTC
    </footer>
</body>
</html>
