<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add incremental resolution benchmark to codspeed - astral-sh/uv #6418</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add incremental resolution benchmark to codspeed</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6418">#6418</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-08-22 09:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>There are three scenarios for the uv resolver:</p>
<ul>
<li>Fresh resolution: We have a set of requirements, but no lockfile. We need to figure a resolution without any prior context. These are continuously tested by <code>resolve_warm_airflow</code>, <code>resolve_warm_jupyter</code> and <code>resolve_warm_jupyter_universal</code>.</li>
<li>Incremental resolution: We have a lockfile that gives us preferences for versions (and help prefetching), but it's incompatible or incomplete with the requirements. This happens in a lot of cases, e.g. when <code>pyproject.toml</code> changed due to a version upgrade, with <code>uv lock --upgrade-package</code> or when using <code>uv run --with</code>. Our goal is to resolve versions that preserve most of the existing lockfile.</li>
<li>We run <code>uv lock</code> and the lockfile matches: We only need to check against <code>package.metadata.requires-dist</code>.</li>
</ul>
<p>While we have good coverage for the first case and the last case is fast beyond the need for optimization (&lt;20ms even for transformers with all extras), we don't have good coverage for the middle case. We should add a scenario to codspeed, with a universal resolution where the requirements changes so that they don't  match <code>uv.lock</code> anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @konstin on 2024-08-22 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @konstin on 2024-08-22 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LoukasPap">@LoukasPap</a> on 2026-01-08 21:59</div>
            <div class="timeline-body"><p>@konstin Is this issue still open to work on? Probably, I am going to need to ask some questions on the way to understand it fully right.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-09 10:48</div>
            <div class="timeline-body"><p>Yes this is still open, though I can only give limited guidance to implementing it.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:21 UTC
    </footer>
</body>
</html>
