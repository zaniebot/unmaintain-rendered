<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Error]stream did not contain valid UTF-8 - astral-sh/uv #8009</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>[Error]stream did not contain valid UTF-8</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8009">#8009</a>
        opened by <a href="https://github.com/sdbds">@sdbds</a>
        on 2024-10-08 16:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sdbds">@sdbds</a> on 2024-10-08 16:42</div>
            <div class="timeline-body"><p>#7726</p>
<p>command: uv pip install crcmod==1.7
platform:windows
version:uv 0.4.19 (a451fb685 2024-10-07)</p>
<pre><code>error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: crcmod==1.7
  Caused by: Failed to run `C:\Users\QINGLO~1\AppData\Local\Temp\.tmpSyOjmr\builds-v0\.tmps5aMOw\Scripts\python.exe`
  Caused by: stream did not contain valid UTF-8
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-10-08 16:49</div>
            <div class="timeline-body"><p>Can you share the output of running <code>chcp</code>? That should print the codepage you're using.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @konstin on 2024-10-08 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-08 16:51</div>
            <div class="timeline-body"><p>Additionally, which terminal/shell are you using? I couldn't reproduce this on my windows machine (german locale, codepage 850, powershell)</p>
<p>Note crcmod==1.7 was published in 2010 and is only tested up to Python 3.1.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sdbds">@sdbds</a> on 2024-10-08 17:02</div>
            <div class="timeline-body"><blockquote>
<p>Can you share the output of running <code>chcp</code>? That should print the codepage you're using.</p>
</blockquote>
<blockquote>
<p>Additionally, which terminal/shell are you using? I couldn't reproduce this on my windows machine (german locale, codepage 850, powershell)</p>
<p>Note crcmod==1.7 was published in 2010 and is only tested up to Python 3.1.</p>
</blockquote>
<p>Chinese locale, codepage 936, powershell 7.4.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sdbds">@sdbds</a> on 2024-10-08 17:47</div>
            <div class="timeline-body"><p>crcmod==1.7
# via oss2
oss2==2.19.0
# via funasr
funasr==1.1.5
# via fish-speech (./pyproject.toml)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kahojyun">@kahojyun</a> on 2024-10-09 02:20</div>
            <div class="timeline-body"><p>Please try install with <code>pip install -v --no-cache-dir crcmod==1.7</code> and <code>uv pip install -vv -n crdmod==1.7</code>. It should print the output of build script like:</p>
<pre><code>❯ .venv\Scripts\pip.exe install --no-cache-dir -v crcmod==1.7
Using pip 24.2 from E:\tt\.venv\lib\site-packages\pip (python 3.8)
Collecting crcmod==1.7
  Downloading crcmod-1.7.tar.gz (89 kB)
  Running command python setup.py egg_info
  Preparing metadata (setup.py) ... done
Building wheels for collected packages: crcmod
  Running command python setup.py bdist_wheel
  _crcfunext.c
     Creating library build\temp.win-amd64-cpython-38\Release\python3\src\_crcfunext.cp38-win_amd64.lib and object build\temp.win-amd64-cpython-38\Release\python3\src\_crcfunext.cp38-win_amd64.exp
  Generating code
  Finished generating code
  E:\tt\.venv\lib\site-packages\setuptools\_distutils\cmd.py:66: SetuptoolsDeprecationWarning: setup.py install is deprecated.
  !!

          ********************************************************************************
          Please avoid running ``setup.py`` directly.
          Instead, use pypa/build, pypa/installer or other
          standards-based tools.

          See https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html for details.
          ********************************************************************************

  !!
    self.initialize_options()
  E:\tt\.venv\lib\site-packages\setuptools\command\bdist_wheel.py:115: RuntimeWarning: Config variable 'Py_DEBUG' is unset, Python ABI tag may be incorrect
    if get_flag(&quot;Py_DEBUG&quot;, hasattr(sys, &quot;gettotalrefcount&quot;), warn=(impl == &quot;cp&quot;)):
  Building wheel for crcmod (setup.py) ... done
  Created wheel for crcmod: filename=crcmod-1.7-cp38-cp38-win_amd64.whl size=25415 sha256=777a3c9daadf2c05407249df3af462e8da226d1099a33f1f34328c1238e164e1
  Stored in directory: C:\Users\kahoj\AppData\Local\Temp\pip-ephem-wheel-cache-5cky5nzg\wheels\ca\5a\02\f3acf982a026f3319fb3e798a8dca2d48fafee7761788562e9
Successfully built crcmod
Installing collected packages: crcmod
Successfully installed crcmod-1.7
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sdbds">@sdbds</a> on 2024-10-09 08:30</div>
            <div class="timeline-body"><blockquote>
<p>Please try install with <code>pip install -v --no-cache-dir crcmod==1.7</code> and <code>uv pip install -vv -n crdmod==1.7</code>. It should print the output of build script like:</p>
<pre><code>❯ .venv\Scripts\pip.exe install --no-cache-dir -v crcmod==1.7
Using pip 24.2 from E:\tt\.venv\lib\site-packages\pip (python 3.8)
Collecting crcmod==1.7
  Downloading crcmod-1.7.tar.gz (89 kB)
  Running command python setup.py egg_info
  Preparing metadata (setup.py) ... done
Building wheels for collected packages: crcmod
  Running command python setup.py bdist_wheel
  _crcfunext.c
     Creating library build\temp.win-amd64-cpython-38\Release\python3\src\_crcfunext.cp38-win_amd64.lib and object build\temp.win-amd64-cpython-38\Release\python3\src\_crcfunext.cp38-win_amd64.exp
  Generating code
  Finished generating code
  E:\tt\.venv\lib\site-packages\setuptools\_distutils\cmd.py:66: SetuptoolsDeprecationWarning: setup.py install is deprecated.
  !!

          ********************************************************************************
          Please avoid running ``setup.py`` directly.
          Instead, use pypa/build, pypa/installer or other
          standards-based tools.

          See https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html for details.
          ********************************************************************************

  !!
    self.initialize_options()
  E:\tt\.venv\lib\site-packages\setuptools\command\bdist_wheel.py:115: RuntimeWarning: Config variable 'Py_DEBUG' is unset, Python ABI tag may be incorrect
    if get_flag(&quot;Py_DEBUG&quot;, hasattr(sys, &quot;gettotalrefcount&quot;), warn=(impl == &quot;cp&quot;)):
  Building wheel for crcmod (setup.py) ... done
  Created wheel for crcmod: filename=crcmod-1.7-cp38-cp38-win_amd64.whl size=25415 sha256=777a3c9daadf2c05407249df3af462e8da226d1099a33f1f34328c1238e164e1
  Stored in directory: C:\Users\kahoj\AppData\Local\Temp\pip-ephem-wheel-cache-5cky5nzg\wheels\ca\5a\02\f3acf982a026f3319fb3e798a8dca2d48fafee7761788562e9
Successfully built crcmod
Installing collected packages: crcmod
Successfully installed crcmod-1.7
</code></pre>
</blockquote>
<pre><code>pip install -v --no-cache-dir crcmod==1.7
Using pip 23.3.1 from E:\Python310\lib\site-packages\pip (python 3.10)
Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple, https://pypi.ngc.nvidia.com
Requirement already satisfied: crcmod==1.7 in e:\python310\lib\site-packages (1.7)
</code></pre>
<pre><code>uv pip install -vv -n crdmod==1.7
    0.001468s DEBUG uv uv 0.4.19
 uv_requirements::specification::from_source source=crdmod==1.7
    0.003947s DEBUG uv_python::discovery Searching for default Python interpreter in system path or `py` launcher
    0.157329s DEBUG uv_python::discovery Found `cpython-3.10.11-windows-x86_64-none` at `E:\Code\fish-speech-for-windows\.venv\Scripts\python.exe` (active virtual environment)
    0.158000s DEBUG uv::commands::pip::operations Using Python 3.10.11 environment at .venv
    0.158378s DEBUG uv_fs Acquired lock for `.venv`
    0.170668s DEBUG uv::commands::pip::install At least one requirement is not satisfied: crdmod==1.7
 uv_client::linehaul::linehaul
    0.171926s DEBUG uv_client::base_client Using request timeout of 30s
 uv_resolver::flat_index::from_entries
 uv_resolver::resolver::solve
    0.173051s   0ms DEBUG uv_resolver::resolver Solving with installed Python version: 3.10.11
    0.173136s   0ms DEBUG uv_resolver::resolver Solving with target Python version: &gt;=3.10.11
   uv_resolver::resolver::choose_version package=root
   uv_resolver::resolver::get_dependencies_forking package=root, version=0a0.dev0
     uv_resolver::resolver::get_dependencies package=root, version=0a0.dev0
    0.173560s   0ms DEBUG uv_resolver::resolver Adding direct dependency: crdmod==1.7
   uv_resolver::resolver::choose_version package=crdmod
 uv_resolver::resolver::process_request request=Versions crdmod
   uv_client::registry_client::simple_api package=crdmod
     uv_client::cached_client::get_cacheable
       uv_client::cached_client::read_and_parse_cache file=C:\Users\QINGLO~1\AppData\Local\Temp\.tmpSrw8eN\simple-v13\pypi\crdmod.rkyv
 uv_resolver::resolver::process_request request=Prefetch crdmod ==1.7
 uv_client::cached_client::from_path_sync path=&quot;C:\\Users\\QINGLO~1\\AppData\\Local\\Temp\\.tmpSrw8eN\\simple-v13\\pypi\\crdmod.rkyv&quot;
        0.174370s   0ms DEBUG uv_client::cached_client No cache entry for: https://pypi.org/simple/crdmod/
       uv_client::cached_client::fresh_request url=&quot;https://pypi.org/simple/crdmod/&quot;
      0.342466s 168ms DEBUG uv_resolver::resolver Searching for a compatible version of crdmod (==1.7)
    0.342615s 169ms DEBUG uv_resolver::resolver No compatible version found for: crdmod
  × No solution found when resolving dependencies:
  ╰─▶ Because crdmod was not found in the package registry and you require crdmod==1.7, we can conclude that your
      requirements are unsatisfiable.
    0.343650s DEBUG uv_fs Released lock at `E:\Code\fish-speech-for-windows\.venv\.lock`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7549.html">astral-sh/uv#7549</a> on 2024-10-11 03:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8120.html">astral-sh/uv#8120</a> on 2024-10-11 04:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kahojyun">@kahojyun</a> on 2024-10-11 12:57</div>
            <div class="timeline-body"><p>I think the non-UTF8 bytes come from the MSVC compiler output. It seems that the output of the compiler bypasses the <code>PYTHONIOENCODING</code> setting and writes directly to <code>stdout</code>/<code>stderr</code> using system default encoding.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-10-11 13:10</div>
            <div class="timeline-body"><p>@sdbds With #8120 merged, when the next release comes out, could you let us know whether this issue is resolved or not? Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8084.html">astral-sh/uv#8084</a> on 2024-10-11 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Super1Windcloud">@Super1Windcloud</a> on 2024-10-11 15:15</div>
            <div class="timeline-body"><blockquote>
<p>I think the non-UTF8 bytes come from the MSVC compiler output. It seems that the output of the compiler bypasses the <code>PYTHONIOENCODING</code> setting and writes directly to <code>stdout</code>/<code>stderr</code> using system default encoding.我认为非 UTF8 字节来自 MSVC 编译器输出。编译器的输出似乎绕过了<code>PYTHONIOENCODING</code>设置并使用系统默认编码直接写入<code>stdout</code> / <code>stderr</code> 。</p>
<h1>very    nice , how  do you  find   this reason ?</h1>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sdbds">@sdbds</a> on 2024-10-12 11:12</div>
            <div class="timeline-body"><blockquote>
<p>@sdbds With #8120 merged, when the next release comes out, could you let us know whether this issue is resolved or not? Thanks!</p>
</blockquote>
<p>I need to check lastest release version for this because my environment dont have rust...
wait for fixing version for python wheel.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @konstin on 2024-10-12 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-10-12 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-12 18:36</div>
            <div class="timeline-body"><p>I'm going to close this since #8120 is merged. Please report if the next release still doesn't work, we'll reopen and try to find and another solution in that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-10-12 18:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:22 UTC
    </footer>
</body>
</html>
