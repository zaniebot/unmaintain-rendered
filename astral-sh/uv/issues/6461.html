<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: Allow script dependency inline with file docstring - astral-sh/uv #6461</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: Allow script dependency inline with file docstring</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6461">#6461</a>
        opened by <a href="https://github.com/aaronsteers">@aaronsteers</a>
        on 2024-08-22 20:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aaronsteers">@aaronsteers</a></div>
            <div class="timeline-body"><p>I am thrilled about <code>uv</code> and have been testing it with custom scripts.</p>
<p>One small ergonomics issue I ran into is the competing placement of a file-level docstring with the inline metadata. I think it could be cleaner to allow <code>///script</code> elements to exist inside the file-level docstring.</p>
<p>Today I have this:</p>
<pre><code>&quot;&quot;&quot;Simple script to download secrets from GCS.

Usage:
    pipx install uv
    uv run scripts/fetch_test_secrets.py
&quot;&quot;&quot;
# Inline dependency metadata for `uv`:
# /// script
# requires-python = &quot;==3.10&quot;
# dependencies = [
#     &quot;airbyte&quot;,  # PyAirbyte
# ]
# ///

from __future__ import annotations

...
</code></pre>
<p>But I would love to be collapse the dependency declarations into the docstring like this:</p>
<pre><code>&quot;&quot;&quot;Simple script to download secrets from GCS.

Usage:
    pipx install uv
    uv run scripts/fetch_test_secrets.py

Inline dependency metadata for `uv`:

/// script
requires-python = &quot;==3.10&quot;
dependencies = [
    &quot;airbyte&quot;,  # PyAirbyte
]
///
&quot;&quot;&quot;

from __future__ import annotations

...
</code></pre>
<p>Or using a markdown triple-backtick block like this:</p>
<pre><code>&quot;&quot;&quot;Simple script to download secrets from GCS.

Usage:
    pipx install uv
    uv run scripts/fetch_test_secrets.py

Inline dependency metadata for `uv`:

```toml-uv-script
requires-python = &quot;==3.10&quot;
dependencies = [
    &quot;airbyte&quot;,  # PyAirbyte
]
```
&quot;&quot;&quot;

from __future__ import annotations

...
</code></pre>
<p>Thanks for considering! And thanks for all your work on this project!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 20:41</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>The use of <code># /// script</code> is actually codified in a standard (<a href="https://peps.python.org/pep-0723/">PEP 723</a>), so we don&#x27;t have control over the structure in that way, since it needs to be interoperable with other tools (e.g., maybe you&#x27;re using Ruff, and want to put your Ruff configuration for the file in that block).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aaronsteers">@aaronsteers</a> on 2024-08-22 21:29</div>
            <div class="timeline-body"><p>@charliermarsh - Thanks for your reply. After reviewing PEP 723 more closely (I only glanced at it previously), I see what you mean.</p>
<p>A compromise I found below is a middle-ground that I find cleaner (at least slightly) - and my testing confirmed it still works! Feels weird to have comments inside a docstring block, but it doesn&#x27;t violate the PEP and <code>uv</code> handles is just fine. ðŸ™Œ</p>
<pre><code>&quot;&quot;&quot;Simple script to download secrets from GCS.

Usage:
    pipx install uv
    uv run scripts/fetch_test_secrets.py

Inline dependency metadata for `uv`:

# /// script
# requires-python = &quot;==3.10&quot;
# dependencies = [
#     &quot;airbyte&quot;,  # PyAirbyte
# ]
# ///

&quot;&quot;&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aaronsteers">@aaronsteers</a> on 2024-08-22 21:30</div>
            <div class="timeline-body"><p>Thanks again for your help - closing as resolved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/aaronsteers">@aaronsteers</a> on 2024-08-22 21:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 21:30</div>
            <div class="timeline-body"><p>Oh, that&#x27;s true! Thanks for following up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-22 21:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:33:06 UTC
    </footer>
</body>
</html>
