<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency resolution failure on transitive Git build-system requirement - astral-sh/uv #11760</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Dependency resolution failure on transitive Git build-system requirement</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11760">#11760</a>
        opened by <a href="https://github.com/astoeckel-abr">@astoeckel-abr</a>
        on 2025-02-24 22:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/astoeckel-abr">@astoeckel-abr</a></div>
            <div class="timeline-body">Summary
<p>Consider a collection of three projects:</p>
<ul>
<li><code>my-build-plugin</code></li>
<li><code>my-foo-lib</code></li>
<li><code>my-foo-app</code></li>
</ul>
<p><code>my-build-plugin</code> is a plugin for setuptools. It is included in <code>pyproject.toml</code> of <code>my-foo-lib</code> through <code>build-system.requires</code>:</p>
<pre><code>[build-system]
requires = [&quot;setuptools&quot;, &quot;my-build-plugin&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = &quot;my-foo-lib&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;&gt;=3.10&quot;

[tool.uv.sources]
my-build-plugin = { git = &quot;&lt;GIT URL&gt;&quot;, subdirectory = &quot;my_build_plugin&quot;, rev = &quot;&lt;GIT REV&gt;&quot; }
</code></pre>
<p>Building the library via</p>
<pre><code>uv build .
</code></pre>
<p>works fine; <code>my-build-plugin</code> is automatically checked out as part of the build.</p>
<p>Now, in <code>my-foo-app</code>, transitively include <code>my-build-plugin</code> by depending on <code>my-foo-lib</code>. <code>pyproject.toml</code>:</p>
<pre><code>[build-system]
requires = [&quot;setuptools&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = &quot;my-foo-app&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [&quot;my-foo-lib&quot;]

[tool.uv.sources]
my-foo-lib = { git = &quot;&lt;GIT URL&gt;&quot;, subdirectory=&quot;my_foo_lib&quot;, rev = &quot;&lt;GIT REV&gt;&quot;}
</code></pre>
<p>Executing <code>uv run</code> in this project results in the following error:</p>
<pre><code>  × Failed to download and build `my-foo-lib @ git+file:///home/astoecke/tmp/uv_build_deps_bug@e64efd7717c64a29adab738cf30d069255e08d87#subdirectory=my_foo_library`
  ├─▶ Failed to resolve requirements from `build-system.requires`
  ├─▶ No solution found when resolving: `setuptools`, `my-build-plugin`
  ╰─▶ Because my-build-plugin was not found in the package registry and you require my-build-plugin, we can conclude that your requirements are unsatisfiable.
  help: `my-foo-lib` was included because `my-foo-app` (v1.0.0) depends on `my-foo-lib`
</code></pre>
<p>So, for some reason, <code>uv</code> does not seem to do a Git checkout for <code>my-build-plugin</code>, when including <code>my-foo-lib</code> as a dependency, even though it does so when building <code>my-foo-lib</code> directly.</p>
<hr>
<p>Script to re-create the test setup (tested on Linux; <code>readlink -e</code> is a GNU extension):</p>
<pre><code>#!/usr/bin/env bash

mkdir -p uv_build_dep_bug/my_build_plugin uv_build_dep_bug/my_foo_lib uv_build_dep_bug/my_foo_app
cd uv_build_dep_bug
git init .

cat &gt;my_build_plugin/pyproject.toml &lt;&lt;EOL
[build-system]
requires = [&quot;setuptools&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = &quot;my-build-plugin&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = []
EOL

cat &gt;my_foo_lib/pyproject.toml &lt;&lt;EOL
[build-system]
requires = [&quot;setuptools&quot;, &quot;my-build-plugin&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = &quot;my-foo-lib&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;&gt;=3.10&quot;

[tool.uv.sources]
my-build-plugin = { git = &quot;&lt;GIT URL&gt;&quot;, subdirectory = &quot;my_build_plugin&quot;, rev = &quot;&lt;GIT REV&gt;&quot; }
EOL

cat &gt;my_foo_app/pyproject.toml &lt;&lt;EOL
[build-system]
requires = [&quot;setuptools&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = &quot;my-foo-app&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [&quot;my-foo-lib&quot;]

[tool.uv.sources]
my-foo-lib = { git = &quot;&lt;GIT URL&gt;&quot;, subdirectory = &quot;my_foo_lib&quot;, rev = &quot;&lt;GIT REV&gt;&quot; }
EOL


# Fill in the Git Repo URL and do an initial commit
sed -i -e &quot;s|&lt;GIT URL&gt;|file://&quot;$(readlink -e . )&quot;|&quot; my_foo_lib/pyproject.toml
sed -i -e &quot;s|&lt;GIT URL&gt;|file://&quot;$(readlink -e . )&quot;|&quot; my_foo_app/pyproject.toml
git add my_*/pyproject.toml
git commit -m &quot;Initial commit&quot;

# Fill in the Git revision for the build plugin dependency
sed -i -e &quot;s|&lt;GIT REV&gt;|&quot;$(git rev-parse HEAD )&quot;|&quot; my_foo_lib/pyproject.toml
git add my_foo_lib/pyproject.toml
git commit -m &quot;Fill in build plugin revision&quot;

# Now fill in the Git revision for the library dependency
sed -i -e &quot;s|&lt;GIT REV&gt;|&quot;$(git rev-parse HEAD )&quot;|&quot; my_foo_app/pyproject.toml
git add my_foo_app/pyproject.toml
git commit -m &quot;Fill in library revision&quot;


# echo &quot;Building my_build_plugin...&quot;
# cd my_build_plugin
# uv build .
# cd ..

# echo &quot;Building my_foo_lib...&quot;
# cd my_foo_lib
# uv build .
# cd ..

echo &quot;Running my_foo_app...&quot;
cd my_foo_app
uv run -v
cd ..
</code></pre>
<hr>
<p>Verbose output:</p>
<pre><code>DEBUG uv 0.6.2+41 (2ea1df1a1 2025-02-24)
DEBUG Found project root: `/home/astoecke/tmp/uv_build_dep_bug/my_foo_app`
DEBUG No workspace root found, using project root
DEBUG Discovered project `my-foo-app` at: /home/astoecke/tmp/uv_build_dep_bug/my_foo_app
DEBUG Acquired lock for `/home/astoecke/tmp/uv_build_dep_bug/my_foo_app`
DEBUG Using Python request `&gt;=3.10` from `requires-python` metadata
DEBUG Checking for Python environment at `.venv`
DEBUG Searching for Python &gt;=3.10 in managed installations or search path
DEBUG Found `cpython-3.13.2-linux-x86_64-gnu` at `/usr/bin/python3` (first executable in the search path)
Using CPython 3.13.2 interpreter at: /usr/bin/python3
Creating virtual environment at: .venv
DEBUG Using base executable for virtual environment: /usr/bin/python3
DEBUG Released lock at `/tmp/uv-2b4561dc1510f3a3.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: my-foo-app @ file:///home/astoecke/tmp/uv_build_dep_bug/my_foo_app
DEBUG No workspace root found, using project root
DEBUG Fetching source distribution from Git: file:///home/astoecke/tmp/uv_build_dep_bug
DEBUG Acquired lock for `file:///home/astoecke/tmp/uv_build_dep_bug`
DEBUG Updating Git source `file:///home/astoecke/tmp/uv_build_dep_bug`
   Updating file:///home/astoecke/tmp/uv_build_dep_bug (880944a06140429e23d55d7d5a23e18acd0eacbc)
DEBUG Performing a Git fetch for: file:///home/astoecke/tmp/uv_build_dep_bug
DEBUG Reset /home/astoecke/.cache/uv/git-v0/checkouts/4e23d374614cfb53/880944a to 880944a06140429e23d55d7d5a23e18acd0eacbc
    Updated file:///home/astoecke/tmp/uv_build_dep_bug (880944a06140429e23d55d7d5a23e18acd0eacbc)
DEBUG Released lock at `/home/astoecke/.cache/uv/git-v0/locks/4e23d374614cfb53`
DEBUG Acquired lock for `/home/astoecke/.cache/uv/sdists-v8/git/45c67979ae0c4d19/880944a06140429e`
DEBUG Found static `pyproject.toml` for: my-foo-lib @ git+file:///home/astoecke/tmp/uv_build_dep_bug@880944a06140429e23d55d7d5a23e18acd0eacbc#subdirectory=my_foo_lib
DEBUG No workspace root found, using project root
DEBUG Released lock at `/home/astoecke/.cache/uv/sdists-v8/git/45c67979ae0c4d19/880944a06140429e/.lock`
DEBUG Solving with installed Python version: 3.13.2
DEBUG Solving with target Python version: &gt;=3.10
DEBUG Adding direct dependency: my-foo-app*
DEBUG Searching for a compatible version of my-foo-app @ file:///home/astoecke/tmp/uv_build_dep_bug/my_foo_app (*)
DEBUG Adding direct dependency: my-foo-lib*
DEBUG Searching for a compatible version of my-foo-lib @ git+file:///home/astoecke/tmp/uv_build_dep_bug@880944a06140429e23d55d7d5a23e18acd0eacbc#subdirectory=my_foo_lib (*)
DEBUG Tried 2 versions: my-foo-app 1, my-foo-lib 1
DEBUG all marker environments resolution took 0.001s
Resolved 2 packages in 41ms
DEBUG Using request timeout of 30s
DEBUG Identified uncached distribution: my-foo-app @ file:///home/astoecke/tmp/uv_build_dep_bug/my_foo_app
DEBUG Identified uncached distribution: my-foo-lib @ git+file:///home/astoecke/tmp/uv_build_dep_bug@880944a06140429e23d55d7d5a23e18acd0eacbc#subdirectory=my_foo_lib
DEBUG Acquired lock for `/home/astoecke/.cache/uv/sdists-v8/editable/dbd5b56341e062d6`
DEBUG Fetching source distribution from Git: file:///home/astoecke/tmp/uv_build_dep_bug
DEBUG Acquired lock for `file:///home/astoecke/tmp/uv_build_dep_bug`
   Building my-foo-app @ file:///home/astoecke/tmp/uv_build_dep_bug/my_foo_app
DEBUG Building: my-foo-app @ file:///home/astoecke/tmp/uv_build_dep_bug/my_foo_app
DEBUG No workspace root found, using project root
DEBUG Using base executable for virtual environment: /usr/bin/python3
DEBUG Ignoring empty directory
DEBUG Using existing Git source `file:///home/astoecke/tmp/uv_build_dep_bug`
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.13.2
DEBUG Solving with target Python version: &gt;=3.13.2
DEBUG Adding direct dependency: setuptools*
DEBUG Found stale response for: https://pypi.org/simple/setuptools/
DEBUG Sending revalidation request for: https://pypi.org/simple/setuptools/
DEBUG Released lock at `/home/astoecke/.cache/uv/git-v0/locks/4e23d374614cfb53`
DEBUG Acquired lock for `/home/astoecke/.cache/uv/sdists-v8/git/45c67979ae0c4d19/880944a06140429e`
   Building my-foo-lib @ git+file:///home/astoecke/tmp/uv_build_dep_bug@880944a06140429e23d55d7d5a23e18acd0eacbc#subdirectory=my_foo_lib
DEBUG Building: my-foo-lib @ git+file:///home/astoecke/tmp/uv_build_dep_bug@880944a06140429e23d55d7d5a23e18acd0eacbc#subdirectory=my_foo_lib
DEBUG Using base executable for virtual environment: /usr/bin/python3
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.13.2
DEBUG Solving with target Python version: &gt;=3.13.2
DEBUG Adding direct dependency: setuptools*
DEBUG Adding direct dependency: my-build-plugin*
DEBUG No cache entry for: https://pypi.org/simple/my-build-plugin/
DEBUG Found not-modified response for: https://pypi.org/simple/setuptools/
DEBUG Searching for a compatible version of setuptools (*)
DEBUG Searching for a compatible version of setuptools (*)
DEBUG Selecting: setuptools==75.8.0 [compatible] (setuptools-75.8.0-py3-none-any.whl)
DEBUG Selecting: setuptools==75.8.0 [compatible] (setuptools-75.8.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/69/8a/b9dc7678803429e4a3bc9ba462fa3dd9066824d3c607490235c6a796be5a/setuptools-75.8.0-py3-none-any.whl.metadata
DEBUG Tried 1 versions: setuptools 1
DEBUG marker environment resolution took 0.065s
DEBUG Installing in setuptools==75.8.0 in /home/astoecke/.cache/uv/builds-v0/.tmpIADi60
DEBUG Registry requirement already cached: setuptools==75.8.0
DEBUG Installing build requirement: setuptools==75.8.0
DEBUG Creating PEP 517 build environment
DEBUG Calling `setuptools.build_meta.get_requires_for_build_editable()`
DEBUG No netrc file found
DEBUG Searching for a compatible version of my-build-plugin (*)
DEBUG No compatible version found for: my-build-plugin
DEBUG Released lock at `/home/astoecke/.cache/uv/sdists-v8/git/45c67979ae0c4d19/880944a06140429e/.lock`
DEBUG Released lock at `/home/astoecke/.cache/uv/sdists-v8/editable/dbd5b56341e062d6/.lock`
  × Failed to download and build `my-foo-lib @ git+file:///home/astoecke/tmp/uv_build_dep_bug@880944a06140429e23d55d7d5a23e18acd0eacbc#subdirectory=my_foo_lib`
  ├─▶ Failed to resolve requirements from `build-system.requires`
  ├─▶ No solution found when resolving: `setuptools`, `my-build-plugin`
  ╰─▶ Because my-build-plugin was not found in the package registry and you require my-build-plugin, we can conclude that your requirements are unsatisfiable.
  help: `my-foo-lib` was included because `my-foo-app` (v1.0.0) depends on `my-foo-lib`
</code></pre>
Platform
<p>Fedora 41</p>
Version
<p>uv 0.6.2+41 (2ea1df1a1 2025-02-24)</p>
Python version
<p>Python 3.13.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/astoeckel-abr">@astoeckel-abr</a> on 2025-02-24 22:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-02-25 17:55</div>
            <div class="timeline-body"><p>Wow fantastic bugreport! I can immediately reproduce this and will look into it.</p>
<p>(Note for macos users running the repro script: replace <code>$(readlink -e . )</code> with <code>$(pwd)</code> -- macos&#x27; readlink doesn&#x27;t have that flag)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-25 20:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-10 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> removed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 17:08</div>
            <div class="timeline-body"><p>While at first this seemed like a bug, upon reflection this is unfortunately intended/expected behaviour, and would require substantial deviations from the relevant python specs to support.</p>
<p><code>[tool.uv.sources]</code> is a feature for development builds, just like dependency-groups. Dev builds are a concept that only exist at the top-level, and not for dependencies. So just as you can&#x27;t depend on a library &quot;with its dependency-group xyz enabled&quot;, you can&#x27;t depend on a library &quot;with its tool.uv.sources enabled&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-11 10:14</div>
            <div class="timeline-body"><p>As a workaround, you can use:</p>
<pre><code>requires = [&quot;setuptools&quot;, &quot;my-build-plugin @ git+&lt;GIT URL&gt;@&lt;GIT REV&gt;#subdirectory=my_build_plugin&quot;]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:28 UTC
    </footer>
</body>
</html>
