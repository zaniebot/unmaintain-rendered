<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identify bottlenecks in current PubGrub implementation - astral-sh/uv #101</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Identify bottlenecks in current PubGrub implementation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/101">#101</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2023-10-16 03:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p><em>No description provided.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-17 15:57</div>
            <div class="timeline-body"><p>We seem to spend a ton of time computing version intersections. I'll just copy an email I wrote to Jacob.</p>
<hr />
<p>When we find ourselves testing many consecutive versions of a given package, the term intersection increases linearly. For example, after testing and rejecting Django 5.0a1, we have:</p>
<pre><code>[ 0a0.dev0, 5.0a1 [  [ 5.0a1.post0.dev0, ∞ [
</code></pre>
<p>We then test Django 4.2.6, which gives us:</p>
<pre><code>[ 0a0.dev0, 4.2.6 [  [ 4.2.6.post0.dev0, ∞ [
</code></pre>
<p>We then take the intersection of these terms, which gives us:</p>
<pre><code>[ 0a0.dev0, 4.2.6 [  [ 4.2.6.post0.dev0, 5.0a1 [  [ 5.0a1.post0.dev0, ∞ [
</code></pre>
<p>This continues until we have a range like:</p>
<pre><code>[ 0a0.dev0, 4.2rc1 [  [ 4.2rc1.post0.dev0, 4.2 [  [ 4.2.post0.dev0, 4.2.1 [  [ 4.2.1.post0.dev0, 4.2.2 [  [ 4.2.2.post0.dev0, 4.2.3 [  [ 4.2.3.post0.dev0, 4.2.4 [  [ 4.2.4.post0.dev0, 4.2.5 [  [ 4.2.5.post0.dev0, 4.2.6 [  [ 4.2.6.post0.dev0, 5.0a1 [  [ 5.0a1.post0.dev0, ∞ [
</code></pre>
<p>If you're testing hundreds of versions, the terms continue to grow, and I suspect this leads to quadratic behavior, since we're increasing the number of terms linearly with the number of tested versions?</p>
<p>The intersections aren't &quot;wrong&quot;, and it's possible that we're doing something wrong with our version formulations -- but could we take advantage of the fact that we know there are no versions in these partial ranges?</p>
<p>For example, given <code>[ 0a0.dev0, 5.0a1 [  [ 5.0a1.post0.dev0, ∞ [</code> and <code>[ 0a0.dev0, 4.2.6 [  [ 4.2.6.post0.dev0, ∞ [</code>, it would be preferable to reduce to <code>[ 0a0.dev0, 4.2.6 [</code>, if I'm understanding the syntax correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @charliermarsh on 2023-10-24 01:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Future" by @charliermarsh on 2023-10-25 04:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-02 20:08</div>
            <div class="timeline-body"><p>This is now better tracked in https://github.com/pubgrub-rs/pubgrub/issues/135 and has improved a lot. I'm closing this in favor of opening specific issues for specific problems.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-02-02 20:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:23:01 UTC
    </footer>
</body>
</html>
