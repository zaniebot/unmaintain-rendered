```yaml
number: 11703
title: "`uv cache prune --ci` leads to error: Failed to generate package metadata"
type: issue
state: closed
author: andersk
labels:
  - bug
assignees: []
created_at: 2025-02-22T01:08:23Z
updated_at: 2025-02-23T00:13:30Z
url: https://github.com/astral-sh/uv/issues/11703
synced_at: 2026-01-10T01:57:27Z
```

# `uv cache prune --ci` leads to error: Failed to generate package metadata

---

_Issue opened by @andersk on 2025-02-22 01:08_

### Summary

```console
$ uv init
Initialized project `test`
$ uv add 'https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip'
Using CPython 3.12.3 interpreter at: /usr/bin/python3.12
Creating virtual environment at: .venv
Resolved 11 packages in 1.29s
      Built zulip @ https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip
Prepared 9 packages in 953ms
Installed 9 packages in 84ms
 + certifi==2025.1.31
 + charset-normalizer==3.4.1
 + click==8.1.8
 + distro==1.9.0
 + idna==3.10
 + requests==2.32.3
 + typing-extensions==4.12.2
 + urllib3==2.3.0
 + zulip==0.9.0 (from https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip)
$ uv cache prune --ci
Pruning cache at: /root/.cache/uv
Removed 2110 files (15.7MiB)
$ uv sync
error: Failed to generate package metadata for `zulip==0.9.0 @ direct+https://github.com/zulip/python-zulip-api/archive/0.9.0.zip`
  Caused by: The source distribution `https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip` has no subdirectory `zulip`
```

This may be a bug in `uv cache prune --ci`, but additionally, I would expect uv to automatically recover from any partial deletion of `~/.cache/uv` since itâ€™s marked with [`CACHEDIR.TAG`](https://bford.info/cachedir/).

### Platform

Ubuntu 24.04 amd64

### Version

uv 0.6.2

### Python version

Python 3.12.3

---

_Label `bug` added by @andersk on 2025-02-22 01:08_

---

_Renamed from "Deleting part of ~/.cache/uv leads to error: Failed to generate package metadata" to "`uv cache prune --ci` leads to error: Failed to generate package metadata" by @andersk on 2025-02-22 01:15_

---

_Comment by @charliermarsh on 2025-02-22 04:40_

Definitely a bug, thanks.

---

_Assigned to @charliermarsh by @charliermarsh on 2025-02-22 22:33_

---

_Referenced in [astral-sh/uv#11719](../../astral-sh/uv/pulls/11719.md) on 2025-02-22 22:39_

---

_Closed by @charliermarsh on 2025-02-23 00:13_

---

_Closed by @charliermarsh on 2025-02-23 00:13_

---
