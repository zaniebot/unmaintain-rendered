<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv add with multiple (extra-)index-urls fails - astral-sh/uv #9741</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv add with multiple (extra-)index-urls fails</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9741">#9741</a>
        opened by <a href="https://github.com/legout">@legout</a>
        on 2024-12-09 16:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/legout">@legout</a> on 2024-12-09 16:22</div>
            <div class="timeline-body"><p>Hi guys,</p>
<p>we have multiple private gitlab repos with its own package index.</p>
<p>When I try to add two packages to my project, I always get an error, that a package can not be downloaded.</p>
<p>I´ve tried the following:</p>
<p>Add <code>[[tool.uv.index]]</code> entries to the pyproject.toml for each package (with and without additional <code>[tool.uv.sources]</code>)</p>
<pre><code class="language-toml">
[tool.uv.sources]
package1 = { index = &quot;package1&quot; }
package2 = { index = &quot;package2&quot; }

[[tool.uv.index]]
name = &quot;package1&quot;
url = &quot;https://token1:secret1@private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/simple&quot;

[[tool.uv.index]]
name = &quot;package2&quot;
url = &quot;https://token1:secret1@private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/simple&quot;

</code></pre>
<p>Set the env variable <code>UV_EXTRA_INDEX_URL to https://token1:secret1@private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/simple https://token1:secret1@private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/simple</code> (space seperated both package registries)</p>
<p>Run each add command with its own --index</p>
<pre><code class="language-bash">uv add package1 --index https://token1:secret1@private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/simple
uv add package2 --index https://token1:secret1@private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/simple
</code></pre>
<p>None of these worked. It alway fails to download one of the packages.</p>
<pre><code class="language-bash">error: Failed to fetch: `https://private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/files/5558649d00d348f5f9486dcd7d309cfa9968f06cd0f40bf01fa06e4c758e67ef/package1-0.1.0-py3-none-any.whl#sha256=5558649d00d348f5f9486dcd7d309cfa9968f06cd0f40bf01fa06e4c758e67ef`
  Caused by: HTTP status client error (404 Not Found) for url (https://private.gitlab-repo.com/api/v4/projects/12345/packages/pypi/files/5558649d00d348f5f9486dcd7d309cfa9968f06cd0f40bf01fa06e4c758e67ef/package1-0.1.0-py3-none-any.whl#sha256=5558649d00d348f5f9486dcd7d309cfa9968f06cd0f40bf01fa06e4c758e67ef)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-09 19:08</div>
            <div class="timeline-body"><p>xref https://discord.com/channels/1039017663004942429/1314574704866099300/1314574704866099300</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hbeukers">@hbeukers</a> on 2024-12-09 22:12</div>
            <div class="timeline-body"><p>This sounds very familiar, is this the same as my issue in #8565 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/legout">@legout</a> on 2024-12-10 09:01</div>
            <div class="timeline-body"><p>This is how i got it working.</p>
<ul>
<li>Removed the <code>[tool.uv.sources]</code> from the pyproject.toml</li>
<li>Run <code>uv lock</code> before <code>uv sync</code> or <code>uv add</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-07 19:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/legout">@legout</a> on 2025-02-06 07:14</div>
            <div class="timeline-body"><p>Hi guys,</p>
<p>unfortunately, this issue isn´t solved for me yet. <code>uv lock</code> solves the problem sometimes. Unfortunately, it is completly unpredictable when and how this works.</p>
<p>@zanieb Can you please reopen this issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-08 02:01</div>
            <div class="timeline-body"><p>@legout this seems like it should be fixed by #11074</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-08 02:01</div>
            <div class="timeline-body"><p>Can you share a clear reproduction on the latest version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/legout">@legout</a> on 2025-02-10 11:21</div>
            <div class="timeline-body"><p>@zanieb I´ve updated uv and it seems to work now. Thanks a lot!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
