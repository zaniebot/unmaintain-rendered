<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support using `uv sync` in pre-commit.ci - astral-sh/uv #15509</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Support using `uv sync` in pre-commit.ci</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15509">#15509</a>
        opened by <a href="https://github.com/vivodi">@vivodi</a>
        on 2025-08-25 05:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vivodi">@vivodi</a> on 2025-08-25 05:19</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Support using <code>uv sync</code> in pre-commit.ci.</p>
<p>pre-commit.ci has no network access at runtime, so <code>uv sync</code> cannot download packages during execution. It can only use the packages specified in <code>additional_dependencies</code> in <code>.pre-commit-config.yaml</code>.</p>
<p>When the build-backend is <code>hatchling</code>, <code>uv sync</code> requires <code>hatchling</code> to be installed. However, the <code>hatchling</code> used by <code>uv</code> must reside in the cache directory (e.g., <code>$HOME/.cache/uv</code>).
The <code>hatchling</code> installed via <code>pre-commit</code>’s <code>additional_dependencies</code> cannot be found by <code>uv</code>.</p>
<h3>Solution</h3>
<p>I think the solution is for <code>uv</code> to be able to use the <code>hatchling</code> installed in <code>.venv</code>, so that the <code>hatchling</code> from <code>additional_dependencies</code> can be used by <code>uv</code>.</p>
<h3>Example</h3>
<pre><code class="language-yaml">  - repo: local
    hooks:
      - id: run-uv-sync
        name: Run uv sync
        entry: uv sync
        language: system
        additional_dependencies:
          - uv
          - hatchling
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @vivodi on 2025-08-25 05:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-25 13:14</div>
            <div class="timeline-body"><p>You can use the hatchling in the venv with <code>--no-build-isolation</code>, but we don't recommend as it removes the advantages of build isolation. uv needs either hatchling in its cache or network access to build packages with the regular build isolation settings, I'm not sure if this is possible with just <code>additional_dependencies</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vivodi">@vivodi</a> on 2025-08-26 06:35</div>
            <div class="timeline-body"><blockquote>
<p>You can use the hatchling in the venv with <code>--no-build-isolation</code>, but we don't recommend as it removes the advantages of build isolation. uv needs either hatchling in its cache or network access to build packages with the regular build isolation settings, I'm not sure if this is possible with just <code>additional_dependencies</code>.</p>
</blockquote>
<p>The method you suggested does solve that problem, but the dependencies installed via <code>additonal_dependencies</code> are in <code>/pc/clone/ZPmcVIdcRg6rN_F4voX-ag/py_env-python3.12/</code> instead of the <code>.venv</code> inside the project directory. This requires running <code>uv sync --active</code>, but since <code>/pc/clone/ZPmcVIdcRg6rN_F4voX-ag/py_env-python3.12/</code> is read-only (due to pre-commit.ci restrictions), the project itself cannot be installed:</p>
<pre><code>error: Failed to install: flexget-3.17.18.dev0-py3-none-any.whl (flexget==3.17.18.dev0 (from file:///code))
  Caused by: failed to create directory `/pc/clone/ZPmcVIdcRg6rN_F4voX-ag/py_env-python3.12/lib/python3.12/site-packages/flexget-3.17.18.dev0.dist-info`: Read-only file system (os error 30)
</code></pre>
<p>Conclusion: I’ve never seen anyone run <code>uv sync</code> inside a pre-commit hook, and after trying it myself I found it far too complicated with too many issues. I eventually gave up on this approach and decided to move the related tasks into GitHub Actions instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @vivodi on 2025-08-26 06:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
