<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv help tool run` fails due to unsupported `less -P` option - astral-sh/uv #16015</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv help tool run</code> fails due to unsupported <code>less -P</code> option</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16015">#16015</a>
        opened by <a href="https://github.com/mesaglio">@mesaglio</a>
        on 2025-09-24 13:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mesaglio">@mesaglio</a></div>
            <div class="timeline-body"><h4>Description</h4>
<p>When running <code>uv help tool run</code>, the command fails because the system <code>less</code> binary does not support the <code>-P</code> option. This happens in environments where <code>less</code> is provided by BusyBox.</p>
<h4>Steps to Reproduce</h4>
<pre><code class="language-bash">podman run --rm -it alpine
&gt; echo -e &quot;https://dl-cdn.alpinelinux.org/alpine/edge/main\nhttps://dl-cdn.alpinelinux.org
/alpine/edge/community&quot; &gt; /etc/apk/repositories
&gt; apk update &amp;&amp; apk add python3 uv
&gt; uv -v help tool run
DEBUG uv 0.8.21
/usr/bin/less: unrecognized option: P
BusyBox v1.37.0 (2025-05-26 20:04:45 UTC) multi-call binary.

Usage: less [-EFIMmNSRh~] [FILE]...

View FILE (or stdin) one screenful at a time

	-E	Quit once the end of a file is reached
	-F	Quit if entire file fits on first screen
	-I	Ignore case in all searches
	-M,-m	Display status line with line numbers
		and percentage through the file
	-N	Prefix line number to each line
	-S	Truncate long lines
	-R	Remove color escape codes in input
	-~	Suppress ~s displayed past EOF
</code></pre>
<p>The issue seems to come from this section of the code where the <code>-P</code> flag is passed to less: https://github.com/astral-sh/uv/blob/ade2bdbd2a58c303b23976be3649ac1ed8796716/crates/uv/src/commands/help.rs#L136</p>
<h3>Platform</h3>
<p>Linux 6.12.13-200.fc41.aarch64 aarch64 Linux</p>
<h3>Version</h3>
<p>0.8.21</p>
<h3>Python version</h3>
<p>Python 3.12.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mesaglio on 2025-09-24 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2025-09-24 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-24 14:34</div>
            <div class="timeline-body"><p>Alas, I'm not sure what the best fix is there. I guess we can spawn <code>less</code> again if we see <code>unrecognized option: P</code> but that doesn't seem like a great option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-01 12:59</div>
            <div class="timeline-body"><p>For notes: Upon some review, it seems like there are a couple more issues:</p>
<ul>
<li>The prompt passed with <code>-P</code> is always bold, even if <code>NO_COLOR</code> is set.</li>
<li>The prompt is passed as <code>-P 'uv help: the command you wanted help with'</code> but the part after the colon and the colon are both getting eaten by less (version 679). Seems like <code>:</code> is special, but I didn't look into it much further.</li>
<li>Some versions of less are ignoring <code>-P</code>? At least after asking some colleagues it seems this doesn't work on mac?</li>
</ul>
<p>Additionally, it's worth noting, busybox less can apparently be compiled without support for <code>-R</code>. Not sure how common that is, but there's another potential bug there.</p>
<p>The information which is put in <code>-P</code> seems genuinely helpful regardless of whether &quot;normal&quot; <code>less</code> is used or not. To me, it seems like a good option would just be to put this as the first line of the output.</p>
<p>Eventually, I think it would be cool if the help pages followed the relatively standard and familiar looking man page look, which is what <code>cargo</code> and <code>git</code> do. But for now, I've opened #16908 which addresses the <code>NO_COLOR</code> issue and avoids using <code>-P</code> entirely (which coincidentally means all pagers now print a heading).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-01 14:28</div>
            <div class="timeline-body"><p>Mostly as a note... the system <code>less</code> on macOS supports <code>-P</code> for me</p>
<pre><code>❯ less --version
less 581.2 (POSIX regular expressions)
Copyright (C) 1984-2021  Mark Nudelman

less comes with NO WARRANTY, to the extent permitted by law.
For information about the terms of redistribution,
see the file named README in the less distribution.
Home page: https://greenwoodsoftware.com/less
❯ which less
/usr/bin/less
</code></pre>
<p><img width="749" height="275" alt="Image" src="https://github.com/user-attachments/assets/160f7731-f6a9-4c18-84c9-be0383c1baf8" /></p>
<p>I'm on an older version though. It does eat the content after colon, which surprised me — I was confused we weren't showing the command :D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-01 18:37</div>
            <div class="timeline-body"><p>For now, the prompt is gone, replaced with a title line when paging. But it may make a comeback in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @EliteTK on 2025-12-01 18:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:00 UTC
    </footer>
</body>
</html>
