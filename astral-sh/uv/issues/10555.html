<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv Standalone Python Build Breaking Program Built with Nuitka - astral-sh/uv #10555</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv Standalone Python Build Breaking Program Built with Nuitka</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10555">#10555</a>
        opened by <a href="https://github.com/nazdridoy">@nazdridoy</a>
        on 2025-01-13 07:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nazdridoy">@nazdridoy</a></div>
            <div class="timeline-body"><p>Issue with Nuitka Standalone Build Using <code>uv</code> Virtual Environment on Python 3.13.1</p>
<p><strong>Description:</strong></p>
<p>I am encountering issues when building a standalone executable using Nuitka within a virtual environment created by <code>uv</code> for Python 3.13.1. The same process works fine with the system Python but fails when using the <code>uv</code> standalone build.</p>
<p><strong>Steps to Reproduce:</strong></p>
<ol>
<li><p>Initialize a project and virtual environment with <code>uv</code> using system Python:</p>
<pre><code>uv init
uv venv --python /usr/bin/python
uv add pygame nuitka
env LDFLAGS=&quot;-L/path/to/libatomic.a -latomic&quot; uv run python -m nuitka --standalone snake.py
</code></pre>
 
 <strong>Nuitka Build Log</strong>

<pre><code>Nuitka-Options: Used command line options: --standalone snake.py
Nuitka-Options: Detected static libpython to exist, consider &#x27;--static-libpython=yes&#x27; for better performance, but errors may happen.
Nuitka: Starting Python compilation with Nuitka &#x27;2.5.9&#x27; on Python &#x27;3.13&#x27; commercial grade &#x27;not installed&#x27;.
Nuitka-Plugins:anti-bloat: Not including &#x27;_json&#x27; automatically in order to avoid bloat, but this may cause: may slow down by using fallback
Nuitka-Plugins:anti-bloat: implementation.
Nuitka-Plugins:anti-bloat: Not including &#x27;_bisect&#x27; automatically in order to avoid bloat, but this may cause: may slow down by using fallback
Nuitka-Plugins:anti-bloat: implementation.
Nuitka: Completed Python level compilation and optimization.
Nuitka: Generating source code for C backend compiler.
Nuitka: Running data composer tool for optimal constant value handling.              
Nuitka: Running C compilation via Scons.
Nuitka-Scons: Backend C compiler: gcc (gcc 14.2.1).
Nuitka-Scons: Scons: Inherited LDFLAGS=&#x27;-L/path/to/libatomic.a -latomic&#x27; variable.
Nuitka-Scons: Backend linking program with 30 files (no progress information available for this stage).
Nuitka-Scons:WARNING: You are not using ccache, re-compilation of identical code will be slower than necessary. Use your OS package manager to
Nuitka-Scons:WARNING: install it.
Nuitka-Plugins:data-files: Included data file &#x27;pygame/freesansbold.ttf&#x27; due to package data for &#x27;pygame&#x27;.
Nuitka-Plugins:data-files: Included data file &#x27;pygame/pygame_icon.bmp&#x27; due to package data for &#x27;pygame&#x27;.
Nuitka: Keeping build directory &#x27;snake.build&#x27;.
Nuitka: Successfully created &#x27;snake.dist/snake.bin&#x27;.
❯ snake.dist/snake.bin
pygame 2.6.1 (SDL 2.28.4, Python 3.13.1)
Hello from the pygame community. https://www.pygame.org/contribute.html
Nuitka: A segmentation fault has occurred. This is highly unusual and can
have multiple reasons. Please check https://nuitka.net/info/segfault.html
for solutions.
</code></pre>
 

</li>
<li><p>The above works fine, but when using <code>uv</code> standalone Python build:</p>
<pre><code>uv init
uv venv --python 3.13.1
uv add pygame nuitka
env LDFLAGS=&quot;-L/path/to/libatomic.a -latomic&quot; uv run python -m nuitka --standalone snake.py
</code></pre>
 
 <strong>Nuitka Build Log</strong>

<pre><code>    Nuitka-Options: Used command line options: --standalone snake.py
Nuitka: Starting Python compilation with Nuitka &#x27;2.5.9&#x27; on Python &#x27;3.13&#x27; commercial grade &#x27;not installed&#x27;.
Nuitka: Completed Python level compilation and optimization.                            
Nuitka: Generating source code for C backend compiler.
Nuitka: Running data composer tool for optimal constant value handling.              
Nuitka: Running C compilation via Scons.
Nuitka-Scons: Backend C compiler: gcc (gcc 14.2.1).
Nuitka-Scons: Scons: Inherited LDFLAGS=&#x27;-L/path/to/libatomic.a -latomic&#x27; variable.
Nuitka-Scons: Backend linking program with 30 files (no progress information available for this stage).
Nuitka-Scons:WARNING: You are not using ccache, re-compilation of identical code will be slower than necessary. Use your OS package manager to
Nuitka-Scons:WARNING: install it.
Nuitka-Plugins:data-files: Included data file &#x27;pygame/freesansbold.ttf&#x27; due to package data for &#x27;pygame&#x27;.
Nuitka-Plugins:data-files: Included data file &#x27;pygame/pygame_icon.bmp&#x27; due to package data for &#x27;pygame&#x27;.
Nuitka: Keeping build directory &#x27;snake.build&#x27;.
Nuitka: Successfully created &#x27;snake.dist/snake.bin&#x27;.
❯ snake.dist/snake.bin
Traceback (most recent call last):
  File &quot;/home/user/USER/Workspace/TEMP/miscProjects/snake/snake.dist/inspect.py&quot;, line 146, in &lt;module&gt;
  File &quot;/home/user/USER/Workspace/TEMP/miscProjects/snake/snake.dist/dis.py&quot;, line 8, in &lt;module&gt;
  File &quot;/home/user/USER/Workspace/TEMP/miscProjects/snake/snake.dist/opcode.py&quot;, line 12, in &lt;module&gt;
ModuleNotFoundError: No module named &#x27;_opcode&#x27;
```

&lt;/details&gt;

Running the generated binary results in:
```
Traceback (most recent call last):
  File &quot;/path/to/snake/snake.dist/inspect.py&quot;, line 146, in &lt;module&gt;
  File &quot;/path/to/snake/snake.dist/dis.py&quot;, line 8, in &lt;module&gt;
  File &quot;/path/to/snake/snake.dist/opcode.py&quot;, line 12, in &lt;module&gt;
ModuleNotFoundError: No module named &#x27;_opcode&#x27;
```
</code></pre>
</li>
</ol>
<p><strong>Additional Information:</strong></p>
<ul>
<li>Operating System: Arch Linux</li>
<li>Python Version: 3.13.1 (system and <code>uv</code> standalone build)</li>
<li>Nuitka Version: uv 0.5.18 (27d1bad55 2025-01-11)</li>
<li>Issue seems similar to <a href="https://github.com/Nuitka/Nuitka/issues/3111#issuecomment-2536438277">Nuitka issue #3111</a></li>
</ul>
<p>Please let me know if additional information or logs are required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-13 20:33</div>
            <div class="timeline-body"><p>Where is <code>_opcode</code> supposed to come from? Unfortunately, I don&#x27;t have time to dig into Nuitka&#x27;s build system so we&#x27;ll need help diagnosing the cause of the difference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nazdridoy">@nazdridoy</a> on 2025-01-13 20:57</div>
            <div class="timeline-body"><p>_opcode module is a built-in module in Python.</p>
<p>maybe @kayhayen can help us understand the core issue. he is probably familiar with similar issues</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kayhayen">@kayhayen</a> on 2025-01-15 13:05</div>
            <div class="timeline-body"><p>Feel free to make a proper report in Nuitka issue tracker, I cannot guess the details. Your Python needing extra LDFLAGS is not a good sign of it being a supported flavor, but I will always be open to adding more.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nazdridoy">@nazdridoy</a> on 2025-01-15 13:20</div>
            <div class="timeline-body"><p>@kayhayen</p>
<p>In Arch Linux, libatomic.a (static libraries) is not available.
This is why I had to use LDFLAGS to make Nuitka work in both cases</p>
<pre><code>LDFLAGS=&quot;-L/path/to/libatomic.a -latomic&quot;
</code></pre>
<p>anyway, I&#x27;ve mentioned you here to know if you have any comment on why the pre-built Python binary from uv doesn&#x27;t work with Nuitka.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kayhayen">@kayhayen</a> on 2025-01-15 13:59</div>
            <div class="timeline-body"><p>I see, if there will be a report in Nuitka, it will be dealt with, for now I don&#x27;t really want to guess about steps to reproduce, etc. so please fill out the issue template and lets handle it there, I don&#x27;t see this being an uv issue or myself tracking this outside of Nuitka tracker.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-15 14:53</div>
            <div class="timeline-body"><p>I think standard Python distributions probably dynamically link libatomic so it would automatically be included in your LDFLAGS but python-build-standalone does not.</p>
<p>Thanks for the replies @kayhayen! Ping me if you think I can help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WilliamStam">@WilliamStam</a> on 2025-09-30 09:45</div>
            <div class="timeline-body"><p>im having this issue now on red hat.</p>
<pre><code>Backend C:  94% 1424/1520 [19:47&lt;00:19,  4.88file/s]
Backend C:  94% 1425/1520 [19:47&lt;00:24,  3.91file/s]
Backend C:  94% 1426/1520 [19:48&lt;00:35,  2.62file/s]
Backend C:  94% 1427/1520 [19:48&lt;00:29,  3.18file/s]
Backend C:  94% 1428/1520 [19:49&lt;00:28,  3.27file/s]
Backend C:  94% 1429/1520 [19:49&lt;00:2
/usr/bin/ld: cannot find -l:libatomic.a
/usr/bin/ld: cannot find -l:libatomic.a
collect2: error: ld returned 1 exit status
scons: *** [/home/munsys_william__bk/.cache/act/877863619d5228fc/hostexecutor/build/main.dist/argus-redhat.bin] Error 1
FATAL: Failed unexpectedly in Scons C backend compilation.
Nuitka:WARNING:     Complex topic! More information can be found at https://nuitka.net/info/scons-backend-failure.html
Nuitka-Reports: Compilation crash report written to file &#x27;nuitka-crash-report.xml&#x27;.
  ❌  Failure - Main Build with nuitka
exit status 1
</code></pre>
<p>(this is run through a gitea actions but it fails regardless)</p>
<p>for those that get this issue after my reading you can install libatomic <code>sudo dnf install libatomic</code> and then set</p>
<pre><code>env LDFLAGS=&quot;-L/usr/lib/gcc/x86_64-redhat-linux/8/32/libatomic.a -latomic&quot; uv run python -m nuitka src/main.py
</code></pre>
<p>maybe your results will be better than mine</p>
<pre><code>name: Build main on redhat
run-name: Building
on:
  push:
    branches:
      - wip

jobs:
  Build:
    runs-on: redhat
    steps:
      - name: Checkout Codebase
        uses: actions/checkout@v5

      - name: Meta
        id: meta
        run: |
          echo REPO_NAME=$(echo ${GITHUB_REPOSITORY} | awk -F&quot;/&quot; &#x27;{print $2}&#x27;) &gt;&gt; $GITHUB_OUTPUT
          echo REPO_VERSION=$(git describe --tags --always | sed &#x27;s/^v//&#x27;) &gt;&gt; $GITHUB_OUTPUT      
          echo PACKAGE_VERSION=$(uvx --from=toml-cli toml get --toml-path=pyproject.toml project.version) &gt;&gt; $GITHUB_OUTPUT      
          echo PACKAGE_NAME=$(uvx --from=toml-cli toml get --toml-path=pyproject.toml project.name) &gt;&gt; $GITHUB_OUTPUT      

      - name: Testing
        run: |
          echo &quot;REPO_NAME: ${{ steps.meta.outputs.REPO_NAME }}&quot;
          echo &quot;REPO_VERSION: ${{ steps.meta.outputs.REPO_VERSION }}&quot;
          echo &quot;PACKAGE_VERSION: ${{ steps.meta.outputs.PACKAGE_VERSION }}&quot;
          echo &quot;PACKAGE_NAME: ${{ steps.meta.outputs.PACKAGE_NAME }}&quot;


      - name: Install uv
        uses: astral-sh/setup-uv@v6

      - name: Set up Python
        run: uv python install


      - name: Install the project
        run: uv sync --locked --all-extras --dev

      - name: Build with nuitka
        run: |
          env LDFLAGS=&quot;-L/usr/lib/gcc/x86_64-redhat-linux/8/32/libatomic.a -latomic&quot; uv run python -m nuitka src/main.py \
            --standalone \
            --onefile \
            --msvc=latest \
            --windows-icon-from-ico=src/static/favicon.ico \
            --include-module=app \
            --include-module=passlib \
            --include-module=passlib.handlers.pbkdf2 \
            --output-filename=argus-redhat \
            --output-dir=build \
            --include-data-dir=src/static/=static/ \
            --include-data-dir=src/templates/=templates/
          
      - name: Release
        uses: akkuman/gitea-release-action@v1
        with:
          files: |-
            ./build/**
          name: &#x27;${{ steps.meta.outputs.PACKAGE_VERSION }}&#x27;
          tag_name: &#x27;${{ steps.meta.outputs.PACKAGE_VERSION }}&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-30 13:29</div>
            <div class="timeline-body"><p>Let&#x27;s track this in <a href="https://github.com/astral-sh/python-build-standalone/issues/616">astral-sh/python-build-standalone#616</a> instead — it links to a couple Nuitka issues and explains the cause of the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-30 13:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:38 UTC
    </footer>
</body>
</html>
