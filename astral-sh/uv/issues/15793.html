<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Question] Unable to import local packages for running pytest - astral-sh/uv #15793</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Question] Unable to import local packages for running pytest</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15793">#15793</a>
        opened by <a href="https://github.com/vaibhavmano">@vaibhavmano</a>
        on 2025-09-11 16:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vaibhavmano">@vaibhavmano</a></div>
            <div class="timeline-body"><h3>Question</h3>
<p>I'm currently in the process of migrating my organization's monorepo to <code>uv</code>. We currently have a flat structure and it consists of both packages and service folders that correspond to each microservice. I've since changes the structure to have <code>src/</code> folder in the root which will contain all the packages.</p>
<p>I've also taken advantage of uv workspaces.</p>
<pre><code>org-backend 
└── src
    └── base
        └── ..
        └── pyproject.toml
    └── bo
        └── ..
        └── pyproject.toml
└── application
   └── ..
   └── pyproject.toml
└── pyproject.toml
</code></pre>
<p>I'm able to build the packages in <code>/src</code> (using <code>hatch</code> for build) but where I'm having issue is within the service folders (in this case, <code>/application</code>)</p>
<p>below is the<code>pyproject.toml</code> for <code>/application</code></p>
<pre><code>[project]
name = &quot;application&quot;
version = &quot;0.1.0&quot;
description = &quot;Contains all business logics of the app&quot;
requires-python = &quot;==3.12.*&quot;
dependencies = [
    &quot;base&quot;,
    &quot;jsonschema==4.22.0&quot;,
]

[tool.uv]
package = false

[tool.uv.sources]
application = { workspace = true }
base = { workspace = true }

[dependency-groups]
dev = [
    &quot;bandit&gt;=1.8.6&quot;,
    &quot;pytest&gt;=8.4.2&quot;,
    &quot;pytest-cov&gt;=7.0.0&quot;,
]

[tool.pytest.ini_options]
pythonpath = [&quot;.&quot;]
addopts = &quot;--cov=. --cov-report=xml&quot;
testpaths = [&quot;tests&quot;]

</code></pre>
<p>Whenever I try to run pytests with <code>uv run pytest</code> after <code>uv sync</code>, I end up getting the error <code>ModuleNotFoundError: No module named 'base'</code> but I can see that the base is installed in the virtual environment. I'm also unable to import it via python console. Is there anything that I'm missing?</p>
<h3>Platform</h3>
<p>macOS 15.4.1</p>
<h3>Version</h3>
<p>uv 0.8.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @vaibhavmano on 2025-09-11 16:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-11 19:06</div>
            <div class="timeline-body"><p>It's hard to answer it from afar, but there's some things we can try for debugging: You can run <code>uv build</code> in base, and check what's the wheel that is build - is there's a <code>base</code> directory in there? You can run <code>uv venv -c &amp;&amp; uv sync -v</code> to get debug logs for a fresh install. You can check that <code>site-packages</code> directory inside the venv and the <code>&lt;...&gt;.pth</code> file for <code>base</code> in it, plus the value of <code>sys.path</code> in <code>uv run python</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vaibhavmano">@vaibhavmano</a> on 2025-09-12 05:07</div>
            <div class="timeline-body"><p>For what's it worth, here's my <code>pyproject.toml</code> from the root</p>
<pre><code>[project]
name = &quot;org-app&quot;
version = &quot;0.1.0&quot;
description = &quot;..&quot;
readme = &quot;README.md&quot;
requires-python = &quot;==3.12.*&quot;
dependencies = [
    &quot;base==0.1.0&quot;,
    &quot;bo==1.0.0&quot;
]

[tool.uv.workspace]
members = [&quot;src/base&quot;, &quot;src/bo&quot;, &quot;application&quot;]

[tool.uv.sources]
base = { workspace = true }
bo = { workspace = true }
application = { workspace = true }
</code></pre>
<p>And here's the <code>pyproject.toml</code> of <code>src/base</code></p>
<pre><code>[project]
name = &quot;base&quot;
version = &quot;0.1.0&quot;
description = &quot;...&quot;
authors = [{ email = &quot;...&quot; }, { email = &quot;...&quot; }]
requires-python = &quot;==3.12.*&quot;
dependencies = [
    &quot;aiohttp==3.11.9&quot;,
    &quot;firebase-admin==6.6.0&quot;,
    &quot;flask==3.1.0&quot;,
    &quot;grpcio==1.67.1&quot;,
    &quot;hatch&gt;=1.14.1&quot;,
    &quot;marshmallow==3.23.1&quot;,
    &quot;oauth2client==4.1.3&quot;,
    &quot;pillow==11.0.0&quot;,
    &quot;psutil==7.0.0&quot;,
    &quot;pydantic&gt;=2.11.7&quot;,
    &quot;supabase==2.10.0&quot;,
    &quot;user-agent-parser==0.1.2&quot;,
    &quot;uwsgi==2.0.28&quot;,
    &quot;werkzeug==3.1.3&quot;,
]

[build-system]
requires = [&quot;hatchling&gt;=1.25&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.hatch.build.targets.wheel]
packages = [&quot;base&quot;]
include = [
    &quot;base/*.py&quot;,
    &quot;base/config/.yaml&quot;,
    &quot;base/util/audit/config/.yml&quot;,
    &quot;base/app_server/configs/*.json&quot;,
]

[tool.hatch.build.targets.sdist]
include = [
    &quot;base/**&quot;,
]

[tool.uv]
package = true

[dependency-groups]
dev = [
    &quot;bandit&gt;=1.8.6&quot;,
    &quot;pytest&gt;=8.4.2&quot;,
    &quot;pytest-cov&gt;=7.0.0&quot;,
]

[tool.pytest.ini_options]
pythonpath = [&quot;.&quot;]
addopts = &quot;--cov=. --cov-report=xml&quot;

</code></pre>
<p>I've scoured over the uv documentation and there isn't any doc regarding importing and using local pakcages that are a workspace themself. Many of the threads in reddit and stackoverflow suggest to install the local package with the whl file using <code>uv pip install</code> but that seems like a workaround.</p>
<p>As @konstin mentioned, I also checked the site packages but only <code>base-0.1.0.dist-info</code> is present, whereas other packages seem to have 2 folders, I'm assuming this is because base is a local package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-12 06:12</div>
            <div class="timeline-body"><p>The decision what gets included and installed of the package is made by hatchling, not by uv. If you do a <code>uv sync</code>, uv asks hatchling to build in editable, which should create a <code>.pth</code> file with the name of a directory in it, which goes inside the site-packages. The contents of this <code>.pth</code> gets added to <code>sys.path</code>, the question what is in the <code>.pth</code> file, what is in <code>sys.path</code>, and what does <code>uv sync -v</code> say?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vaibhavmano">@vaibhavmano</a> on 2025-09-12 07:19</div>
            <div class="timeline-body"><p>@konstin This is what <code>uv sync -v</code> returns when I run it inside <code>/application</code> directory. Also both <code>_base.pth</code> and <code>sys.path</code> is empty.</p>
<pre><code>DEBUG uv 0.8.13 (Homebrew 2025-08-21)
DEBUG Found project root: `/../application`
DEBUG Found workspace root: `/..`
DEBUG Adding root workspace member: `/..`
DEBUG Adding discovered workspace member: `/../src/base`
DEBUG Adding discovered workspace member: `/../src/businessobject`
DEBUG Adding discovered workspace member: `/../application`
DEBUG Acquired lock for `/..`
DEBUG No Python version file found in workspace: /..
DEBUG Using Python request `==3.12.*` from `requires-python` metadata
DEBUG Checking for Python environment at: `/../.venv`
DEBUG The project environment's Python version satisfies the request: `Python ==3.12.*`
DEBUG Released lock at `/var/folders/lx/wkwt7b6j3ld0vg7dl9hh7mgr0000gn/T/uv-dfd1496d607534c7.lock`
DEBUG Acquired lock for `/../.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: application @ file:///../application
DEBUG Found workspace root: `/..`
DEBUG Found static `pyproject.toml` for: base @ file:///../src/base
DEBUG Found workspace root: `/..`
DEBUG Found static `pyproject.toml` for: businessobject @ file:///../src/bo
DEBUG Found workspace root: `/..`
DEBUG Found static `pyproject.toml` for: org-app @ file:///..
DEBUG Found workspace root: `/..`
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 175 packages in 10ms
DEBUG Using request timeout of 30s
DEBUG Requirement already installed: bandit==1.8.6
DEBUG Requirement already installed: pytest==8.4.2
DEBUG Requirement already installed: pytest-cov==7.0.0
DEBUG Computed cache info: Some(Timestamp(SystemTime { tv_sec: 1757659141, tv_nsec: 554696248 })), None, None, {}, {&quot;src&quot;: None}
DEBUG Requirement already installed: base==0.1.0 (from file:///../src/base)
DEBUG Requirement already installed: jsonschema==4.22.0
DEBUG Requirement already installed: pyyaml==6.0.2
DEBUG Requirement already installed: rich==14.1.0
DEBUG Requirement already installed: stevedore==5.5.0
DEBUG Requirement already installed: iniconfig==2.1.0
DEBUG Requirement already installed: packaging==25.0
DEBUG Requirement already installed: pluggy==1.6.0
DEBUG Requirement already installed: pygments==2.19.2
DEBUG Requirement already installed: coverage==7.10.6
DEBUG Requirement already installed: aiohttp==3.11.9
DEBUG Requirement already installed: apispec==6.7.1
DEBUG Requirement already installed: apispec-webframeworks==1.2.0
DEBUG Requirement already installed: boto3==1.35.72
DEBUG Requirement already installed: cachetools==4.2.4
DEBUG Requirement already installed: cerberus==1.3.5
DEBUG Requirement already installed: cryptography==44.0.0
DEBUG Requirement already installed: dnspython==2.6.1
DEBUG Requirement already installed: firebase-admin==6.6.0
DEBUG Requirement already installed: flask==3.1.0
DEBUG Requirement already installed: flatten-json==0.1.14
DEBUG Requirement already installed: future==1.0.0
DEBUG Requirement already installed: google-api-core==2.23.0
DEBUG Requirement already installed: google-api-python-client==2.154.0
DEBUG Requirement already installed: google-auth==2.36.0
DEBUG Requirement already installed: google-cloud-bigquery==3.27.0
DEBUG Requirement already installed: google-cloud-pubsub==2.27.1
DEBUG Requirement already installed: google-cloud-storage==2.18.2
DEBUG Requirement already installed: grpcio==1.67.1
DEBUG Requirement already installed: hatch==1.14.1
DEBUG Requirement already installed: jinja2==3.1.4
DEBUG Requirement already installed: jsonpath==0.82.2
DEBUG Requirement already installed: jsonpath-ng==1.6.1
DEBUG Requirement already installed: kubernetes==31.0.0
DEBUG Requirement already installed: litellm==1.75.3
DEBUG Requirement already installed: marshmallow==3.23.1
DEBUG Requirement already installed: oauth2client==4.1.3
DEBUG Requirement already installed: openai==1.78.0
DEBUG Requirement already installed: pillow==11.0.0
DEBUG Requirement already installed: psutil==7.0.0
DEBUG Requirement already installed: pydantic==2.11.7
DEBUG Requirement already installed: pyjwt==2.10.1
DEBUG Requirement already installed: pymongo==4.10.1
DEBUG Requirement already installed: pymupdf==1.26.3
DEBUG Requirement already installed: pytz==2024.2
DEBUG Requirement already installed: redis==5.2.0
DEBUG Requirement already installed: requests==2.32.3
DEBUG Requirement already installed: setuptools==75.6.0
DEBUG Requirement already installed: simplejson==3.19.3
DEBUG Requirement already installed: supabase==2.10.0
DEBUG Requirement already installed: user-agent-parser==0.1.2
DEBUG Requirement already installed: uwsgi==2.0.28
DEBUG Requirement already installed: werkzeug==3.1.3
DEBUG Requirement already installed: attrs==25.3.0
DEBUG Requirement already installed: jsonschema-specifications==2025.9.1
DEBUG Requirement already installed: referencing==0.36.2
DEBUG Requirement already installed: rpds-py==0.27.1
DEBUG Requirement already installed: markdown-it-py==4.0.0
DEBUG Requirement already installed: aiohappyeyeballs==2.6.1
DEBUG Requirement already installed: aiosignal==1.4.0
DEBUG Requirement already installed: frozenlist==1.7.0
DEBUG Requirement already installed: multidict==6.6.4
DEBUG Requirement already installed: propcache==0.3.2
DEBUG Requirement already installed: yarl==1.20.1
DEBUG Requirement already installed: botocore==1.35.99
DEBUG Requirement already installed: jmespath==1.0.1
DEBUG Requirement already installed: s3transfer==0.10.4
DEBUG Requirement already installed: cffi==2.0.0
DEBUG Requirement already installed: cachecontrol==0.14.3
DEBUG Requirement already installed: google-cloud-firestore==2.21.0
DEBUG Requirement already installed: blinker==1.9.0
DEBUG Requirement already installed: click==8.2.1
DEBUG Requirement already installed: itsdangerous==2.2.0
DEBUG Requirement already installed: six==1.17.0
DEBUG Requirement already installed: googleapis-common-protos==1.70.0
DEBUG Requirement already installed: proto-plus==1.26.1
DEBUG Requirement already installed: protobuf==5.29.5
DEBUG Requirement already installed: google-auth-httplib2==0.2.0
DEBUG Requirement already installed: httplib2==0.30.0
DEBUG Requirement already installed: uritemplate==4.2.0
DEBUG Requirement already installed: pyasn1-modules==0.4.2
DEBUG Requirement already installed: rsa==4.9.1
DEBUG Requirement already installed: google-cloud-core==2.4.3
DEBUG Requirement already installed: google-resumable-media==2.7.2
DEBUG Requirement already installed: python-dateutil==2.9.0.post0
DEBUG Requirement already installed: grpc-google-iam-v1==0.14.2
DEBUG Requirement already installed: grpcio-status==1.67.1
DEBUG Requirement already installed: opentelemetry-api==1.36.0
DEBUG Requirement already installed: opentelemetry-sdk==1.36.0
DEBUG Requirement already installed: google-crc32c==1.7.1
DEBUG Requirement already installed: hatchling==1.27.0
DEBUG Requirement already installed: httpx==0.27.2
DEBUG Requirement already installed: hyperlink==21.0.0
DEBUG Requirement already installed: keyring==25.6.0
DEBUG Requirement already installed: pexpect==4.9.0
DEBUG Requirement already installed: platformdirs==4.4.0
DEBUG Requirement already installed: shellingham==1.5.4
DEBUG Requirement already installed: tomli-w==1.2.0
DEBUG Requirement already installed: tomlkit==0.13.3
DEBUG Requirement already installed: userpath==1.9.2
DEBUG Requirement already installed: uv==0.8.17
DEBUG Requirement already installed: virtualenv==20.34.0
DEBUG Requirement already installed: zstandard==0.24.0
DEBUG Requirement already installed: markupsafe==3.0.2
DEBUG Requirement already installed: ply==3.11
DEBUG Requirement already installed: certifi==2025.8.3
DEBUG Requirement already installed: durationpy==0.10
DEBUG Requirement already installed: oauthlib==3.3.1
DEBUG Requirement already installed: requests-oauthlib==2.0.0
DEBUG Requirement already installed: urllib3==2.5.0
DEBUG Requirement already installed: websocket-client==1.8.0
DEBUG Requirement already installed: importlib-metadata==8.7.0
DEBUG Requirement already installed: python-dotenv==1.1.1
DEBUG Requirement already installed: tiktoken==0.11.0
DEBUG Requirement already installed: tokenizers==0.22.0
DEBUG Requirement already installed: pyasn1==0.6.1
DEBUG Requirement already installed: anyio==4.10.0
DEBUG Requirement already installed: distro==1.9.0
DEBUG Requirement already installed: jiter==0.10.0
DEBUG Requirement already installed: sniffio==1.3.1
DEBUG Requirement already installed: tqdm==4.67.1
DEBUG Requirement already installed: typing-extensions==4.15.0
DEBUG Requirement already installed: annotated-types==0.7.0
DEBUG Requirement already installed: pydantic-core==2.33.2
DEBUG Requirement already installed: typing-inspection==0.4.1
DEBUG Requirement already installed: charset-normalizer==3.4.3
DEBUG Requirement already installed: idna==3.10
DEBUG Requirement already installed: gotrue==2.12.4
DEBUG Requirement already installed: postgrest==0.18.0
DEBUG Requirement already installed: realtime==2.7.0
DEBUG Requirement already installed: storage3==0.9.0
DEBUG Requirement already installed: supafunc==0.7.0
DEBUG Requirement already installed: mdurl==0.1.2
DEBUG Requirement already installed: pycparser==2.23
DEBUG Requirement already installed: msgpack==1.1.1
DEBUG Requirement already installed: pyparsing==3.2.3
DEBUG Requirement already installed: opentelemetry-semantic-conventions==0.57b0
DEBUG Requirement already installed: pathspec==0.12.1
DEBUG Requirement already installed: trove-classifiers==2025.9.9.12
DEBUG Requirement already installed: httpcore==1.0.9
DEBUG Requirement already installed: jaraco-classes==3.4.0
DEBUG Requirement already installed: jaraco-context==6.0.1
DEBUG Requirement already installed: jaraco-functools==4.3.0
DEBUG Requirement already installed: ptyprocess==0.7.0
DEBUG Requirement already installed: distlib==0.4.0
DEBUG Requirement already installed: filelock==3.19.1
DEBUG Requirement already installed: zipp==3.23.0
DEBUG Requirement already installed: regex==2025.9.1
DEBUG Requirement already installed: huggingface-hub==0.34.4
DEBUG Requirement already installed: deprecation==2.1.0
DEBUG Requirement already installed: websockets==15.0.1
DEBUG Requirement already installed: h11==0.16.0
DEBUG Requirement already installed: more-itertools==10.8.0
DEBUG Requirement already installed: fsspec==2025.9.0
DEBUG Requirement already installed: hf-xet==1.1.9
DEBUG Requirement already installed: h2==4.3.0
DEBUG Requirement already installed: hpack==4.1.0
DEBUG Requirement already installed: hyperframe==6.1.0
Audited 161 packages in 1ms
DEBUG Released lock at `/../.venv/.lock
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-12 07:21</div>
            <div class="timeline-body"><p><code>_base.pth</code> being empty would explain it, in that case it's a problem with the hatchling configuration. <code>sys.path</code> should never be empty, can you double check with <code>uv run python -c &quot;import sys; print(sys.path)&quot;</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vaibhavmano">@vaibhavmano</a> on 2025-09-12 07:36</div>
            <div class="timeline-body"><p>It looks like you're right. I'm able to import the <code>bo</code> package but not the <code>base</code>. They both have the exact hatchling configuration.</p>
<p>This is the output for the above cmd</p>
<pre><code>['', '/../.local/share/uv/python/cpython-3.12.11-macos-x86_64-none/lib/python312.zip', '/../.local/share/uv/python/cpython-3.12.11-macos-x86_64-none/lib/python3.12', '/../.local/share/uv/python/cpython-3.12.11-macos-x86_64-none/lib/python3.12/lib-dynload', '/../Desktop/org-app/.venv/lib/python3.12/site-packages', '/../Desktop/org-app/src/bo']
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vaibhavmano">@vaibhavmano</a> on 2025-09-14 16:24</div>
            <div class="timeline-body"><p>@konstin Thanks a ton. Figured it out. It seems like hatch and uv play nicely out of the box with the src folder structure. Changed my package to the src structure and works fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @vaibhavmano on 2025-09-14 16:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:32:52 UTC
    </footer>
</body>
</html>
