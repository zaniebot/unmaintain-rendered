```yaml
number: 13749
title: "Behaviour of `uv run` and `uv sync` is inconsistent based on current directory in a workspace"
type: issue
state: open
author: bradezard131
labels:
  - documentation
  - question
assignees: []
created_at: 2025-05-31T06:49:01Z
updated_at: 2025-12-02T19:55:48Z
url: https://github.com/astral-sh/uv/issues/13749
synced_at: 2026-01-10T01:57:31Z
```

# Behaviour of `uv run` and `uv sync` is inconsistent based on current directory in a workspace

---

_Issue opened by @bradezard131 on 2025-05-31 06:49_

### Summary

# Summary

When navigating around a workspace file structure, `uv sync` and `uv run` will have different behaviour, causing packages to be installed/uninstalled and scripts to fail with `ModuleNotFoundError`s.

# Reproduction

## Structure
```
pyproject.toml
uv.lock
.venv/
packages/
|-- bar/
    |-- pyproject.toml
    |-- main.py
|-- foo/
    |-- pyproject.toml
    |-- main.py
```

## Project Files
```toml
# root pyproject.toml
[project]
name = "uv-bug"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = []

[tool.uv.workspace]
members = ["packages/foo", "packages/bar"]

# packages/foo/pyproject.toml
[project]
name = "foo"
version = "0.1.0"
requires-python = ">=3.12"
dependencies = ["fire"]

# packages/bar/pyproject.toml
[project]
name = "bar"
version = "0.1.0"
requires-python = ">=3.12"
dependencies = ["numpy"]
```

## Scripts
```python
# packages/foo/main.py
import fire

# packages/bar/main.py
import numpy as np
print(f"Hello from bar! {np.arange(5)}")
```


## Behaviour

```bash
$ pwd  # should be the workspace root, situation 1

$ uv sync
Resolved 6 packages in 1ms
Audited in 0.00ms

$ uv run packages/foo/main.py
Traceback (most recent call last):
...
ModuleNotFoundError: No module named 'fire'

$ uv run packages/bar/main.py
...
ModuleNotFoundError: No module named 'numpy'

$ cd packages/bar  # situation 2

$ uv run main.py
Installed 1 package in 47ms
Hello from bar! [0 1 2 3 4]

$ cd ../..  # back to workspace root

$ uv sync
Resolved 6 packages in 1ms
Uninstalled 1 package in 17ms
 - numpy==2.2.6

$ cd packages/foo  # situation 3

$ uv sync
Resolved 6 packages in 1ms
Installed 2 packages in 7ms
 + fire==0.7.0
 + termcolor==3.1.0

$ uv run main.py baz
Hello from foo: baz

$ cd ../.. # back to workspace root, situation 4

$ uv run packages/foo/main.py bing
Hello from foo: bing

$ uv sync
Resolved 6 packages in 1ms
Uninstalled 2 packages in 2ms
 - fire==0.7.0
 - termcolor==3.1.0

$ uv run packages/foo/main.py bort
...
ModuleNotFoundError: No module named 'fire'
```

The failure in situation 1 is apparently intended behaviour, as described in  [#13664](https://github.com/astral-sh/uv/issues/13664#issuecomment-2910505312). However because all projects in a workspace share a common `.venv/`, situation 2 arises where navigating into a package and running it with `uv run` causes it to be installed into the workspace `.venv/`, then navigating back up and running `uv sync` causes it to be uninstalled again.

Situation 3 is similar to 2, where navigating into the member and running `uv sync` causes the dependencies to be installed in the workspace `.venv/` and things are runnable again.

Situation 4 is the strangest, back in the workspace root after syncing inside a member and you can run the script with `uv run` just fine, until you run `uv sync` which (which uninstalls the dependencies), then subsequent `uv run` invocations fail. 

I feel this raises two questions:

1. If `uv` is going to use a common `.venv/` for the whole workspace, does it really make sense for it to sync exactly at the package (incl. root package) by default? This causes churn in package installation as shown in situations 2 and 3. 
  a. Either they should continue to share a `uv.lock` but not a `.venv`; or
  b. Or the `.venv` should sync with the `uv.lock` and include all dependencies. 
2. If `uv` doesn't change it's interactions with the `.venv`, then shouldn't situation 4 fail in all cases? Why doesn't it sync during the `uv run` command?

### Platform

Ubuntu on WSL (Linux 6.6.87.1-microsoft-standard-WSL2 x86_64)

### Version

uv 0.6.14

### Python version

Python 3.12.7

---

_Label `bug` added by @bradezard131 on 2025-05-31 06:49_

---

_Comment by @charliermarsh on 2025-06-02 00:25_

Thanks for the write-up. I _think_ this is all working as intended. The model is as follows:

- When you run `uv run` or `uv sync`, we determine the current workspace member based on the current working directory. (The root is just another workspace member -- it's not special.) We then make sure the virtual environment is up-to-date with that workspace member.
- By default, `uv sync` performs an "exact" sync, so it will not only install any missing packages, but also uninstall any extraneous packages.
- By default, `uv run` performs an "inexact" sync, so it will make the minimum required changes to add the necessary packages to the environment. It won't remove extraneous packages.
- You can pass `--inexact` to `uv sync` to use "inexact" semantics.
- You can pass `--exact` to `uv run` to use "exact" semantics.


---

_Label `bug` removed by @charliermarsh on 2025-06-02 00:25_

---

_Label `question` added by @charliermarsh on 2025-06-02 00:25_

---

_Comment by @bradezard131 on 2025-06-02 07:26_

> - By default, uv sync performs an "exact" sync, so it will not only install any missing packages, but also uninstall any extraneous packages.
> - By default, uv run performs an "inexact" sync, so it will make the minimum required changes to add the necessary packages to the environment. It won't remove extraneous packages.

This intentional difference is surprising to me, I guess I can see why but is that documented anywhere? I can't find it in the places I would expect ([projects](https://docs.astral.sh/uv/guides/projects/#running-commands) [running commands](https://docs.astral.sh/uv/concepts/projects/run/) [syncing](https://docs.astral.sh/uv/concepts/projects/sync/) [cli reference](https://docs.astral.sh/uv/reference/cli/#uv-run)).

Subsequently, what are the chances of considering adding a flag or command to sync the workspace .venv against the lockfile and/or the union of all workspace member dependencies? E.g. something like `uv sync --workspace` which produces the same effect as `cd`-ing into each member and using `uv run` or `uv sync --inexact`? Basically one command I can run so I no longer have to ensure that the workspace root depends on everything, and no longer have to make sure I'm in the correct directory the first time I `uv run` a member.  I'm fairly sure the generally expected end result is more in-line with having all members in the one venv, and less in line with installing/uninstalling/reinstalling packages every time you run a command, so it would be nice to have this available as an option.

---

_Comment by @strugee on 2025-12-01 22:38_

We ran into this at $dayjob. https://docs.astral.sh/uv/concepts/projects/sync/#automatic-lock-and-sync is not clear at all - because the same page, further down, talks about syncs being exact, this makes it sound like the sync done by `uv run` is exact. But it's not.

---

_Comment by @zanieb on 2025-12-01 22:58_

It seems reasonable to expand https://docs.astral.sh/uv/concepts/projects/sync/#retaining-extraneous-packages to be clearer that an explicit sync is exact by default and implicit (automatic) syncs are not.

---

_Comment by @zanieb on 2025-12-01 22:59_

> Subsequently, what are the chances of considering adding a flag or command to sync the workspace .venv against the lockfile and/or the union of all workspace member dependencies?

I think you're asking for `--all-packages`

---

_Label `documentation` added by @zanieb on 2025-12-01 22:59_

---

_Assigned to @zanieb by @zanieb on 2025-12-01 22:59_

---

_Comment by @strugee on 2025-12-01 23:06_

@zanieb is there a strong case against making automatic syncs exact by default too? The issue we're running into in our development environment is that when you're juggling multiple workspace members, it's easy to run `uv sync` in one directory, have its deps populated into the venv, and then switch what you're working on to another workspace member - only to have extraneous deps in the venv that now affect IDE completions, and will be successful locally but fail in a freshly-built venv in production.

---

_Comment by @strugee on 2025-12-01 23:07_

If there's e.g. potential performance issues then this totally makes sense to me to keep automatic syncing inexact, but if not this seems like an unnecessary footgun. (Though, maybe I'm just biased from the current version of the docs.)

---

_Comment by @zanieb on 2025-12-01 23:12_

It's not really about performance no, it's just about people's expectations. There are people that will manually mutate the environment, e.g., `uv pip install package`, and it'd be surprising for `uv run` to subsequently remove that package. They should use `uv run --with package` instead... but it's hard to teach people to use new workflows. The strong case against changing it now is that it'd be massively breaking and disruptive.

I think the ideal solution for your problem is that the IDE becomes workspace aware and just ignores `.venv` entirely and references hermetic isolated environments for each workspace member. We're working towards this.

I'd also like to encourage the use of `--isolated` for `uv run`, maybe making it easy for that to be the default.

---

_Comment by @strugee on 2025-12-02 19:55_

Ahh, ok, that makes at least some sense. Another short-term easy(?) fix that probably would have helped us, then, is a prominent warning in `uv run` that there are extra, undeclared dependencies still lingering in the venv. I can imagine people complaining about this if it's warning them about their usual workflow, though, so I don't know how easy it actually is.

---
