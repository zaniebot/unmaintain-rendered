```yaml
number: 6031
title: "`--universal` output incompatible with `requires-python`"
type: issue
state: open
author: blueraft
labels:
  - needs-decision
assignees: []
created_at: 2024-08-12T09:41:02Z
updated_at: 2026-01-06T20:38:21Z
url: https://github.com/astral-sh/uv/issues/6031
synced_at: 2026-01-10T03:11:31Z
```

# `--universal` output incompatible with `requires-python`

---

_Issue opened by @blueraft on 2024-08-12 09:41_

Simple MRE:

```
[project]
name = "foobar"
version = "0.1"
requires-python = ">=3.9"
dependencies = ["networkx"]
```

```console
â¯ uv pip compile pyproject.toml --universal
Resolved 1 package in 16ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml --universal
networkx==3.3
    # via foobar (pyproject.toml)
```

The output is not universal since `networkx==3.3` only supports `>=py3.10`.

```
â¯ uv pip install -r requirements.txt
  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because the current Python version (3.9.6) does not satisfy Python>=3.10 and networkx==3.3 depends on Python>=3.10, we can conclude that networkx==3.3 cannot be used.
      And because you require networkx==3.3, we can conclude that the requirements are unsatisfiable.
```

The lock file is correct though.

```
â¯ cat uv.lock
version = 1
requires-python = ">=3.9"

[[package]]
name = "foobar"
version = "0.1"
source = { editable = "." }
dependencies = [
    { name = "networkx" },
]

[[package]]
name = "networkx"
version = "3.2.1"
source = { registry = "https://pypi.org/simple" }
sdist = { url = "https://files.pythonhosted.org/packages/c4/80/a84676339aaae2f1cfdf9f418701dd634aef9cc76f708ef55c36ff39c3ca/networkx-3.2.1.tar.gz", hash = "sha256:9f1bb5cf3409bf324e0a722c20bdb4c20ee39bf1c30ce8ae499c8502b0b5e0c6", size = 2073928 }
wheels = [
    { url = "https://files.pythonhosted.org/packages/d5/f0/8fbc882ca80cf077f1b246c0e3c3465f7f415439bdea6b899f6b19f61f70/networkx-3.2.1-py3-none-any.whl", hash = "sha256:f18c69adc97877c42332c170849c96cefa91881c99a7cb3e95b7c659ebdc1ec2", size = 1647772 },
]
```

uv 0.2.35

---

_Comment by @blueraft on 2024-08-12 11:00_

Huh can't reproduce this anymore, I'll close this.

---

_Closed by @blueraft on 2024-08-12 11:00_

---

_Comment by @ibraheemdev on 2024-08-12 11:05_

I don't believe `--universal` reads `requires-python` from the input files, you have to specify `-p 3.9`. By default it will use the major and minor version of the current interpreter as a lower bound.

---

_Comment by @blueraft on 2024-08-12 11:11_

Oh that's why the resolution got fixed.

Is there a reason why it doesn't read the `requires-python` from the `pyproject.toml` file?

```
      --universal                                        Perform a universal resolution, attempting to generate a single `requirements.txt` output file that is compatible with all operating systems,
                                                         architectures, and Python implementations
```

The 'and Python implementations' gives me the impression that it'd be compatible with `requires-python` in the project metadata.

---

_Reopened by @blueraft on 2024-08-12 11:11_

---

_Comment by @zanieb on 2024-08-12 12:15_

I think we don't want `uv pip compile` to implicitly read a pyproject.toml but maybe if it's explicitly provided we _should_ use the metadata? I believe we discussed this previously cc @charliermarsh 

---

_Comment by @charliermarsh on 2024-08-12 14:36_

I'm a little hesitant to read from them but we can consider it.

---

_Comment by @blueraft on 2024-08-12 16:57_

Maybe only for `--universal`, since that's a uv only thing? 

---

_Comment by @charliermarsh on 2024-08-12 16:58_

I think it probably does make sense to pick a Python that meets the requires-python for all provided pyproject.toml files. 

---

_Comment by @blueraft on 2024-08-12 17:08_

Happy to make a PR for this if you decide to support it! 

---

_Label `needs-decision` added by @charliermarsh on 2024-08-22 01:03_

---

_Comment by @paveldikov on 2025-02-11 20:38_

+1 for this.

Being able to make multi-Python-version constraints/lock files is super useful, especially when ensuring build/test reproducibility on a library project that is being tested across a matrix of Python versions and OS platforms.

At the moment I am keeping a clunky algorithm for determining `--python-version` from `requires-python`, but I'd rather just let `uv` handle it for me.

---

_Comment by @zanieb on 2025-02-12 16:13_

Sort of a hack, but we could special case `--python-version requires-python` ðŸ¤” 

---

_Comment by @paveldikov on 2025-02-12 23:30_

Possibly, but why not as a default behaviour? It's a sensible expectation, and `uv lock` seems be doing this already.

(and, perhaps more compellingly: if it's made a default behaviour, it can be represented as a falsey/unset value, rather than a special-case magic string)

---

_Comment by @zanieb on 2025-02-13 04:41_

Because `pip` does not read metadata from the `pyproject.toml` (as a design goal) and reading that metadata implicitly in a "compatible" interface would be surprising to some users.

---

_Comment by @paveldikov on 2025-02-13 08:47_

It's not implicit because I'm passing `pyproject.toml` as an argument, and this is a usage that is already supported in `pip-tools`. And metadata is already being read (`project.{,optional-}dependencies`), so if anything, reading 'this' metadata but not that 'that' metadata is more jarring.

And `--universal` is already a `uv` innovation, so I think the surprise/astonishment element is probably diminished?

(FWIW, I have my workaround and it's fine for the time being -- I am comfortable with holding out for an elegant solution, but alas PEP 751 is some way away and the next best 'standard' thing is constraints files. This is why I am personally trying to refine our usage of constraints files in a way that it's at near-parity with structured lockfiles.)

---

_Comment by @BryceBeagle on 2026-01-06 20:38_

I'm also running into this. I tried using `requires-python` because the error message told me to, but it wasn't doing anything
```
      hint: While the active Python version is 3.10, the resolution failed for
      other Python versions supported by your project. Consider limiting your
      project's supported Python versions using `requires-python`
```

There's a specific interpreter version that my requirements are incompatible with, but I'm perfectly OK with `uv` trying to ignore it entirely. Even more, passing `--python-version` to `uv pip compile` doesn't seem to be doing anything (perhaps a separate issue?)

As a workaround, I've found that I can use
```toml
[tool.uv]
environments = [
  "sys_platform == 'linux' and python_version == '3.10'",
  "sys_platform == 'darwin' and python_version == '3.10'",
  "sys_platform == 'linux' and python_version == '3.11'",
  # etc
]
```
in my `pyproject.toml` to fit my exact `--universal`-ish needs and avoid the fork where my constraints don't resolve properly.

But since `python-requires` _doesn't_ work here, I think it would be a good idea to update the error message since it suggests something that doesn't work.

---
