<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv requires platform-specific wheels to be present, even on different platforms - astral-sh/uv #11573</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv requires platform-specific wheels to be present, even on different platforms</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11573">#11573</a>
        opened by <a href="https://github.com/Audiopolis">@Audiopolis</a>
        on 2025-02-17 08:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Audiopolis">@Audiopolis</a> on 2025-02-17 08:10</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm migrating from poetry to uv. I'm installing dependencies in a Dockerfile. My dependencies include a Windows-specific wheel that is covered in .dockerignore, so it won't be present during the installation. Poetry had no problem with this as the wheel was not going to be needed in the docker build anyway. However, uv exits:</p>
<pre><code>Creating virtual environment at: /.venv
error: Failed to generate package metadata for `gdal==3.9.2 @ path+wheels/GDAL-3.9.2-cp312-cp312-win_amd64.whl`
Caused by: Failed to read from the distribution cache
Caused by: failed to query metadata of file `/wheels/GDAL-3.9.2-cp312-cp312-win_amd64.whl`: No such file or directory (os error 2)
</code></pre>
<p>The command:</p>
<pre><code class="language-dockerfile">ENV PYTHON_VERSION=${PYTHON_VERSION} \
    VIRTUAL_ENV=&quot;path/to/.venv&quot; \
    PYTHONDONTWRITEBYTECODE=0 \
    UV_COMPILE_BYTECODE=1 \
    UV_LINK_MODE=copy \
    UV_CACHE_DIR=${UV_CACHE_DIR} \
    UV_LOCKED=1 \
    UV_PYTHON_PREFERENCE=only-system \
    UV_PYTHON_DOWNLOADS=never

RUN --mount=type=cache,target=${UV_CACHE_DIR} \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --no-default-groups --no-install-project --extra my-extra
</code></pre>
<p>This means I have to COPY the wheel into the build context, install deps (no wheel needed!), then remove the wheel again in the final build stage.</p>
<p>Is this the intended behavior?</p>
<h3>Platform</h3>
<p>python:3.12-slim docker image on Windows 10 x86_64</p>
<h3>Version</h3>
<p>0.6.0</p>
<h3>Python version</h3>
<p>3.12.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Audiopolis on 2025-02-17 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-17 14:48</div>
            <div class="timeline-body"><p>Can you use <code>UV_FROZEN=1</code> instead of <code>UV_LOCKED=1</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-18 01:49</div>
            <div class="timeline-body"><p>Yeah this is intentional, in a sense. <code>uv run --locked</code> (or <code>UV_LOCKED=1 uv run</code>) has to perform a resolution to verify that your dependencies are up-to-date. If you don't include that wheel, we can't resolve, and therefore can't vaidate the lockfile. Typically, you'd use <code>UV_FROZEN</code> instead here to skip that resolution step.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-02-18 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2025-02-18 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Audiopolis">@Audiopolis</a> on 2025-02-18 16:08</div>
            <div class="timeline-body"><p>That makes perfect sense. I should have known. Thank you.</p>
<hr />
<p>From: Charlie Marsh <em><strong>@</strong></em>.<em><strong>&gt;
Sent: Monday, February 17, 2025 21:50
To: astral-sh/uv ***@</strong></em>.<em><strong>&gt;
Cc: Audiopolis ***@</strong></em>.<em><strong>&gt;; Author ***@</strong></em>.***&gt;
Subject: Re: [astral-sh/uv] uv requires platform-specific wheels to be present, even on different platforms (Issue #11573)</p>
<p>Yeah this is intentional, in a sense. uv run --locked (or UV_LOCKED=1 uv run) has to perform a resolution to verify that your dependencies are up-to-date. If you don't include that wheel, we can't resolve, and therefore can't vaidate the lockfile. Typically, you'd use UV_FROZEN instead here to skip that resolution step.</p>
<p>—
Reply to this email directly, view it on GitHub<a href="https://github.com/astral-sh/uv/issues/11573#issuecomment-2664426883">https://github.com/astral-sh/uv/issues/11573#issuecomment-2664426883</a>, or unsubscribe<a href="https://github.com/notifications/unsubscribe-auth/AFKIWEVRTVN5MMSIP6IIX232QKGUFAVCNFSM6AAAAABXIWQE7SVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDMNRUGQZDMOBYGM">https://github.com/notifications/unsubscribe-auth/AFKIWEVRTVN5MMSIP6IIX232QKGUFAVCNFSM6AAAAABXIWQE7SVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDMNRUGQZDMOBYGM</a>.
You are receiving this because you authored the thread.Message ID: <em><strong>@</strong></em>.***&gt;</p>
<p>[charliermarsh]charliermarsh left a comment (astral-sh/uv#11573)<a href="https://github.com/astral-sh/uv/issues/11573#issuecomment-2664426883">https://github.com/astral-sh/uv/issues/11573#issuecomment-2664426883</a></p>
<p>Yeah this is intentional, in a sense. uv run --locked (or UV_LOCKED=1 uv run) has to perform a resolution to verify that your dependencies are up-to-date. If you don't include that wheel, we can't resolve, and therefore can't vaidate the lockfile. Typically, you'd use UV_FROZEN instead here to skip that resolution step.</p>
<p>—
Reply to this email directly, view it on GitHub<a href="https://github.com/astral-sh/uv/issues/11573#issuecomment-2664426883">https://github.com/astral-sh/uv/issues/11573#issuecomment-2664426883</a>, or unsubscribe<a href="https://github.com/notifications/unsubscribe-auth/AFKIWEVRTVN5MMSIP6IIX232QKGUFAVCNFSM6AAAAABXIWQE7SVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDMNRUGQZDMOBYGM">https://github.com/notifications/unsubscribe-auth/AFKIWEVRTVN5MMSIP6IIX232QKGUFAVCNFSM6AAAAABXIWQE7SVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDMNRUGQZDMOBYGM</a>.
You are receiving this because you authored the thread.Message ID: <em><strong>@</strong></em>.***&gt;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-19 02:08</div>
            <div class="timeline-body"><p>No worries at all. Happy to help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-19 02:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:00 UTC
    </footer>
</body>
</html>
