<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drop UV_STACK_SIZE in favour of RUST_MIN_STACK - astral-sh/uv #10367</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Drop UV_STACK_SIZE in favour of RUST_MIN_STACK</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10367">#10367</a>
        opened by <a href="https://github.com/Gankra">@Gankra</a>
        on 2025-01-07 14:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Gankra">@Gankra</a> on 2025-01-07 14:52</div>
            <div class="timeline-body"><p><a href="https://doc.rust-lang.org/std/thread/#stack-size">RUST_MIN_STACK</a> is fairly obscure and barely documented but it does exist specifically to do exactly what UV_STACK_SIZE does (it would affect <em>all</em> non-main threads and not just tokio threads, but the fact that we only resize tokio threads is not really intentional so much as Convenient).</p>
<p>Alternatively: it's really unclear why we need to set the stack size specifically on Windows. All information I can find suggests Rust already forces Windows, macOS, and Linux to all use 2MiB stacks for non-main-threads by default (and UV_STACK_SIZE doesn't affect the main thread).</p>
<p>Unfortunately there's a ton of possibilities:</p>
<ul>
<li>Newer versions of Rust fixed this and we don't actually need it anymore?</li>
<li>Windows wastes more of your stack space with OS-internal datastructures (like the TEB)?</li>
<li>Some platform-specific types are weirdly bigger on Windows?</li>
<li>Windows' ABI/codegen forces more stackspills bloating the stack way more?</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @zanieb on 2025-01-07 15:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-01-08 09:50</div>
            <div class="timeline-body"><p>Another consideration is that usually the main thread overflowed, which afaik gets built by the OS instead of rust.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10479.html">astral-sh/uv#10479</a> on 2025-01-10 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Gankra on 2025-01-15 03:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Gankra on 2025-01-15 03:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
