<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Feature Request] allow exporting virtual environments - astral-sh/uv #6970</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Feature Request] allow exporting virtual environments</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6970">#6970</a>
        opened by <a href="https://github.com/danielgafni">@danielgafni</a>
        on 2024-09-03 14:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/danielgafni">@danielgafni</a> on 2024-09-03 14:45</div>
            <div class="timeline-body"><p>It would be great if <code>uv</code> provided a way to export virtual environments to some formats like <code>.tar.gz</code>.</p>
<p>This is useful when preparing environments for <a href="https://spark.apache.org/docs/latest/api/python/user_guide/python_packaging.html#using-virtualenv">PySpark</a>.</p>
<p><a href="https://github.com/jcrist/venv-pack">venv-pack</a> is a tool which does exactly that, but it's painfully slow. I'm sure <code>uv</code> could do the same task in a fraction of what it takes for <code>venv-pack</code> :crab:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2024-09-06 15:40</div>
            <div class="timeline-body"><p>That's exactly the use case that made me contribute <code>uv venv --relocatable</code> :-) all that is missing is the archival/compression which in your case is a simple <code>tar czf</code> of the finished venv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2024-09-06 18:32</div>
            <div class="timeline-body"><p>I did notice the relocatable flag and used it. That's really nice! I guess all what's missing is a bunch of ergonomics and docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2024-10-02 11:44</div>
            <div class="timeline-body"><p>Hey, getting back to this...
It doesn't seem like the <code>--relocatable </code> flag is working as expected.</p>
<pre><code class="language-shell">❯ uv venv --relocatable
Using CPython 3.11.9
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
❯ cd ./.venv/bin         
❯ ls -lh
total 44K
-rw-r--r-- 1 dan dan 3.7K Oct  2 13:42 activate
-rw-r--r-- 1 dan dan 2.2K Oct  2 13:42 activate.bat
-rw-r--r-- 1 dan dan 2.6K Oct  2 13:42 activate.csh
-rw-r--r-- 1 dan dan 4.2K Oct  2 13:42 activate.fish
-rw-r--r-- 1 dan dan 3.8K Oct  2 13:42 activate.nu
-rw-r--r-- 1 dan dan 2.8K Oct  2 13:42 activate.ps1
-rw-r--r-- 1 dan dan 2.4K Oct  2 13:42 activate_this.py
-rw-r--r-- 1 dan dan 1.7K Oct  2 13:42 deactivate.bat
-rw-r--r-- 1 dan dan 1.2K Oct  2 13:42 pydoc.bat
lrwxrwxrwx 1 dan dan   79 Oct  2 13:42 python -&gt; /home/dan/.local/share/uv/python/cpython-3.11.9-linux-x86_64-gnu/bin/python3.11
lrwxrwxrwx 1 dan dan    6 Oct  2 13:42 python3 -&gt; python
lrwxrwxrwx 1 dan dan    6 Oct  2 13:42 python3.11 -&gt; python
</code></pre>
<p>Looks like the <code>python</code> executable is a symlink (which is not exactly relocatable).</p>
<p>Is there anything I'm missing here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7865.html">astral-sh/uv#7865</a> on 2024-10-02 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-10-02 15:27</div>
            <div class="timeline-body"><p>I think relocatable currently covers this use case: you rename the project folder, like if project1 is now project1.1. I don't think it does more. Without --relocatable, even that breaks (absolute paths in .venv/bin/ executable stubs break)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-02 15:32</div>
            <div class="timeline-body"><p>Yeah we don't support bundling the interpreter in the environment yet, but want to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2024-10-03 10:58</div>
            <div class="timeline-body"><p>Yes, that's right, this was not part of the initial use case that drove me to add <code>--relocatable</code> -- I was happy to take the base interpreter installation for granted.</p>
<p>This works very well for distribution formats like RPM or DEB (where you can register a dependency on a base Python package) but not at all end-user/desktop installs (whereby a system-wide Python installation is not expected or even desirable).</p>
<p>Some more thoughts on how one could solve the end-user-redistributability use case from first principles:</p>
<p><strong>On terminology/semantics</strong>: by the time you bundle an interpreter with the virtual environment it's arguably no longer <em>'virtual'</em>. Rather what you have is a fully fledged Python installation (could indeed be one coming from <code>uv python install</code>), that you are augmenting with further packages installed <em>at system-site-packages-level</em>.</p>
<p>So, this is mostly already achievable using stock <code>uv</code> functionality -- it's <code>uv python install</code> followed by <code>uv pip install --system</code>. The only problem here is the relocatable entrypoints. Currently the only user-facing way to generate relocatable entrypoint scripts is by using <code>uv venv --relocatable</code>... but in this case there is no venv at all! So there is no way to propagate the <code>relocatable: true</code> argument all the way down to the wheel installer.</p>
<p>A few options seem to naturally come out of this:</p>
<ul>
<li><code>uv package</code> command that does a fully opinionated one-stop-shop thing.<ul>
<li>Pros: simplest UX.</li>
<li>Cons: this would probably be strongly-coupled to <code>uv python install</code>, which is currently really enterprise-unfriendly (in a lot of regulated enterprises, downloading arbitrary Python binaries direct from GitHub is a fireable offence)</li>
</ul>
</li>
<li><code>uv pip install --system</code> could imply <code>relocatable: true</code>.<ul>
<li>Pros: this lines up with Python binary distributions already being relocatable -- if <code>python{,.exe}</code> is relocatable then it makes a lot of sense its sibling/dependent scripts to also be relocatable.</li>
<li>Cons: is this an implicit behaviour we are comfortable with? Relocatable entrypoints do have a few corner cases e.g. #6489 which means that there is a minor loss of compatibility.</li>
</ul>
</li>
<li>Add <code>--relocatable</code> param to <code>uv pip install</code><ul>
<li>Pros: low level control</li>
<li>Cons: fragmented UX?</li>
</ul>
</li>
<li>Deliberately ignore the 'virtual' semantics and implement a mode of <code>uv venv</code> that actually completely clones the interpreter in its entirety.<ul>
<li>Pros: UX remains consistent. And we maintain a decent level of low-level control for power users.</li>
<li>Cons: can we live with this breach of semantics?</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-10-03 22:37</div>
            <div class="timeline-body"><p>Thanks for brainstorming this @paveldikov. I think this would be a killer feature especially for offline environment deployments. I expect <code>--relocatable</code> allows one to move a venv anywhere on the file system and still function, is that correct?</p>
<p>Symlinks are somewhat tricky on Windows since they can require elevation to make them (unlike hardlinks) which isn't usually available in enterprise environments, so hopefully <code>--relocatable</code> doesn't depend on symlinks for the Windows implementation. This would have implications for Windows because hardlinks are only valid within the same file system, unlike symlinks which can span file systems since they just point to the other file.</p>
<p>I think <code>--with-python</code> and <code>--with-uv</code> or <code>--with uv,python</code> or <code>--with uv --with python</code> would be awesome options to add for <code>uv venv</code> since these flags would let someone move the venv onto another computer that might not have python or uv installed at all. This is somewhat the inverse of options that <code>virtualenv</code> provides such as <code>--no-pip</code>, <code>--no-wheel</code> and <code>--no-setuptools</code>. <a href="https://virtualenv.pypa.io/en/latest/cli_interface.html">See here</a>.</p>
<p>Maybe there could also be another flag so that one can target additional platforms that the venv should function in. By default, it targets the current platform, but it would be nice to create a venv that also grabs the wheels necessary for a different platform so that the venv could be moved there and still function. I think it would be a powerful feature, but I don't know what the API would look like, maybe <code>--platform current,win_amd64,win32,macosx_10_12_x86_64,...</code> or <code>--platform win --platform macosx</code> with <code>--platform current</code> being the implied default? If many platforms are specified, I would also expect it to apply to other options such as <code>--with-python</code> and <code>--with-uv</code> (i.e., the <code>python</code> and <code>uv</code> binaries for all specified platforms should be in the venv too).</p>
<p><code>--platform all</code> would be nice too, for a universal (and gigantic) venv. Cosmopolitan python anyone?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-10-03 22:50</div>
            <div class="timeline-body"><blockquote>
<p>Cons: this would probably be strongly-coupled to uv python install, which is currently really enterprise-unfriendly (in a lot of regulated enterprises, downloading arbitrary Python binaries direct from GitHub is a fireable offence)</p>
</blockquote>
<p>I think it would be cool if uv just bundled the latest python interpreter inside the respective <code>uv</code> platform binary for bootstrapping purposes, but not sure how the Astral team would feel about this or if it makes sense without having the rest of the standard library.</p>
<blockquote>
<p>Deliberately ignore the 'virtual' semantics and implement a mode of uv venv that actually completely clones the interpreter in its entirety.</p>
</blockquote>
<p>I think this option makes the most sense to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-03 23:50</div>
            <div class="timeline-body"><blockquote>
<p>downloading arbitrary Python binaries direct from GitHub is a fireable offence</p>
</blockquote>
<p>For what it's worth, we're maintaining those binaries — they're not arbitrary. How's uv being installed? Isn't that a binary from GitHub? Note there's a <code>UV_PYTHON_INSTALL_MIRROR</code> which allows you to download from an internal mirror of the binaries.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-03 23:51</div>
            <div class="timeline-body"><p>I also think we can only create environments with a bundled Python interpreter if the interpreter itself is relocatable, i.e., it would need to be one of our managed Python interpreters not an arbitrary system interpreter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2024-10-04 08:07</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>downloading arbitrary Python binaries direct from GitHub is a fireable offence</p>
</blockquote>
<p>For what it's worth, we're maintaining those binaries — they're not arbitrary. How's uv being installed? Isn't that a binary from GitHub? Note there's a <code>UV_PYTHON_INSTALL_MIRROR</code> which allows you to download from an internal mirror of the binaries.</p>
</blockquote>
<p>Oh, by arbitrary I meant 'unapproved' -- no slight intended, it's just that it doesn't fall under a use case that is known and expressly permitted.</p>
<p>It is quite common for enterprises to deploy scanning proxies of various kinds (cf. #5260) -- downloading direct from github.com or pypi.org is considered a breach of policy as you'd be bypassing said proxy. In fact in most cases you wouldn't even have direct connectivity to github.com or pypi.org as these would be blocked at firewall level.</p>
<p>Actually I was not aware of <code>UV_PYTHON_INSTALL_MIRROR</code> -- I am curious, is this also exposed in <code>uv.toml</code>? It does actually make a significant difference -- enterprises could use it to benefit from <code>uv python</code> in a way that still falls under existing/well-understood control implementations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8186.html">astral-sh/uv#8186</a> on 2024-10-15 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8653.html">astral-sh/uv#8653</a> on 2024-11-07 01:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13097.html">astral-sh/uv#13097</a> on 2025-04-25 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13304.html">astral-sh/uv#13304</a> on 2025-05-05 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2389.html">astral-sh/uv#2389</a> on 2025-06-11 11:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jlevy">@jlevy</a> on 2025-06-16 21:47</div>
            <div class="timeline-body"><p>I only now saw this issue. But I looked at this a few weeks ago as I wanted to make a self-contained, relocatable install directory with a given set of dependencies. It's a bit like a uv-powered PyInstaller:</p>
<p>https://github.com/jlevy/py-app-standalone</p>
<p>I think this covers much this use case (see the readme) so am curious if anyone tries it or finds it useful. I didn't try to handle alternate or enterprise-approved mirrors but am sure it could be adapted to support that better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jlevy">@jlevy</a> on 2025-06-16 21:55</div>
            <div class="timeline-body"><p>Thinking a little more, @paveldikov you may find it of interest as it takes the last approach you mention above. By eliminating the symlinks, using relocatable shebangs for all scripts, and also rewriting the macos dylib, you get a fully relocatable standalone directory. If you make the source of the Python install pluggable (e.g. accept a general uv version or a link to an enterprise-approved version) and the package mirror settable, I think it could give you everything you want?</p>
<p>And @zanieb perhaps you already know this, but it seemed like it was only a small patch on macos to make the uv python install relocatable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14602.html">astral-sh/uv#14602</a> on 2025-07-14 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jeffmelville">@jeffmelville</a> on 2025-11-11 21:37</div>
            <div class="timeline-body"><p>To hop on this thread, a Python-only uv variant of <a href="https://pixi.sh/v0.45.0/deployment/pixi_pack/">pixi-pack</a> (or the old conda-pack) would be a great model for the offline deployments I do</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16973.html">astral-sh/uv#16973</a> on 2025-12-03 19:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:38 UTC
    </footer>
</body>
</html>
