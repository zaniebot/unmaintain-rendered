<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv hangs when PyPI is timing out, even when installing a local wheel with all dependencies being met - astral-sh/uv #7579</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv hangs when PyPI is timing out, even when installing a local wheel with all dependencies being met</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/7579">#7579</a>
        opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a>
        on 2024-09-20 10:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-09-20 10:29</div>
            <div class="timeline-body"><p>A few days ago, <code>uv pip install ...</code> just got stuck for me because <code>https://pypi.org/simple/lxml/</code> was timing out.</p>
<p>I was reinstalling a package from a local wheel file, and the required lxml version (and all other deps) were already installed, so I'm not sure why it even needs to perform any network requests there at all.</p>
<p><code>--no-deps</code> worked to avoid hanging, but it feels like a bug that an unresponsive PyPI server breaks anything in this particular case.</p>
<p>In case it's useful (I doubt it, since the problem is likely the fact that the response takes a long time and not that it's an error response), this is what PyPI replied on that day:</p>
<pre><code>$ http -phHbB get https://pypi.org/simple/lxml/
GET /simple/lxml/ HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
Host: pypi.org
User-Agent: HTTPie/3.2.3



HTTP/1.1 503 Timed out while waiting
Connection: close
Content-Type: text/plain;charset=US-ASCII
Fastly-Host: cache-par-lfpg1960051-PAR
Server: Varnish
date: Mon, 16 Sep 2024 22:45:11 GMT
transfer-encoding: chunked

Timed out while waiting on cache-par-lfpg1960051-PAR
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-24 12:21</div>
            <div class="timeline-body"><p>Likely because we need to get the latest list of versions from the registry. Even if something is cached, we generally need to do this, since there could be a newer version of a given dependency available on the registry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-09-24 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-09-24 12:22</div>
            <div class="timeline-body"><p>Why does it matter if there's a newer version when I don't ask uv to upgrade anything via <code>-U</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-24 12:53</div>
            <div class="timeline-body"><p>I can come up with examples where it would be necessary but it depends on more context. Can you explain in more detail the command you ran, and the state of the environment at the time? If lxml is installed and you run uv pip install lxml, we shouldnâ€™t be hitting the registry at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-09-24 12:59</div>
            <div class="timeline-body"><p>I built an updated wheel of my application (w/o touching any of its dependencies which are <em>all</em> pinned to exact versions), and wanted to install that in my env (where the previous version of my wheel was already installed) using <code>uv pip install myapp-whatever.whl</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-24 15:28</div>
            <div class="timeline-body"><p>I think it's probably possible to make that succeed (especially with pinned versions), though it would require some non-trivial refactors (we'd have to move from &quot;get package metadata, then version metadata&quot; to &quot;get version metadata if already installed, continue if that version works, otherwise get package metadata, then version metadata&quot;). Worth keeping the issue open.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2024-09-24 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-09-24 15:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:53 UTC
    </footer>
</body>
</html>
