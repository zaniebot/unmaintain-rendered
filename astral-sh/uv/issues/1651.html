<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install` does not install any new dependencies - astral-sh/uv #1651</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip install</code> does not install any new dependencies</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1651">#1651</a>
        opened by <a href="https://github.com/skshetry">@skshetry</a>
        on 2024-02-18 15:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/skshetry">@skshetry</a></div>
            <div class="timeline-body"><p>Let's say I have a project with the following dependencies, and installed the package using:</p>
<pre><code class="language-console">cat pyproject.toml
uv pip install -e &quot;.&quot;
</code></pre>
<pre><code class="language-toml"># pyproject.toml

[project]
name = &quot;test-project&quot;
version = &quot;0.0.1&quot;
dependencies = [&quot;fsspec&quot;]
</code></pre>
<p>And, later if I add any new dependencies, doing <code>uv pip install -e &quot;.&quot;</code> does not pick new dependencies and/or install them, unless I pass <code>--upgrade</code>.</p>
<pre><code class="language-toml">[project]
name = &quot;test-project&quot;
version = &quot;0.0.1&quot;
dependencies = [&quot;fsspec&quot;, &quot;s3fs&quot;]
</code></pre>
<pre><code class="language-console">$ uv pip install -e &quot;.&quot;
Audited 1 package in 3ms
</code></pre>
<pre><code class="language-console">$ uv pip install -e &quot;.&quot; --upgrade
   Built file:///private/var/folders/xh/trg29z296h70n109kwfk6g800000gn/T/tmp.tP1hZ9RVUH                                                Built 1 editable in 1.00s
Resolved 18 packages in 685ms
Downloaded 5 packages in 142ms
Installed 17 packages in 79ms
 + aiobotocore==2.11.2
 + aiohttp==3.9.3
 + aioitertools==0.11.0
 + aiosignal==1.3.1
 + attrs==23.2.0
 + botocore==1.34.34
 + frozenlist==1.4.1
 + idna==3.6
 + jmespath==1.0.1
 + multidict==6.0.5
 + python-dateutil==2.8.2
 + s3fs==2024.2.0
 + six==1.16.0
 - test-project==0.0.1 (from file:///private/var/folders/xh/trg29z296h70n109kwfk6g800000gn/T/tmp.tP1hZ9RVUH)
 + test-project==0.0.1 (from file:///private/var/folders/xh/trg29z296h70n109kwfk6g800000gn/T/tmp.tP1hZ9RVUH)
 + urllib3==2.0.7
 + wrapt==1.16.0
 + yarl==1.9.4
</code></pre>
<p>This differs from <code>pip install</code> behaviour.</p>
<h3><code>uv version</code></h3>
<pre><code class="language-console">uv --version
uv 0.1.4
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-18 15:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-18 15:07</div>
            <div class="timeline-body"><p>Agree that this should behave as you describe. I can't remember off-hand if this is due to a caching thing or something else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/agriyakhetarpal">@agriyakhetarpal</a> on 2024-02-18 18:36</div>
            <div class="timeline-body"><p>I am currently facing the same issue, but in other ways. It seems as if <code>uv</code> is auditing the installation of a package based on the metadata stored in the <code>&lt;mypackage&gt;.dist-info</code> directoryÂ â€“ which is why if I delete the <code>&lt;mypackage&gt;</code> directory from a virtual environment, it successfully audits <mypackage> based on the metadata directory's contents and believes that <code>&lt;mypackage&gt;</code> is still installed. Of course, this isn't recommended behaviour (deleting a package's installation from the virtual environment, that is) and this problem is in-line with what <code>pip</code> itself does (I should probably open an issue there as well).</p>
<p>A potential solution to mitigate this problem could be to store the checksums of the <code>pyproject.toml</code>/<code>setup.py</code>/<code>setup.cfg</code> files in the <code>uv</code> cache and validate them at the time of the audit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielhollas">@danielhollas</a> on 2024-02-26 16:00</div>
            <div class="timeline-body"><p>I think this is fixed in version 0.1.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/skshetry">@skshetry</a> on 2024-02-26 16:05</div>
            <div class="timeline-body"><p>I'll check when it gets released. Thanks. ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/skshetry">@skshetry</a> on 2024-02-26 16:19</div>
            <div class="timeline-body"><p>The editable issue seems to be fixed, but it does not work for non-editable installs yet. :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 16:30</div>
            <div class="timeline-body"><p>@skshetry - Can you provide the exact repro for non-editable installs, just so I can track what isn't working?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/skshetry">@skshetry</a> on 2024-02-26 16:35</div>
            <div class="timeline-body"><pre><code class="language-console">cat pyproject.toml
uv pip install &quot;test-project @ .&quot;
</code></pre>
<pre><code class="language-toml">[project]
name = &quot;test-project&quot;
version = &quot;0.0.1&quot;
dependencies = [&quot;fsspec&quot;]
</code></pre>
<p>After I add a dependency, say, <code>s3fs</code>, and run the above script again, it does not install new dependencies unless I add <code>--upgrade</code>.</p>
<pre><code>cat pyproject.toml
uv pip install &quot;test-project @ .&quot;
</code></pre>
<pre><code class="language-toml">[project]
name = &quot;test-project&quot;
version = &quot;0.0.1&quot;
dependencies = [&quot;fsspec&quot;, &quot;s3fs&quot;]
</code></pre>
<pre><code class="language-console">$ uv pip install &quot;test-project @ .&quot;
Audited 1 package in 3ms

$ uv pip install &quot;test-project @ .&quot; --upgrade                                                                                    
Resolved 18 packages in 1.80s
   Built test-project @ file:///private/var/folders/xh/trg29z296h70n109kwfk6g800000gn/T/tmp.MLCVX8rwMP                                 Downloaded 1 package in 1.15s
Installed 17 packages in 66ms
 + aiobotocore==2.11.2
 + aiohttp==3.9.3
 + aioitertools==0.11.0
 + aiosignal==1.3.1
 + attrs==23.2.0
 + botocore==1.34.34
 + frozenlist==1.4.1
 + idna==3.6
 + jmespath==1.0.1
 + multidict==6.0.5
 + python-dateutil==2.8.2
 + s3fs==2024.2.0
 + six==1.16.0
 - test-project==0.0.1 (from file:///private/var/folders/xh/trg29z296h70n109kwfk6g800000gn/T/tmp.MLCVX8rwMP)
 + test-project==0.0.1 (from file:///private/var/folders/xh/trg29z296h70n109kwfk6g800000gn/T/tmp.MLCVX8rwMP)
 + urllib3==2.0.7
 + wrapt==1.16.0
 + yarl==1.9.4
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-03-04 01:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-04 19:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:23:45 UTC
    </footer>
</body>
</html>
