<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat/fix: Make `uv` work better with Nix - astral-sh/uv #16106</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat/fix: Make <code>uv</code> work better with Nix</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16106">#16106</a>
        opened by <a href="https://github.com/gabyx">@gabyx</a>
        on 2025-10-02 19:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gabyx">@gabyx</a></div>
            <div class="timeline-body">Summary
<p>This is a rephrasal of the #15709 to explain the core underlying problem when using <code>uv</code> in a Nix environement.</p>
<p><strong>The culprit is that Nix python executables are sometimes wrapped.</strong></p>
<p>I try to explain in simple terms (as good as I can ;)</p>
<p>Wrapped means: The user calls <code>python-A</code>  which will call <code>python-raw</code>.</p>
<ul>
<li><code>python-A</code> is the interpreter (although wrapped) with which you want to build a virtual environment.</li>
<li><code>python-A</code> is a C compiled wrapper to set additional env. variables  <strong>before calling <code>python-raw</code></strong> (which is (mostly) the pure interpreter)</li>
</ul>
<blockquote>
<p>[!NOTE]</p>
<p>The <code>python-A</code> arises from a Nix expressions like <code>python3_13.withPackages { p: [ p.pyyaml ] }</code>.</p>
</blockquote>
<p>What we want:</p>
<ul>
<li>Tell <code>uv</code> to really use <code>python-A</code> as the &quot;base executable for virtual environments&quot;.</li>
</ul>
<p>The above can be tried with no success:</p>
<pre><code>uv venv -vv --python=&quot;/nix/store/g0drgy172i4msg6vvkkm241djwam3x49-python3-3.13.7-env/bin/python&quot;
</code></pre>
<blockquote>
<p>[!NOTE]</p>
<p><code>/nix/store/g0drgy172i4msg6vvkkm241djwam3x49-python3-3.13.7-env/bin/python</code> is the <code>python-A</code> executable.</p>
</blockquote>
<pre><code>DEBUG uv 0.8.14
DEBUG Found project root: `/persist/repos/dac-portal/tests/playwright`
DEBUG No workspace root found, using project root
DEBUG Using Python request `/nix/store/g0drgy172i4msg6vvkkm241djwam3x49-python3-3.13.7-env/bin/python` from explicit request
DEBUG Checking for Python interpreter at path `/nix/store/g0drgy172i4msg6vvkkm241djwam3x49-python3-3.13.7-env/bin/python`
TRACE Querying interpreter executable at /nix/store/g0drgy172i4msg6vvkkm241djwam3x49-python3-3.13.7-env/bin/python
Using CPython 3.13.7 interpreter at: /nix/store/g0drgy172i4msg6vvkkm241djwam3x49-python3-3.13.7-env/bin/python3.13
Creating virtual environment at: .devenv/state/venv

DEBUG Using base executable for virtual environment: /nix/store/829wb290i87wngxlh404klwxql5v18p4-python3-3.13.7/bin/python
</code></pre>
<p><strong>which uses now <code>/nix/store/829wb290i87wngxlh404klwxql5v18p4-python3-3.13.7/bin/python</code></strong></p>
<p>This is due to:</p>
<ol>
<li><code>python-raw</code> beeing called by <code>get_interpreter_info.py</code> which reports <code>sys_base_executbale = python-raw</code>.</li>
</ol>
<p><strong>The question to astral is now how can <code>uv</code> still call <code>get_interpreter_info.py</code>  (cause you rely on this for other attributes etc)
but also give Nix a workaround to overwrite the base executable?</strong></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/gabyx">@gabyx</a> on 2025-10-02 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Make `uv` work better with Nix&quot; to &quot;feat/fix: Make `uv` work better with Nix&quot; by <a href="https://github.com/gabyx">@gabyx</a> on 2025-10-02 19:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:32 UTC
    </footer>
</body>
</html>
