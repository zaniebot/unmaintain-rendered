<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv lock keeps trailing `/` on Linux, but omits on macOS - astral-sh/uv #13707</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv lock keeps trailing <code>/</code> on Linux, but omits on macOS</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13707">#13707</a>
        opened by <a href="https://github.com/ivanychev">@ivanychev</a>
        on 2025-05-28 20:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ivanychev">@ivanychev</a></div>
            <div class="timeline-body">Summary
<p>Hey! Thanks for amazing work and this very useful project. I&#x27;m facing behavior where local macOS <code>uv lock</code> generates a different lock file from what is done on Linux.</p>
<p>My <code>pyproject.toml</code> file contains</p>
<pre><code>[[tool.uv.index]]
name = &quot;mycompany&quot;
url = &quot;https://mycompany-123.d.codeartifact.us-east-1.amazonaws.com/pypi/mycompany/simple/&quot;
default = true
authenticate = &quot;always&quot;
</code></pre>
<p>and when executing <code>uv lock</code> on macOS, it contains entries like</p>
<pre><code>[[package]]
name = &quot;tomli&quot;
version = &quot;2.2.1&quot;
source = { registry = &quot;https://mycompany-123.d.codeartifact.us-east-1.amazonaws.com/pypi/mycompany/simple&quot; }
</code></pre>
<p>However, when doing</p>
<pre><code>uv sync --extra torch-gpu --locked --no-dev --no-install-project
</code></pre>
<p>during Docker build on Ubuntu 22.04 with same uv version, it fails because it tries to change the lock file. The <code>diff -u</code> showed this:</p>
<pre><code>-source = { registry = &quot;https://mycompany-123.d.codeartifact.us-east-1.amazonaws.com/pypi/mycompany/simple/&quot; }
+source = { registry = &quot;https://mycompany-123.d.codeartifact.us-east-1.amazonaws.com/pypi/mycompany/simple&quot; }
</code></pre>
<p>During docker build, I have <code>UV_INDEX_MYCOMPANY_USERNAME</code> and <code>UV_INDEX_MYCOMPANY_PASSWORD</code> specified.</p>
<p>Do you have any idea what might have gone wrong here?</p>
Platform
<p>macOS 15.5 and Ubuntu 22.04</p>
Version
<p>0.7.8</p>
Python version
<p>3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ivanychev">@ivanychev</a> on 2025-05-28 20:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-30 03:55</div>
            <div class="timeline-body"><p>Can you include the verbose output of <code>uv sync --extra torch-gpu --locked --no-dev --no-install-project</code>? There might be something else going on here. There should be a line that indicates &quot;why&quot; the <code>--locked</code> fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lucas-m-1">@lucas-m-1</a> on 2025-06-18 13:00</div>
            <div class="timeline-body"><p>I&#x27;ve got an additional issue, maybe related to this. On my machine (Ubuntu 22.04) I get different results (trailing slashes or not on the https://) when using <code>uv sync</code> or the pre-commit hook <code>uv-sync</code> from https://github.com/astral-sh/uv-pre-commit. There is obviously something wrong going on here, and it might be better to normalize everywhere...</p>
<p>Version: 0.7.13 for both local and pre-commit</p>
<p>Python version: 3.12</p>
<hr>
<p>Nevermind that came from my setting <code>UV_EXTRA_INDEX_URL=https://pypi.org/simple/</code>
Might be nice to normalize still ðŸ˜ƒ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/jtfmumm">@jtfmumm</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-20 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-24 07:04</div>
            <div class="timeline-body"><p>Following up on this, @ivanychev if this is still an issue for you, would it be possible to share the verbose output of <code>uv sync --extra torch-gpu --locked --no-dev --no-install-project</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-24 07:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ivanychev">@ivanychev</a> on 2025-06-24 10:23</div>
            <div class="timeline-body"><p>Let me know if I could share anything else helpful. Our <code>pyproject.toml</code> has</p>
<pre><code>[[tool.uv.index]]
name = &quot;constructor&quot;
url = &quot;https://constructor-012345.d.codeartifact.us-east-1.amazonaws.com/pypi/mycompany/simple/&quot;
default = true
authenticate = &quot;always&quot;
</code></pre>
<p>but we sometimes lock with</p>
<pre><code>export UV_DEFAULT_INDEX=https://constructor-012345.d.codeartifact.us-east-1.amazonaws.com/pypi/mycompany/simple
</code></pre>
<p>The script that fails doesn&#x27;t have <code>UV_DEFAULT_INDEX</code> set but has <code>UV_INDEX_MYCOMPANY_USERNAME</code>, <code>UV_INDEX_MYCOMPANY_PASSWORD</code>. Maybe that&#x27;s the issue â€” I can fix our <code>UV_DEFAULT_INDEX</code> or <code>pyproject.toml</code> to both have trailing <code>/</code> or not, but I&#x27;d like to understand if it&#x27;s default behavior that these urls are not normalized or not. IIUC the actual implementation does normalization somewhere because both urls work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-24 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-24 14:42</div>
            <div class="timeline-body"><p>Thanks for sharing more detail @ivanychev. I don&#x27;t think this is related to macOS/Linux differences, but is just a matter of uv using the exact URL you provided (as you indicate in your last comment about using <code>UV_DEFAULT_INDEX</code> sometimes). I&#x27;ll look into normalizing the URL in the lockfile to prevent this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ivanychev">@ivanychev</a> on 2025-06-24 17:58</div>
            <div class="timeline-body"><p>Thanks a lot @jtfmumm !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-06-27 15:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:51 UTC
    </footer>
</body>
</html>
