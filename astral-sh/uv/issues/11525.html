<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>git bisect like feature for updating lock files - astral-sh/uv #11525</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>git bisect like feature for updating lock files</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11525">#11525</a>
        opened by <a href="https://github.com/gaborbernat">@gaborbernat</a>
        on 2025-02-14 21:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gaborbernat">@gaborbernat</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Sometimes when you refresh your lock file you find out that your app/test suite broke. There's today no easy way today to quickly identify what (combination or single) dependency caused your application to break. It would be great if <code>uv lock --update --step-wise</code> would in this cases update one dependency at a time, giving the opportunity to the caller to run a test suite in between. When the test suite fails the latest change could help to quickly pinpoint to the faulty upgrade.</p>
<h3>Example</h3>
<pre><code>uv lock --update --step-wise --test-command 'pytest --cool'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @gaborbernat on 2025-02-14 21:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @zanieb on 2025-02-14 21:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2025-02-14 21:21</div>
            <div class="timeline-body"><p>From @zanieb, AI wrote a script, probably not something we can priortize in uv itself for quite some time</p>
<pre><code class="language-python">import subprocess
import sys
import re
from typing import List, Optional


def run_command(cmd: List[str]) -&gt; tuple[bool, str]:
    &quot;&quot;&quot;
    Run a command and return whether it succeeded and its output.
    &quot;&quot;&quot;
    try:
        result = subprocess.run(cmd, capture_output=True, text=True)
        return result.returncode == 0, result.stdout + result.stderr
    except Exception as e:
        return False, str(e)


def get_top_level_packages() -&gt; set[str]:
    &quot;&quot;&quot;
    Parse the output of 'uv tree' to get top-level packages.
    &quot;&quot;&quot;
    success, output = run_command([&quot;uv&quot;, &quot;tree&quot;])
    if not success:
        print(f&quot;Error running 'uv tree': {output}&quot;)
        sys.exit(1)

    packages = set()
    # Skip the project name
    for line in output.splitlines()[1:]:
        # Look for lines that start with '└──' or '├──'
        if line.strip().startswith((&quot;└──&quot;, &quot;├──&quot;)):
            # Extract package name and version
            match = re.search(r&quot;[└├]── ([a-zA-Z0-9\-_]+) v&quot;, line)
            if match:
                packages.add(match.group(1))

    return packages


def update_package(package: str, post_update_cmd: Optional[List[str]]) -&gt; bool:
    &quot;&quot;&quot;
    Update a single package using uv lock and run post-update command if provided.
    Returns True if all operations succeeded.
    &quot;&quot;&quot;
    print(f&quot;\nUpdating {package}...&quot;)

    # Run uv lock --upgrade-package
    success, output = run_command([&quot;uv&quot;, &quot;lock&quot;, &quot;--upgrade-package&quot;, package])
    if not success:
        print(f&quot;Failed to update {package}:&quot;)
        print(output)
        return False

    print(f&quot;Successfully updated {package}&quot;)

    # Run post-update command if provided
    if post_update_cmd:
        print(f&quot;Running post-update command: {' '.join(post_update_cmd)}&quot;)
        success, output = run_command(post_update_cmd)
        if not success:
            print(f&quot;Post-update command failed:&quot;)
            print(output)
            return False
        print(&quot;Post-update command succeeded&quot;)

    return True


def main():
    # Get post-update command from command line arguments
    post_update_cmd = sys.argv[1:] if len(sys.argv) &gt; 1 else None

    if not post_update_cmd:
        print(&quot;Warning: No post-update command provided&quot;)
    else:
        print(f&quot;Post-update command: {' '.join(post_update_cmd)}&quot;)

    # Get top-level packages
    packages = get_top_level_packages()
    print(f&quot;Found {len(packages)} top-level packages: {', '.join(packages)}&quot;)

    # Update each package
    success_count = 0
    for package in packages:
        if update_package(package, post_update_cmd):
            success_count += 1
        else:
            print(f&quot;\nStopping after failure on {package}&quot;)
            break

    # Print summary
    print(f&quot;\nSummary: Successfully updated {success_count}/{len(packages)} packages&quot;)
    sys.exit(0 if success_count == len(packages) else 1)


if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2025-02-14 21:56</div>
            <div class="timeline-body"><p>You can also use <code>--exclude-newer</code> to effectively bisect through time</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-14 22:12</div>
            <div class="timeline-body"><p>Minor note that <code>get_top_level_packages</code>... does not do that — it gets indirect dependencies too but it seems vaguely correct to bump each dependency. Once we have JSON output, it'd be simpler? #411 You'd want to remove workspace members and such too.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:55 UTC
    </footer>
</body>
</html>
