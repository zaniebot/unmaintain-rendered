<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>environment variables priorities with .env - astral-sh/uv #12812</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>environment variables priorities with .env</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12812">#12812</a>
        opened by <a href="https://github.com/baggiponte">@baggiponte</a>
        on 2025-04-10 16:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/baggiponte">@baggiponte</a></div>
            <div class="timeline-body">Summary
<p>If:</p>
<ol>
<li>an environment variable is already present in my env (√† la <code>export FOO=baz</code>)</li>
<li>and I have it defined in my <code>.env</code> file too</li>
</ol>
<p>Then, when I run <code>uv run --env-file=.env</code>, the value in <code>.env</code> is not read, while the pre-existing value is used.</p>
<p>Repro:</p>
<pre><code>uv init
echo &quot;FOO=bar&quot; &gt; .env

uv run -- python -c &quot;import os; print(os.getenv(&#x27;FOO&#x27;))&quot;
# prints None ‚úÖ

uv run --env-file=.env -- python -c &quot;import os; print(os.getenv(&#x27;FOO&#x27;))&quot;
# prints bar ‚úÖ

FOO=baz uv run -- python -c &quot;import os; print(os.getenv(&#x27;FOO&#x27;))&quot;
# prints baz ‚úÖ

FOO=baz uv run --env-file=.env -- python -c &quot;import os; print(os.getenv(&#x27;FOO&#x27;))&quot;
# prints baz ‚ùå

export FOO=baz
uv run --env-file=.env -- python -c &quot;import os; print(os.getenv(&#x27;FOO&#x27;))&quot;
# prints baz ‚ùå
</code></pre>
<p>I think what should happen is <code>--env-file=.env</code> takes priority over the value in the env. As a plus, <code>FOO=baz</code> takes priority over everything.</p>
Platform
<p>macOS ARM 14.4.1 (23E224)</p>
Version
<p>uv 0.6.14</p>
Python version
<p>3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/baggiponte">@baggiponte</a> on 2025-04-10 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 20:19</div>
            <div class="timeline-body"><p>I&#x27;m afraid the current behaviour is intended. I believe the intent here is that any environment variables that are ambient on the system are likely temporary for the current invocation (i.e. <code>UV_WHATEVER=1 uv sync</code>).</p>
<p>https://docs.astral.sh/uv/configuration/files/#env</p>
<blockquote>
<p>If the same variable is defined in the environment and in a .env file, the value from the environment will take precedence.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-10 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-10 21:51</div>
            <div class="timeline-body"><p>I believe this matches most other tools. I&#x27;d be curious to see counterexamples.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2025-04-10 22:10</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m afraid the current behaviour is intended. I believe the intent here is that any environment variables that are ambient on the system are likely temporary for the current invocation (i.e. <code>UV_WHATEVER=1 uv sync</code>).</p>
<p><a href="https://docs.astral.sh/uv/configuration/files/#env">docs.astral.sh/uv/configuration/files#env</a></p>
<blockquote>
<p>If the same variable is defined in the environment and in a .env file, the value from the environment will take precedence.</p>
</blockquote>
</blockquote>
<p>OMG I can&#x27;t read.</p>
<p>My usecase is: I have a global <code>OPENAI_API_KEY</code> for tools like aider. Though in some project folders I use different API keys (say for billing, tracing too). So this felt kinda odd and I wouldn&#x27;t be sure how to avoid this otherwise.</p>
<p>Will check how python-dotenv does this tomorrow üòä</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andrewbolster">@andrewbolster</a> on 2025-04-16 13:45</div>
            <div class="timeline-body"><p>Duplicate/replica of <a href="https://github.com/astral-sh/uv/issues/9465">astral-sh/uv#9465</a></p>
<p>I was also &#x27;surprised&#x27; by this; my expectation was --envfile &gt; shellenv &gt; systemenv</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2025-04-16 14:37</div>
            <div class="timeline-body"><blockquote>
<p>Duplicate/replica of <a href="https://github.com/astral-sh/uv/issues/9465">#9465</a></p>
<p>I was also &#x27;surprised&#x27; by this; my expectation was --envfile &gt; shellenv &gt; systemenv</p>
</blockquote>
<p>Nice catch, need to improve my googling. Thank you, closing as duplicate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/baggiponte">@baggiponte</a> on 2025-04-16 14:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:12 UTC
    </footer>
</body>
</html>
