<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Solved] - Private PyPi Credentials Somehow Leak into `uv.lock' - astral-sh/uv #9809</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Solved] - Private PyPi Credentials Somehow Leak into `uv.lock&#x27;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9809">#9809</a>
        opened by <a href="https://github.com/RoTorEx">@RoTorEx</a>
        on 2024-12-11 13:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RoTorEx">@RoTorEx</a></div>
            <div class="timeline-body">BUG - Private PyPi Credentials Somehow Leak into `uv.lock&#x27;
Description
<p>Hi there.</p>
<p>I found a problem when leaking credentials to private PyPi server. I&#x27;m using credentials setup as was described <a href="https://docs.astral.sh/uv/configuration/indexes/#searching-across-multiple-indexes:~:text=dependency%20confusion%22%20attacks.-,Providing%20credentials,-Most%20private%20registries">here</a>.</p>
<ol>
<li>I built a Dockerfile without passing environment variables with credentials for my private package and docker didn&#x27;t crash with a package installation error, it downloaded it without knowing the environment variables!</li>
</ol>
<p>As far as I understand it did this from <code>uv.lock</code>.</p>
<ol>
<li>Also, after several experiments without Docker, this behavior is also observed locally.</li>
</ol>
<p>Even when Global Env <strong>does not have</strong> the necessary values (UV_INDEX_PRIVATE_PYPI_USERNAME and UV_INDEX_PRIVATE_PYPI_PASSWORD are empty or wrong) for indexing, but <code>uv.lock</code> exists, <code>uv</code> successfully downloads the package from my private repository without any creds and refresh lock with <code>uv sync --group core</code> and <code>uv lock --no-cache</code>.</p>
<p>And when I remove <code>uv.lock</code>, the commands also crash with error 401.</p>
My setup
My Global Env
<pre><code>export MY_PYPI_TOKEN_NAME=&quot;token-name&quot;
export MY_PYPI_ACCESS_TOKEN=&quot;access-token&quot;

export UV_INDEX_PRIVATE_PYPI_USERNAME=$MY_PYPI_TOKEN_NAME
export UV_INDEX_PRIVATE_PYPI_PASSWORD=$MY_PYPI_ACCESS_TOKEN
</code></pre>
pyproject.toml
<pre><code>[project]
name = &quot;App&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = []
[dependency-groups]
core = [
    &quot;favourite-package==1.0.2&quot;,
]
dev = [
    &quot;mypy==1.13.0&quot;,
    &quot;ruff==0.8.2&quot;,
]


[tool.uv.sources]
favourite-package = { index = &quot;private-pypi&quot; }


[[tool.uv.index]]
name = &quot;private-pypi&quot;
url = &quot;https://my-registry.com/api/v4/projects/1204/packages/pypi/simple&quot;
explicit = true
</code></pre>
Dockerfile
<pre><code>FROM python:3.12-slim-bookworm AS python-base
WORKDIR $VENV_PATH
RUN apt-get update \
    &amp;&amp; apt-get install --no-install-recommends -y curl ca-certificates \
    &amp;&amp; curl -fsSL https://astral.sh/uv/install.sh | sh \
    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*
ENV PATH=&quot;/root/.local/bin/:$PATH&quot;
# !1. BUG. But working scenario. But how did he even know what credentials he needed to download the package?
COPY pyproject.toml ./
COPY uv.lock ./
RUN uv sync --group core --no-dev
# !2. And here, when there is no `uv.lock` file, it tries to re-do it and crashes with error 401.
# COPY pyproject.toml ./
# RUN uv lock &amp;&amp; uv sync --group core --no-dev

FROM python-base
COPY --from=builder-base $VENV_PATH $VENV_PATH
WORKDIR /base/
COPY pyproject.toml /base/
COPY ./src/app/ /base/src/app/
ENTRYPOINT [&quot;python&quot;, &quot;-m&quot;, &quot;src.app.run&quot;]
</code></pre>
Dockerfile traceback
<pre><code> =&gt; [builder-base 2/4] RUN apt-get update     &amp;&amp; apt-get install --no-install-recommends -y curl ca-certificates     &amp;&amp; curl -fsSL https://astral.sh/uv/install.sh | sh     &amp;  4.7s
 =&gt; [builder-base 3/4] COPY pyproject.toml ./                                                                                                                                  0.0s
 =&gt; ERROR [builder-base 4/4] RUN uv lock &amp;&amp;     uv sync --group core --no-dev                                                                                                  1.3s
------
 &gt; [builder-base 4/4] RUN uv lock &amp;&amp;     uv sync --group core --no-dev:
0.187 Using CPython 3.12.8 interpreter at: /usr/local/bin/python3
1.204   × No solution found when resolving dependencies:
1.204   ╰─▶ Because favourite-package was not found in the package registry and
1.204       integration-bridge:core depends on favourite-package==1.0.2, we can
1.204       conclude that integration-bridge:core&#x27;s requirements are unsatisfiable.
1.204       And because your project requires integration-bridge:core, we can
1.204       conclude that your projects&#x27;s requirements are unsatisfiable.
1.204
1.204       hint: An index URL
1.204       (https://my-registry.com/api/v4/projects/1204/packages/pypi/simple)
1.204       could not be queried due to a lack of valid authentication credentials
1.204       (401 Unauthorized).
------
Dockerfile:26
--------------------
  25 |     # Install core runtime deps
  26 | &gt;&gt;&gt; RUN uv lock &amp;&amp; \
  27 | &gt;&gt;&gt;     uv sync --group core --no-dev
  28 |     # RUN uv sync --group core --no-dev
--------------------
ERROR: failed to solve: process &quot;/bin/sh -c uv lock &amp;&amp;     uv sync --group core --no-dev&quot; did not complete successfully: exit code: 1
make: *** [up] Error 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-11 13:51</div>
            <div class="timeline-body"><p>The tool is awesome, but we need to fix this bug so our team can get it into production :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-11 13:52</div>
            <div class="timeline-body"><p>Can you look at the <code>uv.lock</code> and determine whether the credentials are being included? That would be more helpful than the workflows you&#x27;re describing here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-11 14:01</div>
            <div class="timeline-body"><p>I apologize for forgetting to clarify that I didn&#x27;t find our credentials in <code>uv.lock</code> itself. But with this file both locally and docker downloads a private package.</p>
<p>Here is all related info about my package in the <code>uv.lock</code>:</p>
<pre><code>[package.metadata.requires-dev]
core = [
    { name = &quot;favourite-package&quot;, specifier = &quot;==1.0.2&quot;, index = &quot;https://my-registry.com/api/v4/projects/1204/packages/pypi/simple&quot; },
]

[[package]]
name = &quot;favourite-package&quot;
version = &quot;1.0.2&quot;
source = { registry = &quot;https://my-registry.com/api/v4/projects/1204/packages/pypi/simple&quot; }
sdist = { url = &quot;https://my-registry.com/api/v4/projects/1204/packages/pypi/files/3d1ca15306f8475d369ecf27982dee871b1cc5704cd829439a7cb9e80d8a4aa5/favourite_package-1.0.2.tar.gz&quot;, hash = &quot;sha256:3d1ca15306f8475d369ecf27982dee871b1cc5704cd829439a7cb9e80d8a4aa5&quot; }
wheels = [
    { url = &quot;https://my-registry.com/api/v4/projects/1204/packages/pypi/files/7ac0900f7cc8254cd2e95f9e6eb785a3ab27089717c6f5439668478f4c7b4e4a/favourite_package-1.0.2-py3-none-any.whl&quot;, hash = &quot;sha256:7ac0900f7cc8254cd2e95f9e6eb785a3ab27089717c6f5439668478f4c7b4e4a&quot; },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-11 14:04</div>
            <div class="timeline-body"><p>uv-self 0.5.7 (3ca155ddd 2024-12-06)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-11 14:06</div>
            <div class="timeline-body"><p>Could you include the (redacted) verbose logs from the <code>RUN uv sync --group core --no-dev</code> step? I have no idea how we would be using your credentials if they&#x27;re not in the <code>uv.lock</code> or in the environment. There must be something else going on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-11 14:31</div>
            <div class="timeline-body"><p>I built image with that command:</p>
<pre><code>docker --debug build --no-cache --progress=plain \
	-t my-app:local \
	-f ./Dockerfile .
</code></pre>
<p>I also double checked that there are no any env in my active terminal session and final docker container also doesn&#x27;t have any registry creds.</p>
<p>Docker build logs:</p>
<pre><code>#0 building with &quot;desktop-linux&quot; instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 1.22kB done
#1 DONE 0.0s

#2 [auth] library/python:pull token for registry-1.docker.io
#2 DONE 0.0s

#3 [internal] load metadata for docker.io/library/python:3.12-slim-bookworm
#3 DONE 1.1s

#4 [internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s

#5 [builder-base 1/6] WORKDIR /opt/pysetup
#5 CACHED

#6 [python-base 1/1] FROM docker.io/library/python:3.12-slim-bookworm@sha256:2b0079146a74e23bf4ae8f6a28e1b484c6292f6fb904cbb51825b4a19812fcd8
#6 CACHED

#7 [internal] load build context
#7 transferring context: 22.42kB done
#7 DONE 0.0s

#8 [builder-base 2/6] RUN apt-get update     &amp;&amp; apt-get install --no-install-recommends -y curl ca-certificates     &amp;&amp; curl -fsSL https://astral.sh/uv/install.sh | sh     &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*
#8 0.192 Get:1 http://deb.debian.org/debian bookworm InRelease [151 kB]
#8 0.305 Get:2 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]
#8 0.342 Get:3 http://deb.debian.org/debian-security bookworm-security InRelease [48.0 kB]
#8 0.393 Get:4 http://deb.debian.org/debian bookworm/main arm64 Packages [8688 kB]
#8 0.695 Get:5 http://deb.debian.org/debian bookworm-updates/main arm64 Packages [8844 B]
#8 0.734 Get:6 http://deb.debian.org/debian-security bookworm-security/main arm64 Packages [213 kB]
#8 1.282 Fetched 9164 kB in 1s (7690 kB/s)
#8 1.282 Reading package lists...
#8 1.508 Reading package lists...
#8 1.729 Building dependency tree...
#8 1.785 Reading state information...
#8 1.844 ca-certificates is already the newest version (20230311).
#8 1.844 The following additional packages will be installed:
#8 1.844   libbrotli1 libcurl4 libldap-2.5-0 libnghttp2-14 libpsl5 librtmp1 libsasl2-2
#8 1.845   libsasl2-modules-db libssh2-1
#8 1.845 Recommended packages:
#8 1.845   libldap-common publicsuffix libsasl2-modules
#8 1.884 The following NEW packages will be installed:
#8 1.885   curl libbrotli1 libcurl4 libldap-2.5-0 libnghttp2-14 libpsl5 librtmp1
#8 1.885   libsasl2-2 libsasl2-modules-db libssh2-1
#8 1.981 0 upgraded, 10 newly installed, 0 to remove and 0 not upgraded.
#8 1.981 Need to get 1552 kB of archives.
#8 1.981 After this operation, 4027 kB of additional disk space will be used.
#8 1.981 Get:1 http://deb.debian.org/debian bookworm/main arm64 libbrotli1 arm64 1.0.9-2+b6 [269 kB]
#8 2.112 Get:2 http://deb.debian.org/debian bookworm/main arm64 libsasl2-modules-db arm64 2.1.28+dfsg-10 [20.8 kB]
#8 2.112 Get:3 http://deb.debian.org/debian bookworm/main arm64 libsasl2-2 arm64 2.1.28+dfsg-10 [58.0 kB]
#8 2.116 Get:4 http://deb.debian.org/debian bookworm/main arm64 libldap-2.5-0 arm64 2.5.13+dfsg-5 [171 kB]
#8 2.124 Get:5 http://deb.debian.org/debian bookworm/main arm64 libnghttp2-14 arm64 1.52.0-1+deb12u2 [68.6 kB]
#8 2.148 Get:6 http://deb.debian.org/debian bookworm/main arm64 libpsl5 arm64 0.21.2-1 [58.6 kB]
#8 2.150 Get:7 http://deb.debian.org/debian bookworm/main arm64 librtmp1 arm64 2.4+20151223.gitfa8646d.1-2+b2 [59.4 kB]
#8 2.153 Get:8 http://deb.debian.org/debian bookworm/main arm64 libssh2-1 arm64 1.10.0-3+b1 [172 kB]
#8 2.160 Get:9 http://deb.debian.org/debian bookworm/main arm64 libcurl4 arm64 7.88.1-10+deb12u8 [365 kB]
#8 2.187 Get:10 http://deb.debian.org/debian bookworm/main arm64 curl arm64 7.88.1-10+deb12u8 [309 kB]
#8 2.283 debconf: delaying package configuration, since apt-utils is not installed
#8 2.294 Fetched 1552 kB in 0s (5036 kB/s)
#8 2.304 Selecting previously unselected package libbrotli1:arm64.
(Reading database ... 6680 files and directories currently installed.)
#8 2.307 Preparing to unpack .../0-libbrotli1_1.0.9-2+b6_arm64.deb ...
#8 2.309 Unpacking libbrotli1:arm64 (1.0.9-2+b6) ...
#8 2.330 Selecting previously unselected package libsasl2-modules-db:arm64.
#8 2.330 Preparing to unpack .../1-libsasl2-modules-db_2.1.28+dfsg-10_arm64.deb ...
#8 2.332 Unpacking libsasl2-modules-db:arm64 (2.1.28+dfsg-10) ...
#8 2.342 Selecting previously unselected package libsasl2-2:arm64.
#8 2.343 Preparing to unpack .../2-libsasl2-2_2.1.28+dfsg-10_arm64.deb ...
#8 2.344 Unpacking libsasl2-2:arm64 (2.1.28+dfsg-10) ...
#8 2.356 Selecting previously unselected package libldap-2.5-0:arm64.
#8 2.357 Preparing to unpack .../3-libldap-2.5-0_2.5.13+dfsg-5_arm64.deb ...
#8 2.357 Unpacking libldap-2.5-0:arm64 (2.5.13+dfsg-5) ...
#8 2.375 Selecting previously unselected package libnghttp2-14:arm64.
#8 2.375 Preparing to unpack .../4-libnghttp2-14_1.52.0-1+deb12u2_arm64.deb ...
#8 2.377 Unpacking libnghttp2-14:arm64 (1.52.0-1+deb12u2) ...
#8 2.391 Selecting previously unselected package libpsl5:arm64.
#8 2.392 Preparing to unpack .../5-libpsl5_0.21.2-1_arm64.deb ...
#8 2.392 Unpacking libpsl5:arm64 (0.21.2-1) ...
#8 2.405 Selecting previously unselected package librtmp1:arm64.
#8 2.405 Preparing to unpack .../6-librtmp1_2.4+20151223.gitfa8646d.1-2+b2_arm64.deb ...
#8 2.406 Unpacking librtmp1:arm64 (2.4+20151223.gitfa8646d.1-2+b2) ...
#8 2.421 Selecting previously unselected package libssh2-1:arm64.
#8 2.421 Preparing to unpack .../7-libssh2-1_1.10.0-3+b1_arm64.deb ...
#8 2.422 Unpacking libssh2-1:arm64 (1.10.0-3+b1) ...
#8 2.440 Selecting previously unselected package libcurl4:arm64.
#8 2.440 Preparing to unpack .../8-libcurl4_7.88.1-10+deb12u8_arm64.deb ...
#8 2.441 Unpacking libcurl4:arm64 (7.88.1-10+deb12u8) ...
#8 2.464 Selecting previously unselected package curl.
#8 2.465 Preparing to unpack .../9-curl_7.88.1-10+deb12u8_arm64.deb ...
#8 2.465 Unpacking curl (7.88.1-10+deb12u8) ...
#8 2.488 Setting up libpsl5:arm64 (0.21.2-1) ...
#8 2.491 Setting up libbrotli1:arm64 (1.0.9-2+b6) ...
#8 2.494 Setting up libnghttp2-14:arm64 (1.52.0-1+deb12u2) ...
#8 2.496 Setting up libsasl2-modules-db:arm64 (2.1.28+dfsg-10) ...
#8 2.499 Setting up librtmp1:arm64 (2.4+20151223.gitfa8646d.1-2+b2) ...
#8 2.503 Setting up libsasl2-2:arm64 (2.1.28+dfsg-10) ...
#8 2.507 Setting up libssh2-1:arm64 (1.10.0-3+b1) ...
#8 2.509 Setting up libldap-2.5-0:arm64 (2.5.13+dfsg-5) ...
#8 2.514 Setting up libcurl4:arm64 (7.88.1-10+deb12u8) ...
#8 2.516 Setting up curl (7.88.1-10+deb12u8) ...
#8 2.520 Processing triggers for libc-bin (2.36-9+deb12u9) ...
#8 3.336 downloading uv 0.5.7 aarch64-unknown-linux-gnu
#8 4.502 no checksums to verify
#8 4.706 installing to /root/.local/bin
#8 4.708   uv
#8 4.708   uvx
#8 4.708 everything&#x27;s installed!
#8 4.718
#8 4.718 To add $HOME/.local/bin to your PATH, either restart your shell or run:
#8 4.718
#8 4.718     source $HOME/.local/bin/env (sh, bash, zsh)
#8 4.718     source $HOME/.local/bin/env.fish (fish)
#8 DONE 4.8s

#9 [builder-base 3/6] COPY pyproject.toml ./
#9 DONE 0.0s

#10 [builder-base 4/6] COPY uv.lock ./
#10 DONE 0.0s

#11 [builder-base 5/6] RUN uv lock
#11 0.149 Using CPython 3.12.8 interpreter at: /usr/local/bin/python3
#11 0.150 Resolved 6 packages in 0.63ms
#11 DONE 0.2s

#12 [builder-base 6/6] RUN uv sync --group core --no-dev -vvv
#12 0.100     0.000005s DEBUG uv uv 0.5.7
#12 0.100     0.000149s DEBUG uv_workspace::workspace Found project root: `/opt/pysetup`
#12 0.100     0.000312s DEBUG uv_workspace::workspace No workspace root found, using project root
#12 0.101     0.000358s DEBUG uv::commands::project Using Python request `&gt;=3.12` from `requires-python` metadata
#12 0.101     0.000379s DEBUG uv_python::discovery Searching for Python &gt;=3.12 in managed installations or search path
#12 0.101     0.000389s DEBUG uv_python::discovery Searching for managed installations at `/root/.local/share/uv/python`
#12 0.101     0.001213s DEBUG uv_python::discovery Found `cpython-3.12.8-linux-aarch64-gnu` at `/usr/local/bin/python3` (search path)
#12 0.101 Using CPython 3.12.8 interpreter at: /usr/local/bin/python3
#12 0.101 Creating virtual environment at: .venv
#12 0.102  uv_client::linehaul::linehaul
#12 0.102     0.001949s DEBUG uv_client::base_client Using request timeout of 30s
#12 0.102  uv_resolver::flat_index::from_entries
#12 0.102  uv_distribution::distribution_database::get_or_build_wheel_metadata dist=integration-bridge @ file:///opt/pysetup
#12 0.102     0.002395s   0ms DEBUG uv_distribution::source Found static `pyproject.toml` for: integration-bridge @ file:///opt/pysetup
#12 0.103     0.002515s   0ms DEBUG uv_workspace::workspace No workspace root found, using project root
#12 0.103     0.002554s DEBUG uv::commands::project::lock Existing `uv.lock` satisfies workspace requirements
#12 0.103 Resolved 6 packages in 0.67ms
#12 0.103  uv_client::linehaul::linehaul
#12 0.103     0.002621s DEBUG uv_client::base_client Using request timeout of 30s
#12 0.103  uv_resolver::flat_index::from_entries
#12 0.103     0.002710s DEBUG uv_installer::plan Identified uncached distribution: favourite-package==1.0.2
#12 0.103     0.002721s DEBUG uv_installer::plan Identified uncached distribution: uvicorn==0.32.1
#12 0.103     0.002725s DEBUG uv_installer::plan Identified uncached distribution: click==8.1.7
#12 0.103     0.002729s DEBUG uv_installer::plan Identified uncached distribution: h11==0.14.0
#12 0.103  uv_installer::preparer::prepare total=4
#12 0.103    uv_installer::preparer::get_wheel name=favourite-package==1.0.2, size=None, url=&quot;https://my-registry.com/api/v4/projects/1204/packages/pypi/files/7ac0900f7cc8254cd2e95f9e6eb785a3ab27089717c6f5439668478f4c7b4e4a/favourite_package-1.0.2-py3-none-any.whl&quot;
#12 0.103      uv_distribution::distribution_database::get_or_build_wheel dist=favourite-package==1.0.2
#12 0.103        uv_client::cached_client::get_serde_with_retry
#12 0.103          uv_client::cached_client::get_cacheable_with_retry
#12 0.103            uv_client::cached_client::get_cacheable
#12 0.103              uv_client::cached_client::read_and_parse_cache file=/root/.cache/uv/wheels-v3/index/60709d952927fba9/favourite-package/favourite_package-1.0.2-py3-none-any.http
#12 0.103    uv_installer::preparer::get_wheel name=click==8.1.7, size=Some(97941), url=&quot;https://files.pythonhosted.org/packages/00/2e/d53fa4befbf2cfa713304affc7ca780ce4fc1fd8710527771b58311a3229/click-8.1.7-py3-none-any.whl&quot;
#12 0.103      uv_distribution::distribution_database::get_or_build_wheel dist=click==8.1.7
#12 0.103  uv_client::cached_client::from_path_sync path=&quot;/root/.cache/uv/wheels-v3/index/60709d952927fba9/favourite-package/favourite_package-1.0.2-py3-none-any.http&quot;
#12 0.103        uv_client::cached_client::get_serde_with_retry
#12 0.103          uv_client::cached_client::get_cacheable_with_retry
#12 0.103            uv_client::cached_client::get_cacheable
#12 0.103              uv_client::cached_client::read_and_parse_cache file=/root/.cache/uv/wheels-v3/pypi/click/click-8.1.7-py3-none-any.http
#12 0.103    uv_installer::preparer::get_wheel name=uvicorn==0.32.1, size=Some(63828), url=&quot;https://files.pythonhosted.org/packages/50/c1/2d27b0a15826c2b71dcf6e2f5402181ef85acf439617bb2f1453125ce1f3/uvicorn-0.32.1-py3-none-any.whl&quot;
#12 0.103      uv_distribution::distribution_database::get_or_build_wheel dist=uvicorn==0.32.1
#12 0.103  uv_client::cached_client::from_path_sync path=&quot;/root/.cache/uv/wheels-v3/pypi/click/click-8.1.7-py3-none-any.http&quot;
#12 0.103        uv_client::cached_client::get_serde_with_retry
#12 0.103          uv_client::cached_client::get_cacheable_with_retry
#12 0.103            uv_client::cached_client::get_cacheable
#12 0.103              uv_client::cached_client::read_and_parse_cache file=/root/.cache/uv/wheels-v3/pypi/uvicorn/uvicorn-0.32.1-py3-none-any.http
#12 0.103    uv_installer::preparer::get_wheel name=h11==0.14.0, size=Some(58259), url=&quot;https://files.pythonhosted.org/packages/95/04/ff642e65ad6b90db43e668d70ffb6736436c7ce41fcc549f4e9472234127/h11-0.14.0-py3-none-any.whl&quot;
#12 0.103      uv_distribution::distribution_database::get_or_build_wheel dist=h11==0.14.0
#12 0.103  uv_client::cached_client::from_path_sync path=&quot;/root/.cache/uv/wheels-v3/pypi/uvicorn/uvicorn-0.32.1-py3-none-any.http&quot;
#12 0.103        uv_client::cached_client::get_serde_with_retry
#12 0.103          uv_client::cached_client::get_cacheable_with_retry
#12 0.103            uv_client::cached_client::get_cacheable
#12 0.103              uv_client::cached_client::read_and_parse_cache file=/root/.cache/uv/wheels-v3/pypi/h11/h11-0.14.0-py3-none-any.http
#12 0.103  uv_client::cached_client::from_path_sync path=&quot;/root/.cache/uv/wheels-v3/pypi/h11/h11-0.14.0-py3-none-any.http&quot;
#12 0.103               0.002990s   0ms DEBUG uv_client::cached_client No cache entry for: https://my-registry.com/api/v4/projects/1204/packages/pypi/files/7ac0900f7cc8254cd2e95f9e6eb785a3ab27089717c6f5439668478f4c7b4e4a/favourite_package-1.0.2-py3-none-any.whl
#12 0.103              uv_client::cached_client::fresh_request url=&quot;https://my-registry.com/api/v4/projects/1204/packages/pypi/files/7ac0900f7cc8254cd2e95f9e6eb785a3ab27089717c6f5439668478f4c7b4e4a/favourite_package-1.0.2-py3-none-any.whl&quot;
#12 0.103               0.003081s   0ms DEBUG uv_client::cached_client No cache entry for: https://files.pythonhosted.org/packages/00/2e/d53fa4befbf2cfa713304affc7ca780ce4fc1fd8710527771b58311a3229/click-8.1.7-py3-none-any.whl
#12 0.103              uv_client::cached_client::fresh_request url=&quot;https://files.pythonhosted.org/packages/00/2e/d53fa4befbf2cfa713304affc7ca780ce4fc1fd8710527771b58311a3229/click-8.1.7-py3-none-any.whl&quot;
#12 0.103               0.003126s   0ms DEBUG uv_client::cached_client No cache entry for: https://files.pythonhosted.org/packages/50/c1/2d27b0a15826c2b71dcf6e2f5402181ef85acf439617bb2f1453125ce1f3/uvicorn-0.32.1-py3-none-any.whl
#12 0.103              uv_client::cached_client::fresh_request url=&quot;https://files.pythonhosted.org/packages/50/c1/2d27b0a15826c2b71dcf6e2f5402181ef85acf439617bb2f1453125ce1f3/uvicorn-0.32.1-py3-none-any.whl&quot;
#12 0.103               0.003160s   0ms DEBUG uv_client::cached_client No cache entry for: https://files.pythonhosted.org/packages/95/04/ff642e65ad6b90db43e668d70ffb6736436c7ce41fcc549f4e9472234127/h11-0.14.0-py3-none-any.whl
#12 0.103              uv_client::cached_client::fresh_request url=&quot;https://files.pythonhosted.org/packages/95/04/ff642e65ad6b90db43e668d70ffb6736436c7ce41fcc549f4e9472234127/h11-0.14.0-py3-none-any.whl&quot;
#12 0.239              uv_client::cached_client::new_cache file=/root/.cache/uv/wheels-v3/pypi/uvicorn/uvicorn-0.32.1-py3-none-any.http
#12 0.239              uv_distribution::distribution_database::wheel wheel=uvicorn==0.32.1
#12 0.242              uv_client::cached_client::new_cache file=/root/.cache/uv/wheels-v3/pypi/click/click-8.1.7-py3-none-any.http
#12 0.242              uv_distribution::distribution_database::wheel wheel=click==8.1.7
#12 0.243              uv_client::cached_client::new_cache file=/root/.cache/uv/wheels-v3/pypi/h11/h11-0.14.0-py3-none-any.http
#12 0.243              uv_distribution::distribution_database::wheel wheel=h11==0.14.0
#12 0.274              uv_client::cached_client::new_cache file=/root/.cache/uv/wheels-v3/index/60709d952927fba9/favourite-package/favourite_package-1.0.2-py3-none-any.http
#12 0.274              uv_distribution::distribution_database::wheel wheel=favourite-package==1.0.2
#12 0.322 Prepared 4 packages in 219ms
#12 0.323  uv_installer::installer::install_blocking num_wheels=4
#12 0.323    uv_installer::installer::install num_wheels=4
#12 0.323  uv_install_wheel::linker::install_wheel wheel=uvicorn-0.32.1-py3-none-any.whl
#12 0.325  uv_install_wheel::linker::install_wheel wheel=h11-0.14.0-py3-none-any.whl
#12 0.325    uv_install_wheel::linker::link_wheel_files
#12 0.325  uv_install_wheel::linker::install_wheel wheel=click-8.1.7-py3-none-any.whl
#12 0.325    uv_install_wheel::linker::link_wheel_files
#12 0.325    uv_install_wheel::linker::link_wheel_files
#12 0.325  uv_install_wheel::linker::install_wheel wheel=favourite_package-1.0.2-py3-none-any.whl
#12 0.325    uv_install_wheel::linker::link_wheel_files
#12 0.325 Installed 4 packages in 2ms
#12 0.326  + click==8.1.7
#12 0.326  + h11==0.14.0
#12 0.326  + favourite-package==1.0.2
#12 0.326  + uvicorn==0.32.1
#12 DONE 0.3s

#13 [stage-2 1/4] COPY --from=builder-base /opt/pysetup /opt/pysetup
#13 DONE 0.0s

#14 [stage-2 2/4] WORKDIR /base/
#14 DONE 0.0s

#15 [stage-2 3/4] COPY pyproject.toml /base/
#15 DONE 0.0s

#16 [stage-2 4/4] COPY ./src/app/ /base/src/app/
#16 DONE 0.0s

#17 exporting to image
#17 exporting layers 0.0s done
#17 writing image sha256:f931e25e26b5d6826097565ea37553d51f3c0f0691f8eb51ae443f6a0ed90952 done
#17 naming to docker.io/library/my-app:local
#17 naming to docker.io/library/my-app:local done
#17 DONE 0.0s
</code></pre>
<p>I thought maybe the creeds are stored somewhere in the global config, but I can&#x27;t figure out how they get into the docker</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-11 14:34</div>
            <div class="timeline-body"><p>Wild guess: are you sure that your registry is authenticated? <code>uv sync</code> only hits <code>https://my-registry.com/api/v4/projects/1204/packages/pypi/files/7ac0900f7cc8254cd2e95f9e6eb785a3ab27089717c6f5439668478f4c7b4e4a/favourite_package-1.0.2-py3-none-any.whl</code>. It <em>doesn&#x27;t</em> hit the Simple API (like <code>https://my-registry.com/api/v4/projects/1204/packages/pypi/simple/favourite-package</code>). So if your <code>/files/</code> endpoints aren&#x27;t authenticated (but the <code>/simple/</code> API is), that would explain why <code>uv sync</code> fails but <code>uv lock</code> (without a <code>uv.lock</code>) fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-12 03:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-13 12:11</div>
            <div class="timeline-body"><blockquote>
<p>Wild guess: are you sure that your registry is authenticated? <code>uv sync</code> only hits <code>https://my-registry.com/api/v4/projects/1204/packages/pypi/files/7ac0900f7cc8254cd2e95f9e6eb785a3ab27089717c6f5439668478f4c7b4e4a/favourite_package-1.0.2-py3-none-any.whl</code>. It <em>doesn&#x27;t</em> hit the Simple API (like <code>https://my-registry.com/api/v4/projects/1204/packages/pypi/simple/favourite-package</code>). So if your <code>/files/</code> endpoints aren&#x27;t authenticated (but the <code>/simple/</code> API is), that would explain why <code>uv sync</code> fails but <code>uv lock</code> (without a <code>uv.lock</code>) fails.</p>
</blockquote>
<p>Hi @charliermarsh,</p>
<p>Yes, indeed we had an issue with an older version of GitLab instance where this url which ends on <code>/files/</code> was unprotected and gave away the package without any auth.</p>
<p>I apologize for the loud name of the ticket, haha. After all, it really wasn&#x27;t about <code>uv</code>. Do you think it&#x27;s worth renaming before closing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;BUG - Private PyPi Credentials Somehow Leak into `uv.lock&#x27;&quot; to &quot;[Solved] - Private PyPi Credentials Somehow Leak into `uv.lock&#x27;&quot; by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-17 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-17 16:53</div>
            <div class="timeline-body"><p>The problem turned out to be an old version of the GitLab instance, from where packages were leaking through the <code>.../files/</code> path from GitLab PyPI without authorization</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/RoTorEx">@RoTorEx</a> on 2024-12-17 16:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:07 UTC
    </footer>
</body>
</html>
