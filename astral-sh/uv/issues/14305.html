<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to build anyio; command `hg root` timed out after 40 seconds on Windows - astral-sh/uv #14305</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to build anyio; command <code>hg root</code> timed out after 40 seconds on Windows</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/14305">#14305</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-06-27 03:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>The test cases</p>
<ul>
<li><code>export::pep_751_sdist_url</code></li>
<li><code>lock::no_lowest_warning_with_name_and_url</code></li>
</ul>
<p>flaked with:</p>
<pre><code>FAIL [  57.989s] uv::it export::pep_751_sdist_url
  stdout ───

    running 1 test
    test export::pep_751_sdist_url ... FAILED

    failures:

    failures:
        export::pep_751_sdist_url

    test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 1703 filtered out; finished in 57.96s
    
  stderr ───

    thread &#x27;export::pep_751_sdist_url&#x27; panicked at /rustc/05f9846f893b09a1be1fc8560e33fc3c815cfecb\library\core\src\ops\function.rs:250:5:
    Unexpected failure.
    code=1
    stderr=``````
      × Failed to build `anyio @ https://files.pythonhosted.org/packages/db/4d/3970183622f0330d3c23d9b8a5f52e365e50381fd484d08e[3285](https://github.com/astral-sh/uv/actions/runs/15915149050/job/44891290321?pr=14301#step:10:3286)104333d3/anyio-4.3.0.tar.gz`
      ├─▶ The build backend returned an error
      ╰─▶ Call to `setuptools.build_meta.build_wheel` failed (exit code: 1)

          [stdout]
          running egg_info
          writing src\\anyio.egg-info\\PKG-INFO
          writing dependency_links to src\\anyio.egg-info\\dependency_links.txt
          writing entry points to src\\anyio.egg-info\\entry_points.txt
          writing requirements to src\\anyio.egg-info\\requires.txt
          writing top-level names to src\\anyio.egg-info\\top_level.txt

          [stderr]
          Traceback (most recent call last):
            File \&quot;&lt;string&gt;\&quot;, line 14, in &lt;module&gt;
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\build_meta.py\&quot;, line 325, in get_requires_for_build_wheel
              return self._get_build_requires(config_settings, requirements=[\&#x27;wheel\&#x27;])
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\build_meta.py\&quot;, line 295, in _get_build_requires
              self.run_setup()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\build_meta.py\&quot;, line 311, in run_setup
              exec(code, locals())
            File \&quot;&lt;string&gt;\&quot;, line 1, in &lt;module&gt;
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\__init__.py\&quot;, line 104, in setup
              return distutils.core.setup(**attrs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\core.py\&quot;, line 185, in setup
              return run_commands(dist)
                     ^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\core.py\&quot;, line 201, in run_commands
              dist.run_commands()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\dist.py\&quot;, line 969, in run_commands
              self.run_command(cmd)
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\dist.py\&quot;, line 967, in run_command
              super().run_command(command)
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\dist.py\&quot;, line 988, in run_command
              cmd_obj.run()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 321, in run
              self.find_sources()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 329, in find_sources
              mm.run()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 550, in run
              self.add_defaults()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 591, in add_defaults
              rcfiles = list(walk_revctrl())
                        ^^^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\sdist.py\&quot;, line 16, in walk_revctrl
              yield from ep.load()(dirname)
                         ^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_file_finders\\__init__.py\&quot;, line 103, in find_files
              res: list[str] = command(path)
                               ^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_file_finders\\hg.py\&quot;, line 50, in hg_find_files
              toplevel = _hg_toplevel(path)
                         ^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_file_finders\\hg.py\&quot;, line 18, in _hg_toplevel
              res = _run(
                    ^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_run_cmd.py\&quot;, line 144, in run
              res = subprocess.run(
                    ^^^^^^^^^^^^^^^
            File \&quot;C:\\Users\\Administrator\\AppData\\Roaming\\uv\\python\\cpython-3.12.9-windows-x86_64-none\\Lib\\subprocess.py\&quot;, line 552, in run
              stdout, stderr = process.communicate(input, timeout=timeout)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;C:\\Users\\Administrator\\AppData\\Roaming\\uv\\python\\cpython-3.12.9-windows-x86_64-none\\Lib\\subprocess.py\&quot;, line 1211, in communicate
              stdout, stderr = self._communicate(input, endtime, timeout)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;C:\\Users\\Administrator\\AppData\\Roaming\\uv\\python\\cpython-3.12.9-windows-x86_64-none\\Lib\\subprocess.py\&quot;, line 1632, in _communicate
              raise TimeoutExpired(self.args, orig_timeout)
          subprocess.TimeoutExpired: Command \&#x27;[\&#x27;hg\&#x27;, \&#x27;root\&#x27;]\&#x27; timed out after 40 seconds

          hint: This usually indicates a problem with the package or the build environment.
    ```
    ```
    command=`&quot;V:\\uv\\target\\debug\\uv.exe&quot; &quot;lock&quot; &quot;--cache-dir&quot; &quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache&quot;`
    code=1
    stdout=&quot;&quot;
    stderr=```
      × Failed to build `anyio @ [https://files.pythonhosted.org/packages/db/4d/3970183622f0330d3c23d9b8a5f52e365e50381fd484d08e3285104333d3/anyio-4.3.0.tar.gz`](https://files.pythonhosted.org/packages/db/4d/3970183622f0330d3c23d9b8a5f52e365e50381fd484d08e3285104333d3/anyio-4.3.0.tar.gz%60)
      ├─▶ The build backend returned an error
      ╰─▶ Call to `setuptools.build_meta.build_wheel` failed (exit code: 1)

          [stdout]
          running egg_info
          writing src\\anyio.egg-info\\PKG-INFO
          writing dependency_links to src\\anyio.egg-info\\dependency_links.txt
          writing entry points to src\\anyio.egg-info\\entry_points.txt
          writing requirements to src\\anyio.egg-info\\requires.txt
          writing top-level names to src\\anyio.egg-info\\top_level.txt

          [stderr]
          Traceback (most recent call last):
            File \&quot;&lt;string&gt;\&quot;, line 14, in &lt;module&gt;
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\build_meta.py\&quot;, line 325, in get_requires_for_build_wheel
              return self._get_build_requires(config_settings, requirements=[\&#x27;wheel\&#x27;])
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\build_meta.py\&quot;, line 295, in _get_build_requires
              self.run_setup()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\build_meta.py\&quot;, line 311, in run_setup
              exec(code, locals())
            File \&quot;&lt;string&gt;\&quot;, line 1, in &lt;module&gt;
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\__init__.py\&quot;, line 104, in setup
              return distutils.core.setup(**attrs)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\core.py\&quot;, line 185, in setup
              return run_commands(dist)
                     ^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\core.py\&quot;, line 201, in run_commands
              dist.run_commands()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\dist.py\&quot;, line 969, in run_commands
              self.run_command(cmd)
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\dist.py\&quot;, line 967, in run_command
              super().run_command(command)
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\_distutils\\dist.py\&quot;, line 988, in run_command
              cmd_obj.run()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 321, in run
              self.find_sources()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 329, in find_sources
              mm.run()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 550, in run
              self.add_defaults()
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\egg_info.py\&quot;, line 591, in add_defaults
              rcfiles = list(walk_revctrl())
                        ^^^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools\\command\\sdist.py\&quot;, line 16, in walk_revctrl
              yield from ep.load()(dirname)
                         ^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_file_finders\\__init__.py\&quot;, line 103, in find_files
              res: list[str] = command(path)
                               ^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_file_finders\\hg.py\&quot;, line 50, in hg_find_files
              toplevel = _hg_toplevel(path)
                         ^^^^^^^^^^^^^^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_file_finders\\hg.py\&quot;, line 18, in _hg_toplevel
              res = _run(
                    ^^^^^
            File \&quot;V:\\uv-tmp\\uv\\tests\\.tmpH1jK8V\\cache\\builds-v0\\.tmplldMC6\\Lib\\site-packages\\setuptools_scm\\_run_cmd.py\&quot;, line 144, in run
              res = subprocess.run(
                    ^^^^^^^^^^^^^^^
            File \&quot;C:\\Users\\Administrator\\AppData\\Roaming\\uv\\python\\cpython-3.12.9-windows-x86_64-none\\Lib\\subprocess.py\&quot;, line 552, in run
              stdout, stderr = process.communicate(input, timeout=timeout)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;C:\\Users\\Administrator\\AppData\\Roaming\\uv\\python\\cpython-3.12.9-windows-x86_64-none\\Lib\\subprocess.py\&quot;, line 1211, in communicate
              stdout, stderr = self._communicate(input, endtime, timeout)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            File \&quot;C:\\Users\\Administrator\\AppData\\Roaming\\uv\\python\\cpython-3.12.9-windows-x86_64-none\\Lib\\subprocess.py\&quot;, line 1632, in _communicate
              raise TimeoutExpired(self.args, orig_timeout)
          subprocess.TimeoutExpired: Command \&#x27;[\&#x27;hg\&#x27;, \&#x27;root\&#x27;]\&#x27; timed out after 40 seconds

          hint: This usually indicates a problem with the package or the build environment.
    ```
</code></pre>
<p>more logs at https://gist.github.com/zanieb/e1841842e3f1643fc47b539d02a7eeb4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-27 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">ci-flake</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-27 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssbarnea">@ssbarnea</a> on 2025-10-13 14:08</div>
            <div class="timeline-body"><p>@zanieb Not sure what caused it but I seen this for the first time on <strong>LINUX</strong> https://github.com/ansible/ansible-dev-environment/actions/runs/18468369122/job/52615906699?pr=374 and we make not use of <code>hg</code> ourselves, not sure how we can avoid it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-13 14:12</div>
            <div class="timeline-body"><p>@ssbarnea the fix for you would be to avoid using a source distribution. This isn&#x27;t a uv bug, this is a problem with hg which is invoked by anyio&#x27;s build system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssbarnea">@ssbarnea</a> on 2025-10-13 14:16</div>
            <div class="timeline-body"><p>Thanks for the update. It would be useful to link to an upstream bug to see if it goes into the right direction. TBH considering that (AFAIK) we have no dependency on anything using <code>hg</code>, we would probably not want to execute <code>hg</code> at all. Maybe they can add an option to disable the hg functionality using an environment variable. -- Might be a flake but what if it starts to become more common.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-13 14:19</div>
            <div class="timeline-body"><p>I don&#x27;t know what the upstream bug is. Feel free to open one, but I don&#x27;t have a clear enough reproduction to do so. This issue is just for tracking a flake in uv&#x27;s CI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EliteTK">@EliteTK</a> on 2025-12-22 16:18</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/actions/runs/20436824487/job/58720087106?pr=17216</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:12 UTC
    </footer>
</body>
</html>
