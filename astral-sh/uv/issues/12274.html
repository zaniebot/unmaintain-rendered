<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync fails due to invalid cache - astral-sh/uv #12274</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv sync fails due to invalid cache</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12274">#12274</a>
        opened by <a href="https://github.com/vlaci">@vlaci</a>
        on 2025-03-18 11:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vlaci">@vlaci</a></div>
            <div class="timeline-body">Summary
<p>It started happening right after upgrading from 0.6.5 to 0.6.6.</p>
<p>In our environment, <code>~/.cache/uv</code> is cached between CI runs. My theory is that for some time uv 0.6.5 ran alternating with 0.6.6 on different branches sharing the same cache, as the issue did not happen when 0.6.6 was first introduced.</p>
<p>The error itself is very similar to the one fixed in <a href="https://github.com/astral-sh/uv/pull/11105">astral-sh/uv#11105</a>, but it comes from a different place:</p>
<pre><code>$ uv sync --frozen --no-dev --extra xyz
error: Failed to determine installation plan
Caused by: Failed to deserialize cache entry
Caused by: array had incorrect length, expected 4
</code></pre>
<p>After a cursory glance at the code of <code>Planner.build()</code>, it looks like caching didn&#x27;t get the same treatment in <code>{Http,Local}ArchivePointer::read_from()</code> as <code>SourceDistributionBuilder::url_metadata()</code> got in <a href="https://github.com/astral-sh/uv/pull/11105">astral-sh/uv#11105</a></p>
Platform
<p>Debian 12 (bookworm)</p>
Version
<p>uv 0.6.6</p>
Python version
<p>CPython 3.11.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/vlaci">@vlaci</a> on 2025-03-18 11:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-18 13:47</div>
            <div class="timeline-body"><p>Tagging @Gankra</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/Gankra">@Gankra</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-18 13:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-03-18 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/Gankra">@Gankra</a> on 2025-03-18 15:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:50 UTC
    </footer>
</body>
</html>
