<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unable to install `gitlint` on Windows - astral-sh/uv #8988</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unable to install <code>gitlint</code> on Windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8988">#8988</a>
        opened by <a href="https://github.com/ayussh-verma">@ayussh-verma</a>
        on 2024-11-10 13:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ayussh-verma">@ayussh-verma</a></div>
            <div class="timeline-body">

<p>TL;DR: <code>uv init</code> followed by <code>uv add gitlint==0.19.1</code> fails.  <code>pip install gitlint==0.19.1</code>, however, works.</p>
<p>uv is trying to install the &quot;sh&quot; dependency from gitlint even though I&#x27;m on Windows and the dependency is marked for UNIX only.
<code>DEBUG Adding transitive dependency for gitlint-core==0.19.1: sh{sys_platform != &#x27;win32&#x27;}&gt;=1.14.3, &lt;1.14.3+</code></p>
<pre><code>DEBUG uv 0.5.1 (f399a5271 2024-11-08)
DEBUG Selecting: gitlint==0.19.1 [compatible] (gitlint-0.19.1-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/84/90/8b6a29ddceb51272a054399d4864eefd28083530349f5735e0bb979c5f0f/gitlint-0.19.1-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for gitlint==0.19.1: gitlint-core&gt;=0.19.1, &lt;0.19.1+
DEBUG Adding transitive dependency for gitlint==0.19.1: gitlint-core[trusted-deps]&gt;=0.19.1, &lt;0.19.1+
DEBUG Found fresh response for: https://pypi.org/simple/gitlint-core/
DEBUG Searching for a compatible version of gitlint-core[trusted-deps] (&gt;=0.19.1, &lt;0.19.1+)
DEBUG Selecting: gitlint-core==0.19.1 [compatible] (gitlint_core-0.19.1-py3-none-any.whl)
DEBUG Adding transitive dependency for gitlint-core==0.19.1: gitlint-core==0.19.1
DEBUG Adding transitive dependency for gitlint-core==0.19.1: gitlint-core[trusted-deps]==0.19.1
DEBUG Searching for a compatible version of gitlint-core (==0.19.1)
DEBUG Selecting: gitlint-core==0.19.1 [compatible] (gitlint_core-0.19.1-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/b0/57/dea471da24ceac6de8c3dc5d37e4ddde57a5c340d6bac90010898734de34/gitlint_core-0.19.1-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for gitlint-core==0.19.1: arrow&gt;=1
DEBUG Adding transitive dependency for gitlint-core==0.19.1: click&gt;=8
DEBUG Adding transitive dependency for gitlint-core==0.19.1: sh{sys_platform != &#x27;win32&#x27;}&gt;=1.13.0
DEBUG Searching for a compatible version of gitlint-core[trusted-deps] (==0.19.1)
DEBUG Selecting: gitlint-core==0.19.1 [compatible] (gitlint_core-0.19.1-py3-none-any.whl)
DEBUG Adding transitive dependency for gitlint-core==0.19.1: arrow&gt;=1.2.3, &lt;1.2.3+
DEBUG Adding transitive dependency for gitlint-core==0.19.1: click&gt;=8.1.3, &lt;8.1.3+
DEBUG Found fresh response for: https://pypi.org/simple/arrow/
DEBUG Adding transitive dependency for gitlint-core==0.19.1: sh{sys_platform != &#x27;win32&#x27;}&gt;=1.14.3, &lt;1.14.3+
DEBUG Searching for a compatible version of arrow (&gt;=1.2.3, &lt;1.2.3+)
DEBUG Found fresh response for: https://pypi.org/simple/sh/
DEBUG Selecting: arrow==1.2.3 [compatible] (arrow-1.2.3-py3-none-any.whl)
DEBUG Found fresh response for: https://pypi.org/simple/click/
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/f8/ed/e97229a566617f2ae958a6b13e7cc0f585470eac730a73e9e82c32a3cdd2/arrow-1.3.0-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/c2/f1/df59e28c642d583f7dacffb1e0965d0e00b218e0186d7858ac5233dce840/click-8.1.3-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/00/2e/d53fa4befbf2cfa713304affc7ca780ce4fc1fd8710527771b58311a3229/click-8.1.7-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/67/67/4bca5a595e2f89bff271724ddb1098e6c9e16f7f3d018d120255e3c30313/arrow-1.2.3-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for arrow==1.2.3: python-dateutil&gt;=2.7.0
DEBUG Searching for a compatible version of click (&gt;=8.1.3, &lt;8.1.3+)
DEBUG Selecting: click==8.1.3 [compatible] (click-8.1.3-py3-none-any.whl)
DEBUG Adding transitive dependency for click==8.1.3: colorama{platform_system == &#x27;Windows&#x27;}*
DEBUG Found fresh response for: https://pypi.org/simple/python-dateutil/
DEBUG Searching for a compatible version of sh{sys_platform != &#x27;win32&#x27;} (&gt;=1.14.3, &lt;1.14.3+)
DEBUG Selecting: sh==1.14.3 [compatible] (sh-1.14.3.tar.gz)
DEBUG Adding transitive dependency for sh==1.14.3: sh==1.14.3
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/ec/57/56b9bcc3c9c6a792fcbaf139543cee77261f3651ca9da0c93f5c1221264b/python_dateutil-2.9.0.post0-py2.py3-none-any.whl.metadata
DEBUG Adding transitive dependency for sh==1.14.3: sh{sys_platform != &#x27;win32&#x27;}==1.14.3
DEBUG Found fresh response for: https://pypi.org/simple/colorama/
DEBUG Searching for a compatible version of sh{sys_platform != &#x27;win32&#x27;} (==1.14.3)
DEBUG Selecting: sh==1.14.3 [compatible] (sh-1.14.3.tar.gz)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-10 15:56</div>
            <div class="timeline-body"><p>That&#x27;s because we&#x27;re trying to do a universal resolution. You can instruct the resolve to solve for Windows and non-Windows separately:</p>
<pre><code>[tool.uv]
environments = [&quot;sys_platform == &#x27;win32&#x27;&quot;, &quot;sys_platform != &#x27;win32&#x27;&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-10 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayussh-verma">@ayussh-verma</a> on 2024-11-10 18:56</div>
            <div class="timeline-body"><p>Thank you for the prompt reply. That unfortunately doesn&#x27;t work for me:
To reproduce:</p>
<pre><code>[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;test&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
    &quot;gitlint&quot;,
]

[tool.uv]
environments = [&quot;sys_platform == &#x27;win32&#x27;&quot;, &quot;sys_platform != &#x27;win32&#x27;&quot;]
</code></pre>
<p><code>uv sync --verbose</code></p>
<p>I&#x27;m not sure why uv is trying to install <code>sh</code> even though that is incompatible with windows. Shouldn&#x27;t the installation be skipped?</p>
<p>I&#x27;m able to run <code>uv add red-discordbot</code> (even without the tool.uv section) which declares a dependency &quot;distro&quot; with the marker <code> sys_platform == &#x27;linux&#x27;</code>
uv correctly adds the dependency to the lock file but doesn&#x27;t install <code>distro</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayussh-verma">@ayussh-verma</a> on 2024-11-10 19:27</div>
            <div class="timeline-body"><p>Just as a sanity check, Poetry is able to install gitlint - <code>poetry add gitlint[core]</code></p>
<pre><code>❯ poetry run pip list      
Package         Version
--------------- -----------
arrow           1.2.3
click           8.1.3
colorama        0.4.6
gitlint         0.19.1
gitlint-core    0.19.1
python-dateutil 2.9.0.post0
six             1.16.0
</code></pre>
<p>Here&#x27;s the rest of the debug log</p>
<pre><code>DEBUG Selecting: sh==1.14.3 [compatible] (sh-1.14.3.tar.gz)
DEBUG Acquired lock for `C:\Users\X\AppData\Local\uv\cache\sdists-v6\pypi\sh\1.14.3`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/b7/09/89c28aaf2a49f226fef8587c90c6386bd2cc03a0295bc4ff7fc6ee43c01d/sh-1.14.3.tar.gz
DEBUG No static `pyproject.toml` available for: sh==1.14.3 (MissingPyprojectToml)
DEBUG No static `PKG-INFO` available for: sh==1.14.3 (PkgInfo(UnsupportedMetadataVersion(&quot;1.2&quot;)))
DEBUG No static `egg-info` available for: sh==1.14.3 (MissingRequiresTxt)
DEBUG Preparing metadata for: sh==1.14.3
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.10.15
DEBUG Solving with target Python version: &gt;=3.10.15
DEBUG Adding direct dependency: setuptools&gt;=40.8.0
DEBUG Found stale response for: https://pypi.org/simple/setuptools/
DEBUG Sending revalidation request for: https://pypi.org/simple/setuptools/
DEBUG Found not-modified response for: https://pypi.org/simple/setuptools/
DEBUG Searching for a compatible version of setuptools (&gt;=40.8.0)
DEBUG Selecting: setuptools==75.3.0 [compatible] (setuptools-75.3.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/90/12/282ee9bce8b58130cb762fbc9beabd531549952cac11fc56add11dcb7ea0/setuptools-75.3.0-py3-none-any.whl.metadata
DEBUG Tried 1 versions: setuptools 1
DEBUG marker environment resolution took 0.089s
DEBUG Installing in setuptools==75.3.0 in C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7
DEBUG Requirement already cached: setuptools==75.3.0
DEBUG Installing build requirement: setuptools==75.3.0
DEBUG Creating PEP 517 build environment
DEBUG Calling `setuptools.build_meta:__legacy__.get_requires_for_build_wheel()`
DEBUG Traceback (most recent call last):
DEBUG   File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
DEBUG   File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 333, in get_requires_for_build_wheel
DEBUG     return self._get_build_requires(config_settings, requirements=[])
DEBUG   File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 303, in _get_build_requires
DEBUG     self.run_setup()
DEBUG   File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 521, in run_setup
DEBUG     super().run_setup(setup_script=setup_script)
DEBUG   File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 319, in run_setup
DEBUG     exec(code, locals())
DEBUG   File &quot;&lt;string&gt;&quot;, line 5, in &lt;module&gt;
DEBUG   File &quot;C:\Users\X\AppData\Local\uv\cache\sdists-v6\pypi\sh\1.14.3\d7QG76cQeuGLPVj9Fw5gY\src\sh.py&quot;, line 37, in &lt;module&gt;
DEBUG     import fcntl
DEBUG ModuleNotFoundError: No module named &#x27;fcntl&#x27;
DEBUG Released lock at `C:\Users\X\AppData\Local\uv\cache\sdists-v6\pypi\sh\1.14.3\.lock`
  × Failed to download and build `sh==1.14.3`
  ╰─▶ Build backend failed to determine requirements with `build_wheel()` (exit code: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
        File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 333, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
        File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 303, in _get_build_requires
          self.run_setup()
        File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 521, in run_setup
          super().run_setup(setup_script=setup_script)
        File &quot;C:\Users\X\AppData\Local\uv\cache\builds-v0\.tmpRNTII7\lib\site-packages\setuptools\build_meta.py&quot;, line 319, in run_setup
          exec(code, locals())
        File &quot;&lt;string&gt;&quot;, line 5, in &lt;module&gt;
        File &quot;C:\Users\X\AppData\Local\uv\cache\sdists-v6\pypi\sh\1.14.3\d7QG76cQeuGLPVj9Fw5gY\src\sh.py&quot;, line 37, in &lt;module&gt;
          import fcntl
      ModuleNotFoundError: No module named &#x27;fcntl&#x27;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-10 19:34</div>
            <div class="timeline-body"><p>Just to clarify: the logs <code>DEBUG Adding transitive dependency for gitlint-core==0.19.1: sh{sys_platform != &#x27;win32&#x27;}&gt;=1.14.3, &lt;1.14.3+</code> do <em>not</em> mean that we&#x27;re trying to install that package. They mean we&#x27;re trying to <em>resolve</em> it. So we&#x27;re trying to resolve <code>sh==1.14.3</code>, which means we need its metadata. That package doesn&#x27;t include a wheel (see: https://pypi.org/project/sh/1.14.3/#files). So we have to build it. And we&#x27;re failing to build it for reasons that likely aren&#x27;t related to uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-10 19:35</div>
            <div class="timeline-body"><p>You can probably do <code>environments = [&quot;sys_platform == &#x27;win32&#x27;&quot;]</code> if you <em>only</em> want to resolve for Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-10 19:37</div>
            <div class="timeline-body"><p>My guess is that this works on Poetry due to their heuristics that try to detect source distribution metadata? But those are being removed in the next Poetry release IIUC.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-10 19:39</div>
            <div class="timeline-body"><p>I can test it on my Windows machine later though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayussh-verma">@ayussh-verma</a> on 2024-11-10 20:02</div>
            <div class="timeline-body"><p>I think you&#x27;re absolutely right,
The <a href="https://github.com/amoffat/sh/blob/1.14.3/sh.py">setup file</a> that sh v1.14.3 is using contains <code>import fcntl</code> which is a std-lib module that doesn&#x27;t exist on Windows</p>
<pre><code>[[package]]
name = &quot;sh&quot;
version = &quot;1.14.3&quot;
description = &quot;Python subprocess replacement&quot;
optional = false
python-versions = &quot;*&quot;
files = [
    {file = &quot;sh-1.14.3.tar.gz&quot;, hash = &quot;sha256:e4045b6c732d9ce75d571c79f5ac2234edd9ae4f5fa9d59b09705082bdca18c7&quot;},
]
</code></pre>
<p>This is the lockfile Poetry generated, not sure if it&#x27;s the heuristics like you mentioned</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayussh-verma">@ayussh-verma</a> on 2024-11-10 20:03</div>
            <div class="timeline-body"><p>I want to resolve for both windows &amp; linux though, thankfully this issue made me stumble upon a more well-maintained <a href="https://github.com/conventional-changelog/commitlint">commit linter</a> so I&#x27;ll be parting ways with gitlint... gitlint is using pretty old deps</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-02 03:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-02 03:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:24 UTC
    </footer>
</body>
</html>
