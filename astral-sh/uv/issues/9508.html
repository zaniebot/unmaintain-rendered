<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`constraint-dependencies` not respected outside of pyproject.toml - astral-sh/uv #9508</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>constraint-dependencies</code> not respected outside of pyproject.toml</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9508">#9508</a>
        opened by <a href="https://github.com/cdb39">@cdb39</a>
        on 2024-11-28 17:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cdb39">@cdb39</a></div>
            <div class="timeline-body"><p><code>constraint-dependencies</code> specified in either a project uv.toml, or a user-level uv.toml are ignored, regardless of anything present in the pyproject.toml.  I'm using uv version 0.5.5.</p>
<p>The documentation on constraint dependencies is a bit light but I feel like this is surprising behaviour.</p>
<p>If it is expected, are there any plans to support <code>constraint-dependencies</code> specified in either the user or system-level uv configuration?</p>
<p><strong>Simple example of them working in pyproject.toml</strong></p>
<p>pyproject.toml</p>
<pre><code class="language-toml">[project]
name = &quot;uv-issue&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = []

[tool.uv]
constraint-dependencies = [
    &quot;flask&lt;3&quot;
]
</code></pre>
<p>Running <code>uv add flask</code> does not install a version &gt;=3</p>
<pre><code class="language-shell">Creating virtual environment at: .venv
Resolved 9 packages in 134ms
Prepared 7 packages in 75ms
Installed 7 packages in 2ms
 + blinker==1.9.0
 + click==8.1.7
 + flask==2.3.3
 + itsdangerous==2.2.0
 + jinja2==3.1.4
 + markupsafe==3.0.2
 + werkzeug==3.1.3
</code></pre>
<p><strong>Simple example of them not working in uv.toml</strong></p>
<p>pyproject.toml</p>
<pre><code class="language-toml">[project]
name = &quot;uv-issue&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = []
</code></pre>
<p>uv.toml</p>
<pre><code>constraint-dependencies = [
    &quot;flask&lt;3&quot;
]
</code></pre>
<p>Running <code>uv add flask</code> installs version 3.1.0</p>
<pre><code class="language-shell">Creating virtual environment at: .venv
Resolved 9 packages in 84ms
Prepared 1 package in 32ms
Installed 7 packages in 3ms
 + blinker==1.9.0
 + click==8.1.7
 + flask==3.1.0
 + itsdangerous==2.2.0
 + jinja2==3.1.4
 + markupsafe==3.0.2
 + werkzeug==3.1.3
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-28 17:31</div>
            <div class="timeline-body"><p>Yeah these definitely aren't respected. I honestly thought that we errored here but looks like that's just for <code>dev-dependencies</code> and others.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cdb39">@cdb39</a> on 2024-11-28 18:52</div>
            <div class="timeline-body"><p>Ah ok.  Thanks for the fast response.  Is there a plan to support them in the future?</p>
<p>My use-case is essentially the use-case outlined in the <a href="https://pip.pypa.io/en/stable/user_guide/#constraints-files">pypi guide on constraints file</a>, namely:</p>
<blockquote>
<p>For instance, say that the “helloworld” package doesn’t work in your environment, so you have a local patched version. Some things you install depend on “helloworld”, and some don’t.</p>
<p>...</p>
<p>Constraints files offer a better way: write a single constraints file for your organisation and use that everywhere. If the thing being installed requires “helloworld” to be installed, your fixed version specified in your constraints file will be used.</p>
</blockquote>
<p>The list of constraints is quite long, and can change, so ideally we won't need to individually update every project.</p>
<p>I can see that there was a request for support for a similar workflow (albeit a different implementation) in https://github.com/astral-sh/uv/issues/6518.</p>
<p>I actually think this is also a potential solution to https://github.com/astral-sh/uv/issues/5260, if an organisation is blocking certain package versions, they can declare so in a shared constraints file (or system uv configuration); uv can then use the constraints to skip blocked versions.  As highlighted from the pip docs, this seems to be part of the original intent behind constraint files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-11-29 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-11-29 16:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:37 UTC
    </footer>
</body>
</html>
