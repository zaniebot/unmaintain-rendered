<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtualenv creation is failing on Python embedded versions - astral-sh/uv #1656</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Virtualenv creation is failing on Python embedded versions</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1656">#1656</a>
        opened by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a>
        on 2024-02-18 16:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2024-02-18 16:49</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Hi,</p>
<p>When I try to create a virtualenv from a Python Embedded version on Windows I get the following error:</p>
<pre><code class="language-cmd">Using Python 3.7.9 interpreter at C:\Users\alex\Documents\Python\python-3.7.9-embed-amd64\python.exe
Creating virtualenv at: .venv
uv::venv::creation

  x Failed to create virtualenv
  |-&gt; failed to copy file from C:\Users\alex\Documents\Python\python-3.7.9-embed-amd64\Lib\venv\scripts\nt\python.exe
  |   to \\?\D:\testing\uv\.venv\Scripts\python.exe
  `-&gt; The system cannot find the path specified. (os error 3)
</code></pre>
<p>The path: <code>C:\Users\alex\Documents\Python\python-3.7.9-embed-amd64\Lib\venv\scripts\nt\python.exe</code> doesn't exist.</p>
<p>The error is happening on Windows 10 and uv-0.1.4.</p>
<p>How to recreate the issue:</p>
<ol>
<li>Download an embedded version of Python.</li>
<li>Unzip it on any folder.</li>
<li>Append it to the PATH and make sure it is the Python version by default.</li>
<li>run  <code>uv venv</code>.</li>
<li>Fails.</li>
</ol>
<p>Best,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">virtualenv</span> added by @zanieb on 2024-02-18 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1779.html">astral-sh/uv#1779</a> on 2024-02-23 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2024-02-26 16:54</div>
            <div class="timeline-body"><p>Hey guys,</p>
<p>I wonder if there is any plans to support embedded version, I would really like to bring UV to the company and replace all the libraries we have with Poetry, but sadly, without being able to work with embedded versions, it seems like it won't work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-26 17:02</div>
            <div class="timeline-body"><p>What exactly do you mean by embedded version of python, could you link me to a download page?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2024-02-26 17:03</div>
            <div class="timeline-body"><p>https://www.python.org/ftp/python/3.11.8/python-3.11.8-embed-amd64.zip</p>
<p>https://www.python.org/downloads/release/python-3118/</p>
<p>@konstin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-02-26 18:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-27 13:13</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>I've checked with <code>virtualenv</code> and apparently the strategy for supporting embeddable python version is to check for the shim and if it doesn't exist, copy all files: https://github.com/pypa/virtualenv/blob/cad550030ae77e181a1d7c328742a97f2880ef9b/src/virtualenv/create/via_global_ref/builtin/cpython/cpython3.py#L58-L68</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @konstin on 2024-02-27 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/swz-git">@swz-git</a> on 2024-03-29 19:43</div>
            <div class="timeline-body"><p>When running <code>uv.exe venv testvenv --python .\python-3.11.8-embed-amd64\python.exe</code>, I get</p>
<pre><code class="language-batch">Using Python 3.11.8 interpreter at: python-3.11.8-embed-amd64\python.exe
Creating virtualenv at: testvenv
uv::venv::creation

  x Failed to create virtualenv
  |-&gt; failed to copy file from \\?\C:\Users\simlin1\Downloads\python-3.11.8-embed-amd64\venvwlauncher.exe to
  |   \\?\C:\Users\simlin1\Downloads\testvenv\Scripts\python.exe
  `-&gt; Det g√•r inte att hitta filen. (os error 2)       
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2024-04-19 14:36</div>
            <div class="timeline-body"><p>Yep, same error here. It seems uv is expecting specific files to be there. With virtualenv, there is no problem however.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-19 15:06</div>
            <div class="timeline-body"><p>For starters can we get a minimal reproducible example for this? Like a Dockerfile that I can run to understand the current behavior and what the structure of these embedded Pythons looks like?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-04-19 16:34</div>
            <div class="timeline-body"><p>I can reproduce this when downloading the embedded python from (https://www.python.org/ftp/python/3.11.8/python-3.11.8-embed-amd64.zip) and using it for <code>uv venv -p path\to\embedded\python</code>. The embedded python i looked at was a flat directory which we need to copy to support this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-04-20 03:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-20 03:07</div>
            <div class="timeline-body"><p>I think I see what needs to be changed, and it looks relatively (?) straightforward. Though there are some comments from Paul Moore around this not being an intended use-case for the embedded distribution: https://github.com/pypa/virtualenv/issues/2368#issuecomment-1168574713.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-20 03:19</div>
            <div class="timeline-body"><p>Can anyone just clarify for me what the motivating use-case is for using the embedded Pythons here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pixel-Minions">@Pixel-Minions</a> on 2024-04-20 05:21</div>
            <div class="timeline-body"><p>The comment you mentioned makes sense, there are ways around to create portable versions of python that might work with uv. I will try the nuget or winpython.</p>
<p>The reason for the embedded version is that, after some minor changes to the .pht file and using virtualenv, you can create portable virtual environment, it doesn't get linked to the interpreter source like if you would use a standard Python installation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3161.html">astral-sh/uv#3161</a> on 2024-04-20 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-20 22:04</div>
            <div class="timeline-body"><p>I added virtualenv-like support in https://github.com/astral-sh/uv/pull/3161.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-22 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joetristano">@joetristano</a> on 2024-12-08 02:31</div>
            <div class="timeline-body"><p>Can uv install an embedded python version on windows?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
