<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use uv inside container without venv? - astral-sh/uv #9505</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use uv inside container without venv?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9505">#9505</a>
        opened by <a href="https://github.com/Time0o">@Time0o</a>
        on 2024-11-28 16:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Time0o">@Time0o</a></div>
            <div class="timeline-body"><p>My apologies if this has been asked before but I could not find a solution.</p>
<p>I&#x27;d like to use uv to speed up some Docker image builds, while I&#x27;m at it also installing a different version of Python.</p>
<p>A &quot;naive&quot; approach would be something like:</p>
<pre><code>RUN UV_NO_MODIFY_PATH=1 curl -LsSf https://astral.sh/uv/install.sh | sh &amp;&amp; \
    mv $HOME/.local/bin/uv /usr/local/bin/ &amp;&amp; \ 
    uv python install 3.12 &amp;&amp; \
    uv venv /.venv &amp;&amp; \
    . /.venv/bin/activate &amp;&amp; \
    uv pip install --upgrade pip
</code></pre>
<p>After that I have Python 3.11 and <code>pip</code> available if I source <code>/.venv/bin/activate</code>. But I would prefer not to have to source this file in every subsequent layer. There is the possibility of running <code>uv pip install --system</code> but that only seems to work with the system Python version. There is the possibility of installing Python in a specific location with <code>UV_PYTHON_INSTALL_DIR</code> but uv will complain with &quot;This Python installation is managed by uv and should not be modified.&quot; if I add the contained <code>bin</code> dir to my path and call <code>uv pip install --system</code>. There is also the possibility of pinning the Python version but that is equivalent to the former.</p>
<p>Is there no way to achieve what I want? Do I have to install the version of Python I want via my package manager and then use something like <code>update-alternatives</code>? That seems a bit messy when uv could do the same for me (obviously not a great idea on a production system but for containers...)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-28 17:31</div>
            <div class="timeline-body"><p>You want to install Python using uv, but you don&#x27;t want a virtual environment. Do you want to modify environment of the managed Python directly?
<code>--break-system-packages</code></p>
<pre><code>Allow uv to modify an EXTERNALLY-MANAGED Python installation.

WARNING: --break-system-packages is intended for use in continuous integration (CI) environments, when installing into Python installations that are managed by an external package manager, like apt. It should be used with caution, as such Python installations explicitly recommend against modifications by other package managers (like uv or pip).

May also be set with the UV_BREAK_SYSTEM_PACKAGES environment variable.
</code></pre>
<p>By additionally specifying the path to the managed Python, you should be able to make modifications
https://docs.astral.sh/uv/pip/environments/#using-arbitrary-python-environments</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Time0o">@Time0o</a> on 2024-11-29 07:25</div>
            <div class="timeline-body"><blockquote>
<p>You want to install Python using uv, but you don&#x27;t want a virtual environment. Do you want to modify environment of the managed Python directly? <code>--break-system-packages</code></p>
<pre><code>Allow uv to modify an EXTERNALLY-MANAGED Python installation.

WARNING: --break-system-packages is intended for use in continuous integration (CI) environments, when installing into Python installations that are managed by an external package manager, like apt. It should be used with caution, as such Python installations explicitly recommend against modifications by other package managers (like uv or pip).

May also be set with the UV_BREAK_SYSTEM_PACKAGES environment variable.
</code></pre>
<p>By additionally specifying the path to the managed Python, you should be able to make modifications https://docs.astral.sh/uv/pip/environments/#using-arbitrary-python-environments</p>
</blockquote>
<p>Thanks! By combining <code>UV_PYTHON_INSTALL_DIR</code>, <code>--system</code> and <code>--break-system-packages</code> I can do what I want. For future users, could there maybe be a guide on using <code>uv</code> in CI environments? I could help contribute that if desired.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astrojuanlu">@astrojuanlu</a> on 2024-11-29 14:11</div>
            <div class="timeline-body"><p>Not sure if you&#x27;ve seen this, but FYI https://hynek.me/articles/docker-uv/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-29 16:37</div>
            <div class="timeline-body"><p>Hmm... I think we&#x27;d generally recommend using virtual environments here, so I don&#x27;t know that I&#x27;d want a guide suggesting otherwise. Glad your issue was resolved here though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-29 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-29 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/longqu">@longqu</a> on 2025-03-20 05:24</div>
            <div class="timeline-body"><p>inside the container, we should only have one set of python, so the virtual environment is not needed at all.
The python executable is preferred to be in the PATH directly.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:50 UTC
    </footer>
</body>
</html>
