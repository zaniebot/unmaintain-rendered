<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests in show_settings::* fail due to user-level uv.toml being loaded - astral-sh/uv #15403</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Tests in show_settings::* fail due to user-level uv.toml being loaded</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15403">#15403</a>
        opened by <a href="https://github.com/pposca">@pposca</a>
        on 2025-08-21 08:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pposca">@pposca</a> on 2025-08-21 08:48</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi ðŸ‘‹,</p>
<p>After cloning the repository and running the test suite, Iâ€™m seeing multiple failures in the show_settings::* group.
It seems these tests are not fully isolated from user-level configuration (~/.config/uv/uv.toml), which affects the snapshot expectations.</p>
<p><strong>Steps to reproduce</strong></p>
<ol>
<li>Clone the repository</li>
<li>Ensure Rust and C compiler are installed</li>
<li>cargo run python install</li>
<li>cargo nextest run --no-fail-fast</li>
</ol>
<p><strong>Observed behavior</strong></p>
<p>When running the tests with my normal configuration, I get the following failures:</p>
<p><img width="664" height="227" alt="Image" src="https://github.com/user-attachments/assets/b45aac54-b64c-4852-abee-2ddf68d67a54" /></p>
<p>One issue looks like this:</p>
<p><img width="855" height="702" alt="Image" src="https://github.com/user-attachments/assets/367dddab-b3d2-46d3-b47a-3521f933bc7e" /></p>
<p><img width="1470" height="302" alt="Image" src="https://github.com/user-attachments/assets/7769465c-90fc-402a-a786-ec3f7872c260" /></p>
<p><strong>Analysis</strong></p>
<p>It looks like the tests are picking up my system/user config at:</p>
<p><img width="381" height="68" alt="Image" src="https://github.com/user-attachments/assets/3950a537-2bdf-4b14-b329-c23c1cd58740" /></p>
<p>After commenting out that file and re-running the tests, all the show_settings::* failures disappeared âœ….</p>
<p>This suggests the test suite is not fully isolating $HOME.</p>
<h3>Platform</h3>
<p>openSUSE Tumbleweed x86_64 - Linux 6.16.1-1-default</p>
<h3>Version</h3>
<p>uv 0.8.12</p>
<h3>Python version</h3>
<p>Python 3.14.0rc2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @pposca on 2025-08-21 08:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-21 10:54</div>
            <div class="timeline-body"><p>It looks like these tests clear the variables from our standard test context</p>
<p>https://github.com/astral-sh/uv/blob/b8049eaa20a1f38e7f6530f2ccc793c34e22f334/crates/uv/tests/it/show_settings.rs#L15</p>
<p>otherwise it would be isolated by</p>
<p>https://github.com/astral-sh/uv/blob/7a9e07a98eab351aa49929c70267d52b6abfac56/crates/uv/tests/it/common/mod.rs#L815</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2025-08-21 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @zanieb on 2025-08-21 10:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15434.html">astral-sh/uv#15434</a> on 2025-08-21 21:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-08-21 22:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
