<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv build fails to include modules that have symlinks elsewhere in project - astral-sh/uv #10915</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv build fails to include modules that have symlinks elsewhere in project</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10915">#10915</a>
        opened by <a href="https://github.com/tcjennings">@tcjennings</a>
        on 2025-01-23 21:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tcjennings">@tcjennings</a> on 2025-01-23 21:46</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>As best as I can tell, <code>uv build</code> refuses to add modules to a wheel file when those modules have symlinks elsewhere in the project. These symlinks are not otherwise involved in the package tree. <code>hatch build</code> still works correctly.</p>
<h3>Minimal Reproducible Example</h3>
<ul>
<li>uv 0.5.23</li>
</ul>
<pre><code>uv init --package youvee-test
cd youvee-test
mkdir -p src/youvee_test/foo/templates
mkdir -p src/youvee_test/foo/settings

touch src/youvee_test/__init__.py
touch src/youvee_test/foo/__init__.py
touch src/youvee_test/foo/settings/__init__.py
touch src/youvee_test/foo/templates/__init__.py
touch src/youvee_test/foo/templates/module.py
touch src/youvee_test/foo/templates/not_py.yaml
</code></pre>
<p>pyproject.toml</p>
<pre><code>[project]
name = &quot;youvee-test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
authors = [
    { name = &quot;...&quot;, email = &quot;...&quot; }
]
requires-python = &quot;&gt;=3.12&quot;
dependencies = []

[project.scripts]
youvee-test = &quot;youvee_test:main&quot;

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
<p><code>uv build</code> creates a correct wheel at this point:</p>
<pre><code>❯ unzip -l dist/youvee_test-0.1.0-py3-none-any.whl
Archive:  dist/youvee_test-0.1.0-py3-none-any.whl
  Length      Date    Time    Name
---------  ---------- -----   ----
       57  02-02-2020 00:00   youvee_test/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/settings/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/templates/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/templates/module.py
        0  02-02-2020 00:00   youvee_test/foo/templates/not_py.yaml
      166  02-02-2020 00:00   youvee_test-0.1.0.dist-info/METADATA
       87  02-02-2020 00:00   youvee_test-0.1.0.dist-info/WHEEL
       49  02-02-2020 00:00   youvee_test-0.1.0.dist-info/entry_points.txt
      834  02-02-2020 00:00   youvee_test-0.1.0.dist-info/RECORD
---------                     -------
     1193                     10 files
</code></pre>
<p><strong>Add a symlink farm to the project root.</strong></p>
<pre><code>mkdir ./foo
pushd foo
ln -s ../src/youvee_test/foo/settings .
ln -s ../src/youvee_test/foo/templates .
popd
</code></pre>
<p><code>uv build</code> creates an incorrect wheel now:</p>
<pre><code>❯ unzip -l dist/youvee_test-0.1.0-py3-none-any.whl
Archive:  dist/youvee_test-0.1.0-py3-none-any.whl
  Length      Date    Time    Name
---------  ---------- -----   ----
       57  02-02-2020 00:00   youvee_test/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/__init__.py
      166  02-02-2020 00:00   youvee_test-0.1.0.dist-info/METADATA
       87  02-02-2020 00:00   youvee_test-0.1.0.dist-info/WHEEL
       49  02-02-2020 00:00   youvee_test-0.1.0.dist-info/entry_points.txt
      475  02-02-2020 00:00   youvee_test-0.1.0.dist-info/RECORD
---------                     -------
      834                     6 files
</code></pre>
<p><code>hatch build</code> creates a correct wheel:</p>
<pre><code>❯ unzip -l dist/youvee_test-0.1.0-py3-none-any.whl
Archive:  dist/youvee_test-0.1.0-py3-none-any.whl
  Length      Date    Time    Name
---------  ---------- -----   ----
       57  02-02-2020 00:00   youvee_test/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/settings/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/templates/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/templates/module.py
        0  02-02-2020 00:00   youvee_test/foo/templates/not_py.yaml
      166  02-02-2020 00:00   youvee_test-0.1.0.dist-info/METADATA
       87  02-02-2020 00:00   youvee_test-0.1.0.dist-info/WHEEL
       49  02-02-2020 00:00   youvee_test-0.1.0.dist-info/entry_points.txt
      836  02-02-2020 00:00   youvee_test-0.1.0.dist-info/RECORD
---------                     -------
     1195                     10 files
</code></pre>
<p><strong>Remove a symlink from the farm</strong></p>
<pre><code>rm foo/settings
</code></pre>
<p><code>uv build</code> is partially correct: the module that is not symlinked into the farm is now included:</p>
<pre><code>❯ unzip -l dist/youvee_test-0.1.0-py3-none-any.whl
Archive:  dist/youvee_test-0.1.0-py3-none-any.whl
  Length      Date    Time    Name
---------  ---------- -----   ----
       57  02-02-2020 00:00   youvee_test/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/__init__.py
        0  02-02-2020 00:00   youvee_test/foo/settings/__init__.py
      166  02-02-2020 00:00   youvee_test-0.1.0.dist-info/METADATA
       87  02-02-2020 00:00   youvee_test-0.1.0.dist-info/WHEEL
       49  02-02-2020 00:00   youvee_test-0.1.0.dist-info/entry_points.txt
      565  02-02-2020 00:00   youvee_test-0.1.0.dist-info/RECORD
---------                     -------
      924                     7 files
</code></pre>
<h3>Platform</h3>
<p>Darwin 24.1.0 arm64</p>
<h3>Version</h3>
<p>uv 0.5.23 (ba42467f1 2025-01-23)</p>
<h3>Python version</h3>
<p>Python 3.13.0, Python 3.12.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @tcjennings on 2025-01-23 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-23 21:56</div>
            <div class="timeline-body"><p>Does <code>python -m build</code> (using https://github.com/pypa/build) produce the same result?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tcjennings">@tcjennings</a> on 2025-01-23 21:59</div>
            <div class="timeline-body"><p>For what it's worth, <code>python -m build</code> (without involving uv at all) has the same behavior.</p>
<pre><code>rm -rf .venv
python -m venv .venv
activate .venv/bin/activate
pip install build
python -m build
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-23 22:11</div>
            <div class="timeline-body"><p>If <code>python -m build</code> has the same behavior as <code>uv build</code> then this is a Hatch-specific problem, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tcjennings">@tcjennings</a> on 2025-01-23 22:39</div>
            <div class="timeline-body"><p>I think I found the incantation that works around whatever the problem is: explicitly exclude and skip the symlink farm directory.</p>
<p><code>pyproject.toml</code>:</p>
<pre><code>[tool.hatch.build]
skip-excluded-dirs = true
exclude = [&quot;/foo&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-01-23 22:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-01-23 22:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2025-01-23 22:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-25 22:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:58 UTC
    </footer>
</body>
</html>
