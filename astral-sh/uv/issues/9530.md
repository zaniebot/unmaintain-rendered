```yaml
number: 9530
title: "`uv pip compile` doesn't propagate markers on recursive self-extras"
type: issue
state: closed
author: charliermarsh
labels:
  - bug
  - help wanted
assignees: []
created_at: 2024-11-29T19:26:52Z
updated_at: 2024-11-30T03:40:24Z
url: https://github.com/astral-sh/uv/issues/9530
synced_at: 2026-01-10T04:36:21Z
```

# `uv pip compile` doesn't propagate markers on recursive self-extras

---

_Issue opened by @charliermarsh on 2024-11-29 19:26_

E.g., given:
```toml
[project]
name = "testing"
version = "0.1.0"
requires-python = ">=3.11"
dependencies = []

[project.optional-dependencies]
base = [
    "tomli>=2.2.1",
]
self = [
    "testing[base]; platform_system == 'Windows'",
]

[tool.uv.sources]
testing = { workspace = true }
```

You get:

```shell
‚ùØ uv pip compile ./foo/pyproject.toml --universal --all-extras
Resolved 2 packages in 90ms
# This file was autogenerated by uv via the following command:
#    uv pip compile ./foo/pyproject.toml --universal --all-extras
testing @ file:///Users/crmarsh/workspace/uv/foo ; platform_system == 'Windows'
    # via testing (./foo/pyproject.toml)
tomli==2.2.1
    # via
    #   testing (./foo/pyproject.toml)
    #   testing
```

It's the same as https://github.com/astral-sh/uv/issues/9499, but for `-r pyproject.toml` which goes through a different codepath (we read the dependencies prior to hitting the resolver).

---

_Label `bug` added by @charliermarsh on 2024-11-29 19:26_

---

_Label `help wanted` added by @charliermarsh on 2024-11-29 19:26_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-11-30 03:05_

---

_Closed by @charliermarsh on 2024-11-30 03:40_

---

_Closed by @charliermarsh on 2024-11-30 03:40_

---
