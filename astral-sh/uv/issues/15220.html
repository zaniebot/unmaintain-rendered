<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force newest lock file format (revision = 3, upload-time=...) - astral-sh/uv #15220</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Force newest lock file format (revision = 3, upload-time=...)</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15220">#15220</a>
        opened by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a>
        on 2025-08-11 13:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a> on 2025-08-11 13:36</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We use <code>uv lock</code> as a pre-commit hook, with the newest version of uv specified in pre-commit-config.yaml.</p>
<p>However, we still keep getting different versions of uv.lock, depending on which developer pc which local uv version was most recently used to add a library.
This causes many unrelated changes in the diff for uv.lock, because older uv versions apparently remove e.g. the upload-time=... sections from all hashes.</p>
<p>The <code>uv lock</code> from the pre-commit hook, which is version-pinned, and should always be the correct version, apparently does not rewrite the lock file, even if the format.revision do not match.</p>
<p>Is there a way to force <code>uv lock</code> to also check the format and revision of the lock file?</p>
<p>The workaround I found is e.g.
<code>uv add my-test-package &amp;&amp; uv remove my-test-package</code>, which seems like a terrible hack.</p>
<h3>Example</h3>
<p><code>uv lock --force</code>
-&gt; Rewrite lock file in the newest format, adding revision = 3, upload-time=... for all hashes.</p>
<h3>Example of a uv.lock diff that resulted from commits by different developers, not detected by <code>uv lock</code></h3>
<pre><code class="language-diff">--- a/uv.lock
+++ b/uv.lock
@@ -1,4 +1,5 @@
 version = 1
+revision = 3
 requires-python = &quot;&gt;=3.10&quot;
 resolution-markers = [
     &quot;python_full_version &gt;= '3.12.4' and sys_platform != 'win32'&quot;,
@@ -24,9 +25,9 @@ members = [
 name = &quot;aiohappyeyeballs&quot;
 version = &quot;2.4.6&quot;
 source = { registry = &quot;https://pypi.org/simple&quot; }
-sdist = { url = &quot;https://files.pythonhosted.org/packages/08/07/508f9ebba367fc3370162e53a3cfd12f5652ad79f0e0bfdf9f9847c6f159/aiohappyeyeballs-2.4.6.tar.gz&quot;, hash = &quot;sha256:9b05052f9042985d32ecbe4b59a77ae19c006a78f1344d7fdad69d28ded3d0b0&quot;, size = 21726 }
+sdist = { url = &quot;https://files.pythonhosted.org/packages/08/07/508f9ebba367fc3370162e53a3cfd12f5652ad79f0e0bfdf9f9847c6f159/aiohappyeyeballs-2.4.6.tar.gz&quot;, hash = &quot;sha256:9b05052f9042985d32ecbe4b59a77ae19c006a78f1344d7fdad69d28ded3d0b0&quot;, size = 21726, upload-time = &quot;2025-02-07T17:53:12.277Z&quot; }
 wheels = [
-    { url = &quot;https://files.pythonhosted.org/packages/44/4c/03fb05f56551828ec67ceb3665e5dc51638042d204983a03b0a1541475b6/aiohappyeyeballs-2.4.6-py3-none-any.whl&quot;, hash = &quot;sha256:147ec992cf873d74f5062644332c539fcd42956dc69453fe5204195e560517e1&quot;, size = 14543 },
+    { url = &quot;https://files.pythonhosted.org/packages/44/4c/03fb05f56551828ec67ceb3665e5dc51638042d204983a03b0a1541475b6/aiohappyeyeballs-2.4.6-py3-none-any.whl&quot;, hash = &quot;sha256:147ec992cf873d74f5062644332c539fcd42956dc69453fe5204195e560517e1&quot;, size = 14543, upload-time = &quot;2025-02-07T17:53:10.304Z&quot; },
 ]
 

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @Ben-grmbl on 2025-08-11 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-11 14:32</div>
            <div class="timeline-body"><p>Adding <code>uv lock --force</code> is fine with me.</p>
<p>You might want to add a <code>required-version</code> for uv in your <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @zanieb on 2025-08-11 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/swirle13">@swirle13</a> on 2025-08-12 21:13</div>
            <div class="timeline-body"><p>I'm just some passerby who happens to have experience with this on his team. I use a solution that should mitigate your core issue of devs with different versions of uv.</p>
<p>I use a modified version of this repo, https://github.com/a5chin/python-uv, where it sets up a dev container environment to standardize everything. So when it installs all packages and features, including uv, it's always the same version. Rebuilding of the dev container makes it quick to get everyone on the same page in case anyone has long-running containers with outdated packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mint-o-badges/badgr-server/pulls/557.html">mint-o-badges/badgr-server#557</a> on 2025-08-27 07:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/11happy">@11happy</a> on 2025-09-06 10:00</div>
            <div class="timeline-body"><p>Hii @zanieb  :) , Can I work on this ?</p>
<p>Thank you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-06 11:53</div>
            <div class="timeline-body"><p>Yep!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15757.html">astral-sh/uv#15757</a> on 2025-09-09 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Silvanoc">@Silvanoc</a> on 2025-09-15 10:26</div>
            <div class="timeline-body"><blockquote>
<p>Adding <code>uv lock --force</code> is fine with me.</p>
<p>You might want to add a <code>required-version</code> for uv in your <code>pyproject.toml</code>.</p>
</blockquote>
<p>Weird, I don't find any option <code>--force</code> for <code>uv lock</code>. Using UV 0.8.17.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Silvanoc">@Silvanoc</a> on 2025-09-15 10:29</div>
            <div class="timeline-body"><p>I am having the issue in an OSS with many contributors using different UV versions. Mine using this new Lock File format revision 3 and others using the older revision 1.</p>
<p>Having an option like <code>--lock-version=1.1</code> would be enough for me to avoid these conflicts in such a mixed environment. Somewhere on time the whole project should migrate to revision 3 and done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ir1d">@Ir1d</a> on 2025-09-19 22:11</div>
            <div class="timeline-body"><p>same.. somehow i dont have <code>--force</code> im using <code>v0.8.19</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-20 02:13</div>
            <div class="timeline-body"><p>@Silvanoc / @Ir1d the option has not yet been added, see https://github.com/astral-sh/uv/pull/15757</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-20 02:13</div>
            <div class="timeline-body"><p>@Silvanoc I'd recommend just adding a <code>tool.uv.required-version</code> lower bound?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Silvanoc">@Silvanoc</a> on 2025-09-22 07:36</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/Silvanoc">@Silvanoc</a> I'd recommend just adding a <code>tool.uv.required-version</code> lower bound?</p>
</blockquote>
<p>That would force the whole community of the OSS project where I faced the issue to upgrade UV, right? I will try, since it's probably something meaningful to do, but I'm not sure I will get it accepted. Otherwise, I'll need to downgrade my UV with pipx or so.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../populationgenomics/cpg-flow/pulls/130.html">populationgenomics/cpg-flow#130</a> on 2025-09-22 22:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../open-edge-platform/training_extensions/pulls/4965.html">open-edge-platform/training_extensions#4965</a> on 2025-10-30 12:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ciscorn/mojxml-py/pulls/61.html">ciscorn/mojxml-py#61</a> on 2025-11-10 15:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
