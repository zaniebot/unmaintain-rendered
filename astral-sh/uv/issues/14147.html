<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync --locked` broken when using `uv add` for ssh git dependency - astral-sh/uv #14147</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv sync --locked` broken when using `uv add` for ssh git dependency</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/14147">#14147</a>
        opened by <a href="https://github.com/ultrabear">@ultrabear</a>
        on 2025-06-19 23:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ultrabear">@ultrabear</a> on 2025-06-19 23:30</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>after using uv add to add an ssh auth based private github repository (and specifying git as the login user in the string), <code>uv sync --locked</code> will assert that the lockfile must be changed, doing a <code>uv lock</code> will not update the lockfile nor will a <code>uv sync</code>, the problem it seems to face is the dependency is listed with the username obfuscated with <code>****</code> in uv.lock in one area, for some reason, and manually changing that to git makes things work again, either <code>uv sync --locked</code> behavior should accept the obfuscated name being generated by <code>uv add</code>, or uv add should stop obfuscating the name</p>
<p>Min repro:</p>
<pre><code class="language-fish">uv init locked_error
cd locked_error
# a public python git repository I have ownership 
# over for example, this also happens for private git repos
uv add git+ssh://git@github.com/ultrabear/url_strip
# sanity
uv sync

uv sync --locked # ERROR: the heck?? we just did a uv sync and everything
</code></pre>
<p>Temporary fix (manually edit lockfile):</p>
<pre><code class="language-diff">-requires-dist = [{ name = &quot;url-strip&quot;, git = &quot;ssh://****@github.com/ultrabear/url_strip&quot; }]
+requires-dist = [{ name = &quot;url-strip&quot;, git = &quot;ssh://git@github.com/ultrabear/url_strip&quot; }]
</code></pre>
<p>pictures:</p>
<p><img src="https://github.com/user-attachments/assets/f525dce3-9734-4eb8-b602-0e295de65e52" alt="Image" /></p>
<p>(this was also tested against pipx latest(0.7.13) and still had the same error)</p>
<h3>Platform</h3>
<p>Linux 6.14.9-300.fc42.x86_64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.7.9</p>
<h3>Python version</h3>
<p>Python 3.11.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ultrabear on 2025-06-19 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-20 13:23</div>
            <div class="timeline-body"><p>I don't think this error exists in newer versions. I just ran those commands without error:</p>
<pre><code>❯ uv init locked_error
Initialized project `locked-error` at `/Users/crmarsh/workspace/locked_error`

❯ cd locked_error

❯ uv add git+ssh://git@github.com/ultrabear/url_strip
Using CPython 3.13.2
Creating virtual environment at: .venv
    Updated ssh://git@github.com/ultrabear/url_strip (9bc6bc205c947e7662fd44d83e9577
Resolved 3 packages in 157ms
      Built url-strip @ git+ssh://git@github.com/ultrabear/url_strip@9bc6bc205c947e7
Prepared 2 packages in 338ms
Installed 2 packages in 1ms
 + typing-extensions==4.14.0
 + url-strip==0.2.2b0 (from git+ssh://git@github.com/ultrabear/url_strip@9bc6bc205c947e7662fd44d83e95778f53d6a32f)

❯ uv sync
Resolved 3 packages in 0.46ms
Audited 2 packages in 0.01ms

❯ uv sync --locked
Resolved 3 packages in 0.40ms
Audited 2 packages in 0.01ms
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-06-20 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-06-20 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ultrabear">@ultrabear</a> on 2025-06-20 16:32</div>
            <div class="timeline-body"><p>What version are you using?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ultrabear">@ultrabear</a> on 2025-06-20 16:34</div>
            <div class="timeline-body"><p>Ok, looks like uv add as of 0.7.13 does not add the <code>****</code> that was causing errors
but it still does error on <code>uv sync --locked</code> if the <code>****</code> are present in the lockfile</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-20 16:35</div>
            <div class="timeline-body"><p>Latest (v0.7.13). Writing <code>****</code> was itself a bug in a prior version that we then fixed. I'd suggest removing it or regenerating the lock.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ultrabear">@ultrabear</a> on 2025-06-20 16:38</div>
            <div class="timeline-body"><p>Got it, will close for now as its at least not generating a broken state in newer releases, will have to wait on Fedora to fix this on my real setup though, boo hoo /lh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ultrabear on 2025-06-20 16:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:04 UTC
    </footer>
</body>
</html>
