<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` refers to system Python as a virtual environment when using `UV_PROJECT_ENVIRONMENT` - astral-sh/uv #11206</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv sync` refers to system Python as a virtual environment when using `UV_PROJECT_ENVIRONMENT`</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11206">#11206</a>
        opened by <a href="https://github.com/edmorley">@edmorley</a>
        on 2025-02-03 23:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/edmorley">@edmorley</a> on 2025-02-03 23:27</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using <code>UV_PROJECT_ENVIRONMENT</code> and it points at a system Python installation, the verbose/debug logs refer to it as a virtual environment, when it's not. eg:</p>
<pre><code class="language-Dockerfile">FROM python:3.12-slim-bookworm
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

ENV UV_PROJECT_ENVIRONMENT=/usr/local

WORKDIR /testcase
RUN uv init
RUN uv sync --verbose
</code></pre>
<pre><code>$ docker build . --progress plain --no-cache
...
#10 [stage-0 5/5] RUN uv sync --verbose
#10 0.123 DEBUG uv 0.5.26
#10 0.125 DEBUG Found project root: `/testcase`
#10 0.125 DEBUG No workspace root found, using project root
#10 0.125 DEBUG Reading Python requests from version file at `/testcase/.python-version`
#10 0.125 DEBUG Using Python request `3.12` from version file at `.python-version`
#10 0.125 DEBUG Checking for Python environment at `/usr/local`
#10 0.221 DEBUG The virtual environment's Python version satisfies `3.12`
#10 0.222 DEBUG Using request timeout of 30s
#10 0.222 DEBUG Found static `pyproject.toml` for: testcase @ file:///testcase
#10 0.223 DEBUG No workspace root found, using project root
#10 0.224 DEBUG Solving with installed Python version: 3.12.8
#10 0.224 DEBUG Solving with target Python version: &gt;=3.12
#10 0.225 DEBUG Adding direct dependency: testcase*
#10 0.225 DEBUG Searching for a compatible version of testcase @ file:///testcase (*)
#10 0.225 DEBUG Tried 1 versions: testcase 1
#10 0.225 DEBUG all marker environments resolution took 0.001s
#10 0.225 Resolved 1 package in 4ms
#10 0.226 DEBUG Using request timeout of 30s
#10 0.226 DEBUG Preserving seed package: pip==24.3.1
#10 0.226 Audited in 0.08ms
#10 DONE 0.2s
</code></pre>
<p>For example:
<code>The virtual environment's Python version satisfies 3.12</code></p>
<p>This debug output originates from:
https://github.com/astral-sh/uv/blob/73e9928d406e9ea45eea7f69fb9ec578f38b4657/crates/uv/src/commands/project/mod.rs#L617-L634</p>
<p>The virtual environment references also happen in some error messages, eg:</p>
<pre><code class="language-Dockerfile">FROM python:3.12-slim-bookworm
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

ENV UV_PROJECT_ENVIRONMENT=/usr/local

WORKDIR /testcase
RUN uv init --python 3.13
RUN uv sync --verbose
</code></pre>
<pre><code>$ docker build . --progress plain --no-cache
...
#10 [stage-0 5/5] RUN uv sync --verbose
#10 0.120 DEBUG uv 0.5.27
#10 0.122 DEBUG Found project root: `/testcase`
#10 0.122 DEBUG No workspace root found, using project root
#10 0.122 DEBUG Reading Python requests from version file at `/testcase/.python-version`
#10 0.122 DEBUG Using Python request `3.13` from version file at `.python-version`
#10 0.122 DEBUG Checking for Python environment at `/usr/local`
#10 0.218 DEBUG The virtual environment's Python version does not satisfy `3.13`
#10 0.218 DEBUG Searching for Python 3.13 in managed installations or search path
#10 0.218 DEBUG Searching for managed installations at `/root/.local/share/uv/python`
#10 0.219 DEBUG Found `cpython-3.12.8-linux-aarch64-gnu` at `/usr/local/bin/python3` (search path)
#10 0.219 DEBUG Skipping interpreter at `/usr/local/bin/python3` from search path: does not satisfy request `3.13`
#10 0.318 DEBUG Found `cpython-3.12.8-linux-aarch64-gnu` at `/usr/local/bin/python` (search path)
#10 0.318 DEBUG Skipping interpreter at `/usr/local/bin/python` from search path: does not satisfy request `3.13`
#10 0.318 DEBUG Found `cpython-3.12.8-linux-aarch64-gnu` at `/usr/local/bin/python3` (search path)
#10 0.318 DEBUG Skipping interpreter at `/usr/local/bin/python3` from search path: does not satisfy request `3.13`
#10 0.318 DEBUG Found `cpython-3.12.8-linux-aarch64-gnu` at `/usr/local/bin/python` (search path)
#10 0.318 DEBUG Skipping interpreter at `/usr/local/bin/python` from search path: does not satisfy request `3.13`
#10 0.318 DEBUG Requested Python not found, checking for available download...
#10 0.319 DEBUG Acquired lock for `/root/.local/share/uv/python`
#10 0.319 DEBUG Using request timeout of 30s
#10 0.319 INFO Fetching requested Python...
#10 1.003 DEBUG Downloading https://github.com/astral-sh/python-build-standalone/releases/download/20250115/cpython-3.13.1%2B20250115-aarch64-unknown-linux-gnu-install_only_stripped.tar.gz to temporary location: /root/.local/share/uv/python/.temp/.tmpm4901a
#10 1.003 DEBUG Extracting cpython-3.13.1%2B20250115-aarch64-unknown-linux-gnu-install_only_stripped.tar.gz
#10 1.927 DEBUG Moving /root/.local/share/uv/python/.temp/.tmpm4901a/python to /root/.local/share/uv/python/cpython-3.13.1-linux-aarch64-gnu
#10 2.043 DEBUG Released lock at `/root/.local/share/uv/python/.lock`
#10 2.043 Using CPython 3.13.1
#10 2.043 error: Project virtual environment directory `/usr/local` cannot be used because it is not a compatible environment but cannot be recreated because it is not a virtual environment
</code></pre>
<p>...where the error message describes it as both a virtual environment and not at the same time :-)</p>
<blockquote>
<p>error: Project virtual environment directory <code>/usr/local</code> cannot be used because it is not a compatible environment but cannot be recreated because it is not a virtual environment</p>
</blockquote>
<p>The error message seems to originate from:
https://github.com/astral-sh/uv/blob/73e9928d406e9ea45eea7f69fb9ec578f38b4657/crates/uv/src/commands/project/mod.rs#L164</p>
<h3>Platform</h3>
<p>Debian bookworm</p>
<h3>Version</h3>
<p>0.5.27</p>
<h3>Python version</h3>
<p>Python 3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @edmorley on 2025-02-03 23:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-03 23:34</div>
            <div class="timeline-body"><p>We should just refer to &quot;project environment&quot; when feasible. Both in user-facing messaging and throughout our internals, we use &quot;virtual environment&quot; frequently for &quot;a Python environment&quot; whether its actually virtual or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2025-02-03 23:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @zanieb on 2025-02-03 23:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/edmorley">@edmorley</a> on 2025-02-03 23:57</div>
            <div class="timeline-body"><p>Yeah agree :-)</p>
<p>Also, I think it would be helpful if this:</p>
<blockquote>
<p>cannot be used because it is not a compatible environment</p>
</blockquote>
<p>...explained why it wasn't a compatible environment - since at the moment with non-verbose logs there's no way to tell.</p>
<p>(Let me know if you'd like this filed as a separate issue)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-04 00:01</div>
            <div class="timeline-body"><p>I can take a look at that too, but generally it means that it didn't fulfill your Python request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/edmorley">@edmorley</a> on 2025-02-04 00:11</div>
            <div class="timeline-body"><blockquote>
<p>but generally it means that it didn't fulfill your Python request.</p>
</blockquote>
<p>Yeah in that testcase the Python version was (intentionally) mismatched.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:59 UTC
    </footer>
</body>
</html>
