<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv reports false dependency conflict for pywin32; sys_platform == 'win32' on Linux with private PyPI - astral-sh/uv #16613</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv reports false dependency conflict for pywin32; sys_platform == &#x27;win32&#x27; on Linux with private PyPI</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16613">#16613</a>
        opened by <a href="https://github.com/FlyingHeNanman">@FlyingHeNanman</a>
        on 2025-11-06 12:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/FlyingHeNanman">@FlyingHeNanman</a></div>
            <div class="timeline-body"><strong>Title</strong>
<p>False dependency conflict when resolving conditional dependency <code>pywin32; sys_platform == &#x27;win32&#x27;</code> with private PyPI repository on Linux</p>
<hr>
<strong>Description</strong>
<p>I&#x27;m using <strong>uv 0.8.22</strong> in a <strong>Linux</strong> environment, and I&#x27;m encountering a false dependency resolution failure when building with a <strong>private PyPI repository (Nexus)</strong> inside a Docker build.</p>
<p>My project depends on <code>docker</code>, which has a conditional dependency:</p>
<pre><code>pywin32; sys_platform == &#x27;win32&#x27;
</code></pre>
<p>However, since I‚Äôm on Linux and my private repository only contains Linux packages, there is <strong>no <code>pywin32</code> package</strong> available.
Despite this, uv still fails to resolve dependencies, reporting that <code>pywin32&gt;=304</code> cannot be found ‚Äî even though that dependency should not apply on Linux.</p>
<p>If I upload a dummy <code>pywin32</code> package to my private PyPI, the problem disappears.
This suggests that uv‚Äôs resolver may incorrectly treat ‚Äúmissing platform-specific dependencies‚Äù as hard conflicts when using a private mirror that returns an empty response.</p>
<hr>
<strong>Steps to Reproduce</strong>
<ol>
<li><p>Use a <strong>private PyPI mirror</strong> (e.g., Nexus) with Linux-only packages.</p>
</li>
<li><p>Create a minimal project:</p>
<pre><code>[project]
name = &quot;mini-container-service&quot;
version = &quot;0.1.0&quot;
dependencies = [&quot;docker&quot;]
</code></pre>
</li>
<li><p>Run:</p>
<pre><code>uv sync -v
</code></pre>
</li>
<li><p>Observe the dependency resolution failure.</p>
</li>
</ol>
<hr>
<strong>Expected Behavior</strong>
<p>uv should <strong>ignore conditional dependencies</strong> like <code>pywin32; sys_platform == &#x27;win32&#x27;</code> on non-Windows systems, even if the private PyPI returns no package for them.</p>
<hr>
<strong>Actual Behavior</strong>
<p>uv fails with a false dependency conflict:</p>
<pre><code>√ó No solution found when resolving dependencies:
‚ï∞‚îÄ‚ñ∂ Because only pywin32{sys_platform == &#x27;win32&#x27;}&lt;304 is available and docker==7.1.0 depends on pywin32{sys_platform == &#x27;win32&#x27;}&gt;=304, we can conclude that docker==7.1.0 cannot be used.
    And because only docker==7.1.0 is available and your project depends on docker, we can conclude that your project&#x27;s requirements are unsatisfiable.
</code></pre>
<p>Full verbose log excerpt:</p>

Click to expand

<pre><code>DEBUG uv 0.8.22
DEBUG Found project root: `/home/mini-container-service`
DEBUG Using Python request `3.13` from version file at `.python-version`
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: &gt;=3.13
DEBUG Adding direct dependency: docker*
DEBUG Adding transitive dependency for docker==7.1.0: pywin32{sys_platform == &#x27;win32&#x27;}&gt;=304
DEBUG No cache entry for: http://10.10.100.21:8081/repository/pypi-hosted/simple/pywin32/
DEBUG Searching for a compatible version of pywin32{sys_platform == &#x27;win32&#x27;} (&gt;=304)
DEBUG No compatible version found for: pywin32{sys_platform == &#x27;win32&#x27;}
√ó No solution found when resolving dependencies:
‚ï∞‚îÄ‚ñ∂ Because only pywin32{sys_platform == &#x27;win32&#x27;}&lt;304 is available and docker==7.1.0 depends on pywin32{sys_platform == &#x27;win32&#x27;}&gt;=304, we can conclude that docker==7.1.0 cannot be used.
</code></pre>


<hr>
<strong>Environment</strong>
<ul>
<li><strong>uv version:</strong> 0.8.22</li>
<li><strong>Python version:</strong> 3.13.7</li>
<li><strong>OS:</strong> Linux (Docker environment)</li>
<li><strong>Private PyPI:</strong> Nexus Repository Manager</li>
<li><strong>Network setup:</strong> Air-gapped / internal mirror (no access to pypi.org)</li>
</ul>
<hr>
<strong>Workaround</strong>
<p>Uploading a dummy <code>pywin32</code> wheel (or any <code>pywin32</code> version) to the private repository resolves the problem, which confirms this is not a real dependency conflict.</p>
<hr>
<strong>Possible Cause</strong>
<p>uv‚Äôs resolver may not properly skip platform-specific dependencies when a private repository responds with an empty ‚Äúsimple index‚Äù for that package.
This causes the solver to incorrectly register a conflict instead of ignoring the irrelevant dependency.</p>
<hr>
<strong>Question</strong>
<p>Is this expected behavior, or a known limitation of uv‚Äôs resolver when using private PyPI mirrors?
If not, I believe this should be treated as a <strong>bug</strong>.</p>
Platform
<p>Linux 5.15.0-119-generic x86_64 GNU/Linux</p>
Version
<p>uv 0.8.22</p>
Python version
<p>3.13.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/FlyingHeNanman">@FlyingHeNanman</a> on 2025-11-06 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-06 14:37</div>
            <div class="timeline-body"><p>In order to create, update, or validate a <code>uv.lock</code> file, uv needs to be able to access all of the declared dependencies to extract their metadata -- even those that won&#x27;t ultimately be installed. So it&#x27;s correct for uv to look in the internal registry even on non-Windows machines, as the lockfile is intended to be used across <em>all</em> platforms.</p>
<p>If you create a <code>uv.lock</code> and check it in, you can (e.g.) install on a non-Windows machine using <code>uv sync --frozen</code> and we won&#x27;t hit that index. In other words, if the lockfile already exists, uv can use it and doesn&#x27;t require access to dependencies it won&#x27;t install; but to <em>create</em> (or update, or validate) the lockfile, we need access to all of them.</p>
<p>You could also tell uv that you don&#x27;t need to resolve on Windows at all with:</p>
<pre><code>[tool.uv]
environments = [
    &quot;sys_platform == &#x27;linux&#x27;&quot;,
]
</code></pre>
<p>(See: https://docs.astral.sh/uv/concepts/resolution/#limited-resolution-environments)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-06 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-06 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FlyingHeNanman">@FlyingHeNanman</a> on 2025-11-08 14:51</div>
            <div class="timeline-body"><p>Thank you very much for the detailed explanation!
It‚Äôs clear now ‚Äî I misunderstood how uv handles dependency resolution across environments. I should have read the documentation on limited resolution environments more carefully.</p>
<p>Appreciate your time and clarification! I‚Äôm closing this issue. üôè</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/FlyingHeNanman">@FlyingHeNanman</a> on 2025-11-08 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-08 16:27</div>
            <div class="timeline-body"><p>No worries, glad I could help, thank you for following up!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:55 UTC
    </footer>
</body>
</html>
