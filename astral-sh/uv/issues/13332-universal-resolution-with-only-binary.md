---
number: 13332
title: "Universal resolution with `only-binary`"
type: issue
state: open
author: tkukushkin
labels:
  - question
assignees: []
created_at: 2025-05-07T16:00:51Z
updated_at: 2025-05-08T20:11:18Z
url: https://github.com/astral-sh/uv/issues/13332
synced_at: 2026-01-10T01:25:32Z
---

# Universal resolution with `only-binary`

---

_Issue opened by @tkukushkin on 2025-05-07 16:00_

### Question

Hello! I have a small problem with universal resolution for pymssql.

First circumstance:
- [pymssql==2.3.4](https://pypi.org/project/pymssql/2.3.4/#files) doesn't have wheels for Windows x86-64
- [pymssql==2.3.3](https://pypi.org/project/pymssql/2.3.3/#files) doesn't have wheels for linux

Second circumstance: it's not very easy to install pymssql on windows without wheels.

So I generate requirements.txt like that:

```
echo 'pymssql' | uv pip compile --universal --only-binary pymssql -
```

but I get:

```
Resolved 1 package in 589ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --universal --only-binary pymssql -
pymssql==2.3.4
```

I tried to add uv.toml with
```toml
required-environments = [
  "sys_platform == 'win32' and platform_machine == 'x86_64'",
  "sys_platform == 'linux' and platform_machine == 'x86_64'",
]
```
but it didn't help.

How can I ask uv to take into consideration availability of wheels for some specific environments?


### Platform

Darwin 24.3.0 arm64

### Version

uv 0.7.2 (481d05d8d 2025-04-30)

---

_Label `question` added by @tkukushkin on 2025-05-07 16:00_

---

_Comment by @zanieb on 2025-05-07 16:14_

I don't think `uv pip compile` respects `required-environments`. I think you need to use a `pyproject.toml` and a `uv.lock` then `uv export` if you want a `requirements.txt` file?

---

_Comment by @tkukushkin on 2025-05-07 16:30_

It's interesting that is seems `uv pip compile` respects `environments` somehow, but it generates unusable requirements.txt:
```
❯ echo -e "pymssql" | uv pip compile --only-binary pymssql --universal --emit-build-options -
Resolved 1 package in 13ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --only-binary pymssql --universal --emit-build-options -
--only-binary pymssql

pymssql==2.3.4 ; platform_machine == 'x86_64' and sys_platform == 'win32'
```

---

_Comment by @konstin on 2025-05-07 16:39_

I can't reproduce this on linux, it looks correct on my machine, both with and without `required-environments` in `uv.toml`:

```
$ echo -e "pymssql" | uv pip compile --only-binary pymssql --universal --emit-build-options -
Resolved 1 package in 133ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --only-binary pymssql --universal --emit-build-options -
--only-binary pymssql

pymssql==2.3.4
```

---

_Comment by @tkukushkin on 2025-05-07 16:46_

Um, I can reproduce it in docker:
```
❯ docker run -it --rm --pull=always ghcr.io/astral-sh/uv:debian bash
debian: Pulling from astral-sh/uv
Digest: sha256:8f75d47049441186e0c4901f7a657decf16a03cddd3ade62ffabc6d177f0db33
Status: Image is up to date for ghcr.io/astral-sh/uv:debian
root@489fed716acc:/# uv --version
uv 0.7.2
root@489fed716acc:/# echo "environments = [\"sys_platform == 'win32' and platform_machine == 'x86_64'\"]" > uv.toml
root@489fed716acc:/# echo -e "pymssql" | uv pip compile --only-binary pymssql --universal --emit-build-options -
Resolved 1 package in 4.93s
# This file was autogenerated by uv via the following command:
#    uv pip compile --only-binary pymssql --universal --emit-build-options -
--only-binary pymssql

pymssql==2.3.4 ; platform_machine == 'x86_64' and sys_platform == 'win32'
```

---

_Comment by @tkukushkin on 2025-05-07 16:48_

Oh, I see the difference, you tried with `required-environments`, but I mentioned `environments` [here](https://github.com/astral-sh/uv/issues/13332#issuecomment-2859239908).

---

_Comment by @tkukushkin on 2025-05-07 17:02_

I just mean `environments` and `required-environments` are pretty similar in scope of use options , and if `uv pip compile` respects `environments` (even if does it wrong), it seems strange to me that `uv pip compile` doesn't respect `required-environments`.

I would like to use pyproject.toml, but we have requirements.in in hundreds repositories and this migration will not be so easy. 
At the moment, it seems it's easier for me to just pin pymssql==2.3.2 which has all necessary wheels.

---

_Comment by @konstin on 2025-05-08 20:11_

CC @charliermarsh re `environments` and `required-environments` being treated differently in `uv pip compile`.

---
