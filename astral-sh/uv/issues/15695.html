<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV Sync is using the wrong platform wheels - astral-sh/uv #15695</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV Sync is using the wrong platform wheels</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15695">#15695</a>
        opened by <a href="https://github.com/mechstei03">@mechstei03</a>
        on 2025-09-05 07:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mechstei03">@mechstei03</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<h1>Information</h1>
<h2>Architecture</h2>
<p><code>bash python3 -c &quot;import platform; print(platform.system().lower())&quot;</code>
<em>linux</em></p>
<p><code>python3 -c &quot;import platform; print(platform.machine().lower())&quot;</code>
<em>x86_64</em></p>
<p>command:  <em>lscpu</em></p>
<pre><code>Architektur:             x86_64
CPU Operationsmodus:     32-bit, 64-bit
Byte-Reihenfolge:        Little Endian
CPU(s):                  8
Liste der Online-CPU(s): 0-7
Thread(s) pro Kern:      1
Kern(e) pro Socket:      1
Sockel:                  8
NUMA-Knoten:             1
Anbieterkennung:         GenuineIntel
Prozessorfamilie:        6
Modell:                  85
Modellname:              Intel(R) Xeon(R) Gold 6226R CPU @ 2.90GHz
Stepping:                7
CPU MHz:                 2893.202
BogoMIPS:                5786.40
Hypervisor-Anbieter:     VMware
Virtualisierungstyp:     voll
L1d Cache:               32K
L1i Cache:               32K
L2 Cache:                1024K
L3 Cache:                22528K
NUMA-Knoten0 CPU(s):     0-7
</code></pre>
<h2>Issue</h2>
<p>When downloading from a linux x86_64 machine suing command</p>
<p><code>uv sync</code></p>
<p>the wheels downloaded includes aarch64.</p>
<p>Can we use some parameter or somehow only get the x86_64 platform wheels ?`
We tried --platform , -- python-platform and both did not work or fix the issue</p>
<h2>Recreation of issue / Log</h2>
<pre><code>[build-system]
requires = [&quot;setuptools&gt;=67.0.0&quot;, &quot;wheel&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = &quot;pyflask-com&quot;
version = &quot;1.0.0&quot;
authors = [
]

dependencies = [
    &quot;torch==2.7.1&quot;,
    &quot;torchvision==0.22.1&quot;
]

[tool.uv]
dev-dependencies = [
    &quot;pytest==8.4.1&quot;,
    &quot;pytest-env==1.1.5&quot;,
    &quot;twine==6.1.0&quot;,
    &quot;build==1.3.0&quot;,
    &quot;pylint==3.3.8&quot;
]

[project.optional-dependencies]
dev = [
]

[tool.pytest.ini_options]
pythonpath = [
    &quot;.&quot;, &quot;src&quot;,
]

</code></pre>
<p>Example of transitive package that downloads as aarch64.whl</p>
<pre><code>nvidia_cuda_cupti_cu12-12.6.80-py3-none-manylinux2014_aarch64.manylinux_2_17_aarch64.whl
</code></pre>
<h3>Platform</h3>
<p>Linux 4.18.0-553.72.1.el8_10.x86_64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.8.13</p>
<h3>Python version</h3>
<p>Python 3.11.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mechstei03 on 2025-09-05 07:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 09:35</div>
            <div class="timeline-body"><p>Does something fail when running Python code? How are you determining it's downloading aarch64 wheels?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mechstei03">@mechstei03</a> on 2025-09-05 11:24</div>
            <div class="timeline-body"><p>Hi @konstin , thanks for the quick reply</p>
<blockquote>
<p>Does something fail when running Python code? How are you determining it's downloading aarch64 wheels?</p>
</blockquote>
<p>We have a sonatype server that needs each package to be whitelisted or allowed for it to be downloaded.
during the download we can see that the package downloaded is a aarch64 package as sonatype is blocking it from being downloaded. the same package x86_64 architecture is already allowed and should be able to download normally without error . we confirmed this by using pip install normally which results in no error and only a x86_64 package.</p>
<p>Please let me know if you need more info</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 11:49</div>
            <div class="timeline-body"><p>In universal resolution, when the index supports neither PEP 658 nor range requests, uv uses one wheel to get the METADATA file which lists all dependencies. This isn't necessarily the same wheel as the current platform, uv picks one deterministically but otherwise without regards to the current platform (to avoid getting different resolution behavior on different platforms). It downloads this wheel to extract the METADATA file from it, but doesn't use it otherwise. The best solution would be PEP 658 support in the index, which also solves the performance problems with downloading a wheel just for the METADATA. Another option would be not advertising wheels in the index that are not actually available to download: uv needs to trust the index information the index sends it, and if it contains aarch64 wheels, uv assumes those exist and are available.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mechstei03">@mechstei03</a> on 2025-09-05 12:22</div>
            <div class="timeline-body"><p>@konstin  can you please refer me to documentation as for PEP658 implementationn in the index ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 12:23</div>
            <div class="timeline-body"><p>The reference for PEP 658 is at https://peps.python.org/pep-0658/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mechstei03">@mechstei03</a> on 2025-09-08 06:01</div>
            <div class="timeline-body"><p>Thank you . will close the ticket</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mechstei03 on 2025-09-08 06:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:32:49 UTC
    </footer>
</body>
</html>
