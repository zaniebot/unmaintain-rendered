<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deleting .venv of Project B fails when running Project A due to locked files - astral-sh/uv #15164</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Deleting .venv of Project B fails when running Project A due to locked files</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15164">#15164</a>
        opened by <a href="https://github.com/ctykk">@ctykk</a>
        on 2025-08-08 10:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ctykk">@ctykk</a> on 2025-08-08 10:41</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><strong>Description:</strong>
When both Project A and Project B include some same dependencies (like <code>aiohttp</code>), and I am running Project A, attempting to delete the <code>aiohttp</code> directory inside Project B’s <code>.venv</code> – specifically <code>.venv/Lib/site-packages/aiohttp</code> – fails with an error indicating the file or directory is in use by another process. However, deleting other files or directories inside Project B’s <code>site-packages</code> succeeds without issue.</p>
<p><strong>Steps to Reproduce:</strong></p>
<ol>
<li>Ensure both Project A and Project B depend on <code>aiohttp</code>.</li>
<li>Activate and run Project A, which loads <code>aiohttp</code> from its own environment.</li>
<li>In a separate terminal or from file explorer, attempt to delete <code>ProjectB/.venv/Lib/site-packages/aiohttp</code>.</li>
<li>Observe an error indicating &quot;File in use&quot; or similar.</li>
<li>Attempt deleting other directories (e.g., other packages) in the same <code>site-packages</code> – these delete cleanly.</li>
</ol>
<p><strong>Expected Behavior:</strong>
It should be possible to delete any directory within an inactive project’s <code>.venv</code>, regardless of shared dependencies present in other running virtual environments.</p>
<p><strong>Actual Behavior:</strong>
Deletion of <code>aiohttp</code> within Project B’s <code>.venv</code> is blocked when Project A is running and has aiohttp loaded. Other packages still delete normally.</p>
<h3>Platform</h3>
<p>Windows 10 x64</p>
<h3>Version</h3>
<p>uv 0.8.2 (21fadbcc1 2025-07-22)</p>
<h3>Python version</h3>
<p>Python 3.13.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ctykk on 2025-08-08 10:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-08-08 12:39</div>
            <div class="timeline-body"><p>Can you provide more details about how you've set these projects up and what commands you're running?</p>
<p>I tried the following on Windows 11 and couldn't reproduce:</p>
<ol>
<li>Created a directory with two subdirectories, <code>a</code> and <code>b</code>.</li>
<li>In each of <code>a</code> and <code>b</code>, ran <code>uv init &amp;&amp; uv add aiohttp</code></li>
<li>In <code>a</code>, ran <code>source .venv/Scripts/activate</code>.</li>
<li>In a separate terminal, successfully deleted <code>.venv/Lib/site-packages/aiohttp</code> in <code>b</code>.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @jtfmumm on 2025-08-08 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ctykk">@ctykk</a> on 2025-08-08 17:33</div>
            <div class="timeline-body"><ol>
<li>add <code>aiohttp</code> to <code>a</code> and <code>b</code></li>
<li>keep this script running in project <code>a</code></li>
</ol>
<pre><code class="language-python">from asyncio import run, sleep
from aiohttp import ClientSession, ClientTimeout

async def main():
    async with ClientSession() as session:
        async with session.get('https://www.bing.com', timeout=ClientTimeout(total=600)) as resp:
            await sleep(600)
            await resp.read()

if __name__ == '__main__':
    run(main())
</code></pre>
<ol start="3">
<li>try delete <code>b/.venv</code></li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-08-08 20:05</div>
            <div class="timeline-body"><p>I'm still not able to reproduce from the command line (trying from both PowerShell and WSL) when running the script (though I am on Windows 11). I can delete <code>b/.venv</code> successfully.</p>
<p>When initially setting up the two projects, are you creating a new, separate directory for each and running <code>uv init &amp;&amp; uv add aiohttp</code>? Or are you following any other steps prior to running the script in <code>a</code> and then trying to delete <code>b/.venv</code>?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:11 UTC
    </footer>
</body>
</html>
