<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uninterpreted color codes in some error messages - astral-sh/uv #15840</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Uninterpreted color codes in some error messages</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15840">#15840</a>
        opened by <a href="https://github.com/fleetingbytes">@fleetingbytes</a>
        on 2025-09-14 15:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/fleetingbytes">@fleetingbytes</a> on 2025-09-14 15:27</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>In the issue #15799 (now fixed) @konstin and @eabase noticed that certain error messages contain uninterpreted color code tags.</p>
<p>minimal example of reproducing this on FreeBSD (amd64):</p>
<pre><code class="language-sh">uv init rebuild
cd rebuild
uv add cffi
uv sync --verbose
</code></pre>
<p>produces:</p>
<pre><code class="language-log">DEBUG uv 0.8.17 (21a92c163 2025-09-11)
DEBUG Found project root: `/home/tejul/src/rebuild`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/home/tejul/src/rebuild`
DEBUG Reading Python requests from version file at `/home/tejul/src/rebuild/.python-version`
DEBUG Using Python request `3.11` from version file at `.python-version`
DEBUG Checking for Python environment at: `.venv`
DEBUG The project environment's Python version satisfies the request: `Python 3.11`
DEBUG Released lock at `/tmp/uv-6ba0532bfdeb457a.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: rebuild @ file:///home/tejul/src/rebuild
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 3 packages in 0.57ms
DEBUG Using request timeout of 30s
DEBUG Platform tags mismatch for cffi==2.0.0: The distribution is compatible with \x1b[36mFreeBSD\x1b[39m (`\x1b[36mfreebsd_14_2_release_amd64\x1b[39m`), but you're on \x1b[36mFreeBSD\x1b[39m (`\x1b[36mfreebsd_14_2_RELEASE_x86_64\x1b[39m`)
</code></pre>
<p>The lines appear with properly interpreted color. The word <code>DEBUG</code> at the start of the line is cyan (or light blue), but the last line about platform tags mismatch has some uninterpreted color codes later on.</p>
<p>The error about the mismatched platform tags has been fixed in #15799, but the issue with the rogue color codes still remains.</p>
<p>It may be masked by the fix because as far I have seen, this type of message is the only one where it occurs.</p>
<p>Attached is the output of <code>python -m sysconfig</code></p>
<p><a href="https://github.com/user-attachments/files/22321299/system-python-sysconfig.txt">system-python-sysconfig.txt</a></p>
<h3>Platform</h3>
<p>FreeBSD 14.2-RELEASE amd64</p>
<h3>Version</h3>
<p>uv 0.8.17 (21a92c163 2025-09-11)</p>
<h3>Python version</h3>
<p>Python 3.11.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @fleetingbytes on 2025-09-14 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15799.html">astral-sh/uv#15799</a> on 2025-09-14 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-14 15:46</div>
            <div class="timeline-body"><p>What terminal and shell are you using?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fleetingbytes">@fleetingbytes</a> on 2025-09-14 15:55</div>
            <div class="timeline-body"><p>Alacrity and zsh. I can give you their exact versions later. I currently don't have access to my machine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../PyO3/maturin/pulls/2741.html">PyO3/maturin#2741</a> on 2025-09-14 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-14 16:03</div>
            <div class="timeline-body"><p>Thank you for the sysconfig!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fleetingbytes">@fleetingbytes</a> on 2025-09-14 17:40</div>
            <div class="timeline-body"><p>Just for completeness:</p>
<ul>
<li>the uninterpreted color codes appear also when I use <code>--color never</code>.</li>
<li>alacritty 0.16.0-dev (985def87)</li>
<li>zsh 5.9 (amd64-portbld-freebsd14.1)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-09-14 18:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-14 18:16</div>
            <div class="timeline-body"><p>I actually see the same thing (but it's masked by only being present in <code>--verbose</code>):</p>
<pre><code>DEBUG Platform tags mismatch for numpy==2.3.3: The distribution is compatible with \x1b[36mmacOS\x1b[39m (`\x1b[36mmacosx_14_0_arm64\x1b[39m`), but you're on \x1b[36mLinux\x1b[39m (`\x1b[36mmanylinux_2_28_x86_64\x1b[39m`)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-14 18:18</div>
            <div class="timeline-body"><p>It looks like a general problem whereby color codes in debug messages get misinterpreted (we rarely use these):</p>
<pre><code>DEBUG Identified uncached distribution: \x1b[32mnumpy==2.3.3\x1b[39m
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15843.html">astral-sh/uv#15843</a> on 2025-09-14 18:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-14 18:57</div>
            <div class="timeline-body"><p>As far as I can tell, https://github.com/astral-sh/uv/issues/11560 was closed but is still broken:</p>
<pre><code>‚ùØ uv python install 3.13 -v --color=never
DEBUG uv 0.8.16 (2de677b0d 2025-09-09)
DEBUG Acquired lock for `/Users/crmarsh/.local/share/uv/python`
DEBUG Found `\x1b[32mcpython-3.13.6-macos-aarch64-none\x1b[39m` for request `\x1b[36m3.13 (cpython-3.13-macos-aarch64-none)\x1b[39m`
DEBUG Using request timeout of 30s
DEBUG Inspecting existing executable at `/Users/crmarsh/.local/bin/python3.13`
DEBUG Executable at `/Users/crmarsh/.local/bin/python3.13` is already for `cpython-3.13.6-macos-aarch64-none`
DEBUG Released lock at `/Users/crmarsh/.local/share/uv/python/.lock`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-14 19:24</div>
            <div class="timeline-body"><p>Ahh, I see... This was changed in https://github.com/tokio-rs/tracing/pull/3368 in response to a security vulnerability. And there doesn't seem to be a way to turn it back on: https://github.com/tokio-rs/tracing/issues/3369. So this likely worked after https://github.com/astral-sh/uv/pull/11604, but &quot;regressed&quot; when we upgraded <code>tracing-subscriber</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tokio-rs/tracing/issues/3378.html">tokio-rs/tracing#3378</a> on 2025-09-15 07:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-09-17 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15913.html">astral-sh/uv#15913</a> on 2025-09-17 14:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:12 UTC
    </footer>
</body>
</html>
