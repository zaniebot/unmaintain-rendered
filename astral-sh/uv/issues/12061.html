<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` hangs on `setuptools.build_meta:__legacy__.get_requires_for_build_wheel` - astral-sh/uv #12061</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv add</code> hangs on <code>setuptools.build_meta:__legacy__.get_requires_for_build_wheel</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12061">#12061</a>
        opened by <a href="https://github.com/rllin">@rllin</a>
        on 2025-03-08 00:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rllin">@rllin</a> on 2025-03-08 00:40</div>
            <div class="timeline-body"><h3>Summary</h3>
<h2>repro</h2>
<pre><code class="language-bash">uv init
uv add apache-beam
uv add datasets
</code></pre>
<h2>trace</h2>
<p>I can't seem to get more logs out of this</p>
<pre><code>DEBUG Found fresh response for: https://files.pythonhosted.org/packages/58/17/5151b6ac2ac9b6276d46c33369ff814b0901872b2a0871771252f02e9192/multiprocess-0.70.9.tar.gz
   Building multiprocess==0.70.9
DEBUG Building: multiprocess==0.70.9
TRACE Preview is disabled, not checking for direct build
DEBUG Using base executable for virtual environment: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.12.8
DEBUG Solving with target Python version: &gt;=3.12.8
TRACE Assigned packages:
TRACE Chose package for decision: root. remaining choices:
DEBUG Adding direct dependency: setuptools&gt;=40.8.0
INFO add_decision: Id::&lt;PubGrubPackage&gt;(0) @ 0a0.dev0 without checking dependencies
TRACE Fetching metadata for setuptools from https://pypi.org/simple/setuptools/
TRACE Assigned packages: root==0a0.dev0
TRACE Chose package for decision: setuptools. remaining choices:
TRACE Cached request https://pypi.org/simple/setuptools/ is storable because its response has a 'public' cache-control directive
TRACE Freshness lifetime found via cache-control max age setting: 600s
DEBUG Found fresh response for: https://pypi.org/simple/setuptools/
TRACE Received package metadata for: setuptools
TRACE Selecting candidate for setuptools with range &gt;=40.8.0 with 589 remote versions
DEBUG Searching for a compatible version of setuptools (&gt;=40.8.0)
TRACE Selecting candidate for setuptools with range &gt;=40.8.0 with 589 remote versions
TRACE Found candidate for package setuptools with range &gt;=40.8.0 after 1 steps: 75.8.2 version
TRACE Returning candidate for package setuptools with range &gt;=40.8.0 after 1 steps
TRACE Found candidate for package setuptools with range &gt;=40.8.0 after 1 steps: 75.8.2 version
TRACE Returning candidate for package setuptools with range &gt;=40.8.0 after 1 steps
DEBUG Selecting: setuptools==75.8.2 [compatible] (setuptools-75.8.2-py3-none-any.whl)
TRACE Cached request https://files.pythonhosted.org/packages/a9/38/7d7362e031bd6dc121e5081d8cb6aa6f6fedf2b67bf889962134c6da4705/setuptools-75.8.2-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Freshness lifetime found via cache-control max age setting: 365000000s
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/a9/38/7d7362e031bd6dc121e5081d8cb6aa6f6fedf2b67bf889962134c6da4705/setuptools-75.8.2-py3-none-any.whl.metadata
TRACE Received built distribution metadata for: setuptools==75.8.2
INFO add_decision: Id::&lt;PubGrubPackage&gt;(1) @ 75.8.2 without checking dependencies
TRACE Assigned packages: root==0a0.dev0, setuptools==75.8.2
DEBUG Tried 1 versions: setuptools 1
DEBUG marker environment resolution took 0.001s
TRACE Resolution: ResolverEnvironment { kind: Specific { marker_env: ResolverMarkerEnvironment(MarkerEnvironment { inner: MarkerEnvironmentInner { implementation_name: &quot;cpython&quot;, implementation_version: StringVersion { string: &quot;3.12.8&quot;, version: &quot;3.12.8&quot; }, os_name: &quot;posix&quot;, platform_machine: &quot;arm64&quot;, platform_python_implementation: &quot;CPython&quot;, platform_release: &quot;24.3.0&quot;, platform_system: &quot;Darwin&quot;, platform_version: &quot;Darwin Kernel Version 24.3.0: Thu Jan  2 20:24:22 PST 2025; root:xnu-11215.81.4~3/RELEASE_ARM64_T6041&quot;, python_full_version: StringVersion { string: &quot;3.12.8&quot;, version: &quot;3.12.8&quot; }, python_version: StringVersion { string: &quot;3.12&quot;, version: &quot;3.12&quot; }, sys_platform: &quot;darwin&quot; } }) } }
TRACE Resolution edge: ROOT -&gt; setuptools
TRACE Resolution edge:     0a0.dev0 -&gt; 75.8.2
DEBUG Installing in setuptools==75.8.2 in /Users/randall/.cache/uv/builds-v0/.tmpWAr3l3
DEBUG Registry requirement already cached: setuptools==75.8.2
DEBUG Installing build requirement: setuptools==75.8.2
TRACE Extracting file name=PackageName(&quot;setuptools&quot;)
TRACE Cloning /Users/randall/.cache/uv/archive-v0/7RlhyIIdWf5xI6NlX_nsg/setuptools-75.8.2.dist-info to /Users/randall/.cache/uv/builds-v0/.tmpWAr3l3/lib/python3.12/site-packages/setuptools-75.8.2.dist-info
TRACE Cloning /Users/randall/.cache/uv/archive-v0/7RlhyIIdWf5xI6NlX_nsg/distutils-precedence.pth to /Users/randall/.cache/uv/builds-v0/.tmpWAr3l3/lib/python3.12/site-packages/distutils-precedence.pth
TRACE Cloning /Users/randall/.cache/uv/archive-v0/7RlhyIIdWf5xI6NlX_nsg/setuptools to /Users/randall/.cache/uv/builds-v0/.tmpWAr3l3/lib/python3.12/site-packages/setuptools
TRACE Cloning /Users/randall/.cache/uv/archive-v0/7RlhyIIdWf5xI6NlX_nsg/pkg_resources to /Users/randall/.cache/uv/builds-v0/.tmpWAr3l3/lib/python3.12/site-packages/pkg_resources
TRACE Cloning /Users/randall/.cache/uv/archive-v0/7RlhyIIdWf5xI6NlX_nsg/_distutils_hack to /Users/randall/.cache/uv/builds-v0/.tmpWAr3l3/lib/python3.12/site-packages/_distutils_hack
TRACE Extracted 5 files name=PackageName(&quot;setuptools&quot;)
TRACE No entrypoints name=PackageName(&quot;setuptools&quot;)
TRACE No data name=PackageName(&quot;setuptools&quot;)
TRACE Writing installer metadata name=PackageName(&quot;setuptools&quot;)
TRACE Writing record name=PackageName(&quot;setuptools&quot;)
DEBUG Creating PEP 517 build environment
DEBUG Calling `setuptools.build_meta:__legacy__.get_requires_for_build_wheel()`
</code></pre>
<h3>Platform</h3>
<p>macos</p>
<h3>Version</h3>
<p>0.6.5</p>
<h3>Python version</h3>
<p>3.12.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @rllin on 2025-03-08 00:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 00:55</div>
            <div class="timeline-body"><p>Historically, this is usually a bug in setuptools</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 00:56</div>
            <div class="timeline-body"><p>Like</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/11238</li>
<li>https://github.com/pypa/setuptools/issues/332</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rllin">@rllin</a> on 2025-03-08 01:00</div>
            <div class="timeline-body"><p>@zanieb thanks for quick response!</p>
<p>seems like
<code> uv run pip install --use-pep517 --no-cache --force-reinstall &quot;datasets&quot;</code>
this works fine, am i maybe misunderstanding?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 01:19</div>
            <div class="timeline-body"><p>The error seems to be on &quot;multiprocess==0.70.9&quot;? What happens if you install that in isolation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 01:21</div>
            <div class="timeline-body"><p><code>uv add</code> could resolve to a different version than <code>uv pip install</code> or <code>pip install</code> because it's universal resolution rather than single-platform <em>and</em> <code>pip</code> won't into account previously installed packages so it doesn't care that you also require <code>apache-beam</code> there.</p>
<p>ref https://docs.astral.sh/uv/concepts/resolution/#platform-specific-resolution</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rllin">@rllin</a> on 2025-03-08 01:48</div>
            <div class="timeline-body"><p><code>multiprocess==0.70.9</code> alone also hangs similarly!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-08 14:25</div>
            <div class="timeline-body"><p>It seems like a problem with that package, you could add a constraint that avoids it? Like</p>
<pre><code class="language-toml">[tool.uv]
constraint-dependencies = [&quot;multiprocess&gt;0.70.9&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wchen99998">@wchen99998</a> on 2025-07-18 16:23</div>
            <div class="timeline-body"><p>still running into this issue, can't install apache_beam at all</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-07-21 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @konstin on 2025-07-21 12:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:57 UTC
    </footer>
</body>
</html>
