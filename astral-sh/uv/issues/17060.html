<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV took the wrong torch nightly for the Linux and Windows Platform - astral-sh/uv #17060</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV took the wrong torch nightly for the Linux and Windows Platform</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17060">#17060</a>
        opened by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a>
        on 2025-12-10 00:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I ran uv lock to update the uv.lock file with torch nightly</p>
<p>it updateD the uv.lock with version:
windows: 2.10.0.dev20251208+cu130<br />
linux:        2.10.0.dev20251209+cu130 (this version does not even exist in pytorch nightly index)
https://download.pytorch.org/whl/nightly/torch/
at the time I ran this uv lock, the latest version is as below
windows: 2.10.0.dev20251209+cu130
linux:        2.10.0.dev20251208+cu130
the uv.lock file seems like mismatch linux with windows version, and mismatched windows with linux version</p>
<h3>Platform</h3>
<p>Linux 6.14.0-37-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>astral-sh/setup-uv@v7</p>
<h3>Python version</h3>
<p>3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @lanluo-nvidia on 2025-12-10 00:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-10 00:56</div>
            <div class="timeline-body"><p>Can you please include a complete reproduction? What was the state of your <code>uv.lock</code> file and <code>pyproject.toml</code> when you ran <code>uv.lock</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-10 00:57</div>
            <div class="timeline-body"><p>Here is the wrong torch record in the uv.lock file:
[[package]]
name = &quot;torch&quot;
version = &quot;2.10.0.dev20251208+cu130&quot;
source = { registry = &quot;https://download.pytorch.org/whl/nightly/cu130&quot; }
resolution-markers = [
&quot;python_full_version &gt;= '3.13' and sys_platform == 'windows'&quot;,
&quot;python_full_version == '3.12.*' and sys_platform == 'windows'&quot;,
&quot;python_full_version &lt; '3.12' and sys_platform == 'windows'&quot;,
]
dependencies = [
{ name = &quot;filelock&quot;, marker = &quot;sys_platform == 'windows'&quot; },
{ name = &quot;fsspec&quot;, marker = &quot;sys_platform == 'windows'&quot; },
{ name = &quot;jinja2&quot;, marker = &quot;sys_platform == 'windows'&quot; },
{ name = &quot;networkx&quot;, marker = &quot;sys_platform == 'windows'&quot; },
{ name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12' and sys_platform == 'windows'&quot; },
{ name = &quot;sympy&quot;, marker = &quot;sys_platform == 'windows'&quot; },
{ name = &quot;typing-extensions&quot;, marker = &quot;sys_platform == 'windows'&quot; },
]</p>
<p>[[package]]
name = &quot;torch&quot;
version = &quot;2.10.0.dev20251209+cu130&quot;
source = { registry = &quot;https://download.pytorch.org/whl/nightly/cu130&quot; }
resolution-markers = [
&quot;python_full_version &gt;= '3.13' and sys_platform == 'linux'&quot;,
&quot;python_full_version == '3.12.*' and sys_platform == 'linux'&quot;,
&quot;python_full_version &lt; '3.12' and sys_platform == 'linux'&quot;,
]
dependencies = [
{ name = &quot;filelock&quot;, marker = &quot;sys_platform == 'linux'&quot; },
{ name = &quot;fsspec&quot;, marker = &quot;sys_platform == 'linux'&quot; },
{ name = &quot;jinja2&quot;, marker = &quot;sys_platform == 'linux'&quot; },
{ name = &quot;networkx&quot;, marker = &quot;sys_platform == 'linux'&quot; },
{ name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12' and sys_platform == 'linux'&quot; },
{ name = &quot;sympy&quot;, marker = &quot;sys_platform == 'linux'&quot; },
{ name = &quot;typing-extensions&quot;, marker = &quot;sys_platform == 'linux'&quot; },
]</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-10 00:59</div>
            <div class="timeline-body"><p>Here is the full uv lock verbose log:</p>
<p><a href="https://github.com/user-attachments/files/24066234/uv.log">uv.log</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-10 01:02</div>
            <div class="timeline-body"><p>I don't fully understand what the problem is here, but note that <code>sys_platform == 'windows'</code> is incorrect -- you're looking for <code>sys_platform == 'win32'</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-10 01:03</div>
            <div class="timeline-body"><p>hi @charliermarsh  thanks for your swift response.
repro steps are as below:
Our repo: https://github.com/pytorch/TensorRT
switch to  branch: lluo/add_uv_sync_job
install bazel:
uv lock
uv sync --frozen</p>
<p>https://github.com/pytorch/TensorRT/blob/8bc31c83bb5ea8bcdb4737134ad1ceaf8826a6a0/.github/workflows/uv-update.yml</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-10 01:04</div>
            <div class="timeline-body"><p>Thank you, I will take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-10 01:07</div>
            <div class="timeline-body"><p>I have changed from
sys_platform == 'windows'
to
sys_platform == 'win32'
same wrong version</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-10 03:13</div>
            <div class="timeline-body"><p>Unfortunately I can't build that project as I'm on macOS.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-11 22:27</div>
            <div class="timeline-body"><p>Hi @charliermarsh
Since you cannot repro on your mac, can you please look at the result I am getting from the uv lock or uv sync:
Is it a bug on either
Reads/sorts platform-specific nightly wheels from that index,
or
Emits resolution-markers in the lock for multi-platform packages.</p>
<p>uv.lock file generate the torch nightly records for linux :
2.10.0.dev20251211+cu130
but this version does not even exist in https://download.pytorch.org/whl/nightly/cu130
(you can see there is only windows wheel for torch on this day)</p>
<pre><code>[[package]]
name = &quot;torch&quot;
version = &quot;2.10.0.dev20251211+cu130&quot;
source = { registry = &quot;https://download.pytorch.org/whl/nightly/cu130&quot; }
resolution-markers = [
    &quot;python_full_version &gt;= '3.13' and sys_platform == 'linux'&quot;,
    &quot;python_full_version == '3.12.*' and sys_platform == 'linux'&quot;,
    &quot;python_full_version == '3.11.*' and sys_platform == 'linux'&quot;,
    &quot;python_full_version &lt; '3.11' and sys_platform == 'linux'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot;, marker = &quot;sys_platform == 'linux'&quot; },
    { name = &quot;fsspec&quot;, marker = &quot;sys_platform == 'linux'&quot; },
    { name = &quot;jinja2&quot;, marker = &quot;sys_platform == 'linux'&quot; },
    { name = &quot;networkx&quot;, version = &quot;3.4.2&quot;, source = { registry = &quot;https://download.pytorch.org/whl/nightly/cu130&quot; }, marker = &quot;python_full_version &lt; '3.11' and sys_platform == 'linux'&quot; },
    { name = &quot;networkx&quot;, version = &quot;3.6.1&quot;, source = { registry = &quot;https://download.pytorch.org/whl/nightly/cu130&quot; }, marker = &quot;python_full_version &gt;= '3.11' and sys_platform == 'linux'&quot; },
    { name = &quot;setuptools&quot;, marker = &quot;python_full_version &gt;= '3.12' and sys_platform == 'linux'&quot; },
    { name = &quot;sympy&quot;, marker = &quot;sys_platform == 'linux'&quot; },
    { name = &quot;typing-extensions&quot;, marker = &quot;sys_platform == 'linux'&quot; },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-11 22:28</div>
            <div class="timeline-body"><p>it is become a major issue, since nightly windows, linux wheel are not always there for all the platforms.
This is keeping giving me the wrong non-exist index for torch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-11 22:30</div>
            <div class="timeline-body"><p>it is working only if it has the torch wheels for all the platform on that nightly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lanluo-nvidia">@lanluo-nvidia</a> on 2025-12-11 23:28</div>
            <div class="timeline-body"><p>I am able to make it work by:</p>
<ol>
<li>adding required-environments:
environments = [&quot;sys_platform == 'linux'&quot;, &quot;sys_platform == 'win32'&quot;]</li>
</ol>
<pre><code>required-environments = [
    &quot;sys_platform == 'linux' and python_version &gt;= '3.10' and python_version &lt;= '3.13' and platform_machine == 'x86_64'&quot;,
    &quot;sys_platform == 'win32' and python_version &gt;= '3.10' and python_version &lt;= '3.13' and platform_machine == 'AMD64'&quot;
]
</code></pre>
<ol start="2">
<li>use <code>uv lock --refresh --prerelease=allow</code> instead of <code>uv lock</code></li>
</ol>
<p>@charliermarsh  I Would like to hear from you is this the correct way to do it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-12 23:26</div>
            <div class="timeline-body"><p>Using a windows-only version for a linux environments is indeed bad, it looks like the same problem as https://github.com/astral-sh/uv/issues/17067, which has a minimal example.</p>
<p>I couldn't verify with the actual repo cause my build got stuck at &quot;Loading: 0 packages loaded&quot;, but adding this should work:</p>
<pre><code class="language-toml"># We must have wheel for both of those platforms
required-environments = [&quot;sys_platform == 'linux'&quot;, &quot;sys_platform == 'windows'&quot;]
# Ignore other platforms
environments = [&quot;sys_platform == 'linux'&quot;, &quot;sys_platform == 'windows'&quot;]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:39 UTC
    </footer>
</body>
</html>
