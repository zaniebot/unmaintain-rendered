```yaml
number: 13091
title: When adding optional dependency for a non-existing group, a new emtpy dependency group should be created
type: issue
state: closed
author: alelom
labels:
  - enhancement
assignees: []
created_at: 2025-04-24T14:46:18Z
updated_at: 2025-05-13T03:08:14Z
url: https://github.com/astral-sh/uv/issues/13091
synced_at: 2026-01-10T01:57:29Z
```

# When adding optional dependency for a non-existing group, a new emtpy dependency group should be created

---

_Issue opened by @alelom on 2025-04-24 14:46_

### Summary

Running `uv add --optional groupname xyz` should add an empty dependency group `groupname` for the optional dependency if it doesn't exist. Otherwise, the resulting `toml` file only contains the section 


```
[project.optional-dependencies]
groupname = [
    "xyz>=2.5.1",
]
```

which then subsequently will make calls to `uv sync --no-group groupname` return the error `error: Group groupname is not defined in the project's dependency-groups table`, which would be hard to understand for newbies, and also it's a missed opportunity for a simple automation.

I understand this is an edge case, but I think that doing `uv add --optional groupname xyz` when `groupname` doesn't exist in the dependency group, should either:

- return an error stating that `groupname` doesn't exist (like what you get if you subsequently run `uv sync`) , **or**,
- add an empty `groupname` group in the dependency groups by itself, then add the optional dependency in the optional dependencies part.


### Example

Example: freshly new `toml` file.
```
[project]
name = "somename"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.08"
dependencies = [
]
```

Running ` uv add --optional dev-torch torch` adds this to the toml file:

```
[project.optional-dependencies]
dev-torch = [
    "torch>=2.5.1",
]
```

However, the dependency group `dev-torch` isn't created. So when running `uv sync --no-group dev-torch` you get:
```bash
error: Group `dev-torch` is not defined in the project's `dependency-groups` table
```

This is easily resolvable by adding an empty group manually:

```
[project]
name = "ml-cad-assistant"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.08"
dependencies = [
    "sysappend>=1.6.2",
    "rich",
    "pymupdf",
    "pycocotools"
]

[dependency-groups]
dev-torch = [
]

[project.optional-dependencies]
dev-torch = [
    "torch>=2.5.1",
]
```

But I argue that it should be done automatically on the first invocation of  `uv add --optional dev-torch torch` if the name `dev-torch` doesn't exist between the dependency groups already.


---

_Label `enhancement` added by @alelom on 2025-04-24 14:46_

---

_Renamed from "When adding optional dependency on a new group that wasn't set before, an empty dependency group should be created" to "When adding optional dependency for a non-existing group, a new emtpy dependency group should be created" by @alelom on 2025-04-24 15:18_

---

_Comment by @charliermarsh on 2025-04-24 16:16_

I think you might be conflating dependency groups with optional dependencies? They're not the same thing. `--no-group dev-torch` should _not_ work if you have `dev-torch` under `project.optional-dependencies` -- that's not a dependency group. It would be super confusing to have an optional dependency and a dependency group with the same name.

---

_Comment by @alelom on 2025-05-09 11:02_

@charliermarsh My understanding was that optional dependencies **can be** _optional under an existing dependency group_. 

When you add an optional dependency, you can add it as optional for the entire project or for a dependency group. Which is why `uv add --optional groupname xyz` is allowed: the `xyz` is an optional dependency for dependency group called `groupname`. 

I understand this is an edge case, but I think that doing `uv add --optional groupname xyz` when `groupname` doesn't exist in the dependency group, should either:
- return an error stating that `groupname` doesn't exist, or,
- add an empty `groupname` in the dependency groups by itself, then add the optional dependency in the optional dependencies part.

---

_Comment by @charliermarsh on 2025-05-13 03:08_

That's not quite right. `uv add --optional groupname xyz` adds `xyz` to the `groupname` section in `project.optional-dependencies`. This is _not_ the same as a "dependency group" named `groupname`. That would be `uv add --group groupname xyz`.  `uv add --optional groupname xyz ` has nothing to do with `[dependency-groups.groupname]`. These are two distinct concepts that are defined in Python standards -- they're not defined by uv.

---

_Closed by @charliermarsh on 2025-05-13 03:08_

---
