<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal resolution can generate un-installable requirements with environments - astral-sh/uv #6836</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Universal resolution can generate un-installable requirements with environments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6836">#6836</a>
        opened by <a href="https://github.com/alex">@alex</a>
        on 2024-08-29 22:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alex">@alex</a></div>
            <div class="timeline-body"><pre><code>(tempenv-564a2572618) ~/.v/tempenv-564a2572618 ❯❯❯ uv version
uv 0.4.0 (Homebrew 2024-08-28)
(tempenv-564a2572618) ~/.v/tempenv-564a2572618 ❯❯❯ cat uv.toml
environments = [&quot;python_version &gt;= '3.10'&quot;, &quot;python_version &gt;= '3.8' and python_version &lt; '3.10'&quot;, &quot;python_version &lt; '3.8'&quot;]

(tempenv-564a2572618) ~/.v/tempenv-564a2572618 ❯❯❯ echo 'build' | uv pip compile - --universal -p 3.7
warning: The requested Python version 3.7 is not available; 3.12.5 will be used to build dependencies instead.
Resolved 12 packages in 5ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - --universal -p 3.7
build==1.1.1 ; python_full_version &lt; '3.8'
build==1.2.1 ; python_full_version &gt;= '3.8'
colorama==0.4.6 ; os_name == 'nt'
    # via build
importlib-metadata==6.7.0 ; python_full_version &lt; '3.8'
    # via build
importlib-metadata==8.4.0 ; python_full_version &lt; '3.10.2'
    # via build
packaging==24.0 ; python_full_version &lt; '3.8'
    # via build
packaging==24.1 ; python_full_version &gt;= '3.8'
    # via build
pyproject-hooks==1.1.0
    # via build
tomli==2.0.1 ; python_full_version &lt; '3.11'
    # via build
typing-extensions==4.7.1 ; python_full_version &lt; '3.8'
    # via importlib-metadata
zipp==3.15.0 ; python_full_version &lt; '3.8'
    # via importlib-metadata
zipp==3.20.1 ; python_full_version &lt; '3.10.2'
    # via importlib-metadata
</code></pre>
<p>The resolutions for <code>importlib-metadata</code> are not usable on Python 3.7, because both of the following match the markers:</p>
<pre><code>importlib-metadata==6.7.0 ; python_full_version &lt; '3.8'
    # via build
importlib-metadata==8.4.0 ; python_full_version &lt; '3.10.2'
    # via build
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-29 22:34</div>
            <div class="timeline-body"><p>@BurntSushi - Can you check if this is fixed on your branch?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2024-08-29 22:36</div>
            <div class="timeline-body"><p>I feel like I should apologize for constantly dragging weird universal resolution issues in, like a cat dragging in mice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-29 22:37</div>
            <div class="timeline-body"><p>Haha no, it’s good!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-08-29 23:49</div>
            <div class="timeline-body"><p>On main, I get this:</p>
<pre><code>$ echo 'build' | run-uv main -- pip compile - --universal -p 3.7
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.12s
warning: uv is only compatible with Python &gt;=3.8, found Python 3.7.9
Resolved 12 packages in 96ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - --universal -p 3.7
build==1.1.1 ; python_full_version &lt; '3.10'
build==1.2.1 ; python_full_version &gt;= '3.10'
colorama==0.4.6 ; os_name == 'nt'
    # via build
importlib-metadata==6.7.0 ; python_full_version &lt; '3.10'
    # via build
importlib-metadata==8.4.0 ; python_full_version &lt; '3.10.2'
    # via build
packaging==24.0 ; python_full_version &lt; '3.10'
    # via build
packaging==24.1 ; python_full_version &gt;= '3.10'
    # via build
pyproject-hooks==1.1.0
    # via build
tomli==2.0.1 ; python_full_version &lt; '3.11'
    # via build
typing-extensions==4.7.1 ; python_full_version &lt; '3.8'
    # via importlib-metadata
zipp==3.15.0 ; python_full_version &lt; '3.10'
    # via importlib-metadata
zipp==3.20.1 ; python_full_version &lt; '3.10.2'
    # via importlib-metadata
</code></pre>
<p>Notice that the markers here are different from yours @alex, but they are still overlapping and thus incorrect.</p>
<p>On my branch, I get:</p>
<pre><code>$ echo 'build' | run-uv pr1 -- pip compile - --universal -p 3.7
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.12s
warning: uv is only compatible with Python &gt;=3.8, found Python 3.7.9
Resolved 12 packages in 38ms
# This file was autogenerated by uv via the following command:
#    uv pip compile - --universal -p 3.7
build==1.1.1 ; python_full_version &lt; '3.10'
build==1.2.1 ; python_full_version &gt;= '3.10'
colorama==0.4.6 ; os_name == 'nt'
    # via build
importlib-metadata==6.7.0 ; python_full_version &lt; '3.10'
    # via build
importlib-metadata==8.4.0 ; python_full_version &gt;= '3.10' and python_full_version &lt; '3.10.2'
    # via build
packaging==24.0 ; python_full_version &lt; '3.10'
    # via build
packaging==24.1 ; python_full_version &gt;= '3.10'
    # via build
pyproject-hooks==1.1.0
    # via build
tomli==2.0.1 ; python_full_version &lt; '3.11'
    # via build
typing-extensions==4.7.1 ; python_full_version &lt; '3.8'
    # via importlib-metadata
zipp==3.15.0 ; python_full_version &lt; '3.10'
    # via importlib-metadata
zipp==3.20.1 ; python_full_version &gt;= '3.10' and python_full_version &lt; '3.10.2'
    # via importlib-metadata
</code></pre>
<p>The markers are not overlapping but quite constraining. I haven't dug in to see whether that's correct or not, but these requirements are at least valid.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-08-29 23:50</div>
            <div class="timeline-body"><p>I also get a different warning:</p>
<pre><code>warning: uv is only compatible with Python &gt;=3.8, found Python 3.7.9
</code></pre>
<p>Where as @alex's output has:</p>
<pre><code>warning: The requested Python version 3.7 is not available; 3.12.5 will be used to build dependencies instead.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2024-08-30 11:24</div>
            <div class="timeline-body"><p>I spot checked those markers against the <code>build</code> source, and they look right.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-08-30 11:55</div>
            <div class="timeline-body"><p>All righty, that means this should be fixed by: https://github.com/astral-sh/uv/pull/6268</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @BurntSushi on 2024-08-30 11:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2024-08-30 11:57</div>
            <div class="timeline-body"><p>Great, thanks.</p>
<p>On Fri, Aug 30, 2024 at 7:55 AM Andrew Gallant <em><strong>@</strong></em>.***&gt; wrote:</p>
<blockquote>
<p>All righty, that means this should be fixed by: #6268</p>
<p>—
Reply to this email directly, view it on GitHub, or unsubscribe.
You are receiving this because you were mentioned.Message ID: <em><strong>@</strong></em>.***&gt;</p>
</blockquote>
<p>--
All that is necessary for evil to succeed is for good people to do nothing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-09-03 22:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-09-03 22:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:41 UTC
    </footer>
</body>
</html>
