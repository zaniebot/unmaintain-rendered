<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--system doesn't work on Windows on Python &lt;3.12 in GitHub Actions - astral-sh/uv #2056</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--system doesn't work on Windows on Python &lt;3.12 in GitHub Actions</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2056">#2056</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-02-28 21:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-28 21:59</div>
            <div class="timeline-body"><p>See https://github.com/AlexWaygood/typeshed-stats/pull/200 for a repro. It's possible this is a just-in-GitHub Actions thing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-02-28 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @AlexWaygood on 2024-02-28 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-28 22:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2057.html">astral-sh/uv#2057</a> on 2024-02-28 22:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-28 22:03</div>
            <div class="timeline-body"><p>It appears to work fine on Python 3.12, but on Python 3.11/3.10 in CI, running <code>coverage -m pytest</code> leads to this error message (despite <code>coverage</code> and <code>pytest</code> having both been installed by uv using <code>--system</code>):</p>
<pre><code>coverage: D:\a\_temp\2100b3f7-7035-42ca-a241-f5034d096de8.ps1:2
Line |
   2 |  coverage run -m pytest --doctest-modules
     |  ~~~~~~~~
     | The term 'coverage' is not recognized as a name of a cmdlet, function, script file, or executable program. Check
     | the spelling of the name, or if a path was included, verify that the path is correct and try again.
Error: Process completed with exit code 1.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-28 22:07</div>
            <div class="timeline-body"><p>I've confirmed that this works as expected locally. If I install Python 3.10 from python.org, I can globally install binaries like <code>isort</code>, and they get picked up in my PATH.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "--system doesn't work on Windows on Python <3.12" to "--system doesn't work on Windows on Python <3.12 in GitHub Actions" by @AlexWaygood on 2024-02-28 22:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ispg-group/harmonwig/pulls/3.html">ispg-group/harmonwig#3</a> on 2024-02-28 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1526.html">astral-sh/uv#1526</a> on 2024-02-28 23:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 00:15</div>
            <div class="timeline-body"><p>It looks like the problem is that <code>--system</code> is installing into Python 3.12 (which is already installed in the image, I assume?) rather than the version installed via the setup action.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 00:37</div>
            <div class="timeline-body"><p>The problem is that we first look in <code>py --list-paths</code>, and that returns:</p>
<pre><code class="language-text">-V:3.12 *        C:\hostedtoolcache\windows\Python\3.12.2\x64\python.exe
-V:3.12-32       C:\hostedtoolcache\windows\Python\3.12.2\x86\python.exe
-V:3.11          C:\hostedtoolcache\windows\Python\3.11.8\x64\python.exe
-V:3.11-32       C:\hostedtoolcache\windows\Python\3.11.8\x86\python.exe
-V:3.10          C:\hostedtoolcache\windows\Python\3.10.11\x64\python.exe
-V:3.10-32       C:\hostedtoolcache\windows\Python\3.10.11\x86\python.exe
-V:3.9           C:\hostedtoolcache\windows\Python\3.9.13\x64\python.exe
-V:3.9-32        C:\hostedtoolcache\windows\Python\3.9.13\x86\python.exe
-V:3.8           C:\hostedtoolcache\windows\Python\3.8.10\x64\python.exe
-V:3.8-32        C:\hostedtoolcache\windows\Python\3.8.10\x86\python.exe
-V:3.7           C:\hostedtoolcache\windows\Python\3.7.9\x64\python.exe
-V:3.7-32        C:\hostedtoolcache\windows\Python\3.7.9\x86\python.exe
</code></pre>
<p>So that ends up returning the Python 3.12.2 interpreter that comes pre-bundled in the cache.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 00:37</div>
            <div class="timeline-body"><p>I'm not sure how to fix this. Should we be looking in <code>PATH</code> first? \cc @konstin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2024-02-29 01:35</div>
            <div class="timeline-body"><p>Yes, please look in PATH first as in the majority of scenarios the <code>py</code> launcher will not be used or even available (as I was trying to express in the other issue).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 01:36</div>
            <div class="timeline-body"><p>There's a PR open for it here: https://github.com/astral-sh/uv/pull/2057.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 01:36</div>
            <div class="timeline-body"><p>Do you have a link to the other issue? I'd like to read (but was focused on other things at the time).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2024-02-29 01:44</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/issues/1310#issuecomment-1951464381</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 02:09</div>
            <div class="timeline-body"><p>I know you mention this in your comment but I'm surprised because virtualenv does seem to do registry-based lookups before PATH.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2024-02-29 02:30</div>
            <div class="timeline-body"><p>Nothing will be added to one's registry without an installer that does that. So for example if you build from source or use a prebuilt distribution and merely unpack then you have to just rely on PATH.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-29 08:32</div>
            <div class="timeline-body"><p>When installing the defaults from the official build from python.org build, you get the py launcher but no <code>PATH</code> modification. This means that the great majority of users - especially those who don't have expertise around <code>PATH</code> - will have no <code>python.exe</code> in <code>PATH</code></p>
<p><img src="https://github.com/astral-sh/uv/assets/6826232/ba1b8f6d-8b77-438a-b518-573af581eb12" alt="Python 3.12 installer" /></p>
<p>Above is the preset configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../CederGroupHub/chgnet/pulls/133.html">CederGroupHub/chgnet#133</a> on 2024-02-29 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2024-02-29 14:01</div>
            <div class="timeline-body"><p>Yes, that is true. However almost everyone enables that checkbox to add to PATH because you only install with that GUI if you're an average user and the vast majority of folks have no idea about the registry PEP (why would they) so in order to make it usable you check the box not even so much for external tools but so you have a <code>python</code> available on the command line. So, that group will always have PATH updated.</p>
<p>The other, far far larger group, will install Python on servers. In this case they will disable the <code>py</code> launcher because it's irrelevant or not even have it because they are building from source to get optimizations, either themselves or fetching some prebuilt distribution to unpack.</p>
<p>I have been exclusively a Windows user my entire life. I cannot express enough how few people use the <code>py</code> launcher and how often the registry stuff is unused.</p>
<p>In the official documentation, their example updates PATH https://docs.python.org/3/using/windows.html#installing-without-ui:</p>
<pre><code>python-3.9.0.exe /quiet InstallAllUsers=1 PrependPath=1 Include_test=0
</code></pre>
<p>You will be hard-pressed to find code on GitHub (and in private) that does not rely on PATH. Some examples:</p>
<ul>
<li>Here is the official Python Docker image adding to PATH https://github.com/docker-library/python/blob/5906158d277460e04837c45f5b22051bbf28af92/3.12/windows/windowsservercore-ltsc2022/Dockerfile#L28</li>
<li>Here is TensorFlow's build infra adding to PATH https://github.com/tensorflow/tensorflow/blob/6ce973f15f0d02331b74efdb59b4cf3526e3db4a/ci/devinfra/docker_windows/Dockerfile#L80</li>
<li>Here is Microsoft's build image for their standard library adding to PATH https://github.com/microsoft/STL/blob/517b7830c235ce2844081594abddc7c684a1ec32/azure-devops/provision-image.ps1#L231 (they also do that in all of their other repos)</li>
<li>Here is Nvidia's Triton Inference Server image adding to PATH https://github.com/triton-inference-server/server/blob/5630efe6e0d8b74b72a793678722f89112240f76/Dockerfile.win10.min#L64</li>
<li>Here is Google's type checker CI adding to PATH https://github.com/google/pytype/blob/5201c541c7611f70b0c83c63aea09c1ce4d8078e/.github/workflows/ci-windows.yml#L34</li>
<li>Here is the GRPC build image adding to PATH https://github.com/grpc/grpc/blob/e39bd5071671d099c587580bddafb117601a4e30/tools/internal_ci/helper_scripts/install_python_interpreters.ps1#L42</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-29 14:07</div>
            <div class="timeline-body"><p>Yeah, having been exclusively a Windows user until very recently, I agree with basically everything @ofek is saying here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-29 15:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../zenml-io/zenml/pulls/2442.html">zenml-io/zenml#2442</a> on 2024-03-01 17:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:57 UTC
    </footer>
</body>
</html>
