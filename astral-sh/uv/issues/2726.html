<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv incorrectly determines local package availability as part of `install_requires` - astral-sh/uv #2726</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv incorrectly determines local package availability as part of `install_requires`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2726">#2726</a>
        opened by <a href="https://github.com/ikalchev">@ikalchev</a>
        on 2024-03-29 09:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ikalchev">@ikalchev</a> on 2024-03-29 09:01</div>
            <div class="timeline-body"><p>First of all - wow this thing is fast! I recently moved a project's <em>six</em> of the linters/formatters to ruff and now uv is equally impressive. Cheers folks, splendid work!</p>
<p>I think there is an issue when you attempt to install two packages from a local folder that depend on each other.</p>
<p>Steps to reproduce below. We have two packages - <code>aaa</code> and <code>bbb</code>. <code>bbb</code> depends on <code>aaa</code> on some version. Both <code>aaa</code> and <code>bbb</code> share a package namespace <code>foo</code>. The packages themselves are empty.</p>
<p>Package <code>aaa</code>:</p>
<pre><code>$ tree aaa
aaa
├── foo
│   ├── __init__.py
│   └── aaa
│       └── __init__.py

$ cat aaa/setup.py
from setuptools import setup, find_packages

version = &quot;1.2.3&quot;

setup(
    name=&quot;foo-aaa&quot;,
    namespace_packages=[&quot;foo&quot;],
    extras_require={},
    version=version,
    packages=find_packages(),
    description=&quot;aaa&quot;,
)

$ cat aaa/foo/__init__.py
__import__(&quot;pkg_resources&quot;).declare_namespace(__name__)
</code></pre>
<p>Package <code>bbb</code>:</p>
<pre><code>$ tree bbb
bbb
├── foo
│   ├── __init__.py
│   └── bbb
│       └── __init__.py

$ cat bbb/setup.py
from setuptools import setup, find_packages

version = &quot;3.2.1&quot;

setup(
    name=&quot;foo-bbb&quot;,
    namespace_packages=[&quot;foo&quot;],
    version=version,
    install_requires=[&quot;foo-aaa~=1.2.3&quot;],
    extras_require={},
    packages=find_packages(),
    description=&quot;bbb&quot;,
)

$ cat bbb/foo/__init__.py
__import__(&quot;pkg_resources&quot;).declare_namespace(__name__)
</code></pre>
<p>Installing aaa:</p>
<pre><code>$ uv pip install -e &quot;./aaa&quot;
   Built file:///Users/ikalchev/dev/test/aaa                                                                                                          Built 1 editable in 352ms
Resolved 1 package in 0.23ms
Installed 1 package in 0.74ms
 + foo-aaa==1.2.3 (from file:///Users/ikalchev/dev/test/aaa)
</code></pre>
<p>Installing bbb (fails):</p>
<pre><code>$ uv pip install -e &quot;./bbb&quot;  
   Built file:///Users/ikalchev/dev/test/bbb                                                                                                          Built 1 editable in 262ms
  × No solution found when resolving dependencies:
  ╰─▶ Because foo-aaa&gt;=1.2.3, &lt;1.3.dev0 was not found in the package registry and foo-bbb==3.2.1 depends on foo-aaa&gt;=1.2.3,&lt;1.3.dev0, we can
      conclude that foo-bbb==3.2.1 cannot be used.
      And because you require foo-bbb==3.2.1, we can conclude that the requirements are unsatisfiable.

      hint: foo-aaa was requested with a pre-release marker (e.g., foo-aaa&gt;=1.2.3,&lt;1.3.dev0), but pre-releases weren't enabled (try:
      `--prerelease=allow`)
</code></pre>
<p>Oddly enough, when I change the <code>install_requires=[&quot;foo-aaa~=1.2&quot;]</code> (just remove the maintenance version part), it fails again but have a look at the &quot;found&quot; version for <code>foo-aaa</code>:</p>
<pre><code>$ uv pip install -e &quot;./bbb&quot;
   Built file:///Users/ikalchev/dev/test/bbb                                                                                                          Built 1 editable in 368ms
  × No solution found when resolving dependencies:
  ╰─▶ Because foo-aaa&gt;=1.2, &lt;2.dev0 was not found in the package registry and foo-bbb==3.2.1 depends on foo-aaa&gt;=1.2,&lt;2.dev0, we can conclude that
      foo-bbb==3.2.1 cannot be used.
      And because you require foo-bbb==3.2.1, we can conclude that the requirements are unsatisfiable.

      hint: foo-aaa was requested with a pre-release marker (e.g., foo-aaa&gt;=1.2,&lt;2.dev0), but pre-releases weren't enabled (try:
      `--prerelease=allow`)
</code></pre>
<p>Note that if I try to install bbb after that with pip, it succeeds:</p>
<pre><code>$ pip install -e &quot;./bbb&quot;
Obtaining file:///Users/ikalchev/dev/test/bbb
  Installing build dependencies ... done
  Checking if build backend supports build_editable ... done
  Getting requirements to build editable ... done
  Preparing editable metadata (pyproject.toml) ... done
Requirement already satisfied: foo-aaa~=1.2.3 in ./venv_test/lib/python3.10/site-packages (from foo-bbb==3.2.1) (1.2.3)
Building wheels for collected packages: foo-bbb
  Building editable for foo-bbb (pyproject.toml) ... done
  Created wheel for foo-bbb: filename=foo_bbb-3.2.1-0.editable-py3-none-any.whl size=3085 sha256=bc90e3fc0255e0e3e1321b87f3a0c6dc32339a6ef0a1b83e592f39febd6c1dd3
  Stored in directory: /private/var/folders/8p/znpv_6555dnc6tqwv_bvkdb80000gn/T/pip-ephem-wheel-cache-h0lzvry0/wheels/83/66/26/26bae4c6dee3068d97be61cb5b3594a7140a46d287d2f915f0
Successfully built foo-bbb
Installing collected packages: foo-bbb
Successfully installed foo-bbb-3.2.1
</code></pre>
<p>Env:</p>
<ul>
<li>macOS 14.4 (23E214)</li>
<li>python 3.10</li>
<li>uv 0.1.26 (7b685a815 2024-03-28)</li>
</ul>
<p>Let me know if I can be of further help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aliencaocao">@aliencaocao</a> on 2024-03-29 13:33</div>
            <div class="timeline-body"><p>Same issue here, can observe with &gt;= requirements too.
Example is installing <code>bitsandbytes</code> when a <code>torch</code> already exists locally. <code>pip</code> would succeed in this case while <code>uv</code> will go and reinstall torch again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-29 13:36</div>
            <div class="timeline-body"><p>This looks like a duplicate of https://github.com/astral-sh/uv/issues/1661 which was resolved in #2596 and will be in the next release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-03-29 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-29 18:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
