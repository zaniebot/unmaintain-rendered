```yaml
number: 13452
title: "Uv can't build if I do have a private repo declared"
type: issue
state: closed
author: gervaila
labels:
  - question
assignees: []
created_at: 2025-05-14T14:30:40Z
updated_at: 2025-06-05T17:52:15Z
url: https://github.com/astral-sh/uv/issues/13452
synced_at: 2026-01-10T01:57:30Z
```

# Uv can't build if I do have a private repo declared

---

_Issue opened by @gervaila on 2025-05-14 14:30_

### Summary

I do have a problem with this feature our CI was working before and now it's broken.
I publish my built package to a private repository but I don't need it for building.
When I try to build, uv tries to look for hatchling inside my private repository and can't find it because it's not authenticated.
Here's my pyproject.toml
```
[project]
name = "x"
version = "1.5.0"

requires-python = ">=3.13"
dependencies = [
    "httpx>=0.28.1",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[[tool.uv.index]]
name = "gcp"
url = "https://europe-west1-python.pkg.dev/xx/xx/simple/"
publish-url = "https://europe-west1-python.pkg.dev/xx/xx/"
```
And here's the error I get :
```
 Building source distribution...
  × Failed to build
  │ `/home/runner/work/xx/xx`
  ├─▶ Failed to resolve requirements from `build-system.requires`
  ├─▶ No solution found when resolving: `hatchling`
  ╰─▶ Because hatchling was not found in the package registry and you require
      hatchling, we can conclude that your requirements are unsatisfiable.
      hint: An index URL
      (https://europe-west1-python.pkg.dev/xx/xx/simple/)
      could not be queried due to a lack of valid authentication credentials
      (401 Unauthorized).
```
I don't really want to authenticate during the build step and I don't think it's usefull, how can I change my pyproject.toml to make it work ?

### Platform

github runner

### Version

uv 0.7.3

### Python version

python 3.13

---

_Label `bug` added by @gervaila on 2025-05-14 14:30_

---

_Comment by @gervaila on 2025-05-14 14:31_

here's probably the root cause of my problem : [12805](https://github.com/astral-sh/uv/pull/12805)

---

_Assigned to @jtfmumm by @konstin on 2025-05-14 14:57_

---

_Comment by @jtfmumm on 2025-05-14 15:29_

One approach you could take here is to pass `--index https://pypi.org/simple/` to `uv build` in order to give PyPI priority over your private index. Then it should find `hatchling` there before needing to search your index.

---

_Label `bug` removed by @jtfmumm on 2025-05-14 15:30_

---

_Label `question` added by @jtfmumm on 2025-05-14 15:30_

---

_Comment by @charliermarsh on 2025-05-15 02:34_

This is intentional: uv _should_ fail if it can't connect to your registry; otherwise, we'd silently fall-through in cases where you actually _want_ to get packages from the registry, and you'd end up installing packages from PyPI that you _thought_ were coming from your registry.

If you want to fall back regardless (i.e., restore the prior behavior and accept the risks):

```toml
[[tool.uv.index]]
name = "gcp"
url = "https://europe-west1-python.pkg.dev/xx/xx/simple/"
publish-url = "https://europe-west1-python.pkg.dev/xx/xx/"
ignore-error-codes = [401, 403]
```

Alternatively, you can pass `--index https://pypi.org/simple/` to `uv build` as @jtfmumm mentioned, and we'll check PyPI first.


---

_Closed by @charliermarsh on 2025-05-15 02:34_

---

_Comment by @gervaila on 2025-05-15 07:09_

Great ! it works, thanks !
I would love to see a feature where there's a distinction between an index you intend to publish to and one where you want to get package from, but that's another topic.
Thank you for your help !

---

_Comment by @jtfmumm on 2025-05-15 07:13_

[You can configure a distinct URL for publishing](https://docs.astral.sh/uv/guides/package/#publishing-your-package). Is that what you mean?

---

_Comment by @gervaila on 2025-05-15 08:55_

Yes, that's exactly what I was looking for ! thanks again

---

_Comment by @ketozhang on 2025-06-05 17:51_

Added #13856 issue, but focus more on this feature further complicates local development of packages.

---
