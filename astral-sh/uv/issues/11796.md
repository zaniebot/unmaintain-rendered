```yaml
number: 11796
title: "Failed to spawn error with `uv run python3.12`"
type: issue
state: open
author: gmsya
labels:
  - good first issue
  - error messages
assignees: []
created_at: 2025-02-26T11:30:37Z
updated_at: 2025-03-16T12:23:29Z
url: https://github.com/astral-sh/uv/issues/11796
synced_at: 2026-01-10T01:57:27Z
```

# Failed to spawn error with `uv run python3.12`

---

_Issue opened by @gmsya on 2025-02-26 11:30_

### Summary

![Image](https://github.com/user-attachments/assets/9b651347-d76f-4fdf-86b1-e23ada66d4aa)

### Platform

mac

### Version

uv 0.6.3 (a0b9f22a2 2025-02-24)

### Python version

_No response_

---

_Label `bug` added by @gmsya on 2025-02-26 11:30_

---

_Comment by @nkitsaini on 2025-02-26 14:12_

This is the intended behavior.

You are probably looking for `uv run --python 3.12 python3` or `uvx python@3.12`. Both of these will work.

By default `uv run <cmd>`, will run the `<cmd>` as your shell would but by including libraries and binaries from virtual environment if present.

Since you already have `python3.13` installed (outside of uv) it runs successfully.


Maybe we should include `uv run --python 3.12 ...` example in https://docs.astral.sh/uv/guides/install-python/.


---

_Comment by @zanieb on 2025-02-26 15:10_

We could probably special-case this and provide a nice error message

---

_Label `bug` removed by @zanieb on 2025-02-26 15:10_

---

_Label `error messages` added by @zanieb on 2025-02-26 15:10_

---

_Renamed from "uv run python error" to "Failed to spawn error with `uv run python3.12`" by @zanieb on 2025-02-26 15:10_

---

_Label `good first issue` added by @zanieb on 2025-02-26 15:10_

---

_Comment by @zanieb on 2025-02-26 15:11_

On a "not found" error, we can sniff for the command name (`python3.12`) and suggest the proper alternatives.

---

_Comment by @JWLee89 on 2025-03-08 08:44_

Hi @zanieb ,

If nobody is looking into this, do you mind if I try taking a look at this issue? Just getting my feet wet with `uv`. 

(thinking of starting with this, because this does not seem to be a mission-critical issue, so getting a solution for this doesn't seem super high-priority). 

Managed to reproduce with the following command: 

```bash
MacBookPro uv % cargo run -- run python3.9 
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.76s
     Running `target/debug/uv run python3.9`
error: Failed to spawn: `python3.9`
  Caused by: No such file or directory (os error 2)
MacBookPro uv % 
```

Would the desired result would be something like the following? 


My guess is that this occurs in cases where people want to run a specific python version with uv, but is not available in their current environment.

```bash
# If command starts with string `python` 
error: Failed to spawn: `python3.9`
  Caused by:  Command `python3.9` not found. Check the list of available python versions with `uv python list`.
# For other not found commands
error: Failed to spawn: `some_command`
  Caused by:  Command `some_command` not found.
```

Does this sound okay? If so, I can create a PR for this update.

---

_Comment by @zanieb on 2025-03-08 15:01_

Yeah you could take a swing at it!

I don't think we can just do `startswith`, that could match something like `python-foo`; it'd have to be `python<version>` specifically.

I think we'd want to say something like..

> `python3.12` is not available in the current environment which uses Python 3.11. Did you mean `uv run -p 3.12 python` or `uvx python@3.12`?

We may need to add more context based on whether or not `run` is happening in a project or not (I think the split is [here](https://github.com/astral-sh/uv/blob/40dce4e00959abc9b598df9e565c0d35dfa5f4c2/crates/uv/src/commands/project/run.rs#L779)). For example

> `python3.12` is not available in the project environment which uses Python 3.11. Did you mean to change the environment to Python 3.12 with `uv run -p 3.12 python`?

and

> `python3.12` is not available in the virtual environment which was created with Python 3.11. Did you mean to search for a Python 3.12 environment with `uv run -p 3.12 python`?

We could also have a note about `uvx`, like..

> or did you mean to create a temporary Python 3.12 environment with `uvx python@3.12`?

---

_Comment by @JWLee89 on 2025-03-09 06:51_

@zanieb Thank you for the clarification! üôá 
This is my first time using / working with UV so my background knowledge will be quite shallow. 

> I don't think we can just do `startswith`, that could match something like python-foo; it'd have to be python<version> specifically.

Good point. Would the following suggestion be okay? 

```rust
// Matches strings like: 
// "python3", "python3.9", "python3.10", "python4", etc.
// But NOT "python-foo", "python39", "python3abc", "python3.12b3".
// "python3.13.3" is also invalid because we cannot specify patch version when attempting to invoke python via the cli
// However, we might want to be able to specify patch version because 
// `uv python pin` also works with patch versions e.g. `uv python pin 3.8.13`
fn is_python_executable_name(name: &str) -> bool {
    // If this pattern is re-used or there is a common location for regex patterns, we can move this
    let pattern = r"^(?i)python[0-9](\.[0-9]+)?$";
    let re = Regex::new(pattern).expect("Invalid regex");
    re.is_match(name)
}
```
If we want to make this even more robust and see if we get a response from the shell, we can also incorporate the following check: 

```rust
// Check whether we get some return such as `Python 3.12.5`
let output = Command::new(candidate)
        .arg("--version")
        .output()
        .map_err(|e| anyhow!("Failed to spawn command `{}`: {}", candidate.display(), e))?;
// Todo, check whether output yields something like `Python x.x.x`
```

This + combination of the regex check is likely the most reliable method but might be overkill. For now, I will prioritize on safety first.

> python3.12 is not available in the current environment which uses Python 3.11. Did you mean uv run -p 3.12 python or uvx python@3.12?

My guess is that the python versions mentioned above are derived from: 

`python3.12` -> **from user prompt**. E.g. `cargo run -- run python3.9` will output `python3.9`

We need to check whether `python<version>` is an available python environment instead of solely relying on `startswith`, since that will not catch cases such as `python-foo` as you mentioned.

`Python 3.11` -> **from interpreter**: E.g. using `base_interpreter.python_version()` (whatever version we are pinned to currently)

My current implementation outputs the following: 

<img width="1137" alt="Image" src="https://github.com/user-attachments/assets/2bcb84b1-6816-4fca-9802-5fc75a194f8d" />

Regarding the environment, I am assuming that we will need a different message depending on the following two cases: 

1. In a project 

Generate error message using definitions above.

2. Not in a project - split defined: https://github.com/astral-sh/uv/blob/40dce4e00959abc9b598df9e565c0d35dfa5f4c2/crates/uv/src/commands/project/run.rs#L779

Generate the following message, using the python version definitions

> {user_input_python_version} is not available in the virtual environment which was created with {interpreter_python_version). Did you mean to search for a {user_input_python_version} environment with uv run -p {user_input_python_version} python?

If so, I will work on this during my spare time and submit a PR.
(it might take a while,  since I need to familiarize myself with the codebase and during the week, I need to focus on my day job).

Does this sound okay?

Thank you for your patience! üôá 

---

_Comment by @zanieb on 2025-03-11 20:10_

Sorry I have limited time to reply here so I might be a bit brief.

Regarding `is_python_executable_name` ‚Äî you should be able to use some existing code. Perhaps you can abstract something from inside https://github.com/astral-sh/uv/blob/3a53ec3c5af88a50fbb334a73880a41fd9e9b3a5/crates/uv-python/src/discovery.rs#L543 and https://github.com/astral-sh/uv/blob/2966471db2dfafa71230cdedfa7f0cd124de02b7/crates/uv-python/src/implementation.rs#L36

>  If we want to make this even more robust and see if we get a response from the shell, we can also incorporate the following check:

I don't think you need to do this.

Otherwise I think what you've written makes sense!

---

_Comment by @JWLee89 on 2025-03-13 03:49_

@zanieb Thanks for the clarification. 
I will take a stab at the PR during the weekend when I have more time. 

Is there a recommended location inside of uv to write unit tests?

The reason why I am asking is because I saw the following folder: https://github.com/astral-sh/uv/tree/main/crates/uv/tests/it, 
which I assume is supposed ton contain only integration tests here and not unit tests.

Thank you once again!

---

_Comment by @nkitsaini on 2025-03-13 04:24_

> Is there a recommended location inside of uv to write unit tests?

Most of the unit tests live in the same file as the code. Example: https://github.com/astral-sh/uv/blob/4f70d144d7ea730b20de6dbc2982b7d7a4ef59d1/crates/uv-distribution-filename/src/wheel.rs#L385-L413

---

_Comment by @JWLee89 on 2025-03-13 05:51_

@nkitsaini Ahh I see. If I don't find unit tests within a specific file, I guess I can just add the `mod tests` block and write the tests there. 

Thank you for the clarification! üëç 

---

_Referenced in [astral-sh/uv#12201](../../astral-sh/uv/pulls/12201.md) on 2025-03-16 12:12_

---

_Comment by @JWLee89 on 2025-03-16 12:23_

@zanieb @nkitsaini Hi :) 

I just created a preliminary PR here: https://github.com/astral-sh/uv/pull/12201 
from where we can start discussion / finalize specs for updates and make the appropriate modifications. 

Just wanted to give you both a heads up. 

I might not be able to follow up quickly during the week, but I will do my best to follow up during the weekend. 

Thank you for the helpful responses in this thread!

---
