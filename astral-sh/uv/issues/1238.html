<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puffin can't build ujson on windows due to pip difference - astral-sh/uv #1238</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Puffin can&#x27;t build ujson on windows due to pip difference</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1238">#1238</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-02-02 19:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>The <code>ujson</code> package includes a <code>[build-system]</code>, but no <code>build-backend</code>. It installs with pip but fails with puffin.</p>
<p>Specifically,</p>
<pre><code>pip install https://files.pythonhosted.org/packages/43/1a/b0a027144aa5c8f4ea654f4afdd634578b450807bb70b9f8bad00d6f6d3c/ujson-5.7.0.tar.gz
</code></pre>
<p>works, while</p>
<pre><code>cargo run -- pip install &quot;ujson @ https://files.pythonhosted.org/packages/43/1a/b0a027144aa5c8f4ea654f4afdd634578b450807bb70b9f8bad00d6f6d3c/ujson-5.7.0.tar.gz&quot; 
</code></pre>
<p>does not:</p>
<pre><code>Resolved 1 package in 2.21s
error: Failed to download distributions
  Caused by: Failed to fetch wheel: ujson @ https://files.pythonhosted.org/packages/43/1a/b0a027144aa5c8f4ea654f4afdd634578b450807bb70b9f8bad00d6f6d3c/ujson-5.7.0.tar.gz
  Caused by: Failed to build: ujson @ https://files.pythonhosted.org/packages/43/1a/b0a027144aa5c8f4ea654f4afdd634578b450807bb70b9f8bad00d6f6d3c/ujson-5.7.0.tar.gz
  Caused by: Build backend failed to build wheel through `build_wheel()`:
--- stdout:
running bdist_wheel
running build
running build_ext
building &#x27;ujson&#x27; extension
creating build
creating build\temp.win-amd64-cpython-312
creating build\temp.win-amd64-cpython-312\Release
creating build\temp.win-amd64-cpython-312\Release\deps
creating build\temp.win-amd64-cpython-312\Release\deps\double-conversion
creating build\temp.win-amd64-cpython-312\Release\deps\double-conversion\double-conversion
creating build\temp.win-amd64-cpython-312\Release\lib
creating build\temp.win-amd64-cpython-312\Release\python
&quot;C:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.38.33130\bin\HostX86\x64\cl.exe&quot; /c /nologo /O2 /W3 /
GL /DNDEBUG /MD -I./python -I./lib -I./deps/double-conversion/double-conversion -IC:\Users\Konstantin\AppData\Local\Temp\.tmp4B
tsR8\.venv\include -IC:\Users\Konstantin\AppData\Local\Programs\Python\Python312\include -IC:\Users\Konstantin\AppData\Local\Pr
ograms\Python\Python312\Include &quot;-IC:\Program Files\Microsoft Visual Studio\2022\Community\VC\Tools\MSVC\14.38.33130\include&quot; &quot;
-IC:\Program Files\Microsoft Visual Studio\2022\Community\VC\Auxiliary\VS\include&quot; &quot;-IC:\Program Files (x86)\Windows Kits\10\in
clude\10.0.22621.0\ucrt&quot; &quot;-IC:\Program Files (x86)\Windows Kits\10\\include\10.0.22621.0\\um&quot; &quot;-IC:\Program Files (x86)\Windows
 Kits\10\\include\10.0.22621.0\\shared&quot; &quot;-IC:\Program Files (x86)\Windows Kits\10\\include\10.0.22621.0\\winrt&quot; &quot;-IC:\Program F
iles (x86)\Windows Kits\10\\include\10.0.22621.0\\cppwinrt&quot; /EHsc /Tp./deps/double-conversion/double-conversion\bignum-dtoa.cc /Fobuild\temp.win-amd64-cpython-312\Release\./deps/double-conversion/double-conversion\bignum-dtoa.obj -D_GNU_SOURCE
bignum-dtoa.cc
c1xx: fatal error C1083: Datei (Quelle) kann nicht geÔøΩffnet werden: &quot;./deps/double-conversion/double-conversion\bignum-dtoa.cc&quot;: No such file or directory
--- stderr:
WARNING setuptools_scm.pyproject_reading toml section missing &#x27;pyproject.toml does not contain a tool.setuptools_scm section&#x27;  
error: command &#x27;C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\\MSVC\\14.38.33130\\bin\\HostX86\\x64\\cl.exe&#x27; failed with exit code 2
---
error: process didn&#x27;t exit successfully: `target\debug\puffin.exe pip install &quot;ujson @ https://files.pythonhosted.org/packages/43/1a/b0a027144aa5c8f4ea654f4afdd634578b450807bb70b9f8bad00d6f6d3c/ujson-5.7.0.tar.gz&quot;` (exit code: 2)
</code></pre>
<p>We need to figure out what different setuptools incantation pip performs and replicate it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-02-02 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-02-02 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 19:56</div>
            <div class="timeline-body"><p>Does <code>pypa/build</code> build it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-02 19:59</div>
            <div class="timeline-body"><p>Yes that works too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Initial release&quot; by <a href="https://github.com/konstin">@konstin</a> on 2024-02-02 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 20:01</div>
            <div class="timeline-body"><p>ü§∑‚Äç‚ôÇÔ∏è We do basically the exact same thing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-02 20:02</div>
            <div class="timeline-body"><p>Even if <code>build-backend</code> is not specified while <code>[build-system]</code> is? That is the test case this is coming from</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 20:02</div>
            <div class="timeline-body"><p>Can try with <code>--legacy-setup-py</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 20:03</div>
            <div class="timeline-body"><p>Yes, I believe so: <a href="https://github.com/astral-sh/puffin/pull/530">astral-sh/puffin#530</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 20:04</div>
            <div class="timeline-body"><p><code>ujson</code> was the originating example of that, hence why we have a test for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 22:01</div>
            <div class="timeline-body"><p>Could this be a path conversion error somewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 15:40</div>
            <div class="timeline-body"><p>@konstin - I&#x27;m gonna assign to you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 19:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 19:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 19:27</div>
            <div class="timeline-body"><p>This works fine on my Windows machine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 19:32</div>
            <div class="timeline-body"><p>Oh sorry, let me see what happens when I try to build from source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 19:37</div>
            <div class="timeline-body"><p>Okay, reproduced.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 19:43</div>
            <div class="timeline-body"><p>I&#x27;ll take over.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 20:06</div>
            <div class="timeline-body"><p>I think this has something to do with setting the current working directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-11 20:27</div>
            <div class="timeline-body"><p>It&#x27;s possible this issue will drive me insane though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-12 00:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:29:11 UTC
    </footer>
</body>
</html>
