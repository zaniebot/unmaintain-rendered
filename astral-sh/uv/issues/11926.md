```yaml
number: 11926
title: uv sync fails while uv venv + uv pip install succeeds
type: issue
state: closed
author: kohlrabi
labels:
  - bug
assignees: []
created_at: 2025-03-03T15:47:13Z
updated_at: 2025-06-22T02:25:17Z
url: https://github.com/astral-sh/uv/issues/11926
synced_at: 2026-01-10T01:57:27Z
```

# uv sync fails while uv venv + uv pip install succeeds

---

_Issue opened by @kohlrabi on 2025-03-03 15:47_

### Summary

I reduced the problem to the following MRE. I have a `pyproject.toml` with the following content:

```
[project]
name = "myproject"
version = "1.0.0"
dependencies = [
    "jupyter",
]
requires-python = ">=3.12"
```

When trying to setup or update the environment of the project using `uv sync`, I get the following error:

```
error: Failed to fetch: `https://<ourpypirepo>/packages/packages/26/7e/71f604d8cea1b58f82ba3590290b66da1e72d840aeb37e0d5f7291bd30db/tornado-6.4.2-cp38-abi3-macosx_10_9_universal2.whl#sha256=e828cce1123e9e44ae2a50a9de3055497ab1d0aeb440c5ac23064d9e44880da1`
  Caused by: HTTP status client error (404 Not Found) for url (https://<ourpypirepo>/packages/packages/26/7e/71f604d8cea1b58f82ba3590290b66da1e72d840aeb37e0d5f7291bd30db/tornado-6.4.2-cp38-abi3-macosx_10_9_universal2.whl#sha256=e828cce1123e9e44ae2a50a9de3055497ab1d0aeb440c5ac23064d9e44880da1)
```

Apparently uv sync tries to fetch `tornado` for macosx as a dependency of `jupyter`, even though I am on Debian 12 Linux x86_64.


But I can get a working venv by using 
```
uv venv
. .venv/bin/activate
uv pip install -r pyproject.toml
```

Why does `uv sync` fail like that in this case?

`uv python list` gives the following result:

```
cpython-3.13.0+freethreaded-linux-x86_64-gnu    /home/myuser/python/python-3.13.0-ft/bin/python3.13t
cpython-3.13.0+freethreaded-linux-x86_64-gnu    /home/myuser/python/python-3.13.0-ft/bin/python3.13
cpython-3.13.0+freethreaded-linux-x86_64-gnu    /home/myuser/python/python-3.13.0-ft/bin/python3 -> python3.13
cpython-3.13.0-linux-x86_64-gnu                 /home/myuser/python/python-3.13.0/bin/python3.13
cpython-3.13.0-linux-x86_64-gnu                 /home/myuser/python/python-3.13.0/bin/python3 -> python3.13
cpython-3.12.7-linux-x86_64-gnu                 /home/myuser/python/python-3.12.7/bin/python3.12
cpython-3.12.7-linux-x86_64-gnu                 /home/myuser/python/python-3.12.7/bin/python3 -> python3.12
cpython-3.11.10-linux-x86_64-gnu                /home/myuser/python/python-3.11.10/bin/python3.11
cpython-3.11.10-linux-x86_64-gnu                /home/myuser/python/python-3.11.10/bin/python3 -> python3.11
cpython-3.11.2-linux-x86_64-gnu                 /usr/bin/python3.11
cpython-3.11.2-linux-x86_64-gnu                 /usr/bin/python3 -> python3.11
cpython-3.11.2-linux-x86_64-gnu                 /bin/python3.11
cpython-3.11.2-linux-x86_64-gnu                 /bin/python3 -> python3.11
pypy-3.9.16-linux-x86_64-gnu                    /usr/bin/pypy3 -> pypy3.9
pypy-3.9.16-linux-x86_64-gnu                    /bin/pypy3 -> pypy3.9
```

### Platform

Debian 12 x86_64

### Version

0.6.3

### Python version

3.12, 3.13

---

_Label `bug` added by @kohlrabi on 2025-03-03 15:47_

---

_Comment by @kohlrabi on 2025-03-07 15:37_

I noticed by looking at the verbose output that the order in which packets are installed is different between sync and pip install:

For sync:
```
$ grep "Adding transitive dependency for jupyter==" sync.log
DEBUG Adding transitive dependency for jupyter==1.1.1: ipykernel*
DEBUG Adding transitive dependency for jupyter==1.1.1: ipywidgets*
DEBUG Adding transitive dependency for jupyter==1.1.1: jupyter-console*
DEBUG Adding transitive dependency for jupyter==1.1.1: jupyterlab*
DEBUG Adding transitive dependency for jupyter==1.1.1: nbconvert*
DEBUG Adding transitive dependency for jupyter==1.1.1: notebook*
```

Also it shows:
```
DEBUG Adding transitive dependency for ipykernel==6.29.5: appnope{sys_platform == 'darwin'}*
```

For pip install:
```
$ grep "Adding transitive dependency for jupyter==" pip.log
DEBUG Adding transitive dependency for jupyter==1.1.1: notebook*
DEBUG Adding transitive dependency for jupyter==1.1.1: jupyter-console*
DEBUG Adding transitive dependency for jupyter==1.1.1: nbconvert*
DEBUG Adding transitive dependency for jupyter==1.1.1: ipykernel*
DEBUG Adding transitive dependency for jupyter==1.1.1: ipywidgets*
DEBUG Adding transitive dependency for jupyter==1.1.1: jupyterlab*
```

pip install does not erroneously resolve darwin as the target platform.


So in case of "uv sync" the dependencies are sorted. In case of "uv sync" pip tries to install "ipykernel" first (and fails), while in case of "pip install" pip tries to install "notebook" first.

I am not fluent enough in either rust or the codebase to quickly find the location where the dependencies are being sorted. My guess is that the lock-file mechanism (which is not used for pip install?) also sorts the dependencies passed to the pip process. Is this a problem?

---

_Comment by @konstin on 2025-03-10 22:44_

`uv sync` picks a wheel a platform-independent fashion, so that you get the same resolution no matter where you run it, and uses that wheel to get the metadata and dependency information for a version of a package. In this case, it tries to read that information from the macOS wheel; It assumes that all wheels listed in the index are available to read.

`uv pip install` behaves different because it only resolves for the current platforms, ignoring all wheels and dependencies for other platforms.

---

_Comment by @kohlrabi on 2025-03-11 11:40_

@konstin Thank you for the explanation. Can I somehow workaround that behaviour?

---

_Comment by @konstin on 2025-03-11 11:55_

If you only need linux, you can try https://docs.astral.sh/uv/concepts/resolution/#limited-resolution-environments, otherwise you need to check with the registry why it outputs wheels in the API that cannot be accessed.

---

_Comment by @kohlrabi on 2025-03-11 13:46_

The first solution does not work. I will check with the registry admin to see what can be done, we are using an on-premise Artifactory PyPI mirror. Thank you.

---

_Closed by @charliermarsh on 2025-06-22 02:25_

---
