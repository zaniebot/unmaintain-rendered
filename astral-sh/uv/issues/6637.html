<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a virtual environment from a PEP 723 script - astral-sh/uv #6637</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Create a virtual environment from a PEP 723 script</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6637">#6637</a>
        opened by <a href="https://github.com/gnosys-nmercer">@gnosys-nmercer</a>
        on 2024-08-26 02:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gnosys-nmercer">@gnosys-nmercer</a> on 2024-08-26 02:18</div>
            <div class="timeline-body"><p>It would be useful to be able to create a virtual environment from a PEP723 script.</p>
<p>For example if you specify <code>uv venv --script scriptfile.py</code> it could read the dependencies from the script and create a virtual environment in the same directory.</p>
<p>I know that you can run the script using <code>uv run --script scriptfile.py</code>, but when editing/debugging the script in an IDE (like vscode) you need an environment. This functionality would be useful to quickly create the environment without needing to manually read the dependencies from the script file and then creating the environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-26 17:27</div>
            <div class="timeline-body"><p>Can you share more about how you'd use this from an IDE? We're a bit hesitant about adding this interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-08-26 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @zanieb on 2024-08-26 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gnosys-nmercer">@gnosys-nmercer</a> on 2024-08-27 15:10</div>
            <div class="timeline-body"><blockquote>
<p>Can you share more about how you'd use this from an IDE? We're a bit hesitant about adding this interface.</p>
</blockquote>
<p>@zanieb</p>
<p>Yes I can. Although technically I didn't mean that I would use it from the IDE directly. I will describe my use case and hopefully that will make it clear what I mean.</p>
<p>If I have a PEP723 script file called <strong>myscript.py</strong> and inside this script, it defines the python version and some dependencies using the PEP723 format.</p>
<p>Right now, I am able to run the script using <code>uv run --script myscript.py</code> which will create a temporary virtual environment on the system (not in the local ./.venv directory) and it will install the dependencies. This is all great and I really appreciate this capability.</p>
<p>However, now, for example I want to edit the script and debug it using vscode for example. When I open the script and I with vscode, before I can debug, I will need to set the interpreter (virtual environment) to use to debug. But because it is a PEP723 script, there is no virtual environment set up for it so I would then have to manually create one using <code>uv venv</code> and then <code>uv pip install</code> to install the dependencies. This will create a virtual environment at ./.venv which I can now tell vscode is my interpreter and I can debug.</p>
<p>But I would like to instead, be able to do <code>uv venv --script myscript.py</code> which will understand that myscript.py is a PEP723 script and it will be able to read the dependencies from this script and create an environment at ./.venv with my dependencies. Now I can tell vscode that this is my interpreter and I can debug.</p>
<p>So essentially it makes it easier to create an environment from a script file so I don't have to manually read each dependency and do a <code>uv pip install</code> for each one of these dependencies.</p>
<p>I hope this is more clear. Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Zeddicus414">@Zeddicus414</a> on 2024-08-30 23:13</div>
            <div class="timeline-body"><p>Haha, I did the exact same thing. It went like this:</p>
<ol>
<li>&quot;WOW, this script running thing is AMAZING!!!!&quot;</li>
<li>&quot;Wait... but now VSCode has no idea what's happening in my python script and I have to make a venv to work on it effectively.&quot;</li>
</ol>
<p>It's a good problem to have considering the script running works like magic!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @zanieb on 2024-09-03 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-03 14:30</div>
            <div class="timeline-body"><p>Thanks for the additional context. We'll discuss this and report back here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "feature request: create environment from PEP73 script" to "feature request: create environment from PEP723 script" by @gnosys-nmercer on 2024-09-24 16:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8652.html">astral-sh/uv#8652</a> on 2024-10-29 05:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8856.html">astral-sh/uv#8856</a> on 2024-11-06 15:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> on 2024-11-16 01:03</div>
            <div class="timeline-body"><p>I wanted to comment that I have the exact same use case as https://github.com/astral-sh/uv/issues/6637#issuecomment-2312835746, but that the <code>uv venv --script myscript.py</code> UI might not be desirable if (close) parity with <code>virtualenv</code> is desired.</p>
<p>Maybe <code>uv sync --script myscript.py</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-29 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/remleduff">@remleduff</a> on 2025-01-08 19:31</div>
            <div class="timeline-body"><blockquote>
<p>Haha, I did the exact same thing. It went like this:</p>
<ol>
<li>&quot;WOW, this script running thing is AMAZING!!!!&quot;</li>
<li>&quot;Wait... but now VSCode has no idea what's happening in my python script and I have to make a venv to work on it effectively.&quot;</li>
</ol>
<p>It's a good problem to have considering the script running works like magic!</p>
</blockquote>
<p>I'm not sure if a me-too comment is useful or not, but I just faced the exact same issue.</p>
<p>(I have a directory in my project that's basically a dumping ground for a bunch of scripts and I'd like to use inline metadata for all of them. Working on them in vscode now requires manually looking for all the deps and doing a bunch of &quot;uv pip install&quot;.</p>
<p>Would be great to be able to &quot;uv pip install --from-script *.py&quot; and not have to figure that all out manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oyarsa">@oyarsa</a> on 2025-01-10 21:54</div>
            <div class="timeline-body"><p>Another possibility would a <code>uv</code> subcommand to open a subshell with the venv for script sourced. Or a <code>uv run</code> flag to run a command using the environment from the script. Both of these would work if the IDE could detect this environment. I know you can do this for neovim, but I don't know if it's generally applicable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-10 22:01</div>
            <div class="timeline-body"><p>As of the latest version...</p>
<pre><code>❯ uv init --script main.py
Initialized script at `main.py`
❯ uv add --script main.py anyio
Updated `main.py`
❯ uv venv main.venv &amp;&amp; uv export --script main.py | uv pip install -r - -p main.venv &amp;&amp; uv run -p main.venv -- python -c &quot;import anyio; print(anyio)&quot;
Using CPython 3.14.0a3 interpreter at: /Users/zb/.local/bin/python
Creating virtual environment at: main.venv
Activate with: source main.venv/bin/activate
Resolved 3 packages in 90ms
Using Python 3.14.0a3 environment at: main.venv
Resolved 3 packages in 1ms
Installed 3 packages in 5ms
 + anyio==4.8.0
 + idna==3.10
 + sniffio==1.3.1
&lt;module 'anyio' from '/Users/zb/example/main.venv/lib/python3.14/site-packages/anyio/__init__.py'&gt;
</code></pre>
<p>Of course, you can call the environment whatever you want — the commands are simpler if you use the default name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-10 22:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oyarsa">@oyarsa</a> on 2025-01-10 22:26</div>
            <div class="timeline-body"><p>Thanks for the update!</p>
<p>It's good that we can do this with the existing features, but maybe it should be considered to offer a more streamlined interface?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-10 22:34</div>
            <div class="timeline-body"><p>We're considering that still, e.g., <code>uv sync --script</code>, but I'm not really sure if it makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oyarsa">@oyarsa</a> on 2025-01-11 15:48</div>
            <div class="timeline-body"><p>@zanieb Your demonstration seems to work properly, but running the script directly uses <code>uv</code>'s temporary directory instead of the venv:</p>
<pre><code>$ echo '
# /// script
# requires-python = &quot;&gt;=3.12&quot;
# dependencies = []
# ///

import sys
print(sys.executable)
' &gt; main.py

$ uv venv main.venv &amp;&amp; uv export --script main.py | uv pip install -r - -p main.venv &amp;&amp; uv run -p main.venv main.py
Using CPython 3.12.3 interpreter at: /Users/italo/.local/share/mise/installs/python/3.12.3/bin/python3.12
Creating virtual environment at: main.venv
Activate with: source main.venv/bin/activate.fish
Resolved in 14ms
warning: No dependencies found in stdin
Using Python 3.12.3 environment at: main.venv
Audited in 27ms
Reading inline script metadata from `main.py`
/Users/italo/Library/Caches/uv/archive-v0/du4CKJWedb4NBSF-PZBfA/bin/python3
</code></pre>
<p>Explicitly using <code>python</code> works, though:</p>
<pre><code>$ uv venv main.venv &amp;&amp; uv export --script main.py | uv pip install -r - -p main.venv &amp;&amp; uv run -p main.venv -- python main.py
Using CPython 3.12.3 interpreter at: /Users/italo/.local/share/mise/installs/python/3.12.3/bin/python3.12
Creating virtual environment at: main.venv
Activate with: source main.venv/bin/activate.fish
Resolved in 0.88ms
warning: No dependencies found in stdin
Using Python 3.12.3 environment at: main.venv
Audited in 2ms
/private/tmp/testsuggestion/main.venv/bin/python3
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-11 15:51</div>
            <div class="timeline-body"><p>That looks right to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oyarsa">@oyarsa</a> on 2025-01-11 15:55</div>
            <div class="timeline-body"><p>If I understand correctly, <code>uv run -p main.venv main.py</code> ignores <code>-p main.venv</code> and always uses the temporary environment. Is this the intended behaviour?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-11 15:59</div>
            <div class="timeline-body"><p>Yeah. The <code>-p</code> is the base interpreter. Scripts still get their own environment. What are you trying to do? Why?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oyarsa">@oyarsa</a> on 2025-01-11 16:04</div>
            <div class="timeline-body"><p>I want to be able to run a command (e.g. neovim) inside the script's temporary environment. I don't really care about a local venv (like `main.venv in the example). I just want to either source the temporary environment or open a command that's aware of the environment.</p>
<p>The main problem I'm trying to address is that <code>uv run script.py</code> works , automatically creating the venv and installing dependencies. But when editing the script with an with LSP or an IDE, they don't have access to the venv and can't find the dependencies, so I get errors like &quot;could not resolve module ...&quot;.</p>
<p>Exporting the dependencies and creating a venv with them works, but then I should be able to run the script in that venv so I don't have two separate venvs, one for the editor and another for running the script.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dnwe">@dnwe</a> on 2025-01-14 14:00</div>
            <div class="timeline-body"><p>@charliermarsh similarly I'd love a <code>uv edit script.py</code> that creates/returns the same cached/temporary venv as <code>uv run</code> and calls (for example) <code>source $HOME/.cache/uv/archive-v0/BGtlGcLdG53DhWjMv43cv/bin/activate &amp;&amp; $EDITOR script.py</code> in a subshell so that the editor uses the identical inline-metadata generated venv for python and dependency resolution</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 18:39</div>
            <div class="timeline-body"><p>That's a pretty interesting idea :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BenediktMaag">@BenediktMaag</a> on 2025-01-28 15:30</div>
            <div class="timeline-body"><blockquote>
<p>We're considering that still, e.g., <code>uv sync --script</code>, but I'm not really sure if it makes sense.</p>
</blockquote>
<p>Hi @zanieb,
i tried your solution and unfortunately it didnt work for my usecase when installing from a local index:</p>
<blockquote>
<p>uv init --script script.py
uv add --script script.py mydependency --index internal=<path-to-index></p>
</blockquote>
<p>This will add mydependency into the script, add my index under tool.uv.index and link the mydependecy to this index.</p>
<blockquote>
<p>uv venv
uv export --script script.py | uv pip install -r -</p>
</blockquote>
<p>× No solution found when resolving dependencies:
╰─▶ Because there is no version of mydependency ==0.13.3 and you require mydependency ==0.13.3, we can conclude that your requirements are unsatisfiable.</p>
<p>uv can't resolve the package because the index information gets lost with uv export.
I would really benefit form adding uv sync --script</p>
<p>Im also happy if you can provide another way to get the code completion working in vscode and neovim without creating the virtual environment</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @zanieb on 2025-01-28 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "feature request: create environment from PEP723 script" to "Create a virtual environment from a PEP 723 script" by @zanieb on 2025-01-28 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @zanieb on 2025-01-28 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @zanieb on 2025-01-28 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-28 18:01</div>
            <div class="timeline-body"><p>Thanks for the use-case @BenediktMaag — we'll need to think about a solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BenediktMaag">@BenediktMaag</a> on 2025-01-29 08:53</div>
            <div class="timeline-body"><p>I created another issue that should probably considered when thinking about a solution as it is closely related:</p>
<p>https://github.com/astral-sh/uv/issues/11053</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11197.html">astral-sh/uv#11197</a> on 2025-02-03 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-02-07 03:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nishikoh">@Nishikoh</a> on 2025-02-09 16:55</div>
            <div class="timeline-body"><p>I want to propose a use case using Docker for this topic.</p>
<pre><code class="language-Dockerfile">FROM  ghcr.io/astral-sh/uv:latest
COPY my_script.py my_script.py

CMD uv run --script my_script.py
</code></pre>
<p>In the above case, the environment is set up when running <code>docker run</code>, which results in a longer execution time.</p>
<p>By enabling pre-installation as shown below, startup time can be reduced.</p>
<pre><code class="language-Dockerfile">FROM  ghcr.io/astral-sh/uv:latest
COPY my_script.py my_script.py
RUN # pre-install Python packages using uv for my_script.py

CMD uv run --script my_script.py
</code></pre>
<p>If <code>my_script.py</code> was developed with a tool other than <code>uv</code> that supports PEP 723, it would not have a <code>uv.lock</code> file.<br />
If a virtual environment is to be built from PEP 723 metadata, it would be desirable to allow environment setup even in the absence of <code>uv.lock</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11361.html">astral-sh/uv#11361</a> on 2025-02-09 19:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-12 16:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:34 UTC
    </footer>
</body>
</html>
