<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package built with uv, ignores dependency sources specified in tool.uv.sources - astral-sh/uv #13353</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Package built with uv, ignores dependency sources specified in tool.uv.sources</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/13353">#13353</a>
        opened by <a href="https://github.com/mvechtomova">@mvechtomova</a>
        on 2025-05-08 18:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-08 18:20</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>@charliermarsh
We used tool.uv.sources to specify our dependency source (GitHub) and then built the package using uv build.</p>
<p>I realized then when we tried to install the package somewhere else, the source from tool.uv.sources was ignored - instead, the package was downloaded from PyPi (and a package with that name existed too!)</p>
<p>If tool.uv.sources is used to specify our dependency source,  the installation of the wheel with dependencies will fail in the best case. In the worst case, the package with the same name might be available on PyPi. Then it will be installed instead of the package from the specified source (and may contain malware).</p>
<p>Not obvious and dangerous.</p>
<p><img src="https://github.com/user-attachments/assets/2aeb1bd1-392a-413a-a795-9ceff6cc9a41" alt="Image" /></p>
<h3>Platform</h3>
<p>all</p>
<h3>Version</h3>
<p>0.7.2</p>
<h3>Python version</h3>
<p>3.11.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mvechtomova on 2025-05-08 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-05-08 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @zanieb on 2025-05-08 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-05-08 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-08 18:28</div>
            <div class="timeline-body"><p>Where would you expect to see this highlighted?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-08 18:28</div>
            <div class="timeline-body"><p>(and separately, what build backend are you using?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-08 18:36</div>
            <div class="timeline-body"><blockquote>
<p>(and separately, what build backend are you using?)</p>
</blockquote>
<p>Setuptools build backend. I need to try another one to see whether the problem persists then.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-08 18:36</div>
            <div class="timeline-body"><blockquote>
<p>Where would you expect to see this highlighted?</p>
</blockquote>
<p>Good question, I think this should be removed all together if this is a possibility that this behaviors occurs. I noticed you marked it as question. But it is too serious to just be a question.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-08 18:37</div>
            <div class="timeline-body"><blockquote>
<p>Setuptools build backend. I need to try another one to see whether the problem persists then.</p>
</blockquote>
<p>No build backend will respect <code>tool.uv.sources</code>. It's both uv-specific, and development-only.</p>
<blockquote>
<p>I think this should be removed all together if this is a possibility that this behaviors occurs.</p>
</blockquote>
<p>I think you're just misunderstanding the purpose of the feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-08 18:39</div>
            <div class="timeline-body"><p>The first paragraph of documentation for this feature is clear that it's for development https://docs.astral.sh/uv/concepts/projects/dependencies/#dependency-sources</p>
<p>And the next paragraph is clear that its purpose is to add support for things not covered by the <code>project.dependencies</code> standard (i.e., the <em>published</em> metadata).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-08 18:41</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Setuptools build backend. I need to try another one to see whether the problem persists then.</p>
</blockquote>
<p>No build backend will respect <code>tool.uv.sources</code>. It's both uv-specific, and development-only.</p>
<blockquote>
<p>I think this should be removed all together if this is a possibility that this behaviors occurs.</p>
</blockquote>
<p>I think you're just misunderstanding the purpose of the feature.</p>
</blockquote>
<p>This is not clear at all that this is development-only. Hence it is dangerous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-08 18:44</div>
            <div class="timeline-body"><blockquote>
<p>The first paragraph of documentation for this feature is clear that it's for development https://docs.astral.sh/uv/concepts/projects/dependencies/#dependency-sources</p>
<p>And the next paragraph is clear that its purpose is to add support for things not covered by the <code>project.dependencies</code> standard (i.e., the <em>published</em> metadata).</p>
</blockquote>
<p>Many people come from poetry, in poetry these are not development dependencies! So it is very logical to assume these are not development dependencies either. It is crucial to highlight the consequences of not being published metadata for the built wheel.</p>
<p>Since too many people may misunderstand it (and already do!), it creates serious vulnerability risks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-08 18:49</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Where would you expect to see this highlighted?</p>
</blockquote>
<p>Good question, I think this should be removed all together if this is a possibility that this behaviors occurs. I noticed you marked it as question. But it is too serious to just be a question.</p>
</blockquote>
<p>We're limited by the rules that PEP 621 imposes on the <code>[project]</code> table, a split declaration with fields that apply only locally otherwise wouldn't have been our choice. Given the current (external) constraints that apply, we're using the fields during uv development and document the behavior. We generally found it to be well received by users and is the underpinning for advanced features such as workspaces.</p>
<p>Note that indexes generally reject all non-index dependencies, so it is not possible to upload a package with a e.g. Git source to PyPI, independent of whether it's <code>[tool.uv.sources]</code> or in <code>[project]</code>.</p>
<p>With Poetry 2.0 and its switch to PEP 621, Poetry faces the same problem that source is used locally, but only the version constraint is published:</p>
<pre><code class="language-toml">[project]
# ...
dependencies = [
    &quot;requests&gt;=2.13.0&quot;,
]

[tool.poetry.dependencies]
requests = { source = &quot;private-source&quot; }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-08 18:57</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<blockquote>
<p>Where would you expect to see this highlighted?</p>
</blockquote>
<p>Good question, I think this should be removed all together if this is a possibility that this behaviors occurs. I noticed you marked it as question. But it is too serious to just be a question.</p>
</blockquote>
<p>We're limited by the rules that PEP 621 imposes on the <code>[project]</code> table, a split declaration with fields that apply only locally otherwise wouldn't have been our choice. Given the current (external) constraints that apply, we're using the fields during uv development and document the behavior. We generally found it to be well received by users and is the underpinning for advanced features such as workspaces.</p>
<p>Note that indexes generally reject all non-index dependencies, so it is not possible to upload a package with a e.g. Git source to PyPI, independent of whether it's <code>[tool.uv.sources]</code> or in <code>[project]</code>.</p>
<p>With Poetry 2.0 and its switch to PEP 621, Poetry faces the same problem that source is used locally, but only the version constraint is published:</p>
<p>[project]</p>
<h1>...</h1>
<p>dependencies = [
&quot;requests&gt;=2.13.0&quot;,
]</p>
<p>[tool.poetry.dependencies]
requests = { source = &quot;private-source&quot; }</p>
</blockquote>
<p>Quite often people do not upload packages to PyPi (as they are private) and just use GitHub link. Hence it is logical to include that in dependencies. Seems like poetry also does not look at tool.poetry.dependencies anymore:</p>
<blockquote>
<p>When both are specified, project.dependencies are used for metadata when building the project, &gt; tool.poetry.dependencies is only used to enrich project.dependencies for locking.</p>
</blockquote>
<blockquote>
<p>Alternatively, you can add dependencies to dynamic and define your dependencies completely in the tool.poetry &gt; section. Using only the tool.poetry section might make sense in non-package mode when you will not build an sdist &gt; or a wheel.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-09 06:31</div>
            <div class="timeline-body"><p>@zanieb @konstin I guess my main problem with this is that the way requirements are defined must be different for development and when the wheel must be built. Inconsistency by design.</p>
<p>In the case I shared it will not fail, but will cause some unexpected behavior. As dependency is specified in dependencies, it will actually be included in metadata - but not the source, hence if the package exists in PyPi, a different package will be installed. Something which is very hard to debug.</p>
<p>There is no way to isolate local development and build as it seems.</p>
<p>https://docs.astral.sh/uv/concepts/projects/dependencies/#build-dependencies. This documentation is also very unclear:</p>
<blockquote>
<p>By default, uv will respect tool.uv.sources when resolving build dependencies. For example, to use a local version of setuptools for building, add the source to tool.uv.sources</p>
</blockquote>
<blockquote>
<p>When publishing a package, we recommend running uv build --no-sources to ensure that the package builds correctly when tool.uv.sources is disabled, as is the case when using other build tools, like <a href="https://github.com/pypa/build">pypa/build</a>.</p>
</blockquote>
<p>The second kind of implies that uv build may use sources.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JenspederM">@JenspederM</a> on 2025-05-11 09:52</div>
            <div class="timeline-body"><p>I will second @mvechtomova concerns. I was also very surprised the first time I encountered this issue, and I don't find the documentation to be clear on this.</p>
<p>I wonder, why we couldn't just resolve the dependencies though. Since uv is effectively in control of the build process, why not just copy local dependencies into site-packages at build time?</p>
<p>@mvechtomova As for git dependencies, I've found that manually specifying these, as you would have in a requirements.txt, will actually resolve correctly. But I do find it unfortunate that this has to be done manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mavwolverine">@mavwolverine</a> on 2025-06-10 22:17</div>
            <div class="timeline-body"><p>Me too. I came here looking for exactly the same thing.
I have a core project and an app project. When I do a <code>uv build</code> on the app project, I want it to run <code>uv build</code> on core, install it in app, then run <code>uv build</code> on app so that the final wheel contains all necessary packages for app.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-11 20:43</div>
            <div class="timeline-body"><p>@mavwolverine That sounds like an unrelated problem, wheels only contain one project, independent of whether <code>tool.uv.sources</code> are used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/offsetcyan">@offsetcyan</a> on 2025-06-22 21:38</div>
            <div class="timeline-body"><p>I've just encountered this, same as @mvechtomova, while trying to build wheels and it's a clear security risk. To reiterate mvechtomova's point: a malicious actor (say, working at an organisation) could intercept the build process with a name collision via PyPi and install malicious code from out-of-tree.</p>
<p>@zanieb post-hoc the leading sentence and trailing &quot;important&quot; paragraph in that section are clear, but I wouldn't have guessed this was the behaviour after reading that the first time. It's only after debugging unexpected dependencies while installing a wheel did I realise what was happening.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanpainchaud">@nathanpainchaud</a> on 2025-07-04 17:52</div>
            <div class="timeline-body"><p>I understand that respecting the specified <code>tool.uv.sources</code> is not something uv can force on any build backend, since it relies on a uv-specific field in <code>pyproject.toml</code>.</p>
<p>However, I was wondering if it was something that could be supported when using the (newly released) <code>uv_build</code> backend? At first glance, it doesn't seem unreasonable to me for uv's own backend to be aware of uv-specific fields in <code>pyproject.toml</code>...</p>
<p>Or maybe I'm missing some trickier issues with python standards compliance that make this inadvisable, even for <code>uv_build</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-07 08:28</div>
            <div class="timeline-body"><p>Unfortunately, PEP 621 requires us to keep <code>project.dependencies</code> exactly as they were, so we're bound to that with <code>uv_build</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanpainchaud">@nathanpainchaud</a> on 2025-07-07 08:42</div>
            <div class="timeline-body"><blockquote>
<p>Unfortunately, PEP 621 requires us to keep <code>project.dependencies</code> exactly as they were, so we're bound to that with <code>uv_build</code>.</p>
</blockquote>
<p>I was afraid that was the case, but thank you for the clear and direct answer üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../aptible/unpage/pulls/18.html">aptible/unpage#18</a> on 2025-07-28 17:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
