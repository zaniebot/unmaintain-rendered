<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv tool install` fails to download newer Python when `pip` is installed in system python - astral-sh/uv #10282</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv tool install</code> fails to download newer Python when <code>pip</code> is installed in system python</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10282">#10282</a>
        opened by <a href="https://github.com/ceejatec">@ceejatec</a>
        on 2025-01-03 00:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ceejatec">@ceejatec</a> on 2025-01-03 00:15</div>
            <div class="timeline-body"><p>I have a PyPI project named <code>cbdep</code> where all versions depend on at least Python 3.10. If I run <code>uv tool install cbdep</code> in a Linux environment where the system Python is &lt; 3.10 <em>and</em> <code>pip</code> is installed, <code>uv</code> decides not to download a newer Python and instead fails with the error</p>
<pre><code>Ã— No solution found when resolving dependencies:
â•°â”€â–¶ Because the current Python version (3.8.10) does not satisfy
     Python&gt;=3.10 and all versions of cbdep depend on Python&gt;=3.10, we can
     conclude that all versions of cbdep cannot be used.
     And because you require cbdep, we can conclude that your requirements
     are unsatisfiable.</code></pre>
<p>Setting <code>--python-preference=only-managed</code> allows this to work, but that means it will install Python even in an environment where Python 3.10+ is available which isn't optimal.</p>
<p>Here is a Dockerfile which demonstrates the problem, included the rather bizarre fact that it only occurs when the <code>python3-pip</code> package is installed:</p>
<pre><code>FROM ubuntu:20.04 AS base

RUN apt-get update &amp;&amp; apt-get install -y python3 curl
RUN useradd -m testuser
USER testuser
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH=&quot;/home/testuser/.local/bin:${PATH}&quot;

# This path works as expected
FROM base AS successful

RUN uv tool install cbdep
RUN ls -l ~/.local/share/uv/python
RUN touch /tmp/foo

# This path fails because uv decides not to download python
FROM base AS failure

USER root
RUN apt-get install -y python3-pip

# This line is only here to make `docker build` build the `successful` path
COPY --from=successful /tmp/foo /tmp/foo

USER testuser
RUN RUST_LOG=trace uv tool install cbdep
RUN ls -l ~/.local/share/uv/python</code></pre>
<p>I wonder if this might be related in some way to https://github.com/astral-sh/uv/issues/5144 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-03 00:22</div>
            <div class="timeline-body"><p>I think this is a duplicate of https://github.com/astral-sh/uv/issues/6381</p>
<p>I don't think the presence of <code>pip</code> should make any difference. I presume the difference is that the older Python version is placed on your <code>PATH</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-03 00:23</div>
            <div class="timeline-body"><p>You can bypass this by explicitly requesting 3.10+, e.g., <code>--python &quot;&gt;=3.10&quot;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ceejatec">@ceejatec</a> on 2025-01-03 08:57</div>
            <div class="timeline-body"><blockquote>
<p>I think this is a duplicate of https://github.com/astral-sh/uv/issues/6381</p>
</blockquote>
<p>Yep, that does look like basically the same issue. I did search for relevant issues before filing this one but somehow missed that one.</p>
<blockquote>
<p>I don't think the presence of pip should make any difference.</p>
</blockquote>
<p>I completely agree! ðŸ˜„</p>
<blockquote>
<p>I presume the difference is that the older Python version is placed on your PATH?</p>
</blockquote>
<p>No, in both cases it's python 3.8 from Ubuntu's repositories, and it's on PATH in both cases. The only difference is the installation of the <code>python3-pip</code> Ubuntu package in the failing example. It is true that I was assuming the existence of the <code>pip</code> binary is playing a role here; it could equally be something else that is brought in by the <code>python3-pip</code> package, which is quite a lot of stuff. But I can say that in both cases, <code>type python</code> returns &quot;not found&quot;, while <code>type python3</code> returns <code>/usr/bin/python3</code>.</p>
<p>I do notice that after installing <code>python3-pip</code>, both <code>pip</code> and <code>pip3</code> are on the PATH; is it weird that there's a <code>pip</code> but no <code>python</code>?</p>
<blockquote>
<p>You can bypass this by explicitly requesting 3.10+, e.g., --python &quot;&gt;=3.10&quot;</p>
</blockquote>
<p>Thanks; that's a slightly better workaround than using <code>--python-preference=only-managed</code> since it <em>will</em> use the OS-provided Python if it matches the requirement, rather than unambiguously downloading a Python installation every time. It's still not a general solution though, of course, since it requires you to have a priori knowledge of the Python requirement of the tool you're installing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-03 09:30</div>
            <div class="timeline-body"><blockquote>
<p>I did search for relevant issues before filing this one but somehow missed that one.</p>
</blockquote>
<p>No problem, GitHub's search is bad. Thanks for making the effort though.</p>
<blockquote>
<p>I do notice that after installing python3-pip, both pip and pip3 are on the PATH; is it weird that there's a pip but no python?</p>
</blockquote>
<p>I'm not sure â€” it's probably a Python 2 compatibility quirk.</p>
<blockquote>
<p>No, in both cases it's python 3.8 from Ubuntu's repositories, and it's on PATH in both cases. The only difference is the installation of the python3-pip Ubuntu package in the failing example.</p>
</blockquote>
<p>Interesting. I'll take a look at the reproduction. We don't ever invoke or inspect pip.</p>
<blockquote>
<p>It's still not a general solution though, of course, since it requires you to have a priori knowledge of the Python requirement of the tool you're installing.</p>
</blockquote>
<p>Definitely! We'd love to fix this by solving for the necessary Python version, we just haven't gotten to it yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @zanieb on 2025-01-03 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2025-01-03 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-05 23:41</div>
            <div class="timeline-body"><p>I'm going to try to fix this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-01-05 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-08 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-08 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cb-robot">@cb-robot</a> on 2025-01-13 09:29</div>
            <div class="timeline-body"><p>Verified working with uv 0.5.18 - thank you @charliermarsh !</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:52 UTC
    </footer>
</body>
</html>
