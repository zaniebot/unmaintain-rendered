<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Behaviour of `uv sync` with extras? - astral-sh/uv #11473</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Behaviour of <code>uv sync</code> with extras?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11473">#11473</a>
        opened by <a href="https://github.com/mschwoer">@mschwoer</a>
        on 2025-02-13 10:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mschwoer">@mschwoer</a></div>
            <div class="timeline-body">Question
<p>Hey,
I&#x27;d like to transition from <code>pip</code> to <code>uv</code>, but there&#x27;s still a behavior that puzzles me with <code>uv</code>.</p>
<p>Basically, I want to offer two installation flavours, one with pinned requirements (&#x27;stable&#x27;) and one with loose requirements (to allow easier integration into existing environments, on the users&#x27; risk).</p>
<p>With the below <code>pyproject.toml</code>, <code>pip</code>&#x27;s behaviour is nicely reproduced by <code>uv</code>
(all commands assume a &#x27;clean&#x27; environment, so <code>.venv</code>, <code>build</code> and <code>egg-info</code> being absent):</p>
<blockquote>
<p><code>uv pip install .</code>    =&gt; scikit-learn==1.6.1   OK
<code>uv pip install &quot;.[stable]&quot;</code>    =&gt; scikit-learn==1.6.0   OK</p>
</blockquote>
<p>However, when using <code>uv sync</code>, the behaviour is different:</p>
<blockquote>
<p><code>uv sync</code> =&gt; scikit-learn==1.6.0  would expect 1.6.1 here
<code>uv sync --no-extra stable</code> =&gt; scikit-learn==1.6.0  would expect 1.6.1 here</p>
</blockquote>
<p>How can I select the &#x27;stable&#x27; extra in <code>uv sync</code>?</p>
<p>Moreover, when adding this
<code>optional-dependencies.future = [     &quot;scikit-learn==1.6.1&quot; ]</code>
I get an <code>No solution found when resolving dependencies</code></p>
<p>It could well be that I didn&#x27;t get the role of <code>uv sync</code> right? I think of it as an equivalent of <code>pip install [whatever requirement is defined in the given extra]</code>?</p>
<p>best,
Magnus</p>
<hr>
<p>Steps to reproduce:</p>
<blockquote>
<p>uv init explore-uv</p>
</blockquote>
<p>pyproject.toml:</p>
<pre><code>[project]
name = &quot;explore-uv&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;

dependencies = [
    &quot;scikit-learn&quot;
]
optional-dependencies.stable = [
    &quot;scikit-learn==1.6.0&quot;
]

#optional-dependencies.stable2 = [
#    &quot;scikit-learn==1.6.1&quot;
#]
</code></pre>
Platform
<p>macOS</p>
Version
<p>uv 0.5.29 (ca73c4754 2025-02-05)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/mschwoer">@mschwoer</a> on 2025-02-13 10:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-13 14:13</div>
            <div class="timeline-body"><p>For the pinned requirements stable flavor, you can use <code>uv export</code> and have users use that file as constraints file. This trick means that the package ship the loose requirements but user can still coerce their resolution into the test pinned version with e.g. <code>pip install -c &lt;constraint_file&gt;</code>.</p>
<p>In <code>uv sync</code>, uv requires all extras to be compatible with each other, including the base dependencies and each extra. When uv see that one extra requires a specific version, that version gets coerced for the entire package. That is different from <code>uv pip</code>, that only looks at the actually used extras.</p>
<p><a href="https://docs.astral.sh/uv/concepts/projects/config/#conflicting-dependencies">conflicting dependencies</a> may be another option for you: You can declare that two extras are never installed at the same time, so their dependencies are allowed to conflict and can have different version (even tough uv generally tries to reuse versions where possible).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-18 22:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:17 UTC
    </footer>
</body>
</html>
