```yaml
number: 10154
title: Conditionally allow dependencies to resolve where specific versions conflict with optional dependency bounds
type: issue
state: open
author: mjlbach
labels:
  - configuration
  - needs-design
assignees: []
created_at: 2024-12-25T14:43:04Z
updated_at: 2025-12-01T16:44:48Z
url: https://github.com/astral-sh/uv/issues/10154
synced_at: 2026-01-10T01:57:23Z
```

# Conditionally allow dependencies to resolve where specific versions conflict with optional dependency bounds

---

_Issue opened by @mjlbach on 2024-12-25 14:43_

# Description of problem
Some optional dependencies can introduce additional version constraints. E.g., I may introduce a package that requires numpy pinned to version 1.x.x. I would ideally like this not to impact the resolved packages when not using this optional dependency.

## Scenario 1: optional dependency upper bound is incompatible with lower bound of dependency
### pyproject toml
```toml
[project]
name = "uv-test"
version = "0.1.0"
description = "an example showing conflict resolution"
requires-python = ">=3.12.7"
dependencies = [
  "numpy>=2.0.0",
]

[project.optional-dependencies]
mediapipe = [
    "mediapipe>=0.10.20",
]

```

###  Sync the dependencies
```
❯ uv sync
Using CPython 3.12.7
Creating virtual environment at: .venv
  × No solution found when resolving dependencies:
  ╰─▶ Because your project depends on numpy>=2.0.0 and mediapipe==0.10.20 depends on
      numpy<2, we can conclude that mediapipe==0.10.20 and your project are incompatible.
      And because only mediapipe<=0.10.20 is available, we can conclude that
      mediapipe>=0.10.20 and your project are incompatible.
      And because uv-test[mediapipe] depends on mediapipe>=0.10.20 and your project
      requires uv-test[mediapipe], we can conclude that your project's requirements are
      unsatisfiable.
```

## Workaround

```toml
[project]
name = "uv-test"
version = "0.1.0"
description = "an example showing conflict resolution"
requires-python = ">=3.12.7"
dependencies = []

[dependency-groups]
numpy = [
  "numpy>=2.0.0",
]

[tool.uv]
default-groups = ["numpy"]
conflicts = [
    [
      { group = "numpy" },
      { extra = "mediapipe" },
    ],
]

[project.optional-dependencies]
mediapipe = [
    "mediapipe>=0.10.20",
]
```

## Ugly workaround
```
uv sync --extra mediapipe --no-group numpy
```

Anything I'm missing?

---

_Comment by @charliermarsh on 2024-12-26 14:42_

I don't think there's a better way to do this right now than the workaround you have above.

---

_Label `configuration` added by @charliermarsh on 2024-12-26 14:43_

---

_Label `needs-design` added by @charliermarsh on 2024-12-26 14:43_

---

_Comment by @mjlbach on 2024-12-26 17:55_

I figured poking through the code :) I think it's a worthwhile feature to support.

---

_Comment by @florent-pajot on 2025-12-01 16:44_

I'm encountering the same issue.

---
