```yaml
number: 14992
title: "Allow relative `exclude-newer` values like \"one week ago\""
type: issue
state: closed
author: GeoVizNow
labels:
  - enhancement
assignees: []
created_at: 2025-07-31T13:14:40Z
updated_at: 2026-01-06T16:54:19Z
url: https://github.com/astral-sh/uv/issues/14992
synced_at: 2026-01-10T01:57:34Z
```

# Allow relative `exclude-newer` values like "one week ago"

---

_Issue opened by @GeoVizNow on 2025-07-31 13:14_

### Summary

I am not very experienced with `uv` yet, but see great benefits with what I have tried. 

Benefit of adding functionality to parse natural date into `exclude-newer` would be to easily be able to keep `uv` from puling very freshly published dependencies in case of yet to be detected malware.

I would really appreciated to be able to state in pyproject.toml something like below, example:
```
[tool.uv]
exclude-newer = "one week ago"
```
or 
```
[tool.uv]
exclude-newer = "14 days ago"
```
I do not know if this is hard to implement and if it is inconsistent with other configurations. E.g. one would not want this filter to apply for an editable package under development.

Would be interesting to hear your thoughts on this or if this is already being discussed.

---

_Label `enhancement` added by @GeoVizNow on 2025-07-31 13:14_

---

_Comment by @zanieb on 2025-07-31 13:34_

We can't allow this in persistent configuration today because we invalidate the lockfile whenever the `exclude-newer` value changes. We could consider changing that behavior for this use-case though... it'd be a cool feature.

---

_Renamed from "Add functionality to `exclude-newer` such that it can parse a date from a natural string such as 'one week ago' to account for and filter away malware packages just released" to "Allow relative `exclude-newer` values like "one week ago"" by @zanieb on 2025-07-31 13:35_

---

_Comment by @GeoVizNow on 2025-07-31 15:00_

Thanks for the fast reply and for considering adding such a feature:). I see there is a challenge with lock files, but great that you see possibilities. This could be one approach to try to tackle the challenge of fresh published malware not detected yet and avoid unintentionally pulling it.

---

_Comment by @notatallshaw on 2025-07-31 15:46_

A similar request was made before, https://github.com/astral-sh/uv/issues/3019, a workaround exists on the command line with Linux:

```
--exclude-newer $(date --utc -d "7 days ago" "+%Y-%m-%dT%H:%M:%SZ")
```

---

_Comment by @GeoVizNow on 2025-08-01 08:20_

I have experimented a bit automating updating the exclude-newer with code towards `pyproject.toml` and notice how it could be beneficial to state more details into such a relative natural date string constraint.

If I state "7 day ago **at noon**" it will set the date string as below and dates will jump with whole days and not seconds.
```
[tool.uv]
exclude-newer = "2025-07-25T12:00:00Z"
```
This would help avoiding too eagerly updating the `uv.lock` and would result in making it update no more frequently than daily (which would maybe be what to prefer) due to this constraint. 

---

_Comment by @BurntSushi on 2025-08-04 16:25_

A point against things like `7 days ago` in persistent configuration is that it lacks a time zone. Does that mean 7 days ago in UTC? Or in the time zone of whoever is running uv? This is why we require a specific and unambiguous timestamp in `pyproject.toml` (e.g., RFC 3339) but, IIRC, allow things like `2025-08-01` on the CLI where it's more obvious that the system's configured time zone would be used to resolve that civil date to an instant in time. On that token though, I think it would be cool to allow things like `7 days ago` on the CLI.

---

_Comment by @zanieb on 2025-08-04 17:32_

Isn't 7 days ago the same time regardless of the time zone?

---

_Comment by @zanieb on 2025-08-04 17:32_

(of course, it's probably not once you start dealing with DST?)

---

_Comment by @BurntSushi on 2025-08-04 18:00_

DST is part of it, but "7 days ago" is a relative datetime. So from which point do you start counting? If you start at the current UTC time you'll end up at a difference place than if you started with the current time on the East coast in 5 out of 24 hours in the day (or 4 during DST).

---

_Comment by @GeoVizNow on 2025-08-05 08:07_

I can easily see that details around time zone could lead to problems in the the details that must potentially be but solved somehow. The intention of this issue was to hopefully being able to leverage another method to tackle the ever increasing challenge of not-yet-detected malicious packages with malware. The main idea would be to secure a delay such that the risk of installing malicious sofware decreases due to chance of discovery is higher when putting a such a delay that gives researchers more time to detect issues.
Thus I think that the date is the important constraint. Maybe one could assume UTC as a default time zone as a simplification when/if relative date is used in configuration files (is UTC what is used for pypi package publish date?).

---

_Comment by @BurntSushi on 2025-08-05 13:22_

IMO, we shouldn't assume UTC for datetimes (relative or not) without a time zone or an offset stored in a persistent configuration file. I think it makes it too easy for readers of the configuration to assume local time instead of UTC.

> (is UTC what is used for pypi package publish date?)

`upload_time` is a timestamp that is compatible with both RFC 3339 and ISO 8601. It has a time zone offset indicating UTC (`Z`), so no assumption of implied UTC is required.

---

_Comment by @notatallshaw on 2025-08-05 14:20_

Apologies, this is a slight aside, but I was thinking about assuming UTC for pip when a timezone isn't provided for the non-relative exclude newer so that it produces the same result across environments: https://github.com/pypa/pip/pull/13520

In terms of relative difference, you need to decide when it comes to a DST change over does "1 day ago" mean the same as "86400 seconds ago". This is clearly subjective as different datetime libraries have different solutions (this has been somewhat a discussion on DPO since utcnow was deprecated). One solution is perhaps to offer very limited relative syntax so o ky one way can be described. 

---

_Referenced in [pypa/pip#13520](../../pypa/pip/pulls/13520.md) on 2025-08-05 14:30_

---

_Comment by @BurntSushi on 2025-08-05 14:31_

@zanieb and I were talking about something like `2 days ago in UTC` or `2 days ago in America/New_York`. A bit more verbose, but much less ambiguous.

---

_Comment by @notatallshaw on 2025-08-05 15:11_

Well, as I say, there is some ambiguity about what "2 days ago in America/New_York" means, at least when you also provide the option to say "48 hours ago", or "1.1 days ago" e.g. https://discuss.python.org/t/why-is-datetime-utcnow-deprecated/86868/10

But I'm not too opinionated as long it is explicitly documented. 

---

_Comment by @notatallshaw on 2025-08-05 15:20_

> `upload_time` is a timestamp that is compatible with both RFC 3339 and ISO 8601. It has a time zone offset indicating UTC (`Z`), so no assumption of implied UTC is required.

One last side note, PEP 700 says that an index MUST provide the Z UTC time zone offset, so any other time zone would be a violation of spec. 

---

_Comment by @BurntSushi on 2025-08-05 15:54_

Yeah Jiff (the datetime library we use) will correctly interpret `2 days ago` with respect to DST, and `48 hours` as a physical duration that is always 48 hours. The former may be longer or shorter than 48 hours.

---

_Comment by @GeoVizNow on 2025-08-20 08:53_

Just a follow up on this one. Do you see this as an enhancement that may be possible to implement/may be prioritized?

---

_Comment by @zanieb on 2025-08-21 11:17_

It's possible, I built a prototype. It's not a priority though, it's a "nice to have" feature and there are a lot of "must have" things we're working on.

---

_Comment by @GeoVizNow on 2025-08-25 08:23_

Great that it is possible and thanks @zanieb for putting work into a prototype! I can understand other things are more important. Thank you all for good perspectives on the topic!

---

_Comment by @MartinCura on 2025-09-11 15:44_

Neat idea, i'd like this.

pnpm just merged a `minimumReleaseAge` setting https://github.com/pnpm/pnpm/pull/9957, they have an interesting discussion in the related issue.

---

_Comment by @paulzakin on 2025-09-16 19:19_

@zanieb I stumbled across this issue after playing around with `exclude-newer`. 

In particular, `minimumReleaseAgeExclude` of pnpm seems like a crucial setting to add to `uv`. While `minimumReleaseAge` seems to mostly map to `exclude_newer`, I think you need an escape hatch of `minimumReleaseAgeExclude`. That is because (unless I do not understand something, always possible!) `exclude_newer` is a global value. Hence, if you have a package with a CVE that needs to be upgraded but you want the rest of your dependencies in your uv.lock to stay a week old, I do not think that is currently possible. However, with `minimumReleaseAge`, it becomes possible. That seems like a super useful feature!

---

_Comment by @paulzakin on 2025-10-01 23:54_

After playing around with it more, it does seem that exclude-newer-package provides the escape hatch. It’s a great feature.

---

_Comment by @zanieb on 2025-10-02 02:22_

If someone is interested in trying to clean up the branch, here's where I left it: https://github.com/astral-sh/uv/compare/zb/exclude-newer-delay — I'll revisit it eventually. I think the semantics are sort of subtle though.

---

_Referenced in [astral-sh/uv#16803](../../astral-sh/uv/issues/16803.md) on 2025-11-21 15:59_

---

_Referenced in [astral-sh/uv#16851](../../astral-sh/uv/issues/16851.md) on 2025-11-25 21:04_

---

_Comment by @janlarres on 2025-11-26 04:24_

Another example of a tool that has implemented this functionality:
https://bun.com/docs/runtime/bunfig#install-minimumreleaseage

Sadly I think that the need for this feature is only going to become more relevant in the future.

---

_Comment by @konstin on 2025-11-26 15:10_

The main difference with a relative release date is that I'd want it to not affect the lockfile. The absolute exclude-newer is intended to generate the same resolution each time (with the exception of yanking), freezing the world at an earlier state. With a relative exclude newer, I'd expect it not to affect the lockfile, instead operating as if I'm following the regular stream of new versions, just with a cooldown.

Together with the relative cooldown, we also need an option to disable it on a per-package basis, such as https://github.com/astral-sh/uv/pull/16854, so that this option doesn't block you from pulling in selected bugfix releases.

Using the data from https://blog.yossarian.net/2025/11/21/We-should-all-be-using-dependency-cooldowns, most attacks have a short lifetime - usually hours - so that even a short cooldown can be effective.

---

_Comment by @zanieb on 2025-11-26 15:52_

I opened a draft at #16814 

---

_Referenced in [PlasmaPy/PlasmaPy#3158](../../PlasmaPy/PlasmaPy/issues/3158.md) on 2025-11-26 22:37_

---

_Referenced in [j178/prek#1152](../../j178/prek/issues/1152.md) on 2025-11-29 19:48_

---

_Referenced in [jazzband/pip-tools#2288](../../jazzband/pip-tools/issues/2288.md) on 2025-11-30 01:25_

---

_Comment by @woodruffw on 2025-12-26 16:14_

Triage: this was done in https://github.com/astral-sh/uv/pull/16814

Docs: https://docs.astral.sh/uv/concepts/resolution/#dependency-cooldowns

---

_Closed by @woodruffw on 2025-12-26 16:14_

---

_Comment by @GeoVizNow on 2026-01-06 16:54_

Thanks a lot for implementing this!!

---
