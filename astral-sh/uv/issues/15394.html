<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add option for `uv export` to also support --index-url --extra-index-url in exported requirements.txt - astral-sh/uv #15394</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Add option for `uv export` to also support --index-url --extra-index-url in exported requirements.txt</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15394">#15394</a>
        opened by <a href="https://github.com/adychar">@adychar</a>
        on 2025-08-20 16:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adychar">@adychar</a> on 2025-08-20 16:48</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>for a uv project that has a different default index or extra indexes, it would be useful to be able to export a requirements.txt which also includes those indexes as supported by the pip documentation https://pip.pypa.io/en/stable/reference/requirements-file-format/?utm_source=chatgpt.com</p>
<h3>Example</h3>
<p>Given the following pyproject.toml</p>
<pre><code class="language-[project]">name = &quot;constraints&quot;
version = &quot;0.1.0&quot;
description = &quot;An example project&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
  &quot;requests&quot;
]

[[tool.uv.index]]
name = &quot;test&quot;
url = &quot;https://test.pypi.org/simple/&quot;
default = true

[[tool.uv.index]]
name = &quot;pytorch&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true
</code></pre>
<p>I would expect <code>uv export</code> or <code>uv export --include-indexes</code> to result in the following requirements.txt</p>
<pre><code># This file was autogenerated by uv via the following command:
#    uv export
--index-url https://test.pypi.org/simple/
--extra-index-url https://download.pytorch.org/whl/cu118

requests==2.5.4.1 \
    --hash=sha256:0a2c98e46121e7507afb0edc89d342641a1fb9e8d56f7d592d4975ee6b685f9a \
    --hash=sha256:b19df51fa3e52a2bd7fc80a1ac11fb6b2f51a7c0bf31ba9ff6b5d11ea8605ae9
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @adychar on 2025-08-20 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jorgehermo9">@jorgehermo9</a> on 2025-08-20 20:53</div>
            <div class="timeline-body"><p>I'm willing to contribute this!</p>
<p>Taking a look to the code, it seems that <code>uv export</code> exports the <code>uv.lock</code> file and not the <code>pyproject.toml</code> one. This means, in order to export the indexes in a <code>requirements.txt</code>, we need to either</p>
<ol>
<li>Include the <code>pyproject.toml</code> indexes in the <code>uv.lock</code> and then export it</li>
<li>read the <code>pyproject.toml</code> in addition to the <code>uv.lock</code> when exporting, to know the used indexes</li>
</ol>
<p>I'm not familiar with uv internals, but option 1 seems more doable, but I'm hesitant of adding a field to that lockfile just to export it to <code>requirements.txt</code> format.. I will appreciate an uv mantainer's opinion about this.</p>
<p>Another option would be to scan the <code>source</code> property of all packages in the <code>uv.lock</code> file</p>
<pre><code class="language-toml">[[package]]
name = &quot;requests&quot;
version = &quot;2.5.4.1&quot;
source = { registry = &quot;https://test.pypi.org/simple/&quot; }
sdist = { url = &quot;https://test-files.pythonhosted.org/packages/6e/93/638dbb5f2c1f4120edaad4f3d45ffb1718e463733ad07d68f59e042901d6/requests-2.5.4.1.tar.gz&quot;, hash = &quot;sha256:b19df51fa3e52a2bd7fc80a1ac11fb6b2f51a7c0bf31ba9ff6b5d11ea8605ae9&quot;, size = 448691, upload-time = &quot;2015-03-13T21:30:03.228Z&quot; }
wheels = [
    { url = &quot;https://test-files.pythonhosted.org/packages/6d/00/8ed1b6ea43b10bfe28d08e6af29fd6aa5d8dab5e45ead9394a6268a2d2ec/requests-2.5.4.1-py2.py3-none-any.whl&quot;, hash = &quot;sha256:0a2c98e46121e7507afb0edc89d342641a1fb9e8d56f7d592d4975ee6b685f9a&quot;, size = 468942, upload-time = &quot;2015-03-13T21:29:55.769Z&quot; },
]
</code></pre>
<p>But that way, we don't know if the index is a default index (<code>--index-url</code>) or an extra index (<code>--extra-index</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-21 12:55</div>
            <div class="timeline-body"><p>Thanks! I think this is a duplicate of #10008. The problem (which I mentioned there) is that we can't actually output to <code>requirements.txt</code> with full fidelity (i.e., the output would sometimes be wrong) because the format isn't powerful enough to represent explicit index pinning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-08-21 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adychar">@adychar</a> on 2025-08-21 14:15</div>
            <div class="timeline-body"><p>Thanks for the responses. And I understand the concern about the complete fidelity of the specific indexes. However, I don't need to pin each package to a specific index, I just need the new index's listed at the top of the requirements.txt.</p>
<p>The functionality (of the index listings) would be exactly the same as the index listings in <code>uv pip compile pyproject.toml --emit-index-url </code></p>
<p>The reason why I can't use that is because it generates the requirements.txt from the pyproject.toml and does not respect the lock file. As a result <code>uv sync</code> results in a different environment to that output in the generated requirements.txt file from <code>uv pip compile pyproject.toml --emit-index-url</code></p>
<p>Interestingly the example pyproject.toml above results in the following file (with uv export):</p>
<pre><code># This file was autogenerated by uv via the following command:
#    uv export
requests==2.15.1 \
    --hash=sha256:e5659b9315a0610505e050bb7190bf6fa2ccee1ac295f2b760ef9d8a03ebbb2e \
    --hash=sha256:ff753b2196cd18b1bbeddc9dcd5c864056599f7a7d9a4fb5677e723efa2b7fb9
    # via constraints
</code></pre>
<p>Which is non functioning without any index-url as that version of requests is not available on the default pypi server.</p>
<p>In Summary
-<code>uv export</code> doesn't work at all with alternate indexes</p>
<ul>
<li><code>uv pip compile pyproject.toml --emit-index-url</code> doesn't respect the versions in the uv.lock file</li>
</ul>
<p>so, currently I have to use a bash script to concatenate the indexes onto the front of the exported requirements.txt</p>
<p>Implementing the <code>--emit-index-url</code> option in <code>uv export</code> would at least give the above project example a change of finding the correct package. And given the option to match the hashes of the packages, this should result in an exact copy of the uv.lock environment.</p>
<p>Further more, if you are worried about the fidelity of the export, <code>uv pip compile pyproject.toml --emit-index-url</code> also doesn't respect any index pinning, such that the following pyproject.toml</p>
<pre><code>[project]
name = &quot;constraints&quot;
version = &quot;0.1.0&quot;
description = &quot;An example project&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
  &quot;requests&quot;
]

[tool.uv.sources]
requests = { index = &quot;pypi-default&quot; }

[[tool.uv.index]]
name = &quot;test&quot;
url = &quot;https://test.pypi.org/simple/&quot;
default = true

[[tool.uv.index]]
name = &quot;pypi-default&quot;
url = &quot;https://pypi.org/simple/&quot;
default = true
</code></pre>
<p>results in the following requirements.txt with <code>uv pip compile pyproject.toml &gt; requirements.txt</code></p>
<pre><code># This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml --emit-index-url
--index-url https://test.pypi.org/simple/

requests==2.15.1
    # via constraints (pyproject.toml)

</code></pre>
<p>which is also non-functioning as this version of requests is not available on the test.pypi.org index, yet the uv venv is fine.</p>
<p>Hopefully, these examples demonstrate the challenges i'm facing with a number of index issues included exporting environments when an internal index mirror is used.</p>
<p>I would urge you again to consider adding the <code>uv export --emit-index-url</code> option as it really would solve the majority of issues I'm having with uv.</p>
<p>Regards,</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
