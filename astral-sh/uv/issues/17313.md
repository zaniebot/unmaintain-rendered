```yaml
number: 17313
title: "Unexpected behavior with `sys_platform == 'linux' and platform_machine == 'x86_64'\"`"
type: issue
state: closed
author: collinanderson
labels:
  - bug
assignees: []
created_at: 2026-01-03T21:56:42Z
updated_at: 2026-01-05T15:37:08Z
url: https://github.com/astral-sh/uv/issues/17313
synced_at: 2026-01-10T01:57:37Z
```

# Unexpected behavior with `sys_platform == 'linux' and platform_machine == 'x86_64'"`

---

_Issue opened by @collinanderson on 2026-01-03 21:56_

### Summary

`uv add "ruff; sys_platform == 'linux' and platform_machine == 'x86_64'"` 

The `uv.lock` file looks like:
```
version = 1
revision = 3
requires-python = ">=3.13"

[[package]]
name = "ruff"
version = "0.14.10"
source = { registry = "https://pypi.org/simple" }
sdist = { ... }
wheels = [
    { url = "https://.../ruff-0.14.10-py3-none-linux_armv6l.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-manylinux_2_17_armv7l.manylinux2014_armv7l.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-manylinux_2_17_ppc64.manylinux2014_ppc64.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-manylinux_2_17_s390x.manylinux2014_s390x.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-manylinux_2_31_riscv64.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-musllinux_1_2_armv7l.whl", ... },
    { url = "https://.../ruff-0.14.10-py3-none-musllinux_1_2_x86_64.whl", ... },
]

[[package]]
name = "tmp"
version = "0.1.0"
source = { virtual = "." }
dependencies = [
    { name = "ruff", marker = "platform_machine == 'x86_64' and sys_platform == 'linux'" },
]

[package.metadata]
requires-dist = [{ name = "ruff", marker = "platform_machine == 'x86_64' and sys_platform == 'linux'", specifier = ">=0.14.10" }]
```

I'd expect most of those wheels not to be included in the lock file, but `uv` seems to treat `platform_machine` as simply 32bit vs 64bit rather than actual platform machine?

`tool.uv.environments` has the same issue:
```
[tool.uv]
environments = ["platform_machine == 'x86_64' and sys_platform == 'linux'"]
```
uv.lock:
```
version = 1
revision = 3
requires-python = ">=3.13"
resolution-markers = [
    "platform_machine == 'x86_64' and sys_platform == 'linux'",
]
supported-markers = [
    "platform_machine == 'x86_64' and sys_platform == 'linux'",
]

[[package]]
name = "ruff"
version = "0.14.10"
source = { registry = "https://pypi.org/simple" }
sdist = { ... }
wheels = [
...ruff-0.14.10-py3-none-linux_armv6l.whl"...
...linux_armv6l.whl"...
...armv7l.manylinux2014_armv7l.whl"...
...ppc64.manylinux2014_ppc64.whl"...
...ppc64le.manylinux2014_ppc64le.whl"...
...s390x.manylinux2014_s390x.whl"...
...riscv64.whl"...
...armv7l.whl"...
```

This is possibly related to #15060 (which said to open a new issue if not handled by `tool.uv.environments`) or the "windows" amd64 issue #16576. 

### Platform

Linux 6.8.0-90-generic x86_64 GNU/Linux

### Version

uv 0.9.21

### Python version

Python 3.13.3

---

_Label `bug` added by @collinanderson on 2026-01-03 21:56_

---

_Comment by @collinanderson on 2026-01-03 22:02_

I errored on the side of opening a new issue, but looking at  #15060 more closely I think it is the same thing and I mis-read the comment about opening a new issue if not handled by `tool.uv.environments`. I'll comment there instead.

---

_Referenced in [astral-sh/uv#15060](../../astral-sh/uv/issues/15060.md) on 2026-01-03 22:10_

---

_Comment by @charliermarsh on 2026-01-04 18:50_

I think we just don't narrow on those other platforms.

---

_Assigned to @charliermarsh by @charliermarsh on 2026-01-04 18:51_

---

_Referenced in [astral-sh/uv#17317](../../astral-sh/uv/pulls/17317.md) on 2026-01-04 19:01_

---

_Closed by @charliermarsh on 2026-01-05 15:25_

---

_Comment by @collinanderson on 2026-01-05 15:37_

Thanks!

---
