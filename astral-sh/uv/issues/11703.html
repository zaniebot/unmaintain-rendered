<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv cache prune --ci` leads to error: Failed to generate package metadata - astral-sh/uv #11703</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv cache prune --ci</code> leads to error: Failed to generate package metadata</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11703">#11703</a>
        opened by <a href="https://github.com/andersk">@andersk</a>
        on 2025-02-22 01:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andersk">@andersk</a></div>
            <div class="timeline-body">Summary
<pre><code>$ uv init
Initialized project `test`
$ uv add &#x27;https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip&#x27;
Using CPython 3.12.3 interpreter at: /usr/bin/python3.12
Creating virtual environment at: .venv
Resolved 11 packages in 1.29s
      Built zulip @ https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip
Prepared 9 packages in 953ms
Installed 9 packages in 84ms
 + certifi==2025.1.31
 + charset-normalizer==3.4.1
 + click==8.1.8
 + distro==1.9.0
 + idna==3.10
 + requests==2.32.3
 + typing-extensions==4.12.2
 + urllib3==2.3.0
 + zulip==0.9.0 (from https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip)
$ uv cache prune --ci
Pruning cache at: /root/.cache/uv
Removed 2110 files (15.7MiB)
$ uv sync
error: Failed to generate package metadata for `zulip==0.9.0 @ direct+https://github.com/zulip/python-zulip-api/archive/0.9.0.zip`
  Caused by: The source distribution `https://github.com/zulip/python-zulip-api/archive/0.9.0.zip#subdirectory=zulip` has no subdirectory `zulip`
</code></pre>
<p>This may be a bug in <code>uv cache prune --ci</code>, but additionally, I would expect uv to automatically recover from any partial deletion of <code>~/.cache/uv</code> since itâ€™s marked with <a href="https://bford.info/cachedir/"><code>CACHEDIR.TAG</code></a>.</p>
Platform
<p>Ubuntu 24.04 amd64</p>
Version
<p>uv 0.6.2</p>
Python version
<p>Python 3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/andersk">@andersk</a> on 2025-02-22 01:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Deleting part of ~/.cache/uv leads to error: Failed to generate package metadata&quot; to &quot;`uv cache prune --ci` leads to error: Failed to generate package metadata&quot; by <a href="https://github.com/andersk">@andersk</a> on 2025-02-22 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-22 04:40</div>
            <div class="timeline-body"><p>Definitely a bug, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-22 22:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-23 00:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-23 00:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:26 UTC
    </footer>
</body>
</html>
