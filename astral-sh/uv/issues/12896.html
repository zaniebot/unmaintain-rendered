<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should I run uv lock or uv sync before uv build? - astral-sh/uv #12896</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should I run uv lock or uv sync before uv build?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12896">#12896</a>
        opened by <a href="https://github.com/Gabriel-p">@Gabriel-p</a>
        on 2025-04-15 12:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Gabriel-p">@Gabriel-p</a> on 2025-04-15 12:19</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I have a project that I work on on different systems. My workflow for setting up a new environment is:</p>
<ol>
<li>Copy <code>pyproject.toml</code> and <code>.python-version</code> files from a previous system</li>
<li>Generate the environment and install the required packages via:</li>
</ol>
<pre><code>$ uv venv
$ uv sync
</code></pre>
<p>This handles creating the <code>uv.lock</code> file that looks like:</p>
<pre><code>version = 1
revision = 1
requires-python = &quot;&gt;=3.11.11&quot;

[[package]]
name = &quot;asteca&quot;
version = &quot;0.5.7.dev0&quot;
source = { editable = &quot;.&quot; }
dependencies = [
    { name = &quot;astropy&quot; },
    { name = &quot;fast-histogram&quot; },
    { name = &quot;numpy&quot; },
    { name = &quot;scipy&quot; },
]
...
</code></pre>
<p>The issue is that the version in the <code>uv.lock</code> file is inherited from the  <code>pyproject.toml</code> file, and that version usually looks like <code>0.5.7-dev</code> (a <code>0</code> is added in the <code>uv.lock</code> file version by <code>uv sync</code> I guess?). The <code>dev</code> is there to indicate that this is a version &quot;in development&quot;.</p>
<p>When I want to publish the finished version, I update the version in the <code>pyproject.toml</code> file to e.g. <code>0.5.7</code>, i.e. removing the <code>dev</code>. Here's what I don't understand because if I then go directly to <code>uv build</code> and <code>uv publish</code>, the <code>uv.lock</code> file will still show the <code>0.5.7-dev</code> inside because it was never updated.</p>
<p>Should I run <code>uv sync</code> or <code>uv lock</code> before building, to update the <code>uv.lock</code> file? How should I properly handle this?</p>
<h3>Platform</h3>
<p>elementary OS 8</p>
<h3>Version</h3>
<p>0.6.6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @Gabriel-p on 2025-04-15 12:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-15 12:44</div>
            <div class="timeline-body"><p>Package building with <code>uv build</code> and project syncing with <code>uv sync</code> are currently independent of each other. <code>uv build</code> builds the package in isolation and does not consider <code>uv.lock</code> (this is something that is expected to change in the future, where we want to lock the build dependencies, too). <code>uv publish</code> also does not read <code>uv.lock</code>, but only the built files, so <code>uv build &amp;&amp; uv publish</code> works even with an outdated lockfile; you can even use <code>uv build</code> on a project that otherwise doesn't uv at all and doesn't have a <code>uv.lock</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-15 12:47</div>
            <div class="timeline-body"><p>üëç Yeah it's not necessary. <code>uv build</code> doesn't actually know anything about the lockfile, since it's just building your own code and then including a list of the dependencies (as defined in your <code>pyproject.toml</code> or elsewhere), following the Python standards.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-15 12:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gabriel-p">@Gabriel-p</a> on 2025-04-15 12:54</div>
            <div class="timeline-body"><p>Bau the <code>.tar.gz</code> file generated by <code>uv build</code> includes the <code>uv.lock</code> file. Does this not mess with <code>uv publish</code> later on? Will it not mess up the version in Pypi?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-15 12:57</div>
            <div class="timeline-body"><p>No, it won't be used in either of those places. It's just like another file in the source code. You could even configure your build backend (setuptools or similar) to omit it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gabriel-p">@Gabriel-p</a> on 2025-04-15 12:58</div>
            <div class="timeline-body"><p>(Last question and I won't bother you anymore I swear)</p>
<p>So does the version number of my package in the <code>uv.lock</code> file serve any purpose or is it completely useless?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:04 UTC
    </footer>
</body>
</html>
