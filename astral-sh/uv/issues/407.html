<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Injecting a python version when building source distributions - astral-sh/uv #407</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Injecting a python version when building source distributions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/407">#407</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-11-13 09:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2023-11-13 09:49</div>
            <div class="timeline-body"><p>When resolving packages, we allow setting a python version that is not the one in the current venv when resolving, e.g. <code>target/debug/puffin pip-compile --python-version py39</code>. We will select everything as if we were on that python version. This however doesn't really work anymore when building source distribution because a PEP 517 (and setup.py too) need a <code>sys.executable</code> that will necessarily be the local version.</p>
<p>Possible options:</p>
<ul>
<li>Build the source distribution with the real python version, pick the wheel with the local python version tag (even if it mismatches the faked environment), assume that wheels built for different python versions have the same metadata (this is a somewhat necessary assumption anyway, without it a sane reusable resolution becomes all but impossible). We would keep two environments around, the main fake one and the secondary real one.</li>
<li>Provision the fake python from python-build-standalone for builds, making it a real python.</li>
<li>Ban source distribution builds when <code>--python-version</code> is set.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/398.html">astral-sh/uv#398</a> on 2023-11-13 10:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-13 14:34</div>
            <div class="timeline-body"><p>I think I want Option (1).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-11-13 14:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Feature complete" by @charliermarsh on 2023-11-13 14:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-13 14:34</div>
            <div class="timeline-body"><p>But I can't tell if what's implemented in #398 is Option (1).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-11-13 15:34</div>
            <div class="timeline-body"><p>I think it's broken on both main and #398 atm, this is a separate task to implement</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-11-29 15:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/532.html">astral-sh/uv#532</a> on 2023-12-04 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2023-12-04 10:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:19 UTC
    </footer>
</body>
</html>
