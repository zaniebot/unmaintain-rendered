<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv cache prune` causes self update to fail - astral-sh/uv #6417</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv cache prune</code> causes self update to fail</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6417">#6417</a>
        opened by <a href="https://github.com/weihenglim">@weihenglim</a>
        on 2024-08-22 09:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/weihenglim">@weihenglim</a></div>
            <div class="timeline-body"><p>On Windows, running <code>uv cache prune</code> removes <code>uv-receipt.json</code> from the cache, which leads to <code>uv</code> being unable to self update:</p>
<pre><code class="language-cmd">&gt;uv cache prune -v
DEBUG uv 0.3.0
Pruning cache at: C:\Users\User\AppData\Local\uv
DEBUG Removing dangling cache entry: C:\Users\User\AppData\Local\uv\uv-receipt.json
Removed 1 file (253B)

&gt;uv self update -v
DEBUG uv 0.3.0
DEBUG no receipt found; assuming uv was installed via a package manager
warning: Self-update is only available for uv binaries installed via the standalone installation scripts.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-08-22 10:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @konstin on 2024-08-22 10:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 12:29</div>
            <div class="timeline-body"><p>Ohh, thanks. That's interesting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-22 12:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 13:09</div>
            <div class="timeline-body"><p>Did you move the cache at all? I think the cache by default is at <code>C:\Users\User\AppData\Local\uv\cache</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/weihenglim">@weihenglim</a> on 2024-08-22 13:16</div>
            <div class="timeline-body"><p>No, nothing was configured. Just tested a fresh install on another Windows 11 machine and the cache directory defaults to <code>AppData\Local\uv</code> as well.</p>
<pre><code class="language-cmd">&gt;powershell -c &quot;irm https://astral.sh/uv/install.ps1 | iex&quot;
Downloading uv 0.3.1 (x86_64-pc-windows-msvc)
Installing to C:\Users\Admin\.cargo\bin
  uv.exe
  uvx.exe
everything's installed!

&gt;uv cache dir -v
DEBUG uv 0.3.1
C:\Users\Admin\AppData\Local\uv
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 13:19</div>
            <div class="timeline-body"><p>Ahh sorry, I think the cache directory changed slightly in v0.3.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 13:20</div>
            <div class="timeline-body"><p>(But in a backwards-compatible way, so my machine was still using the previous location.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/weihenglim">@weihenglim</a> on 2024-08-22 13:27</div>
            <div class="timeline-body"><p>As a temporary workaround, manually moving all the files (except <code>uv-receipt.json</code>) to <code>AppData\Local\uv\cache</code> seems to fix the issue (and <code>uv cache dir</code> properly detects the new cache location)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 17:03</div>
            <div class="timeline-body"><p>Yeah, that makes sense. Will fix though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-23 02:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-23 02:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:21 UTC
    </footer>
</body>
</html>
