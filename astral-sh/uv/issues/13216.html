<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using UV_EXTRA_INDEX_URL fails in 0.7, regression from 0.6.17 - astral-sh/uv #13216</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using UV_EXTRA_INDEX_URL fails in 0.7, regression from 0.6.17</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13216">#13216</a>
        opened by <a href="https://github.com/brynmathias">@brynmathias</a>
        on 2025-04-30 08:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/brynmathias">@brynmathias</a></div>
            <div class="timeline-body">Summary
<p>I have an internal facing repository configured with:
UV_EXTRA_INDEX_URL=....</p>
<p>this index doesn&#x27;t mirror the pypi.org repository</p>
<p>When I try to install packages with UV 0.7 I get an error with &quot;package not found&quot; for packages that don&#x27;t exist in our index, which is correct
However this error should be ignored by default and the next index checked</p>
<p>this can be fixed by explicitly adding the extra index in the <code>pyproject.toml</code>
with the flag
ignore-error-codes = [401]</p>
<p>I would propose that for the env var UV_EXTRA_INDEX_URL that the ignore codes are set to sensible defaults, rather than having to manually configure the repository</p>
Platform
<p>macOS, linux build pipelines etc</p>
Version
<p>uv 0.7</p>
Python version
<p>3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/brynmathias">@brynmathias</a> on 2025-04-30 08:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/juhaszp95">@juhaszp95</a> on 2025-04-30 08:34</div>
            <div class="timeline-body"><p>Just flagging my related comment <a href="https://github.com/astral-sh/uv/pull/12805#issuecomment-2841198133">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-30 08:38</div>
            <div class="timeline-body"><p>Does this internal-facing index require authentication?</p>
<p>The reason we no longer ignore 401s is because this is not a secure by default approach to dependency confusion attacks. Imagine a user is looking for a package in the private index (whether specified in <code>pyproject.toml</code> or via a command line argument) and there is a malicious package with the same name on PyPI. An authentication failure does not actually tell us that the package is not present in the private index. In effect, if we fall through on 401s, the fact that the private index was secured by authentication has made the user more vulnerable to dependency confusion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brynmathias">@brynmathias</a> on 2025-04-30 08:51</div>
            <div class="timeline-body"><p>I understand the point @jtfmumm
What I think is happening is as follows:</p>
<ol>
<li>We auth with the repo and check for the package</li>
<li>The public package isn&#x27;t found in the private repo</li>
<li>we retry, but without creds (or we hit the jfrog rate limit for logging in)</li>
<li>We then receive a 401</li>
<li>install fails</li>
</ol>
<p>So we need to do something to counter this behaviour, either a wait time between retries from the private index, or we skip it after the initial 404 and move on to the next index and try that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brynmathias">@brynmathias</a> on 2025-04-30 08:53</div>
            <div class="timeline-body"><p>and yes the internal index requires authentication</p>
<p>the specific example I am seeing is:
Internal index -- Non mirroring, hosts 2 packages we need
PyPi -- hosts everything other than the internal packages</p>
<p>UV sync tries to install setup tools, looks in the internal index and doesn&#x27;t find it, tries again. First try we get a 404, second try we get a 401.
The 404 gets retried on the internal index, the 401 is raised by the index server on the second try</p>
<p>install fails</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-30 08:59</div>
            <div class="timeline-body"><p>Thanks for the context. I can investigate this. I would have expected the initial 404 to lead uv to fall through. Would you mind sharing the trace (<code>-vv</code>) logs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/jtfmumm">@jtfmumm</a> by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-30 09:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jesusfbes">@jesusfbes</a> on 2025-04-30 09:24</div>
            <div class="timeline-body"><p>I have a similar error when using uv in a Azure Pipeline to get a package from azure feed. Going back to previous version works.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brynmathias">@brynmathias</a> on 2025-04-30 09:24</div>
            <div class="timeline-body"><pre><code>TRACE No credentials in cache for URL https://ANON_ORG.jfrog.io/
DEBUG No netrc file found
TRACE Considering retry of error: Error { kind: WrappedReqwestError(Url { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;ANON_ORG.jfrog.io&quot;)), port: None, path: &quot;/setuptools/&quot;, query: None, fragment: None }, WrappedReqwestError(Reqwest(reqwest::Error { kind: Status(404), url: &quot;https://ANON_ORG.jfrog.io/setuptools/&quot; }))) }
TRACE Cannot retry error: not an IO error
TRACE Fetching metadata for setuptools from https://ANON_USER%40ANON_ORG.ai:[scrubbed]@ANON_ORG.jfrog.io/artifactory/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE idle interval checking for expired
TRACE No cache entry exists for /Users/ANON_USER/.cache/uv/simple-v15/index/c542f1043ba3dc97/setuptools.rkyv
DEBUG No cache entry for: https://ANON_ORG.jfrog.io/artifactory/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE Sending fresh GET request for https://ANON_ORG.jfrog.io/artifactory/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE Handling request for https://ANON_USER%40ANON_ORG.ai:****@ANON_ORG.jfrog.io/artifactory/api/pypi/ANON_ORG-no-pypi/simple/setuptools/ with authentication policy auto
TRACE Request for https://ANON_USER%40ANON_ORG.ai:****@ANON_ORG.jfrog.io/artifactory/api/pypi/ANON_ORG-no-pypi/simple/setuptools/ already contains username and password
TRACE take? (&quot;https&quot;, ANON_ORG.jfrog.io): expiration = Some(90s)
DEBUG reuse idle connection for (&quot;https&quot;, ANON_ORG.jfrog.io)
TRACE Considering retry of error: Error { kind: WrappedReqwestError(Url { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;ANON_ORG.jfrog.io&quot;)), port: None, path: &quot;/artifactory/api/pypi/ANON_ORG-no-pypi/simple/setuptools/&quot;, query: None, fragment: None }, WrappedReqwestError(Reqwest(reqwest::Error { kind: Status(404), url: &quot;https://ANON_ORG.jfrog.io/artifactory/api/pypi/ANON_ORG-no-pypi/simple/setuptools/&quot; }))) }
TRACE Cannot retry error: not an IO error
TRACE Fetching metadata for setuptools from https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE put; add idle connection for (&quot;https&quot;, ANON_ORG.jfrog.io)
DEBUG pooling idle connection for (&quot;https&quot;, ANON_ORG.jfrog.io)
TRACE No cache entry exists for /Users/ANON_USER/.cache/uv/simple-v15/index/eb4ee5ea165afeaf/setuptools.rkyv
DEBUG No cache entry for: https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE Sending fresh GET request for https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE Handling request for https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/ with authentication policy auto
TRACE Request for https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE Attempting unauthenticated request for https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/
TRACE take? (&quot;https&quot;, ANON_ORG.jfrog.io): expiration = Some(90s)
DEBUG reuse idle connection for (&quot;https&quot;, ANON_ORG.jfrog.io)
TRACE put; add idle connection for (&quot;https&quot;, ANON_ORG.jfrog.io)
DEBUG pooling idle connection for (&quot;https&quot;, ANON_ORG.jfrog.io)
TRACE Request for https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/ failed with 401 Unauthorized, checking for credentials
TRACE No credentials in cache for URL https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple
TRACE Considering retry of error: Error { kind: WrappedReqwestError(Url { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;ANON_ORG.jfrog.io&quot;)), port: None, path: &quot;/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/&quot;, query: None, fragment: None }, WrappedReqwestError(Reqwest(reqwest::Error { kind: Status(401), url: &quot;https://ANON_ORG.jfrog.io/ANON_ORG/api/pypi/ANON_ORG-no-pypi/simple/setuptools/&quot; }))) }
TRACE Cannot retry error: not an IO error
DEBUG Indexes search failed because of status code failure: 401 Unauthorized
TRACE Received package metadata for: setuptools
DEBUG Searching for a compatible version of setuptools (*)
TRACE Selecting candidate for setuptools with range * with 0 remote versions
DEBUG No compatible version found for: setuptools```
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brynmathias">@brynmathias</a> on 2025-04-30 09:24</div>
            <div class="timeline-body"><p>That&#x27;s what I&#x27;ve got at the moment, getting one of our devs to grab me full logs @jtfmumm</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-30 10:56</div>
            <div class="timeline-body"><p>I&#x27;m having trouble reproducing this. Would you mind including the relevant sections of your <code>pyproject.toml</code> file and the command you are running that triggers this? And how are you providing credentials for your private index?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jc-5s">@jc-5s</a> on 2025-04-30 11:32</div>
            <div class="timeline-body"><p>just wanted to note that we are experiencing the same issue.</p>
<p>we pass credentials to uv on the cmd line using --extra-index-url i.e.
pip uv install --extra-index-url https://username:password@url ...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-30 12:35</div>
            <div class="timeline-body"><blockquote>
<p>just wanted to note that we are experiencing the same issue.</p>
<p>we pass credentials to uv on the cmd line using --extra-index-url i.e. pip uv install --extra-index-url https://username:password@url ...</p>
</blockquote>
<p>Thanks. Would you mind sharing some more details? Which index are you using? How have you configured pyproject.toml? And could you share the trace logs (‘-vv’)?</p>
<p>I’m still unable to reproduce</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/constantinevitt">@constantinevitt</a> on 2025-04-30 12:42</div>
            <div class="timeline-body"><p>I have a similar problem. I have a private pypi server with fallback to the official pypi and with uv version 0.7.0 it stopped being able to find packages not hosted on the private server. I thought I could use <code>ignore-error-codes = [302]</code> but that doesn&#x27;t work either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-30 12:44</div>
            <div class="timeline-body"><blockquote>
<p>I have a similar problem. I have a private pypi server with fallback to the official pypi and with uv version 0.7.0 it stopped being able to find packages not hosted on the private server. I thought I could use <code>ignore-error-codes = [302]</code> but that doesn&#x27;t work either.</p>
</blockquote>
<p>Is that fixed with 0.7.1? I don’t think it’s related to this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-04-30 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wep21">@wep21</a> on 2025-05-01 01:04</div>
            <div class="timeline-body"><p>I&#x27;ve encountered the same problem. I&#x27;ve also tried 0.7.1, but it returns 403.</p>
<pre><code>No solution found when resolving dependencies:
  ╰─▶ Because aaa was not found in the package registry and you require aaa, we can conclude that your
      requirements are unsatisfiable.

      hint: An index URL (https://pypi.aaa.dev/) could not be queried due to a lack of valid authentication credentials
      (403 Forbidden).
</code></pre>
<p>I&#x27;m currently using username/password url.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-05-01 07:08</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;ve encountered the same problem. I&#x27;ve also tried 0.7.1, but it returns 403.</p>
<pre><code>No solution found when resolving dependencies:
  ╰─▶ Because aaa was not found in the package registry and you require aaa, we can conclude that your
      requirements are unsatisfiable.

      hint: An index URL (https://pypi.aaa.dev/) could not be queried due to a lack of valid authentication credentials
      (403 Forbidden).
</code></pre>
<p>I&#x27;m currently using username/password url.</p>
</blockquote>
<p>That sounds like a distinct problem to me. Would you mind sharing your trace logs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wep21">@wep21</a> on 2025-05-01 07:19</div>
            <div class="timeline-body"><p>Here is the trace log.</p>
<pre><code>DEBUG uv 0.7.1 (Homebrew 2025-04-30)
DEBUG Searching for default Python interpreter in virtual environments
TRACE Cached interpreter info for Python 3.12.9, skipping probing: .venv/bin/python3
DEBUG Found `cpython-3.12.9-macos-aarch64-none` at `/Users/daisuke/workspace/patron-rating-viewer/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.12.9 environment at: .venv
TRACE Checking lock for `.venv` at `.venv/.lock`
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: aaa
TRACE Caching credentials for https://username:password@pypi.aaa.dev/
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.9
DEBUG Solving with target Python version: &gt;=3.12.9
TRACE Assigned packages: 
TRACE Chose package for decision: root. remaining choices: 
DEBUG Adding direct dependency: aaa*
TRACE Assigned packages: root==0a0.dev0
TRACE Chose package for decision: aaa. remaining choices: 
TRACE Fetching metadata for aaa from https://username:password@pypi.aaa.dev/aaa/
TRACE Cached request https://pypi.aaa.dev/aaa/ is storable because its response has a heuristically cacheable status code 200
TRACE Could not determine freshness lifetime, assuming none exists
TRACE Cached request https://pypi.aaa.dev/aaa/ has a cached response that does not allow staleness
TRACE Request https://pypi.aaa.dev/aaa/ does not have a fresh cache because its age is 671436 seconds, it is greater than the freshness lifetime of 0 seconds and stale cached responses are not allowed
DEBUG Found stale response for: https://pypi.aaa.dev/aaa/
DEBUG Sending revalidation request for: https://pypi.aaa.dev/aaa/
TRACE Handling request for https://username:****@pypi.aaa.dev/aaa/ with authentication policy auto
TRACE Request for https://username:****@pypi.aaa.dev/aaa/ already contains username and password
TRACE Considering retry of error: Error { kind: WrappedReqwestError(Url { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;pypi.aaa.dev&quot;)), port: None, path: &quot;/aaa/&quot;, query: None, fragment: None }, WrappedReqwestError(Reqwest(reqwest::Error { kind: Status(403), url: &quot;https://pypi.aaa.dev/simple/aaa/&quot; }))) }
TRACE Cannot retry error: not an IO error
DEBUG Indexes search failed because of status code failure: 403 Forbidden
TRACE Received package metadata for: aaa
DEBUG Searching for a compatible version of aaa (*)
TRACE Selecting candidate for aaa with range * with 0 remote versions
DEBUG No compatible version found for: aaa
TRACE Resolver derivation tree before reduction
term root==0a0.dev0
  root==0a0.dev0 depends on aaa*
  aaa not found in the package registry
TRACE Resolver derivation tree after reduction
term root==0a0.dev0
  root==0a0.dev0 depends on aaa*
  aaa not found in the package registry
  × No solution found when resolving dependencies:
  ╰─▶ Because aaa was not found in the package registry and you require aaa, we can conclude that your requirements are
      unsatisfiable.

      hint: An index URL (https://pypi.aaa.dev/) could not be queried due to a lack of valid authentication credentials
      (403 Forbidden).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtfmumm">@jtfmumm</a> on 2025-05-01 07:49</div>
            <div class="timeline-body"><p>@wep21 Thanks! This looks like a separate issue. Would you mind opening one so we can explore further?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wep21">@wep21</a> on 2025-05-01 08:01</div>
            <div class="timeline-body"><p>@jtfmumm I&#x27;m sorry, this is my fault. When debugging pixi 0.7.0, I&#x27;ve mistakenly removed auth user from pypi server. It works fine with pixi 0.7.1 after adding auth user.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/constantinevitt">@constantinevitt</a> on 2025-05-01 15:04</div>
            <div class="timeline-body"><blockquote>
<p>Is that fixed with 0.7.1? I don’t think it’s related to this</p>
</blockquote>
<p>Indeed, it is fixed in 0.7.1. Thank you for the quick reply.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ScottWilliamAnderson">@ScottWilliamAnderson</a> on 2025-05-13 15:52</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Is that fixed with 0.7.1? I don’t think it’s related to this</p>
</blockquote>
<p>Indeed, it is fixed in 0.7.1. Thank you for the quick reply.</p>
</blockquote>
<p>Should this be marked as resolved? or @brynmathias are you still experiencing the issue at the moment with uv &gt; 0.7.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/valentinoli">@valentinoli</a> on 2025-06-13 20:43</div>
            <div class="timeline-body"><p>This is still a problem when authenticating to Azure Artifacts. I keep getting errors in <code>uv==0.7.13</code> like the following when installing packages and having a private index URL configured. It works with <code>uv==0.6.*</code></p>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because ruff was not found in the package registry and you require
      ruff==0.11.0, we can conclude that your requirements are unsatisfiable.

      hint: An index URL
      (https://pkgs.dev.azure.com/[**REDACTED**]/[**REDACTED**]/_packaging/[**REDACTED**]/pypi/simple/)
      could not be queried due to a lack of valid authentication credentials
      (401 Unauthorized).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-13 20:48</div>
            <div class="timeline-body"><p>Are you sure that the authentication is actually working on prior uv versions? Or is it just falling through to PyPI? We&#x27;d need to see trace (<code>-vv</code>) logs to help you out here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/valentinoli">@valentinoli</a> on 2025-06-15 20:10</div>
            <div class="timeline-body"><p>@charliermarsh I revisited this and found out it was my fault, I did not configure the auth token. Sorry for the false alarm.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-16 00:37</div>
            <div class="timeline-body"><p>Thanks for following up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-16 00:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-16 00:39</div>
            <div class="timeline-body"><p>(to the OP: if your problem persists and you can get full logs, please let us know and we can help. I think these cases are mostly part of the intentional security change in 0.7)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:25 UTC
    </footer>
</body>
</html>
