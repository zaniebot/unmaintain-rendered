<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remember previous lock options when running `uv sync` - astral-sh/uv #6001</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Remember previous lock options when running <code>uv sync</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6001">#6001</a>
        opened by <a href="https://github.com/nikhilweee">@nikhilweee</a>
        on 2024-08-11 03:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nikhilweee">@nikhilweee</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p><strong>Problem Description</strong></p>
<p><code>uv sync</code>, by itself, does not install optional dependencies. Which is fine, I believe it's how it should be.</p>
<p>But let's say I am running <code>uv sync</code> for the first time. I wish to include two extras, <code>extra1</code> and <code>extra2</code>. I run the following:</p>
<pre><code>uv sync --extra extra1 --extra extra2
</code></pre>
<p>Great. Now I have the package with extras installed. But what about subsequent syncs?</p>
<p><strong>Suggestion</strong></p>
<p>One argument is to remember the two extras (and other lock options) from before, and use them as the new defaults. In other words, subsequent syncs should imply <code>--extra extra1 --extra extra2</code>. If an extra argument is provided explicitly during sync, these new extras should override the defaults. I believe this is how it currently works in <code>rye</code> and <code>pdm</code>. Those tools store lock options in their lockfiles.</p>
<p>The PDM lockfile has a metadata section which stores these implicit extras</p>
<pre><code class="language-toml">[metadata]
groups = [&quot;extra1&quot;, &quot;extra2&quot;]
</code></pre>
<p>Similarly, Rye stores these implicit extras in its lockfile</p>
<pre><code># last locked with the following flags:
#   features: [&quot;extra1&quot;, &quot;extra2&quot;]
</code></pre>
<p>AFAIK I don't think UV stores lock options in its lockfile. Should we think about remembering previous lock options?</p>
<p><strong>Related</strong></p>
<p>I am aware that that <a href="https://peps.python.org/pep-0751/">PEP-751</a> is under discussion and from a brief glance I'm not sure if package managers will be able to store any kind of metadata in there. That said, it's still a draft and maybe we can bring this up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-11 14:55</div>
            <div class="timeline-body"><p>The discussion at https://github.com/astral-sh/uv/issues/4730 may be helpful</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nikhilweee">@nikhilweee</a> on 2024-08-11 17:09</div>
            <div class="timeline-body"><p>Thanks for the pointer @zanieb, I think the following comment comes close to capturing the gist of this issue.</p>
<p>https://github.com/astral-sh/uv/issues/4730#issuecomment-2203338364</p>
<blockquote>
<p>The huge drawback here: Modulo default-{packages,extras,command}, you have to specify all arguments in every uv run every time.</p>
</blockquote>
<p>I'd also like to add that remembering lockfile options would make it easy for users switching from other package managers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-11 18:51</div>
            <div class="timeline-body"><p>To clarify one thing, the extras have no impact on the lockfile -- we lock for all extras at once. <code>uv lock</code> doesn't even accept extras as an argument :) The extras only impact the installation phase (which subset of packages should we install), not the locking phase (which packages should we include when resolving). This is different from Rye which can't produce a lockfile that supports switching out extras at install-time, so has to encode them like that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-08-11 18:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nikhilweee">@nikhilweee</a> on 2024-08-20 16:10</div>
            <div class="timeline-body"><p>Ah, sorry my understanding of uv internals is not the best. That said, the spirit of this issue is to remember previous lock options when running <code>uv install</code>. If this is something of interest, I'm sure the implementation details can be discussed further.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> removed by @zanieb on 2024-08-20 18:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:05 UTC
    </footer>
</body>
</html>
