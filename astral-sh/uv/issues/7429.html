<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Best practices for `requires-python`  - astral-sh/uv #7429</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Best practices for <code>requires-python</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/7429">#7429</a>
        opened by <a href="https://github.com/TheRealBecks">@TheRealBecks</a>
        on 2024-09-16 14:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TheRealBecks">@TheRealBecks</a></div>
            <div class="timeline-body"><p>I had some thoughts about version handling and documentation in #7352, but that was out of scope, so I created this issue.</p>
<ul>
<li>~I used the wrong version identifier in the first place which resulted to <code>3.12.0</code>~ -&gt; #7426</li>
<li>I did not expect <code>uv</code> to be stuck at <code>3.12.0</code> when defining <code>requires-python = &quot;==3.12&quot;</code> and changing it to <code>~=3.12</code></li>
<li>I think it&#x27;s best to change the identifier in the documentation to <code>~=3.12</code> (or <code>==3.12.*</code>?) and describing what that means instead of using <code>&gt;=3.12</code> which could lead to <code>3.13.x</code></li>
<li>Maybe pointing the interested user in a notice field to the <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/"><code>Version specifier</code></a> documentation?</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 14:29</div>
            <div class="timeline-body"><p>Using <code>&gt;=3.12</code> is best practice for <code>requires-python</code> — it&#x27;s generally not great to add upper version pins to the Python requirement of the project. Instead, you should use <code>uv python pin 3.12</code> to pin the version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/edmorley">@edmorley</a> on 2024-09-16 20:56</div>
            <div class="timeline-body"><p>@zanieb So this actually overlaps with a topic that affects us quite a bit (both in general, and it&#x27;s also come up again with the recent addition of Poetry support).</p>
<p>For libraries (or tools/software that is going to be distributed to a variety of end-user machines that needs to support multiple Python versions, such as CLIs, ...) supporting a range of Python versions in <code>requires-python</code> absolutely makes sense.</p>
<p>However, there are a large number of projects (and I would posit a much larger group than the library/... case), for which the project only needs to support, and will likely only ever be capable of supporting (due to lack of CI coverage of all Python versions in a CI matrix), a single major Python version.</p>
<p>For example, when deploying a Django app to a PaaS, the build system needs to pick a single version of Python for the project to install into the container and use to boot the app at launch.</p>
<p>But what version should be picked if there is no <code>.python-version</code> file, and the <code>requires-python</code> field contains say <code>&gt;=3.8</code>? Do we:</p>
<ol>
<li>Always pick the latest GA Python (3.12)? However, that&#x27;s not ideal, since the app could break when Python 3.13 is released.</li>
<li>On the first build, pick the current GA Python (3.12), store that in the per-app build cache, and then forever use the same major Python version with that app? However, that&#x27;s not ideal, since it&#x27;s hidden state/magic (ie: requires more explanation when the version reaches EOL and you have to tell the user to change a version they didn&#x27;t even pick/set), and means inconsistency between local development, review apps, staging app and production apps, given state isn&#x27;t shared.</li>
<li>Pick the lowest Python in the range (so 3.8)? However, that&#x27;s still not ideal, since it&#x27;s likely an old Python (particularly since people unlikely to remember to bump <code>requires-python</code> over time).</li>
<li>Fail the build until they add a <code>.python-version</code> file. However, errors aren&#x27;t ideal for an onboarding experience.</li>
</ol>
<p>Plus for all of the above apart from (4), there is no guarantee that the Python version picked by the build system will match the end users machine - or even that two developers from the same team are using the same Python version. This then leads to &quot;well it works for me locally, but not on your platform&quot; type support tickets.</p>
<p>The fact that <code>uv init</code> creates a <code>.python-version</code> file (with our preferred, major-version-only syntax) and also validates that the <code>.python-version</code> file&#x27;s version is compatible with the range in <code>requires-python</code> (when running other commands) is already a big improvement over e.g. Poetry.</p>
<p>However, I imagine there will still be a number of uv-using projects that didn&#x27;t use <code>uv init</code> and so don&#x27;t have a <code>.python-version</code> file.</p>
<p>As such, it would be great to either:</p>
<ul>
<li>Find ways to increase the adoption of <code>.python-version</code>. For example,  when locking warn if the file doesn&#x27;t exist or even automatically create the file (ie: lock the Python version at the same time as the dependencies, which conceptually seems like it might fit?). There would of course need to be a way to opt out, and perhaps it could be limited to when the project was using &quot;app&quot; mode (disabled if <code>package = true</code> etc).</li>
<li>Or, encourage the use of &quot;safer&quot; (and deploy/dev-prod parity friendly) <code>requires-python</code> values for &quot;app&quot; use-cases - such <code>==3.12.*</code> instead of <code>&gt;=3.12</code>. (Whilst technically <code>~=3.12.0</code> would also count as &quot;safe&quot; from a &quot;doesn&#x27;t pull in major version changes&quot; point of view, IMO the <code>~=</code> operator is too surprising, given that <code>~=3.12</code> and <code>~=3.12.0</code> are not equivalent - and so I would prefer to steer end-users away from it.)</li>
</ul>
<p>Lastly, imagine the scenario where:</p>
<ul>
<li>someone runs <code>uv init</code> now for their project of type &quot;app&quot;, giving a <code>.python-version</code> containing <code>3.12</code> and a <code>pyproject.toml</code> with a <code>requires-python</code> of <code>&gt;=3.12</code></li>
<li>over the years they bump their <code>.python-version</code> version, but don&#x27;t think about needing to update the <code>requires-python</code> version</li>
<li>eventually Python 3.12 reaches EOL</li>
<li>as the user later adds or updates packages, uv&#x27;s resolver has to find packages that are still compatible with Python 3.12 (to meet the <code>requires-python</code> range), but this becomes increasingly hard over time</li>
<li>this causes outdated packages, which is confusing for the user since they&#x27;ve requested a modern Python version in their <code>.python-version</code> file and may not even be aware about <code>requires-python</code> and the impact it has on package resolution.</li>
</ul>
<p>In that scenario, it seems using a wide-version-range value for <code>requires-python</code> (such as the default of <code>&gt;=3.X</code>) is a net-negative for UX for the &quot;app&quot; project type, even if a <code>.python-version</code> file is present. As such, perhaps nudging &quot;app&quot; project types towards a <code>requires-python</code> of e.g. <code>==3.12.*</code> would still be preferred? (Though an alternative might be for uv to output a warning if the <code>requires-python</code> range includes EOL Python versions perhaps?)</p>
<p>(See also <a href="https://github.com/heroku/buildpacks-python/issues/260">heroku/buildpacks-python#260</a> and <a href="https://github.com/python-poetry/poetry/issues/9668">python-poetry/poetry#9668</a>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Python Version Identification and Documentation&quot; to &quot;Best practices for `requires-python` &quot; by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 22:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">projects</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 22:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 22:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 22:25</div>
            <div class="timeline-body"><p>Thanks for the thorough comment @edmorley — I basically agree there are problems with using <code>&gt;=</code> for unpublished packages. I think it&#x27;d be reasonable to use <code>==X.y.*</code> instead, but I am curious to hear from more of the uv team though.</p>
<p>See also <a href="https://github.com/astral-sh/uv/issues/4970">astral-sh/uv#4970</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/2-5">@2-5</a> on 2024-09-17 11:10</div>
            <div class="timeline-body"><p>I have a related issue, and I&#x27;m not sure what&#x27;s the best approach.</p>
<p>I have a modular monolith, where the same Python package/code can run as multiple roles - webserver or worker for example. Each role has different dependencies, and I&#x27;m using <code>project.optional-dependencies</code> for that:</p>
<pre><code>[project]
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
    &quot;prometheus-client&gt;=0.20.0&quot;,
]

[project.optional-dependencies]
webserver = [
    &quot;aiohttp&gt;=3.9.5&quot;,
]
worker = [
    &quot;orjson&gt;=3.10.7&quot;,
]
</code></pre>
<p>If I want to run a particular checkout using the <code>worker</code> role I initialize the <code>.venv</code> like this: <code>uv sync --frozen --extra worker</code></p>
<p>The two pain points I encountered:</p>
<ol>
<li>there is no way to make <code>uv</code> remember how the <code>.venv</code> was initialized. If after the above command I run <code>uv sync</code>, it will not take into account that it was run previously with <code>--extra worker</code>, and it will change the installed packages</li>
<li>the different roles can have different Python version requirements. <code>webserver</code> is only compatible with 3.11, while <code>worker</code> also works with 3.12. This means I can&#x27;t use a Git commited <code>.python-version</code>, since it would have to be different between the roles. So instead I do this <code>uv sync --frozen --extra webserver --python 3.11</code></li>
</ol>
<p>So I&#x27;m wondering if there are some best practices on how to work with separate sets of somewhat incompatible optional dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Seazs">@Seazs</a> on 2024-09-23 12:39</div>
            <div class="timeline-body"><p>I have a similar issue with the usage of the following type of command:</p>
<pre><code>uv python install &#x27;&gt;=3.11&#x27;
</code></pre>
<p>With the latest pre-release Python version 3.13.0rc2 being available, if no other version is installed, uv will install 3.13.0rc2.</p>
<p>Would it not be better if uv installed the latest stable version (3.12.6) in that scenario?</p>
<p>As explained in <a href="https://peps.python.org/pep-0440/#version-specifiers">PEP440</a>, section <strong>Handling of pre-release</strong>,
&quot;Pre-releases of any kind, including developmental releases, are implicitly excluded from all version specifiers, unless they are already present on the system, explicitly requested by the user, or if the only available version that satisfies the version specifier is a pre-release.&quot;</p>
<p>Also, I am new to creating issues or requests, so let me know if I am doing something wrong.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-23 13:25</div>
            <div class="timeline-body"><p>@Seazs thanks for the report, that&#x27;s different than this issue — that&#x27;s a bug. We&#x27;ll track it in <a href="https://github.com/astral-sh/uv/issues/7637">astral-sh/uv#7637</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2024-12-14 06:04</div>
            <div class="timeline-body"><p>Hi! I have a similar issue.</p>
<p>When developing libraries, I prefer to use minimal supported Python version. It&#x27;s easier to control that I&#x27;m not using features of newer Python versions.</p>
<p>I also use tox with tox-uv to test libraries against all supported Python versions.</p>
<p>When I use .python-version with minimal supported version, tox-uv stops working properly. As I can see from the logs, uv recreates test environment because it doesn&#x27;t match the pinned python version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-14 15:26</div>
            <div class="timeline-body"><p>Hi @tkukushkin perhaps that&#x27;s a tox-uv bug? It sounds like they should be supplying an explicit Python version to use during testing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2024-12-14 16:10</div>
            <div class="timeline-body"><p>I saw the tox-uv issue about it (<a href="https://github.com/tox-dev/tox-uv/issues/110">tox-dev/tox-uv#110</a>) but I just decided to show my use case here as well. Ideally I would not like to have .python-version at all. It just duplicates <code>requires-python</code> and I have to remember to keep them in sync.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-14 17:31</div>
            <div class="timeline-body"><p>Except it doesn&#x27;t duplicate it — it serves a distinct purpose, e.g., see discussion in <a href="https://github.com/astral-sh/uv/issues/8247">astral-sh/uv#8247</a></p>
<p>You don&#x27;t need to have a <code>.python-version</code> file if you don&#x27;t want to, but then we&#x27;ll use the <em>first</em> Python version we find that is compatible with your <code>requires-python</code> range unless you request a different version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2024-12-14 17:39</div>
            <div class="timeline-body"><p>I meant it duplicates in my use case. I never want them to be different.</p>
<p>Also I don&#x27;t really understand what &quot;first&quot; means. Could you please clarify it? I&#x27;ve seen it in documentation, but it&#x27;s not clear for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tkukushkin">@tkukushkin</a> on 2024-12-14 17:49</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/uv/issues/5609 looks like what I need.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofer-pd">@ofer-pd</a> on 2025-01-26 21:52</div>
            <div class="timeline-body"><p>Sorry to intrude on this issue, but I have a related noob question:</p>
<p>If I have a private project (company web app), isn&#x27;t it redundant to have a <code>.python-version</code> file <strong>and</strong> a <code>pyproject.toml</code> file with the <code>project.requires-python</code> field defined?  Wouldn&#x27;t it make sense to drop the <code>requires-python</code> field and simply rely on the <code>.python-version</code> file?</p>
<p>(I assume in the case of a public project, like Django, one would want to keep the <code>requires-python</code> field defined for the benefit of package managers.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-28 17:50</div>
            <div class="timeline-body"><p>@ofer-pd that&#x27;s addressed a few comments up <a href="https://github.com/astral-sh/uv/issues/7429">astral-sh/uv#7429</a>#issuecomment-2543194925</p>
<p>If you&#x27;re publishing a package, then you should definitely still use a <code>requires-python</code> field.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofer-pd">@ofer-pd</a> on 2025-01-28 19:16</div>
            <div class="timeline-body"><p>@zanieb Thanks for the response - and for linking to #8247.  I found this comment helpful:</p>
<blockquote>
<p>The .python-version file is not quite obsolete with requires-python -- they&#x27;re subtly different. requires-python is the range of versions supported by your project. .python-version is the exact version you want to use when developing. For example, if you&#x27;re working on a library, your requires-python might be &gt;= &quot;3.10&quot;. But when developing on your machine, you might want to use 3.12.4 by default -- so you&#x27;d set that in a .python-version.</p>
</blockquote>
<p>https://github.com/astral-sh/uv/issues/8247#issuecomment-2416680597</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssbarnea">@ssbarnea</a> on 2025-07-25 18:04</div>
            <div class="timeline-body"><p>I need to tell uv to do something like use, python 3.9 <code>&gt;=3.9.17</code> or 3.10 <code>&gt;= 3.10.13</code> or just <code>&gt;=3.11</code> but I am afraid that there is no way to tell it this right now.</p>
<p>Note that this might not be the version needed by the package, is the version of python I want uv to install as I want to be sure that some of the known problematic outdated versions are to be avoided during testing. Any ideas?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:04 UTC
    </footer>
</body>
</html>
