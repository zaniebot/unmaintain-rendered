<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paths to using published versions of vendored, forked crates? - astral-sh/uv #5588</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Paths to using published versions of vendored, forked crates?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5588">#5588</a>
        opened by <a href="https://github.com/musicinmybrain">@musicinmybrain</a>
        on 2024-07-30 05:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/musicinmybrain">@musicinmybrain</a> on 2024-07-30 05:04</div>
            <div class="timeline-body"><p>While finishing up a <code>uv</code> package for Fedora Linux, I’ve documented several cases where third-party crates have been copied into <code>uv</code>.</p>
<ul>
<li><code>crates/pep440-rs</code> is forked from version 0.6.0 of https://crates.io/crates/pep440_rs which is maintained in https://github.com/konstin/pep440-rs</li>
<li><code>crates/pep508-rs</code> is forked from version 0.6.0 of https://crates.io/crates/pep508_rs which is maintained in https://github.com/konstin/pep508_rs</li>
<li><code>crates/uv-extract/src/vendor/cloneable_seekable_reader.rs</code> appears to be forked from https://crates.io/crates/ripunzip which is maintained in https://github.com/google/ripunzip; based on the file’s contents and when it was originally introduced, I think it was forked from version 0.4.0, i.e. https://github.com/google/ripunzip/blob/v0.4.0/src/unzip/cloneable_seekable_reader.rs.</li>
<li><code>wheel_metadata_from_remote_zip</code> in <code>crates//uv-client/src/remote_metadata.rs</code> is forked from <code>lazy_read_wheel_metadata</code> in <code>crates/rattler_installs_packages/src/index/lazy_metadata.rs</code> in version 0.9.0 https://crates.io/crates/rattler_installs_packages which is maintained at https://github.com/prefix-dev/rip</li>
<li><code>crates/uv-virtualenv/</code> as a whole is derived from https://github.com/konstin/gourgeist 0.0.4, which was published as https://crates.io/crates/gourgeist. I am inclined not to treat this as a case of bundling, because it looks like the project was subsumed into <code>uv</code>, and the link to <code>uv</code> at https://konstin.github.io/gourgeist/ seems to support this.</li>
</ul>
<p>(Please correct me if any of the above is not quite right.)</p>
<p><a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/#bundling">Fedora policy</a> requires me to ask if there is a path toward eventually using a system copy of any or all of these libraries, i.e., if the necessary changes may eventually be worked around or upstreamed in the original crates.io packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/musicinmybrain">@musicinmybrain</a> on 2024-07-30 05:05</div>
            <div class="timeline-body"><p>I also found that <code>crates/uv-python/python/packaging</code> is vendored from https://pypi.org/project/packaging, but the fact that <code>uv</code> does not necessarily depend on a Python interpreter or environment provides much of the explanation for why this is necessary, and the commit message for 7964bfbb2bed50a5c7b0650a7b6799a66503a33a seems to provide most of the remaining rationale.</p>
<p>A similar rationale seems to apply for <code>crates/uv-virtualenv/src/activator/</code>, bundled and slightly forked from files in https://pypi.org/project/virtualenv and specificially https://github.com/pypa/virtualenv/tree/main/src/virtualenv/activation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/musicinmybrain">@musicinmybrain</a> on 2024-07-30 05:05</div>
            <div class="timeline-body"><p>Regarding forked crates that are not directly vendored, but referenced by <code>git</code> dependencies:</p>
<ul>
<li>I already asked about <code>async_zip</code>, https://github.com/astral-sh/uv/issues/5556</li>
<li>I already asked about <code>pubgrub</code>, https://github.com/astral-sh/uv/issues/3794</li>
<li>and I believe I understand that the path to using upstream <code>reqwest-middleware</code>/<code>reqwest-retry</code> is for some form of https://github.com/TrueLayer/reqwest-middleware/pull/159 to be merged, but please correct me if I am mistaken</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-30 08:52</div>
            <div class="timeline-body"><blockquote>
<p>crates/pep440-rs is forked from version 0.6.0 of https://crates.io/crates/pep440_rs which is maintained in https://github.com/konstin/pep440-rs
crates/pep508-rs is forked from version 0.6.0 of https://crates.io/crates/pep508_rs which is maintained in https://github.com/konstin/pep508_rs
crates/uv-virtualenv/ as a whole is derived from https://github.com/konstin/gourgeist 0.0.4, which was published as https://crates.io/crates/gourgeist. I am inclined not to treat this as a case of bundling, because it looks like the project was subsumed into uv, and the link to uv at https://konstin.github.io/gourgeist/ seems to support this.</p>
</blockquote>
<p>These have diverged significantly and the upstream versions are only passively maintained, uv requires these custom versions and can't use a system copy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-07-30 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">internal</span> added by @charliermarsh on 2024-07-30 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/2002.html">prefix-dev/pixi#2002</a> on 2024-09-07 14:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 21:20</div>
            <div class="timeline-body"><p>Are there remaining open questions here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/musicinmybrain">@musicinmybrain</a> on 2024-10-21 22:58</div>
            <div class="timeline-body"><p>I think this is adequately answered – thanks!</p>
<p>(I’m also tracking the forked <code>tl</code> crate, https://github.com/astral-sh/uv/issues/6687, but that’s just waiting on <code>tl</code> upstream to become active again and consider https://github.com/y21/tl/pull/69.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @musicinmybrain on 2024-10-21 22:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:31 UTC
    </footer>
</body>
</html>
