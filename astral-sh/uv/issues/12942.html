<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strange default owner/group when installed as root - astral-sh/uv #12942</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Strange default owner/group when installed as root</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/12942">#12942</a>
        opened by <a href="https://github.com/jklaiho">@jklaiho</a>
        on 2025-04-17 12:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jklaiho">@jklaiho</a> on 2025-04-17 12:55</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm installing uv for all users on a system. This involves downloading the installer and executing it as root:</p>
<pre><code>UV_INSTALL_DIR=/usr/local/bin INSTALLER_NO_MODIFY_PATH=1 ./install.sh
</code></pre>
<p>For some reason, the <code>uv</code> and <code>uvx</code> binaries are created with the owner/group values of <code>1001:117</code>. The same happens if I just download the release file from GitHub and extract it manually as root.</p>
<p>If I perform the installation with a non-root user into a path owned by them, the files are created with the owner/group of that user.</p>
<p>This seems like it may be a *nix feature rather than a uv &quot;bug&quot; as such, but I'd still expect root-installed binaries to end up as <code>root:root</code>. Is there anything the installer could do to facilitate that?</p>
<h3>Platform</h3>
<p>Ubuntu 24.04 amd64</p>
<h3>Version</h3>
<p>uv 0.6.14</p>
<h3>Python version</h3>
<p>Python 3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @jklaiho on 2025-04-17 12:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @Gankra by @zanieb on 2025-04-17 21:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-04-22 19:13</div>
            <div class="timeline-body"><p>Installing &quot;as root&quot; isn't really a supported workflow, no. Could you elaborate on how you did it &quot;as root&quot; (sudo? su?)? Also is this actually preventing the other users from running it? What are the full permissions you're ending up with?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @Gankra on 2025-04-22 19:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @Gankra on 2025-04-22 19:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jklaiho">@jklaiho</a> on 2025-04-23 11:17</div>
            <div class="timeline-body"><p>Being a centrally managed multi-user system, it just didn't make sense to me to have everyone install a separate <code>uv</code> binary when everything seemingly works just fine with one installed by root in <code>/usr/local/bin</code>. (Except self-updates by non-root users, but that's by design in this case.)</p>
<p>I installed it via an Ansible task that sudoes using <code>become_user</code>. The method of becoming root doesn't matter, same result.</p>
<p>I changed the ownership of the extracted binaries to <code>root:root</code> with a later Ansible task. They have <code>0755</code> perms when extracted, so it didn't <em>particularly</em> matter what the ownership was before, anyone could still run them. Kinda ugly to have them owned by user 1001, who does exist on the system and has no business being the owner of the binaries, which is the main reason I wanted them changed.</p>
<p>Looking deeper, I checked what your GitHub release tarballs contain:</p>
<pre><code>$ tar tvzf uv-x86_64-unknown-linux-gnu.tar.gz
drwxr-xr-x runner/docker     0 2025-04-10 00:38 uv-x86_64-unknown-linux-gnu/
-rwxr-xr-x runner/docker 41044656 2025-04-10 00:38 uv-x86_64-unknown-linux-gnu/uv
-rwxr-xr-x runner/docker   373296 2025-04-10 00:38 uv-x86_64-unknown-linux-gnu/uvx
</code></pre>
<p>So the CI process that builds the archive apparently has <code>runner</code> with UID 1001 and <code>docker</code> with GID 117, and those are just baked into the archive. And then when you extract the archive with <code>tar</code> as root, it preserves those numeric permissions, which then makes the files appear as owned by a particular user/group on the target machine, if corresponding ones exist.</p>
<p>Quick fix suggestions in your CI:</p>
<ul>
<li><code>chown -R 0:0 uv-x86_64-unknown-linux-gnu</code> before <code>tar</code>ing the directory</li>
<li><code>tar --owner=0 --group=0 &lt;etc&gt;</code> directly.</li>
</ul>
<p>I tested both. Extracting as root, the files come out as <code>root:root</code>. Extracting as a non-root user, they come out with the UID:GID of that user, just like they currently do.</p>
<p>Having a single <code>/usr/local/bin/uv</code> common to all users is a completely valid use case IMHO, unless I've missed something in the docs that absolutely prevents it from being a consideration, and this change of ownership inside the tarball seemingly breaks nothing that's currently working, just makes root installs nicer without the extra <code>chown</code> step to ensure that a random user on the system doesn't own the binaries.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../axodotdev/cargo-dist/pulls/2195.html">axodotdev/cargo-dist#2195</a> on 2025-11-10 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AThePeanut4">@AThePeanut4</a> on 2025-11-10 18:53</div>
            <div class="timeline-body"><p>I have exactly the same situation, where I want to install into <code>/usr/local/bin</code>. I found an even simpler fix - just use <code>--no-same-owner</code> in the <code>tar</code> command - which I've made PR https://github.com/axodotdev/cargo-dist/pull/2195 for in the upstream project.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
