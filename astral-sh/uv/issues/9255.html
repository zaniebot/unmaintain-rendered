<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` doesn't respect `--index-url` flag in `requirements.txt` - astral-sh/uv #9255</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv sync</code> doesn't respect <code>--index-url</code> flag in <code>requirements.txt</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9255">#9255</a>
        opened by <a href="https://github.com/fynnsu">@fynnsu</a>
        on 2024-11-19 22:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/fynnsu">@fynnsu</a> on 2024-11-19 22:38</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>I have a requirements.txt file with a custom index-url for one of the packages, ex.</p>
<pre><code>--index-url https://my_custom_index.org
some_package
</code></pre>
<p>and in my <code>pyproject.toml</code></p>
<pre><code>[project]
name = &quot;my_project&quot;
dynamic = [&quot;dependencies&quot;]
...
[tool.setuptools.dynamic]
dependencies = { file = [&quot;requirements.txt&quot;] }
...
</code></pre>
<p>Running</p>
<pre><code class="language-bash">uv sync
</code></pre>
<p>results in:</p>
<pre><code>❯ uv sync
warning: No `requires-python` value found in the workspace. Defaulting to `&gt;=3.10`.
  × Failed to build `my_package @ file:///home/fynnsu/projects/my_package`
  ╰─▶ Build backend failed to determine requirements with `build_editable()` (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/_vendor/packaging/requirements.py&quot;, line 36,
      in __init__
          parsed = _parse_requirement(requirement_string)
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/_vendor/packaging/_parser.py&quot;, line 62, in
      parse_requirement
          return _parse_requirement(Tokenizer(source, rules=DEFAULT_RULES))
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/_vendor/packaging/_parser.py&quot;, line 71, in
      _parse_requirement
          name_token = tokenizer.expect(
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/_vendor/packaging/_tokenizer.py&quot;, line 142,
      in expect
          raise self.raise_syntax_error(f&quot;Expected {expected}&quot;)
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/_vendor/packaging/_tokenizer.py&quot;, line 167,
      in raise_syntax_error
          raise ParserSyntaxError(
      packaging._tokenizer.ParserSyntaxError: Expected package name at the start of dependency specifier
          --index-url https://my_custom_index.org
          ^

      The above exception was the direct cause of the following exception:

      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 483, in
      get_requires_for_build_editable
          return self.get_requires_for_build_wheel(config_settings)
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 334, in
      get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 304, in _get_build_requires
          self.run_setup()
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 320, in run_setup
          exec(code, locals())
        File &quot;&lt;string&gt;&quot;, line 85, in &lt;module&gt;
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/__init__.py&quot;, line 117, in setup
          return distutils.core.setup(**attrs)
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/_distutils/core.py&quot;, line 157, in setup
          dist.parse_config_files()
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/_virtualenv.py&quot;, line 20, in parse_config_files
          result = old_parse_config_files(self, *args, **kwargs)
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/dist.py&quot;, line 648, in parse_config_files
          pyprojecttoml.apply_configuration(self, filename, ignore_option_errors)
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/config/pyprojecttoml.py&quot;, line 73, in
      apply_configuration
          return _apply(dist, config, filepath)
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/config/_apply_pyprojecttoml.py&quot;, line 59, in
      apply
          dist._finalize_requires()
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/dist.py&quot;, line 380, in _finalize_requires
          self._normalize_requires()
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/dist.py&quot;, line 395, in _normalize_requires
          self.install_requires = list(map(str, _reqs.parse(install_requires)))
        File &quot;/home/fynnsu/.cache/uv/builds-v0/.tmpSKP82X/lib/python3.10/site-packages/setuptools/_vendor/packaging/requirements.py&quot;, line 38,
      in __init__
          raise InvalidRequirement(str(e)) from e
      packaging.requirements.InvalidRequirement: Expected package name at the start of dependency specifier
          --index-url https://my_custom_index.org
          ^
</code></pre>
<p>Even if I also add the index to <code>pyproject.toml</code> it still fails:</p>
<pre><code>[[tool.uv.index]]
url = &quot;https://my_custom_index.org&quot;
default = false
</code></pre>
<p>Perhaps this is intended behaviour and I need to fully switch to the uv specification, however, that makes it difficult to gradually switch the project, while maintaining support for <code>requirements.txt</code>. Also the fact that <code>uv pip install</code> handles <code>--index-url</code> in <code>requirements.txt</code> correctly makes me think this might be a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-19 22:39</div>
            <div class="timeline-body"><p>We do respect this. That looks like a setuptools error? Which isn't in uv itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fynnsu">@fynnsu</a> on 2024-11-19 22:47</div>
            <div class="timeline-body"><p>Oh I see, my bad.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @fynnsu on 2024-11-19 22:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:49 UTC
    </footer>
</body>
</html>
