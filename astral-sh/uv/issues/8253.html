<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explicit index not respected for transitive dependency - astral-sh/uv #8253</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Explicit index not respected for transitive dependency</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/8253">#8253</a>
        opened by <a href="https://github.com/juzna">@juzna</a>
        on 2024-10-16 12:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/juzna">@juzna</a> on 2024-10-16 12:47</div>
            <div class="timeline-body"><p>Hey, thanks for delivering explicit indexes in #7481 ‚ù§Ô∏è I'm trying this with uv built from the last commit (e71b1d0c), but I have a problem with transitive dependencies &amp; explicit index.</p>
<p>Scenario: <code>my-app</code> depends on internal pkg <code>a</code>, which declares a dependency on (internal) package <code>b.</code></p>
<p>In my app project.toml, I define the index plus I set sources for both pkg <code>a</code> &amp; <code>b. But then </code>uv lock` gives me</p>
<blockquote>
<p>Because b was not found in the package registry ...</p>
</blockquote>
<p>So it's ignoring the source definition when resolving a transitive dependency.</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;my-internal-index&quot;
url = &quot;...&quot;
explicit = true

[tool.uv.sources]
a = { index = &quot;my-internal-index&quot; }
b = { index = &quot;my-internal-index&quot; }

[project.dependencies]
a = { version = &quot;1.0&quot; }  # `a` declares a dependency on `b`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-16 12:48</div>
            <div class="timeline-body"><p>Sources only apply to dependencies that are declared in the project itself. In this case, you'd need to define <code>b</code> as a dependency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/juzna">@juzna</a> on 2024-10-16 12:57</div>
            <div class="timeline-body"><p>Yep, that works.</p>
<p>Though, is it a good approach? <code>my-app</code> doesn't really depend on <code>b</code>, only transitively. So if <code>a</code> removes the dependency on <code>b</code> in the future, I'll be left with an unused dependency. For this reason, I'll also get a warning by <a href="https://github.com/fpgmaas/deptry">deptry</a> that the dependency is not used in my code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-10-16 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/corleyma">@corleyma</a> on 2024-10-16 21:26</div>
            <div class="timeline-body"><p>I don't know if it applies here, but this handling of transitive dependencies is the primary driver for the &quot;glob pattern-based source declaration&quot; functionality that exists in PDM and others have implemented using poetry plugins described e.g. <a href="https://github.com/astral-sh/uv/issues/171#issuecomment-2302093785">here</a>.  The idea is that in corporate environments, where it's common to enforce a namespace for internal packages, this makes it easy to setup a declaration that handles pinning transitive internal dependencies to a particular repository.</p>
<p>just echoing that there is some desire to have a way to inform a package manager about how to handle particular transitive dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/odie5533">@odie5533</a> on 2024-10-18 16:55</div>
            <div class="timeline-body"><p>@juzna You may be better off though removing the <code>explicit = true</code> so that all packages are checked on your internal index first. That's probably a fair workaround, and improves your security.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mnchsmn">@mnchsmn</a> on 2024-10-23 15:53</div>
            <div class="timeline-body"><p>We're also running into this issue. We have a library that depends on torch, so for that library we have set up as in the docs, and that works.</p>
<pre><code>[tool.uv.sources]
torch = { index = &quot;pytorch&quot; }

[[tool.uv.index]]
name = &quot;pytorch&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
</code></pre>
<p>Now when this library is used in an application, I'm getting <code>Because there is no version of torch{platform_system == 'Linux'}==2.5.0+cpu...</code>, even when the same index is also added in the application's <code>pyproject.toml</code>. Making the index non-explicit also doesn't work, because the torch index contains some older version of <code>requests</code> which then blocks us from fetching the required <code>requests</code> from the default index. It does work with non-explicit index and <code>--index-strategy unsafe-first-match</code> but we'd prefer to avoid using the unsafe option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oxenit">@oxenit</a> on 2024-12-17 13:54</div>
            <div class="timeline-body"><p>I would also be in favor of an improvement of this corporate use case.
My package <code>A</code> depends on package <code>B</code> from private index which itself depends on <code>C</code> from private index.</p>
<p>No way to make it works from <code>A</code> <code>pyproject.toml</code> without <code>explicit = true</code> that we don't want as it puts unnecessary pressure on our internal index, only used for our packages.
Option 2 of defining transitive dependencies like <code>C</code> directly in <code>A</code> is not very clean either.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2025-05-08 05:11</div>
            <div class="timeline-body"><p>Hey guys, do you have any further thoughts on this? Using <code>uv</code> with multiple packages from separate indices is somewhat painful right now do to a lack of configurability of such a feature.</p>
<p>Example:</p>
<ul>
<li>project depends on <code>rospy</code> from their index, which has other transitive dependencies in their custom index</li>
<li>project depends on <code>custom-lib</code> from an internal index, which has other transitive dependencies in the internal index</li>
<li>both depend on <code>numpy</code> (silly example) from the PyPi index</li>
</ul>
<p>How do we resolve such dependencies without declaring <em>both</em> the <code>rospy</code> index and <code>custom-lib</code> index as <code>non-explicit</code>? Marking both as <code>non-explicit</code> leads to poor resolution from unexpected indices.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NeverDieOne">@NeverDieOne</a> on 2025-09-01 12:47</div>
            <div class="timeline-body"><p>Do you have any plans to add some options to resolve it ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mikenerone">@mikenerone</a> on 2025-09-02 14:52</div>
            <div class="timeline-body"><p>This missing functionality is problematic for me, as well, so +1, but I'm going to go a bit further and say that <code>uv pip install &lt;package&gt;</code> should <em>also</em> honor the source configurations. The common use case for this is plugins: my (proprietary) app employs a plugin package architecture. Devs frequently need to test the app locally with different plugin packages installed (all of which are arbitrary and optional, so not dependencies of the main app at all). Currently, we can't simply install the package with <code>uv pip install</code> as one would hope, even if we assign those packages to our private package index in <code>[tool.uv.sources]</code>. That should work.</p>
<p>Note: currently we work around this by installing from the repo URL or a local clone, but this approach requires extra care, as it introduces the risk that we're testing with a build of the plugin package that doesn't correspond to the latest release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JustGevorg">@JustGevorg</a> on 2025-09-11 17:28</div>
            <div class="timeline-body"><p>+1 from me for adding this fnctional. @charliermarsh advice from his answer works for me but in more complicated cases i see this approach may cause troubles in managing my company internal dependencies</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ARKAD97">@ARKAD97</a> on 2025-09-19 23:44</div>
            <div class="timeline-body"><p>+1</p>
<p>Can't properly handle installing nightly torch for CUDA Toolkit 13.0:</p>
<pre><code class="language-toml">[project.optional-dependencies]
cu128 = [ &quot;torch==2.7.1&quot; ]
cu129 = [ &quot;torch==2.8.0&quot; ]
cu130 = [ &quot;torch==2.9.0.dev20250909+cu130&quot; ]

[tool.uv.sources]
torch = [
  { index = &quot;cu128&quot;, extra = &quot;cu128&quot; },
  { index = &quot;cu129&quot;, extra = &quot;cu129&quot; },
  { index = &quot;cu130&quot;, extra = &quot;cu130&quot; }
]

[[tool.uv.index]]
name = &quot;cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true

[[tool.uv.index]]
name = &quot;cu129&quot;
url = &quot;https://download.pytorch.org/whl/cu129&quot;
explicit = true

[[tool.uv.index]]
name = &quot;cu130&quot;
url = &quot;https://download.pytorch.org/whl/nightly/cu130&quot;
explicit = true
</code></pre>
<p>Making non-explicit all indices is kinda scary</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MauroPfister">@MauroPfister</a> on 2025-10-06 15:00</div>
            <div class="timeline-body"><p>Ran into the same issue also in a corporate setting where only some package should be fetched from the private index. Would appreciate seeing an improvement of that usecase here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KochankovID">@KochankovID</a> on 2025-10-09 13:53</div>
            <div class="timeline-body"><p>+1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tekeinhor">@tekeinhor</a> on 2025-11-14 14:49</div>
            <div class="timeline-body"><p>+1, ran into this issue today as well</p>
<p>(Thanks for all u do)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karim-moon">@karim-moon</a> on 2025-11-27 03:59</div>
            <div class="timeline-body"><p>+1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rabyj">@rabyj</a> on 2025-11-27 19:35</div>
            <div class="timeline-body"><p>@KochankovID @tekeinhor @karim-moon</p>
<p>Just a quick note: on many projects, maintainers prefer avoiding ‚Äú+1‚Äù comments since they notify everyone without adding new information. Using the üëç reaction on the original post is usually the recommended way to show support and keep the thread clean and useful for maintainers.</p>
<p>Thanks!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:17:14 UTC
    </footer>
</body>
</html>
