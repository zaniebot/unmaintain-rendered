<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` perf regression in 0.2.6 - astral-sh/uv #4040</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv pip compile` perf regression in 0.2.6</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/4040">#4040</a>
        opened by <a href="https://github.com/blueraft">@blueraft</a>
        on 2024-06-05 09:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/blueraft">@blueraft</a> on 2024-06-05 09:59</div>
            <div class="timeline-body"><p>There's a significant performance regression in <code>uv 0.2.6</code> for projects that rely on <a href="https://github.com/pypa/setuptools_scm/">setuptools_scm</a>.</p>
<h3>MRE</h3>
<ol>
<li>Initialize a blank git repo.</li>
<li>Copy the following pyproject.toml.</li>
</ol>
<pre><code class="language-toml">[build-system]
requires = [&quot;setuptools&lt;69.3.0&quot;, &quot;setuptools-scm&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = 'foobar'
dynamic = [&quot;version&quot;]
requires-python = &quot;&gt;=3.9&quot;

dependencies = [&quot;flask&quot;]

[tool.setuptools_scm]
</code></pre>
<p>Benchmarks from an Ubuntu machine (I am able to reproduce this on MacOS too):</p>
<ol>
<li><code>uv 0.2.6</code></li>
</ol>
<pre><code class="language-sh">❯ uv --version
uv 0.2.6
❯ hyperfine 'uv pip compile pyproject.toml'
Benchmark 1: uv pip compile pyproject.toml
  Time (mean ± σ):     604.1 ms ±   5.2 ms    [User: 515.1 ms, System: 96.1 ms]
  Range (min … max):   596.4 ms … 611.8 ms    10 runs
</code></pre>
<ol start="2">
<li><code>uv 0.2.5</code></li>
</ol>
<pre><code class="language-sh">❯ uv --version
uv 0.2.5
❯ hyperfine 'uv pip compile pyproject.toml'
Benchmark 1: uv pip compile pyproject.toml
  Time (mean ± σ):      58.2 ms ±   1.3 ms    [User: 41.6 ms, System: 23.7 ms]
  Range (min … max):    55.1 ms …  61.0 ms    50 runs
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @konstin on 2024-06-05 11:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @konstin on 2024-06-05 11:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-05 11:04</div>
            <div class="timeline-body"><p>The cause of this regression is we unified some code paths and now require a static <code>version</code> field to read a <code>pyproject.toml</code> statically, instead we're now building the package to get the metadata including the version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-05 15:02</div>
            <div class="timeline-body"><p>We can fix this though it's sort of a pain.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-06-05 15:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-06-05 15:17</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4058.html">astral-sh/uv#4058</a> on 2024-06-05 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-06-05 18:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
