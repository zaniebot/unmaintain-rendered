```yaml
number: 11408
title: "Breaking behavior change: uv 0.5.29 creates a `/tmp/uv-xcxx.lock` "
type: issue
state: closed
author: zongsizhang
labels:
  - bug
assignees: []
created_at: 2025-02-10T21:42:12Z
updated_at: 2025-02-10T22:19:34Z
url: https://github.com/astral-sh/uv/issues/11408
synced_at: 2026-01-10T01:57:26Z
```

# Breaking behavior change: uv 0.5.29 creates a `/tmp/uv-xcxx.lock` 

---

_Issue opened by @zongsizhang on 2025-02-10 21:42_

### Summary

Our Dockerfile
```
FROM --platform=linux/amd64 ghcr.io/astral-sh/uv:python3.11-bookworm-slim
ENV PYTHONUNBUFFERED=true
ENV DEBIAN_FRONTEND=noninteractive

# Copy our project and run uv sync`
WORKDIR /app
COPY . /app/
RUN uv sync --no-install-workspace --package api
```

Since today, when we rebuild our image, the UV version is upgraded from `0.5.28` -> `0.5.29`
And we found that it starts to create a file `/tmp/uv-xxxx.lock` file before we run uv commands under the project.
While in the image with `0.5.28`, it doesn't try to create the file before execution.

Here I attach the digest of the 2 images:
* Image without temp file created: `uv:0.5.28-python3.11-bookworm-slim@sha256:2f72c97cc252b5b616380848539546c93de0d40ee4ec8cf0981bdbd63c9db613`
* Image with temp file created: `uv:0.5.29-python3.11-bookworm-slim@sha256:80ac1ba1ccf13317b29a2eb02e4c3a99094efdb6f90ae878f000ade6b101412d`

Our Kubernetes container stopped working cause now it requires access to `/tmp` directory.
I wonder if this is a new behavior of `0.5.29`, or this is due to something in the image?

### Platform

Debian GNU/Linux 12 (bookworm)

### Version

0.5.29

### Python version

Python 3.11.11

---

_Label `bug` added by @zongsizhang on 2025-02-10 21:42_

---

_Renamed from "uv 0.5.29 creates a `/tmp/uv-xcxx.lock`" to "Breaking behavior change: uv 0.5.29 creates a `/tmp/uv-xcxx.lock` " by @zongsizhang on 2025-02-10 21:42_

---

_Comment by @charliermarsh on 2025-02-10 21:45_

It's a new behavior in 0.5.29. But why doesn't your container have access to `/tmp`?

---

_Comment by @charliermarsh on 2025-02-10 21:46_

Or do you mean that the lockfile is created by one user, but runs in production under another user?

---

_Comment by @zongsizhang on 2025-02-10 21:51_

> Or do you mean that the lockfile is created by one user, but runs in production under another user?

Thanks for replying, it was never required, so we didn't bother to do that. And yes the root user created a lockfile and in the production it run as another user.

BTW where is this change mentioned? I can't find in the release note or the change logs

---

_Comment by @zanieb on 2025-02-10 21:52_

It's https://github.com/astral-sh/uv/pull/11259

---

_Comment by @zanieb on 2025-02-10 21:53_

See also

- https://github.com/astral-sh/uv/pull/11178
- https://github.com/astral-sh/uv/issues/10773

---

_Comment by @zongsizhang on 2025-02-10 21:57_

Thanks! we'll add access to the `/tmp` folder then.

---

_Closed by @zongsizhang on 2025-02-10 21:57_

---

_Comment by @charliermarsh on 2025-02-10 21:59_

I think this might "just work" for you in v0.5.30. The problem you're running into (probably) is that the production user can't access the lock because it's created by the root, but in v0.5.30, I've fixed the permissions on it. It's probably worth just seeing if v0.5.30 works for you (which will be out today).

---

_Comment by @zongsizhang on 2025-02-10 22:12_

Sounds great!

---

_Comment by @zongsizhang on 2025-02-10 22:19_

@charliermarsh BTW is there a way we can remove this lock elegantly elegantly?

---
