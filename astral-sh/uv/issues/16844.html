<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>resolving a circular dependency as `lowest` results in an older version of the project being fetched - astral-sh/uv #16844</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>resolving a circular dependency as <code>lowest</code> results in an older version of the project being fetched</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16844">#16844</a>
        opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a>
        on 2025-11-25 14:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/neutrinoceros">@neutrinoceros</a></div>
            <div class="timeline-body">Summary
<p>When experimenting with <code>--resolution=lowest</code> for astropy&#x27;s complete dependency graph, I hit a diabolical edge case, where <code>astropy</code> has an optional dependency on <code>asdf-astropy&gt;=0.3</code>, which <em>itself</em> requires <code>astropy&gt;=5.0.4</code> (astropy&#x27;s current version number is in the <code>8.0.0dev+...</code>). Apparently, uv fails to recognize that <code>astropy</code> is the package being resolved for, and it attempts to build v5.0.4 from source. This would already be a waste of time even if it worked, but it doesn&#x27;t, making it harder to ignore.</p>
<p><a href="https://github.com/astropy/astropy/actions/runs/19665128196/job/56320090314?pr=18955">example logs</a>
relevant excerpt :</p>
<pre><code>Building astropy==5.0.4
  × Failed to download and build `astropy==5.0.4`
  ├─▶ Failed to resolve requirements from `build-system.requires`
  ├─▶ No solution found when resolving: `setuptools`, `setuptools-scm&gt;=6.2`,
  │   `wheel`, `cython==0.29.22`, `markupsafe==2.0.1`, `jinja2==3.0.3`,
  │   `oldest-supported-numpy`, `extension-helpers`
  ╰─▶ Because markupsafe==2.0.1 has no usable wheels and you require
      markupsafe==2.0.1, we can conclude that your requirements are
      unsatisfiable.

      hint: Wheels are required for `markupsafe` because building from
      source is disabled for `markupsafe` (i.e., with `--no-build-package
      markupsafe`)
  help: `astropy` (v5.0.4) was included because `asdf-astropy` (v0.3.0)
        depends on `astropy`
</code></pre>
<p>To add insult to injury, astropy&#x27;s version number is dynamic...</p>
<p>I suppose at this point, the resolver cannot really be expected to do better than <em>taking a bet</em> and just assume that the version of astropy being built will satisfy the requirements. I think this would be fine as long as the assumption is checked after we&#x27;re done building astropy.</p>
<p>I do note that there&#x27;s a known workaround we can use by making astropy requiring a more recent version of asdf-astropy, but I think that&#x27;s ultimately a hack, and only works because we end up downloading older versions of astropy that have matching wheels, so I&#x27;d be interested to see if there&#x27;s a chance to resolve the root issue in uv instead.</p>
<p>Unfortunately I couldn&#x27;t reproduce this locally on macOS (amr64), so I don&#x27;t have the ability to reduce my reproducer yet.
Possibly related, but I don&#x27;t think that&#x27;s quite a duplicate: <a href="https://github.com/astral-sh/uv/issues/16372">astral-sh/uv#16372</a></p>
Platform
<p>Seen on ubuntu ubuntu-24.04</p>
Version
<p>uv==0.9.11</p>
Python version
<p>3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-11-25 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-26 16:10</div>
            <div class="timeline-body"><p>The CI workflow you linked uses <code>uv pip install</code>, without <code>astropy</code> in the list of dependencies. It seems correct that <code>uv pip</code> doesn&#x27;t pick up the current pyproject.toml if <code>.</code> isn&#x27;t requested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;BUG: resolving a circular dependency as `lowest` results in an older version of the project being fetched&quot; to &quot;resolving a circular dependency as `lowest` results in an older version of the project being fetched&quot; by <a href="https://github.com/konstin">@konstin</a> on 2025-11-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/konstin">@konstin</a> on 2025-11-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-11-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-11-26 16:15</div>
            <div class="timeline-body"><p>oh, excellent point, I missed that. Well, that&#x27;s a problem for tox and tox-uv then. Thank you !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-11-26 16:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:41:08 UTC
    </footer>
</body>
</html>
