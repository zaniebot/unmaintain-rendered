<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>resolving a circular dependency as `lowest` results in an older version of the project being fetched - astral-sh/uv #16844</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>resolving a circular dependency as `lowest` results in an older version of the project being fetched</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16844">#16844</a>
        opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a>
        on 2025-11-25 14:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-11-25 14:13</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When experimenting with <code>--resolution=lowest</code> for astropy's complete dependency graph, I hit a diabolical edge case, where <code>astropy</code> has an optional dependency on <code>asdf-astropy&gt;=0.3</code>, which <em>itself</em> requires <code>astropy&gt;=5.0.4</code> (astropy's current version number is in the <code>8.0.0dev+...</code>). Apparently, uv fails to recognize that <code>astropy</code> is the package being resolved for, and it attempts to build v5.0.4 from source. This would already be a waste of time even if it worked, but it doesn't, making it harder to ignore.</p>
<p><a href="https://github.com/astropy/astropy/actions/runs/19665128196/job/56320090314?pr=18955">example logs</a>
relevant excerpt :</p>
<pre><code>Building astropy==5.0.4
  × Failed to download and build `astropy==5.0.4`
  ├─▶ Failed to resolve requirements from `build-system.requires`
  ├─▶ No solution found when resolving: `setuptools`, `setuptools-scm&gt;=6.2`,
  │   `wheel`, `cython==0.29.22`, `markupsafe==2.0.1`, `jinja2==3.0.3`,
  │   `oldest-supported-numpy`, `extension-helpers`
  ╰─▶ Because markupsafe==2.0.1 has no usable wheels and you require
      markupsafe==2.0.1, we can conclude that your requirements are
      unsatisfiable.

      hint: Wheels are required for `markupsafe` because building from
      source is disabled for `markupsafe` (i.e., with `--no-build-package
      markupsafe`)
  help: `astropy` (v5.0.4) was included because `asdf-astropy` (v0.3.0)
        depends on `astropy`
</code></pre>
<p>To add insult to injury, astropy's version number is dynamic...</p>
<p>I suppose at this point, the resolver cannot really be expected to do better than <em>taking a bet</em> and just assume that the version of astropy being built will satisfy the requirements. I think this would be fine as long as the assumption is checked after we're done building astropy.</p>
<p>I do note that there's a known workaround we can use by making astropy requiring a more recent version of asdf-astropy, but I think that's ultimately a hack, and only works because we end up downloading older versions of astropy that have matching wheels, so I'd be interested to see if there's a chance to resolve the root issue in uv instead.</p>
<p>Unfortunately I couldn't reproduce this locally on macOS (amr64), so I don't have the ability to reduce my reproducer yet.
Possibly related, but I don't think that's quite a duplicate: https://github.com/astral-sh/uv/issues/16372</p>
<h3>Platform</h3>
<p>Seen on ubuntu ubuntu-24.04</p>
<h3>Version</h3>
<p>uv==0.9.11</p>
<h3>Python version</h3>
<p>3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @neutrinoceros on 2025-11-25 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astropy/astropy/issues/18992.html">astropy/astropy#18992</a> on 2025-11-25 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-26 16:10</div>
            <div class="timeline-body"><p>The CI workflow you linked uses <code>uv pip install</code>, without <code>astropy</code> in the list of dependencies. It seems correct that <code>uv pip</code> doesn't pick up the current pyproject.toml if <code>.</code> isn't requested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "BUG: resolving a circular dependency as `lowest` results in an older version of the project being fetched" to "resolving a circular dependency as `lowest` results in an older version of the project being fetched" by @konstin on 2025-11-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-11-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-11-26 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2025-11-26 16:15</div>
            <div class="timeline-body"><p>oh, excellent point, I missed that. Well, that's a problem for tox and tox-uv then. Thank you !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @neutrinoceros on 2025-11-26 16:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
