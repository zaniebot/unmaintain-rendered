<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache is invalidated on token renewal - astral-sh/uv #3009</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cache is invalidated on token renewal</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3009">#3009</a>
        opened by <a href="https://github.com/jvdw-synth">@jvdw-synth</a>
        on 2024-04-12 06:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jvdw-synth">@jvdw-synth</a> on 2024-04-12 06:55</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<h1>Cache is invalidated on token renewal</h1>
<p>Some private package registries (e.g. <code>CodeArtifact</code>) use short-lived credentials. Since they are short-lived, the exact URL that is assigned to <code>UV_INDEX_URL</code> changes frequently and with that the cache key / hashes of these URLs. This causes the cache to be missed on token renewal.</p>
<pre><code class="language-bash">aws codeartifact login \
    --tool pip \
    --domain my_domain \
    --domain-owner 111122223333 \
    --repository my_repo

export UV_INDEX_URL=$(pip config global.index-url)

# First time, cold cache (will download)
uv pip install -r requirements.txt

# Remove
uv pip uninstall -r requirements.txt

# Desired behavior: warm cache, fast installs
uv pip install -r requirements.txt

# Remove again to clarify issue below
uv pip uninstall -r requirements.txt

# Renew credentials
aws codeartifact login \
    --tool pip \
    --domain my_domain \
    --domain-owner 111122223333 \
    --repository my_repo

export UV_INDEX_URL=$(pip config global.index-url)

# Should be warm cache, but downloads because token renewalc
uv pip install -r requirements.txt
</code></pre>
<p>Version: <code>uv 0.1.31 (7bcca28b1 2024-04-09)</code>
Platform: Macbook M2 Pro - MacOS 14.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3010.html">astral-sh/uv#3010</a> on 2024-04-12 07:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-15 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-15 14:46</div>
            <div class="timeline-body"><p>Closed by #3010.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:57 UTC
    </footer>
</body>
</html>
