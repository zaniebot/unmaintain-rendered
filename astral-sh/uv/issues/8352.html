<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> How to Use uv for Publishing a Package to Private GitLab and Install from It - astral-sh/uv #8352</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>How to Use uv for Publishing a Package to Private GitLab and Install from It</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8352">#8352</a>
        opened by <a href="https://github.com/the-korean-coder">@the-korean-coder</a>
        on 2024-10-19 00:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/the-korean-coder">@the-korean-coder</a></div>
            <div class="timeline-body"><p>Hi,</p>
<p>I'm looking for guidance on how to:</p>
<ul>
<li>Publish a Python package to a private GitLab repo using uv.</li>
<li>Install the package from the private GitLab repo in another project.
Thanks!</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-19 07:54</div>
            <div class="timeline-body"><h3>Q1: Publish a Python package to a private GitLab repo using uv.</h3>
<p>After I created the deploy tokens,  setting <code>UV_PUBLISH_URL</code>„ÄÅ<code>UV_PUBLISH_USERNAME</code> and <code>UV_PUBLISH_PASSWORD</code>, then <code>uv publish</code>
https://docs.gitlab.com/ee/user/project/deploy_tokens/
https://docs.astral.sh/uv/guides/publish/#publishing-your-package</p>
<h3>Q2: Install the package from the private GitLab repo in another project.</h3>
<p>For Q2, you should be able to find the answer in the GitLab documentation.
https://docs.gitlab.com/ee/user/packages/pypi_repository/</p>
<p>As for Q1, you can refer to it as well since they are quite similar.</p>
<p><strong>Note:</strong> Currently, UV does not support <code>.pypirc</code>. https://github.com/astral-sh/uv/issues/7676</p>
<p>Uploading packages locally is done this way for me, but it seems unnecessary to apply for Deploy tokens when uploading packages from GitLab CI/CD.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/the-korean-coder">@the-korean-coder</a> on 2024-10-19 10:37</div>
            <div class="timeline-body"><p>Thanks, i was able to publish my packages.
Now, how do I add this package to an uv project using <code>uv add</code>? What would the exact syntax or command be for that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-19 12:27</div>
            <div class="timeline-body"><blockquote>
<p>Thanks, i was able to publish my packages. Now, how do I add this package to an uv project using <code>uv add</code>? What would the exact syntax or command be for that?</p>
</blockquote>
<p>I haven't used any PyPI packages that require authentication. However, UV usually implements PEPs (Python Enhancement Proposals) and doesn't always introduce non-standard behaviors. Therefore, formats that pip can parse often only require minor modifications to work with UV.</p>
<ul>
<li>This is the documentation for the project series: uv init, uv add, uv remove, uv sync, and uv lock.
https://docs.astral.sh/uv/guides/projects/</li>
<li>This is the document about the incompatibility between UV and PIP.
https://docs.astral.sh/uv/pip/compatibility/#pre-release-compatibility</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-10-24 12:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-11-03 18:02</div>
            <div class="timeline-body"><p>I think this has been sufficiently answered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-11-03 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotk">@timotk</a> on 2024-12-18 10:33</div>
            <div class="timeline-body"><p>I had the same issue (with publishing), and it still took me some time to figure it out. So I wrote <a href="https://xebia.com/blog/how-to-publish-a-python-package-to-a-gitlab-package-registry-using-uv/">a blog post</a> about it.</p>
<p>Basically it boils down to the following <code>.gitlab-ci.yml</code>:</p>
<pre><code class="language-yaml">stages:  
  - publish  

variables:  
  PYTHON_VERSION: &quot;3.13&quot;  
  UV_VERSION: &quot;0.5.5&quot;
  UV_PUBLISH_URL: &quot;${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/pypi&quot;  
  UV_PUBLISH_USERNAME: &quot;gitlab-ci-token&quot;  
  UV_PUBLISH_PASSWORD: &quot;${CI_JOB_TOKEN}&quot;  

before_script:  
  - pip install uv==${UV_VERSION}

publish:  
  stage: publish  
  image: python:${PYTHON_VERSION}
  script:  
    # Set the version in pyproject.toml to the current git tag  
    - VERSION=$(git describe --exact-match --tags)  
    - uvx --from=toml-cli toml set --toml-path=pyproject.toml project.version $VERSION  
    # Build and publish the package  
    - uv build  
    - uv publish dist/*.whl  
  only:
    - tags
</code></pre>
<ul>
<li>Gitlab provides the current Gitlab instance url (<code>${CI_API_V4_URL}</code>) and a token (<code>${CI_JOB_TOKEN}</code>).</li>
<li><code>uv</code> picks up the <a href="https://docs.astral.sh/uv/configuration/environment/">environment variables</a> and uses those as credentials. This is a little bit easier to read then putting them in the command itself.</li>
<li>I had to apply <a href="https://github.com/astral-sh/uv/issues/6298#issuecomment-2335034247">this trick</a> for versioning since <code>uv</code> does not do dynamic versioning (yet).</li>
</ul>
<p>Hope this helps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KirkBuah">@KirkBuah</a> on 2025-06-03 09:17</div>
            <div class="timeline-body"><p>Out of curiosity, why does <code>uv publish</code> use <code>UV_PUBLISH_PASSWORD</code> instead of <code>UV_PUBLISH_TOKEN</code> in this case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-06-03 09:29</div>
            <div class="timeline-body"><p>@KirkBuah If you're looking for a more authoritative answer, I believe it's simply because that method is the one recommended in GitLab's official documentation.
If you use other methods, GitLab doesn't guarantee they'll be supported in future versions.
https://docs.gitlab.com/user/packages/pypi_repository/?tab=With+a+CI%2FCD+job+token#authenticate-with-the-gitlab-package-registry</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-03 09:41</div>
            <div class="timeline-body"><p><code>UV_PUBLISH_TOKEN</code> assumes the username <code>__token__</code> (PyPI's convention), while GitLab wants the username <code>gitlab-ci-token</code>, so we need to use <code>UV_PUBLISH_USERNAME</code>/<code>UV_PUBLISH_PASSWORD</code></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:27:48 UTC
    </footer>
</body>
</html>
