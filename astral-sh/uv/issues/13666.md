```yaml
number: 13666
title: uv unable to uninstall ruamel.yaml
type: issue
state: closed
author: hauntsaninja
labels:
  - external
assignees: []
created_at: 2025-05-26T20:27:15Z
updated_at: 2025-05-30T06:51:51Z
url: https://github.com/astral-sh/uv/issues/13666
synced_at: 2026-01-10T01:57:31Z
```

# uv unable to uninstall ruamel.yaml

---

_Issue opened by @hauntsaninja on 2025-05-26 20:27_

The old ruamel.yaml sticks around after the following:
```
rm -rf env
uv venv env
uv pip install ruamel.yaml==0.18.11
uv pip install ruamel.yaml==0.18.10
uv pip freeze
```
In contrast, pip handles this correctly:
```
uv venv env --seed
source env/bin/activate
python -m pip install ruamel.yaml==0.18.11
python -m pip install ruamel.yaml==0.18.10
python -m pip freeze
```

I suspect something funky is going on with normalisation of dist-info and RECORD files (in particular, underscore vs period). The installed RECORD files differ too depending on whether installed with pip or with uv

uv 0.7.0

---

_Renamed from "uv unable to install ruamel.yaml" to "uv unable to uninstall ruamel.yaml" by @hauntsaninja on 2025-05-26 20:27_

---

_Comment by @konstin on 2025-05-26 20:38_

ruamel.yaml 0.18.11 has an invalid RECORD, comparing [actual contents](https://inspector.pypi.io/project/ruamel-yaml/0.18.11/packages/2e/62/615a16ebbca43fd4434843e9d346d795a134d0a1ff46101c858d93c9778d/ruamel.yaml-0.18.11-py3-none-any.whl/) and [RECORD](https://inspector.pypi.io/project/ruamel-yaml/0.18.11/packages/2e/62/615a16ebbca43fd4434843e9d346d795a134d0a1ff46101c858d93c9778d/ruamel.yaml-0.18.11-py3-none-any.whl/ruamel.yaml-0.18.11.dist-info/RECORD), and pip seems to ignore the RECORD?

Files:

```
./ruamel.yaml-0.18.11.dist-info/METADATA
./ruamel.yaml-0.18.11.dist-info/RECORD
./ruamel.yaml-0.18.11.dist-info/WHEEL
./ruamel.yaml-0.18.11.dist-info/licenses/LICENSE
./ruamel.yaml-0.18.11.dist-info/top_level.txt
```

RECORD:
```
ruamel_yaml-0.18.11.dist-info/licenses/LICENSE,sha256=DOmtap1PCCkpanLHfQd5XdZ_QnUeKSK-VsBR05rhwBE,1121
ruamel_yaml-0.18.11.dist-info/METADATA,sha256=gEtWY9XJKxSPQTdzG_ETiVFWoyENhDKTRmWatOnRGDM,23962
ruamel_yaml-0.18.11.dist-info/WHEEL,sha256=zaaOINJESkSfm_4HQVc5ssNzHCPXhJm0kEUakpsEHaU,91
ruamel_yaml-0.18.11.dist-info/top_level.txt,sha256=lu5ar9ilvyS03jNvS5x9I0_3NwCKkvIlY2k0QH9AArk,7
ruamel_yaml-0.18.11.dist-info/RECORD,,
```

---

_Comment by @hauntsaninja on 2025-05-26 20:42_

How would pip uninstall if it ignores RECORD? But there is something interesting where the pip installed version inserts extra entries into the RECORD...

---

_Comment by @hauntsaninja on 2025-05-26 20:42_

With uv:
```
ruamel.yaml-0.18.11.dist-info/INSTALLER,sha256=5hhM4Q4mYTT9z6QB6PGpUAW81PGNFrYrdXMj4oM_6ak,2
ruamel.yaml-0.18.11.dist-info/REQUESTED,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
...
ruamel_yaml-0.18.11.dist-info/METADATA,sha256=gEtWY9XJKxSPQTdzG_ETiVFWoyENhDKTRmWatOnRGDM,23962
ruamel_yaml-0.18.11.dist-info/RECORD,,
ruamel_yaml-0.18.11.dist-info/WHEEL,sha256=zaaOINJESkSfm_4HQVc5ssNzHCPXhJm0kEUakpsEHaU,91
ruamel_yaml-0.18.11.dist-info/licenses/LICENSE,sha256=DOmtap1PCCkpanLHfQd5XdZ_QnUeKSK-VsBR05rhwBE,1121
ruamel_yaml-0.18.11.dist-info/top_level.txt,sha256=lu5ar9ilvyS03jNvS5x9I0_3NwCKkvIlY2k0QH9AArk,7
```
With pip:
```
ruamel.yaml-0.18.11.dist-info/INSTALLER,sha256=zuuue4knoyJ-UwPPXg8fezS7VCrXJQrAP7zeNuwvFQg,4
ruamel.yaml-0.18.11.dist-info/METADATA,,
ruamel.yaml-0.18.11.dist-info/RECORD,,
ruamel.yaml-0.18.11.dist-info/REQUESTED,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
ruamel.yaml-0.18.11.dist-info/WHEEL,,
ruamel.yaml-0.18.11.dist-info/licenses/LICENSE,,
ruamel.yaml-0.18.11.dist-info/top_level.txt,,
...
pip also lists a bunch of pycache entries in here
...
ruamel_yaml-0.18.11.dist-info/METADATA,sha256=gEtWY9XJKxSPQTdzG_ETiVFWoyENhDKTRmWatOnRGDM,23962
ruamel_yaml-0.18.11.dist-info/RECORD,,
ruamel_yaml-0.18.11.dist-info/WHEEL,sha256=zaaOINJESkSfm_4HQVc5ssNzHCPXhJm0kEUakpsEHaU,91
ruamel_yaml-0.18.11.dist-info/licenses/LICENSE,sha256=DOmtap1PCCkpanLHfQd5XdZ_QnUeKSK-VsBR05rhwBE,1121
ruamel_yaml-0.18.11.dist-info/top_level.txt,sha256=lu5ar9ilvyS03jNvS5x9I0_3NwCKkvIlY2k0QH9AArk,7
```

---

_Comment by @konstin on 2025-05-26 21:28_

Filed upstream: https://sourceforge.net/p/ruamel-yaml/tickets/544/

---

_Label `external` added by @konstin on 2025-05-26 21:29_

---

_Comment by @konstin on 2025-05-26 21:30_

My preferred outcome would be a fix on the ruamel.yaml side, but we can add a workaround if they don't fix it and it causes enduring breakage.

---

_Comment by @hauntsaninja on 2025-05-26 21:58_

Thanks! Was worried I would have to figure out how to make a SourceForge account :-)

If you do want to match `pip`, it looks like they just modify RECORD at installation time to include all the files they know they've installed:
https://github.com/pypa/pip/blob/502d08cc404625c9687e0c1aa08f502994e0fc18/src/pip/_internal/operations/install/wheel.py#L452-L704

Maybe they got tired of their users sounding like a broken record about broken RECORDs...

---

_Comment by @dimbleby on 2025-05-27 15:15_

I would guess that ruamel.yaml broke by trying to do something manual - where they only needed to use a newer version of setuptools to build their wheels.

Perhaps uv should consider validating during installation, compare:
```
$ poetry add ruamel.yaml
Using version ^0.18.11 for ruamel-yaml

Updating dependencies
Resolving dependencies... (0.3s)

Package operations: 2 installs, 0 updates, 0 removals

  - Installing ruamel-yaml-clib (0.2.12)
  - Installing ruamel-yaml (0.18.11)
Warning: Validation of the RECORD file of ruamel.yaml-0.18.11-py3-none-any.whl failed. Please report to the maintainers of that package so they can fix their build process. Details:
In /home/dch/.cache/pypoetry/artifacts/03/7f/48/26d941431e21e84e85c3dd17696c9db678f19b3170bab766b85af7fdb1/ruamel.yaml-0.18.11-py3-none-any.whl, ruamel.yaml-0.18.11.dist-info/METADATA is not mentioned in RECORD
In /home/dch/.cache/pypoetry/artifacts/03/7f/48/26d941431e21e84e85c3dd17696c9db678f19b3170bab766b85af7fdb1/ruamel.yaml-0.18.11-py3-none-any.whl, ruamel.yaml-0.18.11.dist-info/RECORD is not mentioned in RECORD
In /home/dch/.cache/pypoetry/artifacts/03/7f/48/26d941431e21e84e85c3dd17696c9db678f19b3170bab766b85af7fdb1/ruamel.yaml-0.18.11-py3-none-any.whl, ruamel.yaml-0.18.11.dist-info/WHEEL is not mentioned in RECORD
In /home/dch/.cache/pypoetry/artifacts/03/7f/48/26d941431e21e84e85c3dd17696c9db678f19b3170bab766b85af7fdb1/ruamel.yaml-0.18.11-py3-none-any.whl, ruamel.yaml-0.18.11.dist-info/licenses/LICENSE is not mentioned in RECORD
In /home/dch/.cache/pypoetry/artifacts/03/7f/48/26d941431e21e84e85c3dd17696c9db678f19b3170bab766b85af7fdb1/ruamel.yaml-0.18.11-py3-none-any.whl, ruamel.yaml-0.18.11.dist-info/top_level.txt is not mentioned in RECORD


Writing lock file
```

---

_Comment by @AvdN on 2025-05-29 06:03_

This should be fixed in 0.18.12, should be out soon

---

_Comment by @AvdN on 2025-05-30 06:14_

0.18.12 is out with the fix for this. I tested the .whl with
```
uv venv /opt/util/testuninstall
uv pip install --python /opt/util/testuninstall ruamel.yaml-0.18.12-py3-none-any.whl
uv pip uninstall --python /opt/util/testuninstall ruamel.yaml ruamel.yaml.clib
find /opt/util/testuninstall/lib/python3.13/site-packages | fgrep ruamel
```
and the last command had no (longer) any output

---

_Comment by @konstin on 2025-05-30 06:51_

Thank you!

---

_Closed by @konstin on 2025-05-30 06:51_

---
