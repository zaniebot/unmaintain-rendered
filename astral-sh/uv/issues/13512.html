<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV seems to identify the wrong platform for torch - astral-sh/uv #13512</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV seems to identify the wrong platform for torch</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13512">#13512</a>
        opened by <a href="https://github.com/snowblink14">@snowblink14</a>
        on 2025-05-18 05:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/snowblink14">@snowblink14</a></div>
            <div class="timeline-body">Summary
<p>I&#x27;m trying to use <code>uv sync</code> from a <code>uv.lock</code> file in an open-source repo on my Mac (Apple M3 pro), but get the following error when installing torch 2.6.0:</p>
<pre><code>error: Distribution `torch==2.6.0 @ registry+https://pypi.org/simple` can&#x27;t be installed because it doesn&#x27;t have a source distribution or wheel for the current platform

hint: You&#x27;re on macOS (`macosx_15_0_x86_64`), but `torch` (v2.6.0) only has wheels for the following platforms: `manylinux_2_28_aarch64`, `manylinux1_x86_64`, `macosx_11_0_arm64`, `win_amd64`
</code></pre>
<p>But my mac actually should use <code>macosx_11_0_arm64</code>. When I use <code>python -m venv</code> to create another virtual environment and run <code>pip install torch==2.6.0</code>, it successfully installs from <code>torch-2.6.0-cp310-none-macosx_11_0_arm64.whl</code>.</p>
<p>It seems to be uv problem. When I tried to run <code>uv pip install torch</code> it can only install torch=2.2.2. Installing higher version results in similar error.</p>
<p>FYI the open source project I was playing with is <code>https://github.com/OpenPipe/ART</code>.</p>
Platform
<p>Darwin 24.4.0 arm64</p>
Version
<p>uv 0.7.3 (Homebrew 2025-05-07)</p>
Python version
<p>The above error prevents me from getting result from <code>uv run python --version</code>. requires-python = &quot;&gt;=3.10&quot; in pyproject.toml.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/snowblink14">@snowblink14</a> on 2025-05-18 05:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-05-18 06:43</div>
            <div class="timeline-body"><p>I&#x27;m not a macOS user myself, but I dug through the uv source code a bit. It seems uv gets platform information from the <code>MACOSX_DEPLOYMENT_TARGET</code> environment variable, and if it&#x27;s not found, it defaults to version <code>13.0</code>.
By the way, I recommend using <code>--verbose</code>. This will help whoever is assisting you in debugging the issue pinpoint the problem better.
For this issue, I think you also need to provide the value of <code>MACOSX_DEPLOYMENT_TARGET</code>.
https://docs.astral.sh/uv/configuration/environment/#macosx_deployment_target
https://github.com/astral-sh/uv/blob/d4e8df9b94ac4ffc8e9214fab30d9af1bd9c80df/crates/uv-configuration/src/target_triple.rs#L243-L249
https://github.com/astral-sh/uv/blob/d4e8df9b94ac4ffc8e9214fab30d9af1bd9c80df/crates/uv-configuration/src/target_triple.rs#L753-L764</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-18 12:37</div>
            <div class="timeline-body"><p>For context on that default version, see <a href="https://github.com/astral-sh/uv/pull/12518">astral-sh/uv#12518</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-18 14:42</div>
            <div class="timeline-body"><p>Did you try <code>uv cache clean</code>? If you&#x27;re seeing that, then we must&#x27;ve queried your interpreter at some point and seen it return x86.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-18 15:25</div>
            <div class="timeline-body"><p>Can you share <code>uv python find -v</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowblink14">@snowblink14</a> on 2025-05-18 17:33</div>
            <div class="timeline-body"><p>Thank you all! It&#x27;s indeed possible that uv previously queried interpreter as <code>x86_64</code> since I migrated from my old mac.</p>
<p>I&#x27;ve tried to run <code>uv cache clean</code> and it cleaned the cache, but the result of <code>uv sync</code> still result in the same error.</p>
<p>Result of <code>uv python find -v</code>:</p>
<pre><code>DEBUG uv 0.7.3 (Homebrew 2025-05-07)
DEBUG Found project root: `/Users/sc/github_projects/ART`
DEBUG No workspace root found, using project root
DEBUG Reading Python requests from version file at `/Users/sc/github_projects/ART/.python-version`
DEBUG Using Python request `3.10` from version file at `.python-version`
DEBUG Searching for Python 3.10 in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.10.0-macos-x86_64-none` at `/Users/sc/github_projects/ART/.venv/bin/python3` (virtual environment)
/Users/sc/github_projects/ART/.venv/bin/python3
</code></pre>
<p>I did try to run <code>uv python uninstall 3.10</code> and <code>uv python install 3.10</code> but it still installs <code>cpython-3.10.17-macos-x86_64-none</code>.</p>
<p>The <code>uv sync verbose</code> result is as follows:</p>
<pre><code>DEBUG uv 0.7.3 (Homebrew 2025-05-07)
DEBUG Found project root: `/Users/sc/github_projects/ART`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/Users/sc/github_projects/ART`
DEBUG Reading Python requests from version file at `/Users/sc/github_projects/ART/.python-version`
DEBUG Using Python request `3.10` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
warning: Ignoring existing virtual environment linked to non-existent Python interpreter: .venv/bin/python3 -&gt; python
DEBUG Searching for Python 3.10 in managed installations or search path
DEBUG Searching for managed installations at `/Users/sc/.local/share/uv/python`
DEBUG Skipping incompatible managed installation `cpython-3.13.3-macos-x86_64-none`
DEBUG Skipping incompatible managed installation `cpython-3.12.10-macos-x86_64-none`
DEBUG Skipping incompatible managed installation `cpython-3.11.12-macos-x86_64-none`
DEBUG Found managed installation `cpython-3.10.17-macos-x86_64-none`
DEBUG Found `cpython-3.10.17-macos-x86_64-none` at `/Users/sc/.local/share/uv/python/cpython-3.10.17-macos-x86_64-none/bin/python3.10` (managed installations)
Using CPython 3.10.17
Removed virtual environment at: .venv
Creating virtual environment at: .venv
DEBUG Assessing Python executable as base candidate: /Users/sc/.local/share/uv/python/cpython-3.10.17-macos-x86_64-none/bin/python3.10
DEBUG Using base executable for virtual environment: /Users/sc/.local/share/uv/python/cpython-3.10.17-macos-x86_64-none/bin/python3.10
DEBUG Released lock at `/var/folders/_n/hdcb30656qn99fhl2yryrgq40000gn/T/uv-b1a9aca7e84223b5.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: openpipe-art @ file:///Users/sc/github_projects/ART
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 317 packages in 67ms
error: Distribution `torch==2.6.0 @ registry+https://pypi.org/simple` can&#x27;t be installed because it doesn&#x27;t have a source distribution or wheel for the current platform

hint: You&#x27;re on macOS (`macosx_15_0_x86_64`), but `torch` (v2.6.0) only has wheels for the following platforms: `manylinux_2_28_aarch64`, `manylinux1_x86_64`, `macosx_11_0_arm64`, `win_amd64`
</code></pre>
<p>I still need a way to let uv install arm64 version instead of x86_64 version for macosx, I guess.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-20 13:09</div>
            <div class="timeline-body"><p>Is your terminal running under Rosetta or something?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowblink14">@snowblink14</a> on 2025-05-20 20:45</div>
            <div class="timeline-body"><blockquote>
<p>Is your terminal running under Rosetta or something?</p>
</blockquote>
<p>No. I was simply using the terminal under Cursor. If I switch to iTerm2 the results are the same.</p>
<p>Uninstalled my brew uv installation and use <code>curl -LsSf https://astral.sh/uv/install.sh | sh</code> instead. Now the version is <code>uv 0.7.6 (7f3e94a09 2025-05-19)</code> but the result is the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/snowblink14">@snowblink14</a> on 2025-05-27 17:51</div>
            <div class="timeline-body"><p>FYI I resolved this by deleting the repo, redo <code>git clone</code> and rerun <code>uv sync</code>. Now uv is able to recognize the correct aarch64 architecture for mac.</p>
<p>But it never worked when <code>uv</code> had cache and recognized the arch as <code>x86_64</code> even after running <code>uv cache clean</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sheilahu">@sheilahu</a> on 2025-09-23 16:17</div>
            <div class="timeline-body"><p>Providing another data point on this. I ran into this issue after running <code>uv sync</code>. And this error message popped up:</p>
<pre><code>error: Distribution `torch==2.8.0 @ registry+https://pypi.org/simple` can&#x27;t be installed because it doesn&#x27;t have a source distribution or wheel for the current platform

hint: You&#x27;re on macOS (`macosx_15_0_x86_64`), but `torch` (v2.8.0) only has wheels for the following platforms: `manylinux_2_28_aarch64`, `manylinux_2_28_x86_64`, `macosx_11_0_arm64`, `win_amd64`; consider adding your platform to `tool.uv.required-environments` to ensure uv resolves to a version with compatible wheels
</code></pre>
<p>After reading everything mentioned above, I decided to install torch directly with pip:</p>
<pre><code>pip install torch==2.8.0
</code></pre>
<p>and it says no such version exists:</p>
<pre><code>ERROR: Could not find a version that satisfies the requirement torch==2.8.0 (from versions: 2.2.0, 2.2.1, 2.2.2)
</code></pre>
<p>So I realized the <code>pyproject.toml</code> file in my directory is pointing the requirement of torch to be &gt;= 2.8.0</p>
<pre><code>[dependency-groups]
dev = [
    &quot;torch&gt;= 2.8.0&quot;,
]
</code></pre>
<p>Once I downgrade this requirement to <code>==2.2.2</code>, and ran <code>uv cache clean</code>, I&#x27;m able to run <code>uv sync</code> without problem.</p>
<p>This error message that indicates I&#x27;m on an intel system where in reality I&#x27;m running on arm64 is quite misleading.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-23 17:11</div>
            <div class="timeline-body"><blockquote>
<p>This error message that indicates I&#x27;m on an intel system where in reality I&#x27;m running on arm64 is quite misleading.</p>
</blockquote>
<p>The platform comes from the Python interpreter you&#x27;re using since we need to find packages matching that. x86-64 is transparently emulatable on arm64, so it&#x27;s very likely you&#x27;re running an x86-64 interpreter unintentionally as was happening in <a href="https://github.com/astral-sh/uv/issues/13512">astral-sh/uv#13512</a>#issuecomment-2889112822. If you share <code>uv python find -v</code> in the project, I assume you&#x27;ll see an x86-64 interpreter is being used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ricardobeat">@ricardobeat</a> on 2025-11-10 18:49</div>
            <div class="timeline-body"><p>For what it&#x27;s worth, I just had the same issue, and it turns out <code>uv</code> itself was running in x86-64. This is due to carrying over homebrew from an older Intel machine, where it was running under Rosetta for compatibility at the time. You can check this with</p>
<pre><code>file &quot;$(which uv)&quot;
</code></pre>
<p>It should say <code>arm64</code>. If it doesn&#x27;t, <code>brew uninstall uv</code>, reinstall Homebrew and uv again, make sure you create a new venv and everything should be running arm64 versions as intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BradyAJohnston">@BradyAJohnston</a> on 2025-11-24 18:13</div>
            <div class="timeline-body"><p>I haven&#x27;t done anything with torch so I don&#x27;t know what steps occurred but I ended up running into this issue also.</p>
<p>There was a python installation here: <code>~/.local/share/uv/python/cpython-3.11.14-macos-x86_64-none/</code>. Alongside other arm64 installs. Removing that folder completely solved the issue for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nkalinov">@nkalinov</a> on 2025-11-25 08:18</div>
            <div class="timeline-body"><p>&quot;Brand new&quot; M3 was also showing a x86 arch in <code>uv python find -v</code>.
Fixed by creating a new env with explicit python arm64 version: <code>uv venv --python cpython-3.12.3-macos-aarch64-none</code> after which torch automatically resolved to the latest version in <code>uv add</code></p>
<p>Ref: https://docs.astral.sh/uv/concepts/python-versions/#requesting-a-version</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-26 16:39</div>
            <div class="timeline-body"><p>@nkalinov Have you checked whether uv itself or your terminal are running under Rosetta 2 emulation, or whether you previously used an x86_64 Python interpreter?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nguyentiendan">@nguyentiendan</a> on 2025-12-29 01:10</div>
            <div class="timeline-body"><p>I have fix error as below</p>
<p><strong>pyproject.toml file.</strong> Add torch&gt;= 2.2.2 to dependency-groups</p>
<p>[dependency-groups]
dev = [
&quot;torch&gt;= 2.8.0&quot;,
]</p>
<p><strong>uv.lock file</strong>
Update package torch 2.8.0 to 2.2.2</p>
<p>Run command
uv cache clean
uv sync</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:41 UTC
    </footer>
</body>
</html>
