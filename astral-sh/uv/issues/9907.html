<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>resolver: requiring `PyQt5` produces non-portable locks - astral-sh/uv #9907</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>resolver: requiring `PyQt5` produces non-portable locks</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9907">#9907</a>
        opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a>
        on 2024-12-15 07:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2024-12-15 07:58</div>
            <div class="timeline-body"><p>Ok this is a weird one. Let's start with what uv 0.5.9 does (or older versions too, as far as I could check):</p>
<pre><code>mkdir test
cd test
uv init
uv add PyQt5
</code></pre>
<p>and let's look at the relevant portion of the resulting lock file. For context, <code>PyQt5-Qt5</code> is a dependency to <code>PyQt5</code>:</p>
<pre><code>[[package]]
name = &quot;pyqt5-qt5&quot;
version = &quot;5.15.15&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/4a/6e/a5789bac6310208756fc6a36fd7e01caa86ea6ae7abbb5922dcea003a215/PyQt5_Qt5-5.15.15-py3-none-macosx_10_13_x86_64.whl&quot;, hash = &quot;sha256:eb74072935958a830887115b1de1ff26341fc2d5881b28129de39612b10a260e&quot;, size = 39147807 },
    { url = &quot;https://files.pythonhosted.org/packages/92/4c/c9026ca280f2cd4bef562cfb0a5050eb23f1e7fe1b85aa8455eb6ea437bf/PyQt5_Qt5-5.15.15-py3-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:f8b174725fbe29c1a22f8acce5798933a65c8a083f1d9833ff212479ec2b3c14&quot;, size = 36953104 },
    { url = &quot;https://files.pythonhosted.org/packages/95/70/1ba9b828387f42e0812b496ed637a950bf57a5d59b844d034841e8f9fb4f/PyQt5_Qt5-5.15.15-py3-none-manylinux2014_x86_64.whl&quot;, hash = &quot;sha256:611505d04ffb06a5e5bcf98f5ff0e4e15ba7785565ccbe7bd3b2e40642ea3bdd&quot;, size = 59827278 },
]
</code></pre>
<p>It is evident that the version that uv selected (the current latest) doesn't have wheels for windows. Unfortunately there a no source distribution either, so this lock file just doesn't port to windows.
Looking at https://pypi.org/simple/pyqt5-qt5/</p>
<blockquote>
<p><a href="https://files.pythonhosted.org/packages/62/09/99a222b0360616250fb2e6003a54e43a2a06b0774f0f8d5daafb86a2c375/PyQt5_Qt5-5.15.2-py3-none-macosx_10_13_intel.whl#sha256=76980cd3d7ae87e3c7a33bfebfaee84448fd650bad6840471d6cae199b56e154">PyQt5_Qt5-5.15.2-py3-none-macosx_10_13_intel.whl</a>
<a href="https://files.pythonhosted.org/packages/83/d4/241a6a518d0bcf0a9fcdcbad5edfed18d43e884317eab8d5230a2b27e206/PyQt5_Qt5-5.15.2-py3-none-manylinux2014_x86_64.whl#sha256=1988f364ec8caf87a6ee5d5a3a5210d57539988bf8e84714c7d60972692e2f4a">PyQt5_Qt5-5.15.2-py3-none-manylinux2014_x86_64.whl</a>
<a href="https://files.pythonhosted.org/packages/1c/7e/ce7c66a541a105fa98b41d6405fe84940564695e29fc7dccf6d9e8c5f898/PyQt5_Qt5-5.15.2-py3-none-win32.whl#sha256=9cc7a768b1921f4b982ebc00a318ccb38578e44e45316c7a4a850e953e1dd327">PyQt5_Qt5-5.15.2-py3-none-win32.whl</a>
<a href="https://files.pythonhosted.org/packages/37/97/5d3b222b924fa2ed4c2488925155cd0b03fd5d09ee1cfcf7c553c11c9f66/PyQt5_Qt5-5.15.2-py3-none-win_amd64.whl#sha256=750b78e4dba6bdf1607febedc08738e318ea09e9b10aea9ff0d73073f11f6962">PyQt5_Qt5-5.15.2-py3-none-win_amd64.whl</a>
<a href="https://files.pythonhosted.org/packages/e1/66/3f374e3f9e74c1bc5659c23f6312d12684d8f78782d3b51c874c3657fa69/PyQt5_Qt5-5.15.11-1-py3-none-macosx_11_0_arm64.whl#sha256=9bb0d816de8c003ce41881e39fe5d64c2cdf5e8ca96b6c016c34f8e0bdc30768">PyQt5_Qt5-5.15.11-1-py3-none-macosx_11_0_arm64.whl</a>
<a href="https://files.pythonhosted.org/packages/66/f5/0a684b2b33b1f1dceaf894d4e8a105f523bb08003f81c89a91e509c5f854/PyQt5_Qt5-5.15.11-py3-none-macosx_10_13_x86_64.whl#sha256=109c418d221538751e4d7755a81c978ee31abbd65facb3f1f361dca74a1b758a">PyQt5_Qt5-5.15.11-py3-none-macosx_10_13_x86_64.whl</a>
<a href="https://files.pythonhosted.org/packages/e0/ff/7ca1897bfb045562090491e3c368b3d2034dcdc04a92efae1e765564309a/PyQt5_Qt5-5.15.11-py3-none-macosx_11_0_arm64.whl#sha256=3cccb21942eb49d21fb0193f28e3e8ae3d35395f158e8a9d4d58e23efa3a2ea7">PyQt5_Qt5-5.15.11-py3-none-macosx_11_0_arm64.whl</a>
<a href="https://files.pythonhosted.org/packages/be/3c/0f2ab2ef3bdf93ddb6834540613add6fca9ba76de08deb4a2465bb108088/PyQt5_Qt5-5.15.12-py3-none-macosx_10_13_x86_64.whl#sha256=7adff02a33f2f82b409ca115d57fc7e39b22e673d29e35c9d2594164039f0f71">PyQt5_Qt5-5.15.12-py3-none-macosx_10_13_x86_64.whl</a>
<a href="https://files.pythonhosted.org/packages/46/c0/8d23f1e671fa63345d82852cf6734ade99f7dc69452ceed757afdcc6a868/PyQt5_Qt5-5.15.12-py3-none-macosx_11_0_arm64.whl#sha256=b4c56566683ae905d5f04dd6ab925f02a384d6ce5ff4986eea0720d453666c22">PyQt5_Qt5-5.15.12-py3-none-macosx_11_0_arm64.whl</a>
<a href="https://files.pythonhosted.org/packages/40/dc/96d9d0ba0d13256343b53efffe8729f278e62409ab4c937bb22e70ab98ac/PyQt5_Qt5-5.15.13-py3-none-macosx_10_13_x86_64.whl#sha256=92575a9e96a27c4ed67c56c7048ded7461a1655d5d21f0e05064664e6e9fcbdf">PyQt5_Qt5-5.15.13-py3-none-macosx_10_13_x86_64.whl</a>
<a href="https://files.pythonhosted.org/packages/c9/8b/4441c208c8ca29b50fab6467ebfa32b6401d16c5c915a031a48dc85dfa7a/PyQt5_Qt5-5.15.13-py3-none-macosx_11_0_arm64.whl#sha256=141859f2ffe04cc6c5db970e2b6ad9f98897805d886a14c52614e3799daab6d6">PyQt5_Qt5-5.15.13-py3-none-macosx_11_0_arm64.whl</a>
<a href="https://files.pythonhosted.org/packages/41/6c/fb7bfdf7345ef3ce8b1ed8ae67374cae177b0ea89928490de063932ae284/PyQt5_Qt5-5.15.14-py3-none-macosx_10_13_x86_64.whl#sha256=c89b35b2aaf24d2805cc76fe31880c77b7f7557db8aafb26f1015f1bba7031d6">PyQt5_Qt5-5.15.14-py3-none-macosx_10_13_x86_64.whl</a>
<a href="https://files.pythonhosted.org/packages/bf/b4/99c33cfe20b58426302783096a882a3defef0bc594c7891ff58c6122132c/PyQt5_Qt5-5.15.14-py3-none-macosx_11_0_arm64.whl#sha256=730da7e6a97f6bad1b6df21082fe625647730418bc83e20cbc2ff6401ed0a8be">PyQt5_Qt5-5.15.14-py3-none-macosx_11_0_arm64.whl</a>
<a href="https://files.pythonhosted.org/packages/2d/4c/5c9824e9844d03e2a32e7e89b28f7fd55765515dfabd4e4f2bb1f16a6d75/PyQt5_Qt5-5.15.14-py3-none-manylinux2014_x86_64.whl#sha256=aa3911276b1a1aa9b5b9cba687ef905faddd706980d34e234312591c3d3cbef8">PyQt5_Qt5-5.15.14-py3-none-manylinux2014_x86_64.whl</a>
<a href="https://files.pythonhosted.org/packages/4a/6e/a5789bac6310208756fc6a36fd7e01caa86ea6ae7abbb5922dcea003a215/PyQt5_Qt5-5.15.15-py3-none-macosx_10_13_x86_64.whl#sha256=eb74072935958a830887115b1de1ff26341fc2d5881b28129de39612b10a260e">PyQt5_Qt5-5.15.15-py3-none-macosx_10_13_x86_64.whl</a>
<a href="https://files.pythonhosted.org/packages/92/4c/c9026ca280f2cd4bef562cfb0a5050eb23f1e7fe1b85aa8455eb6ea437bf/PyQt5_Qt5-5.15.15-py3-none-macosx_11_0_arm64.whl#sha256=f8b174725fbe29c1a22f8acce5798933a65c8a083f1d9833ff212479ec2b3c14">PyQt5_Qt5-5.15.15-py3-none-macosx_11_0_arm64.whl</a>
<a href="https://files.pythonhosted.org/packages/95/70/1ba9b828387f42e0812b496ed637a950bf57a5d59b844d034841e8f9fb4f/PyQt5_Qt5-5.15.15-py3-none-manylinux2014_x86_64.whl#sha256=611505d04ffb06a5e5bcf98f5ff0e4e15ba7785565ccbe7bd3b2e40642ea3bdd">PyQt5_Qt5-5.15.15-py3-none-manylinux2014_x86_64.whl</a></p>
</blockquote>
<p>we can see that there are wheels for older versions on Windows (<code>PyQt5-Qt5==5.15.2</code>). Unfortunately <em>no</em> single version has wheels for all major platforms: <code>PyQt5-Qt5==5.15.2</code> misses a wheel for <code>macosx</code> + <code>arm64</code>.</p>
<p>My expectation would be that <code>uv</code>'s resolver could detect this problem and fork the requirements automatically, but it doesn't.
Admittedly this is an exceptional setup, and I would understand that it falls out of scope somehow, especially considering that it could be resolved downstream if <code>PyQt5-Qt5</code> just shipped more wheels. I just thought it was similar (at least in spirit) to the problem solved by https://github.com/astral-sh/uv/pull/9827, so I figured it was worth a shot.</p>
<p>Meanwhile, a usable workaround for me is to manually write the fork in my requirements as</p>
<pre><code>&quot;PyQt5-Qt5==5.15.2 ; platform_system == 'Windows'&quot;,
&quot;PyQt5-Qt5&gt;=5.15.14 ; platform_system != 'Windows'&quot;,
</code></pre>
<p>which I can hide away from users into a dependency group (where a user-visible requirement would be much more inconvenient).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../1313e/CMasher/pulls/188.html">1313e/CMasher#188</a> on 2024-12-15 08:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-15 13:45</div>
            <div class="timeline-body"><p>Thanks! This is another case of #9711: for packages that lack source distributions, we can end up with &quot;incomplete&quot; resolutions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-12-15 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2024-12-15 14:08</div>
            <div class="timeline-body"><p>Oh, sorry I missed it ! Of course, feel free to close this one as a dup'
Thanks !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-15 14:48</div>
            <div class="timeline-body"><p>I'll merge into that issue. I'm thinking about that problem now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-15 14:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../neuroinformatics-unit/movement/pulls/683.html">neuroinformatics-unit/movement#683</a> on 2025-10-29 20:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
