<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV ignores extra dependencies for overrided library - astral-sh/uv #16484</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV ignores extra dependencies for overrided library</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16484">#16484</a>
        opened by <a href="https://github.com/Wintreist">@Wintreist</a>
        on 2025-10-28 13:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Wintreist">@Wintreist</a></div>
            <div class="timeline-body">Summary
<p>Hi!
I am testing the changes in the &quot;my-testing-lib&quot; library. It is also used by other libraries from my repository, so I can&#x27;t just change the link in sources to the branch where I&#x27;m testing it, so I use override-dependencies to force download it from the branch I need. But there was a problem that UV does not install any libraries from the &quot;gui&quot; group of extra dependencies</p>
<p>MyLib pyproject.toml</p>
<pre><code>[project]
name = &quot;my-lib&quot;
version = &quot;0.1.0&quot;
dependencies = [
    ...
]
[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
[tool.uv]
override-dependencies = [
    &quot;my-testing-lib @ git+ssh://my-git-repo@TESTING-BRANCH#subdirectory=my_testing_lib&quot;
]
[tool.uv.sources]
...
# my-testing-lib = { git = &quot;ssh://my-git-repo&quot;, subdirectory = &quot;my_testing_lib&quot; }

[dependency-groups]
dev = [
    ...
    &quot;my-testing-lib[gui]&quot;,
]
</code></pre>
<p>MyTestingLib pyproject.toml:</p>
<pre><code>[project]
name = &quot;my-testing-lib&quot;
version = &quot;0.1.0&quot;
dependencies = [
    ...
]
[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project.optional-dependencies]
gui = [
    ...
    &quot;pyqt-extra-dep-lib&quot;,
]

[tool.uv.sources]
...
pyqt-extra-dep-lib = { git = &quot;ssh://git@my-git-repo&quot;, subdirectory = &quot;pyqt_extra_dep_lib&quot; }
</code></pre>
<p>If I try to run the command with override-dependencies, it won&#x27;t find anything.</p>
<pre><code>(my-lib) PS D:\...\Repositories\my-lib&gt; uv tree --package pyqt-extra-dep-lib
Resolved 232 packages in 1ms
(my-lib) PS D:\...\Repositories\my-lib&gt; 
</code></pre>
<p>But if I return everything to the standard view and synchronize venv, the library will be installed:</p>
<pre><code>(my-lib) PS D:\...\Repositories\my-lib&gt; uv tree --package pyqt-extra-dep-lib --reverse
Resolved 236 packages in 1ms
pyqt-extra-dep-lib v0.1.0
└── my-testing-lib v0.1.0 (extra: gui)
    └── my-lib[gui] v0.1.0 (group: dev)
(my-lib) PS D:\...\Repositories\my-lib&gt;
</code></pre>
Platform
<p>Windows 10 x86_64</p>
Version
<p>uv 0.9.5</p>
Python version
<p>3.12.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/Wintreist">@Wintreist</a> on 2025-10-28 13:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-28 14:26</div>
            <div class="timeline-body"><p>This behavior is by design, overrides replace all existing mentions of a package, including extras, with the new specifier. This is exists to support cases where you want to change the extra too.</p>
<blockquote>
<p>It is also used by other libraries from my repository, so I can&#x27;t just change the link in sources to the branch where I&#x27;m testing it, so I use override-dependencies to force download it from the branch I need.</p>
</blockquote>
<p>I&#x27;m not following, what happens if you use sources for it? Alternatively, can you use <code>constraint-dependencies</code> to set the URL? Constraints can also set a URL, but don&#x27;t remove extras.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wintreist">@Wintreist</a> on 2025-10-28 15:07</div>
            <div class="timeline-body"><p>@konstin</p>
<blockquote>
<p>I&#x27;m not following, what happens if you use sources for it?</p>
</blockquote>
<p>Conditionally, this will happen:</p>
<pre><code>  × Failed to resolve dependencies for `other-lib` (v0.1.1)
  ╰─▶ Requirements contain conflicting URLs for package `my-testing-lib` in all marker environments:
      - git+ssh://git@my-git-repo@TESTING-BRANCH#subdirectory=my_testing_lib
      - git+ssh://git@my-git-repo#subdirectory=my_testing_lib
  help: `other-lib` (v0.1.1) was included because `my-lib` (v0.1.0) depends on `other-lib`
</code></pre>
<blockquote>
<p>This is exists to support cases where you want to change the extra too.</p>
</blockquote>
<p>But if I want to override extra dependencies, I will specify them in &quot;my-lib&quot; pyproject.toml:</p>
<pre><code>[tool.uv]
override-dependencies = [
    &quot;my-testing-lib @ git+ssh://my-git-repo@TESTING-BRANCH#subdirectory=my_testing_lib&quot;
    &quot;pyqt-extra-dep-lib @ git+ssh://git@my-git-repo@TESTING-BRANCH#subdirectory=pyqt_extra_dep_lib&quot;
]
</code></pre>
<blockquote>
<p>Alternatively, can you use constraint-dependencies to set the URL?</p>
</blockquote>
<p>I didn&#x27;t quite figure out the difference between override and constraint, but I replaced override with constraint and an error occurred:</p>
<pre><code>[tool.uv]
constraint-dependencies = [
    &quot;my-testing-lib @ git+ssh://my-git-repo@TESTING-BRANCH#subdirectory=my_testing_lib&quot;
]
</code></pre>
<pre><code>  × Failed to resolve dependencies for `my-testing-lib` (v0.1.0)
  ╰─▶ Package `pyqt-extra-dep-lib` was included as a URL dependency. URL dependencies must be expressed as direct requirements or constraints. Consider adding `pyqt-extra-dep-lib @
      git+ssh://git@my-git-repo#subdirectory=pyqt_extra_dep_lib` to your dependencies or constraints file.
  help: `my-testing-lib` (v0.1.0) was included because `my-lib:dev` (v0.1.0) depends on `my-testing-lib`
</code></pre>
<p>As I understand it, UV wants me to manually specify where to get the dependency &quot;pyqt-extra-dep-lib&quot;
But I don&#x27;t need it. It&#x27;s enough for me to override only the library under test. If I want to override something else, I&#x27;ll do it on purpose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-28 15:55</div>
            <div class="timeline-body"><p>Sorry, I&#x27;m a but lost what&#x27;s happening here, can you share a repo that reproduces the problem?</p>
<blockquote>
<blockquote>
<p>I&#x27;m not following, what happens if you use sources for it?</p>
</blockquote>
<p>Conditionally, this will happen:</p>
<pre><code>  × Failed to resolve dependencies for `other-lib` (v0.1.1)
  ╰─▶ Requirements contain conflicting URLs for package `my-testing-lib` in all marker environments:
      - git+ssh://git@my-git-repo@TESTING-BRANCH#subdirectory=my_testing_lib
      - git+ssh://git@my-git-repo#subdirectory=my_testing_lib
  help: `other-lib` (v0.1.1) was included because `my-lib` (v0.1.0) depends on `other-lib`
</code></pre>
</blockquote>
<p>This should only happen when there are two conflicting sources.</p>
<blockquote>
<blockquote>
<p>Alternatively, can you use constraint-dependencies to set the URL?</p>
</blockquote>
<p>I didn&#x27;t quite figure out the difference between override and constraint, but I replaced override with constraint and an error occurred:</p>
<pre><code>[tool.uv]
constraint-dependencies = [
    &quot;my-testing-lib @ git+ssh://my-git-repo@TESTING-BRANCH#subdirectory=my_testing_lib&quot;
]
</code></pre>
<pre><code>  × Failed to resolve dependencies for `my-testing-lib` (v0.1.0)
  ╰─▶ Package `pyqt-extra-dep-lib` was included as a URL dependency. URL dependencies must be expressed as direct requirements or constraints. Consider adding `pyqt-extra-dep-lib @
      git+ssh://git@my-git-repo#subdirectory=pyqt_extra_dep_lib` to your dependencies or constraints file.
  help: `my-testing-lib` (v0.1.0) was included because `my-lib:dev` (v0.1.0) depends on `my-testing-lib`
</code></pre>
</blockquote>
<p>This error should only happen when a registry dependency uses a URL, other URL dependency should not cause this error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wintreist">@Wintreist</a> on 2025-10-28 16:42</div>
            <div class="timeline-body"><p>@konstin
I created a repository with a structure similar to mine:
https://github.com/Wintreist/uv_issue_16484</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-29 12:12</div>
            <div class="timeline-body"><p>Thank you for the repo! In practice, are those packages in the same repo, and do they use <code>git = </code> deps inside the repo (vs. <code>path = </code> deps in the repo)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wintreist">@Wintreist</a> on 2025-10-29 12:24</div>
            <div class="timeline-body"><p>Hi!</p>
<blockquote>
<p>In practice, are those packages in the same repo</p>
</blockquote>
<p>In practice, my-lib is located in a separate git repository. All the others are in the other one</p>
<blockquote>
<p>do they use git =  deps inside the repo (vs. path =  deps in the repo)?</p>
</blockquote>
<p>They all use git= in all libraries (which are written by us, the rest we take from pypi). path= not in use</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-29 15:29</div>
            <div class="timeline-body"><p>Can you use <code>path =</code> dependencies inside the git repository? This could solve your different-branch problem. uv recognizes root -&gt; git -&gt; path dependencies and internally converts it to another git dependency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Wintreist">@Wintreist</a> on 2025-10-30 10:44</div>
            <div class="timeline-body"><p>@konstin, Hi!
I created a <a href="https://github.com/Wintreist/uv_issue_16484/tree/test_update_git_to_path">branch</a> in the same repository where I tested your proposal. In the end, there is still a problem.
As I mentioned above, my-lib is in a separate repository, so the my-testing-lib, other-lib, and pyqt-extra-dep-lib libraries still need to be accessed via git+ssh, so there is still a conflicting <a href="https://github.com/Wintreist/uv_issue_16484/blob/test_update_git_to_path/readme.md">URL error</a>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:49 UTC
    </footer>
</body>
</html>
