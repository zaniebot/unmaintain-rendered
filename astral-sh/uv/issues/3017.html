<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow sha256-&lt;hash&gt; (for Gitea/Forgejo compatibility) - astral-sh/uv #3017</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow sha256-&lt;hash&gt; (for Gitea/Forgejo compatibility)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3017">#3017</a>
        opened by <a href="https://github.com/Zottelchen">@Zottelchen</a>
        on 2024-04-12 16:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Zottelchen">@Zottelchen</a> on 2024-04-12 16:26</div>
            <div class="timeline-body"><p>When trying to install a package from a private Forgejo/Gitea instance with rye 0.32.0 (<code>rye add private_package</code>)  it fails, because of the following uv error:</p>
<pre><code>error: Failed to run uv compile error: Received some unexpected HTML from https://git.example.com/api/packages/Zottelchen/pypi/simple/private_package/
  Caused by: Unexpected fragment (expected `#sha256=...` or similar) on URL: sha256-2dad1cbbf357953b94b0c57a240e5217eb59300f303e4d35215fe7d07478f089
. uv exited with status: exit code: 2
</code></pre>
<p><a href="https://codeberg.org/forgejo/forgejo/src/commit/0c42e3c7557ff03614c99e14487a0844a649f393/templates/api/packages/pypi/simple.tmpl#L11">The issue lies in the way the Forgejo/Gitea template formats the link.</a> So currently the package links look like this: <code>https://git.example.com/api/packages/Zottelchen/pypi/files/private_package/0.1.0/private_package-0.1.0-py3-none-any.whl#sha256-2dad1cbbf357953b94b0c57a240e5217eb59300f303e4d35215fe7d07478f089</code></p>
<p>A quick fix for this would be to also allow the minus  in the  <code>sha256-</code>fragment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Zottelchen">@Zottelchen</a> on 2024-04-12 16:47</div>
            <div class="timeline-body"><p>Also opened a issue/PR with Forgejo: https://codeberg.org/forgejo/forgejo/issues/3189</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-12 17:35</div>
            <div class="timeline-body"><p>Ah yeah, that's interesting. It looks like a bug in the registry, given the spec? My guess is that pip drops those hashes altogether and doesn't enforce them, as if they didn't exist, but I'd have to look back at the pip code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-04-12 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-04-12 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-04-13 00:14</div>
            <div class="timeline-body"><p>It seems like Forgejo has already fix this https://codeberg.org/forgejo/forgejo/pulls/3197 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-13 00:58</div>
            <div class="timeline-body"><p>Oh great! Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-13 00:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-04-13 01:09</div>
            <div class="timeline-body"><p>Or specifically they accepted @Zottelchen PR and backported it already ðŸŽ‰</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../go-gitea/gitea/pulls/30594.html">go-gitea/gitea#30594</a> on 2024-04-19 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../go-gitea/gitea/pulls/30612.html">go-gitea/gitea#30612</a> on 2024-04-20 01:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:26 UTC
    </footer>
</body>
</html>
