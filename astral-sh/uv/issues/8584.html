<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trusted publishing support for GitHub Actions + TestPyPI via `uv publish` - astral-sh/uv #8584</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Trusted publishing support for GitHub Actions + TestPyPI via <code>uv publish</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8584">#8584</a>
        opened by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a>
        on 2024-10-26 04:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a></div>
            <div class="timeline-body"><p>Currently, <code>uv publish</code> supports trusted publishing support via GitHub Actions with PyPI, but not with TestPyPI. For testing purposes, it would be great if support could be extended to TestPyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-26 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 08:09</div>
            <div class="timeline-body"><p>The trusted publishing support exists for both TestPyPI and PyPI, is there anything specific not working?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-10-28 08:53</div>
            <div class="timeline-body"><p>OK, that&#x27;s great to hear, I guess in that case I just haven&#x27;t worked out how to set up trusted publishing properly yet. I&#x27;m experimenting here:
https://github.com/nathanjmcdougall/postmodern-python-ci/blob/main/.github/workflows/release.yml</p>
<p><a href="https://github.com/nathanjmcdougall/postmodern-python-ci/actions/runs/11550297410/job/32144983240">I get errors</a> about missing credentials:</p>
<blockquote>
<p>error: Failed to publish <code>dist/postmodern_ci-0.1.0-py3-none-any.whl</code> to https://upload.test.pypi.org/legacy/
Caused by: Failed to send POST request
Caused by: Missing credentials for https://upload.test.pypi.org/legacy/</p>
</blockquote>
<p>My TestPyPI config is here:
<img src="https://github.com/user-attachments/assets/74456a34-2c6d-42ab-bf06-36489d89f89e" alt="image"></p>
<p>I don&#x27;t actually know where the TestPyPI upload endpoint is, I&#x27;ve tried manually using API tokens but I get the following:</p>
<ul>
<li>https://test.upload.pypi.org/legacy/  -&gt; <code>dns error: No such host is known. (os error 11001)</code></li>
<li>https://upload.test.pypi.org/legacy/  -&gt; <code>dns error: No such host is known. (os error 11001)</code></li>
<li>https://upload.pypi.org/legacy/ -&gt;<code>Permission denied (status code 403 Forbidden)</code></li>
</ul>
<p>Probably I need to do more work to diagnose my issue, so I&#x27;m closing for now. Any support appreciated but not expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-10-28 08:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 08:58</div>
            <div class="timeline-body"><p>The publish endpoint for TestPyPI is https://test.pypi.org/legacy/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-28 08:59</div>
            <div class="timeline-body"><p>To help with debugging trusted publishing, I recommend <code>uv publish --trusted-publishing always</code>, this will show errors earlier when there is a problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-10-28 09:57</div>
            <div class="timeline-body"><p>Thanks, great to know the endpoint and the suggestion to <code>--trusted-publishing</code> was also helpful. The message I got was:</p>
<blockquote>
<p>error: Failed to obtain token for trusted publishing
Caused by: environment variable not found</p>
</blockquote>
<p>This was a tad cryptic without knowing the ins-and-outs of trusted publishing, but the issue was that I had not set <code>id-token</code> write permission, <a href="https://docs.pypi.org/trusted-publishers/using-a-publisher/">as described here</a>. Once this was set, everything worked.</p>
<p>Thank you so much for your help.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:04 UTC
    </footer>
</body>
</html>
