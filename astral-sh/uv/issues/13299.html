<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv add fails to install package while  uv pip install doesn't - astral-sh/uv #13299</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv add fails to install package while  uv pip install doesn&#x27;t</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13299">#13299</a>
        opened by <a href="https://github.com/SSchleehauf">@SSchleehauf</a>
        on 2025-05-05 10:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SSchleehauf">@SSchleehauf</a></div>
            <div class="timeline-body">Summary
<p>PS C:\Users\Schleehauf\PycharmProjects\myproject&gt; uv add pyqt5</p>
<pre><code>Resolved 4 packages in 1.69s
error: Distribution `pyqt5-qt5==5.15.16 @ registry+https://pypi.org/simple` can&#x27;t be installed because it doesn&#x27;t have a source distribution or wheel for the current platform

hint: You&#x27;re on Windows (`win_amd64`), but `pyqt5-qt5` (v5.15.16) only has wheels for the following platforms: `manylinux2014_x86_64`, `macosx_10_13_x86_64`, `macosx_11_0_arm64`
</code></pre>
<p><strong>uv add fails, while uv pip install properly resolves the correct packages:</strong></p>
<p>PS C:\Users\Schleehauf\PycharmProjects\myproject&gt;  pyqt5</p>
<pre><code>Resolved 3 packages in 140ms
Installed 3 packages in 295ms
 + pyqt5==5.15.11
 + pyqt5-qt5==5.15.2
 + pyqt5-sip==12.17.0

</code></pre>
Platform
<p>Windows 11</p>
Version
<p>myproject</p>
Python version
<p>Python 3.11.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/SSchleehauf">@SSchleehauf</a> on 2025-05-05 10:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-05 11:17</div>
            <div class="timeline-body"><p>Your hitting an edge case due to pyqt5-qt5 publishing wheels for different platforms in different versions: <code>uv add</code> tries to do a universal resolution and picks the latest version, which then fails to install, while <code>uv pip install</code> goes back to an older, compatible version. You can work around this by setting the required environments to include your platform before running <code>uv add</code> (https://docs.astral.sh/uv/concepts/resolution/#required-environments).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/konstin">@konstin</a> on 2025-05-05 11:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-05-05 11:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SSchleehauf">@SSchleehauf</a> on 2025-05-05 19:15</div>
            <div class="timeline-body"><p>I am not sure if I am doing this right, I added</p>
<pre><code>[tool.uv]
environments = [
    &quot;sys_platform==&#x27;win32&#x27;&quot;,
]
</code></pre>
<p>to <code>pyproject.toml</code>, but this does not help:</p>
<pre><code>
&gt; uv add --verbose pyqt5
DEBUG uv 0.7.2 (481d05d8d 2025-04-30)
DEBUG Found project root: `C:\Users\sebi\test_env`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `C:\Users\sebi\test_env`
DEBUG Reading Python requests from version file at `C:\Users\sebi\test_env\.python-version`
DEBUG Using Python request `3.11` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The virtual environment&#x27;s Python version satisfies the request: `Python 3.11`
DEBUG Released lock at `C:\Users\sebi\AppData\Local\Temp\uv-f6c3a328fae758f2.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: test-env @ file:///C:/Users/sebi/test_env
DEBUG No workspace root found, using project root
DEBUG Ignoring existing lockfile due to mismatched requirements for: `test-env==0.1.0`
  Requested: {Requirement { name: PackageName(&quot;pyqt5&quot;), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([]), index: None, conflict: None }, origin: None }}
  Existing: {}
DEBUG Solving with installed Python version: 3.11.1
DEBUG Solving with target Python version: &gt;=3.11, &lt;4
DEBUG Solving split (python_full_version &gt;= &#x27;3.11&#x27; and python_full_version &lt; &#x27;4&#x27; and sys_platform == &#x27;win32&#x27;) (requires-python: RequiresPython { specifiers: VersionSpecifiers([VersionSpecifier { operator: GreaterThanEqual, version: &quot;3.11&quot; }, VersionSpecifier { operator: LessThan, version: &quot;4&quot; }]), range: RequiresPythonRange(LowerBound(Included(&quot;3.11&quot;)), UpperBound(Excluded(&quot;4&quot;))) })
DEBUG Adding direct dependency: test-env*
DEBUG Searching for a compatible version of test-env @ file:///C:/Users/sebi/test_env (*)
DEBUG Adding direct dependency: pyqt5*
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5.lock`
DEBUG Found stale response for: https://pypi.org/simple/pyqt5/
DEBUG Sending revalidation request for: https://pypi.org/simple/pyqt5/
DEBUG Found not-modified response for: https://pypi.org/simple/pyqt5/
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5.lock`
DEBUG Searching for a compatible version of pyqt5 (*)
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5\pyqt5-5.15.11-cp38-abi3-macosx_11_0_arm64.lock`
DEBUG Selecting: pyqt5==5.15.11 [compatible] (PyQt5-5.15.11-cp38-abi3-macosx_11_0_arm64.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/11/64/42ec1b0bd72d87f87bde6ceb6869f444d91a2d601f2e67cd05febc0346a1/PyQt5-5.15.11-cp38-abi3-macosx_11_0_arm64.whl.metadata
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5\pyqt5-5.15.11-cp38-abi3-macosx_11_0_arm64.lock`
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-qt5&gt;=5.15.2, &lt;5.16.0
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-sip&gt;=12.15, &lt;13
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-qt5.lock`
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-sip.lock`
DEBUG Found stale response for: https://pypi.org/simple/pyqt5-sip/
DEBUG Sending revalidation request for: https://pypi.org/simple/pyqt5-sip/
DEBUG Found stale response for: https://pypi.org/simple/pyqt5-qt5/
DEBUG Sending revalidation request for: https://pypi.org/simple/pyqt5-qt5/
DEBUG Found not-modified response for: https://pypi.org/simple/pyqt5-sip/
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-sip.lock`
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-sip\pyqt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.lock`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/52/fd/7d6e3deca5ce37413956faf4e933ce6beb87ac0cc7b26d934b5ed998f88a/PyQt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.whl.metadata
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-sip\pyqt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.lock`
DEBUG Found not-modified response for: https://pypi.org/simple/pyqt5-qt5/
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\simple-v15\pypi\pyqt5-qt5.lock`
DEBUG Searching for a compatible version of pyqt5-qt5 (&gt;=5.15.2, &lt;5.16.0)
DEBUG Acquired lock for `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-qt5\pyqt5_qt5-5.15.16-1-py3-none-manylinux2014_x86_64.lock`
DEBUG Selecting: pyqt5-qt5==5.15.16 [compatible] (PyQt5_Qt5-5.15.16-1-py3-none-manylinux2014_x86_64.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/2f/97/ef77663fb5d61b65f2e93edc135cc0b86724c1fc610c10a6867ae0c0baff/PyQt5_Qt5-5.15.16-1-py3-none-manylinux2014_x86_64.whl.metadata
DEBUG Released lock at `C:\Users\sebi\AppData\Local\uv\cache\wheels-v5\pypi\pyqt5-qt5\pyqt5_qt5-5.15.16-1-py3-none-manylinux2014_x86_64.lock`
DEBUG Searching for a compatible version of pyqt5-sip (&gt;=12.15, &lt;13)
DEBUG Selecting: pyqt5-sip==12.17.0 [compatible] (PyQt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.whl)
DEBUG Tried 4 versions: pyqt5 1, pyqt5-qt5 1, pyqt5-sip 1, test-env 1
DEBUG split `python_full_version &gt;= &#x27;3.11&#x27; and python_full_version &lt; &#x27;4&#x27; and sys_platform == &#x27;win32&#x27;` resolution took 0.201s
DEBUG Distinct solution for split (python_full_version &gt;= &#x27;3.11&#x27; and python_full_version &lt; &#x27;4&#x27; and sys_platform == &#x27;win32&#x27;) with 4 packages
Resolved 4 packages in 208ms
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: test-env @ file:///C:/Users/sebi/test_env
DEBUG No workspace root found, using project root
DEBUG Ignoring existing lockfile due to mismatched requirements for: `test-env==0.1.0`
  Requested: {Requirement { name: PackageName(&quot;pyqt5&quot;), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: GreaterThanEqual, version: &quot;5.15.11&quot; }]), index: None, conflict: None }, origin: None }}
  Existing: {Requirement { name: PackageName(&quot;pyqt5&quot;), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([]), index: None, conflict: None }, origin: None }}
DEBUG Solving with installed Python version: 3.11.1
DEBUG Solving with target Python version: &gt;=3.11, &lt;4
DEBUG Solving split (python_full_version &gt;= &#x27;3.11&#x27; and python_full_version &lt; &#x27;4&#x27; and sys_platform == &#x27;win32&#x27;) (requires-python: RequiresPython { specifiers: VersionSpecifiers([VersionSpecifier { operator: GreaterThanEqual, version: &quot;3.11&quot; }, VersionSpecifier { operator: LessThan, version: &quot;4&quot; }]), range: RequiresPythonRange(LowerBound(Included(&quot;3.11&quot;)), UpperBound(Excluded(&quot;4&quot;))) })
DEBUG Adding direct dependency: test-env*
DEBUG Searching for a compatible version of test-env @ file:///C:/Users/sebi/test_env (*)
DEBUG Adding direct dependency: pyqt5&gt;=5.15.11
DEBUG Searching for a compatible version of pyqt5 (&gt;=5.15.11)
DEBUG Selecting: pyqt5==5.15.11 [preference] (PyQt5-5.15.11-cp38-abi3-macosx_11_0_arm64.whl)
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-qt5&gt;=5.15.2, &lt;5.16.0
DEBUG Adding transitive dependency for pyqt5==5.15.11: pyqt5-sip&gt;=12.15, &lt;13
DEBUG Searching for a compatible version of pyqt5-qt5 (&gt;=5.15.2, &lt;5.16.0)
DEBUG Selecting: pyqt5-qt5==5.15.16 [preference] (PyQt5_Qt5-5.15.16-1-py3-none-manylinux2014_x86_64.whl)
DEBUG Searching for a compatible version of pyqt5-sip (&gt;=12.15, &lt;13)
DEBUG Selecting: pyqt5-sip==12.17.0 [preference] (PyQt5_sip-12.17.0-cp311-cp311-macosx_10_9_universal2.whl)
DEBUG Tried 4 versions: pyqt5 1, pyqt5-qt5 1, pyqt5-sip 1, test-env 1
DEBUG split `python_full_version &gt;= &#x27;3.11&#x27; and python_full_version &lt; &#x27;4&#x27; and sys_platform == &#x27;win32&#x27;` resolution took 0.015s
DEBUG Distinct solution for split (python_full_version &gt;= &#x27;3.11&#x27; and python_full_version &lt; &#x27;4&#x27; and sys_platform == &#x27;win32&#x27;) with 4 packages
DEBUG Reverting changes to `pyproject.toml`
DEBUG Reverting changes to `uv.lock`
error: Distribution `pyqt5-qt5==5.15.16 @ registry+https://pypi.org/simple` can&#x27;t be installed because it doesn&#x27;t have a source distribution or wheel for the current platform

</code></pre>
<p>The problem is the dependency <code>pyqt5-qt5</code>, the newest windows version is indeed 5.15.2.</p>
<p><strong>When I specify the pyqt5-qt5 version, things work just fine:</strong></p>
<pre><code>&gt; uv add pyqt5 pyqt5-qt5==5.15.2
Resolved 4 packages in 45ms
Installed 3 packages in 1.81s
 + pyqt5==5.15.11
 + pyqt5-qt5==5.15.2
 + pyqt5-sip==12.17.0

</code></pre>
<p>Using this workaround, I pin the version of a dependency. For Qt5 this is obviously fine because there won&#x27;t be any new non-commercial releases, but for <code>uv add</code> in general this behavior (and the workaround) do not look right to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-05 19:37</div>
            <div class="timeline-body"><p>Can you try <code>required-environments</code> instead of <code>environments</code>? I.e.:</p>
<pre><code>[tool.uv]
required-environments = [
  &quot;sys_platform == &#x27;win32&#x27;&quot;
]
</code></pre>
<p>This should resolve versions that install on windows, too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SSchleehauf">@SSchleehauf</a> on 2025-05-05 19:54</div>
            <div class="timeline-body"><p>Yes, this solves the package resolution and I get</p>
<pre><code>&gt; uv add pyqt5
Resolved 5 packages in 1.18s
Installed 3 packages in 1.56s
 + pyqt5==5.15.11
 + pyqt5-qt5==5.15.2
 + pyqt5-sip==12.17.0
</code></pre>
<p>So this pin the Linux/MacOS version of pyt5-qt5 to 5.15.2 even though there are newer wheels, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-05 20:04</div>
            <div class="timeline-body"><p>Yeah, it makes uv skip over versions that can&#x27;t be installed with the platform listed in <code>required-environments</code>, going back to a version that can be installed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SSchleehauf">@SSchleehauf</a> on 2025-05-05 20:24</div>
            <div class="timeline-body"><p>Thanks a lot, now I get it. You are right, this seems to be reasonable behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/SSchleehauf">@SSchleehauf</a> on 2025-05-05 20:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:29 UTC
    </footer>
</body>
</html>
