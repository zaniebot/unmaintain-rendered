<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv cache {clean, prune} fails with os error 63 - astral-sh/uv #15569</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv cache {clean, prune} fails with os error 63</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15569">#15569</a>
        opened by <a href="https://github.com/barberogaston">@barberogaston</a>
        on 2025-08-28 11:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/barberogaston">@barberogaston</a> on 2025-08-28 11:53</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Current state: <code>uv</code>'s cache folder is quite bloated with 57GiB of data:</p>
<pre><code>❯ du -h -d 1 | sort -hr | head -n 10
 57G    ./uv
</code></pre>
<p>However, trying to run a <code>uv cache clean</code> or <code>uv cache prune</code> yields the following error:</p>
<pre><code>❯ uv cache clean
Clearing cache at: uv
error: Failed to clear cache at: uv
  Caused by: IO error for operation on /Users/gaston.barbero/.cache/uv/sdists-v6/index/4306dec2056c9470/xgboost/1.3.3/epUeJwNL75qLZYa8tNqAC/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/build/temp.macosx-11.0-arm64-cpython-312/xgboost/src/xgboost/dmlc-core/tracker/yarn/src/main/java/org/apache/hadoop/yarn/dmlc: File name too long (os error 63)
  Caused by: File name too long (os error 63)
</code></pre>
<h3>Platform</h3>
<p>macOS M1 Sonoma 14.7.7 (Darwin 23.6.0 arm64)</p>
<h3>Version</h3>
<p>v0.8.13</p>
<h3>Python version</h3>
<p>3.12.6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @barberogaston on 2025-08-28 11:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-28 12:03</div>
            <div class="timeline-body"><p>You can just run <code>rm</code> on the output of <code>uv cache dir</code> as a workaround.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/barberogaston">@barberogaston</a> on 2025-08-28 12:11</div>
            <div class="timeline-body"><blockquote>
<p>You can just run <code>rm</code> on the output of <code>uv cache dir</code> as a workaround.</p>
</blockquote>
<p>Yup, that's the path I went for</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-28 12:19</div>
            <div class="timeline-body"><p>(We should make the removal operations robust to this, though.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sunfkny">@sunfkny</a> on 2025-11-02 13:04</div>
            <div class="timeline-body"><p>Cache clean also fails when there is a Windows-incompatible file name (e.g. ending with a period) in the cache dir</p>
<pre><code>PS C:\Users\root&gt; uv cache clean
Clearing cache at: AppData\Local\uv\cache
error: Failed to clear cache at: AppData\Local\uv\cache
  Caused by: failed to remove file `C:\Users\root\AppData\Local\uv\cache\sdists-v9\index\3ba65c4f41aac3a1\uwsgi\2.0.31\l1w3t3Nrz8OnzxF6ri3eg\src\core\logging.`: The system cannot find the file specified. (os error 2)
PS C:\Users\root&gt; python
Python 3.14.0 (tags/v3.14.0:ebf955d, Oct  7 2025, 10:15:03) [MSC v.1944 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import os
&gt;&gt;&gt; os.path.isreserved(r&quot;C:\Users\root\AppData\Local\uv\cache\sdists-v9\index\3ba65c4f41aac3a1\uwsgi\2.0.31\l1w3t3Nrz8OnzxF6ri3eg\src\core\logging.&quot;)
True
&gt;&gt;&gt;
</code></pre>
<p>workaround:</p>
<pre><code class="language-shell"># cmd
rd /s /q &quot;C:\Users\root\AppData\Local\uv\cache&quot;
# powershell
rm -Recurse -Force &quot;C:\Users\root\AppData\Local\uv\cache&quot;
</code></pre>
<p>programmatically delete:</p>
<pre><code class="language-rust">fs_err::remove_file(r&quot;\\?\C:\Users\root\AppData\Local\uv\cache\sdists-v9\index\3ba65c4f41aac3a1\uwsgi\2.0.31\l1w3t3Nrz8OnzxF6ri3eg\src\core\logging.&quot;).unwrap();
// The \\?\ prefix allows operations on paths that exceed the MAX_PATH limit or contain characters normally restricted by the Win32 API (for example, trailing dots or spaces).
// See: https://learn.microsoft.com/en-us/windows/win32/fileio/naming-a-file#win32-file-namespaces
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-03 18:57</div>
            <div class="timeline-body"><p>@sunfkny That looks like a different problem, can you open a separate bug with complete instructions for reproducing this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-03 19:25</div>
            <div class="timeline-body"><p>I'm actually not sure <em>how</em> to make removal robust to this?</p>
<p>The best I can think of is to update https://github.com/astral-sh/uv/blob/00aa2ab67290f45c3797c1359d027cc38d137d7e/crates/uv-cache/src/removal.rs#L217 to emit a warning and ignore the error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16586.html">astral-sh/uv#16586</a> on 2025-11-04 07:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:11 UTC
    </footer>
</body>
</html>
