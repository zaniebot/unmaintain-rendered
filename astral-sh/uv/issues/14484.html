<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python version is ignored if dependency bounds are not specified - astral-sh/uv #14484</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Python version is ignored if dependency bounds are not specified</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14484">#14484</a>
        opened by <a href="https://github.com/tpoliaw">@tpoliaw</a>
        on 2025-07-07 11:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tpoliaw">@tpoliaw</a> on 2025-07-07 11:52</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>If a project specifies a dependency without any version bounds, the python version doesn't seem to be checked and an invalid version is selected. If a bound (that includes the previously selected version) is added, resolution fails with a python version error.</p>
<h1>Minimal example</h1>
<p>Given the following <code>pyproject.toml</code></p>
<pre><code class="language-toml">[project]
name = &quot;demo&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [
    &quot;numba&quot;
]
</code></pre>
<p>Running <code>uv tree</code> gives</p>
<pre><code>Resolved 7 packages in 5ms
demo v0.1.0
└── numba v0.61.2
    ├── llvmlite v0.44.0
    └── numpy v2.2.6
</code></pre>
<p>Updating the pyproject.toml to include a bound on the <code>numba</code> dependency (note <code>&gt;=0.61</code> should include the 0.61.2 previously selected),</p>
<pre><code class="language-toml">[project]
name = &quot;demo&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.9&quot;
dependencies = [
    &quot;numba&gt;=0.61&quot;
]
</code></pre>
<p><code>uv tree</code> now fails with a conflict error</p>
<pre><code>❯ uv tree
  × No solution found when resolving dependencies for split
  │ (python_full_version == '3.9.*'):
  ╰─▶ Because the requested Python version (&gt;=3.9) does not satisfy
      Python&gt;=3.10 and numba&gt;=0.61.0 depends on Python&gt;=3.10, we can
      conclude that numba&gt;=0.61.0 cannot be used.
      And because only the following versions of numba are available:
          numba&lt;=0.61.0
          numba==0.61.2
      and your project depends on numba&gt;=0.61, we can conclude that your
      project's requirements are unsatisfiable.

      hint: Pre-releases are available for `numba` in the requested
      range (e.g., 0.61.1rc1), but pre-releases weren't enabled (try:
      `--prerelease=allow`)

      hint: The `requires-python` value (&gt;=3.9) includes Python versions
      that are not supported by your dependencies (e.g., numba&gt;=0.61.0 only
      supports &gt;=3.10). Consider using a more restrictive `requires-python`
      value (like &gt;=3.10).

      hint: While the active Python version is 3.12, the resolution failed
      for other Python versions supported by your project. Consider limiting
      your project's supported Python versions using `requires-python`.
</code></pre>
<h3>Platform</h3>
<p>arch linux 6.12.31-1-lts</p>
<h3>Version</h3>
<p>uv 0.7.18 (87e9ccfb9 2025-07-01)</p>
<h3>Python version</h3>
<p>3.12.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @tpoliaw on 2025-07-07 11:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-07-07 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-07-07 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-07 12:34</div>
            <div class="timeline-body"><p>uv realizes that the latest version of numba works on Python 3.12, while resolving an older version for Python 3.9. In <code>uv.lock</code>, you can see that uv has split the resolution for different Python versions:</p>
<pre><code>[[package]]
name = &quot;debug&quot;
version = &quot;0.1.0&quot;
source = { editable = &quot;.&quot; }
dependencies = [
    { name = &quot;numba&quot;, version = &quot;0.60.0&quot;, source = { registry = &quot;https://pypi.org/simple&quot; }, marker = &quot;python_full_version &lt; '3.10'&quot; },
    { name = &quot;numba&quot;, version = &quot;0.61.2&quot;, source = { registry = &quot;https://pypi.org/simple&quot; }, marker = &quot;python_full_version &gt;= '3.10'&quot; },
]
</code></pre>
<p>As the current Python version is 3.12, numba 0.61.2 can be used, while the older version will be installed on Python 3.9.</p>
<p>We recommend always adding lower bounds to dependencies, to avoid such problems.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tpoliaw">@tpoliaw</a> on 2025-07-07 13:29</div>
            <div class="timeline-body"><p>Ok, thank you for the quick response and explanation. I think I may have misdiagnosed the problem I'm actually getting.</p>
<p>In an empty directory</p>
<pre><code>uv init
uv add sparse
uv add numpy
</code></pre>
<p>works fine, whereas</p>
<pre><code>uv init
uv add sparse numpy # fails
</code></pre>
<p>fails with it selecting a version of <code>numba</code> that isn't compatible with the python version.</p>
<p>Oddly it works again if you include <code>numba</code> explicitly</p>
<pre><code>uv init
uv add sparse numpy numba # works
</code></pre>
<p>I can open a new issue for that. Feels kind of similar to <a href="https://github.com/astral-sh/uv/issues/6281#issuecomment-2316240724">this one</a> but in this case there <em>is</em> a way of distinguishing between the two resolutions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-07 14:41</div>
            <div class="timeline-body"><p>I'd suggest adding a constraint somewhere. This is likely just the resolver choosing a certain outcome that isn't incorrect, but also isn't what you want, so you can provide more information to guide it. (We don't respect upper-bounds on <code>requires-python</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../SpikeInterface/spikeinterface/pulls/4046.html">SpikeInterface/spikeinterface#4046</a> on 2025-07-09 12:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vonfry">@Vonfry</a> on 2025-07-16 12:29</div>
            <div class="timeline-body"><p>Some projects, especially in ML, such as ChatTTS and funasr, aren't set versions for some dependencies usually in both pypi and repo. I think uv could make it working like pip in such cases by installing/syncing dependencies with current python version or respecting <code>requires-python</code>.</p>
<p>I agree on &quot;always adding lower bounds to dependencies&quot;, but dependencies are from anywhere and other authors may not follow this.</p>
<p>At least, uv could add a warning if there is a dependency without lower bounds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tpoliaw">@tpoliaw</a> on 2025-07-16 12:48</div>
            <div class="timeline-body"><p>Yeah, adding a lower bound fixes it so I'm happy for this to be closed but I'd question &quot;the resolver choosing a certain outcome that isn't incorrect&quot; as it's selecting a combination that isn't valid. It might be a consequence of ignoring python upper bounds. Is there a reason for that decision?</p>
<p>It's also a little annoying having to add a lower bound to <code>numba</code> when we wouldn't otherwise depend on it directly.</p>
<p>Might just be being picky though as <code>uv</code> has been a great improvement in every other respect so far.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-17 09:27</div>
            <div class="timeline-body"><p>@Vonfry You can set constraints for transitive dependencies too (https://docs.astral.sh/uv/reference/settings/#constraint-dependencies). uv already tries to determine a good resolution, but sometimes it's not possible to tell the better choice algorithmically, where you need to add bounds manually.</p>
<blockquote>
<p>Yeah, adding a lower bound fixes it so I'm happy for this to be closed but I'd question &quot;the resolver choosing a certain outcome that isn't incorrect&quot; as it's selecting a combination that isn't valid. It might be a consequence of ignoring python upper bounds. Is there a reason for that decision?</p>
</blockquote>
<p>That's a complex story, the context is in and linked to in https://github.com/astral-sh/uv/issues/4022.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-07-17 09:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:08 UTC
    </footer>
</body>
</html>
