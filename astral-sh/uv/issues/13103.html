<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to use Apple Accelerate instead of OpenBlas when installing Numpy on Apple Silicon? - astral-sh/uv #13103</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>How to use Apple Accelerate instead of OpenBlas when installing Numpy on Apple Silicon?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13103">#13103</a>
        opened by <a href="https://github.com/eureka-0">@eureka-0</a>
        on 2025-04-25 08:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/eureka-0">@eureka-0</a></div>
            <div class="timeline-body">Question
<p>Hi, in the past year, I have used <code>no-binary-package = [&quot;numpy&quot;]</code> config for installing numpy (just build it on my laptop), and it works well with Accelerate. This is the output of <code>numpy.__config__.show()</code>:</p>
<pre><code>Build Dependencies:
  blas:
    detection method: system
    found: true
    include directory: unknown
    lib directory: unknown
    name: accelerate
    openblas configuration: unknown
    pc file directory: unknown
    version: unknown
  lapack:
    detection method: internal
    found: true
    include directory: unknown
    lib directory: unknown
    name: dep4396855664
    openblas configuration: unknown
    pc file directory: unknown
    version: 1.26.4
</code></pre>
<p>While if I install pre-built wheel using <code>uv add numpy</code> (remove <code>no-binary-package = [&quot;numpy&quot;]</code> config), it will use OpenBlas instead of Accelerate:</p>
<pre><code>Build Dependencies:
  blas:
    detection method: pkgconfig
    found: true
    include directory: /opt/arm64-builds/include
    lib directory: /opt/arm64-builds/lib
    name: openblas64
    openblas configuration: USE_64BITINT=1 DYNAMIC_ARCH=1 DYNAMIC_OLDER= NO_CBLAS=
      NO_LAPACK= NO_LAPACKE= NO_AFFINITY=1 USE_OPENMP= SANDYBRIDGE MAX_THREADS=3
    pc file directory: /usr/local/lib/pkgconfig
    version: 0.3.23.dev
  lapack:
    detection method: pkgconfig
    found: true
    include directory: /opt/arm64-builds/include
    lib directory: /opt/arm64-builds/lib
    name: openblas64
    openblas configuration: USE_64BITINT=1 DYNAMIC_ARCH=1 DYNAMIC_OLDER= NO_CBLAS=
      NO_LAPACK= NO_LAPACKE= NO_AFFINITY=1 USE_OPENMP= SANDYBRIDGE MAX_THREADS=3
    pc file directory: /usr/local/lib/pkgconfig
    version: 0.3.23.dev
</code></pre>
<p>OpenBlas is much slower and has heavier CPU usage than Accelerate (there are many benchmarks on the Internet). So I prefer to build numpy locally to use Accelerate. However, I encountered a problem when installing a package <code>ChaosMagPy </code> (which relies on Numpy 1.26.0). The error are as follows.</p>
<pre><code>Found CMake: /opt/homebrew/bin/cmake (4.0.0)
WARNING: CMake Toolchain: Failed to determine CMake compilers state
Run-time dependency openblas found: NO (tried pkgconfig, framework and cmake)
Run-time dependency openblas found: NO (tried pkgconfig, framework and cmake)

../../numpy/meson.build:207:4: ERROR: Problem encountered: No BLAS library detected! Install one, or use the `allow-noblas` build
option (note, this may be up to 100x slower for some linear algebra operations).
</code></pre>
<p>It seems that OpenBlas can not be found and Accelerate was not used, but <a href="https://numpy.org/doc/stable/release/1.26.0-notes.html#support-for-the-updated-accelerate-blas-lapack-library">Numpy 1.26.0 should support Accelerate</a>. So where is the problem here? Does uv has pre-built Numpy wheels for Accelerate and how to install it properly?</p>
Platform
<p>macOS 15 arm64</p>
Version
<p>uv 0.6.16 (Homebrew 2025-04-22)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/eureka-0">@eureka-0</a> on 2025-04-25 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-25 10:04</div>
            <div class="timeline-body"><p>This is problem with numpy rather than uv and should be discussed with the numpy developers rather than uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eureka-0">@eureka-0</a> on 2025-04-25 11:53</div>
            <div class="timeline-body"><blockquote>
<p>This is problem with numpy rather than uv and should be discussed with the numpy developers rather than uv.</p>
</blockquote>
<p>Thank you for reply. Finally I figured out. Accelerate was supported from Numpy 1.26.0, but the auto-detection for Accelerate was added from <a href="https://numpy.org/devdocs/release/1.26.1-notes.html#improved-blas-lapack-detection-and-control">1.26.1</a>. So I have to specify the blas to use when building. This command gave me Numpy 1.26.0 with Accelerate:</p>
<pre><code>uv add numpy==1.26.0 --config-setting setup-args=-Dblas=accelerate --config-setting setup-args=-Dlapack=accelerate --no-binary-package numpy
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2025-04-25 12:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:21 UTC
    </footer>
</body>
</html>
