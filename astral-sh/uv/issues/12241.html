<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv lock` creates a lockfile that can't be installed - astral-sh/uv #12241</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv lock` creates a lockfile that can't be installed</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12241">#12241</a>
        opened by <a href="https://github.com/s-banach">@s-banach</a>
        on 2025-03-17 14:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/s-banach">@s-banach</a> on 2025-03-17 14:51</div>
            <div class="timeline-body"><h3>Question</h3>
<h2>Basic question</h2>
<p>My <code>pyproject.toml</code> specifies <code>python &gt;= 3.11</code>.
My actual <code>.venv</code> has python 3.12.
When I run <code>uv lock</code>, it creates a lockfile that works for python 3.11, but fails for python 3.12.
Is this the intended behavior?</p>
<h2>Specific details</h2>
<p>My company has our own internal pypi index. It has some oddities.
For example, <code>numpy==2.2.4</code> is available for python 3.11, but not yet available for newer versions of python.
If I run <code>uv lock</code>, it creates a lockfile that specifies <code>numpy==2.2.4</code>.
If <code>uv</code> chose <code>numpy==2.2.3</code> instead, it would be installable on <code>3.11, 3.12, 3.13</code>.</p>
<h2>Why I'm confused.</h2>
<p>The <code>uv.lock</code> file lists various wheels for <code>python 3.11, 3.12, 3.13</code>, so it seems to be <em>trying</em> to build  a lockfile that works for those three versions. But the lockfile it eventually produces can't be installed on any version except <code>3.11</code>.</p>
<h3>Platform</h3>
<p><em>No response</em></p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @s-banach on 2025-03-17 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-17 17:48</div>
            <div class="timeline-body"><p>There's a fairly thorough write-up on this problem here: https://docs.astral.sh/uv/concepts/resolution/#required-environments</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s-banach">@s-banach</a> on 2025-03-17 18:20</div>
            <div class="timeline-body"><p>Thanks!
It seemingly ignored the following two arguments that I tried for <code>required-environments</code>:</p>
<pre><code>&quot;platform_system == 'Windows' and python_version == '3.12'&quot;
&quot;sys_platform == 'win32' and python_version == '3.12'&quot;
</code></pre>
<p>(Not sure why, I believe they should be correct.)</p>
<p>But eventually it worked with this argument:</p>
<pre><code>&quot;sys_platform == 'win_amd64' and python_version == '3.12'&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @s-banach on 2025-03-17 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s-banach">@s-banach</a> on 2025-03-17 18:25</div>
            <div class="timeline-body"><p>Actually, it just builds the same lock file, but adds a section for win_64 with <code>numpy-2.2.3.tar.gz</code> instead of wheels.
Idk, I can't make it work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-17 18:28</div>
            <div class="timeline-body"><p>I don't think we look at <code>python_version</code> at all in that setting. There's an open issue tracking it. I can look at it soon. You should really just pin <code>numpy</code> to PyPI rather than getting it from your own repository via an explicit index source?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s-banach">@s-banach</a> on 2025-03-17 18:30</div>
            <div class="timeline-body"><p>I'm sorry for wasting your time with stupid stuff. My company blocks pypi, we have our &quot;internal pypi&quot; which has some bogus security scanner that blocks certain versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-17 18:39</div>
            <div class="timeline-body"><p>That's ok, I understand. Let me re-open.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2025-03-17 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-03-17 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sanmai-NL">@sanmai-NL</a> on 2025-04-01 13:21</div>
            <div class="timeline-body"><p>@charliermarsh</p>
<pre><code class="language-toml">[tool.uv]
environments = [
  &quot;platform_system == 'Darwin' and platform_machine == 'arm64'&quot;,
  &quot;platform_system == 'Linux' and (platform_machine == 'x86_64' or platform_machine == 'aarch64')&quot;,
  &quot;platform_system == 'Windows' and (platform_machine == 'amd64')&quot;,
]
required-environments = [
  &quot;platform_system == 'Darwin' and platform_machine == 'arm64'&quot;,
  &quot;platform_system == 'Linux' and (platform_machine == 'x86_64' or platform_machine == 'aarch64')&quot;,
  &quot;platform_system == 'Windows' and (platform_machine == 'amd64')&quot;,
]
no-build = true
required-version = &quot;==0.6.11&quot;
</code></pre>
<pre><code class="language-console">$ uv sync
TRACE Resolver derivation tree before reduction
term root==0a0.dev0
  root==0a0.dev0 depends on mypackage*
  term mypackage*
    term mypackage==2025.2.26.12.0.0
      mypackage==2025.2.26.12.0.0 depends on lingua-language-detector==2.1.0
      lingua-language-detector==2.1.0 no `platform_machine == 'amd64' and sys_platform == 'win32'`-compatible wheels
    no versions of mypackage&lt;2025.2.26.12.0.0 | &gt;2025.2.26.12.0.0
TRACE Resolver derivation tree after reduction
term mypackage==2025.2.26.12.0.0
  mypackage==2025.2.26.12.0.0 depends on lingua-language-detector==2.1.0
  lingua-language-detector==2.1.0 no `platform_machine == 'amd64' and sys_platform == 'win32'`-compatible wheels
  × No solution found when resolving dependencies for split (platform_machine == 'amd64' and sys_platform == 'win32'):
  ╰─▶ Because lingua-language-detector==2.1.0 has no `platform_machine == 'amd64' and sys_platform == 'win32'`-compatible wheels and your project depends on
      lingua-language-detector==2.1.0, we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<p>Even though https://pypi.org/project/lingua-language-detector/#lingua_language_detector-2.1.0-cp312-cp312-win_amd64.whl exists.</p>
<p>Nothing on https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/ or the values obtained via the functions in https://docs.python.org/3/library/platform.html suggests how to match against the wheel tag <code>win_64</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sanmai-NL">@sanmai-NL</a> on 2025-04-01 13:28</div>
            <div class="timeline-body"><p>See: https://discuss.python.org/t/wheel-platform-tag-for-windows/9025/7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RazerM">@RazerM</a> on 2025-06-16 18:12</div>
            <div class="timeline-body"><p>@sanmai-NL I think the error you see is fixed by https://github.com/astral-sh/uv/pull/14041 (not released yet)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:02 UTC
    </footer>
</body>
</html>
