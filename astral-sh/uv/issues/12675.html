<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` doesn't honour `uv.toml`; `uv run` ignores both `uv.toml` and `--extra-index-url` flags - astral-sh/uv #12675</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv add` doesn't honour `uv.toml`; `uv run` ignores both `uv.toml` and `--extra-index-url` flags</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12675">#12675</a>
        opened by <a href="https://github.com/knguyen1">@knguyen1</a>
        on 2025-04-04 15:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/knguyen1">@knguyen1</a> on 2025-04-04 15:48</div>
            <div class="timeline-body"><h3>Summary</h3>
<h2>Adding a package</h2>
<p>Without <code>--extra-index-url</code>, it fails:</p>
<pre><code>(my-project) vscode ➜ /workspaces/my-project (master) $ uv add requests
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of graphrag==1.0.1.dev23 and your project depends on graphrag==1.0.1.dev23, we can conclude that your
      project's requirements are unsatisfiable.
</code></pre>
<p>With <code>--extra-index-url</code> it succeeds:</p>
<pre><code>(my-project) vscode ➜ /workspaces/my-project (master) $ uv add requests --extra-index-url 'https://my-artifactory1/simple'
warning: Indexes specified via `--extra-index-url` will not be persisted to the `pyproject.toml` file; use `--index` instead.
Resolved 157 packages in 1.56s
      Built my-project @ file:///workspaces/my-project
</code></pre>
<p>The contents of my <code>uv.toml</code></p>
<pre><code>(my-project) vscode ➜ /workspaces/my-project (master) $ cat ~/.config/uv/uv.toml 
[pip]
index-url = &quot;https://my-artifactory2/simple&quot;
extra-index-url = [&quot;https://my-artifactory1/simple&quot;]
</code></pre>
<p>~~## Bonus bug~~</p>
<p>~~<code>uv run</code> ignores both <code>uv.toml</code> and <code>--extra-index-url</code> flags:~~</p>
<p>Works with:</p>
<p><code>uv run --extra-index-url 'https://my-artifactory1/simple'  python --version</code></p>
<h3>Platform</h3>
<p>Linux 6.1.84-99.169.amzn2023.x86_64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.6.12</p>
<h3>Python version</h3>
<p>Python 3.12.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @knguyen1 on 2025-04-04 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-04 15:51</div>
            <div class="timeline-body"><p><code>uv run python --version --extra-index-url 'https://my-artifactory1/simple'</code> is passing the <code>--extra-index-url</code> argument to <code>python</code>. You need to put any uv arguments before the command name (in this case, <code>python</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/knguyen1">@knguyen1</a> on 2025-04-04 15:53</div>
            <div class="timeline-body"><blockquote>
<p><code>uv run python --version --extra-index-url 'https://my-artifactory1/simple'</code> is passing the <code>--extra-index-url</code> argument to <code>python</code>. You need to put any uv arguments before the command name (in this case, <code>python</code>).</p>
</blockquote>
<p>Got it.  Will edit original issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-04 15:54</div>
            <div class="timeline-body"><p>Separately, remove the <code>[pip]</code> from your <code>uv.toml</code>. Settings under <code>[pip]</code> only apply to the <code>uv pip</code> commands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/knguyen1">@knguyen1</a> on 2025-04-04 15:58</div>
            <div class="timeline-body"><blockquote>
<p>Separately, remove the <code>[pip]</code> from your <code>uv.toml</code>. Settings under <code>[pip]</code> only apply to the <code>uv pip</code> commands.</p>
</blockquote>
<p>That did the trick.  Can close this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @knguyen1 on 2025-04-04 16:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:04 UTC
    </footer>
</body>
</html>
