<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noticeable lag with uv-created virtual environments during first interpreter session - astral-sh/uv #9666</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Noticeable lag with uv-created virtual environments during first interpreter session</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9666">#9666</a>
        opened by <a href="https://github.com/ketozhang">@ketozhang</a>
        on 2024-12-06 01:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ketozhang">@ketozhang</a></div>
            <div class="timeline-body"><p>Using uv for quite a while, I&#x27;ve been noticing a significant lag that only happens the first time you run the interpreter after creating the virtual environment with uv. This lag is more apparent with larger environments. I do not find this as noticeable in venv-created virtual environments.</p>
<p>Here I have a small benchmark (sorry it&#x27;s not very robust) that shows this.</p>
<pre><code>❯ uv venv &amp;&amp; uv pip install pandas &amp;&amp; time .venv/bin/python -c &quot;import pandas&quot;
...
.venv/bin/python -c &quot;import pandas&quot;  1.65s user 0.39s system 10% cpu 19.765 total
</code></pre>
<pre><code>❯ python3.13 -m venv .venv &amp;&amp; .venv/bin/python3.13 -m pip install pandas &amp;&amp; time .venv/bin/python -c &quot;import pandas&quot;
...
.venv/bin/python -c &quot;import pandas&quot;  0.39s user 0.10s system 2% cpu 16.609 total
</code></pre>
Full log
<p>

<pre><code>❯ uv venv &amp;&amp; uv pip install pandas &amp;&amp; time .venv/bin/python -c &quot;import pandas&quot;
Using CPython 3.13.0 interpreter at: /usr/local/opt/python@3.13/bin/python3.13
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
Resolved 6 packages in 11ms
Installed 6 packages in 93ms
 + numpy==2.1.3
 + pandas==2.2.3
 + python-dateutil==2.9.0.post0
 + pytz==2024.2
 + six==1.17.0
 + tzdata==2024.2
.venv/bin/python -c &quot;import pandas&quot;  1.65s user 0.39s system 10% cpu 19.765 total
</code></pre>
<pre><code>❯ python3.13 -m venv .venv &amp;&amp; .venv/bin/python3.13 -m pip install pandas &amp;&amp; time .venv/bin/python -c &quot;import pandas&quot;
Collecting pandas
  Using cached pandas-2.2.3-cp313-cp313-macosx_10_13_x86_64.whl.metadata (89 kB)
Collecting numpy&gt;=1.26.0 (from pandas)
  Using cached numpy-2.1.3-cp313-cp313-macosx_14_0_x86_64.whl.metadata (62 kB)
Collecting python-dateutil&gt;=2.8.2 (from pandas)
  Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl.metadata (8.4 kB)
Collecting pytz&gt;=2020.1 (from pandas)
  Using cached pytz-2024.2-py2.py3-none-any.whl.metadata (22 kB)
Collecting tzdata&gt;=2022.7 (from pandas)
  Using cached tzdata-2024.2-py2.py3-none-any.whl.metadata (1.4 kB)
Collecting six&gt;=1.5 (from python-dateutil&gt;=2.8.2-&gt;pandas)
  Using cached six-1.17.0-py2.py3-none-any.whl.metadata (1.7 kB)
Using cached pandas-2.2.3-cp313-cp313-macosx_10_13_x86_64.whl (12.5 MB)
Using cached numpy-2.1.3-cp313-cp313-macosx_14_0_x86_64.whl (6.6 MB)
Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl (229 kB)
Using cached pytz-2024.2-py2.py3-none-any.whl (508 kB)
Using cached tzdata-2024.2-py2.py3-none-any.whl (346 kB)
Using cached six-1.17.0-py2.py3-none-any.whl (11 kB)
Installing collected packages: pytz, tzdata, six, numpy, python-dateutil, pandas
Successfully installed numpy-2.1.3 pandas-2.2.3 python-dateutil-2.9.0.post0 pytz-2024.2 six-1.17.0 tzdata-2024.2

[notice] A new release of pip is available: 24.2 -&gt; 24.3.1
[notice] To update, run: python3.13 -m pip install --upgrade pip
.venv/bin/python -c &quot;import pandas&quot;  0.39s user 0.10s system 2% cpu 16.609 total
</code></pre>
</p>
 

<ul>
<li><strong>OS:</strong> macOS Sonoma 14.6.1</li>
<li><strong>Python:</strong> 3.13.0 (Homebrew)</li>
<li><strong>UV:</strong> uv 0.5.6 (Homebrew 2024-12-03)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-06 01:53</div>
            <div class="timeline-body"><p>Have you tried running with <code>--compile-bytecode</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-06 01:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ketozhang">@ketozhang</a> on 2024-12-06 18:33</div>
            <div class="timeline-body"><p>That was my guess that uv-created virtualenvs are taking longer to compile bytecode (curious why)</p>
<p>Adding <code>--compile-bytecode</code> does go faster</p>
<pre><code>❯ uv venv &amp;&amp; uv pip install --compile-bytecode pandas &amp;&amp; time .venv/bin/python -c &quot;import pandas&quot;
...  
.venv/bin/python -c &quot;import pandas&quot;  0.51s user 0.15s system 2% cpu 23.172 total
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-06 18:43</div>
            <div class="timeline-body"><p>I don&#x27;t think they&#x27;re taking longer to compile bytecode. We just don&#x27;t compile bytecode upfront by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ketozhang">@ketozhang</a> on 2024-12-06 18:49</div>
            <div class="timeline-body"><p>Gotcha, I must&#x27;ve misremembered that pip doesn&#x27;t compile during install. (Can&#x27;t tell from <a href="https://pip.pypa.io/en/stable/cli/pip_install/">install help docs</a>).</p>
<p>If that&#x27;s it, then this is solved.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-06 19:21</div>
            <div class="timeline-body"><p>There&#x27;s a note in our documentation at https://docs.astral.sh/uv/pip/compatibility/#bytecode-compilation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-06 19:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:59 UTC
    </footer>
</body>
</html>
