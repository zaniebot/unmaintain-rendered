<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnose `.dirty` version - astral-sh/uv #10931</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Diagnose `.dirty` version</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10931">#10931</a>
        opened by <a href="https://github.com/superlopuh">@superlopuh</a>
        on 2025-01-24 08:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/superlopuh">@superlopuh</a> on 2025-01-24 08:49</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Is there a way to print the reasoning behind a <code>.dirty</code> in the version of a package? I'm playing around with my dependency spec in a <code>pyproject.toml</code>, and seemingly innocuous changes add a <code>.dirty</code> to the version string, and I have no idea why.</p>
<h3>Platform</h3>
<p>macOS 15.2</p>
<h3>Version</h3>
<p>uv 0.5.20 (Homebrew 2025-01-15)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @superlopuh on 2025-01-24 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-24 14:43</div>
            <div class="timeline-body"><p>Sorry, can you create a reproduction? This doesn't seem to be a uv behavior. I'm guessing that your build backend is doing this. Are you using dynamic metadata?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/superlopuh">@superlopuh</a> on 2025-01-24 16:32</div>
            <div class="timeline-body"><p>Hi, would you like me to create a minimal reproducer? Here are the steps to reproduce in the project I'm working on, we do use a dynamic version.</p>
<p>The behaviour can be observed by cloning our pure python repo and comparing <a href="https://github.com/xdslproject/xdsl/tree/sasha/dependencies/less-precise-versions">this branch</a> to main. Running <code>uv sync</code> or <code>make venv</code> on main results in a non-dirty version, vs the branch's dirty suffix. The <code>~=</code> seem to cause it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-01-24 16:35</div>
            <div class="timeline-body"><p>The <code>.dirty</code> seems to be created by <code>versioneer.py</code>, unrelated to uv</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/superlopuh">@superlopuh</a> on 2025-01-24 16:38</div>
            <div class="timeline-body"><p>I see, thank you! I wasn't sure how to phrase the issue, and I appreciate your help here, but do you think that some way to get uv to print the reasoning behind the .dirty would make sense? It would be nice to know where to start looking as a user instead of filing a new issue when this happens.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/superlopuh">@superlopuh</a> on 2025-01-24 16:39</div>
            <div class="timeline-body"><p>Or you mean that the version string itself is generated by versioneer, and unrelated to uv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-01-24 17:00</div>
            <div class="timeline-body"><p>When you build from source code, the front end installer (in this case uv, but could be pip, or poetry, or pdm, etc.) calls the backend builder (in this case <a href="https://github.com/xdslproject/xdsl/blob/sasha/dependencies/less-precise-versions/pyproject.toml#L69">setuptools and versioneer</a>) to build the package.</p>
<p>The front end only knows what the backend is doing via some limited hooks, and anything that is printed to stdout or stderr, the backend can be running arbitary code. As <a href="https://github.com/xdslproject/xdsl/blob/sasha/dependencies/less-precise-versions/pyproject.toml#L14">your version</a> is dynamic that tells the frontend to get the version from the backend.</p>
<p>Versioneer is doing <em>something</em> to put &quot;<a href="https://github.com/xdslproject/xdsl/blob/sasha/dependencies/less-precise-versions/versioneer.py#L78">dirty</a>&quot; in the <a href="https://github.com/xdslproject/xdsl/blob/sasha/dependencies/less-precise-versions/versioneer.py#L128">version string</a>. But the frontend, uv, is not privy to why it is doing that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/superlopuh">@superlopuh</a> on 2025-01-24 17:24</div>
            <div class="timeline-body"><p>Thank you for the explanation! I was under the impression that uv appended this to the version string when some modifications were made to the venv it managed, sorry about the noise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @superlopuh on 2025-01-24 17:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
