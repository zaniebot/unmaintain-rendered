<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should `uv sync` sync the full workspace by default? - astral-sh/uv #5727</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Should `uv sync` sync the full workspace by default?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/5727">#5727</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-08-02 14:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 14:50</div>
            <div class="timeline-body"><p>If you have a virtual workspace, we do this. But for non-virtual workspaces, we sync the workspace root. It's a little bit of a footgun (see, e.g., https://github.com/astral-sh/ruff/pull/12622#issuecomment-2265469492).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-08-02 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 14:58</div>
            <div class="timeline-body"><p>There are a few different cases to consider...</p>
<ul>
<li><code>uv sync</code> from the workspace root</li>
<li><code>uv sync -p foo</code> from the workspace root</li>
<li><code>uv sync</code> from a workspace member (e.g., <code>./foo</code>)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-02 14:59</div>
            <div class="timeline-body"><p>Does this mean that all workspace requirements would no longer need to be explicit?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 16:58</div>
            <div class="timeline-body"><p>I think it'd be something like:</p>
<ul>
<li><code>uv sync</code> (and <code>uv run</code> by extension) always syncs the full workspace, regardless of whether you're in the top-level directory or a project.</li>
<li><code>uv sync -p</code> always syncs the specified package (and it could be the workspace root).</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-08-02 17:32</div>
            <div class="timeline-body"><p>I have a minor concern that <code>un run</code> would uninstall some other part of the workspace that an already running (concurrent) <code>uv run</code> is using - that's a drawback of the current behaviour, I mean.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 17:55</div>
            <div class="timeline-body"><p>In general <code>uv run</code> won't uninstall (unless your dependencies changed in some way) -- it just makes the changes necessary to get to a sufficient state, but could include some packages that you don't need.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> removed by @zanieb on 2024-08-20 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-20 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2024-09-03 01:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-03 01:21</div>
            <div class="timeline-body"><p>This has come up a few times so leaving it open for more discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6832.html">astral-sh/uv#6832</a> on 2024-09-03 01:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2024-09-03 01:25</div>
            <div class="timeline-body"><p>I guess a good default behavior is to take a light touch, so maybe not <code>sync</code>ing the full workspace by default makes sense.</p>
<p>Perhaps we can add a CLI/config arg to <code>sync</code>, something like <code>--full-workspace</code>, and provide decent docs on the decision</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../developmentseed/cql2-rs/pulls/40.html">developmentseed/cql2-rs#40</a> on 2024-10-10 20:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6797.html">astral-sh/uv#6797</a> on 2024-10-30 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 20:43</div>
            <div class="timeline-body"><blockquote>
<p>I guess a good default behavior is to take a light touch, so maybe not syncing the full workspace by default makes sense.</p>
</blockquote>
<p>Hmm.. I'd suggest the opposite -- that the good default behaviour is the least surprising one. If I've set up a workspace, I've explicitly declared &quot;I'm going to be working with all of these members&quot;. It's very strange that <code>uv sync</code> sets up a venv, but doesn't install anything (unless my workspace root also happens to be a &quot;real&quot; project vs. just a workspace container) -- even though it does a full resolve and creates a lock file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 20:46</div>
            <div class="timeline-body"><p>I would argue that it would also be surprising, though, if any package could import any other package regardless of whether it was declared as a dependency, which is what would be enabled if we synced the entire workspace by default. We would lose any sort of enforcement of module boundaries.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 20:55</div>
            <div class="timeline-body"><p>But don't you end up in that state anyway, once you've synced multiple members of the workspace? e.g. from what you said above -- <code>uv run</code> won't uninstall, so you'll have things you don't need available in the environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 20:57</div>
            <div class="timeline-body"><p><code>uv run --exact</code> will uninstall packages, as will <code>uv sync</code>, but yes <code>uv run</code> won't uninstall by default. That's a compromise, though, to make things work as expected with extras -- we don't want to <em>remove</em> extras between <code>uv run --extra dev</code> to <code>uv run</code> invocation, since <em>that</em> would be surprising to users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 21:10</div>
            <div class="timeline-body"><p>I think that makes workspaces much less useful. For example, the comfyui/plugins scenario can't be supported reasonably. Ideally, I'd want to specify extras as a global thing for the workspace. In other words, I wouldn't have the ability to run workspace member <code>foo</code> with extra <code>thing</code> and workspace member <code>bar</code> without extra <code>thing</code>. If I want that, why am I in a workspace to begin with? (Or if I <em>really</em> want that, <code>uv run --isolated</code> already exists.) Again, totally just my opinion, but to me:</p>
<ul>
<li>inside a workspace, there should be one global set of packages (the full resolution), with any extra sets globally applied across all members</li>
<li>if I want to run a specific project with a different set of packages, then I should need to use <code>--isolated</code></li>
</ul>
<p>it shouldn't be up to <code>uv</code> to enforce perfect dependency declarations; that can be verified with <code>--isolated</code>, but otherwise it's a python ecosystem limitation that you can't really do this.</p>
<p>Edit: at the very least, an option to do this (sync everything) that can be set in the workspace root would be helpful. Then the actual default doesn't matter much.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-30 22:58</div>
            <div class="timeline-body"><p>I completely missed the mention of &quot;virtual workspace&quot; vs. project in the initial post here. (There's also no mention of &quot;virtual workspace&quot; on https://docs.astral.sh/uv/concepts/workspaces/) If I just remove the <code>[project]</code> section (which was a dummy section -- I thought I needed one!) then I think I'm getting the behaviour that I want, but I'm currently fighting with pytorch still.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6523.html">astral-sh/uv#6523</a> on 2024-10-30 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 04:30</div>
            <div class="timeline-body"><p>The “virtual workspace” concept isn’t present in the docs because they’re considered legacy. We removed them in favor of non-packaged projects (projects without a build system), which you can find in the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-10-31 05:12</div>
            <div class="timeline-body"><p>Ah ok. Please don't remove them even if legacy until there's another way to get the full-workspace sync behaviour -- it's the only way to make this work right now. non-packaged projects trigger the &quot;sync just the project&quot; behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-02 02:37</div>
            <div class="timeline-body"><p>You can now use <code>uv sync --all-packages</code> (same on <code>uv run</code>, <code>uv export</code>, etc.) to sync the full workspace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-02 02:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-11-02 02:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-11-02 02:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vvuk">@vvuk</a> on 2024-11-06 17:43</div>
            <div class="timeline-body"><p>Great, thank you! Is there a way to set this in the workspace pyproject file, so that it doesn't need to be passed in as a command line argument?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/m-dziuba">@m-dziuba</a> on 2025-01-29 07:39</div>
            <div class="timeline-body"><p>You could use direnv so that the command is ran automatically every time you enter the the main directory. Or set up an alias like <code>usa</code> for <code>uv sync --all-packages</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/krpatter-intc">@krpatter-intc</a> on 2025-02-13 19:34</div>
            <div class="timeline-body"><p>I see this is released and that the <code>uv sync --all-packages</code> runs. However, I can't tell the behavior change. It still seems that <code>uv sync --all-packages</code> will install/uninstall based on the current-working-dir. For example: running it in a workspace followed by running it in the root, will uninstall the dependencies of the workgroups.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-13 19:36</div>
            <div class="timeline-body"><p>@krpatter-intc -- Please create a separate issue with a clear reproduction that we can run ourselves, rather than commenting on a closed issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rosmur">@rosmur</a> on 2025-10-29 04:11</div>
            <div class="timeline-body"><blockquote>
<p>You can now use uv sync --all-packages (same on uv run, uv export, etc.) to sync the full workspace.</p>
</blockquote>
<p>requesting confirmation that this is still the correct method and the default <code>uv sync</code> behavior is not changed? Claude Code seems to think that it did</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-29 11:40</div>
            <div class="timeline-body"><p>Please check our documentation on workspaces, it is more accurate that LLms: https://docs.astral.sh/uv/concepts/projects/workspaces/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rosmur">@rosmur</a> on 2025-10-30 06:09</div>
            <div class="timeline-body"><p>@konstin I did. nowhere in that page (or anywhere else in the docs) is this information stated cleanly/explicitly.</p>
<p>Please understand that people are swtiching to using AI as the front end for docs - and this is arguably a sensible/pragmatic approach as reading docs requires time investment that many devs dont have/cant prioritize. It then behooves maintainers to ensure that a) docs are replete b) human and machine friendly.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:20 UTC
    </footer>
</body>
</html>
