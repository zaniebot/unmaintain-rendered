```yaml
number: 14729
title: uv 0.8.0 --with behaviour not finding current project
type: issue
state: closed
author: Zaloog
labels:
  - bug
assignees: []
created_at: 2025-07-18T15:53:19Z
updated_at: 2025-07-22T12:13:15Z
url: https://github.com/astral-sh/uv/issues/14729
synced_at: 2026-01-10T01:57:33Z
```

# uv 0.8.0 --with behaviour not finding current project

---

_Issue opened by @Zaloog on 2025-07-18 15:53_

### Summary

Ive build a tool (ayu) which utilizes the `--with` feature to install itself as a pytest plugin to be used as an independent TUI for a project to execute tests interactively, this is accomplished by executing subprocesses  that runs commands  like: `uv run --with ayu pytest --collect-only`.

With the upgrade to 0.8.0 I am unable to import the project itself from the `conftest.py`. 
i.e. I get `ModuleNotFoundError, no module named X`, it also doesnt find the dev dependencies and throws an error if I have coverage arguments declared.

1. So if I run `uv run -w ayu pytest --collect-only` in my project `X`, I get a `ModeleNotFoundError, no module named X`.
2. When I run `uv run -w ayu python` and then `import  X` it works fine.
3. `Running uv run -w ayu,. pytest --collect-only` installs `X` also (though without dev dependencies as expected) and I do not get an import error.

Is the situation in 1. intended, to raise a module not found error for the current project working on?
Or is this one of the cases where the note from the release notes applies?
 > This should only cause breakage in cases where the environment is being inspected at runtime.


### Platform

Darwin 24.5.0 arm64

### Version

uv 0.8.0 (Homebrew 2025-07-17)

### Python version

Python 3.13.2

---

_Label `bug` added by @Zaloog on 2025-07-18 15:53_

---

_Comment by @zanieb on 2025-07-18 15:55_

Thanks for the report! I'll take a look

---

_Comment by @zanieb on 2025-07-18 16:00_

It looks like imports in general are fine
```
❯ uv self version
uv 0.8.0 (0b2357294 2025-07-17)
❯ uv init --package example
Initialized project `example` at `/private/tmp/example`
❯ cd example
❯ uv run --with anyio python -c "import example"
Using CPython 3.13.2
Creating virtual environment at: .venv
      Built example @ file:///private/tmp/example
Installed 1 package in 4ms
Installed 3 packages in 4ms
```

and via pytest
```
❯ uv add --dev pytest
Resolved 7 packages in 125ms
      Built example @ file:///private/tmp/example
Prepared 1 package in 6ms
Uninstalled 1 package in 0.93ms
Installed 6 packages in 10ms
 ~ example==0.1.0 (from file:///private/tmp/example)
 + iniconfig==2.1.0
 + packaging==25.0
 + pluggy==1.6.0
 + pygments==2.19.2
 + pytest==8.4.1
❯ echo "import example" > conftest.py
❯ uv run --with anyio pytest
============================================================================================================================= test session starts =============================================================================================================================
platform darwin -- Python 3.13.2, pytest-8.4.1, pluggy-1.6.0
rootdir: /private/tmp/example
configfile: pyproject.toml
collected 0 items                                                                                                                                                                                                                                                             

============================================================================================================================ no tests ran in 0.00s ============================================================================================================================
```

---

_Comment by @zanieb on 2025-07-18 16:00_

Can you provide a minimal reproduction?

---

_Comment by @zanieb on 2025-07-18 16:02_

I can reproduce with `ayu`

```
❯ uv run --with ayu pytest
Installed 48 packages in 40ms
ImportError while loading conftest '/private/tmp/example/test/conftest.py'.
test/conftest.py:1: in <module>
    import example
E   ModuleNotFoundError: No module named 'example'
```

I presume you're doing something unusual?

---

_Comment by @Zaloog on 2025-07-18 16:38_

Hi @zanieb  thanks for the quick response.

I also was unable to reproduce it with other packages.
Hmm i am not aware of something unusual, the idea behind `ayu` was to install itself on the fly before invoking pytest, to act as a plugin and send test data to a websocket server which is started by the ayu TUI part.

So if you do `uvx ayu` it starts the TUI.
On start it executes `uv run -w ayu pytest --co` to send the test tree to the TUI to be displayed.

I am not sure how the new v0.8.0 release changed the ephemeral virtual env structure, but I would expect that
it would contain the project+project_dependencies +ayu+ayu_dependencies.

Heres the [pyproject.toml](https://github.com/Zaloog/ayu/blob/main/pyproject.toml) of my project.
Can you spot anything unusual there? 




---

_Comment by @zanieb on 2025-07-18 16:47_

I don't see anything unusual there. I presume it's an interaction with the pytest plugin / collection system? I think I'd have to go pretty deep to give more advice.

All we did was add another layer, so instead of `project -> with requirements` it's `project -> with requirements -> empty`.

---

_Comment by @Zaloog on 2025-07-18 21:29_

Ye my understanding from the layer was pretty much that. But the way you wrote the sequence makes it even more clear.

Hmm but how does the extra layer mess this up? It worked well before... I wouldnt expect a change in functionality there...


If you have time and want to dig deeper, Id be very thankful and if you need more information on my part, I am happy to support, but I can also understand if you have more important things to do.
Ill add a note for now to m project, that it doesnt work under uv>=0.8.0.

---

_Referenced in [Zaloog/ayu#1](../../Zaloog/ayu/issues/1.md) on 2025-07-18 21:33_

---

_Comment by @zanieb on 2025-07-19 00:58_

If you can get some sort of verbose logs or traceback from Python prior to

```
ImportError while loading conftest '/private/tmp/example/test/conftest.py'.
test/conftest.py:1: in <module>
    import example
E   ModuleNotFoundError: No module named 'example'
```

it might help us understand how conftest is being loaded.

---

_Comment by @Zaloog on 2025-07-21 08:20_

You mean like the output of
`uv run --with ayu pytest` prior to the new uv version 0.8.0? Will do that after work.

One more thing I observed is, that the dev dependencies for in your case`example` also are not detected when running pytest.
I.e. I have arguments for `pytest-cov` and `pytest-xdist` defined in the pytproject.toml, but get notified, that the arguments are unknown.

If I add the mentioned above pytest plugins as part of the `--with` part, they get installed correctly.



---

_Comment by @zanieb on 2025-07-21 12:31_

I think we've identified that this is causing more breakage https://github.com/astral-sh/uv/issues/14749

I think it's the same root problem as https://github.com/astral-sh/uv/issues/13327

---

_Referenced in [astral-sh/uv#14788](../../astral-sh/uv/pulls/14788.md) on 2025-07-21 13:01_

---

_Referenced in [astral-sh/uv#14790](../../astral-sh/uv/pulls/14790.md) on 2025-07-21 14:41_

---

_Closed by @zanieb on 2025-07-22 12:11_

---

_Comment by @Zaloog on 2025-07-22 12:13_

Thanks a lot @zanieb for the blazing fast support


---
