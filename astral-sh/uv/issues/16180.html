<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Question] UV Caching in Docker behaviour? - astral-sh/uv #16180</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Question] UV Caching in Docker behaviour?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16180">#16180</a>
        opened by <a href="https://github.com/vaibhavmano">@vaibhavmano</a>
        on 2025-10-08 10:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vaibhavmano">@vaibhavmano</a> on 2025-10-08 10:28</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I have checked out <a href="https://docs.astral.sh/uv/guides/integration/docker/#caching">Docker Caching</a> and the <a href="https://github.com/astral-sh/uv-docker-example/blob/main/Dockerfile">uv docker example</a>. Both of them fail to clarify on the behaviour of the cache directory.</p>
<p>In the local system, I'm able to check and verify that the <code>UV_CACHE_DIR</code> contains many folders and files like <code>CACHEDIR.TAG</code>, <code>wheels</code>, <code>interpreter</code> etc.</p>
<p>The case is different when building a Docker Image though! Below is one of my <code>Dockerfile</code> for a service</p>
<pre><code>FROM basexg:latest

ENV SERVICE_NAME=application
ENV UV_CACHE_DIR=/${SERVICE_NAME}/cache/uv

COPY /pyproject.toml /build/
COPY /uv.lock /build/
COPY /baselib /build/baselib
COPY /application /build/application

WORKDIR /build
# WITH CACHE
RUN --mount=type=cache,target=${UV_CACHE_DIR} \
    uv sync --active --frozen --no-group dev --package application

RUN useradd -u 1001 snapp &amp;&amp; chown -R snapp:snapp /build
USER snapp

ENTRYPOINT [&quot;sh&quot;, &quot;/build/application/start.sh&quot;]
</code></pre>
<p>This is the <code>pyproject.toml</code> for the service file</p>
<pre><code>[project]
name = &quot;application&quot;
version = &quot;1.0.0&quot;
description = &quot;Contains all business logics related to application service&quot;
authors = [{ email = &quot;john@test.com&quot; }]
requires-python = &quot;==3.12.*&quot;
dependencies = [
    &quot;baselib==0.1.0&quot;,
    &quot;jsonschema==4.22.0&quot;,
]

[tool.uv]
package = false

[tool.uv.sources]
baselib = { workspace = true }


[dependency-groups]
dev = [
    &quot;ruff==0.13.0&quot;,
    &quot;bandit&gt;=1.8.6&quot;,
    &quot;pytest&gt;=8.4.2&quot;,
    &quot;pytest-cov&gt;=7.0.0&quot;,
]

[tool.pytest.ini_options]
pythonpath = [&quot;.&quot;]
addopts = &quot;--cov=. --cov-report=xml&quot;
testpaths = [&quot;tests&quot;]

</code></pre>
<p>Running <code>uv cache dir</code> inside the container returns the value <code>/application/cache/uv</code>. However, as mentioned in the doc, the cache directory is not created inside the container as well as in the host system.</p>
<ol>
<li>Is this the right behaviour? I'm guessing the cache mount should exist somewhere. I have also been able to verify this because the packages keep downloading from the source and not used from the cache. This is the docker build command <code>docker build -f application/Dockerfile -t apps . --progress=plain</code>. I've added <code>tokenizers</code> as a dependency to test the cache and it starts to download all the package and I assumed the cache would install only the new package.</li>
</ol>
<p>Snippet that all the dependent packages are being downloaded.</p>
<pre><code>#11 11.11  Downloading google-api-python-client
#11 11.53  Downloading uv
#11 11.85  Downloading pymupdf
#11 12.14  Downloading botocore
#11 15.23       Built uwsgi==2.0.28
#11 15.24 Prepared 157 packages in 14.27s
#11 15.57 Installed 157 packages in 330ms
</code></pre>
<ol start="2">
<li>My existing setup consists of using Jenkins as the CI/CD server running on k8s. All the jenkins build agents are therefore ephemeral and I won't be able to use the host file system for the uv cache. Only if above problem is resolved, I'll be able to check and see if I can mount a k8s pvc as a <code>UV_CACHE_DIR</code></li>
</ol>
<h3>Platform</h3>
<p>macOS 15.4 x86_64</p>
<h3>Version</h3>
<p>uv 0.8.17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @vaibhavmano on 2025-10-08 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "UV Caching in Docker behaviour?" to "[Question] UV Caching in Docker behaviour?" by @vaibhavmano on 2025-10-09 06:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 13:33</div>
            <div class="timeline-body"><p>I tried to reproduce this with a simple project and this docker and it is caching for me:</p>
<pre><code class="language-dockerfile">FROM ghcr.io/astral-sh/uv:0.9.18 AS uv
FROM debian

COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/
ADD pyproject.toml pyproject.toml
ADD uv.lock uv.lock
ADD src src

ENV UV_LINK_MODE=copy

RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync
</code></pre>
<p>The caching relies on local docker volume, which docker manages for you. If you have a distributed setup, you can mount in e.g. a shared volume and with <code>uv cache prune</code> to only cache the slow parts, it's not something we can give general advice on in the uv docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @vaibhavmano on 2025-12-22 11:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
