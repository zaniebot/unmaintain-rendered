<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provide uv zipapp - astral-sh/uv #7419</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Provide uv zipapp</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/7419">#7419</a>
        opened by <a href="https://github.com/ksamuel">@ksamuel</a>
        on 2024-09-16 09:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ksamuel">@ksamuel</a> on 2024-09-16 09:51</div>
            <div class="timeline-body"><p>Now that uv can run zipapps, there is the potential for a good story to build python projects before pushing them in production instead of doing the build on the server.</p>
<p>However, building a zipapp is currently too complicated for the average user:</p>
<ul>
<li>The format assumes the code base is zipsafe, but most projects aren't. Web frameworks like django, flasks or fastapi actually assume they have access to the file system directly.</li>
<li>The stdlib zipapp packager (https://docs.python.org/3/library/zipapp.html) doesn't have any way to package dependencies.</li>
<li>Even when using something like shiv (https://shiv.readthedocs.io/) to build zipapp with dependencies, creating one on Windows can lead to a Windows specific zipapp if c-extensions are installed, and the deployment on a Linux server will fail.</li>
<li>It requires a nontrivial understanding of entry points to make that work. Between <code>__main__.py</code>, WSGI <code>app</code> var and <code>if __name__ == &quot;__main__&quot;</code>, most beginners have little chance to make the correct choice.</li>
<li>Building a viable zipapp implies copying more than Python code. You may also want static files, and sometimes scripts that are not importable by default yet parts of the entry point (e.g: CSS files and <code>manage.py</code> with django).</li>
</ul>
<p>There is an opportunity to make uv the first tool to allow fast and easy Python deployments by:</p>
<ul>
<li>Providing an &quot;uv zipapp&quot; subcommand that will turn your script or project into a zipapp.</li>
<li>Adopting the shiv hack that unzip the project on the first run to allow transparent filesystem access.</li>
<li>Giving hooks to build a zipapp for other OSes than the one you build it on, thanks to packse.</li>
<li>Making the common entry points trivial to declare. From a simple script with inline deps to complex web app.</li>
<li>Allowing straightforward declaration of additional files to be added into the zip.</li>
<li>Adding checks such as platform compat and Python version into the zipapp so that if it fails to run, the end-user has a nice error message to figure it out.</li>
<li>Ensuring configurability from <code>pyproject.toml</code>, so you don't have to figure out the command line options every time for big projects.</li>
<li>Letting you optionally clean up the older deployment artifacts.</li>
</ul>
<p>Finding a clear solution for the that entry point is the hard part. It needs to be usable as an import (to use in a shell), with variables from the entry points (like access to the app var for wsgi) and as an executable script (for the cli use case), yet proxy all that to the unzipped cache transparently.</p>
<p>uv already has all the primitives to do this: compression, deps download, and platform mapping. Plus, it can do it fast and correctly. It would be the first tool to actually make zipapps practical to use.</p>
<p>What's more, it would be a stepping stone for creating full standalone executable later on, with uv bundled into the zip to bootstrap python itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattmess1221">@mattmess1221</a> on 2024-10-07 23:21</div>
            <div class="timeline-body"><p>For reference, <a href="https://github.com/ClericPy/zipapps"><code>zipapps</code></a> is able to bundle dependencies into a <code>.pyz</code> as well, including entire virtualenvs. It can also lazily install dependencies on first run (useful for programs with non-python dependencies)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-10-08 01:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @zanieb on 2024-10-08 01:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-08 01:47</div>
            <div class="timeline-body"><p>Thanks for the write-up! We're focused on core functionality outside of bundling right now, but it's definitely something we're interested in doing someday. I'm not sure zipapp is the ideal format for us, but I don't know much about it yet.</p>
<p>Related</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/7865</li>
<li>https://github.com/astral-sh/uv/issues/5802</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ksamuel">@ksamuel</a> on 2024-10-08 10:03</div>
            <div class="timeline-body"><p>Cheers.</p>
<p>I'd like to add that zipapps are different to the bundles defined in those 2 tickets since they explicitly don't bundle a Python environment.</p>
<p>This means:</p>
<ul>
<li>You can ship a zipapp to saas that don't allow you to spawn your own process like heroku, or only allow a WSGI entry point (like the popular pythonanywhere.com).</li>
<li>A zipapp with no c-extension is platform agnostic.</li>
<li>The resulting zip is smaller.</li>
<li>You can deploy a zipapp with secured systems that can't allow non white-listed executable to run, or use custom python builds.</li>
<li>Zipapps work on alternative distributions like anaconda.</li>
</ul>
<p>Of course, having a self-contained executable is a killer feature, but:</p>
<ul>
<li>I see them as different solutions to different problems.</li>
<li>A contained executable is a much harder problem to tackle. And an even harder problem to tackle correctly.</li>
<li>There are actually better solutions currently to build stand alone executables than zipapps in the python ecosystem, surprisingly.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/clbarnes">@clbarnes</a> on 2024-12-03 15:22</div>
            <div class="timeline-body"><p>For my use case, an MVP would be simply an equivalent of <code>uv run</code> which, instead of building an environment and running the given command/ script, would create a zipapp including the project/script and all its runtime dependencies. Working with inline script metadata is most of what I want out of this tbh.</p>
<p>Bundling an interpreter in any kind of compiled package would be great, but IMO is outside of the scope of zipapps, as is any behaviour which would mean that the zipapp could only be run by uv.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:50 UTC
    </footer>
</body>
</html>
