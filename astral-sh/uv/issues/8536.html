<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv fails to install correct odrive version on old macOS - astral-sh/uv #8536</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv fails to install correct odrive version on old macOS</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8536">#8536</a>
        opened by <a href="https://github.com/alec-bike">@alec-bike</a>
        on 2024-10-24 18:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alec-bike">@alec-bike</a> on 2024-10-24 18:01</div>
            <div class="timeline-body"><p>I'm using <code>uv</code> on two macOS systems -- a newer M1 on macOS <code>15.1</code>, and an old Intel pegged to <code>11.7</code>. I'm trying to install the <code>odrive</code> package. Newer <code>odrive</code> packages (<code>&gt;0.6.8</code>) require macOS 12+, so I can install <code>0.6.9.post0</code> on the M1 but only <code>0.6.8</code> on the Intel.</p>
<p>If I don't use <code>uv</code> (and use <code>requirements.txt</code> and <code>pip</code> instead) I can specify <code>odrive &gt;= 0.6.8</code> in <code>requirements.txt</code> and <code>pip install -r requirements.txt</code> will choose the correct package version on both platforms (<code>0.6.8</code> on the Intel, <code>0.6.9.post0</code> on the M1).</p>
<p>If I use <code>uv</code> with <code>odrive&gt;=0.6.8</code> in pyproject.toml, <code>uv</code> will try to install <code>0.6.9.pos0</code> on the Intel and will fail.</p>
<p>I can force <code>uv</code> to install <code>0.6.8</code> on the Intel using <code>uv pip install -r requirements.txt</code> but <code>uv tree</code> still shows <code>0.6.9.post0</code> and some functionality (<code>uv run</code> for example) is broken.</p>
<p>I can edit the <code>pyproject.toml</code> on the Intel to force <code>&quot;odrive==0.6.8&quot;</code> and keep the changes local, but I'm hoping to find a cross-platform solution.</p>
<p>Any recommendations?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv sync fails to install correct odrive package version on old macOS" to "uv sync fails to install correct odrive version on old macOS" by @alec-bike on 2024-10-24 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv sync fails to install correct odrive version on old macOS" to "uv fails to install correct odrive version on old macOS" by @alec-bike on 2024-10-24 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-24 18:04</div>
            <div class="timeline-body"><p>Are you installing from PyPI?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alec-bike">@alec-bike</a> on 2024-10-24 18:06</div>
            <div class="timeline-body"><p>Yes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-24 18:54</div>
            <div class="timeline-body"><p>This is an area where the package isn't well-setup for uv's model of universal resolution: there's no source distribution, and some set of wheels, but the wheels don't cover the entire set of possible platforms. We basically have to assume that they do, since the set of possible platforms is infinite and not known in advance. So the resolver picks 0.6.9, but we then fail (I assume) to find a compatible wheel when you're on Intel.</p>
<blockquote>
<p>I can force uv to install 0.6.8 on the Intel using uv pip install -r requirements.txt but uv tree still shows 0.6.9.post0 and some functionality (uv run for example) is broken.</p>
</blockquote>
<p>This works because <code>uv pip install -r requirements.txt</code> will only install and resolve for the current platform, whereas <code>uv tree</code> and <code>uv run</code> use the universal resolver. They're two different modes of working that you typically don't want to mix-and-match -- you should either use the <code>uv pip</code> interface or <code>uv run</code> (plus <code>uv sync</code>, <code>uv lock</code>). (They <em>can</em> be mixed and matched, but that's mostly for power users.)</p>
<p>I think what you want here is to declare a different version for Intel macOS, like:</p>
<pre><code class="language-toml">[project]
dependencies = [
    &quot;odrive &lt; 0.6.9 ; platform_system == 'Darwin' and platform_machine == 'x86_64'&quot;,
    &quot;odrive &gt;= 0.6.9; platform_system != 'Darwin' or platform_machine != 'x86_64'&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-10-24 18:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alec-bike">@alec-bike</a> on 2024-10-24 19:46</div>
            <div class="timeline-body"><p>Thanks for the suggestion, that worked. I tweaked it to use <code>platform_release</code> instead of <code>_machine</code>:</p>
<pre><code class="language-zsh">dependencies = [
    &quot;odrive == 0.6.8 ; platform_system == 'Darwin' and platform_release &lt;= '20.6.0'&quot;,
    &quot;odrive &gt; 0.6.8; platform_system == 'Darwin' and platform_release &gt; '20.6.0'&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-24 19:52</div>
            <div class="timeline-body"><p>Nice! The underlying limitation around wheels-without-source-distributions is tracked here: https://github.com/astral-sh/uv/issues/5182. Gonna close in favor of that issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-10-24 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-10-24 19:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:38:56 UTC
    </footer>
</body>
</html>
