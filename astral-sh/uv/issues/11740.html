<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document recommended way to install private pypi packages in docker build - astral-sh/uv #11740</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Document recommended way to install private pypi packages in docker build</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11740">#11740</a>
        opened by <a href="https://github.com/RonNabuurs">@RonNabuurs</a>
        on 2025-02-24 09:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RonNabuurs">@RonNabuurs</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Already there is good documentation in how to use UV in a Dockerfile, but there is no documentation about the usage of private pypi repositories within Dockerfiles.</p>
<h3>Example</h3>
<p>One possible solution (though not recommended) could be using the arg and env variables in the Dockerfile:</p>
<p>E.g:
pyproject.toml</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;private&quot;
url = &quot;https://pypi.private.url&quot;
</code></pre>
<p>Dockerfile</p>
<pre><code class="language-Dockerfile">ARG UV_INDEX_PRIVATE_USERNAME
ENV UV_INDEX_PRIVATE_USERNAME=${UV_INDEX_PRIVATE_USERNAME}
ARG UV_INDEX_PRIVATE_PASSWORD
ENV UV_INDEX_PRIVATE_PASSWORD=${UV_INDEX_PRIVATE_PASSWORD}
</code></pre>
<p>I think it would be a nice addition to the documentation if some recommended way of handling this use case could be described.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @RonNabuurs on 2025-02-24 09:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sanmai-NL">@sanmai-NL</a> on 2025-02-24 10:37</div>
            <div class="timeline-body"><p><a href="https://pythonspeed.com/articles/docker-build-secrets/">When you do it like that, you store the result in the container image's history.</a></p>
<p>Use <a href="https://docs.docker.com/build/building/secrets/">build secrets</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RonNabuurs">@RonNabuurs</a> on 2025-02-24 11:25</div>
            <div class="timeline-body"><p>@sanmai-NL Thats true indeed. Though in our CI we use kaniko to build images. I don't think kaniko supports build secrets though, should we also include something like kaniko in uv docs, or is that too specific?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RonNabuurs">@RonNabuurs</a> on 2025-03-06 12:35</div>
            <div class="timeline-body"><p>I'm just putting this here if some one else also happens to have the same issue as me.</p>
<p>By using docker build secrets we could achieve my original outcome, but without adding the environment variable.</p>
<p>In your docker file you would do something like this:</p>
<pre><code class="language-Dockerfile">RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    --mount=type=secret,id=uvpass \
    UV_INDEX_PRIVATE_PASSWORD=$(cat &quot;/run/secrets/uvpass&quot;) \
    uv sync --frozen
</code></pre>
<p>Most of it is the same as described on the docs: https://docs.astral.sh/uv/guides/integration/docker/#intermediate-layers</p>
<p>If you Dockerfile looks like that you can build the container with:</p>
<pre><code>docker build --secret id=uvpass,env=UV_INDEX_PRIVATE_PASSWORD .
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:06 UTC
    </footer>
</body>
</html>
