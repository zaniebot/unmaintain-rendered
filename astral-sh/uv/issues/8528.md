```yaml
number: 8528
title: "``uv tool upgrade`` is not considered a failed update when it doesn't replace executable files in windows."
type: issue
state: closed
author: FishAlchemist
labels:
  - bug
  - help wanted
  - uv tool
assignees: []
created_at: 2024-10-24T14:36:03Z
updated_at: 2025-06-16T09:15:42Z
url: https://github.com/astral-sh/uv/issues/8528
synced_at: 2026-01-10T01:57:19Z
```

# ``uv tool upgrade`` is not considered a failed update when it doesn't replace executable files in windows.

---

_Issue opened by @FishAlchemist on 2024-10-24 14:36_

**version:** uv 0.4.25 (97eb6ab4a 2024-10-21)
**OS:** Windows 11 x86-64
 An upgrade should be considered a failure if it cannot be finished completely, enabling a retry.
* uv tool upgrade ruff
![image](https://github.com/user-attachments/assets/766e63b3-071c-4401-b5ed-e66db238ea41)
* ruff version
![image](https://github.com/user-attachments/assets/cf0e0264-7198-47fb-999f-3716f078721c)
* uv tool upgrade ruff
![image](https://github.com/user-attachments/assets/3814e4dd-35a2-4fd8-918e-3ef08d3041ff)

I suspect that the reason for the update failure is that I had Visual Studio Code open, which occupied the ruff executable file.

Edit:
This problem also occurs in uv 0.5.26 (5ef3d5139 2025-01-30).

---

_Label `bug` added by @zanieb on 2024-10-24 16:05_

---

_Label `help wanted` added by @zanieb on 2024-10-24 16:05_

---

_Label `uv tool` added by @zanieb on 2024-10-24 16:05_

---

_Referenced in [astral-sh/uv#11134](../../astral-sh/uv/issues/11134.md) on 2025-01-31 16:22_

---

_Comment by @charliermarsh on 2025-01-31 17:54_

This does return a non-zero exit code though, right?

---

_Comment by @FishAlchemist on 2025-01-31 19:14_

@charliermarsh Of course, the value is non-zero.
![Image](https://github.com/user-attachments/assets/4bfb9830-4c77-4e1e-99a3-fe7a95bc3acf)

Since my computer currently has ruff 0.9.4 installed (the latest version), if I want to reproduce it, I need to install the old version, and then delete the part that will affect the installation to the new version in the [tool.options] setting in uv-receipt.toml.

<details><summary> uv tool upgrade ruff --verbose </summary>
<p>

```powershell
DEBUG uv 0.5.26 (5ef3d5139 2025-01-30)
DEBUG Acquired lock for `AppData\Roaming\uv\data\tools`
DEBUG Upgrading tool: `ruff`
DEBUG Checking for Python environment at `AppData\Roaming\uv\data\tools\ruff`
DEBUG Found existing environment for tool `ruff`: AppData\Roaming\uv\data\tools\ruff
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13
DEBUG Solving with target Python version: >=3.13
DEBUG Adding direct dependency: ruff*
DEBUG Acquired lock for `C:\Users\[user_name]\AppData\Local\uv\cache\simple-v15\pypi\ruff.lock`
DEBUG Found stale response for: https://pypi.org/simple/ruff/
DEBUG Sending revalidation request for: https://pypi.org/simple/ruff/
DEBUG Found not-modified response for: https://pypi.org/simple/ruff/
DEBUG Released lock at `C:\Users\[user_name]\AppData\Local\uv\cache\simple-v15\pypi\ruff.lock`
DEBUG Searching for a compatible version of ruff (*)
DEBUG Found installed version of ruff==0.9.2 that satisfies *
DEBUG Found installed version of ruff==0.9.2 that satisfies *
DEBUG Selecting: ruff==0.9.4 [compatible] (ruff-0.9.4-py3-none-win_amd64.whl)
DEBUG Acquired lock for `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/12/41/2d2d2c6a72e62566f730e49254f602dfed23019c33b5b21ea8f8917315a1/ruff-0.9.4-py3-none-win_amd64.whl.metadata
DEBUG Released lock at `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Tried 1 versions: ruff 1
DEBUG marker environment resolution took 0.238s
DEBUG Requirement installed, but mismatched:
  Installed: Registry(InstalledRegistryDist { name: PackageName("ruff"), version: "0.9.2", path: "C:\\Users\\[user_name]\\AppData\\Roaming\\uv\\data\\tools\\ruff\\Lib\\site-packages\\ruff-0.9.2.dist-info", cache_info: None })
  Requested: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: "0.9.4" }]), index: Some(Url { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("pypi.org")), port: None, path: "/simple", query: None, fragment: None }), conflict: None }
DEBUG Must revalidate requirement: ruff
DEBUG Acquired lock for `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/12/41/2d2d2c6a72e62566f730e49254f602dfed23019c33b5b21ea8f8917315a1/ruff-0.9.4-py3-none-win_amd64.whl
DEBUG Released lock at `C:\Users\[user_name]\AppData\Local\uv\cache\wheels-v3\pypi\ruff\ruff-0.9.4-py3-none-win_amd64.lock`
DEBUG Uninstalled ruff (9 files, 3 directories)
Updated ruff v0.9.2 -> v0.9.4
 - ruff==0.9.2
 + ruff==0.9.4
DEBUG Removing executable: `C:/Users/[user_name]/.local/bin/ruff.exe`
WARN Failed to remove executable: `C:/Users/[user_name]/.local/bin/ruff.exe`: failed to remove file `C:/Users/[user_name]/.local/bin/ruff.exe`:  Access is denied. (os error 5)
DEBUG Installing tool executables into: .local\bin
DEBUG Looking at `.dist-info` at: AppData\Roaming\uv\data\tools\ruff\Lib\site-packages\ruff-0.9.4.dist-info
DEBUG Installing executable: `ruff.exe`
error: Failed to upgrade ruff
  Caused by: Failed to install entrypoint
  Caused by: failed to copy file from C:\Users\[user_name]\AppData\Roaming\uv\data\tools\ruff\Scripts\ruff.exe to C:\Users\[user_name]\.local\bin\ruff.exe: The process cannot access the file because it is being used by another process. (os error 32)
DEBUG Released lock at `C:\Users\[user_name]\AppData\Roaming\uv\data\tools\.lock`
```

</p>
</details> 

---

_Comment by @FishAlchemist on 2025-06-16 09:15_

This issue is a bit old, so I'll go ahead and close it.

---

_Closed by @FishAlchemist on 2025-06-16 09:15_

---

_Referenced in [astral-sh/uv#14520](../../astral-sh/uv/issues/14520.md) on 2025-07-09 14:48_

---
