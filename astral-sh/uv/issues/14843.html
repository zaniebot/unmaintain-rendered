<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadowed `install_name_tool` can break Python installation - astral-sh/uv #14843</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Shadowed `install_name_tool` can break Python installation</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/14843">#14843</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-07-23 12:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-23 12:33</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>e.g., when shadowed by an x86-64 <code>install_name_tool</code> from Conda as described in https://github.com/ankitects/anki/issues/4216, the command fails, but corrupts the binary somehow so subsequent uses fail.</p>
<p>We could do a few things</p>
<ul>
<li>Reimplement <code>install_name_tool</code> in Rust</li>
<li>Only use <code>install_name_tool</code> from <code>/usr/bin</code></li>
<li>Scan for an <code>install_name_tool</code> that matches the target architecture</li>
<li>Create a backup copy of the executable and replace atomically on <code>install_name_tool</code> failure</li>
<li>Add binary padding in PBS so we naively replace the target path in the executable</li>
</ul>
<h3>Platform</h3>
<p>macOS</p>
<h3>Version</h3>
<p>main</p>
<h3>Python version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-07-23 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ankitects/anki/issues/4216.html">ankitects/anki#4216</a> on 2025-07-23 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14869.html">astral-sh/uv#14869</a> on 2025-07-24 11:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14893.html">astral-sh/uv#14893</a> on 2025-07-25 12:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-07-30 18:45</div>
            <div class="timeline-body"><p>I'm about 80% of the way to an <code>install_name_tool</code> reimplementation in Rust (including re-codesigning) but I probably need to deprioritize the second 80% in favor of other work at the moment. Hopefully can get back to it in the next couple of weeks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @geofft by @geofft on 2025-07-30 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shuaib7860">@shuaib7860</a> on 2025-08-30 15:03</div>
            <div class="timeline-body"><p>Hi Guys,</p>
<p>Coming over from https://github.com/ankitects/anki/issues/4216, after many hours trying to solve my problem. This issue I believe captures my problem but mine is more about fixing my uv behaviour after a previous anaconda install which was uninstalled. How I go about resolving this, I'm not too sure but would really appreciate some help.</p>
<p>Basically I had an old MacBook with intel architecture which I recently replaced with a new MacBook on arm architecture. I had backed up all my files and transferred over to my new MacBook. So far so good. My old MacBook with the intel architecture had anaconda installed on it which transferred onto my new MacBook including the python install that came with anaconda.</p>
<p>But now I wanted to switch to uv on my new MacBook as I have become increasingly frustrated with anaconda and more accustomed to tools like uv. So I uninstalled my anaconda installation and deleted all the binaries and installed uv. But whenever I am outside of the default python environment in the terminal and try to create another venv, or if I run the uv run python command I am still running into the error:</p>
<pre><code>Failed to patch the install name of the dynamic library for /Users/choudhryshuaib/.local/share/uv/python/cpython-3.9.23-macos-aarch64-none/bin/python3.9. This may cause issues when building Python native extensions.
error: Querying Python at `/Users/choudhryshuaib/.local/share/uv/python/cpython-3.9.23-macos-aarch64-none/bin/python3.9` failed with exit status signal: 9 (SIGKILL).
</code></pre>
<p>I amended the .bashrc and .zshrc files but to no avail. Additionally, whenever I run python in the terminal I get zsh: killed python. But if I run python3 in the terminal, it works.</p>
<p>What is the best way to fix this? After spending a couple of days on this, my only thought is just to reboot my Mac from a fresh install and only back up essential files I want to keep. Do let me know if I'm missing anything obvious about how to resolve this as I can't get uv working at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-09-02 18:30</div>
            <div class="timeline-body"><p>@shuaib7860 What is the output of <code>where install_name_tool</code>? I'm guessing that either</p>
<ul>
<li>you still have a version from conda that hasn't been removed</li>
<li>you have an old, Intel version of Xcode's Developer Tools, and you should update your Xcode/Developer Tools to the latest version</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shuaib7860">@shuaib7860</a> on 2025-09-02 18:50</div>
            <div class="timeline-body"><p>Just ran <code>where install_name_tool</code>. The output I got was <code>/usr/bin/install_name_tool</code>.</p>
<p>Should I uninstall Xcode's developer tools and then make sure I install the arm version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/geofft">@geofft</a> on 2025-09-02 19:28</div>
            <div class="timeline-body"><p>I think that's worth trying!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shuaib7860">@shuaib7860</a> on 2025-09-02 19:43</div>
            <div class="timeline-body"><p>@geofft You're a legend. That did the trick. Many thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-01 11:37</div>
            <div class="timeline-body"><p><img width="1081" height="434" alt="Image" src="https://github.com/user-attachments/assets/546a374d-273c-4f7c-9494-fe0d355c0856" /></p>
<p>On a fresh macOS VM, the installation passes with a warning while simultaneously spawning the dev tools install dialog, I assume this will also be fixed by the reimplementation.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
