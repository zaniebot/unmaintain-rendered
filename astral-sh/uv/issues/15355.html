<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Request: Have `uv tool update-shell` check parent process when environment variables aren't enough - astral-sh/uv #15355</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature Request: Have `uv tool update-shell` check parent process when environment variables aren't enough</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15355">#15355</a>
        opened by <a href="https://github.com/edrogers">@edrogers</a>
        on 2025-08-18 16:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/edrogers">@edrogers</a> on 2025-08-18 16:17</div>
            <div class="timeline-body"><h3>Summary</h3>
<h2>Problem Description</h2>
<p>When the executable directory isn't in the PATH, <code>uv tool update-shell</code> attempts to use environment variables to determine the shell. If it succeeds in determining the shell, it will use that to fix the issue with the PATH. However, if the environment variables it checks for are unavailable, the command fails with <code>error: The executable directory /home/user/.local/bin is not in PATH, but the current shell could not be determined</code>.</p>
<p>While it's typical for these environment variables to be set, there are scenarios where they may not be. For example, the Linux x64 release of the self-hosted GitHub Actions runner application uses bash to call commands, but it does not export <code>BASH_VERSION</code> or <code>SHELL</code> as environment variables. Thus, if the executable directory is not already in the PATH, <code>uv tool update-shell</code> will raise the error mentioned above.</p>
<p>For unix-like systems at least, when the environment variables are not informative, it would be nice for <code>uv tool update-shell</code> to check the parent process command as a fallback approach. I'd like to introduce a Pull Request for this behavior.</p>
<h2>Environment Information</h2>
<ul>
<li><strong>uv version</strong>: 0.8.11</li>
<li><strong>Operating system</strong>: Ubuntu 22.04.5 LTS</li>
<li><strong>Shell</strong>: zsh 5.8.1 (x86_64-ubuntu-linux-gnu)</li>
</ul>
<h2>Minimal Reproduction</h2>
<pre><code class="language-bash"># Remove shell environment variables and run uv tool update-shell
env -u ZSH_VERSION -u SHELL -u PATH $(which uv) tool update-shell --verbose
</code></pre>
<pre><code class="language-text">DEBUG uv 0.8.11
DEBUG Ensuring that the executable directory is in PATH: /home/user/.local/bin
error: The executable directory /home/user/.local/bin is not in PATH, but the current shell could not be determined
</code></pre>
<p>While this is expected behavior, the calling process could be used to inform the <code>uv</code> of what shell is in use. See, for example:</p>
<pre><code class="language-bash">env -u ZSH_VERSION -u SHELL -u PATH $(which ps) -p $$ -o comm=
</code></pre>
<pre><code class="language-text">zsh
</code></pre>
<h2>Proposed Solution</h2>
<p>Add a fallback mechanism to Shell::from_env() for unix-like systems that inspects the parent process when environment variables are unavailable. The implementation would:</p>
<ol>
<li>Get the parent process ID</li>
<li>Read <code>/proc/&lt;ppid&gt;/exe</code> to determine the parent executable path</li>
<li>Fall back to <code>/proc/&lt;ppid&gt;/comm</code> if the exe symlink fails</li>
<li>Use the existing <code>parse_shell_from_path()</code> function to identify the shell type</li>
</ol>
<p>This approach should be fully compatible with existing workflows. It would only have an impact in cases where, currently, an error is raised.</p>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @edrogers on 2025-08-18 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-18 16:21</div>
            <div class="timeline-body"><p>This seems reasonable to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2025-08-18 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-08-18 18:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:26:50 UTC
    </footer>
</body>
</html>
