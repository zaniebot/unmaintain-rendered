<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fails to install `azure-cli` (which is installed just fine with `pip`) - astral-sh/uv #9510</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fails to install `azure-cli` (which is installed just fine with `pip`)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9510">#9510</a>
        opened by <a href="https://github.com/facundobatista">@facundobatista</a>
        on 2024-11-28 17:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/facundobatista">@facundobatista</a> on 2024-11-28 17:40</div>
            <div class="timeline-body"><p>Working with <code>uv 0.5.5</code> under Ubuntu 24.04.1 LTS.</p>
<p>I tried the following <code>uv --verbose tool run --from azure-cli az --version</code>, which end up failing with</p>
<pre><code>Traceback (most recent call last):
  File &quot;&lt;frozen runpy&gt;&quot;, line 189, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 112, in _get_module_details
  File &quot;/home/facundo/.cache/uv/archive-v0/It-BMRRUxK61HFCnOgJeg/lib/python3.12/site-packages/azure/__init__.py&quot;, line 1, in &lt;module&gt;
    __import__('pkg_resources').declare_namespace(__name__)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
ModuleNotFoundError: No module named 'pkg_resources'
</code></pre>
<p>(full verbose run <a href="https://gist.githubusercontent.com/facundobatista/618aeb8765b69b73d4428ab2355f3d93/raw/077e5b9c7a85020b13af2e1ab4a7d2b97c1f2d08/gistfile1.txt">in this gist</a> way too long to include it here)</p>
<p>Note that <code>azure-cli</code> is <strong>installable just fine with <code>pip</code></strong> (see <a href="https://gist.github.com/facundobatista/25f3124465b8b2cad9d9cec359de5d88">this other gist</a> for the logs).</p>
<p>Strangely, in the pip installation there is no <code>lib/python3.12/site-packages/azure/__init__.py</code> file... but hey, it works:</p>
<pre><code>(testaz) 14:37:08|facundo@trifon:~/temp$ which az
/home/facundo/temp/testaz/bin/az
(testaz) 14:37:24|facundo@trifon:~/temp$ az --version
azure-cli                         2.67.0
...
(testaz) 14:37:31|facundo@trifon:~/temp$ ll /home/facundo/temp/testaz/lib/python3.12/site-packages/azure/
total 60
drwxrwxr-x  5 facundo facundo 4096 nov 28 14:36 appconfiguration
drwxrwxr-x  6 facundo facundo 4096 nov 28 14:36 batch
drwxrwxr-x  6 facundo facundo 4096 nov 28 14:36 cli
drwxrwxr-x  3 facundo facundo 4096 nov 28 14:36 common
drwxrwxr-x  8 facundo facundo 4096 nov 28 14:36 core
drwxrwxr-x  5 facundo facundo 4096 nov 28 14:36 cosmos
drwxrwxr-x  3 facundo facundo 4096 nov 28 14:36 data
drwxrwxr-x  4 facundo facundo 4096 nov 28 14:36 datalake
drwxrwxr-x  6 facundo facundo 4096 nov 28 14:36 keyvault
drwxrwxr-x 66 facundo facundo 4096 nov 28 14:36 mgmt
drwxrwxr-x  3 facundo facundo 4096 nov 28 14:36 monitor
drwxrwxr-x  6 facundo facundo 4096 nov 28 14:36 multiapi
drwxrwxr-x  3 facundo facundo 4096 nov 28 14:36 profiles
drwxrwxr-x  3 facundo facundo 4096 nov 28 14:36 storage
drwxrwxr-x  6 facundo facundo 4096 nov 28 14:36 synapse
(testaz) 14:37:55|facundo@trifon:~/temp$ 

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-29 16:49</div>
            <div class="timeline-body"><p>I think you might need <code>--with setuptools</code>? Though I'm not sure why. Does that fix it for you? <code>azure-cli</code> might be assuming something non-standard about the virtual environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-29 16:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimbleby">@dimbleby</a> on 2024-11-29 17:12</div>
            <div class="timeline-body"><p>there are lots of duplicates, uv failure to install azure-cli is always about pre-releases</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/facundobatista">@facundobatista</a> on 2024-11-29 19:08</div>
            <div class="timeline-body"><p>@charliermarsh But <code>setuptools</code> is a dependency of <code>azure-cli</code> (declared in its <code>setup.py</code>), so why would one need to indicate that separately?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/facundobatista">@facundobatista</a> on 2024-11-29 19:09</div>
            <div class="timeline-body"><p>@dimbleby duplicated issues, you mean? not following, about pre-releases of what?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/facundobatista">@facundobatista</a> on 2024-12-03 12:03</div>
            <div class="timeline-body"><p>I've been able to go deep on this. It results it's not a &quot;bug&quot; in <code>uv</code>, but more than &quot;a behaviour difference&quot; with <code>pip</code>.</p>
<p>While <code>pip</code> prefers stable versions (and not pre-releases) but still selects a pre-release if no other option available (<em>1), <code>uv</code> just refuses to use it unless a flag is specified (</em>2).</p>
<p>So, I'll go forward and close this (just re-open if you think this is something that actually should be fixed).</p>
<p>(*1) From the pip gitst linked above:</p>
<pre><code>Collecting azure-cli
  Using cached azure_cli-2.67.0-py3-none-any.whl.metadata (8.4 kB)
...
Collecting azure-keyvault-administration==4.4.0b2 (from azure-cli)
  Using cached azure_keyvault_administration-4.4.0b2-py3-none-any.whl.metadata (30 kB)
...
Successfully installed ... azure-keyvault-administration-4.4.0b2 ...
...
(testaz) 14:37:24|facundo@trifon:~/temp$ az --version
azure-cli                         2.67.0
</code></pre>
<p>(*2) It happened <code>uv</code> was installing a broken old version (<code>2.0.67</code> which is easily visually confused with <code>2.67.0</code>)... if forced to last version, the detail of why it was not chosing the last version was more evident:</p>
<pre><code>31:44|facundo@trifon:~$ uv --verbose tool run --from &quot;azure-cli==2.67&quot; az --version
DEBUG uv 0.5.5
...
  × No solution found when resolving tool dependencies:
  ╰─▶ Because there is no version of azure-keyvault-administration==4.4.0b2 and azure-cli==2.67.0 depends on azure-keyvault-administration==4.4.0b2, we can conclude that azure-cli==2.67.0 cannot be used.
      And because you require azure-cli==2.67, we can conclude that your requirements are unsatisfiable.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @facundobatista on 2024-12-03 12:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-03 14:45</div>
            <div class="timeline-body"><p>Details on our pre-release behavior in https://docs.astral.sh/uv/pip/compatibility/#pre-release-compatibility</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14415.html">astral-sh/uv#14415</a> on 2025-07-02 10:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
