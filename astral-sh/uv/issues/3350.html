<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cross platform lock file generation - astral-sh/uv #3350</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>cross platform lock file generation</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3350">#3350</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2024-05-03 14:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-05-03 14:57</div>
            <div class="timeline-body"><h3>Work items</h3>
<ul>
<li>[x] #3353</li>
<li>[x] #3352</li>
<li>[x] #3354</li>
<li>[x] #3355</li>
<li>[x] #3351</li>
<li>[x] #3358</li>
<li>[x] #3359</li>
<li>[x] #3360</li>
<li>[x] #3926</li>
</ul>
<p>This is a tracking ticket for exposing a way to generate a cross platform lock file using the <code>uv</code> CLI. This ticket is primarily about making this available as a library feature, with exposure on the CLI being a step for making it easy to interact with. For example, this should be done via <code>uv pip compile --unstable-uv-lock-file</code>.</p>
<p>A bit ago, I did a prototype of this by roughly doing the following:</p>
<ol>
<li>Ignore markers on dependencies.</li>
<li>Make the resolver &quot;fork&quot; internally whenever multiple packages enter the dependency tree as a result of ignoring markers.</li>
<li>Unify all forks of the resolver at the end into one set of locked versions for packages. The result is a &quot;universal&quot; or &quot;cross platform.&quot; Its principally differs from a <code>requirements.txt</code> in that it can have multiple versions of the same package in it, and it includes all of the artifacts (wheels and source dist) for each distribution. Installing from a lock file thus requires some filtering.</li>
</ol>
<p>While this prototype demonstrated the idea, it took a number of shortcuts that made it work only in a limited number of cases.</p>
<p>NOTE: This is distinct from #3347 in that this goal of this ticket is make lock file generation work. In #3347, the goal is to integrate lock file generate with the rest of the <code>uv</code> workspace commands.</p>
<p>A good litmus test for this issue being completed is that we can run the following:</p>
<pre><code>$ cat requirements.in
# Compile with Python 3.10 as minimal version.
anyio&lt;4 ; python_version &lt; &quot;3.11&quot;
anyio&gt;=4.3.0 ; python_version &gt;= &quot;3.11&quot;
idna&lt;3 ; python_version &lt; &quot;3.10&quot;
idna&gt;=3.6.0 ; python_version &gt;= &quot;3.12&quot;
$ uv pip compile -p3.10 --unstable-uv-lock-file requirements.in
</code></pre>
<p>And get a <code>uv.lock</code> file as output. This example is interesting because it requires the resolver to &quot;fork.&quot; Namely, with 3.10 as the minimal version of Python, both <code>anyio&lt;4</code> and <code>anyio&gt;=4.3.0</code> are constraints that need to be resolved simultaneously. Since they must necessarily lead to different versions of <code>anyio</code>, the resulting lock file will contain multiple versions of <code>anyio</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @BurntSushi on 2024-05-03 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">tracking</span> added by @BurntSushi on 2024-05-03 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @BurntSushi on 2024-05-03 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3347.html">astral-sh/uv#3347</a> on 2024-05-03 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3353.html">astral-sh/uv#3353</a> on 2024-05-03 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3354.html">astral-sh/uv#3354</a> on 2024-05-03 15:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3355.html">astral-sh/uv#3355</a> on 2024-05-03 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3358.html">astral-sh/uv#3358</a> on 2024-05-03 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3359.html">astral-sh/uv#3359</a> on 2024-05-03 18:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3360.html">astral-sh/uv#3360</a> on 2024-05-03 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3333.html">astral-sh/uv#3333</a> on 2024-05-06 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../commaai/openpilot/issues/32522.html">commaai/openpilot#32522</a> on 2024-05-28 04:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../oxidase/ofiuco/issues/69.html">oxidase/ofiuco#69</a> on 2024-06-06 18:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-10 12:47</div>
            <div class="timeline-body"><p>I think we have a good base for the universal resolver, and all of the items initially planned for this are done.</p>
<p>However, for folks tracking this ticket, it's still not yet in a shippable state. That goal is tracked in https://github.com/astral-sh/uv/issues/3347.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-06-10 12:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
