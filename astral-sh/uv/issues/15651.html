<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv python list` can fail with Access is denied. (os error 5) - astral-sh/uv #15651</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv python list` can fail with Access is denied. (os error 5)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15651">#15651</a>
        opened by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a>
        on 2025-09-03 06:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-09-03 06:04</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When running <code>uv python list</code>, it fails with <code>Access is denied. (os error 5)</code></p>
<pre><code class="language-powershell">PS C:\Users\GiGaGon&gt; uv python list
error: Failed to inspect Python interpreter from registry at `C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe`
  Caused by: Failed to query Python interpreter at `C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe`
  Caused by: Access is denied. (os error 5)
</code></pre>
<details>
<summary>
Verbose output
</summary>

<pre><code>PS C:\Users\GiGaGon&gt; uv python list -vvv
DEBUG uv 0.8.14 (af856fb88 2025-08-28)
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `aarch64`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
TRACE Architecture `x86_64` is not compatible with `x86`
DEBUG Searching for any Python interpreter in managed installations, search path, or registry
DEBUG Searching for managed installations at `AppData\Roaming\uv\python`
TRACE Searching PATH for executables: python.exe, python3.exe, cpython.exe, cpython3.exe, pypy.exe, pypy3.exe, graalpy.exe, graalpy3.exe, pyodide.exe, pyodide3.exe
TRACE Checking `PATH` directory for interpreters: C:\Users\GiGaGon\.local\bin
TRACE Checking `PATH` directory for interpreters: C:\Program Files\PowerShell\7
TRACE Checking `PATH` directory for interpreters: C:\Program Files (x86)\Common Files\Oracle\Java\java8path
TRACE Checking `PATH` directory for interpreters: D:\Oculus\Support\oculus-runtime
TRACE Checking `PATH` directory for interpreters: C:\Program Files\Eclipse Adoptium\jre-21.0.6.7-hotspot\bin
TRACE Checking `PATH` directory for interpreters: C:\Program Files\Eclipse Adoptium\jdk-17.0.6.10-hotspot\bin
TRACE Checking `PATH` directory for interpreters: C:\Windows\system32
TRACE Checking `PATH` directory for interpreters: C:\Windows
TRACE Checking `PATH` directory for interpreters: C:\Windows\System32\Wbem
TRACE Checking `PATH` directory for interpreters: C:\Windows\System32\WindowsPowerShell\v1.0\
TRACE Checking `PATH` directory for interpreters: C:\Windows\System32\OpenSSH\
TRACE Checking `PATH` directory for interpreters: C:\Program Files (x86)\NVIDIA Corporation\PhysX\Common
TRACE Checking `PATH` directory for interpreters: C:\Program Files\NVIDIA Corporation\NVIDIA NvDLISR
TRACE Checking `PATH` directory for interpreters: C:\Windows\system32
TRACE Skipping already seen directory: C:\Windows\system32
TRACE Checking `PATH` directory for interpreters: C:\Windows
TRACE Skipping already seen directory: C:\Windows
TRACE Checking `PATH` directory for interpreters: C:\Windows\System32\Wbem
TRACE Skipping already seen directory: C:\Windows\System32\Wbem
TRACE Checking `PATH` directory for interpreters: C:\Windows\System32\WindowsPowerShell\v1.0\
TRACE Skipping already seen directory: C:\Windows\System32\WindowsPowerShell\v1.0\
TRACE Checking `PATH` directory for interpreters: C:\Windows\System32\OpenSSH\
TRACE Skipping already seen directory: C:\Windows\System32\OpenSSH\
TRACE Checking `PATH` directory for interpreters: C:\HaxeToolkit\haxe
TRACE Checking `PATH` directory for interpreters: C:\HaxeToolkit\neko
TRACE Checking `PATH` directory for interpreters: C:\Program Files\Microsoft SQL Server\150\Tools\Binn\
TRACE Checking `PATH` directory for interpreters: C:\Program Files\dotnet\
TRACE Checking `PATH` directory for interpreters: C:\Program Files\Git\cmd
TRACE Checking `PATH` directory for interpreters: C:\ProgramData\chocolatey\bin
TRACE Checking `PATH` directory for interpreters: C:\Program Files (x86)\IVI Foundation\VISA\WinNT\Bin
TRACE Checking `PATH` directory for interpreters: C:\Program Files\PowerShell\7\
TRACE Skipping already seen directory: C:\Program Files\PowerShell\7\
TRACE Checking `PATH` directory for interpreters: C:\Program Files (x86)\Lua\5.1
TRACE Checking `PATH` directory for interpreters: C:\Program Files (x86)\Lua\5.1\clibs
TRACE Checking `PATH` directory for interpreters: C:\Program Files\Graphviz\bin
TRACE Checking `PATH` directory for interpreters: C:\Users\GiGaGon\AppData\Local\Microsoft\WindowsApps
TRACE Querying interpreter executable at C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe
DEBUG Failed to inspect Python interpreter from registry at `C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe`
TRACE Error trace: Failed to inspect Python interpreter from registry at `C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe`

Caused by:
    0: Failed to query Python interpreter at `C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe`
    1: Access is denied. (os error 5)
error: Failed to inspect Python interpreter from registry at `C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe`
  Caused by: Failed to query Python interpreter at `C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe`
  Caused by: Access is denied. (os error 5)
</code></pre>
</details>

<p>This started after I managed to break a different windows installation in an entirely new way, see #14637 for the previous breakage. This time, I tried to change my primary user's name so I could stop having to constantly censor it since it was my real name. It went horribly, and I managed to make the computer almost unusable, but eventually managed to mostly recover and make a new user account. The pythons were installed by the old user account, so something has happened where despite being being an administrator the new user account cannot access some files from the old one, even if the terminal is being run as admin.</p>
<p>Like how #14637 was fixed in #14636, I think it would be reasonable if these broken interpreters are skipped, since they are broken for reasons outside of the actual interpreter having a problem, it instead being a bigger computer issue.</p>
<h3>Platform</h3>
<p>Windows 10 Home 22H2</p>
<h3>Version</h3>
<p>uv 0.8.14 (af856fb88 2025-08-28)</p>
<h3>Python version</h3>
<p>N/A</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MeGaGiGaGon on 2025-09-03 06:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @konstin on 2025-09-03 13:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-03 13:24</div>
            <div class="timeline-body"><p>Does <code>C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe</code> exist, and can you run it manually? If you have the Python launcher for Windows installed, what does <code>py -0</code> show?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-09-04 02:42</div>
            <div class="timeline-body"><p>Here's the output of <code>py -0</code>:</p>
<pre><code class="language-powershell">PS C:\Users\GiGaGon&gt; py -0
 -V:3.11 *        Python 3.11
</code></pre>
<p>If I try to go there in file explorer/non-admin cmd, I get this error:</p>
<pre><code class="language-powershell">PS C:\Program Files&gt;cd WindowsApps
Access is denied.
</code></pre>
<p>If I go there in an admin window, I can get to the file, but not run it.</p>
<pre><code class="language-powershell">PS C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0&gt; .\python3.11.exe
ResourceUnavailable: Program 'python3.11.exe' failed to run: An error occurred trying to start process 'C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe' with working directory 'C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0'. Access is denied.At line:1 char:1
+ .\python3.11.exe
+ ~~~~~~~~~~~~~~~~.
</code></pre>
<p>I also tried running it from outside the broken directory, but it still doesn't work.</p>
<pre><code class="language-powershell">PS C:\Program Files&gt; .\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe
ResourceUnavailable: Program 'python3.11.exe' failed to run: An error occurred trying to start process 'C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe' with working directory 'C:\Program Files'. Access is denied.At line:1 char:1
+ .\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__q â€¦
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-04 09:01</div>
            <div class="timeline-body"><p>It seems the restricted access to <code>C:\Program Files\WindowsApps</code> is by design. Can run <code>py -V:3.11</code>, and if that works <code>print(sys.executable)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-09-04 14:36</div>
            <div class="timeline-body"><pre><code class="language-powershell">PS C:\Program Files&gt; py -V:3.11
Unable to create process using '&quot;C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\python3.11.exe&quot;': Access is denied.
</code></pre>
<p>Happens in both a normal and admin level powershell instance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-04 16:25</div>
            <div class="timeline-body"><p>We may want to make this non-fatal in <code>uv python list</code>, and show the other interpreters despite the error, but the interpreter seems broken in some fashion, apparently related to the Windows Store.</p>
<p>CC @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15685.html">astral-sh/uv#15685</a> on 2025-09-04 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-09-05 14:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
