<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv build shouldn't overwrite by default - astral-sh/uv #11979</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv build shouldn&#x27;t overwrite by default</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11979">#11979</a>
        opened by <a href="https://github.com/pycaw">@pycaw</a>
        on 2025-03-05 15:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pycaw">@pycaw</a></div>
            <div class="timeline-body"><p>In my opinion uv build shouldn&#x27;t overwrite by default. Let&#x27;s say I have distributed by build output. Then I forget to bump the package version and I overwrite the last build output of mine. I assume just as repositories do not overwrite packages by default (what is more, aren&#x27;t really even configured to overwrite any time), files under /dist shouldn&#x27;t be either by <code>uv build</code>. Maybe if an additional flag is present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-05 18:50</div>
            <div class="timeline-body"><p>I don&#x27;t think I agree. Why do you need the previous build in this context? I think this is a case where most people would want it to build and overwrite and we&#x27;d need a strong motivation to add friction to the experience by requiring opt-in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-05 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-05 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pycaw">@pycaw</a> on 2025-03-05 20:06</div>
            <div class="timeline-body"><p>I can&#x27;t imagine silently overwriting existing packaged distributions is a clearly better default  than, on the other hand, to stop for a prompt or just straight up refuse to do so. Sometimes it could be mistakes that lead to this behavior and therefore aborting this would be warranted so the user can react before worsening their situation; or, potential data loss (not impossible). Passing a -f/--force/--force-output flag could convey clear intent. At the least a message should be issued in case of overwriting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-05 20:20</div>
            <div class="timeline-body"><p>I don&#x27;t think you answered my question there.</p>
<p>cc @konstin if you have an opinion</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pycaw">@pycaw</a> on 2025-03-05 21:48</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t think you answered my question there.</p>
<p>cc <a href="https://github.com/konstin">@konstin</a> if you have an opinion</p>
</blockquote>
<p>Even if I never need the previous build, I&#x27;d always want to know if the new build I produced maybe overwrites one I had already built (and distributed).</p>
<p>Then, I might need the previous build because... I want to do something with an older build, this can be a sizeable list of things.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-15 01:01</div>
            <div class="timeline-body"><p>I think this is the right behavior, personally. It matches the other tools I can think of: <code>python -m build</code>, <code>cargo build</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-15 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pycaw">@pycaw</a> on 2025-03-17 11:13</div>
            <div class="timeline-body"><p>[EDIT: code improved]</p>
<p>I understand there are different preferences, and that this became some kind of default and one must adjust. In any case, if someone wants this behavior, this is how I achieved it (using hatchling backend):</p>
<pre><code>import re
from pathlib import Path

from hatchling.builders.hooks.plugin.interface import BuildHookInterface


class SpecialBuildHook(BuildHookInterface):
    def initialize(self, version, build_data):
        pat = rf&quot;.*{re.escape(self.metadata.version)}(\.-py3-.*|\.tar\.gz)&quot;
        if not (
            files := [
                m.group() for m in [re.match(pat, p.name) for p in (Path(self.directory).glob(&quot;*&quot;))] if m
            ]
        ):
            return
        for f in files:
            self.app.display_error(f&quot;Found file &#x27;{f}&#x27; with same version&quot;)
        self.app.display_warning(
            &quot;Removing existing files in the build output directory or &quot;
            &quot;set HATCH_BUILD_NO_HOOKS=1 to disable hooks.&quot;
        )
        self.app.abort()
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-17 12:33</div>
            <div class="timeline-body"><p>Thank you for following up, that&#x27;s great.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:37 UTC
    </footer>
</body>
</html>
