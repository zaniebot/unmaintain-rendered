```yaml
number: 2941
title: "potential breaking change / bug in `uv==0.1.30`"
type: issue
state: closed
author: zzstoatzz
labels: []
assignees: []
created_at: 2024-04-09T18:28:32Z
updated_at: 2024-04-09T21:01:57Z
url: https://github.com/astral-sh/uv/issues/2941
synced_at: 2026-01-10T01:57:06Z
```

# potential breaking change / bug in `uv==0.1.30`

---

_Issue opened by @zzstoatzz on 2024-04-09 18:28_

the following GHA step
```
- name: Install packages
  run: |
    python -m pip install -U uv
    uv pip install --upgrade --system -e .[dev]
```

started failing after the release of `0.1.30` with
```console
Run python -m pip install -U uv
Collecting uv
  Downloading uv-0.1.30-py3-none-manylinux_2_17_x86_64.manylinux20[14](https://github.com/PrefectHQ/prefect/actions/runs/8620086419/job/23626392040?pr=12629#step:6:15)_x86_64.whl.metadata (26 kB)
Downloading uv-0.1.30-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (11.5 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 11.5/11.5 MB 125.0 MB/s eta 0:00:00
Installing collected packages: uv
Successfully installed uv-0.1.30

Notice:  A new release of pip is available: 23.0.1 -> 24.0
Notice:  To update, run: pip install --upgrade pip
Built 1 editable in 1.[17](https://github.com/PrefectHQ/prefect/actions/runs/8620086419/job/23626392040?pr=12629#step:6:18)s
error: Attempted to wait on an unregistered task
Error: Process completed with exit code 2.
```

full CI [run](https://github.com/PrefectHQ/prefect/actions/runs/8620086419/job/23626392040?pr=12629) (not much else as far as logs unfortunately)

pinning to `0.1.29` appeared to resolve the issue

---

#### more potentially useful context

we use the following step before the install step, pending `setup-python` support
```
      - name: UV Cache
        # Manually cache the uv cache directory
        # until setup-python supports it:
        # https://github.com/actions/setup-python/issues/822
        uses: actions/cache@v4
        id: cache-uv
        with:
          path: ~/.cache/uv
          key: uvcache-${{ runner.os }}-${{ steps.setup_python.outputs.python-version }}-${{ hashFiles('requirements-client.txt', 'requirements.txt', 'requirements-dev.txt') }}
```


---
I don't have a strong hypothesis for why this error is occurring, sorry. let me know if there's anything useful I can provide

---

_Comment by @zanieb on 2024-04-09 18:30_

Thanks for the report Nate!

cc @charliermarsh 

---

_Comment by @zanieb on 2024-04-09 18:32_

Note this doesn't reproduce locally (macOS) with `prefect@7f2c69b007c1374ee3cbbd37a6a068fbc7ebd2e5` and `uv pip install --upgrade -e '.[dev]'`

---

_Comment by @zanieb on 2024-04-09 18:37_

It does reproduce in CI though, here are the verbose logs https://github.com/zanieb/prefect/actions/runs/8620667551/job/23627935783

I tested a couple changes and it fails without `--editable` and without `--system`.

---

_Comment by @zanieb on 2024-04-09 18:47_

Presumably we fail at https://github.com/astral-sh/uv/blob/1512e07a2e7c05b7c9fcb457f35c7ef0f25d8d9b/crates/uv-resolver/src/resolver/mod.rs#L615

---

_Comment by @hsheth2 on 2024-04-09 18:48_

We're seeing this in CI for the datahub project as well. It doesn't happen reliably though - seems like it impacts ~50% of our CI workflows, despite the matrixes being pretty similar.

https://github.com/datahub-project/datahub/actions/runs/8620627386/job/23627824491?pr=10256

---

_Referenced in [astral-sh/uv#2942](../../astral-sh/uv/pulls/2942.md) on 2024-04-09 18:53_

---

_Referenced in [astral-sh/uv#2943](../../astral-sh/uv/pulls/2943.md) on 2024-04-09 18:57_

---

_Comment by @zanieb on 2024-04-09 19:03_

We've identified this is most likely caused by #2452 and resolved by #2943 though we're still confirming with a reproduction. This wasn't caught by our unit test suite (and you'll only see it in some cases) because the cause is a performance optimization which is only applied when backtracking occurs several times.

---

_Closed by @zanieb on 2024-04-09 19:09_

---

_Reopened by @zanieb on 2024-04-09 19:10_

---

_Comment by @zanieb on 2024-04-09 19:10_

I'll leave this open until we release:

- https://github.com/astral-sh/uv/pull/2944

---

_Comment by @0x2b3bfa0 on 2024-04-09 19:18_

Almost off-topic remark: on our project (both locally and on GitHub Actions), it fails consistently with Python 3.9 and succeeds consistently with Python 3.12; probably because the dependency resolution is different.

---

_Comment by @charliermarsh on 2024-04-09 20:05_

v0.1.31 is out now, which hopefully resolves this.

---

_Referenced in [PrefectHQ/prefect#12633](../../PrefectHQ/prefect/pulls/12633.md) on 2024-04-09 20:12_

---

_Comment by @zzstoatzz on 2024-04-09 20:15_

it does indeed appear to be resolved for us on v0.1.31 ✨ 

thanks for the quick fix!

---

_Closed by @zzstoatzz on 2024-04-09 20:24_

---

_Comment by @charliermarsh on 2024-04-09 20:33_

Awesome, thanks for reporting, glad we could resolve!

---

_Referenced in [huggingface/datasets#6794](../../huggingface/datasets/pulls/6794.md) on 2024-04-12 15:14_

---

_Referenced in [aiidateam/aiida-core#6363](../../aiidateam/aiida-core/pulls/6363.md) on 2024-04-22 07:21_

---

_Referenced in [astral-sh/uv#3184](../../astral-sh/uv/issues/3184.md) on 2024-04-22 13:07_

---
