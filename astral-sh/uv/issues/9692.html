<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--project` and `lock` produces incorrect relative path in lock file - astral-sh/uv #9692</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`--project` and `lock` produces incorrect relative path in lock file</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9692">#9692</a>
        opened by <a href="https://github.com/JamesMTSloan">@JamesMTSloan</a>
        on 2024-12-06 18:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/JamesMTSloan">@JamesMTSloan</a> on 2024-12-06 18:09</div>
            <div class="timeline-body"><h2>Minimal reproduction</h2>
<p>Running in <code>/home/user/projects/uv_test</code> with <code>uv</code> 0.5.6.</p>
<pre><code class="language-bash">mkdir other
mkdir project
cd project
uv init
cd ../other
uv --project ../project/ lock
uv --project ../project/ run python3 hello.py
</code></pre>
<p>Gives the following output:</p>
<pre><code class="language-bash">Initialized project `project`
Using CPython 3.10.12 interpreter at: /usr/bin/python3.10
Resolved 1 package in 2ms

Using CPython 3.10.12 interpreter at: /usr/bin/python3.10
Creating virtual environment at: ../project/.venv
error: Failed to generate package metadata for `project==0.1.0 @ virtual+../../../project`
  Caused by: Distribution not found at: file:///home/user/project
</code></pre>
<p>Contents of project/uv.lock:</p>
<pre><code>version = 1
requires-python = &quot;&gt;=3.10&quot;

[[package]]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;../../../project&quot; }
</code></pre>
<hr />
<p>The relative path that ends up in the lock file is incorrect. Using <code>--directory</code> instead of <code>--project</code> produces the expected <code>&quot;.&quot;</code> path.
Nor is the path produced, <code>&quot;../../../project&quot;</code>, the one given as <code>--project</code> - it ends up pointing to a somewhat arbitrary directory and so with some bad luck could produce some very unexpected results if it happens to hit a different valid project. In my case the concrete project is at <code>/home/user/projects/uv_test/project</code> with <code>uv</code> looking in <code>/home/user/project</code>.</p>
<p>To be clear, in my usecase switching to <code>--directory</code> worked. Maybe this is expected behaviour but I am reporting it as it surprised me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-06 18:23</div>
            <div class="timeline-body"><p>Might be a bug? I'll take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-12-06 21:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-07 18:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9709.html">astral-sh/uv#9709</a> on 2024-12-07 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-07 20:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-07 20:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:24 UTC
    </footer>
</body>
</html>
