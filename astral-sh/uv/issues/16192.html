<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show a better error when a uv lockfile is used in `-r` - astral-sh/uv #16192</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Show a better error when a uv lockfile is used in <code>-r</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16192">#16192</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-10-08 15:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-08 15:28</div>
            <div class="timeline-body"><p>e.g., if you try to use <code>uv lock --script action.py</code> then <code>-r action.py.lock</code></p>
<pre><code>error: Couldn't parse requirement in `action.py.lock` at position 0
  Caused by: no such comparison operator &quot;=&quot;, must be one of ~= == != &lt;= &gt;= &lt; &gt; ===
version = 1
        ^^^
</code></pre>
<p>We can do better by detecting our own lockfile format</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2025-10-08 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2025-10-08 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CakeVision">@CakeVision</a> on 2025-10-08 17:42</div>
            <div class="timeline-body"><p>I could take a look at this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cmnemoi">@cmnemoi</a> on 2025-10-15 14:41</div>
            <div class="timeline-body"><p>Hello,</p>
<p>How do you think this issue should be tackled ?</p>
<p>I see in https://github.com/Arkenstone999/uv/blob/main/crates/uv-requirements/src/sources.rs that the requirements source format is determined solely based on filename.</p>
<p>However, <code>uv</code> is not the only tool which uses lockfiles with <code>.lock</code> extension so we can't just check that.</p>
<p>And this MR has been rejected (https://github.com/astral-sh/uv/pull/16282/files) partially (?) by trying to infer the lock format by analyzing its content.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CakeVision">@CakeVision</a> on 2025-10-16 07:45</div>
            <div class="timeline-body"><blockquote>
<p>Hello,</p>
<p>How do you think this issue should be tackled ?</p>
<p>I see in https://github.com/Arkenstone999/uv/blob/main/crates/uv-requirements/src/sources.rs that the requirements source format is determined solely based on filename.</p>
<p>However, <code>uv</code> is not the only tool which uses lockfiles with <code>.lock</code> extension so we can't just check that.</p>
<p>And this MR has been rejected (https://github.com/astral-sh/uv/pull/16282/files) partially (?) by trying to infer the lock format by analyzing its content.</p>
</blockquote>
<p>I had a look during the weekend and it's why it took a bit for me to make a pr here. Took the same approach as the pr mentioned in your reply, but realized it will be error prone to detect that way about one day into development. Would appreciate some help designing this. My best idea so far is to use custom names for the locks based on their type when they are generated, but i'm not familiar enough with uv's design to make an educated choice</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:09 UTC
    </footer>
</body>
</html>
