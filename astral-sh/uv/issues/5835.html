<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cannot resolve package in arm Mac Docker container when specifying platform - astral-sh/uv #5835</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>cannot resolve package in arm Mac Docker container when specifying platform</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5835">#5835</a>
        opened by <a href="https://github.com/jbcpollak">@jbcpollak</a>
        on 2024-08-06 21:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jbcpollak">@jbcpollak</a> on 2024-08-06 21:43</div>
            <div class="timeline-body"><p>The below example is with a <code>uv pip install</code> but my actual usecase is trying to compile a cross-platform requirements.txt  file using <code>uv pip compile</code> and a custom python script (from https://github.com/astral-sh/uv/issues/2679#issuecomment-2068208602) which runs the same compile three times, once for each platform, then normalizes them into a single file.</p>
<p>Anyway, here is what I am experiencing:</p>
<p>M3 Macbook Pro
Python 3.11
UV 0.2.33</p>
<p>I am running a Linux devcontainer in Docker Desktop. At the command line I get this output when I ask Linux about its platform:</p>
<pre><code>vscode ➜ /workspaces/firefly/vision (feat/tach-detection) $ uname -a
Linux de575a211720 6.10.0-linuxkit #1 SMP Wed Jul 17 10:51:09 UTC 2024 aarch64 GNU/Linux
vscode ➜ /workspaces/firefly/vision (feat/tach-detection) $ uname -m
aarch64
vscode ➜ /workspaces/firefly/vision (feat/tach-detection) $ uname -p
unknown
</code></pre>
<p>If I specify the <code>--python-platform</code> I get this:</p>
<pre><code>vscode ➜ /workspaces/firefly/vision (feat/tach-detection) $ uv pip install open3d==0.18.0 --python-platform linux
  × No solution found when resolving dependencies:
  ╰─▶ Because open3d==0.18.0 has no wheels with a matching Python ABI tag and you require open3d==0.18.0, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>But if I don't specify the platform the install works ok:</p>
<pre><code>vscode ➜ /workspaces/firefly/vision (feat/tach-detection) $ uv pip install open3d==0.18.0
Resolved 39 packages in 11ms
░░░░░░░░░░░░░░░░░░░░ [0/39] Installing wheels...                                                                                                                                                                                                                     warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance. If this is intentional, use `--link-mode=copy` to suppress this warning.

hint: If the cache and target directories are on different filesystems, hardlinking may not be supported.
Installed 39 packages in 4.21s
 + attrs==24.2.0
 + blinker==1.8.2
 + certifi==2024.7.4
 + charset-normalizer==3.3.2
 + click==8.1.7
 + configargparse==1.7
 + dash==2.17.1
 + dash-core-components==2.0.0
 + dash-html-components==2.0.0
 + dash-table==5.0.0
 + fastjsonschema==2.20.0
 + flask==3.0.3
 + idna==3.7
 + importlib-metadata==8.2.0
 + itsdangerous==2.2.0
 + jinja2==3.1.4
 + jsonschema==4.23.0
 + jsonschema-specifications==2023.12.1
 + jupyter-core==5.7.2
 + markupsafe==2.1.5
 + nbformat==5.10.4
 + nest-asyncio==1.6.0
 + numpy==2.0.1
 + open3d==0.18.0
 + packaging==24.1
 + platformdirs==4.2.2
 + plotly==5.23.0
 + referencing==0.35.1
 + requests==2.32.3
 + retrying==1.3.4
 + rpds-py==0.20.0
 + setuptools==72.1.0
 + six==1.16.0
 + tenacity==9.0.0
 + traitlets==5.14.3
 + typing-extensions==4.12.2
 + urllib3==2.2.2
 + werkzeug==3.0.3
 + zipp==3.19.2
</code></pre>
<p>Maybe I'm missing something, but I would expect the behavior to be the same regardless of the command-line switch since I'm running in a Linux container on Docker.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-06 21:46</div>
            <div class="timeline-body"><p>Can you try <code>--python-platform x86_64-manylinux_2_28</code> instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-06 21:47</div>
            <div class="timeline-body"><p>If you check https://pypi.org/project/open3d/#files, the oldest manylinux version they support is <code>manylinux_2_27</code>. By default we try to solve for <code>manylinux_2_17</code>, so you just need to bump your &quot;minimum-supported manylinux version&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-06 23:06</div>
            <div class="timeline-body"><p>I've confirmed that this resolves: <code>uv pip install open3d==0.18.0 --python-platform x86_64-manylinux_2_28 --python-version 3.11</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-06 23:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-06 23:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-08-06 23:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jbcpollak">@jbcpollak</a> on 2024-08-07 00:39</div>
            <div class="timeline-body"><p>Thanks for this diagnosis.</p>
<p>For my understanding, what is the difference between specifying the platform as just &quot;linux&quot; vs one of the manylinux options?</p>
<p>And why does this work correctly when I don't specify a platform at all? That's the most unexpected thing to me since without specifying a platform it's already on &quot;linux&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-07 00:47</div>
            <div class="timeline-body"><p>Totally, happy to explain. For background (and apologies if you're already familiar), manylinux tries to capture the version of glibc installed on a given Linux machine, so <code>x86_64-manylinux_2_28</code> is saying that you need at least glibc 2.28.</p>
<p>If you run with just <code>linux</code>, that's an alias for <code>x86_64-manylinux_2_17</code>. <code>linux</code> alone is under-specified, so we have to pick some default, and we decided to use <code>x86_64-manylinux_2_17</code> as the default. So, if you pass <code>linux</code>, you're requiring that all the things you depend on support glibc 2.17 and later.</p>
<p>(If you run with <code>x86_64-manylinux_2_28</code>, you're raising that requirement, i.e., being more relaxed about the versions of glibc that you care about supporting.)</p>
<p>If you omit <code>--python-platform</code> at all, then we detect your <em>current</em> Python platform and use that. My guess is that your machine has a version of glibc that's newer than 2.17, so it's inferring that it's fine for your dependencies to all require newer glibc versions too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jbcpollak">@jbcpollak</a> on 2024-08-07 02:54</div>
            <div class="timeline-body"><p>got it, that's very helpful, thanks.</p>
<p>Is there a way to infer what the current Python platform will be when <code>--python-platform</code> is omitted?</p>
<p>This may end up being moot since <code>--universal</code> may solve my use-case with less complexity, but it sounds like I want to replace <code>linux</code> with <code>x86_64-manylinux_2_28</code> (or <code>aarch64...</code> in my case).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-07 03:03</div>
            <div class="timeline-body"><p>If you run <code>ldd --version</code>:</p>
<pre><code>root@2010ac4b3c01:/# ldd --version
ldd (Ubuntu GLIBC 2.39-0ubuntu8.2) 2.39
</code></pre>
<p>That'll tell you the glibc version. And then you would round down -- we only support a few cutoffs:</p>
<ul>
<li><code>x86_64-manylinux_2_17</code></li>
<li><code>x86_64-manylinux_2_28</code></li>
<li><code>x86_64-manylinux_2_31</code></li>
</ul>
<p>I'd recommend just using <code>x86_64-manylinux_2_28</code> though. It's a common cutoff. Anything that works on <code>x86_64-manylinux_2_28</code> should also work on a machine with glibc 2.2.8 or later.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:32 UTC
    </footer>
</body>
</html>
