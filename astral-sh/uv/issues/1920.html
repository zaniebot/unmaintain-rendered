<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to download distributions with large requirements file - astral-sh/uv #1920</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to download distributions with large requirements file</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1920">#1920</a>
        opened by <a href="https://github.com/strickvl">@strickvl</a>
        on 2024-02-23 16:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/strickvl">@strickvl</a> on 2024-02-23 16:55</div>
            <div class="timeline-body"><p>Have a Dockerfile in which I'm testing the use of uv, but uv fails to build the dependencies:</p>
<pre><code># Use Python 3.9 as the base image
FROM python:3.9-slim

# Set environment variables to make Python outputs work correctly in Docker
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PIP_NO_CACHE_DIR=off \
    PIP_DISABLE_PIP_VERSION_CHECK=on \
    PIP_DEFAULT_TIMEOUT=100

# Install Git, as it's often necessary for installing dependencies
RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends git &amp;&amp; rm -rf /var/lib/apt/lists/*

# Create a virtual environment to isolate our package dependencies locally
RUN python3 -m venv /venv
ENV PATH=&quot;/venv/bin:$PATH&quot;

RUN pip install -U pip &amp;&amp; pip install git+https://github.com/zenml-io/zenml.git@bugfix/whylogs-extras#20138b5a8c8e01ba74e3d8f3ba6f6a8ce4efb36b#egg=zenml[server,templates,terraform,secrets-aws,secrets-gcp,secrets-azure,secrets-hashicorp,s3fs,gcsfs,adlfs,dev,mlstacks]

RUN zenml integration export-requirements \
    --output-file integration-requirements.txt \
    whylogs scipy pytorch azure airflow aws deepchecks

RUN pip install uv
RUN uv venv

ENV PATH=&quot;/venv/bin:$PATH&quot;

RUN uv pip install -r integration-requirements.txt

# Set the default command for the container to keep it running.
CMD [&quot;tail&quot;, &quot;-f&quot;, &quot;/dev/null&quot;]
</code></pre>
<p>The error I see is:</p>
<pre><code> =&gt; ERROR [8/8] RUN uv pip install -r integration-requirements.txt                                                            314.9s
------
 &gt; [8/8] RUN uv pip install -r integration-requirements.txt:
13.74 Resolved 274 packages in 13.14s
314.2 error: Failed to download distributions
314.2   Caused by: Failed to fetch wheel: torch==2.2.1
314.2   Caused by: Failed to extract source distribution
314.2   Caused by: request or response body error: operation timed out
314.2   Caused by: operation timed out
------
Dockerfile_test:59
--------------------
  57 |     ENV PATH=&quot;/venv/bin:$PATH&quot;
  58 |
  59 | &gt;&gt;&gt; RUN uv pip install -r integration-requirements.txt
  60 |
  61 |     # Set the default command for the container to keep it running.
--------------------
ERROR: failed to solve: process &quot;/bin/sh -c uv pip install -r integration-requirements.txt&quot; did not complete successfully: exit code: 2
</code></pre>
<p>It doesn't time out on the same download each time. I'm assuming sorting the <code>integration-requirements.txt</code> file makes no difference, but there's something nondeterministic about this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-23 17:05</div>
            <div class="timeline-body"><p>Can you try increasing your request timeout? e.g. <code>HTTP_TIMEOUT=600</code> or <code>UV_HTTP_TIMEOUT=600</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-02-23 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-02-23 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-23 17:06</div>
            <div class="timeline-body"><p>Duplicate of:</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/1912</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1921.html">astral-sh/uv#1921</a> on 2024-02-23 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-23 17:29</div>
            <div class="timeline-body"><p>Exploring some other ideas in</p>
<ul>
<li>#1921</li>
<li>#1922</li>
</ul>
<p>We'll track this in those long-term.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-02-23 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/strickvl">@strickvl</a> on 2024-02-23 17:31</div>
            <div class="timeline-body"><p>Setting <code>HTTP_TIMEOUT=600</code> and <code>UV_HTTP_TIMEOUT=600</code> made it work / pass, btw.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/strickvl">@strickvl</a> on 2024-02-24 11:56</div>
            <div class="timeline-body"><p>Actually it failed a few times later, so it's not completely solid :) I guess the time was longer than the values I put in. No worry; happy to wait for the better solution.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:57 UTC
    </footer>
</body>
</html>
