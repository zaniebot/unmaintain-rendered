<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plans for eventually using published pubgrub? - astral-sh/uv #3794</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Plans for eventually using published pubgrub?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3794">#3794</a>
        opened by <a href="https://github.com/musicinmybrain">@musicinmybrain</a>
        on 2024-05-23 14:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/musicinmybrain">@musicinmybrain</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>I noticed that <code>pubgrub</code> is one of two dependencies that <code>uv</code> currently needs to fork (https://github.com/astral-sh/pubgrub), with <a href="https://github.com/prefix-dev/async_http_range_reader/issues/14"><code>async_zip</code></a> being the other. I also noticed that there seems to be ongoing work toward minimizing the changes in the fork, e.g. https://github.com/astral-sh/uv/pull/3713, https://github.com/astral-sh/pubgrub/commit/eeb63dd5fe524d4e3633d789da81e1d73dd574e5.</p>
<p>For the benefit of distribution packagers and others who <a href="https://docs.fedoraproject.org/en-US/packaging-guidelines/Rust/#_replacing_git_dependencies">need to treat git dependencies specially</a>, could you please comment briefly on whether you have a plan for eventually using the published <a href="https://crates.io/crates/pubgrub"><code>pubgrub</code> crate</a>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-23 14:25</div>
            <div class="timeline-body"><p>We unfortunately require api-breaking changes to pubgrub and access to some of the internals that will not be exposed in the published version. While we have been and will be spending significant effort into upstreaming our changes (https://github.com/pubgrub-rs/pubgrub/pulls?q=is%3Apr+author%3Akonstin), we unfortunately do not have plans to switch to a crates.io version of pubgrub.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/musicinmybrain">@musicinmybrain</a> on 2024-05-23 14:31</div>
            <div class="timeline-body"><p>Thanks! Even if the fork will be maintained indefinitely, the statement and explanation is valuable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @musicinmybrain on 2024-05-23 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-23 14:35</div>
            <div class="timeline-body"><p>We could vendor it within <code>uv</code> itself if it makes a big difference externally. We generally find it easier to maintain the fork in a separate repository though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-05-23 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/musicinmybrain">@musicinmybrain</a> on 2024-05-23 14:49</div>
            <div class="timeline-body"><blockquote>
<p>We could vendor it within <code>uv</code> itself if it makes a big difference externally. We generally find it easier to maintain the fork in a separate repository though.</p>
</blockquote>
<p>In Fedora, we handle <code>git</code> crate dependencies by adding an additional source archive, like https://github.com/astral-sh/pubgrub/archive/0e684a874c9fb8f74738cd8875524c80e3d4820b/pubgrub-0e684a874c9fb8f74738cd8875524c80e3d4820b.tar.gz, to the source RPM. Then we extract it and patch the <code>git</code> crate dependency into a <code>path</code> one.</p>
<p>This is perhaps a little more effort than dealing with an “in-tree” vendored/bundled crate, but not much more, as long as the number of such crates is small. Plus, this method has the advantage that it’s explicit, with no chance of missing vendored/bundled code that we needed to document and justify to satisfy our packaging guidelines. So I can’t speak for other distributions, but I’m perfectly happy with the way these two forked crates are managed now.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:00 UTC
    </footer>
</body>
</html>
