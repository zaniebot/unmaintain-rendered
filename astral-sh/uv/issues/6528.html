<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerPC page size issue with released binaries - astral-sh/uv #6528</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PowerPC page size issue with released binaries</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6528">#6528</a>
        opened by <a href="https://github.com/rjzak">@rjzak</a>
        on 2024-08-23 15:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rjzak">@rjzak</a> on 2024-08-23 15:47</div>
            <div class="timeline-body"><p>The released binaries for powerpc64le don't run on 64k page size systems, but uv runs on those systems when compiled from source.</p>
<pre><code>~/Downloads
❯ ./uv-powerpc64le-unknown-linux-gnu/uv -V
&lt;jemalloc&gt;: Unsupported system page size
&lt;jemalloc&gt;: Unsupported system page size
memory allocation of 56 bytes failed
Aborted

~/Downloads
❯ ./uv-powerpc64le-unknown-linux-musl/uv -V
&lt;jemalloc&gt;: Unsupported system page size
&lt;jemalloc&gt;: Unsupported system page size
memory allocation of 56 bytes failed
Aborted

~/Downloads
❯ ./uv-0.3.2/target/release/uv -V
uv 0.3.2

~/Downloads
❯ uname -a
Linux behemoth 6.1.0-23-powerpc64le #1 SMP Debian 6.1.99-1 (2024-07-15) ppc64le GNU/Linux

~/Downloads
❯ lsb_release -a
No LSB modules are available.
Distributor ID:	Debian
Description:	Debian GNU/Linux 12 (bookworm)
Release:	12
Codename:	bookworm

~/Downloads
❯ getconf PAGESIZE
65536
</code></pre>
<p>This may be an issue since I think most ppc64 systems use 64k as that seems to be the default. As far as I know, the discontinued Void Linux PPC and Chimera Linux are the only ppc64 systems which used 4k pages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 15:52</div>
            <div class="timeline-body"><p>Is this a duplicate of https://github.com/astral-sh/uv/issues/4647 but for our distributions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rjzak">@rjzak</a> on 2024-08-23 16:46</div>
            <div class="timeline-body"><p>Yes, sorry I missed that. It's also not clear that issue is with the released binaries from the GitHub releases page or something else, but I think aarch64 has the same issue with some distributions but I'm not sure.</p>
<p>This is an issue with the ppc64le binaries on the releases page.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-25 02:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 02:33</div>
            <div class="timeline-body"><p>Any idea how to approach fixing this? Do we need to set a different page size during build?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rjzak">@rjzak</a> on 2024-08-25 02:55</div>
            <div class="timeline-body"><p>I'd say just have a note in the readme, release notes, or the binary file name to indicate the binary expects 4k pages on ppc64 (and probably arm) where 4k isn't the default. As for how to have your build environment run with a 64k page size when you likely aren't running on bare metal, I don't know. Can Docker allow running with different page sizes?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">release</span> added by @zanieb on 2024-08-26 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4647.html">astral-sh/uv#4647</a> on 2024-08-26 16:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-26 16:50</div>
            <div class="timeline-body"><p>We do this</p>
<p>https://github.com/astral-sh/uv/blob/e097f948c9eca7fb09948d73ac03248363c8ce7a/.github/workflows/build-binaries.yml#L574</p>
<p>per</p>
<ul>
<li>https://github.com/gnzlbg/jemallocator/issues/170</li>
<li>https://github.com/astral-sh/ruff/issues/3791</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rjzak">@rjzak</a> on 2024-08-26 18:52</div>
            <div class="timeline-body"><p>That looks good for ARM devices.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tom-miller1">@tom-miller1</a> on 2024-09-10 14:49</div>
            <div class="timeline-body"><p>Same results on an IBM Power9 server, both the downloaded artifact from the release page and the pip-installed binary fail in jemalloc. Have not yet tried to build from the source, but this is a blocker for using <code>uv</code> as a CI build and test target for our internal Python apps on ppc64le.</p>
<pre><code>$ .venv/bin/uv
&lt;jemalloc&gt;: Unsupported system page size
&lt;jemalloc&gt;: Unsupported system page size
memory allocation of 56 bytes failed
Abort(coredump)

$ tail -4 /proc/cpuinfo
platform        : pSeries
model           : IBM,9009-22A
machine         : CHRP IBM,9009-22A
MMU             : Hash

$ uname -srvmio        
Linux 4.18.0-477.43.1.el8_8.ppc64le #1 SMP Thu Jan 4 09:45:15 EST 2024 ppc64le ppc64le GNU/Linux

$ /bin/getconf PAGESIZE
65536
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rjzak">@rjzak</a> on 2024-09-10 19:21</div>
            <div class="timeline-body"><p>Maybe build from source and cache the binary for your CI? The build is pretty simple and straightforward.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tom-miller1">@tom-miller1</a> on 2024-09-11 11:16</div>
            <div class="timeline-body"><p>Looks like this was fixed for ppc64le in Ruff using the same build flags that are being passed to maturin for aarch64. Could the same fix be applied to uv?</p>
<p>https://github.com/astral-sh/ruff/issues/10073</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-11 11:42</div>
            <div class="timeline-body"><p>I'm happy to review a PR and see if it fixes it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-11 15:43</div>
            <div class="timeline-body"><p>Yeah we should apply those changes. I actually thought we already had them in the build script, but it turns out they're only applied to some other architectures and not PowerPC.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2024-09-11 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7298.html">astral-sh/uv#7298</a> on 2024-09-11 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-11 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-11 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10942.html">astral-sh/uv#10942</a> on 2025-01-24 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../archlinuxarm/PKGBUILDs/pulls/2089.html">archlinuxarm/PKGBUILDs#2089</a> on 2025-02-09 01:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Wilfred/difftastic/issues/872.html">Wilfred/difftastic#872</a> on 2025-08-21 12:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
