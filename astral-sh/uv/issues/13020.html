<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect pip compile for git subdirectory dependency - astral-sh/uv #13020</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect pip compile for git subdirectory dependency</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/13020">#13020</a>
        opened by <a href="https://github.com/bnaul">@bnaul</a>
        on 2025-04-21 18:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bnaul">@bnaul</a> on 2025-04-21 18:52</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Example <code>requirements.in</code>:</p>
<pre><code>git+https://github.com/PrefectHQ/prefect.git#subdirectory=src/integrations/prefect-dask
</code></pre>
<p>Compiling gives a weird-looking relative reference for <code>prefect</code> that does not install correctly</p>
<pre><code>âžœ uv pip compile requirements.in | grep '^prefect'
Resolved 105 packages in 193ms
prefect @ ../../../@562b964535b46f586b9b12808462956ed2f90c5a
prefect-dask @ git+https://github.com/PrefectHQ/prefect.git@562b964535b46f586b9b12808462956ed2f90c5a#subdirectory=src/integrations/prefect-dask
</code></pre>
<p>The same thing happens if you declare <code>prefect</code> in <code>requirements.in</code>, but adding <code>prefect</code> as a <code>git+</code> dependency does work.</p>
<h3>Platform</h3>
<p>MacOS 15 ARM64</p>
<h3>Version</h3>
<p>uv 0.6.14 (Homebrew 2025-04-09)</p>
<h3>Python version</h3>
<p>3.13.2, 3.10.16</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @bnaul on 2025-04-21 18:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-23 02:02</div>
            <div class="timeline-body"><p>Thanks, this is definitely a bug. I believe that's the path to the <code>prefect</code> root <em>within our cache</em>. We fix these up in a variety of places, but we might be missing one? Or there's something else going on. @konstin has some context here too, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-26 14:20</div>
            <div class="timeline-body"><p>The problem is that we use the incorrect <code>given</code> value for the path-in-git case, and the given value is what's displayed: https://github.com/astral-sh/uv/blob/4b348512c270d4fc45d4c5ab55df0bae4e2d93cd/crates/uv-distribution/src/metadata/lowering.rs#L691-L713</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-26 14:23</div>
            <div class="timeline-body"><p>Oh interesting. I wonder why that hasn't affected use elsewhere. Honestly, we might want to drop <code>given</code> entirely for sources? <code>given</code> mostly existed to help with preserving environment variables in <code>requirements.txt</code> files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-06-26 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-26 15:37</div>
            <div class="timeline-body"><p>I can take a look from here @konstin.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14288.html">astral-sh/uv#14288</a> on 2025-06-26 17:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-06-26 19:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
