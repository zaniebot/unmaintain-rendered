<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add an option to add a local dependency also as workspace member for `uv add` - astral-sh/uv #9634</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add an option to add a local dependency also as workspace member for `uv add`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/9634">#9634</a>
        opened by <a href="https://github.com/NicholasPini">@NicholasPini</a>
        on 2024-12-04 10:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/NicholasPini">@NicholasPini</a> on 2024-12-04 10:18</div>
            <div class="timeline-body"><p>I'm working with a bit of an unorthodox setup: I have a bunch of different, independent projects. Some of these projects are utilities meant to be used by other projects, and I found that the easiest way to manage this setup is to make the &quot;main&quot; projects workspaces that depend on the utilities packages, which are also members of these workspaces. Something like this:</p>
<pre><code>main_folder
 - workspace A (members and dependencies: utility A, utility B)
 - workspace B (members and dependencies: utility A)
 - workspace C (members and dependencies: utility B)
 - utility A (an uv project)
 - utility B (an uv project)
</code></pre>
<p>I know that workspaces are supposed to contain in their folders their members, but this setup lets me deal with uv sync/build/etc without repeating the command for the utilities projects by using <code>--all-packages</code>. Also, I can easily copy pyproject.toml and uv.lock of a workspace and its utilities, and call <code>uv sync --no-install-workspace</code> to easily install all the dependencies of the entire workspace in a Docker container, without installing the projects and utilities themselves.</p>
<p>That said, I can add a local dependency in the CLI using <code>uv add /path/to/package</code>, but I then have to manually edit the pyproject.toml file to make that package also a workspace member.</p>
<p>Would it make sense to have some kind of option, something like <code>--as-member</code>, so that <code>uv add --as-member /path/to/package</code> would add <code>package</code> as a dependency <em>and</em> as a workspace member?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2024-12-06 00:11</div>
            <div class="timeline-body"><p>Does <code>uv add --editable /path/to/package</code> work for you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-06 00:15</div>
            <div class="timeline-body"><p>I think this makes sense? I don't think you can do this from the CLI today. IIRC, if you <code>uv add /path/to/package</code> and <code>/path/to/package</code> matches <code>members</code>, it does mark it as a workspace package; but if it's not in <code>members</code>, I don't <em>think</em> we have a way to add it as such.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2024-12-06 00:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-12-06 00:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NicholasPini">@NicholasPini</a> on 2024-12-06 09:35</div>
            <div class="timeline-body"><p>EDIT: Never mind, this was caused by missing <code>__init__.py</code> files in the package directory. Not sure why this was not necessary when using workspaces, oh well.</p>
<blockquote>
<p>Does <code>uv add --editable /path/to/package</code> work for you?</p>
</blockquote>
<p>I'm facing problems with this approach. Basically, in my Dockerfile I recreate the same identical folder structure that I have in my repo. If I have project A depending on the local project B, I create these folders:</p>
<pre><code>app
 - project_a
   - pyproject.toml
   - uv.lock
   - README.md
   - src (this is empty)
 - project_B 
   - pyproject.toml
   - uv.lock
   - README.md
   - src (this is empty)
</code></pre>
<p><code>src</code> is empty because the Python files are actually pulled from S3 later, when the Docker container is already built.</p>
<p>Here is the problem: if project_A is a workspace with project_B as member, I can run <code>uv sync --locked --no-dev --no-install-workspace</code> and I can install all the dependencies without actually having the source files, but I cannot do the same if project_A simply depends on project_B. I can run <code>uv sync --locked --no-dev --no-install-project --no-editable</code> in the project_B folder, and it works. But as soon as I run <code>uv sync --locked --no-dev --no-install-project --no-editable</code> in the project_A folder, I get this error:</p>
<pre><code>1.245       ValueError: Unable to determine which files to ship
1.245       inside the wheel using the following heuristics:
1.245       https://hatch.pypa.io/latest/plugins/builder/wheel/#default-file-selection
1.245 
1.245       The most likely cause of this is that there is no directory that matches
1.245       the name of your project (utils_2).
1.245 
1.245       At least one file selection option must be defined
1.245       in the `tool.hatch.build.targets.wheel` table, see:
1.245       https://hatch.pypa.io/latest/config/build/
1.245 
1.245       As an example, if you intend to ship a directory named `foo` that
1.245       resides within a `src` directory located at the root of your project,
1.245       you can define the following:
1.245 
1.245       [tool.hatch.build.targets.wheel]
1.245       packages = [&quot;src/foo&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MrMegaMango">@MrMegaMango</a> on 2024-12-28 12:23</div>
            <div class="timeline-body"><p>it's confusing as a new Python user to differentiate when to use --editable vs workspace for local package import to work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NicholasPini">@NicholasPini</a> on 2024-12-28 12:46</div>
            <div class="timeline-body"><blockquote>
<p>it's confusing as a new Python user to differentiate when to use --editable vs workspace for local package import to work</p>
</blockquote>
<p>This can already be the case, it's just that there's no option to add an already existing workspace member in the CLI. I mean, creating a project inside a project automatically makes it a workspace member by default.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
