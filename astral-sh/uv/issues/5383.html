<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow `uv add --git &lt;url&gt;` - astral-sh/uv #5383</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow <code>uv add --git &lt;url&gt;</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/5383">#5383</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-07-23 22:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a></div>
            <div class="timeline-body"><p>e.g. <code>uv add [&lt;package&gt;] --git &lt;url&gt;</code></p>
<p>Unlike <code>uv add &lt;git-url&gt;</code> the user should not have to include a <code>git+</code> prefix.</p>
<p>Part of <a href="https://github.com/astral-sh/uv/issues/5381">astral-sh/uv#5381</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-23 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-23 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eth3lbert">@eth3lbert</a> on 2024-07-24 08:55</div>
            <div class="timeline-body"><p>I&#x27;d like to request some clarification on the following:</p>
<ol>
<li><p>What is the expected outcome of this operation?</p>
</li>
<li><p>Would the result of <code>uv add &quot;httpx&gt;0.2.0&quot; --git https://github.com/encode/httpx</code> differ from <code>uv add &quot;httpx&gt;0.2.0&quot; git+https://github.com/encode/httpx</code>?</p>
</li>
<li><p>Should we consider issues #4604  or #5341  during implementation?</p>
</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-24 14:38</div>
            <div class="timeline-body"><ol>
<li><p>The same as <code>uv add git+https://github.com/encode/httpx</code></p>
</li>
<li><p>This drops the version specifiers from the <code>project.dependencies</code> entry for <code>httpx</code>, they need to be respected.</p>
</li>
</ol>
<pre><code>❯ uv init
warning: `uv init` is experimental and may change without warning
Initialized project `example`
❯ uv add &quot;httpx&gt;0.2.0&quot; git+https://github.com/encode/httpx
warning: `uv add` is experimental and may change without warning
 Updated https://github.com/encode/httpx (beb501f)
⠙ Resolving dependencies...                                                                                                                                                                                                                                                    warning: `uv.sources` is experimental and may change without warning
 Updated https://github.com/encode/httpx (beb501f)
Resolved 8 packages in 379ms
   Built example @ file:///Users/zb/workspace/example
Prepared 1 package in 388ms
Uninstalled 1 package in 0.36ms
Installed 1 package in 0.85ms
 - example==0.1.0 (from file:///Users/zb/workspace/example)
 + example==0.1.0 (from file:///Users/zb/workspace/example)
❯ cat pyproject.toml
[project]
name = &quot;example&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;httpx&quot;,
]

[tool.uv]
dev-dependencies = []

[tool.uv.sources]
httpx = { git = &quot;https://github.com/encode/httpx&quot; }
</code></pre>
<ol>
<li>I think we can keep this separate from:</li>
</ol>
<ul>
<li>#4604,</li>
<li>#4603</li>
<li>#5341</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eth3lbert">@eth3lbert</a> on 2024-07-26 00:50</div>
            <div class="timeline-body"><blockquote>
<p>2. This drops the version specifiers from the <code>project.dependencies</code> entry for <code>httpx</code>, they need to be respected.</p>
</blockquote>
<p>Since issue #5339 has been resolved, is this statement still valid?</p>
<hr>
<p>Let me summarize a bit. Please correct me if I&#x27;m wrong.</p>
<ul>
<li>This command adds a git source from a given URL (<code>git+</code> prefix is optional).</li>
<li>This should be considered equivalent to <code>uv add git+URL</code>.</li>
<li>This should preserve the version specifier if provided.<ul>
<li>Since issue #5339 has been resolved, I think the following should be considered equivalent:<ul>
<li><code>uv add &quot;httpx &gt; 0.2.0&quot; &quot;git+https://github.com/encode/httpx&quot;</code></li>
<li><code>uv add &quot;httpx &gt; 0.2.0&quot; --git &quot;https://github.com/encode/httpx&quot;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>Unclear Part</p>
<ul>
<li><p>If the provided package name differs from the actual one, e.g. <code>uv add &quot;asdf&quot; --git &quot;httpx://github.com/encode/httpx&quot;</code>
this should be considered as <code>uv add &quot;asdf @ git+https://github.com/encode/httpx&quot;</code>
which results in:</p>
<pre><code>  dependency = [ &quot;asdf&quot; ]
  [tool.uv.sources]
  asdf = { git = &quot;https://github.com/encode/httpx&quot; }
</code></pre>
</li>
<li><p>Furthermore, if the provided package name differs from the actual one and includes a <code>version specifier</code>, e.g. <code>uv add &quot;asdf &gt; 0.2.0&quot; --git &quot;https://github.com/encode/httpx&quot;</code>
this should be considered as <code>uv add &quot;asdf @ git+https://github.com/encode/httpx&quot; &quot;asdf &gt; 0.2.0&quot;</code>
which results in:</p>
<pre><code>  dependency = [&quot;asdf &gt; 0.2.0&quot;]
  [tool.uv.source]
  asdf = {git = &quot;https://github.com/encode/httpx&quot;}
</code></pre>
</li>
<li><p>Additional complexity arises when the git reference is involved.</p>
<p>If the package name differs from the actual one and includes a version specifier, e.g. <code>uv add &quot;asdf &gt; 0.2.0&quot; --git &quot;https://github.com/encode/httpx&quot; --tag 0.24.1</code></p>
<p>This cannot be run with a single <code>uv add</code> command. Currently, you need to execute two separate commands:
<code>uv add &quot;asdf @ git+https://github.com/encode/httpx&quot; --tag 0.24.1</code>
<code>uv add &#x27;asdf &gt; 0.2.0&#x27;</code></p>
<p>Note:</p>
<ul>
<li><code>uv add</code> does not currently support <code>uv add &#x27;asdf @ git+https://github.com/encode/httpx@0.24.1&#x27;</code>, you must either use the <code>--tag</code> flag or the <code>--raw-sources</code> flag.</li>
<li>however, <code>uv pip</code> install allows, <code>uv pip install &#x27;asdf @ git+https://github.com/encode/httpx@0.24.1&#x27;</code> this is valid.</li>
<li>but, <code>pip install &#x27;asdf @ git+https://github.com/encode/httpx@0.24.1&#x27;</code> will error with: <code>has inconsistent name: expected &#x27;asdf&#x27;, but metadata has &#x27;httpx&#x27;</code></li>
</ul>
</li>
</ul>
<hr>
<p>Based on my understanding, if the <code>--git</code> flag is used, we simply rewrite the <code>requirements</code> from <code>--git</code> and the <code>[package]</code> as needed (similar to how <code>cargo add</code> works, although <code>cargo add</code> doesn&#x27;t currently allow specifying a git URL with a version).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-20 18:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:32:13 UTC
    </footer>
</body>
</html>
