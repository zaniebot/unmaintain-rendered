<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `--only-workspace` to `uv tree` - astral-sh/uv #11505</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>--only-workspace</code> to <code>uv tree</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11505">#11505</a>
        opened by <a href="https://github.com/danielgafni">@danielgafni</a>
        on 2025-02-14 11:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danielgafni">@danielgafni</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>It would be great to have this option available.</p>
<p>I am writing a <a href="https://dagger.io/">Dagger</a> pipeline to build my monorepo and getting the information about internal workspace dependencies from <code>uv</code> would allow me to granularly copy only the required source files for a particular subproject into the build container. This in turn will greatly improve caching.</p>
<p>I kinda can do it by hand already but I feel like internal dependencies source code location discovery could be automated with <code>uv</code>.</p>
<h3>Example</h3>
<pre><code class="language-shell">uv tree --package my-project --only-workspace
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @danielgafni on 2025-02-14 11:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-14 13:20</div>
            <div class="timeline-body"><p>We discussed flags for this a fair bit over in https://github.com/astral-sh/uv/issues/4028#issuecomment-2302998517</p>
<p>Would you mind seeing if the concerns there are relevant or if one of the other suggestions makes sense for your use-case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2025-02-14 17:44</div>
            <div class="timeline-body"><p>I don't see anything related to the <code>uv tree</code> command in this issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-14 19:10</div>
            <div class="timeline-body"><p>What does <code>--only-workspace</code> do here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2025-02-14 23:32</div>
            <div class="timeline-body"><p>It would only include workspace members in the <code>uv tree</code> command output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-15 00:57</div>
            <div class="timeline-body"><blockquote>
<p>I don't see anything related to the <code>uv tree</code> command in this issue</p>
</blockquote>
<p>The discussed flags are for <code>uv sync</code>, but the concepts are applicable elsewhere. For example, we use the same concepts in <code>uv export</code></p>
<pre><code>      --no-emit-project                    Do not emit the current project
      --no-emit-workspace                  Do not emit any workspace members, including the root project
      --no-emit-package &lt;NO_EMIT_PACKAGE&gt;  Do not emit the given package(s)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2025-02-16 21:41</div>
            <div class="timeline-body"><p>Sorry @zanieb, I don't get what am I supposed to do :)</p>
<p>Are you implying that the <code>--only-workspace</code> <em>name</em> is not a good candidate for this flag?
If so, does <code>--only-emit-workspace</code> work better?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-17 04:16</div>
            <div class="timeline-body"><p>Don't worry about it, I'll re-read the discussion there and see what flag makes sense here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Sessional">@Sessional</a> on 2025-03-10 19:08</div>
            <div class="timeline-body"><p>@zanieb I think this conversation is maybe targeting a specific problem uncovered while shoving uv+dagger together in a monorepo. There is no great way to discover ONLY your local dependencies for a package. There is a great way to discover everything BUT your local dependencies.</p>
<p>While building the monorepo (via dagger inside a container) into a new runtime container, we need to copy all relevant sources for our dependencies into the build container. While one could go <code>uv sync</code> if all sources are copied into the build context,  trying to keep as much out of the context (of the build container) as possible is generally a good idea and so shipping ALL of the parts of the monorepo seems unwieldy.</p>
<p>Given a project like so:
libs/lib1
libs/lib2
libs/lib3
projects/app</p>
<p>And a dependency tree like so: <code>projects/app</code> -&gt; <code>libs/lib1</code> -&gt; <code>libs/lib2</code>.</p>
<p>When creating the context for our build container we can intelligently leave <code>lib3</code> out because it isn't part of the dependency tree. In this small example it's no big deal, but when we talk larger libraries or even more libraries it becomes more impactful. Right now to find the entire dependency tree, we have to navigate the <code>uv.lock</code> file which historically is frowned upon by most tools because it's really an internal format for internal goodies.</p>
<p>By shoving a flag for some form of <code>--only-locals</code> into the tree it would be feasible to traverse that tree instead of the lock file for which projects to copy into the build container context. As an aside on this, can <code>uv tree</code> output in a format other than <code>pretty-print</code> for us to dig around in with code (unless we should be using the .lock file?)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:55 UTC
    </footer>
</body>
</html>
