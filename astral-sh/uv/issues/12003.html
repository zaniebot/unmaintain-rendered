<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv cache prune removes binaries that are symlinked to - astral-sh/uv #12003</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv cache prune removes binaries that are symlinked to</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12003">#12003</a>
        opened by <a href="https://github.com/eblade">@eblade</a>
        on 2025-03-06 13:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/eblade">@eblade</a></div>
            <div class="timeline-body">Summary
<p>We used uv 0.5 previously and this problem did not occur there, so we had a <code>uv cache prune</code> at the end of the docker script to save some space (but we still wanted a small cache so we could sync the env on run later).</p>
<p>Now we have upgraded to uv 0.6.4 and cache prune is much more aggressive. We run with UV_LINK_MODE=symlink (also to save some space), which might be of interest.</p>
<p>The result is that the imports that point to .so binaries no longer resolve in python.</p>
<p>Anyway, thanks for this great piece of software!</p>
Platform
<p>Linux 5.15.167.4-microsoft-standard-WSL2 x86_64 GNU/Linux</p>
Version
<p>uv 0.6.4</p>
Python version
<p>Python 3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/eblade">@eblade</a> on 2025-03-06 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-06 15:13</div>
            <div class="timeline-body"><p>Unfortunately using <code>uv cache prune</code> (and <code>uv cache clean</code>) with <code>UV_LINK_MODE=symlink</code> is effectively unsupported. We should probably warn about this. They&#x27;re sort of just inherently incompatible... If you&#x27;re symlinking into the cache, we have no way of knowing what&#x27;s in-use, and removing the source files breaks the symlinks (as you&#x27;d expect).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-06 15:55</div>
            <div class="timeline-body"><p>I think we should at least warn about this (and possibly do a more limited prune).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-06 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-06 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-06 16:27</div>
            <div class="timeline-body"><p>Actually, do you know exactly what&#x27;s failing here? Like what it can&#x27;t find? I&#x27;m trying to reproduce.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-06 16:27</div>
            <div class="timeline-body"><p>(Are you running <code>uv cache prune --ci</code>? Or <code>uv cache prune</code>?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jezekra1">@jezekra1</a> on 2025-03-07 16:11</div>
            <div class="timeline-body"><p>Hi, have you seen this issue by any chance? #11694</p>
<p>It&#x27;s a bit unrelated but it&#x27;s also about <code>uv cache prune</code> removing things it shouldn&#x27;t :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eblade">@eblade</a> on 2025-03-10 07:34</div>
            <div class="timeline-body"><p>I did try both with and without the --ci flag, but it does not seem to matter much.</p>
<p>It seems like the files that it can&#x27;t find are mostly .so files, the binary modules. So if you try something like numpy this would happen. If I reainstall the package from which it fails to import, it will start working and move on to the next one.</p>
<p>I&#x27;m starting to think that if I must choose, it makes more sense to do that pruning (with --ci) than the symlinking, so I should try that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-18 22:23</div>
            <div class="timeline-body"><p>Can you give me a concrete example of the commands to run (and which package to use), and the error message you see? It&#x27;s hard for me to help without being able to reproduce.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-18 22:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:37:38 UTC
    </footer>
</body>
</html>
