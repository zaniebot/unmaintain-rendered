<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug: ModuleNotFoundError related to venv uv_cache.json when store in iCloud - astral-sh/uv #9902</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bug: ModuleNotFoundError related to venv uv_cache.json when store in iCloud</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9902">#9902</a>
        opened by <a href="https://github.com/cvanea">@cvanea</a>
        on 2024-12-15 02:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cvanea">@cvanea</a></div>
            <div class="timeline-body">Description
<p><code>uv run</code> fails with a <code>ModuleNotFoundError</code> when the venv <code>uv_cache.json</code> is present. This doesn‚Äôt happen on an earlier macOS version.</p>
Environment
<ul>
<li>uv version: uv 0.5.9 (0652800cb 2024-12-13)</li>
<li>OS: macOS 15.1.1 (bug present)</li>
<li>Also tested on: macOS 14.3.1 (bug not present)</li>
</ul>
Minimal Reproduction Steps
<pre><code>uv init --package foo
cd foo
uv run foo
</code></pre>
Bug Description
<p><code>uv run foo</code> correctly prints <code>Hello from foo!</code> for a few seconds. Then running it results in:</p>
<pre><code>ModuleNotFoundError: No module named &#x27;foo&#x27;
</code></pre>
Additional Information
<ol>
<li>Deleting the cache file resolves the issue temporarily:</li>
</ol>
<pre><code>rm .venv/lib/python3.13/site-packages/foo-0.1.0.dist-info/uv_cache.json
</code></pre>
<ol>
<li>Setting the environment variable <code>UV_NO_INSTALLER_METADATA=1 uv run foo</code> prevents the issue.</li>
</ol>
Debug Information

Debug Logs - Failed Run (with cache)

<pre><code>DEBUG uv 0.5.9 (0652800cb 2024-12-13)
DEBUG Found project root: `/Users/user/Documents/code/py/foo`
DEBUG No workspace root found, using project root
DEBUG Discovered project `foo` at: /Users/user/Documents/code/py/foo
DEBUG Reading Python requests from version file at `/Users/user/Documents/code/py/foo/.python-version`
DEBUG Using Python request `3.13` from version file at `.python-version`
TRACE Cached interpreter info for Python 3.13.1, skipping probing: .venv/bin/python3
DEBUG The virtual environment&#x27;s Python version satisfies `3.13`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: foo @ file:///Users/user/Documents/code/py/foo
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
DEBUG Using request timeout of 30s
TRACE Comparing installed with source: Url(InstalledDirectUrlDist { name: PackageName(&quot;foo&quot;), version: &quot;0.1.0&quot;, direct_url: LocalDirectory { url: &quot;file:///Users/user/Documents/code/py/foo&quot;, dir_info: DirInfo { editable: Some(true) } }, url: Url { scheme: &quot;file&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: None, port: None, path: &quot;/Users/user/Documents/code/py/foo&quot;, query: None, fragment: None }, editable: true, path: &quot;/Users/user/Documents/code/py/foo/.venv/lib/python3.13/site-packages/foo-0.1.0.dist-info&quot;, cache_info: Some(CacheInfo { timestamp: Some(Timestamp(SystemTime { tv_sec: 1734188435, tv_nsec: 526620830 })), commit: None, tags: None }) }) Directory { install_path: &quot;/Users/user/Documents/code/py/foo&quot;, editable: true, virtual: false, url: VerbatimUrl { url: Url { scheme: &quot;file&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: None, port: None, path: &quot;/Users/user/Documents/code/py/foo&quot;, query: None, fragment: None }, given: None } }
DEBUG Requirement already installed: foo==0.1.0 (from file:///Users/user/Documents/code/py/foo)
DEBUG Using Python 3.13.1 interpreter at: /Users/user/Documents/code/py/foo/.venv/bin/python3
DEBUG Running `foo`
Traceback (most recent call last):
  File &quot;/Users/user/Documents/code/py/foo/.venv/bin/foo&quot;, line 5, in &lt;module&gt;
    from foo import main
ModuleNotFoundError: No module named &#x27;foo&#x27;
DEBUG Command exited with code: 1
</code></pre>


Debug Logs - Successful Run (after removing cache)

<pre><code>DEBUG uv 0.5.9 (0652800cb 2024-12-13)
DEBUG Found project root: `/Users/user/Documents/code/py/foo`
DEBUG No workspace root found, using project root
DEBUG Discovered project `foo` at: /Users/user/Documents/code/py/foo
DEBUG Reading Python requests from version file at `/Users/user/Documents/code/py/foo/.python-version`
DEBUG Using Python request `3.13` from version file at `.python-version`
TRACE Cached interpreter info for Python 3.13.1, skipping probing: .venv/bin/python3
DEBUG The virtual environment&#x27;s Python version satisfies `3.13`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: foo @ file:///Users/user/Documents/code/py/foo
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
DEBUG Using request timeout of 30s
TRACE Comparing installed with source: Url(InstalledDirectUrlDist { name: PackageName(&quot;foo&quot;), version: &quot;0.1.0&quot;, direct_url: LocalDirectory { url: &quot;file:///Users/user/Documents/code/py/foo&quot;, dir_info: DirInfo { editable: Some(true) } }, url: Url { scheme: &quot;file&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: None, port: None, path: &quot;/Users/user/Documents/code/py/foo&quot;, query: None, fragment: None }, editable: true, path: &quot;/Users/user/Documents/code/py/foo/.venv/lib/python3.13/site-packages/foo-0.1.0.dist-info&quot;, cache_info: None }) Directory { install_path: &quot;/Users/user/Documents/code/py/foo&quot;, editable: true, virtual: false, url: VerbatimUrl { url: Url { scheme: &quot;file&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: None, port: None, path: &quot;/Users/user/Documents/code/py/foo&quot;, query: None, fragment: None }, given: None } }
DEBUG Requirement installed, but not fresh: foo==0.1.0 (from file:///Users/user/Documents/code/py/foo)
DEBUG Directory source requirement already cached: foo==0.1.0 (from file:///Users/user/Documents/code/py/foo)
[File removal logs...]
DEBUG Uninstalled foo (9 files, 1 directory)
Uninstalled 1 package in 1ms
[Installation logs...]
Installed 1 package in 3ms
DEBUG Using Python 3.13.1 interpreter at: /Users/user/Documents/code/py/foo/.venv/bin/python3
DEBUG Running `foo`
Hello from foo!
DEBUG Command exited with code: 0
</code></pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-15 02:56</div>
            <div class="timeline-body"><p>I think I would need to see a full reproduction in order to help (like, an example project that reproduces the bug along with a series of commands). From the logs, it looks like removing the cache file is just invalidating the cache?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-15 02:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cvanea">@cvanea</a> on 2024-12-15 15:34</div>
            <div class="timeline-body"><p>Hi Charlie, thanks for taking a look at this!</p>
<p>I figured out the source of the issue. If the uv project is in an iCloud synced directory then this error happens reliably. I don&#x27;t fully understand it but it seems related to the way macOS treats the file paths of synced directories. The cache says the documents are here:</p>
<p><code>/Users/user/Documents/code/py/foo</code></p>
<p>But in reality they&#x27;re here:</p>
<p><code>/Users/user/Library/Mobile Documents/com~apple~CloudDocs/Documents/code/py/foo</code></p>
<p>This also explains the timing nature of the bug due to the sync schedule.</p>
Full Reproduction Steps
<ol>
<li>Enable iCloud sync for Documents</li>
<li><code>cd Documents</code></li>
<li><code>uv init --package foo</code></li>
<li><code>cd foo</code></li>
<li><code>uv run foo</code></li>
<li>Wait 10 seconds</li>
<li>Repeat <code>uv run foo</code> until <code>ModuleNotFoundError</code></li>
</ol>
<p>This is reproducible across macOS versions (macOS 15.1.1, 14.3.1, 13.5).</p>
<p>Very silly to have this in an iCloud syncing directory! New computer üòÖ However a few people had this same issue at an Anthropic hackathon I went to recently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wchen99998">@wchen99998</a> on 2024-12-31 05:21</div>
            <div class="timeline-body"><p>+1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-07 19:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ceeeeej">@ceeeeej</a> on 2025-03-14 20:06</div>
            <div class="timeline-body"><p>Glad I found this, I was able to observe the same behavior on an iCloud based project. I thought I was insane as I couldn&#x27;t get workspaces to work in a monorepo.</p>
<p>This is a nice to have as it would allow the directories to be synced across Macs. I don&#x27;t think I have ever run into problems with storing code / git repos in iCloud until this.</p>
<p>Would the fix just to be resolving the path or using a relative path?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/huntermatthews">@huntermatthews</a> on 2025-07-11 04:25</div>
            <div class="timeline-body"><p>@charliermarsh -- ping</p>
<p>I&#x27;m hitting this as well.
Please note: I <em>think</em> this is a uv bug, <em>but</em> freely acknowledge it could be a python bug.
Please let me know if I can provide any other information.</p>
<p>macOS 15.5 (24F74)
uv 0.7.20 (Homebrew 2025-07-09).  installed via Homebrew 4.5.9</p>
<p>I&#x27;ve created a simple hello world repo at https://github.com/huntermatthews/helllo_world. -- the only change from
uv init --app hello_world is to move the main function into a package, forcing package resolution.</p>
<p>If I move the project directory outside of iCloud (both a simple copy and via symlink) I do not hit problem.</p>
<p>I reproduced this with python 3.8, 3.10, and 3.12. The hello_world repo is currently at 3.8.</p>
<pre><code>hunter@ed ~/p/helllo_world (main)&gt; uv run hw
Using CPython 3.10.18
Creating virtual environment at: .venv
      Built hw @ file:///Users/hunter/Documents/projects/helllo_world
Installed 1 package in 2ms
Hello from hello-world!
hunter@ed ~/p/helllo_world (main)&gt; uv run hw ; date
Traceback (most recent call last):
  File &quot;/Users/hunter/Documents/projects/helllo_world/.venv/bin/hw&quot;, line 4, in &lt;module&gt;
    from hw.cli import main
ModuleNotFoundError: No module named &#x27;hw&#x27;
Thu Jul 10 23:44:59 EDT 2025
hunter@ed ~/p/helllo_world (main)&gt; rm -rf .venv/
hunter@ed ~/p/helllo_world (main)&gt; uv run hw ; date
Using CPython 3.10.18
Creating virtual environment at: .venv
Installed 1 package in 8ms
Hello from hello-world!
Fri Jul 11 00:11:47 EDT 2025
hunter@ed ~/p/helllo_world (main)&gt; uv run hw ; date
Hello from hello-world!
Fri Jul 11 00:11:48 EDT 2025
hunter@ed ~/p/helllo_world (main)&gt; uv run hw ; date
Hello from hello-world!
Fri Jul 11 00:11:49 EDT 2025
hunter@ed ~/p/helllo_world (main)&gt; uv run hw ; date
Hello from hello-world!
Fri Jul 11 00:11:51 EDT 2025
hunter@ed ~/p/helllo_world (main)&gt; uv run hw ; date
Traceback (most recent call last):
  File &quot;/Users/hunter/Documents/projects/helllo_world/.venv/bin/hw&quot;, line 4, in &lt;module&gt;
    from hw.cli import main
ModuleNotFoundError: No module named &#x27;hw&#x27;
Fri Jul 11 00:11:52 EDT 2025
hunter@ed ~/p/helllo_world (main)&gt;
</code></pre>
<p>Reproduction with --verbose:</p>
<pre><code>hunter@ed ~/p/helllo_world (main)&gt; rm -rf .venv
hunter@ed ~/p/helllo_world (main)&gt; date ; uv  run --verbose hw
Fri Jul 11 00:20:57 EDT 2025
DEBUG uv 0.7.20 (Homebrew 2025-07-09)
DEBUG Found project root: `/Users/hunter/Documents/projects/helllo_world`
DEBUG No workspace root found, using project root
DEBUG Discovered project `hw` at: /Users/hunter/Documents/projects/helllo_world
DEBUG Acquired lock for `/Users/hunter/Documents/projects/helllo_world`
DEBUG Reading Python requests from version file at `/Users/hunter/Documents/projects/helllo_world/.python-version`
DEBUG Using Python request `3.10` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG Searching for Python 3.10 in managed installations or search path
DEBUG Searching for managed installations at `/Users/hunter/.local/share/uv/python`
DEBUG Found managed installation `cpython-3.10.18-macos-aarch64-none`
DEBUG Found `cpython-3.10.18-macos-aarch64-none` at `/Users/hunter/.local/share/uv/python/cpython-3.10.18-macos-aarch64-none/bin/python3.10` (managed installations)
Using CPython 3.10.18
Creating virtual environment at: .venv
DEBUG Assessing Python executable as base candidate: /Users/hunter/.local/share/uv/python/cpython-3.10.18-macos-aarch64-none/bin/python3.10
DEBUG Using base executable for virtual environment: /Users/hunter/.local/share/uv/python/cpython-3.10.18-macos-aarch64-none/bin/python3.10
DEBUG Released lock at `/var/folders/qv/t8pt14356h50k_lpgd2rhvg40000gn/T/uv-4d4b934068286181.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: hw @ file:///Users/hunter/Documents/projects/helllo_world
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 1 package in 0.93ms
DEBUG Using request timeout of 30s
DEBUG Computed cache info: Some(Timestamp(SystemTime { tv_sec: 1752205162, tv_nsec: 273578285 })), None, None, {}, {&quot;src&quot;: Some(Timestamp(Timestamp(SystemTime { tv_sec: 1752199360, tv_nsec: 22408246 })))}
DEBUG Directory source requirement already cached: hw==0.1.0 (from file:///Users/hunter/Documents/projects/helllo_world)
Installed 1 package in 4ms
 + hw==0.1.0 (from file:///Users/hunter/Documents/projects/helllo_world)
DEBUG Released lock at `/Users/hunter/Documents/projects/helllo_world/.venv/.lock`
DEBUG Using Python 3.10.18 interpreter at: /Users/hunter/Documents/projects/helllo_world/.venv/bin/python
DEBUG Running `hw`
DEBUG Spawned child 24446 in process group 24445
Hello from hello-world!
DEBUG Command exited with code: 0
hunter@ed ~/p/helllo_world (main)&gt; date ; uv  run --verbose hw
Fri Jul 11 00:21:00 EDT 2025
DEBUG uv 0.7.20 (Homebrew 2025-07-09)
DEBUG Found project root: `/Users/hunter/Documents/projects/helllo_world`
DEBUG No workspace root found, using project root
DEBUG Discovered project `hw` at: /Users/hunter/Documents/projects/helllo_world
DEBUG Acquired lock for `/Users/hunter/Documents/projects/helllo_world`
DEBUG Reading Python requests from version file at `/Users/hunter/Documents/projects/helllo_world/.python-version`
DEBUG Using Python request `3.10` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The project environment&#x27;s Python version satisfies the request: `Python 3.10`
DEBUG Released lock at `/var/folders/qv/t8pt14356h50k_lpgd2rhvg40000gn/T/uv-4d4b934068286181.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: hw @ file:///Users/hunter/Documents/projects/helllo_world
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 1 package in 0.99ms
DEBUG Using request timeout of 30s
DEBUG Computed cache info: Some(Timestamp(SystemTime { tv_sec: 1752205162, tv_nsec: 273578285 })), None, None, {}, {&quot;src&quot;: Some(Timestamp(Timestamp(SystemTime { tv_sec: 1752199360, tv_nsec: 22408246 })))}
DEBUG Requirement already installed: hw==0.1.0 (from file:///Users/hunter/Documents/projects/helllo_world)
Audited 1 package in 0.15ms
DEBUG Released lock at `/Users/hunter/Documents/projects/helllo_world/.venv/.lock`
DEBUG Using Python 3.10.18 interpreter at: /Users/hunter/Documents/projects/helllo_world/.venv/bin/python3
DEBUG Running `hw`
DEBUG Spawned child 24454 in process group 24453
Hello from hello-world!
DEBUG Command exited with code: 0
hunter@ed ~/p/helllo_world (main)&gt; date ; uv  run --verbose hw
Fri Jul 11 00:21:03 EDT 2025
DEBUG uv 0.7.20 (Homebrew 2025-07-09)
DEBUG Found project root: `/Users/hunter/Documents/projects/helllo_world`
DEBUG No workspace root found, using project root
DEBUG Discovered project `hw` at: /Users/hunter/Documents/projects/helllo_world
DEBUG Acquired lock for `/Users/hunter/Documents/projects/helllo_world`
DEBUG Reading Python requests from version file at `/Users/hunter/Documents/projects/helllo_world/.python-version`
DEBUG Using Python request `3.10` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The project environment&#x27;s Python version satisfies the request: `Python 3.10`
DEBUG Released lock at `/var/folders/qv/t8pt14356h50k_lpgd2rhvg40000gn/T/uv-4d4b934068286181.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: hw @ file:///Users/hunter/Documents/projects/helllo_world
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 1 package in 1ms
DEBUG Using request timeout of 30s
DEBUG Computed cache info: Some(Timestamp(SystemTime { tv_sec: 1752205162, tv_nsec: 273578285 })), None, None, {}, {&quot;src&quot;: Some(Timestamp(Timestamp(SystemTime { tv_sec: 1752199360, tv_nsec: 22408246 })))}
DEBUG Requirement already installed: hw==0.1.0 (from file:///Users/hunter/Documents/projects/helllo_world)
Audited 1 package in 0.14ms
DEBUG Released lock at `/Users/hunter/Documents/projects/helllo_world/.venv/.lock`
DEBUG Using Python 3.10.18 interpreter at: /Users/hunter/Documents/projects/helllo_world/.venv/bin/python3
DEBUG Running `hw`
DEBUG Spawned child 24462 in process group 24461
Traceback (most recent call last):
  File &quot;/Users/hunter/Documents/projects/helllo_world/.venv/bin/hw&quot;, line 4, in &lt;module&gt;
    from hw.cli import main
ModuleNotFoundError: No module named &#x27;hw&#x27;
DEBUG Command exited with code: 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/huntermatthews">@huntermatthews</a> on 2025-07-11 04:26</div>
            <div class="timeline-body"><p>Oh - and I would ask the bug be renamed to include &quot;iCloud&quot; somewhere - this was the devil to find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Bug: ModuleNotFoundError related to venv uv_cache.json&quot; to &quot;Bug: ModuleNotFoundError related to venv uv_cache.json when store in iCloud&quot; by <a href="https://github.com/cvanea">@cvanea</a> on 2025-07-11 19:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matthewsht">@matthewsht</a> on 2025-07-16 21:50</div>
            <div class="timeline-body"><p>I&#x27;ve just had a chance to test this on the work laptop - using OneDrive ( MS icloud knock-off) I can&#x27;t reproduce the problem:</p>
System info:
<pre><code>‚ùØ uv --version
uv 0.7.21 (Homebrew 2025-07-14)
‚ùØ sw_vers
ProductName:		macOS
ProductVersion:		15.5
BuildVersion:		24F74
</code></pre>
Run:
<pre><code>‚ùØ cd ~/Documents/proj_test/
‚ùØ git clone git@github.com:huntermatthews/helllo_world.git
Cloning into &#x27;helllo_world&#x27;...
remote: Enumerating objects: 13, done.
remote: Counting objects: 100% (13/13), done.
remote: Compressing objects: 100% (8/8), done.
remote: Total 13 (delta 0), reused 10 (delta 0), pack-reused 0 (from 0)
Receiving objects: 100% (13/13), done.
‚ùØ cd helllo_world/
‚ùØ uv sync
Using CPython 3.10.18 interpreter at: /opt/homebrew/opt/python@3.10/bin/python3.10
Creating virtual environment at: .venv
Resolved 1 package in 20ms
      Built hw @ file:///Users/matthewsht/Library/CloudStorage/OneDrive-WORK_NAME_HERE/Documents/proj_test/helllo_world
Prepared 1 package in 1.28s
Installed 1 package in 8ms
 + hw==0.1.0 (from file:///Users/matthewsht/Library/CloudStorage/OneDrive-WORK_NAME_HERE/Documents/proj_test/helllo_world)
‚ùØ uv run hw
Hello from hello-world!
</code></pre>
<p>Also, Ive just noticed I spelled hello wrong. Sigh.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:12 UTC
    </footer>
</body>
</html>
