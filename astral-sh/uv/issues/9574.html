<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Difference in `uv run` behavior between GNU/Linux and Windows - astral-sh/uv #9574</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Difference in `uv run` behavior between GNU/Linux and Windows</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9574">#9574</a>
        opened by <a href="https://github.com/sbellon">@sbellon</a>
        on 2024-12-02 12:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sbellon">@sbellon</a> on 2024-12-02 12:25</div>
            <div class="timeline-body"><p>On GNU/Linux you can do</p>
<pre><code>uv run --python 3.13 $SHELL
</code></pre>
<p>and inside the newly opened shell, the selected python is callable as its <code>bin</code> is added to <code>PATH</code>:</p>
<pre><code>/home/user/.local/share/uv/python/cpython-3.13.0-linux-x86_64-gnu/bin
</code></pre>
<p>When doing the same on Windows, i.e.</p>
<pre><code>uv run --python 3.13 cmd.exe
</code></pre>
<p>this does not work, even though <code>PATH</code> variable is also adjusted, but on Windows the <code>Scripts</code> folder is used instead:</p>
<pre><code>C:\Users\user\AppData\Roaming\uv\python\cpython-3.13.0-windows-x86_64-none\Scripts
</code></pre>
<p>and this folder only has the <code>.empty</code> file inside whereas the <code>python.exe</code> would be located one folder level higher.</p>
<p>My use case would be to call (platform-independently)</p>
<pre><code>uv run --python 3.13 some_app
</code></pre>
<p>where <code>some_app</code> in turn expects a specific python version &quot;to be available&quot;. <code>uv run</code> seems to be perfect for this use case, if only on Windows the <code>Scripts</code> part would be omitted.</p>
<p>Is this by intention or a bug?  Or am I misunderstanding things?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-02 13:41</div>
            <div class="timeline-body"><p>I think this is an oversight.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-12-02 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @charliermarsh on 2024-12-02 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbellon">@sbellon</a> on 2024-12-02 14:07</div>
            <div class="timeline-body"><p>Thanks for confirming. An occasional fix for this will then be highly appreciated and I'm looking very much forward to it. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbellon">@sbellon</a> on 2024-12-02 17:21</div>
            <div class="timeline-body"><p>Not sure whether I know what I am doing, but this change seems to fix it for me:</p>
<pre><code class="language-diff">--- a/crates/uv/src/commands/project/run.rs
+++ b/crates/uv/src/commands/project/run.rs
@@ -1016,7 +1016,11 @@ pub(crate) async fn run(
             .as_ref()
             .map(PythonEnvironment::scripts)
             .into_iter()
-            .chain(std::iter::once(base_interpreter.scripts()))
+            .chain(std::iter::once(if cfg!(windows) {
+                base_interpreter.data()
+            } else {
+                base_interpreter.scripts()
+            }))
             .map(PathBuf::from)
             .chain(
                 std::env::var_os(EnvVars::PATH)

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-02 17:23</div>
            <div class="timeline-body"><p>I think that works by &quot;coincidence&quot;, my guess is that the data dir is the top-level dir.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-02 17:30</div>
            <div class="timeline-body"><p>One guiding question: where does the <code>python.exe</code> live in unmanaged Python installations? Is it in <code>Scripts/</code>? Is it in the top-level directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-02 17:31</div>
            <div class="timeline-body"><p>I believe it's the top-level directory. I checked on my Windows machine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbellon">@sbellon</a> on 2024-12-02 17:50</div>
            <div class="timeline-body"><p>But, in that case, is it then &quot;by coincidence&quot; or is it rather &quot;by design&quot;? ;-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-02 17:59</div>
            <div class="timeline-body"><p>Per https://docs.python.org/3.12/library/sysconfig.html#nt-user it seems okay to add the <code>data()</code> directory to the <code>PATH</code>. An alternative is that we generate a trampoline <code>python.exe</code> but that seems expensive without further justification. We probably want to include the <code>scripts()</code> directory too still though, in case it's populated with something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-02 19:23</div>
            <div class="timeline-body"><p>I think it's not the data dir -- it's the install dir. It seems like virtualenvs on Windows do use <code>./Scripts/python.exe</code>, but outside of virtual environments, the executables are placed in the install directory (i.e., the top-level), and both are added to PATH by the installer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-02 19:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-02 19:35</div>
            <div class="timeline-body"><p>I don't understand the distinction you're making. There is no &quot;install directory&quot; in the sysconfig paths and, from what I can tell, the data directory <em>is</em> the install directory by definition?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-02 19:38</div>
            <div class="timeline-body"><p>The &quot;install directory&quot; is the directory containing the Python installation. The &quot;data directory&quot; is some path that <code>sysconfig</code> tells you to look for data files in. I'm fairly certain they do not have to be the same by definition. Distributions can customize sysconfig paths however they want. By &quot;install directory&quot;, I am quoting from the MSI README: https://github.com/python/cpython/blob/c4303763dac4494300e299e54c079a4a11931a55/Tools/msi/README.txt#L466</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-02 19:57</div>
            <div class="timeline-body"><blockquote>
<p>I'm fairly certain they do not have to be the same by definition</p>
</blockquote>
<p>Yeah I'm not really sure. The <code>sysconfig</code> reference I linked to suggests that they're equivalent for all schemes. I imagine there's some way you could set it to a different directory but it seems unlikely in practice.</p>
<p>Regardless, the &quot;install directory&quot; seems correct to me. How are you going to retrieve it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-02 21:29</div>
            <div class="timeline-body"><p>I was considering: if the executable isn't in Scripts, add the executable's parent directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9585.html">astral-sh/uv#9585</a> on 2024-12-02 22:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-02 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-02 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbellon">@sbellon</a> on 2024-12-03 07:52</div>
            <div class="timeline-body"><p>I can confirm that this fixes my issue. Thanks for this lightnight fast fix. :-)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
