```yaml
number: 11391
title: Index URL cannot be queried for lack of authentication ending with package name
type: issue
state: closed
author: jzazo
labels:
  - bug
  - registry
assignees: []
created_at: 2025-02-10T17:00:59Z
updated_at: 2025-04-29T21:37:04Z
url: https://github.com/astral-sh/uv/issues/11391
synced_at: 2026-01-10T01:57:26Z
```

# Index URL cannot be queried for lack of authentication ending with package name

---

_Issue opened by @jzazo on 2025-02-10 17:00_

### Summary

Hi. We cannot get to install packages with uv in production environments when `VSS_NUGET_EXTERNAL_FEED_ENDPOINTS` env variable is set. UV fails to get authentication credentials because it queries a URL ending with the package name.

I thought [#11074](https://github.com/astral-sh/uv/pull/11074) would fix the problem. Probably related with [#4583](https://github.com/astral-sh/uv/issues/4583).

Failing logs:
```
[Verbose] [CredentialProvider]Running in stand-alone mode
[Verbose] [CredentialProvider]Command-line v1.2.3: /home/javier/.local/share/uv/tools/keyring/lib/python3.13/site-packages/artifacts_keyring/plugins/plugins/netcore/CredentialProvider.Microsoft/CredentialProvider.Microsoft.dll -Uri https://<...>/_packaging/<...>/pypi/simple/poetry-core/ -IsRetry False -NonInteractive False -CanShowDialog False -OutputFormat Json -Verbosity Verbose
[Verbose] [CredentialProvider]Handling auth request, Uri: https://<...>/_packaging/<...>/pypi/simple/poetry-core/, IsRetry: False, IsNonInteractive: False, CanShowDialog: False
[Verbose] [CredentialProvider]URI: https://<...>/_packaging/<...>/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]Using NuGetCredentialProvider.CredentialProviders.VstsBuildTaskServiceEndpoint.VstsBuildTaskServiceEndpointCredentialProvider to try to get credentials for https://<...>/_packaging/<...>/pypi/simple/poetry-core/.
[Verbose] [CredentialProvider]VstsBuildTaskServiceEndpointCredentialProvider - IsRetry: False
[Verbose] [CredentialProvider]Parsing json
[Verbose] [CredentialProvider]VstsBuildTaskServiceEndpointCredentialProvider - Environment variable VSS_NUGET_EXTERNAL_FEED_ENDPOINTS did not have credentials for endpoint https://<...>/_packaging/<...>/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]Failed to authenticate to https://<...>/_packaging/<...>/pypi/simple/poetry-core/ from your project collection
[Verbose] [CredentialProvider]VstsBuildTaskCredentialProvider - This credential provider must be run under the Team Build tasks for NuGet. Appropriate environment variables must be set.
[Verbose] [CredentialProvider]Skipping NuGetCredentialProvider.CredentialProviders.VstsBuildTask.VstsBuildTaskCredentialProvider, cannot provide credentials for https://<...>/_packaging/<...>/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]VstsCredentialProvider - This credential provider must not run if any build task environment variables are set. Variables: VSS_NUGET_URI_PREFIXES, VSS_NUGET_ACCESSTOKEN, VSS_NUGET_EXTERNAL_FEED_ENDPOINTS, ARTIFACTS_CREDENTIALPROVIDER_FEED_ENDPOINTS
[Verbose] [CredentialProvider]Skipping NuGetCredentialProvider.CredentialProviders.Vsts.VstsCredentialProvider, cannot provide credentials for https://<...>/_packaging/<...>/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]Unable to acquire credentials.
```

Index configuration in `pyproject.toml`:
```
[[tool.uv.index]]
url = "https://VssSessionToken@<...>/_packaging/<...>/pypi/simple/"
name = "mi"
default = true
```
Tried ending in `/` and without it in URL, but fails in both cases. Tagging @zanieb to continue discussion from previous thread. Thank you.

### Platform

Ubuntu 22.04

### Version

0.5.29

### Python version

3.12.3

---

_Label `bug` added by @jzazo on 2025-02-10 17:00_

---

_Comment by @zanieb on 2025-02-10 17:07_

This looks the same as https://github.com/astral-sh/uv/issues/11236

I continue to advocate for a change to the keyring backend, e.g., in https://github.com/microsoft/artifacts-credprovider, to support child URLs.

We can try to do something here but I'm not sure what yet.

---

_Label `registry` added by @zanieb on 2025-02-10 17:08_

---

_Referenced in [astral-sh/uv#11507](../../astral-sh/uv/issues/11507.md) on 2025-02-14 13:02_

---

_Comment by @zanieb on 2025-03-20 22:13_

This is also the same as #4056 

---

_Referenced in [astral-sh/uv#12651](../../astral-sh/uv/pulls/12651.md) on 2025-04-03 14:18_

---

_Assigned to @jtfmumm by @jtfmumm on 2025-04-11 08:13_

---

_Closed by @zanieb on 2025-04-29 21:37_

---
