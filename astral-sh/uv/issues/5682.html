<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--universal does not properly handle version differences on different platforms  - astral-sh/uv #5682</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--universal does not properly handle version differences on different platforms</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5682">#5682</a>
        opened by <a href="https://github.com/gokay05">@gokay05</a>
        on 2024-08-01 04:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gokay05">@gokay05</a></div>
            <div class="timeline-body"><p>I am using uv 0.2.32 to compile a requirements file, which I use to sync other devices. Some of the other devices are on other platforms, so I am using the --universal flag. However, it doesnt seem like the universal flag checks versions so even though I can compile without issues, I cannot install on the other end.</p>
<p>As a reproduction case, create a new folder and install onnxruntime on a Windows machine with:</p>
<pre><code>uv init
uv add onnxruntime
</code></pre>
<p>This currently installs onnxruntime version 1.18.1. Then create a requirements files with:</p>
<pre><code>uv pip compile --universal --output-file requirements.txt pyproject.toml
</code></pre>
<p>The file contains 1.18.1 as the version number.  Now try to install this package on a Linux machine:</p>
<pre><code>uv pip install  --requirement requirements.txt test
</code></pre>
<p>However, this results in the following error:</p>
<p>No solution found when resolving dependencies:
Because onnxruntime==1.18.1 has no wheels with a matching Python implementation tag and you require
onnxruntime==1.18.1, we can conclude that the requirements are unsatisfiable.</p>
<p>Not sure what the right solution ought to be here, but the handling should be on the compile side instead of install/sync side. It seems like the last Linux wheel for the package is 1.16.3, so it could compile to that or error out and say it cannot be compiled with the universal flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-08-01 07:18</div>
            <div class="timeline-body"><p>What exact OS and python version are you on, what does <code>ldd --version</code> say?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2024-08-01 10:51</div>
            <div class="timeline-body"><p>Does <code>--only-binary</code> make a difference in the resolution?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-08-01 14:36</div>
            <div class="timeline-body"><blockquote>
<p>uv pip install  --requirement requirements.txt test</p>
</blockquote>
<p>Is the &quot;test&quot; here a copy and paste error? Because that will definetly cause errors.</p>
<p><code>onnxruntime==1.18.1</code> is definetly available on Linux, I think you will need to provide more of the outputs such as the exact Python, the <code>requirements.txt</code>, and the verbose output of the <code>uv pip install </code> install command:</p>
<pre><code>$ uv venv
Using Python 3.11.8 interpreter at: .pyenv/versions/3.11.8/bin/python3
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate

$ uv pip install &quot;onnxruntime==1.18.1&quot;
Resolved 9 packages in 11ms
Prepared 9 packages in 1.72s
Installed 9 packages in 470ms
 + coloredlogs==15.0.1
 + flatbuffers==24.3.25
 + humanfriendly==10.0
 + mpmath==1.3.0
 + numpy==1.26.4
 + onnxruntime==1.18.1
 + packaging==24.1
 + protobuf==5.27.3
 + sympy==1.13.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gokay05">@gokay05</a> on 2024-08-01 18:24</div>
            <div class="timeline-body"><p>As <a href="https://github.com/notatallshaw">notatallshaw</a> mentioned, onnxruntime is available on Linux at 1.18.1. I am on an older version of Linux and Python, so it seems I can only handle up to a &quot;cp311-cp311-manylinux_2_26_x86_64&quot; wheel since my version of libc is 2.26. With 1.17.0, onnxruntime switched to using libc 2.27 which is why I could only install up tp 1.16.3.</p>
<p>So the resolution is correct for a general Linux machine, just not the one I am using. Since there seems to be nothing wrong with uv, I am closing the issue. Thanks for your help and keep up the good work!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @gokay05 on 2024-08-01 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-08-01 18:51</div>
            <div class="timeline-body"><p>One thing I do for my resolution is provide a constraint file that contains bounds that only I can know for my environment, e.g. a constraints.txt:</p>
<pre><code>onnxruntime &lt; 1.17.0 # Required for our Linux env which uses libc 2.26
</code></pre>
<p>And then:</p>
<pre><code>uv pip compile --constraint constraints.txt ...
</code></pre>
<p>I prefer this over directly adding to a requirements file as seperates my hard requirements from my known constraints (which may be on transativie dependencies as well as actual dependencies).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gokay05">@gokay05</a> on 2024-08-01 18:57</div>
            <div class="timeline-body"><p>Very useful!! Thanks for the tip <a href="https://github.com/notatallshaw">notatallshaw</a>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:53 UTC
    </footer>
</body>
</html>
