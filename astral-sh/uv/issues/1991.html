<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic optional dependencies not audited upon re-install - astral-sh/uv #1991</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Dynamic optional dependencies not audited upon re-install</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1991">#1991</a>
        opened by <a href="https://github.com/kendallbailey">@kendallbailey</a>
        on 2024-02-26 21:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kendallbailey">@kendallbailey</a></div>
            <div class="timeline-body"><p>uv version: 0.1.11
platform: Ubuntu 20.04, python 3.10</p>
<p>I have a <code>pyproject.toml</code> that uses dynamic optional dependencies</p>
<pre><code>[tool.setuptools.dynamic]
optional-dependencies.tests = {file = [&quot;reqs/test.txt&quot;]}
</code></pre>
<p>After an editable install using <code>uv</code>, and then editing the <code>reqs/test.txt</code> file, a re-install doesn't notice the changes in the optional dependencies the way <code>pip</code> does.  I have to <code>touch pyproject.toml</code> to convince <code>uv</code> to look at the dynamic optional dependencies and ensure the changes are applied to the environment. I'm used to doing <code>pip install -e &quot;.[tests]&quot;</code> after updating <code>test.txt</code>, but <code>uv pip install -e &quot;.[tests]&quot;</code> says &quot;Audited 1 package in 90ms&quot; and does not install the package(s) that were added to <code>test.txt</code>.</p>
<p>The above is a simplified example. In reality I have multiple optional dependencies, many of which involve multiple <code>.txt</code> files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 21:19</div>
            <div class="timeline-body"><p>This is mostly by design. We don't validate changes across the full environment. But you can pass <code>--reinstall</code> to force it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kendallbailey on 2024-02-26 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-02-26 22:28</div>
            <div class="timeline-body"><p>@charliermarsh would you reconsider this? Checking the timestamp of pyproject.toml makes sense except when some metadata is declared as dynamic, in which case it can be computed from other sources than pyproject.toml itself. This way you could have the fastest performance for fully static pyproject.toml, but keep a correct behaviour for those who need dynamic metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 23:08</div>
            <div class="timeline-body"><p>@sbidoul -- Yeah definitely open to reconsidering it, but how could we &quot;tell&quot; that some metadata is dynamic?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 23:08</div>
            <div class="timeline-body"><p>Oh, if you have the above in your <code>pyproject.toml</code>, does it in turn require that have you <code>dynamic = [&quot;dependencies&quot;]</code> set?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-02-26 23:11</div>
            <div class="timeline-body"><p>If there is a <code>[project]</code> table, yes, every dynamic metadata MUST be declared in <code>project.dynamic</code>. If there is no <code>[project]</code> table, everything is to be considered dynamic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2024-02-26 23:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 23:12</div>
            <div class="timeline-body"><p>That makes sense, we can probably support this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-26 23:13</div>
            <div class="timeline-body"><p>Or rather, we can support this, I just have to get through a few other things first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-02-26 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-26 23:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-28 01:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:02 UTC
    </footer>
</body>
</html>
