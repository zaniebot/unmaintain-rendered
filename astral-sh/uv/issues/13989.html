<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detect broken virtual environments when moved - astral-sh/uv #13989</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Detect broken virtual environments when moved</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13989">#13989</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-06-12 13:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 13:21</div>
            <div class="timeline-body"><blockquote>
<p>We can read the beginning of all entrypoints we created (through <code>entry_points.txt</code>) and if any of them points to a python interpreter that doesn't exist, we invalidate the environment. There are some details to be figured out around perf and where the scripts come from, e.g. we don't cover non-entrypoint scripts (I don't think we keep a record of <code>#!python</code> script we rewrote vs. script where the shebang was user-provided).</p>
<p>Another approach is recording the venv location (either <code>pyvenv.cfg</code> or a different file we create, iirc it's not recorded yet anywhere) and invalidating it if the original location and the current location aren't the same directory (usually, because the original location doesn't exist anymore, but we want to allow symlinks above the <code>.venv</code>).</p>
</blockquote>
<p><em>Originally posted by @konstin in <a href="https://github.com/astral-sh/uv/issues/13196#issuecomment-2849277210">#13196</a></em></p>
<p>In projects, we can invalidate and recreate these environments. In other contexts, we can improve our error messages or warn.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-06-12 13:30</div>
            <div class="timeline-body"><p>There's an existing issue for project environment invalidation</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/10895</li>
</ul>
<p>We should close that out when this is done too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2025-06-12 13:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:35:44 UTC
    </footer>
</body>
</html>
