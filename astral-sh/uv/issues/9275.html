<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignore irrelevant platform-specific packages during resolution - astral-sh/uv #9275</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ignore irrelevant platform-specific packages during resolution</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9275">#9275</a>
        opened by <a href="https://github.com/Vinno97">@Vinno97</a>
        on 2024-11-20 14:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Vinno97">@Vinno97</a></div>
            <div class="timeline-body"><p>Hi,</p>
<p>I&#x27;ve noticed that <code>uv</code>  still tries to resolve packages that are supposed to be irrelevant for the configured environment. I&#x27;m working on a server with a private registry where we don&#x27;t have Darwin packages. When I try to install <code>ipykernel</code>, however, I see it still tries to resolve a Darwin-specific package, which then fails as it isn&#x27;t available in our registry. Specifically, it&#x27;s about <code>appnope</code>, which is configured as <code>&#x27;appnope&gt;=0.1.2;platform_system==&quot;Darwin&quot;&#x27;</code> in ipykernel&#x27; s pyproject.toml.(https://github.com/ipython/ipykernel/blob/8c4901d691b1f309da3b80eefad5af13d7418185/pyproject.toml#L32C6-L32C13)</p>
<p>I&#x27;m using <code>uv</code> 0.5.2 on RHEL.</p>
<pre><code>[project]
name = &quot;test-project&quot;
version = &quot;0.1.0&quot;
description = &quot;My test project&quot;
readme = &quot;README.md&quot;

dependencies = [
    &quot;ipykernel ; sys_platform == &#x27;linux&#x27;&quot;
]

[tool.uv]
environments = [
    &quot;sys_platform == &#x27;linux&#x27;&quot;
]
</code></pre>
<pre><code>$ uv lock -v 2&gt;&amp;1 | grep Darwin
DEBUG Solving split (python_full_version == &#x27;3.10&#x27;and platform_system == &#x27;Darwin&#x27; and sys_platform == &#x27;linux&#x27;) ...
DEBUG Adding transitive dependency for ipykernel==x.x.x: appnope{platform_system == &#x27;Darwin&#x27;}*
DEBUG Adding transitive dependency for ipykernel==x.x.x: appnope{platform_system == &#x27;Darwin&#x27;}*
</code></pre>
<p>I think it might be related to <a href="https://github.com/astral-sh/uv/issues/9051">astral-sh/uv#9051</a>#issuecomment-2470334438</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 14:18</div>
            <div class="timeline-body"><p>You might want to add something like <code>platform_system == &quot;Linux&quot;</code> to <code>environments</code>? The system doesn&#x27;t know that <code>platform_system == &#x27;Darwin&#x27;</code> and <code>sys_platform == &#x27;linux&#x27;</code> are mutually exclusive -- there&#x27;s nothing in the spec that says they <em>have</em> to be, it&#x27;s just true in practice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vinno97">@Vinno97</a> on 2024-11-21 08:13</div>
            <div class="timeline-body"><p>Oh that&#x27;s interesting and, though annoying, quite logical. Using platform_system indeed works and this then isn&#x27;t a bug.</p>
<hr>
<p>If you think it&#x27;s worthwhile, I&#x27;d be willing to add a small note to your documentation about this, as it currently uses <code>sys_platform</code> exclusively. This would then not work if any of your dependencies, like <code>ipykernel</code> uses <code>platform_system</code> instead of <code>sys_platform</code>.</p>
<p><img src="https://github.com/user-attachments/assets/3de9881a-5928-40fe-b5ea-2ff038003498" alt="image"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-07 01:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-07 01:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:37 UTC
    </footer>
</body>
</html>
