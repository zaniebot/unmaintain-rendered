```yaml
number: 14411
title: Since 0.7.14, uv tries to write to .venv, even when frozen
type: issue
state: closed
author: dannystaple
labels:
  - bug
  - great writeup
assignees: []
created_at: 2025-07-02T09:06:49Z
updated_at: 2025-07-03T13:49:24Z
url: https://github.com/astral-sh/uv/issues/14411
synced_at: 2026-01-10T01:57:32Z
```

# Since 0.7.14, uv tries to write to .venv, even when frozen

---

_Issue opened by @dannystaple on 2025-07-02 09:06_

### Summary

As a best practice in running production facing containers, we run our built python containers with a security context preventing writing to root. While we provide a writeable /tmp, the .venv folder is definitely not writeable.

The container, built with uv, will have installed any depencies it needs during the build phase, and therefore should not be trying to write when `uv run` is installed.

We are running uv with:
```dockerfile
# enable uv to run without cache
ENV UV_NO_CACHE=true
ENV UV_FROZEN=true
```

In later versions, with that security context we will see the following:
```
error: Read-only file system (os error 30) at path "/app/.venv/.tmpbgoo4f"
```

This appears to be related to https://github.com/astral-sh/uv/pull/14153/files.

uv was not attempting to write to this location in 0.7.13 and prior versions.

Small dockerfile to reproduce this (the pyproject/lock file can be any):
```dockerfile
ARG UV_VERSION=0.7.17
FROM ghcr.io/astral-sh/uv:$UV_VERSION AS uv

FROM python:3.13-slim

COPY --from=uv /uv /uvx /bin/

WORKDIR /app

ARG USERNAME=app
ARG USER_UID=1000
ARG USER_GID=$USER_UID

# Create the user
RUN groupadd --gid $USER_GID $USERNAME \
    && useradd --uid $USER_UID --gid $USER_GID -m $USERNAME \
    && chown $USERNAME:$USERNAME /app

# define the user to run the application
USER $USERNAME

# enable uv to run without cache
ENV UV_NO_CACHE=true
ENV UV_FROZEN=true

COPY pyproject.toml uv.lock  /app/

# install dependencies
RUN uv sync

CMD ["uv", "run", "python", "--version"]
```

This can be built and run with:

```bash
export VERSION=17
docker build --build-arg UV_VERSION="0.7.${VERSION}" . -f uv-test.Dockerfile -t uv-test:${VERSION}
docker run --rm -it --read-only --tmpfs /tmp:rw uv-test:${VERSION}
```

This was tried with the range 13 through to 18. The error will be seen in any version 14 or later.

### Platform

docker ghcr.io/astral-sh/uv + python:3.13-slim

### Version

0.7.14, 15, 1,6 17, 18.

### Python version

3.13

---

_Label `bug` added by @dannystaple on 2025-07-02 09:06_

---

_Comment by @zanieb on 2025-07-02 14:18_

I believe this would be fixed by https://github.com/astral-sh/uv/pull/14404

Appreciate the clear reproduction! The issue here is that we added environment locking to prevent concurrency bugs. As a minor note `UV_FROZEN` doesn't guarantee we won't update the environment, you probably want `UV_NO_SYNC` as well.

---

_Label `great writeup` added by @zanieb on 2025-07-02 14:18_

---

_Referenced in [astral-sh/uv#14404](../../astral-sh/uv/pulls/14404.md) on 2025-07-02 17:49_

---

_Assigned to @charliermarsh by @charliermarsh on 2025-07-02 17:50_

---

_Closed by @charliermarsh on 2025-07-02 18:03_

---

_Comment by @dannystaple on 2025-07-03 13:49_

Awesome to see the turn around here. I've put the docker example into a gist at https://gist.github.com/dannystaple/3958c0f66731e1093e669b7aaf06699f, including the extra option from @zanieb . 

---

_Referenced in [docling-project/docling-serve#265](../../docling-project/docling-serve/issues/265.md) on 2025-07-09 13:54_

---
