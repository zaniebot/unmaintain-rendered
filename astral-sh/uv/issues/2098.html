<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prefer wheel over source packages when choosing between multiple indexes - astral-sh/uv #2098</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Prefer wheel over source packages when choosing between multiple indexes</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/2098">#2098</a>
        opened by <a href="https://github.com/andrey-klochkov-liftoff">@andrey-klochkov-liftoff</a>
        on 2024-03-01 02:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/andrey-klochkov-liftoff">@andrey-klochkov-liftoff</a> on 2024-03-01 02:34</div>
            <div class="timeline-body"><p>We build wheels for packages that only have a source package on pypi.org, and put them on our private pypi repo. We then do <code>pip install --index-url https://pypi.org/simple/ --extra-index-url https://private-repo/simple/</code>, and <code>pip</code> always chooses to install the wheel package if it's available in our repo.</p>
<p>There are two different related issues with using <code>uv pip install</code> in this mode.</p>
<p>First, if we pass <code>--index-url</code> and <code>--extra-index-url</code>, <code>uv</code> would always prefer the repo passed with <code>--index-url</code> (as explained in #2083), and so our repo contains an older version of the package only but we want to install a newer version from pypi.org, <code>uv</code> won't find it. If we instead pass both indexes using <code>--extra-index-url</code>, <code>uv</code> would work in this scenario but it will fail in the second (below).</p>
<p>The second scenario is that we have a wheel package in our private repo, and <code>pypi.org</code> only contains the source repo. Here <code>uv</code> for some reason attempts to install the source repo (and we don't want to), and there doesn't seem to be a way to make it pick the wheel. The only way is to pass our repo through the <code>--index-url</code> argument, but then we get the 1st scenario failing.</p>
<p>Sorry if this has been discussed before but I haven't found this exact issue (or a combination of two?) being discussed previously.</p>
<p>Thanks for such a great tool! I wish we could just switch to doing <code>uv pip install</code>, but these corner cases are blocking us from that for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-01 03:12</div>
            <div class="timeline-body"><p>Thanks for the clear issue!</p>
<p>One thing for clarity: in the most recent release, we switched the priority (per your link: https://github.com/astral-sh/uv/pull/2083).</p>
<p>So, as of the most recent release, if you provide <code>--index-url https://pypi.org/simple/ --extra-index-url https://private-repo/simple/</code>, <code>uv</code> will first look in <code>https://private-repo/simple/</code>; if the package exists, it will stop, and return those versions. If it doesn't, it will look in PyPI.</p>
<p>Unlike <code>pip</code>, we don't currently look in <em>both</em> indexes and merge the versions. We're considering making that change, but it also brings with it a bunch of security issues.</p>
<p>Based on that, my read of the above is:</p>
<ul>
<li>If you want to install a newer version from PyPI of a repo that exists in your private index -- we don't currently support that, since we'll never look in PyPI if a package exists in your private index. We may support it in the future.</li>
<li>On the second scenario: I'm not sure what this would be. uv will only look at one index. (Prior to the most recent release, it would look at PyPI, not your custom index; we just reversed that.)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-03-01 05:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andrey-klochkov-liftoff">@andrey-klochkov-liftoff</a> on 2024-03-01 18:24</div>
            <div class="timeline-body"><p>@charliermarsh ,
Thanks! Is there an issue that tracks the 1st change from your list that I can subscribe to?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:24 UTC
    </footer>
</body>
</html>
