<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` header does not include `--upgrade` - astral-sh/uv #9771</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip compile</code> header does not include <code>--upgrade</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9771">#9771</a>
        opened by <a href="https://github.com/karthiknadig">@karthiknadig</a>
        on 2024-12-10 12:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/karthiknadig">@karthiknadig</a> on 2024-12-10 12:09</div>
            <div class="timeline-body"><p><img src="https://github.com/user-attachments/assets/e9779236-22be-4676-8adf-c049209f0b21" alt="Image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-12-10 12:53</div>
            <div class="timeline-body"><p>I don't see the point of adding <code>--upgrade</code> to the header, since it doesn't make any difference to the final result.
Unless you have specific cases where including <code>--upgrade</code> results in different outcomes, adding it will only cause unnecessary file changes.</p>
<p>By the way, I'm not part of the uv team. I'm just expressing my personal opinion, so whether or not this feature request should be implemented is not up to me.</p>
<p>Edit:
pip-compile (pip-tools) also ignores <code>--upgrade</code>, so I think the lack of --upgrade in uv is intentional, not a mistake.
https://github.com/jazzband/pip-tools/blob/53309647980e2a4981db54c0033f98c61142de0b/piptools/utils.py#L51-L61</p>
<pre><code class="language-py">COMPILE_EXCLUDE_OPTIONS = {
    &quot;--dry-run&quot;,
    &quot;--quiet&quot;,
    &quot;--rebuild&quot;,
    &quot;--upgrade&quot;,
    &quot;--upgrade-package&quot;,
    &quot;--verbose&quot;,
    &quot;--cache-dir&quot;,
    &quot;--no-reuse-hashes&quot;,
    &quot;--no-config&quot;,
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-10 13:22</div>
            <div class="timeline-body"><p>Yeah, I believe this is intentional.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-12-10 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-10 15:17</div>
            <div class="timeline-body"><blockquote>
<p>Unless you have specific cases where including <code>--upgrade</code> results in different outcomes</p>
</blockquote>
<p>I don't have an opinion on including it / not including it, but there is a difference when an output file is specified and pre-populated. I found this a little confusing when first using <code>uv pip compile</code>, that it takes the contents of the output file as a starting solution and you need to explicitly call <code>--upgrade</code> to get a new solution.</p>
<p>E.g.</p>
<pre><code>$ echo &quot;pandas&quot; | uv pip compile --exclude-newer 2023-01-01 --python 3.11 -o requirements.txt --annotation-style line -
Resolved 5 packages in 17ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --exclude-newer 2023-01-01 --python 3.11 -o requirements.txt --annotation-style line -
numpy==1.24.1             # via pandas
pandas==1.5.2
python-dateutil==2.8.2    # via pandas
pytz==2022.7              # via pandas
six==1.16.0               # via python-dateutil

$ echo &quot;pandas&quot; | uv pip compile --python 3.11 -o requirements.txt --annotation-style line -
Resolved 5 packages in 11ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --python 3.11 -o requirements.txt --annotation-style line -
numpy==1.24.1             # via pandas
pandas==1.5.2
python-dateutil==2.8.2    # via pandas
pytz==2022.7              # via pandas
six==1.16.0               # via python-dateutil

$ echo &quot;pandas&quot; | uv pip compile --python 3.11 -o requirements.txt --annotation-style line --upgrade -
Resolved 6 packages in 141ms
# This file was autogenerated by uv via the following command:
#    uv pip compile --python 3.11 -o requirements.txt --annotation-style line -
numpy==2.2.0              # via pandas
pandas==2.2.3
python-dateutil==2.9.0.post0  # via pandas
pytz==2024.2              # via pandas
six==1.17.0               # via python-dateutil
tzdata==2024.2            # via pandas
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-10 15:18</div>
            <div class="timeline-body"><p>I would probably err on the side of removing <code>-o requirements.txt</code> from the header, actually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-10 15:21</div>
            <div class="timeline-body"><blockquote>
<p>I would probably err on the side of removing <code>-o requirements.txt</code> from the header, actually.</p>
</blockquote>
<p>Wouldn't that make it hard to reproduce the file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-10 15:25</div>
            <div class="timeline-body"><p>Hmm, well what's the value in including it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-10 15:27</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>I would probably err on the side of removing <code>-o requirements.txt</code> from the header, actually.</p>
</blockquote>
<p>Wouldn't that make it hard to reproduce the file?</p>
</blockquote>
<p>If the aim is to reproduce, and you have an output file, then you need to know if <code>--upgrade</code> was included or not...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-10 15:27</div>
            <div class="timeline-body"><p>So I can copy and paste the command :)</p>
<blockquote>
<p>If the aim is to reproduce, then you need to know if --upgrade was called or not...</p>
</blockquote>
<p>I don't think so — you'll reproduce it without <code>--upgrade</code>. <code>--upgrade</code> is for mutating the file. Right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-10 15:36</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>If the aim is to reproduce, then you need to know if --upgrade was called or not...</p>
</blockquote>
<p>I don't think so — you'll reproduce it without <code>--upgrade</code>. <code>--upgrade</code> is for mutating the file. Right?</p>
</blockquote>
<p>I'm not sure what you mean, <a href="https://github.com/astral-sh/uv/issues/9771#issuecomment-2531991498">as above</a> you get different results based on the contents of the output file and whether you call <code>--upgrade</code> or not.</p>
<p>If you want to be able to reproduce the same output with the same input, and the output file is an input (which is what I first found confusing about this command), then you need to know if <code>--upgrade</code> was called or not.</p>
<p>I guess the question is, what is the purpose of including the command? Copy and paste helper? Reproducibility? Copy pip-compile API? Or something else?</p>
<p>I do actually have to do a bit of work in my script that calls <code>uv pip compile</code> so the the <code>-o {OUTPUT_PATH}</code> always looks the same, so I would be happy to delete the few lines that do that logic, but I don't care that much.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:51 UTC
    </footer>
</body>
</html>
