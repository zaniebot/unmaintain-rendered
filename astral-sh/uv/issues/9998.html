<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fork-strategy requires-python produces unexpected results with repeated dependencies - astral-sh/uv #9998</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fork-strategy requires-python produces unexpected results with repeated dependencies</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9998">#9998</a>
        opened by <a href="https://github.com/alex">@alex</a>
        on 2024-12-18 13:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alex">@alex</a></div>
            <div class="timeline-body"><p>Hello!</p>
<p>I'm playing with using <code>fork-strategy</code> to replace our current <code>tool.uv.environments</code>, however it doesn't seem to be working due to some dependencies being repeated.</p>
<p>To reproduce:</p>
<pre><code>$ echo -e &quot;nox &gt;=2024.04.15\nnox[uv] &gt;=2024.03.02; python_version &gt;= '3.8'&quot; | uv pip compile --universal -p 3.7 -
</code></pre>
<p>If you look at the result, you'll see that there is a single version of <code>argcomplete==3.1.2</code>. However, what I'd expect to see is:</p>
<pre><code>argcomplete==3.1.2 ; python_full_version &lt; '3.8'
    # via nox
argcomplete==3.5.2 ; python_full_version &gt;= '3.8'
    # via nox
</code></pre>
<p>When I do a more minimal test (<code>echo 'nox' | uv pip compile --universal -p 3.7 -</code>), I see the expected behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @zanieb on 2024-12-18 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-12-18 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-18 15:34</div>
            <div class="timeline-body"><p>Thanks yeah, I see the issue here. It should be an easy fix, I'm just evaluating the fixture changes to make sure it's correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2024-12-18 16:08</div>
            <div class="timeline-body"><p>Great, thanks!</p>
<p>On Wed, Dec 18, 2024, 10:35â€¯AM Charlie Marsh <em><strong>@</strong></em>.***&gt;
wrote:</p>
<blockquote>
<p>Thanks yeah, I see the issue here. It should be an easy fix, I'm just
evaluating the fixture changes to make sure it's correct.</p>
<p>â€”
Reply to this email directly, view it on GitHub
<a href="https://github.com/astral-sh/uv/issues/9998#issuecomment-2551634752">https://github.com/astral-sh/uv/issues/9998#issuecomment-2551634752</a>, or
unsubscribe
<a href="https://github.com/notifications/unsubscribe-auth/AAAAGBGIXUJOIE22AFQ7TZT2GGI3RAVCNFSM6AAAAABT2WX35WVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDKNJRGYZTINZVGI">https://github.com/notifications/unsubscribe-auth/AAAAGBGIXUJOIE22AFQ7TZT2GGI3RAVCNFSM6AAAAABT2WX35WVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDKNJRGYZTINZVGI</a>
.
You are receiving this because you authored the thread.Message ID:
<em><strong>@</strong></em>.***&gt;</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-12-18 20:13</div>
            <div class="timeline-body"><p>FWIW, I was also going to report this, I was surprised to see no resolution difference between the two fork strategies when I threw very complex resolutions at them, but my resolutions were too complex to produce a useful MRE ðŸ˜°</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-18 21:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:57 UTC
    </footer>
</body>
</html>
