<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv lock branch dependency doesn't update commit hash on new commits - astral-sh/uv #4317</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv lock branch dependency doesn't update commit hash on new commits</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/4317">#4317</a>
        opened by <a href="https://github.com/blueraft">@blueraft</a>
        on 2024-06-13 20:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/blueraft">@blueraft</a> on 2024-06-13 20:12</div>
            <div class="timeline-body"><p>When pointing a package dependency to the main branch, I noticed a discrepancy in behavior between the <code>uv pip compile</code> lock file and the <code>uv lock</code> file. Specifically, if the main branch has new commits, <code>uv pip compile</code> updates the commit hash in the lock file. However, the uv lock file does not update the commit hash when there are new commits in the branch.</p>
<p>Is this the intended behavior for <code>uv lock</code>?</p>
<p>MRE:</p>
<ul>
<li>Copy the toml file.</li>
</ul>
<pre><code class="language-toml">[build-system]
requires = [&quot;setuptools&lt;69.3.0&quot;, &quot;setuptools-scm&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project]
name = 'foobar'
version = &quot;0.1&quot;
requires-python = &quot;&gt;=3.9&quot;

dependencies = [&quot;flask @ git+https://github.com/pallets/flask.git&quot;]
</code></pre>
<ul>
<li>Run <code>uv lock</code> and <code>uv pip compile</code>. Both lock files correctly point to the latest commit from Flask.</li>
</ul>
<pre><code class="language-sh">❯ rg &quot;git\+https&quot; requirements.txt
7:flask @ git+https://github.com/pallets/flask.git@d718ecf6d3dfc4656d262154c59672437c1ea075
❯ rg &quot;git\+https&quot; uv.lock
❯ rg &quot;git\+https&quot; uv.lock
40:source = &quot;git+https://github.com/pallets/flask.git#d718ecf6d3dfc4656d262154c59672437c1ea075&quot;
83:source = &quot;git+https://github.com/pallets/flask.git#d718ecf6d3dfc4656d262154c59672437c1ea075&quot;
</code></pre>
<ul>
<li>Replace the latest commit with an older commit.</li>
</ul>
<pre><code class="language-sh">❯ sed -i '' 's/d718ecf6d3dfc4656d262154c59672437c1ea075/0ce27278d234c13ce00019540ff8e9891542d1f2/g' requirements.txt
❯ sed -i '' 's/d718ecf6d3dfc4656d262154c59672437c1ea075/0ce27278d234c13ce00019540ff8e9891542d1f2/g' uv.lock
❯ rg &quot;git\+https&quot; requirements.txt
7:flask @ git+https://github.com/pallets/flask.git@0ce27278d234c13ce00019540ff8e9891542d1f2
❯ rg &quot;git\+https&quot; uv.lock
40:source = &quot;git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2&quot;
83:source = &quot;git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2&quot;
</code></pre>
<ul>
<li>Run <code>uv lock</code> and <code>uv pip compile</code> again.</li>
</ul>
<pre><code class="language-sh">❯ uv pip compile pyproject.toml -o requirements.txt -p 3.11
 Updated https://github.com/pallets/flask.git (d718ecf6)
Resolved 7 packages in 1.75s
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml -o requirements.txt -p 3.11
blinker==1.8.2
    # via flask
click==8.1.7
    # via flask
flask @ git+https://github.com/pallets/flask.git@d718ecf6d3dfc4656d262154c59672437c1ea075
    # via foobar (pyproject.toml)
itsdangerous==2.2.0
    # via flask
jinja2==3.1.4
    # via flask
markupsafe==2.1.5
    # via
    #   jinja2
    #   werkzeug
werkzeug==3.0.3
    # via flask
❯ uv lock -p 3.11
warning: `uv lock` is experimental and may change without warning.
Resolved 12 packages in 1.11s
❯ rg &quot;git\+https&quot; requirements.txt
7:flask @ git+https://github.com/pallets/flask.git@d718ecf6d3dfc4656d262154c59672437c1ea075
❯ rg &quot;git\+https&quot; uv.lock
40:source = &quot;git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2&quot;
83:source = &quot;git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2&quot;
</code></pre>
<ul>
<li>uv 0.2.11 (MacOS)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-06-13 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @zanieb on 2024-06-13 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 21:45</div>
            <div class="timeline-body"><p>Thanks! Sounds like a bug to me but we'll see what @BurntSushi and @charliermarsh say.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-13 21:53</div>
            <div class="timeline-body"><p>This is intended. You should pass the upgrade flag to update the locked version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-13 21:58</div>
            <div class="timeline-body"><p>Ah that makes sense to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2024-06-13 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-06-13 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-06-14 06:38</div>
            <div class="timeline-body"><p>Makes sense, <code>uv lock -P flask</code> works for me. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @blueraft on 2024-06-14 06:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14954.html">astral-sh/uv#14954</a> on 2025-07-29 13:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:20 UTC
    </footer>
</body>
</html>
