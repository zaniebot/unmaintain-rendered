<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should `uv sync` remove extraneous packages? - astral-sh/uv #4358</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should `uv sync` remove extraneous packages?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/4358">#4358</a>
        opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a>
        on 2024-06-17 15:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-06-17 15:56</div>
            <div class="timeline-body"><p><a href="https://github.com/astral-sh/uv/blob/67f1285ce3f00840e1833e4aa5a7e6480e94e489/crates/uv/src/commands/project/sync.rs#L191">It currently does not</a>, while <code>uv pip sync</code> does. This would also affect whether <code>uv remove</code> removes <em>all</em> extraneous packages, or has to do extra work to only remove the affected packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-17 17:00</div>
            <div class="timeline-body"><p>In brief, I think we should:</p>
<ol>
<li>Change sync to always remove extraneous packages. This is the common understanding on sync.</li>
<li>Implement an opt-out option for removal during sync, e.g. <code>--allow-extra-packages</code></li>
<li>Update <code>uv remove</code> to allow extraneous packages by default, only removing the relevant dependency tree</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @zanieb on 2024-06-17 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ibraheemdev by @ibraheemdev on 2024-06-17 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4366.html">astral-sh/uv#4366</a> on 2024-06-17 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-06-19 18:37</div>
            <div class="timeline-body"><p><code>uv sync</code> now removes extraneous packages by default, which you can opt-out with <code>--no-clean</code>.</p>
<p>Currently <code>uv add</code> and <code>uv run</code> do not ever remove from the environment, and so <code>uv remove</code> should, for consistency, only remove the affected packages. An alternative approach to 3 is to have all project commands, <code>uv run</code>, <code>uv add</code>, and <code>uv remove</code>, always clean the virtual environment, which would simplify things and doesn't seem necessarily problematic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-19 20:29</div>
            <div class="timeline-body"><p>I don't think they should always clean the virtual environment. I think it's too common for people to manually manage packages in Python and without an explicit sync it seems excessive for us to purge extraneous packages. Changing remove to be more clearly scoped by default seems like a more intuitive user experience.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-23 15:34</div>
            <div class="timeline-body"><blockquote>
<p>Update uv remove to allow extraneous packages by default, only removing the relevant dependency tree</p>
</blockquote>
<p>Does this mean: <code>uv remove foo</code> uninstalls <code>foo</code>, or uninstalls <code>foo</code> and its dependencies?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-09 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @ibraheemdev by @charliermarsh on 2024-08-09 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-10 18:54</div>
            <div class="timeline-body"><p>My current vote is that it uses the same semantics as <code>uv run</code>, and we add an <code>--exact</code> argument to enable exact syncing. But I would also be okay shipping with the current behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> removed by @zanieb on 2024-08-20 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2024-09-19 10:47</div>
            <div class="timeline-body"><blockquote>
<p>I think it's too common for people to manually manage packages in Python and without an explicit sync it seems excessive for us to purge extraneous packages.</p>
</blockquote>
<p>IIUC, uv's top level commands do some automations to keep your workspace in sync between lockfile, pyproject.toml and venv.
I think who wants manually manage packages could use low level commands, i.e. <code>uv pip uninstall</code> in this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-19 11:02</div>
            <div class="timeline-body"><p>I think we made a decision on this â€” we have a toggle now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-19 11:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aberres">@aberres</a> on 2024-10-11 12:34</div>
            <div class="timeline-body"><p>For anyone coming here after not finding the switch when looking at <code>--help</code>: It is called <code>--inexact</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7838.html">astral-sh/uv#7838</a> on 2024-11-13 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11937.html">astral-sh/uv#11937</a> on 2025-03-03 23:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:58 UTC
    </footer>
</body>
</html>
