<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install cudaq` fails first time perhaps due to dynamic install_requires - astral-sh/uv #12759</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip install cudaq</code> fails first time perhaps due to dynamic install_requires</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12759">#12759</a>
        opened by <a href="https://github.com/PhilReinhold">@PhilReinhold</a>
        on 2025-04-08 19:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/PhilReinhold">@PhilReinhold</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>In a fresh venv from <code>uv venv</code>.</p>
<pre><code>$ uv pip install cudaq
Resolved 1 package in 2ms
Installed 1 package in 1ms
 + cudaq==0.10.0

# missing all dependencies!
# Just run it twice though...

$ uv pip install cudaq
Resolved 24 packages in 9ms
Installed 23 packages in 69ms
 + astpretty==3.0.0
 + certifi==2025.1.31
 + charset-normalizer==3.4.1
 + cuda-quantum-cu12==0.10.0
 + cudensitymat-cu12==0.1.0
 + cupy-cuda12x==13.4.1
 + cuquantum-python-cu12==25.3.0
 + custatevec-cu12==1.8.0
 + cutensor-cu12==2.2.0
 + cutensornet-cu12==2.7.0
 + fastrlock==0.8.3
 + idna==3.10
 + numpy==2.2.4
 + nvidia-cublas-cu12==12.8.4.1
 + nvidia-cuda-nvrtc-cu12==12.8.93
 + nvidia-cuda-runtime-cu12==12.8.90
 + nvidia-curand-cu12==10.3.9.90
 + nvidia-cusolver-cu12==11.7.3.90
 + nvidia-cusparse-cu12==12.5.8.93
 + nvidia-nvjitlink-cu12==12.8.93
 + requests==2.32.3
 + scipy==1.15.2
 + urllib3==2.3.0
</code></pre>
<p>If I instead use regular <code>pip install</code> (with or without <code>--use-pep517</code>), it works the first time.</p>
<p>This appears to manifest in <code>uv add</code> as well, although I haven't tested as much there. I suspect this has something to do with the fact that <code>cudaq</code> only provides an sdist, with a <code>setup.py</code> that dynamically calculates <code>install_requires</code> based on environment, see https://github.com/NVIDIA/cuda-quantum/tree/main/python/metapackages.</p>
<h3>Platform</h3>
<p>Linux 6.1.119-129.201.amzn2023.x86_64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.5.20</p>
<h3>Python version</h3>
<p>Python 3.11.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @PhilReinhold on 2025-04-08 19:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-08 20:39</div>
            <div class="timeline-body"><p>Hmm, I think this is a problem with the package. If you look at the sdist's <code>PKG-INFO</code> file:</p>
<pre><code>Metadata-Version: 2.2
Name: cudaq
Version: 0.10.0
Summary: Python bindings for the CUDA-Q toolkit for heterogeneous quantum-classical workflows.
Author: NVIDIA Corporation &amp; Affiliates
Maintainer: NVIDIA Corporation &amp; Affiliates
License: Apache License Version 2.0
        
        Copyright (c) 2023 - 2025 NVIDIA Corporation &amp; Affiliates
        All rights reserved.
        
        Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
        you may not use this file except in compliance with the License.
        You may obtain a copy of the License at
        
            http://www.apache.org/licenses/LICENSE-2.0
        
        Unless required by applicable law or agreed to in writing, software
        distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        See the License for the specific language governing permissions and
        limitations under the License.
        
Project-URL: Homepage, https://developer.nvidia.com/cuda-q
Project-URL: Documentation, https://nvidia.github.io/cuda-quantum
Project-URL: Repository, https://github.com/NVIDIA/cuda-quantum
Project-URL: Releases, https://nvidia.github.io/cuda-quantum/latest/releases.html
Keywords: cudaq,cuda-quantum,cuda,quantum,quantum computing,nvidia,high-performance computing
Classifier: Intended Audience :: Science/Research
Classifier: Intended Audience :: Developers
Classifier: Programming Language :: Python
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Environment :: GPU :: NVIDIA CUDA
Classifier: Environment :: GPU :: NVIDIA CUDA :: 11
Classifier: Environment :: GPU :: NVIDIA CUDA :: 12
Classifier: Topic :: Software Development
Classifier: Topic :: Scientific/Engineering
Requires-Python: &gt;=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
License-File: NOTICE
License-File: CITATION.cff
Provides-Extra: chemistry
Requires-Dist: scipy==1.10.1; extra == &quot;chemistry&quot;
Requires-Dist: openfermionpyscf==0.5; extra == &quot;chemistry&quot;
Requires-Dist: h5py&lt;3.11; extra == &quot;chemistry&quot;
Provides-Extra: visualization
Requires-Dist: qutip&lt;5; extra == &quot;visualization&quot;
Requires-Dist: matplotlib&gt;=3.5; extra == &quot;visualization&quot;
</code></pre>
<p>It uses Metadata 2.2, so we are &quot;allowed&quot; to trust it. But it doens't include the dependencies. And it doesn't declare the <code>requires-dist</code> as dynamic.</p>
<p>After we build the wheel, subsequent invocations use the metdata from the built wheel, which <em>does</em> include the dependencies.</p>
<p>I think the source distribution should be marking its requirements as dynamic?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-04-08 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @charliermarsh on 2025-04-08 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-04-08 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ACE07-Sev">@ACE07-Sev</a> on 2025-11-16 09:56</div>
            <div class="timeline-body"><p>Question. I'm having this issue (I think) in my PR.
https://github.com/unitaryfoundation/mitiq/pull/2839</p>
<p>Anything I can do to get <code>cudaq</code> to install on the Ubuntu venv? It's a Linux x86 only wheel by the way, so won't work on macos nor windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-18 15:54</div>
            <div class="timeline-body"><p>You can use <a href="https://docs.astral.sh/uv/reference/settings/#dependency-metadata">https://docs.astral.sh/uv/reference/settings/#dependency-metadata</a> as escape hatch, but really it's something cudaq needs to fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lmondada">@lmondada</a> on 2025-11-19 16:57</div>
            <div class="timeline-body"><p>Thanks for reporting it. I'll see about fixing this in cudaq.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:52 UTC
    </footer>
</body>
</html>
