<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better sync API for groups with workspaces - astral-sh/uv #11537</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better sync API for groups with workspaces</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/11537">#11537</a>
        opened by <a href="https://github.com/xixixao">@xixixao</a>
        on 2025-02-15 15:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/xixixao">@xixixao</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>If I want to run tests for one workspace member, I'd like to use the following sync in CI:</p>
<pre><code>uv sync --all-extras --no-editable --no-dev --group test --package ${MEMBER}
</code></pre>
<p>ideally I want:</p>
<p>The root project to have <code>test</code> group with <code>pytest</code> in it.
The member to optionally have additional dependencies needed in its own <code>test</code> group only (but I don't have any use case for this atm).</p>
<p>The command</p>
<pre><code>uv sync --all-extras --no-editable --no-dev --group test --package ${MEMBER}
</code></pre>
<p>doesn't work because <code>test</code> is defined in root, but because I specified <code>--package</code>, the group I guess targets only groups in the member's <code>pyproject.toml</code>.</p>
<p>An alternative, less optimal solution I tried was:</p>
<pre><code>uv sync --all-extras --no-editable --no-dev --all-groups  --package ${MEMBER}
</code></pre>
<p>but this again doesn't work, because only the groups from the package, not from the root, are synced.</p>
<p>I don't think there's a way to target the groups in the root right now?</p>
<p>The workaround that does work right now is to copy the <code>test</code> group into each workspace member's <code>pyproject.toml</code>.</p>
<p>Side-note: I have spent a ton of time learning by trial and error what sync does. The options are documented at a very high level, but how their combinations work is not documented much at all. Maybe a sort of &quot;sync philosophy&quot; doc is missing. There's Locking and Syncing but that's really about Locking, not about Syncing.</p>
<p>Thanks as always for working on uv!</p>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @xixixao on 2025-02-15 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-02-15 18:02</div>
            <div class="timeline-body"><p>The Proposal:
<code>--group .[test]</code> where (<code>.</code>) tries to load group from current workspace.</p>
<p>when you do cd into package dir:
<code>--group ..[test]</code> where (<code>..</code>) tries to load group from parent dir.</p>
<p>Then <code>--all-groups</code> would accept optional values (default: <code>.</code>).</p>
<p>Using inter-packages group:
<code>uv sync --package member1 --group member2[test]</code> when run command at workspace root.</p>
<p>When not using these syntaxes, then current behavior will be applied.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xixixao">@xixixao</a> on 2025-02-15 18:35</div>
            <div class="timeline-body"><p>Note that currently when you do <code>--group typecheck</code>, but don't use <code>--package</code>, then all groups of that name are synced (from all members and from root).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2025-02-15 18:45</div>
            <div class="timeline-body"><blockquote>
<p>Note that currently when you do <code>--group typecheck</code>, but don't use <code>--package</code>, then all groups of that name are synced (from all members and from root).</p>
</blockquote>
<p>According to other current behaviors you mentioned above, IMO the expected behavior here is to not include them <em>implicitly</em>!</p>
<p>(Current behavior has <em>selective choose</em> between members that declared and not declared that group.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-20 22:49</div>
            <div class="timeline-body"><p>@Gankra this may be interesting to you. Maybe we should add some syntactic sugar for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-03-21 14:28</div>
            <div class="timeline-body"><p>Hmm yeah we're already doing a bit of logic like this in the <code>uv pip --group</code> stuff. Presumably the desired semantic here is to be similar to the pip approach where you're basically asking for <code>--only-group</code> from the workspace? (i.e. you don't want to sync the entire workspace, <em>just</em> that workspace-group and that package)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-21 15:56</div>
            <div class="timeline-body"><p>We're talking about workspace <em>packages</em> / members here not the workspace as a whole, I think.</p>
<p>Like <code>uv sync --group member_a:group_x</code>. I'm not sure about the semantics, i.e., if that member package is already being synced should we exclude it? (I don't think so). If not, should we include non-group dependencies? (I also don't think so).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xixixao">@xixixao</a> on 2025-12-04 19:56</div>
            <div class="timeline-body"><p>I still think this should be fixed. I consider <code>sync</code> to be core (kinda the point of) <code>uv</code>, so it ought to avoid these ambiguities.</p>
<p>I ran into it again with the group <code>docs</code>, and wanting to install one of the workspace members:</p>
<p>When I do</p>
<p><code>uv sync --all-extras --no-editable --no-dev --group docs --all-packages</code> then the group <code>docs</code> in the workspace root is installed, and all the workspace members are.</p>
<p>but when I do</p>
<p><code>uv sync --all-extras --no-editable --no-dev --group docs --package foo</code></p>
<p>the sync fails because I don't have a group docs in the workspace member <code>foo</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:56 UTC
    </footer>
</body>
</html>
