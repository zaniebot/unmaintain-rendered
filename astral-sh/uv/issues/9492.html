<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv tool install --force doesn't properly sync with local modifications - astral-sh/uv #9492</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv tool install --force doesn&#x27;t properly sync with local modifications</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9492">#9492</a>
        opened by <a href="https://github.com/CoderJoshDK">@CoderJoshDK</a>
        on 2024-11-28 03:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CoderJoshDK">@CoderJoshDK</a></div>
            <div class="timeline-body"><p>Using the command <code>uv tool install --force .</code>, doesn&#x27;t actually update tool with new changes.</p>
<pre><code>$ uv init fail --package &amp;&amp; cd fail &amp;&amp; uv tool install . --force
$ fail
Hello from fail!
</code></pre>
<p>From here, we will modify the print statement.</p>
<pre><code># src/fail/__init__.py
def main() -&gt; None:
    print(&quot;Hello from fail! Modification!&quot;)
</code></pre>
<p>And now we re-force install and run:</p>
<pre><code>$ uv tool install . --force
Resolved 1 package in 0.85ms
Uninstalled 1 package in 0.25ms
Installed 1 package in 1ms
 ~ fail==0.1.0 (from file:///home/josh/fail)
Installed 1 executable: fail
$ fail
Hello from fail!
$ uv run fail
Hello from fail! Modification!
</code></pre>
<p>As you can see, if I run <code>uv run fail</code>, it does output the expected updates.</p>
Verbose install
<p>

<pre><code>$ uv tool install . --force --verbose
DEBUG uv 0.5.5
DEBUG Searching for default Python interpreter in managed installations or search path
DEBUG Searching for managed installations at `/home/josh/.local/share/uv/python`
DEBUG Found `cpython-3.9.19-linux-aarch64-gnu` at `/usr/bin/python3` (search path)
DEBUG Using request timeout of 30s
DEBUG Found PEP 621 metadata for /home/josh/fail in `pyproject.toml` (fail)
DEBUG Acquired lock for `/home/josh/.local/share/uv/tools`
DEBUG Found existing environment for tool `fail`: /home/josh/.local/share/uv/tools/fail
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: fail @ file:///home/josh/fail
DEBUG No workspace root found, using project root
DEBUG Solving with installed Python version: 3.9.19
DEBUG Solving with target Python version: &gt;=3.9.19
DEBUG Adding direct dependency: fail*
DEBUG Searching for a compatible version of fail @ file:///home/josh/fail (*)
DEBUG Tried 1 versions: fail 1
DEBUG marker environment resolution took 0.000s
Resolved 1 package in 0.96ms
DEBUG Directory source requirement already cached: fail==0.1.0 (from file:///home/josh/fail)
DEBUG Uninstalled fail (10 files, 3 directories)
Uninstalled 1 package in 0.52ms
Installed 1 package in 3ms
 ~ fail==0.1.0 (from file:///home/josh/fail)
DEBUG Removing executable: `/home/josh/.local/bin/fail`
DEBUG Installing tool executables into: /home/josh/.local/bin
DEBUG Looking at `.dist-info` at: /home/josh/.local/share/uv/tools/fail/lib/python3.9/site-packages/fail-0.1.0.dist-info
DEBUG Installing executable: `fail`
Installed 1 executable: fail
DEBUG Adding receipt for tool `fail`
DEBUG Adding metadata entry for tool `fail` at /home/josh/.local/share/uv/tools/fail/uv-receipt.toml
DEBUG Released lock at `/home/josh/.local/share/uv/tools/.lock`
</code></pre>
</p>
 

<p>We can actually see that the bin is being updated! But for some reason ,,, it isn&#x27;t.</p>
File modifications
<p>

<pre><code>$ fail
Hello from fail!
[josh@uv fail]$ ls -al ~/.local/share/uv/tools/fail/bin/
total 56
drwxr-xr-x 1 josh josh  266 Nov 27 21:54 .
drwxr-xr-x 1 josh josh  116 Nov 27 21:51 ..
-rw-r--r-- 1 josh josh 3713 Nov 27 21:51 activate
-rw-r--r-- 1 josh josh 2269 Nov 27 21:51 activate.bat
-rw-r--r-- 1 josh josh 2620 Nov 27 21:51 activate.csh
-rw-r--r-- 1 josh josh 4184 Nov 27 21:51 activate.fish
-rw-r--r-- 1 josh josh 3869 Nov 27 21:51 activate.nu
-rw-r--r-- 1 josh josh 2762 Nov 27 21:51 activate.ps1
-rw-r--r-- 1 josh josh 2415 Nov 27 21:51 activate_this.py
-rw-r--r-- 1 josh josh 1728 Nov 27 21:51 deactivate.bat
-rwxr-xr-x 1 josh josh  236 Nov 27 21:54 fail
-rw-r--r-- 1 josh josh 1215 Nov 27 21:51 pydoc.bat
lrwxrwxrwx 1 josh josh   16 Nov 27 21:51 python -&gt; /usr/bin/python3
lrwxrwxrwx 1 josh josh    6 Nov 27 21:51 python3 -&gt; python
lrwxrwxrwx 1 josh josh    6 Nov 27 21:51 python3.9 -&gt; python
[josh@uv fail]$ uv tool install . --force
Resolved 1 package in 1ms
Uninstalled 1 package in 0.57ms
Installed 1 package in 4ms
 ~ fail==0.1.0 (from file:///home/josh/fail)
Installed 1 executable: fail
[josh@uv fail]$ ls -al ~/.local/share/uv/tools/fail/bin/
total 56
drwxr-xr-x 1 josh josh  266 Nov 27 21:56 .
drwxr-xr-x 1 josh josh  116 Nov 27 21:51 ..
-rw-r--r-- 1 josh josh 3713 Nov 27 21:51 activate
-rw-r--r-- 1 josh josh 2269 Nov 27 21:51 activate.bat
-rw-r--r-- 1 josh josh 2620 Nov 27 21:51 activate.csh
-rw-r--r-- 1 josh josh 4184 Nov 27 21:51 activate.fish
-rw-r--r-- 1 josh josh 3869 Nov 27 21:51 activate.nu
-rw-r--r-- 1 josh josh 2762 Nov 27 21:51 activate.ps1
-rw-r--r-- 1 josh josh 2415 Nov 27 21:51 activate_this.py
-rw-r--r-- 1 josh josh 1728 Nov 27 21:51 deactivate.bat
-rwxr-xr-x 1 josh josh  236 Nov 27 21:56 fail
-rw-r--r-- 1 josh josh 1215 Nov 27 21:51 pydoc.bat
lrwxrwxrwx 1 josh josh   16 Nov 27 21:51 python -&gt; /usr/bin/python3
lrwxrwxrwx 1 josh josh    6 Nov 27 21:51 python3 -&gt; python
lrwxrwxrwx 1 josh josh    6 Nov 27 21:51 python3.9 -&gt; python
[josh@uv fail]$ fail
Hello from fail!
[josh@uv fail]$ uv run fail
Hello from fail! Modification!
</code></pre>
</p>
 

Same as above but less noise
<p>

<pre><code>$ fail
Hello from fail!

$ ls -al ~/.local/share/uv/tools/fail/bin/
drwxr-xr-x 1 josh josh  266 Nov 27 21:54 .
-rwxr-xr-x 1 josh josh  236 Nov 27 21:54 fail

$ uv tool install . --force
 ~ fail==0.1.0 (from file:///home/josh/fail)
Installed 1 executable: fail

$ ls -al ~/.local/share/uv/tools/fail/bin/
drwxr-xr-x 1 josh josh  266 Nov 27 21:56 .
-rwxr-xr-x 1 josh josh  236 Nov 27 21:56 fail

$ fail
Hello from fail!

$ uv run fail
Hello from fail! Modification!
</code></pre>
</p>
 

<p>So everything is giving the appearance of updating, and yet it isn&#x27;t.</p>
<p>Oh ,,, and sorry if the name of the package sounds passive aggressive. I only realized that it might sound that way after I wrote all of this ... I actually am super appreciative of all the work you guys have done! Thank you again!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/powercoconola">@powercoconola</a> on 2024-11-28 04:42</div>
            <div class="timeline-body"><p>Just curious, does this work?</p>
<pre><code>uv tool install . --reinstall
</code></pre>
<blockquote>
<p>Reinstall all packages, regardless of whether theyâ€™re already installed. Implies --refresh</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/powercoconola">@powercoconola</a> on 2024-11-28 04:51</div>
            <div class="timeline-body"><p>From the documentation it seems <code>--force</code> doesn&#x27;t do what you think it does.</p>
<blockquote>
<p>Will replace any existing entry points with the same name in the executable directory.</p>
</blockquote>
<p>I think it&#x27;s just replacing the entrypoint (in the <code>/bin</code> directory) but not the <code>.py</code> files.</p>
<p>Additionally, your file structure seems a bit odd to me as well. I think the <code>/bin</code> directory is not supposed to be in the same directory where the tool <code>Scripts</code> and <code>Lib</code> are installed. I&#x27;m not familiar with Linux and <code>uv</code> though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pnasrat">@pnasrat</a> on 2024-11-28 11:44</div>
            <div class="timeline-body"><p>According to this PR force should imply reinstall package but as the reproducer here shows its not working as intended</p>
<p>https://github.com/astral-sh/uv/commit/b642dd92875456a175fe09d912a918d99db2ae27</p>
<p>Looking at the log output while the settings are being populated the difference I see with reinstall is rather than</p>
<p>I think that if force is set similar to <code>target.is_latest</code> it probably want to set the cache with refresh around line 93</p>
<pre><code>let cache  = if force | target.is_latest() {
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CoderJoshDK">@CoderJoshDK</a> on 2024-11-28 12:01</div>
            <div class="timeline-body"><blockquote>
<p>From the documentation it seems --force doesn&#x27;t do what you think it does.</p>
</blockquote>
<p><code>--force</code> was recently updated (the commit linked above). But it seems this change in behavior should be reflected in the docs too.</p>
<blockquote>
<p>Additionally, your file structure seems a bit odd to me as well.</p>
</blockquote>
<p><code>uv tool</code> interacts with 2 locations. There is the <code>bin</code> and then the <code>tool</code> dir, where the bin just symlinks to the tool&#x27;s bin. <code>--force</code> updates both that link and reinstalls the package:</p>
<pre><code>$ ls -l ~/.local/bin/fail
lrwxrwxrwx 1 josh josh 46 Nov 28 06:54 /home/josh/.local/bin/fail -&gt; /home/josh/.local/share/uv/tools/fail/bin/fail
</code></pre>
<blockquote>
<p>Just curious, does this work?</p>
<pre><code>uv tool install . --reinstall
</code></pre>
</blockquote>
<p>Well yes, but I don&#x27;t want to use <code>--reinstall</code>. <code>--reinstall-package</code> should be enough (implied by <code>--force</code>. In practice, I have expensive to install dependencies and want to make this command as lightweight as possible. But it is good to note and add, that running the full fat <code>--reinstall</code> does have the expected behvior.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:49 UTC
    </footer>
</body>
</html>
