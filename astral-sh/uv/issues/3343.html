<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv pip compile skips optional dependencies - astral-sh/uv #3343</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv pip compile skips optional dependencies</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3343">#3343</a>
        opened by <a href="https://github.com/nmichlo">@nmichlo</a>
        on 2024-05-03 11:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nmichlo">@nmichlo</a> on 2024-05-03 11:38</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Create <code>r.txt</code></p>
<pre><code>qdrant-client~=1.6.1
</code></pre>
<p><strong>uv</strong>:</p>
<p>Now compile:</p>
<pre><code>uv pip compile r.txt
</code></pre>
<p>Gives:</p>
<pre><code># This file was autogenerated by uv via the following command:
#    uv pip compile r.txt
annotated-types==0.6.0
    # via pydantic
anyio==4.3.0
    # via httpx
certifi==2024.2.2
    # via
    #   httpcore
    #   httpx
exceptiongroup==1.2.1
    # via anyio
grpcio==1.63.0
    # via
    #   grpcio-tools
    #   qdrant-client
grpcio-tools==1.63.0
    # via qdrant-client
h11==0.14.0
    # via httpcore
h2==4.1.0
    # via httpx
hpack==4.0.0
    # via h2
httpcore==1.0.5
    # via httpx
httpx==0.27.0
    # via qdrant-client
hyperframe==6.0.1
    # via h2
idna==3.7
    # via
    #   anyio
    #   httpx
numpy==1.26.4
    # via qdrant-client
portalocker==2.8.2
    # via qdrant-client
protobuf==5.26.1
    # via grpcio-tools
pydantic==2.7.1
    # via qdrant-client
pydantic-core==2.18.2
    # via pydantic
qdrant-client==1.6.9
setuptools==69.5.1
    # via grpcio-tools
sniffio==1.3.1
    # via
    #   anyio
    #   httpx
typing-extensions==4.11.0
    # via
    #   anyio
    #   pydantic
    #   pydantic-core
urllib3==1.26.18
    # via qdrant-client
</code></pre>
<p>The important difference to look for is <code>httpx==0.27.0</code></p>
<p><strong>pip-tools v7</strong>:</p>
<p>Compare this to <code>pip-tools</code></p>
<pre><code>pip-compile r.txt -o out.txt
</code></pre>
<p>Output</p>
<pre><code>#
# This file is autogenerated by pip-compile with Python 3.9
# by the following command:
#
#    pip-compile --output-file=out.txt r.txt
#
annotated-types==0.6.0
    # via pydantic
anyio==4.3.0
    # via httpx
certifi==2024.2.2
    # via
    #   httpcore
    #   httpx
exceptiongroup==1.2.1
    # via anyio
grpcio==1.63.0
    # via
    #   grpcio-tools
    #   qdrant-client
grpcio-tools==1.63.0
    # via qdrant-client
h11==0.14.0
    # via httpcore
h2==4.1.0
    # via httpx
hpack==4.0.0
    # via h2
httpcore==1.0.5
    # via httpx
httpx[http2]==0.27.0
    # via qdrant-client
hyperframe==6.0.1
    # via h2
idna==3.7
    # via
    #   anyio
    #   httpx
numpy==1.26.4
    # via qdrant-client
portalocker==2.8.2
    # via qdrant-client
protobuf==5.26.1
    # via grpcio-tools
pydantic==2.7.1
    # via qdrant-client
pydantic-core==2.18.2
    # via pydantic
qdrant-client==1.6.9
    # via -r r.txt
sniffio==1.3.1
    # via
    #   anyio
    #   httpx
typing-extensions==4.11.0
    # via
    #   anyio
    #   pydantic
    #   pydantic-core
urllib3==1.26.18
    # via qdrant-client

# The following packages are considered to be unsafe in a requirements file:
# setuptools
</code></pre>
<p>The important difference to look for is <code>httpx[http2]==0.27.0</code></p>
<p>ALTHOUGH, in version <code>v8</code> the <code>--strip-extras</code> flag is being added which can remove this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-03 13:15</div>
            <div class="timeline-body"><p>Hi looks like a duplicate of https://github.com/astral-sh/uv/issues/2163 â€” the default behavior is changing in pip-tools to match ours. You can use <code>--no-strip-extras</code> if you want it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-05-03 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-05-03 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-05-03 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nmichlo">@nmichlo</a> on 2024-05-07 18:53</div>
            <div class="timeline-body"><p>Oops, thank you! Didn't realise that <code>--no-strip-extras</code> was already added.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:27 UTC
    </footer>
</body>
</html>
