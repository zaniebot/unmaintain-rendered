<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv python find` does not detect venv Python in CPython 3.13t - astral-sh/uv #16428</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv python find` does not detect venv Python in CPython 3.13t</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16428">#16428</a>
        opened by <a href="https://github.com/lmmx">@lmmx</a>
        on 2025-10-24 01:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/lmmx">@lmmx</a> on 2025-10-24 01:25</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I tried removing all aspects of this and could not find any confounding factors so I think it's a real bug.</p>
<p>I isolated a bug using a CI workflow that appears to show CPython 3.13t, 3.14t not picking up the venv in the way expected via the <code>uv python find</code> API after <code>uv sync</code> in an immediately prior step in the same job</p>
<ul>
<li><strong>edit</strong> originally I thought this was other versions, later clarified only 3.13t, 3.14t</li>
</ul>
<p>I echoed the python it found and it was <code>/usr/bin/python3</code></p>
<p>My understanding it is best practice to use <code>uv python find</code> over just directly referencing <code>.venv/bin/python</code></p>
<ul>
<li>I used v6 of the <code>astral-sh/setup-uv</code> Action here but I then bumped to v7 and it didn't heal so it's not that</li>
<li>I removed Swatinem/rust-cache and the mold linker and didn't heal so not that</li>
<li>The error said maturin not found but I could call maturin in <code>.venv/bin</code> directly so not that</li>
<li>I turned off the <code>with_cache</code> in the setup uv action step but not that</li>
<li>I tried passing <code>--directory .venv</code> to hint to look in there but same as without so not that</li>
</ul>
<p>CI run link: https://github.com/lmmx/comrak/actions/runs/18766098367/job/53541371018?pr=28</p>
<details>
<summary>üìù Click to show CI logs</summary>

<pre><code>
Run uv sync --only-group build --only-group test
  uv sync --only-group build --only-group test
  shell: /usr/bin/bash -e {0}
  env:
    UV_PYTHON: 3.13t
    UV_CACHE_DIR: /home/runner/work/_temp/setup-uv-cache
    CARGO_HOME: /home/runner/.cargo
    CARGO_INCREMENTAL: 0
    CARGO_TERM_COLOR: always
Downloading cpython-3.13.9+freethreaded-linux-x86_64-gnu (download) (110.5MiB)
 Downloading cpython-3.13.9+freethreaded-linux-x86_64-gnu (download)
Using CPython 3.13.9
Creating virtual environment at: .venv
Resolved 59 packages in 130ms
Downloading maturin (8.2MiB)
Downloading pygments (1.2MiB)
Downloading pillow (4.2MiB)
 Downloading maturin
 Downloading pillow
 Downloading pygments
Prepared 10 packages in 176ms
Installed 10 packages in 21ms
 + iniconfig==2.3.0
 + maturin==1.9.6
 + packaging==24.2
 + patchelf==0.17.2.4
 + pillow==11.0.0
 + pluggy==1.6.0
 + py-cpuinfo==9.0.0
 + pygments==2.19.1
 + pytest==8.4.0
 + pytest-benchmark==5.0.0
0s
Run VENV_PYTHON=$(uv python find --directory .venv)
  VENV_PYTHON=$(uv python find --directory .venv)
  echo &quot;VENV_PYTHON: $VENV_PYTHON&quot;
  $VENV_PYTHON -m maturin develop --uv
  shell: /usr/bin/bash -e {0}
  env:
    UV_PYTHON: 3.13t
    UV_CACHE_DIR: /home/runner/work/_temp/setup-uv-cache
    CARGO_HOME: /home/runner/.cargo
    CARGO_INCREMENTAL: 0
    CARGO_TERM_COLOR: always
VENV_PYTHON: /usr/bin/python3
/usr/bin/python3: No module named maturin
Error: Process completed with exit code 1.
</code></pre>
</details>

<p>The workflow file is available on the job logs <a href="https://github.com/lmmx/comrak/actions/runs/18766098367/workflow?pr=28">here</a> and also attached here:</p>
<details>
<summary>üóÉÔ∏è Click to show CI workflow</summary>

<pre><code class="language-yaml">name: Test

on:
  push:
    branches:
      - master
  pull_request:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref_name }}-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true

jobs:
  get-python-versions:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      python-versions: ${{ steps.get-versions.outputs.python-versions }}
    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v6

      - name: Get Python versions from uv
        id: get-versions
        run: |
          MIN_VERSION=$(uvx --from=toml-cli toml get --toml-path=pyproject.toml project.requires-python | sed 's/&gt;=//;s/&quot;//g')
          versions=$(uv python list --all-versions --output-format json | jq -c --arg min &quot;$MIN_VERSION&quot; '
            ($min | split(&quot;.&quot;) | {major: .[0]|tonumber, minor: .[1]|tonumber}) as $minv |
            [.[] | {v:.version_parts, t:.variant}]
            | unique_by([.v.minor,.t])
            | map(select(.v.major &gt; $minv.major or (.v.major == $minv.major and .v.minor &gt;= $minv.minor)))
            | map(&quot;\(.v.major).\(.v.minor)\(if .t==&quot;freethreaded&quot; then &quot;t&quot; else &quot;&quot; end)&quot;)')
          echo &quot;python-versions=$versions&quot; &gt;&gt; $GITHUB_OUTPUT
  test:
    needs: get-python-versions
    runs-on: ubuntu-latest
    timeout-minutes: 10
    strategy:
      fail-fast: false
      matrix:
        python-version: ${{ fromJson(needs.get-python-versions.outputs.python-versions) }}
    steps:
      - uses: actions/checkout@v4

      # - name: Set up mold linker
      #   uses: rui314/setup-mold@v1

      # - uses: Swatinem/rust-cache@v2.8.1

      - name: Install uv
        uses: astral-sh/setup-uv@v6
        with:
          enable-cache: false # true
          python-version: ${{ matrix.python-version }}

      - name: Set up Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Sync build and test dependencies
        run: uv sync --only-group build --only-group test

      - name: Build extension
        run: |
          VENV_PYTHON=$(uv python find --directory .venv)
          echo &quot;VENV_PYTHON: $VENV_PYTHON&quot;
          $VENV_PYTHON -m maturin develop --uv
      - name: Run tests
        run: $(uv python find) -m pytest tests/ -v
</code></pre>
</details>

<h3>Platform</h3>
<p>ubuntu-latest</p>
<h3>Version</h3>
<p>0.9.5</p>
<h3>Python version</h3>
<p>3.13t (also on: 3.14t)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @lmmx on 2025-10-24 01:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-24 03:45</div>
            <div class="timeline-body"><p>Can you share verbose logs for <code>uv python find</code>? e.g., <code>uv python find -vv</code>?</p>
<p>Separately, if your goal is to invoke Python in a virtual environment, I'd use <code>uv run python</code> instead. You can also use <code>uv run -m</code> directly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lmmx">@lmmx</a> on 2025-10-24 08:22</div>
            <div class="timeline-body"><blockquote>
<p>Can you share verbose logs for <code>uv python find</code>? e.g., <code>uv python find -vv</code>?</p>
</blockquote>
<p>So this now <strong>only</strong> fails with the free-threaded pythons</p>
<ul>
<li>I tried removing source .venv/bin/activate and it has the same result</li>
<li>I now see 3.14 (not <code>t</code>) working normally, so I think that must have been a separate failure, not related.</li>
</ul>
<details>
<summary> üì∏ Click to show screenshot</summary>

<p><img src="https://github.com/user-attachments/assets/c2ae91f7-2533-459f-bd51-7b34f7a74311" alt="Image" /></p>
</details>

<details>
<summary>üìù Click to show verbose output</summary>

<pre><code>Run source .venv/bin/activate
  source .venv/bin/activate
  echo &quot;-- uv python find VERBOSE DEBUG&quot;
  uv python find -vv
  echo &quot;-- END OF uv python find DEBUG&quot;
  $(uv python find) -m maturin develop --uv
  shell: /usr/bin/bash -e {0}
  env:
    CACHE_ON_FAILURE: false
    CARGO_INCREMENTAL: 0
    UV_PYTHON_INSTALL_DIR: /home/runner/work/_temp/uv-python-dir
    UV_PYTHON: 3.13t
    CARGO_HOME: /home/runner/.cargo
    CARGO_TERM_COLOR: always
-- uv python find VERBOSE DEBUG
DEBUG uv 0.9.5
TRACE Checking shared lock for `/home/runner/.cache/uv` at `/home/runner/.cache/uv/.lock`
DEBUG Acquired shared lock for `/home/runner/.cache/uv`
DEBUG Found project root: `/home/runner/work/comrak/comrak`
DEBUG No workspace root found, using project root
DEBUG No Python version file found in workspace: /home/runner/work/comrak/comrak
DEBUG Using Python request `&gt;=3.9` from `requires-python` metadata
DEBUG Searching for Python &gt;=3.9 in virtual environments, managed installations, or search path
TRACE Querying interpreter executable at /home/runner/work/comrak/comrak/.venv/bin/python3
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3` (active virtual environment)
DEBUG Skipping interpreter at `.venv/bin/python3` from active virtual environment: does not satisfy request `&gt;=3.9`
TRACE Found cached interpreter info for Python 3.13.9, skipping query of: .venv/bin/python3
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3` (virtual environment)
DEBUG Skipping interpreter at `.venv/bin/python3` from virtual environment: does not satisfy request `&gt;=3.9`
DEBUG Searching for managed installations at `/home/runner/work/_temp/uv-python-dir`
TRACE Found `ld` path: /lib64/ld-linux-x86-64.so.2
TRACE stdout output from `ld`: &quot;&quot;
TRACE stderr output from `ld`: &quot;/lib64/ld-linux-x86-64.so.2: missing program name\nTry '/lib64/ld-linux-x86-64.so.2 --help' for more information.\n&quot;
TRACE Tried to find musl version by running `&quot;/lib64/ld-linux-x86-64.so.2&quot;`, but failed: Could not find musl version in output of: `/lib64/ld-linux-x86-64.so.2`
TRACE Tried to find libc version from possible symlink at &quot;/lib64/ld-linux-x86-64.so.2&quot;, but failed: Failed to find glibc version in the filename of linker: `../lib/x86_64-linux-gnu/ld-linux-x86-64.so.2`
TRACE stdout output from `ld.so --version`: &quot;ld.so (Ubuntu GLIBC 2.39-0ubuntu8.6) stable release version 2.39.\nCopyright (C) 2024 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE.\n&quot;
TRACE Found manylinux 2.39 in stdout of ld.so version
DEBUG Found managed installation `cpython-3.13.9+freethreaded-linux-x86_64-gnu`
TRACE Found cached interpreter info for Python 3.13.9, skipping query of: /home/runner/work/_temp/uv-python-dir/cpython-3.13.9+freethreaded-linux-x86_64-gnu/bin/python3.13t
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/_temp/uv-python-dir/cpython-3.13.9+freethreaded-linux-x86_64-gnu/bin/python3.13t` (managed installations)
DEBUG Skipping interpreter at `/home/runner/work/_temp/uv-python-dir/cpython-3.13.9+freethreaded-linux-x86_64-gnu/bin/python3.13t` from managed installations: does not satisfy request `&gt;=3.9`
TRACE Searching PATH for executables: python3, python
TRACE Checking `PATH` directory for interpreters: /home/runner/work/comrak/comrak/.venv/bin
TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python3
TRACE Found cached interpreter info for Python 3.13.9, skipping query of: .venv/bin/python3
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3` (first executable in the search path)
DEBUG Skipping interpreter at `.venv/bin/python3` from first executable in the search path: does not satisfy request `&gt;=3.9`
TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python
TRACE Querying interpreter executable at /home/runner/work/comrak/comrak/.venv/bin/python
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python` (search path)
DEBUG Skipping interpreter at `.venv/bin/python` from search path: does not satisfy request `&gt;=3.9`
TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python3.13
TRACE Querying interpreter executable at /home/runner/work/comrak/comrak/.venv/bin/python3.13
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3.13` (search path)
DEBUG Skipping interpreter at `.venv/bin/python3.13` from search path: does not satisfy request `&gt;=3.9`
TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python3.13t
TRACE Querying interpreter executable at /home/runner/work/comrak/comrak/.venv/bin/python3.13t
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3.13t` (search path)
DEBUG Skipping interpreter at `.venv/bin/python3.13t` from search path: does not satisfy request `&gt;=3.9`
TRACE Checking `PATH` directory for interpreters: /home/runner/work/_temp/uv-python-dir
TRACE Checking `PATH` directory for interpreters: /opt/hostedtoolcache/uv/0.9.5/x86_64
TRACE Checking `PATH` directory for interpreters: /opt/pipx_bin
TRACE Checking `PATH` directory for interpreters: /home/runner/.cargo/bin
TRACE Checking `PATH` directory for interpreters: /usr/local/.ghcup/bin
TRACE Checking `PATH` directory for interpreters: /home/runner/.dotnet/tools
TRACE Checking `PATH` directory for interpreters: /usr/local/sbin
TRACE Checking `PATH` directory for interpreters: /usr/local/bin
TRACE Checking `PATH` directory for interpreters: /usr/sbin
TRACE Checking `PATH` directory for interpreters: /usr/bin
TRACE Found possible Python executable: /usr/bin/python3
TRACE Found cached interpreter info for Python 3.12.3, skipping query of: /usr/bin/python3
/usr/bin/python3
DEBUG Found `cpython-3.12.3-linux-x86_64-gnu` at `/usr/bin/python3` (search path)
DEBUG Released lock at `/home/runner/.cache/uv/.lock`
-- END OF uv python find DEBUG
/usr/bin/python3: No module named maturin
</code></pre>
</details>

<p>It seems to reject it!</p>
<ul>
<li>First as python3</li>
</ul>
<pre><code class="language-sh">TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python3
TRACE Found cached interpreter info for Python 3.13.9, skipping query of: .venv/bin/python3
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3` (first executable in the search path)
DEBUG Skipping interpreter at `.venv/bin/python3` from first executable in the search path: does not satisfy request `&gt;=3.9`
</code></pre>
<ul>
<li>Then as python</li>
</ul>
<pre><code class="language-sh">TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python
TRACE Querying interpreter executable at /home/runner/work/comrak/comrak/.venv/bin/python
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python` (search path)
DEBUG Skipping interpreter at `.venv/bin/python` from search path: does not satisfy request `&gt;=3.9`
</code></pre>
<ul>
<li>Then as python13</li>
</ul>
<pre><code class="language-sh">TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python3.13
TRACE Querying interpreter executable at /home/runner/work/comrak/comrak/.venv/bin/python3.13
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3.13` (search path)
DEBUG Skipping interpreter at `.venv/bin/python3.13` from search path: does not satisfy request `&gt;=3.9`
</code></pre>
<ul>
<li>Then as python13t</li>
</ul>
<pre><code class="language-sh">TRACE Found possible Python executable: /home/runner/work/comrak/comrak/.venv/bin/python3.13t
TRACE Querying interpreter executable at /home/runner/work/comrak/comrak/.venv/bin/python3.13t
DEBUG Found `cpython-3.13.9+freethreaded-linux-x86_64-gnu` at `/home/runner/work/comrak/comrak/.venv/bin/python3.13t` (search path)
DEBUG Skipping interpreter at `.venv/bin/python3.13t` from search path: does not satisfy request `&gt;=3.9`
</code></pre>
<blockquote>
<p>Separately, if your goal is to invoke Python in a virtual environment, I'd use <code>uv run python</code> instead. You can also use <code>uv run -m</code> directly.</p>
</blockquote>
<p>I thought that was the one that pulls the dependency at call time not uses the venv one?</p>
<p>I want to ensure I am using the exactly right version in CI (in this case a free-threaded Python maturin) not just let it pull in a suitable one (and mislead me that it is free-threaded if actually there is a bug in that)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv python find` does not detect venv Python in CPython 3.13t and 3.14+ (CI)" to "`uv python find` does not detect venv Python in CPython 3.13t and 3.14t (CI)" by @lmmx on 2025-10-24 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16434.html">astral-sh/uv#16434</a> on 2025-10-24 09:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lmmx">@lmmx</a> on 2025-10-24 09:02</div>
            <div class="timeline-body"><p>Closing this in favour of more precise repro in #16434</p>
<p>Update: 3.14t was actually failing at a later CI step due to segfault and 3.13t was failing at this uv python find step as the discovery is hardcoded to treat 3.13t as experimental and discount it during comparison to requires-python (which I think is a bug but a separate one)</p>
<p>The 3.14t was an unrelated SegFault, I should not have assumed. Updating issue title here apologies for misreport</p>
<pre><code>Run source .venv/bin/activate
============================= test session starts ==============================
platform linux -- Python 3.14.0, pytest-8.4.0, pluggy-1.6.0 -- /home/runner/work/comrak/comrak/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/work/comrak/comrak
configfile: pyproject.toml
Fatal Python error: Segmentation fault
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @lmmx on 2025-10-24 09:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv python find` does not detect venv Python in CPython 3.13t and 3.14t (CI)" to "`uv python find` does not detect venv Python in CPython 3.13t" by @lmmx on 2025-10-24 09:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
