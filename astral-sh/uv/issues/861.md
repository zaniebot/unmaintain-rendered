```yaml
number: 861
title: "Skip `get_requires_for_build_wheel` for build backends that always return `[]`"
type: issue
state: closed
author: charliermarsh
labels:
  - performance
  - needs-decision
assignees: []
created_at: 2024-01-09T22:53:26Z
updated_at: 2024-07-28T00:54:56Z
url: https://github.com/astral-sh/uv/issues/861
synced_at: 2026-01-10T01:57:01Z
```

# Skip `get_requires_for_build_wheel` for build backends that always return `[]`

---

_Issue opened by @charliermarsh on 2024-01-09 22:53_

This is a probably-unsafe optimization we could perform, but e.g., poetry-core always returns `[]` (https://github.com/python-poetry/poetry-core/blob/21b00338544f52df7c3ba320f5f242a2fc815b65/src/poetry/core/masonry/api.py#L20C1-L20C1). So if we're using a version of poetry-core that we _know_ always returns `[]`, we could skip that step entirely.

---

_Label `performance` added by @charliermarsh on 2024-01-09 22:53_

---

_Comment by @charliermarsh on 2024-01-09 22:56_

I looked at some of the others and:

- `flit` does need it (https://github.com/pypa/flit/blob/b2e3491a2f64dfac6649dce5ee20aecea9a01858/flit_core/flit_core/buildapi.py#L21).
- `hatchling` does need it (https://github.com/pypa/hatch/blob/7b1ef02af717101d006d9801bca6f246ecb46892/backend/src/hatchling/build.py#L37)
- `setuptools` doesn't need it (I think)

Not sure what else is popular.


---

_Comment by @charliermarsh on 2024-01-09 22:56_

@konstin - I feel like this would be a pretty sketchy but maybe interesting to you.

---

_Comment by @charliermarsh on 2024-01-09 22:57_

(Not sure if we should do this.)

---

_Comment by @konstin on 2024-01-09 23:16_

maturin also has it hardcoded: https://github.com/PyO3/maturin/blob/1369b2779a05645fe5e96fec98ef2cdffb6400eb/maturin/__init__.py#L122-L127

---

_Comment by @konstin on 2024-01-09 23:23_

To list our options:
* We could maintain a list of backends and versions with a static return value. We put it on a separate repo into github releases, download and cache it and only update it when we encounter a too new version.
* We could parse the file of the backend module (and hope they perform no import shenanigans). We know how to do this really fast from ruff, but it would pull in at least ruff's parser.
* We ask backend authors if they are willing to expose additional metadata that allows to skip that hook
* The call overhead becomes irrelevant due to https://github.com/astral-sh/puffin/issues/846

---

_Comment by @charliermarsh on 2024-01-09 23:52_

Hoping the last item is fine.

---

_Comment by @charliermarsh on 2024-01-10 14:50_

Although the first item would be my second choice.

---

_Comment by @sbidoul on 2024-02-17 11:56_

> setuptools doesn't need it (I think)

Actually setuptools does need `get_requires_for_build_wheel`. By default it returns `wheel`, but it also returns `setup_requires` entries.

Related: https://github.com/astral-sh/uv/issues/1582

---

_Comment by @charliermarsh on 2024-02-17 12:41_

@sbidoul -- Thank you!

---

_Label `needs-decision` added by @zanieb on 2024-07-01 21:34_

---

_Closed by @charliermarsh on 2024-07-28 00:54_

---

_Reopened by @charliermarsh on 2024-07-28 00:54_

---

_Comment by @charliermarsh on 2024-07-28 00:54_

I think this isn't gonna work.

---

_Closed by @charliermarsh on 2024-07-28 00:54_

---
