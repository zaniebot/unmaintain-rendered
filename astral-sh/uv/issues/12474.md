```yaml
number: 12474
title: uv generates invalid pyproject.toml
type: issue
state: closed
author: builder555
labels:
  - question
assignees: []
created_at: 2025-03-26T00:29:18Z
updated_at: 2025-03-26T12:34:39Z
url: https://github.com/astral-sh/uv/issues/12474
synced_at: 2026-01-10T01:57:28Z
```

# uv generates invalid pyproject.toml

---

_Issue opened by @builder555 on 2025-03-26 00:29_

### Summary

#### Steps to reproduce:

```bash
uv init myapp
cd myapp
uv add --dev pytest-watch
uv run ptw
```

#### Expected result:
pytest-watch runs continuously

#### Actual result:
```
myapp/.venv/lib/python3.13/site-packages/docopt.py:165: SyntaxWarning: invalid escape sequence '\S'
  name = re.findall('(<\S*?>)', source)[0]
myapp/.venv/lib/python3.13/site-packages/docopt.py:166: SyntaxWarning: invalid escape sequence '\['
  value = re.findall('\[default: (.*)\]', source, flags=re.I)
myapp/.venv/lib/python3.13/site-packages/docopt.py:207: SyntaxWarning: invalid escape sequence '\['
  matched = re.findall('\[default: (.*)\]', description, flags=re.I)
myapp/.venv/lib/python3.13/site-packages/docopt.py:456: SyntaxWarning: invalid escape sequence '\S'
  split = re.split('\n *(<\S+?>|-\S+?)', doc)[1:]
Traceback (most recent call last):
  File "myapp/.venv/bin/ptw", line 10, in <module>
    sys.exit(main())
             ~~~~^^
  File "myapp/.venv/lib/python3.13/site-packages/pytest_watch/command.py", line 83, in main
    if not merge_config(args, pytest_args, verbose=args['--verbose']):
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "myapp/.venv/lib/python3.13/site-packages/pytest_watch/config.py", line 95, in merge_config
    config.read(config_path)
    ~~~~~~~~~~~^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/configparser.py", line 735, in read
    self._read(fp, filename)
    ~~~~~~~~~~^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/configparser.py", line 1050, in _read
    ParsingError._raise_all(self._read_inner(fp, fpname))
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/configparser.py", line 334, in _raise_all
    raise next(exceptions).combine(exceptions)
configparser.ParsingError: Source contains parsing errors: 'myapp/pyproject.toml'
	[line 12]: ']\n'
```

pyproject.toml:
```toml
[project]
name = "myapp"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.13"
dependencies = []

[dependency-groups]
dev = [
    "pytest-watch>=4.2.0",
]

```

If I modify the `[dependency-groups]` section to have dependencies on one line, it works fine:

`dev = ["pytest-watch>=4.2.0"]`

### Platform

macOS 15 arm64

### Version

uv 0.6.3 (Homebrew 2025-02-24)

### Python version

Python 3.13.2

---

_Label `bug` added by @builder555 on 2025-03-26 00:29_

---

_Comment by @charliermarsh on 2025-03-26 01:15_

I'm confused -- that _is_ valid TOML? You can paste it into any TOML validator.

---

_Label `bug` removed by @charliermarsh on 2025-03-26 01:15_

---

_Label `question` added by @charliermarsh on 2025-03-26 01:15_

---

_Comment by @j178 on 2025-03-26 01:39_

```configparser.ParsingError```

seems like that pytest-watch is parsing pyproject.toml as an ini config file.

---

_Comment by @SummerStorm on 2025-03-26 02:24_

You want `uv add --dev pytest-watcher` instead. That installs the actively maintained watcher that you want. 
 
`uv add --dev pytest-watch` adds [joeyespo/pytest-watch](https://github.com/joeyespo/pytest-watch) which was last updated 7 years ago and can only be configured by pytest.ini and is incomptible with any .toml files. This is a `pytest-watch` issue and not a `uv` issue. 

---

_Closed by @charliermarsh on 2025-03-26 12:34_

---
