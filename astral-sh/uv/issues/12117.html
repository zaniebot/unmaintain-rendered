<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv build packages for torch cpu and gpu - astral-sh/uv #12117</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv build packages for torch cpu and gpu</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/12117">#12117</a>
        opened by <a href="https://github.com/anmolnagi-fugro">@anmolnagi-fugro</a>
        on 2025-03-11 16:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/anmolnagi-fugro">@anmolnagi-fugro</a> on 2025-03-11 16:34</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I would like to build three packages such that</p>
<p>custom-package has only the 3 listed <code>dependencies</code>
custom-package-cpu has <code>dependencies + cpu optional dependencies</code>
custom-package-cu117 has <code>dependencies + cu117 optional dependencies</code></p>
<p>I was wondering if there is a way to create 3 different build?</p>
<p>for reference, I can install the different dependencies as
<code>uv sync --extra cpu</code>
<code>uv sync --extra cu117</code></p>
<p>Another question is why <code>torch==2.0.0+cpu</code> and <code>torchvision==0.19.1</code> are installed when I do <code>uv sync</code></p>
<pre><code>[project]
name = &quot;custom-package&quot;

dependencies = [
  &quot;pandas==2.2.3&quot;,
  &quot;numpy==1.23.2&quot;,
  &quot;natsort==8.4.0&quot;,
]

[tool.setuptools.packages.find]
where = [&quot;.&quot;]
include = [&quot;custome-package*&quot;]

[project.optional-dependencies]
cpu = [
  &quot;torch==2.0.0&quot;,
  &quot;torchvision==0.15.1&quot;,
]
cu117 = [
  &quot;torch==2.0.0+cu117&quot;,
  &quot;torchvision==0.15.1+cu117&quot;,
]

[dependency-groups]
dev = [
  &quot;ipykernel&quot;
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu117&quot;
url = &quot;https://download.pytorch.org/whl/cu117&quot;
explicit = true

[tool.uv]
conflicts = [
  [
    { extra = &quot;cpu&quot; },
    { extra = &quot;cu117&quot; },
  ],
]

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu117&quot;, extra = &quot;cu117&quot; },
]
torchvision = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu117&quot;, extra = &quot;cu117&quot; },
]
</code></pre>
<h3>Platform</h3>
<p><em>No response</em></p>
<h3>Version</h3>
<p>uv 0.6.5 (bcbcd0a1e 2025-03-06)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @anmolnagi-fugro on 2025-03-11 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-14 01:11</div>
            <div class="timeline-body"><p>Unfortunately I can't get this to resolve:</p>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because only the following versions of numpy are available:
          numpy&lt;=1.26.0
          numpy==1.26.1
          numpy==1.26.2
          numpy==1.26.3
          numpy==1.26.4
          numpy==2.0.0
          numpy==2.0.1
          numpy==2.0.2
          numpy==2.1.0
          numpy==2.1.1
          numpy==2.1.2
          numpy==2.1.3
          numpy==2.2.0
          numpy==2.2.1
          numpy==2.2.2
          numpy==2.2.3
      and pandas==2.2.3 depends on numpy&gt;=1.26.0, we can conclude that pandas==2.2.3 depends on numpy&gt;=1.26.0.
      And because your project depends on numpy==1.23.2 and pandas==2.2.3, we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<p>I'm happy to help if you can put together a clear reproducible example with the exact commands you ran, the <code>pyproject.toml</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2025-03-14 01:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-03-14 01:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Sunhill666">@Sunhill666</a> on 2025-04-24 07:14</div>
            <div class="timeline-body"><p>@charliermarsh Hello, i also have the same problem, here's my <code>project.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;some-package&quot;
version = &quot;0.1.0&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [
  &quot;ultralytics&gt;=8.3.112&quot;,
]

[project.optional-dependencies]
cpu = [
  &quot;torch&gt;=2.6.0&quot;,
  &quot;torchvision&gt;=0.21.0&quot;,
  &quot;torchaudio&gt;=2.6.0&quot;,
]

cu118 = [
  &quot;torch&gt;=2.6.0&quot;,
  &quot;torchvision&gt;=0.21.0&quot;,
  &quot;torchaudio&gt;=2.6.0&quot;,
]

cu124 = [
  &quot;torch&gt;=2.6.0&quot;,
  &quot;torchvision&gt;=0.21.0&quot;,
  &quot;torchaudio&gt;=2.6.0&quot;,
]

cu126 = [
  &quot;torch&gt;=2.6.0&quot;,
  &quot;torchvision&gt;=0.21.0&quot;,
  &quot;torchaudio&gt;=2.6.0&quot;,
]

[tool.uv]
conflicts = [
  [
    { extra = &quot;cpu&quot; },
    { extra = &quot;cu118&quot; },
    { extra = &quot;cu124&quot; },
    { extra = &quot;cu126&quot; },
  ],
]

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu118&quot;, extra = &quot;cu118&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; },
  { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; },
  { index = &quot;pytorch-cu126&quot;, extra = &quot;cu126&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; }
]
torchvision = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu118&quot;, extra = &quot;cu118&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; },
  { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; },
  { index = &quot;pytorch-cu126&quot;, extra = &quot;cu126&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; }
]
torchaudio = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu118&quot;, extra = &quot;cu118&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; },
  { index = &quot;pytorch-cu124&quot;, extra = &quot;cu124&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; },
  { index = &quot;pytorch-cu126&quot;, extra = &quot;cu126&quot;, marker = &quot;sys_platform == 'linux' or sys_platform == 'win32'&quot; }
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu124&quot;
url = &quot;https://download.pytorch.org/whl/cu124&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu126&quot;
url = &quot;https://download.pytorch.org/whl/cu126&quot;
explicit = true

[[tool.uv.index]]
url = &quot;https://mirrors.ustc.edu.cn/pypi/simple&quot;
default = true
</code></pre>
<p>Why is the pytorch of cpu installed when executing <code>uv run</code> without <code>--extra</code>, and the pytorch of cuda will only be installed if <code>--extra</code> parameters are used to specify, such as <code>cu124</code>, etc. How can I use <code>cu124</code> or <code>cu118</code> by default when executing <code>uv run</code> or <code>uv sync</code>?
Thank you and look forward to your reply.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-24 12:10</div>
            <div class="timeline-body"><p>It’s because Ultralytics itself depends on PyTorch. So if you don’t specify an extra, we still need to choose some version of PyTorch. You could move Ultralytics into each of the optional groups to make the relationship / behavior more explicit.</p>
<p>We don’t support enabling an extra by default, but you could use dependency groups instead. We do support default dependency groups, if you look for default-groups in the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Sunhill666">@Sunhill666</a> on 2025-04-25 00:19</div>
            <div class="timeline-body"><p>@charliermarsh Thank you for your reply.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:26 UTC
    </footer>
</body>
</html>
