<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment building fails based on order of libraries - astral-sh/uv #10664</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Environment building fails based on order of libraries</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10664">#10664</a>
        opened by <a href="https://github.com/thedch">@thedch</a>
        on 2025-01-16 02:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thedch">@thedch</a> on 2025-01-16 02:12</div>
            <div class="timeline-body"><p>I'm not sure if this is an appropriate bug to file here, or if this is just an artifact of various libraries specifying their requirements poorly / python versioning being difficult -- resolving a dependency matrix is hard! Feel free to close if this isn't in the scope of what <code>uv</code> can fix, but I wanted to flag in case it was interesting.</p>
<p>In this specific case, the environment successfully builds if the ordering is <code>umap-learn,numpy,pandas</code>, but not if it's <code>umap-learn,pandas,numpy</code>.</p>
<pre><code>❯ uv run --python 3.12 --with &quot;umap-learn,numpy,pandas&quot; python
Python 3.12.8 (main, Dec  6 2024, 19:42:06) [Clang 18.1.8 ] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;

❯ uv run --python 3.12 --with &quot;umap-learn,pandas,numpy&quot; python
  × Failed to build `llvmlite==0.36.0`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
        File &quot;/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 334, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 304, in _get_build_requires
          self.run_setup()
        File &quot;/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 522, in run_setup
          super().run_setup(setup_script=setup_script)
        File &quot;/Users/daniel/.cache/uv/builds-v0/.tmplh3u73/lib/python3.12/site-packages/setuptools/build_meta.py&quot;, line 320, in run_setup
          exec(code, locals())
        File &quot;&lt;string&gt;&quot;, line 55, in &lt;module&gt;
        File &quot;&lt;string&gt;&quot;, line 52, in _guard_py_ver
      RuntimeError: Cannot install on Python version 3.12.8; only versions &gt;=3.6,&lt;3.10 are supported.

      hint: This usually indicates a problem with the package or the build environment.
  help: `llvmlite` (v0.36.0) was included because `umap-learn` (v0.5.7) depends on `pynndescent` (v0.5.13) which depends on `llvmlite`

❯ uv version
uv 0.5.18 (Homebrew 2025-01-11)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-16 02:25</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>The resolver prioritized packages by their ordering (in the absence of other reasons to prioritize packages), so the change in behavior is expected. Since you don't provide any bounds on your requirements, this means we can backtrack in an undesirable way. Some discussion in https://github.com/astral-sh/uv/issues/8157 (which links to more discussion). Ideally, we'd solve the expected environment here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by @zanieb on 2025-01-16 02:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-16 15:07</div>
            <div class="timeline-body"><p>I believe this is because we don't respect upper-bounds on <code>requires-python</code>. See, e.g., https://github.com/astral-sh/uv/issues/10440#issuecomment-2581677866.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-16 15:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:57 UTC
    </footer>
</body>
</html>
