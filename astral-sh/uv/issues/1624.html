<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile pyproject.toml` ignores dependencies declared in `setup.cfg` - astral-sh/uv #1624</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv pip compile pyproject.toml` ignores dependencies declared in `setup.cfg`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1624">#1624</a>
        opened by <a href="https://github.com/SnoopJ">@SnoopJ</a>
        on 2024-02-18 04:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/SnoopJ">@SnoopJ</a> on 2024-02-18 04:44</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Platform: Ubuntu 20.04
<code>uv</code> version: <code>fef1956</code></p>
<h2>Reproduction</h2>
<h3>Project files</h3>
<pre><code># pyproject.toml
[build-system]
requires = [&quot;setuptools&quot;]
build-backend = &quot;setuptools.build_meta&quot;
</code></pre>
<pre><code># setup.cfg
[options]
packages = find:
install_requires=
    numpy
</code></pre>
<pre><code># setup.py
from setuptools import setup


setup(
    name=&quot;dummypkg&quot;,
    description=&quot;A dummy package&quot;,
)
</code></pre>
<h3><code>uv</code> invocation</h3>
<p>NOTE: this invocation points directly to the <code>uv</code> entrypoint to work around #1623.</p>
<pre><code>$ ~/.pyenv/versions/3.9.16/bin/uv pip compile pyproject.toml  # numpy dependency is ignored
Resolved 0 packages in 4ms
# This file was autogenerated by uv v0.1.4 via the following command:
#    uv pip compile pyproject.toml
</code></pre>
<h3>Reference <code>pip-compile</code> (7.3.0) invocation</h3>
<pre><code>$ pip-compile pyproject.toml
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.9
# by the following command:
#
#    pip-compile pyproject.toml
#
numpy==1.26.4
    # via dummypkg (pyproject.toml)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SnoopJ">@SnoopJ</a> on 2024-02-18 04:52</div>
            <div class="timeline-body"><p>Note: <code>uv pip install</code> <em>does</em> support this metadata layout, but the inconsistency is quite surprising, and this was the very first issue I ran into with <code>uv</code>.</p>
<p>Moving the dependency declaration into <code>pyproject.toml</code> resolves the problem, but this excludes the <code>setuptools</code> workflow and delivers poorly on a &quot;drop-in&quot; experience.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-02-18 08:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2024-02-18 08:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 03:13</div>
            <div class="timeline-body"><p>Thanks, I'll take a look at this. (Right now, we just read the dependency information directly from the <code>pyproject.toml</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-22 03:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 04:19</div>
            <div class="timeline-body"><p>So it looks like <code>pip-tools</code> will actually perform a PEP 517 call when passed a <code>pyproject.toml</code>, to determine the dependencies for the project. That's... interesting. It's a departure from my understanding of how it worked, but we of course have the capability to do that too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2167.html">astral-sh/uv#2167</a> on 2024-03-04 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../brycedrennan/imaginAIry/pulls/474.html">brycedrennan/imaginAIry#474</a> on 2024-03-06 03:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1644.html">astral-sh/uv#1644</a> on 2024-03-10 13:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-03-10 13:27</div>
            <div class="timeline-body"><p>This could be solved similarly to https://github.com/astral-sh/uv/pull/2029.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-10 15:09</div>
            <div class="timeline-body"><p>@sbidoul I don't think so, that issue uses a <code>dynamic</code> value in the pyproject.toml as a hint to reinstall. Here we need to add PEP 517 calls to determine dependencies in some cases (rather than just reading them all directly from the file), but I don't see a key suggesting they're dynamic. Although there is a key in https://github.com/astral-sh/uv/issues/1644 it doesn't seem to apply in all cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-03-10 15:17</div>
            <div class="timeline-body"><p>@zanieb in this case it is the absence of a <code>[project]</code> table that signals that all metadata is dynamic and a PEP 517 metadata preparation is required to obtain it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 15:18</div>
            <div class="timeline-body"><p>üëç Might be two things here: (1) making it possible to run PEP 517 hooks for these, and (2) adding detection based on whether it‚Äôs dynamic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2475.html">astral-sh/uv#2475</a> on 2024-03-15 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-22 04:31</div>
            <div class="timeline-body"><p>I'll be looking into this tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2633.html">astral-sh/uv#2633</a> on 2024-03-23 02:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-23 02:36</div>
            <div class="timeline-body"><p>Now in review here: https://github.com/astral-sh/uv/pull/2633. Expect it to be supported in the next release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-25 20:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
