<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile pyproject.toml` ignores dependencies declared in `setup.cfg` - astral-sh/uv #1624</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip compile pyproject.toml</code> ignores dependencies declared in <code>setup.cfg</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1624">#1624</a>
        opened by <a href="https://github.com/SnoopJ">@SnoopJ</a>
        on 2024-02-18 04:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SnoopJ">@SnoopJ</a></div>
            <div class="timeline-body">

<p>Platform: Ubuntu 20.04
<code>uv</code> version: <code>fef1956</code></p>
Reproduction
Project files
<pre><code># pyproject.toml
[build-system]
requires = [&quot;setuptools&quot;]
build-backend = &quot;setuptools.build_meta&quot;
</code></pre>
<pre><code># setup.cfg
[options]
packages = find:
install_requires=
    numpy
</code></pre>
<pre><code># setup.py
from setuptools import setup


setup(
    name=&quot;dummypkg&quot;,
    description=&quot;A dummy package&quot;,
)
</code></pre>
<code>uv</code> invocation
<p>NOTE: this invocation points directly to the <code>uv</code> entrypoint to work around #1623.</p>
<pre><code>$ ~/.pyenv/versions/3.9.16/bin/uv pip compile pyproject.toml  # numpy dependency is ignored
Resolved 0 packages in 4ms
# This file was autogenerated by uv v0.1.4 via the following command:
#    uv pip compile pyproject.toml
</code></pre>
Reference <code>pip-compile</code> (7.3.0) invocation
<pre><code>$ pip-compile pyproject.toml
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.9
# by the following command:
#
#    pip-compile pyproject.toml
#
numpy==1.26.4
    # via dummypkg (pyproject.toml)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SnoopJ">@SnoopJ</a> on 2024-02-18 04:52</div>
            <div class="timeline-body"><p>Note: <code>uv pip install</code> <em>does</em> support this metadata layout, but the inconsistency is quite surprising, and this was the very first issue I ran into with <code>uv</code>.</p>
<p>Moving the dependency declaration into <code>pyproject.toml</code> resolves the problem, but this excludes the <code>setuptools</code> workflow and delivers poorly on a &quot;drop-in&quot; experience.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-18 08:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-18 08:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 03:13</div>
            <div class="timeline-body"><p>Thanks, I&#x27;ll take a look at this. (Right now, we just read the dependency information directly from the <code>pyproject.toml</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 03:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-22 04:19</div>
            <div class="timeline-body"><p>So it looks like <code>pip-tools</code> will actually perform a PEP 517 call when passed a <code>pyproject.toml</code>, to determine the dependencies for the project. That&#x27;s... interesting. It&#x27;s a departure from my understanding of how it worked, but we of course have the capability to do that too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-03-10 13:27</div>
            <div class="timeline-body"><p>This could be solved similarly to <a href="https://github.com/astral-sh/uv/pull/2029">astral-sh/uv#2029</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-10 15:09</div>
            <div class="timeline-body"><p>@sbidoul I don&#x27;t think so, that issue uses a <code>dynamic</code> value in the pyproject.toml as a hint to reinstall. Here we need to add PEP 517 calls to determine dependencies in some cases (rather than just reading them all directly from the file), but I don&#x27;t see a key suggesting they&#x27;re dynamic. Although there is a key in <a href="https://github.com/astral-sh/uv/issues/1644">astral-sh/uv#1644</a> it doesn&#x27;t seem to apply in all cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbidoul">@sbidoul</a> on 2024-03-10 15:17</div>
            <div class="timeline-body"><p>@zanieb in this case it is the absence of a <code>[project]</code> table that signals that all metadata is dynamic and a PEP 517 metadata preparation is required to obtain it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-10 15:18</div>
            <div class="timeline-body"><p>üëç Might be two things here: (1) making it possible to run PEP 517 hooks for these, and (2) adding detection based on whether it‚Äôs dynamic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-22 04:31</div>
            <div class="timeline-body"><p>I&#x27;ll be looking into this tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-23 02:36</div>
            <div class="timeline-body"><p>Now in review here: <a href="https://github.com/astral-sh/uv/pull/2633">astral-sh/uv#2633</a>. Expect it to be supported in the next release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-25 20:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:29:40 UTC
    </footer>
</body>
</html>
