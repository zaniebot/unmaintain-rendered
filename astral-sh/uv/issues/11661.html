<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migrating from pip-tools workflow to uv project - astral-sh/uv #11661</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Migrating from pip-tools workflow to uv project</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11661">#11661</a>
        opened by <a href="https://github.com/mario-at-intercom">@mario-at-intercom</a>
        on 2025-02-20 11:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mario-at-intercom">@mario-at-intercom</a> on 2025-02-20 11:13</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hey, i'm looking into migrating one of my projects from pip-tools to uv project.</p>
<p>I can't find a guidance on doing that. I'd like my versions in requirements.txt staying the same (and I have two different files for two different platforms) when i move to the uv's lockfile.</p>
<h3>Platform</h3>
<p>macOS, Windows</p>
<h3>Version</h3>
<p>uv 0.6.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @mario-at-intercom on 2025-02-20 11:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-20 11:22</div>
            <div class="timeline-body"><p>Can you describe what you tried and what didn't work for your case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-20 14:13</div>
            <div class="timeline-body"><p>I don't think there's an easy way to use multiple <code>requirements.txt</code> files for different platforms to constrain the versions of a new uv lockfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mario-at-intercom">@mario-at-intercom</a> on 2025-02-20 15:55</div>
            <div class="timeline-body"><p>@konstin I haven't tried any approach yet because I have no ideas to try.</p>
<p>My mental model:</p>
<ul>
<li>I have to create a brand new project with uv</li>
<li>Have to move all dependencies from requirements.in (no versions defined) to pyproject.toml</li>
<li>Have to make sure that uv.lock keeps versions from requirements.txt (will this happen automatically?). This is the piece I have no ideas about even to try.</li>
</ul>
<p>@zanieb I have two requirements.txt because I need to install a different tensorflow-text package based on the platform. Platform selector (probably not the right term?!) wasn't supported back then so I had to resort to</p>
<ul>
<li>requirements-common.in</li>
<li>requirements.in</li>
<li>requirements-macos.in</li>
</ul>
<p>That compile to requirements.txt and requirements-macos.txt. If I can use platform==darwin and platform!=darwin in uv project definition and that get properly translated to single uv lockfile, I don't need multiple requirements files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-20 16:27</div>
            <div class="timeline-body"><p>You'd need to copy your <code>requirements.txt</code> contents into <code>tool.uv.constraint-dependencies</code> (https://docs.astral.sh/uv/reference/settings/#constraint-dependencies), presumably you'd also want to add the platform markers relevant for the requirements file.</p>
<p>Then, you can <code>uv add -r requirements.in</code> and the lockfile should respect the pinned versions from your compiled requirements files.</p>
<blockquote>
<p>If I can use platform==darwin and platform!=darwin in uv project definition and that get properly translated to single uv lockfile,</p>
</blockquote>
<p>Yes you can do this with markers, e.g., https://docs.astral.sh/uv/concepts/projects/dependencies/#platform-specific-dependencies</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-20 16:32</div>
            <div class="timeline-body"><p>(zanie wrote their response at the same time, sorry for the overlap)</p>
<blockquote>
<p>My mental model:</p>
<pre><code>* I have to create a brand new project with uv

* Have to move all dependencies from requirements.in (no versions defined) to pyproject.toml

* Have to make sure that uv.lock keeps versions from requirements.txt (will this happen automatically?). This is the piece I have no ideas about even to try.</code></pre>
</blockquote>
<p>The first two steps are correct, the third one is tricky. There's no 1:1 translation from locked requirement.txt to uv.lock due to the slightly different models (mainly that pip is platform specific and uv's lockfile is universal), but there's some tricks that can help you get close.</p>
<p>One option is using constraints. Constraints use the same syntax as requirements and are passed explicitly, for the uv project interface in <code>tool.uv</code>:</p>
<pre><code class="language-toml">[tool.uv]
constraint-dependencies = [&quot;...&quot;, &quot;...&quot;]
</code></pre>
<p>You could add <code>; sys_platform == &quot;darwin&quot;</code> to each entry in the one requirements file and <code>; sys_platform != &quot;darwin&quot;</code> to the other, then insert them as constraints here. This is the most accurate approach but it my fail with a conflict due to uv's resolver being different from pip's, requiring some manual editing until it works. Once you have your <code>uv.lock</code>, you can remove the constraints, uv updates <code>uv.lock</code> only when required or requested.</p>
<p>Another is doing the first with <code>--exclude-newer</code> and the timestamp of the pip freezing, if that is available, then remove the <code>exclude-newer</code> line from the resulting <code>uv.lock</code>. This trick only works with pypi and simulates a resolution at that time, which may be sufficient to get the right lockfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mario-at-intercom">@mario-at-intercom</a> on 2025-02-21 08:40</div>
            <div class="timeline-body"><p>Thanks @zanieb and @konstin. I think I understand what I need to do to migrate us. I don't know when exactly we'll do that but I needed to understand the complexity we might hit. Thanks for that.</p>
<p>It's probably safe to close the issue now since the path to migration is outlined.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-02-24 08:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:01 UTC
    </footer>
</body>
</html>
