<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't break on upgrades of externally-managed Pythons - astral-sh/uv #9739</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don't break on upgrades of externally-managed Pythons</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9739">#9739</a>
        opened by <a href="https://github.com/lishaduck">@lishaduck</a>
        on 2024-12-09 15:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/lishaduck">@lishaduck</a> on 2024-12-09 15:05</div>
            <div class="timeline-body"><p>I primarily use uv a a pipx replacement. Whenever I run <code>brew upgrade</code> and there's a new version of the <code>python@3.13</code> package, all of the Python CLIs I use break with <code>/Users/username/.local/bin/some-package: bad interpreter: /Users/username/.local/share/uv/tools/some-package/bin/python3: no such file or directory</code>. Upon further inspection, it looks like uv is using aliases instead of symlinks, which the wonderful internet informs me link to a file id, rather than a file path.
If I try to repair them using <code>uv tool install --force some-package</code>, it works, but I have to run this manually. <code>uv tool upgrade --all --reinstall</code> fails with <code>error: Failed to upgrade some-package Caused by: `some-package` is not installed; run `uv tool install some-package` to install</code>.
Note: this is not a regression, it's been true since August; I just thought there was an existing issue, but there wasn't.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-09 15:14</div>
            <div class="timeline-body"><p>We don't use aliases, afaik. Can you share more details about the contents of <code>/Users/username/.local/bin/some-package</code> and the target of <code>/Users/username/.local/share/uv/tools/some-package/bin/python3</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lishaduck">@lishaduck</a> on 2024-12-09 15:45</div>
            <div class="timeline-body"><blockquote>
<p>We don't use aliases, afaik. Can you share more details about the contents of <code>/Users/username/.local/bin/some-package</code> and the target of <code>/Users/username/.local/share/uv/tools/some-package/bin/python3</code>?</p>
</blockquote>
<p>Sure! For <code>ipython</code>, <code>/Users/username/.local/bin/ipython</code> is a symlink pointing to <code>/Users/username/.local/share/uv/tools/ipython/bin/ipython</code>. That's an executable file, if I force-open it in TextEdit (macOS doesn't recognize it as a text file), it's a simple wrapper script:</p>
<pre><code class="language-py">#!/Users/username/.local/share/uv/tools/ipython/bin/python
# -*- coding: utf-8 -*-
import re
import sys
from IPython import start_ipython
if __name__ == &quot;__main__&quot;:
    sys.argv[0] = re.sub(r&quot;(-script\.pyw|\.exe)?$&quot;, &quot;&quot;, sys.argv[0])
    sys.exit(start_ipython())
</code></pre>
<p><code>/Users/username/.local/share/uv/tools/ipython/bin/python3</code> is an alias pointing to <code>/opt/homebrew/Cellar/python@3.13/3.13.1/Frameworks/Python.framework/Versions/3.13/bin/python3.13</code>. I know it's an alias because if I rename the <code>python3.13</code> binary to <code>python6.13</code>, the uv alias remains pointed to the file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-10 20:18</div>
            <div class="timeline-body"><p>Per a brief Google search</p>
<blockquote>
<p>Aliases store two pieces of information about the destination file - both the location and a file identifier. Symbolic links only store the other location. For that reason, if you move a file, Aliases are superior since they can often still point at the correct file when a change happens.</p>
</blockquote>
<p>My understanding is that we're using symbolic links everywhere, which matches both the behavior and the above description.</p>
<p>I'm surprised we resolve the Python interpreter to <code>/opt/homebrew/Cellar/python@3.13/3.13.1/Frameworks/Python.framework/Versions/3.13/bin/python3.13</code> though, I believe we made some changes to try to use their stable directory.</p>
<p>What does <code>uv python list</code> show?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lishaduck">@lishaduck</a> on 2024-12-10 20:50</div>
            <div class="timeline-body"><blockquote>
<p>Per a brief Google search</p>
<blockquote>
<p>Aliases store two pieces of information about the destination file - both the location and a file identifier. Symbolic links only store the other location. For that reason, if you move a file, Aliases are superior since they can often still point at the correct file when a change happens.</p>
</blockquote>
<p>My understanding is that we're using symbolic links everywhere, which matches both the behavior and the above description.</p>
</blockquote>
<p>How do symbolic links match the behavior? If I rename the <code>python3.13</code> in the Cellar, the alias remains pointed to the &quot;right&quot; file, which is not the behavior of a symlink, which only stores the path.
I'm not trying to be a bother, I'm just confused where the statement about behavior came from.</p>
<blockquote>
<p>I'm surprised we resolve the Python interpreter to <code>/opt/homebrew/Cellar/python@3.13/3.13.1/Frameworks/Python.framework/Versions/3.13/bin/python3.13</code> though, I believe we made some changes to try to use their stable directory.</p>
<p>What does <code>uv python list</code> show?</p>
</blockquote>
<p>Here you go:</p>
<pre><code class="language-sh">❯ uv python list    
cpython-3.13.1+freethreaded-macos-aarch64-none    &lt;download available&gt;
cpython-3.13.1-macos-aarch64-none                 /opt/homebrew/opt/python@3.13/bin/python3.13 -&gt; ../Frameworks/Python.framework/Versions/3.13/bin/python3.13
cpython-3.13.1-macos-aarch64-none                 &lt;download available&gt;
cpython-3.12.8-macos-aarch64-none                 /opt/homebrew/opt/python@3.12/bin/python3.12 -&gt; ../Frameworks/Python.framework/Versions/3.12/bin/python3.12
cpython-3.12.8-macos-aarch64-none                 &lt;download available&gt;
cpython-3.11.11-macos-aarch64-none                &lt;download available&gt;
cpython-3.10.16-macos-aarch64-none                &lt;download available&gt;
cpython-3.9.21-macos-aarch64-none                 &lt;download available&gt;
cpython-3.9.6-macos-aarch64-none                  /Applications/Xcode.app/Contents/Developer/usr/bin/python3 -&gt; ../../Library/Frameworks/Python3.framework/Versions/3.9/bin/python3
cpython-3.8.20-macos-aarch64-none                 &lt;download available&gt;
pypy-3.10.14-macos-aarch64-none                   &lt;download available&gt;
pypy-3.9.19-macos-aarch64-none                    &lt;download available&gt;
pypy-3.8.16-macos-aarch64-none                    &lt;download available&gt;

~ took 2s 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-10 22:17</div>
            <div class="timeline-body"><blockquote>
<p>How do symbolic links match the behavior? If I rename the python3.13 in the Cellar, the alias remains pointed to the &quot;right&quot; file, which is not the behavior of a symlink, which only stores the path.</p>
</blockquote>
<p>Ah sorry I misread what you said. I guess I'm a bit confused about the alias vs symlink behaviors. I'll need to just take some time to verify what's happening under the hood — afaik we don't create any aliases explicitly but perhaps the Rust standard library does.</p>
<p>Thanks for providing the <code>uv python list</code> output! That's helpful. I'm surprised we resolve that interpreter to a different path. Can you confirm this occurs on the latest version of uv if you install a new tool?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lishaduck">@lishaduck</a> on 2024-12-10 22:35</div>
            <div class="timeline-body"><blockquote>
<p>Can you confirm this occurs on the latest version of uv if you install a new tool?</p>
</blockquote>
<p>Oh, I installed uv via the Homebrew formula as well (<a href="https://github.com/Homebrew/homebrew-core/blob/6dca727f43cb7a89d50279eeba961baa4e8d6a18/Formula/u/uv.rb">it doesn't look they they patch it</a>, but worth noting).
I installed black, made a copy of the original python binary, deleted the original python binary, and renamed the copied one to <code>python3.13</code>, and it works fine. I'm unsure what's different (it's gotta something different Brew is doing, I haven't updated uv, python, or Brew since filing the issue (as there aren't new updates)).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Support externally-managed Python upgrades" to "Don't break on upgrades of externally-managed Pythons" by @lishaduck on 2024-12-10 22:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @zanieb on 2025-01-07 19:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11048.html">astral-sh/uv#11048</a> on 2025-01-29 01:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:46 UTC
    </footer>
</body>
</html>
