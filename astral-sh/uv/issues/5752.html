<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` adds a dependency and then declares it invalid - astral-sh/uv #5752</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv add</code> adds a dependency and then declares it invalid</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5752">#5752</a>
        opened by <a href="https://github.com/dimbleby">@dimbleby</a>
        on 2024-08-03 15:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dimbleby">@dimbleby</a> on 2024-08-03 15:53</div>
            <div class="timeline-body"><pre><code class="language-shell">$ uv init .
warning: `uv init` is experimental and may change without warning
Initialized project `foo` at `/home/dch/foo`      

$ uv add --extra-index-url=&quot;https://download.pytorch.org/whl/cpu&quot; -- torch
warning: `uv add` is experimental and may change without warning
Using Python 3.10.12 interpreter at: /usr/bin/python3
Creating virtualenv at: .venv
Resolved 10 packages in 2.50s
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: foo @ file:///home/dch/foo
  Caused by: Failed to build: `foo @ file:///home/dch/foo`
  Caused by: Build backend failed to build wheel through `build_editable()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
  File &quot;/home/dch/.cache/uv/builds-v0/.tmpqaB24C/lib/python3.10/site-packages/hatchling/build.py&quot;, line 83, in build_editable
    return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))
  File &quot;/home/dch/.cache/uv/builds-v0/.tmpqaB24C/lib/python3.10/site-packages/hatchling/builders/plugin/interface.py&quot;, line 90, in build
    self.metadata.validate_fields()
  File &quot;/home/dch/.cache/uv/builds-v0/.tmpqaB24C/lib/python3.10/site-packages/hatchling/metadata/core.py&quot;, line 261, in validate_fields
    self.core.validate_fields()
  File &quot;/home/dch/.cache/uv/builds-v0/.tmpqaB24C/lib/python3.10/site-packages/hatchling/metadata/core.py&quot;, line 1353, in validate_fields
    getattr(self, attribute)
  File &quot;/home/dch/.cache/uv/builds-v0/.tmpqaB24C/lib/python3.10/site-packages/hatchling/metadata/core.py&quot;, line 1224, in dependencies
    self._dependencies = list(self.dependencies_complex)
  File &quot;/home/dch/.cache/uv/builds-v0/.tmpqaB24C/lib/python3.10/site-packages/hatchling/metadata/core.py&quot;, line 1203, in dependencies_complex
    raise ValueError(message) from None
ValueError: Dependency #1 of field `project.dependencies` is invalid: Expected end or semicolon (after version specifier)
    torch&gt;=2.4.0+cpu
         ~~~~~~~^

$ uv version
uv 0.2.33
</code></pre>
<p><code>torch&gt;=2.4.0+cpu</code> was introduced by <code>uv</code> itself</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimbleby">@dimbleby</a> on 2024-08-03 15:56</div>
            <div class="timeline-body"><p>I guess strictly speaking it is hatchling declaring that the dependency is invalid, but it is right: per <a href="https://peps.python.org/pep-0440/#inclusive-ordered-comparison">PEP440</a> &quot;Local version identifiers are NOT permitted in this version specifier.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-03 15:59</div>
            <div class="timeline-body"><p>Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-03 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-03 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-08-03 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-03 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-03 17:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:37 UTC
    </footer>
</body>
</html>
