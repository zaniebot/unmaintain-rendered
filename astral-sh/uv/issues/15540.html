<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test `create_venv_current_working_directory` is failing on Windows - astral-sh/uv #15540</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Test <code>create_venv_current_working_directory</code> is failing on Windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15540">#15540</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-08-26 20:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-26 20:41</div>
            <div class="timeline-body"><pre><code>    Snapshot: create_venv_current_working_directory-2
    Source: V:\uv:1616
    ───────────────────────────────────────────────────────────────────────────────
    Expression: snapshot
    ───────────────────────────────────────────────────────────────────────────────
    -old snapshot
    +new results
    ────────────┬──────────────────────────────────────────────────────────────────
        0       │-success: true
        1       │-exit_code: 0
              0 │+success: false
              1 │+exit_code: 2
        2     2 │ ----- stdout -----
        3     3 │ 
        4     4 │ ----- stderr -----
        5     5 │ Using CPython 3.12.[X] interpreter at: [PYTHON-3.12]
        6     6 │ Creating virtual environment at: .
        7       │-Activate with: source bin/activate
              7 │+error: Failed to create virtual environment
              8 │+  Caused by: failed to remove directory `[VENV]/`: The process cannot access the file because it is being used by another process. (os error 32)
    ────────────┴──────────────────────────────────────────────────────────────────
</code></pre>
<p>I find this confusing because we have handling for self removal there? https://github.com/astral-sh/uv/blob/9eb5fc240ca28d8222f1be6d62379fd795e2f09e/crates/uv-virtualenv/src/virtualenv.rs#L602-L613</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @zanieb on 2025-08-26 20:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-26 20:42</div>
            <div class="timeline-body"><p>cc @charliermarsh (I will not get to this right away)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-08-26 20:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-08-27 03:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:07 UTC
    </footer>
</body>
</html>
