<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seeking for suggestions to install axolotl - astral-sh/uv #14178</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Seeking for suggestions to install axolotl</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/14178">#14178</a>
        opened by <a href="https://github.com/hongbo-miao">@hongbo-miao</a>
        on 2025-06-21 06:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hongbo-miao">@hongbo-miao</a> on 2025-06-21 06:30</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I recently try to install axolotl by</p>
<p>pyproject.toml</p>
<pre><code class="language-toml">[project]
name = &quot;hm-axolotl&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.11.0&quot;
dependencies = [
  &quot;axolotl==0.10.0&quot;,
  &quot;torch==2.7.1&quot;,
]

[tool.uv]
package = false
required-version = &quot;&gt;=0.6.0&quot;

[tool.uv.sources]
torch = [{ index = &quot;pytorch-cu128&quot; }]

[[tool.uv.index]]
name = &quot;pytorch-cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true
</code></pre>
<p><code>uv sync</code> will return error</p>
<pre><code class="language-sh">  × No solution found when resolving dependencies for split (python_full_version &gt;= '3.11.0' and python_full_version &lt; '3.12' and sys_platform == 'linux'):
  ╰─▶ Because axolotl==0.10.0 depends on torch==2.6.0 and your project depends on axolotl==0.10.0, we can conclude that your project depends on torch==2.6.0.
      And because your project depends on torch==2.7.1, we can conclude that your project's requirements are unsatisfiable.
error: Recipe `uv-install-dependencies` failed on line 5 with exit code 1
</code></pre>
<p>However, based on https://github.com/axolotl-ai-cloud/axolotl/issues/2812#issuecomment-2991192914
they requires installing <code>torch==2.7.1</code> first and then <code>axolotl</code>.</p>
<p>I am trying to install by <code>uv sync</code> instead of <code>uv pip install xxx</code>.
I am wondering is this something axolotl side need improve or uv side have a way for this partical case? Thank you! ☺️</p>
<h3>Platform</h3>
<p>Linux 6.11.0-26-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.7.13 (62ed17b23 2025-06-12)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @hongbo-miao on 2025-06-21 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-06-21 07:46</div>
            <div class="timeline-body"><p>https://docs.astral.sh/uv/concepts/resolution/#dependency-metadata
I looked through the documents, and perhaps this could solve your problem, though it might mean losing cross-platform capability. But I think this should work as a temporary solution.
You could also look for relevant content in the documents; perhaps there's a better way.</p>
<pre><code class="language-toml">[[tool.uv.dependency-metadata]]
name = &quot;axolotl&quot;
version = &quot;0.10.0&quot;
requires-dist = [&quot;torch==2.7.1&quot;]
</code></pre>
<p>Run on Google Colab
<img src="https://github.com/user-attachments/assets/fa832004-ed73-4ba9-9e0a-8de737ee139d" alt="Image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hongbo-miao">@hongbo-miao</a> on 2025-06-21 09:28</div>
            <div class="timeline-body"><p>Thank you @FishAlchemist !
I found to be able to run</p>
<pre><code class="language-sh">uv run axolotl fetch examples
uv run axolotl preprocess examples/qwen3/8b-qat-fsdp2.yml
uv run axolotl train examples/qwen3/8b-qat-fsdp2.yml
</code></pre>
<p>I need do</p>
<pre><code class="language-toml">[project]
name = &quot;hm-axolotl&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.11.0&quot;
dependencies = [
  &quot;axolotl==0.10.0&quot;,
  &quot;deepspeed==0.17.1&quot;,
  &quot;flash-attn==2.8.0.post2&quot;,
  &quot;torch==2.7.1&quot;,
]

[tool.uv]
package = false
required-version = &quot;&gt;=0.6.0&quot;
no-build-isolation-package = [&quot;flash-attn&quot;]

[[tool.uv.dependency-metadata]]
name = &quot;axolotl&quot;
version = &quot;0.10.0&quot;
requires-dist = [
  &quot;torch==2.7.1&quot;,
  &quot;colorama==0.4.6&quot;,
  &quot;click==8.2.1&quot;,
  &quot;python-dotenv==1.1.0&quot;,
  &quot;requests==2.32.4&quot;,
  &quot;pydantic==2.11.7&quot;,
  &quot;transformers==4.52.4&quot;,
  &quot;bitsandbytes==0.46.0&quot;,
  &quot;peft==0.15.2&quot;,
  &quot;addict==2.4.0&quot;,
  &quot;fastcore==1.8.4&quot;,
  &quot;datasets==3.6.0&quot;,
  &quot;pillow==11.2.1&quot;,
  &quot;fire==0.7.0&quot;,
  &quot;numba==0.61.2&quot;,
  &quot;axolotl-contribs-lgpl==0.0.6&quot;,
  &quot;hf-transfer==0.1.9&quot;,
]

[tool.uv.sources]
torch = [{ index = &quot;pytorch-cu128&quot; }]

[[tool.uv.index]]
name = &quot;pytorch-cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true
</code></pre>
<p>Note</p>
<ol>
<li><code>&quot;axolotl[flash-attn,deepspeed]==0.10.0&quot;</code> does not help install <code>flash-attn</code> and <code>deepspeed</code> when provide <code>[[tool.uv.dependency-metadata]]</code> for <code>axolotl</code>. So I provide <code>&quot;deepspeed==0.17.1&quot;</code> and <code>&quot;flash-attn==2.8.0.post2&quot;</code> under <code>dependencies</code>.</li>
<li>When I provide <code>&quot;torch==2.7.1&quot;</code> under <code>dependencies</code>, it will install newer versions:</li>
</ol>
<pre><code> - nvidia-cublas-cu12==12.6.4.1
 + nvidia-cublas-cu12==12.8.3.14
 - nvidia-cuda-cupti-cu12==12.6.80
 + nvidia-cuda-cupti-cu12==12.8.57
 - nvidia-cuda-nvrtc-cu12==12.6.77
 + nvidia-cuda-nvrtc-cu12==12.8.61
 - nvidia-cuda-runtime-cu12==12.6.77
 + nvidia-cuda-runtime-cu12==12.8.57
 - nvidia-cudnn-cu12==9.5.1.17
 + nvidia-cudnn-cu12==9.7.1.26
 - nvidia-cufft-cu12==11.3.0.4
 + nvidia-cufft-cu12==11.3.3.41
 - nvidia-cufile-cu12==1.11.1.6
 + nvidia-cufile-cu12==1.13.0.11
 - nvidia-curand-cu12==10.3.7.77
 + nvidia-curand-cu12==10.3.9.55
 - nvidia-cusolver-cu12==11.7.1.2
 + nvidia-cusolver-cu12==11.7.2.55
 - nvidia-cusparse-cu12==12.5.4.2
 + nvidia-cusparse-cu12==12.5.7.53
 - nvidia-nvjitlink-cu12==12.6.85
 + nvidia-nvjitlink-cu12==12.8.61
 - nvidia-nvtx-cu12==12.6.77
 + nvidia-nvtx-cu12==12.8.55
</code></pre>
<p>However, I still met</p>
<blockquote>
<p>CUDA error: an illegal memory access was encountered</p>
</blockquote>
<p>but I think this is out of scope of this issue.</p>
<p>I am wondering if the author of axolotl could provide something like unsloth https://github.com/unslothai/unsloth/blob/db8185dd114b799256e5429fbc1708418b54e944/pyproject.toml#L342-L346</p>
<pre><code class="language-toml">[project.optional-dependencies]
cu128-torch270 = [
    &quot;unsloth[huggingface]&quot;,
    &quot;bitsandbytes&gt;=0.45.5&quot;,
    &quot;unsloth[cu128onlytorch270]&quot;,
]
</code></pre>
<p>so I can install by <code>unsloth[cu128-torch270]</code> for certain torch version.</p>
<p>I posted the question at https://github.com/axolotl-ai-cloud/axolotl/issues/2812#issuecomment-2993483933</p>
<p>But if anyone has better suggestions, please let me know, thank you! ☺️</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../axolotl-ai-cloud/axolotl/issues/2812.html">axolotl-ai-cloud/axolotl#2812</a> on 2025-06-21 09:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../hongbo-miao/hongbomiao.com/issues/28632.html">hongbo-miao/hongbomiao.com#28632</a> on 2025-06-21 09:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Seeking for suggestion to install axolotl" to "Seeking for suggestions to install axolotl" by @hongbo-miao on 2025-06-21 09:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-06-21 10:34</div>
            <div class="timeline-body"><p>@hongbo-miao It seems that using <code>override-dependencies</code> works too.
https://docs.astral.sh/uv/concepts/resolution/#dependency-overrides</p>
<pre><code class="language-toml">[tool.uv]
override-dependencies = [&quot;torch==2.7.1&quot;]
</code></pre>
<p>By the way, the <code>no build isolation</code> flag that https://github.com/axolotl-ai-cloud/axolotl/issues/2812#issuecomment-2991192914 mentioned actually exists in uv, but it seems to be more useful with uv pip.
I can't find a way to make it work properly with <code>uv sync</code>.
https://docs.astral.sh/uv/reference/environment/#uv_no_build_isolation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hongbo-miao">@hongbo-miao</a> on 2025-06-21 23:02</div>
            <div class="timeline-body"><p>Thank you @FishAlchemist ! Now it is much cleaner!</p>
<pre><code class="language-toml">[project]
name = &quot;hm-axolotl&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.11.0&quot;
dependencies = [
  &quot;axolotl[deepspeed]==0.10.0&quot;,
  &quot;flash-attn==2.8.0.post2&quot;,
]

[tool.uv]
package = false
required-version = &quot;&gt;=0.6.0&quot;
no-build-isolation-package = [&quot;flash-attn&quot;]
override-dependencies = [&quot;torch==2.7.1&quot;]

[tool.uv.sources]
torch = [{ index = &quot;pytorch-cu128&quot; }]

[[tool.uv.index]]
name = &quot;pytorch-cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true
</code></pre>
<p>Note, <code>no-build-isolation-package = [&quot;flash-attn&quot;]</code> does not work on <code>axolotl[deepspeed,flash-attn]</code>, so I add <code>&quot;flash-attn==2.8.0.post2&quot;</code> individually under <code>dependencies</code>.</p>
<p>I think I can close for now. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @hongbo-miao on 2025-06-22 04:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:28 UTC
    </footer>
</body>
</html>
