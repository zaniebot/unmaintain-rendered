<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv refuses to use a wheel that is definitely built using a matching python implementation - astral-sh/uv #3065</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv refuses to use a wheel that is definitely built using a matching python implementation</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3065">#3065</a>
        opened by <a href="https://github.com/kvelicka">@kvelicka</a>
        on 2024-04-16 16:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kvelicka">@kvelicka</a> on 2024-04-16 16:03</div>
            <div class="timeline-body"><p>I'm trying to pre-build some wheels for a Pyston based build pipeline. I've realised that using <code>uv pip install</code> appears to ignore my pre-built wheels. DEBUG/TRACE level logging doesn't seem to provide enough information as to why the wheel I built was unsuitable.</p>
<p>I managed to get the repro down to a <em>fairly</em> minimal Dockerfile, which will hopefully make this bug not too onerous to reproduce. It might be useful to run the Dockerfile using <code>DOCKER_BUILDKIT=0 docker build .</code> as doing it that way doesn't swallow logs/output (e.g. output of  <code>ls $HOME/wheels</code>). In the example I'm packaging <code>gevent</code>  but the issue isn't package specific AFAICT.</p>
<p>On my machine the last command fails with</p>
<pre><code>  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because gevent==24.2.1 is unusable because no wheels are available with
      a matching Python implementation and you require gevent==24.2.1, we can
      conclude that the requirements are unsatisfiable.
</code></pre>
<pre><code class="language-Dockerfile">
FROM ubuntu:22.04

RUN apt update &amp;&amp; apt install -qqy git curl build-essential libffi-dev

ENV HOME /root

ENV PYENV_ROOT $HOME/.pyenv
RUN git clone https://github.com/pyenv/pyenv.git $PYENV_ROOT
ARG PYTHON=pyston-2.3.5
RUN $PYENV_ROOT/bin/pyenv install $PYTHON
ENV PATH $PYENV_ROOT/versions/$PYTHON/bin:$PATH

RUN python -m pip install uv==0.1.32

RUN uv venv --seed /root/.venv
# Poor man's `activate` - can't just `activate` in a docker image
ENV PATH=&quot;/root/.venv/bin:$PATH&quot;

RUN mkdir $HOME/wheels
WORKDIR $HOME/wheels

RUN pip wheel --no-deps gevent==24.2.1

WORKDIR $HOME

RUN ls $HOME/wheels

RUN uv pip install --offline --find-links $HOME/wheels/ -v gevent==24.2.1

# alternative repro
# RUN uv pip install --only-binary ':all:' --find-links $HOME/wheels/ -v gevent==24.2.1


</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-16 16:38</div>
            <div class="timeline-body"><p>Thanks for the clear repro. I was able to reproduce but haven't yet dug into what's happening.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kvelicka">@kvelicka</a> on 2024-04-16 16:59</div>
            <div class="timeline-body"><p>Actually it's worth mentioning #1681 here, as the repro above is a reduced example of how we use the <code>pip wheel</code> command.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-04-18 03:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 04:00</div>
            <div class="timeline-body"><p>(Still on my list to look into this.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 05:05</div>
            <div class="timeline-body"><p>The problem is that <code>sys.implementation.version</code> is return 3.8, when it should be returning 2.3, I guess? So we're looking for a wheel like <code>pyston38-pyston_38</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 05:06</div>
            <div class="timeline-body"><p>Is this a Pyston bug? I'm confused.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 05:07</div>
            <div class="timeline-body"><blockquote>
<p>version is a named tuple, in the same format as sys.version_info. It represents the version of the Python implementation. This has a distinct meaning from the specific version of the Python language to which the currently running interpreter conforms, which sys.version_info represents. For example, for PyPy 1.8 sys.implementation.version might be sys.version_info(1, 8, 0, 'final', 0), whereas sys.version_info would be sys.version_info(2, 7, 2, 'final', 0). For CPython they are the same value, since it is the reference implementation.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 05:08</div>
            <div class="timeline-body"><p>But in the above, I see <code>sys.version_info(major=3, minor=8, micro=12, releaselevel='final', serial=0)</code>. So I don't see how I would get <code>pyston_23</code>, where is it exposed? ðŸ¤”</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 05:12</div>
            <div class="timeline-body"><p>Wow, I guess you're supposed to do something like this? https://github.com/isabella232/tox-gh/blob/b3f9ac0150f30be765ada0dcde8b4eb18f7373a6/src/tox_gh/plugin.py#L35</p>
<p>I got there from reading https://github.com/pyston/pyston/issues/39.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 05:13</div>
            <div class="timeline-body"><p>Yeah, that does return <code>sys.version_info(major=2, minor=3, micro=5, releaselevel='final', serial=0)</code>. Interesting. Why on Earth don't they return that from <code>sys.implementation.version</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kvelicka">@kvelicka</a> on 2024-04-18 08:34</div>
            <div class="timeline-body"><p>Thanks a lot of looking into this. I hoped that this was something about it being not-cpython rather than a Pyston-specific quirk but sounds like latter is the case. Hopefully you can find some simple fix/workaround for this but if that's looking unlikely it's probably not the end of the word - I expect uv's Pyston userbase to be a vanishingly small percentage of all users so no hard feelings if this ends up as wontfix!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-04-20 01:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2024-04-20 01:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-20 02:00</div>
            <div class="timeline-body"><p>Hmm yeah, I think I'm gonna close this as wontfix. I changed our logic to return the <code>pyston_version_info</code> when present, but the wheels still aren't quite working. I'm confused because the wheel tag is <code>pyston38-pyston_23_aarch64_linux_gnu-linux_aarch64</code>, but I feel like it should be... <code>pyston38_pyston_23-aarch64_linux_gnu-linux_aarch64</code>, since we split on <code>-</code>? I'm sure I'm wrong, but it's hard to justify investing deeply in it -- sorry about that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-20 02:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-14 02:05</div>
            <div class="timeline-body"><p>I'm realizing that I misread the tag. It's <code>pyston38-pyston_23_aarch64_linux_gnu-linux_aarch64</code>, which is (<code>pyston38</code>, <code>pyston_23_aarch64_linux_gnu</code>, <code>linux_aarch64</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kvelicka">@kvelicka</a> on 2025-01-16 21:30</div>
            <div class="timeline-body"><p>Does that mean that this is more viable than previously anticipated or not really? Thanks!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
