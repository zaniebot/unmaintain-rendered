<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expose flag to enable dependency resolution based on packages that were available on a target date - astral-sh/uv #2088</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Expose flag to enable dependency resolution based on packages that were available on a target date</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2088">#2088</a>
        opened by <a href="https://github.com/namurphy">@namurphy</a>
        on 2024-02-29 16:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/namurphy">@namurphy</a></div>
            <div class="timeline-body"><p>It would be helpful to have a way to solve for dependencies with constraints on the dates that dependencies were released.  For example, I would like to be able to solve for an environment based on what was available two years ago.</p>
Possible interface
<p>My first thought was to have a <code>--target-date</code> flag. Doing <code>uv pip compile astropy --target-date=&quot;2015-04-01&quot;</code> would solve the environment based on what the pythoniverse was like on 2015 April 1, and exclude versions of packages that were released after that date.  But, I am totally open to other possibilities!</p>
Use cases
<ul>
<li><strong>Continuous integration testing</strong> â€” Packages typically run test suites in multiple environments (e.g., different Python versions, lowest allowed dependencies, different versions of NumPy, etc.).  Having a way to solve for an environment on a particular date would be a straightforward way of generating different test environments. Instead of doing both the oldest and newest environments possible, it&#x27;d be straightforward to do some intermediate dates.</li>
<li><a href="https://scientific-python.org/specs/spec-0000/"><strong>SPEC 0</strong></a> proposes a policy for the scientific pythoniverse that &quot;support for core package dependencies be dropped 2 years after their initial release.&quot; The capability proposed here would make it a lot easier to figure out when to drop dependencies.</li>
<li><strong>Reproducing years-old scientific research.</strong>  If we want to reproduce research from an old Jupyter notebook, it is helpful to have a way to recreate a Python environment from the time the notebook was written.  The Jupyter notebook could have been a supplement to a research publication, or one of our own that we haven&#x27;t touched in a few years.</li>
<li><strong>Creating an environment to run a package that is no longer being maintained.</strong>  If a package was last updated in 2014, it&#x27;s likely that it will not work with the newest versions of its dependencies. Being able to solve for an environment based on a particular target date could make it easier to get this old code running again.</li>
</ul>
Alternatives
<ul>
<li>With regards to SPEC 0 compliance, I&#x27;ve usually looked up packages on PyPI and updated our <code>pyproject.toml</code> manually.  This suffices for small use cases but doesn&#x27;t scale well.</li>
<li>Creating a standalone package would be a possibility, but it would lead to a more fragmented packaging landscape, and I don&#x27;t think it would be likely to happen.</li>
<li>The <code>--resolution=lowest</code> and <code>--resolution=lowest-direct</code> flags address some of the continuous integration testing use case above. (These flags are awesome, and the reason why I switched to using <code>uv</code>!)</li>
<li>I thought about also having flags for a minimum date. A flag for a minimum date may be useful in conjunction with <code>--resolution=lowest</code> to handle situations where a package doesn&#x27;t list a minimum version of a dependency and we want to avoid ending up with <code>v0.0.1</code>.  However, <code>--resolution=lowest-direct</code> would probably suffice for those situations.</li>
</ul>
<p>Thank you so much for creating an awesome tool!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 16:50</div>
            <div class="timeline-body"><p>Hi! Thanks for including so much context in your writeup. We do actually support this already, but it&#x27;s hidden</p>
<p>See:</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/1358</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 16:52</div>
            <div class="timeline-body"><p>@charliermarsh should we just expose this flag?</p>
<p>@namurphy would you expect unsolvable requirement errors to pretend these packages do not exist at all or explain that it was unsolvable because newer packages were excluded?</p>
<p>I think I would want to add an environment variable that toggles that behavior so we can omit the message in our test suite but expose it to users. Otherwise, errors can be very confusing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Enable dependency resolution based on packages that were available on a target date&quot; to &quot;Expose flag to enable dependency resolution based on packages that were available on a target date&quot; by <a href="https://github.com/namurphy">@namurphy</a> on 2024-02-29 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/namurphy">@namurphy</a> on 2024-02-29 17:20</div>
            <div class="timeline-body"><p>Awesome!  I love it when the time to issue resolution is negative!  (Next time, I&#x27;ll take a look back through the closed issues &amp; PRs instead of just the open ones!)</p>
<p>I updated the title of this issue accordingly: to expose this option when it is stable enough to be part of the public API.</p>
<blockquote>
<p>@namurphy would you expect unsolvable requirement errors to pretend these packages do not exist at all or explain that it was unsolvable because newer packages were excluded?</p>
</blockquote>
<p>I&#x27;d prefer the latter, since it would be useful information to know that there is a newer package available.</p>
<p>Thank you again!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-29 17:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-01 11:01</div>
            <div class="timeline-body"><p>I&#x27;m +1 on exposing <code>--exclude-newer</code>, i initially intended it for those use cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/zanieb">@zanieb</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-01 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-04 06:25</div>
            <div class="timeline-body"><p>I&#x27;d love for this to be a documented feature! Currently attempting to use it in <a href="https://github.com/python/typing_extensions/pull/348">python/typing_extensions#348</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-04 17:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:30:08 UTC
    </footer>
</body>
</html>
