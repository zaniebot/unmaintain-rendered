<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv run not respecting extra index preferences in cargo build vs pip install in a conda env - astral-sh/uv #6358</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv run not respecting extra index preferences in cargo build vs pip install in a conda env</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6358">#6358</a>
        opened by <a href="https://github.com/abazabaaa">@abazabaaa</a>
        on 2024-08-21 17:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/abazabaaa">@abazabaaa</a></div>
            <div class="timeline-body"><p>Hi,</p>
<p>I believe this to be a bug.</p>
<p>When creating a micromamba env (micromamba -n test2 python=3.11) and then installing uv with pip I am able to run the following and get a successful installation:
<code>uv pip install openeye-toolkits</code>
uv pip install openeye-toolkits
Resolved 1 package in 1.04s
░░░░░░░░░░░░░░░░░░░░ [0/1] Installing wheels...                                                                                                                   warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance.
If the cache and target directories are on different filesystems, hardlinking may not be supported.
If this is intentional, set <code>UV_LINK_MODE=copy</code> or use <code>--link-mode=copy</code> to suppress this warning.
Installed 1 package in 20.55s</p>
<ul>
<li>openeye-toolkits==2024.1.1</li>
</ul>
<p>When I create the python script (this time using the cargo install of uv, ~/.cargo/bin/uv) below:
<code>uv add --script openeyetest.py &quot;openeye-toolkits&quot; &quot;numpy&quot;</code>
<code># /// script</code>
<code># requires-python = &quot;&gt;=3.12&quot;</code>
<code># dependencies = [</code>
<code>#     &quot;openeye-toolkits&quot;,</code>
<code>#     &quot;numpy&quot;,</code>
<code># ]</code>
<code># ///</code></p>
<p><code>from openeye import oechem, oegraphsim</code>
<code>import numpy as np</code></p>
<p><code># Create an OEBitVector object from a molecule fingerprint</code>
<code>mol = oechem.OEGraphMol()</code>
<code>oechem.OEParseSmiles(mol,&#x27;c1ccccc1&#x27;)</code>
<code>fp = oegraphsim.OEFingerPrint()</code>
<code>oegraphsim.OEMakeMACCS166FP(fp, mol)</code></p>
<p><code>bitv = [0]*fp.GetSize()</code></p>
<p><code># bitv = np.array([0]*fp.GetSize())</code>
<code>bit = fp.FirstBit()</code>
<code>while bit != -1:</code>
<code>bitv[bit]=1</code>
<code>bit=fp.NextBit(bit)</code></p>
<p><code>packed = np.packbits(bitv)</code>
<code>unpacked = np.unpackbits(packed)</code>
<code>print(packed)</code>
<code>print(unpacked)</code></p>
<p>I then do:
<code>uv run openeyetest.py</code>
Reading inline script metadata from: openeyetest.py
× No solution found when resolving script dependencies:
╰─▶ Because there are no versions of openeye-toolkits and you require openeye-toolkits, we can conclude that your requirements are unsatisfiable.</p>
<p>My ~/.uv/uv.toml is as follows (truncated paths and removed token):
[pip]
index-url = &quot;xxxx.com/simple/&quot;
extra-index-url = [&quot;https://token:xxxxxxxx@magpie.eyesopen.com/simple&quot;, &quot;https://download.pytorch.org/whl/cu121&quot;]</p>
<p>I have additionally tried various versions of python in the header of openeyetest.py (python==3.11.9 ; which works with the openeye-toolkits). I have exported the path to uv.toml so that it was set (export UV_CONFIG_FILE=/xxx/uv.toml)</p>
<p>uv --version
uv 0.3.0</p>
<p>Other than this, things seem to be working ok.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:21</div>
            <div class="timeline-body"><p>Yeah this looks wrong. We should be respecting the configuration there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:21</div>
            <div class="timeline-body"><p>Just clarifying, it <em>does not</em> work even with <code>UV_CONFIG_FILE=...</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abazabaaa">@abazabaaa</a> on 2024-08-21 17:24</div>
            <div class="timeline-body"><p>Correct, is does not seem to make a difference.</p>
<p>export UV_CONFIG_FILE=/xxxxxx/uv.toml
<code>uv run openeyetest.py</code>
Reading inline script metadata from: openeyetest.py
× No solution found when resolving script dependencies:
╰─▶ Because there are no versions of openeye-toolkits and you require openeye-toolkits, we can conclude that your requirements are unsatisfiable.</p>
<p>I can see it correctly set in the help.
<code>uv --help</code>
...
Global options:
-q, --quiet                      Do not print any output
-v, --verbose...                 Use verbose output
--color &lt;COLOR_CHOICE&gt;       Control colors in output [default: auto] [possible values: auto, always, never]
--native-tls                 Whether to load TLS certificates from the platform&#x27;s native certificate store [env: UV_NATIVE_TLS=]
--offline                    Disable network access
--no-progress                Hide all progress outputs
--config-file &lt;CONFIG_FILE&gt;  The path to a <code>uv.toml</code> file to use for configuration [env: UV_CONFIG_FILE=/xxxxxv/uv.toml]
--no-config                  Avoid discovering configuration files (<code>pyproject.toml</code>, <code>uv.toml</code>) [env: UV_NO_CONFIG=]
-h, --help                       Display the concise help for this command
-V, --version                    Display the uv version</p>
<p>Use <code>uv help</code> for more details.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:24</div>
            <div class="timeline-body"><p>Ok thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abazabaaa">@abazabaaa</a> on 2024-08-21 17:45</div>
            <div class="timeline-body"><p>Just to further confirm this with an internal pypi server which I have in my uv.toml as my index-url:
[pip]
index-url = &quot;xxxx.com/simple/&quot;
extra-index-url = [&quot;https://token:<a href="mailto:xxxxxxxx@magpie.eyesopen.com">xxxxxxxx@magpie.eyesopen.com</a>/simple&quot;, &quot;https://download.pytorch.org/whl/cu121&quot;]</p>
<p>I was unable to run pydingertest.py  after adding &quot;pydinger&quot; with <code>uv add --script pydingertest.py &quot;pydinger&quot;</code>
<code>uv run pydingertest.py</code>
Reading inline script metadata from: pydingertest.py
× No solution found when resolving script dependencies:
╰─▶ Because pydinger was not found in the package registry and you require pydinger, we can conclude that your requirements are unsatisfiable.</p>
<p>It was successful in the micromamba env with the same version of uv (0.3).</p>
<p><code>micromamba activate test2</code>
<code>uv pip install pydinger</code>
Resolved 23 packages in 14.19s
Built pydinger==1.0.3
Built ldclient==2023.2.2
Prepared 8 packages in 6.45s
░░░░░░░░░░░░░░░░░░░░ [0/22] Installing wheels...                                                                                                                  warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance.
If the cache and target directories are on different filesystems, hardlinking may not be supported.
If this is intentional, set <code>UV_LINK_MODE=copy</code> or use <code>--link-mode=copy</code> to suppress this warning.
Installed 22 packages in 31.93s</p>
<ul>
<li>annotated-types==0.7.0</li>
<li>certifi==2024.7.4</li>
<li>charset-normalizer==3.3.2</li>
<li>deprecated==1.2.10</li>
<li>dill==0.3.8</li>
<li>idna==3.7</li>
<li>ldclient==2023.2.2</li>
<li>multiprocess==0.70.16</li>
<li>numpy==2.1.0</li>
<li>pandas==2.2.2</li>
<li>pydantic==2.8.2</li>
<li>pydantic-core==2.20.1</li>
<li>pydinger==1.0.3</li>
<li>python-dateutil==2.9.0.post0</li>
<li>pytz==2024.1</li>
<li>requests==2.32.3</li>
<li>six==1.16.0</li>
<li>tqdm==4.66.5</li>
<li>typing-extensions==4.12.2</li>
<li>tzdata==2024.1</li>
<li>urllib3==2.2.2</li>
<li>wrapt==1.16.0</li>
</ul>
<p>So it seems that our internal pypi server is not getting searched on the cargo version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:50</div>
            <div class="timeline-body"><p>Oh sorry -- can you change:</p>
<pre><code>[pip]
index-url = &quot;xxxx.com/simple/&quot;
extra-index-url = [&quot;https://token:[xxxxxxxx@magpie.eyesopen.com](mailto:xxxxxxxx@magpie.eyesopen.com)/simple&quot;, &quot;https://download.pytorch.org/whl/cu121&quot;]
</code></pre>
<p>To:</p>
<pre><code>index-url = &quot;xxxx.com/simple/&quot;
extra-index-url = [&quot;https://token:[xxxxxxxx@magpie.eyesopen.com](mailto:xxxxxxxx@magpie.eyesopen.com)/simple&quot;, &quot;https://download.pytorch.org/whl/cu121&quot;]
</code></pre>
<p>Settings under <code>[pip]</code> only apply to <code>uv pip</code>, but settings at the top-level apply everywhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abazabaaa">@abazabaaa</a> on 2024-08-21 17:56</div>
            <div class="timeline-body"><p>Fixed!!</p>
<p>So just to be clear, I can also have a [pip] so that my uv pip works the same?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:58</div>
            <div class="timeline-body"><p>If you write it without <code>[pip]</code>, it will <em>also</em> affect <code>uv pip</code>. It&#x27;s just that if you write it with <code>[pip]</code>, it <em>doesn&#x27;t</em> affect <code>uv run</code> and other APIs. Does that make sense?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 17:58</div>
            <div class="timeline-body"><p>In other words, you only need the version without <code>[pip]</code>.</p>
<p>(We kept the <code>[pip]</code> table for backwards compatibility.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abazabaaa">@abazabaaa</a> on 2024-08-21 17:59</div>
            <div class="timeline-body"><p>Yes, it makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 01:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:33:00 UTC
    </footer>
</body>
</html>
