<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better Error Handling for Bad PyPIs - astral-sh/uv #7257</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better Error Handling for Bad PyPIs</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7257">#7257</a>
        opened by <a href="https://github.com/CF-FHB-X">@CF-FHB-X</a>
        on 2024-09-10 15:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CF-FHB-X">@CF-FHB-X</a></div>
            <div class="timeline-body"><p>Hi there!</p>
<p>I&#x27;m trying to move over from <code>Poetry</code> to <code>uv</code>, but I&#x27;m running into an issue with one of the internal PyPIs that our Nexus is proxying. When I run <code>uv add package_name</code>, I get the following error:</p>
<pre><code>error: Received some unexpected HTML from https://url.to.nexus/repository/pypi/simple/package_name/
  Caused by: Unexpected fragment (expected &#x27;#sha256=...&#x27; or similar) on URL: main
</code></pre>
<p>For some reason that downstream repo has a bunch of &quot;fluff&quot; for each package&#x27;s endpoint (i.e., instead of just listing all the packages with their hashes, it also has links like &quot;About&quot;, &quot;Documentation&quot;, etc.). I suspect it&#x27;s because that PyPI is a custom deployment (caveat: I have zero input on our Nexus, and even less than zero input on that downstream custom PyPI). If I don&#x27;t include any packages that reside on that custom downstream repo, <code>uv</code> works <em>great</em>, but the moment I need anything on that custom repo, bam. Errors.</p>
<p>Is there some setting for <code>uv</code> where it can ignore situations like this? Something along the lines of a <code>--ignore-fragments</code> or something more appropriate?</p>
<p>I&#x27;m running <code>uv</code> v0.4.7 and running on Windows 11. I&#x27;ve tested this on Python 3.10 through 3.12.</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 02:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 02:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CF-FHB-X">@CF-FHB-X</a> on 2024-10-30 18:26</div>
            <div class="timeline-body"><p>Just curious if there&#x27;s any extra info on whether this can be added to a future version or not? If there&#x27;s something I can help with, more than happy to!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mulliken">@mulliken</a> on 2025-01-29 22:53</div>
            <div class="timeline-body"><p>I think I am running into the same issue and would be interested in any updates.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-29 23:24</div>
            <div class="timeline-body"><p>@mulliken can you share the error? Without providing more details about your situation, we can&#x27;t use your comment as further motivation for adding this feature.</p>
<p>@CF-FHB-X Sorry for the lack of reply. It seems generally hard to support non-compliant indexes. I think we&#x27;re only likely to take action here if see more use-cases and have a better understanding of the patterns present in these indexes. Does pip work with this index?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CF-FHB-X">@CF-FHB-X</a> on 2025-01-30 16:37</div>
            <div class="timeline-body"><p>@zanieb Yes, <code>pip</code> and <code>Poetry</code> both work with that particular repo without any issues. My feeling is that <code>uv</code> is seeing those non-package HTML links and isn&#x27;t able to parse them correctly (maybe it&#x27;s expecting certain parts to be there like the hash?), hence the <code>unexpected HTML</code> error. Maybe I&#x27;m oversimplifying it, but would it just be an issue of adding in some error handling for that particular part where a non-standard HTML link that can&#x27;t be parsed is just ignored (or instead throws a warning instead of an error)?</p>
<p>I&#x27;m sure there&#x27;s more going on in the backend that I&#x27;m not aware of, but I also know how those Nexus repos have caused issues in the past with indexes that are either out of date or have those extra HTML links in there. Both <code>pip</code> and <code>Poetry</code> seem to be able to handle them (although <code>Poetry</code> doesn&#x27;t like out of date indexes where files are missing).</p>
<p>Hope that helps!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-30 16:45</div>
            <div class="timeline-body"><p>Sigh... I think we should probably not throw a hard error here. It&#x27;s not explicitly forbidden by the spec (including a SHA as a fragment is a SHOULD, and it doesn&#x27;t say anything about other kinds of fragments). I&#x27;m annoyed by it, though!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CF-FHB-X">@CF-FHB-X</a> on 2025-01-30 17:04</div>
            <div class="timeline-body"><p>You&#x27;d be surprised by the number of times &quot;annoyed&quot; and &quot;Nexus&quot; show up together... But happy to test out any changes on this goofy repo, though! Just let me know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-30 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-30 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CF-FHB-X">@CF-FHB-X</a> on 2025-01-30 19:21</div>
            <div class="timeline-body"><p>Awesome - thanks for that fix! I&#x27;ll keep you posted when that version is released.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CF-FHB-X">@CF-FHB-X</a> on 2025-02-10 21:07</div>
            <div class="timeline-body"><p>Sorry for the delay in replying (got sidetracked with a couple of other things), but everything is working like a charm now!</p>
<p>Thanks again!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:33:53 UTC
    </footer>
</body>
</html>
