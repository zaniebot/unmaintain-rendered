<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add additional Color Environment Variables+Values - astral-sh/uv #7352</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add additional Color Environment Variables+Values</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7352">#7352</a>
        opened by <a href="https://github.com/TheRealBecks">@TheRealBecks</a>
        on 2024-09-13 08:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TheRealBecks">@TheRealBecks</a></div>
            <div class="timeline-body">

<p>I&#x27;m running <code>uv</code> version <code>0.4.9</code> on Opensuse Tumbleweed (rolling release).</p>
<p>In #3955 the color environment variables have been improved, but when executing <code>uv run ansible-playbook ...</code> I don&#x27;t get an colored output, but it&#x27;s working when activating the virtual environment with <code>sources ...</code> and exucuting <code>ansible-playbook ...</code>.</p>
<p>Until now the <code>uv run</code> command never supported colored output on my system. As I can see my system has other environemnt variables set then mentioned in #3955:</p>
<pre><code>‚ùØ printenv | grep -i color
COLORTERM=truecolor
COLORFGBG=15;0
TERM=xterm-256color
</code></pre>
<p>As far as I found out the following variables+values are used for declaring color support:</p>
<pre><code>COLORTERM=truecolor
COLORTERM=24bit
</code></pre>
<p>...additionally to the variables+values you already check üòâ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2024-09-13 09:41</div>
            <div class="timeline-body"><p>I checked further what&#x27;s going in in the Linux and Unix world and therefore it&#x27;s always good to check what the <a href="https://github.com/Textualize/rich">rich</a> team is doing:</p>
<p>They are using these variables+values to check for coloring in their tests:</p>
<p>https://github.com/Textualize/rich/blob/e9f75c9912ed25b9777bc0257853370951220b17/tests/test_console.py#L984-L992</p>
<p>--&gt;</p>
<pre><code>&quot;FORCE_COLOR&quot;: &quot;1&quot;,
&quot;TERM&quot;: &quot;xterm-256color&quot;,
&quot;COLORTERM&quot;: &quot;truecolor&quot;,
</code></pre>
<p>Over here they are parsing the following environment variables:</p>
<p>https://github.com/Textualize/rich/blob/e9f75c9912ed25b9777bc0257853370951220b17/rich/diagnose.py#L17-L29</p>
<p>--&gt;</p>
<pre><code>&quot;TERM&quot;,
&quot;COLORTERM&quot;,
&quot;CLICOLOR&quot;,
&quot;NO_COLOR&quot;,
</code></pre>
<p><code>CLICOLOR</code> color is for MAC based systems told me the internet.</p>
<p>So these ones are needed for Linux and MAC:</p>
<pre><code>&quot;TERM&quot;: &quot;xterm-256color&quot;,
&quot;COLORTERM&quot;: &quot;truecolor&quot;,
&quot;CLICOLOR&quot;: &quot;1&quot;,

# You already check for these ones?
&quot;FORCE_COLOR&quot;: &quot;1&quot;,
&quot;NO_COLOR: &quot;1&quot;&quot;,
</code></pre>
<p>They are not checking for <code>COLORTERM=24bit</code>, but I found several Google entries for searching <code>&quot;COLORTERM=24bit&quot;</code> (with <code>&quot;</code> included).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-13 13:12</div>
            <div class="timeline-body"><p>I think some of those are already checked in <code>anstream</code> which we use for color detection: https://github.com/rust-cli/anstyle/blob/c2ee0d95bf619b721da004f69fd69a46c5fc51b8/crates/anstyle-query/src/lib.rs#L55. It looks like <code>&quot;TERM&quot;: &quot;xterm-256color&quot;</code> should be sufficient to enable color? So not sure why you aren&#x27;t seeing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-13 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-13 13:12</div>
            <div class="timeline-body"><p>How can I reproduce?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2024-09-16 12:05</div>
            <div class="timeline-body"><p>I added a <a href="https://github.com/TheRealBecks/uv-test-coloring">test repository</a> with a README.md.</p>
<p>I found out that Ansible is using the <code>curses</code> module that can be tested as follows:</p>
<pre><code>import curses

curses.setupterm()
print(curses.tigetnum(&quot;colors&quot;))
</code></pre>
<p>If the terminal supports coloring we will get a positive integer as return value (like <code>256</code>), if not we will get a negative number.</p>
<p>When <strong>not</strong> using a virtual environment both Python 3.11 and 3.12 return <code>256</code>. But then using a virtual environment with <code>uv</code> or <code>pipenv</code> I get the following results:</p>
<p>The output of Python 3.11:</p>
<pre><code>$ python test_curses.py 
256
</code></pre>
<p>...and Python 3.12:</p>
<pre><code>python test_curses.py 
Traceback (most recent call last):
  File &quot;/home/mbeckert/Entwicklung/Sonstiges/uv-test-coloring/test_curses.py&quot;, line 3, in &lt;module&gt;
    curses.setupterm()
_curses.error: setupterm: could not find terminfo database
</code></pre>
<p>üôÉ</p>
<p>So maybe that&#x27;s a curses bug in Python 3.12?</p>

<p>UPDATE: I found out what&#x27;s going on here! üôÇ I will write another comment today, but I need to check some documentations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2024-09-16 13:29</div>
            <div class="timeline-body"><p>Regarding the coloring: That was a bug in Python <code>3.12.0</code>, but has been fixed in <code>3.12.x</code>. I wondered why I had Ansible workign with coloring in some cases, but my test cases had no colering at all. So I checked my Python versions:</p>
<p>There seems to be something odd with the Python version as <code>uv</code> used <code>3.12.0</code> instead of <code>3.12.5</code>. So I did some tests with the version defined in <code>pyproject.toml</code>. I did not delete the <code>uv.lock</code> file for these test cases, but used <code>uv sync</code> after I changed the <code>requires-python</code> key.</p>
<p>I started with <code>requires-python = &quot;==3.12&quot;</code> that lead to <code>3.12.0</code>. When changing to <code>==3.11</code>:</p>
<pre><code>error: No interpreter found for Python ==3.11 in managed installations or system path
</code></pre>
<p>-&gt; Which is correct, but from a user perspective I would not expect this message as there&#x27;s <code>3.11.9</code> installed on my system. It would be good if the error message gives a clear message that <code>uv</code> searched for version <code>3.11.0</code> that&#x27;s not been installed on my system.</p>
<p>Now changing to <code>&gt;=3.11</code> still leads to version <code>3.12.0</code> as that has been choosen by <code>uv</code> in the first run.</p>
<p>So I see some problems from the user side:</p>
<ul>
<li>Many users do not know that there is a &quot;zero padding expansion&quot; seen <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#version-matching">here</a> when using <code>==3.11</code> which leads to version 3.11.0 if it&#x27;s installed on the system. Not sure what do about it... üòÄ</li>
<li>In your <a href="https://docs.astral.sh/uv/concepts/projects/#project-metadata">example</a> <code>&gt;=3.12</code> is used what I did not use for my projects as I don&#x27;t want Python <code>3.13.x</code> to be installed on new systems. So I wrongly choose <code>==3.12</code>. Instead I thing it would be best to use <code>~=3.12</code> and tell the people that it&#x27;s the same as using <code>==3.12.*</code> and <code>&gt;=3.12,&lt;3.13</code>. In that case all users copying your example will get a <code>3.12</code> version instead of <code>3.13</code> on newer OSes.</li>
</ul>
Wrapping up:
<ul>
<li>I used the wrong version identifier in the first place which resulted to <code>3.12.0</code></li>
<li>I did not expect <code>uv</code> to be stuck at <code>3.12.0</code> even if I changed the identifier to <code>~=3.12</code></li>
<li>I think it&#x27;s best to change the identifier in the documentation to <code>~=3.12</code> (or <code>==3.12.*</code>?) and describing what that means</li>
<li>And maybe pointing the interested user in a notice field to the <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/"><code>Version specifier</code></a> documentation?</li>
</ul>
<p>Does that make sense what I&#x27;m saying here? üòÄ</p>
Final words
<p>Thanks for your awesome software and support!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 13:41</div>
            <div class="timeline-body"><p>Created an issue for that specific problem <a href="https://github.com/astral-sh/uv/issues/7426">astral-sh/uv#7426</a></p>
<p>Thanks for investigating!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2024-09-16 13:47</div>
            <div class="timeline-body"><p>Is there a <code>uv</code> command that tells me if <code>uv</code> will color my console? Or do you know how I can test this?</p>
<p>My Ansible example isn&#x27;t working here, because they are using <code>curses</code> that checks my terminal environment variable <code>TERM=xterm-256color</code> itself (...that environment variable is <strong>not</strong> check by <code>uv</code>, am I right?). I still think it&#x27;s best to add these environemtn variables when checking for color support:</p>
<pre><code>&quot;TERM&quot;: &quot;xterm-256color&quot;,
&quot;COLORTERM&quot;: &quot;truecolor&quot;,
&quot;CLICOLOR&quot;: &quot;1&quot;,

# Maybe this one:
&quot;COLORTERM&quot;: &quot;24bit&quot;,

# You already check for these ones?
&quot;FORCE_COLOR&quot;: &quot;1&quot;,
&quot;NO_COLOR: &quot;1&quot;&quot;,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 13:51</div>
            <div class="timeline-body"><p>No we don&#x27;t have a command to check. You might want to open an issue <a href="https://github.com/rust-cli/anstyle">upstream</a> ‚Äî we&#x27;re not really experts on color selection and generally rely on the dependency to do &quot;the right thing&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2024-09-16 14:27</div>
            <div class="timeline-body"><p>Done from my side. Thanks for your input! I checked the upstream <code>anstyle</code> and their environment variable checking looks sane to me üôÇ</p>
<p>I opened #7429 for further discussion about Python versioning and the <code>uv</code> documentation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/TheRealBecks">@TheRealBecks</a> on 2024-09-16 14:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:00 UTC
    </footer>
</body>
</html>
