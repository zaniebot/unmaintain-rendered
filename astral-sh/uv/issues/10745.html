<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to define &amp; build dependencies for `magic-pdf[full]` in pyproject.toml? - astral-sh/uv #10745</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>How to define &amp; build dependencies for `magic-pdf[full]` in pyproject.toml?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10745">#10745</a>
        opened by <a href="https://github.com/hongbo-miao">@hongbo-miao</a>
        on 2025-01-19 01:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hongbo-miao">@hongbo-miao</a> on 2025-01-19 01:00</div>
            <div class="timeline-body"><h1>Background</h1>
<p>I have succeed installing <code>magic-pdf[full]</code> with Python 3.12 in Ubuntu 22 by using below way:</p>
<p><strong>pyproject.toml</strong></p>
<pre><code class="language-toml">[project]
name = &quot;mineru&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.12.0&quot;
dependencies = [
  &quot;detectron2&quot;,
  &quot;magic-pdf[full]==1.0.1&quot;
]

[tool.uv]
package = false
prerelease = &quot;allow&quot;

[tool.uv.sources]
detectron2 = { git = &quot;https://github.com/facebookresearch/detectron2.git&quot; }
</code></pre>
<p>Then I can install by</p>
<pre><code class="language-sh">uv venv
uv pip install torch
uv pip install --no-build-isolation git+https://github.com/facebookresearch/detectron2.git
uv sync --dev
</code></pre>
<p><strong>Notes:</strong></p>
<ul>
<li><code>magic-pdf[full]</code> has a dependency <code>detectron2</code> which does not have wheel, which is why I run <code>uv pip install --no-build-isolation git+https://github.com/facebookresearch/detectron2.git</code>.</li>
<li><code>detectron2</code> didn't define the dependency <code>torch</code> but requires it, which is why I manually run <code>uv pip install torch</code> before <code>detectron2</code>.</li>
<li><code>magic-pdf[full] 1.0.1</code> currently is using a pre-release dependency <code>paddlepaddle 3.0.0b1</code> which is why we need <code>prerelease = &quot;allow&quot;</code>, but in future, once magic-pdf relies on a formal release version of <code>paddlepaddle</code>, then no need <code>prerelease = &quot;allow&quot;</code>.</li>
</ul>
<h1>What I Try to Achieve</h1>
<p>Now I am trying to fully use <code>pyproject.toml</code> to define everything for <code>magic-pdf[full]</code> without manual running things like <code>uv pip install --no-build-isolation</code>.
For <code>detectron2</code> is a dependency for <code>magic-pdf[full]</code>, ideally if no need define in <code>dependencies = []</code> list in pyproject.toml, that would be great, as in the code, there is no code import <code>detectron2</code> directly.</p>
<p>Any guide would be appreciate, thanks! ☺️</p>
<p>I have read</p>
<ul>
<li>https://docs.astral.sh/uv/concepts/projects/config/#build-isolation</li>
<li>https://docs.astral.sh/uv/concepts/projects/dependencies/#default-groups</li>
</ul>
<p>Below are what I have tried.</p>
<h2>Experiments</h2>
<p>For below three experiments, when I try to run</p>
<pre><code class="language-sh">uv sync --extra build
uv sync --extra build --extra compile
</code></pre>
<p>They all failed at first step <code>uv sync --extra build</code> with error</p>
<pre><code class="language-sh">Resolved 220 packages in 2.83s
  × Failed to build `detectron2 @
  │ git+[https://github.com/facebookresearch/detectron2.git@9604f5995cc628619f0e4fd913453b4d7d61db3f`](https://github.com/facebookresearch/detectron2.git@9604f5995cc628619f0e4fd913453b4d7d61db3f%60)
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit
      status: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
      ModuleNotFoundError: No module named 'setuptools'

      hint: This usually indicates a problem with the package or the build
      environment.
  help: `detectron2` was included because `mineru` (v1.0.0) depends on
        `detectron2`
</code></pre>
<h2>Experiment 1 - using <code>project.optional-dependencies</code></h2>
<pre><code class="language-toml">[project]
name = &quot;mineru&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.12.0&quot;
dependencies = [
  &quot;detectron2&quot;,
  &quot;magic-pdf[full]==1.0.1&quot;,
]

[project.optional-dependencies]
build = [&quot;setuptools&quot;, &quot;torch&quot;]
compile = [&quot;detectron2&quot;]

[tool.uv]
package = false
prerelease = &quot;allow&quot;
no-build-isolation-package = [&quot;detectron2&quot;]

[tool.uv.sources]
detectron2 = { git = &quot;https://github.com/facebookresearch/detectron2.git&quot;, branch = &quot;main&quot; }
</code></pre>
<h2>Experiment 2 - using <code>[[tool.uv.dependency-metadata]]</code></h2>
<pre><code class="language-toml">[project]
name = &quot;mineru&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.12.0&quot;
dependencies = [
  &quot;detectron2&quot;,
  &quot;magic-pdf[full]==1.0.1&quot;,
]

[project.optional-dependencies]
build = [&quot;setuptools&quot;, &quot;torch&quot;]
compile = [&quot;detectron2&quot;]

[tool.uv]
package = false
prerelease = &quot;allow&quot;
no-build-isolation-package = [&quot;detectron2&quot;]

[[tool.uv.dependency-metadata]]
name = &quot;detectron2&quot;
version = &quot;0.6&quot;
requires-dist = [&quot;torch&quot;]

[tool.uv.sources]
detectron2 = { git = &quot;https://github.com/facebookresearch/detectron2.git&quot;, branch = &quot;main&quot; }
</code></pre>
<h2>Experiment 3 - using <code>[build-system]</code></h2>
<pre><code class="language-toml">[project]
name = &quot;mineru&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.12.0&quot;
dependencies = [
  &quot;detectron2&quot;,
  &quot;magic-pdf[full]==1.0.1&quot;,
]

[build-system]
requires = [&quot;setuptools&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[project.optional-dependencies]
build = [&quot;torch&quot;]
compile = [&quot;detectron2&quot;]

[tool.uv]
package = false
prerelease = &quot;allow&quot;
no-build-isolation-package = [&quot;detectron2&quot;]

[tool.uv.sources]
detectron2 = { git = &quot;https://github.com/facebookresearch/detectron2.git&quot;, branch = &quot;main&quot; }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "How to install `magic-pdf[full]` without manual `uv pip install --no-build-isolation`?" to "How to define dependencies for `magic-pdf[full]` in pyproject.toml?" by @hongbo-miao on 2025-01-19 01:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "How to define dependencies for `magic-pdf[full]` in pyproject.toml?" to "How to define & build dependencies for `magic-pdf[full]` in pyproject.toml?" by @hongbo-miao on 2025-01-19 02:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hongbo-miao">@hongbo-miao</a> on 2025-01-19 12:22</div>
            <div class="timeline-body"><p>I just succeed by doing this way. Please let me know if any place can be improved, thanks! ☺️</p>
<pre><code class="language-toml">[project]
name = &quot;mineru&quot;
version = &quot;1.0.0&quot;
requires-python = &quot;~=3.12.0&quot;

[project.optional-dependencies]
build = [&quot;setuptools&quot;, &quot;torch&quot;]
compile = [&quot;detectron2&quot;, &quot;magic-pdf[full]==1.0.1&quot;]

[tool.uv]
package = false
prerelease = &quot;allow&quot;
no-build-isolation-package = [&quot;detectron2&quot;]

[tool.uv.sources]
detectron2 = { git = &quot;https://github.com/facebookresearch/detectron2.git&quot;, branch = &quot;main&quot; }
</code></pre>
<p>Now I just need install by</p>
<pre><code class="language-sh">uv sync --extra=build
uv sync --extra=build --extra=compile
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @hongbo-miao on 2025-01-19 12:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:32:58 UTC
    </footer>
</body>
</html>
