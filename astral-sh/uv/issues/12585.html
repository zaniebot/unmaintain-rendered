<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect behavior of dependency group created by `uvx migrate-to-uv` - astral-sh/uv #12585</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect behavior of dependency group created by <code>uvx migrate-to-uv</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12585">#12585</a>
        opened by <a href="https://github.com/dandavison">@dandavison</a>
        on 2025-03-31 14:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dandavison">@dandavison</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The file https://github.com/temporalio/samples-python/blob/78dcff4023ae87d58ce6e4fb26353cb323f664c2/pyproject.toml was created by <code>uvx migrate-to-uv</code>.</p>
<p>This interaction with uv appears wrong:</p>
<ol>
<li>It's telling me to try the command which I issued</li>
<li>The error seems to contradict the hint</li>
</ol>
<pre><code>$ uv remove pyarrow --group cloud-export-to-parquet
hint: `pyarrow` is in the `cloud-export-to-parquet` group (try: `uv remove pyarrow --group cloud-export-to-parquet`)
error: The dependency `pyarrow` could not be found in `dependency-groups.cloud-export-to-parquet`
</code></pre>
<p>This occurs with <code>0.6.11</code> and current <code>main</code> (c1b49b9ab22b4cc4e98dd7e3bb2f7deab9b7e4e8).</p>
<p>On deleting <code>uv.lock</code> and manually removing <code>pyarrow</code>, another confusing interaction with <code>uv</code> resulted when I tried:</p>
<pre><code>samples-python(uv) uv add pyarrow --group cloud_export_to_parquet
error: Failed to parse `pyproject.toml`
  Caused by: TOML parse error at line 17, column 1
   |
17 | [dependency-groups]
   | ^^^^^^^^^^^^^^^^^^^
duplicate dependency group: `cloud-export-to-parquet`
</code></pre>
<p>The change it made to <code>pyproject.toml</code> was</p>
<pre><code class="language-toml">cloud_export_to_parquet = [
    &quot;pandas&gt;=2.2.2,&lt;3 ; python_version &gt;= '3.9' and python_version &lt; '4.0'&quot;,
    &quot;numpy&gt;=1.26.0,&lt;2 ; python_version &gt;= '3.9' and python_version &lt; '3.13'&quot;,
    &quot;boto3&gt;=1.34.89,&lt;2&quot;,
]
cloud-export-to-parquet = [
    &quot;pyarrow&quot;,
]
</code></pre>
<p>(Same error whether one uses <code>--group cloud-export-to-parquet</code> or <code>--group cloud_export_to_parquet</code>)</p>
<h3>Platform</h3>
<p>MacOS arm</p>
<h3>Version</h3>
<p><code>0.6.11</code> and current <code>main</code> (c1b49b9ab22b4cc4e98dd7e3bb2f7deab9b7e4e8)</p>
<h3>Python version</h3>
<p>Python 3.13.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dandavison on 2025-03-31 14:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-31 14:03</div>
            <div class="timeline-body"><p>Probably the same bug, my guess is that the <code>pyproject.toml</code> code isn't normalizing the groups when comparing / searching / etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-03-31 14:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dandavison">@dandavison</a> on 2025-03-31 14:05</div>
            <div class="timeline-body"><p>Yes, <code>uv add pyarrow --group cloud-export-to-parquet</code> works as expected if the group name uses dashes in <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-03-31 14:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:43 UTC
    </footer>
</body>
</html>
