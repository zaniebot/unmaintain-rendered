<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to build HTTP client, could not load PEM file - astral-sh/uv #1701</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Failed to build HTTP client, could not load PEM file</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1701">#1701</a>
        opened by <a href="https://github.com/mattmess1221">@mattmess1221</a>
        on 2024-02-19 15:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mattmess1221">@mattmess1221</a> on 2024-02-19 15:54</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>All commands that connect to the internet are failing when trying to load the local CAFILE. I do have some private certs installed, so it may be related.</p>
<p>Command: <code>uv venv --seed</code>
Platform: Debian 10
UV Version: 0.1.5
<a href="https://gist.github.com/killjoy1221/b7406351afb186b9842f765e1ee7bcf7">ca-certificates.crt</a></p>
<p>The cafile loaded fine in uv 0.1.2, so this is a regression.</p>
<p>Error output:</p>
<pre><code>$ uv --version
uv 0.1.5
$ RUST_BACKTRACE=full uv venv --seed 
Using Python 3.11.0 interpreter at /usr/software/pkgs/Python-3.11.0/bin/python3.11
Creating virtualenv at: .venv
thread 'main' panicked at crates/uv-client/src/registry_client.rs:87:33:
Failed to build HTTP client.: reqwest::Error { kind: Builder, source: Custom { kind: InvalidData, error: &quot;Could not load PEM file \&quot;/usr/lib/ssl/certs/ca-certificates.crt\&quot;: Invalid byte 32, offset 0.&quot; } }
stack backtrace:
   0:     0x55ed8874602c - &lt;unknown&gt;
   1:     0x55ed88779150 - &lt;unknown&gt;
   2:     0x55ed88741f4f - &lt;unknown&gt;
   3:     0x55ed88745e14 - &lt;unknown&gt;
   4:     0x55ed88747c77 - &lt;unknown&gt;
   5:     0x55ed887479df - &lt;unknown&gt;
   6:     0x55ed887480f8 - &lt;unknown&gt;
   7:     0x55ed88747fde - &lt;unknown&gt;
   8:     0x55ed887464f6 - &lt;unknown&gt;
   9:     0x55ed88747d42 - &lt;unknown&gt;
  10:     0x55ed87792cf5 - &lt;unknown&gt;
  11:     0x55ed87793233 - &lt;unknown&gt;
  12:     0x55ed87e42a26 - &lt;unknown&gt;
  13:     0x55ed87af85ec - &lt;unknown&gt;
  14:     0x55ed87afda1d - &lt;unknown&gt;
  15:     0x55ed87adac96 - &lt;unknown&gt;
  16:     0x55ed879e7776 - &lt;unknown&gt;
  17:     0x55ed87b23831 - &lt;unknown&gt;
  18:     0x55ed878436e3 - &lt;unknown&gt;
  19:     0x55ed87ac5499 - &lt;unknown&gt;
  20:     0x55ed88737937 - &lt;unknown&gt;
  21:     0x55ed87ac548e - &lt;unknown&gt;
  22:     0x7f20f290ad0a - __libc_start_main
  23:     0x55ed87793549 - &lt;unknown&gt;
  24:                0x0 - &lt;unknown&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattmess1221">@mattmess1221</a> on 2024-02-19 16:19</div>
            <div class="timeline-body"><p>Likely introduced by #1512</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-02-19 17:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-19 17:12</div>
            <div class="timeline-body"><p>Presumably the certificate was not being loaded at all prior to #1512, is it a valid certificate? This might be an upstream bug.</p>
<p>I wonder if we can fallback to using bundled certificates if we fail to load the system store like this, cc @BurntSushi</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattmess1221">@mattmess1221</a> on 2024-02-19 17:36</div>
            <div class="timeline-body"><p>curl/openssl is able to load it fine, so I would assume so.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1819.html">astral-sh/uv#1819</a> on 2024-02-21 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-22 22:46</div>
            <div class="timeline-body"><p>I'm not sure what to do about this, unfortunately. You may need to open this as an issue upstream or do some more debugging yourself. We're not in control of certificate validation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @zanieb on 2024-02-22 22:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattmess1221">@mattmess1221</a> on 2024-02-26 19:58</div>
            <div class="timeline-body"><p>I figured out the issue was caused by there being indentation in the pem file (for some reason). I've created an issue upstream at rustls/pemfile#40</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-26 23:06</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @zanieb on 2024-02-26 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by @zanieb on 2024-02-26 23:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">network</span> added by @zanieb on 2024-02-28 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattmess1221">@mattmess1221</a> on 2024-03-04 20:01</div>
            <div class="timeline-body"><p>The bug was fixed in <code>rustls-pemfile</code> v2.1.1, however <code>reqwest</code> is still using v1.0.</p>
<p>Likely blocked by seanmonstar/reqwest#2136</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-07 02:57</div>
            <div class="timeline-body"><p>Thank you for checking back in @killjoy1221!</p>
<p>We're on rustls-pemfile v2.1.2 now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-06-07 02:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
