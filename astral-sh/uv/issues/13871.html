<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip sync - &lt;&lt;&lt;&quot;-e .&quot;` does not honour `sources` - astral-sh/uv #13871</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip sync - &lt;&lt;&lt;&quot;-e .&quot;</code> does not honour <code>sources</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/13871">#13871</a>
        opened by <a href="https://github.com/paveldikov">@paveldikov</a>
        on 2025-06-05 19:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/paveldikov">@paveldikov</a></div>
            <div class="timeline-body">Summary
<p>I am wanting to refactor a bunch of my</p>
<pre><code>uv pip install -e . -c constraints.txt
</code></pre>
<p>usages into <code>uv pip sync</code> usages -- for a modest performance improvement, but also the ability to easily remove superfluous junk from manual <code>uv pip install</code> usage.</p>
<p>In my quest, I tried:</p>
<pre><code>uv pip sync constraints.txt - &lt;&lt;&lt;&quot;-e .&quot;
</code></pre>
<p>and it works great -- except in cases where I use <code>sources</code> to define a dependency on a local package. In those cases, the installation simply fails because it cannot find any distribution for said local package (it&#x27;s local -- not published to any index.)</p>
<p>I.e. for some reason, <code>uv pip install</code> is <code>sources</code>-aware, and <code>uv pip sync</code> is not.</p>
<p>(wondering: is this deliberate?)</p>
Platform
<p>Linux</p>
Version
<p>uv 0.7.11</p>
Python version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-06-05 19:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-05 19:21</div>
            <div class="timeline-body"><p>Not totally sure what&#x27;s going on, will look into this, thanks @paveldikov.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-06 00:16</div>
            <div class="timeline-body"><p>When you use <code>uv pip sync</code>, we don&#x27;t look at any dependencies, and sources are applied to a package&#x27;s dependencies. So here, we get the requirement on <code>.</code>, then any requirements defined in <code>constraints.txt</code>, but we never pick up the sources in <code>.</code> because they&#x27;d only be applied when iterating over its dependencies.</p>
<p>I&#x27;m unsure if this should change. I agree it&#x27;s a little confusing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-06-06 12:05</div>
            <div class="timeline-body"><blockquote>
<p>When you use uv pip sync, we don&#x27;t look at any dependencies, and sources are applied to a package&#x27;s dependencies.</p>
</blockquote>
<p>So the inexplicable thing is that -- yes, it does not <em>install</em> dependencies -- but it is clearly <em>evaluating</em> them at some point in the crit
path, because otherwise it wouldn&#x27;t have failed?</p>
<p>That aside... I <em>could</em> have enumerated the editable local dependency in the constraints file -- arguably should -- but then it&#x27;s no longer valid as a constraints file... gah! <code>pylock.toml</code> is better at this, but not fully usable at this point in time.</p>
<p>Maybe what I&#x27;m actually looking for is <code>uv pip install ... --clean</code> so that I can lean on that to clear miscellaneous cruft from the venv...?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-06 12:07</div>
            <div class="timeline-body"><p>Wait, so above, <code>constraints.txt</code> doesn&#x27;t include a reference to the failing path?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-06-06 12:11</div>
            <div class="timeline-body"><p>No, because it&#x27;s not valid for a constraints file to list an editable dependency (it seems) -- I tried:</p>
<pre><code>-e foo
foo @ -e foo
</code></pre>
<p>Either is discarded at input validation stage.</p>
<p>What does work (end to end!), but kills the editability:</p>
<pre><code>foo @ foo
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-06-06 12:13</div>
            <div class="timeline-body"><p>(As an aside, can you remind me which features of <code>pylock.toml</code> are missing for you?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-06-06 12:20</div>
            <div class="timeline-body"><blockquote>
<p>(As an aside, can you remind me which features of pylock.toml are missing for you?)</p>
</blockquote>
<p>Either of:</p>
<ul>
<li>Ability to use a lockfile as a constraints file -- this lets me be very lazy BUT also requires that <code>pip</code> support this exact same flow, and that is not to be taken for granted<ul>
<li>(background: we use <code>pip</code> to bootstrap <code>uv</code>, and ideally it should be the right version of <code>uv</code> i.e. the one in the lockfile)</li>
</ul>
</li>
<li>Ability to preserve dependency groups in <code>uv pip compile -o pylock.toml</code><ul>
<li>also I&#x27;d need to be able to feed an additional dependency group inline (<code>- &lt;&lt;&lt;&quot;foo&quot;</code>) -- but I imagine that&#x27;s just a case of attaching a marker to <code>foo</code>? <code>foo ; &#x27;my_grp&#x27; in dependency_groups</code>? and then I need a way of getting <code>my_grp</code> listed in the top-level listing of available groups... gah!</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-06-06 14:23</div>
            <div class="timeline-body"><p>FWIW, I use basically the same workflow as @paveldikov and have similiar desires out of a lock file.</p>
<p>And I pass in the local path to the sync command, I don&#x27;t use sources, my pip sync command looks like:</p>
<pre><code>echo -e $EDITABLE_PACKAGES | cat - &quot;$CONSTRAINTS_PATH&quot; | uv pip sync -
</code></pre>
<p>Where <code>$EDITABLE_PACKAGES</code>  looks like:</p>
<pre><code>EDITABLE_PACKAGES=&quot;\n-e ${_PROJECT_ROOT}/sub/dir/to/package\n-e ${_PROJECT_ROOT}/sub/dir/to/other/package\n&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-06-06 15:35</div>
            <div class="timeline-body"><p>Yeah. I may have somewhat painted myself in a corner by trying to use a constraints file as a legacy-friendly approximation of a proper lockfile. It works fine for the most part, but the stipulation against editable installs (fwiw, that&#x27;s baked into the spec @ PyPA) is pretty limiting.</p>
<p>I could, however, see myself just dropping constraints files cold-turkey in favour of PEP 751/<code>pylock.toml</code>. This does, as mentioned, require that multi-use lockfiles are properly supported -- and to be honest this needs to happen anyway, so I&#x27;d be equally happy with WONTFIX&#x27;ing this scenario if <code>pylock.toml</code> is to handle it more structurally.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:56 UTC
    </footer>
</body>
</html>
