<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure index be based on host or platform - astral-sh/uv #15342</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Configure index be based on host or platform</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15342">#15342</a>
        opened by <a href="https://github.com/jpkolsen">@jpkolsen</a>
        on 2025-08-18 06:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jpkolsen">@jpkolsen</a></div>
            <div class="timeline-body">Question
<p>I&#x27;m in a setting where our production environment does not have access to the internet so it uses a private index. I can target this with <code>uv</code> by adding an environment variable, cli flag or in pyproject.toml. Hovewer, if I want to develop locally, I don&#x27;t have access to the private index. Incidentally,  my own machine is a mac while the production host is linux, so I tried adding the below to pyproject.toml (using <code>art</code> package as example)</p>
<pre><code>dependencies = [
    &quot;art&gt;=6.5&quot;,
]

[tool.uv.sources]
art = [
  { index = &quot;pypi&quot;, marker = &quot;platform_system == &#x27;Darwin&#x27;&quot;},
  { index = &quot;nexus&quot;, marker = &quot;platform_system == &#x27;Linux&#x27;&quot;},
]

[[tool.uv.index]]
name = &quot;nexus&quot;
url = &quot;https://internal.url/repository/pypi-proxy/simple&quot;

[[tool.uv.index]]
name = &quot;pypi&quot;
url = &quot;https://pypi.python.org/simple&quot;
</code></pre>
<p>This fails on both platforms. It looks like it&#x27;s trying to access both indexes even though the marker specifies to use one, but maybe I&#x27;m just holding it wrong? Also, could this be set up in a way that&#x27;s not specific to each package, but basically just configures <code>uv</code> to use one index on one host/platform and another index on all others?</p>
Platform
<p>MacOS 15, Ubuntu 22.04</p>
Version
<p>uv 0.8.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/jpkolsen">@jpkolsen</a> on 2025-08-18 06:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-19 09:30</div>
            <div class="timeline-body"><p>Two things:</p>
<ol>
<li>I recommend adding <code>explicit = true</code> to each of your <code>[[tool.uv.index]]</code> entries. That says: &quot;Only use this for packages that are marked with the index&quot;. Otherwise, we&#x27;ll try to query it for other dependencies, which could lead to errors in your case.</li>
<li>uv creates a universal <code>uv.lock</code>, so it needs access to both indexes in order to generate the lockfile, even if it won&#x27;t need to install the package from the Linux index when you&#x27;re on the macOS machine. Typically what you&#x27;d do is generate the <code>uv.lock</code> on your machine that <em>does</em> have access to the private index, then on macOS, run with the <code>--frozen</code> flag to use the lockfile but avoid attempting to update or validate it.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-19 09:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jpkolsen">@jpkolsen</a> on 2025-08-19 14:11</div>
            <div class="timeline-body"><p>Thanks for confirming that locking requires access to both indexes, at least I know that I shouldn&#x27;t try to fiddle with settings to get my intended workflow running! I think your workaround might work, so thanks for that suggestion as well!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/jpkolsen">@jpkolsen</a> on 2025-08-19 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-19 14:30</div>
            <div class="timeline-body"><p>No worries! Thanks for following up.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:02 UTC
    </footer>
</body>
</html>
