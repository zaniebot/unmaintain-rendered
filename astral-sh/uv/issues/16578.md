```yaml
number: 16578
title: "`--no-project` has no effect if a project virtual environment already exists (.venv)"
type: issue
state: closed
author: DhavalGojiya
labels:
  - bug
assignees: []
created_at: 2025-11-03T11:05:57Z
updated_at: 2025-11-04T13:52:14Z
url: https://github.com/astral-sh/uv/issues/16578
synced_at: 2026-01-10T01:57:36Z
```

# `--no-project` has no effect if a project virtual environment already exists (.venv)

---

_Issue opened by @DhavalGojiya on 2025-11-03 11:05_

### Summary


When running `uv run` with the `--no-project` flag, it should ignore the project’s virtual environment (`.venv`).

However, if a `.venv` already exists in the project directory, `uv` still includes it in `sys.path`, causing the project’s dependencies to be accessible - even when explicitly using `--no-project`.

---

#### **Steps to Reproduce**

1. Create a project with uv:

   ```bash
   uv init venus
   cd venus

   uv sync
   uv add django
   ```
2. Run a Python file using:

   ```bash
   uv run --no-project --with pyjwt -- python main.py
   ```
3. Inside `main.py`, print `sys.path` and import a dependency installed in `.venv`:

   ```python
   import sys
   print(sys.path)

   import django
   print(django)
   ```

---

#### **Observed Output**

```python
['/home/dhaval/Open-Source/venus',
 '/usr/local/lib/python38.zip',
 '/usr/local/lib/python3.8',
 '/usr/local/lib/python3.8/lib-dynload',
 '/home/dhaval/.cache/uv/builds-v0/.tmphekDoG/lib/python3.8/site-packages',
 '/home/dhaval/.cache/uv/archive-v0/U2tMbkpBCr3aqAMJz6gD6/lib/python3.8/site-packages',
 '/home/dhaval/Open-Source/venus/.venv/lib/python3.8/site-packages']
```

Notice the last line - the project’s `.venv` site-packages directory is still added to `sys.path`, and because of this Django can be imported even though it is not included in the `--with` flag:

```python
<module 'django' from '/home/dhaval/Open-Source/venus/.venv/lib/python3.8/site-packages/django/__init__.py'>
```

---

#### **Expected Behavior**

When `--no-project` is used:

* The project’s `.venv` **should not** be added to `sys.path`.
* Only packages specified with `--with` should be accessible.

---

#### **Workaround**

If we delete virtual environment manually at `.venv`:

```bash
rm -rf .venv
uv run --no-project --with pyjwt -- python main.py
```
#### **Observed Output**

```python
['/home/dhaval/Open-Source/venus',
 '/usr/local/lib/python38.zip',
 '/usr/local/lib/python3.8',
 '/usr/local/lib/python3.8/lib-dynload',
 '/home/dhaval/.cache/uv/builds-v0/.tmphekDoG/lib/python3.8/site-packages',
 '/home/dhaval/.cache/uv/archive-v0/U2tMbkpBCr3aqAMJz6gD6/lib/python3.8/site-packages'
```

Then, the behavior is correct:
The project's `.venv` is not added to `sys.path` , and Django is not accessible.

```python
ModuleNotFoundError: No module named 'django'
```

---

#### **Summary**

* ✅ Works correctly when `.venv` **does not exist**
* ❌ Fails when `.venv` **already exists**
* Expected: `--no-project` should fully ignore the existing `.venv`, even if present.

---

#### **Additional Context**

This issue makes it impossible to isolate ephemeral runs with `--no-project` if a local `.venv` already exists - which defeats the purpose of `--no-project` when testing isolated dependency contexts.

### Platform

Linux 6.8.0-45-generic x86_64 GNU/Linux

### Version

uv 0.9.7

### Python version

Python 3.8

---

_Label `bug` added by @DhavalGojiya on 2025-11-03 11:05_

---

_Comment by @DhavalGojiya on 2025-11-03 11:52_

I think the reason this happens when `.venv` is available and gets appended to `sys.path` is that - even after specifying
 `--no-project` - **uv** still needs a Python interpreter to run the file.

From the verbose log (When `.venv` exists):

```
> uv run -v --no-project --with pyjwt -- python main.py

DEBUG uv 0.9.7
DEBUG Acquired shared lock for `/home/dhaval/.cache/uv`
DEBUG Found project root: `/home/dhaval/Open-Source/venus`
DEBUG No workspace root found, using project root
DEBUG Ignoring discovered project due to `--no-project`
DEBUG No project found; searching for Python interpreter
DEBUG Reading Python requests from version file at `/home/dhaval/Open-Source/venus/.python-version`
DEBUG Searching for Python 3.8 in virtual environments, managed installations, or search path

DEBUG Found `cpython-3.8.10-linux-x86_64-gnu` at `/home/dhaval/Open-Source/venus/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.8.10 interpreter at: /home/dhaval/Open-Source/venus/.venv/bin/python3

DEBUG At least one requirement is not satisfied in the base environment: pyjwt
DEBUG Syncing `--with` requirements to cached environment
DEBUG Assessing Python executable as base candidate: /home/dhaval/Open-Source/venus/.venv/bin/python3
DEBUG Assessing Python executable as base candidate: /home/dhaval/Open-Source/venus/.venv/bin/python
DEBUG Assessing Python executable as base candidate: /usr/local/bin/python3.8
DEBUG Caching via base interpreter: `/usr/local/bin/python3.8`
```

It finds the Python interpreter at:

```
DEBUG Found `cpython-3.8.10-linux-x86_64-gnu` at `/home/dhaval/Open-Source/venus/.venv/bin/python3` (virtual environment)
```

And because of how Python works under the hood, the interpreter itself adds its own `/site-packages` directory to `sys.path`, which causes this issue.

Not sure whether this is an actual bug or expected behavior.

---

_Comment by @zanieb on 2025-11-03 14:38_

> When running uv run with the --no-project flag, it should ignore the project’s virtual environment (.venv).

This only disables project discovery, but not general `.venv` discovery.

It sounds like you want `uv run --no-project --isolated`?

---

_Comment by @DhavalGojiya on 2025-11-03 16:30_

> > When running uv run with the --no-project flag, it should ignore the project’s virtual environment (.venv).
> 
> This only disables project discovery, but not general `.venv` discovery.
> 
> It sounds like you want `uv run --no-project --isolated`?

Thanks for your reply, zanieb.  
Yes, I am familiar with `--isolated`.  
It creates a completely isolated virtual environment without installing any project dependencies.

While working with `uv run`, I came across this behavior and decided to post it to verify whether it's a bug or expected behavior.  
Since your answer clarifies that `.venv` discovery isn’t disabled when using `--no-project`, that clears up a lot.

If this is the intended behavior, I can close the issue.

---

_Comment by @zanieb on 2025-11-03 17:23_

Yeah let's close this as intended for now unless we hear from other people that are confused.

---

_Closed by @zanieb on 2025-11-03 17:23_

---

_Comment by @olivierdelree on 2025-11-04 13:00_

I would like to +1 the confusion.
From my point of view, passing `--no-project` also sounds like it would run in an environment that has nothing to do with the project. Still using the `.venv` directory is unexpected but I don't think a behaviour change is really required. Instead, specifying in the CLI help that `.venv` discovery still happens and/or that `--isolated` might be desired for a truly clean environment should be enough.

---

_Comment by @DhavalGojiya on 2025-11-04 13:52_

> I would like to +1 the confusion. From my point of view, passing `--no-project` also sounds like it would run in an environment that has nothing to do with the project. Still using the `.venv` directory is unexpected but I don't think a behaviour change is really required. Instead, specifying in the CLI help that `.venv` discovery still happens and/or that `--isolated` might be desired for a truly clean environment should be enough.

I think it would be great if, in the `uv` documentation, they wrote a note like:  
> **Note:** Specifying `--no-project` will only disable project discovery and **not** the normal Python search resolution order (i.e., virtual environments, managed installations, and search path discovery).

CC: @zanieb 

---
