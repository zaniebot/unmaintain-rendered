<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make `--all-packages` the default? - astral-sh/uv #9755</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Make <code>--all-packages</code> the default?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9755">#9755</a>
        opened by <a href="https://github.com/gjoseph92">@gjoseph92</a>
        on 2024-12-10 00:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gjoseph92">@gjoseph92</a></div>
            <div class="timeline-body"><p>When setting up a uv workspace in a monorepo, I was surprised to find that <code>uv sync</code> would change which packages were installed depending on which directory I ran it from. For example:</p>
<ol>
<li>it removed all my transitive dev dependencies when run from the root directory</li>
<li>when run within a sub-package, it removed dependencies (required and dev) for all other packages!</li>
</ol>
<p>Overall, it&#x27;s confusing that the behavior of <code>uv sync</code> changes depending on where you run it from within a workspace that just has one shared environment.</p>
<p>Without <code>--all-packages</code>, <code>uv sync</code> seems to behave as though the virtual environment belongs only to whichever package you&#x27;re currently inâ€”which would make sense in non-workspace mode, where each package has its own environment. But in a workspace, the environment is shared between all members, so it feels odd for each member to trample on this shared resource by default.</p>
Some specific repros

<p>You can recreate these with https://github.com/gjoseph92/uv-monorepro</p>
<p>The transitive dev dependencies aren&#x27;t available in the base workspace (I&#x27;d expect <code>py-spy</code> and <code>pip</code> to be here):</p>
<pre><code>uv-monorepro main*â€‹(uv-monorepro) â¯ uv tree
Resolved 15 packages in 2ms
uv-monorepro v0.1.0
â”œâ”€â”€ needs-things v0.1.0
â”‚   â”œâ”€â”€ thing1 v0.1.0
â”‚   â”‚   â”œâ”€â”€ cowsay v6.1
â”‚   â”‚   â””â”€â”€ py-spy v0.4.0 (group: dev)
â”‚   â””â”€â”€ thing2 v0.1.0
â”‚       â”œâ”€â”€ trio v0.27.0
â”‚       â”‚   â”œâ”€â”€ attrs v24.2.0
â”‚       â”‚   â”œâ”€â”€ idna v3.10
â”‚       â”‚   â”œâ”€â”€ outcome v1.3.0.post0
â”‚       â”‚   â”‚   â””â”€â”€ attrs v24.2.0
â”‚       â”‚   â”œâ”€â”€ sniffio v1.3.1
â”‚       â”‚   â””â”€â”€ sortedcontainers v2.4.0
â”‚       â””â”€â”€ pip v24.3.1 (group: dev)
â””â”€â”€ thing1 v0.1.0 (*)
(*) Package tree already displayed
uv-monorepro main*â€‹(uv-monorepro) â¯ which pip   
pip not found
</code></pre>
<p>If I go into a subpackage, <code>uv sync</code> uninstalls the <em>required</em> dependency (<code>cowsay</code>) of my other subpackage (because it&#x27;s not a dependency of this subpackage):</p>
<pre><code>uv-monorepro main*â€‹(uv-monorepro) â¯ cd packages/thing2
uv-monorepro/packages/thing2 main*â€‹(uv-monorepro) â¯ uv sync
Resolved 15 packages in 2ms
Uninstalled 1 package in 8ms
Installed 1 package in 9ms
 - cowsay==6.1
 + pip==24.3.1
uv-monorepro/packages/thing2 main*â€‹(uv-monorepro) â¯ which pip
/Users/gjoseph/scratch/uv-monorepro/.venv/bin/pip
</code></pre>
<p>Going to the other subpackage does the inverse:</p>
<pre><code>uv-monorepro/packages/thing2 main*â€‹(uv-monorepro) â¯ cd ../thing1      
uv-monorepro/packages/thing1 main*â€‹(uv-monorepro) â¯ uv sync
Resolved 15 packages in 1ms
Uninstalled 7 packages in 97ms
Installed 2 packages in 2ms
 - attrs==24.2.0
 + cowsay==6.1
 - idna==3.10
 - outcome==1.3.0.post0
 - pip==24.3.1
 + py-spy==0.4.0
 - sniffio==1.3.1
 - sortedcontainers==2.4.0
 - trio==0.27.0
uv-monorepro/packages/thing1 main*â€‹(uv-monorepro) â¯ which pip
pip not found
</code></pre>
<p>Back in the root workspace, <code>uv sync</code> again does install the necessary dependencies for the subpackages, but not their dev dependencies (<code>py-spy</code> and <code>pip</code> are both gone now). Given that the <a href="https://docs.astral.sh/uv/concepts/projects/dependencies/#default-groups">docs say</a> the dev group is included by default, I would have expected and wanted all the dev dependencies of member packages to be installed too.</p>
<pre><code>uv-monorepro/packages/thing1 main*â€‹(uv-monorepro) â¯ cd ../..    
uv-monorepro main*â€‹(uv-monorepro) â¯ uv sync
Resolved 15 packages in 2ms
Uninstalled 1 package in 3ms
Installed 6 packages in 5ms
 + attrs==24.2.0
 + idna==3.10
 + outcome==1.3.0.post0
 - py-spy==0.4.0
 + sniffio==1.3.1
 + sortedcontainers==2.4.0
 + trio==0.27.0
uv-monorepro main*â€‹(uv-monorepro) â¯ which pip
pip not found
</code></pre>
<p><code>--all-packages</code> gets the behavior I want. And most importantly, it always results in the same things being installed no matter which directory I run it from.</p>
<pre><code>uv-monorepro main*â€‹(uv-monorepro) â¯ uv sync --all-packages
Resolved 15 packages in 2ms
Installed 2 packages in 8ms
 + pip==24.3.1
 + py-spy==0.4.0
uv-monorepro main*â€‹(uv-monorepro) â¯ which pip
/Users/gjoseph/scratch/uv-monorepro/.venv/bin/pip
</code></pre>


<p>I couldn&#x27;t find other issues requesting this, but apologies if this is a dupe. Maybe somewhat related to <a href="https://github.com/astral-sh/uv/issues/9261">astral-sh/uv#9261</a>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-10 00:25</div>
            <div class="timeline-body"><p>I think we&#x27;re somewhat unlikely to change this... I hear your confusion but it may just be a learning curve that comes from working with the workspace concept? Cargo, for example, behaves the same way: the workspace root is a member, just like any other, and by default <code>cargo run</code> uses the current directory which can be overridden with <code>-p</code>.</p>
<p>In our case, <code>uv sync</code> always does a strict sync. You can use <code>uv sync --inexact</code> if you only want to make the minimal changes necessary to include all dependencies for the current workspace member. (<code>uv run</code> uses these &quot;inexact&quot; semantics by default.)</p>
<blockquote>
<p>But in a workspace, the environment is shared between all members, so it feels odd for each member to trample on this shared resource by default.</p>
</blockquote>
<p>Well... I think this isn&#x27;t quite true. You can have members within a workspace that don&#x27;t depend on any other members. Those members should declare all the direct dependencies that they need. In that case, running <code>uv sync</code> and removing dependencies of <em>other</em> members is totally right.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-10 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-07 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-07 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntjess">@ntjess</a> on 2025-06-29 13:21</div>
            <div class="timeline-body"><p>@charliermarsh would you consider supporting a pyproject configuration option like:</p>
<pre><code>[tool.uv]
sync-all-packages = true
</code></pre>
<p>in the monorepo root so that workspaces which <em>do</em> share the same environment can enable this behavior?</p>
<p>Use case: allow multiple devs using the same code base to experience the same CLI behavior running <code>uv sync</code> without needing to add bash scripts/etc to the repo</p>
<p>Apologies if this is already possible -- I checked the <a href="https://docs.astral.sh/uv/reference/settings">docs</a> for configurations and didn&#x27;t come across it. Also happy to open a new issue if it&#x27;s preferable</p>
<p>Edit: just came across #5737 which looks like a similar request so I&#x27;ll subscribe to that issue instead ğŸ™‚</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:04 UTC
    </footer>
</body>
</html>
