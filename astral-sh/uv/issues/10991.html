<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support disabling workspace and dev installation of `uv pip install` - astral-sh/uv #10991</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support disabling workspace and dev installation of <code>uv pip install</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10991">#10991</a>
        opened by <a href="https://github.com/potiuk">@potiuk</a>
        on 2025-01-27 16:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/potiuk">@potiuk</a></div>
            <div class="timeline-body">Summary
<p>While moving Airlfow to use workspace (which is great feature of uv) - <a href="https://github.com/apache/airflow/issues/46045">apache/airflow#46045</a> I foud out that <code>uv pip install</code> behaviour for NON EDITABLE installation when project has workspace defined in <code>pyproject.toml</code> is somewhat broken. It&#x27;s not a really a bug, just the behaviour is different to what you would expect and it lacks control of what you would like to install there.</p>
A bit of context
<p>On of the usages of <code>uv</code> we have in airflow, is to prepare constraints resulting in:</p>
<ul>
<li>installing airflow IN NON-EDITABLE MODE from local sources + pyproject.toml</li>
<li>Installing all providers from PyPI (!) in NON-EDITABLE MODE but with --resolution highest</li>
<li>freeze all those installed packages to a file and publish it as &quot;latest constraints&quot;</li>
</ul>
<p>There are good reasons we are doing it - mostly we do it in order to produce a somewhat reproducible installation for our users when we release airlfow - and the version we do in <code>main</code> is more of &quot;let&#x27;s see if it still works&quot; - we only actually use those <code>pypi</code> constraints when we release airflow - so we have a variant of such constraints for every release of airlfow and every python version supported frozen in our GitHub repository so our users can refer to it if they want to somewhat reproducibly install airflow with dependencies and providers that we tested at the moment of release of Airflow.</p>
<p>We do it with a command (auto-generated) similar to this:</p>
<pre><code>uv pip install --system &#x27;.[all-core]&#x27; --reinstall apache-airflow-providers-airbyte==5.0.0 apache-airflow-providers-alibaba==3.0.0 ... --resolution highest
</code></pre>
The problem
<p>The problem is that this does not really pull the providers from pypi as expected - but uses the ones which are defined in the workspace.</p>
<p>Our workspace looks more or less like this:</p>
<pre><code>
[dependency-groups]
dev = [
  &quot;apache-airflow-providers-airbyte&quot;,
  &quot;apache-airflow-providers-alibaba&quot;,
]

[tool.uv.sources]
apache-airflow-providers-airbyte = {workspace = true}
apache-airflow-providers-alibaba = { workspace = true }
# more providers

[tool.uv.workspace]
members = [
    &quot;providers/airbyte&quot;,
    &quot;providers/alibaba&quot;,
# more providers

</code></pre>
<p>And the problem is tha when I run pip install command above, it will install and use all the providers and all the devel dependencies defined in the pyproject.toml  - and not &quot;bare&quot; &quot;airlfow&quot; package + all the packages I requested to install.</p>
<p>For example - this is what happens when I run another version of this:</p>
<pre><code>root@00376a013642:/opt/airflow# uv pip install &quot;.[all-core]&quot; apache-airflow-providers-airbyte --system
Using Python 3.9.21 environment at: /usr/local
   Built apache-airflow @ file:///opt/airflow
â ¦ Resolving dependencies...                                                                                                                                                                                                                                                                                                                                                                   warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-ftp`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-smtp`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-sqlite`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-amazon`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-cassandra`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-drill`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-druid`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-flink`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-hdfs`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-hive`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-impala`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-kafka`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-livy`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apache-pinot`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-apprise`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-arangodb`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-atlassian-jira`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-cloudant`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-cncf-kubernetes`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-databricks`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-dbt-cloud`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-dingding`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-discord`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-docker`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-elasticsearch`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-fab`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-github`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-google`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-grpc`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-influxdb`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-jdbc`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-microsoft-azure`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-microsoft-mssql`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-microsoft-psrp`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-microsoft-winrm`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-mongo`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-opensearch`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-oracle`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-redis`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-salesforce`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-sendgrid`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-sftp`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-slack`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-trino`
warning: Missing version constraint (e.g., a lower bound) for `apache-airflow-providers-yandex`
Resolved 209 packages in 1m 02s
   Built apache-airflow-providers-common-compat @ file:///opt/airflow/providers/common/compat
   Built apache-airflow-providers-standard @ file:///opt/airflow/providers/standard
   Built apache-airflow-providers-common-sql @ file:///opt/airflow/providers/common/sql
   Built apache-airflow-providers-http @ file:///opt/airflow/providers/http
   Built apache-airflow-providers-common-io @ file:///opt/airflow/providers/common/io
   Built apache-airflow-providers-imap @ file:///opt/airflow/providers/imap
Prepared 12 packages in 3.12s
Uninstalled 8 packages in 16ms
Installed 12 packages in 1.53s
 ~ apache-airflow==3.0.0.dev0 (from file:///opt/airflow)
 ~ apache-airflow-providers-common-compat==1.4.0 (from file:///opt/airflow/providers/common/compat)
 ~ apache-airflow-providers-common-io==1.5.0 (from file:///opt/airflow/providers/common/io)
 ~ apache-airflow-providers-common-sql==1.21.0 (from file:///opt/airflow/providers/common/sql)
 + apache-airflow-providers-fab==1.5.2
 + apache-airflow-providers-ftp==3.12.0
 ~ apache-airflow-providers-http==5.0.0 (from file:///opt/airflow/providers/http)
 ~ apache-airflow-providers-imap==3.8.0 (from file:///opt/airflow/providers/imap)
 + apache-airflow-providers-smtp==1.9.0
 + apache-airflow-providers-sqlite==4.0.0
 ~ apache-airflow-providers-standard==0.0.3 (from file:///opt/airflow/providers/standard)
 - flask-appbuilder==4.5.3
 + flask-appbuilder==4.5.2
</code></pre>
<p>When you look at this - even if I requested a non-editable version of &quot;airflow&quot; from sources, it still instas editable versions of packages referred to by the workspace - even though what I <strong>REALLY</strong> want in this case I would like to install those packages from PyPI.</p>
<p>This might or might not be a reasonable default, not sure. Depends what your philosophy of workspace is - the fact that you have <code>pyproject.toml</code> locally that determines workspace, might mean that you want to use the workspace-packages even in non-editable mode, And this is fine.</p>
<p>But the real problem is that I currently have no way to add parameters to <code>uv pip install</code> to change this behaviour. I miss specifically those two:</p>
<ul>
<li>--no-install-workspace</li>
<li>--no-dev</li>
</ul>
<p>Also others (<code>--only-dev</code>) that <code>uv sync</code> supports.</p>
<p>Now - why can&#x27;t I use <code>uv sync</code> ? One could think that I could use:</p>
<pre><code>uv sync --no-editable --no-install-workspace --extra &quot;[all]&quot; --resolution highest
</code></pre>
<p>or</p>
<pre><code>uv sync --no-editable --no-install-workspace --all-extras --resolution highest
</code></pre>
<p>But I really can&#x27;t - because in this case I do NOT want to install the provider packages from my workspace - I want to install them from pypi AND I want to explicitly specify which provider packages I want to use, individually, so <code>uv pip install</code> is much more suitable for it.</p>
<p>Currently what I am doing to workaround it is I modify the <code>pyproject.toml</code> dynamically before running the <code>uv pip install</code> command and remove all providers from the workspace definition. This works as expected. The above command will install packages from PyPI rather than from local workspace and life is good. But it&#x27;s a nasty hack.</p>
<p>Would you please consider adding extra flags to <code>pip</code> install to control the workspace/dev installation behaviour when <code>uv pip install ,</code> is run for project which is workspace-enabled in <code>pyproject.toml</code>?</p>
<p>This is behaviour observed in 0.5.11 (latest at the time of this issue writing) version.</p>
Example
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/potiuk">@potiuk</a> on 2025-01-27 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-01-27 16:48</div>
            <div class="timeline-body"><p>Does <code>--no-sources</code> work for you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/potiuk">@potiuk</a> on 2025-01-27 18:07</div>
            <div class="timeline-body"><p>AAAAAAhhhh ðŸ¤¦ ....</p>
<p>You are a lifesaver @konstin !</p>
<p>I totally, totally missed it when I looked at the commands available and I have not realized it does what I am doing by manually removing the workspaces...</p>
<p>I checked it and it seems I can get it to work, with few small other tweaks (for example I need to add <code>--reinstall</code> flag to make sure that the <code>workspace</code> packages are actually replaced by the packages from <code>PyPI</code>.</p>
<p>There are few more tweaks I have to add but generally speaking it does, indeed, solve my problem.</p>
<p>Thank you !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/potiuk">@potiuk</a> on 2025-01-27 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-27 18:08</div>
            <div class="timeline-body"><p>Maybe we should add the word &quot;workspace&quot; somewhere in the help for <code>--no-sources</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/potiuk">@potiuk</a> on 2025-01-27 18:39</div>
            <div class="timeline-body"><blockquote>
<p>Maybe we should add the word &quot;workspace&quot; somewhere in the help for <code>--no-sources</code>.</p>
</blockquote>
<p>Yes. That would be great :)</p>
<p>But actually ... I found a bug with how <code>--no-sources</code> implementation ... I will open a separate issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/potiuk">@potiuk</a> on 2025-01-27 18:55</div>
            <div class="timeline-body"><p>@charliermarsh @konstin =&gt; Issue here: <a href="https://github.com/astral-sh/uv/issues/10999">astral-sh/uv#10999</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:55 UTC
    </footer>
</body>
</html>
