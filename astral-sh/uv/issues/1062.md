```yaml
number: 1062
title: "Ensure that uv works with `conda` Python distributions"
type: issue
state: closed
author: charliermarsh
labels:
  - compatibility
assignees: []
created_at: 2024-01-23T15:00:57Z
updated_at: 2024-04-01T14:35:22Z
url: https://github.com/astral-sh/uv/issues/1062
synced_at: 2026-01-10T01:57:01Z
```

# Ensure that uv works with `conda` Python distributions

---

_Issue opened by @charliermarsh on 2024-01-23 15:00_

This probably already works, but I've never tested it. It's worth testing manually.


---

_Label `compatibility` added by @charliermarsh on 2024-01-23 15:01_

---

_Comment by @zanieb on 2024-01-24 00:35_

This isn't polished at all but I threw together some code to download distributions https://github.com/astral-sh/puffin/commit/07d247efd1edebe862551a738d04d62766a41423

```
❯ python3.12 scripts/bootstrap install conda@3.11.2
2024-01-23 18:36:02 INFO Using version metadata from bootstrap/self/versions.json
2024-01-23 18:36:02 INFO Using system macos-aarch64
2024-01-23 18:36:02 INFO Searching for compatible Python version conda@3.11.2
2024-01-23 18:36:02 INFO Downloading conda@3.11.2
2024-01-23 18:36:03 INFO Verifying hash...
2024-01-23 18:36:06 INFO Installed to bootstrap/bin/python3.11.2
❯ bootstrap/bin/python3.11.2 --version
Python 3.11.2

---

_Comment by @charliermarsh on 2024-01-24 00:52_

That looks cool. I mostly want to make sure it works when installed through whatever their recommended method is though, so still worth testing I think?

---

_Comment by @zanieb on 2024-01-24 02:08_

I'm not sure you'll end up with different Python distributions by managing them directly from e.g. `conda` but yeah we should probably test it. I'm not sure if this is critical to do before release though.

---

_Assigned to @konstin by @konstin on 2024-02-01 15:53_

---

_Comment by @charliermarsh on 2024-02-11 19:25_

@konstin - Did you have a chance to look at this?

---

_Comment by @konstin on 2024-02-11 19:51_

I didn't get to it unfortunately

---

_Renamed from "Ensure that Puffin works with `conda` Python distributions" to "Ensure that uv works with `conda` Python distributions" by @zanieb on 2024-02-15 19:51_

---

_Comment by @drewbitt on 2024-02-15 21:40_

Works for me with miniforge installed through brew
`Using Python 3.12.1 interpreter at /opt/homebrew/Caskroom/miniforge/base/bin/python3.12`

---

_Comment by @charliermarsh on 2024-02-15 21:51_

You're awesome, thank you.

---

_Comment by @shughes-uk on 2024-02-15 22:05_

This might be for a seperate ticket but we ran into this while testing out `uv` in conda environments.

```
uv pip install chardet                                                    (coiled)  ✘ 2
error: Failed to list installed packages
  Caused by: Found duplicate package in environment: wheel (/opt/homebrew/Caskroom/mambaforge/base/envs/coiled/lib/python3.11/site-packages/wheel-0.42.0.dist-info vs. /opt/homebrew/Caskroom/mambaforge/base/envs/coiled/lib/python3.11/site-packages/wheel-0.40.0.dist-info)
```

Duplicate dist-info's are pretty common in our experience with conda. We have to do some shenanigans to figure out what the real installed "active" version is.

---

_Comment by @charliermarsh on 2024-02-15 22:10_

That's interesting... We can probably support it, though would need to map out how various operations work. What does `pip uninstall wheel` do in that case?

---

_Comment by @shughes-uk on 2024-02-15 22:30_

It seems to just remove the `dist-info` of whatever version pip installed.

Generally this seems to happens when you install a package via pip/conda and then install it again with the other package manager, files don't get cleaned up properly.

It's not super recommended to mix pip/conda, but every conda user i've met will do this pretty often.

---

_Comment by @ntessore on 2024-02-15 23:02_

Not sure if I'm ignorant about a fundamental difference between build isolation in `pip` and `uv pip`, but simply trying out `uv pip install .` on a local project fails where `pip install .` succeeds. That happens in a conda environment where all dependencies are installed, but `uv pip` tries to download and build a package that cannot be compiled on my machine (but is installed in the conda env).

Edit: It looks like uv will try and build a local package against a newer version of a dependency from pip than the one currently installed in the conda environment. [Reproducer](https://github.com/ntessore/uv-conda-test)

---

_Unassigned @konstin by @konstin on 2024-02-20 10:28_

---

_Referenced in [astral-sh/uv#1848](../../astral-sh/uv/issues/1848.md) on 2024-02-22 02:46_

---

_Closed by @charliermarsh on 2024-03-31 14:11_

---

_Comment by @zanieb on 2024-04-01 14:35_

@ntessore fwiw I think that should be resolved by #2596 

---
