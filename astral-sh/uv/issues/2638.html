<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv fails to pip compile nb-black - astral-sh/uv #2638</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv fails to pip compile nb-black</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2638">#2638</a>
        opened by <a href="https://github.com/owenlamont">@owenlamont</a>
        on 2024-03-24 11:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/owenlamont">@owenlamont</a></div>
            <div class="timeline-body"><p>uv pip compile fails with <a href="https://github.com/dnanhkhoa/nb_black/blob/master/setup.py">nb-black</a> package (while pip compile works with it). I think uv is just being stricter about the version data type in the nb-black&#x27;s setup.py while pip compile is apparently more lenient. I&#x27;m happy to accept this is just something broken in nb-black and I don&#x27;t plan to keep that dependency... I just noticed the behaviour was different between pip compile and uv pip compile.</p>
<img alt="image" src="https://github.com/astral-sh/uv/assets/12672027/0e23393b-527d-4b38-bdb9-bc43b74d2591">

<ul>
<li>A minimal code snippet that reproduces the bug (requirements.in)</li>
</ul>
<pre><code>nb-black
</code></pre>
<ul>
<li>The command you invoked</li>
</ul>
<pre><code>uv pip compile requirements.in -o requirements.txt
</code></pre>
<ul>
<li>The current uv platform.</li>
</ul>
<p>Running on Windows, pipx installed uv (with a Python 3.12.2 env). Created a Python 3.11.2 venv and attempted the above uv pip compile (I have reproduced the same issue on Ubuntu too also with a Python 3.11.2 venv).</p>
<ul>
<li>The current uv version (<code>uv --version</code>).</li>
</ul>
<pre><code>uv 0.1.24 (a5cae0292 2024-03-22)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-03-24 15:59</div>
            <div class="timeline-body"><p>I get  the same error with pip:</p>
<pre><code>PS C:\Users\damia&gt; py -V
Python 3.12.2
PS C:\Users\damia&gt; py -m pip -V
pip 24.0 from C:\Users\damia\AppData\Local\Programs\Python\Python312\Lib\site-packages\pip (python 3.12)
PS C:\Users\damia&gt; py -m pip install --dry-run nb-black
Collecting nb-black
  Downloading nb_black-1.0.7.tar.gz (4.8 kB)
  Installing build dependencies ... done
  Getting requirements to build wheel ... error
  error: subprocess-exited-with-error

  × Getting requirements to build wheel did not run successfully.
  │ exit code: 1
  ╰─&gt; [3 lines of output]
      error in nb_black setup command: &#x27;install_requires&#x27; must be a string or list of strings containing valid project/version requirement specifiers; Expected end or semicolon (after name and no valid version specifier)
          yapf &gt;= &#x27;0.28&#x27;; python_version &lt; &#x27;3.6&#x27;
               ^
      [end of output]

  note: This error originates from a subprocess, and is likely not a problem with pip.
error: subprocess-exited-with-error

× Getting requirements to build wheel did not run successfully.
│ exit code: 1
╰─&gt; See above for output.

note: This error originates from a subprocess, and is likely not a problem with pip.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/owenlamont">@owenlamont</a> on 2024-03-24 18:43</div>
            <div class="timeline-body"><p>Oh, apologies. For me this was running in the context of a larger repo and CI pipeline which didn&#x27;t give me errors with nb-black but did after I tried migrating to uv.</p>
<p>Not sure if there was some other difference/logic that was handling the error there or whether it was using an older version of pip or setuptools.</p>
<p>I&#x27;ll investigate the differences further.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/owenlamont">@owenlamont</a> on 2024-03-24 18:57</div>
            <div class="timeline-body"><p>I&#x27;ll close this issue now assuming it&#x27;s not directly uv related.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/owenlamont">@owenlamont</a> on 2024-03-24 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-03-24 18:59</div>
            <div class="timeline-body"><p>Yeah, I can&#x27;t help with your larger pipeline without understanding it, but it seems nb_black has been broken for awhile and there has been no response from maintainers, I would suggest removing it from your dependency chain if you can:</p>
<ul>
<li>https://github.com/dnanhkhoa/nb_black/pull/41</li>
<li>https://github.com/dnanhkhoa/nb_black/issues/40</li>
</ul>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:30:35 UTC
    </footer>
</body>
</html>
