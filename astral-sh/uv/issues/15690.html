<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Rounding Precision Issue Under x86_64 Emulation - astral-sh/uv #15690</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Python Rounding Precision Issue Under x86_64 Emulation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15690">#15690</a>
        opened by <a href="https://github.com/Bradleywboggs">@Bradleywboggs</a>
        on 2025-09-04 22:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Bradleywboggs">@Bradleywboggs</a> on 2025-09-04 22:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>UV-installed Python versions exhibit critical rounding precision issues when running x86_64 containers under ARM64 emulation (Docker with Rosetta on Apple Silicon). The issue does not occur on native x86_64 or ARM64 systems.</p>
<p><strong>Key Finding</strong>: <code>round(1.125, 2)</code> returns <code>1.0</code> instead of expected <code>1.12</code></p>
<h3>Environment</h3>
<ul>
<li><strong>Host</strong>: Apple Silicon Mac (ARM64) + Docker Desktop + Rosetta 2</li>
<li><strong>Affected</strong>: x86_64 UV containers under emulation</li>
<li><strong>Unaffected</strong>: Native x86_64/ARM64 systems, standard Python containers</li>
<li><strong>Tested</strong>: Python 3.8 through 3.14rc2</li>
</ul>
<h3>Reproduction</h3>
<p><strong>Quick test</strong> (fails with UV managed python, passes with system Python):</p>
<pre><code class="language-bash">#### UV managed Python - FAILS
docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.13-bookworm \
  uv run --managed-python python -c &quot;print(round(1.125, 2))&quot;
Downloading cpython-3.13.7-linux-x86_64-gnu (download) (30.8MiB)
 Downloading cpython-3.13.7-linux-x86_64-gnu (download)
1.0
</code></pre>
<pre><code class="language-bash">#### System Python - WORKS  
docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.13-bookworm \
  python -c &quot;print(round(1.125, 2))&quot;
1.12
</code></pre>
<h3>Test Results</h3>
<p>| Platform | Python Source | All Versions (3.8-3.14rc2) | <code>round(1.125, 2)</code> | Status |
|----------|---------------|----------------------------|-------------------|--------|
| x86_64 (emulated) | UV-installed | ❌ All affected | <code>1.0</code> | BROKEN |
| x86_64 (emulated) | Standard | ✅ All working | <code>1.12</code> | WORKS |
| x86_64 (native) | UV-installed | ✅ All working | <code>1.12</code> | WORKS |
| ARM64 (native) | UV-installed | ✅ All working | <code>1.12</code> | WORKS |</p>
<h3>Impact</h3>
<ul>
<li><strong>Scope</strong>: Development environments using x86_64 containers on Apple Silicon</li>
<li><strong>Affected Operations</strong>: Mathematical calculations, financial computations, any precision-dependent code</li>
<li><strong>Production Risk</strong>: None (issue limited to emulation environments)</li>
</ul>
<h3>Workarounds</h3>
<ul>
<li>Use ARM64-native UV containers on Apple Silicon</li>
<li>Use standard Python images for x86_64 compatibility testing</li>
<li>Issue does not affect production deployments on native x86_64</li>
</ul>
<h3>Analysis</h3>
<p>Appears to be an emulation compatibility issue where UV's optimized x86_64 Python binaries don't interact correctly with ARM64-to-x86_64 emulation layers, specifically affecting floating-point operations.</p>
<h3>Platform</h3>
<p>macOS 15.6: M1 Pro emulating x86_64</p>
<h3>Version</h3>
<p>uv 0.8.15</p>
<h3>Python versions</h3>
<p>3.8 - 3.14rc2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Bradleywboggs on 2025-09-04 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-04 22:56</div>
            <div class="timeline-body"><p>A couple things I'm confused by</p>
<ol>
<li><code>ghcr.io/astral-sh/uv:python3.9-bookworm</code> this image has Debian's Python pre-installed, not uv's</li>
<li>The reproduction you shared does not reproduce:</li>
</ol>
<pre><code>❯ docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.9-bookworm \
  python -c &quot;print(round(1.125, 2))&quot;
1.12
</code></pre>
<p>Even if you use uv's Python?</p>
<pre><code>❯ docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.9-bookworm uv run --managed-python python -c &quot;print(round(1.125, 2))&quot;
Downloading cpython-3.13.7-linux-x86_64-gnu (download) (30.8MiB)
 Downloading cpython-3.13.7-linux-x86_64-gnu (download)
1.12
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @zanieb on 2025-09-04 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-04 23:07</div>
            <div class="timeline-body"><p>For context, I'm on an M3 MacBook Pro</p>
<pre><code>❯ uname -rsm
Darwin 23.6.0 arm64
❯ docker version
Client:
 Version:           27.5.1
 API version:       1.47
 Go version:        go1.22.11
 Git commit:        9f9e405
 Built:             Wed Jan 22 13:37:19 2025
 OS/Arch:           darwin/arm64
 Context:           orbstack
❯ orb version
Version: 1.10.3 (1100300)
Commit: 2b5dd5f580d80a3d2494b7b40dde2ef46813cfc5 (v1.10.3)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Bradleywboggs">@Bradleywboggs</a> on 2025-09-04 23:52</div>
            <div class="timeline-body"><blockquote>
<p>For context, I'm on an M3 MacBook Pro</p>
<pre><code>❯ uname -rsm
Darwin 23.6.0 arm64
❯ docker version
Client:
 Version:           27.5.1
 API version:       1.47
 Go version:        go1.22.11
 Git commit:        9f9e405
 Built:             Wed Jan 22 13:37:19 2025
 OS/Arch:           darwin/arm64
 Context:           orbstack
❯ orb version
Version: 1.10.3 (1100300)
Commit: 2b5dd5f580d80a3d2494b7b40dde2ef46813cfc5 (v1.10.3)
</code></pre>
</blockquote>
<p>Interesting! I'll go back and investigate further and make updates to the issue or close it.</p>
<h3>UPDATE</h3>
<p>Thanks for pointing out the discrepancy.
I've updated the steps for reproducing. I do indeed get the behavior only when running with the <strong>uv managed</strong> python installation.  That  got lost in my final edits of my notes.</p>
<pre><code>λ&gt;  uname -rsm
Darwin 24.6.0 arm64

λ&gt; docker version
Client:
 Version:           27.5.1
 API version:       1.47
 Go version:        go1.22.11
 Git commit:        9f9e405
 Built:             Wed Jan 22 13:37:19 2025
 OS/Arch:           darwin/arm64
 Context:           desktop-linux

Server: Docker Desktop 4.38.0 (181591)
 Engine:
  Version:          27.5.1
  API version:      1.47 (minimum version 1.24)
  Go version:       go1.22.11
  Git commit:       4c9b3b0
  Built:            Wed Jan 22 13:41:25 2025
  OS/Arch:          linux/arm64
  Experimental:     false
 containerd:
  Version:          1.7.25
  GitCommit:        bcc810d6b9066471b0b6fa75f557a15a1cbf31bb
 runc:
  Version:          1.1.12
  GitCommit:        v1.1.12-0-g51d5e946
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
</code></pre>
<p>@zanieb So the main differerences in our setups are:</p>
<ul>
<li>Docker Desktop vs OrbStack</li>
<li>Darwin 24.6.0  vs Darwin 23.6.0</li>
<li>M1 Pro vs M3 chips (That shouldn't affect emulation, though. The Rosetta versions are the same, I think?)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 07:07</div>
            <div class="timeline-body"><p>This looks like a bug in OrbStack or some other part of the emulation to me, have you tried the latest OrbStack version? If it works on the native platform, the uv-provided binary should be fine and the problem is in the emulation layer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zsol">@zsol</a> on 2025-09-05 08:28</div>
            <div class="timeline-body"><p>This doesn't reproduce for me either (I'm not using rosetta for emulation):</p>
<pre><code>❯ docker version
Client:
 Version:           28.3.3
 API version:       1.51
 Go version:        go1.24.5
 Git commit:        980b856
 Built:             Fri Jul 25 11:33:03 2025
 OS/Arch:           darwin/arm64
 Context:           desktop-linux

Server: Docker Desktop 4.45.0 (203075)
 Engine:
  Version:          28.3.3
  API version:      1.51 (minimum version 1.24)
  Go version:       go1.24.5
  Git commit:       bea959c
  Built:            Fri Jul 25 11:35:32 2025
  OS/Arch:          linux/arm64
  Experimental:     false
 containerd:
  Version:          1.7.27
  GitCommit:        05044ec0a9a75232cad458027ca83437aae3f4da
 runc:
  Version:          1.2.5
  GitCommit:        v1.2.5-0-g59923ef
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
❯ uname -rsm
Darwin 24.6.0 arm64
❯ docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.13-bookworm \
        uv run --managed-python python -c &quot;print(round(1.125, 2))&quot;
Downloading cpython-3.13.7-linux-x86_64-gnu (download) (30.8MiB)
 Downloading cpython-3.13.7-linux-x86_64-gnu (download)
1.12
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Bradleywboggs">@Bradleywboggs</a> on 2025-09-05 11:48</div>
            <div class="timeline-body"><blockquote>
<p>This looks like a bug in OrbStack or some other part of the emulation to me, have you tried the latest OrbStack version? If it works on the native platform, the uv-provided binary should be fine and the problem is in the emulation layer.</p>
</blockquote>
<p>It's strange to me that the system provided Python consistently works when emulating, though. There seems to be something in how the uv managed binary is being compiled to trigger the issue (at least on my machine)</p>
<p>I'm not using orb stack. But I can give it a try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-05 13:14</div>
            <div class="timeline-body"><blockquote>
<p>This looks like a bug in OrbStack</p>
</blockquote>
<p>I'm using OrbStack, they are using Docker Desktop.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 13:19</div>
            <div class="timeline-body"><p>Sorry for mixing those up!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-05 13:21</div>
            <div class="timeline-body"><p>@zsol what's doing the x86-64 emulation in your setup?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szicari-streambit">@szicari-streambit</a> on 2025-09-05 14:13</div>
            <div class="timeline-body"><p>For what it's worth, I experience the same issue on an M1 Mac with vanilla Docker Desktop installed.</p>
<pre><code class="language-shell">docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.13-bookworm \
 uv run --managed-python python -c &quot;print(round(1.125, 2))&quot;
Unable to find image 'ghcr.io/astral-sh/uv:python3.13-bookworm' locally
python3.13-bookworm: Pulling from astral-sh/uv
f014853ae203: Pull complete 
6d6401b7636b: Pull complete 
cffef7dc6f99: Pull complete 
1e6ffe3614ab: Pull complete 
bcfb14ce47c8: Pull complete 
b390d6738a63: Pull complete 
1fe8038e5470: Pull complete 
d88ad2a93a61: Pull complete 
Digest: sha256:d939988134ca1d678d2b1da32862e9ea206e9316fa77697f872b1c42fae61e7a
Status: Downloaded newer image for ghcr.io/astral-sh/uv:python3.13-bookworm
Downloading cpython-3.13.7-linux-x86_64-gnu (download) (30.8MiB)
 Downloading cpython-3.13.7-linux-x86_64-gnu (download)
1.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szicari-streambit">@szicari-streambit</a> on 2025-09-05 14:46</div>
            <div class="timeline-body"><p>Further research yielded that switching from the Apple virtualization framework to Qemu resulted in &quot;correct&quot; behavior.</p>
<pre><code class="language-shell">docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.13-bookworm \
 uv run --managed-python python -c &quot;print(round(1.125, 2))&quot;
Downloading cpython-3.13.7-linux-x86_64-gnu (download) (30.8MiB)
 Downloading cpython-3.13.7-linux-x86_64-gnu (download)
1.12
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Bradleywboggs">@Bradleywboggs</a> on 2025-09-05 14:51</div>
            <div class="timeline-body"><p>Also, simply disabling Rosetta produced correct results, too.</p>
<p><img width="802" height="400" alt="Image" src="https://github.com/user-attachments/assets/559e6f06-7c0f-4da0-a497-0c8990b27f0e" /></p>
<pre><code class="language-bash">λ&gt; docker run --platform linux/amd64 --rm ghcr.io/astral-sh/uv:python3.13-bookworm \
 uv run --managed-python python -c &quot;print(round(1.125, 2))&quot;
Downloading cpython-3.13.7-linux-x86_64-gnu (download) (30.8MiB)
 Downloading cpython-3.13.7-linux-x86_64-gnu (download)
1.12
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Bradleywboggs">@Bradleywboggs</a> on 2025-09-05 14:55</div>
            <div class="timeline-body"><p>It appears this is a problem with Rosetta in other contexts as well:
<a href="https://github.com/oven-sh/bun/issues/19677">https://github.com/oven-sh/bun/issues/19677</a></p>
<p>I'm going to close the issue, since it doesn't appear to be a <code>uv</code> problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Bradleywboggs on 2025-09-05 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-05 15:02</div>
            <div class="timeline-body"><p>For future reference, it looks like Apple has fixed this per https://github.com/oven-sh/bun/issues/19677#issuecomment-3114724055 but it may not have released yet.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:26:56 UTC
    </footer>
</body>
</html>
