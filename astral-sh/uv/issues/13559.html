<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refuses to use old setuptools - astral-sh/uv #13559</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Refuses to use old setuptools</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13559">#13559</a>
        opened by <a href="https://github.com/mlanett">@mlanett</a>
        on 2025-05-20 18:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mlanett">@mlanett</a> on 2025-05-20 18:22</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have an project which I want to uv-ify but which requires some old projects, and uv can't install them.</p>
<p>uv init
uv venv --seed
uv add &quot;setuptools==45.3.0&quot; # Required for old zope-i18nmessageid==4.0.3
uv sync
uv add &quot;zope-i18nmessageid==4.0.3&quot; # Fails because it uses newer setuptools from base python
UV_NO_SYNC=1 uv run pip install &quot;zope-i18nmessageid==4.0.3&quot; # uses setuptools==45.3.0; works
uv pip list # Has zope-i18nmessageid 4.0.3
uv add &quot;zope-i18nmessageid==4.0.3&quot; # Fails even though zope-i18nmessageid is installed</p>
<h1>What is going on:</h1>
<ol>
<li><p>zope-i18nmessageid==4.0.3 requires Feature which is in setuptools==45.3.0</p>
</li>
<li><p>uv keeps trying to use newer setuptools to install packages</p>
</li>
<li><p>Even if we install zope-i18nmessageid==4.0.3 manually, uv add or sync tries to reinstall it, but uses wrong setuptools.</p>
</li>
</ol>
<p>See &quot;Selecting: setuptools==80.8.0&quot; in log output:</p>
<pre><code>$ uv add -v &quot;zope-i18nmessageid==4.0.3&quot; # Fails because it uses setuptools from base image
DEBUG uv 0.7.6 (Homebrew 2025-05-19)
DEBUG Found project root: `/Users/Mark.Lanett/ClassPass/x`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/Users/Mark.Lanett/ClassPass/x`
DEBUG Reading Python requests from version file at `/Users/Mark.Lanett/ClassPass/x/.python-version`
DEBUG Using Python request `3.10` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
DEBUG The project environment's Python version satisfies the request: `Python 3.10`
DEBUG Released lock at `/var/folders/fl/dfhxwq1d07vb1qc_hn9bh04w0000gq/T/uv-d9ff856810d6c64e.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: x @ file:///Users/Mark.Lanett/ClassPass/x
DEBUG No workspace root found, using project root
DEBUG Ignoring existing lockfile due to mismatched requirements for: `x==0.1.0`
  Requested: {Requirement { name: PackageName(&quot;setuptools&quot;), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: &quot;45.3.0&quot; }]), index: None, conflict: None }, origin: None }, Requirement { name: PackageName(&quot;zope-i18nmessageid&quot;), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: &quot;4.0.3&quot; }]), index: None, conflict: None }, origin: None }}
  Existing: {Requirement { name: PackageName(&quot;setuptools&quot;), extras: [], groups: [], marker: true, source: Registry { specifier: VersionSpecifiers([VersionSpecifier { operator: Equal, version: &quot;45.3.0&quot; }]), index: None, conflict: None }, origin: None }}
DEBUG Solving with installed Python version: 3.10.16
DEBUG Solving with target Python version: &gt;=3.10
DEBUG Adding direct dependency: x*
DEBUG Searching for a compatible version of x @ file:///Users/Mark.Lanett/ClassPass/x (*)
DEBUG Adding direct dependency: setuptools&gt;=45.3.0, &lt;45.3.0+
DEBUG Adding direct dependency: zope-i18nmessageid&gt;=4.0.3, &lt;4.0.3+
DEBUG Found stale response for: https://pypi.org/simple/zope-i18nmessageid/
DEBUG Sending revalidation request for: https://pypi.org/simple/zope-i18nmessageid/
DEBUG Found stale response for: https://pypi.org/simple/setuptools/
DEBUG Sending revalidation request for: https://pypi.org/simple/setuptools/
DEBUG Found not-modified response for: https://pypi.org/simple/setuptools/
DEBUG Found not-modified response for: https://pypi.org/simple/zope-i18nmessageid/
DEBUG Searching for a compatible version of setuptools (&gt;=45.3.0, &lt;45.3.0+)
DEBUG Selecting: setuptools==45.3.0 [preference] (setuptools-45.3.0-py3-none-any.whl)
DEBUG Acquired lock for `/Users/Mark.Lanett/Library/Caches/uv/sdists-v9/pypi/zope-i18nmessageid/4.0.3`
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/0e/8e/4d9a9009afeae48ec1301713d96b9ae901aa6e157637ddf37e844c1bf4ee/setuptools-45.3.0-py3-none-any.whl.metadata
DEBUG Searching for a compatible version of zope-i18nmessageid (&gt;=4.0.3, &lt;4.0.3+)
DEBUG Selecting: zope-i18nmessageid==4.0.3 [compatible] (zope.i18nmessageid-4.0.3.tar.gz)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/97/16/e76c4d7833d8e4246e0ebec826b68facbf21c97a1a62a9292f0b2779e3a1/zope.i18nmessageid-4.0.3.tar.gz
DEBUG No `pyproject.toml` available for: zope-i18nmessageid==4.0.3
DEBUG No static `PKG-INFO` available for: zope-i18nmessageid==4.0.3 (PkgInfo(UnsupportedMetadataVersion(&quot;1.0&quot;)))
DEBUG Preparing metadata for: zope-i18nmessageid==4.0.3
DEBUG Assessing Python executable as base candidate: /Users/Mark.Lanett/ClassPass/x/.venv/bin/python3
DEBUG Assessing Python executable as base candidate: /Users/Mark.Lanett/ClassPass/x/.venv/bin/python
DEBUG Assessing Python executable as base candidate: /Users/Mark.Lanett/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/bin/python3.10
DEBUG Using base executable for virtual environment: /Users/Mark.Lanett/.local/share/uv/python/cpython-3.10.16-macos-aarch64-none/bin/python3.10
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.10.16
DEBUG Solving with target Python version: &gt;=3.10.16
DEBUG Adding direct dependency: setuptools&gt;=40.8.0
DEBUG Found fresh response for: https://pypi.org/simple/setuptools/
DEBUG Searching for a compatible version of setuptools (&gt;=40.8.0)
DEBUG Selecting: setuptools==80.8.0 [compatible] (setuptools-80.8.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/58/29/93c53c098d301132196c3238c312825324740851d77a8500a2462c0fd888/setuptools-80.8.0-py3-none-any.whl.metadata
DEBUG Tried 1 versions: setuptools 1
DEBUG marker environment resolution took 0.002s
DEBUG Installing in setuptools==80.8.0 in /Users/Mark.Lanett/Library/Caches/uv/builds-v0/.tmpBMfDNh
DEBUG Registry requirement already cached: setuptools==80.8.0
DEBUG Installing build requirement: setuptools==80.8.0
DEBUG Creating PEP 517 build environment
DEBUG Calling `setuptools.build_meta:__legacy__.get_requires_for_build_wheel()`
DEBUG Traceback (most recent call last):
DEBUG   File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
DEBUG   File &quot;/Users/Mark.Lanett/Library/Caches/uv/builds-v0/.tmpBMfDNh/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 331, in get_requires_for_build_wheel
DEBUG     return self._get_build_requires(config_settings, requirements=[])
DEBUG   File &quot;/Users/Mark.Lanett/Library/Caches/uv/builds-v0/.tmpBMfDNh/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 301, in _get_build_requires
DEBUG     self.run_setup()
DEBUG   File &quot;/Users/Mark.Lanett/Library/Caches/uv/builds-v0/.tmpBMfDNh/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 512, in run_setup
DEBUG     super().run_setup(setup_script=setup_script)
DEBUG   File &quot;/Users/Mark.Lanett/Library/Caches/uv/builds-v0/.tmpBMfDNh/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 317, in run_setup
DEBUG     exec(code, locals())
DEBUG   File &quot;&lt;string&gt;&quot;, line 25, in &lt;module&gt;
DEBUG ImportError: cannot import name 'Feature' from 'setuptools' (/Users/Mark.Lanett/Library/Caches/uv/builds-v0/.tmpBMfDNh/lib/python3.10/site-packages/setuptools/__init__.py)
DEBUG Released lock at `/Users/Mark.Lanett/Library/Caches/uv/sdists-v9/pypi/zope-i18nmessageid/4.0.3/.lock`
DEBUG Reverting changes to `pyproject.toml`
DEBUG Reverting changes to `uv.lock`
  × Failed to build `zope-i18nmessageid==4.0.3`
  ├─▶ The build backend returned an error
</code></pre>
<h3>Platform</h3>
<p>Darwin GKXY9X7G4W 24.4.0 Darwin Kernel Version 24.4.0: Fri Apr 11 18:33:47 PDT 2025; root:xnu-11417.101.15~117/RELEASE_ARM64_T6000 arm64</p>
<h3>Version</h3>
<p>uv --version uv 0.7.6 (Homebrew 2025-05-19)</p>
<h3>Python version</h3>
<p>3.10.16</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @mlanett on 2025-05-20 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-20 18:33</div>
            <div class="timeline-body"><p>You can set build constraints to force an older setuptools version in project mode (https://docs.astral.sh/uv/reference/settings/#build-constraint-dependencies)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-05-20 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-05-20 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mlanett">@mlanett</a> on 2025-05-20 19:53</div>
            <div class="timeline-body"><p>Perfect, I had tried constraint-dependencies but did not find build-constraint-dependencies, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mlanett on 2025-05-20 19:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:06 UTC
    </footer>
</body>
</html>
