<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` rejects pytorch from its index when on mac - astral-sh/uv #5182</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv add` rejects pytorch from its index when on mac</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/5182">#5182</a>
        opened by <a href="https://github.com/baggiponte">@baggiponte</a>
        on 2024-07-18 12:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-07-18 12:25</div>
            <div class="timeline-body"><p>I am trying to use <code>uv</code> to add torch to my project's dependencies, but it fails. I am on macOS14.4.1 (ARM).</p>
<p>Here is a  minimal repro.</p>
<pre><code class="language-toml">[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.10&quot;
</code></pre>
<p>Then run:</p>
<pre><code class="language-bash">uv python pin 3.10
uv add --extra-index-url=&quot;https://download.pytorch.org/whl/cpu&quot; -- torch
</code></pre>
<p>Error:</p>
<pre><code>warning: `uv add` is experimental and may change without warning.
Using Python 3.10.14 interpreter at: /Users/luca/Library/Application Support/uv/python/cpython-3.10.14-macos-aarch64-none/install/bin/python3
Creating virtualenv at: .venv
Resolved 13 packages in 1.69s
error: distribution torch==2.3.1+cpu @ registry+https://download.pytorch.org/whl/cpu can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>If I use <code>uv pip install</code> then everything works smoothly:</p>
<pre><code>uv pip install --extra-index-url=&quot;https://download.pytorch.org/whl/cpu&quot; -- torch
Resolved 9 packages in 1.73s
Installed 9 packages in 369ms
 + filelock==3.13.1
 + fsspec==2024.2.0
 + jinja2==3.1.3
 + markupsafe==2.1.5
 + mpmath==1.3.0
 + networkx==3.2.1
 + sympy==1.12
 + torch==2.3.1
 + typing-extensions==4.9.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-07-18 12:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-18 13:24</div>
            <div class="timeline-body"><p>This is already resolved on main but not released.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-18 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-07-18 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2024-07-18 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-18 13:24</div>
            <div class="timeline-body"><p>Sorry, misread the last part of the error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-18 14:33</div>
            <div class="timeline-body"><p>Can you include the <code>uv.lock</code> that is generated?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">lock</span> added by @zanieb on 2024-07-18 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-19 01:42</div>
            <div class="timeline-body"><p>This one is pretty tricky... Basically, <code>2.3.1+cpu</code> includes Windows and Linux wheels, but not macOS wheels. Separately, <code>2.3.1</code> (without the local version) has macOS wheels. We choose <code>2.3.1+cpu</code> because we don't evaluate platform compatibility during a universal install. But then we don't end up including macOS wheels.</p>
<p>One path forward: if the user selects <code>2.3.1</code>, always choose the non-local version. That at least gives users some more control.</p>
<p>I don't know what other options we have. Try to sniff platform compatibility on the wheel tags, at least for macOS / Windows / Linux?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-19 01:42</div>
            <div class="timeline-body"><p>\cc @konstin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-19 01:48</div>
            <div class="timeline-body"><p>I'd suggest using a direct URL for now while we figure out how to support this @baggiponte.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-19 01:49</div>
            <div class="timeline-body"><p>I've confirmed that Poetry has the same problem. It also chooses:</p>
<pre><code class="language-toml">[[package]]
name = &quot;torch&quot;
version = &quot;2.3.1+cpu&quot;
description = &quot;Tensors and Dynamic neural networks in Python with strong GPU acceleration&quot;
optional = false
python-versions = &quot;&gt;=3.8.0&quot;
files = [
    {file = &quot;torch-2.3.1+cpu-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:d679e21d871982b9234444331a26350902cfd2d5ca44ce6f49896af8b3a3087d&quot;},
    {file = &quot;torch-2.3.1+cpu-cp310-cp310-win_amd64.whl&quot;, hash = &quot;sha256:500bf790afc2fd374a15d06213242e517afccc50a46ea5955d321a9a68003335&quot;},
    {file = &quot;torch-2.3.1+cpu-cp311-cp311-linux_x86_64.whl&quot;, hash = &quot;sha256:a272defe305dbd944aa28a91cc3db0f0149495b3ebec2e39723a7224fa05dc57&quot;},
    {file = &quot;torch-2.3.1+cpu-cp311-cp311-win_amd64.whl&quot;, hash = &quot;sha256:d2965eb54d3c8818e2280a54bd53e8246a6bb34e4b10bd19c59f35b611dd9f05&quot;},
    {file = &quot;torch-2.3.1+cpu-cp312-cp312-linux_x86_64.whl&quot;, hash = &quot;sha256:2141a6cb7021adf2f92a0fd372cfeac524ba460bd39ce3a641d30a561e41f69a&quot;},
    {file = &quot;torch-2.3.1+cpu-cp312-cp312-win_amd64.whl&quot;, hash = &quot;sha256:6acdca2530462611095c44fd95af75ecd5b9646eac813452fe0adf31a9bc310a&quot;},
    {file = &quot;torch-2.3.1+cpu-cp38-cp38-linux_x86_64.whl&quot;, hash = &quot;sha256:cab92d5101e6db686c5525e04d87cedbcf3a556073d71d07fbe7d1ce09630ffb&quot;},
    {file = &quot;torch-2.3.1+cpu-cp38-cp38-win_amd64.whl&quot;, hash = &quot;sha256:dbc784569a367fd425158cf4ae82057dd3011185ba5fc68440432ba0562cb5b2&quot;},
    {file = &quot;torch-2.3.1+cpu-cp39-cp39-linux_x86_64.whl&quot;, hash = &quot;sha256:a3cb8e61ba311cee1bb7463cbdcf3ebdfd071e2091e74c5785e3687eb02819f9&quot;},
    {file = &quot;torch-2.3.1+cpu-cp39-cp39-win_amd64.whl&quot;, hash = &quot;sha256:df68668056e62c0332e03f43d9da5d4278b39df1ba58d30ec20d34242070955d&quot;},
]
</code></pre>
<p>And then <code>poetry install</code> fails after <code>poetry lock</code> succeeds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-07-19 07:42</div>
            <div class="timeline-body"><blockquote>
<p>Can you include the <code>uv.lock</code> that is generated?</p>
</blockquote>
<p>Ops, sorry for the delay. Here it is (sorry for the .txt format, github does not support it).</p>
<p><a href="https://github.com/user-attachments/files/16308854/uv.lock.txt">uv.lock.txt</a></p>
<blockquote>
<p>I'd suggest using a direct URL for now while we figure out how to support this @baggiponte.</p>
</blockquote>
<p>i.e. from pypi, right?</p>
<p>Thank you very much for the prompt support!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimbleby">@dimbleby</a> on 2024-07-19 19:35</div>
            <div class="timeline-body"><p>FWIW over in poetry I have mostly come to think that this is a torch problem and not a poetry problem at all.  (And therefore also not a uv problem).</p>
<p>Specifically I reckon that https://github.com/pytorch/pytorch/issues/110004 is the right request to make, and the right place to make it.  &quot;Closing as implemented&quot; seems not correct, perhaps someone would like to try again.</p>
<p>More generally... pytorch does lots of unusual things with its multiple indexes and playing games with local version identifiers and suchlike.  If you want a taste of the sort of fun uv is likely to have trying to accommodate all of this - and if you have plenty of time to spare - then see https://github.com/python-poetry/poetry/issues/6409.</p>
<p>If uv - either deliberately or accidentally - were to make choices that somehow made sense of all of that, then there are plenty of folk in that thread who would likely be pleased to see it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2024-07-30 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-03 15:05</div>
            <div class="timeline-body"><p>Uhm as an FYI: today I tried <code>uv add torch</code> on M3 mac and it correctly installed the version w/o CUDA (which was brought me to use <code>uv add --extra-index-url=&quot;https://download.pytorch.org/whl/cpu&quot; -- torch</code> in the first place).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7005.html">astral-sh/uv#7005</a> on 2024-09-04 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7557.html">astral-sh/uv#7557</a> on 2024-09-19 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimbleby">@dimbleby</a> on 2024-09-19 22:19</div>
            <div class="timeline-body"><p>https://github.com/pytorch/pytorch/issues/136275</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8536.html">astral-sh/uv#8536</a> on 2024-10-24 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8603.html">astral-sh/uv#8603</a> on 2024-10-27 18:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6523.html">astral-sh/uv#6523</a> on 2024-10-30 20:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8746.html">astral-sh/uv#8746</a> on 2024-11-01 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../owid/etl/pulls/3518.html">owid/etl#3518</a> on 2024-11-08 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9209.html">astral-sh/uv#9209</a> on 2024-11-18 18:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9228.html">astral-sh/uv#9228</a> on 2024-11-19 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../google/magika/issues/801.html">google/magika#801</a> on 2024-11-19 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9412.html">astral-sh/uv#9412</a> on 2024-11-25 14:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9425.html">astral-sh/uv#9425</a> on 2024-11-25 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9514.html">astral-sh/uv#9514</a> on 2024-11-29 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9711.html">astral-sh/uv#9711</a> on 2024-12-07 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-20 19:14</div>
            <div class="timeline-body"><p>Fixed by https://github.com/astral-sh/uv/pull/10046.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-20 19:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/meliz19">@meliz19</a> on 2025-01-22 14:44</div>
            <div class="timeline-body"><p>I'm seeing a similar error when trying to install the Pantsbuild libraries via <code>uv add</code> or <code>uv pip install</code>. I'm on a MacOS 14.7.1 ARM machine. Full error message below.</p>
<pre><code>margaretblack test-project % uv add https://github.com/pantsbuild/pants/releases/download/release_2.23.1/pantsbuild.pants-2.23.1-cp39-cp39-macosx_11_0_arm64.whl
Resolved 25 packages in 2.49s
error: distribution `pantsbuild-pants==2.23.1 @ direct+https://github.com/pantsbuild/pants/releases/download/release_2.23.1/pantsbuild.pants-2.23.1-cp39-cp39-macosx_11_0_arm64.whl` can't be installed because the binary distribution is incompatible with the current platform

margaretblack test-project % uv add https://github.com/pantsbuild/pants/archive/refs/tags/release_2.23.1.tar.gz
error: Failed to parse metadata from built wheel
  Caused by: Metadata field Name not found

margaretblack test-project % uv add https://github.com/pantsbuild/pants/archive/refs/tags/release_2.23.1.zip
error: Failed to parse metadata from built wheel
  Caused by: Metadata field Name not found

margaretblack test-project % uv pip install git+https://github.com/pantsbuild/pants.git@release_2.23.0
 Updated https://github.com/pantsbuild/pants.git (6fad8c66e)
error: Failed to parse metadata from built wheel
  Caused by: Metadata field Name not found
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../TechnologyBrewery/pants-uv-lifecycle-plugin/issues/6.html">TechnologyBrewery/pants-uv-lifecycle-plugin#6</a> on 2025-01-22 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-22 14:55</div>
            <div class="timeline-body"><p>Are you sure that you're using Python 3.9? Does <code>uv add --python 3.9 https://github.com/pantsbuild/pants/releases/download/release_2.23.1/pantsbuild.pants-2.23.1-cp39-cp39-macosx_11_0_arm64.whl</code> fail in the same way?</p>
<p>As for those other failures, I'm not quite sure what to do with them -- it seems like that's not a properly structured Python package...? Running <code>python -m build</code> in those source directories creates invalid wheels.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/meliz19">@meliz19</a> on 2025-01-22 15:10</div>
            <div class="timeline-body"><blockquote>
<p>Are you sure that you're using Python 3.9? Does <code>uv add --python 3.9 https://github.com/pantsbuild/pants/releases/download/release_2.23.1/pantsbuild.pants-2.23.1-cp39-cp39-macosx_11_0_arm64.whl</code> fail in the same way?</p>
<p>As for those other failures, I'm not quite sure what to do with them -- it seems like that's not a properly structured Python package...? Running <code>python -m build</code> in those source directories creates invalid wheels.</p>
</blockquote>
<p>Running <code>uv add --python 3.9 https://github.com/pantsbuild/pants/releases/download/release_2.23.1/pantsbuild.pants-2.23.1-cp39-cp39-macosx_11_0_arm64.whl</code> resolved this issue! Thank you so much for the quick response @charliermarsh!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-22 15:13</div>
            <div class="timeline-body"><p>No prob!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../google/magika/issues/922.html">google/magika#922</a> on 2025-01-24 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../google/magika/issues/928.html">google/magika#928</a> on 2025-01-24 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szethh">@szethh</a> on 2025-03-21 22:39</div>
            <div class="timeline-body"><p>Hi! I am still running into this issue. I'm also on macos (intel). <code>uv add torch</code> results in:</p>
<pre><code>error: Distribution `torch==2.6.0 @ registry+https://pypi.org/simple` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're on macOS (`macosx_14_0_x86_64`), but `torch` (v2.6.0) only has wheels for the following platform: `macosx_11_0_arm64`
</code></pre>
<p>I also tried with the pytorch cpu index, but no dice:</p>
<pre><code>error: Distribution `torch==2.6.0 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're on macOS (`macosx_14_0_x86_64`), but `torch` (v2.6.0) only has wheels for the following platform: `macosx_11_0_arm64`
</code></pre>
<p>My version of uv is <code>0.6.8</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-21 23:05</div>
            <div class="timeline-body"><p>You need to declare macOS x86 as a required environment: https://docs.astral.sh/uv/concepts/resolution/#required-environments (itâ€™s actually the example we use in the docs, so you can copy the configuration at the bottom there)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szethh">@szethh</a> on 2025-03-22 13:38</div>
            <div class="timeline-body"><p>that worked, thanks @charliermarsh!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mathemmagician">@Mathemmagician</a> on 2025-04-10 16:32</div>
            <div class="timeline-body"><p>Just wanted to spell out the Intel x86_64 macOS solution that worked for me</p>
<ol>
<li>In pyproject.toml, add:</li>
</ol>
<pre><code>[tool.uv]
required-environments = [
    &quot;sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;
]
</code></pre>
<ol start="2">
<li>Downgrade NumPy to below 2.0.0:</li>
</ol>
<pre><code>&quot;numpy&lt;2.0.0&quot;,
</code></pre>
<ol start="3">
<li>Run <code>uv sync</code></li>
</ol>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:20 UTC
    </footer>
</body>
</html>
