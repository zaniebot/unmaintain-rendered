<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv publish` error uploading to test.pypi.org due to metadata version mismatch - astral-sh/uv #10733</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv publish</code> error uploading to test.pypi.org due to metadata version mismatch</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10733">#10733</a>
        opened by <a href="https://github.com/CaptSolo">@CaptSolo</a>
        on 2025-01-18 13:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CaptSolo">@CaptSolo</a></div>
            <div class="timeline-body"><p>An error appears when uploading a package to <code>test.pypi.org</code>:</p>
<pre><code>‚ùØ uv publish --index testpypi
warning: `uv publish` is experimental and may change without warning
Publishing 2 files https://test.pypi.org/legacy/
Uploading my_package-0.1.0-py3-none-any.whl (29.9KiB)
error: Failed to publish `dist/my_package-0.1.0-py3-none-any.whl` to https://test.pypi.org/legacy/
  Caused by: Upload failed with status code 400 Bad Request. Server says: 400 license-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.
</code></pre>
<p>It appears that <code>uv</code> generates the <code>License-File:</code> property in package metadata but that metadata is not compatible with the metadata version used:</p>
<p><code>License-File: LICENSE</code></p>
<p>The version of uv:</p>
<ul>
<li>uv 0.5.21 (Homebrew 2025-01-17)</li>
</ul>
<p>The operating system:</p>
<ul>
<li>macOS 14.7</li>
</ul>
<p>The output of the command with the --verbose flag:</p>
<pre><code>Uploading my_project-0.1.0-py3-none-any.whl (29.9KiB)
DEBUG Hashing dist/my_project-0.1.0-py3-none-any.whl
DEBUG Using username/password basic auth
DEBUG Response code for https://test.pypi.org/legacy/: 400 Bad Request
DEBUG Upload error response: {&quot;message&quot;: &quot;The server could not comply with the request since it is either malformed or otherwise incorrect.\n\n\nlicense-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.\n\n&quot;, &quot;code&quot;: &quot;400 license-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.&quot;, &quot;title&quot;: &quot;Bad Request&quot;}
DEBUG Checking for my_project-0.1.0-py3-none-any.whl in the registry
DEBUG No cache entry for: https://test.pypi.org/simple/lv-namedays/
WARN Package not found in the registry; skipping upload check for my_project-0.1.0-py3-none-any.whl
error: Failed to publish `dist/my_project-0.1.0-py3-none-any.whl` to https://test.pypi.org/legacy/
  Caused by: Upload failed with status code 400 Bad Request. Server says: 400 license-file introduced in metadata version 2.4, not 2.2. See https://packaging.python.org/specifications/core-metadata for more information.
</code></pre>
<p>The index used for publishing (set in the <code>pyproject.toml</code> file):</p>
<pre><code>[[tool.uv.index]]
name = &quot;testpypi&quot;
url = &quot;https://test.pypi.org/simple/&quot;
publish-url = &quot;https://test.pypi.org/legacy/&quot;
explicit = true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CaptSolo">@CaptSolo</a> on 2025-01-18 13:46</div>
            <div class="timeline-body"><p>Here&#x27;s the package metadata generated by <code>uv</code>:</p>
<pre><code>Metadata-Version: 2.2
[...]
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Requires-Python: &gt;=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: click
Provides-Extra: convert
Requires-Dist: pandas; extra == &quot;convert&quot;
Requires-Dist: openpyxl; extra == &quot;convert&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CaptSolo">@CaptSolo</a> on 2025-01-18 13:49</div>
            <div class="timeline-body"><p>Related issue (sorry, my issue might be a duplicate): #9513</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CaptSolo">@CaptSolo</a> on 2025-01-18 13:54</div>
            <div class="timeline-body"><p>It seems to be an upstream problem. A workaround is to change the build system from setuptools to hatchling:</p>
<pre><code>[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 15:24</div>
            <div class="timeline-body"><p>Yeah I don&#x27;t believe this is in our control -- this is generated by the build backend (like setuptools or hatchling), not the build frontend (uv).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 15:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:47 UTC
    </footer>
</body>
</html>
