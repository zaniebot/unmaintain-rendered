<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency resolution regression in 0.1.33 - astral-sh/uv #3127</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Dependency resolution regression in 0.1.33</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3127">#3127</a>
        opened by <a href="https://github.com/burgholzer">@burgholzer</a>
        on 2024-04-18 22:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/burgholzer">@burgholzer</a> on 2024-04-18 22:06</div>
            <div class="timeline-body"><p>Hey üëãüèº</p>
<p>thanks for all the work on <code>uv</code>! We recently incorporated it into all the tools we develop as part of our research (https://mqt.readthedocs.io) and the transition was really smooth! üòé</p>
<p>However, I believe the latest version (specifically the changes from #3087) might have broken our CI pipelines.
For a production workflow run failing, see: https://github.com/cda-tum/mqt-core/actions/runs/8744279279/job/23998070565</p>
<p>I tried to construct a minimal reproducible example from what I could gather. The following is the best I could come up with.</p>
<p>Given the following <code>pyproject.toml</code></p>
<pre><code class="language-toml">[build-system]
requires = [&quot;scikit-build-core&gt;=0.8.1&quot;]
build-backend = &quot;scikit_build_core.build&quot;

[project]
name = &quot;uv_reproducer&quot;
requires-python = &quot;&gt;=3.8&quot;
version = &quot;0.1.0&quot;

[project.optional-dependencies]
test = [&quot;pytest&gt;=7.0&quot;]
coverage = [&quot;uv_reproducer[test]&quot;, &quot;pytest-cov&gt;=4&quot;]
</code></pre>
<p>and a minimal <code>CMakeLists.txt</code></p>
<pre><code class="language-cmake">cmake_minimum_required(VERSION 3.15...3.26)
project(${SKBUILD_PROJECT_NAME} LANGUAGES CXX)
</code></pre>
<p>The following chain of commands will error out</p>
<pre><code class="language-bash">uv venv
source .venv/bin/activate
uv pip install scikit-build-core[pyproject]==0.8.1
uv pip install '-ve.[test,coverage]' --resolution=lowest-direct --no-build-isolation
</code></pre>
<p>See below for the complete output.
This is on <code>uv</code> version 0.1.33 running on Ubuntu 22.04.
Tested to work on version 0.1.32.
My guess would be that it has to do with the recursive self dependencies that are now resolved differently, for whatever reason.
Interestingly, running with build isolation, i.e.</p>
<pre><code class="language-bash">uv venv
source .venv/bin/activate
uv pip install '-ve.[test,coverage]' --resolution=lowest-direct
</code></pre>
<p>works just fine.</p>
<p>Would be nice to know if this change was intentional and I am missing something or if there is something to be fixed here (at least the scenario above was working in previous versions). Let me know if you need any more info!</p>
<p>The full error log of the <code>uv pip install '-ve.[test,coverage]' --resolution=lowest-direct --no-build-isolation</code> command is as follows:</p>
<pre><code class="language-console">INFO Found a virtualenv through VIRTUAL_ENV at: /home/lburgholzer/PycharmProjects/uv-reproducer/.venv
DEBUG Cached interpreter info for Python 3.10.12, skipping probing: .venv/bin/python
DEBUG Using Python 3.10.12 environment at .venv/bin/python
DEBUG Trying to lock if free: .venv/.lock
DEBUG Using registry request timeout of 300s
DEBUG Building (editable) file:///home/lburgholzer/PycharmProjects/uv-reproducer
DEBUG Calling `scikit_build_core.build.build_editable(metadata_directory=None)`
DEBUG Finished building (editable): uv-reproducer @ file:///home/lburgholzer/PycharmProjects/uv-reproducer
Built 1 editable in 635ms
DEBUG Solving with target Python version 3.10.12
DEBUG Searching for a compatible version of uv-reproducer[coverage] @ file:///home/lburgholzer/PycharmProjects/uv-reproducer (==0.1.0)
DEBUG Adding transitive dependency for uv-reproducer[coverage]0.1.0: uv-reproducer*
DEBUG Adding transitive dependency for uv-reproducer[coverage]0.1.0: uv-reproducer[test]*
DEBUG Adding transitive dependency for uv-reproducer[coverage]0.1.0: pytest-cov&gt;=4
TRACE Fetching metadata for pytest-cov from https://pypi.org/simple/pytest-cov/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/pytest-cov.rkyv
DEBUG No cache entry for: https://pypi.org/simple/pytest-cov/
TRACE Sending fresh GET request for https://pypi.org/simple/pytest-cov/
TRACE Handling request for https://pypi.org/simple/pytest-cov/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/pytest-cov/
DEBUG Preparing metadata for: uv-reproducer @ file:///home/lburgholzer/PycharmProjects/uv-reproducer
DEBUG No static `PKG-INFO` available for: uv-reproducer @ file:///home/lburgholzer/PycharmProjects/uv-reproducer (MissingPkgInfo)
DEBUG Found static `pyproject.toml` for: uv-reproducer @ file:///home/lburgholzer/PycharmProjects/uv-reproducer
TRACE Received source distribution metadata for: uv-reproducer @ file:///home/lburgholzer/PycharmProjects/uv-reproducer
TRACE cached request https://pypi.org/simple/pytest-cov/ is storable because its response has a 'public' cache-control directive
TRACE Received package metadata for: pytest-cov
TRACE selecting candidate for package pytest-cov with range Range { segments: [(Included(&quot;4&quot;), Unbounded)] } with 46 remote versions
TRACE found candidate for package PackageName(&quot;pytest-cov&quot;) with range Range { segments: [(Included(&quot;4&quot;), Unbounded)] } after 43 steps: &quot;4.0.0&quot; version
DEBUG Searching for a compatible version of pytest-cov (&gt;=4)
TRACE selecting candidate for package pytest-cov with range Range { segments: [(Included(&quot;4&quot;), Unbounded)] } with 46 remote versions
TRACE found candidate for package PackageName(&quot;pytest-cov&quot;) with range Range { segments: [(Included(&quot;4&quot;), Unbounded)] } after 43 steps: &quot;4.0.0&quot; version
DEBUG Selecting: pytest-cov==4.0.0 (pytest_cov-4.0.0-py3-none-any.whl)
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/pytest-cov/pytest_cov-4.0.0-py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/fe/1f/9ec0ddd33bd2b37d6ec50bb39155bca4fe7085fa78b3b434c05459a860e3/pytest_cov-4.0.0-py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/fe/1f/9ec0ddd33bd2b37d6ec50bb39155bca4fe7085fa78b3b434c05459a860e3/pytest_cov-4.0.0-py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/fe/1f/9ec0ddd33bd2b37d6ec50bb39155bca4fe7085fa78b3b434c05459a860e3/pytest_cov-4.0.0-py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/fe/1f/9ec0ddd33bd2b37d6ec50bb39155bca4fe7085fa78b3b434c05459a860e3/pytest_cov-4.0.0-py3-none-any.whl.metadata
TRACE cached request https://files.pythonhosted.org/packages/fe/1f/9ec0ddd33bd2b37d6ec50bb39155bca4fe7085fa78b3b434c05459a860e3/pytest_cov-4.0.0-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: pytest-cov==4.0.0
DEBUG Adding transitive dependency: pytest&gt;=4.6
DEBUG Adding transitive dependency: coverage&gt;=5.2.1
DEBUG Adding transitive dependency: coverage[toml]&gt;=5.2.1
TRACE Fetching metadata for pytest from https://pypi.org/simple/pytest/
TRACE Fetching metadata for coverage from https://pypi.org/simple/coverage/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/pytest.rkyv
DEBUG No cache entry for: https://pypi.org/simple/pytest/
TRACE Sending fresh GET request for https://pypi.org/simple/pytest/
TRACE Handling request for https://pypi.org/simple/pytest/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/pytest/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/coverage.rkyv
DEBUG No cache entry for: https://pypi.org/simple/coverage/
TRACE Sending fresh GET request for https://pypi.org/simple/coverage/
TRACE Handling request for https://pypi.org/simple/coverage/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/coverage/
TRACE cached request https://pypi.org/simple/pytest/ is storable because its response has a 'public' cache-control directive
TRACE Received package metadata for: pytest
TRACE selecting candidate for package pytest with range Range { segments: [(Included(&quot;4.6&quot;), Unbounded)] } with 173 remote versions
TRACE found candidate for package PackageName(&quot;pytest&quot;) with range Range { segments: [(Included(&quot;4.6&quot;), Unbounded)] } after 102 steps: &quot;4.6.0&quot; version
DEBUG Searching for a compatible version of pytest (&gt;=4.6)
TRACE selecting candidate for package pytest with range Range { segments: [(Included(&quot;4.6&quot;), Unbounded)] } with 173 remote versions
TRACE found candidate for package PackageName(&quot;pytest&quot;) with range Range { segments: [(Included(&quot;4.6&quot;), Unbounded)] } after 102 steps: &quot;4.6.0&quot; version
DEBUG Selecting: pytest==4.6.0 (pytest-4.6.0-py2.py3-none-any.whl)
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/pytest/pytest-4.6.0-py2.py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/98/b8/db268d7c6b517af5b1731fc95d13e89a5032116a1482f2badb423333a420/pytest-4.6.0-py2.py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/98/b8/db268d7c6b517af5b1731fc95d13e89a5032116a1482f2badb423333a420/pytest-4.6.0-py2.py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/98/b8/db268d7c6b517af5b1731fc95d13e89a5032116a1482f2badb423333a420/pytest-4.6.0-py2.py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/98/b8/db268d7c6b517af5b1731fc95d13e89a5032116a1482f2badb423333a420/pytest-4.6.0-py2.py3-none-any.whl.metadata
TRACE cached request https://pypi.org/simple/coverage/ is storable because its response has a 'public' cache-control directive
TRACE cached request https://files.pythonhosted.org/packages/98/b8/db268d7c6b517af5b1731fc95d13e89a5032116a1482f2badb423333a420/pytest-4.6.0-py2.py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: pytest==4.6.0
DEBUG Adding transitive dependency: py&gt;=1.5.0
DEBUG Adding transitive dependency: six&gt;=1.10.0
DEBUG Adding transitive dependency: packaging*
DEBUG Adding transitive dependency: attrs&gt;=17.4.0
DEBUG Adding transitive dependency: atomicwrites&gt;=1.0
DEBUG Adding transitive dependency: pluggy&gt;=0.12, &lt;1.0
DEBUG Adding transitive dependency: importlib-metadata&gt;=0.12
DEBUG Adding transitive dependency: wcwidth*
DEBUG Adding transitive dependency: more-itertools&gt;=4.0.0
TRACE Fetching metadata for py from https://pypi.org/simple/py/
TRACE Fetching metadata for six from https://pypi.org/simple/six/
TRACE Fetching metadata for packaging from https://pypi.org/simple/packaging/
TRACE Fetching metadata for attrs from https://pypi.org/simple/attrs/
TRACE Fetching metadata for atomicwrites from https://pypi.org/simple/atomicwrites/
TRACE Fetching metadata for pluggy from https://pypi.org/simple/pluggy/
TRACE Fetching metadata for importlib-metadata from https://pypi.org/simple/importlib-metadata/
TRACE Fetching metadata for wcwidth from https://pypi.org/simple/wcwidth/
TRACE Fetching metadata for more-itertools from https://pypi.org/simple/more-itertools/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/py.rkyv
DEBUG No cache entry for: https://pypi.org/simple/py/
TRACE Sending fresh GET request for https://pypi.org/simple/py/
TRACE Handling request for https://pypi.org/simple/py/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/py/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/six.rkyv
DEBUG No cache entry for: https://pypi.org/simple/six/
TRACE Sending fresh GET request for https://pypi.org/simple/six/
TRACE Handling request for https://pypi.org/simple/six/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/six/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/attrs.rkyv
DEBUG No cache entry for: https://pypi.org/simple/attrs/
TRACE Sending fresh GET request for https://pypi.org/simple/attrs/
TRACE Handling request for https://pypi.org/simple/attrs/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/attrs/
TRACE cached request https://pypi.org/simple/packaging/ is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://pypi.org/simple/packaging/
TRACE Received package metadata for: packaging
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/pluggy.rkyv
DEBUG No cache entry for: https://pypi.org/simple/pluggy/
TRACE Sending fresh GET request for https://pypi.org/simple/pluggy/
TRACE Handling request for https://pypi.org/simple/pluggy/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/pluggy/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/atomicwrites.rkyv
DEBUG No cache entry for: https://pypi.org/simple/atomicwrites/
TRACE Sending fresh GET request for https://pypi.org/simple/atomicwrites/
TRACE Handling request for https://pypi.org/simple/atomicwrites/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/atomicwrites/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/importlib-metadata.rkyv
DEBUG No cache entry for: https://pypi.org/simple/importlib-metadata/
TRACE Sending fresh GET request for https://pypi.org/simple/importlib-metadata/
TRACE Handling request for https://pypi.org/simple/importlib-metadata/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/importlib-metadata/
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/wcwidth.rkyv
DEBUG No cache entry for: https://pypi.org/simple/wcwidth/
TRACE Sending fresh GET request for https://pypi.org/simple/wcwidth/
TRACE Handling request for https://pypi.org/simple/wcwidth/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/wcwidth/
DEBUG Found installed version of packaging==24.0 that satisfies preference in *
TRACE Received installed distribution metadata for: packaging==24.0
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/simple-v7/pypi/more-itertools.rkyv
DEBUG No cache entry for: https://pypi.org/simple/more-itertools/
TRACE Sending fresh GET request for https://pypi.org/simple/more-itertools/
TRACE Handling request for https://pypi.org/simple/more-itertools/
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://pypi.org/simple/more-itertools/
TRACE cached request https://pypi.org/simple/py/ is storable because its response has a 'public' cache-control directive
TRACE Received package metadata for: py
TRACE selecting candidate for package py with range Range { segments: [(Included(&quot;1.5.0&quot;), Unbounded)] } with 62 remote versions
TRACE found candidate for package PackageName(&quot;py&quot;) with range Range { segments: [(Included(&quot;1.5.0&quot;), Unbounded)] } after 0 steps: &quot;1.11.0&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/py/py-1.11.0-py2.py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/f6/f0/10642828a8dfb741e5f3fbaac830550a518a775c7fff6f04a007259b0548/py-1.11.0-py2.py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/f6/f0/10642828a8dfb741e5f3fbaac830550a518a775c7fff6f04a007259b0548/py-1.11.0-py2.py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/f6/f0/10642828a8dfb741e5f3fbaac830550a518a775c7fff6f04a007259b0548/py-1.11.0-py2.py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/f6/f0/10642828a8dfb741e5f3fbaac830550a518a775c7fff6f04a007259b0548/py-1.11.0-py2.py3-none-any.whl.metadata
TRACE cached request https://pypi.org/simple/six/ is storable because its response has a 'public' cache-control directive
TRACE cached request https://files.pythonhosted.org/packages/f6/f0/10642828a8dfb741e5f3fbaac830550a518a775c7fff6f04a007259b0548/py-1.11.0-py2.py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: py==1.11.0
TRACE Received package metadata for: six
TRACE selecting candidate for package six with range Range { segments: [(Included(&quot;1.10.0&quot;), Unbounded)] } with 28 remote versions
TRACE found candidate for package PackageName(&quot;six&quot;) with range Range { segments: [(Included(&quot;1.10.0&quot;), Unbounded)] } after 0 steps: &quot;1.16.0&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/six/six-1.16.0-py2.py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl.metadata
TRACE Received package metadata for: coverage
TRACE selecting candidate for package coverage with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } with 129 remote versions
TRACE found candidate for package PackageName(&quot;coverage&quot;) with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } after 0 steps: &quot;7.4.4&quot; version
TRACE selecting candidate for package coverage with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } with 129 remote versions
TRACE found candidate for package PackageName(&quot;coverage&quot;) with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } after 0 steps: &quot;7.4.4&quot; version
DEBUG Searching for a compatible version of coverage (&gt;=5.2.1)
TRACE selecting candidate for package coverage with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } with 129 remote versions
TRACE found candidate for package PackageName(&quot;coverage&quot;) with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } after 0 steps: &quot;7.4.4&quot; version
DEBUG Selecting: coverage==7.4.4 (coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl)
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/coverage/coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/93/41/e6e9dbb322f3c93aba7bc519b9c62846d923d7b57398bdd7eda3f0acdd11/coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/93/41/e6e9dbb322f3c93aba7bc519b9c62846d923d7b57398bdd7eda3f0acdd11/coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/93/41/e6e9dbb322f3c93aba7bc519b9c62846d923d7b57398bdd7eda3f0acdd11/coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/93/41/e6e9dbb322f3c93aba7bc519b9c62846d923d7b57398bdd7eda3f0acdd11/coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata
TRACE cached request https://pypi.org/simple/attrs/ is storable because its response has a 'public' cache-control directive
TRACE cached request https://pypi.org/simple/pluggy/ is storable because its response has a 'public' cache-control directive
TRACE Received package metadata for: attrs
TRACE cached request https://pypi.org/simple/atomicwrites/ is storable because its response has a 'public' cache-control directive
TRACE selecting candidate for package attrs with range Range { segments: [(Included(&quot;17.4.0&quot;), Unbounded)] } with 28 remote versions
TRACE found candidate for package PackageName(&quot;attrs&quot;) with range Range { segments: [(Included(&quot;17.4.0&quot;), Unbounded)] } after 0 steps: &quot;23.2.0&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/attrs/attrs-23.2.0-py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/e0/44/827b2a91a5816512fcaf3cc4ebc465ccd5d598c45cefa6703fcf4a79018f/attrs-23.2.0-py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/e0/44/827b2a91a5816512fcaf3cc4ebc465ccd5d598c45cefa6703fcf4a79018f/attrs-23.2.0-py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/e0/44/827b2a91a5816512fcaf3cc4ebc465ccd5d598c45cefa6703fcf4a79018f/attrs-23.2.0-py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/e0/44/827b2a91a5816512fcaf3cc4ebc465ccd5d598c45cefa6703fcf4a79018f/attrs-23.2.0-py3-none-any.whl.metadata
TRACE Received package metadata for: pluggy
TRACE selecting candidate for package pluggy with range Range { segments: [(Included(&quot;0.12&quot;), Excluded(&quot;1.0&quot;))] } with 22 remote versions
TRACE found candidate for package PackageName(&quot;pluggy&quot;) with range Range { segments: [(Included(&quot;0.12&quot;), Excluded(&quot;1.0&quot;))] } after 6 steps: &quot;0.13.1&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/pluggy/pluggy-0.13.1-py2.py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/a0/28/85c7aa31b80d150b772fbe4a229487bc6644da9ccb7e427dd8cc60cb8a62/pluggy-0.13.1-py2.py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/a0/28/85c7aa31b80d150b772fbe4a229487bc6644da9ccb7e427dd8cc60cb8a62/pluggy-0.13.1-py2.py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/a0/28/85c7aa31b80d150b772fbe4a229487bc6644da9ccb7e427dd8cc60cb8a62/pluggy-0.13.1-py2.py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/a0/28/85c7aa31b80d150b772fbe4a229487bc6644da9ccb7e427dd8cc60cb8a62/pluggy-0.13.1-py2.py3-none-any.whl.metadata
TRACE Received package metadata for: atomicwrites
TRACE selecting candidate for package atomicwrites with range Range { segments: [(Included(&quot;1.0&quot;), Unbounded)] } with 18 remote versions
TRACE found candidate for package PackageName(&quot;atomicwrites&quot;) with range Range { segments: [(Included(&quot;1.0&quot;), Unbounded)] } after 0 steps: &quot;1.4.1&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/built-wheels-v3/pypi/atomicwrites/1.4.1/revision.http
DEBUG No cache entry for: https://files.pythonhosted.org/packages/87/c6/53da25344e3e3a9c01095a89f16dbcda021c609ddb42dd6d7c0528236fb2/atomicwrites-1.4.1.tar.gz
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/87/c6/53da25344e3e3a9c01095a89f16dbcda021c609ddb42dd6d7c0528236fb2/atomicwrites-1.4.1.tar.gz
TRACE Handling request for https://files.pythonhosted.org/packages/87/c6/53da25344e3e3a9c01095a89f16dbcda021c609ddb42dd6d7c0528236fb2/atomicwrites-1.4.1.tar.gz
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/87/c6/53da25344e3e3a9c01095a89f16dbcda021c609ddb42dd6d7c0528236fb2/atomicwrites-1.4.1.tar.gz
TRACE cached request https://pypi.org/simple/more-itertools/ is storable because its response has a 'public' cache-control directive
TRACE cached request https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: six==1.16.0
TRACE cached request https://pypi.org/simple/importlib-metadata/ is storable because its response has a 'public' cache-control directive
TRACE cached request https://pypi.org/simple/wcwidth/ is storable because its response has a 'public' cache-control directive
TRACE Received package metadata for: wcwidth
TRACE selecting candidate for package wcwidth with range Range { segments: [(Unbounded, Unbounded)] } with 25 remote versions
TRACE found candidate for package PackageName(&quot;wcwidth&quot;) with range Range { segments: [(Unbounded, Unbounded)] } after 0 steps: &quot;0.2.13&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/wcwidth/wcwidth-0.2.13-py2.py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/fd/84/fd2ba7aafacbad3c4201d395674fc6348826569da3c0937e75505ead3528/wcwidth-0.2.13-py2.py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/fd/84/fd2ba7aafacbad3c4201d395674fc6348826569da3c0937e75505ead3528/wcwidth-0.2.13-py2.py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/fd/84/fd2ba7aafacbad3c4201d395674fc6348826569da3c0937e75505ead3528/wcwidth-0.2.13-py2.py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/fd/84/fd2ba7aafacbad3c4201d395674fc6348826569da3c0937e75505ead3528/wcwidth-0.2.13-py2.py3-none-any.whl.metadata
TRACE Received package metadata for: more-itertools
TRACE selecting candidate for package more-itertools with range Range { segments: [(Included(&quot;4.0.0&quot;), Unbounded)] } with 45 remote versions
TRACE found candidate for package PackageName(&quot;more-itertools&quot;) with range Range { segments: [(Included(&quot;4.0.0&quot;), Unbounded)] } after 0 steps: &quot;10.2.0&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/more-itertools/more_itertools-10.2.0-py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/50/e2/8e10e465ee3987bb7c9ab69efb91d867d93959095f4807db102d07995d94/more_itertools-10.2.0-py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/50/e2/8e10e465ee3987bb7c9ab69efb91d867d93959095f4807db102d07995d94/more_itertools-10.2.0-py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/50/e2/8e10e465ee3987bb7c9ab69efb91d867d93959095f4807db102d07995d94/more_itertools-10.2.0-py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/50/e2/8e10e465ee3987bb7c9ab69efb91d867d93959095f4807db102d07995d94/more_itertools-10.2.0-py3-none-any.whl.metadata
TRACE Received package metadata for: importlib-metadata
TRACE selecting candidate for package importlib-metadata with range Range { segments: [(Included(&quot;0.12&quot;), Unbounded)] } with 114 remote versions
TRACE found candidate for package PackageName(&quot;importlib-metadata&quot;) with range Range { segments: [(Included(&quot;0.12&quot;), Unbounded)] } after 0 steps: &quot;7.1.0&quot; version
TRACE No cache entry exists for /home/lburgholzer/.cache/uv/wheels-v1/pypi/importlib-metadata/importlib_metadata-7.1.0-py3-none-any.msgpack
DEBUG No cache entry for: https://files.pythonhosted.org/packages/2d/0a/679461c511447ffaf176567d5c496d1de27cbe34a87df6677d7171b2fbd4/importlib_metadata-7.1.0-py3-none-any.whl.metadata
TRACE Sending fresh GET request for https://files.pythonhosted.org/packages/2d/0a/679461c511447ffaf176567d5c496d1de27cbe34a87df6677d7171b2fbd4/importlib_metadata-7.1.0-py3-none-any.whl.metadata
TRACE Handling request for https://files.pythonhosted.org/packages/2d/0a/679461c511447ffaf176567d5c496d1de27cbe34a87df6677d7171b2fbd4/importlib_metadata-7.1.0-py3-none-any.whl.metadata
TRACE No credentials on request, checking cache...
TRACE No credentials in cache.
DEBUG No credentials found for https://files.pythonhosted.org/packages/2d/0a/679461c511447ffaf176567d5c496d1de27cbe34a87df6677d7171b2fbd4/importlib_metadata-7.1.0-py3-none-any.whl.metadata
TRACE cached request https://files.pythonhosted.org/packages/93/41/e6e9dbb322f3c93aba7bc519b9c62846d923d7b57398bdd7eda3f0acdd11/coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: coverage==7.4.4
DEBUG Searching for a compatible version of coverage[toml] (&gt;=5.2.1)
TRACE selecting candidate for package coverage with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } with 129 remote versions
TRACE found candidate for package PackageName(&quot;coverage&quot;) with range Range { segments: [(Included(&quot;5.2.1&quot;), Unbounded)] } after 0 steps: &quot;7.4.4&quot; version
DEBUG Selecting: coverage[toml]==7.4.4 (coverage-7.4.4-cp310-cp310-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl)
DEBUG Adding transitive dependency: tomli*
DEBUG Searching for a compatible version of py (&gt;=1.5.0)
TRACE selecting candidate for package py with range Range { segments: [(Included(&quot;1.5.0&quot;), Unbounded)] } with 62 remote versions
TRACE found candidate for package PackageName(&quot;py&quot;) with range Range { segments: [(Included(&quot;1.5.0&quot;), Unbounded)] } after 0 steps: &quot;1.11.0&quot; version
DEBUG Selecting: py==1.11.0 (py-1.11.0-py2.py3-none-any.whl)
DEBUG Searching for a compatible version of six (&gt;=1.10.0)
TRACE selecting candidate for package six with range Range { segments: [(Included(&quot;1.10.0&quot;), Unbounded)] } with 28 remote versions
TRACE found candidate for package PackageName(&quot;six&quot;) with range Range { segments: [(Included(&quot;1.10.0&quot;), Unbounded)] } after 0 steps: &quot;1.16.0&quot; version
DEBUG Selecting: six==1.16.0 (six-1.16.0-py2.py3-none-any.whl)
DEBUG Searching for a compatible version of attrs (&gt;=17.4.0)
TRACE selecting candidate for package attrs with range Range { segments: [(Included(&quot;17.4.0&quot;), Unbounded)] } with 28 remote versions
TRACE found candidate for package PackageName(&quot;attrs&quot;) with range Range { segments: [(Included(&quot;17.4.0&quot;), Unbounded)] } after 0 steps: &quot;23.2.0&quot; version
DEBUG Selecting: attrs==23.2.0 (attrs-23.2.0-py3-none-any.whl)
TRACE Fetching metadata for tomli from https://pypi.org/simple/tomli/
TRACE cached request https://pypi.org/simple/tomli/ is storable because its response has a 'public' cache-control directive
DEBUG Found fresh response for: https://pypi.org/simple/tomli/
TRACE Received package metadata for: tomli
DEBUG Found installed version of tomli==2.0.1 that satisfies preference in *
TRACE Received installed distribution metadata for: tomli==2.0.1
TRACE cached request https://files.pythonhosted.org/packages/e0/44/827b2a91a5816512fcaf3cc4ebc465ccd5d598c45cefa6703fcf4a79018f/attrs-23.2.0-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: attrs==23.2.0
DEBUG Searching for a compatible version of atomicwrites (&gt;=1.0)
TRACE selecting candidate for package atomicwrites with range Range { segments: [(Included(&quot;1.0&quot;), Unbounded)] } with 18 remote versions
TRACE found candidate for package PackageName(&quot;atomicwrites&quot;) with range Range { segments: [(Included(&quot;1.0&quot;), Unbounded)] } after 0 steps: &quot;1.4.1&quot; version
DEBUG Selecting: atomicwrites==1.4.1 (atomicwrites-1.4.1.tar.gz)
TRACE cached request https://files.pythonhosted.org/packages/87/c6/53da25344e3e3a9c01095a89f16dbcda021c609ddb42dd6d7c0528236fb2/atomicwrites-1.4.1.tar.gz is storable because its response has a 'public' cache-control directive
DEBUG Downloading source distribution: atomicwrites==1.4.1
DEBUG Preparing metadata for: atomicwrites==1.4.1
DEBUG No static `PKG-INFO` available for: atomicwrites==1.4.1 (DynamicPkgInfo(UnsupportedMetadataVersion(&quot;1.2&quot;)))
DEBUG No static `pyproject.toml` available for: atomicwrites==1.4.1 (MissingPyprojectToml)
DEBUG Calling `setuptools.build_meta:__legacy__.prepare_metadata_for_build_wheel()`
TRACE cached request https://files.pythonhosted.org/packages/fd/84/fd2ba7aafacbad3c4201d395674fc6348826569da3c0937e75505ead3528/wcwidth-0.2.13-py2.py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: wcwidth==0.2.13
TRACE cached request https://files.pythonhosted.org/packages/a0/28/85c7aa31b80d150b772fbe4a229487bc6644da9ccb7e427dd8cc60cb8a62/pluggy-0.13.1-py2.py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: pluggy==0.13.1
TRACE cached request https://files.pythonhosted.org/packages/50/e2/8e10e465ee3987bb7c9ab69efb91d867d93959095f4807db102d07995d94/more_itertools-10.2.0-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: more-itertools==10.2.0
TRACE cached request https://files.pythonhosted.org/packages/2d/0a/679461c511447ffaf176567d5c496d1de27cbe34a87df6677d7171b2fbd4/importlib_metadata-7.1.0-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE Received built distribution metadata for: importlib-metadata==7.1.0
error: Failed to download and build: atomicwrites==1.4.1
  Caused by: Failed to build: atomicwrites==1.4.1
  Caused by: Build backend failed to determine metadata through `prepare_metadata_for_build_wheel` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
ModuleNotFoundError: No module named 'setuptools'
---
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 22:18</div>
            <div class="timeline-body"><p>Thanks, I‚Äôll have to look at the changelog to see what‚Äôs up. My initial reaction is that there‚Äôs probably a real problem with that package? But that (by chance?) we went down a different resolution path in the prior version ‚Äî probably due to incorporating pip‚Äôs heuristics around how we prioritize packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 22:18</div>
            <div class="timeline-body"><p>(But need to revisit when I‚Äôm back at my laptop.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 22:45</div>
            <div class="timeline-body"><p>Can I ask why you're running with <code>--no-build-isolation</code>? And, if intentional, why not install <code>setuptools</code>, since it seems to be needed to build some of the requisite packages?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-04-18 22:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-04-18 22:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/burgholzer">@burgholzer</a> on 2024-04-18 23:17</div>
            <div class="timeline-body"><blockquote>
<p>Can I ask why you're running with <code>--no-build-isolation</code>? And, if intentional, why not install <code>setuptools</code>, since it seems to be needed to build some of the requisite packages?</p>
</blockquote>
<p>Running with no build isolation can speed up repeated builds and is especially helpful when working with compiled extensions because it does not create a throwaway temporary directory for the build but maintains a set build directory, allowing for much faster rebuilds.</p>
<p>I don't believe installing setuptools is the right solution here as it is not a direct dependency of our project (neither is it in the reproducer).
Note also, that unwinding the recursive self dependencies and replacing the &quot;uv_reproducer[test]&quot; in the coverage extra definition by &quot;pytest&gt;=7&quot; works without any problems.
I would consider this (pytest + pytest-cov) one of the most common setups for measuring code coverage in Python. That combination is pretty much tried and tested.
I am fairly confident that the problem here has something to do with how &quot;--resolution=lowest-direct&quot; interacts with recursive self-dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 23:24</div>
            <div class="timeline-body"><p>I'll take a closer look, but:</p>
<blockquote>
<p>I don't believe installing setuptools is the right solution here as it is not a direct dependency of our project (neither is it in the reproducer).</p>
</blockquote>
<p>I don't think this is the right criteria though, is it? If you run with <code>--no-build-isolation</code>, you must install all build dependencies of all of your dependencies upfront. Like, would you agree that if your resolution leads to installing <code>atomicwrites==1.4.1</code>, and you're running with <code>--no-build-isolation</code>, you <em>must</em> install <code>setuptools</code> in order to succeed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 23:29</div>
            <div class="timeline-body"><p>I think the <code>pytest&gt;=7.0</code> is being enforced &quot;too late&quot; due to the order in which we're visiting the requirements. So we try to solve <code>pytest-cov&gt;=4</code> before we expand <code>uv_reproducer[test]</code>. Presumedly it would end up reaching the same conclusion by backtracking, but it's building older versions than is strictly necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2024-04-18 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-04-18 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmc-cs-mdrissi">@hmc-cs-mdrissi</a> on 2024-04-18 23:30</div>
            <div class="timeline-body"><pre><code>Disable isolation when building a modern source distribution. Build dependencies specified by PEP 518 must be already installed if this option is used.

</code></pre>
<p>https://pip.pypa.io/en/stable/cli/pip_install/#cmdoption-no-build-isolation</p>
<p>--no-build-isolation means you must install all build dependencies manually. setuptools might be special cased by pip due to legacy reasons, but even that is not required and newer pip is allowed to break here too. Although exact resolver/backtracking behavior is going to be very installer specific. You must manually manage your build dependencies for all packages you resolve if you use it.</p>
<p>In practice this tends to be not bad as build dependencies are relatively uncommon that I normally do,</p>
<pre><code>pip install a b c --no-dependencies # build dependencies
pip install requirements.txt --no-dependencies --no-build-isolation
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/burgholzer">@burgholzer</a> on 2024-04-18 23:32</div>
            <div class="timeline-body"><blockquote>
<p>I'll take a closer look, but:</p>
<blockquote>
<p>I don't believe installing setuptools is the right solution here as it is not a direct dependency of our project (neither is it in the reproducer).</p>
</blockquote>
<p>I don't think this is the right criteria though, is it? If you run with <code>--no-build-isolation</code>, you must install all build dependencies of all of your dependencies upfront. Like, would you agree that if your resolution leads to installing <code>atomicwrites==1.4.1</code>, and you're running with <code>--no-build-isolation</code>, you <em>must</em> install <code>setuptools</code> in order to succeed?</p>
</blockquote>
<p>No, the build isolation setting is not transitive. It only holds for the current package. At least that's what I've gotten to learn from pip.</p>
<p>https://pip.pypa.io/en/stable/cli/pip_install/#options just states:</p>
<blockquote>
<p>--no-build-isolation
Disable isolation when building a modern source distribution. Build dependencies specified by PEP 518 must be already installed if this option is used.</p>
</blockquote>
<p>In the reproducer above, the only build dependency (scikit-build-core) is installed prior to the main package install.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 23:38</div>
            <div class="timeline-body"><p>I think we should avoid trying to build this package at all (i.e., I agree that this shouldn't <em>require</em> setuptools), but you <em>definitely</em> need to install all build dependencies for all transitive dependencies that will be built from source, if you run with <code>--no-build-isolation</code>. (For example: try running <code>pip install pytest==4.6.0 --no-build-isolation</code> in an environment without setuptools.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-04-18 23:39</div>
            <div class="timeline-body"><p>The issue appears to be uv 0.1.33 is selecting an old version of pytest:</p>
<pre><code>DEBUG Selecting: pytest==4.6.0 (pytest-4.6.0-py2.py3-none-any.whl)
</code></pre>
<p>Even though the requirements included a higher lower bound:</p>
<pre><code>test = [&quot;pytest&gt;=7.0&quot;]
</code></pre>
<p>In uv 0.1.32 a much higher version of pytest is selected (that matches the constraints of the lower bound):</p>
<pre><code>DEBUG Selecting: pytest==7.0.0 (pytest-7.0.0-py3-none-any.whl)
</code></pre>
<p>The requirement for atomicwrites was removed for non-Windows platforms in pytest 5.3.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-04-18 23:43</div>
            <div class="timeline-body"><blockquote>
<p>I think the <code>pytest&gt;=7.0</code> is being enforced &quot;too late&quot; due to the order in which we're visiting the requirements. So we try to solve <code>pytest-cov&gt;=4</code> before we expand <code>uv_reproducer[test]</code>. Presumedly it would end up reaching the same conclusion by backtracking, but it's building older versions than is strictly necessary.</p>
</blockquote>
<p>Oh, @charliermarsh already beat me to while I was testing and writing the post.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 23:43</div>
            <div class="timeline-body"><p>Haha yeah. That matches my diagnosis above. Because of the heuristics (which are clearly off a bit), we're fully resolving <code>pytest-cov&gt;=4</code> before we even look at <code>uv_reproducer[test]</code>, which adds the extra constraint.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/burgholzer">@burgholzer</a> on 2024-04-18 23:44</div>
            <div class="timeline-body"><blockquote>
<p>I think the <code>pytest&gt;=7.0</code> is being enforced &quot;too late&quot; due to the order in which we're visiting the requirements. So we try to solve <code>pytest-cov&gt;=4</code> before we expand <code>uv_reproducer[test]</code>. Presumedly it would end up reaching the same conclusion by backtracking, but it's building older versions than is strictly necessary.</p>
</blockquote>
<p>I would also suspect this to be the case.
I guess most of the errors that pop up with &quot;--resolution=lowest-direct&quot; originate from rather old packages that are being resolved. And if the &quot;pytest-cov&quot; resolution were the only one to take place here, I would totally consider that a package/user error and definitely not an error with <code>uv</code>, given that it resolved correctly.
In this case, however, it could (maybe should) be able to detect that a different dependency applies a stricter lower bound and hence, it may only try from that version onwards anyways.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-18 23:46</div>
            <div class="timeline-body"><p>Yeah, there's something for us to fix here. I'll look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/burgholzer">@burgholzer</a> on 2024-04-18 23:47</div>
            <div class="timeline-body"><blockquote>
<p>I think we should avoid trying to build this package at all (i.e., I agree that this shouldn't <em>require</em> setuptools), but you <em>definitely</em> need to install all build dependencies for all transitive dependencies that will be built from source, if you run with <code>--no-build-isolation</code>. (For example: try running <code>pip install pytest==4.6.0 --no-build-isolation</code> in an environment without setuptools.)</p>
</blockquote>
<p>Thanks for pointing that out! Didn't know that before üôå</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmc-cs-mdrissi">@hmc-cs-mdrissi</a> on 2024-04-18 23:48</div>
            <div class="timeline-body"><pre><code>No, the build isolation setting is not transitive. It only holds for the current package. At least that's what I've gotten to learn from pip.
</code></pre>
<p>I don't follow this. My experience using pip is it is transitive and I've just confirmed this. The easiest way is to test this manually by installing library A that has dependency B which depends on some build dependency and avoid installing it yourself. pip will crash here even though A does not have any build dependencies itself. This is a little tricky to pull off with pip as most recent libraries have wheels so you end up needing to look for interesting example or use --no-binary to avoid choosing the wheel.</p>
<p>setuptools is rather special and pip often pre-seeds that one, but that's legacy choice that future pips/python versions may stop doing entirely. I think only recent python versions/pip avoid pre-seeding setuptools.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/burgholzer">@burgholzer</a> on 2024-04-18 23:52</div>
            <div class="timeline-body"><blockquote>
<pre><code>
No, the build isolation setting is not transitive. It only holds for the current package. At least that's what I've gotten to learn from pip.

</code></pre>
<p>I don't follow this. My experience using pip is it is transitive and I've just confirmed this. The easiest way is to test this manually by installing library A that has dependency B which depends on some build dependency and avoid installing it yourself. pip will crash here even though A does not have any build dependencies itself. This is a little tricky to pull off with pip as most recent libraries have wheels so you end up needing to look for interesting example or use --no-binary to avoid choosing the wheel.</p>
<p>setuptools is rather special and pip often pre-seeds that one, but that's legacy choice that future pips/python versions may stop doing entirely. I think only recent python versions/pip avoid pre-seeding setuptools.</p>
</blockquote>
<p>Yeah. That was totally a misconception on my end based on the fact that up until the most recent versions of pip, setuptools was always special cased. So I guess I never really noticed the explicit dependency there.
Sorry for that.
Your example as well as Charlie's from above perfectly illustrate simple cases for when my assumption from above breaks down. üëçüèª</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-04-19 01:11</div>
            <div class="timeline-body"><blockquote>
<p>Haha yeah. That matches my diagnosis above. Because of the heuristics (which are clearly off a bit), we're fully resolving <code>pytest-cov&gt;=4</code> before we even look at <code>uv_reproducer[test]</code>, which adds the extra constraint.</p>
</blockquote>
<p>As someone thinking about Python packaging resolution for awhile I reallly find the optionality of extras to be very very annoying, it makes writing all resolvers significantly more complex.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3133.html">astral-sh/uv#3133</a> on 2024-04-19 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-19 02:04</div>
            <div class="timeline-body"><p>Ok, I tested it out on your project, and https://github.com/astral-sh/uv/pull/3133 should fix it. I think there's a &quot;deeper&quot; fix I want to pursue here for some other pathological cases, but that should be good for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-19 02:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3135.html">astral-sh/uv#3135</a> on 2024-04-19 04:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/burgholzer">@burgholzer</a> on 2024-04-19 08:30</div>
            <div class="timeline-body"><p>Yeah. I can confirm that this fixes all the regressions we were seeing.
Thanks for the extremely fast fix. Keep up the good work üéâ
It's really cool to follow these developments!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3143.html">astral-sh/uv#3143</a> on 2024-04-19 17:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
