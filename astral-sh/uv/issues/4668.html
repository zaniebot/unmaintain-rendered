<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python version limited requirement in universal locking - astral-sh/uv #4668</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Python version limited requirement in universal locking</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4668">#4668</a>
        opened by <a href="https://github.com/davidfritzsche">@davidfritzsche</a>
        on 2024-06-30 21:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidfritzsche">@davidfritzsche</a></div>
            <div class="timeline-body"><p>With uv 0.2.18 the following fails</p>
<pre><code>$ echo &#x27;uv;python_version&gt;=&quot;3.8&quot;&#x27; | uv pip compile -p 3.7 --universal -
warning: uv is only compatible with Python 3.8+, found Python 3.7.17.
  × No solution found when resolving dependencies:
</code></pre>
<p>Which on one hand makes sense, as there really is no version of uv supporting Python 3.7. On the other hand, <code>uv==X; python_version&gt;=&quot;3.8&quot;</code> could be installed under Python 3.7 for any version X.</p>
<p>In non-universal locking, <code>uv;python_version&gt;=&quot;3.8&quot;</code> can be compiled for Python 3.7:</p>
<pre><code>$ echo &#x27;uv;python_version&gt;=&quot;3.8&quot;&#x27; | uv pip compile -p 3.7 -
warning: uv is only compatible with Python 3.8+, found Python 3.7.17.
Resolved 0 packages in 0.77ms
# This file was autogenerated by uv via the following command:
#    uv pip compile -p 3.7 -
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 21:36</div>
            <div class="timeline-body"><p>Oh thank you, I think this is the same as #4669 -- sorry, I missed that you created this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 21:36</div>
            <div class="timeline-body"><p>I&#x27;m going to merge into #4669. Good bug!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-30 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-01 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-01 20:00</div>
            <div class="timeline-body"><p>Re-opening because this case is a little different than the NumPy one and they&#x27;ll have separate PRs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-01 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/houbie">@houbie</a> on 2024-08-05 11:48</div>
            <div class="timeline-body"><p>I&#x27;m facing a related issue: using python 3.9, <code>uv pip install pdm</code> correctly installs pdm version 2.17.3, but <code>echo &#x27;pdm==2.17.3&#x27;| uv pip compile --universal -</code> fails:</p>
<pre><code>(px-uvdir) % echo &#x27;pdm==2.17.3&#x27;| uv pip compile --universal -
  × No solution found when resolving dependencies:
  ╰─▶ Because only the following versions of truststore{python_version &gt;= &#x27;3.10&#x27;} are available:
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.1.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.2.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.3.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.4.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.5.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.6.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.6.1
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.7.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.8.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.9.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}==0.9.1
      and the requested Python version (&gt;=3.9.17) does not satisfy Python&gt;=3.10, we can conclude that any of:
          truststore{python_version &gt;= &#x27;3.10&#x27;}&lt;0.9.0
          truststore{python_version &gt;= &#x27;3.10&#x27;}&gt;0.9.0
       are incompatible.
      And because truststore{python_version &gt;= &#x27;3.10&#x27;}==0.9.0 was yanked (reason: Doesn&#x27;t work for CPython 3.13, upgrade to 0.9.1), we can conclude that all versions of truststore{python_version &gt;= &#x27;3.10&#x27;} are incompatible.
      And because pdm==2.17.3 depends on truststore{python_version &gt;= &#x27;3.10&#x27;} and you require pdm==2.17.3, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>pdm has a dependency on truststore <code>Requires-Dist: truststore; python_version &gt;= &quot;3.10&quot;</code>
<code>uv pip compile</code> should retain this dependency with the python constraint instead of failing on it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 13:00</div>
            <div class="timeline-body"><p>@houbie -- Think that&#x27;s the same as <a href="https://github.com/astral-sh/uv/issues/4668">astral-sh/uv#4668</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-20 14:15</div>
            <div class="timeline-body"><p>On main there&#x27;s now a workaround for this:</p>
<pre><code>[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.7&quot;
dependencies = [&quot;uv ; python_version &gt;= &#x27;3.8&#x27;&quot;]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.uv]
environments = [&quot;python_version &lt; &#x27;3.8&#x27;&quot;, &quot;python_version &gt;= &#x27;3.8&#x27;&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> removed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-20 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanCardin">@DanCardin</a> on 2024-08-28 16:39</div>
            <div class="timeline-body"><p>I&#x27;m encountering something similar, where the environments workaround doesn&#x27;t appear to work. It works with <strong>only</strong> the <code>&quot;numpy &gt;= 2.0; python_version &gt;= &#x27;3.9&#x27;&quot;</code> dependency, but not with certain other dependencies in combination.</p>
<pre><code>[project]
name = &quot;foo&quot;
version = &quot;0.0.0&quot;
description = &quot;&quot;
requires-python = &quot;&gt;=3.8,&lt;4&quot;
dependencies = [
  &quot;pydantic&quot;,
  &quot;numpy &gt;= 2.0; python_version &gt;= &#x27;3.9&#x27;&quot;,
]

[tool.uv]
environments = [&quot;python_version &lt; &#x27;3.9&#x27;&quot;, &quot;python_version &gt;= &#x27;3.9&#x27;&quot;]
</code></pre>
<p>This ^ will attempt to install numpy (which then fails for me), which i think it shouldnt even be attempting.</p>
<p>I&#x27;m not sure what significance <code>pydantic</code> has here, it only depends on <code>pydantic-core</code>, <code>typing-extensions</code> and <code>annotated-types</code>. And explicitly stating those dependencies (locked to the locked versions) individually instead doesn&#x27;t fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-28 16:45</div>
            <div class="timeline-body"><p>Can you clarify what the issue is? It&#x27;s attempting to install NumPy on which Python versions? (I can <code>uv lock</code> that successfully.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanCardin">@DanCardin</a> on 2024-08-28 16:59</div>
            <div class="timeline-body"><p>oh right sorry! <code>uv sync -p 3.8</code> fails trying to install numpy (when it shouldn&#x27;t be), <code>uv sync -p 3.9</code> succeeds and does.</p>
<p>admittedly the failing part is because it&#x27;s trying to build the wheel and i dont have the requirements necessary, but the point is that it&#x27;s installing numpy when it shouldn&#x27;t anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkniewallner">@mkniewallner</a> on 2024-08-31 19:04</div>
            <div class="timeline-body"><blockquote>
<p>On main there&#x27;s now a workaround for this:</p>
<pre><code>[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.7&quot;
dependencies = [&quot;uv ; python_version &gt;= &#x27;3.8&#x27;&quot;]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.uv]
environments = [&quot;python_version &lt; &#x27;3.8&#x27;&quot;, &quot;python_version &gt;= &#x27;3.8&#x27;&quot;]
</code></pre>
</blockquote>
<p>It looks like the workaround suggested here does not work anymore on 0.4.1, with the changes made in <a href="https://github.com/astral-sh/uv/pull/6841">astral-sh/uv#6841</a>:</p>
<pre><code>$ uv lock
error: Environment markers `python_full_version &gt;= &#x27;3.8&#x27;` don&#x27;t overlap with Python requirement `&gt;=3.7`
</code></pre>
<p>Since the workaround was suggested a few weeks ago, is there maybe a better way to work around the issue now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-31 22:37</div>
            <div class="timeline-body"><p>If that&#x27;s not working, it looks like a bug. Let me take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-31 22:42</div>
            <div class="timeline-body"><p>Apologies @mkniewallner, really dumb bug: <a href="https://github.com/astral-sh/uv/pull/6902">astral-sh/uv#6902</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanCardin">@DanCardin</a> on 2024-10-09 13:53</div>
            <div class="timeline-body"><p>Fwiw, if anyone else runs into <a href="https://github.com/astral-sh/uv/issues/4668">astral-sh/uv#4668</a>#issuecomment-2315850477 (because it was blocking by ability to adopt uv), a newer release of uv (0.4.20), given the referenced pyproject.toml, produces</p>
<pre><code>  × No solution found when resolving dependencies for split (python_full_version &gt;= &#x27;3.9&#x27;):
  ╰─▶ Because the requested Python version (&gt;=3.8, &lt;4) does not satisfy Python&gt;=3.10 and the requested Python version (&gt;=3.8, &lt;4) does not satisfy
      Python&gt;=3.9,&lt;3.10, we can conclude that Python&gt;=3.9 is incompatible.
      And because only the following versions of numpy{python_full_version &gt;= &#x27;3.9&#x27;} are available:
          numpy{python_full_version &gt;= &#x27;3.9&#x27;}&lt;=2.0.2
          numpy{python_full_version &gt;= &#x27;3.9&#x27;}&gt;=2.1.0
      we can conclude that all of:
          numpy{python_full_version &gt;= &#x27;3.9&#x27;}&gt;=2.0.0,&lt;2.1.0
          numpy{python_full_version &gt;= &#x27;3.9&#x27;}&gt;2.1.0,&lt;2.1.1
          numpy{python_full_version &gt;= &#x27;3.9&#x27;}&gt;2.1.1,&lt;2.1.2
          numpy{python_full_version &gt;= &#x27;3.9&#x27;}&gt;2.1.2
       are incompatible.
      And because the requested Python version (&gt;=3.8, &lt;4) does not satisfy Python&gt;=3.10 and your project depends on numpy{python_full_version &gt;=
      &#x27;3.9&#x27;}&gt;=2.0, we can conclude that your project&#x27;s requirements are unsatisfiable.
</code></pre>
<p>I took that to imply that I need to match the upper bound with the upper bound of my project: <code>environments = [&quot;python_version &lt; &#x27;3.9&#x27;&quot;, &quot;python_version &gt;= &#x27;3.9&#x27; and python_version &lt; &#x27;4&#x27;&quot;]</code>, and <strong>that</strong> solved the issue, at least in the newer version of uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-28 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-28 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-28 13:48</div>
            <div class="timeline-body"><p>This should &quot;just work&quot; without any workarounds in the next version (see: <a href="https://github.com/astral-sh/uv/pull/8628">astral-sh/uv#8628</a>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/potiuk">@potiuk</a> on 2024-10-28 17:42</div>
            <div class="timeline-body"><blockquote>
<p>This should &quot;just work&quot; without any workarounds in the next version (see: #8628).</p>
</blockquote>
<p>Cool . We are getting way closer now with <code>uv</code> being the default tool for Airflow development.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:31:48 UTC
    </footer>
</body>
</html>
