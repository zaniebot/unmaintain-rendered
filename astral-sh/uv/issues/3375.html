<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use `uv` on Dockerfile - astral-sh/uv #3375</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use <code>uv</code> on Dockerfile</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/3375">#3375</a>
        opened by <a href="https://github.com/brunolnetto">@brunolnetto</a>
        on 2024-05-04 19:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/brunolnetto">@brunolnetto</a> on 2024-05-04 19:04</div>
            <div class="timeline-body"><p>Can we use <code>uv</code> on a Dockerfile? I tried using as follows, but got this error: <code>0.258 error: failed to canonicalize path /code/.venv/bin/python 258   Caused by: No such file or directory (os error 2)</code></p>
<pre><code>FROM python:3.11.3-slim-buster AS base

WORKDIR /code

# Set env variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=&quot;/code&quot;

# Create non-root user
RUN adduser --disabled-password appuser

# Install uv
RUN pip install uv

# Create virtual environment
RUN python3 -m venv /code/venv

# Activate virtual environment (assuming it's named 'venv')
RUN bash -c &quot;source /code/venv/bin/activate&quot;

# Copy application code and requirements (assuming requirements.txt is in the same directory)
COPY . .

# Install dependencies with uv
RUN pip install --upgrade pip
RUN uv pip install -r requirements.txt

# Switch to non-root user
USER appuser

# Run the application
CMD [&quot;bash&quot;, &quot;scripts/run.sh&quot;]

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-04 19:15</div>
            <div class="timeline-body"><p>I ran this myself and saw the error I expected:</p>
<pre><code>#14 0.134 error: Failed to locate a virtualenv or Conda environment (checked: `VIRTUAL_ENV`, `CONDA_PREFIX`, and `.venv`). Run `uv venv` to create a virtualenv.
</code></pre>
<p>The problem is that <code>RUN bash -c &quot;source /code/venv/bin/activate&quot;</code> doesn't affect any of the commands that run after it.</p>
<p>There are a lot of different options here to fix it.</p>
<p>First, you can use <code>.venv</code> as the environment name, and <code>uv</code> will discover it automatically:</p>
<pre><code>FROM python:3.11.3-slim-buster AS base

WORKDIR /code

# Set env variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=&quot;/code&quot;

# Create non-root user
RUN adduser --disabled-password appuser

# Install uv
RUN pip install uv

# Create virtual environment
RUN python -m venv /code/.venv

# Copy application code and requirements (assuming requirements.txt is in the same directory)
COPY . .

# Install dependencies with uv
RUN uv pip install -r requirements.txt
</code></pre>
<p>Alternatively, you can use <code>uv</code> to create the environment, to simplify things further:</p>
<pre><code>FROM python:3.11.3-slim-buster AS base

WORKDIR /code

# Set env variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=&quot;/code&quot;

# Create non-root user
RUN adduser --disabled-password appuser

# Install uv
RUN pip install uv

# Create virtual environment
RUN uv venv

# Copy application code and requirements (assuming requirements.txt is in the same directory)
COPY . .

# Install dependencies with uv
RUN uv pip install -r requirements.txt
</code></pre>
<p>Alternatively, you can tell <code>uv</code> to install into that specific virtualenv:</p>
<pre><code>FROM python:3.11.3-slim-buster AS base

WORKDIR /code

# Set env variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=&quot;/code&quot;

# Create non-root user
RUN adduser --disabled-password appuser

# Install uv
RUN pip install uv

# Create virtual environment
RUN python3 -m venv /code/venv

# Copy application code and requirements (assuming requirements.txt is in the same directory)
COPY . .

# Install dependencies with uv
RUN uv pip install -r requirements.txt --python /code/venv/bin/python
</code></pre>
<p>Alternatively, you can &quot;activate&quot; the <code>VIRTUAL_ENV</code> via environment variables:</p>
<pre><code>FROM python:3.11.3-slim-buster AS base

WORKDIR /code

# Set env variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=&quot;/code&quot;

# Create non-root user
RUN adduser --disabled-password appuser

# Install uv
RUN pip install uv

# Create virtual environment
RUN python3 -m venv /code/venv

# Copy application code and requirements (assuming requirements.txt is in the same directory)
COPY . .

ENV VIRTUAL_ENV /code/venv
ENV PATH /code/venv/bin:$PATH

# Install dependencies with uv
RUN uv pip install -r requirements.txt
</code></pre>
<p>Finally, you can use <code>--system</code> and skip the virtualenv entirely, since you're already containerized:</p>
<pre><code>FROM python:3.11.3-slim-buster AS base

WORKDIR /code

# Set env variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=&quot;/code&quot;

# Create non-root user
RUN adduser --disabled-password appuser

# Install uv
RUN pip install uv

# Copy application code and requirements (assuming requirements.txt is in the same directory)
COPY . .

# Install dependencies with uv
RUN uv pip install -r requirements.txt --system
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-04 19:15</div>
            <div class="timeline-body"><p>Personally, I would do this one:</p>
<pre><code class="language-docker">FROM python:3.11.3-slim-buster AS base

WORKDIR /code

# Set env variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PYTHONPATH=&quot;/code&quot;

# Create non-root user
RUN adduser --disabled-password appuser

# Install uv
RUN pip install uv

# Create virtual environment
RUN uv venv

# Copy application code and requirements (assuming requirements.txt is in the same directory)
COPY . .

# Install dependencies with uv
RUN uv pip install -r requirements.txt
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-05-04 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brunolnetto">@brunolnetto</a> on 2024-05-04 19:18</div>
            <div class="timeline-body"><p>I am flattered to have this issue answered by you. I will portrait this on my fridge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-04 21:05</div>
            <div class="timeline-body"><p>Happy to help :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-04 21:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brunolnetto">@brunolnetto</a> on 2024-05-07 01:38</div>
            <div class="timeline-body"><p>Another related question:  I found <a href="https://github.com/tiangolo/full-stack-fastapi-template/blob/master/backend/Dockerfile">this outstanding work</a> at fastapi repository. It uses poetry, a long-standing friend, and below commands. I would like to give some refreshing refactor and a pull request with <code>uv</code>. What do you suggest? :-)</p>
<pre><code>ARG INSTALL_DEV=false
RUN bash -c &quot;if [ $INSTALL_DEV == 'true' ] ; then poetry install --no-root ; else poetry install --no-root --only main ; fi&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blfpd">@blfpd</a> on 2025-09-23 16:08</div>
            <div class="timeline-body"><blockquote>
<p>Personally, I would do this one:</p>
<pre><code>FROM python:3.11.3-slim-buster AS base

WORKDIR /code
</code></pre>
</blockquote>
<p>Maybe you never encountered this issue, but I’d advise against using <code>/code</code> as a workdir for Python projects, as it is a valid Python module and might mess with your imports.<br />
See:<br />
https://docs.python.org/3/library/code.html<br />
https://github.com/python/cpython/blob/main/Lib/code.py</p>
<p>Popular options: <code>/app</code>, <code>/src</code>, <code>/srv</code>…</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:32 UTC
    </footer>
</body>
</html>
