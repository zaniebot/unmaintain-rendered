<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows: symbolic link to the `exe` created by uv can not work - astral-sh/uv #1766</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Windows: symbolic link to the `exe` created by uv can not work</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1766">#1766</a>
        opened by <a href="https://github.com/j178">@j178</a>
        on 2024-02-20 16:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/j178">@j178</a> on 2024-02-20 16:52</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<h2>Information</h2>
<pre><code>System: Windows 11 (x86_64)
Shell: PowerShell 7
uv version: uv 0.1.5
</code></pre>
<p>The original issue is from https://github.com/mitsuhiko/rye/issues/696.
Rye creates symbolic links to installed script under <code>~/.rye/shims</code>, but the script created by <code>uv</code> can not work. The default <code>pip-tools</code> created script works fine.</p>
<h2>Steps to reproduce</h2>
<pre><code class="language-sh">&gt; uv --version
uv 0.1.5

&gt; uv -v venv -p C:\Users\nigel\.rye\py\cpython@3.12.1\install\python.exe
 uv_interpreter::python_query::find_requested_python request=&quot;C:\\Users\\nigel\\.rye\\py\\cpython@3.12.1\\install\\python.exe&quot;, platform=Platform { os: Windows, arch: X86_64 }, cache=Cache { root: &quot;\\\\?\\C:\\Users\\nigel\\AppData\\Local\\uv\\cache&quot;, refresh: None, _temp_dir_drop: None }
      0.002273s   0ms DEBUG uv_interpreter::interpreter Using cached markers for: \\?\C:\Users\nigel\.rye\py\cpython@3.12.1\install\python.exe
Using Python 3.12.1 interpreter at C:\Users\nigel\.rye\py\cpython@3.12.1\install\python.exe
Creating virtualenv at: .venv

&gt; uv -v pip install pycowsay
 uv::requirements::from_source source=pycowsay
    0.002195s DEBUG uv_interpreter::virtual_env Found a virtualenv named .venv at: E:\tmp\test-uv\.venv
    0.002394s DEBUG uv_interpreter::interpreter Detecting markers for: \\?\E:\tmp\test-uv\.venv\Scripts\python.exe
    0.256957s DEBUG uv::commands::pip_install Using Python 3.12.1 environment at E:\tmp\test-uv\.venv\Scripts\python.exe
 uv_client::flat_index::from_entries
 uv_resolver::resolver::solve
      0.261629s   0ms DEBUG uv_resolver::resolver Solving with target Python version 3.12.1
   uv_resolver::resolver::choose_version package=root
   uv_resolver::resolver::get_dependencies package=root, version=0a0.dev0
        0.261995s   0ms DEBUG uv_resolver::resolver Adding direct dependency: pycowsay*
   uv_resolver::resolver::choose_version package=pycowsay
     uv_resolver::resolver::package_wait package_name=pycowsay
 uv_resolver::resolver::process_request request=Versions pycowsay
   uv_client::registry_client::simple_api package=pycowsay
     uv_client::cached_client::get_cacheable
       uv_client::cached_client::read_and_parse_cache file=\\?\C:\Users\nigel\AppData\Local\uv\cache\simple-v1\pypi\pycowsay.rkyv
 uv_resolver::resolver::process_request request=Prefetch pycowsay *
          0.262916s   0ms DEBUG uv_client::cached_client Found stale response for: https://pypi.org/simple/pycowsay/
          0.262970s   0ms DEBUG uv_client::cached_client Sending revalidation request for: https://pypi.org/simple/pycowsay/
       uv_client::cached_client::revalidation_request url=&quot;https://pypi.org/simple/pycowsay/&quot;
          0.761721s 499ms DEBUG uv_client::cached_client Found not-modified response for: https://pypi.org/simple/pycowsay/
       uv_client::cached_client::refresh_cache file=\\?\C:\Users\nigel\AppData\Local\uv\cache\simple-v1\pypi\pycowsay.rkyv
 uv_resolver::version_map::from_metadata
   uv_distribution::distribution_database::get_or_build_wheel_metadata dist=pycowsay==0.0.0.2
     uv_client::registry_client::wheel_metadata built_dist=pycowsay==0.0.0.2
       uv_client::cached_client::get_serde
         uv_client::cached_client::get_cacheable
           uv_client::cached_client::read_and_parse_cache file=\\?\C:\Users\nigel\AppData\Local\uv\cache\wheels-v0\pypi\pycowsay\pycowsay-0.0.0.2-py3-none-any.msgpack
        0.764071s 501ms DEBUG uv_resolver::resolver Searching for a compatible version of pycowsay (*)
        0.764190s 502ms DEBUG uv_resolver::resolver Selecting: pycowsay==0.0.0.2 (pycowsay-0.0.0.2-py3-none-any.whl)
   uv_resolver::resolver::get_dependencies package=pycowsay, version=0.0.0.2
     uv_resolver::resolver::distributions_wait package_id=pycowsay-0.0.0.2
              0.764488s   0ms DEBUG uv_client::cached_client Found fresh response for: https://files.pythonhosted.org/packages/eb/bd/17f894b13037499e615048a6daeb9cae28142ee85ce6eb8d24d10504860b/pycowsay-0.0.0.2-py3-none-any.whl
Resolved 1 package in 503ms
    0.765456s DEBUG uv_installer::plan Requirement already cached: pycowsay==0.0.0.2
 uv_installer::installer::install num_wheels=1
Installed 1 package in 9ms
 + pycowsay==0.0.0.2

# Create a symbolic link to pycowsay
&gt; New-Item -Path .\pycatsay.exe -ItemType SymbolicLink -Value .\.venv\Scripts\pycowsay.exe

    Directory: E:\tmp\test-uv

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
la---           2024/2/21     0:47              0 pycatsay.exe -&gt; .\.venv\Scripts\pycowsay.exe

&gt; .\pycatsay.exe
Error: The system cannot find the file specified.
 (from CreateProcessA(null(), child_cmdline.into_bytes_with_nul().as_mut_ptr(),
    null(), null(), 1, 0, null(), null(), addr_of!(*si),
    child_process_info.as_mut_ptr()))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/rye/issues/696.html">astral-sh/rye#696</a> on 2024-02-20 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-20 17:10</div>
            <div class="timeline-body"><p>Thanks for reporting. Hmm, that's going to be interesting. What I understand from the error is that our shim fails to locate the <code>pyton.exe</code> path because it searches it relative to the executed command. We may need to check if the file is a symlink before resolving the python exe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-02-20 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @MichaReiser on 2024-02-20 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-20 17:15</div>
            <div class="timeline-body"><p>On unix we use the absolute path as interpreter, maybe we can embed it in the binary too. Otherwise we need to find a solution that works with symlinks, junctions and hardlinks (as far as these work with exes at all).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/j178">@j178</a> on 2024-02-20 17:16</div>
            <div class="timeline-body"><blockquote>
<p>On unix we use the absolute path as interpreter, maybe we can embed it in the binary too.</p>
</blockquote>
<p>Yes, I agree this should be the best solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-20 17:21</div>
            <div class="timeline-body"><blockquote>
<p>On unix we use the absolute path as interpreter, maybe we can embed it in the binary too. Otherwise we need to find a solution that works with symlinks, junctions and hardlinks (as far as these work with exes at all).</p>
</blockquote>
<p>I considered searching for the shebang of the script and use that hehe. But it would require unzipping the script. I don't know if there's another way to embed it except if we manipulate the binary in place which sounds scary</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mitsuhiko">@mitsuhiko</a> on 2024-02-20 20:22</div>
            <div class="timeline-body"><p>It looks like <code>setuptools</code> own launcher executable &quot;parses&quot; the shebang.</p>
<p>https://github.com/pypa/setuptools/blob/569fd7b0b587409f4043f127a766131a25b366dd/launcher.c#L293-L298</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2024-02-21 11:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1803.html">astral-sh/uv#1803</a> on 2024-02-21 11:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-22 15:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:23 UTC
    </footer>
</body>
</html>
