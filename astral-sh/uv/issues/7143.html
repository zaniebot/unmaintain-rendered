<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove `{ workspace = true }` requirement for sources - astral-sh/uv #7143</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Remove `{ workspace = true }` requirement for sources</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/7143">#7143</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-09-06 22:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-06 22:17</div>
            <div class="timeline-body"><p>We error if a package is in the workspace but isn't marked as <code>{ workspace = true }</code>. Should we just infer this? As-is, you need to specify the members up to three times (once in members, once in dependencies, and once in sources).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-09-06 22:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-06 22:18</div>
            <div class="timeline-body"><p>I think this <em>probably</em> makes sense. The downside is, if this is omitted by default, then we lose the behavior that we error if you mark <code>workspace = true</code> but the package <em>isn't</em> found.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mmerickel">@mmerickel</a> on 2024-09-06 22:35</div>
            <div class="timeline-body"><p>I could be missing some nuance but I don't really see the logic in the current behavior. If I add the packages to the workspace then it'd be quite surprising to me for them to not be found/installed from the workspace when other packages depend on them. So to me it's only an improvement to add them to the list of sources by default to avoid having to duplicate them. It's even worse because the original workspace declaration is a glob for me hiding the details, and then I need to explicitly list the packages anyway.</p>
<pre><code class="language-toml">[project]
# this can technically contain a subset of the packages so it makes sense to declare them here as default dependencies of the workspace
dependencies = [&quot;my-foo&quot;, &quot;my-bar&quot;, &quot;...&quot;]

# it'd be nice to get rid of this
[tool.uv.sources]
my-foo = { workspace = true }
my-bar = {workspace = true }
# ...

[tool.uv.workspace]
members = [&quot;src/*&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mmerickel">@mmerickel</a> on 2024-09-06 22:48</div>
            <div class="timeline-body"><p>I should also point out that rye's workspaces don't have this extra sources requirement. In rye the packages are automatically workspace-packages when added to <code>tool.rye.workspace.members</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-06 23:08</div>
            <div class="timeline-body"><p>Just to be explicit: if a package is defined in the workspace but not declared as a source, we error rather than proceeding. So we're just being strict in asking users to specify the source explicitly. It might be more annoying than helpful though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-06 23:14</div>
            <div class="timeline-body"><p>I think I'm fine to remove this. If a user does it explicitly, we can then error if the package isn't found in the workspace but is marked as <code>{ workspace = true }</code>. I guess this is breaking, though... any applications that would be affected by it would <em>already</em> error today, so maybe not.</p>
<p>\cc @konstin @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-09-07 18:03</div>
            <div class="timeline-body"><p>This behavior was carried over from cargo, which intentionally requires <code>{ workspace = true }</code>.  In cargo, with <code>workspace = true</code> and <code>registry = &quot;...&quot;</code> you can always tell just from <code>Cargo.toml</code> where a dependency comes from, you have to explicitly annotate if you want a dependency that's not from the default registry.</p>
<p>I don't expect this change to be breaking, iirc <code>workspace = true</code> is a read-only check that doesn't actually change dependency lowering, you'd just have to remote this check:</p>
<p>https://github.com/astral-sh/uv/blob/56cc0c9b3cac860b072d2b22556d441d602a0eb0/crates/uv-distribution/src/metadata/lowering.rs#L47-L63</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 18:09</div>
            <div class="timeline-body"><p>@konstin -- Any opinion on changing it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-09-07 19:23</div>
            <div class="timeline-body"><p>I like the explicitness in cargo but I see the awkwardness when applied in a split-table dependencies vs. sources scenario.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tremeschin">@Tremeschin</a> on 2024-10-23 15:35</div>
            <div class="timeline-body"><p>Having implicit <code>workspace=true</code> in sources allows for having private packages/insiders repositories part of the venv glob listed in <code>members</code>. I've already migrated to <code>uv</code> and failed to notice this beforehand, not breaking for me but not ideal.</p>
<p>Somewhat related, but I find it weird having to re-define the workspace packages in <code>dev-dependencies</code> (without a version) for any <code>[project.scripts]</code> defined in member projects to create their entry points in the <code>venv</code> bin directory.</p>
<p>Maybe I'm doing something wrong, most documentation points to <code>uv run {cmd}</code> which I'd only recommend to beginners as it downloads python, creates venv and all, and personally prefer just typing <code>{cmd}</code> to run stuff;</p>
<p>point is, listing a package in a rye workspace implies all of that, I had to lurk to get it working ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Remove `{ workspace = true}` requirement for sources" to "Remove `{ workspace = true }` requirement for sources" by @charliermarsh on 2024-10-30 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../open-telemetry/opentelemetry-python-contrib/pulls/3124.html">open-telemetry/opentelemetry-python-contrib#3124</a> on 2025-01-10 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../open-telemetry/opentelemetry-python-contrib/issues/3189.html">open-telemetry/opentelemetry-python-contrib#3189</a> on 2025-01-15 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12107.html">astral-sh/uv#12107</a> on 2025-03-11 00:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tsudol-plaid">@tsudol-plaid</a> on 2025-12-20 01:31</div>
            <div class="timeline-body"><p>An additional point: this would be nice to have because the <a href="https://docs.astral.sh/uv/concepts/projects/workspaces/">workspace docs</a> recommend using a glob for workspace members. What's the point of accepting a glob for <code>tool.uv.workspace.members</code> when you have to go define <code>tool.uv.sources</code> for each one anyway?</p>
<pre><code class="language-toml">[tool.uv.sources]
bird-feeder = { workspace = true }

[tool.uv.workspace]
members = [&quot;packages/*&quot;]
exclude = [&quot;packages/seeds&quot;]
</code></pre>
<p>But I'll admit that cargo requiring this is a strong argument in its favor.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:22 UTC
    </footer>
</body>
</html>
