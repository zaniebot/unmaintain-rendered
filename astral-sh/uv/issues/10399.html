<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How should I handle cross compatibility with the torch dependency? - astral-sh/uv #10399</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>How should I handle cross compatibility with the torch dependency?</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/10399">#10399</a>
        opened by <a href="https://github.com/MattTheCuber">@MattTheCuber</a>
        on 2025-01-08 16:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MattTheCuber">@MattTheCuber</a> on 2025-01-08 16:30</div>
            <div class="timeline-body"><p>Note, this seems to be an question with all Python dependency tools. However, I wasn't able to find any documentation on the problem online.</p>
<p>I use the uv pip method with <code>requirements.txt</code>. When I add <code>torch</code> to my <code>pyproject.toml</code> -&gt; <code>project.dependencies</code>, then run <code>uv pip compile</code>, it creates a <code>requirements.txt</code> with a bunch of Linux-specific dependencies for nvidia packages such as <code>nvidia-cublas-cu12</code> and <code>nvidia-nccl-cu12</code>. This works and makes sense for Linux. However, if you are building a cross-platform compatible tool, this does not work on Windows. When running <code>uv pip install torch</code> on Windows, those nvidia dependencies are not installed. This makes <code>uv pip sync</code> fail on Windows.</p>
<p>The only solutions I came up with are to remove the dependencies from the requirements file manually or use <code>--no-emit-package</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MattTheCuber">@MattTheCuber</a> on 2025-01-08 16:45</div>
            <div class="timeline-body"><p>This is what I mean for the <code>--no-emit-package</code>.</p>
<pre><code class="language-toml">[tool.uv.pip]
no-emit-package = [
    &quot;nvidia-cublas-cu12&quot;,
    &quot;nvidia-cuda-cupti-cu12&quot;,
    &quot;nvidia-cuda-nvrtc-cu12&quot;,
    &quot;nvidia-cuda-runtime-cu12&quot;,
    &quot;nvidia-cudnn-cu12&quot;,
    &quot;nvidia-cufft-cu12&quot;,
    &quot;nvidia-curand-cu12&quot;,
    &quot;nvidia-cusolver-cu12&quot;,
    &quot;nvidia-cusparse-cu12&quot;,
    &quot;nvidia-nccl-cu12&quot;,
    &quot;nvidia-nvjitlink-cu12&quot;,
    &quot;nvidia-nvtx-cu12&quot;,
]
</code></pre>
<p>It works, but I feel like their is a better way of handling this that I don't know about.</p>
<p>EDIT:
This does not work when re-running <code>pip sync</code> on Linux because those packages are required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MattTheCuber">@MattTheCuber</a> on 2025-01-08 17:26</div>
            <div class="timeline-body"><p>I think this may work?</p>
<pre><code class="language-toml">[project]
...
dependencies = [
    &quot;nvidia-cublas-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-cuda-cupti-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-cuda-nvrtc-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-cuda-runtime-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-cudnn-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-cufft-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-curand-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-cusolver-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-cusparse-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-nccl-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-nvjitlink-cu12; sys_platform=='linux'&quot;,
    &quot;nvidia-nvtx-cu12; sys_platform=='linux'&quot;,
]
</code></pre>
<p>Maybe as a constraint?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../aslafy-z/yolo-object-detection-cli/pulls/42.html">aslafy-z/yolo-object-detection-cli#42</a> on 2025-01-22 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AKuederle">@AKuederle</a> on 2025-01-23 11:59</div>
            <div class="timeline-body"><p>This is because the torch packages differ based on the system you install it on. Have a look at the installation matrix on the official torch website (https://pytorch.org). The version of torch that you get on linux when using pypi as index is a version with GPU suppor tbuild against CUDA 12.4. However, the official Pypi version refers to the CPU only version when installed on Windows or MacOS.</p>
<p>To use a GPU enabled version of torch on windows (or a version build against a different cuda version), requires to install the packages from the official pytorch index instead of Pypi.</p>
<p>The uv guide on pytorch suggests some solutions for this: https://docs.astral.sh/uv/guides/integration/pytorch/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MattTheCuber">@MattTheCuber</a> on 2025-01-24 16:12</div>
            <div class="timeline-body"><p>This is great, thank you! I don't know why I didn't find that guide.</p>
<p>How does this work for <code>uv pip compile</code>? Do I need to compile requirements from each environment (with CUDA for Linux, with CPU for Windows, and a special one for CI using CPU)?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:25 UTC
    </footer>
</body>
</html>
