<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install --target` inconsistencies - astral-sh/uv #6198</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip install --target</code> inconsistencies</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6198">#6198</a>
        opened by <a href="https://github.com/schlamar">@schlamar</a>
        on 2024-08-19 07:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/schlamar">@schlamar</a></div>
            <div class="timeline-body"><p>I use <code>pip install --target</code> to build compatible package directories for different platforms to distribute applications. For example</p>
<p><code>pip install --platform=win_amd64 --target packages-win64 --only-binary=:all: --python-version 310 &quot;sqlalchemy&gt;=2,&lt;3&quot;</code>
<code>pip install --platform=win32--target packages-win32 --only-binary=:all: --python-version 310 &quot;sqlalchemy&gt;=2,&lt;3&quot;</code></p>
<p>There are inconsistencies using <code>uv pip install</code> compared to <code>pip</code>.</p>
<p><strong>1) It requires an active virtual environment</strong></p>
<pre><code>&gt; .\venv\Scripts\uv.exe pip install --target temp --only-binary=:all: --python-version 3.12 --python-platform windows sqlalchemy
error: No virtual environment found
</code></pre>
<p>When using <code>--target</code> an active virtual environment doesn't make sense for me.</p>
<p><strong>2) You cannot install binary packages with different architecture on Windows</strong></p>
<p>With pip I can install 32bit packages running a 64bit Python and vice versa. With <code>uv</code> I couldn't find a way to explicitly select 32bit packages.</p>
<p>Running <code>uv install</code> with a 64bit Python I couldn't find a way to install 32bit packages (I guess that's a missing feature).</p>
<p>Running <code>uv install</code> with a 32bit Python and without <code>python-platform</code> installs 32bit packages. Running <code>uv install</code> with a 32bit Python and <code>--python-platform windows</code> installs 64bit packages. I would consider the latter behavior as a bug - that's really unexpected.</p>
<p><strong>3) Parameter <code>--implementation</code> missing in uv</strong></p>
<p>With <code>pip</code> you can use <code>--implementation py</code> to only select packages which don't have platform dependent binary content. I couldn't find a way to reproduce this behavior with <code>uv</code>. See https://packaging.python.org/en/latest/specifications/platform-compatibility-tags/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-19 14:00</div>
            <div class="timeline-body"><blockquote>
<p>When using --target an active virtual environment doesn't make sense for me.</p>
</blockquote>
<p>You can pass <code>--system</code> to avoid requiring a virtual environment.</p>
<blockquote>
<p>Running uv install with a 32bit Python and without python-platform installs 32bit packages. Running uv install with a 32bit Python and --python-platform windows installs 64bit packages. I would consider the latter behavior as a bug - that's really unexpected.</p>
</blockquote>
<p>We don't have a target triple for 32-bit Windows. We could add one. But the current behavior is intentional. If you pass <code>--python-platform</code>, we entirely ignore the Python platform of your current interpreter. And the docs mention that <code>windows</code> is an alias for <code>x86_64-pc-windows-msvc</code>. If we start mixing the current interpreter with the <code>--python-platform</code>, you lose all of the guarantees that <code>--python-platform</code> provides (i.e., that it's independent of the current platform).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-08-19 14:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlamar">@schlamar</a> on 2024-08-19 16:14</div>
            <div class="timeline-body"><p>Thanks for your quick reply! First of all, I didn't know about the docs at all. They are quite hard to find at https://docs.astral.sh/uv. Maybe you could improve visiblity a little bit more. :-)</p>
<p><strong>1)</strong></p>
<p>I have thought about this point and changed my expectation.</p>
<p>A common use case is to use pip from an virtual environment without having the virtual environment activated. One scenario would be in a CI pipeline. For example</p>
<pre><code>py -m venv venv
venv\Scripts\pip install ruff
venv\Scripts\ruff check src tests
</code></pre>
<p>This example with uv fails with <code>error: No virtual environment found</code></p>
<pre><code>py -m venv venv
venv\Scripts\pip install uv
venv\Scripts\uv pip install ruff
venv\Scripts\ruff check src tests
</code></pre>
<p>So my expectation here is actually that ruff should detect automatically if it is installed in a virtual envrionment and use that.</p>
<p>I just found out that <code>py -m venv .venv</code> would actually work but I don't like such an implicit behavior (the Zen of Python says &quot;Explicit is better than implicit.&quot;). You could argue that automatic detection is kind of an implicit behavior, too. But I think that invoking an executable from a path in a virtual environment is an explicit action to justify this behavior.</p>
<p><strong>2)</strong></p>
<p>The point that <code>windows</code> is an alias for <code>x86_64-pc-windows-msvc</code> makes the current behavior pretty consistent.</p>
<p>It would be really great if you could add a triple to target win32 Python packages.</p>
<p>Generally, I wonder why win32 isn't an officially supported platform as it is in <a href="https://peps.python.org/pep-0011/#tier-1">Python</a> <strong>and</strong> <a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html#tier-1-with-host-tools">Rust</a> tier 1 list?</p>
<p><strong>3)</strong></p>
<p>I have edited the issue to add another point, so maybe you missed it completely?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-19 16:20</div>
            <div class="timeline-body"><p>See https://github.com/astral-sh/uv/issues/5973 regarding the documentation — it's not announced/public yet but will be soon.</p>
<blockquote>
<p>So my expectation here is actually that ruff should detect automatically if it is installed in a virtual envrionment and use that.</p>
</blockquote>
<p>If you want uv to do this, use <code>venv\Scripts\python -m uv</code> — it'll detect and use the parent interpreter's environment then.</p>
<blockquote>
<p>A common use case is to use pip from an virtual environment without having the virtual environment activated</p>
</blockquote>
<p>If you don't want to activate the environment, but want uv to detect it, set <code>VIRTUAL_ENV</code> to the path.</p>
<blockquote>
<p>With pip you can use --implementation py to only select packages which don't have platform dependent binary content.</p>
</blockquote>
<p>I'd presume we could add this without too much difficulty, but I'd prefer we discuss support for it it in a dedicated issue instead of lumping everything together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlamar">@schlamar</a> on 2024-08-19 16:48</div>
            <div class="timeline-body"><p>Sorry, I totally agree. This has gone wild. I will split this in separate issues tommorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlamar">@schlamar</a> on 2024-08-20 06:51</div>
            <div class="timeline-body"><blockquote>
<p>If you want uv to do this, use venv\Scripts\python -m uv — it'll detect and use the parent interpreter's environment then.</p>
</blockquote>
<p>Didn't expect this to behave differently than executing <code>venv\Scripts\uv</code>. But in this case I guess this is fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/schlamar">@schlamar</a> on 2024-08-20 07:00</div>
            <div class="timeline-body"><p>I made #6245 for 2) and #6246 for 3)</p>
<p>I consider 1) as resolved by the statement above.</p>
<p>Sorry again for mixing different points in one issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @schlamar on 2024-08-20 07:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:11 UTC
    </footer>
</body>
</html>
