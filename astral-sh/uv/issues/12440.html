<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`setuptools` fails with &quot;Invalid dash-separated key&quot; or &quot;Invalid uppercase key&quot; - astral-sh/uv #12440</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`setuptools` fails with &quot;Invalid dash-separated key&quot; or &quot;Invalid uppercase key&quot;</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/12440">#12440</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2025-03-24 16:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-24 16:48</div>
            <div class="timeline-body"><p><code>setuptools</code> <a href="https://setuptools.pypa.io/en/stable/history.html#v78-0-0">v78</a> no longer accepts options containing uppercase or dash characters in <code>setup.cfg</code>. This means if your package uses this feature, or if any of your dependencies need to be built from source (and are using the invalid syntax) then an error will be raised.</p>
<p>This can be worked around in the uv CLI by excluding new versions:</p>
<pre><code>$ uv sync --exclude-newer 2025-03-24
</code></pre>
<p>This fix can be persisted in the <code>pyproject.toml</code> as:</p>
<pre><code class="language-toml">[tool.uv]
exclude-newer = &quot;2025-03-24T00:00:00Z&quot;
</code></pre>
<p>Note this will prevent upgrading other packages.</p>
<p>If you are using <code>uv pip</code>, you can set a build constraint instead:</p>
<pre><code>echo &quot;setuptools&lt;78&quot; | uv pip install -b - &lt;package&gt;
</code></pre>
<p>This fix can be persisted in the <code>pyproject.toml</code> as:</p>
<pre><code class="language-toml">[tool.uv]
build-constraint-dependencies = [&quot;setuptools&lt;78&quot;]
</code></pre>
<p>There is an unrelated uv bug that does not propagate <code>build-constraint-dependencies</code> in <code>uv sync</code> (https://github.com/astral-sh/uv/issues/12441). We will be releasing a fix for that soon.</p>
<p>I've asked for the change to be reverted upstream at https://github.com/pypa/setuptools/pull/4870#issuecomment-2748731521</p>
<p>We're also adding a dedicated warning for this error case in https://github.com/astral-sh/uv/pull/12438</p>
<p>See also</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/12434</li>
<li>#12437</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12434.html">astral-sh/uv#12434</a> on 2025-03-24 16:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypa/setuptools/pulls/4870.html">pypa/setuptools#4870</a> on 2025-03-24 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12441.html">astral-sh/uv#12441</a> on 2025-03-24 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @zanieb on 2025-03-24 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/systemsoverload">@systemsoverload</a> on 2025-03-24 17:04</div>
            <div class="timeline-body"><p>Is there a reasonable alternative to <code>uv sync</code> that will allow for installing <code>[dependency-groups]</code> ? Looks like <code>uv venv &amp;&amp; uv pip install .</code> is a rough approximation to unblock the base deps but I cant figure out how to get the dev groups installed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-24 17:06</div>
            <div class="timeline-body"><p><code>uv pip install --group &lt;name&gt;</code> should work for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/systemsoverload">@systemsoverload</a> on 2025-03-24 17:08</div>
            <div class="timeline-body"><pre><code>âœ— uv pip install --group dev
error: unexpected argument '--group' found

  tip: to pass '--group' as a value, use '-- --group'

Usage: uv pip install [OPTIONS] &lt;PACKAGE|--requirements &lt;REQUIREMENTS&gt;|--editable &lt;EDITABLE&gt;&gt;

For more information, try '--help'.
</code></pre>
<p>Unfortunately it seems <code>uv pip</code> is unaware of groups?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/toby-j">@toby-j</a> on 2025-03-24 17:11</div>
            <div class="timeline-body"><pre><code>[tool.uv]
exclude-newer = &quot;2025-03-24T00:00:00Z&quot;
</code></pre>
<p>Worked for me although no joy with <code>build-constraint-dependencies</code>.</p>
<p>Thanks for the support @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12442.html">astral-sh/uv#12442</a> on 2025-03-24 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/systemsoverload">@systemsoverload</a> on 2025-03-24 17:15</div>
            <div class="timeline-body"><p>Unfortunately <code>exclude-newer</code> will refuse to install packages that have no upload date specified, which of course, happens to include popular public packages ðŸ¤¦</p>
<pre><code>warning: pytest_django-4.10.0.tar.gz is missing an upload date, but user provided: 2025-03-24T20:00:00Z
warning: responses-0.17.0.tar.gz is missing an upload date, but user provided: 2025-03-24T20:00:00Z
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../MeltanoLabs/tap-gitlab/pulls/110.html">MeltanoLabs/tap-gitlab#110</a> on 2025-03-24 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rayanramoul">@rayanramoul</a> on 2025-03-24 17:16</div>
            <div class="timeline-body"><blockquote>
<p>Unfortunately <code>exclude-newer</code> will refuse to install packages that have no upload date specified, which of course, happens to include popular public packages ðŸ¤¦</p>
<pre><code>warning: pytest_django-4.10.0.tar.gz is missing an upload date, but user provided: 2025-03-24T20:00:00Z
warning: responses-0.17.0.tar.gz is missing an upload date, but user provided: 2025-03-24T20:00:00Z
</code></pre>
</blockquote>
<p>Yes, getting the same one for torch==2.3.0</p>
<pre><code>warning: torch-2.3.0+cu118-cp310-cp310-linux_x86_64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp310-cp310-win_amd64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp311-cp311-linux_x86_64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp311-cp311-win_amd64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp312-cp312-linux_x86_64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp312-cp312-win_amd64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp38-cp38-linux_x86_64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp38-cp38-win_amd64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp39-cp39-linux_x86_64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
warning: torch-2.3.0+cu118-cp39-cp39-win_amd64.whl is missing an upload date, but user provided: 2025-03-24T00:00:00Z
  x No solution found when resolving dependencies:
  `-&gt; Because there is no version of torch==2.3.0 ....
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-03-24 17:19</div>
            <div class="timeline-body"><blockquote>
<p>Unfortunately <code>exclude-newer</code> will refuse to install packages that have no upload date specified, which of course, happens to include popular public packages ðŸ¤¦</p>
</blockquote>
<p>Are you getting those of PyPI or some other index? In general PyPI should have the upload date of every package and if not we should report a bug to them.</p>
<p>However it is known that torch, and many other indexes, don't yet support upload date.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/systemsoverload">@systemsoverload</a> on 2025-03-24 17:22</div>
            <div class="timeline-body"><p>Good point. We are using Artifactory as an internal mirror, and given that they only implemented the <code>/simple</code> API, Im guessing upload date is going to be missing for every package we've cached there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/systemsoverload">@systemsoverload</a> on 2025-03-24 17:26</div>
            <div class="timeline-body"><p>As noted in  #12441, this is a reasonable approximation that will follow <code>build-constraint-dependencies</code> and <code>dependency-groups</code>. Just creating an alias <code>uv-sync</code> for now that does this:</p>
<pre><code>uv export --all-groups &gt; requirements.txt
uv venv
uv pip install -r requirements.txt
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypa/setuptools/issues/4910.html">pypa/setuptools#4910</a> on 2025-03-24 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-24 18:56</div>
            <div class="timeline-body"><p><code>uv pip --group</code> shipped in v0.6.7: https://github.com/astral-sh/uv/releases/tag/0.6.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anrooo">@anrooo</a> on 2025-03-24 19:03</div>
            <div class="timeline-body"><p>Also hitting the limitation with <code>exclude-newer</code>. It would be great to have a flag to ignore this constraint for packages that don't publish version data.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12446.html">astral-sh/uv#12446</a> on 2025-03-24 19:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../aws/s2n-tls/pulls/5215.html">aws/s2n-tls#5215</a> on 2025-03-24 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../aws/s2n-tls/issues/5216.html">aws/s2n-tls#5216</a> on 2025-03-24 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12448.html">astral-sh/uv#12448</a> on 2025-03-24 19:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2025-03-24 20:09</div>
            <div class="timeline-body"><p>Hi everyone, 20 minutes ago setuptools added a new package that postpones this change:</p>
<p>https://setuptools.pypa.io/en/stable/history.html</p>
<p>Anyway, it would be better if uv used the same setuptools in the env when installed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-03-24 20:14</div>
            <div class="timeline-body"><blockquote>
<p>Anyway, it would be better if uv used the same setuptools in the env when installed</p>
</blockquote>
<p>It has been a Python packaging standard to seperate out build dependencies from runtime dependencies for years now, generally it has solved a lot more problems than it has created, all modern packaging tools I am aware of support it.</p>
<p>It was defined in https://peps.python.org/pep-0517/ and discussion about problems it has and solutions to those problems should be discussed over at https://discuss.python.org/c/packaging/14</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-24 20:14</div>
            <div class="timeline-body"><p>@inoa-jboliveira we won't use the same setuptools as installed in the environment as that breaks PEP 517 build isolation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-24 20:14</div>
            <div class="timeline-body"><p>See https://github.com/pypa/setuptools/pull/4911 for the setuptools revert.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../skodaconnect/myskoda/pulls/394.html">skodaconnect/myskoda#394</a> on 2025-03-24 20:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-03-25 01:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
