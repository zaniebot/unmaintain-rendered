<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv build with msvc, the console output is abnormal - astral-sh/uv #10073</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv build with msvc, the console output is abnormal</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/10073">#10073</a>
        opened by <a href="https://github.com/fanck0605">@fanck0605</a>
        on 2024-12-21 07:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fanck0605">@fanck0605</a></div>
            <div class="timeline-body"><h2>Environment</h2>
<p>Platform: Windows 10 (<strong>Chinese Language</strong>)
Console charsets: <strong>GBK</strong>
UV: 0.5.11</p>
<h2>Details</h2>
<p>I tried to build a <code>.pyd</code> file using scikit-build-core on Windows (msvc backend), when i use <code>uv build</code>, the output of msvc cannot print abnormal in prowershell console (like this <code>����ɴ��������</code>), while i directly using <code>python -m build</code> will not.</p>
<p>This may be caused by <code>uv build</code> not handling non-UTF-8 charsets well. Can anyone fix it?</p>
<h2>Console output</h2>
<pre><code>-- Build files have been written to: C:/Users/User/AppData/Local/Temp/tmpz_8ybcie/build
*** Building project with Visual Studio 16 2019...
���� .NET Framework �� Microsoft (R) ��������汾 16.11.2+f32259642
��Ȩ����(C) Microsoft Corporation����������Ȩ����

C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Microsoft\VC\v160\Microsoft.CppBuild.targets(517,5): warning MSB8029: �м�Ŀ¼�����Ŀ¼�޷�פ������ʱĿ¼�£���Ϊ����ܻᵼ���������ɳ������⡣ [C:\Users\User\AppData\Local\Temp\tmpz_8ybcie\build\ZERO_CHECK.vcxproj]
  1&gt;Checking Build System
C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Microsoft\VC\v160\Microsoft.CppBuild.targets(517,5): warning MSB8029: �м�Ŀ¼�����Ŀ¼�޷�פ������ʱĿ¼�£���Ϊ����ܻᵼ���������ɳ������⡣ [C:\Users\User\AppData\Local\Temp\tmpz_8ybcie\build\_core.vcxproj]
  Building Custom Rule D:/.uv/cache/sdists-v6/.tmpJfNZWj/scikit_build_example-0.0.1/CMakeLists.txt
  main.cpp
    ���ڴ����� C:/Users/User/AppData/Local/Temp/tmpz_8ybcie/build/Release/_core.lib �Ͷ��� C:/Users/User/AppData/Local/Temp/tmpz_8ybcie/build/Release/_core.exp
  _core.vcxproj -&gt; C:\Users\User\AppData\Local\Temp\tmpz_8ybcie\build\Release\_core.cp312-win_amd64.pyd
</code></pre>
<h2>Reproduce</h2>
<ol>
<li><p>Install  <a href="https://visualstudio.microsoft.com/zh-hans/downloads/?q=build+tools">Visual Stutio Build Tools</a></p>
</li>
<li><p>Run <code>uv build</code></p>
</li>
</ol>
<pre><code>git clone https://github.com/pybind/scikit_build_example.git
cd scikit_build_example
uv build
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anqorithm">@anqorithm</a> on 2024-12-21 09:09</div>
            <div class="timeline-body"><p>It works fine when using the uv command on WSL (Ubuntu on Windows) with the same environment. It seems that the issue is related to character encoding handling on Windows 10 with the GBK charset, which is causing problems with non-UTF-8 characters in the output.</p>
<p>Running the uv build command under WSL avoids this issue, as it uses a different console environment that handles the character encoding more effectively.</p>
<p>Let me know if you'd like further assistance!</p>
<p><img src="https://github.com/user-attachments/assets/de73b68b-f676-4c0e-bf51-2aafc332f701" alt="Image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-12-21 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @charliermarsh on 2024-12-21 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-21 23:52</div>
            <div class="timeline-body"><p>Seems like a bug, thanks.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:00 UTC
    </footer>
</body>
</html>
