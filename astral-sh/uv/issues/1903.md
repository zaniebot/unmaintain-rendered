```yaml
number: 1903
title: Duplicate git dependencies that resolve to the same commit are treated as conflicting
type: issue
state: closed
author: rossmacarthur
labels:
  - needs-decision
assignees: []
created_at: 2024-02-23T07:13:24Z
updated_at: 2024-03-07T23:47:32Z
url: https://github.com/astral-sh/uv/issues/1903
synced_at: 2026-01-10T01:57:04Z
```

# Duplicate git dependencies that resolve to the same commit are treated as conflicting

---

_Issue opened by @rossmacarthur on 2024-02-23 07:13_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

If you have two git dependencies that resolve to the same commit, they could be treated as the same.
```
uv 0.1.9
```

```
# requirements.in
werkzeug @ git+https://github.com/pallets/werkzeug.git@2.0.0
werkzeug @ git+https://github.com/pallets/werkzeug@af160e0b6b7ddd81c22f1652c728ff5ac72d5c74
```

When running `uv pip compile requirements.in`
```
error: Requirements contain conflicting URLs for package `werkzeug`:
- git+https://github.com/pallets/werkzeug.git@2.0.0
- git+https://github.com/pallets/werkzeug@af160e0b6b7ddd81c22f1652c728ff5ac72d5c74
```

However, if you just have 
```
# requirements.in
werkzeug @ git+https://github.com/pallets/werkzeug.git@2.0.0
```

It resolves to that url when running `uv pip compile requirements.in`

```
# requirements.txt
werkzeug @ git+https://github.com/pallets/werkzeug@af160e0b6b7ddd81c22f1652c728ff5ac72d5c74
```



---

_Comment by @rossmacarthur on 2024-02-23 07:16_

To clarify the reason I encounter is this:
- I have a git dependency in my `pyproject.toml`
- I generate `requirements.txt` from `pyproject.toml`
- Then I generate `requirements.dev.txt` using `requirements.txt` _and_ `pyproject.toml`  + extra dev as the input.

So if don't put the commit hash as the ref in `pyproject.toml` I get this error.


---

_Label `needs-decision` added by @charliermarsh on 2024-02-23 15:18_

---

_Comment by @charliermarsh on 2024-02-23 15:19_

Can I ask why `requirements.txt` needs to be an input to the second resolution?

---

_Comment by @zanieb on 2024-02-23 15:24_

It seems best if we can avoid allowing this, just to keep things tractable. I'm also curious why not just compile from the `pyproject.toml` directly the second time?

---

_Comment by @charliermarsh on 2024-02-23 15:25_

Alternatively you can use your `requirements.txt` as an `--overrides requirements.txt`.

---

_Comment by @rossmacarthur on 2024-02-26 11:24_

> Can I ask why requirements.txt needs to be an input to the second resolution?

Maybe the following can help explain what error I want to catch:

Consider the following input

```toml
# pyproject.toml

[project]
name = "example"
version = "0.0.0"
dependencies = [
    "pydantic",
]

[project.optional-dependencies]
dev = [
    "pydantic < 2.6.0",
]
```


- **simple case**
   ```
   uv pip compile pyproject.toml -o requirements.txt
   uv pip compile --extra dev pyproject.toml -o requirements.dev.txt
   ```
   Problem: prod and dev now have different versions of pydantic
   
- **using override**
   ```
   uv pip compile pyproject.toml -o requirements.txt
   uv pip compile --extra dev pyproject.toml --override requirements.txt -o requirements.dev.txt
   ```
   Problem: dev dependency might be broken
   
- **using requirements.txt** as input
   ```
   uv pip compile pyproject.toml -o requirements.txt
   uv pip compile --extra dev pyproject.toml requirements.txt -o requirements.dev.txt
   ```
   Appropriately errors that the dependencies are unresolvable

   






---

_Referenced in [astral-sh/uv#2285](../../astral-sh/uv/pulls/2285.md) on 2024-03-07 19:19_

---

_Closed by @charliermarsh on 2024-03-07 23:47_

---

_Referenced in [astral-sh/uv#2614](../../astral-sh/uv/issues/2614.md) on 2024-03-22 14:22_

---
