<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUG: resolution failure in `uv pip` where `python -m pip` suceeds - astral-sh/uv #5143</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>BUG: resolution failure in `uv pip` where `python -m pip` suceeds</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/5143">#5143</a>
        opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a>
        on 2024-07-17 10:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2024-07-17 10:19</div>
            <div class="timeline-body"><p>Right now, trying to install <code>matplotlib</code> nightlies as follows</p>
<pre><code class="language-shell">uv venv -p 3.12
source .venv/bin/activate
uv pip install matplotlib --only-binary &quot;:all:&quot; --pre --extra-index-url https://pypi.anaconda.org/scientific-python-nightly-wheels/simple
</code></pre>
<p>fails with</p>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because pillow==11.0.0.dev0 has no wheels are available with a matching Python ABI and only the following versions of pillow are available:
          pillow&lt;8
          pillow==11.0.0.dev0
      we can conclude that all versions of pillow cannot be used.
      And because all versions of matplotlib depend on pillow, we can conclude that all versions of matplotlib cannot be used.
      And because only the following versions of matplotlib are available:
          matplotlib==3.10.0.dev370+g6b7b999274
          matplotlib==3.10.0.dev378+g830361d544
          matplotlib==3.10.0.dev384+g8b33378746
          matplotlib==3.10.0.dev395+gdc649460f7
          matplotlib==3.10.0.dev401+g9b8a8c7246
      and you require matplotlib, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>(this is uv 0.2.25, but I've seen this with 0.2.18 too)
<a href="https://github.com/yt-project/cmyt/actions/runs/9967437982/job/27541120876">example logs</a></p>
<p><code>pillow==11.0.0.dev0</code> is actually not a constraint I'm imposing, it's just the only version that's available at the moment from <code>https://pypi.anaconda.org/scientific-python-nightly-wheels/simple</code>, but there's only one wheel and it doesn't match my env (I request Python 3.12, this wheel is cp311). This looks like a bug to me: as I'm not imposing a constraint on <code>pillow</code>, and I'm only passing <code>--extra-index-url</code> (as opposed to <code>--index-url</code>), <code>uv</code> should be able to pick up a wheel from pypi.org</p>
<p>Furthermore, <code>pip</code> succeeds in the same scenario</p>
<pre><code>python -m pip install matplotlib --only-binary &quot;:all:&quot; --pre --extra-index-url https://pypi.anaconda.org/scientific-python-nightly-wheels/simple
</code></pre>
<pre><code>...
Successfully installed contourpy-1.3.0.dev1 cycler-0.12.1 fonttools-4.53.1 kiwisolver-1.4.5 matplotlib-3.10.0.dev401+g9b8a8c7246 numpy-2.1.0.dev0 packaging-24.1 pillow-10.4.0 pyparsing-3.1.2 python-dateutil-2.9.0.post0 six-1.16.0
</code></pre>
<p>reporting the resulting with <code>uv pip tree</code> for legibility (and because this tool rocks)</p>
<pre><code>❯ uv pip tree --package matplotlib
matplotlib v3.10.0.dev401+g9b8a8c7246
├── contourpy v1.3.0.dev1
│   └── numpy v2.1.0.dev0
├── cycler v0.12.1
├── fonttools v4.53.1
├── kiwisolver v1.4.5
├── numpy v2.1.0.dev0
├── packaging v24.1
├── pillow v10.4.0
├── pyparsing v3.1.2
└── python-dateutil v2.9.0.post0
    └── six v1.16.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../la-niche/lick/pulls/123.html">la-niche/lick#123</a> on 2024-07-17 10:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-17 10:24</div>
            <div class="timeline-body"><p>uv differs in its handling of extra index urls from pip (https://github.com/astral-sh/uv/blob/main/PIP_COMPATIBILITY.md#packages-that-exist-on-multiple-indexes). In your case, you need to pick a different <code>--index-strategy</code> value if you want uv to fallback to pypi.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2024-07-17 10:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neutrinoceros">@neutrinoceros</a> on 2024-07-17 10:58</div>
            <div class="timeline-body"><p>Oh, I didn't remember this from when I read the compatibility guide, I should have gone back to it !
Thank you for your snappy response, <code>--index-strategy=unsafe-best-match</code> is indeed what I need.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @neutrinoceros on 2024-07-17 10:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:58 UTC
    </footer>
</body>
</html>
