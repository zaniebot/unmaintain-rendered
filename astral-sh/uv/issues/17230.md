```yaml
number: 17230
title: "`uv sync --script` should respect `UV_PROJECT_ENVIRONMENT` (or some other env var)"
type: issue
state: closed
author: metaist
labels:
  - enhancement
assignees: []
created_at: 2025-12-23T17:56:01Z
updated_at: 2026-01-05T21:21:18Z
url: https://github.com/astral-sh/uv/issues/17230
synced_at: 2026-01-10T01:57:37Z
```

# `uv sync --script` should respect `UV_PROJECT_ENVIRONMENT` (or some other env var)

---

_Issue opened by @metaist on 2025-12-23 17:56_

### Summary

While `uv sync` generally respects `UV_PROJECT_ENVIRONMENT`, `uv sync --script` ignores it.

I recognize this is a weird request and I'm ok with the workaround I currently implement (i.e. fetch the venv path after the fact ala https://github.com/astral-sh/uv/issues/16171#issuecomment-3379501787).

My use case is [`cosmofy`](https://github.com/metaist/cosmofy) which uses uv to build a temporary venv and bundles everything up into a Cosmopolitan Python file. When bundling the project, I can force the venv to be built in a temp directory of my choosing, but I cannot do the same for individual `--script` files.

### Example

```bash
UV_PROJECT_ENVIRONMENT=path_of_my_own uv sync --script myscript.py
```

---

_Label `enhancement` added by @metaist on 2025-12-23 17:56_

---

_Comment by @woodruffw on 2025-12-26 15:35_

I *think* the reason we don't do this by default is because `--script` generally implies a per-script ephemeral virtual environment, whereas `UV_PROJECT_ENVIRONMENT` (typically `.venv`) generally corresponds to an entire project (= `pyproject.toml`'s) resolution set.

Out of curiosity, is there a reason you can't use project-level dependencies for this, since you're already using a project environment? To do that you can remove the PEP 723 dependencies/script metadata and use `uv sync` without `--script`, for example:

```bash
# 'myscript' would be a dependency group for 'myscript.py'
# you could also omit this and use the default dependencies, depending on your use case
uv sync --group myscript  
```

And then, to run `myscript`, you'd do `uv run` without `--script` too:

```bash
# could omit --group here if you omit it above
uv run --group myscript myscript.py
```

...and that would honor both the default project venv and any environment you configure via `UV_PROJECT_ENVIRONMENT`, I believe.

---

_Comment by @metaist on 2025-12-26 19:05_

> I _think_ the reason we don't do this by default is because `--script` generally implies a per-script ephemeral virtual environment, whereas `UV_PROJECT_ENVIRONMENT` (typically `.venv`) generally corresponds to an entire project (= `pyproject.toml`'s) resolution set.

Yes, I understood that to be the case, which is why I don't consider this a bug, but more of a feature request (or pointing out a slight inconsistency).

> Out of curiosity, is there a reason you can't use project-level dependencies for this, since you're already using a project environment? To do that you can remove the PEP 723 dependencies/script metadata and use `uv sync` without `--script`, for example: [...]

To clarify: [the tool I built](https://github.com/metaist/cosmofy) bundles up people's projects (with their dependencies) into a [cosmopolitan python executable](https://ahgamut.github.io/2021/07/13/ape-python/), so I don't want to mess up their current venv. To do that, I perform a [very specific `uv sync`](https://github.com/metaist/cosmofy/blob/815ee899788b3e062a014960c35901b9181d1ea1/src/cosmofy/bundle.py#L227) which I then bundle up.

I wanted to support a `--script` mode (like `uv` does), in which case I definitely don't want to use anything other than the inline PEP 723 dependencies. My current approach just reads the "ephemeral" (it's actually persistent per script) venv after-the-fact from the JSON output of `uv sync`, so everything works, but it feels like if there's a mechanism to force `uv` to use a certain directory for the venv, that there should be some comparable system for `--script` (if not literally `UV_PROJECT_ENVIRONMENT`), but my use case may be too weird for that.

---

_Comment by @zanieb on 2026-01-05 20:51_

I think using `VIRTUAL_ENV=...` and `--active` should work with `--script` today.

We could also expose a `UV_SCRIPT_ENVIRONMENT` variable? Though I'm a little hesitant to double-down on that pattern. 

---

_Referenced in [astral-sh/uv#17329](../../astral-sh/uv/pulls/17329.md) on 2026-01-05 21:05_

---

_Comment by @charliermarsh on 2026-01-05 21:05_

If we decide we want to do it: https://github.com/astral-sh/uv/pull/17329

---

_Comment by @metaist on 2026-01-05 21:21_

> I think using `VIRTUAL_ENV=...` and `--active` should work with `--script` today.

Thanks for following up on this. I tested my code with `VIRTUAL_ENV` + `--script` + `--active` and it works just fine. Not sure why I didn't think of this despite reading the docs carefully.

> We could also expose a `UV_SCRIPT_ENVIRONMENT` variable? Though I'm a little hesitant to double-down on that pattern.

I agree that there's not really a reason for `UV_SCRIPT_ENVIRONMENT` right now. Currently, I can think of real reasons why you might want to control the `UV_PROJECT_ENVIRONMENT` and `VIRTUAL_ENV` directories separately. But scripts are otherwise self-contained, so only the `VIRTUAL_ENV` override really makes any sense.

---

_Closed by @metaist on 2026-01-05 21:21_

---

_Referenced in [metaist/cosmofy#113](../../metaist/cosmofy/issues/113.md) on 2026-01-06 17:02_

---
