<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow use of `tool.uv.sources` in published build metadata - astral-sh/uv #7167</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow use of `tool.uv.sources` in published build metadata</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/7167">#7167</a>
        opened by <a href="https://github.com/FishAlchemist">@FishAlchemist</a>
        on 2024-09-07 12:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-09-07 12:38</div>
            <div class="timeline-body"><p><strong>uv version:</strong> uv 0.4.7 (a178051e8 2024-09-07)
If a project depends on a package that doesn't exist on PyPI, the resulting wheel from uv build will also be unusable.
<img src="https://github.com/user-attachments/assets/d8fa64c2-9d2c-4c56-872e-9630d5319bbc" alt="image" />
Due to this problem, I am unable to depend on private packages.</p>
<pre><code class="language-toml">[project]
name = &quot;temp&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
    &quot;python-world&quot;,
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.uv.sources]
python-world = { git = &quot;https://github.com/ceddlyburge/python_world&quot; }
</code></pre>
<p><strong>Note:</strong> I didn't verify the contents of the Git repository. I simply found a package name that doesn't exist on PyPI.
<strong>Note:</strong> I'm using URL dependencies for wheels, but since it's a private package, I've found another way to reproduce the same issue.
<a href="https://github.com/user-attachments/files/16918152/dist.zip">dist.zip</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:41</div>
            <div class="timeline-body"><p>You can use a PEP 508 requirement instead of <code>tool.uv.sources</code> if you want them to appear in the distributed metadata. This is intentional.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-09-07 12:47</div>
            <div class="timeline-body"><blockquote>
<p>You can use a PEP 508 requirement instead of <code>tool.uv.sources</code> if you want them to appear in the distributed metadata. This is intentional.</p>
</blockquote>
<p>Does uv have a way to automatically convert to PEP 508 during <code>uv build</code>? The current format is quite readable, so I don't want to write it as PEP 508 unless necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 12:49</div>
            <div class="timeline-body"><p>Hmm, I don't think so. We could consider adding something like that. Right now we have <code>--no-sources</code>, which ignores the sources entirely during various operations. I think we could <em>only</em> support this if we had our own build backend though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-09-07 13:01</div>
            <div class="timeline-body"><blockquote>
<p>Hmm, I don't think so. We could consider adding something like that. Right now we have <code>--no-sources</code>, which ignores the sources entirely during various operations. I think we could <em>only</em> support this if we had our own build backend though.</p>
</blockquote>
<p>If there are no sources, it should error, right? After all, nothing can be found.
<img src="https://github.com/user-attachments/assets/17e957c7-94d9-466f-b9c4-fa6242dfbd0e" alt="image" />
However, <code>uv build --no-sources</code> can successfully produce .tar.gz and whl files.
<strong>Note:</strong> Running uv within the same project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 13:08</div>
            <div class="timeline-body"><p>No, it would work fine, because those aren't <em>build</em> requirements, so they don't get pulled in at all when building the wheel or source distribution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-09-07 13:21</div>
            <div class="timeline-body"><p>Have you considered stopping the build if there are dependencies originating from <code>uv source</code>? Since uv isn't using UV's build backend now, its dependency behavior will differ from normal UV usage.
Could this lead to confusion regarding package dependencies? For instance, if we expect to install packages from a specific source but end up installing from PyPI.
Issuing a warning is also an option; it's not necessary to halt the build. Perhaps users expect such an outcome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "The result package dependencies of  ``uv build`` cannot be Git." to "Allow use of `tool.uv.sources` in published build metadata" by @charliermarsh on 2024-09-07 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-09-07 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-09-07 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-07 15:14</div>
            <div class="timeline-body"><p>I don't think it's improper to define alternative package sources for development then publish using public versions. We probably should have some sort of safe guards or warnings here though â€” maybe an opt-in mechanism.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-07 15:50</div>
            <div class="timeline-body"><p>So that's roughly what we do today -- if you run <code>uv build</code> or <code>python -m build</code> or whatever, any information in <code>tool.uv.sources</code> is ignored (i.e., that Git reference would be absent from the published metadata). That <em>is</em> by design, since we consider <code>project.dependencies</code> to be the declared project metadata, and <code>tool.uv.sources</code> to be for local development. The ask here is that <code>tool.uv.sources</code> find its way into the declared project metadata, so that <code>uv build</code> would retain that Git reference above by translating it to PEP 508.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-07 16:25</div>
            <div class="timeline-body"><p>Yep I think we're on the same page about the current behavior. I think a possible idea is that during publish we could require opt-in when local sources are defined so our behavior does not surprise people. I'm not a huge fan of that, but it's a possibility. My comment was roughly in response to:</p>
<blockquote>
<p>Have you considered stopping the build if there are dependencies originating from uv source?</p>
</blockquote>
<p>An alternative is that we display a warning which requires opt-in to silence. I don't love that either, as I don't think the happy path should include warnings. I'm not certain of the best way for the CLI to teach that sources are not included in the built and published package.</p>
<blockquote>
<p>The ask here is that tool.uv.sources find its way into the declared project metadata, so that uv build would retain that Git reference above by translating it to PEP 508.</p>
</blockquote>
<p>This might be kind of hard to teach as well, but it does seem like reasonable behavior to opt-in to. I think we could consider exposing this with a flag like <code>--convert-sources</code>. What source kinds could we support here?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:47:48 UTC
    </footer>
</body>
</html>
