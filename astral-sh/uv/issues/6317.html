<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` does not include local package - astral-sh/uv #6317</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip compile</code> does not include local package</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6317">#6317</a>
        opened by <a href="https://github.com/joellidin">@joellidin</a>
        on 2024-08-21 10:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/joellidin">@joellidin</a> on 2024-08-21 10:55</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>I am playing around a bit with <code>uv</code> and its features and got interested in the <code>uv pip compile</code> for platform agnostic lock files. I set up a very basic project with this <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;test-uv&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12.4&quot;
dependencies = [
    &quot;ruff&gt;=0.6.1&quot;,
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
<p>Later I ran <code>uv pip compile --universal pyproject.toml -o requirements.lock</code> which resulted in:</p>
<pre><code class="language-lock"># This file was autogenerated by uv via the following command:
#    uv pip compile --universal pyproject.toml -o requirements.lock
ruff==0.6.1
    # via test-uv (pyproject.toml)
</code></pre>
<p>However, my local package is not included in this lockfile which is a bit weird to me. For example if I run <code>rye sync</code> instead I get the following:</p>
<pre><code class="language-lock"># generated by rye
# use `rye lock` or `rye sync` to update this lockfile
#
# last locked with the following flags:
#   pre: false
#   features: []
#   all-features: false
#   with-sources: false
#   generate-hashes: false
#   universal: false

-e file:.
ruff==0.6.1
    # via test-uv
</code></pre>
<p>Moreover, when doing <code>uv sync</code> it actually installs my <code>test-uv</code> package in editable mode. But, I want to explore an option where you can just use normal <code>pip install -r requirements.lock</code> and not forced to use <code>uv</code>.</p>
<p>Am I missing something from the documentation or is this intended behavior?</p>
<p>I am on Ubuntu 22.04 with the latest version of <code>uv 0.3.0</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 13:25</div>
            <div class="timeline-body"><p>So, if you pass a <code>pyproject.toml</code>, we lock the <em>dependencies</em> but not the project itself.</p>
<p>But if you pass a <em>source tree</em>, we'll lock the project.</p>
<p>In other words, you can put <code>./test-uv</code> (or <code>./</code> if in the same directory) in a <code>requirements.in</code>, then run <code>uv pip compile --universal requirements.in</code>, and you should see the result you're looking for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 13:26</div>
            <div class="timeline-body"><p>For example:</p>
<pre><code>‚ùØ uv pip compile req.in
Resolved 4 packages in 62ms
# This file was autogenerated by uv via the following command:
#    uv pip compile req.in
anyio==4.4.0
    # via black
./
    # via -r req.in
idna==3.7
    # via anyio
sniffio==1.3.1
    # via anyio
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-08-21 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joellidin">@joellidin</a> on 2024-08-21 13:52</div>
            <div class="timeline-body"><p>How can I lock dependencies with extras? I'm encountering the following error:</p>
<pre><code class="language-bash">error: Requesting extras requires a `pyproject.toml`, `setup.cfg`, or `setup.py` file.
</code></pre>
<p>I'd prefer not to specify dependencies in multiple files.</p>
<p><code>rye sync --features test --universal</code> works perfectly for me, creating both <code>requirements.lock</code> and <code>requirements-dev.lock</code>. I was just curious if this is possible with <code>uv</code> as well, but it seems like it doesn't work the same way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 13:58</div>
            <div class="timeline-body"><p>Yeah totally -- you can add the following <code>requirements.in</code> to include the <code>dev</code> extra:</p>
<pre><code>.[dev]
</code></pre>
<p>Is the main issue with <code>uv sync</code> just that you don't want the project to be installed as editable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joellidin">@joellidin</a> on 2024-08-21 14:15</div>
            <div class="timeline-body"><p>Okay! I understand better how it works then. I would want to have a lock file that is not only usable with uv. If I have the output from the compile I get a file I can install with the normal pip? For example if someone is not using <code>uv</code>. If that makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 18:02</div>
            <div class="timeline-body"><p>Makes sense. We will probably add support for <em>exporting</em> <code>uv.lock</code> to <code>requirements.txt</code>, which could be useful for you in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-23 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-23 18:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:39 UTC
    </footer>
</body>
</html>
