<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModuleNotFoundError when running with `uv run`, but works fine with activated virtual environment - astral-sh/uv #17124</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ModuleNotFoundError when running with <code>uv run</code>, but works fine with activated virtual environment</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17124">#17124</a>
        opened by <a href="https://github.com/Priate-cat">@Priate-cat</a>
        on 2025-12-13 13:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Priate-cat">@Priate-cat</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm encountering a <code>ModuleNotFoundError </code>when executing my script using <code>uv run</code>, while the same script runs without issues when I activate the virtual environment and run it directly with <code>python test.py</code>.</p>
<p>Environment details:</p>
<p>Python version: 3.10
uv version: uv 0.9.17 (2b5d65e61 2025-12-09)
Dependencies installed via: <code>uv pip install -r requirements.txt</code>
Steps to reproduce:</p>
<p>Install dependencies: <code>uv pip install -r requirements.txt</code>
Run the script using uv: uv run python test.py → Results in ModuleNotFoundError for one or more modules listed in requirements.txt.
Activate the virtual environment manually and run: python test.py → Script executes successfully with no import errors.
Expected behavior:
uv run python test.py should be able to locate and import all modules installed via uv pip install -r requirements.txt, just as it does when the environment is activated manually.</p>
<p><code>requirements.txt</code>:</p>
<pre><code class="language-bash">pydantic
python-dotenv
langgraph
langchain-core
langchain-deepseek
langchain-tavily
langsmith
langchain-openai
langchain-text-splitters
langchain-community
faiss-cpu
langgraph_supervisor
graphrag
</code></pre>
<p><code>test.py</code>:</p>
<pre><code class="language-bash">from langchain_openai import OpenAIEmbeddings
print(&quot;Import successful&quot;)
</code></pre>
<h3>Platform</h3>
<p>Windows 11 x86_64</p>
<h3>Version</h3>
<p>uv 0.9.17 (2b5d65e61 2025-12-09)</p>
<h3>Python version</h3>
<p>Python 3.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Priate-cat on 2025-12-13 13:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-12-13 14:55</div>
            <div class="timeline-body"><p>To facilitate resolution when submitting a BUG, please provide the result with the <code>--verbose</code> option enabled.</p>
<p>Regarding this issue, I can reproduce the same result locally, though I cannot guarantee the underlying cause is the same.</p>
<p>The steps to reproduce are as follows:</p>
<ol>
<li>Run <code>uv venv -p 3.10</code></li>
<li>Run <code>uv pip install langchain_openai</code></li>
<li>Use <code>uv python pin</code> to pin a Python version that is incompatible with the virtual environment.</li>
<li>Run <code>uv run test.py</code></li>
</ol>
<p>The reason on my machine is that since <code>uv run</code> is a project API, it consults <code>.python-version</code>. Consequently, on Windows, because the virtual environment (<code>.venv</code>) version did not match the required version, it ignored the virtual environment. It then somehow  to executing with the  managed Python, but since the Python lacked the necessary dependencies, the result was a <code>ModuleNotFoundError</code>.</p>
<p>So, the temporary solution is to run <code>uv python pin 3.10</code> in your project's root directory. This will prevent <code>uv</code> from skipping the <code>.venv</code> folder when searching for the virtual environment.</p>
<p>A slightly more cumbersome temporary solution is to explicitly specify using the virtual environment's Python when running <code>uv run</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-12-13 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-12-13 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-12-13 15:43</div>
            <div class="timeline-body"><p>Please do share more reproduction details and verbose logs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-12-13 16:21</div>
            <div class="timeline-body"><p>Let me provide the detailed log of my scenario(https://github.com/astral-sh/uv/issues/17124#issuecomment-3649507720).
command: <code>uv run --verbose .\test.py</code></p>
<pre><code>DEBUG uv 0.9.17 (2b5d65e61 2025-12-09)
DEBUG Acquired shared lock for `C:\Users\user\AppData\Local\uv\cache`
DEBUG No project found; searching for Python interpreter
DEBUG Reading Python requests from version file at `C:\Users\user\path_a\.python-version`
DEBUG Using request timeout of 30s
DEBUG Searching for Python 3.12 in virtual environments, managed installations, search path, or registry
DEBUG Found `cpython-3.10.19-windows-x86_64-none` at `C:\Users\user\path_a\.venv\Scripts\python.exe` (virtual environment)
DEBUG Skipping interpreter at `.venv\Scripts\python.exe` from virtual environment: does not satisfy request `3.12`
DEBUG Searching for managed installations at `C:\Users\user\AppData\Roaming\uv\data\python`
WARN Ignoring malformed managed Python entry:
    failed to open file `C:\Users\user\AppData\Roaming\uv\data\python\cpython-3.10.14-windows-x86_64-none\BUILD`: Access denied. (os error 5)
DEBUG Skipping managed installation `cpython-3.14.0-windows-x86_64-none`: does not satisfy `3.12`
DEBUG Skipping managed installation `cpython-3.14.0+freethreaded-windows-x86_64-none`: does not satisfy `3.12`
DEBUG Skipping managed installation `cpython-3.14.0a6-windows-x86_64-none`: does not satisfy `3.12`
DEBUG Skipping managed installation `cpython-3.13.6-windows-x86_64-none`: does not satisfy `3.12`
DEBUG Skipping managed installation `cpython-3.13.1+freethreaded-windows-x86_64-none`: does not satisfy `3.12`
DEBUG Skipping managed installation `cpython-3.13.0-windows-x86_64-none`: does not satisfy `3.12`
DEBUG Found managed installation `cpython-3.12.10-windows-x86_64-none`
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Users\user\AppData\Roaming\uv\data\python\cpython-3.12.10-windows-x86_64-none\python.exe` (managed installations)
DEBUG Using Python 3.12.10 interpreter at: C:\Users\user\AppData\Roaming\uv\data\python\cpython-3.12.10-windows-x86_64-none\python.exe
DEBUG Running `python .\test.py`
Traceback (most recent call last):
  File &quot;C:\Users\user\path_a\test.py&quot;, line 1, in &lt;module&gt;
    from langchain_openai import OpenAIEmbeddings
ModuleNotFoundError: No module named 'langchain_openai'
DEBUG Command exited with code: 1
DEBUG Released lock at `C:\Users\user\AppData\Local\uv\cache\.lock`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Priate-cat">@Priate-cat</a> on 2025-12-16 06:29</div>
            <div class="timeline-body"><blockquote>
<p>To facilitate resolution when submitting a BUG, please provide the result with the <code>--verbose</code> option enabled.</p>
<p>Regarding this issue, I can reproduce the same result locally, though I cannot guarantee the underlying cause is the same.</p>
<p>The steps to reproduce are as follows:</p>
<ol>
<li>Run <code>uv venv -p 3.10</code></li>
<li>Run <code>uv pip install langchain_openai</code></li>
<li>Use <code>uv python pin</code> to pin a Python version that is incompatible with the virtual environment.</li>
<li>Run <code>uv run test.py</code></li>
</ol>
<p>The reason on my machine is that since <code>uv run</code> is a project API, it consults <code>.python-version</code>. Consequently, on Windows, because the virtual environment (<code>.venv</code>) version did not match the required version, it ignored the virtual environment. It then somehow to executing with the managed Python, but since the Python lacked the necessary dependencies, the result was a <code>ModuleNotFoundError</code>.</p>
<p>So, the temporary solution is to run <code>uv python pin 3.10</code> in your project's root directory. This will prevent <code>uv</code> from skipping the <code>.venv</code> folder when searching for the virtual environment.</p>
<p>A slightly more cumbersome temporary solution is to explicitly specify using the virtual environment's Python when running <code>uv run</code>.</p>
</blockquote>
<p>Thanks for the quick response and the helpful workaround!
I can confirm I'm seeing the exact same issue as you described—I also reproduced it locally, and <code>uv python pin 3.10</code> resolves it cleanly. I also found that running <code>uv init -p 3.10 --bare</code> to generate a <code>pyproject.toml</code> (which includes the Python version specification) effectively avoids the issue, as it establishes a proper project context and ensures <code>uv run</code> uses the existing <code>.venv</code>.
Just out of curiosity: is this behavior expected long-term, or might future versions of <code>uv</code> improve virtual environment detection even in the absence of <code>.python-version</code> or <code>pyproject.toml</code>? And would you generally recommend using <code>uv init</code> to set up projects rather than starting with <code>uv venv</code> directly?
Thanks again!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-16 10:20</div>
            <div class="timeline-body"><p>For <code>uv run</code>, you need to run <code>uv add -r requirements.txt</code>. <code>uv pip</code> and <code>uv run</code> don't mix well: <code>uv run</code> is a project-based, managed interface where uv can remove and recreate the venv, it has <code>pyproject.toml</code> and <code>uv.lock</code>. <code>requirements.txt</code> on the other hand is a pip-specific interface, and <code>uv pip</code> exist for compatibility with exiting pip workflows. Those pip workflows are rather manual, where you create the venv yourself with <code>uv venv</code> and each modification of it is a specific command.</p>
<p>We recommend using using the the project based interface with <code>uv init</code>, <code>uv add</code>, <code>uv sync</code>, <code>uv run</code>, etc. Those handle venv creation for you. For migration, uv has the <code>uv add -r requirements.txt</code> command that converts <code>requirements.txt</code> to the standard <code>pyproject.toml</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:41 UTC
    </footer>
</body>
</html>
