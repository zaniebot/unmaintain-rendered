```yaml
number: 15146
title: uv 0.8.5 requires hashes for all build dependencies, while uv 0.8.4 does not
type: issue
state: closed
author: hauntsaninja
labels:
  - bug
assignees: []
created_at: 2025-08-07T19:17:43Z
updated_at: 2025-08-07T21:43:25Z
url: https://github.com/astral-sh/uv/issues/15146
synced_at: 2026-01-10T03:32:46Z
```

# uv 0.8.5 requires hashes for all build dependencies, while uv 0.8.4 does not

---

_Issue opened by @hauntsaninja on 2025-08-07 19:17_

### Summary

Consider r.txt like so:
```
# This file was autogenerated by uv via the following command:
#    uv pip compile r.in --output-file r.txt --generate-hashes
mpi4py==4.0.1 \
    --hash=sha256:05999b6e8536a1234456d739ea1e695105613a866cae9a86010f87875229ffc0 \
    --hash=sha256:0cb209fcdc7fee0346d12edff1cfd1c1ffca1b807c53631ba0436b9c2bcf8229 \
    --hash=sha256:2b8bfbb730c47214a6233512eb905b2b12a40a036d92e96e2c7dd9a3405d8b4a \
    --hash=sha256:52a7b1760b1aeb41a0ea38969314b2b170117a0ded2f689915f1cb89aaaf8a6f \
    --hash=sha256:600f26cae7f390b4ec525f5c1ccc374686c37a8c07f9c21320866c0a323f6dae \
    --hash=sha256:6fa09d03ec7aa1264fcf650670c52e06ae87110f0bc6f84bf29f0183f6d3d19a \
    --hash=sha256:72006d9d9cc0e17d2a354648839e0d9743c7b91223586c323090033114324ee4 \
    --hash=sha256:93f45dcc2fd5f3396f961b1bc8f0fb9d5db786fdc0d72e4f8611f47718b5dac8 \
    --hash=sha256:b704e7db92b1ac94b96802e17cf28082455daa928e8e51398ad9f5e5eb8c9b7b \
    --hash=sha256:bf15be241ed81bad0a0635cb47e0f20faa6ec4228f0fa955bf0128f43462b639 \
    --hash=sha256:cd29eff4366f5182f3cbdac42ba62d0c5b17c6fc925dfe55cbe469fbe2d56cfb \
    --hash=sha256:f3174b245775d556f4fddb32519a2066ef0592edc810c5b5a59238f9a0a40c89 \
    --hash=sha256:f7e863ea266af98d25c3efb9b7d9f56265000001b57cf2fb98a986f4ec7daa3c
    # via -r r.in
```

0.8.5
```
λ uvx uv@0.8.5 pip install -r r.txt --require-hashes
Using Python 3.12.9 environment at: /Users/shantanu/.virtualenvs/openai312
Resolved 1 package in 163ms
  × Failed to download and build `mpi4py==4.0.1`
  ├─▶ Failed to resolve requirements from `build-system.requires`
  ├─▶ No solution found when resolving: `setuptools>=42`, `build`
  ╰─▶ In `--require-hashes` mode, all requirements must be pinned upfront with `==`, but found: `setuptools`
```

0.8.4
```
λ uvx uv@0.8.4 pip install -r r.txt --require-hashes
Using Python 3.12.9 environment at: /Users/shantanu/.virtualenvs/openai312
Resolved 1 package in 3ms
Installed 1 package in 2ms
 + mpi4py==4.0.1
```

Might need to cache clean if you have a successful build

Couldn't find any corresponding change in the CHANGELOG

### Platform

N/A

### Version

0.8.5

### Python version

_No response_

---

_Label `bug` added by @hauntsaninja on 2025-08-07 19:17_

---

_Comment by @zanieb on 2025-08-07 19:31_

Thank you for the report.

Also reported at https://github.com/astral-sh/uv/issues/5190#issuecomment-3161021952


---

_Comment by @zanieb on 2025-08-07 20:01_

Separately from the fact that this is a regression, do you... prefer this behavior? It seems more correct if we support locking the build dependencies in the `requirements.txt` file.

---

_Comment by @hauntsaninja on 2025-08-07 20:13_

If there was a way to lock build dependencies in the same file, I think it might be good?

I see two main downsides:
- Insanity when you start having conflicting versions of build dependencies
- Bloat from build dependencies for things you end up installing from wheel

---

_Comment by @hauntsaninja on 2025-08-07 20:19_

(It's definitely short term inconvenient enough that it would be nice to unregress for now. I didn't follow PEP 751 too closely, but I think they gave up on build dep locking because of various confusion / edge cases, so is probably a tough thing to get working well with requirements.txt in a patch release)

---

_Comment by @zanieb on 2025-08-07 20:23_

Yeah I'm definitely pursuing fixing this

---

_Comment by @zanieb on 2025-08-07 20:25_

A bisect points to bda9ea957a1c2c2907d05850cbae39b28de71040 / https://github.com/astral-sh/uv/pull/15087

---

_Comment by @zanieb on 2025-08-07 21:31_

Holy cow I spent way too long staring at #15036 instead of #15087 like a dummy

---

_Closed by @zanieb on 2025-08-07 21:43_

---
