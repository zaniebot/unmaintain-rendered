<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[0.1.19 regression] `uv` no longer uses the Python interpreter set by `pyenv` - astral-sh/uv #2488</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[0.1.19 regression] <code>uv</code> no longer uses the Python interpreter set by <code>pyenv</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2488">#2488</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-03-16 15:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><p>From version 0.1.19 onwards, <code>uv</code> seems to no longer respect the Python interpreter set by using <code>pyenv local</code>, even though it did on previous versions. This still reproduces on the latest version (uv==0.1.21). Reproducer in the shell to show that this worked with <code>uv==0.1.18</code>, but not on later versions (the &quot;Using Python 3.XX.X lines are the relevant ones that demonstrate the bug):</p>
<pre><code>% pyenv local 3.11                                                                                                                    ~/dev/typeshed
% py --version                                                                                                                        ~/dev/typeshed
Python 3.11.8
% pipx install uv==0.1.18 --force                                                                                                     ~/dev/typeshed
Installing to existing venv &#x27;uv&#x27;
  installed package uv 0.1.18, installed using Python 3.12.2
  These apps are now globally available
    - uv
done! âœ¨ ðŸŒŸ âœ¨
% uv venv 311-env                                                                                                                     ~/dev/typeshed
Using Python 3.11.8 interpreter at: /Users/alexw/.pyenv/versions/3.11.8/bin/python3
Creating virtualenv at: 311-env
Activate with: source 311-env/bin/activate
% rm -rf 311-env                                                                                                                      ~/dev/typeshed
% pipx install uv==0.1.19 --force                                                                                                     ~/dev/typeshed
Installing to existing venv &#x27;uv&#x27;
  installed package uv 0.1.19, installed using Python 3.12.2
  These apps are now globally available
    - uv
done! âœ¨ ðŸŒŸ âœ¨
% uv venv 311-env                                                                                                                     ~/dev/typeshed
Using Python 3.12.2 interpreter at: /usr/local/bin/python3
Creating virtualenv at: 311-env
Activate with: source 311-env/bin/activate
% rm -rf 311-env                                                                                                                      ~/dev/typeshed
% pipx upgrade uv                                                                                                                     ~/dev/typeshed
upgraded package uv from 0.1.19 to 0.1.21 (location: /Users/alexw/Library/Application Support/pipx/venvs/uv)
% uv venv 311-env                                                                                                                     ~/dev/typeshed
Using Python 3.12.2 interpreter at: /usr/local/bin/python3
Creating virtualenv at: 311-env
Activate with: source 311-env/bin/activate
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-16 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-16 15:57</div>
            <div class="timeline-body"><p>Hm I&#x27;m not sure what would have caused this from the <a href="https://github.com/astral-sh/uv/blob/main/CHANGELOG.md#0119">CHANGELOG</a>.</p>
<p>The next steps are perhaps:</p>
<ul>
<li>Ensure the expected behavior here is compliant with the proposed behavior in #2386</li>
<li>Bisect the commit that introduced the regression</li>
<li>Add a system check test covering this (these do not support assertions a specific version is used yet)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-16 16:05</div>
            <div class="timeline-body"><blockquote>
<ul>
<li>Ensure the expected behavior here is compliant with the proposed behavior in #2386</li>
</ul>
</blockquote>
<p><code>/Users/alexw/.pyenv/shims</code> is on my <code>PATH</code> -- does that satisfy this point? It looks like using pyenv shims has been supported since at least <a href="https://github.com/astral-sh/uv/pull/1711">astral-sh/uv#1711</a>, but perhaps we never officially declared support. I certainly found it very useful when <code>uv</code> did support pyenv shims :-)</p>
<p>I&#x27;ll try bisecting this to a specific commit now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-16 16:12</div>
            <div class="timeline-body"><pre><code>7964bfbb2bed50a5c7b0650a7b6799a66503a33a is the first bad commit
commit 7964bfbb2bed50a5c7b0650a7b6799a66503a33a
Author: konsti &lt;konstin@mailbox.org&gt;
Date:   Wed Mar 13 12:51:14 2024 +0100

    Move architecture and operating system probing to Python (#2381)
</code></pre>
<p>7964bfbb2bed50a5c7b0650a7b6799a66503a33a by @konstin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-16 16:55</div>
            <div class="timeline-body"><p>Explicitly passing the Python version using the <code>--python</code> flag also seems to fail:</p>
<pre><code>% python3.11
Python 3.11.8 (main, Feb 15 2024, 19:32:18) [Clang 15.0.0 (clang-1500.1.0.2.5)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; exit()
% uv venv --python 3.11                                                                                                                   ~/dev/mypy
  Ã— Querying Python at `/Users/alexw/.pyenv/shims/python3.11` failed with status exit status: 127 with exit status: 127
  â”‚ --- stdout:

  â”‚ --- stderr:
  â”‚ pyenv: python3.11: command not found

  â”‚ The `python3.11&#x27; command exists in these Python versions:
  â”‚   3.11.8

  â”‚ Note: See &#x27;pyenv help global&#x27; for tips on allowing both
  â”‚       python2 and python3 to be found.
  â”‚ ---
[1] % uv venv --python 3.11.8                                                                                                             ~/dev/mypy
  Ã— Querying Python at `/Users/alexw/.pyenv/shims/python3.11` failed with status exit status: 127 with exit status: 127
  â”‚ --- stdout:

  â”‚ --- stderr:
  â”‚ pyenv: python3.11: command not found

  â”‚ The `python3.11&#x27; command exists in these Python versions:
  â”‚   3.11.8

  â”‚ Note: See &#x27;pyenv help global&#x27; for tips on allowing both
  â”‚       python2 and python3 to be found.
  â”‚ ---
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-16 22:06</div>
            <div class="timeline-body"><p>Donâ€™t see any inherent reason that that change should break pyenv. I can take a look on Monday.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-17 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:13</div>
            <div class="timeline-body"><p>Oh my guess is that it&#x27;s because we now run that in a temporary directory...? Rather than the current working directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-18 02:23</div>
            <div class="timeline-body"><p>Oh that seems like it would break the shim, interesting</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:23</div>
            <div class="timeline-body"><p>I still wish we could concat all the files into one :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-18 02:27</div>
            <div class="timeline-body"><p>We could put it in a zipapp... :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:28</div>
            <div class="timeline-body"><p>I tried, it actually is meaningfully slower lol</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-18 02:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-18 18:37</div>
            <div class="timeline-body"><p>Confirmed that this is fixed in uv==0.1.22 ðŸ¥³</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:30:29 UTC
    </footer>
</body>
</html>
