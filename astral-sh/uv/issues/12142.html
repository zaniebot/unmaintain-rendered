<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv self update` may leave uv unusable if interrupted - astral-sh/uv #12142</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv self update</code> may leave uv unusable if interrupted</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12142">#12142</a>
        opened by <a href="https://github.com/qin-tain">@qin-tain</a>
        on 2025-03-12 19:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/qin-tain">@qin-tain</a> on 2025-03-12 19:03</div>
            <div class="timeline-body"><h3>Description:</h3>
<p>The current update process renames <code>uv.exe</code> to <code>uv.exe.previous.exe</code> before completing. If interrupted (e.g., by network failures or manual termination), this can leave uv unusable due to an incomplete update.</p>
<h3>Suggested Improvement:</h3>
<p>Ensure atomic replacement where <code>uv.exe</code> is only modified after the new version is fully validated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-12 19:37</div>
            <div class="timeline-body"><p>I'm not sure we can do an atomic replacement here because of limitations on removing currently running executables on Windows, but we can probably narrow the time in which this can fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-03-12 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2025-03-12 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @zanieb on 2025-03-12 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Winand">@Winand</a> on 2025-03-22 09:30</div>
            <div class="timeline-body"><p>@zanieb I'm not sure if my problem belongs here, but
in theory can we check if <code>uvx</code> is not running before performing self update?
Sometimes I just forget that i've started uvx in some terminal window.</p>
<pre><code>PS C:\Users\username&gt; uv self update
info: Checking for updates...
error: The installation failed. Output from the installer: Downloading uv 0.6.9 (x86_64-pc-windows-msvc)
Installing to C:\Users\username\.local\bin
uv.exe
We encountered an error trying to perform the installation;
please review the error messages below.

����� �� ����� ������� ����� � 䠩�� &quot;C:\Users\username\.local\bin\uvx.exe&quot;, ⠪ ��� ��� 䠩� �ᯮ������ ��㣨� ����ᮬ.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-01 17:09</div>
            <div class="timeline-body"><p>I'm not sure we can easily tell. I think we just need to move it to a temporary directory instead of trying to remove it. This is a Windows-specific thing though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexBlandin">@AlexBlandin</a> on 2025-06-06 23:03</div>
            <div class="timeline-body"><p>I think &quot;atomic replacement&quot; here is not &quot;true&quot; atomic (in the concurrency primitive sense) but rather the colloquial idea that instead of immediately renaming <code>uv.exe</code> to <code>uv.exe.previous.exe</code>, simply delay that step until after the new executable is ready to replace it, and indeed to make the window for error as small as possible? I may be misunderstanding the original issue, but the general idea of &quot;keeping things working even if they fail&quot; does seem implicit either way.</p>
<p>The updater logic here follows <a href="https://docs.rs/self-replace/latest/self_replace/">self-replace</a>, and is an appropriate solution, but I would imagine there is some error propagation that isn't happening: if this is occurring on network errors, not just the more obvious (external) aborts that would naturally leave a mess, then clearly something is amiss. It may not be uv's fault, deferring largely to <a href="https://github.com/axodotdev/axoupdater">axoupdater</a> as it does, which <a href="https://github.com/axodotdev/axoupdater/blob/main/axoupdater/src/lib.rs#L484">should</a> move/rename the file back if the update fails... but clearly hasn't. Where the specific problem lies, though, I clearly haven't gleamed from my admittedly quick skim-through.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-10 11:05</div>
            <div class="timeline-body"><p>CC @Gankra</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:57 UTC
    </footer>
</body>
</html>
