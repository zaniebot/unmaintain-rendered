<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: add a way to install only build dependencies - astral-sh/uv #1516</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: add a way to install only build dependencies</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/1516">#1516</a>
        opened by <a href="https://github.com/stefanv">@stefanv</a>
        on 2024-02-16 17:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/stefanv">@stefanv</a></div>
            <div class="timeline-body"><p>ref: <a href="https://github.com/pypa/pip/issues/11440">pypa/pip#11440</a>#issuecomment-1615211774</p>
<p>In our CI, we often need to install build-dependencies for a project, without installing the project itself.
At the moment, there is no easy way of telling pip to do that.</p>
<p>We&#x27;ve resorted to <a href="https://github.com/pypa/pip/issues/11440#issuecomment-1791049862">compiling requirements files</a> from pyproject.toml, but it would be convenient if we could install dependencies directly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/webknjaz">@webknjaz</a> on 2024-02-22 13:04</div>
            <div class="timeline-body"><blockquote>
<p>In our CI, we often need to install build-dependencies for a project, without installing the project itself.
At the moment, there is no easy way of telling pip to do that.</p>
</blockquote>
<p>May I suggest making the use case/motivation more detailed? You&#x27;re jumping to the proposed solution here but it&#x27;s not clear <em>why</em> you need this. Are you trying to have a manually managed PEP 517 build environment? An example would be helpful FTR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stefanv">@stefanv</a> on 2024-02-22 16:39</div>
            <div class="timeline-body"><p>Like I wrote above, it&#x27;s useful for a developer setup or CI where the need is to install dependencies without compiling the project. Think of the case, e.g., where you want to prepare a new environment for repeated builds, using no-build-isolation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/webknjaz">@webknjaz</a> on 2024-02-22 22:03</div>
            <div class="timeline-body"><p>Okay, so it&#x27;s indeed about PEP 517 / 660. I wasn&#x27;t sure that it&#x27;s not about PEP 735.
Strictly speaking, the project itself is never installed into the build env in any of the build frontends I know of.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stefanv">@stefanv</a> on 2024-02-23 21:12</div>
            <div class="timeline-body"><p>PEP 735: &quot;This is suitable for creating named groups of dependencies, similar to requirements.txt files.&quot; — since we <a href="https://github.com/pypa/pip/issues/11440#issuecomment-1791049862">currently use <code>requirements.txt</code></a> for this purpose, it seems related?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/webknjaz">@webknjaz</a> on 2024-02-24 03:23</div>
            <div class="timeline-body"><blockquote>
<p>it seems</p>
</blockquote>
<p>Well, that&#x27;s what I&#x27;m trying to determine by asking to spell out the use case details.</p>
<p>It could be viewed as related but it doesn&#x27;t directly cover <code>[build-system]</code> due to focusing on a very specific table it defines — <code>[dependency-groups]</code>, effectively leaving it out.</p>
<p>Though you raise a valid question — can the PEP 517 build deps be a special-cased dependency group. And if you ask me, I&#x27;d say: &quot;It&#x27;s complicated&quot;.
This is because this section specifically targets packageable projects and dependency groups are more generic. Also, PEP 517 build deps aren&#x27;t defined statically more often than not — for example, you can statically define a dependency on <code>setuptools</code> and that would be your single build dependency for building sdists. But as soon as you start producing wheels, another dependency appears — <code>wheel</code>. <code>setuptools</code> injects it dynamically through the corresponding PEP 517 hook. So special-casing such a dependency would inevitably open up a can of worms.</p>
<p>Still, it might be useful to let the PEP author know so that it could be called out in the document.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-26 16:15</div>
            <div class="timeline-body"><p>@stefanv I&#x27;ve seen you linked scikit-image as an example, could you walk me through what the workflow there (or in another shareable repo) is? I&#x27;m trying to follow along what the need here workflow-wise is so we can add something to uv that fills that gap.</p>
<p>I&#x27;m also inviting others to share their usage scenarios and pipelines, this would be extremely helpful for us for coming up with the right design and test case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/webknjaz">@webknjaz</a> on 2024-02-26 16:53</div>
            <div class="timeline-body"><p>In my last year&#x27;s rant I enumerated some of the dependency groups that may exist in various workflows: <a href="https://github.com/jazzband/pip-tools/issues/1326">jazzband/pip-tools#1326</a>#issuecomment-1834517252. Might be useful FTR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stefanv">@stefanv</a> on 2024-02-26 23:26</div>
            <div class="timeline-body"><blockquote>
<p>@stefanv I&#x27;ve seen you linked scikit-image as an example, could you walk me through what the workflow there (or in another shareable repo) is? I&#x27;m trying to follow along what the need here workflow-wise is so we can add something to uv that fills that gap.</p>
</blockquote>
<p>Sure thing. We have a pyproject.toml file that <a href="https://github.com/scikit-image/scikit-image/blob/main/pyproject.toml#L45">declares build and other types of dependencies</a>. When then have a pre-commit hook that ensures that <code>pyproject.toml</code> dependencies <a href="https://github.com/scikit-image/scikit-image/blob/main/.pre-commit-config.yaml#L43">are exported to <code>requirements.txt</code> files</a>.</p>
<p>For simplicity, we declare all dependencies as optional package dependencies (including re-declaring build dependencies), but ideally there would be no duplication.</p>
<p>The above configuration allows us to:</p>
<ol>
<li>Have one definitive place to define various types of dependencies.</li>
<li>Install those dependencies by themselves, as needed. E.g., <a href="https://github.com/scikit-image/scikit-image/blob/main/tools/github/before_install.sh#L35">in our CI</a> (<a href="https://github.com/scikit-image/scikit-image/blob/main/tools/github/script.sh#L16">another example</a>).</li>
</ol>
<p>Another scenario where this is useful is for developing, say, NumPy. I want to create an environment, install all build dependencies, and then run the standard &quot;in-place&quot; developer build: <code>spin build</code>.</p>
<p>Developer builds require that the environment already has dependencies installed. The only existing way I know of to get those dependencies installed is to install the package using &quot;no build isolation&quot;, and to then uninstall it again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/webknjaz">@webknjaz</a> on 2024-02-27 03:05</div>
            <div class="timeline-body"><blockquote>
<p>Developer builds require that the environment already has dependencies installed. The only existing way I know of to get those dependencies installed is to install the package using &quot;no build isolation&quot;, and to then uninstall it again.</p>
</blockquote>
<p>Looking into https://github.com/scikit-image/scikit-image/blob/628adaa/tools/generate_requirements.py#L32-L34, it seems like you don&#x27;t really want build deps in the terms of PEP 517 but runtime deps that happen to be needed too.  and the contents of <code>requirements/</code> confirms that suspicion...
There&#x27;s nothing in your scripts retrieving https://github.com/scikit-image/scikit-image/blob/628adaa/pyproject.toml#L120-L129. Yet, for some reason I can&#x27;t fully comprehend, you think that &quot;no build isolation&quot; helps you get those deps. Is is that you want Cython for in-place builds or why?</p>
<p>FWIW we also have something similar for the runtime deps: https://github.com/aio-libs/aiohttp/blob/6c3122f/Makefile#L187-L190 / https://github.com/aio-libs/aiohttp/blob/6c3122f/requirements/sync-direct-runtime-deps.py / https://github.com/aio-libs/aiohttp/blob/6c3122f/requirements/runtime-deps.in. While keeping all the &quot;dependency groups&quot; in separate requirements files that are then processed by pip-compile to produce constraints.</p>
<p>In another project with a focus on maximum CI stability, I do indeed retrieve <code>[build-system].requires</code> that I then resolve into constraints and set to <code>PIP_CONSTRAINT</code> for package install reproducibility: https://github.com/cherrypy/cheroot/blob/0fd16f0/requirements/dist-build-constraints.txt.
There, I made a pip wrapper (https://github.com/cherrypy/cheroot/blob/0fd16f0/bin/pip-wrapper / https://github.com/cherrypy/cheroot/blob/0fd16f0/bin/pip_constraint_helpers.py) integrated into tox (https://github.com/cherrypy/cheroot/blob/0fd16f0/tox.ini#L22-L29) that auto-selects a proper constraint file from the matrix for the current env and auto-injects it into the <code>pip install</code> command via <code>-c</code>. Dependency groups for the envs involved are hand-crafted (https://github.com/cherrypy/cheroot/tree/0fd16f0/requirements) with a subset of the constraints being auto-generated/updated via GHA that provides access to many different runtimes (https://github.com/cherrypy/cheroot/blob/0fd16f0/.github/workflows/pip-tools.yml#L51-L66), which addresses the problem with inability to cross-compile transitive deps that need to be built from source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stefanv">@stefanv</a> on 2024-02-27 06:58</div>
            <div class="timeline-body"><blockquote>
<p>Looking into https://github.com/scikit-image/scikit-image/blob/628adaa/tools/generate_requirements.py#L32-L34, it seems like you don&#x27;t really want build deps in the terms of PEP 517 but runtime deps that happen to be needed too.</p>
</blockquote>
<p>Both use-cases are important to us. See <code>requirements/build.txt</code> vs <code>requirements/optional.txt</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/webknjaz">@webknjaz</a> on 2024-02-27 15:15</div>
            <div class="timeline-body"><p>@stefanv ah, I didn&#x27;t realize that you maintain the entries in two places in sync.</p>
<p>FWIW I recommended to document that this is explicitly out of the scope in PEP 735.</p>
<p>I also noted that extending the build deps with the dependency group entries is something the build backends should eventually be able to implement eventually, making it a backend problem rather than frontend: https://discuss.python.org/t/pep-735-dependency-groups-in-pyproject-toml/39233/241. With that, you&#x27;d be able to keep the entries in dependency groups as the canonical location, not having to duplicate them in the build system section.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-06 17:50</div>
            <div class="timeline-body"><p>@stefanv -- How much of this is covered by the fact that we support <code>pip install -r pyproject.toml</code> and <code>pip compile pyproject.toml</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stefanv">@stefanv</a> on 2024-06-10 00:05</div>
            <div class="timeline-body"><blockquote>
<p>@stefanv -- How much of this is covered by the fact that we support <code>pip install -r pyproject.toml</code> and <code>pip compile pyproject.toml</code>?</p>
</blockquote>
<p>Hi @charliermarsh, thanks for pointing out that feature (BTW, I notice that the <code>--help</code> does not indicate that <code>pyproject.toml</code> is an acceptable file). That&#x27;s useful for getting the environment ready for running a package in, but not for <em>building</em> the package. For that, we need to be able to install its build dependencies. Similarly, one may want to define the set of dependencies for building docs, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-10 00:32</div>
            <div class="timeline-body"><p>Sorry, yes, I forgot that this issue was about <em>build</em> dependencies. I came here after reading the <code>--only-deps</code> issue in pip which seemed like it would be partially solved by <code>uv pip install -r pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kasvtv">@kasvtv</a> on 2024-11-07 00:16</div>
            <div class="timeline-body"><p>We are also very much missing this feature. For example, wanting to run <code>ruff</code> in CI while respecting the version defined in any of <code>pyproject.toml</code>&#x27;s dependencies. Creating a separate dependency group with just ruff in there does not seem to suffice, because the group of dependencies cannot be installed without the default dependencies.</p>
<p>It would be great if the <code>--no-group</code> option would allow for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 00:21</div>
            <div class="timeline-body"><blockquote>
<p>...because the group of dependencies cannot be installed without the default dependencies.</p>
</blockquote>
<p>Are you looking for <code>--only-group</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/goodseog">@goodseog</a> on 2025-03-24 07:03</div>
            <div class="timeline-body"><p>How about using <code>uv lock</code>?</p>
<p>I found that running <code>uv sync</code> with a generated <code>uv.lock</code> file installs only the dependencies and completes the build without the <code>src</code> folder.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:29:32 UTC
    </footer>
</body>
</html>
