<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv self update` fails in MSYS2 environment - astral-sh/uv #12686</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv self update` fails in MSYS2 environment</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12686">#12686</a>
        opened by <a href="https://github.com/wilson">@wilson</a>
        on 2025-04-05 17:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/wilson">@wilson</a> on 2025-04-05 17:32</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I installed uv using the standalone installation script.
This is Windows 10, MSYS2. <code>uv 0.6.12 (e4e03833f 2025-04-02)</code></p>
<p>When running <code>uv self update</code>, I get:
<code>warning: Self-update is only available for uv binaries installed via the standalone installation scripts.</code></p>
<pre><code>% command -v uv
/c/Users/Wilson/.local/bin/uv
</code></pre>
<p>This is maybe a bug related to my strange platform? The standalone installer script has direct MSYS2 support, and that code looked correct to me, so I'm not sure where the exact root is.</p>
<h3>Platform</h3>
<p>Windows 10: MINGW64_NT-10.0-19045 3.6.0-529a0f09.x86_64 x86_64 Msys</p>
<h3>Version</h3>
<p>uv 0.6.12 (e4e03833f 2025-04-02)</p>
<h3>Python version</h3>
<p>Python 3.13.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @wilson on 2025-04-05 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eegli">@eegli</a> on 2025-05-29 14:16</div>
            <div class="timeline-body"><p>As mentioned in the linked issue above, <a href="https://github.com/axodotdev/axoupdater">axoupdater</a> always tries to load the receipt from <code>%LOCALAPPDATA%/uv/uv-receipt.json</code> on Windows: https://github.com/astral-sh/uv/blob/72e2821d26d52f97268d318c5c70de6b336c291f/crates/uv/src/commands/self_update.rs#L47</p>
<p>The installation script <a href="https://astral.sh/uv/install.sh">https://astral.sh/uv/install.sh</a> works for POSIX-compliant environments, including MSIS2 and even Git bash as a minimal subset of MSYS2. However, when running the installer scripts on Windows:</p>
<ul>
<li>Bash (https://astral.sh/uv/install.sh) dumps the receipt in <code>~/.config/uv/</code></li>
<li>Powershell (https://astral.sh/uv/install.ps1) dumps the receipt in <code>%LOCALAPPDATA%/uv/uv-receipt.json</code></li>
</ul>
<p>Hence, installing via Powershell works as expected, via bash the receipt is in the &quot;wrong&quot; place.</p>
<p>So can we simply move the receipt after installing via bash to where axoupdater expects it?</p>
<pre><code class="language-sh">mkdir -p $LOCALAPPDATA/uv &amp;&amp; mv ~/.config/uv/uv-receipt.json $LOCALAPPDATA/uv/uv-receipt.json
</code></pre>
<p>Running <code>uv self update</code> now complains with:</p>
<blockquote>
<p>The current executable is at <code>C:\Users\xxx\.local\bin\uv.exe</code> but the standalone installer was used to install uv to <code>/c/Users/xxx/.local/bin</code>. Are multiple copies of uv installed?</p>
</blockquote>
<p>Very interestingly, the receipts are equivalent except for the <code>install_prefix</code> value:</p>
<ul>
<li>Powershell: <code>&quot;install_prefix&quot;: &quot;C:\\Users\\xxx\\.local\\bin&quot;,</code></li>
<li>Bash: <code>&quot;install_prefix&quot;: &quot;/c/Users/xxx/.local/bin&quot;,</code></li>
</ul>
<p>Which happens due to to path conversion. Setting the path in the receipt to a valid Windows path eventually works.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv self update` prints warning in MSYS2 environment" to "`uv self update` fails in MSYS2 environment" by @zanieb on 2025-05-29 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-29 14:23</div>
            <div class="timeline-body"><p>Thanks for the details!</p>
<p>cc @Gankra</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eegli">@eegli</a> on 2025-05-29 14:29</div>
            <div class="timeline-body"><p>Enabling supporting POSIX-compliant environments is not a well-defined task. After all, should MSYS2 be considered POSIX just because it has some of the utilities?</p>
<p>I generally agree with uv's opinion about <a href="https://docs.astral.sh/uv/configuration/files/">configuration files</a> - Windows is Windows, regardless of any software-defined compatibility layer on top of it, and any user/system level configuration should be read from <code>%APPDATA%</code> and <code>%SYSTEMDRIVE%</code>  respectively.</p>
<p>W.r.t to the installation itself, a straightforward way to support MSYS2/Git bash for <code>uv self update</code> would be to adjust the bash installer script to <a href="https://stackoverflow.com/questions/65527286/how-to-check-if-my-program-is-running-on-mingwor-msys-shell-or-on-cmd">check the presence of MSYS</a> and, if true:</p>
<ol>
<li>Move the receipt to <code>%LOCALAPPDATA%</code>,</li>
<li>Perform path conversion for <code>install_prefix</code></li>
</ol>
<p>This shouldn't break any existing settings and does not require adjusting the receipt lookup at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-05-29 14:35</div>
            <div class="timeline-body"><p>Wow incredible writeup!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gankra">@Gankra</a> on 2025-05-29 15:59</div>
            <div class="timeline-body"><p>I believe this change could be made to the installer script yes:</p>
<p>https://github.com/axodotdev/cargo-dist/blob/c8ba950c63f9c38c77782912ec6cdb6807bd0fbd/cargo-dist/templates/installer/installer.sh.j2#L53</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eegli">@eegli</a> on 2025-05-29 16:30</div>
            <div class="timeline-body"><p>Just realized that the installer script is autogenerated from <code>cargo-dist</code>. Should I raise it in the upstream repo?</p>
<blockquote>
<p>I believe this change could be made to the installer script yes:</p>
<p>https://github.com/axodotdev/cargo-dist/blob/c8ba950c63f9c38c77782912ec6cdb6807bd0fbd/cargo-dist/templates/installer/installer.sh.j2#L53</p>
</blockquote>
<p>Yes, <code>RECEIPT_HOME</code> needs to be adjusted. Furthermore, <code>AXO_INSTALL_PREFIX</code> in</p>
<p>https://github.com/axodotdev/cargo-dist/blob/c8ba950c63f9c38c77782912ec6cdb6807bd0fbd/cargo-dist/templates/installer/installer.sh.j2#L577</p>
<p>needs to evaluate to a Windows path with escaped backslashes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-29 17:09</div>
            <div class="timeline-body"><p>We're working off a fork of cargo-dist for now (the upstream is no longer maintained): https://github.com/astral-sh/cargo-dist</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/axel-kah">@axel-kah</a> on 2025-10-02 14:46</div>
            <div class="timeline-body"><p>I always wondered why the update failed in my GitBash. I followed @eegli 's instructions and now I can update again üëç</p>
<p>Would be great if this makes it into your cargo-dist fork.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eegli">@eegli</a> on 2025-11-01 08:59</div>
            <div class="timeline-body"><p>@zanieb @Gankra since this has been open for a while, would you mind if I claim this issue and open a PR in <a href="https://github.com/astral-sh/cargo-dist">the cargo-dist fork</a>?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:17:32 UTC
    </footer>
</body>
</html>
