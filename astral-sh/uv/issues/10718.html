<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv using default pypi when pytorch nightly index is specified - astral-sh/uv #10718</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv using default pypi when pytorch nightly index is specified</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10718">#10718</a>
        opened by <a href="https://github.com/rbavery">@rbavery</a>
        on 2025-01-17 17:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rbavery">@rbavery</a></div>
            <div class="timeline-body"><p>I have the following toml where torch has a lower bound and is pinned to use the nightly index. From this previous issue, this index gets used if I don&#x27;t specify a lower bound: <a href="https://github.com/astral-sh/uv/issues/10702">astral-sh/uv#10702</a>#issue-2794300371</p>
<pre><code>[project]
authors = [
    {name = &quot;Ryan Avery&quot;, email = &quot;ryan@wherobots.com&quot;},
]
license = {text = &quot;nos&quot;}
requires-python = &quot;&lt;4.0,&gt;=3.10&quot;
dependencies = [
    &quot;httpx&lt;1.0.0,&gt;=0.26.0&quot;,
    &quot;shapely&lt;3.0.0,&gt;=2.0.2&quot;,
    &quot;geopandas&lt;1.0.0,&gt;=0.14.2&quot;,
    &quot;pystac-client&lt;1.0.0,&gt;=0.7.5&quot;,
    &quot;pystac&lt;2.0.0,&gt;=1.9.0&quot;,
    &quot;stac-model&lt;1.0,&gt;=0.2&quot;,
    &quot;tqdm&lt;5.0.0,&gt;=4.66.1&quot;,
    &quot;typer[all]&lt;1.0.0,&gt;=0.9.0&quot;,
    &quot;rich&lt;14.0.0,&gt;=13.7.0&quot;,
    &quot;boto3&lt;2.0.0,&gt;=1.34.134&quot;,
    &quot;huggingface_hub&quot;
]
name = &quot;wbc-model&quot;
version = &quot;0.1.0&quot;
description = &quot;Recipes for creating model metadata hosted for WBC users.&quot;
readme = &quot;README.md&quot;
keywords = []
classifiers = [
    &quot;Development Status :: 3 - Alpha&quot;,
    &quot;Intended Audience :: Developers&quot;,
    &quot;Operating System :: OS Independent&quot;,
    &quot;Topic :: Software Development :: Libraries :: Python Modules&quot;,
    &quot;License :: Other/Proprietary License&quot;,
    &quot;Programming Language :: Python :: 3&quot;,
    &quot;Programming Language :: Python :: 3.10&quot;,
    &quot;Programming Language :: Python :: 3.11&quot;,
    &quot;Private :: Do Not Upload&quot;,
]

[build-system]
requires = [&quot;pdm-backend&quot;]
build-backend = &quot;pdm.backend&quot;

# Keywords description https://python-poetry.org/docs/pyproject/#keywords
keywords = []  # UPDATEME with relevant keywords

# Pypi classifiers: https://pypi.org/classifiers/
classifiers = [  # UPDATEME with additional classifiers; remove last classifier to allow publishing on PyPI
  &quot;Development Status :: 3 - Alpha&quot;,
  &quot;Intended Audience :: Developers&quot;,
  &quot;Operating System :: OS Independent&quot;,
  &quot;Topic :: Software Development :: Libraries :: Python Modules&quot;,
  &quot;License :: Other/Proprietary License&quot;,
  &quot;Programming Language :: Python :: 3&quot;,
  &quot;Programming Language :: Python :: 3.10&quot;,
  &quot;Programming Language :: Python :: 3.11&quot;,
  &quot;Private :: Do Not Upload&quot;
]

[tool.uv]
dev-dependencies = [
    &quot;mypy&lt;2.0.0,&gt;=1.0.0&quot;,
    &quot;mypy-extensions&lt;1.0.0,&gt;=0.4.3&quot;,
    &quot;pre-commit&lt;3.0.0,&gt;=2.21.0&quot;,
    &quot;bandit&lt;2.0.0,&gt;=1.7.5&quot;,
    &quot;safety&lt;3.0.0,&gt;=2.3.4&quot;,
    &quot;jupyterlab&lt;5.0.0,&gt;=4.0.10&quot;,
    &quot;flake8&lt;6.0.0,&gt;=5.0.4&quot;,
    &quot;pydocstyle[toml]&lt;7.0.0,&gt;=6.2.0&quot;,
    &quot;pydoclint&lt;1.0.0,&gt;=0.3.0&quot;,
    &quot;pytest&lt;8.0.0,&gt;=7.2.1&quot;,
    &quot;pytest-html&lt;4.0.0,&gt;=3.2.0&quot;,
    &quot;pytest-cov&lt;5.0.0,&gt;=4.1.0&quot;,
    &quot;pytest-mock&lt;4.0.0,&gt;=3.10.0&quot;,
    &quot;pytest-timeout&lt;3.0.0,&gt;=2.2.0&quot;,
    &quot;pytest-benchmark&lt;5.0.0,&gt;=4.0.0&quot;,
    &quot;pytest-sugar&lt;1.0.0,&gt;=0.9.7&quot;,
    &quot;pytest-click&lt;2.0.0,&gt;=1.1.0&quot;,
    &quot;pytest-pikachu&lt;2.0.0,&gt;=1.0.0&quot;,
    &quot;coverage&lt;8.0.0,&gt;=7.3.0&quot;,
    &quot;ruff&lt;1.0.0,&gt;=0.1.7&quot;,
    &quot;hypothesis&gt;=6.122.3&quot;,
    &quot;expecttest&quot;,
]

[dependency-groups]
#if any of these start to conflict: https://docs.astral.sh/uv/concepts/projects/config/#conflicting-dependencies
satlas-solar = [
    &quot;satlas-solar==0.1.0&quot;
]
eurosat = [
    &quot;torchgeo&lt;1.0.0,&gt;=0.6.0&quot;,
    &quot;lightning&lt;3.0.0,&gt;=2.1.3&quot;,
]
torchgpu = [
  &quot;torch&gt;=2.6&quot;,
  &quot;torchvision&quot;,
  &quot;pytorch-triton&quot;,
]

# uv pays attention to index order, this is prioritized
[[tool.uv.index]]
name = &quot;pytorch-nightly-gpu&quot;
url = &quot;https://download.pytorch.org/whl/nightly/cu124&quot;
explicit = true

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-nightly-gpu&quot;, marker = &quot;platform_system != &#x27;Darwin&#x27;&quot;}, # Add nightly source
]
torchvision = [
  { index = &quot;pytorch-nightly-gpu&quot;, marker = &quot;platform_system != &#x27;Darwin&#x27;&quot;}, # Add nightly source
]
pytorch-triton = [
    {index = &quot;pytorch-nightly-gpu&quot;, marker = &quot;platform_system != &#x27;Darwin&#x27;&quot;},
]
satlas-solar = { path = &quot;model-forge/satlas/solar/&quot; }

[tool.pdm.build]
includes = [
    &quot;wbc_model&quot;,
]
</code></pre>
<p>I set the lower bound to <code>torch&gt;=2.6</code> since nightlies for 2.7 are out. but I get a weird error that seems to be using the wrong index even though I specified in my toml</p>
<pre><code>[[tool.uv.index]]
name = &quot;pytorch-nightly-gpu&quot;
url = &quot;https://download.pytorch.org/whl/nightly/cu124&quot;
explicit = true
</code></pre>
<pre><code>→ uv sync --upgrade --group torchgpu --group satlas-solar
⠙ Resolving dependencies...                                                     warning: Missing version constraint (e.g., a lower bound) for `expecttest`
warning: Missing version constraint (e.g., a lower bound) for `torchvision`
warning: Missing version constraint (e.g., a lower bound) for `pytorch-triton`
warning: Missing version constraint (e.g., a lower bound) for `huggingface-hub`
  × No solution found when resolving dependencies for split (sys_platform
  │ == &#x27;darwin&#x27;):
  ╰─▶ Because only torch{sys_platform == &#x27;darwin&#x27;}&lt;=2.5.1 is available and
      wbc-model:torchgpu depends on torch{sys_platform == &#x27;darwin&#x27;}&gt;=2.6, we
      can conclude that wbc-model:torchgpu&#x27;s requirements are unsatisfiable.
      And because your project requires wbc-model:torchgpu, we can conclude
      that your project&#x27;s requirements are unsatisfiable.
</code></pre>
<p>It seems like uv is only looking at default pypi to say that only torch&lt;=2.5.1 is available. But on the nightly index, versions above 2.6 should be available, as seen <a href="https://github.com/astral-sh/uv/issues/10702#issue-2794300371">here </a> where I&#x27;m downloading torch 2.7 nightlies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 18:28</div>
            <div class="timeline-body"><p>Can you please share a minimal example? It looks like there&#x27;s a lot of extraneous content in that <code>pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-17 18:58</div>
            <div class="timeline-body"><p>You have <code>torch&gt;=2.6</code> in <code>torchgpu</code>. But on Darwin, it has to resolve that using PyPI-only, since your index is marked as &quot;only use this index on non-Darwin&quot;. And that version doesn&#x27;t exist on PyPI. So you either need to change the constraint, make that dependency inapplicable on Darwin, or use the torch index for all platforms.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rbavery">@rbavery</a> on 2025-01-17 19:12</div>
            <div class="timeline-body"><p>Ok thanks, removing the platform requirement for the torch index fixed this. I was running this on Ubuntu (non-Darwin right?) so I would expect the solver to not look to PyPI and to use the index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-17 19:20</div>
            <div class="timeline-body"><p>The solver is platform independent https://docs.astral.sh/uv/concepts/resolution/#universal-resolution</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rbavery">@rbavery</a> on 2025-01-17 19:21</div>
            <div class="timeline-body"><p>I see, thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/rbavery">@rbavery</a> on 2025-01-17 19:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:46 UTC
    </footer>
</body>
</html>
