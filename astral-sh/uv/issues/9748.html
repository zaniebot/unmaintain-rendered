<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot export to requirements.txt with conflicting extras even if unused. - astral-sh/uv #9748</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cannot export to requirements.txt with conflicting extras even if unused.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9748">#9748</a>
        opened by <a href="https://github.com/lengau">@lengau</a>
        on 2024-12-09 19:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lengau">@lengau</a></div>
            <div class="timeline-body"><p>When exporting to a requirements.txt file, the export fails if conflicting extras exist in pyproject.toml, even if they aren&#x27;t used.</p>
<p>An example <code>pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;uv-example&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.11&quot;
dependencies = [&quot;distro&quot;]

[project.optional-dependencies]
a = [
    &quot;numpy&lt;1.20&quot;,
]
b = [
    &quot;numpy&gt;1.20&quot;,
]

[tool.uv]
conflicts = [
    [
        { extra = &quot;a&quot; },
        { extra = &quot;b&quot; },
    ]
]
</code></pre>
Expected behaviour:
<pre><code>lengau@ratel:~/tmp/uv-example$ uv export --no-hashes
Using CPython 3.11.10
Resolved 3 packages in 0.45ms
# This file was autogenerated by uv via the following command:
#    uv export --no-hashes
distro==1.9.0
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a
Using CPython 3.11.10
Resolved 3 packages in 417ms
# This file was autogenerated by uv via the following command:
#    uv export --no-hashes --extra a
distro==1.9.0
numpy==1.19.5
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra b
Using CPython 3.11.10
Resolved 3 packages in 388ms
# This file was autogenerated by uv via the following command:
#    uv export --no-hashes --extra b
distro==1.9.0
numpy==2.2.0
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a --extra b
Using CPython 3.11.10
Resolved 4 packages in 362ms
error: Extras `a` and `b` are incompatible with the declared conflicts: {`uv-example[a]`, `uv-example[b]`}
</code></pre>
Actual behaviour:
<pre><code>lengau@ratel:~/tmp/uv-example$ uv export --no-hashes
Using CPython 3.11.10
Resolved 4 packages in 0.50ms
error: Cannot represent `uv.lock` with conflicting extras or groups as `requirements.txt`
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a
Using CPython 3.11.10
Resolved 4 packages in 0.48ms
error: Cannot represent `uv.lock` with conflicting extras or groups as `requirements.txt`
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra b
Using CPython 3.11.10
Resolved 4 packages in 0.48ms
error: Cannot represent `uv.lock` with conflicting extras or groups as `requirements.txt`
lengau@ratel:~/tmp/uv-example$ uv export --no-hashes --extra a --extra b
Using CPython 3.11.10
Resolved 4 packages in 0.50ms
error: Extras `a` and `b` are incompatible with the declared conflicts: {`uv-example[a]`, `uv-example[b]`}
</code></pre>
<p>Only the last one (where both extras are declared) appears correct to me. In the other cases, because only (0,1) of the incompatible extras is being used, the export should succeed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-09 19:46</div>
            <div class="timeline-body"><p>Ah yeah. We can loosen this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-09 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-09 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-09 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-09 22:21</div>
            <div class="timeline-body"><p>Closed by <a href="https://github.com/astral-sh/uv/pull/9751">astral-sh/uv#9751</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-09 22:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:36:03 UTC
    </footer>
</body>
</html>
