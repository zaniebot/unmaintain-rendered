<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support a &quot;flat&quot; package layout in `uv init` - astral-sh/uv #5328</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support a &quot;flat&quot; package layout in <code>uv init</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5328">#5328</a>
        opened by <a href="https://github.com/mgaitan">@mgaitan</a>
        on 2024-07-23 03:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mgaitan">@mgaitan</a> on 2024-07-23 03:38</div>
            <div class="timeline-body"><p><code>uv init mypackage</code> currently generates a &quot;src&quot; layout:</p>
<pre><code>.
├── pyproject.toml
├── README.md
└── src
    └── mypackage
        └── __init__.py
</code></pre>
<p>That's okay as the default because this layout has some <a href="https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/#src-layout-vs-flat-layout">known</a> <a href="https://hynek.me/articles/testing-packaging/">advantages</a>.</p>
<p>However, it isn't a widely used convention, especially for simple, pure Python packages.</p>
<p>So I propose to allow creating a flat layout with <code>uv init --flat</code>:</p>
<pre><code>.
├── pyproject.toml
├── README.md
└── mypackage
    └── __init__.py
</code></pre>
<p>Paraphrasing <a href="https://docs.python-guide.org/writing/style/#we-are-all-responsible-users">The Hitchhiker's Guide to Python</a>:</p>
<blockquote>
<p>Python allows many tricks, and some of them are potentially dangerous. [Python's] philosophy, very different from highly defensive languages like Java, which provide many mechanisms to prevent misuse, is expressed by the saying: “We are all responsible users.”</p>
</blockquote>
<p>and (abusing) the <a href="https://peps.python.org/pep-0020/">Zen of Python</a>:</p>
<blockquote>
<p>Flat is better than nested.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-23 15:34</div>
            <div class="timeline-body"><p>Thanks for the writeup!</p>
<p>I'm pretty hesitant, honestly. This results in confusing behavior for users due to the module search path including the package by default. I think we may be better off taking an opinionated stance here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2024-08-22 07:14</div>
            <div class="timeline-body"><p>The lack of flat layout support makes migrating large monorepos (https://github.com/dagster-io/dagster) with dozens of packages much harder.</p>
<p>I agree with your point about the potential confusion with automatic package discovery when using the flat layourt, but there are already thousands of Python projects using it.</p>
<p>I think <code>uv</code> should prefer the <code>src</code> layout and use it by default, but at the same time adding support for flat layout seems reasonable to me. The opposite decision will slow down <code>uv</code> adoption.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-22 14:18</div>
            <div class="timeline-body"><p>@danielgafni Sorry if I'm missing something here, but we just don't create a flat layout in <code>uv init</code> — as far as I know, uv itself should fully support flat layouts otherwise?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2024-08-22 14:26</div>
            <div class="timeline-body"><p>Hey, I first tried using the flat layout and got import errors for our packages.</p>
<p>For example, with the <a href="https://github.com/dagster-io/dagster/blob/uv-migration/python_modules/dagster-pipes/pyproject.toml">following</a> <code>pyproject.toml</code>, running</p>
<pre><code class="language-shell">uv pip install -e python_modules/dagster-pipes
</code></pre>
<p>passes with both flat and src layout, but only the src layout makes the package available for importing. I'm not sure what can cause this behavior. Moving <code>dagster_pipes</code> to <code>/src</code> and re-running <code>uv pip install</code> solves the problem, that's why I assumed flat layout wasn't supported.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danielgafni">@danielgafni</a> on 2024-08-22 15:18</div>
            <div class="timeline-body"><p>Actually, I can't reproduce this issue anymore :open_mouth:
Everything seems to be working, probably something was wrong on my side, sorry about that!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mgaitan">@mgaitan</a> on 2024-08-30 17:31</div>
            <div class="timeline-body"><p>@zanieb I guess my original request have been implemented via <code>uv init --app</code>  right? . We could close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-30 17:34</div>
            <div class="timeline-body"><p>Correct! Thanks @mgaitan.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-30 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @zanieb by @charliermarsh on 2024-08-30 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-08-30 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Winand">@Winand</a> on 2024-12-26 15:36</div>
            <div class="timeline-body"><p>When we use <code>--lib</code> uv creates a folder <code>src/&lt;NAME&gt;</code> and adds hatchling build system.</p>
<p>In hatchling docs i read that by default <a href="https://hatch.pypa.io/latest/plugins/builder/wheel/#default-file-selection">it searches for a package</a> in <code>&lt;NAME&gt;</code>, <code>src/&lt;NAME&gt;</code>, <code>&lt;NAME&gt;.py</code> and <code>&lt;NAMESPACE&gt;/&lt;NAME&gt;</code>.</p>
<p>So do I understand correctly that i can place my package in project's root dir? So the &quot;flat&quot; layout is already supported, right?</p>
<hr />
<p>Update: also an example for <a href="https://docs.astral.sh/uv/concepts/projects/init/#packaged-applications">Packaged applications</a> won't work as described in docs, because <code>src/example_packaged_app</code> differs from project name &quot;example-pkg&quot; so <em>hatchling</em> won't find that package.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:36 UTC
    </footer>
</body>
</html>
