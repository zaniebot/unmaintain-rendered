<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advice on sharing user's uv cache between non-docker and docker - astral-sh/uv #17049</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Advice on sharing user's uv cache between non-docker and docker</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/17049">#17049</a>
        opened by <a href="https://github.com/rzuckerm">@rzuckerm</a>
        on 2025-12-09 17:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rzuckerm">@rzuckerm</a> on 2025-12-09 17:16</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Our current poetry-based system supports both non-docker and docker mode. In non-docker mode, poetry commands and other tools run on the host system, and the user's poetry cache is used. In docker mode, a per-project directory holds the user's poetry cache, and poetry commands and other tools run in a docker container. The docker container could be running a vastly different Linux distros than the host system.</p>
<p>I am trying to convert our poetry-based system to uv, and I would like some advice on whether the user's uv cache can be safely mounted in the docker container, or do I need to continue using the per-project directory to hold the uv cache? I'm concerned about how big the uv cache gets, and if I have to do per-project, then that could add a significant amount of space requirements for our users.</p>
<h3>Platform</h3>
<p>Ubuntu 24.04 amd64</p>
<h3>Version</h3>
<p>0.9.16</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @rzuckerm on 2025-12-09 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-11 10:34</div>
            <div class="timeline-body"><p>A problem can be permissions, if docker runs with root, or as a different UID/GID as the local user, and the local session runs as non-root with their specific UID/GID, sharing the cache could lead to one that the other one can't read. Different linux distros shouldn't be a problem, the cache is keyed by wheel tag.</p>
<p>If the having two caches isn't a critical space issue, I'd start with the cache mount guide at https://docs.astral.sh/uv/guides/integration/docker/#caching.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rzuckerm">@rzuckerm</a> on 2025-12-11 12:55</div>
            <div class="timeline-body"><p>@konstin Thanks for the information. We run our docker containers as the current user, so permissions and UID/GID should not be an issue.</p>
<p>With regard to the docker caching user guide, we're not building docker images. Instead, we use pre-built docker images for the base functionality that most projects need (or the project provides it's own pre-built docker image when additional functionality is needed). Then, our build system runs the appropriate command in a docker container like this:</p>
<pre><code>docker run &lt;interactive and terminal options as appropriate&gt; --rm \
  -u &lt;UID&gt;:&lt;GID&gt; &lt;all user groups&gt; \
  -v /etc/passwd:/etc/passwd:ro -v /etc/group:/etc/group:ro -v &lt;pwd&gt;:/local &lt;other volume mounts&gt; \
  -w /local \
  &lt;environment variables&gt; \
  &lt;docker image&gt;:&lt;tag&gt; \
  &lt;command&gt; &lt;args&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-11 16:53</div>
            <div class="timeline-body"><p>If the permissions match, you can mount the uv cache into the container to share it.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
