<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow sync to install to system python - astral-sh/uv #7748</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow sync to install to system python</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7748">#7748</a>
        opened by <a href="https://github.com/nhumrich">@nhumrich</a>
        on 2024-09-27 23:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nhumrich">@nhumrich</a> on 2024-09-27 23:29</div>
            <div class="timeline-body"><p>In docker environments, it's quite common to install all python packages to the system. Virtual environments are not needed because the current project is the only thing installed.</p>
<p>The docker documentation for UV recommends that you use the venv entrypoint for all container commands:</p>
<pre><code>CMD [&quot;/app/.venv/bin/python&quot;]
</code></pre>
<p>However, this makes migrating to UV a bit harder when so many things already reference &quot;python&quot; directly in.</p>
<p>Also, using a virtual environment in these situations complicates the container, because devs now have to remember to use the .venv python always.</p>
<p>Would it be possible to install into the system during <code>uv sync</code> somehow. I assumed <code>--python-preference only-system</code> would do this, but that doesn't seem to prevent the creating of a virtual environment. <code>uv pip install</code> support <code>--system</code>, so its sort of strange that <code>sync</code> does not.</p>
<p>My current workaround is doing this in the dockerfile instead:</p>
<pre><code>RUN --mount=from=ghcr.io/astral-sh/uv,source=/uv,target=/bin/uv \
    uv pip compile pyproject.toml -o requirements.txt &amp;&amp; \
    uv pip install -r requirements.txt --system
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-28 03:52</div>
            <div class="timeline-body"><p>See <a href="https://docs.astral.sh/uv/concepts/projects/#configuring-the-project-environment-path"><code>UV_PROJECT_ENVIRONMENT</code></a> and #6834</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-09-28 03:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-09-28 03:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-10-21 22:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nhumrich">@nhumrich</a> on 2024-10-22 15:31</div>
            <div class="timeline-body"><p>@zanieb maybe I am misunderstanding, but it appears as if UV_PROJECT_ENVIRONMENT wants the location of a virtualenv.</p>
<p>The intent is not to tell UV to use an existing virtual environment, but to use the system directly.</p>
<p>The docs also say:</p>
<blockquote>
<p>uv sync will remove extraneous packages from the environment by default and, as such, may leave the system in a broken state.</p>
</blockquote>
<p>This is not wanted. I would conclude that this feature request does not appear to be the same as the UV_PROJECT_ENVIRONMENT feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-22 15:49</div>
            <div class="timeline-body"><blockquote>
<p>uv sync will remove extraneous packages from the environment by default and, as such, may leave the system in a broken state.</p>
</blockquote>
<p>You can use <code>--inexact</code> then, but it still might change package versions if it needs to â€” which is the problem with using a system environment generally. Why are you using <code>uv sync</code> to a system environment if you don't have control over the environment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nhumrich">@nhumrich</a> on 2024-10-26 23:21</div>
            <div class="timeline-body"><p>@zanieb I do have control over the environment. Its a docker container.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-27 00:41</div>
            <div class="timeline-body"><p>Then why are you worried about packages being removed? Sorry, I must be missing something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eric-gitta-moore">@eric-gitta-moore</a> on 2025-04-26 03:33</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/zanieb">@zanieb</a> I do have control over the environment. Its a docker container.</p>
</blockquote>
<p>Same here.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
