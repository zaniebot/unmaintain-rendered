<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Python versions with trailing `+` - astral-sh/uv #1357</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support Python versions with trailing `+`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1357">#1357</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-02-15 21:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-15 21:30</div>
            <div class="timeline-body"><p>It was reported that a locally-built Python with <code>3.11.4+</code> errors out in our version parser:</p>
<p>https://gist.github.com/jsbueno/be1797cfe654c69245ddbea78e0360ff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-15 21:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-15 21:44</div>
            <div class="timeline-body"><p>The <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#local-version-identifiers">Local Version Identifiers section of the Version Specifiers spec</a> seems to suggest that a local label needs to be non-empty, but it doesn't seem to come out and say it explicitly. With that said, the <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#appendix-parsing-version-strings-with-regular-expressions">regex for parsing version numbers</a> does unambiguously require a non-empty local version segment if a <code>+</code> is present.</p>
<p>So at least with respect to the spec, it seems like the version number here is invalid. Is there any particular reason why <code>3.11.4+</code> is being used? If it's just a mistake, then perhaps that should be fixed instead.</p>
<p>But if this is a widespread or common practice, then perhaps there isn't too much harm in making our version parser slightly more flexible. I think the point here though would be to decide what the semantics of <code>3.11.4+</code> are. Is the version identical to <code>3.11.4</code>? And in particular, if someone gave us a <code>3.11.4+</code> version and we spit <code>3.11.4</code> back out at some point, would that be an issue? The question might seem strange, but it's the difference between a &quot;version without a local segment&quot; and a &quot;version with an empty local segment.&quot; (The current representation of a <code>Version</code> doesn't distinguish between those cases.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1402.html">astral-sh/uv#1402</a> on 2024-02-16 00:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-02-16 01:10</div>
            <div class="timeline-body"><p>I think the Python version isn't governed by PEP 440.</p>
<p>3.11.4+ is if you build off of random CPython commit. I think it comes from e.g. https://github.com/python/cpython/blob/c08c0679055d96c0397cf128bf7cc8134538b36a/Include/patchlevel.h#L26</p>
<p>Should be fine to treat it as 3.11.4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 01:14</div>
            <div class="timeline-body"><p>They seem semantically different; I would treat <code>3.11.4+</code> as fulfilling versions that are not pinned. It's rare that we request e.g.  <code>==3.11</code> or <code>==3.11.4</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 01:33</div>
            <div class="timeline-body"><p>What's the issue with treating this as equivalent to parsing <code>3.11.4</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> on 2024-02-16 01:43</div>
            <div class="timeline-body"><p>I second @hauntsaninja. The <code>+</code> is usually added to Python builds that are built off the <code>main</code> branch rather than a tag:</p>
<pre><code>&gt;&gt;&gt; import pprint
&gt;&gt;&gt; from packaging.markers import default_environment
&gt;&gt;&gt; pprint.pprint(default_environment())
{'implementation_name': 'cpython',
 'implementation_version': '3.13.0a3',
 'os_name': 'posix',
 'platform_machine': 'arm64',
 'platform_python_implementation': 'CPython',
 'platform_release': '23.4.0',
 'platform_system': 'Darwin',
 'platform_version': 'Darwin Kernel Version 23.4.0: Wed Feb  7 23:21:07 PST '
                     '2024; root:xnu-10063.100.637.501.2~2/RELEASE_ARM64_T8112',
 'python_full_version': '3.13.0a3+',
 'python_version': '3.13',
 'sys_platform': 'darwin'}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 01:48</div>
            <div class="timeline-body"><p>Makes sense. I'd also be open to just stripping a trailing <code>+</code> for those fields specifically... @BurntSushi, what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 02:03</div>
            <div class="timeline-body"><p>They're different versions â€” the <code>+</code> has meaning. Similar to <code>1.0.0rc</code>being different from <code>1.0.0</code>. I don't think treating them as distinct versions would cause any problems for our usages of Python versions though. If we treat them as different you could e.g. require a local version by requesting <code>3.13.0+</code>, but if you request <code>3.13</code> it should work fine even if <code>3.13.0+</code> is what we find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1478.html">astral-sh/uv#1478</a> on 2024-02-16 11:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @BurntSushi on 2024-02-16 15:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-20 12:10</div>
            <div class="timeline-body"><p><code>python_full_version</code> needs to be a PEP 440 compliant version, otherwise environment markers break (<a href="https://peps.python.org/pep-0508/#environment-markers">PEP 508 environment marker comparisons</a>). Depending on your interpretation of PEP 508, we would fall back to stringly comparisons for <code>python_full_version</code> where '3.9.0' is lower than '3.11.4+'.</p>
<p>There's an upstream cpython bug: https://github.com/python/cpython/issues/99968</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python/cpython/issues/99968.html">python/cpython#99968</a> on 2024-02-20 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1771.html">astral-sh/uv#1771</a> on 2024-02-20 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-02-20 17:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:56 UTC
    </footer>
</body>
</html>
