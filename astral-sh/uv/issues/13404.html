<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>git+https://dependency information is lost when using uv build with hatchling - astral-sh/uv #13404</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>git+https://dependency information is lost when using uv build with hatchling</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13404">#13404</a>
        opened by <a href="https://github.com/soof-golan">@soof-golan</a>
        on 2025-05-12 10:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/soof-golan">@soof-golan</a> on 2025-05-12 10:28</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi!
For some reason I have not figured out yet, git+https dependency information is lost when consuming wheels or sdist assets produced by <code>uv build</code> (by default with hatchling as the build system)</p>
<h1>Reproduction</h1>
<pre><code class="language-bash">cd $(mktemp -d)
mkdir uv-build-repro &amp;&amp; cd uv-build-repro
uv init --lib
# Replace this with any git dependency that is not published to PyPI
uv add git+https://github.com/soof-golan/uv-build-git-repro-dep
uv build
export WHL_LOCATION=&quot;$(realpath dist/*.whl)&quot;

cd $(mktemp -d)
mkdir uv-build-whl-consumer &amp;&amp; cd uv-build-whl-consumer
uv init --lib
uv add &quot;$WHL_LOCATION&quot;
</code></pre>
<h2>Results</h2>
<pre><code class="language-plaintext">cd $(mktemp -d)
mkdir uv-build-repro &amp;&amp; cd uv-build-repro
uv init --lib
# Replace this with any git dependency that is not published to PyPI
uv add git+https://github.com/soof-golan/uv-build-git-repro-dep
uv build
export WHL_LOCATION=&quot;$(realpath dist/*.whl)&quot;

cd $(mktemp -d)
mkdir uv-build-whl-consumer &amp;&amp; cd uv-build-whl-consumer
uv init --lib
uv add &quot;$WHL_LOCATION&quot;
Initialized project `uv-build-repro`
Using CPython 3.10.17
Creating virtual environment at: .venv
Resolved 2 packages in 209ms
      Built uv-build-repro @ file:///private/var/folders/hg/00n7d3zd42df09kn6k68y0640000gn/T/tmp.uKO4OvlVg6/uv-build-repro
Prepared 1 package in 484ms
Installed 2 packages in 1ms
 + uv-build-git-repro-dep==0.1.0 (from git+https://github.com/soof-golan/uv-build-git-repro-dep@570790e3fdaf7f73709dd4ba772cf59bf42073cd)
 + uv-build-repro==0.1.0 (from file:///private/var/folders/hg/00n7d3zd42df09kn6k68y0640000gn/T/tmp.uKO4OvlVg6/uv-build-repro)
Building source distribution...
Building wheel from source distribution...
Successfully built dist/uv_build_repro-0.1.0.tar.gz
Successfully built dist/uv_build_repro-0.1.0-py3-none-any.whl
Initialized project `uv-build-whl-consumer`
Using CPython 3.10.17
Creating virtual environment at: .venv
  × No solution found when resolving dependencies:
  ╰─▶ Because uv-build-git-repro-dep was not found in the package registry and uv-build-repro==0.1.0 depends on uv-build-git-repro-dep, we can conclude that uv-build-repro==0.1.0 cannot be used.
      And because only uv-build-repro==0.1.0 is available and your project depends on uv-build-repro, we can conclude that your project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.
</code></pre>
<h3>Platform</h3>
<p>Darwin 24.3.0 arm64</p>
<h3>Version</h3>
<p>uv 0.7.3 (3c413f74b 2025-05-07)</p>
<h3>Python version</h3>
<p>Python 3.10.17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @soof-golan on 2025-05-12 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13405.html">astral-sh/uv#13405</a> on 2025-05-12 10:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "git+https://dependency information is lost when using `uv build` with hatchling" to "wheels built by uv with git+https dependencies wrongly installs a package from PyPI with the same name" by @soof-golan on 2025-05-12 11:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "wheels built by uv with git+https dependencies wrongly installs a package from PyPI with the same name" to "git+https://dependency information is lost when using uv build with hatchling" by @soof-golan on 2025-05-12 11:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-13 19:28</div>
            <div class="timeline-body"><p>Can you describe what the difference to #13405 is?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/soof-golan">@soof-golan</a> on 2025-05-14 06:38</div>
            <div class="timeline-body"><p>Thanks for the reply, both issues are similar</p>
<p>Since the git+http source is out-of-spec, I would assume calling <code>uv build</code> would behave in one of 2 ways here:</p>
<ol>
<li>Omit a dependency that has a direct source completely + produce some diagnostic that it has done so.</li>
<li>Produce an error that the project cannot be built as long as there are dependencies that have direct sources.</li>
</ol>
<p>In any way, a silent <em>partial omision</em> (keep the requirement, omit the source) here is surprising and produces wheels/sdists which are broken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-14 07:29</div>
            <div class="timeline-body"><p>This falls under the same reasons as https://github.com/astral-sh/uv/issues/13405#issuecomment-2872702820: https://docs.astral.sh/uv/concepts/projects/dependencies/#dependency-sources explains this behavior, and you can use <code>--raw-sources</code> if you want the git+ssh source in the <code>dependencies</code> table, notably producing a wheel that can't be published to PyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-05-14 07:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:06 UTC
    </footer>
</body>
</html>
