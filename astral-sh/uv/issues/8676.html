<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile --universal` outputs requirements with `python_version &lt; '0'` marker - astral-sh/uv #8676</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip compile --universal</code> outputs requirements with <code>python_version &lt; '0'</code> marker</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8676">#8676</a>
        opened by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a>
        on 2024-10-29 18:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-10-29 18:10</div>
            <div class="timeline-body"><p>uv 0.4.28</p>
<p>requirements.in:</p>
<pre><code>apache-airflow[microsoft.azure]==2.3.4
scikit-learn==1.2.2
ipython&gt;=8.4.0
mypy
black
</code></pre>
<p>constraints.txt:</p>
<pre><code>apache-airflow-providers-microsoft-azure==4.2.0
attrs==22.1.0
azure-identity==1.10.0
click==8.1.3
colorama==0.4.5
markdown-it-py==2.1.0
msal-extensions==1.0.0
msrestazure==0.6.4
numpy==1.22.4
packaging==21.3
portalocker==2.5.1
typing_extensions==4.3.0
</code></pre>
<p>Command:</p>
<pre><code>$ uv pip compile requirements.in -c constraints.txt  --annotation-style line --python 3.10 --universal | grep &quot;'0'&quot;
Resolved 190 packages in 740ms
apache-airflow-providers-ftp==3.11.1 ; python_version &lt; '0'  # via apache-airflow
apache-airflow-providers-http==4.13.1 ; python_version &lt; '0'  # via apache-airflow
apache-airflow-providers-imap==3.7.0 ; python_version &lt; '0'  # via apache-airflow
apache-airflow-providers-sqlite==3.9.0 ; python_version &lt; '0'  # via apache-airflow
azure-core==1.31.0 ; python_version &lt; '0'  # via azure-identity
azure-cosmos==4.7.0 ; python_version &lt; '0'  # via apache-airflow-providers-microsoft-azure
azure-keyvault-secrets==4.9.0 ; python_version &lt; '0'  # via apache-airflow-providers-microsoft-azure
azure-mgmt-resource==23.2.0 ; python_version &lt; '0'  # via apache-airflow-providers-microsoft-azure
azure-servicebus==7.12.3 ; python_version &lt; '0'  # via apache-airflow-providers-microsoft-azure
black==24.10.0 ; python_version &lt; '0'  # via -r requirements.in
cattrs==24.1.2 ; python_version &lt; '0'  # via apache-airflow
connexion==3.1.0 ; python_version &lt; '0'  # via apache-airflow
jsonschema==4.23.0 ; python_version &lt; '0'  # via apache-airflow, flask-appbuilder
mypy==1.13.0 ; python_version &lt; '0'  # via -r requirements.in
rich==13.9.3 ; python_version &lt; '0'  # via apache-airflow
scipy==1.14.1 ; python_version &lt; '0'  # via scikit-learn
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-10-29 18:18</div>
            <div class="timeline-body"><p>I'll take a closer look at this tomorrow. Do you have an expected result? Or just stumbled across the strange output?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @BurntSushi on 2024-10-29 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by @BurntSushi on 2024-10-29 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-10-29 18:20</div>
            <div class="timeline-body"><p>This is an MRE derived from a real requirements set. I think the output file still works, for every <code>python_version &lt; '0'</code> marker there is a requirement above it (on a different version) without a marker, e.g.</p>
<pre><code>rich==13.3.1              # via apache-airflow
rich==13.9.3 ; python_version &lt; '0'  # via apache-airflow
</code></pre>
<p>I would expect the lines with the <code>python_version &lt; '0' </code> to not be in the output, appears to be some internal resolver state?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-10-29 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> removed by @BurntSushi on 2024-11-01 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">lock</span> added by @BurntSushi on 2024-11-01 18:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-11-01 18:31</div>
            <div class="timeline-body"><p>@notatallshaw-gts Thanks for the excellent repro! This should be fixed by #8759.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-11-01 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-11-01 20:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:47 UTC
    </footer>
</body>
</html>
