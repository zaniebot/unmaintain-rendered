<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adding package dependency trace to `uv export` - astral-sh/uv #7777</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Adding package dependency trace to <code>uv export</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7777">#7777</a>
        opened by <a href="https://github.com/zmeir">@zmeir</a>
        on 2024-09-29 08:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zmeir">@zmeir</a></div>
            <div class="timeline-body"><p>I have a project I&#x27;m developing with <code>uv</code>. I use <code>uv lock</code> to lock my dependency versions for my app, and <code>uv sync --frozen</code> to install my development and test environments.</p>
<p>The framework I use to deploy my app uses a <code>requirements.txt</code> file to install the application&#x27;s dependencies.<br>
Previously I used <code>uv pip compile</code> to generate the <code>requirements.txt</code> file, but I figured since I already have the <code>uv.lock</code> file, I can save the extra resolution step and just use <code>uv export --frozen</code>. And it works perfectly!<br>
However, there is one small thing - the <code>uv pip compile</code> output is more verbose and adds comments under each package to show its dependency trace. Conversely, <code>uv export</code> does not, and only shows the package versions (like <code>pip freeze</code>).</p>
<p>Here is an example for the <code>pyproject.toml</code></p>
<pre><code>[project]
name = &quot;test-uv-export&quot;
version = &quot;0.0.dev0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
    &quot;pandas&quot;,
    &quot;numpy&quot;,
]
</code></pre>
<p>This is how the output of <code>uv pip compile pyproject.toml</code> looks:</p>
<pre><code># This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml
numpy==2.1.1
    # via
    #   test-uv-export (pyproject.toml)
    #   pandas
pandas==2.2.3
    # via test-uv-export (pyproject.toml)
python-dateutil==2.9.0.post0
    # via pandas
pytz==2024.2
    # via pandas
six==1.16.0
    # via python-dateutil
tzdata==2024.2
    # via pandas
</code></pre>
<p>And this is the output from <code>uv export --frozen --no-hashes</code> (after having previous ran <code>uv lock</code>):</p>
<pre><code># This file was autogenerated by uv via the following command:
#    uv export --frozen --no-hashes
numpy==2.1.1
pandas==2.2.3
python-dateutil==2.9.0.post0
pytz==2024.2
six==1.16.0
tzdata==2024.2
</code></pre>
<p>Is it possible to add the same dependency trace comments for the <code>uv export</code> output?</p>
<p>This is not a real issue when the consumer of the <code>requirements.txt</code> file is an automated system, but I found the <code>uv pip compile</code> output can be helpful when trying to debug the root cause of deployment failures due to unsuccessful dependency installations.<br>
Of course this is not a very pressing issue, since you can always trace the origin of a dependency through the <code>uv.lock</code> file, but I thought since the information is already there when <code>uv export</code> generates its output, then maybe it can be done without much effort. Or maybe even this option already exists I just couldn&#x27;t find how to enable it...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-30 14:33</div>
            <div class="timeline-body"><p>You might want to use <code>uv tree</code> to debug your dependency install failures instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zmeir">@zmeir</a> on 2024-09-30 16:42</div>
            <div class="timeline-body"><p>Cool, thanks!</p>
<p>That still means I have to log into the environment that failed and run the command there to debug, instead of just looking up the <code>requirements.txt</code> file from the output. In my team we have a handful of developers working on many projects, so sometimes the person debugging a failure doesn&#x27;t have the project cloned and set up with a working environment when starting to debug, so pulling the failed version to get the current <code>uv.lock</code> file and then running <code>uv tree</code> can take a while longer (especially for the less experienced folks).<br>
The alternative of just looking at the build log and seeing which package failed, and then looking where that package came from in the <code>requirements.txt</code> file (from GitHub or the CI logs/artifacts), is still simpler I think. But I understand this might be a very niche use-case...<br>
I should also note that in certain cases we don&#x27;t even keep the <code>uv.lock</code> file, for example when exporting <code>requirements.txt</code> with <code>--resolution lowest</code> to test that our app works with the lowest versions of our dependencies. It is done ad-hoc by the CI and we don&#x27;t keep the <code>uv.lock</code> file for that resolution because we don&#x27;t want it to override the on with the default <code>--resolution highest</code>.</p>
<p>Anyway, this is certainly not a big deal, just want to share this idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-08 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trim21">@trim21</a> on 2025-03-19 05:33</div>
            <div class="timeline-body"><p>a example using <code>uv tree</code> if someone is wondering how:</p>
<p><code>uv tree --invert --package colorama</code></p>
<pre><code>uv tree --invert --package colorama
Using CPython 3.10.16
Resolved 60 packages in 1ms
colorama v0.4.6
├── click v8.1.8
│   ├── litestar v2.15.1
│   │   └── project[jinja] v0
│   ├── rich-click v1.8.8
│   │   └── litestar v2.15.1 (*)
│   └── uvicorn v0.34.0
│       └── project v0
└── pytest v8.3.4
    └── project v0 (group: dev)
(*) Package tree already displayed
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-28 14:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:22 UTC
    </footer>
</body>
</html>
