<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync groups from workspace member packages in a virtual workspace - astral-sh/uv #8722</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv sync groups from workspace member packages in a virtual workspace</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8722">#8722</a>
        opened by <a href="https://github.com/drmason13">@drmason13</a>
        on 2024-10-31 12:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/drmason13">@drmason13</a></div>
            <div class="timeline-body">

<p>uv 0.4.29</p>
<p>I have a virtual workspace. I want to install a union of all my members&#x27; dependencies <em>including</em> development dependencies.</p>
<p>With dependency-groups I had hoped this would now be easy:</p>
<pre><code>uv sync --group dev
error: Group `dev` is not defined in the project&#x27;s `dependency-group` table
</code></pre>
<p>but this simply complained saying that no group <code>dev</code> existed <em>in the workspace root</em> (which is true, but I do have a dependency-group named dev in one of my members).</p>
<p>I&#x27;ve tried two approaches to workaround this:</p>
<ol>
<li>Move all dev dependencies into the workspace root</li>
<li>Duplicate all dev dependencies in workspace root and each member package</li>
</ol>
<p>Both have downsides, in the case of 1. (moving), my packages can no longer be tested independently since they lack their own development dependencies. In the case of 2. (duplicating), that is its own downside. To add development dependencies I am editing multiple pyproject.toml files, which is the kind of thing I hoped to avoid by using a virtual workspace.</p>
Suggested solution
<p>Within a virtual workspace, I want <code>uv sync</code> to have visibility of each members&#x27; dependency-groups specified within pyproject.toml, as well as their dependencies.</p>
<p>How to request that those groups be included or not could go one of two ways:</p>
1. Implicit
<ul>
<li>Have <code>uv sync --group dev</code> include dependencies from all members&#x27; dependency groups, and the root.</li>
</ul>
2. Explicit
<ul>
<li>Have <code>uv sync --group dev</code> only see groups in the root project (behaviour unchanged).</li>
<li>Have <code>uv sync --group dev --include-dependency-groups-of-all-workspace-members</code> include dependencies from all members&#x27; dependency groups, and the root. Same as in the implicit case.</li>
</ul>
<p><code>--include-dependency-groups-of-all-workspace-members</code> is obviously too long, pending a suitable alternative. I don&#x27;t have a strong opinion on the name of the option. It could also/instead be a config file option.</p>
<p>With 2. it would be natural to extend the request to list specific members to include the group from, though that&#x27;s harder to think of syntax for. i.e. I want group <code>dev</code> from members <code>foo</code> and <code>bar</code> where <code>foo</code> and <code>bar</code> are the package names of an arbitrary subset of my workspace members. I don&#x27;t have a good use case for this myself though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/drmason13">@drmason13</a> on 2024-10-31 14:33</div>
            <div class="timeline-body"><p>Actually, I have discovered another workaround to improve 1. Move all dev dependencies into the workspace root</p>
<p>I first <code>uv sync --only-group dev</code> to get all the development dependencies</p>
<p><em>because I have it so they are all listed in the virtual workspace pyproject.toml instead of the members. No members list any dev dependencies, which avoids duplication.</em></p>
<p>Then, <code>uv run --package foo pytest</code> which will <em>additionally install</em> <code>foo</code> and its dependencies but does not uninstall any dev dependencies. Previously this was a problem because I wanted to not have every other member installed while testing <code>foo</code>, but the <code>--only-group dev</code> option to uv sync fixes this ðŸ™‚</p>
<p>When testing the next package, I can <code>uv sync --only-group dev</code> again to effectively uninstall foo and its dependencies and revert back to just having dev dependencies. Then I <code>uv run --package bar pytest</code> and so on.</p>
<p>Note: running <code>uv sync --package foo</code> would lose all the root dev dependencies, so I can&#x27;t ever do that (while testing) but when <em>building</em>, I will do exactly that and everything should work out great.</p>
<p>I think that removes the need for this feature, for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 19:49</div>
            <div class="timeline-body"><p>Sorry yeah -- this is a bug. I actually just noticed it in a separate context. Will fix it now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-31 20:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:10 UTC
    </footer>
</body>
</html>
