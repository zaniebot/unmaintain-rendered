<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to scale uv to large monorepos? - astral-sh/uv #17209</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>How to scale uv to large monorepos?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17209">#17209</a>
        opened by <a href="https://github.com/danijar">@danijar</a>
        on 2025-12-21 21:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/danijar">@danijar</a> on 2025-12-21 21:09</div>
            <div class="timeline-body"><h2>Question</h2>
<p>We have a large monorepo and would love to use native uv but are running into some current limitations. Mainly, we would like to use a shared namespace folder structure and separate lock files and venvs for each package. I've opened this thread to discuss which potential new features would be required for uv to scale to large monorepos while avoiding common issues.</p>
<h2>Example</h2>
<p>Shared folder structure for all projects (<code>pyproject.toml</code> files on the &quot;inside&quot;):</p>
<pre><code>packages
  org
    project
      models
        foo
          pyproject.toml
          uv.lock
          .venv
          __init__.py
          train.py
        bar
          pyproject.toml
        baz
          pyproject.toml
      datasets
        foo
          pyproject.toml
        bar
          pyproject.toml
        baz
          pyproject.toml
...
</code></pre>
<p>Imports include the namespaces (either relative or the absolute):</p>
<pre><code class="language-python3"># org/project/models/foo/train.py
from org.project.datasets import foo, bar, baz
from ..datasets import foo, bar, baz
</code></pre>
<h2>Rationale</h2>
<h3>Shared namespace folder structure</h3>
<p>A flat list of packages is hard to maintain at scale: it would be hundreds of folders and each would have its namespace inlined into the folder name with dashes. Moreover, currently each package would have to duplicate its nested namespace subtree inside. That's too many folders to keep in sync and navigate between. A shared namespace folder structure scales well to any number of packages.</p>
<h3>Separate lock files and venvs for each package</h3>
<p>Forcing all teams to the same version lock file means leads to frequent and unexpected breakages for other teams. Moreover, the more packages use the same dependency, the harder it becomes to ever update that dependency, leading to version lock-in. Separate lock files and venvs for each package allow developers to predictably upgrade at their own convenience, which scales well to any number of packages.</p>
<h2>Open problems</h2>
<h3>pyproject.toml inside namespace leaf folders</h3>
<p>Placing <code>pyproject.toml</code> files inside the leafs of the namespace folder structure seems currently not supported. In principle, it's easy to support by a build backend. I've wrote a small working build backend as an example here: https://gist.github.com/danijar/755c7dbef9ac0819081b26818245c73b</p>
<h3>Path dependencies relative to repo root</h3>
<p>With its single lock file and venv, it seems like uv workspaces only scale to small monorepos, so we should probably go with separate projects with path dependencies. Ideally, it would be possible to specify path dependencies relative to the repo root. We could patch that functionality on top of uv, for which I've opened an issue here: https://github.com/astral-sh/uv/issues/17247</p>
<h3>Building all wheels needed to deploy one package</h3>
<p>Deployments would require building a subtree of wheel files, similar to <code>uv build --all</code> in a uv workspace, but limited to only the dependency subtree of a specific project for faster builds and lightweight deployments. I've opened an issue here: https://github.com/astral-sh/uv/issues/17248</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @danijar on 2025-12-21 21:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17154.html">astral-sh/uv#17154</a> on 2025-12-21 21:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Does uv allow a shared namespace structure for separate projects (with separate lock files)?" to "How to scale uv to large monorepos?" by @danijar on 2025-12-28 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17283.html">astral-sh/uv#17283</a> on 2026-01-02 16:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:15 UTC
    </footer>
</body>
</html>
