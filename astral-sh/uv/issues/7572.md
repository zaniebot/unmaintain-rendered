```yaml
number: 7572
title: "`uv sync --no-source` breaking from 0.4"
type: issue
state: closed
author: lambda-science
labels:
  - bug
assignees: []
created_at: 2024-09-20T07:47:56Z
updated_at: 2024-10-28T18:35:48Z
url: https://github.com/astral-sh/uv/issues/7572
synced_at: 2026-01-10T01:57:17Z
```

# `uv sync --no-source` breaking from 0.4

---

_Issue opened by @lambda-science on 2024-09-20 07:47_

Hello,

My basic TOML:
```toml
[project]
name = "pythia-streamlit"
version = "0.4.0"
dependencies = [
    "numpy",
    "pythia-client>=0.6.3",
]
requires-python = ">=3.12"

[tool.uv.sources]
pythia-client = { workspace = true }

[tool.uv.workspace]
members = [
    "../pythia-client"
]
```

In UV 0.3.5 this worked for me:
```docker
COPY --from=ghcr.io/astral-sh/uv:0.3.5 /uv /bin/uv
ENV UV_COMPILE_BYTECODE=1
ENV UV_NO_CACHE=1
ENV PATH="/code/.venv/bin:$PATH"
# Install dependencies
WORKDIR /code
COPY pyproject.toml /code/
RUN uv sync --no-install-project --no-sources
```

`docker build .`
Output: `[+] Building FINISHED `

In UV 0.4.13 it doesn't work anymore:
```docker
COPY --from=ghcr.io/astral-sh/uv:0.4.13 /uv /bin/uv
ENV UV_COMPILE_BYTECODE=1
ENV UV_NO_CACHE=1
ENV PATH="/code/.venv/bin:$PATH"
# Install dependencies
WORKDIR /code
COPY pyproject.toml /code/
RUN uv sync --no-install-project --no-sources
```
Output:
```docker
 => ERROR [stage-0 6/8] RUN uv sync --no-install-project --no-sources                                                                                                                                                                              0.7s 
------
 > [stage-0 6/8] RUN uv sync --no-install-project --no-sources:
0.613 Using Python 3.12.6 interpreter at: /usr/local/bin/python3
0.613 Creating virtual environment at: .venv
0.620 error: Failed to build: `pythia-streamlit @ file:///code`
0.620   Caused by: Failed to parse entry for: `pythia-client`
0.620   Caused by: Package is not included as workspace package in `tool.uv.workspace`
------
Dockerfile:18
--------------------
  16 |     WORKDIR /code
  17 |     COPY pyproject.toml /code/
  18 | >>> RUN uv sync --no-install-project --no-sources
  19 |
  20 |     COPY src/pythia_streamlit /code/pythia_streamlit
--------------------
ERROR: failed to solve: process "/bin/sh -c uv sync --no-install-project --no-sources" did not complete successfully: exit code: 2
```

My setup is a workspace with 3 parts: two app (`pythia-streamlit`, `pythia-api`) and a python package (`pythia-client`). The Dockerfile snippet is coming from production image where I want to install `pythia-client` from Pypi. In local developement environnement I remove the `--no-sources` to install from local folder (from parent directory).

The update from 0.4 broke by CI/CD pipeline, because the image would not build anymore due to the error above.
Any idea why ?

---

_Assigned to @charliermarsh by @charliermarsh on 2024-09-20 14:13_

---

_Comment by @charliermarsh on 2024-09-20 14:15_

Hmm... I guess we should allow this when running with `--no-sources`? \cc @zanieb @konstin 

---

_Label `needs-decision` added by @charliermarsh on 2024-09-20 14:15_

---

_Comment by @konstin on 2024-09-20 15:47_

This is a complicated one, because `--no-sources` should take the package from pypi (behaving as if it were a published package), so in this case, we should re-lock with the pypi version of the dep?

---

_Comment by @zanieb on 2024-09-20 18:17_

Yeah this seems like a bug? We should not be trying to use the source entry from the lockfile when `--no-sources` is provided right? Roughly agree with what @konstin is saying.

At the very least, the error message is horrible. What's the suggestion if we were to keep the existing behavior and just improve the error? To run` uv lock --no-sources` first?

---

_Comment by @charliermarsh on 2024-09-20 18:21_

I think there's a bug because we shouldn't even be trying to resolve the sources here (which is where the failure happens).

---

_Label `needs-decision` removed by @charliermarsh on 2024-09-20 18:21_

---

_Label `bug` added by @charliermarsh on 2024-09-20 18:21_

---

_Referenced in [astral-sh/uv#7599](../../astral-sh/uv/pulls/7599.md) on 2024-09-20 18:51_

---

_Closed by @charliermarsh on 2024-09-20 19:03_

---

_Closed by @charliermarsh on 2024-09-20 19:03_

---

_Comment by @gita-unlearn on 2024-09-23 23:52_

@charliermarsh 
Im on `uv 0.4.15` and I am having the same problem
```
0.445 error: Failed to build: `gita-current_package` @ file:///opt/dagster/dagster_home/gita-current_package`
0.446   Caused by: Failed to parse entry for: `gita-package1`
0.446   Caused by: Package is not included as workspace package in `tool.uv.workspace`
------

 2 warnings found (use docker --debug to expand):
 - FromAsCasing: 'as' and 'FROM' keywords' casing do not match (line 4)
 - FromAsCasing: 'as' and 'FROM' keywords' casing do not match (line 31)
Dockerfile.backend:40
--------------------
  38 |     RUN uv sync --no-sources --python 3.11 --extra-index-url https://${PRIVATE_PYPI}
  39 |     
  40 | >>> RUN uv run pip install --no-cache-dir dagster-cloud
```

Weirdly the uv sync works, it is when it goes to the next RUN command that it fails

---

_Comment by @charliermarsh on 2024-09-23 23:55_

You'd have to pass `--no-sources` to each command (`uv run --no-sources`). We do not store sync "state" across commands.

---

_Comment by @gita-unlearn on 2024-09-23 23:57_

ah okay, thank you for the quick reply <3 

---

_Referenced in [astral-sh/uv#7945](../../astral-sh/uv/issues/7945.md) on 2025-06-26 01:17_

---
