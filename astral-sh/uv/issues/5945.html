<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add documentation for installing common pytorch variants - astral-sh/uv #5945</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add documentation for installing common pytorch variants</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5945">#5945</a>
        opened by <a href="https://github.com/zanieb">@zanieb</a>
        on 2024-08-09 00:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-09 00:11</div>
            <div class="timeline-body"><p>ðŸ˜­ but it must be done!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @zanieb on 2024-08-09 00:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nikhilweee">@nikhilweee</a> on 2024-08-09 20:02</div>
            <div class="timeline-body"><p>I think the most common difficulty would be to specify the index url, but I'm glad <code>uv</code> makes it as easy as possible.</p>
<pre><code class="language-shell">uv add torch --index-url https://download.pytorch.org/whl/cpu # within a project
uv pip install torch --index-url https://download.pytorch.org/whl/cpu # otherwise
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-08-21 17:21</div>
            <div class="timeline-body"><p>However, I've always used <code>uv pip install</code> for both PyTorch and TensorFlow, because on my Windows system, PyTorch uses CUDA 12.1 and TensorFlow includes <a href="https://pypi.org/project/tensorflow-intel/">tensorflow-intel</a>, both of which are platform-dependent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-21 18:59</div>
            <div class="timeline-body"><p>Available to help :) I am on ARM macOS and <code>uv add torch</code> recently has always been nice to me ðŸ˜… Regular version (w/o CUDA dependencies) are installed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-08-22 06:21</div>
            <div class="timeline-body"><p>Would also like to point out there's been this python package (recently recommended by @muellerzr, HuggingFace Accelerate maintainer) to install torch with automatic backend detection. Might be a good candidate for a first uv plugin, I guess?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2024-08-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/valentincalomme">@valentincalomme</a> on 2024-08-23 15:30</div>
            <div class="timeline-body"><p>Sharing my thoughts to help with the discussion.</p>
<p>I feel that the biggest challenge here is that the source is platform dependent. On MacOs, PyPi is sufficient. But for Linux and Windows, if one wishes to install a cuda enabled version, they need to specify a URL.</p>
<p>I would personally already be helped if I could specify platform-dependent sources for packages.</p>
<p>Now the cuda/not cuda question is difficult. I think that theoretically, using optional dependencies can be a way to deal with this. If you want the cuda version (for any platform), install it as my_package[cuda]. If you only need the cpu version (i.e. Github actions), then install it as my_package[cpu].</p>
<p>But it's more of a flag then an optional dependency. It's either/or. So not sure how to deal with that. Maybe there can be &quot;modes&quot; for dependencies, with a default. And if the &quot;cuda&quot; mode is specified, dependencies are installed based on that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-23 15:42</div>
            <div class="timeline-body"><blockquote>
<p>I would personally already be helped if I could specify platform-dependent sources for packages.</p>
</blockquote>
<p>Regarding this.. https://github.com/astral-sh/uv/issues/3397</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-11 13:27</div>
            <div class="timeline-body"><p>Example at https://github.com/astral-sh/uv/issues/7245#issuecomment-2340970983</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dan-jacobson">@dan-jacobson</a> on 2024-09-21 22:40</div>
            <div class="timeline-body"><p>I've been banging my head against this for a couple days and can only report a list of things that don't work.</p>
<p>For reference, my goal is to install <code>torch</code> cpu-only, in two environments:</p>
<ul>
<li>my m2 macbook</li>
<li><code>linux/amd64</code> (so I can build my image in github ci and run on Cloud Run).</li>
</ul>
<p>Here's what I've tried so far:</p>
<ul>
<li><code>uv add torch</code> : doesn't work because torch defaults to installing a bunch of cuda on <code>linux/amd64</code></li>
<li><code>uv add torch --extra-index-url https://download.pytorch.org/whl/cpu</code> doesn't work because <code>torch==2.4.1+cpu</code> doesn't exist for macos</li>
<li><code>find-links = [&quot;https://download.pytorch.org/whl/torch_stable.html&quot;]</code> somehow downloads cuda stuff on my mac?? this also fails if declare <code>torch==2.4.1+cpu</code> because the <code>macos</code> whl's in that registry don't have the <code>+cpu</code> local version identifier. (edit: i did also have to downgrade to <code>torch==2.3.1</code> because 2.4.X isn't in the <code>torch_stable</code> registry)</li>
<li><code>dependencies = [&quot;torch==2.4.1 ; sys_platform == 'darwin'&quot;, &quot;torch==2.4.1+cpu ;  sys_platform != 'darwin'&quot;]</code>, with <code>extra-index-url = &quot;https://download.pytorch.org/whl/cpu&quot;</code> in <code>[tool.uv]</code>.</li>
<li><code>dependencies = [&quot;torch @ https://download.pytorch.org/whl/cpu/torch-2.4.1-cp312-none-macosx_11_0_arm64.whl ; sys_platform == 'darwin' and platform_machine == 'arm64'&quot;, &quot;torch==2.4.1+cpu ; sys_platform !='darwin'&quot;]</code> again, with <code>extra-index-url</code> pointing to the torch cpu-only registry. i was pretty surprised this one didn't work, since i thought i was yoinking from @charliermarsh in <a href="https://github.com/astral-sh/uv/issues/7245#issuecomment-2340836442">this comment</a>.</li>
</ul>
<p>I've also tried all variations of the above with <code>index-strategy = &quot;unsafe-best-match&quot;</code>, just to make sure that it's not a registry order problem.</p>
<p>anyways, i'm sure there's a way. i just haven't found it yet. i'll keep plugging away. i think my next idea is to define the <code>macos</code> as a <code>dev-dependency</code>, although that feels a little bit hacky.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-21 23:08</div>
            <div class="timeline-body"><p>Thanks, thatâ€™s a good concrete example. Iâ€™ll take a look at it (not tonight, but soon) and report back.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dan-jacobson">@dan-jacobson</a> on 2024-09-22 00:06</div>
            <div class="timeline-body"><p>Update: it seems that the last version I tried, <code>dependencies = [&quot;torch @ whatever ; sys_platform == 'darwin' and platform_machine == 'arm64'&quot;, &quot;torch @ whatever+cpu ; sys_platform !='darwin'&quot;]</code> DOES work if I'm just careful about the paths. Also it works if I relax to just the local version identifier.</p>
<p>For anyone trying this in the future, here's the specific <code>pyproject.toml</code> that worked for me:</p>
<pre><code>dependencies = [
    &quot;torch==2.4.1 ; sys_platform == 'darwin' and platform_machine == 'arm64'&quot;,
    &quot;torch==2.4.1+cpu ; sys_platform !='darwin'&quot;,
]

[tool.uv]
index-strategy = &quot;unsafe-best-match&quot;
extra-index-url = [&quot;https://download.pytorch.org/whl/cpu&quot;]
</code></pre>
<p>Edit: note that <code>index-strategy = &quot;unsafe-best-match&quot;</code> isn't strictly necessary for just <code>torch</code>, but some of the other deps in the <code>https://download.pytorch.org/whl/cpu</code> registry are behind their <code>pypi</code> equivalents. <code>pillow</code>, for example. so it was necessary to either 1) downgrade my <code>pillow</code> version to the one in the <code>pytorch/cpu</code> registry, or 2) use <code>unsafe-best-match</code>.</p>
<p>Edit 2: looking back at my logs, the reason I hadn't gotten this approach to work before was actually because I hadn't wrapped <code>extra-index-url</code> in a <code>List</code> -- I'd just been passing it as a string. This broke the TOML parsing, but the proximate error I was seeing was:</p>
<pre><code>No solution found when resolving dependencies for split (sys_platform != 'darwin'):
  â•°â”€â–¶ Because there is no version of torch{sys_platform != 'darwin'}==2.4.1+cpu and your project depends on torch{sys_platform != 'darwin'}==2.4.1+cpu, we can
      conclude that your project's requirements are unsatisfiable.
</code></pre>
<p>And I had concluded I was writing my <code>dependencies</code> wrong. So, whoops, skill issue for not reading the full stacktrace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-23 19:21</div>
            <div class="timeline-body"><blockquote>
<p>And I had concluded I was writing my dependencies wrong. So, whoops, skill issue for not reading the full stacktrace.</p>
</blockquote>
<p>We had a few releases where we dropped this error on the floor, so it might not have even been visible to you sadly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-23 19:21</div>
            <div class="timeline-body"><p>I do think that what you ended up with is right, though:</p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;torch==2.4.1 ; sys_platform == 'darwin'&quot;, &quot;torch==2.4.1+cpu ;  sys_platform != 'darwin'&quot;]

[tool.uv]
index-strategy = &quot;unsafe-best-match&quot;
extra-index-url = [&quot;https://download.pytorch.org/whl/cpu&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-23 19:27</div>
            <div class="timeline-body"><p>Does anyone know <em>why</em> PyTorch has some wheels with <code>+cpu</code> and some without here? This is on the <code>https://download.pytorch.org/whl/cpu</code> index.</p>
<p><img src="https://github.com/user-attachments/assets/4de1dc89-edd0-4390-9034-fb86ce350657" alt="Screenshot 2024-09-23 at 3 26 14â€¯PM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dan-jacobson">@dan-jacobson</a> on 2024-09-28 18:27</div>
            <div class="timeline-body"><p>Honestly, I'm not entirely sure -- my vague understanding is that the wheels that <em>could</em> have CUDA support have explicit <code>+cpu</code> versions, but the ones without CUDA support are implicitly <code>cpu-only</code>. Either way, quite frustrating.</p>
<p>One other thing, as I've continued to work on this project: using the above <code>pyproject.toml</code>, I can't <code>uv add torchvision</code> without automatically getting <code>torchvision+cpu</code>. Not entirely sure why. What I'm seeing is:</p>
<pre><code>uv add torchvision
error: distribution torchvision==0.19.1+cpu @ registry+https://download.pytorch.org/whl/cpu can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>This is on my macbook, where I would have expected it to resolve to just <code>torchvision</code>, sans <code>+cpu</code>.</p>
<p>However, if I manually add <code>torchvision==0.19.1</code> to my <code>pyproject.toml</code> and <code>uv sync</code>, everything behaves as expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Leon0402">@Leon0402</a> on 2024-10-18 16:57</div>
            <div class="timeline-body"><p>Variant 1:</p>
<pre><code>uv pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
</code></pre>
<pre><code>â ¼ lit==15.0.7                                                                                                                          Ã— Failed to download and build `lit==15.0.7`
  â”œâ”€â–¶ Failed to resolve requirements from `build-system.requires`
  â”œâ”€â–¶ No solution found when resolving: `setuptools&gt;=40.8.0`, `wheel`
  â•°â”€â–¶ Because wheel was not found in the package registry and you require wheel, we can conclude that your requirements are
      unsatisfiable.

      hint: An index URL (https://download.pytorch.org/whl/cu118) could not be queried due to a lack of valid authentication
      credentials (403 Forbidden).
</code></pre>
<p>Variant 2:</p>
<pre><code>uv add torch torchvision torchaudio --default-index https://download.pytorch.org/whl/cu118
</code></pre>
<pre><code>error: Distribution `torchaudio==2.0.0 @ registry+https://download.pytorch.org/whl/cu118` can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>Any idea why neither is working?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-18 17:11</div>
            <div class="timeline-body"><p>@Leon0402 I think this isn't a UV issue. I accessed it a few minutes ago through the browser and it didn't have the correct content, but it seems to be working now. Do you want to try it again?</p>
<p>The result of my visit a few minutes ago:
<img src="https://github.com/user-attachments/assets/6d104d0d-63ea-48c0-a463-8bdc13b3256d" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Leon0402">@Leon0402</a> on 2024-10-18 17:35</div>
            <div class="timeline-body"><p>@FishAlchemist Issue persists. I also tried <code>cu121</code>, but same issue. I am running the right commands though, right? I am new to uv, so maybe I did not use it correctly.
I also just created a new fresh project with uv init and then above command, but same issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-18 17:42</div>
            <div class="timeline-body"><p>@Leon0402 I am unable to replicate this issue on my machine. Would you consider filing a separate issue and providing more specific details based on the prompts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Leon0402">@Leon0402</a> on 2024-10-18 18:05</div>
            <div class="timeline-body"><blockquote>
<p>@Leon0402 I am unable to replicate this issue on my machine. Would you consider filing a separate issue and providing more specific details based on the prompts?</p>
</blockquote>
<p>Sure: https://github.com/astral-sh/uv/issues/8344, Let me know what other output you need there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fzyzcjy">@fzyzcjy</a> on 2024-10-19 12:24</div>
            <div class="timeline-body"><p>Hi I am facing problem in macos for pytorch cpu installation (https://github.com/astral-sh/uv/issues/8358), is there any suggestions? Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amiralik16">@amiralik16</a> on 2024-10-21 17:43</div>
            <div class="timeline-body"><p>Hi UV team. First let me thank you for all the work you're doing on the project. I've just started using it and it is FAST and pretty intuitive (especially coming from poetry).</p>
<p>For my use case, I'm trying to generate a lock file that would install either a cpu only or gpu enabled version of pytorch when on a linux platform and just regular pypi pytorch when using a mac.
According to pytorch, one needs to point to different indexes:</p>
<ol>
<li>Linux and cpu: https://download.pytorch.org/whl/cpu</li>
<li>Linux + cuda 11.8 + gpu: https://download.pytorch.org/whl/cu118</li>
<li>mac: pypi
I have the following pyproject.toml (the idea is I'd be able to do uv sync --extra torch-gpu/torch-cpu) that would install the gpu/cpu version on a linux platform.</li>
</ol>
<pre><code>[project]
name = &quot;uv&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
    # bunch of irrelevant deps
]

[project.optional-dependencies]
torch-gpu = [
    &quot;torch==2.4.1+cu118;sys_platform == 'linux' and extra == 'torch-gpu' and extra != 'torch-cpu'&quot;, 
    &quot;torch==2.4.1;sys_platform == 'darwin'&quot;,
    &quot;torchmetrics&gt;=1.4.3&quot;,
]
torch-cpu = [
    &quot;torch==2.4.1+cpu;sys_platform == 'linux' and extra != 'torch-gpu' and extra == 'torch-cpu'&quot;, 
    &quot;torch==2.4.1;sys_platform == 'darwin'&quot;,
    &quot;torchmetrics&gt;=1.4.3&quot;,
]
classic = [
    &quot;lightgbm&gt;=4.5.0&quot;,
    &quot;scikit-learn&gt;=1.5.2&quot;,
    &quot;xgboost&gt;=2.1.1&quot;,
]


[tool.uv.sources]
torch = [
  { index = &quot;torch-cpu&quot;, marker = &quot;sys_platform == 'linux' and extra != 'torch-gpu' and extra == 'torch-cpu'&quot;},
  { index = &quot;torch-cu118&quot;, marker = &quot;sys_platform == 'linux' and extra == 'torch-gpu' and extra != 'torch-cpu'&quot;},
]

[[tool.uv.index]]
name = &quot;torch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[[tool.uv.index]]
name = &quot;torch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
</code></pre>
<p>However, I am getting the below error. I'm not sure where the torch{sys_platform == 'linux' and extra != 'torch-gpu'}is coming from since my expectation is that torch2.4.1+cpu is ONLY installed if extra torch-cpu is requested and extra torch-gpu isn't requested.</p>
<pre><code> Ã— No solution found when resolving dependencies for split (sys_platform != 'darwin'):
  â•°â”€â–¶ Because there is no version of torch{sys_platform == 'linux' and extra != 'torch-gpu'}==2.4.1+cpu and uv[torch-cpu] depends on torch{sys_platform == 'linux' and extra
      != 'torch-gpu'}==2.4.1+cpu, we can conclude that uv[torch-cpu]'s requirements are unsatisfiable.
      And because your project requires uv[torch-cpu], we can conclude that your projects's requirements are unsatisfiable.
</code></pre>
<p>I'm mainly looking for any suggestions on how to achieve the end goal and if anyone from the UV team can help me understand why torch2.4.1+cpu is being considered for torch{sys_platform == 'linux' and extra != 'torch-gpu'}</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laxas">@laxas</a> on 2024-11-08 11:17</div>
            <div class="timeline-body"><p>I got the same promlem but</p>
<pre><code class="language-bash">uv pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
</code></pre>
<p>works.</p>
<p>It gets uninstalled after every <code>uv sync</code>, but my workaround is</p>
<pre><code class="language-bash">uv sync &amp;&amp; uv pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
</code></pre>
<p>That looks stupid but is, do to caching, realy fast.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-17 03:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-17 03:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:38:39 UTC
    </footer>
</body>
</html>
