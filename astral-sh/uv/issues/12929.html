<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON schema for config-settings seems wrong - astral-sh/uv #12929</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>JSON schema for config-settings seems wrong</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/12929">#12929</a>
        opened by <a href="https://github.com/udifuchs">@udifuchs</a>
        on 2025-04-17 01:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/udifuchs">@udifuchs</a> on 2025-04-17 01:40</div>
            <div class="timeline-body"><p>There is a mismatch between the documentation for <code>config-settings</code> and the JSON schema.
The documentation has this example:</p>
<pre><code>[tool.uv]
config-settings = { editable_mode = &quot;compat&quot; }
</code></pre>
<p>But it fails to validate with uv.schema.json.
On the other hand, the JSON schema does validate this file:</p>
<pre><code>[tool.uv]
config-settings = { single_mode = { String = &quot;compat&quot; }, multi_modes = { List = [ &quot;one&quot;, &quot;two&quot;] } }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-17 01:42</div>
            <div class="timeline-body"><p>Interesting, thanks -- does seem like a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2025-04-17 01:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2025-04-17 01:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxmynter">@maxmynter</a> on 2025-04-17 09:56</div>
            <div class="timeline-body"><p>I wanted to try on this one, but couldn't reproduce the issue on <a href="https://github.com/astral-sh/uv/commit/041c7a5e63d5559ce5571a30e177c072b1b357b2">041c7a5</a>.</p>
<p>Using <a href="https://github.com/sclevine/yj"><code>yj</code></a> and <a href="https://github.com/python-jsonschema/check-jsonschema"><code>check-jsonschema</code></a> i get:</p>
<pre><code class="language-bash">echo '[tool.uv]
config-settings = { editable_mode = &quot;compat&quot; }' &gt; documented-format.toml

yj -t &lt; documented-format.toml &gt; documented-format.json

check-jsonschema documented-format.json --schemafile ../uv.schema.json
# Result: ok -- validation done
</code></pre>
<pre><code class="language-bash">echo '[tool.uv]
config-settings = { single_mode = { String = &quot;compat&quot; }, multi_modes = { List = [ &quot;one&quot;, &quot;two&quot;] } }' &gt; structured-format.toml

yj -t &lt; structured-format.toml &gt; structured-format.json

check-jsonschema structured-format.json --schemafile ../uv.schema.json
# Result: ok -- validation done
</code></pre>
<p>Or am i completely misunderstanding <code>uv</code>s lifecycle and where the <code>.toml</code> is validated against the schema?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-17 12:51</div>
            <div class="timeline-body"><p>Hmm, I'm not sure why you're seeing a difference in the CLI but I <em>can</em> verify it with Even Better TOML:</p>
<p><img src="https://github.com/user-attachments/assets/e67dd1da-2567-419f-ad22-c323756c2ab8" alt="Image" />
<img src="https://github.com/user-attachments/assets/0ee6a71e-1579-4824-ac81-f70257ef6823" alt="Image" /></p>
<p>I think we need to make <code>ConfigSettingValue</code> untagged.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12947.html">astral-sh/uv#12947</a> on 2025-04-17 15:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxmynter">@maxmynter</a> on 2025-04-17 15:16</div>
            <div class="timeline-body"><p>@charliermarsh I could reproduce it with the Even Better Toml extension, too. Weirdly enough, not with the <code>taplo</code> CLI on which that extension is based.</p>
<p>Anyhow, I've proposed a small fix in #12947 that untags the <code>ConfigSettingValue</code>. With it, validation in Even Better Toml passes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-17 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-17 16:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:27 UTC
    </footer>
</body>
</html>
