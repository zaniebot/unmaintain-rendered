```yaml
number: 16117
title: "`uv pip install --project ...` ignoring `tool.uv.sources` setting"
type: issue
state: open
author: ncoghlan
labels:
  - bug
assignees: []
created_at: 2025-10-03T17:41:24Z
updated_at: 2025-10-13T15:40:31Z
url: https://github.com/astral-sh/uv/issues/16117
synced_at: 2026-01-12T16:02:24Z
```

# `uv pip install --project ...` ignoring `tool.uv.sources` setting

---

_@ncoghlan_

### Summary

Attempting to work around #6772 in venvstacks by using the `--project` option instead of the `--config-file` option, I found that this works fine for `tool.uv.index` settings (which also worked via the plain config file option), but still doesn't work for `tool.uv.sources`.

`--no-sources` is listed in the `--help` output for `uv pip install`, suggesting that this is *expected* to work.

Running the installation command directly in verbose mode shows that it is querying PyPI for `torch` info, despite a project setting directing it to use the relevant `PyTorch` index instead:

```
uv pip install --project ~/devel/venvstacks/examples/pytorch/_build/framework-torch-cpu_resolve --python torch_cpu/bin/python -r ~/devel/venvstacks/examples/pytorch/requirements/framework-torch-cpu/requirements-framework-torch-cpu.txt -vvv 2>&1 | grep torch
DEBUG Checking for Python interpreter at path `torch_cpu/bin/python`
TRACE Found cached interpreter info for Python 3.11.13, skipping query of: torch_cpu/bin/python
Using Python 3.11.13 environment at: torch_cpu
TRACE Checking lock for `torch_cpu` at `torch_cpu/.lock`
DEBUG Acquired lock for `torch_cpu`
DEBUG Adding direct dependency: torch{sys_platform != 'darwin'}==2.7.0+cpu
TRACE Fetching metadata for torch from https://pypi.org/simple/torch/
TRACE Response from https://pypi.org/simple/torch/ is storable because it has a 'public' cache-control directive
DEBUG Found fresh response for: https://pypi.org/simple/torch/
TRACE Received package metadata for: torch
TRACE Chose package for decision: torch{sys_platform != 'darwin'}. remaining choices: typing-extensions
DEBUG Searching for a compatible version of torch{sys_platform != 'darwin'} (==2.7.0+cpu)
TRACE Selecting candidate for torch with range ==2.7.0+cpu with 42 remote versions
TRACE Exhausted all candidates for package torch with range ==2.7.0+cpu after 0 steps
DEBUG No compatible version found for: torch{sys_platform != 'darwin'}
   torch{sys_platform != 'darwin'} ==2.7.0+cpu is forbidden
  root==0a0.dev0 depends on torch{sys_platform != 'darwin'}==2.7.0+cpu
  no versions of torch{sys_platform != 'darwin'}==2.7.0+cpu
  root==0a0.dev0 depends on torch{sys_platform != 'darwin'}==2.7.0+cpu
  no versions of torch{sys_platform != 'darwin'}==2.7.0+cpu
  ╰─▶ Because there is no version of torch{sys_platform != 'darwin'}==2.7.0+cpu and you require torch{sys_platform !=
DEBUG Released lock at `/home/acoghlan/devel/_misc/uv_experiments/torch_cpu/.lock`
```

Generated `pyproject.toml`:

```
$ cat ~/devel/venvstacks/examples/pytorch/_build/framework-torch-cpu_resolve/pyproject.toml
[project]
name = "framework-torch-cpu"
version = "0"
dependencies = ["torch==2.7.0"]
requires-python = "==3.11.*"

[tool.uv]
no-build = true
constraint-dependencies = ["numpy==2.3.3"]

[[tool.uv.index]]
name = "pytorch-cpu"
url = "https://download.pytorch.org/whl/cpu/"
explicit = true

[tool.uv.sources.torch]
index = "pytorch-cpu"
```

Exported `requirements.txt` (generated via `uv lock` + `uv export`, as `uv pip compile` similarly ignores `tool.uv.sources`):

```
$ cat ~/devel/venvstacks/examples/pytorch/requirements/framework-torch-cpu/requirements-framework-torch-cpu.txt
# Locked requirements for framework-torch-cpu (DO NOT EDIT)
#     Auto-generated by venvstacks with the following command:
#         python -Im venvstacks lock
filelock==3.19.1 \
    --hash=sha256:66eda1888b0171c998b35be2bcc0f6d75c388a7ce20c3f3f37aa8e96c2dddf58 \
    --hash=sha256:d38e30481def20772f5baf097c122c3babc4fcdb7e14e57049eb9d88c6dc017d
fsspec==2025.9.0 \
    --hash=sha256:19fd429483d25d28b65ec68f9f4adc16c17ea2c7c7bf54ec61360d478fb19c19 \
    --hash=sha256:530dc2a2af60a414a832059574df4a6e10cce927f6f4a78209390fe38955cfb7
jinja2==3.1.6 \
    --hash=sha256:0137fb05990d35f1275a587e9aee6d56da821fc83491a0fb838183be43f66d6d \
    --hash=sha256:85ece4451f492d0c13c5dd7c13a64681a86afae63a5f347908daf103ce6d2f67
markupsafe==3.0.3 \
    --hash=sha256:068f375c472b3e7acbe2d5318dea141359e6900156b5b2ba06a30b169086b91a \
    --hash=sha256:0bf2a864d67e76e5c9a34dc26ec616a66b9888e25e7b9460e1c76d3293bd9dbf \
    --hash=sha256:0db14f5dafddbb6d9208827849fad01f1a2609380add406671a26386cdf15a19 \
    --hash=sha256:1cc7ea17a6824959616c525620e387f6dd30fec8cb44f649e31712db02123dad \
    --hash=sha256:3b562dd9e9ea93f13d53989d23a7e775fdfd1066c33494ff43f5418bc8c58a5c \
    --hash=sha256:4bd4cd07944443f5a265608cc6aab442e4f74dff8088b0dfc8238647b8f6ae9a \
    --hash=sha256:6b5420a1d9450023228968e7e6a9ce57f65d148ab56d2313fcd589eee96a7a50 \
    --hash=sha256:722695808f4b6457b320fdc131280796bdceb04ab50fe1795cd540799ebe1698 \
    --hash=sha256:7be7b61bb172e1ed687f1754f8e7484f1c8019780f6f6b0786e76bb01c2ae115 \
    --hash=sha256:bc51efed119bc9cfdf792cdeaa4d67e8f6fcccab66ed4bfdd6bde3e59bfcbb2f \
    --hash=sha256:de8a88e63464af587c950061a5e6a67d3632e36df62b986892331d4620a35c01 \
    --hash=sha256:f9e130248f4462aaa8e2552d547f36ddadbeaa573879158d721bbd33dfe4743a
mpmath==1.3.0 \
    --hash=sha256:7a28eb2a9774d00c7bc92411c19a89209d5da7c4c9a9e227be8330a23a25b91f \
    --hash=sha256:a0b2b9fe80bbcd81a6647ff13108738cfb482d481d826cc0e02f5b35e5c88d2c
networkx==3.5 \
    --hash=sha256:0030d386a9a06dee3565298b4a734b68589749a544acbb6c412dc9e2489ec6ec \
    --hash=sha256:d4c6f9cf81f52d69230866796b82afbccdec3db7ae4fbd1b65ea750feed50037
sympy==1.14.0 \
    --hash=sha256:d3d3fe8df1e5a0b42f0e7bdf50541697dbe7d23746e894990c030e2b05e72517 \
    --hash=sha256:e091cc3e99d2141a0ba2847328f5479b05d94a6635cb96148ccb3f34671bd8f5
torch==2.7.0 ; sys_platform == 'darwin' \
    --hash=sha256:0a8d43caa342b9986101ec5feb5bbf1d86570b5caa01e9cb426378311258fdde
torch==2.7.0+cpu ; sys_platform != 'darwin' \
    --hash=sha256:6b7edcbf8bb0b9ac2e6c001434797c5ec3f25394f91eb0ed7aeeeeed9ad4500f \
    --hash=sha256:ce510375ed79223db3ec144fe14cbcffc8a361ac57f39674397ff2d8db3b2c21 \
    --hash=sha256:e32f385dc0b5007ca410035c3b91ef4b1b34b142e9bcdb31d3f0224b7748e992
typing-extensions==4.15.0 \
    --hash=sha256:0cea48d173cc12fa28ecabc3b837ea3cf6f38c6d1136f85cbaaf598984861466 \
    --hash=sha256:f0fa19c6845758ab08074a0cfa8b7aecb71c999ca73d62883bc25cc018c4e548
```

I had been considering migrating from `requirements.txt` to `pylock.toml` as the public layer lock format anyway, and the full URLs in that were able to avoid the problem, but the discrepancy between `--no-sources` appearing in the `uv pip` subcommand help output, and the subcommands apparently ignoring `tool.uv.sources` regardless seemed worth reporting.

### Platform

Linux

### Version

uv 0.8.18 (retested on 0.8.22 with the same error)

### Python version

Python 3.11.13

---

_Label `bug` added by @ncoghlan on 2025-10-03 17:41_

---
