<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>maturin build system not always copying the compiled build into the .venv on uv build - astral-sh/uv #9177</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>maturin build system not always copying the compiled build into the .venv on uv build</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9177">#9177</a>
        opened by <a href="https://github.com/zwing99">@zwing99</a>
        on 2024-11-18 00:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zwing99">@zwing99</a> on 2024-11-18 00:47</div>
            <div class="timeline-body"><p>When using the maturin build system, I cannot seem to run <code>uv build</code> or <code>uv run maturin develop</code> or any set of commands that both compiles the library (rust based) and installs it to the local <code>.venv</code>. It works once, but then future builds do not copy the binary into the virtualenv. I am not sure if this is 100% UV's fault, but it seems worth reporting as I suspect many folks will be using pyo3, maturin, uv, and rust to build performant libraries going forward. Below is an example toml file.</p>
<p>my work around was to chain these commands:
<code>rm -fr .venv; uv clean; uv build; uv run ipython</code>
Note: the clean was very needed.</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;maturin&gt;=1.7,&lt;2.0&quot;]
build-backend = &quot;maturin&quot;

[project]
name = &quot;factors-py&quot;
requires-python = &quot;&gt;=3.8&quot;
classifiers = [
    &quot;Programming Language :: Rust&quot;,
    &quot;Programming Language :: Python :: Implementation :: CPython&quot;,
    &quot;Programming Language :: Python :: Implementation :: PyPy&quot;,
]
dynamic = [&quot;version&quot;]
dependencies = [
    &quot;ipython&gt;=8.12.3&quot;,
    &quot;maturin&gt;=1.7.4&quot;,
]
[tool.maturin]
features = [&quot;pyo3/extension-module&quot;]

[dependency-groups]
dev = [
    &quot;pip&gt;=24.3.1&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 01:15</div>
            <div class="timeline-body"><p>Are you looking for <code>uv sync</code>? <code>uv build</code> doesn't install the package; it just builds it into a distribution that you can then publish to a registry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-18 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zwing99">@zwing99</a> on 2024-11-18 02:47</div>
            <div class="timeline-body"><p>I did try a <code>uv sync</code> and it does not update the binary part of the package. after the <code>uv build</code> and <code>uv sync</code> I tried a <code>ls -la .venv/path/to_lib/</code> and see that the built binary had not been updated. I could also confirm with <code>println!</code> statements</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 02:49</div>
            <div class="timeline-body"><p>We don't rebuild on source change by default. You need to use <code>--reinstall-package factors-py</code>, or add <code>reinstall-package = [ &quot;factors-py&quot;]</code> to the <code>pyproject.toml</code> under <code>tool.uv</code>, or define a cache key: https://docs.astral.sh/uv/reference/settings/#cache-keys.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 02:51</div>
            <div class="timeline-body"><p>You can read more about dynamic builds here: https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zwing99">@zwing99</a> on 2024-11-18 03:06</div>
            <div class="timeline-body"><p>Cache keys was the trick! Thanks for the fast response! Love this project! Thanks for being an engaged maintainer.</p>
<pre><code class="language-toml">cache-keys = [{file = &quot;pyproject.toml&quot;}, {file = &quot;requirements.txt&quot;}, {git = {commit = true}}, {file = &quot;**/*.rs&quot;}]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zwing99 on 2024-11-18 03:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-18 04:02</div>
            <div class="timeline-body"><p>Thank you! :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
