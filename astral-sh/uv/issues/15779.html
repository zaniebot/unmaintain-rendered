<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependency groups ignore `project.name` and tries to pull it from registry - astral-sh/uv #15779</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Dependency groups ignore <code>project.name</code> and tries to pull it from registry</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15779">#15779</a>
        opened by <a href="https://github.com/ZzEeKkAa">@ZzEeKkAa</a>
        on 2025-09-10 21:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ZzEeKkAa">@ZzEeKkAa</a></div>
            <div class="timeline-body">Summary
<p>I want to include project&#x27;s extra into a dependency group, but it looks like uv ignores it and tries to pull the project from registry.</p>
<p><code>pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;uv_test&quot;
version = &quot;0.0.1&quot;

[project.optional-dependencies]
foo = [&quot;foo&gt;=1.0.0&quot;]

[dependency-groups]
foo = [&quot;uv_test[foo]&quot;]
</code></pre>
<pre><code>uv pip compile -o pylock.foo-group.toml --group foo pyproject.toml
</code></pre>
<p>results into a lock file with a dependency:</p>
<pre><code>[[packages]]
name = &quot;uv-test&quot;
version = &quot;0.1.0&quot;
sdist = { url = &quot;https://files.pythonhosted.org/packages/70/8b/ac9819d2d6c2071b8e2bbafc37943013d8e7cdad669eea27fbf00e20acd3/uv_test-0.1.0.tar.gz&quot;, upload-time = 2024-11-01T07:12:39Z, size = 27479, hashes = { sha256 = &quot;d0b75903d4e479a1dde7d13600bb49b3102e13661e7786ea1b7bcaa88c334dbd&quot; } }
wheels = [{ url = &quot;https://files.pythonhosted.org/packages/23/9a/677b8c914aeb441458d6af75aaac6b7bf9dc1809016aec92054b4ac872da/uv_test-0.1.0-py3-none-any.whl&quot;, upload-time = 2024-11-01T07:18:02Z, size = 1339, hashes = { sha256 = &quot;784c63e7fc406a312bf768407c0a029cdaded028e82fc6e4e7452c1d493cc879&quot; } }]
</code></pre>
<p>However,</p>
<pre><code>uv pip compile -o pylock.foo-extra.toml --extra foo pyproject.toml
</code></pre>
<p>fails due to</p>
<pre><code>× No solution found when resolving dependencies:
  ╰─▶ Because there are no versions of foo and uv-test depends on foo&gt;=1.0.0, we can conclude that your requirements are unsatisfiable.
</code></pre>
<p>which is correct, since there is no <code>foo&gt;=1.0.0</code> package in registry</p>
<p>So I see here 2 issues:</p>
<ol>
<li>dependency group resolution ignores project name and looks registry</li>
<li>extra dependency is ignored if not found with only a warning (<code>warning: The package </code>uv-test==0.1.0<code>does not have an extra named</code>foo`), however it feels like it should be an error</li>
</ol>
<p>This could explain <a href="https://github.com/astral-sh/uv/issues/14645">astral-sh/uv#14645</a> issue</p>
Platform
<p>Ubuntu 20.04</p>
Version
<p>uv 0.8.16</p>
Python version
<p>Python 3.11.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ZzEeKkAa">@ZzEeKkAa</a> on 2025-09-10 21:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-10 21:41</div>
            <div class="timeline-body"><p>When using the <code>pyproject.toml</code> as an input to <code>uv pip compile</code>, you are not including the project itself, just its dependencies, so uv does not know the project is local.</p>
<p>I think you want <code>uv export</code> instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-10 21:41</div>
            <div class="timeline-body"><p>Regarding (2), this is very common in Python packaging, otherwise it&#x27;s a breaking change for projects to remove extras.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ZzEeKkAa">@ZzEeKkAa</a> on 2025-09-10 21:48</div>
            <div class="timeline-body"><blockquote>
<p>When using the <code>pyproject.toml</code> as an input to <code>uv pip compile</code>, you are not including the project itself, just its dependencies, so uv does not know the project is local.</p>
</blockquote>
<p>I can argue that. If we add <code>bar = [&quot;uv_test[foo]&quot;]</code> to <code>project.optional-dependencies</code>, I&#x27;m getting exactly same issue as with foo:</p>
<pre><code>uv pip compile -o pylock.bar-extra.toml --extra bar pyproject.toml
  × No solution found when resolving dependencies:
  ╰─▶ Because there are no versions of foo and uv-test depends on foo&gt;=1.0.0, we can conclude that your requirements are unsatisfiable.
</code></pre>
<p>That means if referred to itself from <code>project.optional-dependencies</code> it knows about itself, but from <code>dependency-groups</code> - it does not</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-10 22:02</div>
            <div class="timeline-body"><p>mm that&#x27;s a good point! I&#x27;m still not sure it should work, but... the distinction is sort of subtle. I&#x27;ll need to think about it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ZzEeKkAa">@ZzEeKkAa</a> on 2025-09-10 22:13</div>
            <div class="timeline-body"><p>Thank you! Unfortunately there is not WAR for this. The way around is <a href="https://peps.python.org/pep-0735/#why-not-support-dependency-group-includes-in-project-dependencies-or-project-optional-dependencies">deferred</a> for now and duplicating the list of dependencies is highly undesirable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-11 01:58</div>
            <div class="timeline-body"><p>Doesn&#x27;t <code>uv export</code> work though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-14 12:59</div>
            <div class="timeline-body"><p>We&#x27;re already resolving the package name, but we drop it again instead of using it in the resolver. We need to keep the package name -&gt; local directory URL association around. I confirmed that this is possible by using a constraint (https://github.com/astral-sh/uv/compare/main...konsti/keep-source-tree-around), but we should solve this properly, for example in the lookahead resolver.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:19 UTC
    </footer>
</body>
</html>
