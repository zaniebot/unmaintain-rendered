<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` should lock (unless `--locked` is provided) - astral-sh/uv #4812</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv sync</code> should lock (unless <code>--locked</code> is provided)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4812">#4812</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-07-04 17:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p><em>No description provided.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-07-04 17:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-07-04 17:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-07-04 22:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-07-08 20:17</div>
            <div class="timeline-body"><p>Just wanted to make sure this wasn't a typo... if locking is implicit shouldn't the command be <code>uv sync --no-lock</code> or <code>uv sync --without-lock</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-07-08 20:50</div>
            <div class="timeline-body"><p><code>--locked</code> follows Cargo's command line interface, meaning assert the lock file would not change.<code>--no-lock</code> feels ambiguous as it might hint that we won't read or update the lock file â€” which isn't true.</p>
<p>Here's their help menu:</p>
<pre><code>      --locked                Assert that `Cargo.lock` will remain unchanged
      --offline               Run without accessing the network
      --frozen                Equivalent to specifying both --locked and --offline
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-07-08 21:12</div>
            <div class="timeline-body"><p>Ahh I see, so <code>--locked</code> would imply that the lockfile is &quot;locked&quot; and be a signal to <em>not</em> update it. Got it.</p>
<p>I am used to the <code>ruff</code> CLI with <code>ruff check --no-fix</code> / <code>ruff check --fix</code> so my brain tripped up.</p>
<p>Is parity with cargo something you guys are shooting for? Personally I'm not sure how much overlap there is between Rustaceans and Pythonistas... I wish the <a href="https://www.tiobe.com/tiobe-index/">TIOBE index</a> showed multilingual demographics. I'm a Python/C++ guy myself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-09 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-07-09 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/provinzkraut">@provinzkraut</a> on 2024-11-23 12:09</div>
            <div class="timeline-body"><p>@charliermarsh For my own understanding, could you explain why it should lock by default?</p>
<p>This was rather unexpected to me, as it deviates from the behaviour of most other package managers, and for most projects, it's almost never the desired default behaviour.</p>
<p>I see that it makes sense for a <code>sync</code> command to also sync the lockfile, but seeing as there's no separate <code>install</code> command that just install everything from the lockfile, running <code>uv sync</code> without <code>--locked</code> / <code>--frozen</code> seems to defeat one of the purposes of a lockfile: Consistent installs.
When I tell someone to check out my branch and run something, I'd like them to have the same packages installed as I do. Implicit updates is something I virtually never want, and might be consider a footgun instead :eyes:</p>
<p>This extends to other commands such as <code>uv run</code>, where I'd argue this is even more unexpected. For example, what is the benefit of e.g. <code>uv run pytest</code> updating my dependencies? If I execute that command twice in a row, I would expected to not to run into any issues, but it could actually update my dependencies on the second run, breaking my test suite :see_no_evil:</p>
<p>Am I missing something here? Am I using uv wrong?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-23 13:00</div>
            <div class="timeline-body"><p>It generally matches Cargo, as an example. We <em>only</em> update the lockfile if it's out-of-sync with the <code>pyproject.toml</code>, i.e., if you've added a new dependency. We don't update arbitrary dependencies on <code>uv sync</code> or <code>uv run</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-23 13:00</div>
            <div class="timeline-body"><blockquote>
<p>If I execute that command twice in a row, I would expected to not to run into any issues, but it could actually update my dependencies on the second run, breaking my test suite.</p>
</blockquote>
<p>As an example: this wouldn't happen unless you changed your dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/provinzkraut">@provinzkraut</a> on 2024-11-23 13:18</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>If I execute that command twice in a row, I would expected to not to run into any issues, but it could actually update my dependencies on the second run, breaking my test suite.</p>
</blockquote>
<p>As an example: this wouldn't happen unless you changed your dependencies.</p>
</blockquote>
<p>Hm. That is the behaviour I've expected, but not the one I've experienced in a few cases. So, if <code>uv run</code> would update the lockfile without a change to the dependencies in <code>pyproject.toml</code>, that would be considered a bug? In that case, the next time this happens I'll investigate / open an issue if I can reproduce this somehow</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/provinzkraut">@provinzkraut</a> on 2024-11-23 13:19</div>
            <div class="timeline-body"><blockquote>
<p>It generally matches Cargo, as an example. We <em>only</em> update the lockfile if it's out-of-sync with the <code>pyproject.toml</code>, i.e., if you've added a new dependency. We don't update arbitrary dependencies on <code>uv sync</code> or <code>uv run</code>.</p>
</blockquote>
<p>Thanks for the clarification! So my expectations were correct, it's just that either I've misconfigured something somewhere, or found a bug :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:29 UTC
    </footer>
</body>
</html>
