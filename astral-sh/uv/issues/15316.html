<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installing deep_ep and deep_gemm - astral-sh/uv #15316</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Installing deep_ep and deep_gemm</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15316">#15316</a>
        opened by <a href="https://github.com/vwxyzjn">@vwxyzjn</a>
        on 2025-08-15 20:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vwxyzjn">@vwxyzjn</a> on 2025-08-15 20:28</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hi <code>uv</code> team,</p>
<p>Was wondering if there are instructions on installing the following packages more easily. Thanks!&gt;</p>
<p>https://github.com/deepseek-ai/DeepEP</p>
<p>https://github.com/deepseek-ai/DeepGEMM</p>
<h3>Platform</h3>
<p><em>No response</em></p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @vwxyzjn on 2025-08-15 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Building deep_ep and deep_gemm" to "Installing deep_ep and deep_gemm" by @vwxyzjn on 2025-08-15 20:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-08-16 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-16 16:27</div>
            <div class="timeline-body"><p>For DeepEP:</p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
description = &quot;...&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;deep_ep&quot;, &quot;torch&quot;]

[tool.uv.sources]
deep_ep = { git = &quot;https://github.com/deepseek-ai/DeepEP&quot; }

[tool.uv.extra-build-dependencies]
deep_ep = [{ requirement = &quot;torch&quot;, match-runtime = true }]
</code></pre>
<p>For DeepGEMM:</p>
<pre><code class="language-toml">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
description = &quot;...&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;deep_gemm&quot;, &quot;torch&quot;]

[tool.uv.sources]
deep_gemm = { git = &quot;https://github.com/deepseek-ai/DeepGEMM&quot; }

[tool.uv.extra-build-dependencies]
deep_gemm = [{ requirement = &quot;torch&quot;, match-runtime = true }]
</code></pre>
<p>And then you can <code>uv sync</code> to install.</p>
<p>The only hitch is that you need the CUDA development toolkit (<code>apt-get -y install cuda-toolkit-12-8</code> or similar) in order to build these.</p>
<p>I'll be including these in the updated build docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15326.html">astral-sh/uv#15326</a> on 2025-08-16 16:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vwxyzjn">@vwxyzjn</a> on 2025-08-16 17:45</div>
            <div class="timeline-body"><p>You are my hero Charlie! It works! Thanks.</p>
<p><img width="1303" height="651" alt="Image" src="https://github.com/user-attachments/assets/78ccf841-5980-49d5-883d-a819383171dd" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vwxyzjn">@vwxyzjn</a> on 2025-08-16 21:05</div>
            <div class="timeline-body"><p>When running <code>https://github.com/deepseek-ai/DeepEP/blob/main/tests/test_internode.py</code> I got ðŸ‘€</p>
<pre><code>ubuntu@costa-dev-worker-0:~/code/thirdparty/test_uv$ uv run test_internode.py
warning: The `extra-build-dependencies` option is experimental and may change without warning. Pass `--preview-features extra-build-dependencies` to disable this warning.
/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/torch/_subclasses/functional_tensor.py:279: UserWarning: Failed to initialize NumPy: No module named 'numpy' (Triggered internally at /pytorch/torch/csrc/utils/tensor_numpy.cpp:81.)
  cpu = _conversion_method_template(device=torch.device(&quot;cpu&quot;))
Traceback (most recent call last):
  File &quot;/home/ubuntu/code/thirdparty/test_uv/test_internode.py&quot;, line 8, in &lt;module&gt;
    import deep_ep
  File &quot;/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/deep_ep/__init__.py&quot;, line 3, in &lt;module&gt;
    from .utils import EventOverlap
  File &quot;/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/deep_ep/utils.py&quot;, line 8, in &lt;module&gt;
    from deep_ep_cpp import Config, EventHandle
ImportError: /home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/deep_ep_cpp.cpython-312-x86_64-linux-gnu.so: undefined symbol: __cudaRegisterLinkedBinary_52358193_10_runtime_cu_a457eb97
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vwxyzjn">@vwxyzjn</a> on 2025-08-16 21:17</div>
            <div class="timeline-body"><p>I think it's because https://github.com/deepseek-ai/DeepEP?tab=readme-ov-file#download-and-install-nvshmem-dependency.</p>
<p>I was able to make progress in</p>
<pre><code class="language-bash">[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
description = &quot;...&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;deep_ep&quot;, &quot;deep_gemm&quot;, &quot;torch&quot;, &quot;nvidia-nvshmem-cu12&quot;]

[tool.uv.sources]
deep_ep = { git = &quot;https://github.com/deepseek-ai/DeepEP&quot; }
deep_gemm = { git = &quot;https://github.com/deepseek-ai/DeepGEMM&quot; }


[tool.uv.extra-build-dependencies]
deep_ep = [{ requirement = &quot;torch&quot;, match-runtime = true }, { requirement = &quot;nvidia-nvshmem-cu12&quot;, match-runtime = true }]
deep_gemm = [{ requirement = &quot;torch&quot;, match-runtime = true }, { requirement = &quot;nvidia-nvshmem-cu12&quot;, match-runtime = true }]
</code></pre>
<p>Now the error becomes</p>
<pre><code>ubuntu@costa-dev-worker-0:~/code/thirdparty/test_uv$ uv run test.py
warning: The `extra-build-dependencies` option is experimental and may change without warning. Pass `--preview-features extra-build-dependencies` to disable this warning.
/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/torch/_subclasses/functional_tensor.py:279: UserWarning: Failed to initialize NumPy: No module named 'numpy' (Triggered internally at /pytorch/torch/csrc/utils/tensor_numpy.cpp:81.)
  cpu = _conversion_method_template(device=torch.device(&quot;cpu&quot;))
Traceback (most recent call last):
  File &quot;/home/ubuntu/code/thirdparty/test_uv/test.py&quot;, line 8, in &lt;module&gt;
    import deep_ep
  File &quot;/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/deep_ep/__init__.py&quot;, line 3, in &lt;module&gt;
    from .utils import EventOverlap
  File &quot;/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/deep_ep/utils.py&quot;, line 8, in &lt;module&gt;
    from deep_ep_cpp import Config, EventHandle
ImportError: libnvshmem_host.so.3: cannot open shared object file: No such file or directory
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vwxyzjn">@vwxyzjn</a> on 2025-08-16 21:28</div>
            <div class="timeline-body"><p>Looks like a bug on the <code>deep_ep</code> side somehow:</p>
<pre><code>&gt;&gt;&gt; import importlib.util
&gt;&gt;&gt; nvshmem_dir = importlib.util.find_spec(&quot;nvidia.nvshmem&quot;).submodule_search_locations[0]
/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/nvidia/nvshmem/lib/

ImportError: libnvshmem_host.so.3: cannot open shared object file: No such file or directory

 ls /home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/nvidia/nvshmem/lib/
libnvshmem_device.a               nvshmem_bootstrap_pmi.so.3        nvshmem_bootstrap_uid.so.3        nvshmem_transport_libfabric.so.3
libnvshmem_device.bc              nvshmem_bootstrap_pmi2.so.3       nvshmem_transport_ibdevx.so.3     nvshmem_transport_ucx.so.3
libnvshmem_host.so.3              nvshmem_bootstrap_pmix.so.3       nvshmem_transport_ibgda.so.3
nvshmem_bootstrap_mpi.so.3        nvshmem_bootstrap_shmem.so.3      nvshmem_transport_ibrc.so.3
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vwxyzjn">@vwxyzjn</a> on 2025-08-16 21:33</div>
            <div class="timeline-body"><p>On the other hand it appears the <code>deep_gemm</code> installation was successful: https://github.com/deepseek-ai/DeepGEMM/blob/main/tests/test_layout.py</p>
<p><img width="1462" height="495" alt="Image" src="https://github.com/user-attachments/assets/2b15738e-2f71-4c1f-aa80-f6065b6bac09" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vwxyzjn">@vwxyzjn</a> on 2025-08-16 21:43</div>
            <div class="timeline-body"><pre><code>ubuntu@costa-dev-worker-0:~/code/thirdparty/test_uv$ uv run test_low_latency.py
warning: The `extra-build-dependencies` option is experimental and may change without warning. Pass `--preview-features extra-build-dependencies` to disable this warning.
Traceback (most recent call last):
  File &quot;/home/ubuntu/code/thirdparty/test_uv/test_low_latency.py&quot;, line 11, in &lt;module&gt;
    import deep_ep
  File &quot;/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/deep_ep/__init__.py&quot;, line 3, in &lt;module&gt;
    from .utils import EventOverlap
  File &quot;/home/ubuntu/code/thirdparty/test_uv/.venv/lib/python3.12/site-packages/deep_ep/utils.py&quot;, line 8, in &lt;module&gt;
    from deep_ep_cpp import Config, EventHandle
ImportError: libnvshmem_host.so.3: cannot open shared object file: No such file or directory
ubuntu@costa-dev-worker-0:~/code/thirdparty/test_uv$ export NVSHMEM_DIR=$(uv run python -c &quot;import importlib.util; print(importlib.util.find_spec('nvidia.nvshmem').submodule_search_locations[0])&quot;)  # Use for DeepEP installation
export LD_LIBRARY_PATH=&quot;${NVSHMEM_DIR}/lib:$LD_LIBRARY_PATH&quot;
warning: The `extra-build-dependencies` option is experimental and may change without warning. Pass `--preview-features extra-build-dependencies` to disable this warning.
ubuntu@costa-dev-worker-0:~/code/thirdparty/test_uv$
ubuntu@costa-dev-worker-0:~/code/thirdparty/test_uv$ uv run test_low_latency.py
warning: The `extra-build-dependencies` option is experimental and may change without warning. Pass `--preview-features extra-build-dependencies` to disable this warning.
</code></pre>
<p>Whohoo it works. The key is to follow https://github.com/deepseek-ai/DeepEP/blob/main/third-party/README.md#post-installation-configuration. In particular, you'd need to run</p>
<pre><code>export NVSHMEM_DIR=$(uv run python -c &quot;import importlib.util; print(importlib.util.find_spec('nvidia.nvshmem').submodule_search_locations[0])&quot;)  # Use for DeepEP installation
export LD_LIBRARY_PATH=&quot;${NVSHMEM_DIR}/lib:$LD_LIBRARY_PATH&quot;
uv run test_low_latency.py
</code></pre>
<p><img width="1483" height="891" alt="Image" src="https://github.com/user-attachments/assets/f09652ca-9e83-4c28-9e94-a09fe0b86574" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-16 21:50</div>
            <div class="timeline-body"><p>Amazing, thanks for following up! I'll incorporate some of this into the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-08-18 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/billxbf">@billxbf</a> on 2025-12-13 16:58</div>
            <div class="timeline-body"><p>crazy we got the same problem here @vwxyzjn getting hands on deepseek</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
