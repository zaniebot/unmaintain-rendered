<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv add and uv sync doesn't install packages in virtual env created by uv venv &lt;custom venv name&gt; but creates the default .venv - astral-sh/uv #8878</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv add and uv sync doesn't install packages in virtual env created by uv venv &lt;custom venv name&gt; but creates the default .venv</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8878">#8878</a>
        opened by <a href="https://github.com/amanchaudhary-95">@amanchaudhary-95</a>
        on 2024-11-07 05:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/amanchaudhary-95">@amanchaudhary-95</a> on 2024-11-07 05:39</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Current uv version: uv 0.4.29 (85f9a0d0e 2024-10-30)
OS: Windows 11</p>
<p>I created a project using <code>uv init</code> and then created a venv with the name &quot;Temp_Venv&quot; inside that project using <code>uv venv Temp_Venv</code>, the environment was created perfectly. After that, I activated the newly created environment and tried to add python package using <code>uv add pandas</code>, it did not install the package in the activated environment instead it created a new environment with the name .venv and installed the package in that environment. It does the same even after setting the <code>VIRTUAL_ENV=D:\Test\Test_Venv\Temp_Venv</code>.</p>
<h3>Steps to reproduce:</h3>
<p>Step 1: Init a Project with <code>uv init Test_Venv</code></p>
<p>Step 2: Change the directory and create a venv with a custom name of 'Temp_Venv' in that project
<code>cd .\Test_Venv\</code>
<code>uv venv Temp_Venv</code></p>
<p>Step 3: Activate the newly created venv
<code>.\Temp_Venv\Scripts\activate</code></p>
<p>Step 4: Add a package using uv add
<code>uv add pandas</code></p>
<p>It will give a warning
<code>warning: `VIRTUAL_ENV=Temp_Venv` does not match the project environment path `.venv` and will be ignored</code>
and it will create a new venv with a default name .venv and it will add the package in this .venv env and not in the activated <code>Temp_Venv</code></p>
<p>I also tried to set the <code>VIRTUAL_ENV</code> path but still got the same result</p>
<p>Screenshot:
<img src="https://github.com/user-attachments/assets/7953245d-d48a-4088-bdde-d7edd030a8d4" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nlohmann">@nlohmann</a> on 2024-11-07 09:26</div>
            <div class="timeline-body"><p>Same issue when using</p>
<pre><code class="language-shell">uv venv venv
source venv/bin/activate
uv sync
</code></pre>
<p>Output of the last command:</p>
<pre><code>warning: `VIRTUAL_ENV=venv` does not match the project environment path `.venv` and will be ignored
Using CPython 3.13.0 interpreter at: /opt/homebrew/opt/python@3.13/bin/python3.13
Creating virtual environment at: .venv
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/berislavlopac">@berislavlopac</a> on 2024-11-07 11:01</div>
            <div class="timeline-body"><p>The documentation says that <code>uv</code> does not respect the <code>VIRTUAL_ENV</code> variable, which I find very annoying; see https://docs.astral.sh/uv/concepts/projects/#configuring-the-project-environment-path</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 13:20</div>
            <div class="timeline-body"><p>The top-level project commands (<code>uv sync</code>, <code>uv lock</code>, <code>uv run</code>, <code>uv tree</code>, <code>uv export</code>) always use <code>.venv</code>. It's intentional and that's why you're seeing a warning to make you aware of the behavior. You can set <code>UV_PROJECT_ENVIRONMENT</code> to use something else, though it's largely intended for use in continuous integration and other environments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-07 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nlohmann">@nlohmann</a> on 2024-11-07 13:24</div>
            <div class="timeline-body"><p>I see. It might be intentional, but it's currently blocking the adoption of uv in a project, because all existing documentation and CI pipelines assume <code>venv</code> to be the path, and changing all this to <code>.venv</code> is too much effort. Maybe on top of the warning, a parameter to override this behavior could be helpful.</p>
<p>In the meantime, is there a way to set the project environment in pyproject.toml?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 13:28</div>
            <div class="timeline-body"><p>No, we don't expose it in the <code>pyproject.toml</code> though I'll let @zanieb comment on whether we'd add that. We're intentionally pushing to standardize on this naming scheme in these new APIs. (The <code>uv pip</code> APIs work with other environments without an issue.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/berislavlopac">@berislavlopac</a> on 2024-11-07 13:55</div>
            <div class="timeline-body"><p>@charliermarsh I'm curious why was it decided not to honour that variable? It's a pretty standard solution, and it's a common practice to manage the environment separately from the packaging and dependency management.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 13:58</div>
            <div class="timeline-body"><p>We honor it in <code>uv pip</code> but not the project APIs, which is based around a more opinionated workflow. There's context on it here: https://github.com/astral-sh/uv/pull/6834.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/berislavlopac">@berislavlopac</a> on 2024-11-07 14:15</div>
            <div class="timeline-body"><p>OK, fair enough, I understand the decision. I'm not sure yet whether I agree with it, but I'll try playing with uv without an active environment and decide based on how much that affects my workflow (having to put <code>uv run</code> in front of every command is a bit annoying and goes against my muscle memory, but I can think of a few workarounds).</p>
<p>The only other thing I can think of might be to include a configuration option to prevent running a command if there is an activated environment (or at least to add a confirmation prompt, instead of just a warning); I'd prefer to have some control when an environment is created.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-07 14:28</div>
            <div class="timeline-body"><blockquote>
<p>No, we don't expose it in the <code>pyproject.toml</code> though I'll let @zanieb comment on whether we'd add that.</p>
</blockquote>
<p>No we're not planning on adding it to the <code>pyproject.toml</code>; I don't think the project should be able to declare where the developer stores the virtual environment. We might add support in the <code>uv.toml</code> though.</p>
<blockquote>
<p>all existing documentation and CI pipelines assume venv to be the path</p>
</blockquote>
<p>Why does the virtual environment need to be discoverable at a hard-coded path? Just want to try to understand the use-case.</p>
<blockquote>
<p>I'll try playing with uv without an active environment and decide based on how much that affects my workflow (having to put uv run in front of every command is a bit annoying and goes against my muscle memory, but I can think of a few workarounds).</p>
</blockquote>
<p>You can definitely activate the environment still.</p>
<blockquote>
<p>and changing all this to .venv is too much effort.</p>
</blockquote>
<p>Does <code>UV_PROJECT_ENVIRONMENT</code> not work for you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/berislavlopac">@berislavlopac</a> on 2024-11-07 15:11</div>
            <div class="timeline-body"><blockquote>
<p>You can definitely activate the environment still.</p>
</blockquote>
<p>Oh, of course; it's just that in my case a couple of uv's idiosyncracies collide with my usual setup. But as I said, I can think of a few workarounds; I'll know more when I try them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amanchaudhary-95">@amanchaudhary-95</a> on 2024-11-08 07:09</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>No, we don't expose it in the <code>pyproject.toml</code> though I'll let @zanieb comment on whether we'd add that.</p>
</blockquote>
<p>No we're not planning on adding it to the <code>pyproject.toml</code>; I don't think the project should be able to declare where the developer stores the virtual environment. We might add support in the <code>uv.toml</code> though.</p>
<blockquote>
<p>all existing documentation and CI pipelines assume venv to be the path</p>
</blockquote>
<p>Why does the virtual environment need to be discoverable at a hard-coded path? Just want to try to understand the use-case.</p>
<blockquote>
<p>I'll try playing with uv without an active environment and decide based on how much that affects my workflow (having to put uv run in front of every command is a bit annoying and goes against my muscle memory, but I can think of a few workarounds).</p>
</blockquote>
<p>You can definitely activate the environment still.</p>
<blockquote>
<p>and changing all this to .venv is too much effort.</p>
</blockquote>
<p>Does <code>UV_PROJECT_ENVIRONMENT</code> not work for you?</p>
</blockquote>
<p>Hi @zanieb, I also tried setting the <code>UV_PROJECT_ENVIRONMENT</code> variable as an absolute path as <code>set UV_PROJECT_ENVIRONMENT=D:\Test\Test_Venv\Temp_Venv</code> and as relative path as <code>set UV_PROJECT_ENVIRONMENT=Temp_Venv</code> but I'm still getting the same warning. Packages are added in the autocreated <code>.venv</code> environment
<img src="https://github.com/user-attachments/assets/4bf22b6a-eb19-4197-98ed-1e5787e6364d" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nlohmann">@nlohmann</a> on 2024-11-08 07:17</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>all existing documentation and CI pipelines assume venv to be the path</p>
</blockquote>
<p>Why does the virtual environment need to be discoverable at a hard-coded path? Just want to try to understand the use-case.</p>
</blockquote>
<p>We have a very heavy Makefile that has targets for a lot of jobs such as creating a virtual environment, execute tests, etc. That Makefile predates tools like uv and is used in multiple projects to unify the workflows. As such <code>venv</code> is hardcoded there and then also assumed as path in the CI jobs. This is not nice and I want to modernize this with tools like uv. For this, I don't want to touch too much, and it would be much easier for me to just keep the virtual environment at <code>venv</code>.</p>
<blockquote>
<blockquote>
<p>and changing all this to .venv is too much effort.</p>
</blockquote>
<p>Does <code>UV_PROJECT_ENVIRONMENT</code> not work for you?</p>
</blockquote>
<p>I don't control the developers environment variables, so I cannot assume that variable to be set. I can try to pull it into our Makefile, but rooting this to pyproject.toml would have been the easier choice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/reder2000">@reder2000</a> on 2025-01-27 18:08</div>
            <div class="timeline-body"><p>It is also really annoying because I cannot use uv add with pycharm or with different Python versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thomasaarholt">@thomasaarholt</a> on 2025-01-31 15:16</div>
            <div class="timeline-body"><p>@amanchaudhary-95 I get it to work by setting the <code>UV_PROJECT_ENVIRONMENT</code> env variable <em>equal</em> to the <code>VIRTUAL_ENV</code>. The important point is that <code>UV_PROJECT_ENVIRONMENT</code> needs to be a <strong>full path</strong>, or I guess relative to the current directory (as <code>.venv</code> would be).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/reder2000">@reder2000</a> on 2025-02-16 00:12</div>
            <div class="timeline-body"><p>pycharm just added official support for uv and it sucks because there is no way to choose where files are installed. (Poetry support sucks as well, but a bit differently)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-16 04:11</div>
            <div class="timeline-body"><p>We now support a <code>--active</code> flag on <code>uv sync</code>, <code>uv run</code>, etc.</p>
<p>(But we won't detect inactive environments with arbitrary names and won't detect active environments by default. See https://github.com/astral-sh/uv/issues/11273 for a non-CLI option)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-02-16 04:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jerakin">@Jerakin</a> on 2025-07-28 14:56</div>
            <div class="timeline-body"><p>I want package my project with <a href="https://github.com/pyinstaller/pyinstaller">pyinstaller</a>, and as my project is using a <a href="https://github.com/casey/just"><code>justfile</code></a> to run other commands I want to use it for this too. However, <code>just</code> runs each command in its own shell, meaning that if I activate a venv it will not be active in the other subsequent commands, meaning that <code>--active</code> doesn't work here.</p>
<p>I would have hoped there was a <code>uv sync --with-venv myvenv</code>, but given this discussion I don't think this would be something that the project would like to implement.</p>
<p>Have anyone used justfile with uv and non-default venvs with success?</p>
<p>Justfile command (which doesn't work)</p>
<pre><code>pyinstall:
  uv venv pyinstall
  pyinstall\Scripts\activate.bat
  uv sync --group build-exe
  uv run pyinstaller -y __main__.spec
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
