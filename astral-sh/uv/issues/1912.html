<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repeated timeouts in GitHub Actions fetching wheel for large packages - astral-sh/uv #1912</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Repeated timeouts in GitHub Actions fetching wheel for large packages</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1912">#1912</a>
        opened by <a href="https://github.com/adamtheturtle">@adamtheturtle</a>
        on 2024-02-23 13:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2024-02-23 13:11</div>
            <div class="timeline-body"><p>In the last few days since switching to <code>uv</code>, I have seen errors that I have not seen before with <code>pip</code>.</p>
<p>I see:</p>
<pre><code>error: Failed to download distributions
  Caused by: Failed to fetch wheel: torch==2.2.1
  Caused by: Failed to extract source distribution
  Caused by: request or response body error: operation timed out
  Caused by: operation timed out
Error: Process completed with exit code 2.
</code></pre>
<p>I see this on the CI for <a href="https://github.com/VWS-Python/vws-python-mock"><code>vws-python-mock</code></a>, which requires installing 150 packages:</p>
<pre><code>uv pip install --upgrade --editable .[dev]
...
Resolved 150 packages in 1.65s
Downloaded 141 packages in 21.41s
Installed 150 packages in 283ms
</code></pre>
<p>I do this in parallel across many jobs on GitHub Actions, mostly on <code>ubuntu-latest</code>.</p>
<p>This happened with <code>torch 2.2.0</code> before the recent release of <code>torch 2.2.1</code>.
It has not happened with any other dependencies.
The wheels for <code>torch</code> are pretty huge: https://pypi.org/project/torch/#files.</p>
<p><code>uv</code> is always at the latest version as I run <code>curl -LsSf https://astral.sh/uv/install.sh | sh</code>. In the most recent example, this is <code>uv 0.1.9</code>.</p>
<p>Failures:</p>
<ul>
<li>https://github.com/VWS-Python/vws-python-mock/actions/runs/8017894929/job/21902693117</li>
<li>https://github.com/VWS-Python/vws-python-mock/actions/runs/8000017693/job/21848747452</li>
<li>https://github.com/VWS-Python/vws-python-mock/actions/runs/8000017693/job/21848749557</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2024-02-23 13:15</div>
            <div class="timeline-body"><p>Perhaps I just need to use <code>UV_HTTP_TIMEOUT</code> and I will, but I thought that this might be worth pointing out:</p>
<ul>
<li>If so, the error message could helpfully point to <code>UV_HTTP_TIMEOUT</code></li>
<li>Perhaps the default is too small if using GitHub Actions + a popular package times out</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-02-23 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-23 17:08</div>
            <div class="timeline-body"><p>Thanks for the feedback, I've opened issues for your requests</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/1921</li>
<li>https://github.com/astral-sh/uv/issues/1922</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2024-02-23 17:20</div>
            <div class="timeline-body"><p>Thank you @zanieb ! I don't know the value of having this issue open, but I'll leave it to you to close if desired.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-23 17:28</div>
            <div class="timeline-body"><p>In #1921 my co-worker noted that this might be a bug in the way we're specifying the timeout so I'll recategorize this one and leave it open.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @zanieb on 2024-02-23 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-02-23 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @konstin on 2024-02-28 13:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-28 14:23</div>
            <div class="timeline-body"><p>Looking at the actions runs, all the passing actions take ~30s, while the failing ones error after 5min, which is our default timeout, so this looks like a network failure (in either github actions or rust)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-01 11:37</div>
            <div class="timeline-body"><p>I'm not seeing any timeouts anymore with the two most recent versions (https://github.com/konstin/vws-python-mock/actions). Could you check if this now solved?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2024-03-01 11:38</div>
            <div class="timeline-body"><p>I have not seen this issue since posting. Thank you for looking into this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-01 11:40</div>
            <div class="timeline-body"><p>I'll close it for now, please feel free to reopen should it reoccur</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-03-01 11:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2024-03-04 01:35</div>
            <div class="timeline-body"><p>@konstin I do not have permissions to re-open this issue. I can create a new one, but it is probably easier if you re-open this.</p>
<p>This failure has reoccurred:</p>
<ul>
<li>https://github.com/VWS-Python/vws-python-mock/actions/runs/8134588970/job/22227737289</li>
<li>https://github.com/VWS-Python/vws-python-mock/actions/runs/8134588970/job/22227737596</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @konstin on 2024-03-04 08:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @konstin by @konstin on 2024-03-04 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmc-cs-mdrissi">@hmc-cs-mdrissi</a> on 2024-03-05 03:23</div>
            <div class="timeline-body"><p>I'm seeing very similar error message for non pytorch package that's also pretty large. It's ~400 MB wheel and consistently gives me,</p>
<pre><code>(bento_uv2) pa-loaner@C02DVAQNMD6R training-platform % uv pip install --index-url=$REGISTRY_INDEX data-mesh-cli==0.0.66
error: Failed to download: data-mesh-cli==0.0.66
  Caused by: The wheel data_mesh_cli-0.0.66-py3-none-any.whl is not a valid zip file
  Caused by: an upstream reader returned an error: request or response body error: operation timed out
  Caused by: request or response body error: operation timed out
  Caused by: operation timed out
</code></pre>
<p>Package is company internal one though, but I think only notable thing is very large size (it vendors spark/java stuff).</p>
<p>edit: Pytorch weirdly installs fine for me pretty fast.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Repeated timeouts in GitHub Actions fetching wheel for `torch`" to "Repeated timeouts in GitHub Actions fetching wheel for large packages" by @adamtheturtle on 2024-03-13 09:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adamtheturtle">@adamtheturtle</a> on 2024-03-13 09:39</div>
            <div class="timeline-body"><p>I have changed the title of this to not reference <code>torch</code>. It recently happened with <code>nvidia-cudnn-cu12</code>, another large download.</p>
<p>As another example, https://github.com/VWS-Python/vws-python-mock/actions/runs/8262236134 has 7 failures in one run.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astrojuanlu">@astrojuanlu</a> on 2024-03-18 20:13</div>
            <div class="timeline-body"><p>It can happen on Read the Docs as well, not only GHA https://beta.readthedocs.org/projects/kedro-datasets/builds/23790543/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astrojuanlu">@astrojuanlu</a> on 2024-03-24 06:27</div>
            <div class="timeline-body"><p>Spotted it locally today inside a local Docker image running under QEMU</p>
<pre><code>error: Failed to download distributions
  Caused by: Failed to fetch wheel: nvidia-cublas-cu12==12.1.3.1
  Caused by: Failed to extract archive
  Caused by: Failed to download distribution due to network timeout. Try increasing UV_HTTP_TIMEOUT (current value: 300s).
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/njzjz">@njzjz</a> on 2024-04-19 22:12</div>
            <div class="timeline-body"><p>I encountered the problem when I used either uv or pip to download large wheels (for pip, the issue is https://github.com/pypa/pip/issues/4796 and https://github.com/pypa/pip/issues/11153), so I think the root cause is the network. However, I am wondering if uv can be smarter to retry automatically, like something in https://github.com/pypa/pip/pull/11180.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astrojuanlu">@astrojuanlu</a> on 2024-04-20 06:56</div>
            <div class="timeline-body"><p>Worth trying 0.1.35, which includes https://github.com/astral-sh/uv/pull/3144</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-21 15:32</div>
            <div class="timeline-body"><p>It seems likely that this is resolved by #3144</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/OneCyrus">@OneCyrus</a> on 2024-04-25 20:20</div>
            <div class="timeline-body"><blockquote>
<p>I encountered the problem when I used either uv or pip to download large wheels (for pip, the issue is https://github.com/pypa/pip/issues/4796 and https://github.com/pypa/pip/issues/11153), so I think the root cause is the network. However, I am wondering if uv can be smarter to retry automatically, like something in https://github.com/pypa/pip/pull/11180.</p>
</blockquote>
<p>that would be a great feature. we have our dev environments behind TLS inspection and some packages often run into a timeout due too slow inspection. we can reproduce this with a browser and the download gets stuck until a timeout. in the browser we can just click resume and the browser reconnects snd downloads the remaining part. with uv we don't have a retry with resume. so it starts from scratch and gets stuck again.</p>
<p>+1 for retry with resume</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-01 16:33</div>
            <div class="timeline-body"><p>Going to close for now, but we can re-open if this comes up again post-changing the timeout semantics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-01 16:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:33:57 UTC
    </footer>
</body>
</html>
