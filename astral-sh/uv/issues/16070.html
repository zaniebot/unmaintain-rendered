<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Need for universal resolution when running `uv run --python 3.xx`? - astral-sh/uv #16070</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Need for universal resolution when running `uv run --python 3.xx`?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16070">#16070</a>
        opened by <a href="https://github.com/mancellin">@mancellin</a>
        on 2025-09-30 09:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mancellin">@mancellin</a> on 2025-09-30 09:01</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I encountered an issue when testing a package depending on Numpy on nightly builds. See below for an MRE.</p>
<pre><code class="language-toml">[project]
name = &quot;spam-eggs&quot;
version = &quot;0.1&quot;
requires-python = &quot;&gt;= 3.8&quot;
dependencies = [&quot;numpy&quot;]

[dependency-groups]
test = [&quot;pytest&quot;]
</code></pre>
<pre><code class="language-shell">uv run \
    --isolated \
    --group test \
    --pre --extra-index-url https://pypi.anaconda.org/scientific-python-nightly-wheels/simple \
    --python 3.13 \
    python -c 'print(&quot;Testing...&quot;)'
</code></pre>
<p>It fails because the universal resolution cannot find a Numpy version compatible with Python 3.8 on the nightly-wheels index.
I managed to work around this by adding the <code>--index-strategy unsafe-best-match</code> option, making <code>uv</code> use the metadata from PyPI for the universal resolution.</p>
<p>I'm questioning whether it was necessary to run the universal resolution in the first place, given that I only need a single-use environment with a fixed version of Python (<code>uv run --isolated --python 3.13</code>).
Having a way to skip the universal resolution would make my config clearer than the <code>index-strategy</code> setting, but there does not seem to be one.</p>
<h3>Platform</h3>
<p>Ubuntu 22.04</p>
<h3>Version</h3>
<p>0.8.22</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @mancellin on 2025-09-30 09:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-30 10:37</div>
            <div class="timeline-body"><p>There's currently no good support for the scenario of only using a wheel from a different index for a specific run. One option is to use <code>uv pip install</code> instead of <code>uv run</code> to install the nightly numpy for this test run specifically. The project mode solution would be using pypi or the nightly index for numpy using <a href="https://docs.astral.sh/uv/concepts/projects/config/#conflicting-dependencies">conflicting dependencies</a>, which adds a lot of complexity.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mancellin">@mancellin</a> on 2025-10-10 07:58</div>
            <div class="timeline-body"><p>Thank you for your answer.</p>
<p>What might be missing is a way to occasionally use <code>uv run --python 3.13</code> without universal resolution (since I'm only interested in 3.13).
<code>uv run --no-project</code> works, but then I lose the access to <code>--group test</code>.</p>
<p>The workaround I've found is to use <code>uv pip compile</code> which does not use the universal resolution by default:</p>
<pre><code class="language-bash">EXTRA_ARGS=&quot;--pre --extra-index-url https://pypi.anaconda.org/scientific-python-nightly-wheels/simple --python 3.13&quot;
uv pip compile pyproject.toml --group test $EXTRA_ARGS -o /tmp/requirements.txt
uv run --no-project $EXTRA_ARGS --with-requirements /tmp/requirements.txt python -c 'print(&quot;Hello World&quot;)'

</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:13 UTC
    </footer>
</body>
</html>
