<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install `azure-cli` with `uv` fails - astral-sh/uv #4685</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Install `azure-cli` with `uv` fails</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4685">#4685</a>
        opened by <a href="https://github.com/baggiponte">@baggiponte</a>
        on 2024-07-01 09:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-07-01 09:59</div>
            <div class="timeline-body"><p>Referencing <a href="https://github.com/astral-sh/uv/issues/2252#issuecomment-1985853109">this</a> comment #2252 but also #4600: some libraries require <code>wheel</code> to compile. How should we handle this when using <code>uv tool install</code>? (<code>rye</code> has the same issue.) Example:</p>
<pre><code class="language-bash">uv tool install azure-cli
warning: `uv tool install` is experimental and may change without warning.
⠼ azure-mgmt-advisor==2.0.1                                                                                                                                                             error: Failed to download and build `jsmin==2.2.2`
  Caused by: Failed to build: `jsmin==2.2.2`
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
error in jsmin setup command: use_2to3 is invalid.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-01 10:19</div>
            <div class="timeline-body"><p>There is a problem with jsmin (jsmin 2.2.2 uses a feature that has been removed in setuptools 58.0.2 (https://setuptools.pypa.io/en/latest/history.html#v58-0-2)), but that's not the real problem here, it's shadowing something else: uv fails because we try to install an old version of azure cli because we reject newer versions due to preleases:</p>
<pre><code>$ uv pip install azure-cli==2.61.0
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of azure-keyvault-administration==4.4.0b2 and azure-cli==2.61.0 depends on
      azure-keyvault-administration==4.4.0b2, we can conclude that azure-cli==2.61.0 cannot be used.
      And because you require azure-cli==2.61.0, we can conclude that the requirements are unsatisfiable.

      hint: azure-keyvault-administration was requested with a pre-release marker (e.g.,
      azure-keyvault-administration==4.4.0b2), but pre-releases weren't enabled (try: `--prerelease=allow`)
</code></pre>
<p>uv then goes all the way back to <code>azure-cli==2.0.67</code>, which fails due to the transitive jsmin dependency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-07-01 10:32</div>
            <div class="timeline-body"><p>Oh, thanks. Now I get another error:</p>
<pre><code class="language-bash">uv tool install azure-cli --prerelease=allow
...
error: Failed to find dist-info directory `azure-cli-2.61.0.dist-info` in environment at /Users/luca/Library/Application Support/uv/tools/azure-cli
</code></pre>
<p>Will rename the issue, I guess.</p>
<p>EDIT: it also happens with huggingface-cli:</p>
<pre><code>uv tool install huggingface-hub
warning: `uv tool install` is experimental and may change without warning.
Resolved 12 packages in 383ms
Prepared 2 packages in 74ms
Installed 12 packages in 18ms
 + certifi==2024.6.2
 + charset-normalizer==3.3.2
 + filelock==3.15.4
 + fsspec==2024.6.1
 + huggingface-hub==0.23.4
 + idna==3.7
 + packaging==24.1
 + pyyaml==6.0.1
 + requests==2.32.3
 + tqdm==4.66.4
 + typing-extensions==4.12.2
 + urllib3==2.2.2
error: Failed to find dist-info directory `huggingface-hub-0.23.4.dist-info` in environment at /Users/luca/Library/Application Support/uv/tools/huggingface-hub
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "How to install tools that require `wheel`?" to "Install `azure-cli` with uv" by @baggiponte on 2024-07-01 10:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Install `azure-cli` with uv" to "Install `azure-cli` with `uv` fails" by @baggiponte on 2024-07-01 10:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-07-01 10:39</div>
            <div class="timeline-body"><p>That was a speedy PR, wow. I wouldn't know how to rename the issue, feel free to suggest and/or close.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-07-01 10:40</div>
            <div class="timeline-body"><p>The title is correct :) I'll close it through the PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-07-01 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-07-01 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mdragoss">@mdragoss</a> on 2024-07-26 12:30</div>
            <div class="timeline-body"><p>I which release version this would be fixed? 0.2.29 this still fails</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-07-29 14:56</div>
            <div class="timeline-body"><blockquote>
<p>I which release version this would be fixed? 0.2.29 this still fails</p>
</blockquote>
<p>that's odd. it works for me on the latest (and even previous ones) with <code>--prerelease=allow</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:55:50 UTC
    </footer>
</body>
</html>
