```yaml
number: 9187
title: "path-dependencies with dynamic `version` incorrectly cached"
type: issue
state: closed
author: acarapetis
labels:
  - question
assignees: []
created_at: 2024-11-18T03:36:30Z
updated_at: 2024-11-18T04:00:53Z
url: https://github.com/astral-sh/uv/issues/9187
synced_at: 2026-01-10T01:57:21Z
```

# path-dependencies with dynamic `version` incorrectly cached

---

_Issue opened by @acarapetis on 2024-11-18 03:36_

I have a repo structured something like

```
.
├── app
│   ├── pyproject.toml
│   ├── uv.lock
│   └── ....
├── lib
│   ├── pyproject.toml
│   └── ...
```

with the app depending on the lib via a path-dependency:

```toml
[tool.uv.sources]
lib = { path = "../lib" }
```

The lib is using a dynamic version in its pyproject.toml. I'm not currently using uv workspaces.

**The issue:** If I change the version of `lib` (by modifying the `__version__` defined in lib's python source), then running `uv lock` in app/ does not detect this unless I purge the uv cache.

Here's a self-contained repro:

```sh
uv init app
uv init --lib --build-backend flit lib
sed -i 's/version = "0.1.0"/dynamic = ["version"]/' lib/pyproject.toml
echo '__version__ = "0.1.0"' >| lib/src/lib/__init__.py
uv --directory app add ../lib # + lib==0.1.0
echo '__version__ = "0.2.0"' >| lib/src/lib/__init__.py
uv --directory app lock # no change!
UV_CACHE_DIR=/tmp/fresh uv --directory app lock # Updated lib v0.1.0 -> v0.2.0
```

Seems related to #3796 but perhaps not quite the same? [This comment](https://github.com/astral-sh/uv/issues/3796#issuecomment-2128255312) suggests dynamic attributes should trigger a rebuild.


---

_Comment by @charliermarsh on 2024-11-18 03:48_

This is working as intended -- it's discussed in several issues.. You can read [here](https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata) in the docs for a summary of how we treat dynamic metadata. You likely want to add `lib/src/lib/__init__.py` as a cache key. (I personally recommend against using dynamic metadata like this -- it's more trouble than it's worth, in my opinion.)

---

_Closed by @charliermarsh on 2024-11-18 03:48_

---

_Label `question` added by @charliermarsh on 2024-11-18 03:48_

---

_Comment by @acarapetis on 2024-11-18 03:59_

Thanks, clearly I didn't find the right words to google!

---

_Comment by @charliermarsh on 2024-11-18 04:00_

No prob, happy to help.

---
