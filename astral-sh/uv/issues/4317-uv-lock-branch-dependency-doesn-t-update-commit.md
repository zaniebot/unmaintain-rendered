```yaml
number: 4317
title: "uv lock branch dependency doesn't update commit hash on new commits"
type: issue
state: closed
author: blueraft
labels:
  - question
  - preview
assignees: []
created_at: 2024-06-13T20:12:53Z
updated_at: 2024-06-14T06:38:22Z
url: https://github.com/astral-sh/uv/issues/4317
synced_at: 2026-01-12T15:58:49Z
```

# uv lock branch dependency doesn't update commit hash on new commits

---

_@blueraft_

When pointing a package dependency to the main branch, I noticed a discrepancy in behavior between the `uv pip compile` lock file and the `uv lock` file. Specifically, if the main branch has new commits, `uv pip compile` updates the commit hash in the lock file. However, the uv lock file does not update the commit hash when there are new commits in the branch. 

Is this the intended behavior for `uv lock`?

MRE:
- Copy the toml file.
```toml
[build-system]
requires = ["setuptools<69.3.0", "setuptools-scm"]
build-backend = "setuptools.build_meta"

[project]
name = 'foobar'
version = "0.1"
requires-python = ">=3.9"

dependencies = ["flask @ git+https://github.com/pallets/flask.git"]
```
- Run `uv lock` and `uv pip compile`. Both lock files correctly point to the latest commit from Flask.
 ```sh
❯ rg "git\+https" requirements.txt
7:flask @ git+https://github.com/pallets/flask.git@d718ecf6d3dfc4656d262154c59672437c1ea075
❯ rg "git\+https" uv.lock
❯ rg "git\+https" uv.lock
40:source = "git+https://github.com/pallets/flask.git#d718ecf6d3dfc4656d262154c59672437c1ea075"
83:source = "git+https://github.com/pallets/flask.git#d718ecf6d3dfc4656d262154c59672437c1ea075"
```
- Replace the latest commit with an older commit.
```sh
❯ sed -i '' 's/d718ecf6d3dfc4656d262154c59672437c1ea075/0ce27278d234c13ce00019540ff8e9891542d1f2/g' requirements.txt
❯ sed -i '' 's/d718ecf6d3dfc4656d262154c59672437c1ea075/0ce27278d234c13ce00019540ff8e9891542d1f2/g' uv.lock
❯ rg "git\+https" requirements.txt
7:flask @ git+https://github.com/pallets/flask.git@0ce27278d234c13ce00019540ff8e9891542d1f2
❯ rg "git\+https" uv.lock
40:source = "git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2"
83:source = "git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2"
```
- Run `uv lock` and `uv pip compile` again.
```sh
❯ uv pip compile pyproject.toml -o requirements.txt -p 3.11
 Updated https://github.com/pallets/flask.git (d718ecf6)
Resolved 7 packages in 1.75s
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml -o requirements.txt -p 3.11
blinker==1.8.2
    # via flask
click==8.1.7
    # via flask
flask @ git+https://github.com/pallets/flask.git@d718ecf6d3dfc4656d262154c59672437c1ea075
    # via foobar (pyproject.toml)
itsdangerous==2.2.0
    # via flask
jinja2==3.1.4
    # via flask
markupsafe==2.1.5
    # via
    #   jinja2
    #   werkzeug
werkzeug==3.0.3
    # via flask
❯ uv lock -p 3.11
warning: `uv lock` is experimental and may change without warning.
Resolved 12 packages in 1.11s
❯ rg "git\+https" requirements.txt
7:flask @ git+https://github.com/pallets/flask.git@d718ecf6d3dfc4656d262154c59672437c1ea075
❯ rg "git\+https" uv.lock
40:source = "git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2"
83:source = "git+https://github.com/pallets/flask.git#0ce27278d234c13ce00019540ff8e9891542d1f2"
```

- uv 0.2.11 (MacOS)



---

_Label `bug` added by @zanieb on 2024-06-13 21:45_

---

_Label `preview` added by @zanieb on 2024-06-13 21:45_

---

_Comment by @zanieb on 2024-06-13 21:45_

Thanks! Sounds like a bug to me but we'll see what @BurntSushi and @charliermarsh say.

---

_Comment by @charliermarsh on 2024-06-13 21:53_

This is intended. You should pass the upgrade flag to update the locked version.

---

_Comment by @zanieb on 2024-06-13 21:58_

Ah that makes sense to me.

---

_Label `bug` removed by @zanieb on 2024-06-13 21:58_

---

_Label `question` added by @zanieb on 2024-06-13 21:58_

---

_Comment by @blueraft on 2024-06-14 06:38_

Makes sense, `uv lock -P flask` works for me. Thanks!

---

_Closed by @blueraft on 2024-06-14 06:38_

---
