```yaml
number: 16077
title: "Version `0.8.0` introduced bug in python discovery on Windows"
type: issue
state: closed
author: wikiped
labels:
  - bug
assignees: []
created_at: 2025-09-30T17:31:40Z
updated_at: 2025-10-03T19:36:10Z
url: https://github.com/astral-sh/uv/issues/16077
synced_at: 2026-01-10T01:57:35Z
```

# Version `0.8.0` introduced bug in python discovery on Windows

---

_Issue opened by @wikiped on 2025-09-30 17:31_

### Summary

There seems to be a bug with python discovery in `uv` versions 0.8+.
Using `uv python list` on `uv` versions starting with `0.8.0` does not show anything:

```powershell
> uv self version
uv 0.8.22 (ade2bdbd2 2025-09-23)
> uv python list --verbose
DEBUG uv 0.8.22 (ade2bdbd2 2025-09-23)
DEBUG Acquired shared lock for `E:\cache\uv`
DEBUG Searching for any Python interpreter in registry or search path
WARN Broken interpreter cache entry at E:\cache\uv\interpreter-v4\79d66dac82fc70e0\b9f0db740e5eaade.msgpack, removing: invalid type: string "D:\\Python\\Python313\\Lib", expected a sequence
DEBUG Found `cpython-3.13.7-windows-x86_64-none` at `C:\Python\Python313\python.exe` (first executable in the search path)
DEBUG Ignoring Python interpreter at `C:\Python\Python313\python.exe`: only system interpreters allowed
WARN Broken interpreter cache entry at E:\cache\uv\interpreter-v4\79d66dac82fc70e0\bda971ee0901f517.msgpack, removing: invalid type: string "D:\\Python\\Python312\\Lib", expected a sequence
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Python\Python312\python.exe` (search path)
DEBUG Ignoring Python interpreter at `C:\Python\Python312\python.exe`: only system interpreters allowed
WARN Broken interpreter cache entry at E:\cache\uv\interpreter-v4\79d66dac82fc70e0\b85ea2b953b5aa48.msgpack, removing: invalid type: string "D:\\Python\\Python310\\Lib", expected a sequence
DEBUG Found `cpython-3.10.11-windows-x86_64-none` at `C:\Python\Python310\python.exe` (search path)
DEBUG Ignoring Python interpreter at `C:\Python\Python310\python.exe`: only system interpreters allowed
DEBUG Found `cpython-3.13.7-windows-x86_64-none` at `C:\Python\Python313\python.exe` (registry)
DEBUG Ignoring Python interpreter at `C:\Python\Python313\python.exe`: only system interpreters allowed
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Python\Python312\python.exe` (registry)
DEBUG Ignoring Python interpreter at `C:\Python\Python312\python.exe`: only system interpreters allowed
DEBUG Found `cpython-3.10.11-windows-x86_64-none` at `C:\Python\Python310\python.exe` (registry)
DEBUG Ignoring Python interpreter at `C:\Python\Python310\python.exe`: only system interpreters allowed
DEBUG Released lock at `E:\cache\uv\.lock`
```

Below are results of bisecting the recent versions history.
So it appears the bug was introduced in uv version `0.8.0`.

```
0.8.22  <- Bug
0.8.21  <- Bug
...     <- Unchecked
0.8.9   <- Bug
...     <- Unchecked
0.8.0   <- Bug
0.7.22  <- OK
```

Last version producing correct results is `0.7.22`:

```powershell
> uv self version
uv 0.7.22 (78d6d1134 2025-07-17)
> uv python list --verbose
DEBUG uv 0.7.22 (78d6d1134 2025-07-17)
DEBUG Searching for any Python interpreter in registry or search path
WARN Broken interpreter cache entry at E:\cache\uv\interpreter-v4\79d66dac82fc70e0\b9f0db740e5eaade.msgpack, removing: invalid type: sequence, expected path string
DEBUG Found `cpython-3.13.7-windows-x86_64-none` at `C:\Python\Python313\python.exe` (first executable in the search path)
WARN Broken interpreter cache entry at E:\cache\uv\interpreter-v4\79d66dac82fc70e0\bda971ee0901f517.msgpack, removing: invalid type: sequence, expected path string
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Python\Python312\python.exe` (search path)
WARN Broken interpreter cache entry at E:\cache\uv\interpreter-v4\79d66dac82fc70e0\b85ea2b953b5aa48.msgpack, removing: invalid type: sequence, expected path string
DEBUG Found `cpython-3.10.11-windows-x86_64-none` at `C:\Python\Python310\python.exe` (search path)
DEBUG Found `cpython-3.13.7-windows-x86_64-none` at `C:\Python\Python313\python.exe` (registry)
DEBUG Found `cpython-3.12.10-windows-x86_64-none` at `C:\Python\Python312\python.exe` (registry)
DEBUG Found `cpython-3.10.11-windows-x86_64-none` at `C:\Python\Python310\python.exe` (registry)
cpython-3.13.7-windows-x86_64-none     C:\Python\Python313\python.exe
cpython-3.12.10-windows-x86_64-none    C:\Python\Python312\python.exe
cpython-3.10.11-windows-x86_64-none    C:\Python\Python310\python.exe
```

### Platform

Windows 11 x64

### Version

0.8.22

### Python version

Python 3.13

---

_Label `bug` added by @wikiped on 2025-09-30 17:31_

---

_Comment by @zanieb on 2025-09-30 17:42_

Please share verbose logs as described in #9452

---

_Comment by @wikiped on 2025-09-30 18:33_

> Please share verbose logs as described in [#9452](https://github.com/astral-sh/uv/issues/9452)

Added in the original post

---

_Comment by @zanieb on 2025-09-30 18:46_

Thanks!

It looks like they're being filtered here

https://github.com/astral-sh/uv/blob/8f3583a6e63800b770fec3b7be9b754be9d65602/crates/uv-python/src/discovery.rs#L955-L973

which means that 

https://github.com/astral-sh/uv/blob/8f3583a6e63800b770fec3b7be9b754be9d65602/crates/uv-python/src/discovery.rs#L990

is detecting that they are managed Python installations.

Do you have `UV_PYTHON_PREFERENCE=only-system` or `UV_NO_MANAGED_PYTHON=1` set? or the equivalent in a `uv.toml`?

---

_Comment by @wikiped on 2025-09-30 19:29_

```powershell
> $env:UV_CONFIG_FILE
C:\Python\uv\uv.toml

> $env:UV_NO_MANAGED_PYTHON
1

> $env:UV_PYTHON_DOWNLOADS
never

> cat C:\Python\uv\uv.toml
cache-dir = "E:\\cache\\uv"
compile-bytecode = true
link-mode = "hardlink"
python-downloads = "manual"
python-preference = "only-system"
```

env does not have `UV_PYTHON_PREFERENCE`

---

_Comment by @zanieb on 2025-09-30 19:40_

You have `python-preference = "only-system"`

So we're no longer showing those managed installations that we registered.

---

_Comment by @zanieb on 2025-09-30 19:41_

This change is documented in the changelog, see https://github.com/astral-sh/uv/blob/main/CHANGELOG.md#080 / Validate that discovered interpreters meet the Python preference (https://github.com/astral-sh/uv/pull/7934)

---

_Comment by @wikiped on 2025-09-30 19:49_

My understanding was that "managed" meant "downloaded and installed by uv", and "system" meant "installed via system (i.e. python installer, etc)". Is this incorrect?

Those pythons installations that were discovered by `0.7.22` and which are being ignored by `0.8+` were in fact installed via official python installers, not `uv`.

And since I do not want `uv` to interfere with python installations there are those useful settings...

---

_Comment by @zanieb on 2025-09-30 19:55_

> Those pythons installations that were discovered by 0.7.22 and which are being ignored by 0.8+ were in fact installed via official python installers, not uv.

If that's the case, then there is indeed a bug.

What does `C:\Python\Python313\python.exe -c "import sys; print(sys.base_prefix)"` show?

---

_Comment by @zanieb on 2025-09-30 19:57_

Are you changing the uv Python install directory? e.g., with `UV_PYTHON_INSTALL_DIR`?

---

_Comment by @wikiped on 2025-09-30 21:01_

```powershell
> C:\Python\Python313\python.exe -c "import sys; print(sys.base_prefix)"
C:\Python\Python313

> $env:UV_PYTHON_INSTALL_DIR
C:\Python
```

I can see how `uv` can get confused seeing `UV_PYTHON_INSTALL_DIR` pointing to the folder where there are also system installations, so it seems now it would not be possible to keep all python installations in one place (both system and managed), one would have to make sure that `UV_PYTHON_INSTALL_DIR` points to a folder where there are no system python installations, like: `C:\Python\uv-managed`.

I have tested this and it does solve the issue with discovery of all python versions in `0.8+`

Not sure now if this is a bug or documentation issue...

---

_Comment by @zanieb on 2025-09-30 22:11_

We can adjust the logic to account for that case. uv currently assumes complete control of that directory, yeah.

---

_Referenced in [astral-sh/uv#16080](../../astral-sh/uv/pulls/16080.md) on 2025-09-30 22:18_

---

_Closed by @zanieb on 2025-10-03 19:36_

---
