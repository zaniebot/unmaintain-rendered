<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Install tool that contains packages from private index - astral-sh/uv #16021</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Install tool that contains packages from private index</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16021">#16021</a>
        opened by <a href="https://github.com/MauroPfister">@MauroPfister</a>
        on 2025-09-25 07:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MauroPfister">@MauroPfister</a></div>
            <div class="timeline-body">Question
<p>Hello</p>
<p>I have created a package <code>example-app</code> that contains a package <code>foo</code> from a private Google Artifact Registry (see <code>pyproject.toml</code> below).</p>
<pre><code>[project]
name = &quot;example-app&quot;
dynamic = [&quot;version&quot;]
description = &quot;Example application&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
    &quot;foo &gt;= 3.0.0&quot;,
]

[project.scripts]
example-app = &quot;example_app:main&quot;

[tool.uv]
keyring-provider = &quot;subprocess&quot;

[tool.uv.sources]
# Fetch foo from our private google cloud platform index
foo = { index = &quot;gcp-index&quot; }

[[tool.uv.index]]
name = &quot;gcp-index&quot;
url = &quot;https://oauth2accesstoken@###-python.pkg.dev/###/###/simple/&quot; 
explicit = true

[build-system]
requires = [&quot;hatchling&quot;, &quot;uv-dynamic-versioning&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.hatch.version]
source = &quot;uv-dynamic-versioning&quot;

[tool.hatch.metadata]
allow-direct-references = true

[tool.uv-dynamic-versioning]
pattern-prefix = &quot;example-app-&quot;
</code></pre>
<p>Running the entry points works fine using <code>uv run example-app</code>. I can see that <code>uv</code> gets the <code>foo</code> dependency from our private index.</p>
<p>However, when I try to install the package <code>example-app</code> as a tool with <code>uv tool install -e .</code> I get the following error:</p>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because foo was not found in the package registry and example-app==1.0.1 depends on foo&gt;=3.0.0, we can conclude that example-app==1.0.1 cannot be used.
      And because only example-app==1.0.1 is available and you require example-app, we can conclude that your requirements are unsatisfiable.
</code></pre>
<p>Do I need to configure something differently in <code>pyproject.toml</code>? I think the secondary error (only example-app=1.0.1 is available) has nothing to do with the first one but please correct me if I&#x27;m wrong.</p>
<p>EDIT: When I run <code>uv tool install -e . --verbose</code> I see that <code>uv</code> can&#x27;t find the credentials for the private index (I obfuscated the index url):</p>
<pre><code>DEBUG uv 0.8.16
DEBUG Searching for default Python interpreter in managed installations or search path
DEBUG Searching for managed installations at `/home/mauro/.local/share/uv/python`
DEBUG Found managed installation `cpython-3.13.0-linux-x86_64-gnu`
DEBUG Found `cpython-3.13.0-linux-x86_64-gnu` at `/home/mauro/.local/share/uv/python/cpython-3.13.0-linux-x86_64-gnu/bin/python3.13` (managed installations)
DEBUG Using request timeout of 30s
DEBUG Found PEP 621 metadata for /home/mauro/Develop/example-app in `pyproject.toml` (example-app)
DEBUG Acquired lock for `/home/mauro/.local/share/uv/tools`
DEBUG Checking for Python environment at: `/home/mauro/.local/share/uv/tools/example-app`
DEBUG Using request timeout of 30s
DEBUG No static `pyproject.toml` available for: example-app @ file:///home/mauro/Develop/example-app (DynamicField(&quot;version&quot;))
DEBUG Acquired lock for `/home/mauro/.cache/uv/sdists-v9/editable/356415a6d63dfcbf`
DEBUG Computed cache info: Some(Timestamp(SystemTime { tv_sec: 1758731046, tv_nsec: 66537989 })), None, None, {}, {&quot;src&quot;: Some(Timestamp(Timestamp(SystemTime { tv_sec: 1758703684, tv_nsec: 500251165 })))}
DEBUG Using cached metadata for: example-app @ file:///home/mauro/Develop/example-app
DEBUG No workspace root found, using project root
DEBUG Released lock at `/home/mauro/.cache/uv/sdists-v9/editable/356415a6d63dfcbf/.lock`
DEBUG Solving with installed Python version: 3.13
DEBUG Solving with target Python version: &gt;=3.13
DEBUG Adding direct dependency: example-app*
DEBUG Searching for a compatible version of example-app @ file:///home/mauro/Develop/example-app (*)
DEBUG Adding transitive dependency for example-app==1.0.1: foo&gt;=3.0.0
DEBUG Found stale response for: https://###-python.pkg.dev/###/###/simple/foo/
DEBUG Sending revalidation request for: https://###-python.pkg.dev/###/###/simple/foo/
DEBUG No netrc file found
DEBUG Acquired lock for `credentials store`
DEBUG Released lock at `/home/mauro/.local/share/uv/credentials/credentials.toml.lock`
WARN Failed to load credentials from /home/mauro/.local/share/uv/credentials/credentials.toml: Failed to parse TOML credential file: TOML parse error at line 1, column 1
  |
1 | [[credential]]
  | ^^^^^^^^^^^^^^
missing field `service`

DEBUG Indexes search failed because of status code failure: 401 Unauthorized
DEBUG Searching for a compatible version of foo (&gt;=3.0.0)
DEBUG No compatible version found for: foo
DEBUG Recording unit propagation conflict of foo from incompatibility of (example-app)
DEBUG Searching for a compatible version of example-app @ file:///home/mauro/Develop/example-app (&lt;1.0.1 | &gt;1.0.1)
DEBUG No compatible version found for: example-app
  × No solution found when resolving dependencies:
  ╰─▶ Because foo was not found in the package registry and example-app==1.0.1 depends on foo&gt;=3.0.0, we can conclude that example-app==1.0.1 cannot be used.
      And because only example-app==1.0.1 is available and you require example-app, we can conclude that your requirements are unsatisfiable.
DEBUG Released lock at `/home/mauro/.local/share/uv/tools/.lock`
</code></pre>
<p>However, when running <code>uv run --verbose example-app</code> I can see that after trying to load credentials from all the other places, <code>uv</code> gets them successfully from <code>keyring</code>.</p>
<p>Is this expected behavior?</p>
Platform
<p>Ubuntu 24.04 x86_64</p>
Version
<p>uv 0.8.16</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/MauroPfister">@MauroPfister</a> on 2025-09-25 07:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MauroPfister">@MauroPfister</a> on 2025-09-25 09:41</div>
            <div class="timeline-body"><p>I just checked the <a href="https://docs.astral.sh/uv/concepts/authentication/http/#keyring-providers">documentation</a> again and noticed that I can pass the keyring-provider via argument to <code>uv tool</code>. This works:</p>
<pre><code>uv tool install -e . --verbose --keyring-provider subprocess
</code></pre>
<p>I don&#x27;t understand why <code>uv tool</code> doesn&#x27;t respect <code>tool.uv.keyring-provider = &quot;subprocess&quot;</code> .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-25 13:34</div>
            <div class="timeline-body"><p><code>uv tool</code> doesn&#x27;t read your <code>pyproject.toml</code>, it&#x27;ll read user-level settings though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MauroPfister">@MauroPfister</a> on 2025-09-25 13:37</div>
            <div class="timeline-body"><p>Oh, then I probably misunderstood how <code>uv tool</code>  works. How does it determine what dependencies to install?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-25 13:39</div>
            <div class="timeline-body"><p>Sorry, if you do <code>uv tool install .</code> it will read the <code>pyproject.toml</code> but as-if it was a package external to you, e.g., it&#x27;s similar to if you do <code>uv tool install foo</code> and <code>foo</code> needs to be built from source. In that context, we do not read <code>[tool.uv]</code> options from the project, since that&#x27;s not a part of the standard Python package interface.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MauroPfister">@MauroPfister</a> on 2025-09-26 09:03</div>
            <div class="timeline-body"><p>Thanks for the clarification, this makes sense now. The <a href="https://docs.astral.sh/uv/concepts/configuration-files/#configuration-files">docs</a> clearly explain this behavior, I just didn&#x27;t find it.</p>
<p>My solution is to configure this at user level:</p>
<pre><code># ~/.config/uv/uv.toml

keyring-provider = &quot;subprocess&quot;
</code></pre>
<p>Thanks again @zanieb for the quick support!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MauroPfister">@MauroPfister</a> on 2025-09-26 09:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:28 UTC
    </footer>
</body>
</html>
