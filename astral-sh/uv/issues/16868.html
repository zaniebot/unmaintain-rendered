<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inconsistent behavior with version-specifiers containing 'Exclusive ordered comparison' for Post-Release versions - astral-sh/uv #16868</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Inconsistent behavior with version-specifiers containing 'Exclusive ordered comparison' for Post-Release versions</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/16868">#16868</a>
        opened by <a href="https://github.com/LtdSauce">@LtdSauce</a>
        on 2025-11-26 21:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/LtdSauce">@LtdSauce</a> on 2025-11-26 21:25</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi!</p>
<p>It seems that <code>uv</code> does not correctly follow <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#exclusive-ordered-comparison">Exclusive ordered comparison</a> in regards to Post-Release versions, e.g. 1.2.3.post2.</p>
<p>I did search all open issues for the strings <code>post</code> and <code>release</code>. Also i checked the documentation. But i could only find references to prereleases.</p>
<p>If i see it correctly if a package published the following versions to pypi (e.g. <a href="https://pypi.org/project/hidapi/#history">hidapi</a>):</p>
<pre><code>0.13.1
0.12.0.post2
0.12.0.post1
0.12.0
0.11.2
</code></pre>
<p>Than a version constraint of <code>&gt;=0.12.0.post1, &lt;0.12.0.post2</code> should resolve to <code>0.12.0.post1</code>.
But <code>uv</code> fails to recognize this apparently and considers this impossible. In the following i use <code>uv pip compile</code> to reproduce it. I already observed this with with other <code>uv</code> commands that need to resolve this as well, e.g. installing package that has a dependency that relies on a post release being picked from range. This could be seen <a href="https://github.com/Nitrokey/pynitrokey/issues/707">here</a>.</p>
<h4>Reproducer</h4>
<pre><code class="language-bash">$ cat requirements.in
hidapi &gt;=0.12.0.post1, &lt;0.12.0.post2
$ uv pip compile --verbose requirements.in
DEBUG uv 0.9.13
DEBUG Acquired shared lock for `/home/ltdsauce/.cache/uv`
DEBUG Using request timeout of 30s
DEBUG Starting Python discovery for a default Python
DEBUG Looking for exact match for request a default Python
DEBUG Searching for default Python interpreter in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.13.7-linux-x86_64-gnu` at `/tmp/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.13.7 interpreter at \x1b[36m.venv/bin/python3\x1b[39m for builds
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: &gt;=3.13.7
DEBUG Adding direct dependency: hidapiâˆ…
DEBUG No cache entry for: https://pypi.org/simple/hidapi/
  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ you require hidapi âˆ…
DEBUG Released lock at `/home/ltdsauce/.cache/uv/.lock`
</code></pre>
<p><code>pip-compile</code> on the other hand succeeds here:</p>
<pre><code class="language-bash">$ pip-compile --version
pip-compile, version 7.5.2
$ pip-compile
WARNING: --strip-extras is becoming the default in version 8.0.0. To silence this warning, either use --strip-extras to opt into the new default or use --no-strip-extras to retain the existing behavior.
#
# This file is autogenerated by pip-compile with Python 3.13
# by the following command:
#
#    pip-compile
#
hidapi==0.12.0.post1
    # via -r requirements.in

# The following packages are considered to be unsafe in a requirements file:
# setuptools
</code></pre>
<p>To show that Post-Release just seem to be entirely ignored consider the following:</p>
<pre><code class="language-bash">$ cat requirements.in
hidapi &lt;0.12.0.post2
$ uv pip compile --verbose requirements.in
DEBUG uv 0.9.13
DEBUG Acquired shared lock for `/home/ltdsauce/.cache/uv`
DEBUG Using request timeout of 30s
DEBUG Starting Python discovery for a default Python
DEBUG Looking for exact match for request a default Python
DEBUG Searching for default Python interpreter in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.13.7-linux-x86_64-gnu` at `/tmp/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.13.7 interpreter at \x1b[36m.venv/bin/python3\x1b[39m for builds
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: &gt;=3.13.7
DEBUG Adding direct dependency: hidapi&lt;0.12.0.post2
DEBUG Found fresh response for: https://pypi.org/simple/hidapi/
DEBUG Searching for a compatible version of hidapi (&lt;0.12.0.post2)
DEBUG Selecting: hidapi==0.11.2 [compatible] (hidapi-0.11.2.tar.gz)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/29/13/391c7d076014e4763ce3b2731dd72c811a7f6030fda03149c392094f5a60/hidapi-0.11.2-cp310-cp310-macosx_10_9_x86_64.whl.metadata
DEBUG Adding transitive dependency for hidapi==0.11.2: setuptools&gt;=19.0
DEBUG Found fresh response for: https://pypi.org/simple/setuptools/
DEBUG Searching for a compatible version of setuptools (&gt;=19.0)
DEBUG Selecting: setuptools==80.9.0 [compatible] (setuptools-80.9.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/a3/dc/17031897dae0efacfea57dfd3a82fdd2a2aeb58e0ff71b77b87e44edc772/setuptools-80.9.0-py3-none-any.whl.metadata
DEBUG Tried 2 versions: hidapi 1, setuptools 1
DEBUG marker environment resolution took 0.002s
Resolved 2 packages in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.11.2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
DEBUG Released lock at `/home/ltdsauce/.cache/uv/.lock`
</code></pre>
<p>My assumption that <code>uv</code> might be wrong here is based on the fact that <code>pip-compile</code> (and in fact <code>pipx</code>) &quot;correctly&quot; gives me the version i expect. And on the following from the mentiond spec:</p>
<blockquote>
<p>The exclusive ordered comparison &gt;V MUST NOT allow a post-release of the given version unless V itself is a post release.</p>
</blockquote>
<p>As in this case <code>V</code> is a post-release and thus version resolution should consider post-releases. At least that is how i read this ðŸ‘€</p>
<h4>Other comparison operators</h4>
<p>This seems to only apply to <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#exclusive-ordered-comparison">Exclusive ordered comparison</a> as <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#inclusive-ordered-comparison">Inclusive ordered comparison</a>, <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#version-matching">Version matching</a> and <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#compatible-release">Compatible release</a> seem to work as expected:</p>
<h5>Inclusive ordered comparison:</h5>
<pre><code class="language-bash">$ cat requirements.in
hidapi &lt;=0.12.0.post2
$ uv pip compile requirements.in
Resolved 2 packages in 3ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.12.0.post2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
</code></pre>
<h5>Verion matching:</h5>
<pre><code class="language-bash">$ cat requirements.in
hidapi ==0.12.0.post2
$ uv pip compile requirements.in
Resolved 2 packages in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.12.0.post2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
</code></pre>
<h5>Compatible release:</h5>
<pre><code class="language-bash">$ cat requirements.in
hidapi ~=0.12.0.post1
$ uv pip compile requirements.in
Resolved 2 packages in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.in
hidapi==0.12.0.post2
    # via -r requirements.in
setuptools==80.9.0
    # via hidapi
</code></pre>
<p>Thanks for your great work btw!</p>
<h3>Platform</h3>
<p>Ubuntu 25.10 ; Linux 6.17.0-6-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.9.13</p>
<h3>Python version</h3>
<p>Python 3.13.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @LtdSauce on 2025-11-26 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Nitrokey/pynitrokey/issues/707.html">Nitrokey/pynitrokey#707</a> on 2025-11-26 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Inconsistent behavior with PEP440 Exclusive ordered comparison for Post-Release versions" to "Inconsistent behavior with version-specifiers containing 'Exclusive ordered comparison' for Post-Release versions" by @LtdSauce on 2025-11-26 21:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-26 22:15</div>
            <div class="timeline-body"><p>Thanks for the report, will take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-26 22:46</div>
            <div class="timeline-body"><p>It's because of our use of the sentinel &quot;min&quot; version (<code>Self::strictly_lower_than(version.with_min(Some(0)))</code>) which we use to properly handle pre-releases. Should be fixable but need to think on it...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-11-28 13:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16881.html">astral-sh/uv#16881</a> on 2025-11-28 14:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @konstin on 2025-11-28 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-11-28 14:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
