<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> `uv sync --active` can recreate active venv - astral-sh/uv #15603</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv sync --active</code> can recreate active venv</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15603">#15603</a>
        opened by <a href="https://github.com/antonysouthworth-halter">@antonysouthworth-halter</a>
        on 2025-08-31 06:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/antonysouthworth-halter">@antonysouthworth-halter</a> on 2025-08-31 06:07</div>
            <div class="timeline-body"><p>This is my usual workflow for setting up a Python project:</p>
<pre><code>$ asdf set python 3.12.11 # or, whatever python version I want to use
$ python -m venv .venv
$ . .venv/bin/activate
$ python -m pip install --upgrade pip; python -m pip install --upgrade uv
$ uv sync
</code></pre>
<p>BUT it seems maybe some recent change to <code>uv</code> breaks this workflow as this is the output I get:</p>
<pre><code>$ uv sync
Using CPython 3.12.11 interpreter at: /opt/homebrew/opt/python@3.12/bin/python3.12
Removed virtual environment at: .venv # WHYYYYY!?!?!?!
Creating virtual environment at: .venv
Resolved 14 packages in 3ms
Installed 13 packages in 19ms
 + annotated-types==0.7.0
 + anyio==4.10.0
 + certifi==2025.8.3
 + h11==0.16.0
 + httpcore==1.0.9
 + httpx==0.28.1
 + idna==3.10
 + ollama==0.5.3
 + pydantic==2.11.7
 + pydantic-core==2.33.2
 + sniffio==1.3.1
 + typing-extensions==4.15.0
 + typing-inspection==0.4.1
$ uv
bash: /Users/antony/tonybot/.venv/bin/uv: No such file or directory
</code></pre>
<p>I can't put into words how <em>extremely frustrating</em> this behaviour is. I already have a good workflow for setting up Python and a venv just how I like it!! For extra context, I am still reeling from having to change my usual venv location from <code>venv</code> to <code>.venv</code> (I <em>hate</em> having to type the extra character). I am pretty sure <code>uv</code> used to respect existing venvs so long as the name was the same but now it seems to just clobber whatever is there.</p>
<p>IIRC there's a command line flag (called like ~<code>--existing</code> or <code>--inplace</code> or something~ it's <code>--active</code>) that would make <code>uv</code> actually respect the existing venv that it's running in but it's a massive pain to have to remember to include that flag on every single invocation.</p>
<p>Questions:</p>
<ol>
<li>Is this expected behaviour from <code>uv</code> (to delete any existing venv?)</li>
<li>How should I change my workflow so that <code>uv</code> actually helps me?</li>
</ol>
<p>Related issues:</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/6204</li>
<li>https://github.com/astral-sh/uv/issues/6612</li>
<li>https://github.com/astral-sh/uv/issues/11273</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonysouthworth-halter">@antonysouthworth-halter</a> on 2025-08-31 09:06</div>
            <div class="timeline-body"><p>UPDATE: I had a <code>.python-version</code> floating around for some reason. When I delete this and re-run <code>uv</code> it is now behaving as expected.</p>
<pre><code>$ uv --no-managed-python --no-python-downloads sync --active --dry-run --verbose 
DEBUG uv 0.8.14 (af856fb88 2025-08-28)
DEBUG Found project root: `/Users/antony/tonybot`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/Users/antony/tonybot`
DEBUG Reading Python requests from version file at `/Users/antony/tonybot/.python-version`
DEBUG Using Python request `3.12` from version file at `.python-version`
DEBUG Checking for Python environment at: `.venv`
DEBUG The project environment's Python version does not satisfy the request: `Python 3.12`
DEBUG Searching for Python 3.12 in search path
DEBUG Found `cpython-3.13.7-macos-aarch64-none` at `/Users/antony/tonybot/.venv/bin/python3` (first executable in the search path)
DEBUG Ignoring Python interpreter at `/Users/antony/tonybot/.venv/bin/python3`: system interpreter required
DEBUG Found `cpython-3.13.7-macos-aarch64-none` at `/Users/antony/tonybot/.venv/bin/python` (search path)
DEBUG Ignoring Python interpreter at `/Users/antony/tonybot/.venv/bin/python`: system interpreter required
DEBUG Failed to inspect Python interpreter from search path at `/Users/antony/.asdf/shims/python3.12` 
DEBUG Skipping bad interpreter at /Users/antony/.asdf/shims/python3.12 from search path: Querying Python at `/Users/antony/.asdf/shims/python3.12` failed with exit status exit status: 126

[stderr]
No version is set for command python3.12
Consider adding one of the following versions in your config file at /Users/antony/tonybot/.tool-versions
python 3.12.7
python 3.12.6

DEBUG Found `cpython-3.13.7-macos-aarch64-none` at `/Users/antony/.asdf/shims/python3` (search path)
DEBUG Skipping interpreter at `/Users/antony/.asdf/installs/python/3.13.7/bin/python3` from search path: does not satisfy request `3.12`
DEBUG Found `cpython-3.13.7-macos-aarch64-none` at `/Users/antony/.asdf/shims/python` (search path)
DEBUG Skipping interpreter at `/Users/antony/.asdf/installs/python/3.13.7/bin/python` from search path: does not satisfy request `3.12`
DEBUG Found `cpython-3.12.11-macos-aarch64-none` at `/opt/homebrew/bin/python3.12` (search path)
Using CPython 3.12.11 interpreter at: /opt/homebrew/opt/python@3.12/bin/python3.12
DEBUG Using base executable for virtual environment: /opt/homebrew/opt/python@3.12/bin/python3.12
DEBUG Released lock at `/var/folders/mq/s4d2zdnn0m1fgd7drqpz33h80000gp/T/uv-97baab62b3491e7d.lock`
DEBUG Acquired lock for `/Users/antony/.cache/uv/builds-v0/.tmp7AwFjh`
Would replace project environment at: .venv
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: tonybot @ file:///Users/antony/tonybot
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 14 packages in 4ms
Found up-to-date lockfile at: uv.lock
DEBUG Using request timeout of 30s
DEBUG Registry requirement already cached: ollama==0.5.3
DEBUG Registry requirement already cached: httpx==0.28.1
DEBUG Registry requirement already cached: pydantic==2.11.7
DEBUG Registry requirement already cached: anyio==4.10.0
DEBUG Registry requirement already cached: certifi==2025.8.3
DEBUG Registry requirement already cached: httpcore==1.0.9
DEBUG Registry requirement already cached: idna==3.10
DEBUG Registry requirement already cached: annotated-types==0.7.0
DEBUG Registry requirement already cached: pydantic-core==2.33.2
DEBUG Registry requirement already cached: typing-extensions==4.15.0
DEBUG Registry requirement already cached: typing-inspection==0.4.1
DEBUG Registry requirement already cached: sniffio==1.3.1
DEBUG Registry requirement already cached: h11==0.16.0
Would install 13 packages
 + annotated-types==0.7.0
 + anyio==4.10.0
 + certifi==2025.8.3
 + h11==0.16.0
 + httpcore==1.0.9
 + httpx==0.28.1
 + idna==3.10
 + ollama==0.5.3
 + pydantic==2.11.7
 + pydantic-core==2.33.2
 + sniffio==1.3.1
 + typing-extensions==4.15.0
 + typing-inspection==0.4.1
DEBUG Released lock at `/Users/antony/.cache/uv/builds-v0/.tmp7AwFjh/.lock`
</code></pre>
<pre><code>$ rm .python-version 
remove .python-version? y
.python-version
</code></pre>
<pre><code>$ uv --no-managed-python --no-python-downloads sync --active --dry-run --verbose 
DEBUG uv 0.8.14 (af856fb88 2025-08-28)
DEBUG Found project root: `/Users/antony/tonybot`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/Users/antony/tonybot`
DEBUG No Python version file found in workspace: /Users/antony/tonybot
DEBUG Using Python request `&gt;=3.12` from `requires-python` metadata
DEBUG Checking for Python environment at: `.venv`
DEBUG The project environment's Python version satisfies the request: `Python &gt;=3.12`
DEBUG Released lock at `/var/folders/mq/s4d2zdnn0m1fgd7drqpz33h80000gp/T/uv-97baab62b3491e7d.lock`
DEBUG Acquired lock for `.venv`
Would use project environment at: .venv
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: tonybot @ file:///Users/antony/tonybot
DEBUG No workspace root found, using project root
DEBUG Existing `uv.lock` satisfies workspace requirements
Resolved 14 packages in 3ms
Found up-to-date lockfile at: uv.lock
DEBUG Using request timeout of 30s
DEBUG Registry requirement already cached: ollama==0.5.3
DEBUG Registry requirement already cached: httpx==0.28.1
DEBUG Registry requirement already cached: pydantic==2.11.7
DEBUG Registry requirement already cached: anyio==4.10.0
DEBUG Registry requirement already cached: certifi==2025.8.3
DEBUG Registry requirement already cached: httpcore==1.0.9
DEBUG Registry requirement already cached: idna==3.10
DEBUG Registry requirement already cached: annotated-types==0.7.0
DEBUG Identified uncached distribution: pydantic-core==2.33.2
DEBUG Registry requirement already cached: typing-extensions==4.15.0
DEBUG Registry requirement already cached: typing-inspection==0.4.1
DEBUG Registry requirement already cached: sniffio==1.3.1
DEBUG Registry requirement already cached: h11==0.16.0
DEBUG Preserving seed package: pip==25.2
DEBUG Preserving seed package: uv==0.8.14
Would download 1 package
Would install 13 packages
 + annotated-types==0.7.0
 + anyio==4.10.0
 + certifi==2025.8.3
 + h11==0.16.0
 + httpcore==1.0.9
 + httpx==0.28.1
 + idna==3.10
 + ollama==0.5.3
 + pydantic==2.11.7
 + pydantic-core==2.33.2
 + sniffio==1.3.1
 + typing-extensions==4.15.0
 + typing-inspection==0.4.1
DEBUG Released lock at `/Users/antony/tonybot/.venv/.lock`
</code></pre>
<pre><code>$ uv sync --active
Resolved 14 packages in 3ms
Prepared 1 package in 140ms
Installed 13 packages in 15ms
 + annotated-types==0.7.0
 + anyio==4.10.0
 + certifi==2025.8.3
 + h11==0.16.0
 + httpcore==1.0.9
 + httpx==0.28.1
 + idna==3.10
 + ollama==0.5.3
 + pydantic==2.11.7
 + pydantic-core==2.33.2
 + sniffio==1.3.1
 + typing-extensions==4.15.0
 + typing-inspection==0.4.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonysouthworth-halter">@antonysouthworth-halter</a> on 2025-08-31 09:08</div>
            <div class="timeline-body"><p>I guess if you are using <code>asdf</code> and <code>uv</code> together, <code>uv</code> sees the <code>.python-version</code> file and thinks that gives it carte-blanche to rip up any existing venv, even when using <code>--active</code>.</p>
<p>Might be a bug? As a user I would expect <code>--active</code> to always use the active env.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-01 07:16</div>
            <div class="timeline-body"><p>In difference to <code>uv pip install</code>, the idea of <code>uv sync</code> is that it manages your venv. A <code>uv sync</code> ensure that the venv contains exactly the packages declared in your <code>pyproject.toml</code>, through the locked <code>uv.lock</code> versions, i.e. venv management is automatic. With <code>uv run</code>, this also removes the need to activate the venv. This makes the venv itself ephemeral, with a warm cache it can be recreated from the lockfile in &lt;1s. <code>uv sync</code> also respects <code>.python-version</code>, ensuring that the venv matches the pin of the project.</p>
<p>We highly recommend to install uv outside that venv, with uv's curl installer, with asdf or with pipx as a global tool; having uv in the environment it is also managing can make uv fail.</p>
<p><code>uv sync --active</code> recreating the active venv is indeed wrong, we either need to fix the behavior to not recreate or update the documentation to not say <code>Instead of creating or updating the virtual environment</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv clobbered my existing venv" to " `uv sync --active` can recreate active venv" by @konstin on 2025-09-01 07:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2025-09-01 07:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-01 13:13</div>
            <div class="timeline-body"><blockquote>
<p><code>uv sync --active</code> recreating the active venv is indeed wrong.</p>
</blockquote>
<p>So the right behavior here would be: raise an error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-01 14:02</div>
            <div class="timeline-body"><blockquote>
<p>uv sync --active recreating the active venv is indeed wrong, we either need to fix the behavior to not recreate or update the documentation to not say Instead of creating or updating the virtual environment.</p>
</blockquote>
<p>I'm not sure I agree? You're changing the target path with <code>--active</code> so I think it's fair for uv to manage the environment? It's the same as setting <code>UV_PROJECT_ENVIRONMENT=$VIRTUAL_ENV</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-01 14:02</div>
            <div class="timeline-body"><p>I think so, though I want to hear from @zanieb first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-01 14:05</div>
            <div class="timeline-body"><p>It's plausible we should special-case <code>--active</code> to never change the Python version of your environment, I just worry about special-cases making it harder to understand how uv manages environments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-01 14:06</div>
            <div class="timeline-body"><p>I find it surprising that uv will remove (and recreate) an active environment when using <code>--active</code>, this reduces the flag to selecting a different location for a venv; If we do want to go with that we should clarify the docs for <code>--active</code> that it only changes the location of the environment, while it is still managed by uv and uv may recreate it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-01 14:07</div>
            <div class="timeline-body"><p>Why is that surprising given we could also remove all the packages in the environment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-01 14:20</div>
            <div class="timeline-body"><p>From an option called <code>--active</code> and a description &quot;Sync dependencies to the active virtual environment.&quot;, my expectation would be that it uses that environment and only gives me package versions matching , especially when running with <code>--inexact</code>. This may be a naming problem: With <code>UV_PROJECT_ENVIRONMENT</code> being given a path, I do expect it to use that location and am not surprised if it (re)creates an environment at the given path (despite them doing the same thing).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alechouse97">@alechouse97</a> on 2025-09-16 13:08</div>
            <div class="timeline-body"><p>I am seeing similar behavior when trying to <code>uv sync --active</code> into an activated conda environment - uv ignores this environment, creates a venv, and syncs the package there. Is this expected behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-16 13:18</div>
            <div class="timeline-body"><p>@alechouse97 yes it's expected (though we may change it), if you turn on verbose logs you'll see the reason the environment is considered incompatible. Usually it's because of a different Python version request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/soufianeamini">@soufianeamini</a> on 2025-09-25 19:21</div>
            <div class="timeline-body"><p>I've encountered a similar issue, which is that I had an active venv two folders up, and then running <code>uv sync --active</code> in the current directory that contains a different pyproject.toml as well ends up deleting the .venv that exists two folders up and creating a new one in the current directory.</p>
<p>I think raising an error like Charlie mentioned might be a good solution. Not sure if this scenario I mentioned is intended to happen.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonysouthworth-halter">@antonysouthworth-halter</a> on 2025-10-05 20:34</div>
            <div class="timeline-body"><blockquote>
<p>UPDATE: I had a <code>.python-version</code> floating around for some reason. When I delete this and re-run <code>uv</code> it is now behaving as expected.</p>
</blockquote>
<p>...And I think I just found out how; I believe the <code>.python-version</code> is added by <code>uv init</code>.</p>
<p>So what was happening to me is:</p>
<ol>
<li>Use <code>asdf set python ...</code> to set Python version.</li>
<li>Use <code>python -m venv venv</code> to create venv; then I activate it.</li>
<li>Use <code>uv init</code> -&gt; creates <code>.python-version</code>.</li>
<li>Use <code>uv add --active ...</code> -&gt; <code>uv</code> ignores <code>--active</code> flag.</li>
</ol>
<p>Just another minor note, but the other thing I hate about the <code>--active</code> flag is it's not obvious which commands do/don't need it. Again, I'd prefer if <code>uv</code> just used the active venv by default; though at the same time I admit 1) I'm very much &quot;stuck in my ways&quot; and 2) given <em>most</em> people probably don't have strong opinions on their venv management (they just want things to Just Work™️) clobbering any existing crap and making the env fully &quot;uv-managed&quot; probably saves more people in the aggregate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonysouthworth-halter">@antonysouthworth-halter</a> on 2025-10-12 20:47</div>
            <div class="timeline-body"><p>Hit this again. This time I suspect the reason is because of the mismatch between the Python version that the venv was created with and the Python version specified in <code>pyproject.toml</code></p>
<pre><code class="language-shell">$ python -m venv venv
$ . venv/bin/activate
(venv) $ python -m pip install --upgrade pip uv
# ... omitted for clarity
(venv) $ cat pyproject.toml | grep requires-python
requires-python = &quot;&gt;=3.12&quot;
(venv) $ python --version
Python 3.10.12
(venv) $ uv sync --active
Using CPython 3.12.10 interpreter at: /usr/bin/python3.12
Removed virtual environment at: venv
Creating virtual environment at: venv
Resolved 139 packages in 1ms
# ... truncated
</code></pre>
<p>I think this case should quite clearly be an error where <code>uv</code> should refuse to continue.</p>
<p>Desired behaviour (imagine the shell exprs had been expanded)</p>
<pre><code>(venv) $ uv sync --active
You used the --active flag which requires us to use the active virtual environment at $VIRTUAL_ENV -- but this virtual environment is using:

    $($VIRTUAL_ENV/bin/python --version)

which is incompatible with the project's requirements in `pyproject.toml`:

    $(grep 'requires-python' pyproject.toml)

We recommend letting uv manage your Python version and virtual environment, read more at $URL.

Alternatively (if you prefer managing the environment yourself) you should re-create the virtual environment using a compatible version of Python.
</code></pre>
<p>EDIT: just to confirm: yes, re-creating the venv with a compatible Python version works properly. So lends some credence to the mismatch theory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-12 21:15</div>
            <div class="timeline-body"><p>@antonysouthworth-halter With the <code>-v</code> flag we're usually pretty clear about what is causing the environment to be considered invalid.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @zanieb on 2025-10-12 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v0.10.0" by @zanieb on 2025-10-12 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-12 21:22</div>
            <div class="timeline-body"><p>We can consider this changing this for v0.10, though I'm wary that changing this behavior will break some use-cases and make uv's management of project environments less consistent and harder to reason about.</p>
<p>We'll also need to decide if we should error when the Python versions differ or just use the Python version found in the environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonysouthworth-halter">@antonysouthworth-halter</a> on 2025-10-13 00:28</div>
            <div class="timeline-body"><p>On &quot;reasoning about uv's environment management&quot;: having your venv blown away <strong>without warning</strong> is <em>very</em> hard to reason about (and extremely frustrating; thankfully <code>uv</code>s cache means re-creating the venv is quite fast &lt;3). Not sure if that reads snarky or not; apologies if so, not my intention. I agree having reasonable (or &quot;reason-about-able&quot;) behaviour is extremely important so sharing my perspective on that. (EDIT: maybe interpret this paragraph as &quot;<code>uv</code>s project environment management is <em>already</em> hard to reason about, or at least it is for me&quot;).</p>
<p>On &quot;what to do about it&quot;: agree. My mind immediately went to erroring out as above on the grounds that the user has effectively given <code>uv</code> conflicting instructions. On the other hand, one could argue that, if <code>--active</code> means &quot;use existing packages in the environment&quot;, then it's a somewhat natural extension to include &quot;use existing python from the environment too&quot;.</p>
<p>A backwards-compatible fix might be to simply emit a warning &quot;hey, you used <code>--active</code> but the venv is no good because $reason, we will re-create it&quot; and proceed with the current behaviour. I'd probably even be happy enough if <code>uv</code> just prompted me for confirmation before proceeding with the current behaviour (though that might be considered a breaking change for you guys since the program would be waiting for input at a new location).</p>
<p>Personally I would prefer the erroring approach since if I get that warning I am just going to cancel the operation anyway.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:07 UTC
    </footer>
</body>
</html>
