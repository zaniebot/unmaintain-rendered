<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV fails to fetch wheel when package is specified in build-system requires - astral-sh/uv #6894</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV fails to fetch wheel when package is specified in build-system requires</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6894">#6894</a>
        opened by <a href="https://github.com/CosmicallyCosmo">@CosmicallyCosmo</a>
        on 2024-08-31 17:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/CosmicallyCosmo">@CosmicallyCosmo</a> on 2024-08-31 17:28</div>
            <div class="timeline-body"><p>I've tested this with uv version 4.0.1 with <code>uv sync --reinstall</code>. It successfully installs the package when specified under <code>[dependencies]</code> but get the error below when it's under <code>[build-system] requires</code> (anonymized output):</p>
<pre><code>error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: test-project @ file:///home/test/test-project
  Caused by: Failed to install requirements from build-system.requires (install)
  Caused by: Failed to prepare distributions
  Caused by: Failed to fetch wheel: my-package==0.1.6+b11023884
  Caused by: HTTP status client error (404 Not Found) for url (https://a-gitlab-instance.com/api/v4/projects/1234/packages/pypi/files/my-hash/my-package-0.1.6+b11023884-py3-none-any.whl#sha256=my-hash)
</code></pre>
<p>The index where the package lives is specified as an <code>extra-index-url</code> authenticated with a token in the header. My <code>[build-system]</code> in my <code>pyproject.toml</code> looks like this:</p>
<pre><code>[build-system]
requires = [
    &quot;my-package&quot;,
    &quot;setuptools&quot;,
]

build-backend = &quot;setuptools.build_meta&quot;
</code></pre>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-31 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-31 17:55</div>
            <div class="timeline-body"><p>Interesting... This <em>should</em> work so sounds like a bug if it's behaving as described. Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-01 16:16</div>
            <div class="timeline-body"><p>How are you providing the index URL?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CosmicallyCosmo">@CosmicallyCosmo</a> on 2024-09-02 08:56</div>
            <div class="timeline-body"><p>Hi, I'm providing them in the pyproject.toml as follows. The one containing this package is under <code>extra index-url</code></p>
<pre><code>[tool.uv]
index-url = &quot;https://an-artifactory-instance.com/artifactory/api/pypi/python/simple&quot;
extra-index-url = [&quot;https://__token__:...@a-gitlab-instance.com/api/v4/projects/5678/packages/pypi/simple&quot;, &quot;https://__token__:...@a-gitlab-instance.com/api/v4/projects/1234/packages/pypi/simple&quot;]
</code></pre>
<p>The package is only present in <code>1234</code>, I'm fairly sure it's going to be something to do with the local version identifier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CosmicallyCosmo">@CosmicallyCosmo</a> on 2024-09-02 13:23</div>
            <div class="timeline-body"><p>Hi, I think this is potentially to do how I configure GitLab tokens and not an issue with UV. I use a different token for each registry (each shares the same hostname and port) which I've recently learnt shouldn't work. Sorry about this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-03 14:44</div>
            <div class="timeline-body"><p>I think https://github.com/astral-sh/uv/pull/6389 might solve this as you could define your token for each URL prefix?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CosmicallyCosmo">@CosmicallyCosmo</a> on 2024-09-03 21:21</div>
            <div class="timeline-body"><p>Ah yes probably. I've kind of worked around this by using a ci token which has access to both repos but that'd certainly be useful for local developer rigs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @CosmicallyCosmo on 2024-09-03 21:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:59 UTC
    </footer>
</body>
</html>
