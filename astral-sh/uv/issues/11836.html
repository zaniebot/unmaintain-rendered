<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv publish`: Credentials not used in checking if package exists - astral-sh/uv #11836</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv publish`: Credentials not used in checking if package exists</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11836">#11836</a>
        opened by <a href="https://github.com/doraut">@doraut</a>
        on 2025-02-27 17:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/doraut">@doraut</a> on 2025-02-27 17:12</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When publishing to an index and passing a <code>check-url</code>, the provided credentials are not used when checking if the file exists.</p>
<p>For example:</p>
<pre><code class="language-sh">uv publish \ 
  --publish-url=https://$INDEX_URL \
  --check-url=https://$INDEX_URL/simple \
  --password=$PASSWORD \
  --username=$USERNAME \
  *.whl
</code></pre>
<p>will error if one of the wheels exists and the index does not allow uploading the same file again.</p>
<p>As a workaround, the password and username can be provided in the check-url (<code>--check-url=https://$USERNAME:$PASSWORD@$INDEX_URL/simple</code>).</p>
<h3>Platform</h3>
<p>Ubuntu 24.04.2 x86_64</p>
<h3>Version</h3>
<p>uv 0.6.3</p>
<h3>Python version</h3>
<p>Python 3.11.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @doraut on 2025-02-27 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-27 17:16</div>
            <div class="timeline-body"><p>The username and password are only used for publish URL, not for the check URL, which uses regular index authentication (all the usual way for setting username/password for it work the same as with installation). We've split it this way since usually, upload credentials and fetch credentials are different.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-02-27 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @konstin on 2025-02-27 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kwaegel">@kwaegel</a> on 2025-06-20 17:31</div>
            <div class="timeline-body"><p>@konstin I'm not entirely sure if this is a documentation bug. I was about to file a new bug report that is effectively this, but I have the regular index authentication provided via <code>UV_INDEX_MYCOMPANY_{USERNAME,PASSWORD}</code> and the re-upload check still doesn't work (fails with a 401 Forbidden error). All other commands are able to pull from our private repository (set as the default) just fine, but not <code>uv publish --index</code>.</p>
<p>Using uv 0.7.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-20 17:38</div>
            <div class="timeline-body"><p>Is it the reupload check that fails, or the upload itself that fails? Can you share the commands you use and the log?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asturnus">@asturnus</a> on 2025-07-01 08:46</div>
            <div class="timeline-body"><p>@konstin Can confirm that <code>uv</code> does not read credentials from the environment when publishing with <code>--check-url</code>, so the reupload check fails with <code>401</code>. It does not matter if <code>check-url</code> is specified in the config or as an argument.</p>
<details>
<summary>Click to see the log of publishing to a GitLab registry.</summary>

<pre><code class="language-bash">$ uv publish --check-url $INDEX_URL -vv
DEBUG uv 0.7.17
Publishing 1 file to https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/
DEBUG Using request timeout of 900s
DEBUG Checking for &lt;redacted&gt;.whl in the registry
TRACE Fetching metadata for &lt;redacted&gt; from https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/
TRACE No cache entry exists for /root/.cache/uv/simple-v16/index/840f9e7cec2b1188/&lt;redacted&gt;.rkyv
DEBUG No cache entry for: https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/
TRACE Sending fresh GET request for https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/
TRACE Handling request for https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/ with authentication policy auto
TRACE Request for https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/
TRACE Attempting unauthenticated request for https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/
TRACE Request for https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/ failed with 401 Unauthorized, checking for credentials
TRACE No credentials in cache for URL https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple
TRACE No credentials in cache for realm https://gitlab.com
DEBUG No netrc file found
TRACE Considering retry of response HTTP 401 Unauthorized for https://gitlab.com/api/v4/projects/&lt;redacted&gt;/packages/pypi/simple/&lt;redacted&gt;/
TRACE Cannot retry error: not an IO error
DEBUG Indexes search failed because of status code failure: 401 Unauthorized
WARN Package not found in the registry; skipping upload check for &lt;redacted&gt;.whl
</code></pre>
</details>

<p>Using the same workaround as above: embedding the credentials into <code>check-url</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @konstin on 2025-08-26 15:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-08-27 16:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:26:32 UTC
    </footer>
</body>
</html>
