<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Failed to check python version compatibility of the package when installing or locking - astral-sh/uv #7915</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Failed to check python version compatibility of the package when installing or locking</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7915">#7915</a>
        opened by <a href="https://github.com/vtannguyen">@vtannguyen</a>
        on 2024-10-04 08:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vtannguyen">@vtannguyen</a></div>
            <div class="timeline-body"><p>UV seems to not check the python version compatibility when installing new package using <code>uv pip install</code> or <code>uv add</code> or locking package using <code>uv pip compile</code> or <code>uv lock</code>. The bug found in uv latest version <code>0.4.18</code>. The platform I&#x27;m using is fedora  version 40</p>
<p>To reproduce the bug, please take the following steps:</p>
<ul>
<li>Set up python env to version 3.8.13 using <code>pyenv</code></li>
</ul>
<pre><code>pyenv local 3.8.13
</code></pre>
<ul>
<li>Set up venv and install uv</li>
</ul>
<pre><code>python -m venv .venv
source .venv/bin/activate
pip install uv
</code></pre>
<ul>
<li>Create a simple <code>pyproject.toml</code> file with the following content:</li>
</ul>
<pre><code>[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.8,&lt;3.9&quot;
dependencies = [
]
</code></pre>
<ul>
<li>Try to add new package <code>typing</code></li>
</ul>
<pre><code>uv add typing
</code></pre>
<ul>
<li>You should see the version <code>3.10.0.0</code> is installed</li>
<li>try to uninstall the typing package using pip</li>
</ul>
<pre><code>pip uninstall -y typing
</code></pre>
<ul>
<li>try to install typing version 3.10.0.0 using pip</li>
</ul>
<pre><code>pip install typing==3.10.0.0
</code></pre>
<p>You should get the following error</p>
<pre><code>ERROR: Could not find a version that satisfies the requirement typing==3.10.0.0 (from versions: 3.5.0b1, 3.5.0, 3.5.0.1, 3.5.1.0, 3.5.2.2, 3.5.3.0, 3.6.1, 3.6.2, 3.6.4, 3.6.6, 3.7.4, 3.7.4.1, 3.7.4.3)
ERROR: No matching distribution found for typing==3.10.0.0
</code></pre>
<p>When checking the html response at url https://pypi.org/simple/typing/, you can clearly see that for typing version 3.10.0.0, the required python version is <code>data-requires-python=&quot;&amp;gt;=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, &amp;lt;3.5&quot;</code>, which requires-python = &quot;&gt;=3.8,&lt;3.9&quot; in <code>pyproject.toml</code> file does not satisfy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 13:07</div>
            <div class="timeline-body"><p>We don&#x27;t respect upper-bounds on <code>requires-python</code> for published packages. We treat the <code>requires-python</code> as the lower-bound on Python compatibility. There&#x27;s extensive discussion around this in <a href="https://github.com/astral-sh/uv/issues/4022">astral-sh/uv#4022</a>. You may also be interested in https://discuss.python.org/t/requires-python-upper-limits/12663.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 13:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 13:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 13:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vtannguyen">@vtannguyen</a> on 2024-10-04 14:12</div>
            <div class="timeline-body"><p>But <code>uv</code> managed to install an inappropriate version of <code>typing</code> while pip refused to do so (installing <code>typing</code> version 3.10.0.0 in python 3.8.13 environment). Could I call it a bug?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 14:29</div>
            <div class="timeline-body"><p>No, because from our perspective the package has <code>requires-python = &quot;&gt;=2.7&quot;</code>, which <em>is</em> compatible  We disregard the upper bound.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vtannguyen">@vtannguyen</a> on 2024-10-04 14:41</div>
            <div class="timeline-body"><p>But then uv is incompatible with pip and pip-tools right? Because when i used “pip install .” It installed proper version of typing, which is 3.7.4.3 in python 3.8.13 environment. While uv insisted on 3.10.0.0. Also, when i used uv to compile requirements.txt file to install inside the docker container with pip, it just failed. If I compiled that file using pip-tools, everything works just fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 21:19</div>
            <div class="timeline-body"><p>Yes, our handling of <code>requires-python</code> differs from pip&#x27;s handling of <code>requires-python</code>. I&#x27;d recommend setting a constraint to avoid installing <code>typing==3.10.0.0</code> if you want to avoid that version. If you read the linked discussion from above (it&#x27;s long, I know), there&#x27;s more explanation on the motivation behind this behavior. (It&#x27;s even possible that pip adopts those semantics in the future.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vtannguyen">@vtannguyen</a> on 2024-10-06 07:38</div>
            <div class="timeline-body"><p>I read the discussion above and can understand the reason behind the decision. But the main problem here is the pip compatibility. In the Readme file, it says that uv provide &quot;A pip-compatible interface&quot;. That&#x27;s not correct right? Because <code>uv pip install ...</code> might behave differently than <code>pip install ...</code> and <code>uv pip compile ...</code> might generate a requirements.txt file that is uninstallable by pip. If that is the case, could you please update the description in the Readme.md file, state clearly that <code>uv pip ...</code> is not fully compatible with pip so other developers understand it clearly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-06 09:46</div>
            <div class="timeline-body"><p>uv is a drop-in replacement for common pip commands and operations (as stated in the README), but it’s not guaranteed that every command will behave in exactly the same way — we intentionally deviate when we think it’s correct or necessary to do so (and IMO it’s not really even possible to build a tool that upholds the contract that strictly).</p>
<p>You can read more here: https://docs.astral.sh/uv/pip/compatibility/.</p>
<p>(It’s definitely <em>not</em> common for the requires-python upper-bound to play a role in resolution like this, which is why it almost never comes up in issues.)</p>
<p>If anything, I think it should be gated with a PEP 508 marker such that it’s not installed on Python 3.5 or later as per the package documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vtannguyen">@vtannguyen</a> on 2024-10-06 14:19</div>
            <div class="timeline-body"><p>Thanks for your explanation. Now I&#x27;m more clear on how uv works.</p>
<p>One last question though, the whole purpose of the command <code>uv pip compile ...</code> is to generate a simple text file <code>requirements.txt</code>, which can then be installed anywhere (like inside docker container) with pip right? But now, the requirements.txt file is sometime not installable by pip. So every time I compile that file, I would need to check if I can use pip to install it first. If it&#x27;s not the case, I need to check what is the problem, then try to fix it by restrict some packages versions. With other tool like pip-tools, it guarantees that the compiled requirements.txt file is always installable by pip. So in the end, the time trying to fix the problem might be much more than the time <code>uv</code> saves me because of its performance compare to the other tools.</p>
<p>I hope that the <code>uv</code> team can some how fix that problem and make it better for everyone.</p>
<p>Thanks a lot for creating a great tool with amazing performance.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:29 UTC
    </footer>
</body>
</html>
