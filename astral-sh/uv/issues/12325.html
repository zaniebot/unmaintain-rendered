<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv doesn't respect workspace dependences when defined as extras - astral-sh/uv #12325</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv doesn't respect workspace dependences when defined as extras</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12325">#12325</a>
        opened by <a href="https://github.com/szaher">@szaher</a>
        on 2025-03-19 23:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/szaher">@szaher</a> on 2025-03-19 23:50</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using workspace as extra uv doesn't install/package the workspace dependencies along with the extra.</p>
<pre><code class="language-bash">uv tree
</code></pre>
<pre><code>Resolved 30 packages in 2ms
kubeflow-sdk v0.1.4
├── optimizer v0.18.0rc0 (extra: all)
│   ├── certifi v2025.1.31
│   ├── grpcio v1.71.0
│   ├── kubeflow-training v1.9.0
│   │   ├── certifi v2025.1.31
│   │   ├── kubernetes v32.0.1
│   │   │   ├── certifi v2025.1.31
│   │   │   ├── durationpy v0.9
│   │   │   ├── google-auth v2.38.0
│   │   │   │   ├── cachetools v5.5.2
│   │   │   │   ├── pyasn1-modules v0.4.1
│   │   │   │   │   └── pyasn1 v0.6.1
│   │   │   │   └── rsa v4.9
│   │   │   │       └── pyasn1 v0.6.1
│   │   │   ├── oauthlib v3.2.2
│   │   │   ├── python-dateutil v2.9.0.post0
│   │   │   │   └── six v1.17.0
│   │   │   ├── pyyaml v6.0.2
│   │   │   ├── requests v2.32.3
│   │   │   │   ├── certifi v2025.1.31
│   │   │   │   ├── charset-normalizer v3.4.1
│   │   │   │   ├── idna v3.10
│   │   │   │   └── urllib3 v2.3.0
│   │   │   ├── requests-oauthlib v2.0.0
│   │   │   │   ├── oauthlib v3.2.2
│   │   │   │   └── requests v2.32.3 (*)
│   │   │   ├── six v1.17.0
│   │   │   ├── urllib3 v2.3.0
│   │   │   └── websocket-client v1.8.0
│   │   ├── retrying v1.3.4
│   │   │   └── six v1.17.0
│   │   ├── setuptools v77.0.1
│   │   ├── six v1.17.0
│   │   └── urllib3 v2.3.0
│   ├── kubernetes v32.0.1 (*)
│   ├── protobuf v4.25.6
│   ├── setuptools v77.0.1
│   ├── six v1.17.0
│   └── urllib3 v2.3.0
├── trainer (extra: all)
│   ├── kubernetes v32.0.1 (*)
│   └── pydantic v2.10.6
│       ├── annotated-types v0.7.0
│       ├── pydantic-core v2.27.2
│       │   └── typing-extensions v4.12.2
│       └── typing-extensions v4.12.2
├── optimizer v0.18.0rc0 (extra: optimizer) (*)
├── trainer (extra: optimizer) (*)
└── trainer (extra: trainer) (*)
(*) Package tree already displayed

</code></pre>
<p>when I publish the package to pypi uv doesn't include/define neither the trainer nor the optimizer dependencies.
The dependencies are defined in the workspace pyproject.toml files not in the root file to keep them separated and clean.</p>
<h3>Platform</h3>
<p>macos 15.3 Darwin 24.3.0 arm64</p>
<h3>Version</h3>
<p>uv 0.6.5 (bcbcd0a1e 2025-03-06)</p>
<h3>Python version</h3>
<p>Python 3.10.15</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @szaher on 2025-03-19 23:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-19 23:52</div>
            <div class="timeline-body"><p>Apologies, I don't understand the issue from the above. Can you please include a complete reproduction -- like a GitHub repo we can clone, a series of steps we can run, and the expected vs. actual outcome?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-03-19 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-03-19 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szaher">@szaher</a> on 2025-03-19 23:56</div>
            <div class="timeline-body"><p>@charliermarsh Thanks for the quick response.
the complete repo can be found here https://github.com/szaher/kubeflow-sdk-v2
the pypi release can be found here https://pypi.org/project/kubeflow-sdk/0.1.3/</p>
<p>I am trying to create a project with multiple workspaces. we want to release each workspace as separate extra of the main project.
when we do that as per the repo above, <code>uv build</code> ships the workspace without its dependencies which is defined in the workspace <code>pyproject.toml</code> file</p>
<p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-19 23:58</div>
            <div class="timeline-body"><p>The release looks correct, though, unless I'm misunderstanding? The extras are defined and point to those packages (which you need to publish separately):</p>
<pre><code>Provides-Extra: optimizer
Requires-Dist: optimizer; extra == &quot;optimizer&quot;
Provides-Extra: trainer
Requires-Dist: trainer; extra == &quot;trainer&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szaher">@szaher</a> on 2025-03-20 00:02</div>
            <div class="timeline-body"><p>Not sure how to do that using uv? Do I have to push the extras separately? if yes, can you please point me to the docs on how to do that using uv?
Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/szaher">@szaher</a> on 2025-03-20 00:26</div>
            <div class="timeline-body"><p>some how I managed to fix the issue but I don't like the way it's fixed ... (check this commit https://github.com/szaher/kubeflow-sdk-v2/commit/e1b3d1d4ccc9ea427d614faca4dc4b1945d2af24)</p>
<p>I have root package <code>kubeflow</code> with two workspaces <code>trainer</code> and <code>optimizer</code> which I would like to ship them as extras to the root package.</p>
<p>I defined the <code>trainer</code> dependencies in it's own <a href="https://github.com/szaher/kubeflow-sdk-v2/blob/master/kubeflow/trainer/pyproject.toml#L27-L30">pyproject.toml</a>
and did the same for the <code>optimizer</code> <a href="https://github.com/szaher/kubeflow-sdk-v2/blob/master/kubeflow/optimizer/pyproject.toml#L26-L34">pyproject.toml</a></p>
<p>in the root package if I wanted to define <code>trainer</code> and <code>optimizer</code> as extras with direct dependency on them as per https://github.com/szaher/kubeflow-sdk-v2/blob/9ebc9d4bcb18612ff1ab2c033eca94173392256b/pyproject.toml#L9-L20
that works Ok and ships the extra but pip can't find the extra dependency (the code of the trainer and optimizer is already shipped with the root since the root defines both as workspaces)
anyways, I had to re-add the dependencies of both packages again to root <code>pyproject.toml</code> https://github.com/szaher/kubeflow-sdk-v2/blob/master/pyproject.toml#L9-L36 to around that issue and it worked</p>
<p>@charliermarsh is there a way with <code>uv</code> to get the workspace dependencies from its <code>pyproejct.toml</code> file if it's being used as extras? that would make things cleaner and reduce the duplication ....</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../kubeflow/sdk/issues/20.html">kubeflow/sdk#20</a> on 2025-03-20 00:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:02 UTC
    </footer>
</body>
</html>
