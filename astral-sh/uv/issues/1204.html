<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimize cold start with refresh by prefetching revalidation requests - astral-sh/uv #1204</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Optimize cold start with refresh by prefetching revalidation requests</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1204">#1204</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-01-31 12:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>If the last request was &gt;10min or when using <code>--refresh</code> or , we observe a slow start pattern: We make revalidation requests for direct dependencies first, and only when those succeed, we start scheduling more requests in parallel. Instead, we should assume that the transitive dependency remain the same and already start prefetching revalidation requests for them in the background.</p>
<p>Example below: Resolving <code>jupyter</code></p>
<pre><code>RUST_LOG=puffin=info TRACING_DURATIONS_FILE=target/traces/jupyter-refresh.ndjson cargo run --features tracing-durations-export --bin puffin --profile profiling -- pip compile --refresh scripts/requirements/jupyter.in
</code></pre>
<p><img src="https://github.com/astral-sh/puffin/assets/6826232/f14eef37-5534-4164-ab35-7f69a912f736" alt="image"></p>
<p>See also <a href="https://github.com/astral-sh/puffin/issues/1206">astral-sh/puffin#1206</a> for the case with a lockfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by <a href="https://github.com/konstin">@konstin</a> on 2024-01-31 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-31 15:24</div>
            <div class="timeline-body"><p>Agree. We actually might want to do this prefetching <em>always</em> when we have an existing requirements.txt?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-31 15:35</div>
            <div class="timeline-body"><p>(Do you want to benchmark it?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-31 15:49</div>
            <div class="timeline-body"><p>Good idea! Opened a separate issue since the prefetching will be in a different place: <a href="https://github.com/astral-sh/puffin/issues/1206">astral-sh/puffin#1206</a></p>
<blockquote>
<p>(Do you want to benchmark it?)</p>
</blockquote>
<p>I want to finish windows testing first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-31 15:51</div>
            <div class="timeline-body"><blockquote>
<p>I want to finish windows testing first.</p>
</blockquote>
<p>Good prioritization.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-01-14 18:58</div>
            <div class="timeline-body"><p>Closing this since i can&#x27;t reproduce the speedup anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2025-01-14 18:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:29:10 UTC
    </footer>
</body>
</html>
