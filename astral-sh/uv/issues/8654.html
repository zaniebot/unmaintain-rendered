<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv run and SIGINT propagation - astral-sh/uv #8654</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv run and SIGINT propagation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8654">#8654</a>
        opened by <a href="https://github.com/hynek">@hynek</a>
        on 2024-10-29 08:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hynek">@hynek</a></div>
            <div class="timeline-body"><p>Signal handling is weird and one of the most confusing parts is the handling of SIGINT / KeyboardInterrupt / Ctrl-C. Because for non-0-PID processes, a manual Ctrl-C is usually propagated to its children (overly simplifying here) â€“ a SIGINT is not despite being the same signal.</p>
<hr />
<p>Running Python scripts with <code>uv run</code> doesn't quite play along which is what I noticed when trying to use it with <a href="https://pypi.org/project/watchfiles/">watchfiles</a>:</p>
<p>When I start a script using uv and wrapped in watchfiles, pressing Ctrl-C reaches my application. watchfiles's SIGINT, does <strong>not</strong>. If I replace <code>uv run</code> by a Python interpreter, it works.</p>
<hr />
<p>For example:</p>
<pre><code class="language-python">import os, time

try:
    print(os.getpid())
    time.sleep(600)
except KeyboardInterrupt:
    print(&quot;got sigint!&quot;)
</code></pre>
<p>Pressing Ctrl-C works:</p>
<pre><code class="language-python">$ uv run sleepy.py
85706
^Cgot sigint!
</code></pre>
<p><code>kill -sigint 85859</code> works too:</p>
<pre><code class="language-console">$ uv run sleepy.py
85859
got sigint!
</code></pre>
<p>But (this watches the file sleepy.py that I touch in another terminal):</p>
<pre><code class="language-console">$ uvx watchfiles 'uv run sleepy.py' sleepy.py
[08:56:39] watchfiles v0.24.0 ðŸ‘€  path=&quot;/Users/hynek/tmp/sleepy.py&quot; target=&quot;uv run sleepy.py&quot; (command) filter=DefaultFilter...
86705
[08:56:40] 1 change detected
[08:56:45] SIGINT timed out after 5 seconds
[08:56:45] process has not terminated, sending SIGKILL
86739
^Cgot sigint!
got sigint!
[08:56:48] KeyboardInterrupt caught, stopping watch
[08:56:48] process already dead, exit code: 0
</code></pre>
<p>Note how my ^C goes thru.</p>
<p>Replacing <code>uv run</code> by Python works:</p>
<pre><code class="language-console">$ uvx watchfiles 'python3.13 sleepy.py' sleepy.py
[08:55:43] watchfiles v0.24.0 ðŸ‘€  path=&quot;/Users/hynek/tmp/sleepy.py&quot; target=&quot;python3.13 sleepy.py&quot; (command) filter=DefaultFilter...
86420
[08:55:46] 1 change detected
got sigint!
86445
</code></pre>
<p>So, it looks like uv is somehow eating that signal? cc @samuelcolvin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-10-29 14:08</div>
            <div class="timeline-body"><p>I also had issues, although I didn't investigate enough whether it was uv or uvicorn primarily causing the issue.</p>
<p>I have some code that calls a subprocess using uv run and I could not find a way to successfully kill it: https://github.com/notatallshaw/Pip-Resolution-Scenarios-and-Benchmarks/blob/d1dd9cee7b3e174d1840e4120be5d10035450fd8/scenarios.py#L58</p>
<p>As it was a webserver, in the end I created an API to shut itself down, but if uv could improve here that would be great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-29 14:15</div>
            <div class="timeline-body"><p>Duplicate of https://github.com/astral-sh/uv/issues/6724</p>
<p>See also https://github.com/astral-sh/uv/pull/6738#issuecomment-2315466033</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @zanieb on 2024-10-29 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-29 14:15</div>
            <div class="timeline-body"><p>Unfortunately we just haven't had the time to dig deep into this. I'd love some help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hynek">@hynek</a> on 2024-10-29 14:31</div>
            <div class="timeline-body"><p>huh I swear I searched for <code>uv run</code>. ðŸ™ˆ Extra funny that it quotes my own blog post.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @hynek on 2024-10-29 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samuelcolvin">@samuelcolvin</a> on 2024-10-29 21:52</div>
            <div class="timeline-body"><p>Thanks for cc'ing me, I'll watch the other issue, happy to make changes in watchfiles if it helps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hynek">@hynek</a> on 2024-10-30 06:55</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for cc'ing me, I'll watch the other issue, happy to make changes in watchfiles if it helps.</p>
</blockquote>
<p>I think you might be able to help with https://github.com/astral-sh/uv/pull/6738#issuecomment-2315466033? I really don't know enough about Rust to be of great help here. <em>eyes his Stevens books</em></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:00 UTC
    </footer>
</body>
</html>
