<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow dependency metadata entries for path sources - astral-sh/uv #15715</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow dependency metadata entries for path sources</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15715">#15715</a>
        opened by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a>
        on 2025-09-08 01:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a></div>
            <div class="timeline-body">Summary
<p>As far as I can tell, <code>tool.uv.dependency-metadata</code> are not supported for Path sources.</p>
<p>For some motivation, I have a piece of proprietary software which installs a wheel file at a specific location in Windows, say <code>C:/Program Files/ProprietaryFoo/foo-0.1.0-py3-none-any.whl</code>. I&#x27;d like it to be an optional dependency for the project so I have</p>
<pre><code>[project]
optional-dependencies.foo = [ &quot;foo; sys_platform==&#x27;win32&#x27;&quot; ]

[tool.uv.sources]
foo = { path = &quot;C:/Program Files/ProprietaryFoo/foo-0.1.0-py3-none-any.whl&quot;, marker = &quot;sys_platform == &#x27;win32&#x27;&quot; }
</code></pre>
<p>This works fine locally, but then on CI running Linux, the resolver will try to access the path, which doesn&#x27;t exist, similar to #8389.</p>
<p>As a temporary workaround, I&#x27;m just going to create a dummy <code>.whl</code> at that location on the CI.</p>
Example
<p>Ideally, I&#x27;d like to be able to declare <code>dependency-metadata</code> over-rides to make it possible to avoid resolving this path when the markers don&#x27;t match. For example:</p>
<pre><code>[[tool.uv.dependency-metadata]]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
requires-dist = [ &quot;protobuf&lt;6.0.0,&gt;=5.29.0&quot; ]
</code></pre>
<p>However, as it stands, this doesn&#x27;t seem to have any effect.</p>
<p>Perhaps as an aside, it would also be nice if the dependency over-rides kicked in even when the markers match (e.g. if the proprietary software wasn&#x27;t installed on Windows). I don&#x27;t think it should be necessary to access the wheel file unless actually trying to install the optional dependency (it&#x27;s optional, after all).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2025-09-08 01:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-08 01:45</div>
            <div class="timeline-body"><p>It is supported for direct URL dependencies. Can you include verbose logs or a minimal reproduction?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2025-09-08 02:09</div>
            <div class="timeline-body"><p>This is for a (local) path dependency (https://docs.astral.sh/uv/concepts/projects/dependencies/#path), not a URL dependency.</p>
<p>In terms of a minimal reproduction, try setting <code>pyproject.toml</code> to the following and running on Linux:</p>
<pre><code>[project]
name = &quot;demo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = []
optional-dependencies.foo = [ &quot;foo; sys_platform==&#x27;win32&#x27;&quot; ]

[tool.uv.sources]
foo = { path = &quot;C:/Program Files/ProprietaryFoo/foo-0.1.0-py3-none-any.whl&quot;, marker = &quot;sys_platform == &#x27;win32&#x27;&quot; }

[[tool.uv.dependency-metadata]]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
requires-dist = [ &quot;protobuf&lt;6.0.0,&gt;=5.29.0&quot; ]
</code></pre>
<p>I would expect <code>uv sync</code> to run successfully on Linux in this case, since the <code>foo</code> dependency has its metadata declared explicitly, and resolving from the (non-existent) path shouldn&#x27;t be necessary.</p>
<p>Similarly, on Windows, the following <code>pyproject.toml</code> should reproduce:</p>


<pre><code>[project]
name = &quot;demo&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = []
optional-dependencies.foo = [ &quot;foo; sys_platform==&#x27;linux&#x27;&quot; ]

[tool.uv.sources]
foo = { path = &quot;/foo-0.1.0-py3-none-any.whl&quot;, marker = &quot;sys_platform == &#x27;linux&#x27;&quot; }

[[tool.uv.dependency-metadata]]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
requires-dist = [ &quot;protobuf&lt;6.0.0,&gt;=5.29.0&quot; ]
</code></pre>


<p>Which gives the following log when running <code>uv sync -vvv</code>:</p>


<pre><code>DEBUG uv 0.7.13 (62ed17b23 2025-06-12)
DEBUG Found project root: `C:\Users\namc\Temp\demo`
DEBUG No workspace root found, using project root
TRACE Checking lock for `C:\Users\namc\Temp\demo` at `C:\Users\namc\AppData\Local\Temp\uv-d9d139ad2fabec31.lock`
DEBUG Acquired lock for `C:\Users\namc\Temp\demo`
DEBUG Reading Python requests from version file at `C:\Users\namc\Temp\demo\.python-version`
DEBUG Using Python request `3.13` from version file at `.python-version`
DEBUG Checking for Python environment at `.venv`
TRACE Cached interpreter info for Python 3.13.2, skipping probing: .venv\Scripts\python.exe
DEBUG The project environment&#x27;s Python version satisfies the request: `Python 3.13`
TRACE The project environment&#x27;s Python version meets the Python requirement: `&gt;=3.13`
DEBUG Released lock at `C:\Users\namc\AppData\Local\Temp\uv-d9d139ad2fabec31.lock`
TRACE Checking lock for `.venv` at `.venv\.lock`
DEBUG Acquired lock for `.venv`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: demo @ file:///C:/Users/namc/Temp/demo
DEBUG No workspace root found, using project root
TRACE Performing lookahead for demo[foo] @ file:///C:/Users/namc/Temp/demo
TRACE Performing lookahead for foo @ file:///C:/foo-0.1.0-py3-none-any.whl ; sys_platform == &#x27;linux&#x27; and extra == &#x27;foo&#x27;
DEBUG Released lock at `C:\Users\namc\Temp\demo\.venv\.lock`
error: Distribution not found at: file:///C:/foo-0.1.0-py3-none-any.whl
</code></pre>


</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:17 UTC
    </footer>
</body>
</html>
