<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: Have MACOSX_DEPLOYMENT_TARGET as uv config or have a default place from where env vars are loaded for uv - astral-sh/uv #9837</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: Have MACOSX_DEPLOYMENT_TARGET as uv config or have a default place from where env vars are loaded for uv</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9837">#9837</a>
        opened by <a href="https://github.com/uwu-420">@uwu-420</a>
        on 2024-12-12 12:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/uwu-420">@uwu-420</a> on 2024-12-12 12:47</div>
            <div class="timeline-body"><p>Hi all, thanks for making uv!</p>
<p>To not hijack the original issue any further I want to add to a question I had in <a href="https://github.com/astral-sh/uv/issues/3454#issuecomment-2487971792">#3454</a>.</p>
<p>I need the macOS deployment target to be lower than the default of 12.0 (<a href="https://docs.astral.sh/uv/configuration/environment/#macosx_deployment_target">see docs</a>) so currently I would have to set the environment variable <code>MACOSX_DEPLOYMENT_TARGET</code> myself before calling uv. Alternatively, I can create some kind of <code>.env</code> file and make uv use that one by either passing the CLI argument <code>--env-file=...</code> or setting the environment variable <code>UV_ENV_FILE</code> accordingly (<a href="https://docs.astral.sh/uv/configuration/files/#env">see docs</a>).</p>
<p>But at least I would prefer to have a way to specify the macOS deployment target such that everyone else working on my project doesn't have to think about setting the according environment variables themselves. Cloning the project and running <code>uv sync</code> should be all that's necessary. Right now one would have to make sure that either <code>MACOSX_DEPLOYMENT_TARGET</code> or <code>UV_ENV_FILE</code> are set correctly or use the CLI argument every time. There are IDE/editor specific solutions like putting the environment variables into <code>.vscode/settings.json</code> -&gt; <code>terminal.integrated.env.linux</code> but that's not really a solution imo.</p>
<p>So first off, am I missing some way to achieve this already?</p>
<p>If not, I suggest two solutions:</p>
<ol>
<li>Make the <code>MACOSX_DEPLOYMENT_TARGET</code> environment variable a first-class config supported by uv such that it can be e.g. set in <code>pyproject.toml</code>.</li>
<li>Add some default env file that is read by all uv commands unless explicitly specified not to. For example <code>uv.env</code> or <code>.env.uv</code>.</li>
</ol>
<p>Looking forward to reading your thoughts on this :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-12-12 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-12-12 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gmarzot">@gmarzot</a> on 2025-01-02 13:13</div>
            <div class="timeline-body"><p>+1 similar problem. seems to be defaulting to 10.9</p>
<p>(uv) gmarzot@MarzBook folly % sw_vers
ProductName:            macOS
ProductVersion:         15.2
BuildVersion:           24C101
(uv) gmarzot@MarzBook folly % pkgutil --pkg-info=com.apple.pkg.CLTools_Executables
package-id: com.apple.pkg.CLTools_Executables
version: 16.2.0.0.1.1733547573
volume: /
location: /
install-time: 1734703931</p>
<p>./.venv/cpython-3.13.1-macos-x86_64-none/lib/python3.13/config-3.13-darwin/Makefile:CONFIGURE_CFLAGS=   -arch x86_64 -mmacosx-version-min=10.9 -Wno-nullability-completeness -Wno-expansion-to-defined -Wno-undef-prefix   -fPIC    -Werror=unguarded-availability-new</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-02 14:37</div>
            <div class="timeline-body"><p>What do you mean by &quot;defaulting to&quot;? In what context? This isn't a uv environment variable. You're referencing something from the Python build.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gmarzot">@gmarzot</a> on 2025-01-02 14:47</div>
            <div class="timeline-body"><blockquote>
<p>What do you mean by &quot;defaulting to&quot;? In what context? This isn't a uv environment variable. You're referencing something from the Python build.</p>
</blockquote>
<p>yes you are right and perhaps not something uv would have direct control over.. i guess i could tell uv to rebuild w/ different settings. I have a build that looks at these vars provided by the python and i was looking for ways to override that.</p>
<pre><code class="language-python">for key in ('CFLAGS', 'CCSHARED', 'LDSHARED', 'LDCXXSHARED', 'PY_LDFLAGS', 'PY_CFLAGS', 'PY_CPPFLAGS'):
        if key in cfg_vars:
            cfg_vars[key] = cfg_vars[key].replace('-mmacosx-version-min=10.9', '-mmacosx-version-min=10.13')
</code></pre>
<p>btw - am installing python 3.13.1 and was surprised to see that in the flags</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/uwu-420">@uwu-420</a> on 2025-01-13 09:18</div>
            <div class="timeline-body"><p>Guess I'm grasping at straws here, but maybe something like this could also be an idea?</p>
<pre><code class="language-toml">[tool.uv]
environments = [
    &quot;sys_platform == 'darwin' and platform_release &gt;= '19'&quot;,
]
</code></pre>
<p>I took the darwin kernel version for macOS 10.15 from here https://theapplewiki.com/wiki/Kernel.
But uv doesn't take this into account I think? Or the python packages themselves don't specify this information?
Either way, I tried setting the <code>platform_release</code> to something ridiculous like <code>99</code> and <code>uv lock</code> happily resolved everything.
Not sure if this is a good approach though.</p>
<p>Edit: Tagentially, something like <code>platform_machine == 'arm64'</code> isn't considered in the environments as well if I see correctly? I tried finding more information in the docs, but couldn't find which markers are considered for resolution by uv and which are not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10067.html">astral-sh/uv#10067</a> on 2025-02-18 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/uwu-420">@uwu-420</a> on 2025-02-18 09:20</div>
            <div class="timeline-body"><p>Good news, it's getting closer, see https://github.com/astral-sh/uv/pull/10067 but it's not just there yet.
For now, one can at least do something like this</p>
<pre><code class="language-toml">[tool.uv]
required-environments = [
    &quot;sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;
]
</code></pre>
<p>See https://docs.astral.sh/uv/concepts/resolution/#required-environments</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ncoghlan">@ncoghlan</a> on 2025-10-27 15:02</div>
            <div class="timeline-body"><p>@charliermarsh A concrete use case for this comes up with Apple's MLX library, where they publish multiple wheels with different minimum macOS versions (alongside a single manylinux wheel): https://pypi.org/project/mlx/0.29.3/#files</p>
<p>Currently, the specification that macOS wheel installations and wheel builds should use a newer (or older) target deployment version than the system the build is running on can't be captured in <code>pyproject.toml</code>/<code>uv.toml</code>, it has to be separately set up in the environment invoking <code>uv</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../lmstudio-ai/venvstacks/issues/292.html">lmstudio-ai/venvstacks#292</a> on 2025-10-27 15:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @konstin on 2025-10-27 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2025-10-27 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/uwu-420">@uwu-420</a> on 2025-10-27 18:51</div>
            <div class="timeline-body"><p>@ncoghlan +1 for your example. Maybe uv could try to do something similar to what https://github.com/prefix-dev/pixi does, where you can specify system requirements like the minimum glibc version or the minimum macOS version in the <code>pyproject.toml</code> or <code>pixi.toml</code> file, see https://pixi.sh/latest/workspace/system_requirements/#default-system-requirements</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ncoghlan">@ncoghlan</a> on 2025-10-30 13:17</div>
            <div class="timeline-body"><p>Attempting to use the workaround of setting <code>MACOSX_DEPLOYMENT_TARGET</code> in the environment settings, we also ran into the problem where that isn't part of the default <code>cache-keys</code> setting: https://docs.astral.sh/uv/reference/settings/#cache-keys</p>
<p>With <code>uv.lock</code> not being invalidated, setting <code>MACOSX_DEPLOYMENT_TARGET</code> initially appears to have no effect on the wheel selection (since the now stale <code>uv.lock</code> isn't being detected as stale)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:49 UTC
    </footer>
</body>
</html>
