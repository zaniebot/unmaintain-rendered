<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow per-package overrides - astral-sh/uv #2686</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow per-package overrides</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/2686">#2686</a>
        opened by <a href="https://github.com/adzenith">@adzenith</a>
        on 2024-03-27 05:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/adzenith">@adzenith</a></div>
            <div class="timeline-body"><p><a href="https://github.com/astral-sh/uv/issues/511#issuecomment-1831526605">This comment</a> discusses a second type of dependency overriding:</p>
<blockquote>
<p>Replace the requirement on foo==1.2.3 in bar with foo==4.5.6. With this, you say &quot;While bar wants foo 1.2.3, i have confirmed that it is actually compatible with foo 4.5.6, too&quot;. It requires more effort on the user side, but is less risky and gives good errors messages when new requirements on foo are added outside of bar.</p>
</blockquote>
<p>The parent ticket was resolved based on the first idea (global overrides) and I didn't see another ticket to track this second idea, which as stated is less risky and could give better error messages. I would love to see this feature!</p>
<p>Thanks! I've been having an amazing time with <code>uv</code> so far.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-03-29 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmc-cs-mdrissi">@hmc-cs-mdrissi</a> on 2024-08-09 18:42</div>
            <div class="timeline-body"><p>Supportive of this and hit it today. I have several libraries that depend on library A with various constraints. Most of them have flexible enough constraints that I want them to be used and resolved. A few have constraints that are too tight and I've tested and have confidence it's ok to relax a bit.</p>
<p>I ended up working around this by dropping dependencies I knew I could relax, resolving, then adding them back and adding override. Would be safer experience if I could say this directly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 00:33</div>
            <div class="timeline-body"><p>This might now exist as <code>[[tool.uv.dependency-metadata]]</code>?</p>
<p>https://docs.astral.sh/uv/concepts/resolution/#dependency-metadata</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kitryn">@Kitryn</a> on 2025-01-03 08:25</div>
            <div class="timeline-body"><p>ran into this today and not sure if I'm understanding the solution correctly</p>
<p>issue: we have some dependency <code>solders</code> that both <code>anchorpy</code> and <code>solana</code> depend on. <code>solana==0.36.1</code> depends on <code>solders~=0.23.0</code>, whereas <code>anchorpy==0.20.1</code> depends on <code>solders~=0.21.0</code>, thus uv fails as expected, but we know (assume...) that <code>anchorpy==0.20.1</code> in fact can work with <code>solders~=0.23.0</code></p>
<p>We can solve this with global overrides, but ideally we'd like to do this with per-package overrides as previously mentioned. Tried using <code>[[tool.uv.dependency-metadata]]</code>:</p>
<pre><code>[[tool.uv.dependency-metadata]]
name = &quot;anchorpy&quot;
version = &quot;0.20.1&quot;
requires-dist = [&quot;solders~=0.23.0&quot;]
</code></pre>
<p>Is this what the above solution was referring to? Does that mean we have to include <code>anchorpy</code>'s entire list of dependencies in this field? Since if we don't, this replaces the entire dependency list of <code>anchorpy</code> with the contents of <code>requires-dist</code> so other dependencies don't get installed</p>
<p>example pyproject.toml:</p>
<pre><code>[project]
name = &quot;test-uv&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;solana~=0.36.1&quot;,
    &quot;anchorpy~=0.20.0&quot;
]

[[tool.uv.dependency-metadata]]
name = &quot;anchorpy&quot;
version = &quot;0.20.0&quot;
requires-dist = [&quot;solders~=0.23.0&quot;]
</code></pre>
<p>Resultant <code>uv.lock</code> snippet:</p>
<pre><code>...
[[manifest.dependency-metadata]]
name = &quot;anchorpy&quot;
version = &quot;0.20.0&quot;
requires-dist = [&quot;solders~=0.23.0&quot;]

[[package]]
name = &quot;anchorpy&quot;
version = &quot;0.20.0&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
dependencies = [
    { name = &quot;solders&quot; },
]
sdist = { url = &quot;https://files.pythonhosted.org/packages/1b/52/9a2a6a515d5f8aec195c691f26222ef2788f442e867bf3ef6de742b972e2/anchorpy-0.20.0.tar.gz&quot;, hash = &quot;sha256:4bb4b558f3d566b23e7438b78b441040a52d980ac573fdf3897600b555d37fd9&quot;, size = 48047 }
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/17/18/9ff75cbcbdcdce7c79daf7932ef26e168e5ba6ddd09b4cc01eb6339c4092/anchorpy-0.20.0-py3-none-any.whl&quot;, hash = &quot;sha256:173cfbe9bab0ec0ea2548fc82864077880168dc62270b291192b73bb821bb13c&quot;, size = 63048 },
]
...
</code></pre>
<p>Also (don't know if related) - if <code>solana</code> was commented out in the pyproject.toml (i.e. single <code>anchorpy</code> dependency with the <code>tool.uv.dependency-metadata</code> field still included, attempting to override <code>solders</code> version), then the resultant uv.lock is as if there's no override (<code>solders==0.21.0</code> gets installed)</p>
<p>Thanks! <code>uv</code> has been really great in our monorepo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rinarakaki">@rinarakaki</a> on 2025-02-22 09:26</div>
            <div class="timeline-body"><p>I want this feature when I know I can safely ignore dependency conflicts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kitryn">@Kitryn</a> on 2025-05-20 04:36</div>
            <div class="timeline-body"><p>any update on this? thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jiridanek">@jiridanek</a> on 2025-08-27 11:04</div>
            <div class="timeline-body"><ul>
<li>https://github.com/astral-sh/uv/issues/4422#issuecomment-2638910299</li>
</ul>
<pre><code class="language-toml">[[tool.uv.dependency-metadata]]
name = &quot;anchorpy&quot;
version = &quot;0.20.1&quot;
requires-dist = [&quot;solders~=0.23.0&quot;]
</code></pre>
<blockquote>
<p>Is this what the above solution was referring to? Does that mean we have to include anchorpy's entire list of dependencies in this field?</p>
</blockquote>
<p>Yes, we'd have to include anchorpy's entire list of dependencies in this field, besides the changed one we're overriding. So while this can be one off fix for problems related to this issue and also for</p>
<ul>
<li>https://github.com/astral-sh/uv/issues/4422</li>
</ul>
<p>the result is hard-to-maintain because error-prone pyproject.toml.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:24:31 UTC
    </footer>
</body>
</html>
