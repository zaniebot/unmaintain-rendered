<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv init --build-backend scikit followed by uv run --with jupyter jupyter lab has counterintuitive behaviour concerning rebuilds - astral-sh/uv #15701</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv init --build-backend scikit followed by uv run --with jupyter jupyter lab has counterintuitive behaviour concerning rebuilds</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15701">#15701</a>
        opened by <a href="https://github.com/rimathia">@rimathia</a>
        on 2025-09-05 11:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rimathia">@rimathia</a> on 2025-09-05 11:08</div>
            <div class="timeline-body"><h3>Question</h3>
<p>This is probably just a documentation request. My first step is
<code>uv init --build-backend scikit</code>
which works as expected, next I'm starting a jupyter notebook using
<code>uv run --with jupyter jupyter lab</code>
which also works as expected, it builds the C++ extension and I can now create a notebook (using the default kernel) where I can load the C++ python extension. This is a massive improvement over any other tool or workflow that I've tried.
However, I haven't been able to find out the right way to invoke uv to create a jupyter kernel such that it rebuilds the C++ extension if the source files have changed. One way which does work is
<code>uv clean &amp;&amp; rm -r .venv &amp;&amp; uv run --with jupyter jupyter lab</code>
but that is certainly not the way to do it.</p>
<p>Maybe the uv init --build-backend scikit could document the right invocations (for example in the README.md which it creates which is empty by default) or it could print the two or three most frequent workflow commands to the command line after it has created the environment.</p>
<h3>Platform</h3>
<p>Darwin 24.5.0 arm64</p>
<h3>Version</h3>
<p>uv 0.7.19 (38ee6ec80 2025-07-02)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @rimathia on 2025-09-05 11:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 12:24</div>
            <div class="timeline-body"><p>Are you looking for the <code>--refresh-package</code> option?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rimathia">@rimathia</a> on 2025-09-05 14:47</div>
            <div class="timeline-body"><p>Thanks, <code>--refresh-package</code> doesn't recompile the C++ code, but <code>--reinstall</code> does. Given how fast the package reinstallation is, that is perfecly fine for a edit-compile-test cycle with a jupyter notebook.
I'll close this. There are certainly good reasons why a change to the <code>pyproject.toml</code> triggers changes to the python environment for other commands than changes to the python extension source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @rimathia on 2025-09-05 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 15:12</div>
            <div class="timeline-body"><p>The reason is mostly that we know that <code>pyproject.toml</code> files should rebuild, but we don't know which other files are relevant. You can control this behavior with https://docs.astral.sh/uv/reference/settings/#cache-keys.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rimathia">@rimathia</a> on 2025-09-05 15:21</div>
            <div class="timeline-body"><p>Thanks for the bonus tip, using
<code>[tool.uv] cache-keys = [{ file = &quot;pyproject.toml&quot; }, { file = &quot;requirements.txt&quot; },  { file = &quot;src/**.*&quot; }]</code>
I get exactly the behaviour that I intuitively expected: every change of a source file triggers a rebuild of the python extension.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15705.html">astral-sh/uv#15705</a> on 2025-09-06 10:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../hkant27008/uv-package-manager/pulls/1.html">hkant27008/uv-package-manager#1</a> on 2025-09-12 10:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:12 UTC
    </footer>
</body>
</html>
