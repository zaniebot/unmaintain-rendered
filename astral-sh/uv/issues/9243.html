<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Again problems with the --native-tls flag or SSL_CERT_FILE - astral-sh/uv #9243</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Again problems with the --native-tls flag or SSL_CERT_FILE</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/9243">#9243</a>
        opened by <a href="https://github.com/andreamoro">@andreamoro</a>
        on 2024-11-19 20:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-11-19 20:12</div>
            <div class="timeline-body"><p>After a small period of joy, again today I'm experiencing problems in using the uv pip install.
Whether using the <code>--native-tls</code> or setting the <code>SSL_CERT_FILE</code>, both the approach resolve in a &quot;Failed to tech error&quot;.</p>
<img width="654" alt="image" src="https://github.com/user-attachments/assets/887ed237-b809-4308-ab8f-df2d6accfb03">

<p>When it comes to the SSL_CERT_FILE, read-only permissions on the file were given. Not sure this would be making any difference at this stage.</p>
<p>UV version tried, both the 0.4.28 and the 0.5.2</p>
<p>Would someone so kind to provide some debugging steps?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-19 20:24</div>
            <div class="timeline-body"><p>Can you share verbose logs? You can also use <code>RUST_LOG=debug</code> to get logs from the networking stack, it'll be very verbose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-11-19 20:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-11-19 20:28</div>
            <div class="timeline-body"><pre><code>DEBUG uv 0.5.2 (Homebrew 2024-11-14)
DEBUG Searching for default Python interpreter in virtual environments
DEBUG Found `cpython-3.12.1-macos-aarch64-none` at `/Users/andreamoro/.pyenv/versions/3.12.1/envs/DataAnalysis/bin/python3` (active virtual environment)
Using Python 3.12.1 environment at .pyenv/versions/3.12.1/envs/DataAnalysis
DEBUG Acquired lock for `.pyenv/versions/3.12.1/envs/DataAnalysis`
DEBUG At least one requirement is not satisfied: seaborn
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.1
DEBUG Solving with target Python version: &gt;=3.12.1
DEBUG Adding direct dependency: seaborn*
DEBUG No cache entry for: https://pypi.org/simple/seaborn/
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
DEBUG Released lock at `/Users/andreamoro/.pyenv/versions/3.12.1/envs/DataAnalysis/.lock`
error: Failed to fetch: `https://pypi.org/simple/seaborn/`
  Caused by: Request failed after 3 retries
  Caused by: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-11-19 20:30</div>
            <div class="timeline-body"><p>Or with the rust_log enabled</p>
<pre><code>❯ uv pip install --native-tls seaborn --verbose
DEBUG uv 0.5.2 (Homebrew 2024-11-14)
DEBUG Searching for default Python interpreter in virtual environments
DEBUG Found `cpython-3.12.1-macos-aarch64-none` at `/Users/andreamoro/.pyenv/versions/3.12.1/envs/DataAnalysis/bin/python3` (active virtual environment)
Using Python 3.12.1 environment at .pyenv/versions/3.12.1/envs/DataAnalysis
DEBUG Acquired lock for `.pyenv/versions/3.12.1/envs/DataAnalysis`
DEBUG At least one requirement is not satisfied: seaborn
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.12.1
DEBUG Solving with target Python version: &gt;=3.12.1
DEBUG Adding direct dependency: seaborn*
INFO add_decision: root @ 0a0.dev0 without checking dependencies
DEBUG No cache entry for: https://pypi.org/simple/seaborn/
DEBUG starting new connection: https://pypi.org/
DEBUG connecting to 151.101.192.223:443
DEBUG connected to 151.101.192.223:443
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
WARN Retry attempt #0. Sleeping 425.833483ms before the next attempt
DEBUG starting new connection: https://pypi.org/
DEBUG connecting to 151.101.192.223:443
DEBUG connected to 151.101.192.223:443
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
WARN Retry attempt #1. Sleeping 1.954031005s before the next attempt
DEBUG starting new connection: https://pypi.org/
DEBUG connecting to 151.101.192.223:443
DEBUG connected to 151.101.192.223:443
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
WARN Retry attempt #2. Sleeping 1.038860859s before the next attempt
DEBUG starting new connection: https://pypi.org/
DEBUG connecting to 151.101.192.223:443
DEBUG connected to 151.101.192.223:443
DEBUG Transient request failure for https://pypi.org/simple/seaborn/, retrying: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
DEBUG Released lock at `/Users/andreamoro/.pyenv/versions/3.12.1/envs/DataAnalysis/.lock`
error: Failed to fetch: `https://pypi.org/simple/seaborn/`
  Caused by: Request failed after 3 retries
  Caused by: error sending request for url (https://pypi.org/simple/seaborn/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
</code></pre>
<p>It looks like he doesn't like the certificate, but it's the same I used the other time I was able to get it through... generated from the system settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-19 20:33</div>
            <div class="timeline-body"><p>Thanks! Yeah I'm not sure what to tell you here, it looks like the certificate is wrong — this usually has nothing to do with uv's implementation. You can get <em>more</em> logs with <code>RUST_LOG=trace</code> but I doubt it'll show anything interesting. Does the cert work with other tools?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-11-19 20:47</div>
            <div class="timeline-body"><p>Yes it does :(
But why the --native-tls is not going to work anymore? That one should look at the system settings, no?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-19 21:02</div>
            <div class="timeline-body"><p>The behavior of that flag should not have changed, I'm assuming this stopped working without you changing your uv version? What kind of proxy are you using? Who runs it? How do you know the cert is up to date?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-11-19 21:06</div>
            <div class="timeline-body"><p>Update uv today after this was failing. Company is using Zscaler. Cert was verified against the Keychain file ... and just in case I made a new bundle seconds ago just to confirm this was updated, but yet not joy.</p>
<p>In any case I validated the .pem file using the <code>openssl x509 -in &quot;/Documents/ZscalerCertificate.pem&quot; -text -noout</code> command with success.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-19 21:22</div>
            <div class="timeline-body"><p>But you said this also fails on an old version of uv? What was the last working version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-11-20 10:03</div>
            <div class="timeline-body"><p>That's a very good question. I might have ran a brew upgrade at some point, but I don't remember whether uv was upgraded and which version I had before. My bad.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/solomchuk">@solomchuk</a> on 2024-11-29 11:55</div>
            <div class="timeline-body"><p>I just tried using <code>uv</code> for the first time and went through the Getting Started section of the docs and immediately encountered this issue at the <code>uv add ruff</code> step.</p>
<p>In my case it turned out to be a <code>pip</code> problem and not a <code>uv</code> problem, because updating <code>uv</code> or installing new Python versions worked fine. So I took a step back and troubleshooted my system pip setup (on Ubuntu 22.04 in WSL) until that worked. When I tried <code>uv add ruff</code> afterwards, the command completed successfully.</p>
<p>For zscaler guidance specifically, see <a href="https://help.zscaler.com/zia/adding-custom-certificate-application-specific-trust-store">here</a>.</p>
<p>Also have a look at pip docs, specifically the <a href="https://pip.pypa.io/en/latest/topics/https-certificates/">HTTPS Certificates</a> section. Since you're using Python 3.12, if your pip is at v22.2+ you should be able to tell it to use system certificates.</p>
<p>EDIT: Thinking about it a little more - since I don't know how <code>uv</code> operates in the background, it could be that my broken <code>pip</code> was not the cause of <code>uv</code> not working correctly; but whatever caused my <code>pip</code> to break also broke <code>uv</code>.</p>
<p>Hope that helps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-12-01 14:20</div>
            <div class="timeline-body"><p>Thanks @solomchuk so by setting all that global variable did the trick, but it's also true that today I got another upgrade from Apple?</p>
<p>Is there any way at all to export variable when the pyenv is activated as far as you know?
Adding variables at the bottom of the &quot;activate&quot; file for the given environment doesn't seem to work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/solomchuk">@solomchuk</a> on 2024-12-01 18:25</div>
            <div class="timeline-body"><p>@andreamoro I haven't tried playing around with this, but apparently you can use <code>UV_ENV_FILE</code> variable to load environment variables from a file when executing <code>ev run</code>. See <a href="https://docs.astral.sh/uv/configuration/environment/#uv_env_file">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andreamoro">@andreamoro</a> on 2024-12-01 19:06</div>
            <div class="timeline-body"><p>So far I can't get coexisting UV environment with pyenv, so it's not an option for me :(
But thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11595.html">astral-sh/uv#11595</a> on 2025-02-18 12:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amerry">@amerry</a> on 2025-04-03 15:32</div>
            <div class="timeline-body"><p>I get something very similar when attempting to use native TLS to access an internal index:</p>
<pre><code>❯ uv --version
uv 0.6.12 (e4e03833f 2025-04-02)
❯ UV_NATIVE_TLS=&quot;true&quot; uv tool run --with some-internal-package --index &quot;https://artifactory.&lt;internal-network&gt;/artifactory/api/pypi/virtual-pypi/simple&quot; python --version
⠧ Resolving dependencies...
error: Failed to fetch: `https://artifactory.&lt;internal-network&gt;/artifactory/api/pypi/virtual-pypi/simple/some-internal-package/`
  Caused by: Request failed after 3 retries
  Caused by: error sending request for url (https://artifactory.&lt;internal-network&gt;/artifactory/api/pypi/virtual-pypi/simple/some-internal-package/)
  Caused by: client error (Connect)
  Caused by: invalid peer certificate: UnknownIssuer
</code></pre>
<p>I have the above <strong>failure on both Windows and macOS</strong>, where the correct CA certificate is installed into the system certificate stores (curl, for example, can use these system certs fine). It actually <strong>works on Linux</strong>.</p>
<p>I get the same effect whether setting <code>UV_NATIVE_TLS</code> or using <code>--native-tls</code>.</p>
<p>I've tried enabling the extra traces and debug output, but none of it says anything about <em>how</em> certificates are being checked, only that they don't pass validation.</p>
<p>I tried rolling back to some earlier versions of <code>uv</code> from the 0.6 and 0.5 series (based on some of the early comments on this issue), and it didn't help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amerry">@amerry</a> on 2025-04-03 15:42</div>
            <div class="timeline-body"><p>I've found a solution to my specific problem: our setup is that there is a &quot;root CA&quot; and an &quot;issuing CA&quot;. The root CA signs the issuing CA, and the issuing CA signs the actual server certificates.</p>
<p>Both CAs are in the System Keychain, but only the &quot;root CA&quot; is marked as trusted. This seems to be fine for most tools (trusting the root CA is effectively inherited by the entire chain), but not for the libraries that uv uses. If I explicitly trust the issuing CA, it works.</p>
<p>This seems like a bug (in that the behaviour deviates from standard TLS libraries), but presumably in one of the upstream libraries of <code>uv</code> rather than in <code>uv</code> itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-03 16:15</div>
            <div class="timeline-body"><p>@amerry thanks for the details! Perhaps https://github.com/rustls/rustls-native-certs is a good starting place for reporting that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amerry">@amerry</a> on 2025-04-03 17:50</div>
            <div class="timeline-body"><p>Yeah, I'm going to try to see if I can reproduce with the tests from that project, and if so submit a bug there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NMertsch">@NMertsch</a> on 2025-04-07 09:40</div>
            <div class="timeline-body"><p>Hi, I think I have the same issue. Adding our internal PyPI host to <code>allow-insecure-host</code> in <code>uv.toml</code> works for now, but Python's <code>requests</code> library and also all web browsers accept the host certificate, so I think <code>native-tls = true</code> should be enough.</p>
<p>I think this one is related: https://github.com/rustls/rustls-native-certs/issues/131. It is closed because &quot;<code>rustls-platform-verifier</code> is confirmed to work&quot;. I don't know what that means, but maybe it helps someone else here :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amerry">@amerry</a> on 2025-04-08 08:02</div>
            <div class="timeline-body"><p>It sounds like the upstream team are recommending replacing rustls-native-certs with rustls-platform-verifier. There is a ticket for this: seanmonstar/reqwest#2159. That ticket in turn is blocked on https://github.com/rustls/rustls-platform-verifier/issues/58 which is blocked on implementing support for additional root certs on Android.</p>
<p>There's a note on <a href="https://github.com/rustls/rustls-native-certs/issues/131#issuecomment-2335110993">this comment</a> that downstream users of reqwest can use rustls-platform-verifier already. I will attempt to see if that would solve the issue I noted above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @zanieb on 2025-04-08 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-04-08 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @zanieb on 2025-04-08 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @jtfmumm by @zanieb on 2025-04-18 14:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amerry">@amerry</a> on 2025-04-23 13:54</div>
            <div class="timeline-body"><p>I couldn't figure out how to modify <code>uv</code> itself, but I did make a minimal example based on the <code>rustls-native-certs</code> and <code>rustls_platform_verifier</code> example code:</p>
<details><summary>Code</summary>

<pre><code class="language-rust">use clap::Parser;
use rustls;
use rustls_native_certs;
use rustls_platform_verifier;
use std::io::{Read, Write, stdout};
use std::net::TcpStream;
use std::sync::Arc;

#[derive(Parser, Debug)]
#[command(version, about, long_about = None)]
struct Args {
    /// Host to contact
    host: String,

    /// Whether to use rustls-platform-verifier
    #[arg(short, long)]
    verifier: bool,
}

fn main() {
    let args = Args::parse();
    let host = args.host;
    let address = format!(&quot;{host}:443&quot;);

    let config = if args.verifier {
        use rustls_platform_verifier::ConfigVerifierExt;
        rustls::ClientConfig::with_platform_verifier()
    } else {
        let mut roots = rustls::RootCertStore::empty();
        for cert in rustls_native_certs::load_native_certs().expect(&quot;could not load platform certs&quot;)
        {
            roots.add(cert).unwrap();
        }
        rustls::ClientConfig::builder()
            .with_root_certificates(roots)
            .with_no_client_auth()
    };

    let mut conn =
        rustls::ClientConnection::new(Arc::new(config), host.try_into().unwrap()).unwrap();
    let mut sock = TcpStream::connect(address).expect(&quot;cannot connect&quot;);
    let mut tls = rustls::Stream::new(&amp;mut conn, &amp;mut sock);
    tls.write_all(
        concat!(
            &quot;GET / HTTP/1.1\r\n&quot;,
            &quot;Host: google.com\r\n&quot;,
            &quot;Connection: close\r\n&quot;,
            &quot;Accept-Encoding: identity\r\n&quot;,
            &quot;\r\n&quot;
        )
        .as_bytes(),
    )
    .expect(&quot;write failed&quot;);
    let ciphersuite = tls
        .conn
        .negotiated_cipher_suite()
        .expect(&quot;tls handshake failed&quot;);
    writeln!(
        &amp;mut std::io::stderr(),
        &quot;Current ciphersuite: {:?}&quot;,
        ciphersuite.suite()
    )
    .unwrap();
    let mut plaintext = Vec::new();
    tls.read_to_end(&amp;mut plaintext).unwrap();
    stdout().write_all(&amp;plaintext).unwrap();
}
</code></pre>
</details>

<p>With this, I can confirm that accessing an address on the local network (where the root cert is trusted but the intermediate cert has no explicit trust set) doesn't work with <code>rustls-native-certs</code> but <em>does</em> work with <code>rustls_platform_verifier</code>. So for me, at least, the issue should be resolved by switching to <code>rustls_platform_verifier</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/124C41p">@124C41p</a> on 2025-05-24 11:19</div>
            <div class="timeline-body"><p>I have the same issue at work (behind a corporate proxy). Based on the suggestions given here (using <code>rustls_platform_verifier</code>), I was able to patch uv so that it works in my company: https://github.com/124C41p/uv</p>
<p>Please feel free to use this workaround until the issue is fixed properly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @jtfmumm by @konstin on 2025-09-12 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/romaingyh">@romaingyh</a> on 2025-10-06 13:29</div>
            <div class="timeline-body"><p>Hi@124C41p, do you have time to make a PR with your fix?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/124C41p">@124C41p</a> on 2025-10-09 18:48</div>
            <div class="timeline-body"><p>Hi @romaingyh, in principle yes - the patch isn't that big of a deal. But I don't have the impression that the uv team wants to have a workaround in their code fixing an issue of one of their dependencies (please correct me if I am wrong).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/romaingyh">@romaingyh</a> on 2025-10-13 08:38</div>
            <div class="timeline-body"><p>It's an issue in a dependency but this is issue is closed as not planned and considering this answer</p>
<blockquote>
<p>I think this one is related: <a href="https://github.com/rustls/rustls-native-certs/issues/131">rustls/rustls-native-certs#131</a>. It is closed because &quot;<code>rustls-platform-verifier</code> is confirmed to work&quot;</p>
</blockquote>
<p>I think uv is stuck and your fix is the only way</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amerry">@amerry</a> on 2025-10-13 12:51</div>
            <div class="timeline-body"><blockquote>
<p>Hi <a href="https://github.com/romaingyh">@romaingyh</a>, in principle yes - the patch isn't that big of a deal. But I don't have the impression that the uv team wants to have a workaround in their code fixing an issue of one of their dependencies (please correct me if I am wrong).</p>
</blockquote>
<p>I wouldn't describe replacing a deprecated dependency with its official replacement a &quot;workaround&quot; - that sounds like the proper fix to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/124C41p">@124C41p</a> on 2025-10-13 14:54</div>
            <div class="timeline-body"><p>I think <a href="https://github.com/seanmonstar/reqwest/pull/2286">this</a> is the PR the uv team is waiting for to solve this issue. It is open since May 2024, and there doesn't seem to be much progress. I would also like to see an interim solution, and I would be happy to create a PR if the uv team agrees.</p>
<p>@zanieb, @konstin  what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../seanmonstar/reqwest/pulls/2286.html">seanmonstar/reqwest#2286</a> on 2025-10-16 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/djc">@djc</a> on 2025-10-16 21:06</div>
            <div class="timeline-body"><p>It's not that hard to wire up reqwest to use a custom rustls config, which could use rustls-platform-verifier.</p>
<p>Here's how we do it in rustup:</p>
<p>https://github.com/rust-lang/rustup/blob/main/src/download/mod.rs#L623</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michael-o">@michael-o</a> on 2025-11-18 19:40</div>
            <div class="timeline-body"><p>Just hit this on Windows. <code>--native-tls</code> provided, still failing.
Chain:</p>
<pre><code>$ openssl s_client -connect dw-eng-rsc.innomotics.net:443
CONNECTED(00000003)
depth=2 C = DE, ST = Bayern, L = Muenchen, O = Siemens, serialNumber = ZZZZZZA1, OU = Siemens Trust Center, CN = Siemens Root CA V3.0 2016
verify return:1
depth=1 C = DE, ST = Bayern, L = Muenchen, O = Siemens, serialNumber = ZZZZZZE7, CN = Siemens Issuing CA Intranet Server 2022
verify return:1
depth=0 C = DE, O = Siemens, OU = IN HVM DW, CN = dw-eng-rsc.innomotics.net
verify return:1
---
Certificate chain
 0 s:C = DE, O = Siemens, OU = IN HVM DW, CN = dw-eng-rsc.innomotics.net
   i:C = DE, ST = Bayern, L = Muenchen, O = Siemens, serialNumber = ZZZZZZE7, CN = Siemens Issuing CA Intranet Server 2022
---
</code></pre>
<p>Wrote a standalone application with reqwest just like uv uses it along with rustls-native-certs..well rustls-native-certs is pointless on Windows since it does not load intermediate CAs, only root ones, hence the leaf verification fails. Just like it is mentioned in https://github.com/rustls/rustls-native-certs/issues/131. I expected it to be as easy as providing the flag, that's it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michael-o">@michael-o</a> on 2025-11-19 08:24</div>
            <div class="timeline-body"><blockquote>
<p>It's not that hard to wire up reqwest to use a custom rustls config, which could use rustls-platform-verifier.</p>
<p>Here's how we do it in rustup:</p>
<p>https://github.com/rust-lang/rustup/blob/main/src/download/mod.rs#L623</p>
</blockquote>
<p>I have tried to pick this up, this works:</p>
<pre><code class="language-rust">use std::error::Error;

use reqwest::blocking::Client;
use rustls::ClientConfig;
use rustls_platform_verifier::ConfigVerifierExt;

fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    // Create a rustls ClientConfig using the platform-native verifier
    let tls_config = ClientConfig::with_platform_verifier()?;

    // Build a reqwest blocking client using the custom TLS config
    let client = Client::builder()
        .use_preconfigured_tls(tls_config)
        .build()?;

    // Make a request
    let response = client
        .get(&quot;https://dw-eng-rsc.innomotics.net/repos/&quot;)
        .send()?
        .text()?;

    println!(&quot;{response}&quot;);
    Ok(())
}
</code></pre>
<p>while this:</p>
<pre><code class="language-patch">PS C:\Entwicklung\Projekte\uv&gt; git diff -U0 .\Cargo.toml crates/uv-client
diff --git a/Cargo.toml b/Cargo.toml
index c523ecec0..28bed1434 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -153 +153 @@ reqsign = { version = &quot;0.18.0&quot;, features = [&quot;aws&quot;, &quot;default-context&quot;], default-f
-reqwest = { version = &quot;0.12.22&quot;, default-features = false, features = [&quot;json&quot;, &quot;gzip&quot;, &quot;deflate&quot;, &quot;zstd&quot;, &quot;stream&quot;, &quot;system-proxy&quot;, &quot;rustls-tls&quot;, &quot;rustls-tls-native-roots&quot;, &quot;socks&quot;, &quot;multipart&quot;, &quot;http2&quot;, &quot;blocking&quot;] }
+reqwest = { version = &quot;0.12.22&quot;, default-features = false, features = [&quot;json&quot;, &quot;gzip&quot;, &quot;deflate&quot;, &quot;zstd&quot;, &quot;stream&quot;, &quot;system-proxy&quot;, &quot;rustls-tls&quot;, &quot;socks&quot;, &quot;multipart&quot;, &quot;http2&quot;, &quot;blocking&quot;] }
@@ -219,0 +220 @@ rustls = { version = &quot;0.23.29&quot;, default-features = false }
+rustls-platform-verifier = { version = &quot;0.6.2&quot; }
diff --git a/crates/uv-client/Cargo.toml b/crates/uv-client/Cargo.toml
index ffeb09151..75450bf08 100644
--- a/crates/uv-client/Cargo.toml
+++ b/crates/uv-client/Cargo.toml
@@ -59,0 +60,2 @@ rustc-hash = { workspace = true }
+rustls = { workspace = true }
+rustls-platform-verifier = { workspace = true }
@@ -76 +77,0 @@ rcgen = { workspace = true }
-rustls = { workspace = true }
diff --git a/crates/uv-client/src/base_client.rs b/crates/uv-client/src/base_client.rs
index c66c4a038..bed731a82 100644
--- a/crates/uv-client/src/base_client.rs
+++ b/crates/uv-client/src/base_client.rs
@@ -25,0 +26,4 @@ use reqwest_retry::{
+
+use rustls::ClientConfig;
+use rustls_platform_verifier::ConfigVerifierExt;
+
@@ -467 +470,0 @@ impl&lt;'a&gt; BaseClientBuilder&lt;'a&gt; {
-            .tls_built_in_root_certs(self.built_in_root_certs)
@@ -475,0 +479 @@ impl&lt;'a&gt; BaseClientBuilder&lt;'a&gt; {
+        let tls_config = ClientConfig::with_platform_verifier();
@@ -477 +481 @@ impl&lt;'a&gt; BaseClientBuilder&lt;'a&gt; {
-            client_builder.tls_built_in_native_certs(true)
+            client_builder.use_preconfigured_tls(tls_config)
</code></pre>
<p>fails with</p>
<pre><code>C:\Entwicklung\Projekte\kona [freebsd-wheels-index ≡]&gt; &amp;C:\Entwicklung\Projekte\uv\target\debug\uv.exe --native-tls sync

thread 'main2' (21612) panicked at crates\uv-client\src\base_client.rs:509:14:
Failed to build HTTP client.: reqwest::Error { kind: Builder, source: &quot;Unknown TLS backend passed to `use_preconfigured_tls`&quot; }
</code></pre>
<p>Given that my Rust knowledge is non-existing, I am (a bit) clueless here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/124C41p">@124C41p</a> on 2025-12-31 18:24</div>
            <div class="timeline-body"><p>Reqwest v0.13.1 has just been released. It has rustls and rustls-platform-verifier enabled by default. It seems to me that upgrading reqwest will solve this issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:24 UTC
    </footer>
</body>
</html>
