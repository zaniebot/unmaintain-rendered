<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaleido package and sentencepiece dependency installation failed; Outdated flair package being installed - astral-sh/uv #11726</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Kaleido package and sentencepiece dependency installation failed; Outdated flair package being installed</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/11726">#11726</a>
        opened by <a href="https://github.com/hasan-rakibul">@hasan-rakibul</a>
        on 2025-02-23 16:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hasan-rakibul">@hasan-rakibul</a> on 2025-02-23 16:28</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Please note that this is the first issue I have ever created on GitHub, so my apologies if I have missed any norms.</p>
<p>Thanks for the great project. I was trying to install packages listed in <a href="https://github.com/user-attachments/files/18931439/req.txt">req.txt</a>, but it failed for three cases.</p>
<p>I re-tested the installation in an insolated new project to confirm the issues. Just to mention how I proceeded:</p>
<pre><code>mkdir test
uv init
uv add ...
</code></pre>
<h1>Issues</h1>
<ol>
<li>kaleido installation failed with:</li>
</ol>
<blockquote>
<p>error: Distribution <code>kaleido==0.2.1.post1 @ registry+https://pypi.org/simple</code> can't be installed because it doesn't have a source distribution or wheel for the current platform</p>
</blockquote>
<blockquote>
<p>hint: You're on Linux (<code>manylinux_2_31_x86_64</code>), but <code>kaleido</code> (v0.2.1.post1) only has wheels for the following platform: <code>manylinux2014_armv7l</code></p>
</blockquote>
<p>Note that, in the same system, it is smoothly installed by <code>python -m pip install</code> but not through <code>uv add</code> or <code>uv pip install</code>.</p>
<ol start="2">
<li>uv is trying to install sentencepiece but failed.</li>
</ol>
<blockquote>
<p>× Failed to build <code>sentencepiece==0.1.99</code>
├─▶ The build backend returned an error
╰─▶ Call to <code>setuptools.build_meta:__legacy__.build_wheel</code> failed (exit status: 1)
...
help: <code>sentencepiece</code> (v0.1.99) was included because <code>test</code> (v0.1.0) depends on <code>transformers[sentencepiece]</code> (v4.49.0) which depends on <code>sentencepiece</code></p>
</blockquote>
<ol start="3">
<li>The above issue is resolved if I install sentencepiece manually (<code>uv add sentencepiece</code> which indeed installs the latest 2.0 release) before trying to <code>uv add -r req.txt</code>.</li>
</ol>
<p>Still there's another issue even though all package seems to be installed. It installed <code>flair 0.6.1.post1</code> (which is a dependency of <code>textattack</code>) although the latest version in in pypi is 0.15.1. Basic <code>python -m pip install -r req.txt</code> indeed install the latest version but uv didn't, and subsequently <code>from textattack.augmentation import BackTranslationAugmenter, CLAREAugmenter, EmbeddingAugmenter</code> threw error due to outdated code in <code>flair</code>.</p>
<p><a href="https://github.com/user-attachments/files/18931714/pyproject.toml.txt">pyproject.toml.txt</a>
<a href="https://github.com/user-attachments/files/18931713/uv.lock.txt">uv.lock.txt</a></p>
<h3>Platform</h3>
<p>Linux 5.14.21-150500.55.73_13.0.60-cray_shasta_c x86_64 GNU/Linux (SUSE Linux Enterprise Server 15 SP5)</p>
<h3>Version</h3>
<p>0.6.2</p>
<h3>Python version</h3>
<p>3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @hasan-rakibul on 2025-02-23 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-24 15:15</div>
            <div class="timeline-body"><p>The first problem you're hitting is an oddity with kaleido, with more details #10464. You can try <code>kaleido==0.2.0</code>, that should install (it works with pip because only looks at the current platform, but uv looks at all platforms and then it gets into an edge case with the post release).</p>
<blockquote>
<p>The above issue is resolved if I install sentencepiece manually (uv add sentencepiece which indeed installs the latest 2.0 release) before trying to uv add -r req.txt.</p>
</blockquote>
<p><code>sentencepiece==0.1.99</code> has packages up to Python 3.11 (https://pypi.org/project/sentencepiece/0.1.99/#files), so it doesn't work with Python 3.12. Have you confirmed that uv and pip are using the same Python version and that uv uses that Python version as <code>requires-python</code> lower bound, too?</p>
<p>If you change your requirements to <code>sentencepiece&gt;=0.2</code>, you can force the resolver to not consider older version, which should avoid that build error.</p>
<blockquote>
<p>Still there's another issue even though all package seems to be installed. It installed flair 0.6.1.post1 (which is a dependency of textattack) although the latest version in in pypi is 0.15.1. Basic python -m pip install -r req.txt indeed install the latest version but uv didn't, and subsequently from textattack.augmentation import BackTranslationAugmenter, CLAREAugmenter, EmbeddingAugmenter threw error due to outdated code in flair.</p>
</blockquote>
<p>There is likely some conflict between two recent versions. You can manually specify <code>flair&gt;=0.15.1</code> and see if that helps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-02-24 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-02-24 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hasan-rakibul">@hasan-rakibul</a> on 2025-02-26 00:32</div>
            <div class="timeline-body"><p>Thanks for your reply @konstin. I would be happy to specify version for <code>kaleido</code>, but I'm a bit reluctant to specify version for <code>sentencepiece</code> and <code>flair</code> as these are not the primary packages I was installing (these are just some dependencies of my original required packages).</p>
<p>My point is, I feel it suboptimal to specify version of dependencies – even if it solves issues with these two packages for the time being, what if uv is again not installing the latest available for any other arbitrary dependencies (just like it did for flair and sentencepiece). So, overall, I feel this issue is at least a <strong>feature request</strong> (if not bug) that uv should install latest version of dependencies.</p>
<p>To answer your question about whether uv and pip are using the same Python version, I think yes. I was using pip on the same venv that uv created. To clarify:</p>
<pre><code>uv venv # created venv in the current dir
source .venv/.... # activate
python -m ensurepip # pip was not there, so installed it
python -m pip install # tried installing with pip to verify that pip picks up latest dependencies
</code></pre>
<p>Note that earlier I was doing the recommended <code>uv add</code> or <code>uv pip install</code>. The above way of trying directly <code>python -m pip...</code> was part of the troubleshooting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-26 00:49</div>
            <div class="timeline-body"><blockquote>
<p>So, overall, I feel this issue is at least a feature request (if not bug) that uv should install latest version of dependencies.</p>
</blockquote>
<p>We do prefer the latest version of dependencies, but that does not mean we will or can always select them. See https://docs.astral.sh/uv/concepts/resolution/#basic-examples for an example of multiple valid resolutions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sglbl">@sglbl</a> on 2025-05-13 15:22</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>So, overall, I feel this issue is at least a feature request (if not bug) that uv should install latest version of dependencies.</p>
</blockquote>
<p>We do prefer the latest version of dependencies, but that does not mean we will or can always select them. See https://docs.astral.sh/uv/concepts/resolution/#basic-examples for an example of multiple valid resolutions.</p>
</blockquote>
<p>I think this is not just a feature-request, it's a bug. With this message how could I even now that non-post version works totally fine.</p>
<p><img src="https://github.com/user-attachments/assets/9141b49d-6ab7-40a4-83bc-9a75f056dedf" alt="Image" /></p>
<p>I looked at <code>kaleido</code> versions using: <code>uvx pip index versions kaleido</code> and I saw that <code>v0.2.1.post1</code> is not even on pip available version list but uv only took this version into consideration and gave an error. To get rid of a lot of techincal details I think uv should automatically check previous compatible versions .</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
