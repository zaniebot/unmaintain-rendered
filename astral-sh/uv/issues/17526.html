<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respect `Content-Disposition` for direct URL installations? - astral-sh/uv #17526</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Respect <code>Content-Disposition</code> for direct URL installations?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17526">#17526</a>
        opened by <a href="https://github.com/woodruffw">@woodruffw</a>
        on 2026-01-16 16:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/woodruffw">@woodruffw</a></div>
            <div class="timeline-body"><p>This is a breakout from #17426, since we need to obtain clarity/consensus on an approach here.</p>
<p>TL;DR: URLs don't necessarily have a clear filename suffix. When this happens, uv doesn't have a filename to use for the URL's content, which could be either a sdist or a wheel. Consequently, the URL is rejected.</p>
<p>One thing we could do (for a subset of scenarios) is to honor the <code>Content-Disposition</code> header, which <em>can</em> include a <code>filename</code> field.</p>
<p>pip appears to do this, and gives it precedence over any inferred filename:</p>
<p>https://github.com/pypa/pip/blob/545eda389c41478e2f99d23212254d757d8c2cef/src/pip/_internal/network/download.py#L105-L117</p>
<p>Some things we need clarity on (these may already have answers, I just haven't collected the information together):</p>
<ol>
<li>How does this interact with other PEP 508 (and non-standard) distribution name/filename specification mechanisms for URLs?</li>
<li>There are other <code>Content-Distribution</code> mechanisms for specifying filenames, e.g. <code>filename*</code>. We should see if pip handles these, if they do the precedence between them correctly, etc.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @woodruffw on 2026-01-16 16:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2026-01-16 17:53</div>
            <div class="timeline-body"><p>FYI, I'm following this discussion, if you think this puts pip out of standards compliance I will take a look. Although this is hairy enough I'm not likely going to change the behavior beyond logging a warning when content disposition does not match with the actual filename.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2026-01-16 18:22</div>
            <div class="timeline-body"><blockquote>
<p>if you think this puts pip out of standards compliance I will take a look. Although this is hairy enough I'm not likely going to change the behavior beyond logging a warning when content disposition does not match with the actual filename.</p>
</blockquote>
<p>I tried digging into this and found it pretty complicated/confusing ðŸ˜…. Here's my attempt to tie it together:</p>
<p>From the living copy of PEP 440:</p>
<blockquote>
<p>Direct references
Some automated tools may permit the use of a direct reference as an alternative to a normal version specifier. A direct reference consists of the specifier @ and an explicit URL.</p>
<p>Whether or not direct references are appropriate depends on the specific use case for the version specifier. Automated tools SHOULD at least issue warnings and MAY reject them entirely when direct references are used inappropriately.</p>
<p>Public index servers SHOULD NOT allow the use of direct references in uploaded distributions. Direct references are intended as a tool for software integrators rather than publishers.</p>
<p>Depending on the use case, some appropriate targets for a direct URL reference may be an sdist or a wheel binary archive. The exact URLs and targets supported will be tool dependent.</p>
</blockquote>
<p>Ref: https://packaging.python.org/en/latest/specifications/version-specifiers/#direct-references</p>
<p>From the living copy of PEP 508:</p>
<blockquote>
<p>A minimal URL based lookup:</p>
<p><code>pip @ https://github.com/pypa/pip/archive/1.3.1.zip#sha1=da9234ee9982d4bbb3c72346a6de940a148ea686</code></p>
</blockquote>
<p>Ref: https://packaging.python.org/en/latest/specifications/dependency-specifiers/#specification</p>
<p>And from PEP 625:</p>
<blockquote>
<p>The file name of a sdist was standardised in <a href="https://peps.python.org/pep-0625/">PEP 625</a>. The file name must be in the form {name}-{version}.tar.gz, where {name} is normalised according to the same rules as for binary distributions (see <a href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#binary-distribution-format">Binary distribution format</a>), and {version} is the canonicalized form of the project version (see <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#version-specifiers">Version specifiers</a>).</p>
</blockquote>
<p>Ref: https://packaging.python.org/en/latest/specifications/source-distribution-format/#source-distribution-file-name</p>
<p>So, to summarize:</p>
<ul>
<li>Direct references are <code>specifier @ url</code>. Typical targets (i.e. the content behind the URL) are sdists and wheels, but PEP 440 explicitly carves out URLs and targets as tool-specific.</li>
<li>PEP 508 gives an example of a URL-based lookup that <em>isn't</em> a source distribution, since it doesn't use the PEP 625 sdist filename format. This would fall under what both uv and pip would call &quot;source archive&quot; support, which is tool-specific behavior. In practice, that generally means (to my understanding) that both pip and uv try to use the target as a source tree or similar.</li>
<li>PEP 625 says that sdists are always of the form <code>{name}-{version}.tar.gz</code>, so I <em>think</em> a target URL that has <code>https://example/.../{name}-{version}.tar.gz</code> would be correctly treated as a source distribution (and validated as such) rather than a &quot;source archive&quot;. Similarly, I think it's correct to treat <code>filename</code> in <code>Content-Disposition</code> as providing the filename for this validation purpose.</li>
</ul>
<p>TL;DR: I'm pretty sure pip is compliant here, at least insofar as the specs are (1) not super prescriptive, and (2) leave a lot of this open to tool-specific behavior anyways. uv is <em>also</em> compliant w/r/t the specs, but <em>could</em> be more compatible with pip by doing the same <code>Content-Disposition</code> handling.</p>
<p>(I feel medium-low confidence on the analysis above; I'd appreciate someone pointing out places I've gotten it wrong!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2026-01-16 18:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-16 19:05:46 UTC
    </footer>
</body>
</html>
