<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv python install` gives `error: Could not acquire lock for '.local/share/uv/python' at '.local/share/uv/python/.lock': Function not implemented (os error 38)` - astral-sh/uv #9050</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv python install</code> gives <code>error: Could not acquire lock for &#x27;.local/share/uv/python&#x27; at &#x27;.local/share/uv/python/.lock&#x27;: Function not implemented (os error 38)</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9050">#9050</a>
        opened by <a href="https://github.com/maximilianigl">@maximilianigl</a>
        on 2024-11-12 09:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/maximilianigl">@maximilianigl</a></div>
            <div class="timeline-body">

<p>When running <code>uv python install</code>, I get the error</p>
<pre><code>error: Could not acquire lock for `.local/share/uv/python` at `.local/share/uv/python/.lock`: Function not implemented (os error 38)
</code></pre>
<p>It&#x27;s on a linux cluster node (running Slurm), so the home directory is shared across nodes.
<code>uv</code> version is 0.5.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-12 13:49</div>
            <div class="timeline-body"><p>Does your system not support <a href="https://linux.die.net/man/2/flock"><code>flock</code></a>? We need to be able to take locks to prevent concurrent access to state.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maximilianigl">@maximilianigl</a> on 2024-11-12 14:14</div>
            <div class="timeline-body"><p>Thanks for the prompt response!
I didn&#x27;t realize it was related to <code>flock</code>. They recently (temporarily?) disabled it.
I&#x27;ll close the issue as this is a problem on our system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/maximilianigl">@maximilianigl</a> on 2024-11-12 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-12 14:20</div>
            <div class="timeline-body"><p>Yeah the &quot;Function not implemented&quot; is the error from the OS when flock is invoked.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gashon">@gashon</a> on 2025-01-07 21:47</div>
            <div class="timeline-body"><p>I was able to move .lock location w <code>export UV_PYTHON_INSTALL_DIR=/tmp/uv_python_install</code> (can just move to fs that supports flock)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mil-ad">@mil-ad</a> on 2025-02-12 15:21</div>
            <div class="timeline-body"><p>@zanieb does this mean that it&#x27;s safe to call <code>uv sync</code> concurrently from multiple processes if the filesystem supports flock?</p>
<p>And apologies for commenting on a closed thread.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-12 15:22</div>
            <div class="timeline-body"><p>Yes we lock environments for safe concurrency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mil-ad">@mil-ad</a> on 2025-02-12 15:26</div>
            <div class="timeline-body"><p>Amazing! I think flock doesn&#x27;t work on NFS but <a href="https://man7.org/linux/man-pages/man2/fcntl.2.html">fcntl</a> does, at least for more recent versions of NFS and linux kernel</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-12 15:42</div>
            <div class="timeline-body"><p>I think we only use <code>flock</code> right now. Maybe worth opening a new issue tracking a different locking mechanism?</p>
<p>For reference</p>
<p>https://github.com/astral-sh/uv/blob/711766e79c11602ce39506693d17ddeefa4bfe85/crates/uv-fs/src/lib.rs#L564</p>
<p>https://tikv.github.io/doc/fs2/trait.FileExt.html#tymethod.try_lock_exclusive</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:35:26 UTC
    </footer>
</body>
</html>
