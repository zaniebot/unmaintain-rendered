<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem with `opencv-python-headless` installed via uv but not via pip - astral-sh/uv #11806</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Problem with <code>opencv-python-headless</code> installed via uv but not via pip</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11806">#11806</a>
        opened by <a href="https://github.com/Yc-Chen">@Yc-Chen</a>
        on 2025-02-26 17:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Yc-Chen">@Yc-Chen</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I created a reproduction repository here: https://github.com/Yc-Chen/uv-opencv-error</p>
<p>The details of reproduction steps are written in the README.</p>
<p>In short, inside a docker image, when the package <code>opencv-python-headless</code> is installed by uv, the <code>import cv2</code> gives out an error; but if this package is installed by pip, it works.</p>
<p>Maybe a related issue: https://github.com/astral-sh/uv/issues/10708</p>
<h3>Platform</h3>
<p>macOS 13, Intel</p>
<h3>Version</h3>
<p>uv 0.5.31 (e38ac4900 2025-02-12)</p>
<h3>Python version</h3>
<p>Python 3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Yc-Chen on 2025-02-26 17:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Problem with opencv-python-headless installed via uv but not via pip" to "Problem with `opencv-python-headless` installed via uv but not via pip" by @Yc-Chen on 2025-02-26 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-01 01:59</div>
            <div class="timeline-body"><p>I think the problem is:</p>
<pre><code class="language-diff">diff --git a/mypackage/pyproject.toml b/mypackage/pyproject.toml
index 599974c..81185a6 100644
--- a/mypackage/pyproject.toml
+++ b/mypackage/pyproject.toml
@@ -4,7 +4,7 @@ version = &quot;0.1.0&quot;
 description = &quot;Add your description here&quot;
 requires-python = &quot;&gt;=3.11&quot;
 dependencies = [
-    &quot;opencv-python&gt;=4.11.0.86&quot;,
+    &quot;opencv-python-headless&gt;=4.11.0.86&quot;,
 ]
</code></pre>
<p>You have a dependency on <code>opencv-python</code> in the child package. So we're installing <code>opencv-python</code>, and <em>that</em> version of the package requires system dependencies. You should use the headless version everywhere, I think? If I apply that change, I can <code>import cv2</code> in the container.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-03-01 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2025-03-01 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-03-01 02:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Yc-Chen">@Yc-Chen</a> on 2025-03-01 15:31</div>
            <div class="timeline-body"><p>Ah, I initially suspected the child package may have caused dependency conflict so I included it. But now I just removed <code>mypackage</code> <a href="https://github.com/Yc-Chen/uv-opencv-error/commit/ddbe361af4df0b282fe2b4b765c4422f668befb9">there</a> and you will see the same error: <code>import cv2</code> fails with default container, but not with <code>pip.Dockerfile</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-01 18:40</div>
            <div class="timeline-body"><p>You need to re-run uv lock, right? You didnâ€™t update the lockfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Yc-Chen">@Yc-Chen</a> on 2025-03-01 22:08</div>
            <div class="timeline-body"><p>oh, you are right...although I still don't get it. Why is it like this? I tried out more combinations and they are:</p>
<p>| tag | root package includes       |  <code>mypackage</code> includes                  |  Dockerfile  | pip.Dockerfile |
|---|-------------------|-------------------------------------------|-------------------------------------------------------|-----|
| v2-no-error | <code>opencv-python-headless</code>    | -   | No error                       | No error |
| v1 | <code>opencv-python-headless</code>, <code>mypackage</code>  | <code>opencv-python</code>       | ImportError: libGL.so.1: cannot open shared object file | No error |
| v3 | <code>mypackage</code> | <code>opencv-python</code> |  ImportError: libGL.so.1: cannot open shared object file | No error |
| v7  | <code>mypackage</code>, <code>opencv-python</code> | <code>opencv-python</code> | ImportError: libGL.so.1: cannot open shared object file  | No error |
| v4-no-error | <code>mypackage</code> | <code>opencv-python-headless</code> | No error | No error |
| v5 | <code>opencv-python</code>, <code>mypackage</code> | <code>opencv-python-headless</code> | No error | No error |
| v6  | <code>mypackage</code>, <code>opencv-python-headless</code> | <code>opencv-python-headless</code> | No error | No error |</p>
<p>I even explored the case where you have 2 child packages where one contains <code>opencv-python</code> and the other one contains <code>opencv-python-headless</code>. But result is similar.</p>
<p>My conclusion is, whenever a child package includes <code>opencv-python</code>, the best thing to do is to avoid installing <code>opencv-python</code> and force install <code>opencv-python-headless</code>. In dockerfile:</p>
<pre><code class="language-diff">RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
---    uv sync --frozen --no-install-project --no-dev
+++    uv sync --frozen --no-install-project --no-dev --no-install-package opencv-python

...
RUN --mount=type=cache,target=/root/.cache/uv \
---    uv sync --frozen --no-dev
+++    uv sync --frozen --no-dev --no-install-package opencv-python &amp;&amp; \
+++    uv pip install opencv-python-headless

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-02 00:48</div>
            <div class="timeline-body"><p>I don't know why pip works in some of those cases but you definitely don't want to mix them. If you install both packages, I'd consider it &quot;random&quot; whether the import works or not. It would just depend on install order.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-03-02 00:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:08 UTC
    </footer>
</body>
</html>
