<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replace transitive dependencies? `opencv-python` -&gt; `opencv-python-headless` - astral-sh/uv #14220</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Replace transitive dependencies? `opencv-python` -&gt; `opencv-python-headless`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/14220">#14220</a>
        opened by <a href="https://github.com/afaulconbridge">@afaulconbridge</a>
        on 2025-06-23 16:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/afaulconbridge">@afaulconbridge</a> on 2025-06-23 16:21</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I couldn't see this scenario in the docs, nor in existing issues, but I think I can't be the only one whod have it.</p>
<p>As you may know, popular computer vision library OpenCV has two python packages <code>opencv-python</code> and <code>opencv-python-headless</code>. The <code>opencv-python</code> requires various graphical dependencies, so on many devices it won't work; for such cases the <code>-headless</code> exists. If <em>both</em> are installed together, bad stuff happens.</p>
<p>Many packages are built on top of OpenCV - I'm trying to use both <a href="https://github.com/ultralytics/ultralytics">Ultraltyics </a> and <a href="https://github.com/roboflow/supervision">Supervsion </a> for image processing for instance. These packages list the <code>opencv-python</code> package as a dependency, and as a consequence won't work on headless machines that need the <code>opencv-python-headless</code> package.</p>
<p>Can UV be configured to always replace <code>opencv-python</code> to  <code>opencv-python-headless</code> when calculating dependencies, no matter how deep? Note that this is about changing the package itself, not the versions used.</p>
<p>(the root cause is probably OpenCV's packaging decisions, but its large and legacy and can't really be changed at this point)</p>
<h3>Platform</h3>
<p>all</p>
<h3>Version</h3>
<p>0.7.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @afaulconbridge on 2025-06-23 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-23 16:40</div>
            <div class="timeline-body"><p>While we're not yet supporting proper dependency exclusions (https://github.com/astral-sh/uv/issues/12616), you hack this in by using an override with an impossible platform marker, then add <code>opencv-python-headless</code> as a regular dependency:</p>
<pre><code class="language-toml">[tool.uv]
override-dependencies = [
  &quot;opencv-python; python_version &lt; '0'&quot;
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @konstin on 2025-06-23 16:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/afaulconbridge">@afaulconbridge</a> on 2025-06-23 21:21</div>
            <div class="timeline-body"><p>Many thanks for answering. I can confirm this solution works, though it feels strange to have an unfullfillable dependency that doesn't cause any errors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-24 10:40</div>
            <div class="timeline-body"><p>It's a little more silly than that: You can regularly have dependency that can't match due to their Python version, e.g. if a dependency says <code>importlib-metadata; python_version &lt; '3.9'</code> but you have <code>requires-python = &quot;python_version &gt; '3.11'&quot;</code>. These just get filter out and ignored. For overrides, the twist is that we replace all dependencies on the package with the override, no matter their marker. So the only dependency on the package that remains is one that gets filtered out. But of course it's true, this is a hack and proper exclude support is better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/afaulconbridge">@afaulconbridge</a> on 2025-06-24 13:32</div>
            <div class="timeline-body"><p>Oh yes, I get it now. Typically that <code>python_version</code> specifier is used on backported functionallity isn't it? So the platform marker could be read like &quot;only use this dependency if <code>python &lt; 3..9</code>, otherwise ignore&quot;. That's actually pretty close to one way the underlying problem can be expressed - &quot;only use this dependency if there is (not) GUI support&quot;. So it's not as hacky as it looked at first glance!</p>
<p>I think this addresses the original question, so this issues can be closed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-06-24 13:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ultralytics/ultralytics/issues/20385.html">ultralytics/ultralytics#20385</a> on 2025-06-25 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../roboflow/supervision/issues/1861.html">roboflow/supervision#1861</a> on 2025-07-02 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Satge96">@Satge96</a> on 2025-09-09 09:16</div>
            <div class="timeline-body"><p>We use the following:
[tool.uv]override-dependencies = [&quot;opencv-python; sys_platform == 'never'&quot;]
or when not wanting the headless:
[tool.uv]override-dependencies = [&quot;opencv-python-headless; sys_platform == 'never'&quot;]
Are there any opinions on if this is better or worse than the trick with the Python version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-10-31 14:18</div>
            <div class="timeline-body"><p>Heads up, we just added support for excluding dependencies entirely by name: https://github.com/astral-sh/uv/pull/16528 (available in the next release)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:04 UTC
    </footer>
</body>
</html>
