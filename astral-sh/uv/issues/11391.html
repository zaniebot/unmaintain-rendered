<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index URL cannot be queried for lack of authentication ending with package name - astral-sh/uv #11391</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Index URL cannot be queried for lack of authentication ending with package name</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11391">#11391</a>
        opened by <a href="https://github.com/jzazo">@jzazo</a>
        on 2025-02-10 17:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jzazo">@jzazo</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi. We cannot get to install packages with uv in production environments when <code>VSS_NUGET_EXTERNAL_FEED_ENDPOINTS</code> env variable is set. UV fails to get authentication credentials because it queries a URL ending with the package name.</p>
<p>I thought <a href="https://github.com/astral-sh/uv/pull/11074">#11074</a> would fix the problem. Probably related with <a href="https://github.com/astral-sh/uv/issues/4583">#4583</a>.</p>
<p>Failing logs:</p>
<pre><code>[Verbose] [CredentialProvider]Running in stand-alone mode
[Verbose] [CredentialProvider]Command-line v1.2.3: /home/javier/.local/share/uv/tools/keyring/lib/python3.13/site-packages/artifacts_keyring/plugins/plugins/netcore/CredentialProvider.Microsoft/CredentialProvider.Microsoft.dll -Uri https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/ -IsRetry False -NonInteractive False -CanShowDialog False -OutputFormat Json -Verbosity Verbose
[Verbose] [CredentialProvider]Handling auth request, Uri: https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/, IsRetry: False, IsNonInteractive: False, CanShowDialog: False
[Verbose] [CredentialProvider]URI: https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]Using NuGetCredentialProvider.CredentialProviders.VstsBuildTaskServiceEndpoint.VstsBuildTaskServiceEndpointCredentialProvider to try to get credentials for https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/.
[Verbose] [CredentialProvider]VstsBuildTaskServiceEndpointCredentialProvider - IsRetry: False
[Verbose] [CredentialProvider]Parsing json
[Verbose] [CredentialProvider]VstsBuildTaskServiceEndpointCredentialProvider - Environment variable VSS_NUGET_EXTERNAL_FEED_ENDPOINTS did not have credentials for endpoint https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]Failed to authenticate to https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/ from your project collection
[Verbose] [CredentialProvider]VstsBuildTaskCredentialProvider - This credential provider must be run under the Team Build tasks for NuGet. Appropriate environment variables must be set.
[Verbose] [CredentialProvider]Skipping NuGetCredentialProvider.CredentialProviders.VstsBuildTask.VstsBuildTaskCredentialProvider, cannot provide credentials for https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]VstsCredentialProvider - This credential provider must not run if any build task environment variables are set. Variables: VSS_NUGET_URI_PREFIXES, VSS_NUGET_ACCESSTOKEN, VSS_NUGET_EXTERNAL_FEED_ENDPOINTS, ARTIFACTS_CREDENTIALPROVIDER_FEED_ENDPOINTS
[Verbose] [CredentialProvider]Skipping NuGetCredentialProvider.CredentialProviders.Vsts.VstsCredentialProvider, cannot provide credentials for https://&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/poetry-core/
[Verbose] [CredentialProvider]Unable to acquire credentials.
</code></pre>
<p>Index configuration in <code>pyproject.toml</code>:</p>
<pre><code>[[tool.uv.index]]
url = &quot;https://VssSessionToken@&lt;...&gt;/_packaging/&lt;...&gt;/pypi/simple/&quot;
name = &quot;mi&quot;
default = true
</code></pre>
<p>Tried ending in <code>/</code> and without it in URL, but fails in both cases. Tagging @zanieb to continue discussion from previous thread. Thank you.</p>
<h3>Platform</h3>
<p>Ubuntu 22.04</p>
<h3>Version</h3>
<p>0.5.29</p>
<h3>Python version</h3>
<p>3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @jzazo on 2025-02-10 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-10 17:07</div>
            <div class="timeline-body"><p>This looks the same as https://github.com/astral-sh/uv/issues/11236</p>
<p>I continue to advocate for a change to the keyring backend, e.g., in https://github.com/microsoft/artifacts-credprovider, to support child URLs.</p>
<p>We can try to do something here but I'm not sure what yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">registry</span> added by @zanieb on 2025-02-10 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-20 22:13</div>
            <div class="timeline-body"><p>This is also the same as #4056</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @jtfmumm by @jtfmumm on 2025-04-11 08:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-29 21:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:49 UTC
    </footer>
</body>
</html>
