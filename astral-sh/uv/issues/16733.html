<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Issue with private registry username - astral-sh/uv #16733</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Issue with private registry username</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16733">#16733</a>
        opened by <a href="https://github.com/MarthinusBosman">@MarthinusBosman</a>
        on 2025-11-14 06:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MarthinusBosman">@MarthinusBosman</a> on 2025-11-14 06:20</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm trying to set up a repo that uses an Azure Artifacts Feed private registry.</p>
<p>The current documentation gives a good example of how to do this securely for both interactive user environment, and in my case, an Azure DevOps Pipeline.</p>
<p>For users, run <code>uv tool install keyring --with artifacts-keyring</code> and set the following in pyproject.toml:</p>
<pre><code class="language-toml">[tool.uv]
keyring-provider = &quot;subprocess&quot;

[[tool.uv.index]]
name = &quot;private-registry&quot;
url = &quot;https://VssSessionToken@pkgs.dev.azure.com/&lt;ORGANIZATION&gt;/&lt;PROJECT&gt;/_packaging/&lt;FEED&gt;/pypi/simple/&quot;
</code></pre>
<p>This avoids having to try and set any permanent environment variables.</p>
<h2>The problem:</h2>
<p>For Azure DevOps, setting <code>UV_INDEX_PRIVATE_REGISTRY_USERNAME=whatever</code>, <code>UV_INDEX_PRIVATE_REGISTRY_PASSWORD=$(System.AccessToken)</code>, and <code>UV_KEYRING_PROVIDER=disabled</code> should work, but it only works if <code>VssSessionToken@</code> is removed from the index-url in pyproject.toml.</p>
<h2>Proposed Solution</h2>
<p>It would be great if  <code>UV_INDEX_PRIVATE_REGISTRY_USERNAME</code> would override any username set in the url, as that would allow me to not have to try and set the correct env variable in user environments each time.</p>
<p>Or maybe I'm overlooking something that allows me to do the same?</p>
<h3>Version</h3>
<p>0.9.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarthinusBosman">@MarthinusBosman</a> on 2025-11-15 17:47</div>
            <div class="timeline-body"><p>Ok, created what I believe to be a valid PR for this #16748</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2025-11-17 18:34</div>
            <div class="timeline-body"><p>Hi @MarthinusBosman, thanks for filing an issue.</p>
<blockquote>
<p>For Azure DevOps, setting <code>UV_INDEX_PRIVATE_REGISTRY_USERNAME=whatever</code>, <code>UV_INDEX_PRIVATE_REGISTRY_PASSWORD=$(System.AccessToken)</code>, and <code>UV_KEYRING_PROVIDER=disabled</code> should work, but it only works if <code>VssSessionToken@</code> is removed from the index-url in pyproject.toml.</p>
</blockquote>
<p>Curious: why are you setting <code>VssSessionToken</code> as the username, if you want the keyring/user environment to subsequently override it? Is there a reason why you need that to be present, instead of uniformly omitting it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarthinusBosman">@MarthinusBosman</a> on 2025-11-17 18:45</div>
            <div class="timeline-body"><p>@woodruffw I'm setting it for development environment, aka when users/devs are developing in the repo. In that case I want to use the keyring, and it's difficult (and messy) to enforce an env variable across all possible dev machine types &amp; IDEs. So in this case it doesn't get overridden.</p>
<p>Then in the CICD pipeline (aka Azure DevOps Pipelines), I don't want to use VssSessionToken, and it's quite easy to enforce consistent env variables.</p>
<p>In general I'd also just say this is the usual behaviour I expect, that env variables should override anything specified in pyproject.toml when present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/my1e5">@my1e5</a> on 2025-12-02 09:31</div>
            <div class="timeline-body"><p>I seem to recall that this might have used to work? For example, this blog post from earlier this year (https://blog.nathanv.me/posts/azure-artifacts-uv/) says you can set up your pyproject.toml with <code>VssSessionToken</code> and <code>keyring-provider = &quot;subprocess&quot;</code> and then in CI/CD the appropriately named environment variables will override them.</p>
<p>My use case is the same, it's very complicated to enforce env variables across all dev machines. Using <code>VssSessionToken</code> and <code>keyring-provider = &quot;subprocess&quot;</code> means everything 'just works' locally for my devs. And the only time we need a token is in CI/CD, so that can be set up as a separate environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/my1e5">@my1e5</a> on 2025-12-03 09:31</div>
            <div class="timeline-body"><p>@MarthinusBosman - I just tried this again on my company Azure Artifacts registry and it seems to work as expected. I hardcode <code>VssSessionToken@</code> and <code>keyring-provider = &quot;subprocess&quot;</code> in my pyproject.toml and then in my GitHub Actions workflow I set</p>
<pre><code>    env:
      UV_INDEX_FOO_USERNAME: none
      UV_INDEX_FOO_PASSWORD: ${{ secrets.AZURE_ARTIFACTS_TOKEN }}
      UV_KEYRING_PROVIDER: disabled
</code></pre>
<p>and it overrides the pyproject.toml configuration.</p>
<p>Also, I came across this comment from a previous issue where someone else got a similar setup to work - https://github.com/astral-sh/uv/issues/3542#issuecomment-2227222162</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:17:57 UTC
    </footer>
</body>
</html>
