<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace package resolution improvement - astral-sh/uv #17156</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Workspace package resolution improvement</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17156">#17156</a>
        opened by <a href="https://github.com/DiDeoxy">@DiDeoxy</a>
        on 2025-12-17 00:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/DiDeoxy">@DiDeoxy</a> on 2025-12-17 00:31</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hello, I am running into an issue when I have a workspace where some uv sources are in git submodules that are themselves workspaces. I know that you cant have workspaces of workspace and that is fine. What I do instead is the top-level workspace points directly to the members of the submodule workspaces that I want, and for the most part this works fine, for example:</p>
<pre><code>root_ws/
├── root_pyproject.toml
├── external/
│   └── package_d/
├── packages/
│   └── package_a/
└── external_ws/
    └── submodule_1/  (git submodule)
        ├── submodule_1_pyproject.toml
        └── packages/
            ├── package_b/
            └── package_c/
</code></pre>
<p>In root_pyproject.toml:</p>
<pre><code class="language-toml">[tool.uv.workspace]
members = [&quot;packages/*&quot;, &quot;external/*&quot;, &quot;external_ws/submodule_1/packages/*&quot;]

[tool.uv.sources]
package_a = { workspace = true }
package_b = { workspace = true }
package_c = { workspace = true }
package_d = { workspace = true }
</code></pre>
<p>This above works and I am able to sync <code>root_pyproject.toml</code> and have all packages available.</p>
<p>However, an issue arrises when I have <code>package_d</code> in multiple submodules (where <code>package_d</code> is a itself a submodule containing a Python package):</p>
<pre><code>root_ws/
├── root_pyproject.toml
├── external/
│   └── package_d/
├── packages/
│   └── package_a/
└── external_ws/
    └── submodule_1/  (git submodule)
        ├── submodule_1_pyproject.toml
        ├── external/
        │   └── package_d/
        └── packages/
            ├── package_b/
            └── package_c/
</code></pre>
<pre><code class="language-toml">[tool.uv.workspace]
members = [&quot;packages/*&quot;, &quot;external/*&quot;, &quot;external_ws/submodule_1/packages/*&quot;]

[tool.uv.sources]
package_a = { workspace = true }
package_b = { workspace = true }
package_c = { workspace = true }
package_d = { workspace = true }
</code></pre>
<p>I do not include the <code>external_ws/submodule_1/external</code> directory as a member, only the packages directory so <code>package_d</code> is included once in the root workspace. However when I try to sync I get a dependency resolution error like below:</p>
<pre><code>uv sync
  × Failed to resolve dependencies for `httpx-custom` (v0.6.1.post1.dev9)
  ╰─▶ Requirements contain conflicting URLs for package `configgi` in split `python_full_version &gt;= '3.12'`:
      - file:///Users/me/root_ws/packages/pacakge_a (editable)
      - file:///Users/me/root_ws/external_ws/submodule_1/external/package_d (editable)
</code></pre>
<p>This is because for some reason uv is reading <code>external_ws/submodule_1/submodule_1_pyproject.toml</code> and including its settings in the resolition. The only solution I have found is to delete the <code>submodule_1_pyproject.toml</code> file after cloning the submodule, but before running <code>uv sync</code>, which is not ideal.</p>
<p>It would be great if I uv ignored non-root non-package pyproject.toml files when resolving dependencies in a workspace.</p>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @DiDeoxy on 2025-12-17 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 09:52</div>
            <div class="timeline-body"><p>What's the <code>tool.uv.sources</code> configuration in <code>external_ws/submodule_1/packages/</code>? We could have an option that ignores sources for a specific path dependency, but then it would ignore all sources in it, i.e. all of the dependency's workspace members. Otherwise I'm afraid that error message sounds correct, uv can't tell that the packages are the same and needs a different package tree.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DiDeoxy">@DiDeoxy</a> on 2025-12-17 17:01</div>
            <div class="timeline-body"><p>In <code>external_ws/submodule_1/submodule_1_pyproject.toml</code>:</p>
<pre><code>[tool.uv.workspace]
members = [&quot;packages/*&quot;, &quot;external/*&quot;]

[tool.uv.sources]
package_b = { workspace = true }
package_c = { workspace = true }
package_d = { workspace = true }
</code></pre>
<p>Which is where the issue arises since both here and <code>root_pyproject.toml</code> have different paths for <code>package_d</code>. What I don't understand is why <code>external_ws/submodule_1/submodule_1_pyproject.toml</code> is even being read? It is not referenced in <code>root_pyproject.toml</code> at all, it is ignored but uv still reads it for some reason when making <code>uv.lock</code> for <code>root_pyproject.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 17:23</div>
            <div class="timeline-body"><p>uv search the workspace root for each package by traversing upwards, to understand workspace references in it.</p>
<p>It seems roughly correct that uv rejects the package being in two separate locations at the same time.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:15 UTC
    </footer>
</body>
</html>
