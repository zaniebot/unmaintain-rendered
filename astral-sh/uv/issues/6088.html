<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>unable to install petsc4py - astral-sh/uv #6088</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>unable to install petsc4py</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6088">#6088</a>
        opened by <a href="https://github.com/owlkward">@owlkward</a>
        on 2024-08-14 16:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/owlkward">@owlkward</a> on 2024-08-14 16:40</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<ul>
<li>uv version: 0.2.36</li>
<li>python version: 3.12.4</li>
<li>pip version: 24.2</li>
<li>petsc4py version: 3.21.4 (but I have tested a few random other versions and all of them fail the same)</li>
<li>Platform: Arch Linux x86_64</li>
</ul>
<p>All install commands where tested in a clean new virtual environment and produce the same output with added --no-cache.
The uv command that fails and its output is:</p>
<pre><code>uv pip install &quot;petsc4py==3.21.4&quot;
Resolved 4 packages in 3m 11s
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: petsc4py==3.21.4
  Caused by: Failed to build: `petsc4py==3.21.4`
  Caused by: Build backend failed to build wheel through `build_wheel()` with exit status: 1
--- stdout:
running bdist_wheel
running build
running build_src
using Cython 3.0.11
cythonizing 'petsc4py/PETSc.pyx' -&gt; 'petsc4py/PETSc.c'
running build_py
creating build
creating build/lib.linux-x86_64-cpython-312
creating build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/__init__.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/__main__.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/typing.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
creating build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/__init__.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/__init__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/__main__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/py.typed -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc.pxd -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc_api.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
creating build/lib.linux-x86_64-cpython-312/petsc4py/include
creating build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/numpy.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/petsc4py.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/pybuffer.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/pyscalar.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/petsc4py.i -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/lib/__init__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/__init__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/petsc.cfg -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
running build_ext
PETSC_DIR:    /tmp/.tmpNY57CB/builds-v0/.tmpEjCipm/lib/python3.12/site-packages/petsc
PETSC_ARCH:   
version:      3.21.4 release
integer-size: 32-bit
scalar-type:  real
precision:    double
language:     CONLY
compiler:     /usr/bin/mpicc
linker:       /usr/bin/mpicc
building 'PETSc' extension
creating build/temp.linux-x86_64-cpython-312
creating build/temp.linux-x86_64-cpython-312/src
creating build/temp.linux-x86_64-cpython-312/src/petsc4py
/usr/bin/mpicc -fPIC -Wall -Wwrite-strings -Wno-unknown-pragmas -Wno-lto-type-mismatch -Wno-stringop-overflow -fstack-protector -g -O -fPIC -fno-strict-overflow -DNDEBUG -g -O3 -Wall -march=x86-64 -mtune=generic -O3 -pipe -fno-plt -fexceptions -Wp,-D_FORTIFY_SOURCE=3 -Wformat -Werror=format-security -fstack-clash-protection -fcf-protection -fno-omit-frame-pointer -mno-omit-leaf-frame-pointer -g -ffile-prefix-map=/build/python/src=/usr/src/debug/python -flto=auto -ffat-lto-objects -march=x86-64 -mtune=generic -O3 -pipe -fno-plt -fexceptions -Wp,-D_FORTIFY_SOURCE=3 -Wformat -Werror=format-security -fstack-clash-protection -fcf-protection -fno-omit-frame-pointer -mno-omit-leaf-frame-pointer -g -ffile-prefix-map=/build/python/src=/usr/src/debug/python -flto=auto -march=x86-64 -mtune=generic -O3 -pipe -fno-plt -fexceptions -Wp,-D_FORTIFY_SOURCE=3 -Wformat -Werror=format-security -fstack-clash-protection -fcf-protection -fno-omit-frame-pointer -mno-omit-leaf-frame-pointer -g -ffile-prefix-map=/build/python/src=/usr/src/debug/python -flto=auto -DMPICH_SKIP_MPICXX=1 -DOMPI_SKIP_MPICXX=1 -DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION -Isrc -Isrc/petsc4py/include -I/tmp/.tmpNY57CB/builds-v0/.tmpEjCipm/lib/python3.12/site-packages/numpy/_core/include -I/tmp/.tmpNY57CB/built-wheels-v3/pypi/petsc/3.21.4/P3e4qOhmc2TGpnFhGnpc6/petsc-3.21.4.tar.gz/build/bdist.linux-x86_64/wheel/petsc/include -I/tmp/.tmpNY57CB/builds-v0/.tmpEjCipm/include -I/usr/include/python3.12 -c src/petsc4py/PETSc.c -o build/temp.linux-x86_64-cpython-312/src/petsc4py/PETSc.o
--- stderr:
src/petsc4py/PETSc.c:1222:10: fatal error: petsc.h: No such file or directory
 1222 | #include &lt;petsc.h&gt;
      |          ^~~~~~~~~
compilation terminated.
error: command '/usr/bin/mpicc' failed with exit code 1
---
  Caused by: This error likely indicates that you need to install a library that provides &quot;petsc.h&quot; for petsc4py==3.21.4
</code></pre>
<p>The error looked to me like it actually fails in the petsc dependency of petsc4py, but if I install &quot;petsc==3.21.4&quot; separately that works, but if I try to install petsc4py afterwards I still get the same error.</p>
<p>When I try to install the package with pip both</p>
<pre><code>pip install &quot;petsc4py==3.21.4&quot;
</code></pre>
<p>and</p>
<pre><code>pip install &quot;petsc4py==3.21.4&quot; --use-pep517
</code></pre>
<p>work and adding --no-build-environment to the uv command only causes different errors, so it doesn't seem to be that issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-14 16:40</div>
            <div class="timeline-body"><p>What error do you get with <code>--no-build-environment</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/owlkward">@owlkward</a> on 2024-08-14 16:57</div>
            <div class="timeline-body"><p>I had a typo there I guess, the flag is actually called <code>--no-build-isolation</code> and it turns out I was wrong, after thinking about it. The different error I meant was:</p>
<pre><code>uv pip install --no-build-isolation &quot;petsc4py==3.21.4&quot;
Resolved 3 packages in 1.88s
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: petsc4py==3.21.4
  Caused by: Failed to build: `petsc4py==3.21.4`
  Caused by: Build backend failed to build wheel through `build_wheel()` with exit status: 1
--- stdout:
running bdist_wheel
running build
running build_src
using Cython 3.0.11
cythonizing 'petsc4py/PETSc.pyx' -&gt; 'petsc4py/PETSc.c'
running build_py
creating build
creating build/lib.linux-x86_64-cpython-312
creating build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/__init__.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/__main__.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/typing.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
creating build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/__init__.py -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/__init__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/__main__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/py.typed -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc.pxd -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
copying src/petsc4py/PETSc_api.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py
creating build/lib.linux-x86_64-cpython-312/petsc4py/include
creating build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/numpy.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/petsc4py.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/pybuffer.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/pyscalar.h -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/petsc4py.i -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/lib/__init__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/__init__.pyi -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/petsc.cfg -&gt; build/lib.linux-x86_64-cpython-312/petsc4py/lib
running build_ext
--- stderr:
PETSC_DIR not specified
error: PETSc not found
---
</code></pre>
<p>but that gets resolved when I do <code>uv pip install &quot;petsc==3.21.4&quot;</code> before it. Previously I only had setuptools, wheel and cython installed for the <code>--no-build-isolation</code> run, but petsc as a dependency was missing.
So <code>uv pip install setuptools wheel cython petsc &amp;&amp; uv pip install petsc4py --no-build-isolation</code> produces the same error as directly calling <code>uv pip install petsc4py</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2024-08-15 12:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @charliermarsh on 2024-08-15 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-15 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-15 12:28</div>
            <div class="timeline-body"><p>I can also reproduce <code>pip install &quot;petsc4py==3.21.4&quot; --use-pep517</code> working, but <code>uv pip</code> failing, so I'll tag this as a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-15 12:28</div>
            <div class="timeline-body"><p>It <em>may</em> end up being a bug in the package itself, or a bug in uv, need to dig in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wraith1995">@wraith1995</a> on 2024-09-12 20:05</div>
            <div class="timeline-body"><p>I can reproduce this - I cain install fine without uv, but can't with uv. I get:</p>
<pre><code class="language-error:">  Caused by: Failed to fetch wheel: petsc4py==3.21.5
  Caused by: Build backend failed to build wheel through `build_wheel()` with exit status: 1
--- stdout:
running bdist_wheel
running build
running build_src
running build_py
copying src/petsc4py/PETSc.py -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/__init__.py -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/typing.py -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/__main__.py -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/lib/__init__.py -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/lib
copying src/petsc4py/__main__.pyi -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/__init__.pyi -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/py.typed -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/PETSc.pxd -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/PETSc_api.h -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/PETSc.h -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py
copying src/petsc4py/include/petsc4py/numpy.h -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/petsc4py.h -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/pyscalar.h -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/pybuffer.h -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/include/petsc4py/petsc4py.i -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/include/petsc4py
copying src/petsc4py/lib/__init__.pyi -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/__init__.pyi -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/lib
copying src/petsc4py/lib/petsc.cfg -&gt; build/lib.macosx-11.0-arm64-cpython-312/petsc4py/lib
running build_ext
PETSC_DIR:    /Users/teoc/Library/Caches/uv/builds-v0/.tmptFGYXc/lib/python3.12/site-packages/petsc
PETSC_ARCH:   
version:      3.21.5 release
integer-size: 32-bit
scalar-type:  real
precision:    double
language:     CONLY
compiler:     gcc
linker:       gcc
building 'PETSc' extension
gcc -fPIC -Wall -Wwrite-strings -Wno-unknown-pragmas -fstack-protector -fno-stack-check -Qunused-arguments -g -O3 -fno-strict-overflow -Wsign-compare -Wunreachable-code -DNDEBUG -g -O3 -Wall -arch arm64 -mmacosx-version-min=11.0 -Wno-nullability-completeness -Wno-expansion-to-defined -Wno-undef-prefix -fPIC -Werror=unguarded-availability-new -DMPICH_SKIP_MPICXX=1 -DOMPI_SKIP_MPICXX=1 -DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION -Isrc -Isrc/petsc4py/include -I/Users/teoc/Library/Caches/uv/builds-v0/.tmptFGYXc/lib/python3.12/site-packages/numpy/_core/include -I/Users/teoc/Library/Caches/uv/built-wheels-v3/pypi/petsc/3.21.5/w4zagi45eJEbj7BEkZ1Co/petsc-3.21.5.tar.gz/build/bdist.macosx-11.0-arm64/wheel/petsc/include -I/Users/teoc/Library/Caches/uv/builds-v0/.tmptFGYXc/include -I/Users/teoc/.local/share/uv/python/cpython-3.12.5-macos-aarch64-none/include/python3.12 -c src/petsc4py/PETSc.c -o build/temp.macosx-11.0-arm64-cpython-312/src/petsc4py/PETSc.o
--- stderr:
src/petsc4py/PETSc.c:1222:10: error: 'petsc.h' file not found with &lt;angled&gt; include; use &quot;quotes&quot; instead
#include &lt;petsc.h&gt;
         ^~~~~~~~~
         &quot;petsc.h&quot;
src/petsc4py/PETSc.c:1222:10: warning: non-portable path to file '&lt;PETSc.h&gt;'; specified path differs in case from file name on disk [-Wnonportable-include-path]
#include &lt;petsc.h&gt;
         ^~~~~~~~~
         &lt;PETSc.h&gt;
In file included from src/petsc4py/PETSc.c:1224:
src/lib-petsc/compat.h:4:10: fatal error: 'petsc.h' file not found
#include &lt;petsc.h&gt;
         ^~~~~~~~~
1 warning and 2 errors generated.
error: command '/usr/bin/gcc' failed with exit code 1
---
  Caused by: This error likely indicates that you need to install a library that provides &quot;petsc.h&quot; for petsc4py==3.21.5
</code></pre>
<p>Looking at the build statement, I see that this is due to <code>/Users/teoc/Library/Caches/uv/built-wheels-v3/pypi/petsc/3.21.5/w4zagi45eJEbj7BEkZ1Co/petsc-3.21.5.tar.gz/build/bdist.macosx-11.0-arm64/wheel/petsc/include </code> not having anything in it at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-01-09 03:49</div>
            <div class="timeline-body"><p>Duplicate of https://github.com/astral-sh/uv/issues/10052</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10052.html">astral-sh/uv#10052</a> on 2025-01-09 03:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-01-09 14:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:32 UTC
    </footer>
</body>
</html>
