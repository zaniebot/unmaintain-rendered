<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support local package-specific index overrides without modifying pyproject.toml - astral-sh/uv #16471</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support local package-specific index overrides without modifying pyproject.toml</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/16471">#16471</a>
        opened by <a href="https://github.com/patrontheo">@patrontheo</a>
        on 2025-10-27 11:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/patrontheo">@patrontheo</a> on 2025-10-27 11:57</div>
            <div class="timeline-body"><h3>Question</h3>
<p><strong>Description / Problem:</strong>
I’m developing a library that depends on torch. For local development, I want to use a specific CUDA version (e.g., CUDA 11.8), but I also want to keep the pyproject.toml clean and generic so downstream projects can choose their own CUDA version.</p>
<p>Currently, uv only allows package-specific sources via [tool.uv.sources] in the main pyproject.toml. There is no documented or working way to specify a package-specific index for local development without modifying the main pyproject.toml.</p>
<p>What I tried:</p>
<p><strong>1. Specify sources and index in my library’s pyproject.toml</strong></p>
<pre><code class="language-toml">[sources]
torch = [
  { index = &quot;pytorch-cu118&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
torchvision = [
  { index = &quot;pytorch-cu118&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]

[index]
name = &quot;pytorch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true
</code></pre>
<p>Result: installing my library in another project with torch+cu128 failed:</p>
<pre><code class="language-perl">× Failed to resolve dependencies for `my-library` (v0.1.0)
  ╰─▶ Requirements contain conflicting indexes for package `torch` in split `sys_platform == 'linux'`:
      - https://download.pytorch.org/whl/cu118
      - https://download.pytorch.org/whl/cu128
</code></pre>
<p>I thought [tool.uv.sources] and index weren’t supposed to be read by consumers but maybe I'm wrong here.
<strong>In any case, I think 'my-library' pyproject file should be clear of any cuda dependency (to leave it free for downstream projects), so I don't think I should be defining any sources or indexes here.</strong></p>
<p><strong>2. Use UV_EXTRA_INDEX_URL</strong></p>
<pre><code class="language-bash">UV_EXTRA_INDEX_URL=https://download.pytorch.org/whl/cu118 uv sync
</code></pre>
<p>Works as a fallback, but doesn’t guarantee the desired CUDA version if torch exists on PyPI (it installs the CPU or another CUDA variant first). So when doing local development on my-library, I can't hardcode the cuda version.</p>
<p><strong>3. Use uv.toml or a local pyproject.local.toml with [tool.uv.sources]</strong></p>
<p>Fails: uv rejects [tool.uv.sources] outside the main pyproject.toml.</p>
<p>Goal / Proposed feature:</p>
<ul>
<li>Allow a local, non-committed package-specific index override (e.g., for torch)</li>
<li>Applies only to local development, leaving pyproject.toml clean</li>
<li>Works even if consumers install the library with a different CUDA version</li>
</ul>
<p>Motivation / Use case:</p>
<ul>
<li>Libraries depending on PyTorch (or other packages with multiple binary variants) often need a specific CUDA version during development.</li>
<li>Downstream projects may require a different CUDA version.</li>
<li>Right now, there is no clean way to configure this in uv without modifying pyproject.toml or globally replacing indexes.</li>
</ul>
<h3>Platform</h3>
<p>all</p>
<h3>Version</h3>
<p>uv 0.9.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @patrontheo on 2025-10-27 11:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/patrontheo">@patrontheo</a> on 2025-10-27 16:02</div>
            <div class="timeline-body"><p>I realize that it's kind of a duplicate of #6772.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-27 16:40</div>
            <div class="timeline-body"><p><code>[tool.uv.sources]</code> aren't used when installing from a source distribution or wheel. How do your users install package, do use the package published to an index, or do they use a Git dependency with uv?</p>
<p>You can also use <code>[dependency-groups]</code> and sources that apply to a group for development, as <code>[dependency-groups]</code> are never used downstream.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/patrontheo">@patrontheo</a> on 2025-10-27 16:59</div>
            <div class="timeline-body"><p>@konstin thanks for the answer.</p>
<p>The users install the package with <code>uv</code> and a pyproject file as follows:</p>
<pre><code class="language-toml">dependencies = [
    &quot;torch==2.5.1&quot;,
    &quot;my-library&quot;
]

[tool.uv.sources]
my-library = { git = &quot;https://github.com/company/name-of-repo.git&quot;, subdirectory = &quot;my-library-subdir&quot; }
torch = [
  { index = &quot;pytorch-cu128&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]

[[tool.uv.index]]
name = &quot;pytorch-cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true
</code></pre>
<p>If the pyproject of <code>my-library</code> does <strong>not</strong> contain [sources] nor [index] (like below), I can successfully install the library with the pyproject shown above (running <code>uv sync</code>):</p>
<pre><code class="language-toml">dependencies = [
  &quot;torch&gt;=2.5&quot;,
]
</code></pre>
<p>If the pyproject of <code>my-library</code> contains [sources] and [index] (like below), it fails to install with the error I mentioned in the issue description.</p>
<pre><code class="language-toml">dependencies = [
  &quot;torch&gt;=2.5&quot;,
]

[[tool.uv.index]]
name = &quot;pytorch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = false

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cu118&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
</code></pre>
<p>Are you saying that it shouldn't behave like that and that it's a bug ?</p>
<p>What I would like is to be able to specify the source for <code>torch</code> when developing <code>my-library</code>, without this source being used when installing this lib as a dependency.</p>
<p>Maybe I am doing something wrong here ? I am not sure how <code>[dependency-groups]</code> can be used here ? Can you explain a bit more about that ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-27 18:01</div>
            <div class="timeline-body"><p>I think the ideal solution is being able to deactivate sources, especially index sources, for packages you depend on:</p>
<pre><code class="language-toml">[tool.uv.sources]
my-library = { git = &quot;https://github.com/company/name-of-repo.git&quot;, subdirectory = &quot;my-library-subdir&quot;, sources = false }
torch = [
  { index = &quot;pytorch-cu128&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
</code></pre>
<p>I thought we had this tracked somewhere, but I can't find the issue. https://github.com/astral-sh/uv/issues/6772 is also an option for this too, though deactivating sources fits better into uv's design.</p>
<p>The dependency groups approach doesn't work with this setup specifically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/patrontheo">@patrontheo</a> on 2025-10-27 18:12</div>
            <div class="timeline-body"><p>Yes, this would work indeed :)</p>
<p>Although from my point of view, it seems to be better that the user can install the package without having to do anything special about it (e.g. without having to put <code>sources = false</code>).</p>
<p>He just specifies the package as a dependency, and if he needs he adds sources / indexes for a specific dependency he has (e.g. Pytorch).</p>
<p>Then it means that the library pyproject should be clear of any sources, and those could be defined in a <code>uv.toml</code> file (or e.g. <code>pyproject.dev.toml</code>) if needed when developing this lib.</p>
<p>At least I see that as a better solution for packages like pytorch, maybe for some other types of packages the <code>sources = false</code> approach works better.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
