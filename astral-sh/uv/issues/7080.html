<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unable to create an editable .pth without 'uv pip install -e .' - astral-sh/uv #7080</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unable to create an editable .pth without 'uv pip install -e .'</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7080">#7080</a>
        opened by <a href="https://github.com/jklaiho">@jklaiho</a>
        on 2024-09-05 12:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jklaiho">@jklaiho</a> on 2024-09-05 12:21</div>
            <div class="timeline-body"><p>I've got a Django project in development inside a Docker container, structured like this:</p>
<pre><code>/code
  |_apps/
  |_project/
    |_sitename/
    |_manage.py
  |_(more dirs not relevant here)/
  |_pyproject.toml
  |_uv.lock
  |_(more files not relevant here)
</code></pre>
<p>I've used this structure for over a decade, starting with virtualenvs in vagrant boxes, and it's survived to this day. Of course, <code>pyproject.toml</code> is a more recent addition to the mix. I have not created that file or this structure with <code>uv init</code> originally, both were there before I started experimenting with uv. I also use the brand new <code>UV_PROJECT_ENVIRONMENT=/opt/venv</code> variable in the container, but that probably isn't relevant here.</p>
<p><code>/code</code> is bind mounted from the host machine via Compose. <code>project</code> is the result of <code>django-admin startproject</code>. <code>apps</code> contains the Django apps (i.e. subdirs created with <code>/code/project/manage.py startapp</code>).</p>
<p>In earlier projects, I've used pip-tools, creating a requirement file with <code>pip-compile</code> that would get <code>pip-sync</code>ed. Additionally, on container startups, using <code>command:</code> in <code>docker-compose.yml</code>,  I'd run <code>pip install -e .</code> inside the <code>/code</code> directory to create the <code>.pth</code> file containing the string <code>/code/apps</code>, so our later <code>&amp;&amp; /code/project/manage.py runserver</code> invocation in the same <code>command</code> block works correctly and finds the Django apps.</p>
<p>What makes <code>pip install -e .</code> possible is this clause in <code>pyproject.toml</code>:</p>
<pre><code>[tool.setuptools.packages.find]
where = [&quot;apps&quot;]
</code></pre>
<p>So, I'd essentially use the src layout, but with a folder called <code>apps</code> instead of <code>src</code>. Note that <code>pyproject.toml</code> does not contain a build system definition.</p>
<p>This still works the same as before if I run <code>uv pip install -e .</code> inside the <code>/code</code> dir. The <code>.pth</code> file is created. However, with <code>uv add --editable .</code>, it is not created. That command causes these to be added to <code>pyproject.toml</code>, though:</p>
<pre><code>[project]
name=ProjectName
# ... other stuff

dependencies = [
    &quot;Django==5.1.0&quot;,  # pre-existing
    &quot;projectname&quot;  # added by uv
]

# ... other stuff here, then this added by uv:

[tool.uv.sources]
projectname = { workspace = true }
</code></pre>
<p>I have no idea where to go from here to get the .pth file created. <code>uv sync</code> doesn't do it. This is almost certainly just my ignorance about how uv works, but I haven't found an answer in the docs, or at least haven't understood what I've read properly.</p>
<p>This isn't as much a bug report as a request for clarification, possibly at the documentation level. It feels weird to use the uv pip interface for creating the .pth file when everything else I can do without it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidharting">@davidharting</a> on 2024-09-06 19:58</div>
            <div class="timeline-body"><p>I having this issue as well. <code>uv add --editable .</code> seems to try to get me into a workspace-oriented setup. But workspaces don't seem appropriate for me, because I truly only want one pyproject.toml.</p>
<p>I am also noticing that maybe there was a behavior change between 0.3.3 and 0.4.6.</p>
<p>I have a script that I run with:</p>
<pre><code>uv run scripts/my_script.py
</code></pre>
<p>my_script.py imports from a local module:</p>
<pre><code class="language-python"># scripts/my_script.py
from my_module.application import app

if __name__ == '__main__':
  print(app)
</code></pre>
<p>Under <code>uv 0.3.3</code> this worked. I didn't have to install my package as editable or use workspaces.</p>
<p>Under <code>uv 0.4.6</code> this no longer works: <code>ModuleImportError: Module my_module does not exit</code></p>
<p>I can workaround this by running:</p>
<pre><code>pip install -e .
</code></pre>
<p>After this: <code>uv run scripts/my_script.py</code> works. However, the next <code>uv sync</code> removes the local editable install.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidharting">@davidharting</a> on 2024-09-06 20:06</div>
            <div class="timeline-body"><p><strong>Update:</strong></p>
<p>It looks like this diff from my uv.lock from upgrading from uv 0.3.3 to uv 0.4.6 might be related to my issue above.</p>
<pre><code class="language-diff">[[package]]
name = &quot;my-package&quot;
version = &quot;0.0.1&quot;
- source = { editable = &quot;.&quot; }
+ source = { virtual = &quot;.&quot; }
</code></pre>
<hr />
<p>I am happy to split off my discussion into a different issue. I'm not sure if @jklaiho and I are describing symptoms of the same problem or no</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidharting">@davidharting</a> on 2024-09-06 20:21</div>
            <div class="timeline-body"><p><strong>Update 2</strong></p>
<p>I just noticed this from the release notes for uv 0.4.0:</p>
<blockquote>
<p>uv no longer attempts to package and install projects that do not define a [build-system].
While the project itself will not be installed into the virtual environment, its dependencies will still be included.
The previous behavior can be recovered by setting package = true in the [tool.uv] section of your pyproject.toml.</p>
</blockquote>
<p>Doing as the docs suggest resolved my issue. I can now use uv 0.4.6 and <code>uv run scripts/my_script.py</code> successfully!</p>
<p>@jklaiho I wonder if you can do the same and add:</p>
<pre><code>[uv.tool]
package = true
</code></pre>
<p>to your pyproject.toml.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-06 20:23</div>
            <div class="timeline-body"><p>Yes I think you're looking for <code>package = true</code>. Documentation on this in: https://docs.astral.sh/uv/concepts/projects/#build-systems</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-09-06 20:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-07 15:15</div>
            <div class="timeline-body"><p>Let us know if you have more questions!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-07 15:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jklaiho">@jklaiho</a> on 2024-09-10 12:24</div>
            <div class="timeline-body"><p>Can confirm that this worked as intended for my use case as well. :+1:</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:41 UTC
    </footer>
</body>
</html>
