<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV_OFFLINE and --refresh odd behaviour - astral-sh/uv #13316</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV_OFFLINE and --refresh odd behaviour</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/13316">#13316</a>
        opened by <a href="https://github.com/RomainBrault">@RomainBrault</a>
        on 2025-05-06 16:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RomainBrault">@RomainBrault</a></div>
            <div class="timeline-body">Summary
<p>While the flags follow the expected behavior, using the environment variables do not:</p>
<pre><code>❯ UV_OFFLINE=0 UV_REFRESH=1 uv run python -c &#x27;&#x27;

❯ UV_OFFLINE=1 UV_REFRESH=1 uv run python -c &#x27;&#x27;

❯ UV_OFFLINE=0 uv run --refresh python -c &#x27;&#x27;
error: the argument &#x27;--refresh&#x27; cannot be used with &#x27;--offline&#x27;

❯ UV_OFFLINE=1 uv run --refresh python -c &#x27;&#x27;
error: the argument &#x27;--refresh&#x27; cannot be used with &#x27;--offline&#x27;

Usage: uv run --refresh

For more information, try &#x27;--help&#x27;.

❯ UV_OFFLINE=&quot;&quot; UV_REFRESH=&quot;&quot; uv run python -c &#x27;&#x27;
error: invalid value &#x27;&#x27; for &#x27;--offline&#x27;: value was not a boolean

For more information, try &#x27;--help&#x27;.

❯ UV_OFFLINE=&quot;hello&quot; UV_REFRESH=&quot;world&quot; uv run python -c &#x27;&#x27;
error: invalid value &#x27;hello&#x27; for &#x27;--offline&#x27;: value was not a boolean

For more information, try &#x27;--help&#x27;.
</code></pre>
<p>Or maybe I am using wrong the &quot;boolean flags&quot; but I think in this case it would be nice to specify what are the accepted values for the boolean flags.</p>
<p>Otherwise I would expect <code>UV_OFFLINE=1 UV_REFRESH=1 uv run python -c &#x27;&#x27;</code> to fail (now it seems to pass) and <code>UV_OFFLINE=0 uv run --refresh python -c &#x27;&#x27;</code> should pass.</p>
Platform
<p>Ubuntu 25.04</p>
Version
<p>0.7.2</p>
Python version
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2025-05-06 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-06 16:37</div>
            <div class="timeline-body"><blockquote>
<p>error: invalid value &#x27;&#x27; for &#x27;--offline&#x27;: value was not a boolean</p>
</blockquote>
<p>I think this is reasonable.</p>
<blockquote>
<p>error: the argument &#x27;--refresh&#x27; cannot be used with &#x27;--offline&#x27;</p>
</blockquote>
<p>This is enforced at the CLI level, before values are parsed. We&#x27;d have to move <code>--refresh</code> / <code>--offline</code> conflict enforcement out of Clap to fix this, which seems reasonable to do.</p>
<blockquote>
<p>UV_OFFLINE=1 UV_REFRESH=1 uv run python -c &#x27;&#x27;</p>
</blockquote>
<p><code>UV_REFRESH</code> does not exist, hence the success here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-06 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2025-05-06 16:47</div>
            <div class="timeline-body"><p>Thanks, sorry the empty values and hello, world values. They where just here for reference, I think this is very reasonable indeed :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2025-05-06 16:58</div>
            <div class="timeline-body"><p>Wouldn&#x27;t a UV_REFRESH be reasonable too ?</p>
<p>I would like to use refresh when I have internet. If I don&#x27;t have internet I can toggle UV_OFFLINE=1 to avoid errors. However all my commands containing --refresh would fail. It would be nice to be able to switch it off globally with a UV_REFRESH.</p>
<p>I can open another feature issue if necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;UV_OFFLINE and UV_REFRESH odd behaviour&quot; to &quot;UV_OFFLINE and --refresh odd behaviour&quot; by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2025-05-06 16:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-05-06 17:01</div>
            <div class="timeline-body"><p>Why do you want to force refresh the cache when you have internet? (In general, it&#x27;s reasonable for us to add variables for flags, but I&#x27;m curious about the use-case)</p>
<p>You may find <a href="https://github.com/astral-sh/uv/issues/10380">astral-sh/uv#10380</a> interesting too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2025-05-07 07:52</div>
            <div class="timeline-body"><p>I&#x27;m using uv in a test script (justfile). I install local dependencies (the one to test). I want to be sure to have the latest update of my local package (source and metadata) when run the test so I add the --refresh. The performance impact is low and guarantee a clean cache. However when I&#x27;m moving and don&#x27;t have internet access I still wanna be able to test my code hence the UV_OFFLINE toggle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-04 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2026-01-06 20:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:38:30 UTC
    </footer>
</body>
</html>
