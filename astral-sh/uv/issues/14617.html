<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weird behavior with `uv pip install -r requirements.txt` when using relative directories - astral-sh/uv #14617</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Weird behavior with <code>uv pip install -r requirements.txt</code> when using relative directories</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14617">#14617</a>
        opened by <a href="https://github.com/Panacea729">@Panacea729</a>
        on 2025-07-14 22:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-14 22:38</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I have the following directory structure</p>
<pre><code>.
├── packages
│   ├── my-pkg
│   │   ├── pyproject.toml
│   │   └── src
│   │       └── my_pkg
│   │           └── __init__.py
│   └── my-pkg-lib
│       ├── pyproject.toml
│       └── src
│           └── my_pkg_lib
│               └── __init__.py
├── pyproject.toml
├── requirements.txt
├── src
│   └── root_pkg
│       └── __init__.py
└── uv.lock
</code></pre>
<p>and the following pyproject.tomls</p>
<pre><code>[project]
name = &quot;root-pkg&quot;
version = &quot;1.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
        &quot;my-pkg&quot;
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.uv.workspace]
members = [
    &quot;packages/my-pkg&quot;,
    &quot;packages/my-pkg-lib&quot;,
]

[tool.uv.sources]
my-pkg = { workspace = true }
my-pkg-lib = { workspace = true }
</code></pre>
<pre><code>[project]
name = &quot;my-pkg&quot;
version = &quot;1.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = [
        &quot;my-pkg-lib&quot;
]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
<pre><code>[project]
name = &quot;my-pkg-lib&quot;
version = &quot;1.0&quot;
requires-python = &quot;&gt;=3.10&quot;
dependencies = []

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
<p>I have a requirements.txt as follows:</p>
<pre><code>.
./packages/my-pkg
    # via root-pkg
./packages/my-pkg-lib
    # via my-pkg
</code></pre>
<p>This is what gets generated from <code>uv export --no-editable</code></p>
<p>So, now my question/issue. If I run <code>uv pip install -r requirements.txt --target my-deps</code>, my-pkg and my-pkg-lib are installed as editable, even though the requirements.txt does not indicate to install them as such.</p>
<pre><code>└─$ ls my-deps/
my_pkg-1.0.dist-info  my_pkg_lib-1.0.dist-info  _my_pkg_lib.pth  _my_pkg.pth  root_pkg  root_pkg-1.0.dist-info
</code></pre>
<p>Switching the order of the requirements doesn't matter:</p>
<pre><code>./packages/my-pkg-lib
./packages/my-pkg
.
</code></pre>
<p>Another thing to note, is if I don't install the root-pkg, my-pkg gets installed as non-editable and my-pkg-lib gets installed as editable, so clearly it seems as though there's something up with how the dependencies are installed.</p>
<pre><code>./packages/my-pkg-lib
./packages/my-pkg
</code></pre>
<pre><code>└─$ ls my-deps/
my_pkg  my_pkg-1.0.dist-info  my_pkg_lib-1.0.dist-info  _my_pkg_lib.pth
</code></pre>
<p>Obviously if the requirements were listed with <code>-e</code> you would expect this to be the case, but without <code>-e</code> this is unintuitive to me. Is there some way to get around this? Someway to indicate that I don't want to install the lib package (or whatever other dependencies) as editable?</p>
<p>With <code>uv sync</code> there's <code>--no-editable</code> which guarantees that these workspace members won't be installed as editable, but there's no such thing for <code>uv pip install</code>, I imagine because it's expected to come from the requirements file.</p>
<p>Any help would be appreciated.</p>
<h3>Platform</h3>
<p>Linux</p>
<h3>Version</h3>
<p>uv 0.7.21</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @Panacea729 on 2025-07-14 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Weird behavior with `pip install -r requirements.txt` when using relative directories" to "Weird behavior with `uv pip install -r requirements.txt` when using relative directories" by @Panacea729 on 2025-07-14 22:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-14 23:02</div>
            <div class="timeline-body"><p>For reference when using <code>pip</code> and not <code>uv pip</code> the files are installed as uneditable:</p>
<pre><code> pip install -r requirements.txt --target my-deps-pip
</code></pre>
<pre><code>ls my-deps-pip/
my_pkg  my_pkg-1.0.dist-info  my_pkg_lib  my_pkg_lib-1.0.dist-info  root_pkg  root_pkg-1.0.dist-info
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-14 23:05</div>
            <div class="timeline-body"><p>I think this is the same as https://github.com/astral-sh/uv/issues/13087#issuecomment-2971492504</p>
<p>Does it reproduce with the <code>--no-deps</code> flag, e.g., <code>pip install -r requirements.txt --target my-deps-pip --no-deps</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-14 23:07</div>
            <div class="timeline-body"><pre><code> 1737  rm -rf my-deps-pip
 1738  pip install -r requirements.txt --target my-deps-pip --no-deps
 1739  ls my-deps-pip
 1740  history
</code></pre>
<pre><code>└─$ ls my-deps-pip
my_pkg  my_pkg-1.0.dist-info  my_pkg_lib  my_pkg_lib-1.0.dist-info  root_pkg  root_pkg-1.0.dist-info
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-14 23:09</div>
            <div class="timeline-body"><p>Ah, if you meant <code>uv pip install -r requirements.txt --target my-deps-pip --no-deps</code> that seemed to work. Thanks. Should've realized that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Panacea729 on 2025-07-14 23:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-15 15:32</div>
            <div class="timeline-body"><p>Ah so the issue I run into with <code>--no-deps</code> in my actual project is that I actually DO want the deps. I want the deps from the <code>lib</code> packages. My lib packages have dependencies on external python packages from pypi.</p>
<p>The &quot;workaround&quot; for this is either use two requirements.txt files (one with --no-deps and one without, which seems as though it might run into dependency conflicts), or as I'm currently doing, use <code>uv venv</code> and <code>uv sync --no-editable --group MY_GROUP --no-dev</code> and manually parse that venv to grab the packages we want. The second way seems to be working well enough for now, but really, I want to avoid creating a bunch of different dependency groups within the pyproject.toml when I could be using <code>requirements.txt</code> files.</p>
<p>For reference the project I'm making essentially builds a group of plugins, and there are different combinations of plugins that are supported by the main program. I organize those different sets of plugins that work together into dependency-groups. I want all the plugins in the same workspace since developers will always be working on them all at the same time, and they all should share dependencies for simplicity since they can be combined in so many different ways.</p>
<p>The reason I tended toward using <code>uv pip install</code> was to use different sources than present in the pyproject.toml. In some of our CI builds, we want to point the project to use a package from a private repository, where other times we want to point it to use the project from the workspace (very weird scenario), but conditional sources like this isn't supported by <code>uv</code>. Seems like it's only able to differentiate sources based on the os/python version using dependency specifiers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @Panacea729 on 2025-07-15 15:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-15 15:33</div>
            <div class="timeline-body"><p>I'd be nice if the <code>uv pip install</code> interface matched the same behavior as <code>pip install</code> here. (which is a separate issue from ading <code>no-editable</code> to <code>uv pip install</code> although they solve similar issues)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-15 16:54</div>
            <div class="timeline-body"><p><code>uv export</code> should include all those transitive dependencies, you should always install with <code>--no-deps</code> from <code>requirements.txt</code> files to avoid pulling in unlocked dependencies? I'm a bit confused.</p>
<p>Does using <code>--no-sources</code> on the <code>uv pip install</code> invocation work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-15 19:00</div>
            <div class="timeline-body"><p>You can ignore my specific use case, it's very unique. I would rather not include the transitive dependencies in the <code>requirements.txt</code> files if possible.</p>
<p>Essentially, I want to, without a uv project (due to lack of support for conditional sources), have a bunch of different <code>requirements.txt</code> files,
i.e. requirements-group1.txt, requirements-group2.txt, etc...</p>
<p>Some of these requirements.txt files can have relative paths to resolve their dependencies, i.e.</p>
<pre><code>./packages/common-lib
./packages/plugin1
./packages/plugin2
plugin3 == 1.0.0
plugin4 == 1.0.0
./packages/plugin5
</code></pre>
<p>The packages can have transitive dependencies, i.e. common-lib can depend on &quot;requests&quot; or &quot;cryptography&quot;, which are not listed in the requirements.txt</p>
<p>If, for example, plugin1 depends on <code>common-lib</code>, <code>common-lib</code> SHOULD be installed as non-editable since it is included in the requirements.txt file as non-editable.</p>
<p>However, with <code>uv</code>s current implementation <code>common-lib</code> is installed as editable when doing <code>uv pip install -r requirements-group1.txt</code>. Additionally, <code>uv pip install --no-deps</code> cannot be used, since transitive dependencies (outside of those included in the requirements file) should still be resolved.</p>
<p>This seems to go against the standards that <code>pip</code> sets up since <code>pip</code> would install <code>common-lib</code> as non-editable, as shown here https://github.com/astral-sh/uv/issues/14617#issuecomment-3071281240. It would help me if <code>uv pip install</code> followed <code>pip</code>s same logic.</p>
<p>Thank you for the help by the way, I really appreciate the dev team's responsiveness.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-15 21:40</div>
            <div class="timeline-body"><p>I'm closing this because <code>--no-sources</code> should work and I just messed up. I initially tried it and got an error and figured it didn't fix it, but realized that I was getting an error because we link to a hatch plugin in the workspace as part of the build-dependencies for the &quot;lib&quot; pkg. It was working without <code>--no-sources</code> since the root-workspace had <code>hatch-plugin</code> as part of the workspace (so the lib pkg would traverse up and grab it), but with <code>--no-sources</code> it now doesn't know how to find it. I'm not really sure of a good solution for this, but might just manually install it into the <code>venv</code> and then later uninstall it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Panacea729 on 2025-07-15 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-15 21:40</div>
            <div class="timeline-body"><p>Once again, thanks for the help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Panacea729">@Panacea729</a> on 2025-07-15 21:47</div>
            <div class="timeline-body"><p>It would be helpful to have a <code>--no-sources-package</code> and a <code>--no-sources-build</code> or something like that to differentiate between allowing resolving for build dependencies vs package dependencies.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:31:04 UTC
    </footer>
</body>
</html>
