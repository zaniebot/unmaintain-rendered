<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shebang rewrite in installed scripts do not respect extra args passed to the interpreter - astral-sh/uv #14470</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>shebang rewrite in installed scripts do not respect extra args passed to the interpreter</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14470">#14470</a>
        opened by <a href="https://github.com/mayeut">@mayeut</a>
        on 2025-07-06 10:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mayeut">@mayeut</a></div>
            <div class="timeline-body">Summary
<p>e.g. a script in the wheel looks like:</p>
<pre><code>#!python -E
import sys


from cmake import cpack

if __name__ == &#x27;__main__&#x27;:
    if sys.argv[0].endswith(&#x27;-script.pyw&#x27;):
        sys.argv[0] = sys.argv[0][: -11]
    elif sys.argv[0].endswith(&#x27;.exe&#x27;):
        sys.argv[0] = sys.argv[0][: -4]

    sys.exit(cpack())
</code></pre>
<p>The script gets installed as:</p>
<pre><code>#!/bin/sh
&#x27;&#x27;&#x27;exec&#x27; &#x27;/private/var/folders/hb/2n_7f3yn20v06lzz3129dtw80000gn/T/cibw-run-sz3abzyq/cp39-macosx_universal2/venv-test-x86_64/bin/python3&#x27; &quot;$0&quot; &quot;$@&quot;
&#x27; &#x27;&#x27;&#x27; -E

import sys


from cmake import cpack

if __name__ == &#x27;__main__&#x27;:
    if sys.argv[0].endswith(&#x27;-script.pyw&#x27;):
        sys.argv[0] = sys.argv[0][: -11]
    elif sys.argv[0].endswith(&#x27;.exe&#x27;):
        sys.argv[0] = sys.argv[0][: -4]

    sys.exit(cpack())
</code></pre>
<p>The <code>-E</code> argument is not being written where it should be.
pip installing the same wheel creates a working script.
The <a href="https://packaging.python.org/en/latest/specifications/binary-distribution-format/#recommended-installer-features">spec</a> is unclear but the assumption in pip (or maybe distutils) is that arguments present behind the interpreter shall be left untouched (i.e. not removed).</p>
Platform
<p>macOS 15</p>
Version
<p>uv 0.7.19</p>
Python version
<p>Python 3.12.10</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/mayeut">@mayeut</a> on 2025-07-06 10:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;shebangs in installed scripts do not respect extra args passed to the interpreter&quot; to &quot;shebang rewrite in installed scripts do not respect extra args passed to the interpreter&quot; by <a href="https://github.com/mayeut">@mayeut</a> on 2025-07-06 10:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-06 22:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-07 14:49</div>
            <div class="timeline-body"><p>Seems reasonable to preserve if we can.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-07 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-09 14:08</div>
            <div class="timeline-body"><p>I just used <code>pip install</code> for a wheel containing this script:</p>
<pre><code>#!python -E
import sys
print(&quot;Python executable:&quot;, sys.executable)
print(&quot;Arguments:&quot;, sys.argv)
print(&quot;Environment isolated:&quot;, &quot;-E&quot; in sys.flags)
</code></pre>
<p>Here&#x27;s the executable it put in my virtual environment:</p>
<pre><code>#!/Users/crmarsh/workspace/uv/.venv/bin/python
import sys
print(&quot;Python executable:&quot;, sys.executable)
print(&quot;Arguments:&quot;, sys.argv)
print(&quot;Environment isolated:&quot;, &quot;-E&quot; in sys.flags)
</code></pre>
<p>Your comment suggests that pip retains these, but it looks like it doesn&#x27;t?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-09 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-09 14:43</div>
            <div class="timeline-body"><p>I&#x27;ve confirmed from the code that pip drops them, so going to do the same here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-09 15:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:18 UTC
    </footer>
</body>
</html>
