```yaml
number: 4139
title: Packages without source dists break universal resolver
type: issue
state: closed
author: konstin
labels:
  - resolver
  - preview
assignees: []
created_at: 2024-06-07T18:00:50Z
updated_at: 2024-06-10T12:38:22Z
url: https://github.com/astral-sh/uv/issues/4139
synced_at: 2026-01-10T01:57:09Z
```

# Packages without source dists break universal resolver

---

_Issue opened by @konstin on 2024-06-07 18:00_

Consider a project with one of the following requirements, where the host linux and `tensorflow-macos` has only mac os wheels and no source dist, i.e. it is only installable on mac os. 
1. `tensorflow-macos==2.16.1`
2. `tensorflow-macos==2.16.1; platform_system == "Darwin"`
3. `tensorflow-macos==2.16.1; platform_system == "Linux"`

Option 1 currently fails:

```
  x No solution found when resolving dependencies:
  `-> Because the requested Python version (>=3.8) does not satisfy Python>=3.9 and tensorflow-macos==2.16.1 depends on Python>=3.9, we can conclude that
      tensorflow-macos==2.16.1 cannot be used.
      And because foo==1.0.0 depends on tensorflow-macos==2.16.1, we can conclude that foo==1.0.0 cannot be used.
      And because only foo==1.0.0 is available and foo depends on foo, we can conclude that the requirements are unsatisfiable.

      hint: The `Requires-Python` requirement (>=3.8) defined in your `pyproject.toml` includes Python versions that are not supported by your dependencies (e.g.,        
      tensorflow-macos==2.16.1 only supports >=3.9). Consider using a more restrictive `Requires-Python` requirement (like >=3.9).
```

So does option 2 and 3:
```
  x No solution found when resolving dependencies:
  `-> Because the requested Python version (>=3.8) does not satisfy Python>=3.9 and tensorflow-macos{platform_system == 'Darwin'}==2.16.1 depends on Python>=3.9, we can
      conclude that tensorflow-macos{platform_system == 'Darwin'}==2.16.1 cannot be used.
      And because foo==1.0.0 depends on tensorflow-macos{platform_system == 'Darwin'}==2.16.1, we can conclude that foo==1.0.0 cannot be used.
      And because only foo==1.0.0 is available and foo depends on foo, we can conclude that the requirements are unsatisfiable.

      hint: The `Requires-Python` requirement (>=3.8) defined in your `pyproject.toml` includes Python versions that are not supported by your dependencies (e.g.,        
      tensorflow-macos{platform_system == 'Darwin'}==2.16.1 only supports >=3.9). Consider using a more restrictive `Requires-Python` requirement (like >=3.9).
```

Option 1 failing on linux is fine, unless we require that a non-installing target should be able to lock. Option 2 failing is a problem: This is a mac-only dep, it should not break linux or universal wheels! We know that there a wheels that work on macos, so the macos side of things should resolve. Option 3 failing could be considered a feature, because this can never install (there is no platform that is both a linux system and supports mac tags).

One option at solving this would be dropping the solve time tag check and doing only an install time check. This would remove backpropagation from wheels with unsupported to wheels with supported tags, otoh tags are usually not a version-to-version difference in that different version support different tags but a per-package property where certain packages are platform specific, such as tensorflow-macos is mac os only and pywin32 is windows only (and doesn't build on linux).

---

_Label `resolver` added by @konstin on 2024-06-07 18:01_

---

_Label `preview` added by @konstin on 2024-06-07 18:01_

---

_Comment by @charliermarsh on 2024-06-07 18:06_

I think the only option really is to ignore tags are solve time.

---

_Comment by @konstin on 2024-06-07 18:13_

I'm pretty sure that's what poetry does too

---

_Assigned to @charliermarsh by @charliermarsh on 2024-06-09 17:42_

---

_Comment by @charliermarsh on 2024-06-09 19:14_

I can give it a shot.

---

_Comment by @charliermarsh on 2024-06-09 19:15_

I think there's a possible improvement here, like... if we know we're in a branch that only supports macOS, ensure that there's _at least one_ macOS-compliant wheel. But I don't know how to formalize that.

---

_Referenced in [astral-sh/uv#4174](../../astral-sh/uv/pulls/4174.md) on 2024-06-09 23:24_

---

_Closed by @charliermarsh on 2024-06-10 12:38_

---
