<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[workspace] `uv run --with=git+workspace` fails with `Build backend failed to determine requirements` - astral-sh/uv #9301</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[workspace] <code>uv run --with=git+workspace</code> fails with <code>Build backend failed to determine requirements</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9301">#9301</a>
        opened by <a href="https://github.com/PhilipVinc">@PhilipVinc</a>
        on 2024-11-21 00:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/PhilipVinc">@PhilipVinc</a> on 2024-11-21 00:48</div>
            <div class="timeline-body"><p>See the error below.</p>
<p>I'm unsure what the error means</p>
<pre><code class="language-python">❯ uv run --with git+https://github.com/PhilipVinc/uvtest2 python
 Updated https://github.com/PhilipVinc/uvtest2 (d5efb81)
   Built netket @ git+https://github.com/PhilipVinc/uvtest2@d5efb812fbf0dd2a1c7cc23802a003bdc1b08409#subdirectory=external/netket
   Built netket-checkpoint @ git+https://github.com/PhilipVinc/uvtest2@d5efb812fbf0dd2a1c7cc23802a003bdc1b08409#subdirectory=packages/netket_checkpoint
   Built deepnets @ git+https://github.com/PhilipVinc/uvtest2@d5efb812fbf0dd2a1c7cc23802a003bdc1b08409#subdirectory=packages/deepnets
   Built netket-pro @ git+https://github.com/PhilipVinc/uvtest2@d5efb812fbf0dd2a1c7cc23802a003bdc1b08409#subdirectory=packages/netket_pro
  × Failed to download and build `omnia @ git+https://github.com/PhilipVinc/uvtest2@d5efb812fbf0dd2a1c7cc23802a003bdc1b08409`
  ╰─▶ Build backend failed to determine requirements with `build_wheel()` (exit status: 1)

      [stderr]
      error: Multiple top-level packages discovered in a flat-layout: ['config', 'packages', 'external', 'containers'].

      To avoid accidental inclusion of unwanted files or directories,
      setuptools will not proceed with this build.

      If you are trying to create a single distribution with multiple packages
      on purpose, you should not rely on automatic discovery.
      Instead, consider the following options:

      1. set up custom discovery (`find` directive with `include` or `exclude`)
      2. use a `src-layout`
      3. explicitly set `py_modules` or `packages` with a list of names

      To find more information, look for &quot;package discovery&quot; on setuptools docs.

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 04:28</div>
            <div class="timeline-body"><p>This appears to be a setuptools error. It's not specific to uv. Is your project structured properly? Can you build it with <code>python -m build</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-21 04:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PhilipVinc">@PhilipVinc</a> on 2024-11-21 10:49</div>
            <div class="timeline-body"><p>I am trying to add a workspace as a dependency to a project. This works locally, but it does not work if I add it from git.</p>
<p>Compare</p>
<pre><code class="language-bash"># This works
git clone https://github.com/PhilipVinc/uvtest2
mkdir test &amp;&amp; cd test
uv init
uv add ../uvtest2
</code></pre>
<p>against</p>
<pre><code class="language-bash">mkdir test2 &amp;&amp; cd test2
uv init
uv add git+https://github.com/PhilipVinc/uvtest2
</code></pre>
<p>which fails with the error above</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PhilipVinc">@PhilipVinc</a> on 2024-11-21 10:49</div>
            <div class="timeline-body"><p>I cannot build the project because it's a workspace, not a python package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-22 03:12</div>
            <div class="timeline-body"><p>Yeah, I don't know if this should work. We respect &quot;virtual projects&quot; (or non-package projects) locally, in workspaces, but I don't think we can treat arbitrary dependencies that way. It would break any (real) package that relies on an implicit build backend.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PhilipVinc">@PhilipVinc</a> on 2024-11-23 17:08</div>
            <div class="timeline-body"><p>@charliermarsh  I'm not sure I understand what an implicit build backend is...</p>
<p>Overall, I think it's confusing that you can add a local workspace but you cannot add it from git as a dependency. And off the top of my head I see no reason why that should not work.</p>
<p>Is there some way I could convince you that this is reasonable? Could you elaborate on what makes you doubt this could work? A uv workspace cannot be built (does not declare a <code>build-system</code> in pyproject.toml). If there is no <code>setup.py</code>, there is no way this project can be built, so if <code>uv.project</code> is dexlared I see no other way that this could be treated?</p>
<p>--</p>
<p>The reason I wanted to use this is because if we have a workspace which we use as a workspace for ML projects, when using it in production we want to declare the dependency on it. This bypasses the need to package it or to setup containers (which in HPC we cannot use).
uv would make it very easy to run a file in the workspace as <code>uv run --with git+https://ourrepo/ file.py</code> or more generally just add it as a dependency.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:49 UTC
    </footer>
</body>
</html>
