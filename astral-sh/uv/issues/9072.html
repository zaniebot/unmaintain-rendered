<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv init needlessly tries to discover a venv - astral-sh/uv #9072</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv init needlessly tries to discover a venv</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9072">#9072</a>
        opened by <a href="https://github.com/rdaysky">@rdaysky</a>
        on 2024-11-12 23:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rdaysky">@rdaysky</a></div>
            <div class="timeline-body"><p>The existence of a directory named <code>.venv</code> in an ancestor of the current directory seems to influence the behavior of <code>uv init</code>. In particular, it will look for the version of Python installed in it and put it into requires-python. This is problematic because:</p>
<ol>
<li>By definition, uv init is going to create a new project which will define, in its own pyproject.toml, what it wants from the environment it’s going to run in. That some other thing that resides in a parent directory happened to configure its own venv in a particular way is irrelevant.</li>
<li>The directory named <code>.venv</code> isn’t necessarily a fully-functional virtual environment. If it was created within a Docker container and became visible to the host because of a volume mount, the symlinks inside will likely appear to be broken and <code>uv init</code> will fail entirely. Or maybe the user has a ~/.venv directory that’s just a container for various venvs and is not a venv itself.</li>
<li>There doesn’t seem to be a switch to disable this discovery.</li>
<li>It’s undocumented.</li>
</ol>
<p>Given that uv can install Python like any other package, is there any reason not to follow the same process as with any other package and put the latest version into requires-python, ignoring all .venv directories, at least for <code>--app</code>? (<code>--lib</code>s in general require permissive versioning so there should be some heuristic about what to put into requires-python, but that’s a different question.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-11-12 23:46</div>
            <div class="timeline-body"><p>This is maybe similar to issue #8092</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-13 01:08</div>
            <div class="timeline-body"><p>I think this sounds like a bug, as-in, we should not read from virtual environments when finding an interpreter for <code>uv init</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-11-13 01:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-11-13 03:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:19 UTC
    </footer>
</body>
</html>
