```yaml
number: 3358
title: "universal-lock: implement resolver forking"
type: issue
state: closed
author: BurntSushi
labels:
  - preview
assignees: []
created_at: 2024-05-03T18:09:32Z
updated_at: 2024-05-30T18:23:15Z
url: https://github.com/astral-sh/uv/issues/3358
synced_at: 2026-01-10T01:57:07Z
```

# universal-lock: implement resolver forking

---

_Issue opened by @BurntSushi on 2024-05-03 18:09_

This is blocked on #3354 and #3355. It's part of the larger task of #3350.

Implementing forking requires detecting when there are multiple direct dependencies leading to different versions of the same package. In effect, instead of getting just a single list of dependencies, as we do here:

https://github.com/astral-sh/uv/blob/e33ff95575e8165078799548070210947d1cfad0/crates/uv-resolver/src/resolver/mod.rs#L794-L800

We will get a list of lists of dependencies. This can be seen in my prototype:

https://github.com/astral-sh/uv/blob/7f2b401260e6231bebb867c034b27d2955210fe0/crates/uv-resolver/src/resolver/mod.rs#L835-L894

We should be careful to ensure that we only fork when the conflicting packages have non-overlapping versions _and_ non-overlapping marker expressions.

---

_Label `preview` added by @BurntSushi on 2024-05-03 18:09_

---

_Referenced in [astral-sh/uv#3350](../../astral-sh/uv/issues/3350.md) on 2024-05-03 18:09_

---

_Referenced in [astral-sh/uv#3831](../../astral-sh/uv/pulls/3831.md) on 2024-05-24 19:04_

---

_Closed by @BurntSushi on 2024-05-30 18:23_

---
