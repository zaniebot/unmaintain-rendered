<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>specify minimum uv version in pyproject.toml - astral-sh/uv #8605</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>specify minimum uv version in pyproject.toml</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8605">#8605</a>
        opened by <a href="https://github.com/sebhoss">@sebhoss</a>
        on 2024-10-27 10:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sebhoss">@sebhoss</a> on 2024-10-27 10:26</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>I recently noticed that the list of available python versions is hardcoded in uv and thus depends on the version of <code>uv</code> used. One of my colleagues was using an older version of <code>uv</code> and could not install python 3.13 without updating <code>uv</code> first. While updating <code>uv</code> is not a problem, I wish that there was a way to specify a minimum required version for <code>uv</code> itself when working on a project. I think this would improve developer experience because he would immediately have updated <code>uv</code> instead of debugging why the latest python version cannot be downloaded.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2024-10-27 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @zanieb on 2024-10-27 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8636.html">astral-sh/uv#8636</a> on 2024-10-28 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8718.html">astral-sh/uv#8718</a> on 2024-10-31 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8823.html">astral-sh/uv#8823</a> on 2024-11-05 11:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-11-19 06:59</div>
            <div class="timeline-body"><p>Just to summarize some of the thinking from the duplicates, more generally we are wanting to set <em>constraints</em> on the version of <code>uv</code>, similar to how <code>project.requires-python</code> sets constraints on the version of Python.</p>
<p>Aside from a lower bound, I think the most useful constraint would be pinning/equality. I see limited value in upper bounds.</p>
<p>Pinning is useful in a CI pipeline to make sure breaking changes in <code>uv</code> don't break a deployment, etc. So for example, in the <a href="https://github.com/astral-sh/setup-uv">setup-uv</a> GitHub Action (or other CI config), you can pin a version of <code>uv</code>. But then there can be inconsistencies between the developer's local <code>uv</code> version and the one used on CI (or different developer's local <code>uv</code> versions for that matter).</p>
<p>I personally had this situation recently in my organization with the release of v0.5.0 - a whole lot of pipelines failed. Pinning would have prevented this, which is what we're doing now. But now we need a hacky script which re-downloads a hard-coded version of <code>uv</code> per project - or some other workaround. If we could specify the version of <code>uv</code> in <code>pyproject.toml</code>, then this could be avoided.</p>
<p>A similar situation exists in regard to <a href="https://github.com/astral-sh/uv-pre-commit">pre-commit-uv</a>; you need to pin a version of <code>uv</code>. Actually, you're pinning the version of <code>pre-commit-uv</code> which is synchronized with <code>uv</code> itself. In any case, this introduces a similar issue where passing pre-commit depends on using the same version of <code>uv</code> as the one pinned in the pre-commit config. In addition, there is a similar issue to the one discussed at https://github.com/astral-sh/uv-pre-commit/issues/23, where the version of e.g. <code>ruff</code> needs to be synchronized between the virtual environment and the pre-commit config. In this case, the user's installed uv version can mismatch with the one used by pre-commit. This could potentially be solved by allowing the <code>pre-commit-uv</code> implementation to respect a pinned uv version in pyproject.toml.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dmarcoux">@dmarcoux</a> on 2024-11-19 08:37</div>
            <div class="timeline-body"><p>Regarding pinning uv's version, I have a workaround for this. Maybe in the meantime this can help others, so here's how I do it.</p>
<p>In my git repository, I track uv's version in the file <code>.uv-version</code>, like <a href="https://github.com/dmarcoux/sports_tracker/blob/cf5288dc303df44536e840fe49b288d85e1dae6c/.uv-version">this</a>. I generate this file when my development environment is started with this command <code>uv version | cut --delimiter=' ' --fields=2 &gt; .uv-version</code>. So this file is updated whenever I update the <code>uv</code> package. It's less error-prone since I don't have to remember to manually update the file <code>.uv-version</code>, it's just a matter of committing/pushing changes whenever I see them with <code>git status</code>.</p>
<p>As for continuous integration, this is how I pin uv's version with GitHub Actions:</p>
<pre><code class="language-yml">(...)

jobs:
  continuous_integration:
    name: Continuous integration
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Fetch uv's version from .uv-version
        id: uv-version
        run: echo &quot;uv-version=$(cat .uv-version)&quot; &gt;&gt; &quot;$GITHUB_OUTPUT&quot;

      - name: Install uv with the version in .uv-version
        uses: astral-sh/setup-uv@v3
        with:
          version: ${{ steps.uv-version.outputs.uv-version }}
          enable-cache: true

(...)
</code></pre>
<p>You can see the whole workflow <a href="https://github.com/dmarcoux/sports_tracker/blob/cf5288dc303df44536e840fe49b288d85e1dae6c/.github/workflows/continuous_integration.yml">here</a>.</p>
<p>Let me know if something isn't clear.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sebhoss">@sebhoss</a> on 2024-11-22 15:27</div>
            <div class="timeline-body"><p>Just thinking out loud: What if <code>uv</code> somehow knows which version of itself introduced a certain feature? It could use that information to automatically calculate the minimal required <code>uv</code> version based on the features used in the current project and save the result in <code>uv.lock</code> right next to the required python version.</p>
<p>Users could then run something like <code>uv pin python 3.13</code> and <code>uv</code> would automatically change the minimal required version to the version that first added python 3.13 support. Depending on how well this works, maybe there is no need for a new field in pyproject.toml at all?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-11-22 17:10</div>
            <div class="timeline-body"><p>@sebhoss I think you are describing a way to infer a lower bound based on project file contents. The issue with this is that the intended uv behaviour on a project can be <em>implicit</em> - e.g. we might be relying on a new environment variable provided in the latest version of uv, which earlier versions would ignore.</p>
<p>This goes in both directions - there might be a new default incoming in the latest version of uv which I <em>don't</em> want, so I'd want an upper bound to protect from breaking changes.</p>
<p>Another similar issue: I think this would require older versions of uv to identify the presence of future versions' features. Perhaps one could use heuristics like unrecognized <code>[tool.uv]</code> fields but in any case this would probably need to be backported functionality? Which I think is out of the question.</p>
<p>I think any solution would need to deal with the complexity of actually <em>complying</em> with the bounds (inferred or otherwise)- what should uv do in the situation where uv has the 'wrong' version? Probably there needs to be some uv installation cache to allow switching between uv versions without re-downloading.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sebhoss">@sebhoss</a> on 2024-11-22 17:27</div>
            <div class="timeline-body"><p>@nathanjmcdougall yeah agreed on all points. I was just a concerned that introducing yet another version might make simple things like switching to a newer python version more annoying than it should be, e.g. consider:</p>
<ol>
<li>Update <code>project.requires-python</code> version in pyproject.toml first so that it includes the python version you want</li>
<li>Update <code>project.requires-uv</code> (or whatever the name will be) to require a version of <code>uv</code> that supports the wanted python version</li>
<li>Update <code>.python-version</code> file to finally get the new python version</li>
</ol>
<p>That said, I don't really want to derail the conversation here and I think usability improvements can be made after introducing version constraints for <code>uv</code> itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-31 03:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10248.html">astral-sh/uv#10248</a> on 2024-12-31 03:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-31 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/setup-uv/issues/215.html">astral-sh/setup-uv#215</a> on 2025-01-03 11:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:23 UTC
    </footer>
</body>
</html>
