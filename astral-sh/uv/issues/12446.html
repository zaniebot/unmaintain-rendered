<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinning build dependencies such as `setuptools` in `uv.lock` - astral-sh/uv #12446</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Pinning build dependencies such as <code>setuptools</code> in <code>uv.lock</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12446">#12446</a>
        opened by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a>
        on 2025-03-24 19:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a> on 2025-03-24 19:06</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Currently, the <code>uv.lock</code> file specifies the exact versions and binary hashes for all direct and indirect dependencies.</p>
<p>But apparently not the build dependencies. So executing <code>uv sync</code> on different machines, or at different times, may result in different builds, depending on the actual build dependencies used.</p>
<p>Current example: <a href="https://setuptools.pypa.io/en/stable/history.html#v78-0-0">recent changes in setuptools </a> broke a number of builds, see e.g. https://github.com/astral-sh/uv/issues/12434 https://github.com/astral-sh/uv/issues/12440</p>
<ul>
<li><strong>note</strong>: workarounds for that specific problem with setuptools are discussed in #12440</li>
</ul>
<p>If the specific version of setuptools was pinned in uv.lock, the build would be more reproducible, failing only if setuptools is upgraded, same as any other dependency</p>
<h3>Example</h3>
<ul>
<li><p><code>uv sync</code> would always use the version of build dependencies specified in <code>uv.lock</code>, similar to other dependencies</p>
</li>
<li><p><code>uv sync --upgrade</code> would update all dependencies, including build dependencies</p>
</li>
<li><p><code>uv sync --upgrade-package setuptools</code> would update specific build dependencies</p>
</li>
<li><p>a new switch <code>uv sync --upgrade-build-dependencies</code> could be defined, to update all build dependencies</p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @Ben-grmbl on 2025-03-24 19:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-24 19:16</div>
            <div class="timeline-body"><p>We definitely want to support for this, it's on the short-term roadmap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Job-Heersink">@Job-Heersink</a> on 2025-03-24 19:25</div>
            <div class="timeline-body"><p>Currently our builds are failing due to a recent update in setuptools. As @Ben-grmbl mentioned, there is currently no way to specify the version of build dependencies in <code>uv.lock</code>.</p>
<p>Is there a known workaround for uv or is the only solution to go back to pip?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a> on 2025-03-24 19:44</div>
            <div class="timeline-body"><blockquote>
<p>Is there a known workaround for uv or is the only solution to go back to pip?</p>
</blockquote>
<p>Workarounds for the current issue with setuptools are discussed in https://github.com/astral-sh/uv/issues/12440 (<code>--exclude-newer </code> should work)</p>
<p>I think that pinning these dependencies has been a bit of a sticky spot for all package managers, including pip, poetry, uv, see e.g.</p>
<ul>
<li>https://discuss.python.org/t/no-way-to-pin-build-dependencies/29833</li>
<li>https://discuss.python.org/t/pinning-build-dependencies/8363</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex">@alex</a> on 2025-03-25 01:12</div>
            <div class="timeline-body"><p>I believe this is the same issue as https://github.com/astral-sh/uv/issues/7052</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-03-25 01:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-25 01:49</div>
            <div class="timeline-body"><p>Thanks! Couldn't find that one :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ben-grmbl">@Ben-grmbl</a> on 2025-03-25 11:17</div>
            <div class="timeline-body"><p>@charliermarsh I don't think this issue is a duplicate of https://github.com/astral-sh/uv/issues/7052</p>
<p>If I understand this correctly, that issue deals with generating a requirements.txt file that contains the versions for build dependencies, via <code>uv pip compile</code></p>
<ul>
<li>so <code>uv pip compile ...</code> --&gt; a requirements-[...].txt is generated, that contains current build dependency versions.</li>
</ul>
<p>My request here would be to</p>
<ul>
<li>write build dependency versions <em>and hashes</em> in the <code>uv.lock</code> file, after every <code>uv sync</code></li>
<li>and to <em>re-use</em> those same build dependencies the next time <code>uv sync</code> is called.</li>
<li>(I do not use <code>uv pip</code> currently, a requirements.txt file would not help me.)</li>
</ul>
<p>So the issues seem related but distinct.</p>
<p>Could I ask that this issue is reopened? Perhaps I can clarify my feature request some more to make it more clear.</p>
<p>Or should I write my use case as a comment into the other issue instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-25 12:48</div>
            <div class="timeline-body"><p>Yeah, that issue covers both uv.lock and uv pip compile.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:58 UTC
    </footer>
</body>
</html>
