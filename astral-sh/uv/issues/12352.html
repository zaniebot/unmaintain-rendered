<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv build` tries to build even though `tool.uv.package` is False - astral-sh/uv #12352</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv build</code> tries to build even though <code>tool.uv.package</code> is False</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12352">#12352</a>
        opened by <a href="https://github.com/gregglind">@gregglind</a>
        on 2025-03-20 22:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gregglind">@gregglind</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<h3>Observed:</h3>
<ol>
<li><code>pyproject</code> with tool.uv.package = false</li>
<li><code>uv build</code> will attempt to build</li>
</ol>
<blockquote>
<p>Building source distribution...
error: Multiple top-level packages discovered in a flat-layout: [....</p>
</blockquote>
<h3>Expected</h3>
<p>Exit success with a warning that it can't build packages if tool.uv.package = false.</p>
<p>https://docs.astral.sh/uv/concepts/projects/config/#project-packaging,</p>
<blockquote>
<p>Setting tool.uv.package = false will force a project package not to be built and installed into the project environment. uv will ignore a declared build system when interacting with the project</p>
</blockquote>
<h3>Use Case</h3>
<ol>
<li>Roots of monorepos support <em>some</em> uv actions (<code>sync</code> <code>add</code>) but not others (<code>build</code>).</li>
</ol>
<h3>Related:</h3>
<p>https://github.com/astral-sh/uv/issues/10204</p>
<h3>Platform</h3>
<p>mac os arm64</p>
<h3>Version</h3>
<p>uv 0.6.8 (Homebrew 2025-03-18)</p>
<h3>Python version</h3>
<p>Python 3.13.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @gregglind on 2025-03-20 22:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-20 22:38</div>
            <div class="timeline-body"><p><code>tool.uv.package</code> is intended to toggle implicit builds, like during <code>uv sync</code> and <code>uv run</code> â€” <code>uv build</code> is an explicit attempt to build the project and will ignore this flag as the command otherwise would do nothing. We could add a warning or improve the error message, but this is &quot;working as intended&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @zanieb on 2025-03-20 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-03-20 22:38</div>
            <div class="timeline-body"><p>cc @konstin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pizkaz">@pizkaz</a> on 2025-03-31 15:01</div>
            <div class="timeline-body"><p>We just bumped into this as well using <a href="https://github.com/pyproject-nix/uv2nix">uv2nix</a> to manage dependencies for a &quot;non-package&quot; python project (or rather: environment).</p>
<p>For anyone running into the same problem: Adding the following section to <code>pyproject.toml</code> did the job for us:</p>
<pre><code class="language-toml">[tool.setuptools]
py-modules = []
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gregglind">@gregglind</a> on 2025-03-31 15:37</div>
            <div class="timeline-body"><p>Solution (alternative):</p>
<ul>
<li>My way of tackling it was to use a yaml checker for that field before the process that calls <code>uv build</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gregglind">@gregglind</a> on 2025-03-31 15:41</div>
            <div class="timeline-body"><p>Re: improvements to the error message.</p>
<p>I learned something from this discussion:  the concepts of <strong>implicit</strong> and <strong>explicit</strong> builds or installs.</p>
<p>I was mostly led astray by the docs mentioned in the initial report.  Perhaps, add</p>
<p>&quot;Note:  the setting only affects implicit builds.  Explicitly calling<code>uv build</code> will attempt to build the package.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-01 20:50</div>
            <div class="timeline-body"><p>Added in https://github.com/astral-sh/uv/pull/12608</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-02 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-02 13:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:33 UTC
    </footer>
</body>
</html>
