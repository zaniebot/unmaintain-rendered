```yaml
number: 13056
title: "Bug Report: uv ignores --offline flag with git+ssh dependencies"
type: issue
state: closed
author: Rukopet
labels:
  - needs-mre
assignees: []
created_at: 2025-04-22T17:23:36Z
updated_at: 2025-04-30T14:43:31Z
url: https://github.com/astral-sh/uv/issues/13056
synced_at: 2026-01-10T01:57:29Z
```

# Bug Report: uv ignores --offline flag with git+ssh dependencies

---

_Issue opened by @Rukopet on 2025-04-22 17:23_

## Description
When running `uv lock --check --offline` on a project that contains git+ssh dependencies, uv still attempts to fetch from remote Git repositories despite the `--offline` flag. This results in failed checks in environments without network access or in CI/CD pipelines that should run offline.

## Reproduction Steps
1. Create a project with git+ssh dependencies in pyproject.toml:
   ```toml
   [project]
   dependencies = [
       "some-package @ git+ssh://git@example.com/org/repo.git@commit-hash"
   ]
   ```
2. Generate a uv.lock file
3. Run `uv lock --check --offline`

## Expected Behavior
When `--offline` is specified, uv should check the lockfile's integrity using only local data, without attempting to contact remote Git repositories or package indexes.

## Actual Behavior
Despite the `--offline` flag, uv still attempts to fetch the git repository:
```
   Updating ssh://git@example.com/org/repo.git (commit-hash)
⠙ Resolving dependencies...                                                       
× Failed to download and build `package-name @ git+ssh://git@example.com/org/repo.git@commit-hash`
  ├─▶ Git operation failed
  ├─▶ failed to fetch into: /path/to/cache
  ├─▶ failed to fetch commit `commit-hash`
  ╰─▶ process didn't exit successfully:
      `/path/to/git fetch --force --update-head-ok 'ssh://git@example.com/org/repo.git' '+commit-hash:refs/commit/commit-hash'`
      (exit status: 128)
      --- stderr
      fatal: not a git repository (or any of the parent directories): .git
```

## Impact
This bug breaks CI/CD pipelines and pre-commit hooks that need to operate in offline mode, especially in environments with git+ssh dependencies.


No workarounds were founded

### Platform

Darwin 24.4.0 arm64

### Version

uv 0.6.16 (d8ad9d3cd 2025-04-22)

### Python version

Python 3.11.11

---

_Label `bug` added by @Rukopet on 2025-04-22 17:23_

---

_Comment by @charliermarsh on 2025-04-25 01:53_

Hmm, I can't reproduce that -- I don't see the flag being ignored:

```
❯ uv sync --cache-dir baz --offline
Resolved 2 packages in 1ms
   Updating ssh://git@github.com/pytest-dev/iniconfig.git (HEAD)                                                                                                                                                                                × Failed to download and build `iniconfig @ git+ssh://git@github.com/pytest-dev/iniconfig.git@71901257f6cbf660e77b1077e00f11a0f440be1e`
  ├─▶ Git operation failed
  ├─▶ failed to clone into: baz/git-v0/db/b434d4698eccd5c0
  ├─▶ failed to fetch commit `71901257f6cbf660e77b1077e00f11a0f440be1e`
  ╰─▶ Remote Git fetches are not allowed because network connectivity is disabled (i.e., with `--offline`)
  help: `iniconfig` was included because `foo` (v0.1.0) depends on `iniconfig`
```


---

_Label `bug` removed by @charliermarsh on 2025-04-25 01:53_

---

_Label `needs-mre` added by @charliermarsh on 2025-04-25 01:53_

---

_Comment by @Rukopet on 2025-04-30 14:43_

@charliermarsh It's very interesting, because I can't reproduce it now too.

---

_Closed by @Rukopet on 2025-04-30 14:43_

---
