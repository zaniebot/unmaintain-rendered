<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv tool upgrade does not authenticate against GitLab private pypi package registry - astral-sh/uv #14806</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv tool upgrade does not authenticate against GitLab private pypi package registry</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14806">#14806</a>
        opened by <a href="https://github.com/lgatellier">@lgatellier</a>
        on 2025-07-22 08:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lgatellier">@lgatellier</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi,</p>
<p>I have a CLI package <code>myapp</code> published on a self-hosted GitLab Package Registry. The GitLab project hosting the package has <strong>Private</strong> visibility : you must authenticate to access the project's package registry.</p>
<p>Here is my <code>uv.toml</code> config file :</p>
<pre><code class="language-toml">native-tls = true

[[index]]
url = &quot;https://gitlab-deploy-token:my-gitlab-deploy-token-value@gitlab.mycompany.com/api/v4/projects/1234/packages/pypi/simple&quot;
ignore-error-codes = [401] # Necessary for uv to detect new pacakge versions from my GitLab package repository

[[index]]
url = &quot;https://mirror.mycompany.com/repository/pypi.python.org/simple&quot;
default = true
</code></pre>
<p>When I use <code>uv tool install myapp</code> command, it properly installs the <code>myapp</code> package.</p>
<p>When I try to upgrade the tool to a newly released version with <code>uv tool upgrade myapp</code>, I get this error :</p>
<blockquote>
<p>error: Failed to upgrade myapp
Caused by: Failed to fetch: <code>https://gitlab.mycompany.com/api/v4/projects/1234/packages/pypi/files/e09e2e982ff5314c738e8f2478f6e7a656210b829bac89fc38cf127c96aee2d9/myapp-1.16.0-py3-none-any.whl</code>
Caused by: HTTP status client error (401 Unauthorized) for url (https://gitlab.mycompany.com/api/v4/projects/1234/packages/pypi/files/e09e2e982ff5314c738e8f2478f6e7a656210b829bac89fc38cf127c96aee2d9/myapp-1.16.0-py3-none-any.whl)</p>
</blockquote>
<p>What I tried :</p>
<ul>
<li><code>curl</code> this URL while being unauthenticated : I get the same 401 error</li>
<li><code>curl -u username:my-gitlab-deploy-token</code> (with HTTP Basic auth) : I'm allowed to download the <strong>whl</strong> file.</li>
<li>Configure the GitLab project's package registry to be unauthenticated : everything works fine, uv upgrades the package.</li>
</ul>
<p>The full <code>uv -vv tool upgrade myapp</code> log is in the attached <a href="https://github.com/user-attachments/files/21363765/uv-tool-upgrade.log">uv-tool-upgrade.log</a>.</p>
<p>I've read the docs about tools and index auth, but didn't find anything which could solve my problem.</p>
<p>Did I misconfigured something ? Or is this a bug ?</p>
<p>Thanks !</p>
<h3>Platform</h3>
<p>Windows 11 x86_64 WSL Ubuntu 24.04 LTS</p>
<h3>Version</h3>
<p>0.8.0</p>
<h3>Python version</h3>
<p>3.13.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @lgatellier on 2025-07-22 08:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-07-23 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-23 02:48</div>
            <div class="timeline-body"><p>Hmm, okay. The first problem I see is that we're redacting credentials in the receipt (we should be removing them entirely):</p>
<pre><code class="language-toml">[tool]
requirements = [{ name = &quot;flask&quot; }]
entrypoints = [
    { name = &quot;flask&quot;, install-path = &quot;/Users/crmarsh/.local/bin/flask&quot; },
]

[tool.options]
index = [{ url = &quot;https://public:****@pypi-proxy.fly.dev/basic-auth/simple&quot;, explicit = false, default = true, format = &quot;simple&quot;, authenticate = &quot;auto&quot; }]
</code></pre>
<p>The second problem is that we should be transferring the credentials from your <code>uv.toml</code> file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-23 03:03</div>
            <div class="timeline-body"><p>I believe I see the issues here. It is indeed a bug (or maybe two bugs), sorry about that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lgatellier">@lgatellier</a> on 2025-07-23 09:10</div>
            <div class="timeline-body"><p>Don't worry, I'll patiently wait for the bug fix(es) ðŸ˜‰</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-07-23 21:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:32:13 UTC
    </footer>
</body>
</html>
