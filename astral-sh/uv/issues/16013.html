<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to make git tagging a monorepo only build the affected workspace members in CI? - astral-sh/uv #16013</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>How to make git tagging a monorepo only build the affected workspace members in CI?</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/16013">#16013</a>
        opened by <a href="https://github.com/MartyMcFlyInTheSky">@MartyMcFlyInTheSky</a>
        on 2025-09-24 09:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MartyMcFlyInTheSky">@MartyMcFlyInTheSky</a> on 2025-09-24 09:59</div>
            <div class="timeline-body"><h3>Question</h3>
<p>We have a monorepo containing multiple packages and libs. Now when we tag the monorepo typically all of those packages are built with the commit tag version. Since this is slow we want to change it such that only the &quot;affected&quot; packages are built. This means if we make direct changes to the source code of certain packages, only those would be built and released in our gitlab registry. Similarly, if a <em>dependency</em> of A, B and C is changed, releases for A, B and C should also be built.</p>
<p>Is there a way to query uv which packages are affected with the changes of the last MR/PR and need rebuilding/relasing? (Also, someone might enlighten me about an even better way to do this...)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MartyMcFlyInTheSky on 2025-09-24 09:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-25 11:20</div>
            <div class="timeline-body"><p>There's currently no uv-native way of achieving this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ReubenVandezande">@ReubenVandezande</a> on 2025-09-30 10:17</div>
            <div class="timeline-body"><p>I use git commands to determine which packages have been modified since the last release (ie. &quot;tag&quot;). I specifically use this for automating my changelog, but this should also suffice for determining which packages have changed: no commits = no changes.
<code>get_first_commit</code> and <code>get_tag_commit</code> are other functions in the module that, well, do exactly what they say.</p>
<pre><code class="language-python">
def get_release_entries(
    release_tags: list[str], location: str | Path, *, generate_all: bool = False
) -&gt; list[str]:
    &quot;&quot;&quot;Retrieve log entries (commits) between release tags for a given location.

    Parameters
    ----------
    release_tags : list[str]
        A list of known release tags.
    location : str | Path
        The path to the package or project location.
    generate_all : bool, optional
        If True, generates entries for all commits, not just since the last release, by default False.

    Returns
    -------
    list[str]
        All commit messages for commits between now and the last release
    &quot;&quot;&quot;
    previous_release_commit = (
        get_first_commit() if not release_tags or generate_all else get_tag_commit(release_tags[-1])
    )
    delimiter = &quot;|-|&quot;
    git_command = [
        &quot;git&quot;,
        &quot;--no-pager&quot;,
        &quot;log&quot;,
        &quot;--oneline&quot;,
        f&quot;--format=%H{delimiter}%s{delimiter}\n%(trailers)%-C()&quot;,
        f&quot;{previous_release_commit}..HEAD&quot;,
        &quot;--&quot;,
        f&quot;{location!s}&quot;,
    ]

    return subprocess.run(git_command, check=True, text=True, capture_output=True).stdout
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Spenhouet">@Spenhouet</a> on 2025-10-25 09:30</div>
            <div class="timeline-body"><p>Maybe this helps: https://github.com/astral-sh/uv/issues/6356#issuecomment-2983217371</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
