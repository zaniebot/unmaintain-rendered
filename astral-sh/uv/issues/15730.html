<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source used over default index even when not specified explicitly - astral-sh/uv #15730</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Source used over default index even when not specified explicitly</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15730">#15730</a>
        opened by <a href="https://github.com/befelix">@befelix</a>
        on 2025-09-08 07:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/befelix">@befelix</a> on 2025-09-08 07:27</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm not 100% sure this is a bug, but if not I would appreciate a hint on how to resolve the situation:</p>
<p>In the following <code>pyproject.toml</code> file, <code>torch</code> is both a main dependency and a dependency-group. For the dependency group, the index is pinned to the cuda wheels, while it is left unspecified otherwise. My expectation would be that, without the <code>cuda</code> group, the default index is used. However, running <code>uv sync</code> on a Mac will yield an error that a compatible release can't be found on the <code>cu128</code> mirror, even though it is available on the default pypi mirror.</p>
<p><code>uv sync</code> (mac)</p>
<pre><code>error: Distribution `torch==2.8.0+cu128 @ registry+https://download.pytorch.org/whl/cu128` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're on macOS (`macosx_15_0_arm64`), but `torch` (v2.8.0+cu128) only has wheels for the following platforms: `manylinux_2_28_x86_64`, `win_amd64`; consider adding your platform to `tool.uv.required-environments` to ensure uv resolves to a version with compatible wheels
</code></pre>
<p><code>pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.12.0&quot;
dependencies = [&quot;torch&quot;]

[dependency-groups]
cuda = [&quot;torch&gt;=2.5.0&quot;]

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cu128&quot;, group = &quot;cuda&quot; },
]

[[tool.uv.index]]
name = &quot;pytorch-cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true
</code></pre>
<h3>Platform</h3>
<p>macOS</p>
<h3>Version</h3>
<p>uv 0.8.15 (8473ecba1 2025-09-03)</p>
<h3>Python version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @befelix on 2025-09-08 07:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jakubbortlik">@jakubbortlik</a> on 2025-09-08 13:48</div>
            <div class="timeline-body"><p>I seem to be having a similar problem: When in my <code>pyproject.toml</code> i update one of our dependencies which is taken from an index with <code>explicit = true</code> and I run <code>uv sync</code>, suddenly all of the dependencies are updated in the <code>uv.lock</code> so that instead of <code>source = { registry = &quot;https://pypi.org/simple&quot; }</code> they link to the internal index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-08 13:49</div>
            <div class="timeline-body"><p>@jakubbortlik -- This sounds unrelated, can you please open a separate issue with a clear reproduction?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-09-08 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-08 14:58</div>
            <div class="timeline-body"><p>I also expect this to behave the way you describe, will look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jakubbortlik">@jakubbortlik</a> on 2025-09-08 15:11</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/jakubbortlik">@jakubbortlik</a> -- This sounds unrelated, can you please open a separate issue with a clear reproduction?</p>
</blockquote>
<p>I'm sorry, I didn't read the issue description carefully. I'll open a separate issue if I don't find a solution. Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-08 17:52</div>
            <div class="timeline-body"><p>Here's the lockfile: https://gist.github.com/zanieb/e94d8db90c99b75c25dec943492cfec1#file-uv-lock
and logs: https://gist.github.com/zanieb/e94d8db90c99b75c25dec943492cfec1#file-logs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Aleph-Alpha-Research/eval-framework/pulls/61.html">Aleph-Alpha-Research/eval-framework#61</a> on 2025-09-10 08:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
