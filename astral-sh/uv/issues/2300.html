<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv hangs on install - astral-sh/uv #2300</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv hangs on install</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2300">#2300</a>
        opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a>
        on 2024-03-08 10:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-08 10:04</div>
            <div class="timeline-body"><p>uv hangs on various installs for me. The hangs are weirdly deterministic, except for when I really want them to be deterministic and then they stop being so. Anyway, I've got it down to something small that repros reasonably often. The full unminimised case with like 1000 packages always hangs.</p>
<p>In the official Python 3.11 docker image, with <code>uv --version</code> equal to <code>uv 0.1.16</code>, run the following:</p>
<pre><code>import subprocess
from collections import Counter
def run(cmd):
    try:
        subprocess.check_call(cmd, shell=True, timeout=10)
    except Exception as e:
        return type(e)
    return None
Counter(run(&quot;uv cache clean; rm -rf .venv; uv venv; uv pip install --no-cache-dir --no-deps --compile ddtrace==2.6.2 debugpy==1.8.1 decorator==5.1.1 defusedxml==0.7.1 ecdsa==0.18.0 ecos==2.0.13 editorconfig==0.12.4 einops==0.7.0&quot;) for _ in range(10))
</code></pre>
<p>You'll see something like <code>Counter({subprocess.TimeoutExpired: 6, None: 3, subprocess.CalledProcessError: 1})</code> (and larger cases fail more reliably). The singleton crash is a spurious bytecode compilation failure, e.g.:</p>
<pre><code>error: Failed to bytecode compile /root/tmpv/.venv/lib/python3.11/site-packages
  Caused by: Bytecode compilation failed, expected &quot;/root/tmpv/.venv/lib/python3.11/site-packages/defusedxml/cElementTree.py&quot;, received: &quot;&quot;
</code></pre>
<p>You can't really reduce the set of packages further without the hangs going away, although you can get rid of <code>--compile</code> if you want</p>
<p>Anyway, uv making much more progress on installing big work environment from scratch than <a href="https://github.com/astral-sh/uv/issues/1585">last time I tried</a> :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv hangs, also bytecode compilation fails every now and then" to "uv hangs on install, also sometimes bytecode compilation fails" by @hauntsaninja on 2024-03-08 10:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @konstin on 2024-03-08 10:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-03-08 10:24</div>
            <div class="timeline-body"><p>The bytecode compilation failures look like #2245/#2278, but those should have been included in 0.1.16.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-08 10:38</div>
            <div class="timeline-body"><p>Hm, that output was from a less reproducible environment, it's possible I messed up the uv version (I had a few requirements files that contained uv so probably clobbered myself). I'd seen it a few times and so wanted to include it in the issue.</p>
<p>I haven't seen the bytecode crash in my careful docker repro, which is definitely uv 0.1.16. I'll remove the part about bytecode from the title and let you know if I see it again â€” thanks for fixing!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv hangs on install, also sometimes bytecode compilation fails" to "uv hangs on install" by @hauntsaninja on 2024-03-08 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-03-08 15:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-03-11 22:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 00:12</div>
            <div class="timeline-body"><p>I <em>think</em> I'm able to reproduce this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 00:15</div>
            <div class="timeline-body"><p>I was able to reduce it to <code>ddtrace==2.6.2 debugpy==1.8.1 ecdsa==0.18.0 editorconfig==0.12.4</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 01:39</div>
            <div class="timeline-body"><p>Don't worry, I added a bunch of debug logging and it stopped hanging :joy:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-12 01:58</div>
            <div class="timeline-body"><p>Yeah, <code>RUST_LOG=trace</code> <a href="https://discord.com/channels/1039017663004942429/1207998321562619954/1215455734444204073">was a fix for me as well</a> :D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 02:41</div>
            <div class="timeline-body"><p>I've identified the problem. I think it's specific to <code>--no-deps</code>...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 02:42</div>
            <div class="timeline-body"><p>Actually, to be more specific, I could see it manifesting without <code>--no-deps</code>, but <code>--no-deps</code> would make it way more likely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2373.html">astral-sh/uv#2373</a> on 2024-03-12 03:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-12 03:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2374.html">astral-sh/uv#2374</a> on 2024-03-12 04:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-12 04:08</div>
            <div class="timeline-body"><p>Fixed in the next release, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-03-12 06:41</div>
            <div class="timeline-body"><p>Nice, thanks for solving it!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:18 UTC
    </footer>
</body>
</html>
