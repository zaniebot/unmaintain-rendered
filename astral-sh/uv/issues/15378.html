<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broken lock file sneaks in - astral-sh/uv #15378</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Broken lock file sneaks in</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15378">#15378</a>
        opened by <a href="https://github.com/zzJinux">@zzJinux</a>
        on 2025-08-19 11:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zzJinux">@zzJinux</a> on 2025-08-19 11:25</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I happened to find a broken lock file. I only modified the dependency from <code>httpx-retries&gt;=0.4.0</code> to <code>httpx-retries&gt;=0.4.0,&lt;1.0.0</code> (<code>httpx-retries</code> was <code>0.4.0</code> in the lock file) and faced with the CI cyrout from <code>uv sync --locked</code>.</p>
<p>Investigating further, I discovered that <code>uv sync &amp;&amp; uv pip check</code>, where both commands succeeded, reports:</p>
<pre><code>The package `langfuse` requires `packaging&gt;=23.2,&lt;25.0`, but `25.0` is installed
</code></pre>
<p>I identified the revision (made by someone else) that puts the lock file into an inconsistent state. The revision adds <code>langfuse=3.2.1</code>, which conflicts with the lock file's <code>packaging=25.0</code>. It's less likely that he manually edited the lock file. The strange thing is that CI <code>uv sync --locked</code> has never complained so far, including the PR that introduced the revision.</p>
<p>I failed to devise a from-scratch example that reproduces.</p>
<h3>Platform</h3>
<p>macOS 15.6 (24G84) arm64</p>
<h3>Version</h3>
<p>uv 0.8.12 (36151df0e 2025-08-18)</p>
<h3>Python version</h3>
<p>Python 3.13.6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zzJinux on 2025-08-19 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-19 19:16</div>
            <div class="timeline-body"><p>I'm kind of confused here. Can you provide an example diff that was applied to the lockfile that was not caught by <code>uv sync --locked</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zzJinux">@zzJinux</a> on 2025-08-20 09:53</div>
            <div class="timeline-body"><p>@zanieb</p>
<pre><code class="language-diff">Index: uv.lock
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/uv.lock b/uv.lock
--- a/uv.lock	(revision aaa)
+++ b/uv.lock	(revision bbb)
@@ -1543,6 +1543,26 @@
 ]
 sdist = { url = &quot;https://files.pythonhosted.org/packages/0e/72/a3add0e4eec4eb9e2569554f7c70f4a3c27712f40e3284d483e88094cc0e/langdetect-1.0.9.tar.gz&quot;, hash = &quot;sha256:cbc1fef89f8d062739774bd51eda3da3274006b3661d199c2655f6b3f6d605a0&quot;, size = 981474, upload-time = &quot;2021-05-07T07:54:13.562Z&quot; }
 
+[[package]]
+name = &quot;langfuse&quot;
+version = &quot;3.2.1&quot;
+source = { registry = &quot;https://pypi.org/simple&quot; }
+dependencies = [
+    { name = &quot;backoff&quot; },
+    { name = &quot;httpx&quot; },
+    { name = &quot;opentelemetry-api&quot; },
+    { name = &quot;opentelemetry-exporter-otlp&quot; },
+    { name = &quot;opentelemetry-sdk&quot; },
+    { name = &quot;packaging&quot; },
+    { name = &quot;pydantic&quot; },
+    { name = &quot;requests&quot; },
+    { name = &quot;wrapt&quot; },
+]
+sdist = { url = &quot;https://files.pythonhosted.org/packages/61/0d/8fc51099cf337fb3b56cb7d305074bc0223c62e1ccabf80cc6285ccf5b31/langfuse-3.2.1.tar.gz&quot;, hash = &quot;sha256:f79b0380dfcf52c7525bb5d7f8e9d8786a6fc8b37867def047bb388930a7beb3&quot;, size = 153369, upload-time = &quot;2025-07-16T09:50:28.434Z&quot; }
+wheels = [
+    { url = &quot;https://files.pythonhosted.org/packages/92/b0/8f08df3f0fa584c4132937690c6dd33e0a116f963ecf2b35567f614e0ca7/langfuse-3.2.1-py3-none-any.whl&quot;, hash = &quot;sha256:07a84e8c1eed6ac8e149bdda1431fd866e4aee741b66124316336fb2bc7e6a32&quot;, size = 299315, upload-time = &quot;2025-07-16T09:50:26.582Z&quot; },
+]
+
 [[package]]
 name = &quot;langsmith&quot;
 version = &quot;0.4.10&quot;
@@ -2945,6 +2965,7 @@
     { name = &quot;langchain&quot; },
     { name = &quot;langchain-community&quot; },
     { name = &quot;langcodes&quot; },
+    { name = &quot;langfuse&quot; },
     { name = &quot;mysqlclient&quot; },
     { name = &quot;nanoid&quot; },
     { name = &quot;numpy&quot; },
@@ -3047,6 +3068,7 @@
     { name = &quot;langchain&quot;, specifier = &quot;&gt;=0.3.18,&lt;0.4.0&quot; },
     { name = &quot;langchain-community&quot;, specifier = &quot;&gt;=0.3.25&quot; },
     { name = &quot;langcodes&quot;, specifier = &quot;==3.5.0&quot; },
+    { name = &quot;langfuse&quot;, specifier = &quot;&gt;=3.2.1&quot; },
     { name = &quot;mysqlclient&quot;, specifier = &quot;&gt;=2.2.6,&lt;3.0.0&quot; },
     { name = &quot;nanoid&quot;, specifier = &quot;&gt;=2.0.0,&lt;3.0.0&quot; },
     { name = &quot;numpy&quot;, specifier = &quot;&gt;=2.2.6,&lt;2.3.0&quot; },
Index: pyproject.toml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&lt;+&gt;UTF-8
===================================================================
diff --git a/pyproject.toml b/pyproject.toml
--- a/pyproject.toml	(revision aaa)
+++ b/pyproject.toml	(revision bbb)
@@ -68,6 +68,7 @@
     &quot;unstructured&gt;=0.18.3&quot;,
     &quot;websockets&gt;=15.0.1,&lt;16.0.0&quot;,
     &quot;zstandard&gt;=0.23.0,&lt;0.24.0&quot;,
+    &quot;langfuse&gt;=3.2.1&quot;,
 ]
</code></pre>
<p><code>packaging</code> package in the lock file hadn't been changed:</p>
<pre><code>[[package]]
name = &quot;packaging&quot;
version = &quot;25.0&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
sdist = { url = &quot;https://files.pythonhosted.org/packages/a1/d4/1fc4078c65507b51b96ca8f8c3ba19e6a61c8253c72794544580a7b6c24d/packaging-25.0.tar.gz&quot;, hash = &quot;sha256:d443872c98d677bf60f6a1f2f8c1cb748e8fe762d2bf9d3148b5599295b0fc4f&quot;, size = 165727, upload-time = &quot;2025-04-19T11:48:59.673Z&quot; }
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/20/12/38679034af332785aac8774540895e234f4d07f7545804097de4b666afd8/packaging-25.0-py3-none-any.whl&quot;, hash = &quot;sha256:29572ef2b1f17581046b3a2227d5c611fb25ec70ca1ba8554b24b0e69331a484&quot;, size = 66469, upload-time = &quot;2025-04-19T11:48:57.875Z&quot; },
]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:11 UTC
    </footer>
</body>
</html>
