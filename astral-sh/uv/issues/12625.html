<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unexpected Dependency Conflict with uv lock in Python 3.11.11 - astral-sh/uv #12625</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unexpected Dependency Conflict with uv lock in Python 3.11.11</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12625">#12625</a>
        opened by <a href="https://github.com/nordicsushi">@nordicsushi</a>
        on 2025-04-02 14:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nordicsushi">@nordicsushi</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<h2>Description</h2>
<p>When installing dependencies with uv in a Python 3.11.11 environment, the resolver incorrectly enforces numpy&gt;=1.26.0 due to pandas==2.2.2, even though this requirement should only apply to Python 3.12+. This results in an unnecessary conflict with numpy==1.24.4, which should be valid under Python 3.11.</p>
<h2>Steps to Reproduce</h2>
<ol>
<li>Define the following dependencies in pyproject.toml:</li>
</ol>
<pre><code class="language-toml">dependencies = [
    &quot;pandas[performance, parquet]==2.2.2&quot;,
    &quot;numpy==1.24.4&quot;,
]
</code></pre>
<ol start="2">
<li>Run:</li>
</ol>
<pre><code class="language-bash">uv pip install -r pyproject.toml
</code></pre>
<p>‚úÖ Installs successfully without issues.</p>
<ol start="3">
<li>Attempt to generate a lock file:</li>
</ol>
<pre><code class="language-sh">uv lock
</code></pre>
<p>‚ùå Fails with the following error:</p>
<pre><code>√ó No solution found when resolving dependencies for split (python_full_version &gt;= '3.12'):
‚ï∞‚îÄ‚ñ∂ Because only the following versions of numpy{python_full_version &gt;= '3.12'} are available:
      numpy{python_full_version &gt;= '3.12'}&lt;=1.26.0
      ...
    and pandas==2.2.2 depends on numpy{python_full_version &gt;= '3.12'}&gt;=1.26.0,
    we can conclude that pandas==2.2.2 depends on numpy&gt;=1.26.0.
    And because your project depends on numpy==1.24.4 and pandas[performance]==2.2.2,
    we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<h2>Expected Behavior</h2>
<p>uv lock should correctly recognize that for Python 3.11, pandas==2.2.2 only requires numpy&gt;=1.23.2, meaning numpy==1.24.4 should be a valid choice.</p>
<h2>Additional Context</h2>
<p>The pyproject.toml of pandas==2.2.2 explicitly defines different numpy requirements based on Python versions:</p>
<pre><code class="language-toml">dependencies = [
  &quot;numpy&gt;=1.22.4; python_version&lt;'3.11'&quot;,
  &quot;numpy&gt;=1.23.2; python_version=='3.11'&quot;,
  &quot;numpy&gt;=1.26.0; python_version&gt;='3.12'&quot;,
  ...
]
</code></pre>
<p>Since numpy==1.24.4 satisfies numpy&gt;=1.23.2 for Python 3.11, this should not be a conflict.</p>
<p>Moreover, pip-compile successfully generates a lock file without any issues, reinforcing that this is specific to uv‚Äôs resolver.</p>
<p>Would appreciate any insights on this! üöÄ</p>
<h3>Platform</h3>
<p>Linux 5.15.0-1064-azure x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.6.11</p>
<h3>Python version</h3>
<p>python 3.11.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @nordicsushi on 2025-04-02 14:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-02 15:04</div>
            <div class="timeline-body"><blockquote>
<p>the resolver incorrectly enforces numpy&gt;=1.26.0 due to pandas==2.2.2, even though this requirement should only apply to Python 3.12+.</p>
</blockquote>
<p>In the uv lockfile, we solve for all Python versions not just your current one. See https://docs.astral.sh/uv/concepts/resolution/#universal-resolution</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-04-02 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-04-02 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nordicsushi">@nordicsushi</a> on 2025-04-02 15:09</div>
            <div class="timeline-body"><p>@zanieb  Thank you for your quick answer, Zanie. I am a newbie to uv. i'll read the document you provided here :) You may close this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-02 15:13</div>
            <div class="timeline-body"><p>Let me know if you have more questions!  I'd recommend unpinning the versions in your pyproject.toml and allowing a range instead. The lockfile will pin a specific version appropriate for each Python version you might use.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-02 15:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nordicsushi">@nordicsushi</a> on 2025-04-02 15:56</div>
            <div class="timeline-body"><p>@zanieb  we're actually building an application and have to pin the versions and also specify the exact python version we would like to use. I solved this issue by specifying &quot;requires-python = &quot;==3.11.11&quot; in my pyproject.toml, though i'm not sure if this is the best practice... :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-02 16:13</div>
            <div class="timeline-body"><p>It'd be more &quot;proper&quot; to use <code>uv.lock</code> and <code>.python-version</code> to pin your versions unless you need them to be pinned in the distribution, but ü§∑‚Äç‚ôÄ. Setting <code>requires-python</code> like that is fine.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:45 UTC
    </footer>
</body>
</html>
