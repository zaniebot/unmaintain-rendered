<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support hash checking against `RECORD` - astral-sh/uv #888</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support hash checking against <code>RECORD</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/888">#888</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-01-11 17:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-11 17:27</div>
            <div class="timeline-body"><p>We should validate the hash of each individual file in the wheel against the hash recorded in <code>RECORD</code>. (This is distinct from the hash-checking mode described in https://github.com/astral-sh/puffin/issues/131 and https://github.com/astral-sh/puffin/issues/474.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-01-11 17:29</div>
            <div class="timeline-body"><p>During installation or for an existing venv?</p>
<p>install-wheel-rs can do during installation, but it's turned off by default for perf reason (sha256 is slow) and because pip also didn't validate last time i checked.</p>
<p>For an existing venv, https://github.com/konstin/poc-monotrail/blob/main/crates/monotrail/src/verify_installation.rs implements this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-11 17:30</div>
            <div class="timeline-body"><p>For us, installation is <em>linking</em>, so it should really happen when unzipping into the cache.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-11 17:30</div>
            <div class="timeline-body"><p>Or we could do it after-the-fact as part of our venv validation...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-01-11 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2024-01-11 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Initial release" by @charliermarsh on 2024-01-11 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "Initial release" by @charliermarsh on 2024-01-11 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Feature complete" by @charliermarsh on 2024-01-11 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> removed by @charliermarsh on 2024-01-11 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2024-01-11 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">security</span> added by @zanieb on 2024-02-17 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vors">@vors</a> on 2024-08-13 19:21</div>
            <div class="timeline-body"><p>Related topic (let me know if I should create a separate issue):</p>
<p>Currently most python packaging tooling doesn't have any kind of guardrails against the clobbering of files in one whl from another whl. This is basically undefined behavior -- depending on the order the final venv will be different. There are packages in the wild that include things like empty <code>__init__.py</code> files that do clobber each other and it's not a problem in practice (most notably google cloud family of packages). There are also cases when people put <code>README.md</code> into the top-level folder so it ends up in <code>site-packages/README.md</code> and conflicts.</p>
<p>@hauntsaninja proposed that we could do a hash check against the <code>RECORD</code> file entry and maybe have a flag to fail loudly in case of violation -- that should simultaneously allow clobbering of empty <code>__init__.py</code> files and prevent undefined behaviors.</p>
<p>What do you think about this idea? Maybe there is a better way to achieve more strict semantic?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-02 12:40</div>
            <div class="timeline-body"><p>Given that hash checking against RECORD wasn't implemented in pip nor uv, the security features weren't use (https://discuss.python.org/t/discouraging-deprecating-pep-427-style-signatures/94968), it's slow and new security feature such as hashes in the simple API and attestations work on a whole-file basis, I suggest we close this as not planned and focus on whole-archive hash checking.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:26 UTC
    </footer>
</body>
</html>
