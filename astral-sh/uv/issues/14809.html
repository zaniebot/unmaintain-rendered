<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How does requirements.in file ordering affect output? - astral-sh/uv #14809</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>How does requirements.in file ordering affect output?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14809">#14809</a>
        opened by <a href="https://github.com/JulianKenwood">@JulianKenwood</a>
        on 2025-07-22 11:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JulianKenwood">@JulianKenwood</a></div>
            <div class="timeline-body">Question
Dependency Resolution Differs with requirements.in Order
<p>I encountered a situation where the output produced by <code>uv pip compile</code> from a <code>requirements.in</code> file varied depending on the order of the packages listed. It appears that when there are conflicting requirements, the resolver will prefer downgrading the package that is listed later in the <code>requirements.in</code> file.</p>
Example
<p>Suppose I have two dependencies:</p>
<ul>
<li><strong>internal-package</strong><ul>
<li>Version 2.0.0 pins <code>sqlalchemy&lt;2</code></li>
<li>Version 1.0.0 requires <code>sqlalchemy</code> (no version pin)</li>
</ul>
</li>
<li><strong>sqlalchemy</strong></li>
</ul>
Ordering 1
<p>If my <code>requirements.in</code> contains:</p>
<pre><code>sqlalchemy
internal-package
</code></pre>
<p>The compiled <code>requirements.txt</code> is:</p>
<pre><code>sqlalchemy==2.X.Y  # latest
internal-package==1.0.0
</code></pre>
Ordering 2
<p>If I reverse the order:</p>
<pre><code>internal-package
sqlalchemy
</code></pre>
<p>The compiled <code>requirements.txt</code> is:</p>
<pre><code>internal-package==2.0.0  # latest
sqlalchemy==1.X.Y
</code></pre>
<p>It seems as though priority is given to dependencies listed earlier in <code>requirements.in</code> but I could not find any mention of this in the documentation on dependency resolution.</p>
<p><strong>Is this intended behavior?</strong> For our use case, we expected the result from Ordering 2.</p>
Platform
<p>MacOS 15.5 arm64</p>
Version
<p>uv 0.7.2 (481d05d8d 2025-04-30)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/JulianKenwood">@JulianKenwood</a> on 2025-07-22 11:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-22 12:05</div>
            <div class="timeline-body"><p>Yes, priority is given to requirements earlier in the file. As described in the example at https://docs.astral.sh/uv/concepts/resolution/#basic-examples a resolution has multiple possible solutions and requirement ordering is one of the heuristics we use to make decisions about solve order.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-22 12:06</div>
            <div class="timeline-body"><p>I&#x27;d put bounds on the packages in your input requirements.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JulianKenwood">@JulianKenwood</a> on 2025-07-22 14:28</div>
            <div class="timeline-body"><blockquote>
<p>Yes, priority is given to requirements earlier in the file. As described in the example at https://docs.astral.sh/uv/concepts/resolution/#basic-examples a resolution has multiple possible solutions and requirement ordering is one of the heuristics we use to make decisions about solve order.</p>
</blockquote>
<p>I can&#x27;t see any part of the documentation where it says that requirement ordering is a heuristic. The closest I can see on the matter is the following:</p>
<pre><code>Both are valid solutions, and different resolution algorithms may yield either result.
</code></pre>
<p>Changing package order to set priority seems reasonable, but piptools’ pip-compile doesn’t work that way from what I can tell. I wouldn’t want to rely on this behavior unless it was explicitly documented as being part of the API.</p>
<blockquote>
<p>I&#x27;d put bounds on the packages in your input requirements.</p>
</blockquote>
<p>The exact set of pins I would need to add would require me to examine all my dependencies (both direct and indirect), gather all their version constraints, and then decide which versions I actually want to pin. I also don&#x27;t know the exact set of pins in advance, because each dependency version can have its own constraints (and additional constraints from indirect dependencies), and I don&#x27;t know which versions will be chosen by the dependency resolver.</p>
<p>My package could also be a library where I might want to use non-lower bound pins more sparingly.</p>
<p>The package I&#x27;m building doesn&#x27;t directly care what version of sqlalchemy is installed so saying it needs a pin might be misleading.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-22 14:32</div>
            <div class="timeline-body"><p>If you &quot;want&quot; a certain output given multiple valid solutions, then you should give the resolver more guidance. I&#x27;d suggest adding a constraints file if you don&#x27;t want to make it part of your own dependency declarations, and don&#x27;t want to rely on the ordering of the requirements.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-22 14:46</div>
            <div class="timeline-body"><blockquote>
<p>The package I&#x27;m building doesn&#x27;t directly care what version of sqlalchemy is installed so saying it needs a pin might be misleading.</p>
</blockquote>
<p>If you don&#x27;t care what version of <code>sqlalchemy</code> you get, then what is the problem? Is it that you care what version of <code>internal-package</code> you get? If so, why not add a lower bound to that dependency?</p>
<blockquote>
<p>I wouldn’t want to rely on this behavior unless it was explicitly documented as being part of the API.</p>
</blockquote>
<p>You shouldn&#x27;t rely on this behavior, resolution is very complicated and without constraints there&#x27;s no way to guarantee the algorithm will not take a different path than you expect.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-07-22 15:00</div>
            <div class="timeline-body"><p>FYI this is somewhat documented here: https://docs.astral.sh/uv/pip/compatibility/#package-priority</p>
<p>Ordering of input requirements is used as part of the resolution choice for both uv and pip. As pip-tools uses pip under the hood it is also affected by user order, though less so as noted in the comparability guide.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JulianKenwood">@JulianKenwood</a> on 2025-07-23 06:58</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>The package I&#x27;m building doesn&#x27;t directly care what version of sqlalchemy is installed so saying it needs a pin might be misleading.</p>
</blockquote>
<p>If you don&#x27;t care what version of <code>sqlalchemy</code> you get, then what is the problem? Is it that you care what version of <code>internal-package</code> you get? If so, why not add a lower bound to that dependency?</p>
<blockquote>
<p>I wouldn’t want to rely on this behavior unless it was explicitly documented as being part of the API.</p>
</blockquote>
<p>You shouldn&#x27;t rely on this behavior, resolution is very complicated and without constraints there&#x27;s no way to guarantee the algorithm will not take a different path than you expect.</p>
</blockquote>
<p>Sorry, let me clarify what I meant here.</p>
<p>From my package&#x27;s perspective, the version of <code>sqlalchemy</code> is irrelevant and during development it would&#x27;ve worked the same regardless of whether 1.X.Y or 2.X.Y was picked.</p>
<p>I then decided I needed <code>internal-package</code>. <code>internal-package</code> <strong>does</strong> care what version of sqlalchemy it uses. The latest version of <code>internal-package</code>has a pin on <code>sqlalchemy &lt; 2</code>. The earlier version of <code>internal-package</code> does not have the same pin because it predates <code>sqlalchemy 2</code></p>
<blockquote>
<p>FYI this is somewhat documented here: https://docs.astral.sh/uv/pip/compatibility/#package-priority</p>
<p>Ordering of input requirements is used as part of the resolution choice for both uv and pip. As pip-tools uses pip under the hood it is also affected by user order, though less so as noted in the comparability guide.</p>
</blockquote>
<p>This is exactly what I was looking for. Thank you for the link.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-04 17:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:33 UTC
    </footer>
</body>
</html>
