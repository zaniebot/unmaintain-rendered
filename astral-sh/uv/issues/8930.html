<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv failing to create multi-platform env for torch - astral-sh/uv #8930</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv failing to create multi-platform env for torch</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8930">#8930</a>
        opened by <a href="https://github.com/sharmuz">@sharmuz</a>
        on 2024-11-08 10:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sharmuz">@sharmuz</a> on 2024-11-08 10:27</div>
            <div class="timeline-body"><p><strong>uv version:</strong> ~~0.5.0~~ 0.4.28
<strong>OS/platform:</strong> macOS Sonoma 14.7.1 (on a MBP 2020 Intel)</p>
<p>Hey folks - YAO pytorch issue :)</p>
<p>I'm attempting to create an env which will install a given <code>torch</code> and <code>torchvision</code> version from a specified index, depending on whether the OS is darwin/win/linux.</p>
<p>I'm going off of the info in #6523 and <a href="https://github.com/astral-sh/uv/issues/8746#issuecomment-2452438775">#8746</a>.</p>
<p>Here's a minimal excerpt of my <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
name = &quot;minimal&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;==3.10.*&quot;
dependencies = [
  &quot;torch==1.13.1 ; platform_system == 'darwin'&quot;,
  &quot;torch==1.13.1+cpu ; platform_system == 'win32'&quot;,
  &quot;torch==1.13.1+cu116 ; platform_system == 'linux'&quot;,
  &quot;torchvision==0.14.1 ; platform_system == 'darwin'&quot;,
  &quot;torchvision==0.14.1+cpu ; platform_system == 'win32'&quot;,
  &quot;torchvision==0.14.1+cu116 ; platform_system == 'linux'&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;torch-cpu&quot;, marker = &quot;platform_system != 'linux'&quot; },
  { index = &quot;torch-cuda&quot;, marker = &quot;platform_system == 'linux'&quot; },
]
torchvision = [
  { index = &quot;torch-cpu&quot;, marker = &quot;platform_system != 'linux'&quot; },
  { index = &quot;torch-cuda&quot;, marker = &quot;platform_system == 'linux'&quot; },
]

[[tool.uv.index]]
name = &quot;torch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;torch-cuda&quot;
url = &quot;https://download.pytorch.org/whl/cu116&quot;
explicit = true
</code></pre>
<p><code>uv sync</code> runs without error but the generated <code>uv.lock</code> looks off:</p>
<pre><code class="language-toml">[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;platform_system == 'darwin'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'darwin'&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
resolution-markers = [
    &quot;platform_system != 'darwin' and platform_system != 'linux' and platform_system != 'win32'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system != 'darwin' and platform_system != 'linux' and platform_system != 'win32'&quot; },
]
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/81/58/431fd405855553af1a98091848cf97741302416b01462bbf9909d3c422b3/torch-1.13.1-cp310-cp310-manylinux1_x86_64.whl&quot;, hash = &quot;sha256:fd12043868a34a8da7d490bf6db66991108b00ffbeecb034228bfcbbd4197143&quot;, size = 887450534 },
    { url = &quot;https://files.pythonhosted.org/packages/2c/45/43233d36e8e7ec5588fa802bb098337ae73c314863190c68797287f2fbdd/torch-1.13.1-cp310-cp310-manylinux2014_aarch64.whl&quot;, hash = &quot;sha256:d9fe785d375f2e26a5d5eba5de91f89e6a3be5d11efb497e76705fdf93fa3c2e&quot;, size = 60541101 },
    { url = &quot;https://files.pythonhosted.org/packages/33/bd/e174e6737daba03f8eaa7c051b9971d361022eb37b86cbe5db0b08cab00e/torch-1.13.1-cp310-cp310-win_amd64.whl&quot;, hash = &quot;sha256:98124598cdff4c287dbf50f53fb455f0c1e3a88022b39648102957f3445e9b76&quot;, size = 162597315 },
    { url = &quot;https://files.pythonhosted.org/packages/82/d8/0547f8a22a0c8aeb7e7e5e321892f1dcf93ea021829a99f1a25f1f535871/torch-1.13.1-cp310-none-macosx_10_9_x86_64.whl&quot;, hash = &quot;sha256:393a6273c832e047581063fb74335ff50b4c566217019cc6ace318cd79eb0566&quot;, size = 135290591 },
    { url = &quot;https://files.pythonhosted.org/packages/24/45/61e41ef8a84e1d6200ff10b7cb87e23e211599ab62420396a363295f973c/torch-1.13.1-cp310-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:0122806b111b949d21fa1a5f9764d1fd2fcc4a47cb7f8ff914204fd4fc752ed5&quot;, size = 53188434 },
]

[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1+cpu&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;platform_system == 'win32'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'win32'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1%2Bcpu-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:11692523b87c45b79ddfb5148b12a713d85235d399915490d94e079521f7e014&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1+cu116&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cu116&quot; }
resolution-markers = [
    &quot;platform_system == 'linux'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'linux'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cu116/torch-1.13.1%2Bcu116-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:51d5870cdf05b6208b1c739fe0ba511b977eca37f9507829675596acc11b6ca4&quot; },
]
</code></pre>
<p>(equivalent output for torchvision)</p>
<p>I see two problems:</p>
<ol>
<li><code>torch==1.13.1+cpu</code> is marked as for win32 but the binary listed is for linux</li>
<li>The entry for <code>torch==1.13.1</code>for darwin lists no binary, even though this is definitely present (I've tested with <a href="https://download.pytorch.org/whl/cpu/torch-1.13.1-cp310-none-macosx_10_9_x86_64.whl">the url</a> supplied directly instead of index</li>
</ol>
<p>I've tried:</p>
<ul>
<li>Same as above but with torch 2.2.2 and torchvision 0.17.2 --&gt; same result</li>
<li>Specifying <code>index = &quot;torch-cpu&quot;</code> as only for win32 (so darwin should use pypi) --&gt; 1) still a prob</li>
<li>Specifying the direct url for win32 and using <code>index = &quot;torch-cpu&quot;</code> as only for darwin --&gt; 2) still a prob</li>
</ul>
<p>Am I missing something? Ideally I'd like <code>pyproject.toml</code> to not need any direct url sources and work for mac-x86/mac-arm/win/linux-cuda</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-08 14:02</div>
            <div class="timeline-body"><p>In reality, it should be quite rare to see <code>win32</code>  for <code>platform_system</code>, as it's not difficult to replace <code>win32</code> with <code>Windows</code> in its judgment.
<img src="https://github.com/user-attachments/assets/1bbf1706-5391-4c9f-86fa-808e1035fef4" alt="image" /></p>
<p>https://docs.python.org/3.10/library/platform.html#platform.system
<img src="https://github.com/user-attachments/assets/02c94699-fac4-4e3d-85b1-352fd5920855" alt="image" />
https://docs.astral.sh/uv/concepts/dependencies/#dependency-specifiers-pep-508</p>
<p>To generate more precise results, I recommend using <code>Linux</code>, <code>Windows</code>, or <code>Darwin</code> as the marker value. Please note that these values are <strong>case-sensitive</strong>.</p>
<p>The value <code>win32</code> is associated with the marker <code>sys_platform</code>.
https://docs.python.org/3.10/library/sys.html#sys.platform
<img src="https://github.com/user-attachments/assets/e9b5ca33-66ce-44fd-bce3-256fd2b84f63" alt="image" /></p>
<p>Edit:
I'm unsure if <code>platform_system</code> is case-sensitive, but using the correct capitalization for the lock file is usually  best.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharmuz">@sharmuz</a> on 2024-11-08 17:35</div>
            <div class="timeline-body"><p>Thanks @FishAlchemist - that did the trick!</p>
<p>Looks like <strong>case-sensitivity is important for platform_system</strong>. FWIW I originally was using sys_platform instead (hence the win32) but still had issues (can't recall if were same).</p>
<p>Might be worth updating the <a href="https://docs.astral.sh/uv/concepts/dependencies">dependency docs</a> to use platform_system? Just a thought</p>
<p>Anyway here's my working pyproject.toml in case is of use:</p>
<pre><code class="language-toml">[project]
name = &quot;minimal&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;==3.10.*&quot;
dependencies = [
  &quot;torch==1.13.1 ; platform_system == 'Darwin'&quot;,
  &quot;torch==1.13.1+cpu ; platform_system == 'Windows'&quot;,
  &quot;torch==1.13.1+cu116 ; platform_system == 'Linux'&quot;,
  &quot;torchvision==0.14.1 ; platform_system == 'Darwin'&quot;,
  &quot;torchvision==0.14.1+cpu ; platform_system == 'Windows'&quot;,
  &quot;torchvision==0.14.1+cu116 ; platform_system == 'Linux'&quot;,
]

[tool.uv.sources]
torch = [
  { index = &quot;torch-cpu&quot;, marker = &quot;platform_system != 'Linux'&quot; },
  { index = &quot;torch-cuda&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
torchvision = [
  { index = &quot;torch-cpu&quot;, marker = &quot;platform_system != 'Linux'&quot; },
  { index = &quot;torch-cuda&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]

[[tool.uv.index]]
name = &quot;torch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;torch-cuda&quot;
url = &quot;https://download.pytorch.org/whl/cu116&quot;
explicit = true
</code></pre>
<p>(Btw I'm aware pytorch advise installing from pypi for macos - I just prefer this way)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sharmuz on 2024-11-08 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharmuz">@sharmuz</a> on 2024-11-13 11:15</div>
            <div class="timeline-body"><p>Sorry to say I'm getting a new issue with this with 0.5.1 :(</p>
<p>uv fails to install the env, saying it cannot find a compatible file for <code>torch==1.13.1+cpu</code> for my platform (Mac/Darwin).</p>
<p>However, as you can see above it should not be attempting to install that version of torch on Mac. Scanning the lockfile I see that it has indeed erroneously added <code>platform_system == 'Darwin'</code> to the entry for <code>torch==1.13.1+cpu</code> instead of <code>torch==1.13.1</code>.</p>
<p>Downgrading to 0.5.0 did not resolve it. (I must've been mistaken with the ver I wrote at the top).</p>
<p>Changing the tool.uv.sources entry for torch so that <code>index = &quot;torch-cpu&quot;</code> is only for Windows does resolve it. I.e. Darwin installs from pypi. But before it worked from torch-cpu.</p>
<p>Downgrading to 0.4.28 <em>does</em> resolve it fully - it creates a lockfile consistent with the toml and installs the correct torch packages from pytorch.org for Mac.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @sharmuz on 2024-11-13 11:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-13 11:26</div>
            <div class="timeline-body"><p>@sharmuz Can you provide a pyproject.toml file that can reproduce the issue you're facing?
Will this issue occur in version 0.4.29? Since 0.5.0 is a major update, confirming this issue in 0.4.29, the last version in the 0.4.X series, will help narrow down the scope of uv's bug-hunting efforts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-13 15:44</div>
            <div class="timeline-body"><p>@sharmuz -- You likely need to do <code>torch==1.13.1, !==1.13.1+cpu ; platform_system == 'Darwin'</code>, or <code>torch===1.13.1 ; platform_system == 'Darwin'</code>.</p>
<p><code>1.13.1+cpu</code> <em>is</em> a valid version for <code>torch==1.13.1</code>, per the Python standards.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-13 15:49</div>
            <div class="timeline-body"><p>I believe this is a duplicate of https://github.com/astral-sh/uv/issues/9036.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharmuz">@sharmuz</a> on 2024-11-18 16:22</div>
            <div class="timeline-body"><p>Okay using the following pyproject.toml:</p>
<pre><code class="language-toml">[project]
name = &quot;minimal&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;==3.10.*&quot;
dependencies = [
  &quot;torch==1.13.1 ; platform_system == 'Darwin'&quot;,
  &quot;torch==1.13.1+cpu ; platform_system == 'Windows'&quot;,
  &quot;torch==1.13.1+cu116 ; platform_system == 'Linux'&quot;,
  &quot;torchvision==0.14.1 ; platform_system == 'Darwin'&quot;,
  &quot;torchvision==0.14.1+cpu ; platform_system == 'Windows'&quot;,
  &quot;torchvision==0.14.1+cu116 ; platform_system == 'Linux'&quot;,
]

[project.scripts]
minimal = &quot;minimal:main&quot;

[tool.uv]
package = true

[tool.uv.sources]
torch = [
  { index = &quot;torch-cpu&quot;, marker = &quot;platform_system != 'Linux'&quot; },
  { index = &quot;torch-cuda&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
torchvision = [
  { index = &quot;torch-cpu&quot;, marker = &quot;platform_system != 'Linux'&quot; },
  { index = &quot;torch-cuda&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]

[[tool.uv.index]]
name = &quot;torch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;torch-cuda&quot;
url = &quot;https://download.pytorch.org/whl/cu116&quot;
explicit = true

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

</code></pre>
<p>I get this in uv.lock for 0.4.28 <strong>and</strong> 0.4.29:</p>
<pre><code class="language-toml">[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;platform_system == 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1-cp310-none-macosx_10_9_x86_64.whl&quot;, hash = &quot;sha256:393a6273c832e047581063fb74335ff50b4c566217019cc6ace318cd79eb0566&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1-cp310-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:0122806b111b949d21fa1a5f9764d1fd2fcc4a47cb7f8ff914204fd4fc752ed5&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1+cpu&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;platform_system == 'Windows'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Windows'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1%2Bcpu-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:11692523b87c45b79ddfb5148b12a713d85235d399915490d94e079521f7e014&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1%2Bcpu-cp310-cp310-win_amd64.whl&quot;, hash = &quot;sha256:207ab3700cd9c4349f4fd1892597eb3d385eb78221c0f2974ec54b8ea903aa00&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1+cu116&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cu116&quot; }
resolution-markers = [
    &quot;platform_system == 'Linux'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cu116/torch-1.13.1%2Bcu116-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:51d5870cdf05b6208b1c739fe0ba511b977eca37f9507829675596acc11b6ca4&quot; },
]
</code></pre>
<p>(With equivalent entries for torchvision). This is as I would expect.</p>
<p>Attempting with uv 0.5.2:</p>
<pre><code class="language-bash">error: Distribution `torch==1.13.1+cpu @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>If I alter the first dependency, per Charlie's suggestion to:</p>
<pre><code class="language-toml">&quot;torch==1.13.1, !=1.13.1+cpu ; platform_system == 'Darwin'&quot;
</code></pre>
<p>(and equiv. for torchvision)</p>
<p>I then get this in uv.lock for 0.5.2:</p>
<pre><code class="language-toml">[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;platform_system == 'Darwin'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Darwin'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1-cp310-none-macosx_10_9_x86_64.whl&quot;, hash = &quot;sha256:393a6273c832e047581063fb74335ff50b4c566217019cc6ace318cd79eb0566&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1-cp310-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:0122806b111b949d21fa1a5f9764d1fd2fcc4a47cb7f8ff914204fd4fc752ed5&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1+cpu&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cpu&quot; }
resolution-markers = [
    &quot;platform_system == 'Windows'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Windows'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1%2Bcpu-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:11692523b87c45b79ddfb5148b12a713d85235d399915490d94e079521f7e014&quot; },
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-1.13.1%2Bcpu-cp310-cp310-win_amd64.whl&quot;, hash = &quot;sha256:207ab3700cd9c4349f4fd1892597eb3d385eb78221c0f2974ec54b8ea903aa00&quot; },
]

[[package]]
name = &quot;torch&quot;
version = &quot;1.13.1+cu116&quot;
source = { registry = &quot;https://download.pytorch.org/whl/cu116&quot; }
resolution-markers = [
    &quot;platform_system == 'Linux'&quot;,
]
dependencies = [
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_system == 'Linux'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cu116/torch-1.13.1%2Bcu116-cp310-cp310-linux_x86_64.whl&quot;, hash = &quot;sha256:51d5870cdf05b6208b1c739fe0ba511b977eca37f9507829675596acc11b6ca4&quot; },
]
</code></pre>
<p>Which is good ðŸ˜Ž</p>
<p>So I guess now we need to explicitly forbid the +cpu version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 00:14</div>
            <div class="timeline-body"><p>Yeah you have to explicitly forbid <code>+cpu</code> on macOS, since there is no <code>+cpu</code> wheel for macOS (all the macOS builds are assumed to be <code>+cpu</code>). I just published some docs around this with a few example configurations: https://docs.astral.sh/uv/guides/integration/pytorch/.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-20 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-11-20 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-20 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ianmobbs">@ianmobbs</a> on 2024-11-25 23:26</div>
            <div class="timeline-body"><p>Hi, thank you for the detailed response here. I am also seeing this behavior on macOS:</p>
<pre><code>ianmobbs@ians-mbp code % mkdir testtorch
ianmobbs@ians-mbp code % cd testtorch
ianmobbs@ians-mbp testtorch % uv init
Initialized project `testtorch`
ianmobbs@ians-mbp testtorch % uv add torch
Resolved 23 packages in 4ms
error: Distribution `torch==2.5.1 @ registry+https://pypi.org/simple` can't be installed because it doesn't have a source distribution or wheel for the current platform
</code></pre>
<p>It seems like this is intended behavior based on the above discussion, but the same steps had been used to create a previous project. I attempted to follow the <code>uv pip</code> alias at the bottom of the blog post, but that errors too:</p>
<pre><code class="language-ianmobbs@ians-mbp">  Ã— No solution found when resolving dependencies:
  â•°â”€â–¶ Because only the following versions of torch are available:
          ...
          torch==2.5.1
          torch==2.5.1+cpu
      and torch&lt;=0.4.1 has no wheels with a matching Python implementation tag, we can conclude that torch&lt;0.1.6.post17 cannot be used.
      And because torch==0.4.1.post2 has no wheels with a matching Python ABI tag and torch&gt;=1.0.0,&lt;=1.2.0+cpu has no wheels with a matching Python
      implementation tag, we can conclude that torch&lt;1.0.1 cannot be used.
      And because torch==1.3.0 has no wheels with a matching Python ABI tag and torch&gt;=1.3.0+cpu,&lt;=1.5.0+cpu has no wheels with a matching Python
      implementation tag, we can conclude that torch&lt;1.3.0.post2 cannot be used.
      And because torch&gt;=1.5.1 has no wheels with a matching Python ABI tag and you require torch, we can conclude that your requirements are
      unsatisfiable.
</code></pre>
<p>(This occurs even with a fresh <code>uv venv</code>).</p>
<p>Additionally, this <code>pyproject.toml</code> that was previously working for a different project is now broken:</p>
<pre><code>[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;torch&gt;=2.5.1&quot;,
]
</code></pre>
<p>Totally understand that this seems to be a quirk with Pytorch distribution and not necessarily a uv-specific issue. However, I am curious what the 'golden path' is for spinning up a greenfield project using uv and torch on macOS.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-25 23:34</div>
            <div class="timeline-body"><p>Do you know what Python version you're on? You may need to constraint to Python 3.12, since PyTorch doesn't ship Python 3.13 wheels.</p>
<p>There's an example configuration here: https://docs.astral.sh/uv/guides/integration/pytorch/#using-a-pytorch-index</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
