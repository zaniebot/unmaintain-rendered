<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>unsafe-best-match appears incompatible with github-dependencies and to ignore if-necessary-or-explicit - astral-sh/uv #14851</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>unsafe-best-match appears incompatible with github-dependencies and to ignore if-necessary-or-explicit</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/14851">#14851</a>
        opened by <a href="https://github.com/SoundDesignerToBe">@SoundDesignerToBe</a>
        on 2025-07-23 17:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/SoundDesignerToBe">@SoundDesignerToBe</a> on 2025-07-23 17:39</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hello,</p>
<p>I am very confused about what the <code>--index-strategy=unsafe-best-match</code> flag really does and why it fails to install my packages:</p>
<p>I install python packages in a sandboxed environment in CI pipelines where I ~~built uv from source~~ installed uv with <code>pip3 install</code>.</p>
<p>I recently added the <code>--index-strategy=&quot;unsafe-best-match&quot;</code> flag to resolve an issue.</p>
<p>Later, another private package from a private GitLab listed a github dependency in its pyproject.toml such as</p>
<pre><code class="language-toml"># pyproject.toml
dependencies = [
  &quot;some_package@git+https://github.com/author/some_package&quot;
]
</code></pre>
<p>This led to an error when attempting to install the package:</p>
<pre><code class="language-shell">error: Package `some_package` attempted to resolve via URL: git+https://github.com/author/some_package. URL dependencies must be expressed as direct requirements or constraints. Consider adding `some_package @ git+https://github.com/author/some_package` to your dependencies or constraints file.
</code></pre>
<p>I thought this might occur due to some sandbox restrictions but today I faced another issue and realized this is reproducible on my local host, but only if I use the <code>--index-strategy=&quot;unsafe-best-match&quot;</code> flag.</p>
<p>So... 'some_package' is not maintained on PYPI, but there are dev tags on the github repo. I cloned the repo, built the dev tag wheel and pushed it manually to my gitlab package registry -- the registry of the package that lists &quot;some_package&quot; as dependency.
I changed the dependency in the pyproject.toml to the explicit dev tag instead of the github url (such as <code>&quot;some_package==1.2.3a4&quot;</code>). Then I gave a new stable tag to and built a new wheel of my package and uploaded it to its package registry on GitLab.</p>
<p>If I try to install my package now with plain <code>uv pip install</code> (only the index and insecure host are defined in uv.toml, no other settings), then the installation works fine.
If I add the <code>--index-stratety=unsafe-best-match</code> flag again, it fails and will try to install the previous  stable version of my package leading to the error quoted above w.r.t URL dependencies.
I used <code>uv cache clean</code> multiple times, but that had no impact.</p>
<p>So I can only hope to solve my previous issue leading to the use of that flag in another way but I read the documentation and cannot conclude why this fails.</p>
<p>It appeared to me as if the &quot;unsafe-best-match&quot; overwrote the <code>--prerelease=if-necessary-or-explicit</code> default value, so I set it explicitly, but that had no impact, either.</p>
<p>Adding &quot;--prerelease=allow&quot; installs the latest version of my package and its dependency, but then I get prereleases of any further dependency which I do not want for obvious reasons.</p>
<p>So why does the &quot;unsafe-best-strategy&quot; behave so oddly? Is it a bug or did I miss something in the docs?</p>
<p>Specs:</p>
<ul>
<li>Fedora Workstation 42</li>
<li><code>uv venv --python 3.12 ...</code></li>
<li><code>uv --version</code>: 0.7.12</li>
</ul>
<h3>Platform</h3>
<p>Linux 6.15.6-200.fc42.x86_64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.7.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @SoundDesignerToBe on 2025-07-23 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SoundDesignerToBe">@SoundDesignerToBe</a> on 2025-07-24 08:22</div>
            <div class="timeline-body"><p>Update:
Even after using <code>uv cache clean my_package</code> in the install instruction of the sandbox and removing the index strategy flag, it continued to fail to install and I had to go back to using pip there to make it work.  It tried to install it in a cached environment (cached flatpak build). I expected it to try to pull a newer version if it cannot install the old one, but it kept running into the URL dependency error. Replacing <code>uv pip</code> with <code>pip</code> again, it now works and it pulls the new package.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:26:43 UTC
    </footer>
</body>
</html>
