<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optional dependencies are missing when a requirement with option is overridden - astral-sh/uv #11247</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Optional dependencies are missing when a requirement with option is overridden</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/11247">#11247</a>
        opened by <a href="https://github.com/tderwedu">@tderwedu</a>
        on 2025-02-05 15:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tderwedu">@tderwedu</a> on 2025-02-05 15:59</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When generating a lock with the <code>uv pip compile</code> command and adding external constraints with the <code>--overrides</code> option, optional packages are missing for packages that have options and are overridden. However, they are present with the <code>--constraints</code> option.</p>
<h2>Example</h2>
<p>Suppose we have a requirements file and a file containing external constraints:</p>
<h3>requirements.txt</h3>
<pre><code class="language-txt">dvc[gs]==3.50.3
</code></pre>
<p>We get the following results:</p>
<h3>overrides.txt</h3>
<pre><code class="language-txt">dvc==3.50.3
dvc-data==3.15.2
dvc-gs==3.0.1
dvc-http==2.32.0
dvc-objects==5.1.0
dvc-render==1.0.2
dvc-studio-client==0.21.0
dvc-task==0.40.2
</code></pre>
<h2><code>--overrides</code></h2>
<p><code>uv pip compile requirements.txt --no-annotate --no-header --overrides overrides.txt -o lock.txt</code>:</p>
<pre><code class="language-txt"># ...
dvc==3.50.3
dvc-data==3.15.2
dvc-http==2.32.0
dvc-objects==5.1.0
dvc-render==1.0.2
dvc-studio-client==0.21.0
dvc-task==0.40.2
# ...
</code></pre>
<p><code>dvc-gs</code> and it's sub-dependencies are missing.</p>
<h2><code>--constraints</code></h2>
<p><code>uv pip compile requirements.txt --no-annotate --no-header --constraints overrides.txt -o lock.txt</code>:</p>
<pre><code class="language-txt"># ...
dvc==3.50.3
dvc-data==3.15.2
dvc-gs==3.0.1
dvc-http==2.32.0
dvc-objects==5.1.0
dvc-render==1.0.2
dvc-studio-client==0.21.0
dvc-task==0.40.2
# ...
gcsfs==2024.10.0
# ...
google-api-core==2.24.0
google-auth==2.37.0
google-auth-oauthlib==1.2.1
google-cloud-core==2.4.1
google-cloud-storage==2.18.2
google-crc32c==1.5.0
google-resumable-media==2.7.2
googleapis-common-protos==1.66.0
# ...
</code></pre>
<p><a href="https://github.com/user-attachments/files/18675126/lock_with_constraints.txt">lock_with_constraints.txt</a></p>
<p><a href="https://github.com/user-attachments/files/18675133/lock_with_overrides.txt">lock_with_overrides.txt</a></p>
<h3>Platform</h3>
<p>Ubuntu 20.04 (WSL)</p>
<h3>Version</h3>
<p>uv 0.5.28</p>
<h3>Python version</h3>
<p>Python 3.10.6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @tderwedu on 2025-02-05 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-05 16:05</div>
            <div class="timeline-body"><p>Ah yeah, this is intentional. Without this, there'd be no way to disable extras when overriding. If you want the extra to be enabled, you should include it in the overrides.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tderwedu">@tderwedu</a> on 2025-02-05 16:16</div>
            <div class="timeline-body"><p>@charliermarsh thanks for your quick answer!
You mean something like this:</p>
<pre><code class="language-txt">dvc[gs]==3.50.3
dvc==3.50.3
dvc-data==3.15.2
dvc-http==2.32.0
# ...
</code></pre>
<p>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-05 16:19</div>
            <div class="timeline-body"><p>Yeah, although if you have <code>dvc[gs]==3.50.3</code>, you can omit <code>dvc==3.50.3</code>.</p>
<p><code>dvc[gs]==3.50.3</code> already implies <code>dvc==3.50.3</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-02-05 23:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-02-05 23:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-02-05 23:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
