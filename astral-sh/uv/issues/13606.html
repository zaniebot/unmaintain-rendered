<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug? `uv sync` uses extra dependencies even when not requested - astral-sh/uv #13606</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Bug? `uv sync` uses extra dependencies even when not requested</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/13606">#13606</a>
        opened by <a href="https://github.com/Guitaricet">@Guitaricet</a>
        on 2025-05-22 23:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Guitaricet">@Guitaricet</a> on 2025-05-22 23:29</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Following <a href="https://docs.astral.sh/uv/concepts/projects/config/#build-isolation">the tutorial for no-build-isolation</a> dependencies but replacing <code>flash-attn</code> with a package provided via github link seems to break uv sync.</p>
<p>Specifically, even though I do not provide <code>--extra compile</code> it seems to try to install compile-time dependency (tried with both no <code>--extra</code> and with <code>--extra build</code>)</p>
<p>Am I missing something in the configuration or is it a uv bug?</p>
<pre><code>[project]
name = &quot;project&quot;
version = &quot;0.1.0&quot;
description = &quot;...&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = []

[project.optional-dependencies]
build = [&quot;torch&quot;, &quot;setuptools&quot;, &quot;packaging&quot;]
compile = [&quot;mmpose&quot;]

[tool.uv]
no-build-isolation-package = [&quot;mmpose&quot;]

[[tool.uv.dependency-metadata]]
name = &quot;mmpose&quot;
requires-dist = [&quot;torch&quot;, &quot;setuptools&quot;]

[tool.uv.sources]
mmpose = { git = &quot;https://github.com/ViTAE-Transformer/ViTPose.git&quot;, rev = &quot;d5216452796c90c6bc29f5c5ec0bdba94366768a&quot; }
</code></pre>
<p>Error:</p>
<pre><code>vlad@bfgpu2 ~/w/a/a/not_giga_track ❯❯❯ uv sync --extra build --no-cache --verbose
DEBUG uv 0.7.7
DEBUG Found project root: `/home/vlad/worktrees/add_hamer/apps/not_giga_track`
DEBUG Project is contained in non-workspace project: `/home/vlad/worktrees/add_hamer/apps`
DEBUG No workspace root found, using project root
DEBUG Acquired lock for `/home/vlad/worktrees/add_hamer/apps/not_giga_track`
DEBUG No Python version file found in workspace: /home/vlad/worktrees/add_hamer/apps/not_giga_track
DEBUG Using Python request `&gt;=3.10` from `requires-python` metadata
DEBUG Checking for Python environment at `.venv`
DEBUG The project environment's Python version satisfies the request: `Python &gt;=3.10`
DEBUG Released lock at `/tmp/uv-8a3054bb6e5225fb.lock`
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: project @ file:///home/vlad/worktrees/add_hamer/apps/not_giga_track
DEBUG Project is contained in non-workspace project: `/home/vlad/worktrees/add_hamer/apps`
DEBUG No workspace root found, using project root
WARN No version found in dependency metadata entry for `mmpose`
DEBUG Attempting GitHub fast path for: mmpose @ git+https://github.com/ViTAE-Transformer/ViTPose.git@d5216452796c90c6bc29f5c5ec0bdba94366768a
DEBUG Querying GitHub for commit at: https://api.github.com/repos/ViTAE-Transformer/ViTPose/commits/d5216452796c90c6bc29f5c5ec0bdba94366768a
DEBUG Attempting to fetch `pyproject.toml` from: https://raw.githubusercontent.com/ViTAE-Transformer/ViTPose/d5216452796c90c6bc29f5c5ec0bdba94366768a/pyproject.toml
DEBUG Checking netrc for credentials for https://raw.githubusercontent.com/ViTAE-Transformer/ViTPose/d5216452796c90c6bc29f5c5ec0bdba94366768a/pyproject.toml
DEBUG GitHub API returned a 404 for: https://raw.githubusercontent.com/ViTAE-Transformer/ViTPose/d5216452796c90c6bc29f5c5ec0bdba94366768a/pyproject.toml
DEBUG Fetching source distribution from Git: https://github.com/ViTAE-Transformer/ViTPose.git
DEBUG Acquired lock for `https://github.com/vitae-transformer/vitpose`
DEBUG Updating Git source `https://github.com/ViTAE-Transformer/ViTPose.git`
   Updating https://github.com/ViTAE-Transformer/ViTPose.git (d5216452796c90c6bc29f5c5ec0bdba94366768a)
DEBUG Skipping GitHub fast path; full commit hash provided: d5216452796c90c6bc29f5c5ec0bdba94366768a
DEBUG Performing a Git fetch for: https://github.com/ViTAE-Transformer/ViTPose.git
DEBUG Reset /tmp/.tmpU1NP9H/git-v0/checkouts/a4bbcc9f2738db1d/d521645 to d5216452796c90c6bc29f5c5ec0bdba94366768a
    Updated https://github.com/ViTAE-Transformer/ViTPose.git (d5216452796c90c6bc29f5c5ec0bdba94366768a)
DEBUG Released lock at `/tmp/.tmpU1NP9H/git-v0/locks/a4bbcc9f2738db1d`
DEBUG Acquired lock for `/tmp/.tmpU1NP9H/sdists-v9/git/3db644b052beafe6/d5216452796c90c6`
DEBUG No `pyproject.toml` available for: mmpose @ git+https://github.com/ViTAE-Transformer/ViTPose.git@d5216452796c90c6bc29f5c5ec0bdba94366768a
DEBUG No static `PKG-INFO` available for: mmpose @ git+https://github.com/ViTAE-Transformer/ViTPose.git@d5216452796c90c6bc29f5c5ec0bdba94366768a (MissingPkgInfo)
DEBUG Preparing metadata for: mmpose @ git+https://github.com/ViTAE-Transformer/ViTPose.git@d5216452796c90c6bc29f5c5ec0bdba94366768a
DEBUG Proceeding without build isolation
DEBUG Calling `setuptools.build_meta:__legacy__.prepare_metadata_for_build_wheel()`
DEBUG Traceback (most recent call last):
DEBUG   File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
DEBUG     from setuptools.build_meta import __legacy__ as backend
DEBUG ModuleNotFoundError: No module named 'setuptools'
DEBUG Released lock at `/tmp/.tmpU1NP9H/sdists-v9/git/3db644b052beafe6/d5216452796c90c6/.lock`
  × Failed to build `mmpose @ git+https://github.com/ViTAE-Transformer/ViTPose.git@d5216452796c90c6bc29f5c5ec0bdba94366768a`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.prepare_metadata_for_build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 8, in &lt;module&gt;
          from setuptools.build_meta import __legacy__ as backend
      ModuleNotFoundError: No module named 'setuptools'

      hint: This usually indicates a problem with the package or the build environment.
</code></pre>
<h3>Platform</h3>
<p>Ubuntu 22.04</p>
<h3>Version</h3>
<p>0.7.7</p>
<h3>Python version</h3>
<p>3.10, 3.12</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Guitaricet on 2025-05-22 23:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-22 23:48</div>
            <div class="timeline-body"><p>What you're seeing there is actually a failure to resolve the <em>dependencies</em> for <code>mmpose</code>. We still need to resolve the dependencies for all extras, since we create a universal lockfile for all the dependencies in the project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-05-22 23:50</div>
            <div class="timeline-body"><p>If you want to avoid resolving, you should be able to get this working with:</p>
<pre><code class="language-toml">[[tool.uv.dependency-metadata]]
name = &quot;ViTPose&quot;
version = &quot;0.24.0&quot;
requires-dist = [
    &quot;chumpy&quot;,
    &quot;dataclasses; python_version == '3.6'&quot;,
    &quot;json_tricks&quot;,
    &quot;matplotlib&quot;,
    &quot;munkres&quot;,
    &quot;numpy&quot;,
    &quot;opencv-python&quot;,
    &quot;pillow&quot;,
    &quot;scipy&quot;,
    &quot;torchvision&quot;,
    &quot;xtcocotools&gt;=1.8&quot;,
]
</code></pre>
<p>That tells uv what metadata to expect, so it can skip the build. (I didn't test this, sorry!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-05-23 08:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-05-23 08:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-05-24 12:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:27 UTC
    </footer>
</body>
</html>
