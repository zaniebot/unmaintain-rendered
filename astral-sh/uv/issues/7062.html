<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>perf: `uv build` is slower on the second run compared to `uvx hatch build` - astral-sh/uv #7062</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>perf: <code>uv build</code> is slower on the second run compared to <code>uvx hatch build</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7062">#7062</a>
        opened by <a href="https://github.com/pplmx">@pplmx</a>
        on 2024-09-05 02:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pplmx">@pplmx</a></div>
            <div class="timeline-body"><h2>Reproduce Steps</h2>
<h3>1. Using <code>uv build</code></h3>
<pre><code class="language-bash">cookiecutter gh:x-pt/template --directory template/py --no-input &amp;&amp; \
cd my-awesome-project &amp;&amp; \
uv sync &amp;&amp; \
time uv build &amp;&amp; \
time uv build &amp;&amp; \
time uv build &amp;&amp; \
time uv build &amp;&amp; \
cd .. &amp;&amp; rm -fr my-awesome-project
</code></pre>
<h3>2. Using <code>uvx hatch build</code></h3>
<pre><code class="language-bash">cookiecutter gh:x-pt/template --directory template/py --no-input &amp;&amp; \
cd my-awesome-project &amp;&amp; \
uv sync &amp;&amp; \
time uvx hatch build &amp;&amp; \
time uvx hatch build &amp;&amp; \
time uvx hatch build &amp;&amp; \
time uvx hatch build &amp;&amp; \
cd .. &amp;&amp; rm -fr my-awesome-project
</code></pre>
<h3>Additional Information</h3>
<ul>
<li><strong>Inconsistent Performance:</strong> It's worth noting that the first build with <code>uv build</code> is <strong>not always faster</strong> compared to <code>uvx hatch build</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-05 02:18</div>
            <div class="timeline-body"><p>I don't know if there's a ton for us to optimize here but we can look into it. The majority of the time is in invoking the Python interpreter and calling the build backend.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @charliermarsh on 2024-09-05 02:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-05 02:27</div>
            <div class="timeline-body"><p>There's so little work happening here that my guess is Hatch benefits from building a project that uses <code>hatchling</code> as its own backend, so there's less overhead? Like, we're probably paying overhead to invoke Python several times.</p>
<p>If you compare <code>uv build</code> to <code>python -m build --installer uv</code>, I believe <code>uv build</code> is faster (so, e.g., if you try the same thing with a setuptools project, I would guess uv will be faster).</p>
<p>We'll get similar benefits when we build our own build backend!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pplmx">@pplmx</a> on 2024-09-05 02:44</div>
            <div class="timeline-body"><p>Expect the UV's own build backend to be used. ‚ù§Ô∏è</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2024-09-06 20:50</div>
            <div class="timeline-body"><blockquote>
<p>If you compare <code>uv build</code> to <code>python -m build --installer uv</code>, I believe uv build is faster</p>
</blockquote>
<p>Hopefully @matthewfeickert doesn't mind me stealing this from him:</p>
<pre><code class="language-console">$ time pipx run build .
* Creating isolated environment: venv+pip...
* Installing packages in isolated environment:
  - hatch-vcs&gt;=0.3.0
  - hatchling&gt;=1.13.0
* Getting build dependencies for sdist...
* Building sdist...
* Building wheel from sdist
* Creating isolated environment: venv+pip...
* Installing packages in isolated environment:
  - hatch-vcs&gt;=0.3.0
  - hatchling&gt;=1.13.0
* Getting build dependencies for wheel...
* Building wheel...
Successfully built pyhf-0.7.1.dev273.tar.gz and pyhf-0.7.1.dev273-py3-none-any.whl

real	0m3.087s
user	0m2.299s
sys	0m0.282s
$ rm -rf dist &amp;&amp; time pipx run build --installer uv .
* Creating isolated environment: venv+uv...
* Using external uv from /home/feickert/.pyenv/shims/uv
* Installing packages in isolated environment:
  - hatch-vcs&gt;=0.3.0
  - hatchling&gt;=1.13.0
* Getting build dependencies for sdist...
* Building sdist...
* Building wheel from sdist
* Creating isolated environment: venv+uv...
* Using external uv from /home/feickert/.pyenv/shims/uv
* Installing packages in isolated environment:
  - hatch-vcs&gt;=0.3.0
  - hatchling&gt;=1.13.0
* Getting build dependencies for wheel...
* Building wheel...
Successfully built pyhf-0.7.1.dev273.tar.gz and pyhf-0.7.1.dev273-py3-none-any.whl

real	0m1.214s
user	0m0.971s
sys	0m0.278s
$ rm -rf dist
$ time uv build
Building source distribution...
Building wheel from source distribution...
Successfully built dist/pyhf-0.7.1.dev273.tar.gz and dist/pyhf-0.7.1.dev273-py3-none-any.whl

real	0m0.799s
user	0m0.634s
sys	0m0.193s
</code></pre>
<p>And if there was a Rust build backend (like maturin) and uv could skip Python entirely when calling it (like <code>maturin</code> the command does), I'd expect <code>uv build</code> would be ridiculously fast in that case. But under a second isn't bad. :) For a built package though, the compiler takes most of the time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-06 20:59</div>
            <div class="timeline-body"><blockquote>
<p>...uv could skip Python entirely when calling it (like maturin the command does), I'd expect uv build would be ridiculously fast in that case.</p>
</blockquote>
<p>Yeah this is one of the motivations. Would be really cool!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-16 19:20</div>
            <div class="timeline-body"><p>I think we can probably close this now? The uv-native build backend is basically instant (&lt;10ms):</p>
<pre><code>‚ùØ hyperfine &quot;uv build&quot;
Benchmark 1: uv build
  Time (mean ¬± œÉ):       7.2 ms ¬±   0.2 ms    [User: 3.4 ms, System: 3.3 ms]
  Range (min ‚Ä¶ max):     6.8 ms ‚Ä¶   9.1 ms    299 runs
</code></pre>
<p>(It's still in <code>--preview</code>, we don't recommend using it for real projects yet.)</p>
<p>Meanwhile, comparing <code>hatchling</code> with <code>uv build</code> vs. <code>uvx hatch build</code> is still pretty decent given that we can't use a fast-path:</p>
<pre><code>‚ùØ hyperfine &quot;uv build&quot;
Benchmark 1: uv build
  Time (mean ¬± œÉ):     300.9 ms ¬±   2.2 ms    [User: 215.5 ms, System: 78.7 ms]
  Range (min ‚Ä¶ max):   297.4 ms ‚Ä¶ 304.5 ms    10 runs

my-awesome-project on ÓÇ† main [?] is üì¶ v0.0.1 via üêç v3.11.6 took 3s
‚ùØ hyperfine &quot;uvx hatch build&quot;
Benchmark 1: uvx hatch build
  Time (mean ¬± œÉ):     232.6 ms ¬±   1.6 ms    [User: 184.0 ms, System: 60.6 ms]
  Range (min ‚Ä¶ max):   230.5 ms ‚Ä¶ 235.4 ms    12 runs
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-16 19:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:53 UTC
    </footer>
</body>
</html>
