```yaml
number: 827
title: Lack of prerelease selection coerces older versions
type: issue
state: closed
author: konstin
labels: []
assignees: []
created_at: 2024-01-08T09:41:19Z
updated_at: 2024-04-04T04:02:44Z
url: https://github.com/astral-sh/uv/issues/827
synced_at: 2026-01-10T01:57:01Z
```

# Lack of prerelease selection coerces older versions

---

_Issue opened by @konstin on 2024-01-08 09:41_

Puffin currently only uses prereleases that were explicitly selected on the top level. This means we reject any dependency version depending on a prerelease. E.g. for `transformers[accelerate,agents,audio,codecarbon,deepspeed,deepspeed-testing,dev,dev-tensorflow,dev-torch,flax,flax-speech,ftfy,integrations,ja,modelcreation,onnx,onnxruntime,optuna,quality,ray,retrieval,sagemaker,sentencepiece,sigopt,sklearn,speech,testing,tf,tf-cpu,tf-speech,timm,tokenizers,torch,torch-speech,torch-vision,torchhub,video,vision]` on python 3.8, we get a different resolution than pip coercing older versions, because `clldutils` 3.22.1 dependson bibtexparser>=2.0.0b4.

pip:
```
['absl-py==2.0.0', 'accelerate==0.25.0', 'aiohttp==3.9.1', 'aiosignal==1.3.1', 'alembic==1.13.1', 'ansi2html==1.9.1', 'anyio==4.2.0', 'apscheduler==3.10.4', 'arrow==1.3.0', 'astunparse==1.6.3', 'async-timeout==4.0.3', 'attrs==23.2.0', 'audioread==3.0.1', 'av==9.2.0', 'babel==2.14.0', 'backoff==1.11.1', 'backports-zoneinfo==0.2.1', 'beautifulsoup4==4.12.2', 'bibtexparser==2.0.0b5', 'binaryornot==0.4.4', 'blinker==1.7.0', 'boto3==1.34.14', 'botocore==1.34.14', 'cached-property==1.5.2', 'cachetools==5.3.2', 'certifi==2023.11.17', 'cffi==1.16.0', 'chardet==5.2.0', 'charset-normalizer==3.3.2', 'chex==0.1.7', 'click==8.1.7', 'clldutils==3.22.1', 'cloudpickle==2.2.1', 'codecarbon==1.2.0', 'colorama==0.4.6', 'coloredlogs==15.0.1', 'colorlog==6.8.0', 'contextlib2==21.6.0', 'cookiecutter==1.7.3', 'csvw==3.2.1', 'dash-bootstrap-components==1.5.0', 'dash-core-components==2.0.0', 'dash-html-components==2.0.0', 'dash-table==5.0.0', 'dash==2.14.2', 'datasets==2.16.1', 'decorator==5.1.1', 'decord==0.6.0', 'deepspeed==0.12.6', 'diffusers==0.25.0', 'dill==0.3.4', 'dlinfo==1.2.1', 'dm-tree==0.1.8', 'docker==7.0.0', 'etils==1.3.0', 'evaluate==0.4.1', 'exceptiongroup==1.2.0', 'execnet==2.0.2', 'faiss-cpu==1.7.4', 'fastapi==0.95.2', 'fastjsonschema==2.19.1', 'filelock==3.13.1', 'fire==0.5.0', 'flask==3.0.0', 'flatbuffers==23.5.26', 'flax==0.7.0', 'frozenlist==1.4.1', 'fsspec==2023.10.0', 'ftfy==6.1.3', 'fugashi==1.3.0', 'gast==0.4.0', 'gitdb==4.0.11', 'gitpython==3.1.18', 'google-auth-oauthlib==1.0.0', 'google-auth==2.26.1', 'google-pasta==0.2.0', 'gql==3.5.0', 'graphql-core==3.2.3', 'greenlet==3.0.3', 'grpcio==1.60.0', 'h11==0.14.0', 'h5py==3.10.0', 'hf-doc-builder==0.4.0', 'hjson==3.1.0', 'huggingface-hub==0.20.2', 'humanfriendly==10.0', 'hypothesis==6.92.4', 'idna==3.6', 'importlib-metadata==6.11.0', 'importlib-resources==6.1.1', 'iniconfig==2.0.0', 'ipadic==1.0.0', 'isodate==0.6.1', 'isort==5.13.2', 'itsdangerous==2.1.2', 'jax==0.4.13', 'jaxlib==0.4.13', 'jinja2-time==0.2.0', 'jinja2==3.1.2', 'jmespath==1.0.1', 'joblib==1.3.2', 'jsonschema-specifications==2023.12.1', 'jsonschema==4.20.0', 'jupyter-core==5.7.0', 'kenlm==0.2.0', 'keras-core==0.1.5', 'keras-nlp==0.6.1', 'keras==2.13.1', 'language-tags==1.2.0', 'lazy-loader==0.3', 'libclang==16.0.6', 'librosa==0.10.1', 'llvmlite==0.41.1', 'lxml==5.1.0', 'mako==1.3.0', 'markdown-it-py==3.0.0', 'markdown==3.5.1', 'markupsafe==2.1.3', 'mdurl==0.1.2', 'ml-dtypes==0.2.0', 'mpmath==1.3.0', 'msgpack==1.0.7', 'multidict==6.0.4', 'multiprocess==0.70.12.2', 'namex==0.0.7', 'nbformat==5.9.2', 'nest-asyncio==1.5.8', 'networkx==3.1', 'ninja==1.11.1.1', 'nltk==3.8.1', 'numba==0.58.1', 'numpy==1.24.3', 'nvidia-cublas-cu12==12.1.3.1', 'nvidia-cuda-cupti-cu12==12.1.105', 'nvidia-cuda-nvrtc-cu12==12.1.105', 'nvidia-cuda-runtime-cu12==12.1.105', 'nvidia-cudnn-cu12==8.9.2.26', 'nvidia-cufft-cu12==11.0.2.54', 'nvidia-curand-cu12==10.3.2.106', 'nvidia-cusolver-cu12==11.4.5.107', 'nvidia-cusparse-cu12==12.1.0.106', 'nvidia-nccl-cu12==2.18.1', 'nvidia-nvjitlink-cu12==12.3.101', 'nvidia-nvtx-cu12==12.1.105', 'oauthlib==3.2.2', 'onnx==1.15.0', 'onnxconverter-common==1.13.0', 'onnxruntime-tools==1.7.0', 'onnxruntime==1.16.3', 'opencv-python==4.9.0.80', 'opt-einsum==3.3.0', 'optax==0.1.4', 'optuna==3.5.0', 'orbax-checkpoint==0.2.3', 'packaging==23.2', 'pandas==2.0.3', 'parameterized==0.9.0', 'pathos==0.2.8', 'phonemizer==3.2.1', 'pillow==10.2.0', 'pkgutil-resolve-name==1.3.10', 'plac==1.4.2', 'platformdirs==4.1.0', 'plotly==5.18.0', 'pluggy==1.3.0', 'pooch==1.8.0', 'portalocker==2.0.0', 'pox==0.3.3', 'poyo==0.5.0', 'ppft==1.7.6.7', 'protobuf==3.20.3', 'psutil==5.9.7', 'py-cpuinfo==9.0.0', 'py3nvml==0.2.7', 'pyarrow-hotfix==0.6', 'pyarrow==14.0.2', 'pyasn1-modules==0.3.0', 'pyasn1==0.5.1', 'pycparser==2.21', 'pyctcdecode==0.5.0', 'pydantic==1.10.13', 'pygments==2.17.2', 'pygtrie==2.5.0', 'pylatexenc==2.10', 'pynvml==11.5.0', 'pyparsing==3.1.1', 'pypng==0.20220715.0', 'pytest-timeout==2.2.0', 'pytest-xdist==3.5.0', 'pytest==7.4.4', 'python-dateutil==2.8.2', 'python-slugify==8.0.1', 'pytz==2023.3.post1', 'pyyaml==6.0.1', 'ray==2.9.0', 'rdflib==7.0.0', 'referencing==0.32.1', 'regex==2023.12.25', 'requests-oauthlib==1.3.1', 'requests-toolbelt==1.0.0', 'requests==2.31.0', 'responses==0.18.0', 'retrying==1.3.4', 'rfc3986==1.5.0', 'rhoknp==1.3.0', 'rich==13.7.0', 'rjieba==0.1.11', 'rouge-score==0.1.2', 'rpds-py==0.16.2', 'rsa==4.9', 'ruff==0.1.5', 's3transfer==0.10.0', 'sacrebleu==1.5.1', 'sacremoses==0.1.1', 'safetensors==0.4.1', 'sagemaker==2.203.0', 'schema==0.7.5', 'scikit-learn==1.3.2', 'scipy==1.10.1', 'segments==2.2.1', 'sentencepiece==0.1.99', 'setuptools==69.0.3', 'sigopt==8.8.2', 'six==1.16.0', 'smdebug-rulesconfig==1.0.1', 'smmap==5.0.1', 'sniffio==1.3.0', 'sortedcontainers==2.4.0', 'soundfile==0.12.1', 'soupsieve==2.5', 'soxr==0.3.7', 'sqlalchemy==2.0.24', 'starlette==0.27.0', 'sudachidict-core==20230927', 'sudachipy==0.6.8', 'sympy==1.12', 'tabulate==0.9.0', 'tblib==2.0.0', 'tenacity==8.2.3', 'tensorboard-data-server==0.7.2', 'tensorboard==2.13.0', 'tensorboardx==2.6.2.2', 'tensorflow-cpu==2.13.1', 'tensorflow-estimator==2.13.0', 'tensorflow-hub==0.15.0', 'tensorflow-io-gcs-filesystem==0.34.0', 'tensorflow-text==2.13.0', 'tensorflow==2.13.1', 'tensorstore==0.1.45', 'termcolor==2.4.0', 'text-unidecode==1.3', 'tf2onnx==1.16.0', 'threadpoolctl==3.2.0', 'timeout-decorator==0.5.0', 'timm==0.9.12', 'tokenizers==0.15.0', 'tomli==2.0.1', 'toolz==0.12.0', 'torch==2.1.2', 'torchaudio==2.1.2', 'torchvision==0.16.2', 'tqdm==4.66.1', 'traitlets==5.14.1', 'transformers==4.36.2', 'triton==2.1.0', 'types-python-dateutil==2.8.19.20240106', 'typing-extensions==4.5.0', 'tzdata==2023.4', 'tzlocal==5.2', 'unidic-lite==1.0.8', 'unidic==1.1.0', 'uritemplate==4.1.1', 'urllib3==1.26.18', 'uvicorn==0.22.0', 'wasabi==0.10.1', 'wcwidth==0.2.13', 'werkzeug==3.0.1', 'wheel==0.42.0', 'wrapt==1.16.0', 'xmltodict==0.13.0', 'xxhash==3.4.1', 'yarl==1.9.4', 'zipp==3.17.0']
```

puffin:
```
['absl-py==2.0.0', 'accelerate==0.25.0', 'aiohttp==3.9.1', 'aiosignal==1.3.1', 'alembic==1.13.1', 'ansi2html==1.9.1', 'anyio==4.2.0', 'apscheduler==3.10.4', 'arrow==1.3.0', 'astunparse==1.6.3', 'async-timeout==4.0.3', 'attrs==23.2.0', 'audioread==3.0.1', 'av==9.2.0', 'babel==2.14.0', 'backoff==1.11.1', 'backports-zoneinfo==0.2.1', 'beautifulsoup4==4.12.2', 'binaryornot==0.4.4', 'blinker==1.7.0', 'boto3==1.34.14', 'botocore==1.34.14', 'cached-property==1.5.2', 'cachetools==5.3.2', 'certifi==2023.11.17', 'cffi==1.16.0', 'chardet==5.2.0', 'charset-normalizer==3.3.2', 'chex==0.1.7', 'click==8.1.7', 'clldutils==3.21.0', 'cloudpickle==2.2.1', 'codecarbon==1.2.0', 'colorama==0.4.6', 'coloredlogs==15.0.1', 'colorlog==6.8.0', 'contextlib2==21.6.0', 'cookiecutter==1.7.3', 'csvw==3.2.1', 'dash-bootstrap-components==1.5.0', 'dash-core-components==2.0.0', 'dash-html-components==2.0.0', 'dash-table==5.0.0', 'dash==2.14.2', 'datasets==2.16.1', 'decorator==5.1.1', 'decord==0.6.0', 'deepspeed==0.12.6', 'diffusers==0.25.0', 'dill==0.3.4', 'dlinfo==1.2.1', 'dm-tree==0.1.8', 'docker==7.0.0', 'etils==1.3.0', 'evaluate==0.4.1', 'exceptiongroup==1.2.0', 'execnet==2.0.2', 'faiss-cpu==1.7.4', 'fastapi==0.95.2', 'fastjsonschema==2.19.1', 'filelock==3.13.1', 'fire==0.5.0', 'flask==3.0.0', 'flatbuffers==2.0.7', 'flax==0.7.0', 'frozenlist==1.4.1', 'fsspec==2023.10.0', 'ftfy==6.1.3', 'fugashi==1.3.0', 'gast==0.4.0', 'gitdb==4.0.11', 'gitpython==3.1.18', 'google-auth-oauthlib==0.4.6', 'google-auth==2.26.1', 'google-pasta==0.2.0', 'gql==3.5.0', 'graphql-core==3.2.3', 'greenlet==3.0.3', 'grpcio==1.60.0', 'h11==0.14.0', 'h5py==3.10.0', 'hf-doc-builder==0.4.0', 'hjson==3.1.0', 'huggingface-hub==0.20.2', 'humanfriendly==10.0', 'hypothesis==6.92.4', 'idna==3.6', 'importlib-metadata==6.11.0', 'importlib-resources==6.1.1', 'iniconfig==2.0.0', 'ipadic==1.0.0', 'isodate==0.6.1', 'isort==5.13.2', 'itsdangerous==2.1.2', 'jax==0.4.13', 'jaxlib==0.4.13', 'jinja2-time==0.2.0', 'jinja2==3.1.2', 'jmespath==1.0.1', 'joblib==1.3.2', 'jsonschema-specifications==2023.12.1', 'jsonschema==4.20.0', 'jupyter-core==5.7.0', 'kenlm==0.2.0', 'keras-core==0.1.5', 'keras-nlp==0.6.1', 'keras==2.11.0', 'language-tags==1.2.0', 'lazy-loader==0.3', 'libclang==16.0.6', 'librosa==0.10.1', 'llvmlite==0.41.1', 'lxml==5.1.0', 'mako==1.3.0', 'markdown-it-py==3.0.0', 'markdown==3.5.1', 'markupsafe==2.1.3', 'mdurl==0.1.2', 'ml-dtypes==0.2.0', 'mpmath==1.3.0', 'msgpack==1.0.7', 'multidict==6.0.4', 'multiprocess==0.70.12.2', 'namex==0.0.7', 'nbformat==5.9.2', 'nest-asyncio==1.5.8', 'networkx==3.1', 'ninja==1.11.1.1', 'nltk==3.8.1', 'numba==0.58.1', 'numpy==1.24.4', 'nvidia-cublas-cu12==12.1.3.1', 'nvidia-cuda-cupti-cu12==12.1.105', 'nvidia-cuda-nvrtc-cu12==12.1.105', 'nvidia-cuda-runtime-cu12==12.1.105', 'nvidia-cudnn-cu12==8.9.2.26', 'nvidia-cufft-cu12==11.0.2.54', 'nvidia-curand-cu12==10.3.2.106', 'nvidia-cusolver-cu12==11.4.5.107', 'nvidia-cusparse-cu12==12.1.0.106', 'nvidia-nccl-cu12==2.18.1', 'nvidia-nvjitlink-cu12==12.3.101', 'nvidia-nvtx-cu12==12.1.105', 'oauthlib==3.2.2', 'onnx==1.12.0', 'onnxconverter-common==1.13.0', 'onnxruntime-tools==1.7.0', 'onnxruntime==1.16.3', 'opencv-python==4.9.0.80', 'opt-einsum==3.3.0', 'optax==0.1.4', 'optuna==3.5.0', 'orbax-checkpoint==0.2.3', 'packaging==23.2', 'pandas==2.0.3', 'parameterized==0.9.0', 'pathos==0.2.8', 'phonemizer==3.2.1', 'pillow==10.2.0', 'pkgutil-resolve-name==1.3.10', 'plac==1.4.2', 'platformdirs==4.1.0', 'plotly==5.18.0', 'pluggy==1.3.0', 'pooch==1.8.0', 'portalocker==2.0.0', 'pox==0.3.3', 'poyo==0.5.0', 'ppft==1.7.6.7', 'protobuf==3.19.6', 'psutil==5.9.7', 'py-cpuinfo==9.0.0', 'py3nvml==0.2.7', 'pyarrow-hotfix==0.6', 'pyarrow==14.0.2', 'pyasn1-modules==0.3.0', 'pyasn1==0.5.1', 'pycparser==2.21', 'pyctcdecode==0.5.0', 'pydantic==1.10.13', 'pygments==2.17.2', 'pygtrie==2.5.0', 'pylatexenc==2.10', 'pynvml==11.5.0', 'pyparsing==3.1.1', 'pypng==0.20220715.0', 'pytest-timeout==2.2.0', 'pytest-xdist==3.5.0', 'pytest==7.4.4', 'python-dateutil==2.8.2', 'python-slugify==8.0.1', 'pytz==2023.3.post1', 'pyyaml==6.0.1', 'ray==2.9.0', 'rdflib==6.3.2', 'referencing==0.32.1', 'regex==2023.12.25', 'requests-oauthlib==1.3.1', 'requests-toolbelt==1.0.0', 'requests==2.31.0', 'responses==0.18.0', 'retrying==1.3.4', 'rfc3986==1.5.0', 'rhoknp==1.3.0', 'rich==13.7.0', 'rjieba==0.1.11', 'rouge-score==0.1.2', 'rpds-py==0.16.2', 'rsa==4.9', 'ruff==0.1.5', 's3transfer==0.10.0', 'sacrebleu==1.5.1', 'sacremoses==0.1.1', 'safetensors==0.4.1', 'sagemaker==2.203.0', 'schema==0.7.5', 'scikit-learn==1.3.2', 'scipy==1.10.1', 'segments==2.2.1', 'sentencepiece==0.1.99', 'setuptools==69.0.3', 'sigopt==8.8.2', 'six==1.16.0', 'smdebug-rulesconfig==1.0.1', 'smmap==5.0.1', 'sniffio==1.3.0', 'sortedcontainers==2.4.0', 'soundfile==0.12.1', 'soupsieve==2.5', 'soxr==0.3.7', 'sqlalchemy==2.0.25', 'starlette==0.27.0', 'sudachidict-core==20230927', 'sudachipy==0.6.8', 'sympy==1.12', 'tabulate==0.9.0', 'tblib==2.0.0', 'tenacity==8.2.3', 'tensorboard-data-server==0.6.1', 'tensorboard-plugin-wit==1.8.1', 'tensorboard==2.11.2', 'tensorboardx==2.6', 'tensorflow-cpu==2.11.1', 'tensorflow-estimator==2.11.0', 'tensorflow-hub==0.15.0', 'tensorflow-io-gcs-filesystem==0.34.0', 'tensorflow-text==2.11.0', 'tensorflow==2.11.1', 'tensorstore==0.1.45', 'termcolor==2.4.0', 'text-unidecode==1.3', 'tf2onnx==1.14.0', 'threadpoolctl==3.2.0', 'timeout-decorator==0.5.0', 'timm==0.9.12', 'tokenizers==0.15.0', 'tomli==2.0.1', 'toolz==0.12.0', 'torch==2.1.2', 'torchaudio==2.1.2', 'torchvision==0.16.2', 'tqdm==4.66.1', 'traitlets==5.14.1', 'transformers==4.36.2', 'triton==2.1.0', 'types-python-dateutil==2.8.19.20240106', 'typing-extensions==4.9.0', 'tzdata==2023.4', 'tzlocal==5.2', 'unidic-lite==1.0.8', 'unidic==1.1.0', 'uritemplate==4.1.1', 'urllib3==1.26.18', 'uvicorn==0.22.0', 'wasabi==0.10.1', 'wcwidth==0.2.13', 'werkzeug==3.0.1', 'wheel==0.42.0', 'wrapt==1.16.0', 'xmltodict==0.13.0', 'xxhash==3.4.1', 'yarl==1.9.4', 'zipp==3.17.0']
```

```diff
- bibtexparser==2.0.0b5
+ clldutils==3.21.0
- clldutils==3.22.1
+ flatbuffers==2.0.7
- flatbuffers==23.5.26
+ google-auth-oauthlib==0.4.6
- google-auth-oauthlib==1.0.0
+ keras==2.11.0
- keras==2.13.1
- numpy==1.24.3
+ numpy==1.24.4
+ onnx==1.12.0
- onnx==1.15.0
+ protobuf==3.19.6
- protobuf==3.20.3
+ rdflib==6.3.2
- rdflib==7.0.0
- sqlalchemy==2.0.24
+ sqlalchemy==2.0.25
+ tensorboard-data-server==0.6.1
- tensorboard-data-server==0.7.2
+ tensorboard-plugin-wit==1.8.1
+ tensorboard==2.11.2
- tensorboard==2.13.0
+ tensorboardx==2.6
- tensorboardx==2.6.2.2
+ tensorflow-cpu==2.11.1
- tensorflow-cpu==2.13.1
+ tensorflow-estimator==2.11.0
- tensorflow-estimator==2.13.0
+ tensorflow-text==2.11.0
- tensorflow-text==2.13.0
+ tensorflow==2.11.1
- tensorflow==2.13.1
+ tf2onnx==1.14.0
- tf2onnx==1.16.0
- typing-extensions==4.5.0
+ typing-extensions==4.9.0
```

---

_Comment by @charliermarsh on 2024-01-08 14:33_

I think ours is arguably more correct per the spec though.

---

_Comment by @konstin on 2024-01-08 14:38_

I would argue pip's is more per spec :smile: PEP 440 is _vague_. `bibtexparser>=2.0.0b4` is a version specifier that can only be satisfied by a prerelease (no stable 2.0.0), so pip accepts the prerelease `bibtexparser==2.0.0b5`.

---

_Comment by @charliermarsh on 2024-01-08 14:40_

But we find a resolution that doesn't require any prereleases, so prereleases are not required to satisfy the requirements :joy:

---

_Comment by @charliermarsh on 2024-04-04 04:02_

I think our behavior here is ok.

---

_Closed by @charliermarsh on 2024-04-04 04:02_

---
