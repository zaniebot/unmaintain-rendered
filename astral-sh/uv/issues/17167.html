<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip sync` is unable to install a package present in explicit custom index defined in pyproject.toml - astral-sh/uv #17167</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip sync</code> is unable to install a package present in explicit custom index defined in pyproject.toml</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17167">#17167</a>
        opened by <a href="https://github.com/pstrzelczak">@pstrzelczak</a>
        on 2025-12-18 07:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pstrzelczak">@pstrzelczak</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I maintain requirements.txt file generated via <code>uv pip compile -o requirements.txt pyproject.toml</code> and use <code>uv pip sync requirements.txt</code> later on. However, seems like the <code>uv pip sync</code>  is unable to install a package present in explicit custom index defined in pyproject.toml</p>
<pre><code>$ cat pyproject.toml 
[project]
name = &quot;a&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;test007test&quot;,
]

# 1. Define the custom index
[[tool.uv.index]]
name = &quot;testpypi&quot;
url = &quot;https://test.pypi.org/simple/&quot;
explicit = true

# 2. Pin the specific package to that index
[tool.uv.sources]
test007test = { index = &quot;testpypi&quot; }

$ uv pip compile pyproject.toml &gt; requirements.txt
Resolved 1 package in 2ms

$ cat requirements.txt 
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml
test007test==0.0.1
    # via a (pyproject.toml)

$ uv pip sync requirements.txt 
Using Python 3.12.3 environment at: /tmp/uv-py12
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of test007test==0.0.1 and you require test007test==0.0.1, we can conclude that your requirements are unsatisfiable.
</code></pre>
<h3>Platform</h3>
<p>Ubuntu 24.04</p>
<h3>Version</h3>
<p>0.9.18</p>
<h3>Python version</h3>
<p>3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @pstrzelczak on 2025-12-18 07:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 17:24</div>
            <div class="timeline-body"><p><code>requirements.txt</code> can't represent a specific package using a specific index, and <code>uv pip sync</code> can't tell that those sources apply to it installing from <code>requirements.txt</code>, can you use the more modern and standardized <code>pylock.toml</code> instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-12-18 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-12-18 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pstrzelczak">@pstrzelczak</a> on 2025-12-19 07:18</div>
            <div class="timeline-body"><p>Please note that with &quot;explicit = true&quot; flag removed <code>uv pip sync</code> is able to find a package and succeeds. Therefore, I would expect it can work with &quot;explicit = true&quot; marker too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-19 12:29</div>
            <div class="timeline-body"><p>The <code>explicit = true</code> exists only in the uv project interface, it doesn't exist for <code>requirements.txt</code> or <code>pip</code>/<code>uv pip</code>. The reason is that we need to match each source to a <code>project.[optional-]dependencies</code> or <code>dependency-groups</code> entry, and that doesn't work with <code>requirements.txt</code>. One of the main motivations for building <code>uv.lock</code> was to not have the limitations of <code>requirementst.txt</code>.</p>
<p>It happens to work without <code>explicit = true</code> through a different mechanism: All uv commands read
the closest <code>pyproject.toml</code> or <code>uv.toml</code> as configuration files, and use the index settings from them. I know it's confusing that we read some parts of it and ignore others, specifically, we're reading only the <a href="https://docs.astral.sh/uv/reference/settings/#configuration">configuration</a> and dependencies fields for <code>uv pip compile</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pstrzelczak">@pstrzelczak</a> on 2025-12-19 12:42</div>
            <div class="timeline-body"><p>@konstin thank you for your response. I understand that explicit indices is <code>uv</code> specific concept and I am just advocating for <code>uv pip sync requirements.txt</code> to just read package -&gt; index mapping and from <code>tool.uv.sources</code> section of <code>pyproject.toml</code> considering  <code>tool.uv.sources</code> section is already used as in particular there is <code>--no-sources</code> command line switch.</p>
<p>Using <code>uv.lock</code> or <code>pylock.toml</code> is obviously the target solution but may be currently infeasible in our use case considering we heavily really on local Pypi mirrors that would leak to <code>uv.lock</code> or <code>pylock.toml</code> files if <code>--default-index</code> is used. Using old style requirements files is just more compact and enough, modulo the issue being discussed here.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:33:42 UTC
    </footer>
</body>
</html>
