<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How do I lock `torch-scatter`? - astral-sh/uv #9079</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>How do I lock `torch-scatter`?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9079">#9079</a>
        opened by <a href="https://github.com/NellyWhads">@NellyWhads</a>
        on 2024-11-13 07:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-11-13 07:52</div>
            <div class="timeline-body"><p>Here's a relevant example project toml in which I attempt to lock <code>torch-scatter</code> as a dependency which only installs on a specific platform:</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;test_ml&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.8,&lt;3.11&quot;

dependencies = [
  &quot;torch==2.1.0&quot;,
  &quot;torch==2.1.0+cu118 ; sys_platform == 'linux'&quot;,
  &quot;torchvision==0.16.0&quot;,
  &quot;torchvision==0.16.0+cu118 ; sys_platform == 'linux'&quot;,
  #   &quot;torch-scatter==2.1.2 ; sys_platform == 'linux'&quot;,
  #   &quot;torch-scatter==2.1.2+pt21 ; sys_platform == 'linux'&quot;,
  #   &quot;torch-scatter==2.1.2+cu118 ; sys_platform == 'linux'&quot;,
  &quot;torch-scatter==2.1.2+pt21cu118 ; sys_platform == 'linux'&quot;,
]

[tool.uv.sources]
torch = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; }]
torchvision = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; }]
torch-scatter = [
  # { index = &quot;torch-scatter-torch210&quot;, marker = &quot;sys_platform == 'darwin'&quot; },
  { index = &quot;torch-scatter-torch210-cu118&quot;, marker = &quot;sys_platform == 'linux'&quot; },
]

[[tool.uv.index]]
name = &quot;torch-scatter-torch210&quot;
url = &quot;https://data.pyg.org/whl/torch-2.1.0+cpu.html&quot;
explicit = true

[[tool.uv.index]]
name = &quot;torch-scatter-torch210-cu118&quot;
url = &quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot;
explicit = true

[[tool.uv.index]]
name = &quot;torch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[tool.uv]
environments = [&quot;sys_platform == 'darwin'&quot;, &quot;sys_platform == 'linux'&quot;]

</code></pre>
<p>I can't seem to figure out how to lock torch-scatter, let alone build/install it. Any assistance would be apprecaited.</p>
<p>I looked through the previous github issues and don't see anything related to the lock in particular. I'm hoping to set up this config to support both <code>darwin</code> and <code>linux</code>, however, the dependency can be ignored on <code>darwin</code> hosts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-13 09:13</div>
            <div class="timeline-body"><p>Based on my knowledge, UV does not yet provide support for utilizing URLs from find-links as a source within the <code>[[tool.uv.index]]</code> configuration.
Therefore, your only option right now is to configure find-links to meet your requirements.
https://docs.astral.sh/uv/reference/settings/#find-links
Comments mentioning unsupported this features: https://github.com/astral-sh/uv/issues/8717#issuecomment-2451876796</p>
<p>As for whether <code>[[tool.uv.index]]</code> will support find-links in the future, we'll have to wait and see what the UV team decides.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-11-13 14:37</div>
            <div class="timeline-body"><p>Hmm, could you provide a quick example of how to do that in this situation? Is find-links url-specific? Would it significantly simplify the versions since I could use plain <code>torch</code> and <code>torchvision</code> names?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-13 16:11</div>
            <div class="timeline-body"><p>@NellyWhads I think this can be used as a reference. I'm not sure if there's a better way to do it, since I don't usually use <code>find-links</code>.</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;test_ml&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.8,&lt;3.11&quot;
dependencies = [
  &quot;torch==2.1.0&quot;,
  &quot;torch==2.1.0+cu118 ; sys_platform == 'linux'&quot;,
  &quot;torchvision==0.16.0&quot;,
  &quot;torchvision==0.16.0+cu118 ; sys_platform == 'linux'&quot;,
  #   &quot;torch-scatter==2.1.2 ; sys_platform == 'linux'&quot;,
  #   &quot;torch-scatter==2.1.2+pt21 ; sys_platform == 'linux'&quot;,
  #   &quot;torch-scatter==2.1.2+cu118 ; sys_platform == 'linux'&quot;,
  &quot;torch-scatter==2.1.2+pt21cu118 ; sys_platform == 'linux'&quot;,
]

[tool.uv.sources]
torch = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; }]
torchvision = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; }]
#torch-scatter = [
#  # { index = &quot;torch-scatter-torch210&quot;, marker = &quot;sys_platform == 'darwin'&quot; },
#  { index = &quot;torch-scatter-torch210-cu118&quot;, marker = &quot;sys_platform == 'linux'&quot; },
#]

#[[tool.uv.index]]
#name = &quot;torch-scatter-torch210&quot;
#url = &quot;https://data.pyg.org/whl/torch-2.1.0+cpu.html&quot;
#explicit = true

#[[tool.uv.index]]
#name = &quot;torch-scatter-torch210-cu118&quot;
#url = &quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot;
#explicit = true

[[tool.uv.index]]
name = &quot;torch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[tool.uv]
environments = [&quot;sys_platform == 'darwin'&quot;, &quot;sys_platform == 'linux'&quot;]
find-links = [
  &quot;https://data.pyg.org/whl/torch-2.1.0+cpu.html&quot;,
  &quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot;
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-11-13 21:36</div>
            <div class="timeline-body"><p>Thanks @FishAlchemist I actually simplified it further to this:</p>
<details><summary>pyproject.toml</summary>
<p>

<pre><code>[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;test_ml&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.8,&lt;3.11&quot;

dependencies = [
  &quot;torch==2.1.0&quot;,
  &quot;torchvision==0.16.0&quot;,
  # &quot;torch-scatter==2.1.2 ; sys_platform == 'darwin'&quot;,
  &quot;torch-scatter==2.1.2+pt21cu118 ; sys_platform == 'linux'&quot;,
]

[tool.uv.sources]
torch = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform == 'linux'&quot; }]
torchvision = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform == 'linux'&quot; }]

[[tool.uv.index]]
name = &quot;torch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[tool.uv]
environments = [&quot;sys_platform == 'darwin'&quot;, &quot;sys_platform == 'linux'&quot;]
find-links = [
  # &quot;https://data.pyg.org/whl/torch-2.1.0+cpu.html&quot;,
  &quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot;,
]

</code></pre>
</p>
</details> 

<p>My last question; how I can lock the darwin version as well? The CPU index does have wheels with no extra version specifiers which allow for installation of the package on <code>macosx</code> (ie. <code>2.1.2</code> instead of <code>2.1.2+pt21cpu</code>). Pip install of course works, but I can't seem to tell uv to look explicitly for the version without the extra tags when on the <code>darwin</code> platform.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-11-13 21:37</div>
            <div class="timeline-body"><p>Is there some sort of &quot;exact match&quot; specifier I'm missing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-14 03:30</div>
            <div class="timeline-body"><p>@charliermarsh Since 0.5.0, it seems quite difficult to lock dependencies to a specific version without local version tags on macOS, based on dependency requirements. Is this the expected behavior starting from 0.5.0?</p>
<pre><code class="language-toml">requires-python = &quot;&gt;=3.8,&lt;3.11&quot;
dependencies = [
  &quot;torch==2.1.0 ; sys_platform == 'darwin'&quot;,
  &quot;torchvision==0.16.0 ; sys_platform == 'darwin'&quot;,
  &quot;torch==2.1.0+cu118 ; sys_platform == 'linux'&quot;,
  &quot;torchvision==0.16.0+cu118 ; sys_platform == 'linux'&quot;,
  &quot;torch-scatter==2.1.2; sys_platform == 'darwin'&quot;,
  &quot;torch-scatter==2.1.2+pt21cu118 ; sys_platform == 'linux'&quot;,
]

[tool.uv.sources]
torch = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform == 'linux'&quot; }]
torchvision = [{ index = &quot;torch-cu118&quot;, marker = &quot;sys_platform == 'linux'&quot; }]

[[tool.uv.index]]
name = &quot;torch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[tool.uv]
environments = [&quot;sys_platform == 'darwin'&quot;, &quot;sys_platform == 'linux'&quot;]
find-links = [
  &quot;https://data.pyg.org/whl/torch-2.1.0+cpu.html&quot;,
  &quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot;,
]
</code></pre>
<details>

<summary>uv.lock for uv 0.4.29 (85f9a0d0e 2024-10-30) </summary>

<pre><code class="language-toml">[[package]]
name = &quot;torch-scatter&quot;
version = &quot;2.1.2&quot;
source = { registry = &quot;https://data.pyg.org/whl/torch-2.1.0+cpu.html&quot; }
resolution-markers = [
    &quot;sys_platform == 'darwin'&quot;,
]
wheels = [
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcpu/torch_scatter-2.1.2-cp310-cp310-macosx_11_0_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcpu/torch_scatter-2.1.2-cp38-cp38-macosx_11_0_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcpu/torch_scatter-2.1.2-cp39-cp39-macosx_11_0_x86_64.whl&quot; },
]
</code></pre>
<pre><code class="language-toml">[[package]]
name = &quot;torch-scatter&quot;
version = &quot;2.1.2+pt21cu118&quot;
source = { registry = &quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot; }
resolution-markers = [
    &quot;sys_platform == 'linux'&quot;,
]
wheels = [
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcu118/torch_scatter-2.1.2%2Bpt21cu118-cp310-cp310-linux_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcu118/torch_scatter-2.1.2%2Bpt21cu118-cp38-cp38-linux_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcu118/torch_scatter-2.1.2%2Bpt21cu118-cp39-cp39-linux_x86_64.whl&quot; },
]
</code></pre>
</details>
<details>

<summary>uv.lock for uv 0.5.0 (8d665267c 2024-11-07) </summary>

<pre><code class="language-toml">[[package]]
name = &quot;torch-scatter&quot;
version = &quot;2.1.2+pt21cu118&quot;
source = { registry = &quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot; }
wheels = [
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcu118/torch_scatter-2.1.2%2Bpt21cu118-cp310-cp310-linux_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcu118/torch_scatter-2.1.2%2Bpt21cu118-cp38-cp38-linux_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcu118/torch_scatter-2.1.2%2Bpt21cu118-cp39-cp39-linux_x86_64.whl&quot; },
]
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-12-17 04:48</div>
            <div class="timeline-body"><p>Hey folks. any chance we can re-visit this? Coming up against it as a blocker in a machine learning mono-repo</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-12-23 16:51</div>
            <div class="timeline-body"><p>Another option to resolve cases like this would be to allow uv indices to use the find-links functionality directly. This way, for the CPU-only groups, indices could be used without the <code>find-links</code> feature, whereas for GPU groups/indices, it can be toggled on.</p>
<p>The central <code>find-links</code> setting does not allow for resolution of package with and without tags successfully as currently implemented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 16:14</div>
            <div class="timeline-body"><p>I think you want this:</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;test_ml&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.8,&lt;3.11&quot;

dependencies = [
  &quot;torch==2.1.0&quot;,
  &quot;torchvision==0.16.0&quot;,
  &quot;torch-scatter==2.1.2 ; sys_platform != 'darwin'&quot;
]

[tool.uv.sources]
torch = [
    { index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; },
    { index = &quot;torch-cpu&quot;, marker = &quot;sys_platform == 'darwin'&quot; },
]
torchvision = [
    { index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; },
    { index = &quot;torch-cpu&quot;, marker = &quot;sys_platform == 'darwin'&quot; },
]

[[tool.uv.index]]
name = &quot;torch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true


[[tool.uv.index]]
name = &quot;torch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[tool.uv]
find-links = [&quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 16:15</div>
            <div class="timeline-body"><p>On macOS:</p>
<pre><code>test-ml v0.0.0
├── torch v2.1.0
│   ├── filelock v3.16.1
│   ├── fsspec v2024.12.0
│   ├── jinja2 v3.1.5
│   │   └── markupsafe v3.0.2
│   ├── networkx v3.4.2
│   ├── sympy v1.13.3
│   │   └── mpmath v1.3.0
│   └── typing-extensions v4.12.2
└── torchvision v0.16.0
    ├── numpy v2.2.1
    ├── pillow v11.0.0
    ├── requests v2.32.3
    │   ├── certifi v2024.12.14
    │   ├── charset-normalizer v3.4.1
    │   ├── idna v3.10
    │   └── urllib3 v2.3.0
    └── torch v2.1.0 (*)
(*) Package tree already displayed
</code></pre>
<p>On Linux:</p>
<pre><code>test-ml v0.0.0
├── torch v2.1.0+cu118
│   ├── filelock v3.16.1
│   ├── fsspec v2024.12.0
│   ├── jinja2 v3.1.5
│   │   └── markupsafe v3.0.2
│   ├── networkx v3.4.2
│   ├── sympy v1.13.3
│   │   └── mpmath v1.3.0
│   ├── triton v2.1.0
│   │   └── filelock v3.16.1
│   └── typing-extensions v4.12.2
├── torch-scatter v2.1.2+pt21cu118
└── torchvision v0.16.0+cu118
    ├── numpy v2.2.1
    ├── pillow v11.0.0
    ├── requests v2.32.3
    │   ├── certifi v2024.12.14
    │   ├── charset-normalizer v3.4.1
    │   ├── idna v3.10
    │   └── urllib3 v2.3.0
    └── torch v2.1.0+cu118 (*)
(*) Package tree already displayed
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-12-27 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-27 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-12-27 18:23</div>
            <div class="timeline-body"><p>The solution you described is what I currently use, however, modern <code>torch-scatter</code> <em>does</em> support MacOS (<a href="https://data.pyg.org/whl/torch-2.1.0%2Bcpu.html">example of the torch~=2.1.0 wheel source</a>).</p>
<p>This issue is raised to find a way to lock working versions of <code>torch-scatter</code> for MacOS <em>and</em> Linux w/ Cuda 11.8 using pre-built wheels.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 18:29</div>
            <div class="timeline-body"><p>I believe this does what you're describing:</p>
<pre><code class="language-toml">[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[project]
name = &quot;test_ml&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.8,&lt;3.11&quot;

dependencies = [
  &quot;torch==2.1.0&quot;,
  &quot;torchvision==0.16.0&quot;,
  &quot;torch-scatter==2.1.2&quot;
]

[tool.uv.sources]
torch = [
    { index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; },
    { index = &quot;torch-cpu&quot;, marker = &quot;sys_platform == 'darwin'&quot; },
]
torchvision = [
    { index = &quot;torch-cu118&quot;, marker = &quot;sys_platform != 'darwin'&quot; },
    { index = &quot;torch-cpu&quot;, marker = &quot;sys_platform == 'darwin'&quot; },
]

[[tool.uv.index]]
name = &quot;torch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true


[[tool.uv.index]]
name = &quot;torch-cu118&quot;
url = &quot;https://download.pytorch.org/whl/cu118&quot;
explicit = true

[tool.uv]
find-links = [&quot;https://data.pyg.org/whl/torch-2.1.0+cu118.html&quot;, &quot;https://data.pyg.org/whl/torch-2.1.0+cpu.html&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 18:30</div>
            <div class="timeline-body"><p>It only includes the following wheels though since these are the only wheels published for macOS in your Python range:</p>
<pre><code>wheels = [
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcpu/torch_scatter-2.1.2-cp310-cp310-macosx_11_0_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcpu/torch_scatter-2.1.2-cp38-cp38-macosx_11_0_x86_64.whl&quot; },
    { url = &quot;https://data.pyg.org/whl/torch-2.1.0%2Bcpu/torch_scatter-2.1.2-cp39-cp39-macosx_11_0_x86_64.whl&quot; },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2024-12-27 20:09</div>
            <div class="timeline-body"><p>I'll try that config out - I think it's working because of the order of the find-links urls, am I right? I was getting odd behavior when I tried similar configs above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-03 15:28</div>
            <div class="timeline-body"><p>Optimistically closing for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-03 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NellyWhads">@NellyWhads</a> on 2025-01-07 13:23</div>
            <div class="timeline-body"><p>Apologies - have not had the bandwidth to re-test this in my current repo. But running the isolated example seems to behave as described.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:23 UTC
    </footer>
</body>
</html>
