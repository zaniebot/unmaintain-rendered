<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install` does not respect `UV_PROJECT_ENVIRONMENT`. Should it?  - astral-sh/uv #7380</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip install</code> does not respect <code>UV_PROJECT_ENVIRONMENT</code>. Should it?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7380">#7380</a>
        opened by <a href="https://github.com/nikhilweee">@nikhilweee</a>
        on 2024-09-13 22:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nikhilweee">@nikhilweee</a></div>
            <div class="timeline-body">

<p>When <code>UV_PROJECT_ENVIRONMENT</code> is unset, <code>uv pip install &lt;package&gt;</code> works without activating venv</p>
<pre><code>$ uv venv
Using Python 3.10.12 interpreter at: /usr/bin/python3
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate
$ uv pip install requests # no need to activate venv
Resolved 5 packages in 212ms
Installed 5 packages in 20ms
 + certifi==2024.8.30
 + charset-normalizer==3.3.2
 + idna==3.8
 + requests==2.32.3
 + urllib3==2.2.3
</code></pre>
<p>When <code>UV_PROJECT_ENVIRONMENT</code> is set, <code>uv pip install &lt;package&gt;</code> complains about not activating venv</p>
<pre><code>$ export UV_PROJECT_ENVIRONMENT=venv
$ uv venv
Using Python 3.10.12 interpreter at: /usr/bin/python3
Creating virtualenv at: venv
Activate with: source venv/bin/activate
$ uv pip install requests # complains about not activating venv
error: No virtual environment found; run `uv venv` to create an environment, 
or pass `--system` to install into a non-virtual environment
</code></pre>
<p>This is with <code>uv</code> version <code>0.4.10</code></p>
<pre><code>$ uv --version
uv 0.4.10
</code></pre>
<p>Should the behaviour be consistent for both cases? (I think so)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-13 22:43</div>
            <div class="timeline-body"><p><code>UV_PROJECT_ENVIRONMENT</code> is only for project-level commands, not the low-level <code>pip</code> interface. Are you trying to use this in a uv-managed project or an arbitrary directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-13 22:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nikhilweee">@nikhilweee</a> on 2024-09-13 22:51</div>
            <div class="timeline-body"><p>Thanks for the clarification. I&#x27;m trying to run this from an arbitrary directory. If this is intended please feel free to close the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxbrunet">@maxbrunet</a> on 2024-09-20 16:59</div>
            <div class="timeline-body"><p>In my case it is for an uv-managed project, I find it a little confusing that <code>uv pip</code> uses <code>.venv</code> by default without activation, but not <code>UV_PROJECT_ENVIRONMENT</code></p>
<p>I use <code>uv pip</code> to work around packages that do not build in isolation, and this example from <a href="https://docs.astral.sh/uv/concepts/projects/#build-isolation">the doc</a> does not work when <code>UV_PROJECT_ENVIRONMENT</code> is set:</p>
<pre><code>$ export UV_PROJECT_ENVIRONMENT=/some/other/path/to/venv
$ uv venv
$ uv pip install torch
$ uv sync --no-build-isolation-package=flash-attn
error: No virtual environment found; run `uv venv` to create an environment, or pass `--system` to install into a non-virtual environment)
</code></pre>
<p>Instead one must do:</p>
<pre><code>$ export UV_PROJECT_ENVIRONMENT=/some/other/path/to/venv
$ uv venv
$ VIRTUAL_ENV=&quot;${UV_PROJECT_ENVIRONMENT}&quot; uv pip install torch
$ uv sync --no-build-isolation-package=flash-attn
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-20 17:02</div>
            <div class="timeline-body"><p>We could consider having <code>uv pip</code> respect <code>UV_PROJECT_ENVIRONMENT</code> if you are in a project root, but it&#x27;s pretty complicated. I think what you&#x27;re doing is a reasonable workaround. Ideally we&#x27;ll have better ways to declare build dependencies in the long-run so you don&#x27;t need to use <code>uv pip</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxbrunet">@maxbrunet</a> on 2024-09-20 17:03</div>
            <div class="timeline-body"><blockquote>
<p>Ideally we&#x27;ll have better ways to declare build dependencies in the long-run so you don&#x27;t need to use <code>uv pip</code>.</p>
</blockquote>
<p>I would love that! ❤️</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-21 21:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:01 UTC
    </footer>
</body>
</html>
