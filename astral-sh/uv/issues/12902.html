<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UV --native-tls not respecting system certs on RHEL8 - astral-sh/uv #12902</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UV --native-tls not respecting system certs on RHEL8</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12902">#12902</a>
        opened by <a href="https://github.com/TheFriendlyCoder">@TheFriendlyCoder</a>
        on 2025-04-15 19:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/TheFriendlyCoder">@TheFriendlyCoder</a> on 2025-04-15 19:28</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>In a clean base image / docker image running RHEL8 (ubi in my case), some tools don't seem to &quot;play nice&quot; with the system certs when run under <code>uv</code>. One being the <code>mkdocstrings</code> plugin for <code>mkdocs</code>. When it tries to reach out to a public repo to gather Python doc inv files (ie: https://docs.python.org/3/objects.inv) it fails with an SSL certificate failure. Setting the <code>SSL_CERT_FILE</code> env var to the default path of the system cert bundle (ie: <code>/etc/pki/tls/certs/ca-bundle.crt</code>) works as expected, but passing the <code>--native-tls</code> flag to <code>uv</code> does not.</p>
<p>I'm not sure if you have access to &quot;ubi&quot; base images or not, but the steps to reproduce look something like this:</p>
<ol>
<li>Run <code>docker run -it icr.io/appcafe/ibm-semeru-runtimes:open-17-jdk-ubi /bin/bash</code> (mounting a sample workspace into the container if needed)</li>
<li>Run <code>uv run mkdocs build --strict</code> - build fails</li>
<li>Run <code>uv run --native-tls mkdocs build --strict</code> - build fails</li>
<li>Run <code>SSL_CERT_FILE=/etc/pki/tls/certs/ca-bundle.crt uv run mkdocs build --strict</code> - build succeeds</li>
</ol>
<p>The sample project I'm working on has some dependencies like this:</p>
<pre><code class="language-[dependency-groups]">dev = [
    &quot;mkdocs&quot;,
    &quot;mkdocs-material&quot;,
    &quot;mkdocstrings[python]&quot;
]
</code></pre>
<p>and an <code>mkdocs.yml</code> file that looks something like this:</p>
<pre><code>site_name: &quot;fubar&quot;

theme:
  name: material

plugins:
- mkdocstrings:
    default_handler: python
    handlers:
      python:
        import:
          - https://docs.python.org/3/objects.inv

</code></pre>
<p>The exact error produced is:</p>
<pre><code>ERROR   -  mkdocstrings: Couldn't load inventory https://docs.python.org/3/objects.inv through handler 'python': &lt;urlopen error [SSL:
           CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1129)&gt;
</code></pre>
<h3>Platform</h3>
<p>RHEL8</p>
<h3>Version</h3>
<p>uv 0.6.14</p>
<h3>Python version</h3>
<p>Python 3.10.16, Python 3.9.18</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @TheFriendlyCoder on 2025-04-15 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheFriendlyCoder">@TheFriendlyCoder</a> on 2025-04-15 19:35</div>
            <div class="timeline-body"><p>In case it helps, I just reproduced the bug with the <a href="https://hub.docker.com/layers/library/ibm-semeru-runtimes/open-17-jdk-centos7/images/sha256-5c38253a476851f6dae1962406bc9ef1f22d59d10962be03b7fcdf9546aa569e">publicly available</a> centos7 version of the same container.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheFriendlyCoder">@TheFriendlyCoder</a> on 2025-04-15 19:36</div>
            <div class="timeline-body"><p>This being said, it's not all together clear to me how/why the built in SSL certs in <code>uv</code> would have a problem with a publicly accessible host like python.org.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-16 08:22</div>
            <div class="timeline-body"><p>The error is occurring in Python code, while <code>--native-tls</code> only affects uv. I assume that <code>SSL_CERT_FILE</code> helps because environment variables also affect subprocesses, in this case the Python process and its http library. You can confirm this by running with <code>uv sync &amp;&amp; python ...</code> instead of <code>uv run</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-04-16 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-04-16 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-17 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @charliermarsh on 2025-04-17 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheFriendlyCoder">@TheFriendlyCoder</a> on 2025-04-19 19:05</div>
            <div class="timeline-body"><p>So, the one discrepancy here is that when installing a Python version managed by the OS distribution, and attempting the exact same operation, there is no need to set the SSL_CERT_FILE env var. So the issue I am describing here is either an issue with UV itself, or the Python runtime version installed and managed by UV.</p>
<p>If the suggestion here is that the <code>--native-tls</code> flag only impacts the behavior of UV itself and not the tools that UV installs and manages / makes use of under the hood, then perhaps this distinction should be made clear in the documentation. Further, it stands to reason that a solution for this problem should still be investigated on some level - if not as a bug within UV itself, then perhaps as a bug with the pre-built Python runtime that it deploys behind the scenes.</p>
<p>With this in mind, I would be happy to create a duplicate bug report elsewhere if there is a more appropriate place for it to be reported (ie: if there is a separate issue track for reporting bugs in the underlying Python runtimes managed by UV, and if you feel this is a more appropriate location for reporting this bug). Just let me know how/where to transfer the information.</p>
<p>Thanks for your help on this, and keep up the good work! Despite a few small hiccups like this, we've found UV to still be the most stable package management system for Python since the creation of the core <code>setuptools</code> / <code>pip</code> toolchain. I appreciate all of your efforts and continue to look forward to seeing what great work you have coming on the horizon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-04-21 10:41</div>
            <div class="timeline-body"><p>Can you share a complete reproducible example that reproduces the difference between system Python and uv managed Python? I can't reproduce this locally and the docker container has user permissions due to which I can't follow along with the problem description.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TheFriendlyCoder">@TheFriendlyCoder</a> on 2025-05-06 15:56</div>
            <div class="timeline-body"><p>@konstin Sorry for the delay - been busy lately.</p>
<p>I've put together a sample project <a href="https://github.com/TheFriendlyCoder/uv_tls_bug">here</a> to demonstrate the problem. Just checkout the sample repo and run <code>./run.sh</code>. You should see an error similar to:</p>
<pre><code>ERROR   -  mkdocstrings: Couldn't load inventory {'url': 'https://docs.python.org/3/objects.inv'} through PythonHandler.load_inventory: &lt;urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1149)&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-06 23:04</div>
            <div class="timeline-body"><p>Thank you for the self-contained Docker MRE!</p>
<p>If i change the last line to</p>
<pre><code>.venv/bin/mkdocs build
</code></pre>
<p>I get the same error, so the error happens when running Python, not through uv. I tried to check whether the difference was Astral's Python distribution vs. the system Python, but <code>yum update -y</code> fails.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:04 UTC
    </footer>
</body>
</html>
