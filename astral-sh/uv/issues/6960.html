<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature:  have 'uv export' support --only-deps - astral-sh/uv #6960</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Feature:  have 'uv export' support --only-deps</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/6960">#6960</a>
        opened by <a href="https://github.com/RomainBrault">@RomainBrault</a>
        on 2024-09-03 08:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2024-09-03 08:33</div>
            <div class="timeline-body"><p>Have <code>uv export</code> support <code>--only-deps</code></p>
<p>This would be useful to support building <code>requirements.txt</code> from <code>uv.lock</code> without including build dependencies.</p>
<p>Example: in a <code>Dockerfile</code> with a custom hatch build the following fails:</p>
<pre><code class="language-dockerfile">COPY pyproject.toml ./
RUN set -ex &amp;&amp; \
    ${UV_BIN}/uv export \
        --format=&quot;requirements-txt&quot; \
        --all-extras \
        --no-dev
</code></pre>
<p>So I must do</p>
<pre><code class="language-dockerfile">COPY pyproject.toml hatch.toml hatch_build.py ./
RUN set -ex &amp;&amp; \
    ${UV_BIN}/uv export \
        --format=&quot;requirements-txt&quot; \
        --all-extras \
        --no-dev
</code></pre>
<p>It would be nice to be able to have</p>
<pre><code class="language-dockerfile">COPY pyproject.toml ./
RUN set -ex &amp;&amp; \
    ${UV_BIN}/uv export \
        --format=&quot;requirements-txt&quot; \
        --all-extras \
        --no-dev \
        --only-deps
</code></pre>
<p>working.</p>
<p>This would also enable doing</p>
<pre><code class="language-shell">uv pip install --require-hashes
</code></pre>
<p>without <code>uv</code> complaining about</p>
<pre><code class="language-bash">error: In `--require-hashes` mode, all requirement must have a hash, but none were provided for: file:///src
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Feature:  have 'uv export' support --no-install-project and --no-install-workspace" to "Feature:  have 'uv export' support --no-install-project" by @RomainBrault on 2024-09-03 08:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2024-09-03 20:35</div>
            <div class="timeline-body"><p>Related: #6573</p>
<p>If I was unclear, I think it would be nice to convert the uv.lock to a requirements.txt trough uv export with only the dependencies (not the project). I guess I would be really useful if in that case uv would ignore the project's build configuration (otherwise I could just &quot;sed&quot; out the line corresponding to the project in the requirements.txt).</p>
<p>E.g. in my example the project's build use hatch-vcs (with dynamic field + a custom build script) that are not useful to convert the dependencies in uv.lock to requirements.txt.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Feature:  have 'uv export' support --no-install-project" to "Feature:  have 'uv export' support --only-deps" by @RomainBrault on 2024-09-03 20:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-03 23:19</div>
            <div class="timeline-body"><p>Do you need <code>--frozen</code> for these commands, so that you don't resolve?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-09-04 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-04 02:22</div>
            <div class="timeline-body"><p>In other words: if you add <code>--frozen</code> to the above examples, do the commands execute without error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2024-09-04 08:49</div>
            <div class="timeline-body"><p>Thanks, this solve the build problem; with <code>--frozen</code> I am able to generate the <code>requirements.txt</code> from the <code>uv.lock</code>.</p>
<p>However I am unable to <code>pip install --require-hashes</code> due to the line <code>-e .</code> in the <code>requirements.txt</code>.</p>
<p>So the final solution is to use <code>--frozen</code> as suggested and to remove the line in a post-processing step.</p>
<p>A flag to avoid this line would still be useful as well as a flag to save the result to a file. (This would avoid post-processing and stream redirections).</p>
<p>I don't mind closing the issue now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2024-09-04 08:59</div>
            <div class="timeline-body"><p>Related: #6995 #7058</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RomainBrault">@RomainBrault</a> on 2024-09-04 10:03</div>
            <div class="timeline-body"><p>I think the feature could be seen another way:</p>
<p>Be able to do <code>uv pip compile uv.lock</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7110.html">astral-sh/uv#7110</a> on 2024-09-06 00:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-09-06 00:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-06 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-06 01:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:22 UTC
    </footer>
</body>
</html>
