<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work across multiple drives - astral-sh/uv #6613</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Work across multiple drives</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6613">#6613</a>
        opened by <a href="https://github.com/YDX-2147483647">@YDX-2147483647</a>
        on 2024-08-25 18:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/YDX-2147483647">@YDX-2147483647</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<pre><code class="language-shell">$ uv add &lt;any-package&gt;
warning: Failed to hardlink files; falling back to full copy. This may lead to degraded performance.
If the cache and target directories are on different filesystems, hardlinking may not be supported.
</code></pre>
<p>If uv only has cache in <code>C:\</code>, then I am unable to use uv in <code>D:\</code>, at least with “degraded performance”. This case might be common for Windows machines. For example, https://github.com/astral-sh/uv/issues/6397#issuecomment-2303368424:</p>
<blockquote>
<p>this is about the relationship between the cache directory and the drive you're installing on. I'm guessing your cache is not on <code>file:///E:</code>? You can use <code>--cache-dir</code> or <code>UV_CACHE_DIR</code> to set a different cache directory on <code>file:///E:</code>.</p>
</blockquote>
<p>I understand that hard links are not permitted across drives. However, <a href="https://pnpm.io/faq#does-pnpm-work-across-multiple-drives-or-filesystems">pnpm creates multiple stores (one per drive)</a>, solving the issue. Will it be possible for uv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-25 20:31</div>
            <div class="timeline-body"><p>I suppose we could do something like that. It could end up being <em>less</em> efficient sometimes, though, since you duplicate and re-cache any data that's used across drives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @charliermarsh on 2024-08-25 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cache</span> added by @charliermarsh on 2024-08-25 20:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-08-25 22:18</div>
            <div class="timeline-body"><p>This arguably applies on linux too as you can have a mounted secondary drive under some arbitrary path as stated here https://github.com/pnpm/pnpm/issues/712#issuecomment-363295013, I do think using <code>UV_CACHE_DIR</code> is a reasonable solution in the mean time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Holi0317">@Holi0317</a> on 2024-09-02 15:08</div>
            <div class="timeline-body"><p>Also on MacOS as well. I use a separate, case sensitive filesystem for all code project that is different form the fs backing <code>~/.cache</code>.</p>
<p>While this is not mentioned in the pnpm thread, I think users who hits this issue are storing all of their projects in a separate filesystem. Whether it is because of disk space, speed or want to use a different fs. The current behavior is actually less efficient for us because the setup basically disables hard-link dependency deduplication.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Winand">@Winand</a> on 2025-01-01 23:44</div>
            <div class="timeline-body"><p>So I can simply create <code>uv.toml</code> in the root folder of a disk with contents <code>cache-dir = &quot;D:/.uv/cache&quot;</code>? Do i understand it correctly that uv searches for <code>uv.toml</code> in all parent folders of a project?</p>
<blockquote>
<p><a href="https://docs.astral.sh/uv/configuration/files/#configuration-files">Configuration files</a>
Specifically, uv will search for a pyproject.toml or uv.toml file in the current directory, or in the nearest parent directory.</p>
</blockquote>
<p>It means that uv checks each parent folder until it finds the nearest uv.toml file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maphew">@maphew</a> on 2025-03-03 17:58</div>
            <div class="timeline-body"><blockquote>
<p>So I can simply create <code>uv.toml</code> in the root folder of a disk with contents <code>cache-dir = &quot;D:/.uv/cache&quot;</code>? Do i understand it correctly that uv searches for <code>uv.toml</code> in all parent folders of a project?</p>
</blockquote>
<p>This worked for me, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Winand">@Winand</a> on 2025-03-06 20:58</div>
            <div class="timeline-body"><blockquote>
<p>This worked for me, thanks.</p>
</blockquote>
<p>But it won't work if you put uv.tool section in pyproject.toml, because uv doesn't merge these configuration sources and use pyproject.toml OR the nearest uv.toml file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wilsonmfaria">@wilsonmfaria</a> on 2025-05-23 12:44</div>
            <div class="timeline-body"><p>On Windows, by using Powershell, I 've added this to my profile... So once I open a terminal, it sets the <code>UV_CACHE_DIR</code> based on the drive... Except for C: which is the standard..</p>
<pre><code>$DriveLetter = (Get-Location).Drive.Name
if ($DriveLetter -in @(&quot;D&quot;, &quot;E&quot;)) {
    switch ($DriveLetter) {
        &quot;D&quot; { $Env:UV_CACHE_DIR = &quot;D:\.uv&quot; }
        &quot;E&quot; { $Env:UV_CACHE_DIR = &quot;E:\.uv&quot; }
    }
	Write-Host &quot;UV Cache set to: UV_CACHE_DIR=$Env:UV_CACHE_DIR&quot;
}
</code></pre>
<p>It works quite well..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mirh">@mirh</a> on 2025-05-23 21:58</div>
            <div class="timeline-body"><p>Can't you make something up with junction points?
You can only soft link individual folders but that shouldn't be a problem with the layout archive-v0 already has.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maphew">@maphew</a> on 2025-05-24 06:15</div>
            <div class="timeline-body"><p>TIL: On Windows setting the cache without drive letter will make it use the current drive of wherever the project is.</p>
<pre><code>setx UV_CACHE_DIR &quot;\.uv&quot;
</code></pre>
<pre><code>:: will use C:\.uv
C:\Users\me\projects&gt; uv run ...
</code></pre>
<pre><code>:: will use E:\.uv
E:\work\projects&gt; uv run ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brainbytes42">@brainbytes42</a> on 2025-12-02 13:51</div>
            <div class="timeline-body"><p>Thanks @maphew, your workaround works perfectly!</p>
<p>May I suggest to add this solution (<code>setx UV_CACHE_DIR &quot;\.uv&quot;</code>) to the <strong>docs</strong> as another Note <a href="https://docs.astral.sh/uv/concepts/cache/#cache-directory">here</a>?</p>
<p>Though, <strong>for the long term</strong>, I'd suggest a built-in solution (or maybe <code>\.uv</code> as default?), as this would greatly increase usability in my opinion.
I think it's a trade-off between performance (see @charliermarsh's concern above) and disk-space; disk-space isn't the problem nowadays most of the time, but one of uv's core features is performance. So I'd advocate for duplicate data on different drives in favor of higher performance.</p>
<p>I would imagine a mechanism, that knows the cache-dirs on all drives and first tries to &quot;download&quot; from another drive's cache (which should be quite fast), before downloading from external resources if no cache provides the needed resource.
(Or maybe this isn't needed at all and it's just fine to have one cache per drive completely independent...? <em>+1 for simplicity...</em>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maphew">@maphew</a> on 2025-12-02 15:31</div>
            <div class="timeline-body"><p>I've learned of some related vars for tools and am testing a similar approach with them. It seems to work but I'm uncertain if this is a good idea  -- uv likely assumes all tools in one dir, so, for example, <code>uv tool list</code> might not be accurate.</p>
<pre><code>UV_CACHE_DIR=\.local\.uv
UV_LINK_MODE=hardlink
UV_TOOL_BIN_DIR=\.local\bin
UV_TOOL_DIR=\.local\uv\tools
</code></pre>
<p>There's also UV_INSTALL_DIR which I've left alone as having multiple <code>uv.exe</code> will almost certainly be a problem if they're of different versions, or run at the same time:</p>
<pre><code>UV_INSTALL_DIR=%USERPROFILE%/.local/bin
</code></pre>
<p><em>Edit:</em> A caveat with this convention is mapped network drives: uv will create the <code>.local</code> dirs on the server share, and that is definitely a performance hit. Also potentially over time leading to scattered .uv throughout the share tree if the mapped drive is not always using the same root. (If, for example,  <code>pushd \\server\share\path\place</code> is commonly used to map and change dir in one operation and new connections are set to not be remembered.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:31 UTC
    </footer>
</body>
</html>
