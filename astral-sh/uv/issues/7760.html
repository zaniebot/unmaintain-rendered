<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorporate knowledge of disjoint markers into simplification - astral-sh/uv #7760</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorporate knowledge of disjoint markers into simplification</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7760">#7760</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-09-28 18:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-28 18:07</div>
            <div class="timeline-body"><p>There are some markers that we &quot;know&quot; cannot be true at the same time, despite the fact that it's not encoded in the grammar or schema at all.</p>
<p>For example, this is never true: <code>platform_system == 'Linux' and sys_platform == 'darwin'</code>.</p>
<p>If we encode knowledge about the markers that we &quot;know&quot; are disjoint, we can omit more forks, wheels, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @charliermarsh on 2024-09-28 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-28 18:07</div>
            <div class="timeline-body"><p>\cc @ibraheemdev</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-11-20 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 18:55</div>
            <div class="timeline-body"><p>I have this working, but it does mean all expressions like <code>sys_platform == 'linux'</code> get expanded to <code>sys_platform == 'linux' and platform_system == 'Linux'&quot;</code> in the lockfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 18:59</div>
            <div class="timeline-body"><p>I could just replace <code>sys_platform == 'linux'</code> with <code>platform_system == 'Linux'</code>, but then we wouldn't detect disjointness in cases like:</p>
<pre><code>flask ; sys_platform == 'linux'
flask ; sys_platform == 'java1.8.0_51'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mitsuhiko">@mitsuhiko</a> on 2024-11-21 09:11</div>
            <div class="timeline-body"><blockquote>
<p>I have this working, but it does mean all expressions like <code>sys_platform == 'linux'</code> get expanded to <code>sys_platform == 'linux' and platform_system == 'Linux'&quot;</code> in the lockfile.</p>
</blockquote>
<p>Could you not keep the knowledge around what the original marker expression was and serialize that into the lockfile instead.  At read it should be rather trivial to expand it out when the lockfile is read?  Performance wise this will be slightly worse but you presumably there won't be that many cases where that is necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9344.html">astral-sh/uv#9344</a> on 2024-11-22 02:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9444.html">astral-sh/uv#9444</a> on 2024-11-26 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-07 01:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
