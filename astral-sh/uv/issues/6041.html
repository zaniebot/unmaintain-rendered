<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version conflicts installing lock file when multiple git dependencies rely on another git dependency - astral-sh/uv #6041</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Version conflicts installing lock file when multiple git dependencies rely on another git dependency</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/6041">#6041</a>
        opened by <a href="https://github.com/conorvtx">@conorvtx</a>
        on 2024-08-12 19:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/conorvtx">@conorvtx</a> on 2024-08-12 19:21</div>
            <div class="timeline-body"><p>When running</p>
<pre><code>uv pip install -r requirements/lock.txt
</code></pre>
<p>I get something like</p>
<pre><code>error: Requirements contain conflicting URLs for package `repo1`:
- git+ssh://git@github.com/org/repo1.git
- git+ssh://git@github.com/org/repo1.git@f6f1bd2f14f887fe63b15632d3a18109ab7a8105
</code></pre>
<p>The lock file is generated with</p>
<pre><code>uv pip compile -q --generate-hashes pyproject.toml -o requirements/lock.txt
</code></pre>
<p>and has</p>
<pre><code>repo2 @ git+ssh://git@github.com/org/repo2.git@f6f1bd2f14f887fe63b15632d3a18109ab7a8106
    # via current_project (pyproject.toml)

repo3 @ git+ssh://git@github.com/org/repo3.git@f6f1bd2f14f887fe63b15632d3a18109ab7a8104
    # via repo2

repo1 @ git+ssh://git@github.com/org/repo1.git@f6f1bd2f14f887fe63b15632d3a18109ab7a8105
    # via
    #   current_project (pyproject.toml)
    #   repo2
    #   repo3
</code></pre>
<p>The pyproject.toml file for current_project contains dependencies like the following</p>
<pre><code class="language-toml">dependencies = [
    &quot;repo1 @ git+ssh://git@github.com/org/repo1.git&quot;,
    &quot;repo2 @ git+ssh://git@github.com/org/repo2.git&quot;,
]
</code></pre>
<p>repo2 and repo3 use <code>setup.py</code>s that have repo1 as a dependency. They require it as follows</p>
<pre><code class="language-python"># setup.py

def read_requirements(path):
    return [
        line.strip()
        for line in read(path).split(&quot;\n&quot;)
        if not line.startswith(('&quot;', &quot;#&quot;, &quot;-&quot;))
    ]


setup(
    ...
    install_requires=read_requirements(&quot;requirements.txt&quot;),
    ...
)
</code></pre>
<pre><code># requirements.txt

repo1 @ git+ssh://git@github.com/org/repo1.git
</code></pre>
<hr />
<p>I am surprised I get the error</p>
<pre><code>error: Requirements contain conflicting URLs for package `repo1`:
- git+ssh://git@github.com/org/repo1.git
- git+ssh://git@github.com/org/repo1.git@f6f1bd2f14f887fe63b15632d3a18109ab7a8105
</code></pre>
<p>I would expect <code>git+ssh://git@github.com/org/repo1.git@f6f1bd2f14f887fe63b15632d3a18109ab7a8105</code> to satisfy the more general constraint of <code>git+ssh://git@github.com/org/repo1.git</code>.</p>
<p>Currently to get around this, I have to update the lock file in <code>current_project</code> every time <code>repo1</code> has a new commit on the main branch.</p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-12 19:26</div>
            <div class="timeline-body"><p>I think we'd have to special-case this (the &quot;default branch&quot; behavior) if we want to support it. As-is, we resolve both references to a precise SHA, and allow it if the SHAs match.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-08-12 19:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/conorvtx">@conorvtx</a> on 2024-08-12 20:43</div>
            <div class="timeline-body"><p>I am surprised that this fails at the install step rather than at the compile step. I would expect that this problem would be surfaced when making the lock file rather than using the lock file. I thought that the lock file would have all the information needed to rebuild a dependency graph as it has the pinned commits of any package installed through git.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-12 20:45</div>
            <div class="timeline-body"><p>I believe that error is occurring during the resolver step.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-12 20:45</div>
            <div class="timeline-body"><p>Perhaps you intend to be using <code>uv pip sync</code>? <code>uv pip install</code> does a resolution of the input requirements.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-12 20:46</div>
            <div class="timeline-body"><p>Honestly that will probably fail too though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/conorvtx">@conorvtx</a> on 2024-08-12 20:51</div>
            <div class="timeline-body"><p>actually <code>uv pip sync</code> works! however, i was originally not using <code>sync</code> because it would remove packages installed by conda in the conda environment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-12 21:23</div>
            <div class="timeline-body"><p>I think what you're trying to do here should probably work (but agree it doesn't).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NickCrews">@NickCrews</a> on 2024-10-04 03:56</div>
            <div class="timeline-body"><p>I just ran into this (or a similar flavor) too. IDK if this is significant, but in my case the version is <code>main</code> for both, so it should be even more obvious that the versions are compatible?</p>
<pre><code>error: Requirements contain conflicting URLs for package `noatak`:
- git+https://github.com/ShipCreekGroup/noatak.git@main
- git+https://github.com/ShipCreekGroup/noatak.git@main
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-04 09:59</div>
            <div class="timeline-body"><p>Can you come up with a reproduction that I can use to debug? Thatâ€™s a confusing failure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NickCrews">@NickCrews</a> on 2024-10-05 05:45</div>
            <div class="timeline-body"><p>Hmm, after trying to make out a repro, I think I was running into an issue because one of the remote deps was stale, when I pushed there the error went away. You should ignore me since I'm no longer blocked, I'm sure you have better things to do :) . If it's useful for anyone else, I made a tiny <a href="https://github.com/NickCrews/uv-bug-6041">repo here</a> trying to repro, I think that might be a nice template for someone trying to see how multiple libs and transitive deps might interact</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jasongill">@jasongill</a> on 2024-10-09 14:47</div>
            <div class="timeline-body"><p>Here is an example:</p>
<pre><code>[project]
name = &quot;example&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;autogen-core==0.4.0dev0&quot;,
    &quot;autogen-agentchat==0.4.0dev0&quot;,
    &quot;autogen-ext==0.4.0dev0&quot;
]

[tool.uv.sources]
autogen-core = { git = &quot;https://github.com/microsoft/autogen.git&quot;, branch = &quot;staging&quot;, subdirectory = &quot;python/packages/autogen-core&quot; }
autogen-agentchat = { git = &quot;https://github.com/microsoft/autogen.git&quot;, branch = &quot;staging&quot;, subdirectory = &quot;python/packages/autogen-agentchat&quot; }
autogen-ext = { git = &quot;https://github.com/microsoft/autogen.git&quot;, branch = &quot;staging&quot;, subdirectory = &quot;python/packages/autogen-ext&quot; }
</code></pre>
<p>as I had the same issue while trying to load an un-published package from Git:</p>
<pre><code>error: Requirements contain conflicting URLs for package `autogen-core` in split `python_full_version == '3.12.*'`:
</code></pre>
<p>(note that you'll need to run <code>GIT_LFS_SKIP_SMUDGE=1 uv sync --verbose</code> to reproduce, as there's a different and unrelated error about LFS when uv tries to use git to check the repo out, but that's an issue for another ticket)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-09 14:50</div>
            <div class="timeline-body"><p>Thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-10-09 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-09 14:57</div>
            <div class="timeline-body"><p>@jasongill -- Are you seeing an error like this?</p>
<pre><code>error: Requirements contain conflicting URLs for package `autogen-core`:
- file:///Users/crmarsh/Library/Caches/uv/git-v0/checkouts/2b1782d8bf4da9cf/333c9515/python/packages/autogen-core
- git+https://github.com/microsoft/autogen.git@staging#subdirectory=python/packages/autogen-core
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2024-10-09 14:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-09 15:00</div>
            <div class="timeline-body"><p>(That looks like an error, but it also looks different from the other traces in this issue.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jasongill">@jasongill</a> on 2024-10-09 15:04</div>
            <div class="timeline-body"><p>Correct, sorry for the mix-up - I saw the ticket open for &quot;Requirements contain conflicting URLs for package....&quot; and figured it was the same issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-09 15:04</div>
            <div class="timeline-body"><p>No problem. I will look at it -- feel free to create a separate issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8087.html">astral-sh/uv#8087</a> on 2024-10-10 12:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ghidalgo3">@ghidalgo3</a> on 2025-03-13 17:02</div>
            <div class="timeline-body"><p>I ran into this problem too, and found that it reproduces when you:</p>
<ol>
<li>Have a <code>pyproject.toml</code> that references multiple <code>git+</code> dependencies (for example <code>A</code> and <code>B</code>)</li>
<li>There are internal dependencies between them (<code>A</code> declares <code>B</code> as a dependency).</li>
</ol>
<p>The solution is to only reference the top-level one. So in my example, if package <code>A</code> depends on <code>B</code>, then it's not necessary to list <code>B</code> in the list of dependencies of the <code>pyproject.toml</code>.</p>
<p>For reference, this is the <code>dependencies</code> table I've been working on in an internal project:</p>
<pre><code class="language-toml">dependencies = [
    # &quot;pctasks.core @ git+https://github.com/microsoft/planetary-computer-tasks@main#subdirectory=pctasks/core&quot;,
    # &quot;pctasks.task @ git+https://github.com/microsoft/planetary-computer-tasks@main#subdirectory=pctasks/task&quot;,
    # &quot;pctasks.cli @ git+https://github.com/microsoft/planetary-computer-tasks@main#subdirectory=pctasks/cli&quot;,
    # &quot;pctasks.client @ git+https://github.com/microsoft/planetary-computer-tasks@main#subdirectory=pctasks/client&quot;,
    &quot;pctasks.run @ git+https://github.com/microsoft/planetary-computer-tasks@main#subdirectory=pctasks/run&quot;,
]
</code></pre>
<p><code>pctasks.run</code> references the rest of the projects of <code>pctasks</code>, but if I add them explicitly as dependencies then I will get an error like:</p>
<pre><code>    Updated https://github.com/microsoft/planetary-computer-tasks (a27f47c9413faea76117b205d6da8a86a0bb8d9b)
error: Requirements contain conflicting URLs for package `pctasks-client`:
- file:///private/var/folders/p0/vbz6hyr901z17__1xr798h2w0000gn/T/.tmpYEPdVI/git-v0/checkouts/773f2287cfaa68da/a27f47c/pctasks/client
- git+https://github.com/microsoft/planetary-computer-tasks@main#subdirectory=pctasks/client
</code></pre>
<p>I just have to comment on the transitive dependencies to make it work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cdb39">@cdb39</a> on 2025-05-06 19:15</div>
            <div class="timeline-body"><p>I'm getting a similar issue with uv 0.7.2 and the following setup:</p>
<p>Project B depends on Project A and specifies:</p>
<pre><code>[tool.uv.sources]
A = { git = &quot;ssh://git@github/A.git&quot;, rev = &quot;foo&quot; }
</code></pre>
<p>Then Project C which has a direct dependency on B and A specifies</p>
<pre><code>[tool.uv.sources]
A = { git = &quot;ssh://git@github/A.git&quot;, branch = &quot;foo&quot; }
B = { git = &quot;ssh://git@github/B.git&quot; }
</code></pre>
<p>&quot;branch&quot; and &quot;rev&quot; are different but I believe these would actually end up resolving to the same thing.</p>
<p>Personally it feels counter-intuitive that by specifying git as a source, uv is now seemingly transitively using uv sources from that dependency.   If I was installing via any other artifact (such as a published sdist), then Project C's resolution would completely ignore Project A's uv.sources, right?</p>
<p>I appreciate that others might actually prefer that uv uses the sources of the dependencies as those dependencies declare, but perhaps the behaviour could be at least configurable?  Apologies if it already is, I hunted around but couldn't find anything.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ships">@ships</a> on 2025-05-28 23:52</div>
            <div class="timeline-body"><p>I have a similar situation to @cdb39 , it particularly inconvenient when we want to test a feature branch on A, we have to create out a feature branch on B that refers to that branch with no other changes, and change both references upstream. You can imagine this situation cascading though luckily for us it is only 1 deep.</p>
<p>It would be nice to have a configuration for <code>uv</code> in <code>pyproject.toml</code> or even like <code>--no-sources</code> at CLI, which is like <code>--no-transitive-sources</code> or similar.</p>
<p>Thanks for your attention! Lovin this tool.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ryanc-bs">@ryanc-bs</a> on 2025-07-24 16:50</div>
            <div class="timeline-body"><p>Would it be possible to just ignore the [tool.uv.sources] section entirely in dependencies, or else allow the top level pyproject.toml to set a different package source without giving a &quot;Requirements contain conflicting URLs&quot; error?</p>
<p>This is super annoying when installing through git where you have multiple inter-dependent packages if you use git tags and/or branches to specify the version.</p>
<p>For example let's say package A depends on B and C, and B also depends on C. Let's say that in project B the source for C is &quot;https://github.com/foo/bar@v1.2.3&quot; and in project A I set the source to &quot;&quot;https://github.com/foo/bar@v1.2.4&quot; instead. Currently this results in an error, so I cannot bump the version of C in A without bumping it in B first and then bumping B and C together in A. What I want instead is to just ignore the source defined in B and use A as the source of truth.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ryanc-bs">@ryanc-bs</a> on 2025-07-25 08:24</div>
            <div class="timeline-body"><blockquote>
<p>Would it be possible to just ignore the [tool.uv.sources] section entirely in dependencies, or else allow the top level pyproject.toml to set a different package source without giving a &quot;Requirements contain conflicting URLs&quot; error?</p>
<p>This is super annoying when installing through git where you have multiple inter-dependent packages if you use git tags and/or branches to specify the version.</p>
<p>For example let's say package A depends on B and C, and B also depends on C. Let's say that in project B the source for C is &quot;https://github.com/foo/bar@v1.2.3&quot; and in project A I set the source to &quot;&quot;https://github.com/foo/bar@v1.2.4&quot; instead. Currently this results in an error, so I cannot bump the version of C in A without bumping it in B first and then bumping B and C together in A. What I want instead is to just ignore the source defined in B and use A as the source of truth.</p>
</blockquote>
<p>In summary - I'm not familiar with the uv internals but I think the solution here should be quite straightforward from a high level:</p>
<p>With regards to [tool.uv.sources] entries: in case of a conflict, should always use the source which is higher in the tree of dependencies. Only raise an error if two entries at the same level in the hierarchy disagree on the source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dnadlinger">@dnadlinger</a> on 2025-08-15 21:54</div>
            <div class="timeline-body"><p>@ryanc-bs Agreed on the usefulness of such an override behaviour: Let's say library <code>A</code> depends on <code>B</code> which is not on PyPI and will require a Git dependency. In the public release of <code>A</code>, I want to depend on an upsteam version of <code>B</code>. For internal development, I want to have a meta-package <code>C</code> that pulls in both <code>A</code> as well as an internal fork of <code>B</code>. The end goal is to have <code>C</code>, with a committed lock file, serve as an internal base development environment, while also keeping <code>A</code> available as a public library.</p>
<p>For this use case, however, it seems that specifying <code>[tool.uv] overide-dependencies = [&quot;B&quot;]</code> in <code>C/pyproject.toml</code> is good enough (?).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ships">@ships</a> on 2025-09-19 20:11</div>
            <div class="timeline-body"><p>In our case, i think <code>override-dependencies</code> is sufficient to avoid multiple repo branches! Thanks for that pointer ðŸŽ‰</p>
<p>It would be ergonomic still, to have something like <code>authoritative = true</code> or <code>override_transitive_sources = true</code> in the <code>tool.uv.sources</code> block, or allow something similar project-wide, since otherwise we would have to replicate the source info re-encoded in the python dependency string syntax, in the <code>override-dependencies</code>.</p>
<p>If i understood, this essentially as @ryanc-bs suggests but with a config flag rather than resolving that way by default.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:32 UTC
    </footer>
</body>
</html>
