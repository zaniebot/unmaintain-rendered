<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support `--compile-bytecode` in `uv python install` - astral-sh/uv #16408</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support <code>--compile-bytecode</code> in <code>uv python install</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16408">#16408</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2025-10-22 11:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>We should add an <code>--compile-bytecode</code> option to <code>uv python install</code> that bytecode compiles the standard library.</p>
<h2>Background</h2>
<p>See https://github.com/astral-sh/uv/issues/16378 for previous discussion.</p>
<p><code>sudo apt install python3</code> on Ubuntu installs Python with a bytecode compiled standard library (<code>__pycache__/*.pyc</code>). The <code>python</code> docker images strip <code>.pyc</code> files, to save image space (https://github.com/docker-library/python/issues/615#issuecomment-842692129). Python build standalone installations currently aren't bytecode compiled either.</p>
<p>When installing packages with bytecode compilation (default in pip, in uv with <code>--compile-bytecode</code>), only installed Python files are compiled, but not the standard library. But when using pip in the <code>python</code> docker as the (default) root user in the runtime stage, or when using it with Python build standalone, just running pip imports many standard library packages, which compiles them to bytecode. This primes the cache for faster startup, while running uv doesn't do that.</p>
<p>While the situation with the <code>python</code> docker image is more ambiguous (e.g., changing the system installation requires root, and we don't want to recommend running uv as root for faster performance), we can implement faster startup from (Docker) images with Python build standalone by adding an option to bytecode compile the standard library on installation:</p>
<pre><code>uv python install --compile-bytecode
</code></pre>
<p>We should also bytecode compile the standard library when <code>uv sync --compile-bytecode</code> installs a Python interpreter.</p>
<h2>Benchmarks</h2>
<p><strong>Dockerfile.uv</strong></p>
<pre><code class="language-Dockerfile">FROM ghcr.io/astral-sh/uv:debian-slim

RUN uv python install 3.13.9
RUN uv venv
RUN uv pip install --compile-bytecode fastapi==0.119.0

ENV PATH=&quot;/.venv/bin:$PATH&quot;
</code></pre>
<p><strong>Dockerfile.uv-compile</strong></p>
<pre><code class="language-Dockerfile">FROM ghcr.io/astral-sh/uv:debian-slim

RUN uv python install 3.13.9
RUN uv venv
RUN uv pip install --compile-bytecode fastapi==0.119.0

ENV PATH=&quot;/.venv/bin:$PATH&quot;
RUN python -B -m compileall ~/.local/share/uv/python/cpython-3.13.9-linux-x86_64-gnu/lib/python3.13
</code></pre>
<pre><code>docker build . -t uv-fastapi -f Dockerfile.uv
docker build . -t uv-fastapi-compile -f Dockerfile.uv-compile
hyperfine  --warmup 2 \
    'docker run --rm uv-fastapi python -c &quot;import fastapi&quot;' \
    'docker run --rm uv-fastapi-compile python -c &quot;import fastapi&quot;'
</code></pre>
<pre><code>$ hyperfine 'docker run --rm uv-fastapi python -c &quot;import fastapi&quot;' 'docker run --rm uv-fastapi-compile python -c &quot;import fastapi&quot;' --warmup 2
Benchmark 1: docker run --rm uv-fastapi python -c &quot;import fastapi&quot;
  Time (mean ± σ):     872.7 ms ±  19.8 ms    [User: 7.0 ms, System: 6.0 ms]
  Range (min … max):   845.7 ms … 914.1 ms    10 runs
 
Benchmark 2: docker run --rm uv-fastapi-compile python -c &quot;import fastapi&quot;
  Time (mean ± σ):     566.2 ms ±  18.1 ms    [User: 6.4 ms, System: 6.7 ms]
  Range (min … max):   542.0 ms … 599.9 ms    10 runs
 
Summary
  docker run --rm uv-fastapi-compile python -c &quot;import fastapi&quot; ran
    1.54 ± 0.06 times faster than docker run --rm uv-fastapi python -c &quot;import fastapi&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2025-10-22 11:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @EliteTK by @EliteTK on 2025-12-11 16:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @EliteTK on 2026-01-13 17:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-13 17:29:10 UTC
    </footer>
</body>
</html>
