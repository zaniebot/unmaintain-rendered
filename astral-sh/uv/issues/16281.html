<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package resolution should retry with no cache if a requested version is not found - astral-sh/uv #16281</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Package resolution should retry with no cache if a requested version is not found</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16281">#16281</a>
        opened by <a href="https://github.com/MaddyGuthridge">@MaddyGuthridge</a>
        on 2025-10-13 12:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MaddyGuthridge">@MaddyGuthridge</a> on 2025-10-13 12:30</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I manage developer tools using the wonderful <a href="https://mise.jdx.dev/"><code>mise</code></a>, which uses <code>uv</code> under the hood to manage Python tools.</p>
<p>I have found that when upgrading some tools, <code>mise</code> will have a newer cache than <code>uv</code>, causing <code>uv</code> to refuse to install recent package releases, claiming that these packages do not exist (despite the fact that they do).</p>
<p>I opened a <a href="https://github.com/jdx/mise/discussions/6606">discussion</a> where a project contributor stated that it was best to resolve this issue upstream.</p>
<h3>To reproduce</h3>
<ol>
<li>Publish a new version of some package</li>
<li><code>uv tool install package==[new version]</code></li>
</ol>
<h3>Actual output</h3>
<p><code>uv</code> fails despite the version being available on pypi.</p>
<details>

<pre><code class="language-sh">$ uv tool install markten==1.3.1 -v
DEBUG uv 0.9.2
DEBUG Acquired shared lock for `/home/maddy/.cache/uv`
DEBUG Searching for default Python interpreter in managed installations or search path
DEBUG Searching for managed installations at `/home/maddy/.local/share/uv/python`
DEBUG Found `cpython-3.13.7-linux-x86_64-gnu` at `/home/maddy/bin/python` (first executable in the search path)
DEBUG Acquired lock for `/home/maddy/.local/share/uv/tools`
DEBUG Checking for Python environment at: `/home/maddy/.local/share/uv/tools/markten`
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13.7
DEBUG Solving with target Python version: &gt;=3.13.7
DEBUG Adding direct dependency: markten&gt;=1.3.1, &lt;1.3.1+
DEBUG Found fresh response for: https://pypi.org/simple/markten/
DEBUG Searching for a compatible version of markten (&gt;=1.3.1, &lt;1.3.1+)
DEBUG No compatible version found for: markten
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of markten==1.3.1 and you require markten==1.3.1, we can conclude that your requirements are unsatisfiable.
DEBUG Released lock at `/home/maddy/.local/share/uv/tools/.lock`
DEBUG Released lock at `/home/maddy/.cache/uv/.lock`
</code></pre>
<p>Or worse, when I use Mise:</p>
<pre><code>$ mise upgrade --debug
DEBUG ARGS: /home/maddy/.local/bin/mise upgrade --debug
DEBUG config: ~/.config/mise/config.toml
INFO  mise 2025.10.6 by @jdx              upgrade
DEBUG install_some_versions: pipx:markten@1.3
INFO  pipx:markten@1.3.1                  install
INFO  pipx:markten@1.3.1                  uv tool install markten==1.3.1
DEBUG Converted registry URL to index URL: https://pypi.org/simple
DEBUG $ uv tool install markten==1.3.1
  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of markten==1.3.1 and you require
      markten==1.3.1, we can conclude that your requirements are
      unsatisfiable.
      hint: `markten` was found on https://pypi.org/simple, but not at
      the requested version (markten==1.3.1). A compatible version may be
      available on a subsequent index (e.g., https://pypi.org/simple). By
      default, uv will only consider versions that are published on the first
      index that contains a given package, to avoid dependency confusion
      attacks. If all indexes are equally trusted, use `--index-strategy
      unsafe-best-match` to consider all versions from all indexes, regardless
      of the order in which they were defined.
ERROR uv failed
DEBUG config: ~/.config/mise/config.toml
Error:
   0: Failed to install pipx:markten@1.3:
         0: uv exited with non-zero status: exit code 1

      Location:
         src/cmd.rs:488

      Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it.
      Run with RUST_BACKTRACE=full to include source snippets.

Location:
   src/toolset/mod.rs:264

Version:
   2025.10.6 linux-x64 (2025-10-08)

Backtrace omitted. Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.
</code></pre>
</details>

<h3>Expected output</h3>
<p>Upon realising that the version of the dependency doesn't exist in its cache, <code>uv</code> should retry, skipping its cache.</p>
<h3>Workarounds</h3>
<p>Manually skip the cache using <code>UV_NO_CACHE=1</code> as an environment variable</p>
<h3>Platform</h3>
<p>Linux 6.16.10-200.fc42.x86_64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.9.2</p>
<h3>Python version</h3>
<p>Python 3.11.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MaddyGuthridge on 2025-10-13 12:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-13 12:39</div>
            <div class="timeline-body"><p>uv (unlike pip) is following pypi's 10min cache header, so that not every uv invocation has to send revalidation requests. Independent of handling the case of a missing pinned version better, a workaround is to use <code>--refresh</code>, which will make uv revalidate all dependencies, without ignoring the cache entirely as <code>--no-cache</code> does.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MaddyGuthridge">@MaddyGuthridge</a> on 2025-10-13 12:44</div>
            <div class="timeline-body"><p>Is there a way to make <code>uv</code> use the <code>--refresh</code> option as an environment variable, since when running <code>mise upgrade</code>, I cannot pass arguments directly to <code>uv</code>? Even then, making it auto-refresh would still be a good improvement for the case where the requested version does not exist.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-12-18 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2025-12-18 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-18 16:59</div>
            <div class="timeline-body"><p>We don't have a <code>UV_REFRESH</code>, but I'm sure about why, it might be possible to add it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-12-18 17:04</div>
            <div class="timeline-body"><blockquote>
<p>uv (unlike pip) is following pypi's 10min cache header</p>
</blockquote>
<p>FYI I'm planning of changing this back in pip to respect the cache header by default: https://github.com/pypa/pip/issues/13680. No ETA to when I can work on this though.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:13 UTC
    </footer>
</body>
</html>
