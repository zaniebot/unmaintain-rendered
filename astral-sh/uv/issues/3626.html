<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mTLS Support? - astral-sh/uv #3626</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>mTLS Support?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3626">#3626</a>
        opened by <a href="https://github.com/SystemCoder99">@SystemCoder99</a>
        on 2024-05-16 15:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/SystemCoder99">@SystemCoder99</a> on 2024-05-16 15:08</div>
            <div class="timeline-body"><p>Now that uv.toml is implemented and we can set the native-tls flag, will there be support for mTLS?
Will we be able to pass a client_cert file path through the uv.toml so our developers and their package repos can authenticate each other?
We rely heavily on this feature in pip, it would be great to see UV have some kind of implementation too!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-17 02:01</div>
            <div class="timeline-body"><p>Can you say more about how you're using this in pip? Perhaps link to an example or the relevant part of the pip implementation?</p>
<p>It sounds reasonable to configure certificates via the persistent config file. We do support <code>SSL_CERT_FILE</code> already.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SystemCoder99">@SystemCoder99</a> on 2024-05-17 12:10</div>
            <div class="timeline-body"><p>So for pip, we use the &quot;cert&quot; and &quot;client_cert&quot; items in our pip.conf, &quot;cert&quot; to pass the path to our trust store, and &quot;client_cert&quot; to pass the path to the file containing both our client certificate and it's key. <a href="https://pip.pypa.io/en/stable/cli/pip/#cmdoption-client-cert">Pip's cert and client-cert options</a>. Our pip.conf currently looks something like this:</p>
<blockquote>
<p>[global]
index-url=https://package.index.one.url
extra-index-url=https://package.index.two.url
cert=/path/to/ca-chain.crt
client_cert = /path/to/client_cert/bundle.pem</p>
</blockquote>
<p>When a developer only needs to use TLS, we only pass the &quot;cert&quot; item, and it authenticates our jfrog index - which is what I see happens when we use UV with native-tls. But when we need to use mTLS, the &quot;client_cert&quot; item is ALSO added into the pip.conf and passed in the index request.</p>
<p>My understanding from the UV docs is SSL_CERT_FILE is what is used to point directly to our trust store/what we pass in the &quot;cert&quot; item, INSTEAD of native-tls, right? We need something where we can use the native-tls, while also passing the client-cert bundle as well.
<a href="https://github.com/pypa/pip/blob/612515d2e0a6ff8676c139c096a45bc28b3456f4/src/pip/_internal/cli/index_command.py#L78">Pip's _build_session()</a> and <a href="https://github.com/pypa/pip/blob/612515d2e0a6ff8676c139c096a45bc28b3456f4/src/pip/_vendor/urllib3/contrib/securetransport.py#L544">Pip's TLS handshake()</a> both implement the cert and client_cert options, if that helps at all</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-05-17 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2024-05-17 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-17 13:20</div>
            <div class="timeline-body"><p>Thanks for the additional details. This seems reasonable but I'd have to start working on an implementation to understand if it makes sense.</p>
<p>The <code>SSL_CERT_FILE</code> loading comes from https://github.com/rustls/rustls-native-certs but I <em>think</em> that's their behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alkatar21">@alkatar21</a> on 2024-06-04 16:51</div>
            <div class="timeline-body"><p>We also need the <code>cert</code> option. I think our problem is simmilar. Currently this option is used for pip to access our index and I have not found an alternative way with <code>uv</code> to access our index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-04 18:22</div>
            <div class="timeline-body"><p>I'm guessing this looks something like https://github.com/camelop/rust-mtls-example/blob/1379379eb08c63f22f9b4eae080c9380e29ffd44/src/main.rs#L22-L71</p>
<p>If anyone is interested in putting up a pull request I'm happy to review</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2024-06-04 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4171.html">astral-sh/uv#4171</a> on 2024-06-09 16:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-06-11 01:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-12 13:15</div>
            <div class="timeline-body"><p>@SystemCoder99 this should be available in the latest release.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
