<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build the package when the source code directories are on a read-only file system - astral-sh/uv #15745</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Build the package when the source code directories are on a read-only file system</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15745">#15745</a>
        opened by <a href="https://github.com/luzfcb">@luzfcb</a>
        on 2025-09-08 22:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/luzfcb">@luzfcb</a></div>
            <div class="timeline-body">Question
<p>The old setup.py has the ability to change some directories so that, during the build process, nothing is written to the source code directory. This can be achieved with something like</p>
<pre><code>
export SDIST_BASE_PARENT=&quot;/tmp/build_dir&quot;
export SDIST_DIST_DIR=&quot;/tmp/build_dir/dist&quot;
export BDIST_WHEEL_DIST_DIR=&quot;/tmp/build_dir/dist&quot;
export BDIST_WHEEL_BDIST_DIR=&quot;/tmp/build_dir/bdist&quot;
export BUILD_BUILD_BASE=&quot;/tmp/build_dir/build&quot;
export EGG_INFO_EGG_BASE=&quot;/tmp/build_dir/build&quot;


export PYTHON_EGG_CACHE=&quot;/tmp/build_dir/egg-cache&quot;


mkdir -p ${SDIST_DIST_DIR} ${BDIST_WHEEL_BDIST_DIR} ${BUILD_BUILD_BASE} ${PYTHON_EGG_CACHE}

python setup.py egg_info --egg-base ${EGG_INFO_EGG_BASE} build --build-base ${BUILD_BUILD_BASE} sdist --dist-dir ${SDIST_DIST_DIR} bdist_wheel --dist-dir ${BDIST_WHEEL_DIST_DIR} --bdist-dir ${BDIST_WHEEL_BDIST_DIR}

</code></pre>
<p>Note:</p>
  

  About the egg-info: distutils&#x27;s egg-info built into setuptools is somewhat inconsistent and doesn&#x27;t respect egg-base in all stages. I have a patch that modifies sdist source code to force it to respect it. Click here
  

<pre><code>   # replace the by make_distribution on site-packages/setuptools/_distutils/command/sdist.py
   # by
    def make_distribution(self) -&gt; None:
        &quot;&quot;&quot;Create the source distribution(s).  First, we create the release
        tree with &#x27;make_release_tree()&#x27;; then, we create all required
        archive files (according to &#x27;self.formats&#x27;) from the release tree.
        Finally, we clean up by blowing away the release tree (unless
        &#x27;self.keep_temp&#x27; is true).  The list of archive files created is
        stored so it can be retrieved later by &#x27;get_archive_files()&#x27;.
        &quot;&quot;&quot;
        # Minimal change: compute base_dir under a writable parent (outside the project root).
        from pathlib import Path
        fullname = self.distribution.get_fullname()
        dist_dir = getattr(self, &quot;dist_dir&quot;, None) or &quot;dist&quot;
        base_parent = os.environ.get(&quot;SDIST_BASE_PARENT&quot;) or str(Path(dist_dir).parent)
        base_dir = os.path.join(base_parent, fullname)
        base_name = os.path.join(dist_dir, fullname)

        self.make_release_tree(base_dir, self.filelist.files)
        archive_files = []  # remember names of files we create
        # tar archive must be created last to avoid overwrite and remove
        if &#x27;tar&#x27; in self.formats:
            self.formats.append(self.formats.pop(self.formats.index(&#x27;tar&#x27;)))

        for fmt in self.formats:
            file = self.make_archive(
                base_name, fmt, base_dir=base_dir, owner=self.owner, group=self.group
            )
            archive_files.append(file)
            self.distribution.dist_files.append((&#x27;sdist&#x27;, &#x27;&#x27;, file))

        self.archive_files = archive_files

        if not self.keep_temp:
            dir_util.remove_tree(base_dir, dry_run=self.dry_run)

</code></pre>
  

<p>How to perform the same, but with use on a setup.py project using <code>uv build --sdist</code> and <code>uv build --wheel</code></p>
<p>currently, <code>uv</code> only provides  <code>--out-dir</code></p>
<pre><code>buildserver@10e2ea701264:/apps/tools/mylib$ uv build --sdist --out-dir /tmp/build_dir/dist
Building source distribution...
running sdist
running egg_info
creating mylib.egg-info
error: could not create &#x27;mylib.egg-info&#x27;: Read-only file system
  × Failed to build `/apps/tools/mylib`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_sdist` failed (exit status: 1)
      hint: This usually indicates a problem with the package or the build environment.

</code></pre>
Platform
<p>Linux 6.11.0-26-generic x86_64 GNU/Linux</p>
Version
<p>uv 0.8.15</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/luzfcb">@luzfcb</a> on 2025-09-08 22:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-09 12:49</div>
            <div class="timeline-body"><p>It is a decision of the build backend whether to write to the source directory at all. setuptools is the exception in that it writes to the build directory by default, other build backends usually only write to temp files, the output directory and occasionally a build cache for native code (which may be in- or outside the source tree). I&#x27;m not sure if setuptools can be configured to not write to the source tree, I&#x27;d recommend asking in https://github.com/pypa/setuptools/discussions, uv as build frontend does not control. It&#x27;s also possible that a different build backend solves this.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:17 UTC
    </footer>
</body>
</html>
