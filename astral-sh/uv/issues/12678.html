<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should `uv sync` support pep-0496 markers? - astral-sh/uv #12678</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should <code>uv sync</code> support pep-0496 markers?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12678">#12678</a>
        opened by <a href="https://github.com/zaphar">@zaphar</a>
        on 2025-04-04 18:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zaphar">@zaphar</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I looked and couldn't find an issue on this already. I'm trying to use uv on a project with some optional dependencies that aren't supported on my platform. <code>uv sync</code> still tries to install them and then fails. <code>uv pip install -r requirements.txt</code> works just fine so this isn't a blocker or anything.</p>
<h3>Example</h3>
<p>Say I have a requirements.txt with lines like this in it:</p>
<pre><code>numpy==1.26.4
nvidia-cublas-cu11==11.10.3.66; sys_platform != 'darwin' and platform_machine != 'arm64'
</code></pre>
<p>Ideally uv sync would only try to sync numpy and skip the nvidia dep but currently it tries and fails to sync the nvidia dep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zaphar on 2025-04-04 18:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-04 23:00</div>
            <div class="timeline-body"><p>Can you share more details? We do respect markers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @zanieb on 2025-04-04 23:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-04-04 23:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zaphar">@zaphar</a> on 2025-04-05 02:23</div>
            <div class="timeline-body"><p>I have an internal project with those lines in the requirements.txt file that is referenced by the pyproject.toml. when I run <code>uv sync</code> it still tries to install the nvidia dependency but when I run <code>uv pip install -r</code> it works. This is with version 0.6.9.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-05 02:29</div>
            <div class="timeline-body"><p>We need more details â€” please share a concrete minimal reproduction as described in #9452</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @zanieb on 2025-04-05 02:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-07 19:09</div>
            <div class="timeline-body"><p>We resolve for all environments in <code>uv sync</code>, because we're creating a universal lockfile. At install time, we only install the relevant dependencies. You can narrow the set of solved environments with https://docs.astral.sh/uv/reference/settings/#environments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-04-07 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zaphar">@zaphar</a> on 2025-04-07 19:29</div>
            <div class="timeline-body"><p>That explains it thank you. I guess I'll have to avoid the <code>uv sync</code> and <code>uv lock</code> functionality for now. It's a no go on projects that have os/arch dependency differences for hardware reasons.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-07 19:39</div>
            <div class="timeline-body"><blockquote>
<p>It's a no go on projects that have os/arch dependency differences for hardware reasons.</p>
</blockquote>
<p>This shouldn't be the case, if you provide a concrete example I'm happy to help explain what's going on.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zaphar">@zaphar</a> on 2025-04-08 01:51</div>
            <div class="timeline-body"><p>I think if I use the optional groups functionality I could do what I need. But for the moment I can't convert everything over to that for ci/cid reasons on this project. <code>uv pip</code> will suffice for the moment until I get everyone standardized on uv.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:48 UTC
    </footer>
</body>
</html>
