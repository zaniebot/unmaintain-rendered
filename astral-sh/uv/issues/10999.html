<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When using `--no-sources` it seems that uv still reads some metadata from workspace packages - astral-sh/uv #10999</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>When using <code>--no-sources</code> it seems that uv still reads some metadata from workspace packages</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10999">#10999</a>
        opened by <a href="https://github.com/potiuk">@potiuk</a>
        on 2025-01-27 18:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/potiuk">@potiuk</a> on 2025-01-27 18:55</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>It's related to #10991 - I found it after I tried to make Airlfow workspaces tick.</p>
<p>The problem is that even if <code>--no-sources</code> correctly uses actually released packaged in <code>pypi</code> instead of locally installed packages, some metadata still leaks to the <code>uv pip install</code> command,</p>
<p>In airflow: we have</p>
<pre><code class="language-toml">[tool.uv.sources]
apache-airflow-providers-openlineage = { workspace = true }
</code></pre>
<p>However I wanted to use local project to install airflow (non-editable) from sources and specific version of the openlineage provider from pypi (2.0.0).</p>
<p>Our provider in PyPI is released (version 2.0.0):</p>
<p>https://pypi.org/project/apache-airflow-providers-openlineage/2.0.0/</p>
<p>One of it's required dependencies is <code>apache-airflow-providers-common-compat&gt;=1.3.0</code></p>
<p>In our repo however, in the workspace package we already made the provider dependds on <code>apache-airflow-providers-common-compat&gt;=1.4.0</code> - in preparation for the upcoming release. We do not yet whether it is going to be openlineage provider 2.1.0 or 3.0.0 - depending whether it will have some breaking changes, but we already know that it needs common.compat &gt;= 1.4.0. So while <code>common.compat&gt;=1.4.0</code> is already updated, the pyproject.toml of the provider stil has <code>2.0.0</code> version set - it will be bumped by the release manager at the release time:</p>
<p>https://github.com/apache/airflow/blob/f6b05fe243c17ffb80a4d2497fa7849f27ea507e/providers/openlineage/pyproject.toml#L60</p>
<p>The problem is that this <code>common.compat &gt;= 1.4.0</code> and possibly other metadata leaks from the local workspace when <code>--no-sources</code> is used.</p>
<p>Running command:</p>
<pre><code>uv pip install --system --no-sources '.[all-core]' --resolution highest \
 apache-airflow-providers-openlineage==2.0.0 \
 apache-airflow-providers-common-compat==1.3.0  [SOME MORE PROIVDERS]
</code></pre>
<p>I get this error:</p>
<pre><code>Using Python 3.9.21 environment at: /usr/local
   Built apache-airflow @ file:///opt/airflow
  × No solution found when resolving dependencies:
  ╰─▶ Because apache-airflow-providers-openlineage==2.0.0 depends on apache-airflow-providers-common-compat&gt;=1.4.0 and you require apache-airflow-providers-common-compat==1.3.0, we can conclude that your requirements and apache-airflow-providers-openlineage==2.0.0 are incompatible.
      And because you require apache-airflow-providers-openlineage==2.0.0, we can conclude that your requirements are unsatisfiable.```
</code></pre>
<p>Seems like the <code>common-compat&gt;=1.4.0</code> comes from local workspace version of the package and not from <code>PyPI</code> 2.0.0 version.</p>
<h3>Platform</h3>
<p>Ubuntu 22.04</p>
<h3>Version</h3>
<p>0.5.24</p>
<h3>Python version</h3>
<p>3.9.21</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @potiuk on 2025-01-27 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @konstin on 2025-01-27 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-01-27 23:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:54 UTC
    </footer>
</body>
</html>
