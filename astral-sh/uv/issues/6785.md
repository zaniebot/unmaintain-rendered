```yaml
number: 6785
title: "`uv add` treats valid `pyproject.toml` as invalid"
type: issue
state: closed
author: metaist
labels:
  - bug
assignees: []
created_at: 2024-08-29T00:38:30Z
updated_at: 2024-08-29T02:08:32Z
url: https://github.com/astral-sh/uv/issues/6785
synced_at: 2026-01-10T01:57:15Z
```

# `uv add` treats valid `pyproject.toml` as invalid

---

_Issue opened by @metaist on 2024-08-29 00:38_

```
$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.4 LTS
Release:        22.04
Codename:       jammy

$ uv -vv add --optional foo pyright
    0.006241s DEBUG uv uv 0.4.0
    0.006540s DEBUG uv_workspace::workspace Found project root: `/home/metaist/github.com/ds`
    0.007855s DEBUG uv_workspace::workspace No workspace root found, using project root
    0.008276s DEBUG uv::commands::project The virtual environment's Python version satisfies `Python >=3.8`
 uv_requirements::specification::from_source source=pyright
 uv_client::linehaul::linehaul 
    0.009417s DEBUG uv_client::base_client Using request timeout of 30s
 uv_resolver::flat_index::from_entries 
error: Dependencies in `pyproject.toml` are malformed
```
Here's the [`pyproject.toml`](https://github.com/metaist/ds/blob/main/pyproject.toml).

Interestingly, if I run `uv add pyright` or `uv add --dev pyright` it works just fine.

---

_Label `bug` added by @charliermarsh on 2024-08-29 01:15_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-08-29 01:15_

---

_Comment by @charliermarsh on 2024-08-29 01:15_

Thanks! Will take a look.

---

_Referenced in [astral-sh/uv#6787](../../astral-sh/uv/pulls/6787.md) on 2024-08-29 02:01_

---

_Closed by @charliermarsh on 2024-08-29 02:08_

---
