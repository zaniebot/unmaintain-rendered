<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long Pandas compile time (&gt;7 minutes) - astral-sh/uv #8885</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Long Pandas compile time (&gt;7 minutes)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8885">#8885</a>
        opened by <a href="https://github.com/beoRich">@beoRich</a>
        on 2024-11-07 10:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/beoRich">@beoRich</a> on 2024-11-07 10:57</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>We are trying uv as pip replacement and encounter an usual long compile time:
uv sync --reinstall -n --verbose</p>
<pre><code>.....
DEBUG copying pandas\conftest.py -&gt; build\lib.win-amd64-cpython-312\pandas
DEBUG copying pandas\testing.py -&gt; build\lib.win-amd64-cpython-312\pandas
DEBUG copying pandas\_typing.py -&gt; build\lib.win-amd64-cpython-312\pandas
DEBUG copying pandas\_version.py -&gt; build\lib.win-amd64-cpython-312\pandas
DEBUG copying pandas\__init__.py -&gt; build\lib.win-amd64-cpython-312\pandas
DEBUG creating build\lib.win-amd64-cpython-312\pandas\api
DEBUG copying pandas\api\__init__.py -&gt; build\lib.win-amd64-cpython-312\pandas\api
DEBUG creating build\lib.win-amd64-cpython-312\pandas\arrays
DEBUG copying pandas\arrays\__init__.py -&gt; build\lib.win-amd64-cpython-312\pandas\arrays
DEBUG creating build\lib.win-amd64-cpython-312\pandas\compat
DEBUG copying pandas\compat\chainmap.py -&gt; build\lib.win-amd64-cpython-312\pandas\compat
DEBUG copying pandas\compat\pickle_compat.py -&gt; build\lib.win-amd64-cpython-312\pandas\compat
DEBUG copying pandas\compat\pyarrow.py -&gt; build\lib.win-amd64-cpython-312\pandas\compat
.....
</code></pre>
<p>and on via dockerimage:</p>
<pre><code># builder image
FROM ghcr.io/astral-sh/uv:python3.12-bookworm AS builder
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

WORKDIR /app

ENV UV_LINK_MODE=copy
ENV UV_COMPILE_BYTECODE=0
ENV UV_SYSTEM_PYTHON=1

RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --verbose --frozen --no-install-project --no-dev

ADD . /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# final image
FROM python:3.12-slim-bookworm
COPY --from=builder --chown=app:app /app /app
WORKDIR /app

ENTRYPOINT [&quot;python3&quot;]
CMD [&quot;-m&quot;, &quot;application&quot;]
</code></pre>
<p>Since we are using a CI/CD Pipeline with no cache this is too long to be useable.
Pipeline CD Step with uv, dockerbuildtime: 645.7s
Pipeline CD Step with pip, dockerbuildtime: around 90s</p>
<p>Is there any way to fix this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-07 13:23</div>
            <div class="timeline-body"><p>I don't think using pip vs. uv should have any impact on Pandas build times -- they both just call the relevant build backend, none of the build happens in pip or uv. I have two questions: (1) why is Pandas building from source in the first place? Are you on a really old version that doesn't ship wheels or something? And (2) are you sure that you're also building Pandas from source in the pip version of your pipeline?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-07 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/beoRich">@beoRich</a> on 2024-11-07 15:20</div>
            <div class="timeline-body"><ol>
<li>Don't think so, the version ist 1.5.3 which was released Jan 19, 2023. We have no idea why its building from source...it is added via transitive dependency via an own package with extra Index.
project -&gt; own package -&gt; own package (with pandas 1.5.3)
The own packages itself are published via pip, setup.py and twine:</li>
</ol>
<pre><code>python setup.py sdist bdist_wheel
twine upload --repository codeartifact dist/*
</code></pre>
<ol start="2">
<li>Yes we saw the same logs there.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/beoRich">@beoRich</a> on 2024-11-07 15:28</div>
            <div class="timeline-body"><p>Ah I see it tries to access the private extra index for cache and wheel and doesn't find anything.</p>
<pre><code>DEBUG Building: pandas==1.5.3
DEBUG Ignoring empty directory
DEBUG Resolving build requirements
DEBUG Solving with installed Python version: 3.12.0
DEBUG Solving with target Python version: &gt;=3.12.0
DEBUG Adding direct dependency: setuptools&gt;=51.0.0
DEBUG Adding direct dependency: wheel*
DEBUG Adding direct dependency: cython&gt;=0.29.32, &lt;3
DEBUG Adding direct dependency: oldest-supported-numpy&gt;=2022.8.16
DEBUG Searching for a compatible version of setuptools (&gt;=51.0.0)
DEBUG Selecting: setuptools==75.3.0 [compatible] (setuptools-75.3.0-py3-none-any.whl)
DEBUG No cache entry for: &lt;PrivateRepo&gt;/simple/wheel/
</code></pre>
<p>Do I need to explicitly add the https://pypi.org/project/pandas/ index?
This is how the pyproject.toml looks like:</p>
<pre><code>[project]
name = &quot;&lt;project&gt;&quot;
version = &quot;0.1.0&quot;
description = &quot;&lt;desc&gt;&quot;
requires-python = &quot;==3.12.*&quot;
readme = &quot;README.md&quot;
dependencies = [
    &quot;&lt;ownPackage&gt;==11.3.0&quot;,
    &quot;pyhamcrest&quot;,
    &quot;pre-commit&quot;,
    &quot;ruff&quot;,
    &quot;coverage&quot;,
    &quot;pandas==1.5.3&quot;,
]
[[tool.uv.index]]
name = &quot;internal&quot;
url = &quot;https://aws:$CODEARTIFACT_AUTH_TOKEN@&lt;privateIndex&gt;
</code></pre>
<p>Edit:
Also saw in the uv.lock that pandas has no wheel entry..:
<img src="https://github.com/user-attachments/assets/8d450cf6-0913-4050-974c-98adc9ba1aa0" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-11-07 17:15</div>
            <div class="timeline-body"><p>FWIW, pandas 1.5.3 only officially supported Python 3.8 to 3.11: https://pypi.org/project/pandas/1.5.3/#files</p>
<p>Using it with Python 3.12 has no guarantee of working.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/beoRich">@beoRich</a> on 2024-11-08 13:57</div>
            <div class="timeline-body"><p>Thanks, switching to 3.11.9 fixed it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @beoRich on 2024-11-08 13:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
