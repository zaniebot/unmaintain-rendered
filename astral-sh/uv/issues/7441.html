<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't build uv 4.10 on Archlinux - astral-sh/uv #7441</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Can't build uv 4.10 on Archlinux</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7441">#7441</a>
        opened by <a href="https://github.com/mardiros">@mardiros</a>
        on 2024-09-16 21:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mardiros">@mardiros</a> on 2024-09-16 21:05</div>
            <div class="timeline-body"><p>Hi,</p>
<p>I am trying to update (uv package for archlinux users)[https://gitlab.archlinux.org/archlinux/packaging/packages/uv/-/merge_requests/1] but I have an invalid dynamic links bound to the uv binary.</p>
<ul>
<li>A minimal code snippet that reproduces the bug.</li>
</ul>
<p>Using archlinux with the last rustc stable compiler (1.18.1) and maturin 1.7.1</p>
<pre><code class="language-bash">$ git clone git@github.com:astral-sh/uv.git
$ cd uv
$ maturin build
</code></pre>
<p>Afterwhat the <code>uv</code> binary is linked to non existing library <code>libbz2-3265f064.so.1.0</code></p>
<pre><code class="language-bash">$ ldd target/debug/uv
        linux-vdso.so.1 (0x000076ffea2db000)
        libbz2-3265f064.so.1.0 =&gt; not found
        libgcc_s.so.1 =&gt; /usr/lib/libgcc_s.so.1 (0x000076ffea280000)
        libm.so.6 =&gt; /usr/lib/libm.so.6 (0x000076ffea191000)
        libc.so.6 =&gt; /usr/lib/libc.so.6 (0x000076ffe620f000)
        /lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x000076ffea2dd000)
</code></pre>
<p>Afterwhat it cabbot be repaired.</p>
<pre><code>~/workspace/git/uv on ÓÇ† main [!] is üì¶ v0.4.10 via üêç v3.12.5 via ü¶Ä v1.81.0
$  maturin build
üì¶ Including license file &quot;/home/guillaume/workspace/git/uv/LICENSE-APACHE&quot;
üì¶ Including license file &quot;/home/guillaume/workspace/git/uv/LICENSE-MIT&quot;
üçπ Building a mixed python/rust project
üîó Found bin bindings
üì° Using build options bindings from pyproject.toml
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.21s
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.21s
üì¶ Including files matching &quot;rust-toolchain.toml&quot;
üí• maturin failed
  Caused by: Cannot repair wheel, because required library libbz2-3265f064.so.1.0 could not be located.
</code></pre>
<p>I currently use patchelf to fix the binding after the build.</p>
<p>Note that while using <code>cargo build</code>, the uv binary build does not have the wrong binding.</p>
<pre><code class="language-bash">$ ldd target/debug/uv
        linux-vdso.so.1 (0x00007516d5679000)
        libbz2.so.1.0 =&gt; /usr/lib/libbz2.so.1.0 (0x00007516d5639000)
        libgcc_s.so.1 =&gt; /usr/lib/libgcc_s.so.1 (0x00007516d560b000)
        libm.so.6 =&gt; /usr/lib/libm.so.6 (0x00007516d1711000)
        libc.so.6 =&gt; /usr/lib/libc.so.6 (0x00007516d1520000)
        /lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007516d567b000)
</code></pre>
<p>At the moment, I did not succeed at isolate the bug between maturin and bzip2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 21:13</div>
            <div class="timeline-body"><p>cc @konstin</p>
<p>Thanks for the report!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-09-16 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">releases</span> added by @zanieb on 2024-09-16 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 21:27</div>
            <div class="timeline-body"><p>Were you able to build previous versions of uv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-16 21:29</div>
            <div class="timeline-body"><p>This patch wasn't required for the previous version, but that was <code>0.3.1</code> ‚Äî it'd be great to have more clarity about when this regressed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mardiros">@mardiros</a> on 2024-09-17 06:50</div>
            <div class="timeline-body"><blockquote>
<p>Were you able to build previous versions of uv?</p>
</blockquote>
<p>Good question, because I did not try before you ask (I am not the maintainer of the package).</p>
<p>So at the moment, building tags <code>0.3.1</code>, I am having the same issue.</p>
<p>As I see, maturin is using patchelf so I suppose the issue should be in <a href="https://github.com/PyO3/maturin/blob/main/src/build_context.rs#L359">maturin itself</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mardiros">@mardiros</a> on 2024-09-17 07:01</div>
            <div class="timeline-body"><p>Ok so i've started from the first commit that introduce libbz2</p>
<p><code>* d2551bb2 - (HEAD) Add support for .tar.bz2 source distributions (#3069) (5 months ago) &lt;Sergey Kolosov&gt;</code></p>
<p>And its where the bug come from.</p>
<pre><code>~/workspace/git/uv on ÓÇ† HEAD (d2551bb) is üì¶ v0.1.32 via üêç v3.12.5 via ü¶Ä v1.77.2 took 2s
‚ùØ ldd target/debug/uv
        linux-vdso.so.1 (0x000073ec50566000)
        libbz2-3265f064.so.1.0 =&gt; not found
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0x000073ec5051f000)
        libgcc_s.so.1 =&gt; /usr/lib/libgcc_s.so.1 (0x000073ec504f1000)
        libm.so.6 =&gt; /usr/lib/libm.so.6 (0x000073ec50402000)
        libc.so.6 =&gt; /usr/lib/libc.so.6 (0x000073ec4ca0f000)
        /lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x000073ec50568000)
</code></pre>
<p>I suppose that you can close the issue, because it is probably not related on uv itself and now, I should probably open
an issue at maturin.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-09-17 08:55</div>
            <div class="timeline-body"><p>maturin uses patchelf to bundle shared libraries into the wheel so it can be uploaded to pypi without external dependencies.</p>
<p>Unfortunately, i can't reproduce your problem on my machine (f679987fe1908c8a815dbcbc6a2a112ae49858ba):</p>
<pre><code class="language-console">$ uvx maturin build
üì¶ Including license file &quot;/home/konsti/projects/uv/LICENSE-APACHE&quot;
üì¶ Including license file &quot;/home/konsti/projects/uv/LICENSE-MIT&quot;
üçπ Building a mixed python/rust project
üîó Found bin bindings
üì° Using build options bindings from pyproject.toml
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.10s
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.10s
‚ö†Ô∏è  Warning: No compatible platform tag found, using the linux tag instead. You won't be able to upload those wheels to PyPI.
üì¶ Including files matching &quot;rust-toolchain.toml&quot;
üì¶ Built wheel to /home/konsti/projects/uv/target/wheels/uv-0.4.10-py3-none-linux_x86_64.whl
$ ldd target/debug/uv
	linux-vdso.so.1 (0x00007fffbc57e000)
	libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007d2ef9dad000)
	libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007d2ef5f17000)
	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007d2ef5c00000)
	/lib64/ld-linux-x86-64.so.2 (0x00007d2ef9dfa000)
</code></pre>
<p>fwiw you don't critically need maturin, for uv it essentially calls <code>cargo build</code> and bundles the resulting binaries (<code>uv</code> and <code>uvx</code>) with the python entrypoint (the <code>python</code> directory), so if pacman uses a custom format anyway you can also bundle those yourself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-17 13:34</div>
            <div class="timeline-body"><p>@mardiros Would you be able to ping one of the uv package maintainers on this issue? We're happy to help ‚Äî it's a bummer to see such an old version on Arch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kahojyun">@kahojyun</a> on 2024-09-17 16:22</div>
            <div class="timeline-body"><p>Do we need to repair the wheel with <code>patchelf</code> when packaging for a specific distro? This process can be skipped by passing <code>--compatibility linux</code> or <code>--auditwheel skip</code> to <code>maturin</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mardiros">@mardiros</a> on 2024-09-17 21:01</div>
            <div class="timeline-body"><p>I have good news.</p>
<p>The proposal from @kahojyun  to pass <code> --compatibility linux</code> works.</p>
<p>@zanieb</p>
<blockquote>
<p>@mardiros Would you be able to ping one of the uv package maintainers on this issue? We're happy to help ‚Äî it's a bummer to see such an old version on Arch.</p>
</blockquote>
<p>Both issues are cross referenced. I agree that Arch user deserve an up to date version of uv, this is why I starts my contribution.</p>
<p>Thanks everyone for the help and support. üôèüèø</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mardiros on 2024-09-17 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/orhun">@orhun</a> on 2024-09-18 12:13</div>
            <div class="timeline-body"><p>uv 4.11 is now packaged &amp; available for Arch Linux!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
