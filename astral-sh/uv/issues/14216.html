<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automate `source .venv/bin/activate` when github codesspaces starts - astral-sh/uv #14216</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Automate `source .venv/bin/activate` when github codesspaces starts</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/14216">#14216</a>
        opened by <a href="https://github.com/oliverangelil">@oliverangelil</a>
        on 2025-06-23 14:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/oliverangelil">@oliverangelil</a> on 2025-06-23 14:48</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I am using github codespaces with UV.
I don't want to have to type out:</p>
<pre><code>uv venv
source .venv/bin/activate
uvsync

</code></pre>
<p>every time I start a new codespace.</p>
<p>I am using a <code>postCreateCommand.sh</code> script with the above 3 lines of code.</p>
<p>I also have a <code>devcontainer.json</code> file that looks like:</p>
<pre><code>// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/python
{
	&quot;name&quot;: &quot;Python 3&quot;,
	// Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
	&quot;image&quot;: &quot;mcr.microsoft.com/devcontainers/base:debian&quot;,
	&quot;features&quot;: {
		&quot;ghcr.io/va-h/devcontainers-features/uv:1&quot;: {},
		&quot;ghcr.io/dhoeric/features/google-cloud-cli:1&quot;: {},
		&quot;ghcr.io/robbert229/devcontainer-features/opentofu:1&quot;: {}	
	},
	// Use 'forwardPorts' to make a list of ports inside the container available locally.
	// &quot;forwardPorts&quot;: [],

	// Use 'postCreateCommand' to run commands after the container is created.
	&quot;postCreateCommand&quot;: &quot;./.devcontainer/postCreateCommand.sh&quot;,

	// Configure tool-specific properties.
	&quot;customizations&quot;: {
		// Configure properties specific to VS Code.
		&quot;vscode&quot;: {
	  	// Add the IDs of extensions you want installed when the container is created.
	  		&quot;extensions&quot;: [
				&quot;github.copilot&quot;,
				&quot;charliermarsh.ruff&quot;,
				&quot;github.vscode-github-actions&quot;,
				&quot;ms-python.vscode-pylance&quot;
	  		]
		}
  	}
}
</code></pre>
<p>However, it runs the <code>postCreateCommand.sh</code> command too soon which leads to some odd side effects. For example see #14215 .</p>
<p>What is the recommended way to automate this in codespaces?</p>
<h3>Platform</h3>
<p>Debian GNU/Linux 12 (bookworm)</p>
<h3>Version</h3>
<p>uv 0.7.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @oliverangelil on 2025-06-23 14:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-06-23 14:57</div>
            <div class="timeline-body"><p>I'm not familiar with the details of codespaces, but activating a venv is setting <code>VIRTUAL_ENV</code>, adding the bin dir to <code>PATH</code> and (optionally) changing the shell prompt, so maybe the way the scripts are run interact badly with your shell, you may be able to fix this by applying the environment variable changes through a different devcontainer option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Ishangoai/AIMS_course/issues/85.html">Ishangoai/AIMS_course#85</a> on 2025-06-23 15:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nataziel">@nataziel</a> on 2025-06-25 23:59</div>
            <div class="timeline-body"><p>I don't believe that is the correct way to use the <code>postCreateCommand</code>, as it runs separately to whatever terminal(s) you might be using.</p>
<p>I do a lot of work in devcontainers (not codespaces) but I think they work similarly. Assuming you have <code>pyproject.toml</code> setup correctly for <code>uv</code>, you can use the <code>postCreateCommand</code> to sync the venv like so:</p>
<pre><code class="language-json">{
  ...
  &quot;postCreateCommand&quot;: &quot;uv sync&quot;,
  ...
}
</code></pre>
<p><code>uv sync</code> will handle creating the venv if it doesn't already exist so you don't need to manually create it &amp; activate it yourself before running the command.</p>
<p>Then as long as you have selected that venv as the python interpreter, when you launch a new terminal it should automatically activate that venv. This behaviour is controlled by the  <code>python.terminal.activateEnvironment</code> setting in vscode (hopefully there's a similar setting in codespaces).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/oliverangelil">@oliverangelil</a> on 2025-06-27 15:45</div>
            <div class="timeline-body"><p>I've added this line to devcontainer.json:
<code>&quot;postCreateCommand&quot;: &quot;uv sync &amp;&amp; echo 'source .venv/bin/activate' &gt;&gt; ~/.bashrc&quot;, </code></p>
<p>You can see the full code in <a href="https://github.com/Ishangoai/AIMS_course/blob/49ae94ec06c4f7efc5c0d9f0a5a8eaf5cb1d15d3/.devcontainer/devcontainer.json">this</a> commit.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:04 UTC
    </footer>
</body>
</html>
