<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated shebang lines output 'realpath: --: No such file or directory' - astral-sh/uv #16209</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Generated shebang lines output 'realpath: --: No such file or directory'</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/16209">#16209</a>
        opened by <a href="https://github.com/maxwell-k">@maxwell-k</a>
        on 2025-10-09 15:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/maxwell-k">@maxwell-k</a> on 2025-10-09 15:31</div>
            <div class="timeline-body"><p>Example command to reproduce on Alpine Linux:</p>
<pre><code>uv tool run --from charset-normalizer normalizer --version</code></pre>
<p>Expected output:</p>
<pre><code>Charset-Normalizer 3.4.3 - Python 3.12.11 - Unicode 15.0.0 - SpeedUp ON</code></pre>
<p>Actual output:</p>
<pre><code>realpath: --: No such file or directory
Charset-Normalizer 3.4.3 - Python 3.12.11 - Unicode 15.0.0 - SpeedUp ON</code></pre>
<details>
<summary>Background to --</summary>

<p>As background POSIX guidelines encourage utilities to accept <code>--</code>; this can be helpful to handle file name arguments that start with a dash. Python itself follows this guideline.</p>
<blockquote>
<p>Guideline 10: The first -- argument that is not an option-argument should be accepted as a delimiter indicating the end of options. Any following arguments should be treated as operands, even if they begin with the '-' character.</p>
</blockquote>
<p>—<a href="https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html">https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html</a></p>
</details>

<p>Alpine Linux utilities like <code>realpath</code> come from BusyBox not GNU Coreutils. The BusyBox <code>realpath</code> does not support <code>--</code>; and as a result outputs <code>realpath: --: No such file or directory</code>:</p>
<pre><code>~ # touch /file
~ # realpath -- /file
realpath: --: No such file or directory
/file
~ # which realpath
/usr/bin/realpath
~ # apk info --who-owns /usr/bin/realpath
/usr/bin/realpath symlink target is owned by busybox-1.37.0-r19</code></pre>
<p>Because, in certain conditions, uv adds a shebang line that includes <code>realpath --</code> the output from certain uv commands includes an extra error message.</p>
<p>A naive solution is a pull request removing <code>--</code> from shebang lines. This makes <code>uv</code> more portable to distributions like Alpine Linux that use BusyBox. A negative of that solution is for the majority of distributions, which use GNU coreutils, uv will perhaps not handle scripts starting with a dash, <code>-</code>, as effectively. I haven't quantified this negative.</p>
<details>

<summary>Detailed reproduction steps</summary>

<p>Commands to reproduce:</p>
<pre><code>incus launch images:alpine/3.22 c1
incus exec c1 apk add curl python3
incus exec c1 -- su -lc 'curl -LsSf https://astral.sh/uv/install.sh | sh'
incus exec c1 -- su -lc \
    'uv tool run --from charset-normalizer normalizer --version'</code></pre>
<p>Commands to view the shebang line:</p>
<pre><code>incus exec c1 -- sh -c \
    &quot;find /root/.cache/uv -path '*/bin/normalizer' | xargs head -n5&quot;</code></pre>
<p>Output:</p>
<pre><code>#!/bin/sh
'''exec' &quot;$(dirname -- &quot;$(realpath -- &quot;$0&quot;)&quot;)&quot;/'python' &quot;$0&quot; &quot;$@&quot;
' '''
# -*- coding: utf-8 -*-
import sys</code></pre>
</details>

<p><em>I edited the description to use a more popular package in the reproduction steps. <a href="https://pypi.org/project/charset-normalizer/">charset-normalizer</a> appears around number 8 on <a href="https://pypistats.org/top">https://pypistats.org/top</a>. The original report used <a href="https://github.com/Vimjas/vint">https://github.com/Vimjas/vint</a> which is niche by comparison.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @maxwell-k on 2025-10-09 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-10-09 17:34</div>
            <div class="timeline-body"><p>Thanks for the report.</p>
<p>cc @charliermarsh / @geofft</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2025-10-09 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @zanieb on 2025-10-09 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-10-28 23:57</div>
            <div class="timeline-body"><p>@paveldikov may be interested too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paveldikov">@paveldikov</a> on 2025-10-29 08:08</div>
            <div class="timeline-body"><p>Since this only seems to affect <code>busybox</code> (GNU and Mac are fine), I'd be happy with this being implemented as an edge case. You could have a logic branch that introspects the flavour of <code>/bin/sh</code>, and if it smells like <code>busybox</code>, post-process the POSIX-ly correct <code>--</code>s out for compatibility.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lenormju">@Lenormju</a> on 2025-11-27 11:13</div>
            <div class="timeline-body"><p>I observed this with <code>uv 0.9.13</code> (released yesterday) in the Alpine image of uv.</p>
<p>To reproduce easily :</p>
<pre><code class="language-sh">podman run --rm -it \
    --entrypoint /bin/sh \
    ghcr.io/astral-sh/uv@sha256:e7fb76eb20807c7f8d79bdb5bc9b863786556e2b62a1adb6947572a28424b204 \
    -c 'uv tool run --from charset-normalizer normalizer --version 2&gt;&amp;1 | grep realpath | wc -l'
</code></pre>
<p>gives <code>1</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-11-27 13:29</div>
            <div class="timeline-body"><p>That image is distroless, ie, it’s not intended to be used on its own like that. Please see https://docs.astral.sh/uv/guides/integration/docker/#getting-started.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
