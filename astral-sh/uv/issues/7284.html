<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Issue with `.whl` extension in dependency. - astral-sh/uv #7284</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Issue with `.whl` extension in dependency.</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7284">#7284</a>
        opened by <a href="https://github.com/EdgyEdgemond">@EdgyEdgemond</a>
        on 2024-09-11 08:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/EdgyEdgemond">@EdgyEdgemond</a> on 2024-09-11 08:36</div>
            <div class="timeline-body"><p>Following on from my questions in #7245, trying to pin pytorch for multiple architectures.</p>
<p>[edit] Have retried with 0.4.9 release and get same warnings. [/edit]</p>
<p>Minimum reproducible pyproject.toml</p>
<pre><code>[project]
name = &quot;uv-test&quot;
version = &quot;0.0.0&quot;
requires-python = &quot;&gt;=3.10,&lt;3.12&quot;

dependencies = [
    &quot;torch @ https://download.pytorch.org/whl/cpu/torch-2.0.1-cp310-none-macosx_11_0_arm64.whl ; sys_platform == 'darwin' and platform_machine == 'arm64'&quot;,
    &quot;torch @ https://download.pytorch.org/whl/cpu/torch-2.0.1-cp310-none-macosx_10_9_x86_64.whl ; sys_platform == 'darwin' and platform_machine == 'x86_64'&quot;,
    &quot;torch == 2.0.1+cpu ; sys_platform != 'darwin'&quot;,
]

[tool.uv]
extra-index-url = [&quot;https://download.pytorch.org/whl/cpu&quot;]
</code></pre>
<p>When locking on linux, all goes well</p>
<pre><code>&gt;&gt; uv lock
Using Python 3.11.9 interpreter at: /usr/bin/python3.11
Resolved 11 packages in 1.22s
</code></pre>
<p>When syncing on linux, there is a warning (the root of my question), but installation continues successfully.</p>
<pre><code>&gt;&gt; uv sync
Using Python 3.11.9 interpreter at: /usr/bin/python3.11
Creating virtualenv at: .venv
warning: Failed to validate existing lockfile: failed to parse file extension; expected one of: `.zip`, `.tar.gz`, `.tar.bz2`, `.tar.xz`, or `.tar.zst`
Resolved 11 packages in 754ms
Installed 8 packages in 79ms
 + filelock==3.13.1
 + jinja2==3.1.3
 + markupsafe==2.1.5
 + mpmath==1.3.0
 + networkx==3.2.1
 + sympy==1.12
 + torch==2.0.1+cpu
 + typing-extensions==4.9.0
</code></pre>
<p>However when syncing on a mac.</p>
<pre><code>&gt;&gt; uv sync
Using Python 3.11.9 interpreter at: /opt/homebrew/opt/python@3.11/bin/python3.11
Creating virtualenv at: .venv
warning: Failed to validate existing lockfile: failed to parse file extension; expected one of: `.zip`, `.tar.gz`, `.tgz`, `.tar.bz2`, `.tar.xz`, or `.tar.zst`
Resolved 95 packages in 4.13s
error: failed to parse file extension; expected one of: `.zip`, `.tar.gz`, `.tgz`, `.tar.bz2`, `.tar.xz`, or `.tar.zst`
  Caused by: `.zip`, `.tar.gz`, `.tgz`, `.tar.bz2`, `.tar.xz`, or `.tar.zst`
</code></pre>
<p>Is this me failing to use <code>uv</code> correctly, or should a <code>.whl</code> be a viable source (lock command seems to think so)</p>
<pre><code>[[package]]
name = &quot;torch&quot;
version = &quot;2.0.1&quot;
source = { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.0.1-cp310-none-macosx_10_9_x86_64.whl&quot; }
resolution-markers = [
    &quot;platform_machine == 'x86_64' and sys_platform == 'darwin'&quot;,
]
dependencies = [
    { name = &quot;filelock&quot;, marker = &quot;platform_machine == 'x86_64' and sys_platform == 'darwin'&quot; },
    { name = &quot;jinja2&quot;, marker = &quot;platform_machine == 'x86_64' and sys_platform == 'darwin'&quot; },
    { name = &quot;networkx&quot;, marker = &quot;platform_machine == 'x86_64' and sys_platform == 'darwin'&quot; },
    { name = &quot;sympy&quot;, marker = &quot;platform_machine == 'x86_64' and sys_platform == 'darwin'&quot; },
    { name = &quot;typing-extensions&quot;, marker = &quot;platform_machine == 'x86_64' and sys_platform == 'darwin'&quot; },
]
wheels = [
    { url = &quot;https://download.pytorch.org/whl/cpu/torch-2.0.1-cp310-none-macosx_10_9_x86_64.whl&quot;, hash = &quot;sha256:567f84d657edc5582d716900543e6e62353dbe275e61cdc36eda4929e46df9e7&quot; },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EdgyEdgemond">@EdgyEdgemond</a> on 2024-09-11 08:44</div>
            <div class="timeline-body"><p>For completeness, running lock and sync on a fresh directory on the mac.</p>
<pre><code>&gt;&gt; uv lock
Using Python 3.11.9 interpreter at: /opt/homebrew/opt/python@3.11/bin/python3.11
Resolved 95 packages in 4.10s
&gt;&gt; uv sync
Using Python 3.11.9 interpreter at: /opt/homebrew/opt/python@3.11/bin/python3.11
Creating virtualenv at: .venv
warning: Failed to validate existing lockfile: failed to parse file extension; expected one of: `.zip`, `.tar.gz`, `.tgz`, `.tar.bz2`, `.tar.xz`, or `.tar.zst`
Resolved 95 packages in 4.39s
error: failed to parse file extension; expected one of: `.zip`, `.tar.gz`, `.tgz`, `.tar.bz2`, `.tar.xz`, or `.tar.zst`
  Caused by: `.zip`, `.tar.gz`, `.tgz`, `.tar.bz2`, `.tar.xz`, or `.tar.zst`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-11 13:17</div>
            <div class="timeline-body"><p>That should work fine -- it must just be a bug? I'll take a look today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-09-11 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-09-11 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../dagster-io/dagster/pulls/24398.html">dagster-io/dagster#24398</a> on 2024-09-11 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-11 18:36</div>
            <div class="timeline-body"><p>I believe you need <code>uv lock --python 3.10</code>... Those torch versions <em>only</em> work on Python 3.10 (<code>torch-2.0.1-cp310-none-macosx_11_0_arm64.whl</code>), but you're resolving Python 3.11 based on the <code>requires-python</code>. <code>sync --python 3.10</code> works as expected for me while <code>uv sync</code> fails. That error message needs to be improved though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7303.html">astral-sh/uv#7303</a> on 2024-09-11 18:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-11 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EdgyEdgemond">@EdgyEdgemond</a> on 2024-09-11 21:52</div>
            <div class="timeline-body"><p>Ah yes, that makes a lot of sense. Thanks for the heads up. Will tighten that up in the morning and confirm it works as expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EdgyEdgemond">@EdgyEdgemond</a> on 2024-09-12 08:18</div>
            <div class="timeline-body"><p>@charliermarsh can confirm everything works as expected when used correctly.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:22 UTC
    </footer>
</body>
</html>
