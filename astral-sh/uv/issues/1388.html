<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv pip install/compile fails on AWS codeartifact repo - astral-sh/uv #1388</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv pip install/compile fails on AWS codeartifact repo</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/1388">#1388</a>
        opened by <a href="https://github.com/raylu">@raylu</a>
        on 2024-02-15 23:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/raylu">@raylu</a> on 2024-02-15 23:45</div>
            <div class="timeline-body"><p>pip works:</p>
<pre><code>$ pip install pip --index-url 'https://aws:[password]@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple' -U
Looking in indexes: https://aws:****@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple
Collecting pip
  Downloading https://[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple/pip/24.0/pip-24.0-py3-none-any.whl (2.1 MB)
     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2.1 MB 1.2 MB/s 
Installing collected packages: pip
Successfully installed pip-24.0
</code></pre>
<p>but uv doesn't:</p>
<pre><code>$ uv pip install pip --index-url 'https://aws:[password]@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple'
error: Failed to download: pip==24.0
  Caused by: HTTP status client error (404 Not Found) for url (https://[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple/24.0/pip-24.0-py3-none-any.whl#sha256=ba0d021a166865d2265246961bec0152ff124de910c5cc39f1156ce3fa7c69dc)
</code></pre>
<p>notice that pip is using <code>/simple/pip/24.0</code> but uv is using <code>/simple/24.0</code></p>
<p>related (but different URL patterns): #1362, #1371
based on #651, do you already have a AWS codeartifact repo handy to test with?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-02-15 23:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jasonprado">@jasonprado</a> on 2024-02-15 23:46</div>
            <div class="timeline-body"><p>I'm seeing similar 404s on a jfrog.io repository</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">index</span> added by @zanieb on 2024-02-15 23:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 01:06</div>
            <div class="timeline-body"><p>Does this work if you include the <code>/pip</code> in your index URL?</p>
<p>We do not have a CodeArtifact repo to test with yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 01:13</div>
            <div class="timeline-body"><p>I can set one up for us, important to have.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/raylu">@raylu</a> on 2024-02-16 01:54</div>
            <div class="timeline-body"><p>sorry, maybe I should have picked a less confusing package to install. but <code>/pip</code> there is the name of the package</p>
<pre><code>$ pip install jinja2 --index-url 'https://aws:[password]@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple'
Looking in indexes: https://aws:****@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple
Collecting jinja2
  Downloading https://[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple/jinja2/3.1.3/Jinja2-3.1.3-py3-none-any.whl (133 kB)
     ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 133.2/133.2 kB 2.1 MB/s eta 0:00:00
Collecting MarkupSafe&gt;=2.0 (from jinja2)
  Downloading https://[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple/markupsafe/2.1.5/MarkupSafe-2.1.5-cp38-cp38-manylinux_2_17_aarch64.manylinux2014_aarch64.whl (26 kB)
Installing collected packages: MarkupSafe, jinja2
Successfully installed MarkupSafe-2.1.5 jinja2-3.1.3
</code></pre>
<pre><code>$ uv pip install jinja2 --index-url 'https://aws:[password]@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple'
error: Failed to download: jinja2==3.1.3
  Caused by: HTTP status client error (404 Not Found) for url (https://[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple/3.1.3/Jinja2-3.1.3-py3-none-any.whl#sha256=7d6d50dd97d52cbc355597bd845fabfbac3f551e1f99619e39a35ce8c370b5fa)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 02:06</div>
            <div class="timeline-body"><p>Ahh thank you!</p>
<p>So to highlight the difference here:</p>
<pre><code>pip: ../simple/jinja2/3.1.3/Jinja2-3.1.3-py3-none-any.whl
uv:  ../simple/3.1.3/Jinja2-3.1.3-py3-none-any.whl
</code></pre>
<p>It looks like we're failing to include the package name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 02:11</div>
            <div class="timeline-body"><p>My guess is that the index returns relative URLs, and we're making them relative to the <em>index</em> rather than to the page that we requested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 02:14</div>
            <div class="timeline-body"><p>@raylu - Is there any way you can confirm for me, if you request the <code>https://aws:[password]@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple/flask/?format=application/vnd.pypi.simple.v1+json</code> or similar, are the URLs relative? And are they relative to <code>/simple/flask</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-16 02:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/raylu">@raylu</a> on 2024-02-16 02:22</div>
            <div class="timeline-body"><pre><code>$ curl 'https://aws:[password]@[account].d.codeartifact.us-west-2.amazonaws.com/pypi/shared-packages-pypi/simple/flask/?format=application/vnd.pypi.simple.v1+json'
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Links for flask&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Links for flask&lt;/h1&gt;
      &lt;a href=&quot;0.1/Flask-0.1.tar.gz#sha256=9da884457e910bf0847d396cb4b778ad9f3c3d17db1c5997cb861937bd284237&quot;  data-gpg-sig=&quot;false&quot; &gt;Flask-0.1.tar.gz&lt;/a&gt;
      &lt;br/&gt;
      &lt;a href=&quot;0.10.1/Flask-0.10.1.tar.gz#sha256=4c83829ff83d408b5e1d4995472265411d2c414112298f2eb4b359d9e4563373&quot;  data-gpg-sig=&quot;false&quot; &gt;Flask-0.10.1.tar.gz&lt;/a&gt;
      &lt;br/&gt;
[...]
      &lt;br/&gt;
      &lt;a href=&quot;3.0.1/flask-3.0.1.tar.gz#sha256=6489f51bb3666def6f314e15f19d50a1869a19ae0e8c9a3641ffe66c77d42403&quot; data-requires-python=&quot;&amp;gt;=3.8&quot; data-gpg-sig=&quot;false&quot; &gt;flask-3.0.1.tar.gz&lt;/a&gt;
      &lt;br/&gt;
      &lt;a href=&quot;3.0.2/flask-3.0.2-py3-none-any.whl#sha256=3232e0e9c850d781933cf0207523d1ece087eb8d87b23777ae38456e2fbe7c6e&quot; data-requires-python=&quot;&amp;gt;=3.8&quot; data-gpg-sig=&quot;false&quot; &gt;flask-3.0.2-py3-none-any.whl&lt;/a&gt;
      &lt;br/&gt;
      &lt;a href=&quot;3.0.2/flask-3.0.2.tar.gz#sha256=822c03f4b799204250a7ee84b1eddc40665395333973dfb9deebfe425fefcb7d&quot; data-requires-python=&quot;&amp;gt;=3.8&quot; data-gpg-sig=&quot;false&quot; &gt;flask-3.0.2.tar.gz&lt;/a&gt;
      &lt;br/&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>I also tried with <code>-H 'Accept: application/vnd.pypi.simple.latest+json'</code> but got <code>HTTP/2 406</code>
so it looks like AWS codeartifact only does the HTML format (or I'm requesting it wrong)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 02:23</div>
            <div class="timeline-body"><p>Thanks, that's great! I assume there's no <code>&lt;base&gt;</code> tag in the file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 02:30</div>
            <div class="timeline-body"><p>Exploring in https://github.com/astral-sh/uv/pull/1413</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1413.html">astral-sh/uv#1413</a> on 2024-02-16 02:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2024-02-16 02:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/raylu">@raylu</a> on 2024-02-16 03:15</div>
            <div class="timeline-body"><p>yeah, no <code>&lt;base&gt;</code> (the only thing I cut out is a bunch of versions in the middle)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-16 03:25</div>
            <div class="timeline-body"><p>üëç I <em>think</em> we've pinpointed the problem, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-16 04:29</div>
            <div class="timeline-body"><p>Should be fixed in https://github.com/astral-sh/uv/pull/1413/commits/829a1ed5e380fb0b3b1a92383a41c4a6408b65af</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-02-16 04:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1458.html">astral-sh/uv#1458</a> on 2024-02-16 09:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:56 UTC
    </footer>
</body>
</html>
