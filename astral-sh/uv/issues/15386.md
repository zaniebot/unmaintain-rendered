```yaml
number: 15386
title: "uv 0.8.12 panics with internal error: entered unreachable code: Installed distribution could not be found in site-packages"
type: issue
state: closed
author: alex
labels:
  - bug
assignees: []
created_at: 2025-08-20T00:29:05Z
updated_at: 2025-08-20T14:04:40Z
url: https://github.com/astral-sh/uv/issues/15386
synced_at: 2026-01-10T01:57:34Z
```

# uv 0.8.12 panics with internal error: entered unreachable code: Installed distribution could not be found in site-packages

---

_Issue opened by @alex on 2025-08-20 00:29_

### Summary

Full logs here: https://github.com/pyca/cryptography/actions/runs/17084993363/job/48447256454 (from https://github.com/pyca/cryptography/pull/13322)

Relevant bit:

```
DEBUG Build info mismatch for cryptography-vectors: Url(InstalledDirectUrlDist { name: PackageName("cryptography-vectors"), version: "46.0.0.dev1", direct_url: LocalDirectory { url: "file:///home/runner/work/cryptography/cryptography/vectors", dir_info: DirInfo { editable: Some(true) }, subdirectory: None }, url: DisplaySafeUrl { scheme: "file", cannot_be_a_base: false, username: "", password: None, host: None, port: None, path: "/home/runner/work/cryptography/cryptography/vectors", query: None, fragment: None }, editable: true, path: "/home/runner/work/cryptography/cryptography/.nox/tests-rust-debug/lib/python3.13/site-packages/cryptography_vectors-46.0.0.dev1.dist-info", cache_info: Some(CacheInfo { timestamp: Some(Timestamp(SystemTime { tv_sec: 1755649240, tv_nsec: 464897504 })), commit: None, tags: None, env: {}, directories: {"src": None} }), build_info: Some(BuildInfo { config_settings: ConfigSettings({}), extra_build_requires: [], extra_build_variables: {} }) })
DEBUG Requirement installed, but not fresh: cryptography-vectors==46.0.0.dev1 (from file:///home/runner/work/cryptography/cryptography/vectors)

thread 'main2' panicked at crates/uv-installer/src/plan.rs:159:17:
internal error: entered unreachable code: Installed distribution could not be found in site-packages: cryptography-vectors==46.0.0.dev1 (from file:///home/runner/work/cryptography/cryptography/vectors)
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

The invocation is https://github.com/pyca/cryptography/blob/main/noxfile.py#L73-L78

### Platform

Ubuntu 24.04

### Version

0.8.12

### Python version

3.13

---

_Label `bug` added by @alex on 2025-08-20 00:29_

---

_Referenced in [pyca/cryptography#13322](../../pyca/cryptography/pulls/13322.md) on 2025-08-20 00:29_

---

_Comment by @woodruffw on 2025-08-20 00:38_

Just doing some triage:

Failure point is here:

https://github.com/astral-sh/uv/blob/249154ee087ce6a86f1fc35c339fb25d13d1fa10/crates/uv-installer/src/plan.rs#L158-L160

Most recent proximate change is #15289

Edit: This looks like the assumption that changed:

https://github.com/astral-sh/uv/blob/59f4598b5869a80a9fd951bcda9b6af6eb8e55d4/crates/uv-installer/src/plan.rs#L92-L97

---

_Comment by @zanieb on 2025-08-20 02:34_

Thank you for the report! (and for the triage William!)

cc @charliermarsh 

---

_Comment by @charliermarsh on 2025-08-20 08:45_

Iâ€™ll take a look today, thanks.

---

_Assigned to @charliermarsh by @charliermarsh on 2025-08-20 09:55_

---

_Comment by @charliermarsh on 2025-08-20 10:09_

Thanks, I was able to reproduce this. I understand what's going on -- I think it's actually the same "odd" panic that showed up in #15234. It's actually kind of hard to fix, I'll look for a simple patch for now to unblock.

---

_Referenced in [astral-sh/uv#15389](../../astral-sh/uv/pulls/15389.md) on 2025-08-20 10:31_

---

_Comment by @charliermarsh on 2025-08-20 10:34_

Ok, https://github.com/astral-sh/uv/pull/15389 should restore the existing behavior in these cases.

---

_Comment by @charliermarsh on 2025-08-20 10:36_

As an aside, in that noxfile, you might want to use `--config-settings-package cryptography:build-args=--profile=dev` instead, to scope the configuration to `cryptography`. In the future, adding `--config-settings=build-args=--profile=dev` may cause us to rebuild other already-installed source distributions with those new settings, since they aren't scoped to a specific package.

---

_Comment by @alex on 2025-08-20 11:30_

Cool, thanks, will do!

---

_Referenced in [pyca/cryptography#13328](../../pyca/cryptography/pulls/13328.md) on 2025-08-20 11:45_

---

_Closed by @zanieb on 2025-08-20 14:04_

---
