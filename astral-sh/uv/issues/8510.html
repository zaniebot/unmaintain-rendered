<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private repository cloudrepo.io 401 Unauthorized - astral-sh/uv #8510</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Private repository cloudrepo.io 401 Unauthorized</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8510">#8510</a>
        opened by <a href="https://github.com/imatw4r">@imatw4r</a>
        on 2024-10-23 22:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/imatw4r">@imatw4r</a> on 2024-10-23 22:37</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Hey folks! I am running to a problem installing dependencies with private registry hosted on <a href="https://www.cloudrepo.io/">cloudrepo</a>.
The command I execute is:</p>
<pre><code>uv pip install -r requirements.txt --extra-index-url https://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@[redacted].mycloudrepo.io/repositories/[redacted]
</code></pre>
<p>That causes:</p>
<pre><code>Failed to download `[redacted-package-name]==0.0.13`
  Caused by: HTTP status client error (401 Unauthorized) for url (https://[redacted].mycloudrepo.io/repositories/[redacted]/[redacted-package-name]/[redacted-package-name]-0.0.13-py2.py3-none-any.whl)
</code></pre>
<p>Executing pip command:</p>
<pre><code>pip install -r requirements.txt
</code></pre>
<p>With ENV variable <code>PIP_EXTRA_INDEX_URL=</code> set to the same value I pass via <code>--extra-index-url</code> to UV works, and the dependency is found and installed.</p>
<p>Note: I pass password &amp; username directly as a string, not trying to interpolate (I am aware of #5734 discussion). I also tried setting an environment variable UV_PIP_EXTRA_INDEX_URL but it doesn't work.</p>
<p>I know there was an issue reported (#1709) that seems to be closed already, but I wonder if it was supposed to be fixed for all platforms (azure/aws, etc) or if it's needed to be added separately for <code>mycloudrepo.io</code>?</p>
<p>Some more details:</p>
<p>Platform:
MacOS, Sonoma 14.4
M1 Apple Silicon</p>
<pre><code>uv --version
&gt; uv 0.4.22 (Homebrew 2024-10-15)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Cloudrepo.io 401 Unauthorized" to "Private repository cloudrepo.io 401 Unauthorized" by @imatw4r on 2024-10-23 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-23 23:38</div>
            <div class="timeline-body"><p>The environment variable you're looking for is <code>UV_EXTRA_INDEX_URL</code> (no <code>_PIP_</code>), though passing on the command-line should be working too. It's hard to say more without being able to debug the index response itself...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2024-10-23 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imatw4r">@imatw4r</a> on 2024-10-24 08:47</div>
            <div class="timeline-body"><p>@charliermarsh for pip it's <code>PIP_</code>, for <code>uv</code> I was using <code>UV_EXTRA_INDEX_URL</code>.</p>
<p>One, more thing that I've noticed is that installing from a file <code>uv pip install -r requirements.txt --extra-index-url ...</code> fails with 401 Unauthorized and a package:</p>
<pre><code>error: Failed to download `debonair==1.8.0`
  Caused by: HTTP status client error (401 Unauthorized) for url (https://[REDACTED].mycloudrepo.io/repositories/[REDACTED]/debonair/debonair-1.8.0-py3-none-any.whl)
</code></pre>
<p>While installing package directly: <code>uv pip install debonair==1.8.0 --extra-index-url ...</code> works just fine.</p>
<p>I am attaching an output of <code>uv pip install -vv -r requirements.txt --extra-index-url ...</code> - maybe it will help:
<a href="https://github.com/user-attachments/files/17504114/out.txt">out.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-24 12:38</div>
            <div class="timeline-body"><p>Can you share redacted logs with <code>RUST_LOG=uv=trace</code>? That'll give us more information about the authentication flow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imatw4r">@imatw4r</a> on 2024-10-24 15:58</div>
            <div class="timeline-body"><p>@zanieb thanks for the info about <code>RUST_LOG=trace</code>. It helped me solved the issue.</p>
<p>TLDR in my <code>requirements.txt</code> I had specified:</p>
<pre><code># Add our private package repo, with read only credentials.
--extra-index-url https://${CLOUDREPO_USERNAME}:${CLOUDREPO_PASSWORD}@[REDACTED].mycloudrepo.io/repositories/goodrx

package1==version
package2==version
</code></pre>
<p>And seems like index specified in <code>requirements.txt</code> has higher priority over the one passed explicitly via <code>--extra-index-url</code> when calling <code>uv pip install</code>, which caused an issue for me as I didn't have these env variables specified.</p>
<p>It works now, sorry for the inconvenience @zanieb @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @imatw4r on 2024-10-24 18:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
