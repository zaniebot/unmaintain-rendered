<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv publish` uploads every file in `/dist` - astral-sh/uv #8033</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv publish` uploads every file in `/dist`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8033">#8033</a>
        opened by <a href="https://github.com/david-waterworth">@david-waterworth</a>
        on 2024-10-09 06:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-10-09 06:01</div>
            <div class="timeline-body"><p>I'm not sure if this expected but I noticed <code>uv publish</code> uploaded every single file it found in <code>/dist</code> to (our private) pypi. On the plus side this surfaced a build script bug (post-build clean step not running) - but it was a little suprising.</p>
<p>The behaviour of <code>poetry publish</code> is to only publish the <code>the package, previously built with the build command</code> - i.e. (I'm assuming) it uses the version from pyproject.toml to ensure the correct sdist / wheel is uploaded.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @charliermarsh on 2024-10-09 12:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TiansuYu">@TiansuYu</a> on 2024-10-09 15:59</div>
            <div class="timeline-body"><p>potentially duplicate to this one https://github.com/astral-sh/uv/issues/7917</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-09 16:04</div>
            <div class="timeline-body"><p>I don't think this is a duplicate, though this is sort of discussed there.</p>
<p>I think this behavior is pretty reasonable, though maybe we can improve it or have different modes? I think we'd need to read the package from the <code>pyproject.toml</code> if we wanted to limit the scope.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-10-10 01:52</div>
            <div class="timeline-body"><p>Also wheel/sdist filenames contain a version string that's &quot;canonicalised&quot; and doens't necesarily match the version string in <code>pyproject.toml</code> - in order to get the filename of the wheel in my ci process (in which the version is generated by <code>python-semantic-release</code> I had to use the <code>packaging</code> package, i.e.</p>
<pre><code>from packaging.version import Version

def canonicalise(version: str):
    return str(Version(version))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-10 07:12</div>
            <div class="timeline-body"><p>Canonicalizing the name is a requirement from the Python packaging specs (https://packaging.python.org/en/latest/specifications/binary-distribution-format/#escaping-and-unicode)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-10-10 07:40</div>
            <div class="timeline-body"><p>Yeah but that’s just the {version} in the package filename though right? The actual package version doesn’t have to be canonical as far as I’m aware?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-12 19:01</div>
            <div class="timeline-body"><p>The spec says:</p>
<blockquote>
<p>Version numbers should be normalised according to the <a href="https://packaging.python.org/en/latest/specifications/version-specifiers/#version-specifiers">Version specifier specification</a>. Normalised version numbers cannot contain -.</p>
</blockquote>
<p>The critical part is that we can't have the <code>-</code> in a version because then you can't tell whether it's part of the version or starting the next section in the wheel filename.</p>
<hr />
<p>I'd recommend cleaning the dist directory before doing a new publish and then relying on globs to find your files, basically the workflow below:</p>
<pre><code>rm -r dist/
uv build
[other uv build command if you publish a workspace]
[smoke test commands, such as installing the `mypkg-*.tar.gz`/`mypkg-*.whl` in a fresh venv and running `python -c &quot;import mypkg&quot;`]
uv publish
</code></pre>
<p>Would a workflow like that work for your use case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-10-12 21:29</div>
            <div class="timeline-body"><p>Yeah I understand that - &quot;The canonical public version identifiers MUST comply with the following scheme:&quot; <code>[N!]N(.N)*[{a|b|rc}N][.postN][.devN]</code> and the filename needs to contain the canonicalized version for the reason you mention.</p>
<p>But I don't think the package version needs to - i.e. later in the same document</p>
<pre><code>Post releases allow a .,-, or _ separator as well as omitting the separator all together. The normal form of this is with the . separator. This allows versions such as 1.2-post2 or 1.2post2 which normalize to 1.2.post2.
</code></pre>
<p>So it's allowed to have the version in the project.toml to contain <code>1.2-post2</code> but the build backend must canonicalise this - so the point I was trying to make is given a valid version, in order to find the corresponding wheel you need to canonicalise it - but you also must not enfore that the version string is canonical in the first place as far as I understand. So you should expect that that matching a wheel to a valid version isn't trivial.</p>
<p>It's no big deal though, I've already updated our build process to ensure that the dist folder was cleaned out (along with ensuring it doesn't publish the same version twice) to ensure uv behaves in the same manner as poetry. So I'm fine if you want to close this as not doing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-10-12 21:34</div>
            <div class="timeline-body"><p>Thanks - will close.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2024-10-12 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16030.html">astral-sh/uv#16030</a> on 2025-09-25 19:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:04 UTC
    </footer>
</body>
</html>
