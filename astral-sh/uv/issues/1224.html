<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jupyter sometimes fails to install - astral-sh/uv #1224</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Jupyter sometimes fails to install</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1224">#1224</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-02-01 14:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-01 14:22</div>
            <div class="timeline-body"><p>If I run <code>python -m scripts.bench --puffin ./scripts/requirements/compiled/jupyter.txt</code> enough times, it will eventually fail with:</p>
<pre><code>error: Failed to install: jupyterlab-4.0.11-py3-none-any.whl (jupyterlab==4.0.11)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmphqqjw2bm/tmp525tkoe0/.venv/share/icons/hicolor/scalable`
  Caused by: File exists (os error 17)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-01 14:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-01 14:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-01 14:26</div>
            <div class="timeline-body"><p>High-priority bug, I'll fix it today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-01 14:32</div>
            <div class="timeline-body"><p>Various other incarnations of the same issue, to help understand the conflict:</p>
<pre><code class="language-text">error: Failed to install: jupyterlab-4.0.11-py3-none-any.whl (jupyterlab==4.0.11)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmpwdvv_3ac/tmpyg8gnfgf/.venv/share/icons/hicolor/scalable`
  Caused by: File exists (os error 17)

error: Failed to install: jupyterlab-4.0.11-py3-none-any.whl (jupyterlab==4.0.11)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmpev2bts2z/tmpgn09za74/.venv/share/jupyter/lab/schemas`
  Caused by: File exists (os error 17)

error: Failed to install: notebook-7.0.7-py3-none-any.whl (notebook==7.0.7)
  Caused by: failed to create directory `/private/var/folders/nt/6gf2v7_s3k13zq_t3944rwz40000gn/T/tmpuo9hjrtw/tmp95ctafr1/.venv/share/icons/hicolor/scalable/apps`
  Caused by: File exists (os error 17)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-01 14:35</div>
            <div class="timeline-body"><p>These are all data directories, that's on the <code>install_data</code> path. Could it be https://github.com/astral-sh/puffin/blob/4ad0dc8b9e921a544c46e8e48888164cdf58dd30/crates/install-wheel-rs/src/wheel.rs#L672 should be <code>create_dir_all</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-01 14:36</div>
            <div class="timeline-body"><p>Ahh you're a hero! TOCTOU</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-01 15:00</div>
            <div class="timeline-body"><p>Closed by #1227.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-01 15:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:42:54 UTC
    </footer>
</body>
</html>
