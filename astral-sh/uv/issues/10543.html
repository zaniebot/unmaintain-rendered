<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to use the parent directory `venv` within subfolders? - astral-sh/uv #10543</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>How to use the parent directory <code>venv</code> within subfolders?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/10543">#10543</a>
        opened by <a href="https://github.com/badlydrawnrob">@badlydrawnrob</a>
        on 2025-01-12 17:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/badlydrawnrob">@badlydrawnrob</a></div>
            <div class="timeline-body"><p>You can call a subfolders file with <code>uv run uvicorn src.main:app --reload</code> from the parent directory (the <code>venv</code> is stored in this parent directory). How might you run the virtual environment <code>uv</code> command from within the subfolder itself? Is that even possible?</p>
<p>If I try that I get the error:</p>
<pre><code>warning: `VIRTUAL_ENV=/Users/rob/project/build-fast-api` does not match the project environment path `/Users/rob/project/.venv` and will be ignored
error: No interpreter found for executable name `build-fast-api` in managed installations or search path
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-12 18:12</div>
            <div class="timeline-body"><p>It looks like you have <code>UV_PYTHON</code> or the <code>.python-version</code> file set to <code>build-fast-api</code>? Is there a reason you're changing the environment name to something other than <code>.venv</code>? Perhaps that's just the case in your subfolder?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-01-12 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/badlydrawnrob">@badlydrawnrob</a> on 2025-01-12 18:41</div>
            <div class="timeline-body"><p>@zanieb I set it up with <code>uv venv build-fast-api</code> for a named virtual environment. The parent directory has that <code>.python-version</code> file (which I'm assuming tells <code>uv add</code> to add packages to the correct virtual env). I did try to add a version file to subdirectories to see if it'd allow me to run <code>uv run</code> within child folders. That didn't work.</p>
<p>A couple of gotchas I had to double check:</p>
<ol>
<li>Make sure <code>. &quot;$HOME/.local/bin/env&quot;</code> is in your <code>.zshrc</code> file (Mac) — seems like <code>uv</code> added this automatically</li>
<li>Make sure you've <code>source venv-name/bin/activate</code> from the <em>parent</em> directory</li>
</ol>
<p>For instance, if I have a file <code>hello.py</code> in a subfolder <code>chapter_01</code> when I've got <code>(build-fast-api)</code> virtualenv running ...</p>
<pre><code class="language-python">def main():
    print(&quot;Hello from building-with-fast-api!&quot;)


if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<p>And try to <code>uv run hello.py</code> from the subfolder (when virtual env is in parent folder) I get this error:</p>
<pre><code>warning: `VIRTUAL_ENV=/Users/rob/project/build-fast-api` does not match the project environment path `/Users/rob/project/.venv` and will be ignored
error: No interpreter found for executable name `build-fast-api` in managed installations or search path
</code></pre>
<p>If I try to run from parent directory with <code>uv run chapter_01.hello.py</code> I get this error:</p>
<pre><code>error: Failed to spawn: `chapter_01.hello.py`
  Caused by: No such file or directory (os error 2)
</code></pre>
<p>So I don't know what I'm doing wrong. Deactivating and running <code>python3 -m chapter_01.hello</code> works fine. So perhaps it's something to do with global setup or the virtual environment.</p>
<h4>Running <code>uv run hello.py</code> file when in root folder</h4>
<p>When I'm running the command with a file in the root folder, it works, but I still get that warning:</p>
<pre><code>(build-fast-api) rob@MacBook-Pro building-with-fast-api % uv run hello.py
warning: `VIRTUAL_ENV=build-fast-api` does not match the project environment path `.venv` and will be ignored
Using CPython 3.13.1 interpreter at: build-fast-api/bin/python3
Removed virtual environment at: .venv
Creating virtual environment at: .venv
Installed 38 packages in 284ms
Hello from building-with-fast-api!
</code></pre>
<h4>Other package managers etc</h4>
<p><code>npm run [script]</code> will run from any subfolder. I expected the same from <code>uv</code> but perhaps it's my misunderstanding of how things are done in Python?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-12 21:54</div>
            <div class="timeline-body"><blockquote>
<p>The parent directory has that .python-version file (which I'm assuming tells uv add to add packages to the correct virtual env). I did try to add a version file to subdirectories to see if it'd allow me to run uv run within child folders</p>
</blockquote>
<p>Ah this sounds like a possible bug where we don't resolve the directory relative to the <code>.python-version</code> file, e.g.,</p>
<pre><code>❯ uv venv foo
❯ uv python pin foo
Updated `.python-version` from `3.12` -&gt; `foo`
❯ uv python find
/Users/zb/workspace/uv/example/foo/bin/python3
❯ mkdir bar
❯ cd bar
❯ uv python find
error: No interpreter found for executable name `foo` in virtual environments, managed installations, or search path
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-12 21:55</div>
            <div class="timeline-body"><p>I can look into fixing that, but... I would not recommend using directory names in <code>.python-version</code> files or using a custom virtual environment name in a project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/badlydrawnrob">@badlydrawnrob</a> on 2025-01-13 14:37</div>
            <div class="timeline-body"><p>@zanieb Yeah that could be it.</p>
<p>The last time I used Python was about 9 years ago, and at that point <a href="https://github.com/pyenv/pyenv">Pyenv</a> and <a href="https://github.com/pyenv/pyenv-virtualenv">Pyenv Virtual Env</a> was the thing to use. As far as I remember the named virtual environment was stored outside your working directory, so it was very helpful to name them. <code>pyenv virtualenv-init</code> was also handy as it auto-activated your virtualenv.</p>
<h4>1. Creating a sandboxed <code>venv</code> without a name</h4>
<p>Am I right in thinking that running <code>uv venv</code> from within a directory (regardless of if it was created with <code>uv init</code>) creates a sandbox for ALL project packages etc? It seems the <code>venv/bin/python</code> is symlinked to the <code>uv python install</code> location, but that's the only thing that lives outside the <code>.venv</code> folder?</p>
<h4>2. Separate environments</h4>
<p>If I do <code>uv init project1</code> and <code>uv init project2</code> then <code>uv venv</code> in both of them, the naming of the virtualenv doesn't matter as they're two different and distinct sandboxes?</p>
<h4>3. Python environment file</h4>
<p>So if they're unnamed and isolated <code>.venv</code> instances, you no longer need a <code>.python-version</code> file?</p>
<h4>4. Installing packages</h4>
<p>Will <code>uv add</code> just work, and pick the correct environment so long as you're in the project folder?</p>
<h4>5. Uninstalling virtual environments</h4>
<p>Is there a command for this? Do you just <a href="https://stackoverflow.com/questions/11005457/how-do-i-remove-delete-a-virtualenv"><code>rm -rf named-virtualenv/</code></a> delete the folder? And the <code>.venv/</code> folder?</p>
<p>I think the documentation is a bit confusing, as it splits the <code>uv</code> centered commands from the &quot;<a href="https://docs.astral.sh/uv/pip/environments/">The Pip Interface</a>&quot; (the old school way) so i wasn't sure which commands I should be using. If named virtual environments are discouraged, there should be a very obvious note there to warn against it.</p>
<p>Compared to <a href="https://elm-lang.org/">Elm Lang</a> setup is a pain in a lot of other languages (especially on the backend), so it's good to see Python is making progress! For students you want something simple and painless, like <a href="https://thonny.org/">Thonny</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-13 18:31</div>
            <div class="timeline-body"><ol>
<li>Yeah, basically. Packages are hard-linked into the environment from the cache.</li>
<li>Yes. You don't need to run <code>uv venv</code> either, we'll create it on <code>uv sync</code> or <code>uv run</code>.</li>
<li>Sort of. The <code>.python-version</code> file is used here to ensure a consistent Python version for each developer of your project. Otherwise, each developer would get the first Python version on their <code>PATH</code> (that is compatible with the project). I don't think using them to target specific environments is ideal.</li>
<li>Yes.</li>
<li>There isn't a command. You can <code>rm -rf &lt;dir&gt;</code> yes.</li>
</ol>
<p>I think #5200 would help. However, it's really hard for us to explain a transition from existing tooling since there are <em>so</em> many workflows. The guides in the documentation are intended to &quot;just work&quot; without prior knowledge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/badlydrawnrob">@badlydrawnrob</a> on 2025-01-19 13:29</div>
            <div class="timeline-body"><p>Thanks for clarifying those for me. Seems straightforward enough. I don't really need any migration guides as I'm starting from scratch. I guess you'd probably only want to support a subset of those workflows anyway, sounds like a big job!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:16 UTC
    </footer>
</body>
</html>
