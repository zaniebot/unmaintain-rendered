<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`find-links` should be automatically added to `pyproject.toml` after `uv add -f` - astral-sh/uv #8717</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`find-links` should be automatically added to `pyproject.toml` after `uv add -f`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/8717">#8717</a>
        opened by <a href="https://github.com/sheey11">@sheey11</a>
        on 2024-10-31 08:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sheey11">@sheey11</a> on 2024-10-31 08:49</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>After installed a package with <code>--find-links</code>, the next installation will fail because <code>uv</code> is unable to find package without find-links.</p>
<p>Reproduction:</p>
<pre><code class="language-sh">uname -a
# Linux GOOSE 5.15.153.1-microsoft-standard-WSL2 #1 SMP Fri Mar 29 23:14:13 UTC 2024 x86_64 GNU/Linux

uv --version
# uv 0.4.28 (debe67ffd 2024-10-28)

uv init find-links-test &amp;&amp; cd find-links-test

# see https://www.dgl.ai/pages/start.html
# the highest version of `dgl` on PyPI is 2.2.1, and the find-link
# below provides version 2.4.0.
uv add dgl -f https://data.dgl.ai/wheels/torch-2.4/cu124/repo.html

# `find-links` are not recorded
cat pyproject.toml
# [project]
# name = &quot;find-links-test&quot;
# version = &quot;0.1.0&quot;
# description = &quot;Add your description here&quot;
# readme = &quot;README.md&quot;
# requires-python = &quot;&gt;=3.11&quot;
# dependencies = [
#     &quot;dgl&gt;=2.4.0&quot;,
# ]

uv add datasets
#  × No solution found when resolving dependencies for split (python_full_version == '3.11.*'):
#  ╰─▶ Because only dgl&lt;=2.2.1 is available and your project depends on dgl&gt;=2.4.0, we can conclude that your project's requirements are unsatisfiable.
#  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.

# manually adding it to pyproject.toml
cat &lt;&lt;EOF &gt;&gt;pyproject.toml
[tool.uv]
find-links = [&quot;https://data.dgl.ai/wheels/torch-2.4/cu124/repo.html&quot;]
EOF

uv add datasets
# Installed 15 packages in 35ms
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-10-31 09:29</div>
            <div class="timeline-body"><p>I prefer manual control over find-links placement to ensure the correct search order. Automating this process could lead to unintended consequences due to the array's sensitivity to sequence.
While this approach is convenient, I don't think it's a good idea from a security standpoint.
Therefore, I personally disagree with automatically writing find-links into the configuration file.</p>
<p><strong>Note:</strong> I'm just sharing my thoughts on this. Ultimately, the decision of whether to support this feature in UV is out of my hands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @zanieb on 2024-10-31 13:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sheey11">@sheey11</a> on 2024-11-01 02:34</div>
            <div class="timeline-body"><blockquote>
<p>I prefer manual control over find-links placement to ensure the correct search order. Automating this process could lead to unintended consequences due to the array's sensitivity to sequence. While this approach is convenient, I don't think it's a good idea from a security standpoint. Therefore, I personally disagree with automatically writing find-links into the configuration file.</p>
<p><strong>Note:</strong> I'm just sharing my thoughts on this. Ultimately, the decision of whether to support this feature in UV is out of my hands.</p>
</blockquote>
<p>Reasonable, instead of record <code>find-links</code> project wide, there should be another way to check the version of that package, I find that the <code>find-links</code> actually been recorded on <code>uv.lock</code>:</p>
<pre><code class="language-toml">[[package]]
name = &quot;dgl&quot;
version = &quot;2.4.0+cu124&quot;
source = { registry = &quot;https://data.dgl.ai/wheels/torch-2.4/cu124/repo.html&quot; }
</code></pre>
<p>The <code>source</code> recorded here should be used to find the package, but seems <code>uv</code> use the <code>find-links</code> in <code>pyproject.toml</code> only.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-11-01 03:12</div>
            <div class="timeline-body"><p>@sheey11
In uv.lock, the source is indeed written directly, and the closest feature to explicitly specifying a source is currently <code>Package indexes</code>, but it seems that it doesn't support find-link.
<strong>Package indexes</strong> https://docs.astral.sh/uv/configuration/indexes/#package-indexes
<strong>uv.lock(lockfile)</strong> https://docs.astral.sh/uv/concepts/projects/#project-lockfile</p>
<p>However, I'm not sure if there's a better way to do this, since I don't use <code>find-links</code> myself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @charliermarsh by @charliermarsh on 2024-11-01 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @charliermarsh on 2024-11-01 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-01 13:30</div>
            <div class="timeline-body"><p>We probably won't write <code>find-links</code>, but I did leave space open for <code>[[tool.uv.index]]</code> entries to have a <code>find-links</code> &quot;kind&quot;, so we'd add a <code>[[tool.uv.index]]</code> entry instead. Somewhat low priority but it's a TODO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9079.html">astral-sh/uv#9079</a> on 2024-11-13 09:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`file-links` should be automatically added to `pyproject.toml` after `uv add -f`" to "`find-links` should be automatically added to `pyproject.toml` after `uv add -f`" by @zanieb on 2025-01-06 22:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2025-03-26 12:53</div>
            <div class="timeline-body"><p>@charliermarsh Is there any consideration to <code>uv add -f</code> support for <code>[[tool.uv.index]]</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-26 13:12</div>
            <div class="timeline-body"><p>Good call, we should do it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sanbei101">@sanbei101</a> on 2025-11-22 12:29</div>
            <div class="timeline-body"><p>squat</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
