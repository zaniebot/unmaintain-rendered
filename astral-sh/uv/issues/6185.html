<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv-client` cannot be compiled - astral-sh/uv #6185</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv-client</code> cannot be compiled</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6185">#6185</a>
        opened by <a href="https://github.com/fyusifov">@fyusifov</a>
        on 2024-08-18 19:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fyusifov">@fyusifov</a></div>
            <div class="timeline-body"><p><code>uv-client</code> cannot be compiled with below error message:</p>
<pre><code>   Compiling uv-client v0.0.1 (https://github.com/astral-sh/uv.git#615dda0e)
error[E0277]: the trait bound `reqwest_middleware::client::ClientWithMiddleware: From&lt;ClientWithMiddleware&gt;` is not satisfied
   --&gt; /Users/fyusifov/.cargo/git/checkouts/uv-01b33d56c4bfa7c4/615dda0/crates/uv-client/src/registry_client.rs:574:21
    |
573 |                 let mut reader = AsyncHttpRangeReader::from_head_response(
    |                                  ---------------------------------------- required by a bound introduced by this call
574 |                     self.uncached_client().client(),
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `From&lt;ClientWithMiddleware&gt;` is not implemented for `reqwest_middleware::client::ClientWithMiddleware`, which is required by `ClientWithMiddleware: Into&lt;reqwest_middleware::client::ClientWithMiddleware&gt;`
    |
    = help: the trait `From&lt;reqwest::Client&gt;` is implemented for `reqwest_middleware::client::ClientWithMiddleware`
    = help: for that trait implementation, expected `reqwest::Client`, found `ClientWithMiddleware`
    = note: required for `ClientWithMiddleware` to implement `Into&lt;reqwest_middleware::client::ClientWithMiddleware&gt;`
note: required by a bound in `AsyncHttpRangeReader::from_head_response`
   --&gt; /Users/fyusifov/.cargo/registry/src/index.crates.io-6f17d22bba15001f/async_http_range_reader-0.8.0/src/lib.rs:302:22
    |
301 |     pub async fn from_head_response(
    |                  ------------------ required by a bound in this associated function
302 |         client: impl Into&lt;reqwest_middleware::ClientWithMiddleware&gt;,
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `AsyncHttpRangeReader::from_head_response`

error[E0277]: the trait bound `reqwest_middleware::client::ClientWithMiddleware: From&lt;ClientWithMiddleware&gt;` is not satisfied
   --&gt; /Users/fyusifov/.cargo/git/checkouts/uv-01b33d56c4bfa7c4/615dda0/crates/uv-client/src/registry_client.rs:573:34
    |
573 |                   let mut reader = AsyncHttpRangeReader::from_head_response(
    |  __________________________________^
574 | |                     self.uncached_client().client(),
575 | |                     response,
576 | |                     url.clone(),
577 | |                     headers,
578 | |                 )
    | |_________________^ the trait `From&lt;ClientWithMiddleware&gt;` is not implemented for `reqwest_middleware::client::ClientWithMiddleware`, which is required by `ClientWithMiddleware: Into&lt;reqwest_middleware::client::ClientWithMiddleware&gt;`
    |
    = help: the trait `From&lt;reqwest::Client&gt;` is implemented for `reqwest_middleware::client::ClientWithMiddleware`
    = help: for that trait implementation, expected `reqwest::Client`, found `ClientWithMiddleware`
    = note: required for `ClientWithMiddleware` to implement `Into&lt;reqwest_middleware::client::ClientWithMiddleware&gt;`
note: required by a bound in `AsyncHttpRangeReader::from_head_response`
   --&gt; /Users/fyusifov/.cargo/registry/src/index.crates.io-6f17d22bba15001f/async_http_range_reader-0.8.0/src/lib.rs:302:22
    |
301 |     pub async fn from_head_response(
    |                  ------------------ required by a bound in this associated function
302 |         client: impl Into&lt;reqwest_middleware::ClientWithMiddleware&gt;,
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `AsyncHttpRangeReader::from_head_response`

error[E0277]: the trait bound `reqwest_middleware::client::ClientWithMiddleware: From&lt;ClientWithMiddleware&gt;` is not satisfied
   --&gt; /Users/fyusifov/.cargo/git/checkouts/uv-01b33d56c4bfa7c4/615dda0/crates/uv-client/src/registry_client.rs:579:18
    |
579 |                 .await
    |                  ^^^^^ the trait `From&lt;ClientWithMiddleware&gt;` is not implemented for `reqwest_middleware::client::ClientWithMiddleware`, which is required by `ClientWithMiddleware: Into&lt;reqwest_middleware::client::ClientWithMiddleware&gt;`
    |
    = help: the trait `From&lt;reqwest::Client&gt;` is implemented for `reqwest_middleware::client::ClientWithMiddleware`
    = help: for that trait implementation, expected `reqwest::Client`, found `ClientWithMiddleware`
    = note: required for `ClientWithMiddleware` to implement `Into&lt;reqwest_middleware::client::ClientWithMiddleware&gt;`
note: required by a bound in `AsyncHttpRangeReader::from_head_response`
   --&gt; /Users/fyusifov/.cargo/registry/src/index.crates.io-6f17d22bba15001f/async_http_range_reader-0.8.0/src/lib.rs:302:22
    |
301 |     pub async fn from_head_response(
    |                  ------------------ required by a bound in this associated function
302 |         client: impl Into&lt;reqwest_middleware::ClientWithMiddleware&gt;,
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `AsyncHttpRangeReader::from_head_response`

For more information about this error, try `rustc --explain E0277`.
error: could not compile `uv-client` (lib) due to 3 previous errors
</code></pre>
<p>Steps to reproduce:</p>
<ol>
<li>Create new project: <code>cargo new &lt;project_name&gt;</code></li>
<li>Add <code>uv-client</code> as a project dependency: <code>cargo add uv-client --git https://github.com/astral-sh/uv.git</code></li>
<li>Run the program: <code>cargo run</code></li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:16</div>
            <div class="timeline-body"><p>I think you need to do something like this because we have a forks of these crates:</p>
<pre><code>[dependencies]
uv-client = { git = &quot;https://github.com/astral-sh/uv.git&quot;, rev = &quot;615dda0e944f1daa65bbb8ee2f9d87a1fc914911&quot; }

[patch.crates-io]
reqwest-middleware = { git = &quot;https://github.com/astral-sh/reqwest-middleware&quot;, rev = &quot;21ceec9a5fd2e8d6f71c3ea2999078fecbd13cbe&quot; }
reqwest-retry = { git = &quot;https://github.com/astral-sh/reqwest-middleware&quot;, rev = &quot;21ceec9a5fd2e8d6f71c3ea2999078fecbd13cbe&quot; }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-18 22:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fyusifov">@fyusifov</a> on 2024-08-19 07:28</div>
            <div class="timeline-body"><p>Thanks, @charliermarsh. This worked.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:32:48 UTC
    </footer>
</body>
</html>
