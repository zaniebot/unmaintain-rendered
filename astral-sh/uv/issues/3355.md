```yaml
number: 3355
title: "universal-lock: implement routine for computing intersection of two `MarkerTree`s"
type: issue
state: closed
author: BurntSushi
labels:
  - preview
assignees: []
created_at: 2024-05-03T15:55:44Z
updated_at: 2024-05-20T12:16:18Z
url: https://github.com/astral-sh/uv/issues/3355
synced_at: 2026-01-10T01:57:07Z
```

# universal-lock: implement routine for computing intersection of two `MarkerTree`s

---

_Issue opened by @BurntSushi on 2024-05-03 15:55_

As part of #3350, the resolver ought to only fork when there are duplicative packages (as direct dependencies of another package) whose marker expressions have an empty intersection. If the marker expressions have a non-empty intersection, then forking must not happen or else we could wind up with two different versions of the same distribution in the lock file that could be installed simultaneously when the marker environment is in the intersection.

---

_Label `preview` added by @BurntSushi on 2024-05-03 15:55_

---

_Referenced in [astral-sh/uv#3350](../../astral-sh/uv/issues/3350.md) on 2024-05-03 15:55_

---

_Referenced in [astral-sh/uv#3358](../../astral-sh/uv/issues/3358.md) on 2024-05-03 18:09_

---

_Referenced in [astral-sh/uv#3520](../../astral-sh/uv/pulls/3520.md) on 2024-05-10 22:05_

---

_Referenced in [astral-sh/uv#3583](../../astral-sh/uv/pulls/3583.md) on 2024-05-14 17:21_

---

_Comment by @BurntSushi on 2024-05-20 12:16_

This was closed by https://github.com/astral-sh/uv/pull/3583.

---

_Closed by @BurntSushi on 2024-05-20 12:16_

---
