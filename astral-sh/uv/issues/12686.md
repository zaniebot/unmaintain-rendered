```yaml
number: 12686
title: "`uv self update` fails in MSYS2 environment"
type: issue
state: open
author: wilson
labels:
  - bug
assignees: []
created_at: 2025-04-05T17:32:41Z
updated_at: 2025-11-01T08:59:42Z
url: https://github.com/astral-sh/uv/issues/12686
synced_at: 2026-01-10T01:57:29Z
```

# `uv self update` fails in MSYS2 environment

---

_Issue opened by @wilson on 2025-04-05 17:32_

### Summary

I installed uv using the standalone installation script.
This is Windows 10, MSYS2. `uv 0.6.12 (e4e03833f 2025-04-02)`

When running `uv self update`, I get:
`warning: Self-update is only available for uv binaries installed via the standalone installation scripts.`

```
% command -v uv
/c/Users/Wilson/.local/bin/uv
```

This is maybe a bug related to my strange platform? The standalone installer script has direct MSYS2 support, and that code looked correct to me, so I'm not sure where the exact root is.


### Platform

Windows 10: MINGW64_NT-10.0-19045 3.6.0-529a0f09.x86_64 x86_64 Msys

### Version

uv 0.6.12 (e4e03833f 2025-04-02)

### Python version

Python 3.13.2

---

_Label `bug` added by @wilson on 2025-04-05 17:32_

---

_Referenced in [astral-sh/uv#13672](../../astral-sh/uv/issues/13672.md) on 2025-05-28 11:15_

---

_Comment by @eegli on 2025-05-29 14:16_

As mentioned in the linked issue above, [axoupdater](https://github.com/axodotdev/axoupdater) always tries to load the receipt from `%LOCALAPPDATA%/uv/uv-receipt.json` on Windows: https://github.com/astral-sh/uv/blob/72e2821d26d52f97268d318c5c70de6b336c291f/crates/uv/src/commands/self_update.rs#L47

The installation script [https://astral.sh/uv/install.sh](https://astral.sh/uv/install.sh) works for POSIX-compliant environments, including MSIS2 and even Git bash as a minimal subset of MSYS2. However, when running the installer scripts on Windows:

- Bash (https://astral.sh/uv/install.sh) dumps the receipt in `~/.config/uv/`
- Powershell (https://astral.sh/uv/install.ps1) dumps the receipt in `%LOCALAPPDATA%/uv/uv-receipt.json`

Hence, installing via Powershell works as expected, via bash the receipt is in the "wrong" place.

So can we simply move the receipt after installing via bash to where axoupdater expects it?

```sh
mkdir -p $LOCALAPPDATA/uv && mv ~/.config/uv/uv-receipt.json $LOCALAPPDATA/uv/uv-receipt.json
```

Running `uv self update` now complains with:
> The current executable is at `C:\Users\xxx\.local\bin\uv.exe` but the standalone installer was used to install uv to `/c/Users/xxx/.local/bin`. Are multiple copies of uv installed?

Very interestingly, the receipts are equivalent except for the `install_prefix` value:
- Powershell: `"install_prefix": "C:\\Users\\xxx\\.local\\bin",`
- Bash: `"install_prefix": "/c/Users/xxx/.local/bin",`

Which happens due to to path conversion. Setting the path in the receipt to a valid Windows path eventually works.


---

_Renamed from "`uv self update` prints warning in MSYS2 environment" to "`uv self update` fails in MSYS2 environment" by @zanieb on 2025-05-29 14:23_

---

_Comment by @zanieb on 2025-05-29 14:23_

Thanks for the details!

cc @Gankra 

---

_Comment by @eegli on 2025-05-29 14:29_

Enabling supporting POSIX-compliant environments is not a well-defined task. After all, should MSYS2 be considered POSIX just because it has some of the utilities?

I generally agree with uv's opinion about [configuration files](https://docs.astral.sh/uv/configuration/files/) - Windows is Windows, regardless of any software-defined compatibility layer on top of it, and any user/system level configuration should be read from `%APPDATA%` and `%SYSTEMDRIVE%`  respectively.

W.r.t to the installation itself, a straightforward way to support MSYS2/Git bash for `uv self update` would be to adjust the bash installer script to [check the presence of MSYS](https://stackoverflow.com/questions/65527286/how-to-check-if-my-program-is-running-on-mingwor-msys-shell-or-on-cmd) and, if true:
1. Move the receipt to `%LOCALAPPDATA%`,
2. Perform path conversion for `install_prefix`

This shouldn't break any existing settings and does not require adjusting the receipt lookup at all.

---

_Comment by @Gankra on 2025-05-29 14:35_

Wow incredible writeup!

---

_Comment by @Gankra on 2025-05-29 15:59_

I believe this change could be made to the installer script yes:

https://github.com/axodotdev/cargo-dist/blob/c8ba950c63f9c38c77782912ec6cdb6807bd0fbd/cargo-dist/templates/installer/installer.sh.j2#L53

---

_Comment by @eegli on 2025-05-29 16:30_

Just realized that the installer script is autogenerated from `cargo-dist`. Should I raise it in the upstream repo? 

> I believe this change could be made to the installer script yes:
> 
> https://github.com/axodotdev/cargo-dist/blob/c8ba950c63f9c38c77782912ec6cdb6807bd0fbd/cargo-dist/templates/installer/installer.sh.j2#L53

Yes, `RECEIPT_HOME` needs to be adjusted. Furthermore, `AXO_INSTALL_PREFIX` in

https://github.com/axodotdev/cargo-dist/blob/c8ba950c63f9c38c77782912ec6cdb6807bd0fbd/cargo-dist/templates/installer/installer.sh.j2#L577 

needs to evaluate to a Windows path with escaped backslashes.

---

_Comment by @zanieb on 2025-05-29 17:09_

We're working off a fork of cargo-dist for now (the upstream is no longer maintained): https://github.com/astral-sh/cargo-dist

---

_Comment by @axel-kah on 2025-10-02 14:46_

I always wondered why the update failed in my GitBash. I followed @eegli 's instructions and now I can update again üëç

Would be great if this makes it into your cargo-dist fork.

---

_Comment by @eegli on 2025-11-01 08:59_

@zanieb @Gankra since this has been open for a while, would you mind if I claim this issue and open a PR in [the cargo-dist fork](https://github.com/astral-sh/cargo-dist)?

---

_Referenced in [astral-sh/cargo-dist#51](../../astral-sh/cargo-dist/pulls/51.md) on 2025-11-07 15:04_

---
