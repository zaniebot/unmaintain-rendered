<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated PEP 751 pylock.toml from a pyproject.toml source does not match the source's requires-python value - astral-sh/uv #15995</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Generated PEP 751 pylock.toml from a pyproject.toml source does not match the source's requires-python value</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15995">#15995</a>
        opened by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a>
        on 2025-09-22 21:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2025-09-22 21:42</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi! It was suggested I create a new issue for the behavior noted at https://github.com/astral-sh/uv/issues/13497#issuecomment-3320061144 .</p>
<p>It seems that using <code>uv pip compile</code> to generate a <code>pylock.toml</code> from a <code>pyproject.toml</code> source uses the current environment's Python for <code>requires-python</code>, which can be too restrictive.</p>
<pre><code class="language-console">$ mise shell python@3.10
$ uv venv
$ . ./.venv/bin/activate
$ python -V
Python 3.10.18
$ uv init
$ uv add attrs
$ uv pip compile -o pylock.toml pyproject.toml 
$ grep -r requires-python .
./pylock.toml:requires-python = &quot;&gt;=3.10.18&quot;
./uv.lock:requires-python = &quot;&gt;=3.10&quot;
./pyproject.toml:requires-python = &quot;&gt;=3.10&quot;
$ deactivate
$ mise shell python@3.10.0
$ uv venv .venv-3-10-0
$ . ./.venv-3-10-0/bin/activate 
$ python -V
Python 3.10.0
$ uv pip install -r pylock.toml 
Using Python 3.10.0 environment at: .venv-3-10-0
error: The requested interpreter resolved to Python 3.10.0, which is incompatible with the `pylock.toml`'s Python requirement: `&gt;=3.10.18`
</code></pre>
<p>I would instead expect the <code>requires-python</code> value to match that in the <code>pyproject.toml</code> exactly, and so the <code>pylock.toml</code> would be installable for the same range of Python versions.</p>
<h3>Platform</h3>
<p>Linux 6.16.8-zen1-1-zen x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.8.19 (fc7c2f8b5 2025-09-19)</p>
<h3>Python version</h3>
<p>Python 3.10.18, Python 3.10.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AndydeCleyre on 2025-09-22 21:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-22 21:51</div>
            <div class="timeline-body"><p>I don't know if this is intended to work with <code>uv pip compile</code>, which interacts with a <code>pyproject.toml</code> in a fairly naive way.</p>
<p>The <code>requires-python</code> value is correct with <code>uv export</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-22 21:52</div>
            <div class="timeline-body"><p>I believe what you're seeing from <code>uv pip compile</code> is the version of the Python interpreter we're using for the resolution, not the Python version in the source(s) it reads.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @zanieb on 2025-09-22 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2025-09-25 20:25</div>
            <div class="timeline-body"><p>In the temporary workaround department:</p>
<pre><code class="language-python">#!/usr/bin/env python3
# /// script
# requires-python = &quot;&gt;=3.10&quot;
# dependencies = [
#     &quot;plumbum&quot;,
#     &quot;tomlkit&quot;,
#     &quot;uv&quot;,
# ]
# ///

import sys

import tomlkit
from plumbum import FG, local
from plumbum.cmd import uv

if '-h' in sys.argv[1:] or '--help' in sys.argv[1:]:
    print(f&quot;USAGE: {sys.argv[0]} [-U|--upgrade]&quot;, file=sys.stderr)
    sys.exit()

if '-o' in sys.argv[1:] or '--output-file' in sys.argv[1:]:
    print(&quot;Broken, pending https://github.com/astral-sh/uv/issues/3248&quot;)
    sys.exit(1)

pyproject = local.path('pyproject.toml')
pylock = local.path('pylock.toml')

req_python = tomlkit.parse(pyproject.read())['project'].get('requires-python')

uv_args = [
    'pip',
    'compile',
    '-qo',
    str(pylock.relative_to(local.cwd)),
    str(pyproject.relative_to(local.cwd)),
    *sys.argv[1:],
]
uv[uv_args] &amp; FG

if req_python:
    data = tomlkit.parse(pylock.read())
    data['requires-python'] = req_python
    pylock.write(data.as_string())
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2025-09-25 20:40</div>
            <div class="timeline-body"><p>In case it helps in decision making, <a href="https://packaging.python.org/en/latest/specifications/pylock-toml/#pylock-toml-spec">the spec</a> defines the field as</p>
<blockquote>
<p>Specifies the <a href="https://packaging.python.org/en/latest/specifications/core-metadata/#core-metadata-requires-python">Requires-Python</a> for the minimum Python version compatible for any environment supported by the lock file (i.e. the minimum viable Python version for the lock file).</p>
</blockquote>
<p>And that link leads to the Core Metadata <code>requires-python</code>, which is the same definition applied to the <code>pyproject.toml</code> field:</p>
<blockquote>
<p>This field specifies the Python version(s) that the distribution is compatible with. Installation tools may look at this when picking which version of a project to install.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-26 00:43</div>
            <div class="timeline-body"><p>In <code>uv pip compile</code>, the <code>pyproject.toml</code> you input is just one of many sources, e.g., you could include multiple <code>pyproject.toml</code> files, or you could provide a <code>pyproject.toml</code> and a <code>requirements.txt</code> file. There's not a 1:1 mapping between the <code>requires-python</code> in one of those sources and the resolution we're performing â€” so we don't try. In contrast, <code>uv export</code> is for a single project. I'm not sure why you can't use that instead :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2025-09-26 01:32</div>
            <div class="timeline-body"><p>I had been avoiding uv commands which push their own notion of a &quot;project,&quot; so that the operations would fit well across workflows, and not surprise me with implicit changes.</p>
<p>Is it possible to use uv export without a uv lock file? If we use it to create the pylock.toml then delete the uv lock file, will future locks use the state of pylock.toml to generate minimally changed versions, as I believe the pattern is with uv pip compile?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndydeCleyre">@AndydeCleyre</a> on 2025-10-02 14:29</div>
            <div class="timeline-body"><p>Here's a much simpler workaround for those of us using mise tasks:</p>
<pre><code>uv pip compile --python-version={{exec(command='mise tool --requested python')}} ...
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
