<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` Ignores Lower Bound for Transitive Dependency - astral-sh/uv #9322</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv pip compile` Ignores Lower Bound for Transitive Dependency</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/9322">#9322</a>
        opened by <a href="https://github.com/vladislavlh">@vladislavlh</a>
        on 2024-11-21 14:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vladislavlh">@vladislavlh</a> on 2024-11-21 14:37</div>
            <div class="timeline-body"><p>Hello <code>uv</code> team! ðŸ‘‹</p>
<p>First, I want to express my gratitude for the effort and dedication youâ€™ve put into building and maintaining <code>uv</code>. Itâ€™s a fantastic tool, and Iâ€™ve been enjoying exploring its capabilities.</p>
<p>That said, I recently encountered a small issue while trying to compile dependencies with <code>uv</code>. Below are the details:</p>
<hr />
<h4><strong>Environment</strong></h4>
<ul>
<li><strong>uv version</strong>: <code>uv 0.5.3 (56d362208 2024-11-19)</code></li>
<li><strong>Platform</strong>: <code>MacOS Sequoia 15.1.1</code>,</li>
<li><strong>Python version</strong>: <code>Python 3.12.7</code></li>
</ul>
<hr />
<h4><strong>Steps to Reproduce</strong></h4>
<p>Given the following input file <code>reqs.in</code>:</p>
<pre><code>shap
</code></pre>
<p>When running the command:</p>
<pre><code class="language-bash">uv pip compile reqs.in -o reqs.txt --verbose
</code></pre>
<h5><strong>Observed Behaviour</strong></h5>
<p>The resulting <code>reqs.txt</code> includes a pinned version of <code>numba</code> that does not respect the lower bound specified in the <code>shap</code> library's <code>pyproject.toml</code> file:</p>
<pre><code>numba==0.53.1
</code></pre>
<p>However, as specified in shap's <a href="https://github.com/shap/shap/blob/master/pyproject.toml#L24">pyproject.toml</a>, the dependency for numba should have a lower bound of <code>&gt;=0.54</code>.</p>
<p>From the verbose output, we see:</p>
<pre><code>DEBUG Adding transitive dependency for shap==0.46.0: numba*
</code></pre>
<p>This indicates that <code>uv</code> did not pick up the correct lower bound for <code>numba</code>. The next steps, however, appear to have executed correctly. For example:</p>
<pre><code>DEBUG Adding transitive dependency for numba==0.53.1: numpy&gt;=1.15
</code></pre>
<p>It found the latest version of <code>numba</code> that doesn't have an upper bound of an accepted <code>numpy==2.1.3</code></p>
<h5><strong>Expected Behaviour</strong></h5>
<p>The compiled reqs.txt should respect the lower bound for <code>numba</code> and pin a version <code>&gt;=0.54</code> that is compatible with other dependencies. For instance, <code>pip-compile</code> correctly produces an output that includes:</p>
<pre><code>numba==0.60.0
numpy==2.0.2
...
</code></pre>
<hr />
<h4><strong>Workaround</strong></h4>
<p>Adding an explicit requirement to <code>reqs.in</code> resolves the issue:</p>
<pre><code>numba&gt;=0.60.0
</code></pre>
<hr />
<p>Thank you again for all the incredible work youâ€™re doing with <code>uv</code>. Let me know if you need additional details.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 14:42</div>
            <div class="timeline-body"><p>I think that may have been added since the most recent <code>shap</code> release. If you look at the <a href="https://files.pythonhosted.org/packages/04/58/b2ea558ec8d9ed3728e83dfacb1b920c54a1a1f6feee2632c04676c3c1e9/shap-0.46.0-cp312-cp312-win_amd64.whl.metadata">metadata</a>, it doesn't include the constraint:</p>
<pre><code class="language-txt">Metadata-Version: 2.1
Name: shap
Version: 0.46.0
Summary: A unified approach to explain the output of any machine learning model.
Author-email: Scott Lundberg &lt;slund1@cs.washington.edu&gt;
License: MIT License
Project-URL: Repository, http://github.com/shap/shap
Project-URL: Documentation, https://shap.readthedocs.io/en/latest/index.html
Project-URL: Release Notes, https://shap.readthedocs.io/en/latest/release_notes.html
Classifier: Operating System :: Microsoft :: Windows
Classifier: Operating System :: POSIX
Classifier: Operating System :: Unix
Classifier: Operating System :: MacOS
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Intended Audience :: Information Technology
Classifier: Intended Audience :: Science/Research
Classifier: Topic :: Scientific/Engineering
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Classifier: Development Status :: 5 - Production/Stable
Classifier: License :: OSI Approved :: MIT License
Requires-Python: &gt;=3.9
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: numpy
Requires-Dist: scipy
Requires-Dist: scikit-learn
Requires-Dist: pandas
Requires-Dist: tqdm &gt;=4.27.0
Requires-Dist: packaging &gt;20.9
Requires-Dist: slicer ==0.0.8
Requires-Dist: numba
...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 14:42</div>
            <div class="timeline-body"><p>Yeah, it looks like the last release was in June but that constraint was committed in October.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-21 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-11-21 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 14:43</div>
            <div class="timeline-body"><p>If you install from Git, we should respect it (as expected). Otherwise, you'll need to ask the <code>shap</code> team to publish a new release to PyPI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-21 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 14:43</div>
            <div class="timeline-body"><p>(Happy to answer follow-up questions.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vladislavlh">@vladislavlh</a> on 2024-11-21 14:49</div>
            <div class="timeline-body"><p>Thank you for the prompt reply @charliermarsh!</p>
<p>Yeah, the <code>shap</code> library is known to not be actively maintained, so I'm not really surprised to have encountered this issue...</p>
<p>That said, and this might be slightly out of scope for this issue, I'm still trying to fully grasp how <code>uv</code> works. I'm curious to understand why <code>pip-compile</code> is able to adhere to the lower bound requirement even though it's not explicitly listed in the library's metadata. Could you shed some light on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-21 14:56</div>
            <div class="timeline-body"><p>It's a specific issue with recent Numba and NumPy releases. pip-compile generates a different resolution, but both resolutions are technically valid. The main issue tracking that kind of undesirable solution is here: https://github.com/astral-sh/uv/issues/8157. I wrote up an explanation of the specifics of Numba and NumPy here: https://github.com/astral-sh/uv/issues/6281#issuecomment-2316240724.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vladislavlh">@vladislavlh</a> on 2024-11-21 15:14</div>
            <div class="timeline-body"><p>Makes sense to me, thank you for the clarification!
I have no more questions, thank you for your time!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
