<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv add` fails because of `requires-python`'s &quot;default behavior&quot; - astral-sh/uv #14505</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv add</code> fails because of <code>requires-python</code>&#x27;s &quot;default behavior&quot;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14505">#14505</a>
        opened by <a href="https://github.com/trya2l">@trya2l</a>
        on 2025-07-08 12:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/trya2l">@trya2l</a></div>
            <div class="timeline-body">Question
<p>Hi,</p>
<p>I&#x27;m aware of <a href="https://github.com/astral-sh/uv/issues/6780">astral-sh/uv#6780</a>, but maybe I don&#x27;t fully grasp the feedback you gave.</p>
<p>I&#x27;m facing a problem with dependencies resolution while trying to install darts with pytorch cpu version.</p>
<p><code>uv init -p 3.12.11 my-project</code></p>
<pre><code>#requirements.txt
# i know uv add will ignore these indexes, but it&#x27;s fine since i reuse the same file later on
--index-url https://pypi.org/simple
--extra-index-url https://download.pytorch.org/whl/cpu
mlflow
torch==2.7.1
u8darts[torch]==0.36

</code></pre>
<pre><code>#.python-version
3.12.11
</code></pre>
<hr>
<ul>
<li>Default pyproject.toml</li>
</ul>
<p><code>requires-python = &quot;&gt;=3.12.11&quot;</code></p>
<pre><code>uv add -r requirements.txt --index https://download.pytorch.org/whl/cpu
Resolved 118 packages in 3.48s
error: Distribution `markupsafe==3.0.2 @ registry+https://download.pytorch.org/whl/cpu` can&#x27;t be installed because it doesn&#x27;t have a source distribution or wheel for the current platform

hint: You&#x27;re using CPython 3.12 (`cp312`), but `markupsafe` (v3.0.2) only has wheels with the following Python implementation tag: `cp313`
</code></pre>
<ul>
<li>Modified pyproject toml</li>
</ul>
<p><code>requires-python = &quot;==3.12.11&quot;</code></p>
<pre><code>uv add -r requirements.txt --index https://download.pytorch.org/whl/cpu

Resolved 118 packages in 2.29s
Installed 113 packages in 425ms
 + adagio==0.2.6
 + aiohappyeyeballs==2.6.1
</code></pre>
<hr>
<p>I do not know much about python dependency resolution, but here, I&#x27;m not sure I can do much more. For some reason, there is a conflict in the dependencies, and at least, setting the exact python version seems to resolve it.</p>
<p>So is this a valid use case to implement what OP asked in <a href="https://github.com/astral-sh/uv/issues/6780">astral-sh/uv#6780</a></p>
Platform
<p>Linux 6.15.4-200.fc42.x86_64 x86_64 GNU/Linux
Podman: ghcr.io/astral-sh/uv:0.7-debian-slim</p>
Version
<p>0.7.19</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/trya2l">@trya2l</a> on 2025-07-08 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;uv add fails because of `requires-python`&#x27;s &quot;default behavior&quot;&quot; to &quot;`uv add` fails because of `requires-python`&#x27;s &quot;default behavior&quot;&quot; by <a href="https://github.com/trya2l">@trya2l</a> on 2025-07-08 12:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-08 12:47</div>
            <div class="timeline-body"><p>This is an issue with the PyTorch registry whereby they have an incomplete upload for <code>markupsafe</code> (they have <a href="https://download.pytorch.org/whl/MarkupSafe-3.0.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl#sha256=15ab75ef81add55874e7ab7055e9c397312385bd9ced94920f2802310c930396">MarkupSafe-3.0.2-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl</a> but no other wheels for that version).</p>
<p>I think the lowest-effort fix would just be to add <code>markupsafe&lt;3</code> as a constraint in your <code>requirements.txt</code>. Slightly better though would be to structure your <code>pyproject.toml</code> like:</p>
<pre><code>[project]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12.1&quot;
dependencies = [
    &quot;mlflow&quot;,
    &quot;torch==2.7.1&quot;,
    &quot;u8darts[torch]==0.36&quot;,
]

[tool.uv.sources]
torch = { index = &quot;pytorch-cpu&quot; }

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true
</code></pre>
<p>But there isn&#x27;t a super-simple way to do that on the <code>uv add</code> CLI alone.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-08 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trya2l">@trya2l</a> on 2025-07-08 13:14</div>
            <div class="timeline-body"><p>Fair enough, so it is more about PyTorch and my own ignorance than uv.</p>
<p>Thanks @charliermarsh for helping me with this. I&#x27;ll stick with the requirements file as it will ease the transition to uv for my team. In any case I&#x27;m happy with this fix. üëç  :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/trya2l">@trya2l</a> on 2025-07-08 13:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-08 14:35</div>
            <div class="timeline-body"><p>Filed on the PyTorch index at: <a href="https://github.com/pytorch/test-infra/issues/6900">pytorch/test-infra#6900</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:20 UTC
    </footer>
</body>
</html>
