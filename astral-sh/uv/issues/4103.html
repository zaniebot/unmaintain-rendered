<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No build isolation option for bluejay commands - astral-sh/uv #4103</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>No build isolation option for bluejay commands</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/4103">#4103</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-06-06 14:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/konstin">@konstin</a> on 2024-06-06 14:48</div>
            <div class="timeline-body"><p>Locking huggingface currently fails because it depends on <a href="https://pypi.org/project/natten/">natten</a> which only hast source dists and can only be built without build isolation. <code>uv run</code>, <code>uv lock</code> and <code>uv sync</code> should support a <code>--no-build-isolation</code> flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-06-06 14:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-06 14:56</div>
            <div class="timeline-body"><p>Is there an alternative design for <code>--no-build-isolation</code> we should consider? Like specifying extra build dependencies per package? Forcing the user to install build dependencies manually and dropping isolation seems like a bad outcome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-06 16:07</div>
            <div class="timeline-body"><p>It's a good question to ask. Answering it requires understanding why these projects require <code>--no-build-isolation</code>. Often, it's because they require PyTorch, and my understanding is that people don't want to require that you reinstall PyTorch independently for each package, or something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-06 16:07</div>
            <div class="timeline-body"><p>(Also note that <code>--no-build-isolation</code> doesn't mean that we combine the virtualenv with the build dependencies. It means the build dependencies are entirely ignored, i.e., it's assumed that the virtualenv has everything it needs.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hmc-cs-mdrissi">@hmc-cs-mdrissi</a> on 2024-06-06 20:17</div>
            <div class="timeline-body"><p>The most common reason is that there's build compatibility constraints not encodable in existing metadata today. https://pypackaging-native.github.io/key-issues/abi/ is probably best resource on this. At it's core installing separate pytorch  versions for each build can lead to conflicts that will make overall application unusable.</p>
<blockquote>
<p>people don't want to require that you reinstall PyTorch independently for each package, or something.</p>
</blockquote>
<p>The not want here is not motivated by build speed, but compatibility and if you pick separate ones you may crash in the end.</p>
<p>You may be able to handle build dependencies if certain libraries can be marked as must be consistent across environment for all builds. If two libraries depend on library X at build time it is possible for the two to need the build time version of X to be same.</p>
<p>edit: So I think of it not as treating each build as independent is problematic assumption. Managing builds for users and having build dependencies installed is fine if build dependencies are locked together in consistent manner. One extra complication is some build dependencies are sensitive to this, while others are not and free to be inconsistent across builds.</p>
<p>edit 2: This issue is not unique to PyTorch. Any library with native build related abi constraints can make this an issue. If libraries build with numpy for example there exists oldest-supported-numpy as a trick related to this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-28 00:43</div>
            <div class="timeline-body"><p>We may want to add this, since we haven't invested time in an alternative design yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> removed by @zanieb on 2024-08-20 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-22 01:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
