<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip install` doesn't compile pyc - astral-sh/uv #1788</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv pip install</code> doesn't compile pyc</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1788">#1788</a>
        opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a>
        on 2024-02-21 00:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-02-21 00:03</div>
            <div class="timeline-body"><p>pip does this by default (you can opt out with <code>--no-compile</code>). Without this, you pay the cost on first import, which is undesirable in various situations. (Also a thing to make sure is apples to apples when benchmarking)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2024-02-21 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by @zanieb on 2024-02-21 00:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-21 11:31</div>
            <div class="timeline-body"><p>We can add a <code>--compile</code> flag like poetry has (https://python-poetry.org/docs/cli/#install at the bottom).</p>
<p>The original motivation for this was that with bytecode compiling enabled, the majority of installation time in my benchmarks was spent on compiling.</p>
<blockquote>
<p>Without this, you pay the cost on first import, which is undesirable in various situations.</p>
</blockquote>
<p>Could you elaborate?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-02-21 12:04</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Without this, you pay the cost on first import, which is undesirable in various situations.</p>
</blockquote>
<p>Could you elaborate?</p>
</blockquote>
<p>Whenever you import a <code>.py</code> file in Python, if Python doesn't see an associated <code>.pyc</code> file for that <code>.py</code>, the first time it is imported by Python, it will compile the <code>.py</code> module into a <code>.pyc</code> file and save that onto the disk (in a <code>__pycache__</code> directory). That means that the first time you use that module, the import will be much slower than any subsequent times the module is used. This is especially undesirable for e.g. a CLI tool. It means the first time the CLI tool is used will be much slower than any subsequent usages of the CLI tool, since a significant amount of time in the first usage will be spent by Python compiling all the Python code into <code>.pyc</code> files. After the first usage, Python will just reuse the <code>.pyc</code> files from the <code>__pycache__</code> directory, so you &quot;only pay the cost on the first import&quot;, as @hauntsaninja says.</p>
<p>If you're an author of a CLI tool, it's desirable for the installer to pre-compile the Python files into <code>.pyc</code> files as part of the installation process, so that performance of the CLI tool is consistent from the start</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-02-21 20:18</div>
            <div class="timeline-body"><p>Yup, like Alex says, this is undesirable in any case you're sensitive to import latency at runtime.</p>
<p>Another example is if you run your installs when building a container, you will now pay the cost every single time you start a job with that container, instead of just once upfront. This is especially unfortunate if you're running a relatively short lived process in that container.</p>
<p>I know it makes benchmarks look worse (although in that case you should be comparing to <code>pip --no-compile</code> as your baseline), but this is genuinely useful time that users will likely be paying either way! Feels like generally a good use of performance envelope. I do think uv would be able to compile faster than pip does, a) pip does not do any multiprocessing, b) you have the opportunity to do copy-on-write for pyc files (maybe modulo some python version stuff)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-21 20:20</div>
            <div class="timeline-body"><p>Makes sense!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thundergolfer">@thundergolfer</a> on 2024-02-26 18:54</div>
            <div class="timeline-body"><p>Will +1 @hauntsaninja's comments about added container startup latency. At <a href="https://modal.com">modal</a> we've found that when poetry's <code>--compile</code> flag is not used at build-time the resulting lack of <code>.pyc</code> files can add multiple seconds of startup latency for large packages: https://github.com/modal-labs/modal-client/pull/1112.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @konstin on 2024-02-29 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 17:25</div>
            <div class="timeline-body"><p>@konstin is on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-05 03:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:29 UTC
    </footer>
</body>
</html>
