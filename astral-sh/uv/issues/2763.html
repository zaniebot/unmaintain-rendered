<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panic: Resolution should contain all packages - astral-sh/uv #2763</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Panic: Resolution should contain all packages</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2763">#2763</a>
        opened by <a href="https://github.com/BradLucky">@BradLucky</a>
        on 2024-04-01 21:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/BradLucky">@BradLucky</a> on 2024-04-01 21:35</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>We are using <code>uv</code> in Github Actions to install our dependencies. It has been running great for a few weeks now until this afternoon (after 0.1.27 released). Using https://github.com/marketplace/actions/setup-uv, we did not have <code>uv</code> locked to a specific version, and it was unable to install dependencies, giving the error.</p>
<p>Running the command <code>uv pip install --system -r requirements.txt</code> produces the error:</p>
<pre><code class="language-shell">Resolved 202 packages in 605ms
thread 'main' panicked at crates/uv/src/commands/pip_install.rs:670:18:
Resolution should contain all packages
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>After a bit of research, I tried locking CI to version 0.1.26 and things worked fine.</p>
<pre><code class="language-shell">Resolved 202 packages in 6.16s
Downloaded 3 packages in 94ms
Installed 3 packages in 11ms
</code></pre>
<p>Our CI runner OS is Ubuntu 22.04.4 LTS.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-01 21:58</div>
            <div class="timeline-body"><p>This sounds very likely to be a regression related to #2596</p>
<p>Can you share more details on the requirements? Do you have a minimal reproduction?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-04-01 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 22:01</div>
            <div class="timeline-body"><p>Or even a maximal reproduction :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 22:21</div>
            <div class="timeline-body"><p>One reproduction is if you have multiple versions of a package installed. Then, the resolver will try to use them, but the install plan will reject them all.</p>
<pre><code>uv venv --seed
source .venv/bin/activate
pip install anyio==3.7.0 --ignore-installed
pip install anyio==4.0.0 --ignore-installed
uv pip install anyio black --verbose
</code></pre>
<p>Yields:</p>
<pre><code>thread 'main' panicked at crates/uv/src/commands/pip_install.rs:678:18:
Resolution should contain all packages
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 22:22</div>
            <div class="timeline-body"><p>In general, we probably need to try and reduce the coupling in the assumptions, hmm...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bschoenmaeckers">@bschoenmaeckers</a> on 2024-04-02 13:54</div>
            <div class="timeline-body"><p>I got the same error on my local machine when installing the following minimal requirements.txt file:</p>
<pre><code>--extra-index-url https://private-package-registry/simple
--extra-index-url https://download.pytorch.org/whl/cpu

torch==2.1.0+cpu
private-package==1.0.0  # Does not depend on torch
</code></pre>
<pre><code class="language-console">uv pip install -r requirements.txt
Resolved 47 packages in 330ms
thread 'main' panicked at crates\uv\src\commands\pip_install.rs:670:18:
Resolution should contain all packages
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-02 14:14</div>
            <div class="timeline-body"><p>@bschoenmaeckers are any of those packages already installed locally?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-02 16:03</div>
            <div class="timeline-body"><p>@bschoenmaeckers I cannot reproduce this:</p>
<pre><code>❯ cat requirements.txt
--extra-index-url https://astral-sh.github.io/packse/0.3.8/simple-html/
--extra-index-url https://download.pytorch.org/whl/cpu

torch==2.1.0+cpu
example-a==1.0.0

❯ uv venv
Using Python 3.11.8 interpreter at: /usr/bin/python3
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate

❯ cargo run -- pip install -r requirements.txt
    Finished dev [unoptimized + debuginfo] target(s) in 0.16s
     Running `target/debug/uv pip install -r requirements.txt`
Resolved 11 packages in 558ms
Installed 11 packages in 860ms
 + example-a==1.0.0
 + example-b==2.0.0
 + filelock==3.9.0
 + fsspec==2023.4.0
 + jinja2==3.1.2
 + markupsafe==2.1.3
 + mpmath==1.3.0
 + networkx==3.2.1
 + sympy==1.12
 + torch==2.1.0+cpu
 + typing-extensions==4.8.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "0.1.27 breaks in Github Actions" to "Panic: Resolution should contain all packages" by @zanieb on 2024-04-02 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2779.html">astral-sh/uv#2779</a> on 2024-04-02 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bschoenmaeckers">@bschoenmaeckers</a> on 2024-04-02 19:18</div>
            <div class="timeline-body"><blockquote>
<p>@bschoenmaeckers are any of those packages already installed locally?</p>
</blockquote>
<p>I cannot reproduce this error anymore after creating a new venv. So it was maybe just a fluke.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-07 00:02</div>
            <div class="timeline-body"><p>I'm going to close for now since we've fixed a few issues here. If you see it again in the latest release, please LMK and we'll re-open!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-07 00:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../PostHog/posthog/pulls/21389.html">PostHog/posthog#21389</a> on 2024-04-08 08:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:19 UTC
    </footer>
</body>
</html>
