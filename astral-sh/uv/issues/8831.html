<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>can't do local pip install of whl files in requirements.txt when sys_platform is used  - astral-sh/uv #8831</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>can't do local pip install of whl files in requirements.txt when sys_platform is used</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/8831">#8831</a>
        opened by <a href="https://github.com/hsnoil">@hsnoil</a>
        on 2024-11-05 16:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hsnoil">@hsnoil</a> on 2024-11-05 16:28</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>When you have a local whl entry inside the requirements.txt and add <code>; sys_platfom ==</code>  to it, it fails to work.</p>
<p>Here is an example:</p>
<pre><code>#uv pip install -r requirements.txt
error: Couldn't parse requirement in: `requirements.txt` at position 612
  Caused by: Expected path (./test.whl;`) to end in a supported file extension: `.whl`, `.zip`, `.tar.gz`, `.tar.bz2`...
./test.whl; sys_platfom == &quot;win32&quot;
^^^^^^^^
</code></pre>
<p>As you can see the <code>;</code> is for some reason included in the file type</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 16:28</div>
            <div class="timeline-body"><p>You need to include a space before the <code>;</code>. I believe this is compliant with the grammar.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hsnoil">@hsnoil</a> on 2024-11-05 16:30</div>
            <div class="timeline-body"><p>@charliermarsh  that works, thanks! Though pip works without the space. And I've seen many make requirements.txt files without the space so it may make sense to make it compatible?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hsnoil">@hsnoil</a> on 2024-11-05 16:45</div>
            <div class="timeline-body"><p>@charliermarsh I took a quick look and from what I understand the whitespace is optional.</p>
<p>https://pip.pypa.io/en/stable/reference/requirement-specifiers/#requirement-specifiers</p>
<p>says it is based on PEP508 which says</p>
<blockquote>
<p>Non line-breaking whitespace is mostly optional with no semantic meaning. The sole exception is detecting the end of a URL requirement.</p>
</blockquote>
<p>https://peps.python.org/pep-0508/#whitespace</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-05 16:52</div>
            <div class="timeline-body"><p>The key is &quot;<strong>The sole exception is detecting the end of a URL requirement.</strong>&quot; — paths are URLs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 16:53</div>
            <div class="timeline-body"><p>Yeah it's not optional in the <a href="https://peps.python.org/pep-0508/#complete-grammar">grammar</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-05 16:54</div>
            <div class="timeline-body"><p>This is important because there can be <code>;</code> in a URI, e.g.</p>
<pre><code>❯ touch 'foo;bar'
❯ ls
foo;bar
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hsnoil">@hsnoil</a> on 2024-11-05 17:16</div>
            <div class="timeline-body"><p>I see, I saw it more of a path than a URL as a url would be like file://, path is though a part of the url. I guess I misunderstood.</p>
<p>That said, the code is anyways looking for extensions like &quot;whl&quot;, correct? So if whl; is seen as an extension, it should be possible to fix it right? And this would make it compatible with way pip does it. If not at the very least an error to explain why it doesn't work otherwise people coming from pip may just assume the issue is on uv's end.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 17:16</div>
            <div class="timeline-body"><p>I thought we <em>did</em> show a custom error here. That part I can look into. Maybe it regressed at some point.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-11-05 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @charliermarsh on 2024-11-05 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hsnoil">@hsnoil</a> on 2024-11-05 17:53</div>
            <div class="timeline-body"><p>Another question, looking at the spec to do urls you have to do:</p>
<pre><code>test@./test.whl ; sys_platform == 'win32'
</code></pre>
<p>In the case of:</p>
<pre><code>./test ; sys_platform == 'win32'
</code></pre>
<p>it is already not a url by the spec as the spec needs a <code>@</code> sign. Running the spec tester script in PEP508 confirms that. But it works without <code>@</code> sign on both UV and pip</p>
<p>I am trying to find the spec for this implementation without <code>@</code> but can't seem to find it. It is possible pip supports it because it uses a different spec for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 17:54</div>
            <div class="timeline-body"><p>Yeah <code>./test ; sys_platform == 'win32'</code> isn't actually spec-compliant to begin with -- it's not covered by PEP 508. It's something that pip supports but AFAIK it's just implementation-defined.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 18:05</div>
            <div class="timeline-body"><p>Ok it looks like we show the &quot;right&quot; error message for HTTPS URLs, but not file paths.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hsnoil">@hsnoil</a> on 2024-11-05 18:08</div>
            <div class="timeline-body"><p>So if it isn't in the grammar to begin with and was added as pip compatibility, then it makes sense to include <code>./test.whl; sys_platform == 'win32'</code> as well, no?</p>
<p>Especially since you are already looking for extensions like <code>.whl</code> so if the extension ends with <code>whl;</code> it can just remove the <code>;</code> and re-evaluate it. That shouldn't cause any errors of compatibility with urls that use <code>;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 18:10</div>
            <div class="timeline-body"><p>Candidly, I don't want to have incompatible parsing between the two URL formats. It's a source of bugs and confusion for users if the behaviors differ between the two.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-05 18:24</div>
            <div class="timeline-body"><p>Okay, I think we can make this work. I agree it's not super intuitive right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-11-05 21:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:48 UTC
    </footer>
</body>
</html>
