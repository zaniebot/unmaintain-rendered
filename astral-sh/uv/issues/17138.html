<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helpful message when syncing lock file without having index metadata from `pyproject.toml` - astral-sh/uv #17138</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Helpful message when syncing lock file without having index metadata from `pyproject.toml`</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17138">#17138</a>
        opened by <a href="https://github.com/ketozhang">@ketozhang</a>
        on 2025-12-15 22:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ketozhang">@ketozhang</a> on 2025-12-15 22:42</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When deploying Python software from lock files (i.e., both <code>uv.lock</code> and <code>pylock.toml</code>) for reproducible installs, we like to treat the lock file as compiled from source such that the where we want to deploy the environment to shouldn't need any of its original source code. I consider the <code>pyproject.toml</code> as the source code for the lock file.</p>
<p>One pain point, if I am understanding correctly, is that the index metadata in <code>[[tool.uv.index]]</code> is lost in the lock file therefore the environment variables <code>UV_INDEX_FOOBAR_PASSWORD</code> are not used during <code>uv sync</code> or <code>uv pip sync</code> without the associated <code>pyproject.toml</code> in the working directory.</p>
<p><code>pyproject.toml</code> is actually not necessary since users may use <code>uv auth login</code> to build up their authenticated index list. However, the user must remember to run this for every private index listed in the lock file.</p>
<p>My feature request is that uv understand the index URLS stored in the lock file and will check for authentication to those indices during install missing <code>pyproject.toml</code>. On failure, uv should instruct the users to provide index credentials through <code>uv auth login</code>. If <code>UV_INDEX_INDEXNAME_*</code> is specified, uv should warn these environment variable does not work unless a <code>pyproject.toml</code> exist.</p>
<h3>Example</h3>
<pre><code class="language-sh">$ mkdir mysoftware &amp;&amp; cd mysoftware
$ wget https://example.com/myapp/pylock.toml
$ uv venv --python 3.14
$ uv pip sync pylock.toml
Failed to fetch:
  `https://privatepypi.example.com/packages/mysoftwaredependency`

No `pyproject.toml` found. If you are trying to install a lock file, please register the index and credentials (see `uv auth login --help`).

Warning UV_INDEX_PRIVATEPYPI_PASSWORD set but `pyproject.toml` is not found. 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @ketozhang on 2025-12-15 22:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-16 09:23</div>
            <div class="timeline-body"><p>Currently, <code>uv.lock</code> is needed for a number of features, such as workspace discovery and the indexes you mentioned. If you're using a <code>[build-system]</code> table, the <code>pyproject.toml</code> is mandatory to build the project - There's too many things that <code>pyproject.toml</code> does to treat <code>uv.lock</code> as a compiled artifact that works without the source file. This doesn't mean we shouldn't add more information to <code>uv.lock</code>, but <code>pyproject.toml</code> should still exist in the deployment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ketozhang">@ketozhang</a> on 2025-12-16 22:46</div>
            <div class="timeline-body"><p>In my case, there isn't a need for a build system since I am provisioning an app where all my package including the entrypoint program is already uploaded to some pypi server. To me a deploy is really just a list of Python packages (the lock file) and some configuration files (<em>I guess I can treat pyproject.toml as another config file</em>).</p>
<p>Could simply propagate all the metadata to <code>[tool]</code> https://packaging.python.org/en/latest/specifications/pylock-toml/#tool ? Can we start with <code>[[tool.uv.index]]</code> and <code>[tool.uv.sources]</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ketozhang">@ketozhang</a> on 2025-12-16 22:50</div>
            <div class="timeline-body"><p>Any opposition to adding something of the form of this warning?</p>
<pre><code>Warning UV_INDEX_PRIVATEPYPI_PASSWORD set but `pyproject.toml` is not found. 
</code></pre>
<p>I can't see how the index env var will be useful without a <code>[[tool.uv.index]]</code> somewhere (incl. <code>pyproject.toml</code> or <code>uv.toml</code>).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:15 UTC
    </footer>
</body>
</html>
