<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I would like to generate `uv` lock files and exclude optional dependencies. `uv sync` and `uv lock` don't seem to offer this - astral-sh/uv #13355</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>I would like to generate `uv` lock files and exclude optional dependencies. `uv sync` and `uv lock` don't seem to offer this</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/13355">#13355</a>
        opened by <a href="https://github.com/andres-ito-traversal">@andres-ito-traversal</a>
        on 2025-05-08 21:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/andres-ito-traversal">@andres-ito-traversal</a> on 2025-05-08 21:22</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Am I able to run <code>uv lock</code> and exclude optional dependencies? My team uses some private artifactory(s) that we would not like to include in the lock file. We organize these deps into optional deps groups so it'd be nice to do something like <code>uv lock --all-extras --no-extra=&quot;optional-dep-to-exclude&quot;</code></p>
<h3>Platform</h3>
<p>Darwin 24.3.0 arm64</p>
<h3>Version</h3>
<p>uv 0.6.17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @andres-ito-traversal on 2025-05-08 21:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a> on 2025-05-09 05:23</div>
            <div class="timeline-body"><p>I don't think that's possible with <code>uv</code>'s lock file design. It's a universal resolution that's supposed to work no matter what the user decides to install later on.</p>
<p>I think you have two choices: 1/ remove the optional dependency from your <code>pyproject.toml</code>, or 2/ export to <code>pylock.toml</code>. The current <code>export</code> gives a single use <a href="https://peps.python.org/pep-0751/">PEP 751</a> lock file.</p>
<p>And you can do <code>uv export --all-extras --no-extra=&quot;...&quot; --format pylock.toml</code> (then save it in a PEP 751 compatible file name).</p>
<p>You can <code>uv pip install --requirements pylock.my-single-use-lock-file.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andres-ito-traversal">@andres-ito-traversal</a> on 2025-05-09 16:14</div>
            <div class="timeline-body"><p>I see. So <code>pylock.toml</code> would be the lock file in a toml format.</p>
<p>A bit of a dumb question here, but it looks like there are three file formats for lock files:</p>
<ol>
<li>uv.lock</li>
<li>requirements.txt</li>
<li>pylock.toml</li>
</ol>
<p>Is that right? My work around currently was using <code>uv pip compile</code> and using the (2) as my lock file format. I'll give 3 a shot and report back</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-05-09 16:17</div>
            <div class="timeline-body"><p>If you want to lock only specific dependencies, you can use <code>uv pip compile</code>. <code>uv sync</code> enforces consistency between all dependencies of a project, including optional dependencies and dependency groups, so it's not suited for this use case. <code>uv.lock</code> is uv's format, which is tightly coupled to <code>uv lock</code>. <code>pylock.toml</code> can hopefully replace <code>requirements.txt</code>, but it's still young and you might find bugs and no or barebones support in tools.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a> on 2025-05-09 16:26</div>
            <div class="timeline-body"><p>To add on Konstin's reply, the three files you mention can all be seen as lock files, but there is no real consensus about what that term specifically means. We can all agree that the purposes is to lock in your dependencies. But there are various degrees of precision, security, and reproducibility that each of those files allow you to get.</p>
<p><code>requirements.txt</code> has the widest support, but is also the most lacking in terms of the the proprieties above (in my opinion at least) compared to the other two.</p>
<p><code>pylock.toml</code> can be used as a replacement of <code>uv.lock</code> in many cases but it lacks both support and some features that come with <code>uv</code>.</p>
<p><code>uv.lock</code> seems to me the best out of the three, but the tool support argument can be made for it as well (you can only use it with <code>uv</code>). By the way, <code>uv.lock</code> is also written in the TOML format.</p>
<p>(We can get into more details but I don't this a GitHub comment is the appropriate place for that)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andres-ito-traversal">@andres-ito-traversal</a> on 2025-05-09 17:01</div>
            <div class="timeline-body"><p>This is all so helpful! Thanks - I discussed with my team, and we're going to proceed with using <code>requirements.txt</code> since it's been battle tested quite a bit.</p>
<p>We have deployments across various environments where we have to install certain dependencies from private artifactories so this solution seems to scale to our use-case the best.</p>
<p>Many thanks guys :D By the way, uv reduced our build image stage from 5 hours to about 40 minutes (when there isn't a cache hit). We all love what you guys do (uv and ruff)!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-05-12 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @konstin on 2025-05-12 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @konstin on 2025-05-12 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Davidyz/VectorCode/pulls/137.html">Davidyz/VectorCode#137</a> on 2025-05-14 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Maxioum/Peeler/issues/102.html">Maxioum/Peeler#102</a> on 2025-10-08 09:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
