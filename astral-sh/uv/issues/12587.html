<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equivalent of UV_PROJECT_ENVIRONMENT on uv.toml - astral-sh/uv #12587</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Equivalent of UV_PROJECT_ENVIRONMENT on uv.toml</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/12587">#12587</a>
        opened by <a href="https://github.com/carlosjourdan">@carlosjourdan</a>
        on 2025-03-31 15:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/carlosjourdan">@carlosjourdan</a> on 2025-03-31 15:20</div>
            <div class="timeline-body"><h3>Summary</h3>
<h2>Current Behavior</h2>
<p>Afaik, the virtual environment path can only be configured via the <code>UV_PROJECT_ENVIRONMENT</code> environment variable.</p>
<h2>Proposed Enhancement</h2>
<p>Add support for configuring the virtual environment path in <code>uv.toml</code> and/or <code>pyproject.toml</code> configuration files.</p>
<p>Example configuration:</p>
<pre><code class="language-toml">[tool.uv]
project-environment= &quot;/path/to/venv&quot;
</code></pre>
<h2>Use Case &amp; Motivation</h2>
<ul>
<li>Working in a Citrix/VDI environment where the users home dir is actually a network drive under the hood</li>
<li>Need to store virtualenvs on local disk for performance reasons</li>
<li>Supporting &quot;citizen developers&quot; who need a simple setup process:<ol>
<li><code>git clone</code></li>
<li><code>uv sync</code></li>
</ol>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @carlosjourdan on 2025-03-31 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-01 20:45</div>
            <div class="timeline-body"><p>I don't think we want to support this in the <code>pyproject.toml</code>, because then a project can cause a sync to an arbitrary location on your machine. This is a &quot;user&quot; setting, not a &quot;project&quot; setting — if that makes sense?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @zanieb on 2025-04-01 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-01 20:45</div>
            <div class="timeline-body"><p>I think #1495 is a better fit for this use-case</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carlosjourdan">@carlosjourdan</a> on 2025-04-01 22:24</div>
            <div class="timeline-body"><p>I get the distinction between &quot;user&quot; and &quot;project&quot; settings in typical development environments.</p>
<p>However, in VDI (and I suspect many other corporate environments), there are often strict controls on where users can write files. This makes the ability to sync to an aribtrary, pre-determined location a helpful feature rather than a problem.</p>
<p>#1495 would be a more elegant solution to this problem, but I hoped supporting the already existing environment variable through the toml configuration might be a simpler interim approach.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/elonzh">@elonzh</a> on 2025-04-23 10:00</div>
            <div class="timeline-body"><p>Our Python environment depends on conda components, such as specific versions of OpenSSL, the compilation toolchain, etc. Therefore, we create environments using conda and handle this situation by specifying <code>UV_PROJECT_ENVIRONMENT</code> and <code>UV_PYTHON</code>. However, this is very inconvenient in daily development because these environment variables need to be set every time.</p>
<p>We have tried using pixi, but it is not suitable for us. Compared to uv, it lacks many features; for example, it does not support relative path dependencies, it can only build conda packages, and its dependency resolution prioritizes conda packages over PyPI packages.</p>
<p>Since we must work on the Windows platform, using tools like direnv to set environment variables is also not feasible.</p>
<p>We hope for <strong>a local, per-project implementation solution that only requires configuration once</strong>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsal">@gsal</a> on 2025-05-26 02:50</div>
            <div class="timeline-body"><p>Just learning to use uv over the last 3 days and I too have come to need this feature.</p>
<p>We have a team of developers and we get our hands in a mix of projects; from what I can see this early in my uv learning cuve, it would be very useful if UV_PROJECT_ENVIRONMENT could be set in the uv.toml file local to the project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13720.html">astral-sh/uv#13720</a> on 2025-06-02 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13931.html">astral-sh/uv#13931</a> on 2025-06-09 19:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/uu9">@uu9</a> on 2025-07-02 04:09</div>
            <div class="timeline-body"><blockquote>
<p>I think <a href="https://github.com/astral-sh/uv/issues/1495">#1495</a> is a better fit for this use-case</p>
</blockquote>
<p>I found these project-level environment settings variables, <code>UV_PROJECT</code> and <code>UV_PROJECT_ENVIRONMENT</code>, but I think this is probably not a good design because users typically need to frequently change these environment variables to maintain multi-projects and <code>uv</code> is designed for non-central structured  multi-projects. This seems more like environment variables used in Docker, which only requires preparing one project environment.</p>
<p>Is it possible to make these environment variables support customization for multiple projects? For example, <code>UV_PROJECT_ENVIRONMENT=&quot;my_py_project1=path1:my_py_project2=path2&quot;</code>. This design only requires configuration once and also is a user side configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sascharo">@sascharo</a> on 2025-07-02 08:51</div>
            <div class="timeline-body"><blockquote>
<p>This seems more like environment variables used in Docker, which only requires preparing one project environment.</p>
</blockquote>
<p>I think its purpose is really just for containers as Docker by design.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15163.html">astral-sh/uv#15163</a> on 2025-08-08 09:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14515.html">astral-sh/uv#14515</a> on 2025-08-19 15:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andrew-mott">@andrew-mott</a> on 2025-09-10 19:56</div>
            <div class="timeline-body"><p>Hi! Monorepo user here. To get per-project venvs I currently set UV_PROJECT_ENVIRONMENT per project (via direnv/Just), which feels clunky.</p>
<p>Feature request: a config knob instead of env vars:</p>
<pre><code class="language-toml">[tool.uv]
venv_mode = &quot;project&quot;   # or &quot;root&quot; (default)
venv_path = &quot;.venv&quot;     # optional
</code></pre>
<p>Plus a CLI override: <code>uv sync --venv-mode project</code>.</p>
<p>If I’ve missed an existing flag/workflow, please point me to it. Happy to help with a docs PR or a small implementation if this direction seems OK.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lperezmo">@lperezmo</a> on 2025-10-28 19:52</div>
            <div class="timeline-body"><p>I was running into this exact same problem, so what I did is to setup powershell to set a storage location for the uv projects dynamically. In my case, whenever I create a project on shared drive Q it will create a local folder in my home directory under uv-envs. Perhaps not the cleanest solution, but it worked for me, maybe someone else might find it useful, just edit and add to your powershell profile, <code>code $PROFILE</code> to add with VS Code</p>
<p>You can configure where it stores them, and if it is limited to like a shared location. I'm sure you can tweak it more, any LLM could probably handle it too</p>
<pre><code class="language-powershell">&lt;#
.SYNOPSIS
    Centralizes UV virtual environments using path-based hashing.

.DESCRIPTION
    Wraps the uv command to store virtual environments in a central location
    instead of creating .venv folders in project directories. Particularly useful
    for network drives and shared folders with limited space.

.EXAMPLE
    PS Q:\project&gt; uv sync
    Creates/uses environment at: C:\Users\YourName\uv-envs\A1B2C3D4E5F6G7H8

.NOTES
    Hash is deterministic - same path always generates same environment folder.
    Run 'uv list-envs' to see all centralized environments.
#&gt;

function uv {
    param()
    
    # Configuration
    $config = @{
        # Paths requiring centralized environments (empty = all paths)
        LimitToFolders = @(
            &quot;Q:\&quot;  # Network drive
            # &quot;D:\Projects&quot;  # Example additional path
        )
        # LimitToFolders = @() # (empty = all paths)
        
        # Commands that manage environments
        EnvCommands = @('init', 'sync', 'add', 'remove', 'run', 'lock', 'venv', 'pip')
        
        # Base directory for centralized environments
        BaseEnvPath = &quot;$env:USERPROFILE\uv-envs&quot;
    }
    
    # Add custom command to list centralized environments
    if ($args[0] -eq 'list-envs') {
        Show-CentralizedEnvs -BaseEnvPath $config.BaseEnvPath
        return
    }
    
    # Check if this command should use centralized environment
    if ($args.Count -gt 0 -and $config.EnvCommands -contains $args[0]) {
        $currentPath = (Get-Location).Path
        
        if (Should-Centralize -Path $currentPath -AllowedPaths $config.LimitToFolders) {
            $envPath = Setup-CentralizedEnv -Path $currentPath -BaseEnvPath $config.BaseEnvPath
            $env:UV_PROJECT_ENVIRONMENT = $envPath
            
            Write-Host &quot;-&gt; Using centralized environment: &quot; -ForegroundColor Cyan -NoNewline
            Write-Host $envPath -ForegroundColor White
            
            # Warn about existing .venv
            if (Test-Path &quot;.venv&quot;) {
                Write-Warning &quot;Local .venv detected. Consider removing with: Remove-Item -Recurse -Force .venv&quot;
            }
        }
    }
    
    # Execute original uv command
    &amp; uv.exe @args
}

function Should-Centralize {
    param(
        [string]$Path,
        [string[]]$AllowedPaths
    )
    
    # Empty array means centralize everything
    if ($AllowedPaths.Count -eq 0) { return $true }
    
    # Check if path matches any allowed pattern
    foreach ($allowed in $AllowedPaths) {
        if ($Path -like &quot;$allowed*&quot;) { return $true }
    }
    
    return $false
}

function Setup-CentralizedEnv {
    param(
        [string]$Path,
        [string]$BaseEnvPath
    )
    
    # Generate deterministic hash from path
    $bytes = [System.Text.Encoding]::UTF8.GetBytes($Path.ToLower())
    $hash = [System.Security.Cryptography.SHA256]::Create().ComputeHash($bytes)
    $hashString = [System.BitConverter]::ToString($hash).Replace(&quot;-&quot;, &quot;&quot;).Substring(0, 16)
    
    $envPath = Join-Path $BaseEnvPath $hashString
    
    # Ensure ONLY base directory exists
    if (-not (Test-Path $BaseEnvPath)) {
        New-Item -ItemType Directory -Path $BaseEnvPath -Force | Out-Null
    }
    
    # Store project path reference (only if environment was created by UV)
    if (Test-Path $envPath) {
        $infoFile = Join-Path $envPath &quot;_project_info.json&quot;
        if (-not (Test-Path $infoFile)) {
            @{
                ProjectPath = $Path
                CreatedAt = (Get-Date).ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;)
                ProjectName = Split-Path $Path -Leaf
            } | ConvertTo-Json | Set-Content $infoFile -Encoding UTF8
        }
    }
    
    return $envPath
}

function Show-CentralizedEnvs {
    param([string]$BaseEnvPath)
    
    if (-not (Test-Path $BaseEnvPath)) {
        Write-Host &quot;No centralized environments found.&quot; -ForegroundColor Yellow
        return
    }
    
    Write-Host &quot;`nCentralized UV Environments:&quot; -ForegroundColor Cyan
    Write-Host (&quot;-&quot; * 60) -ForegroundColor DarkGray
    
    Get-ChildItem $BaseEnvPath -Directory | ForEach-Object {
        $infoFile = Join-Path $_.FullName &quot;_project_info.json&quot;
        if (Test-Path $infoFile) {
            $info = Get-Content $infoFile | ConvertFrom-Json
            
            # Check if project still exists
            $exists = Test-Path $info.ProjectPath
            $status = if ($exists) { &quot;[OK]&quot; } else { &quot;[X]&quot; }
            $statusColor = if ($exists) { &quot;Green&quot; } else { &quot;Red&quot; }
            
            Write-Host &quot;$status &quot; -ForegroundColor $statusColor -NoNewline
            Write-Host $_.Name -ForegroundColor Yellow -NoNewline
            Write-Host &quot; -&gt; &quot; -ForegroundColor DarkGray -NoNewline
            Write-Host $info.ProjectPath
            
            # Show environment size
            $size = (Get-ChildItem $_.FullName -Recurse | 
                     Measure-Object -Property Length -Sum).Sum / 1MB
            Write-Host &quot;  Size: $([math]::Round($size, 2)) MB | Created: $($info.CreatedAt)&quot; -ForegroundColor DarkGray
        }
    }
    Write-Host (&quot;-&quot; * 60) -ForegroundColor DarkGray
}

# Optional: Add alias for convenience
Set-Alias -Name uvl -Value &quot;uv list-envs&quot; -ErrorAction SilentlyContinue
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:03 UTC
    </footer>
</body>
</html>
