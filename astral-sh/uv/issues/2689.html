<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem with `scikit-build-core` backend - astral-sh/uv #2689</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Problem with `scikit-build-core` backend</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/2689">#2689</a>
        opened by <a href="https://github.com/chainyo">@chainyo</a>
        on 2024-03-27 11:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/chainyo">@chainyo</a> on 2024-03-27 11:11</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Hi, thanks for this initiative, I'm impatient to have a cargo grade dev tools environment for python.</p>
<p>This issue is related to this one I opened in <code>rye</code> initially, but in fact is totally related to the <code>uv</code> process under the hood. https://github.com/astral-sh/rye/issues/872</p>
<p>I can install the <code>cugraph</code> library (poorly packaged but that's another subject) just fine with <code>uv</code> by doing this command in a python 3.9.18 .venv:</p>
<p><code>uv pip install &quot;cugraph-cu12==24.02.*&quot; --extra-index-url &quot;https://pypi.nvidia.com&quot;</code></p>
<p>Outputs:</p>
<p><img src="https://github.com/astral-sh/uv/assets/50595514/8870ff26-3b5e-4b09-8550-b2833c59f363" alt="CleanShot 2024-03-27 at 12 11 49" /></p>
<p>The problem arises when I'm trying to run the <code>rye sync --features gpu</code> command I get a lock file generation error.
It might be because the <code>cugraph</code> library is using the <code>scikit-build-core</code> backend and this backend isn't handled by <code>uv</code> yet?</p>
<p>Here is the error I have:</p>
<pre><code class="language-bash">rye sync --features gpu
Reusing already existing virtualenv
Generating production lockfile: /home/user/foo/requirements.lock
error: Failed to download and build: cugraph-cu12==24.2.0
  Caused by: Failed to build: cugraph-cu12==24.2.0
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/home/user/.cache/uv/.tmpD0iI7V/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 325, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=['wheel'])
  File &quot;/home/user/.cache/uv/.tmpD0iI7V/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 295, in _get_build_requires
    self.run_setup()
  File &quot;/home/user/.cache/uv/.tmpD0iI7V/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 487, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/home/user/.cache/uv/.tmpD0iI7V/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 90, in &lt;module&gt;
RuntimeError: Bad params
---
error: could not write production lockfile for project

Caused by:
    failed to generate lockfile
</code></pre>
<p>Here is the minimal reproduction steps:</p>
<ol>
<li><code>rye init --lib foo</code></li>
<li><code>rye pin 3.10</code></li>
<li>Add the following to your <code>pyproject.toml</code></li>
</ol>
<pre><code class="language-toml">[[tool.rye.sources]]
name = &quot;cugraph-cu12&quot;
url = &quot;https://pypi.nvidia.com&quot;
type = &quot;index&quot;

[project.optional-dependencies]
gpu = [&quot;cugraph-cu12==24.2.0&quot;]
</code></pre>
<ol start="4">
<li><code>rye sync --features gpu</code></li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chainyo">@chainyo</a> on 2024-03-27 12:52</div>
            <div class="timeline-body"><p>Ok after multiple tests I just found that the <code>cugraph</code> dependency wasn't available for python 3.10 on the NVIDIA index, and because of that <code>uv</code> was probably trying to build it but without success.</p>
<p>Not sure why we get that <code>setuptools</code> warning, it's not super explicit to me, but maybe it makes sense with some package tools experience?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-27 14:57</div>
            <div class="timeline-body"><p>Ah yeah -- this does look like a problem with the failed build, but I'm not sure on the source. My guess is that <code>pip</code> would also fail if you tried to install <code>cugraph-cu12==24.2.0</code> with that specific Python executable and version.</p>
<p>I've run into this in the past when trying to build packages from source with an incompatible CUDA or cuDNN version installed, but I can't say definitively that that's the problem...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-27 14:58</div>
            <div class="timeline-body"><p>(Closing as I think this is a correct failure but happy to keep discussing.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-03-27 14:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chainyo">@chainyo</a> on 2024-03-27 15:41</div>
            <div class="timeline-body"><blockquote>
<p>uv pip install &quot;cugraph-cu12==24.02.*&quot; --extra-index-url &quot;https://pypi.nvidia.com&quot;</p>
</blockquote>
<blockquote>
<p>Ah yeah -- this does look like a problem with the failed build, but I'm not sure on the source. My guess is that <code>pip</code> would also fail if you tried to install <code>cugraph-cu12==24.2.0</code> with that specific Python executable and version.</p>
</blockquote>
<p>I tried both <code>uv pip</code> and <code>pip</code> and the package is found correctly with this command:</p>
<p><code>[uv] pip install &quot;cugraph-cu12==24.02.*&quot; --extra-index-url &quot;https://pypi.nvidia.com&quot;</code></p>
<p>Weird thing it seems that the retrieved versions were cp310 compatible while I'm in a python 3.9.18 .venv atm. I don't remember if classic pip is using the .venv python version or if it takes the global python version.</p>
<pre><code class="language-bash">pip install &quot;cugraph-cu12==24.02.0&quot; --extra-index-url &quot;https://pypi.nvidia.com&quot;
Defaulting to user installation because normal site-packages is not writeable
Looking in indexes: https://pypi.org/simple, https://pypi.nvidia.com
Collecting cugraph-cu12==24.02.0
  Using cached https://pypi.nvidia.com/cugraph-cu12/cugraph_cu12-24.2.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1311.2 MB)
Collecting pylibcugraph-cu12==24.2.*
  Downloading https://pypi.nvidia.com/pylibcugraph-cu12/pylibcugraph_cu12-24.2.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1312.2 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.3/1.3 GB 463.6 kB/s eta 0:00:00
Collecting dask-cuda==24.2.*
  Downloading dask_cuda-24.2.0-py3-none-any.whl (126 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 126.5/126.5 KB 4.1 MB/s eta 0:00:00
Collecting cudf-cu12==24.2.*
  Downloading https://pypi.nvidia.com/cudf-cu12/cudf_cu12-24.2.2-cp310-cp310-manylinux_2_28_x86_64.whl (464.7 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 464.7/464.7 MB 1.7 MB/s eta 0:00:00
Collecting dask-cudf-cu12==24.2.*
  Downloading https://pypi.nvidia.com/dask-cudf-cu12/dask_cudf_cu12-24.2.2-py3-none-any.whl (45 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 45.1/45.1 KB 9.3 MB/s eta 0:00:00
Collecting raft-dask-cu12==24.2.*
  Downloading https://pypi.nvidia.com/raft-dask-cu12/raft_dask_cu12-24.2.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (162.9 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 162.9/162.9 MB 5.6 MB/s eta 0:00:00
Collecting ucx-py-cu12==0.36.*
  Downloading https://pypi.nvidia.com/ucx-py-cu12/ucx_py_cu12-0.36.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (7.7 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 7.7/7.7 MB 10.8 MB/s eta 0:00:00
Collecting numpy&gt;=1.21
  Downloading numpy-1.26.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (18.2 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 18.2/18.2 MB 14.2 MB/s eta 0:00:00
Collecting fsspec[http]&gt;=0.6.0
  Downloading fsspec-2024.3.1-py3-none-any.whl (171 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 172.0/172.0 KB 590.1 kB/s eta 0:00:00
Collecting rmm-cu12==24.2.*
  Downloading https://pypi.nvidia.com/rmm-cu12/rmm_cu12-24.2.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.7 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.7/1.7 MB 85.0 MB/s eta 0:00:00
Collecting rapids-dask-dependency==24.2.*
  Downloading https://pypi.nvidia.com/rapids-dask-dependency/rapids_dask_dependency-24.2.0-py3-none-any.whl (6.4 kB)
Collecting numba&gt;=0.57
  Downloading numba-0.59.1-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (3.7 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3.7/3.7 MB 101.0 MB/s eta 0:00:00
Collecting cupy-cuda12x&gt;=12.0.0
  Downloading cupy_cuda12x-13.0.0-cp310-cp310-manylinux2014_x86_64.whl (88.3 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 88.3/88.3 MB 11.1 MB/s eta 0:00:00
Collecting pyarrow&lt;15.0.0a0,&gt;=14.0.1
  Downloading pyarrow-14.0.2-cp310-cp310-manylinux_2_28_x86_64.whl (38.0 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 38.0/38.0 MB 31.9 MB/s eta 0:00:00
Collecting rich
  Downloading rich-13.7.1-py3-none-any.whl (240 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 240.7/240.7 KB 29.1 MB/s eta 0:00:00
Requirement already satisfied: packaging in /home/owkin/.local/lib/python3.10/site-packages (from cudf-cu12==24.2.*-&gt;cugraph-cu12==24.02.0) (24.0)
Collecting pandas&lt;1.6.0dev0,&gt;=1.3
  Downloading pandas-1.5.3-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (12.1 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 12.1/12.1 MB 97.6 MB/s eta 0:00:00
Collecting nvtx&gt;=0.2.1
  Downloading nvtx-0.2.10-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (582 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 582.6/582.6 KB 54.2 MB/s eta 0:00:00
Collecting numpy&gt;=1.21
  Downloading numpy-1.24.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (17.3 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 17.3/17.3 MB 99.9 MB/s eta 0:00:00
Collecting pynvjitlink-cu12
  Downloading https://pypi.nvidia.com/pynvjitlink-cu12/pynvjitlink_cu12-0.1.14-cp310-cp310-manylinux_2_17_x86_64.whl (24.0 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 24.0/24.0 MB 73.0 MB/s eta 0:00:00
Collecting protobuf&lt;5,&gt;=4.21
  Downloading protobuf-4.25.3-cp37-abi3-manylinux2014_x86_64.whl (294 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 294.6/294.6 KB 39.8 MB/s eta 0:00:00
Collecting typing_extensions&gt;=4.0.0
  Downloading typing_extensions-4.10.0-py3-none-any.whl (33 kB)
Collecting cuda-python&lt;13.0a0,&gt;=12.0
  Downloading cuda_python-12.4.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (24.5 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 24.5/24.5 MB 70.4 MB/s eta 0:00:00
Collecting cachetools
  Downloading cachetools-5.3.3-py3-none-any.whl (9.3 kB)
Collecting pynvml&lt;11.5,&gt;=11.0.0
  Downloading pynvml-11.4.1-py3-none-any.whl (46 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 47.0/47.0 KB 9.0 MB/s eta 0:00:00
Requirement already satisfied: click&gt;=8.1 in /home/owkin/.local/lib/python3.10/site-packages (from dask-cuda==24.2.*-&gt;cugraph-cu12==24.02.0) (8.1.7)
Collecting zict&gt;=2.0.0
  Downloading zict-3.0.0-py2.py3-none-any.whl (43 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 43.3/43.3 KB 8.7 MB/s eta 0:00:00
Collecting pylibraft-cu12==24.2.*
  Downloading https://pypi.nvidia.com/pylibraft-cu12/pylibraft_cu12-24.2.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (647.0 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 647.0/647.0 MB 1.1 MB/s eta 0:00:00
Collecting joblib&gt;=0.11
  Downloading joblib-1.3.2-py3-none-any.whl (302 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 302.2/302.2 KB 817.2 kB/s eta 0:00:00
Collecting distributed==2024.1.1
  Downloading distributed-2024.1.1-py3-none-any.whl (1.0 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.0/1.0 MB 2.3 MB/s eta 0:00:00
Collecting dask==2024.1.1
  Downloading dask-2024.1.1-py3-none-any.whl (1.2 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.2/1.2 MB 3.5 MB/s eta 0:00:00
Collecting cloudpickle&gt;=1.5.0
  Downloading cloudpickle-3.0.0-py3-none-any.whl (20 kB)
Collecting partd&gt;=1.2.0
  Downloading partd-1.4.1-py3-none-any.whl (18 kB)
Collecting toolz&gt;=0.10.0
  Downloading toolz-0.12.1-py3-none-any.whl (56 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 56.1/56.1 KB 227.5 kB/s eta 0:00:00
Collecting pyyaml&gt;=5.3.1
  Downloading PyYAML-6.0.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (705 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 705.5/705.5 KB 59.1 MB/s eta 0:00:00
Collecting importlib-metadata&gt;=4.13.0
  Downloading importlib_metadata-7.1.0-py3-none-any.whl (24 kB)
Collecting jinja2&gt;=2.10.3
  Downloading Jinja2-3.1.3-py3-none-any.whl (133 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 133.2/133.2 KB 24.4 MB/s eta 0:00:00
 
 [...]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:57 UTC
    </footer>
</body>
</html>
