<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>empty `requirements.txt` when importing from `pyproject.toml` - astral-sh/uv #3817</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>empty `requirements.txt` when importing from `pyproject.toml`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3817">#3817</a>
        opened by <a href="https://github.com/BBBmau">@BBBmau</a>
        on 2024-05-24 10:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/BBBmau">@BBBmau</a> on 2024-05-24 10:37</div>
            <div class="timeline-body"><p>When attempting to import from an existing <code>pyproject.toml</code> file I get an empty generated <code>requirements.txt</code> file, for context I am currently attempting to import from using <code>poetry</code> to using <code>uv</code> which could be what's causing it. Is their currently a workaround for this?</p>
<p><code>uv pip compile pyproject.toml -o requirements.txt</code>    # Read a pyproject.toml file.</p>
<p>uv version: <code>uv 0.2.2 (e52ae0e2b 2024-05-22)</code></p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-05-24 11:05</div>
            <div class="timeline-body"><p>We don't support poetry's format currently, only the standardized (PEP 621) <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/#dependencies-and-requirements"><code>[project]</code> table</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 12:21</div>
            <div class="timeline-body"><p>This is still supposed to work though. If itâ€™s a Poetry file, we use PEP 517, I think? Though maybe it depends on certain fields being present in the file.</p>
<p>Can you share a pyproject.toml file that reproduces this behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 13:58</div>
            <div class="timeline-body"><p>It works as expected for me with:</p>
<pre><code class="language-toml">[tool.poetry]
name = &quot;poetry-test&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [&quot;Charlie Marsh &lt;charlie.r.marsh@gmail.com&gt;&quot;]
packages = [{ include = &quot;poetry_test&quot; }]

[tool.poetry.dependencies]
python = &quot;^3.10.0&quot;
anyio = &quot;*&quot;

[build-system]
requires = [&quot;poetry-core&quot;]
build-backend = &quot;poetry.core.masonry.api&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2024-05-24 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BBBmau">@BBBmau</a> on 2024-05-24 15:06</div>
            <div class="timeline-body"><blockquote>
<p>It works as expected for me with:</p>
<pre><code class="language-toml">[tool.poetry]
name = &quot;poetry-test&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [&quot;Charlie Marsh &lt;charlie.r.marsh@gmail.com&gt;&quot;]
packages = [{ include = &quot;poetry_test&quot; }]

[tool.poetry.dependencies]
python = &quot;^3.10.0&quot;
anyio = &quot;*&quot;

[build-system]
requires = [&quot;poetry-core&quot;]
build-backend = &quot;poetry.core.masonry.api&quot;
</code></pre>
</blockquote>
<p>I have these included with this along with it:</p>
<pre><code>[tool.poetry.group.dev.dependencies]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 17:13</div>
            <div class="timeline-body"><p>Do you mind sharing the whole file? (We don't include dev dependencies though -- that's a proprietary Poetry feature, so they won't be included if you lock with uv or pip-compile or any other tool IIRC.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BBBmau">@BBBmau</a> on 2024-05-24 17:17</div>
            <div class="timeline-body"><p>sure thing @charliermarsh</p>
<pre><code>[project]
name = &quot;openpilot&quot;
requires-python = &quot;&gt;= 3.11&quot;
readme = &quot;README.md&quot;
license = {text = &quot;MIT License&quot;}

[project.urls]
Homepage = &quot;https://comma.ai&quot;

[tool.pytest.ini_options]
minversion = &quot;6.0&quot;
addopts = &quot;--ignore=openpilot/ --ignore=cereal/ --ignore=opendbc/ --ignore=panda/ --ignore=rednose_repo/ --ignore=tinygrad_repo/ --ignore=teleoprtc_repo/ -Werror --strict-config --strict-markers --durations=10 -n auto --dist=loadgroup&quot;
cpp_files = &quot;test_*&quot;
cpp_harness = &quot;selfdrive/test/cpp_harness.py&quot;
python_files = &quot;test_*.py&quot;
#timeout = &quot;30&quot;  # you get this long by default
markers = [
  &quot;slow: tests that take awhile to run and can be skipped with -m 'not slow'&quot;,
  &quot;tici: tests that are only meant to run on the C3/C3X&quot;,
]
testpaths = [
  &quot;common&quot;,
  &quot;selfdrive/boardd&quot;,
  &quot;selfdrive/car&quot;,
  &quot;selfdrive/controls&quot;,
  &quot;selfdrive/locationd&quot;,
  &quot;selfdrive/monitoring&quot;,
  &quot;selfdrive/navd/tests&quot;,
  &quot;selfdrive/test/longitudinal_maneuvers&quot;,
  &quot;selfdrive/test/process_replay/test_fuzzy.py&quot;,
  &quot;selfdrive/updated&quot;,
  &quot;system/thermald&quot;,
  &quot;system/athena&quot;,
  &quot;system/camerad&quot;,
  &quot;system/hardware/tici&quot;,
  &quot;system/loggerd&quot;,
  &quot;system/proclogd&quot;,
  &quot;system/tests&quot;,
  &quot;system/ubloxd&quot;,
  &quot;system/webrtc&quot;,
  &quot;tools/lib/tests&quot;,
  &quot;tools/replay&quot;,
  &quot;tools/cabana&quot;
]

[tool.mypy]
python_version = &quot;3.11&quot;
plugins = [
  &quot;numpy.typing.mypy_plugin&quot;,
]
exclude = [
  &quot;body/&quot;,
  &quot;cereal/&quot;,
  &quot;opendbc/&quot;,
  &quot;panda/&quot;,
  &quot;rednose/&quot;,
  &quot;rednose_repo/&quot;,
  &quot;tinygrad/&quot;,
  &quot;tinygrad_repo/&quot;,
  &quot;teleoprtc/&quot;,
  &quot;teleoprtc_repo/&quot;,
  &quot;third_party/&quot;,
]

# third-party packages
ignore_missing_imports=true

# helpful warnings
warn_redundant_casts=true
warn_unreachable=true
warn_unused_ignores=true

# restrict dynamic typing
warn_return_any=true

# allow implicit optionals for default args
implicit_optional = true


[tool.poetry]
name = &quot;openpilot&quot;
version = &quot;0.1.0&quot;
description = &quot;an open source driver assistance system&quot;
authors = [&quot;Vehicle Researcher &lt;user@comma.ai&gt;&quot;]
license = &quot;MIT&quot;
readme = &quot;README.md&quot;
repository = &quot;https://github.com/commaai/openpilot&quot;
documentation = &quot;https://docs.comma.ai&quot;


[tool.poetry.dependencies]
python = &quot;~3.11&quot;
aiohttp = &quot;*&quot;
aiortc = &quot;*&quot;
cffi = &quot;*&quot;
crcmod = &quot;*&quot;
Cython = &quot;*&quot;
json-rpc = &quot;*&quot;
libusb1 = &quot;*&quot;
numpy = &quot;*&quot;
onnx = &quot;&gt;=1.14.0&quot;
onnxruntime = { version = &quot;&gt;=1.16.3&quot;, platform = &quot;linux&quot;, markers = &quot;platform_machine == 'aarch64'&quot; }
onnxruntime-gpu = { version = &quot;&gt;=1.16.3&quot;, platform = &quot;linux&quot;, markers = &quot;platform_machine == 'x86_64'&quot; }
psutil = &quot;*&quot;
pyaudio = &quot;*&quot;
pycapnp = &quot;*&quot;
pycryptodome = &quot;*&quot;
PyJWT = &quot;*&quot;
pyserial = &quot;*&quot;
pyzmq = &quot;*&quot;
rerun-sdk = &quot;*&quot;
requests = &quot;*&quot;
scons = &quot;*&quot;
sentry-sdk = &quot;*&quot;
smbus2 = &quot;*&quot;
sounddevice = &quot;*&quot;
spidev = { version = &quot;*&quot;, platform = &quot;linux&quot; }
sympy = &quot;*&quot;
websocket_client = &quot;*&quot;

# acados deps
casadi = &quot;*&quot;
future-fstrings = &quot;*&quot;

# these should be removed
markdown-it-py = &quot;*&quot;
timezonefinder = &quot;*&quot;
setproctitle = &quot;*&quot;

[tool.poetry.group.dev.dependencies]
av = &quot;*&quot;
azure-identity = &quot;*&quot;
azure-storage-blob = &quot;*&quot;
breathe = &quot;*&quot;
control = &quot;*&quot;
coverage = &quot;*&quot;
dictdiffer = &quot;*&quot;
flaky = &quot;*&quot;
hypothesis = &quot;~6.47&quot;
inputs = &quot;*&quot;
Jinja2 = &quot;*&quot;
lru-dict = &quot;*&quot;
matplotlib = &quot;*&quot;
metadrive-simulator = { version = &quot;0.4.2.3&quot;, markers = &quot;platform_machine != 'aarch64'&quot; } # no linux/aarch64 wheels for certain dependencies
mpld3 = &quot;*&quot;
mypy = &quot;*&quot;
myst-parser = &quot;*&quot;
natsort = &quot;*&quot;
opencv-python-headless = &quot;*&quot;
parameterized = &quot;^0.8&quot;
pprofile = &quot;*&quot;
polyline = &quot;*&quot;
pre-commit = &quot;*&quot;
pyautogui = &quot;*&quot;
pyopencl = &quot;==2023.1.4&quot;  # 2024.1 is broken on arm64
pygame = &quot;*&quot;
pywinctl = &quot;*&quot;
pyprof2calltree = &quot;*&quot;
pytest = &quot;*&quot;
pytest-cov = &quot;*&quot;
pytest-cpp = &quot;*&quot;
pytest-subtests = &quot;*&quot;
pytest-xdist = &quot;*&quot;
pytest-timeout = &quot;*&quot;
pytest-randomly = &quot;*&quot;
pytest-asyncio = &quot;*&quot;
pytest-mock = &quot;*&quot;
ruff = &quot;*&quot;
sphinx = &quot;*&quot;
sphinx-rtd-theme = &quot;*&quot;
sphinx-sitemap = &quot;*&quot;
tabulate = &quot;*&quot;
types-requests = &quot;*&quot;
types-tabulate = &quot;*&quot;
tqdm = &quot;*&quot;

# this is only pinned since 5.15.11 is broken
pyqt5 = { version = &quot;==5.15.2&quot;, markers = &quot;platform_machine == 'x86_64'&quot; } # no aarch64 wheels for macOS/linux

[build-system]
requires = [&quot;poetry-core&quot;]
build-backend = &quot;poetry.core.masonry.api&quot;

# https://beta.ruff.rs/docs/configuration/#using-pyprojecttoml
[tool.ruff]
indent-width = 2
lint.select = [
  &quot;E&quot;, &quot;F&quot;, &quot;W&quot;, &quot;PIE&quot;, &quot;C4&quot;, &quot;ISC&quot;, &quot;A&quot;, &quot;B&quot;,
  &quot;NPY&quot;, # numpy
  &quot;UP&quot;,  # pyupgrade
  &quot;TRY302&quot;, &quot;TRY400&quot;, &quot;TRY401&quot;, # try/excepts
  &quot;RUF008&quot;, &quot;RUF100&quot;,
  &quot;TID251&quot;
]
lint.ignore = [
  &quot;E741&quot;,
  &quot;E402&quot;,
  &quot;C408&quot;,
  &quot;ISC003&quot;,
  &quot;B027&quot;,
  &quot;B024&quot;,
  &quot;NPY002&quot;,  # new numpy random syntax is worse
  &quot;UP038&quot;,   # (x, y) -&gt; x|y for isinstance
]
line-length = 160
target-version=&quot;py311&quot;
exclude = [
  &quot;body&quot;,
  &quot;cereal&quot;,
  &quot;panda&quot;,
  &quot;opendbc&quot;,
  &quot;rednose_repo&quot;,
  &quot;tinygrad_repo&quot;,
  &quot;teleoprtc&quot;,
  &quot;teleoprtc_repo&quot;,
  &quot;third_party&quot;,
]
lint.flake8-implicit-str-concat.allow-multiline=false
[tool.ruff.lint.flake8-tidy-imports.banned-api]
&quot;selfdrive&quot;.msg = &quot;Use openpilot.selfdrive&quot;
&quot;common&quot;.msg = &quot;Use openpilot.common&quot;
&quot;system&quot;.msg = &quot;Use openpilot.system&quot;
&quot;third_party&quot;.msg = &quot;Use openpilot.third_party&quot;
&quot;tools&quot;.msg = &quot;Use openpilot.tools&quot;
&quot;pytest.main&quot;.msg = &quot;pytest.main requires special handling that is easy to mess up!&quot;
&quot;unittest&quot;.msg = &quot;Use pytest&quot;

[tool.coverage.run]
concurrency = [&quot;multiprocessing&quot;, &quot;thread&quot;]
[tool.ruff.format]
quote-style = &quot;preserve&quot;

[tool.uv.pip]
index-url = &quot;https://test.pypi.org/simple&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-24 18:45</div>
            <div class="timeline-body"><p>@BBBmau - so technically, per the spec... if you have a <code>[project]</code> section, and <code>dependencies</code> is omitted, it means <code>dependencies = []</code>.</p>
<p>You can fix this by adding <code>dynamic = [&quot;dependencies&quot;]</code>, like:</p>
<pre><code class="language-toml">[project]
name = &quot;openpilot&quot;
requires-python = &quot;&gt;= 3.11&quot;
readme = &quot;README.md&quot;
license = {text = &quot;MIT License&quot;}
dynamic = [&quot;dependencies&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @charliermarsh on 2024-05-24 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-05-24 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mihirsamdarshi">@mihirsamdarshi</a> on 2024-05-26 08:49</div>
            <div class="timeline-body"><p>Charlie, If I understand your last comment correctly, when <code>[project]</code> and <code>[tool.poetry]</code> sections are included, <code>[tool.poetry.dependencies]</code> is ignored, unless <code>dynamic = [&quot;dependencies&quot;]</code> is included under <code>[project]</code>?</p>
<p>Therefore a correct <code>prproject.toml</code> with both <code>[project]</code> and <code>[tool.poetry]</code> would look like this?</p>
<pre><code class="language-toml">[project]
name = &quot;poetry-test&quot;
requires-python = &quot;&gt;= 3.11&quot;
readme = &quot;README.md&quot;
license = {text = &quot;MIT License&quot;}
dynamic = [&quot;dependencies&quot;]

[tool.poetry]
name = &quot;poetry-test&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [&quot;Urmom&quot;]
packages = [{ include = &quot;poetry_test&quot; }]

[tool.poetry.dependencies]
python = &quot;^3.10.0&quot;
anyio = &quot;*&quot;

[build-system]
requires = [&quot;poetry-core&quot;]
build-backend = &quot;poetry.core.masonry.api&quot;
</code></pre>
<p>I was running into the same issue, that <code>uv pip compile pyproject.toml</code> was giving me a blank requirements.txt file. I was able to trace it back to this behavior.</p>
<p>Additionally, I know that isn't probably something you thought would happen, but if you don't have a <code>[tool.poetry]</code> section (your <code>[build-system]</code> is not <code>poetry</code>), but you do have <code>[tool.poetry.dependencies]</code> section (and also have <code>dynamic = [&quot;dependencies&quot;]</code>), the result of <code>uv pip compile pyproject.toml</code> is also empty. I was hoping to incrementally migrate from <code>poetry</code> to <code>uv</code>/<code>rye</code> by removing the packaging system before dependency management. For some reason, the <code>rye add</code> command (listing my dep requirements in the TOML's <code>project.dependencies</code> key) doesn't work, but it does when using <code>uv pip compile pyproject.toml</code> and defining the requirements in <code>tool.poetry.dependencies</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-26 18:38</div>
            <div class="timeline-body"><p>@mihirsamdarshi - Yeah this is technically correct. If you have a non-empty <code>project</code> section, and nothing listed as <code>dynamic</code>, then non-Poetry tools are allowed to assume that the metadata in <code>project</code> is &quot;exactly correct&quot;. And if <code>dependencies</code> is omitted, it's equivalent to setting <code>dependencies = []</code>. So above, non-Poetry tools will think that the package has no dependencies.</p>
<p>If you add <code>dynamic = [&quot;dependencies&quot;]</code> as you did above, it should work with uv and any other non-Poetry tools (like pip-compile).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-26 18:38</div>
            <div class="timeline-body"><p>(Happy to answer more questions, let me know if unclear.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-26 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-05-26 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mhemeryck">@mhemeryck</a> on 2024-05-29 07:01</div>
            <div class="timeline-body"><p>Is there a way in which we can also include poetry's dev dependencies in the lock file? Essentially everything under <code>tool.poetry.group.dev.dependencies</code>?</p>
<p>Looking into a way in which I could steadily migrate our poetry-based setup into uv; would be easy if the 2 could just co-exist for some time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-29 13:31</div>
            <div class="timeline-body"><p>Unfortunately there isn't really any way for us to parse and access Poetry's development dependencies without supporting Poetry's entire schema. Poetry use their own schema for defining dependencies, so from uv's perspective, <code>tool.poetry.group.dev.dependencies</code> is effectively opaque.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mhemeryck">@mhemeryck</a> on 2024-05-29 13:59</div>
            <div class="timeline-body"><blockquote>
<p>Unfortunately there isn't really any way for us to parse and access Poetry's development dependencies without supporting Poetry's entire schema. Poetry use their own schema for defining dependencies, so from uv's perspective, <code>tool.poetry.group.dev.dependencies</code> is effectively opaque.</p>
</blockquote>
<p>OK, makes sense. In the projects we've been developing, poetry has become so much part of the standard way of managing python projects that the <code>pyproject.toml</code> file had become almost exclusively associated with poetry. It's only now that I have been exploring uv that I see other kinds of workflows, like pip-tools (pip-compile and pip-sync).</p>
<p>The quickest work-around for us will probably be to just not split the dependencies into 2 separate groups, because I see it actually works quite OK in that case.</p>
<p>Poetry does not support editable installs though, so that part is then again conflicting; before, we used to run <code>poetry run &lt;tool&gt;</code> and it the current local folder would be part of the python part, but that's not how the virtualenv seems to behave ...</p>
<p>... but I'm rambling on, dependency management in python always has been a bit of an issue so it's great to see all the effort you are putting in this, very curious to see how it will evolve! The thing poetry does right in my view is that is a single tool to manage and resolve dependencies and virtualenvs (the resolving part just tends to be really slow for larger projects).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:58 UTC
    </footer>
</body>
</html>
