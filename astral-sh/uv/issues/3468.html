<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline mode is not automatic fallback when offline - astral-sh/uv #3468</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Offline mode is not automatic fallback when offline</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/3468">#3468</a>
        opened by <a href="https://github.com/minusf">@minusf</a>
        on 2024-05-08 18:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/minusf">@minusf</a> on 2024-05-08 18:50</div>
            <div class="timeline-body"><p>I am trying to understand the reason why <code>--offline</code> is not implied when network connections fail:</p>
<pre><code>VIRTUAL_ENV=venv uv pip install -r requirements.txt
error: Could not connect, are you offline?
  Caused by: error sending request for url (https://pypi.org/simple/django-timezone-field/)
  Caused by: client error (Connect)
  Caused by: dns error: failed to lookup address information: nodename nor servname provided, or not known
  Caused by: failed to lookup address information: nodename nor servname provided, or not known
</code></pre>
<p>Is there one?  The great appeal of <code>devpi</code> was that no matter if I was online or offline <code>pip install</code> just worked. It makes the CI/CD pipeline somewhat more convoluted if a flag needs to be added to explicitly request offline mode.</p>
<p>If the reason is to fail loudly and early and make some noise so a human has a look, it would be really nice to have a &quot;fallback to offline if can't connect anywhere&quot; command line switch please.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Offline not automatic failback" to "Offline mode is not automatic fallback when offline" by @minusf on 2024-05-08 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-08 18:55</div>
            <div class="timeline-body"><p>I'm a little confused by what you expect to happen here. Can you expand on what you think uv's behavior should be? With devpi, there's a package index for tools to query â€” how do you think uv should work without a package index available?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-05-08 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-05-08 21:50</div>
            <div class="timeline-body"><p>I am sorry, I didn't include the rest of the story: the same command with <code>--offline</code> succeeds as all these packages were already in the cache.</p>
<p>Obviously if the dependency graph cannot be successfully resolved and the packages installed only using the cache, the operation should fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-08 21:58</div>
            <div class="timeline-body"><p>Are all of your requirements pinned? I don't think we should attempt a network request unless it is needed, i.e. I would expect us to use the cache without the <code>--offline</code> flag here.</p>
<p>cc @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-05-08 22:02</div>
            <div class="timeline-body"><p>This is a hobby project, so not all packages are pinned :D  Actually only django is and the rest &quot;gets the latest&quot; strategy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-08 22:54</div>
            <div class="timeline-body"><p>If you just pin them i.e. use separate <code>requirements.in</code> and <code>requirements.txt</code> files with <code>uv pip compile</code> you shouldn't run into this issue. I'm not sure we should infer using offline for unpinned requirements, it's interesting to consider though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-05-08 23:22</div>
            <div class="timeline-body"><p>Thank you, I will check out <code>pip-compile</code> &quot;flow&quot;, never used it before.</p>
<p>What are the risks of trying going offline mode here? I have a tunnel vision of my use case here (i.e. the <code>venv</code> was built completely successfully at least once and is cached), but it seems harmless to me to try and see if all packages can be installed from the local cache. What is there to lose? If I add the <code>--offline</code> parameter it just all works already...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-08 23:43</div>
            <div class="timeline-body"><p>I think the main problem is that package resolution should not change whether you have internet or not â€” that'd be a surprising behavior without opt-in.</p>
<p>cc @charliermarsh</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2024-05-08 23:45</div>
            <div class="timeline-body"><blockquote>
<p>that'd be a surprising behavior without opt-in.</p>
</blockquote>
<p>ðŸ‘† 100% agree</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-05-08 23:48</div>
            <div class="timeline-body"><p>So if I understand correctly, if all packages and subpackages were pinned, there could be no surprising behaviour and <code>--offline</code> could be a safe fallback?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-05-08 23:53</div>
            <div class="timeline-body"><p>That's my understanding, I don't think we'd need to change anything we'd just use the cache because we know what versions you want â€” there's no resolution to do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-05-09 00:06</div>
            <div class="timeline-body"><p>I tested the all pinned workflow and <code>--offline</code> indeed becomes redundant.</p>
<p>This is great and maybe worth documenting. This means that for my uses cases I don't need <code>devpi</code> anymore and that's just toast. <code>pip</code> is also a marked man, all it does now is <code>pip list --outdated</code>.</p>
<p>I think this issue can be closed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-05-09 01:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4728.html">astral-sh/uv#4728</a> on 2024-07-02 12:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:57 UTC
    </footer>
</body>
</html>
