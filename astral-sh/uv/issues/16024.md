```yaml
number: 16024
title: Segfault on amd64 under QEMU
type: issue
state: open
author: lczyk
labels:
  - external
assignees: []
created_at: 2025-09-25T11:13:42Z
updated_at: 2025-09-25T13:24:44Z
url: https://github.com/astral-sh/uv/issues/16024
synced_at: 2026-01-10T01:57:35Z
```

# Segfault on amd64 under QEMU

---

_Issue opened by @lczyk on 2025-09-25 11:13_

### Summary

```bash
docker run --rm --platform=linux/amd64 ubuntu:25.04 bash -c '
apt update && apt install -y curl;
curl -LsSf https://astral.sh/uv/install.sh | sh;
source $HOME/.local/bin/env;
which uv;
uv --help'
```

leads to

```
/root/.local/bin/uv # the output of `which`
qemu: uncaught target signal 11 (Segmentation fault) - core dumped
```

note: i'm on arm64 host.

reminds me of [this](https://github.com/junegunn/fzf/issues/4464) issue which i've reported a while ago, which turned out to be an [issue in upstream golang](https://github.com/golang/go/issues/69255) (yes, i know this is not a golang project üòÖ i said it *reminds me* of it) which they resolved in the HEAD (go1.26).

---

Note: here is a useful snippet to enable qemu emulation in docker: `docker run --privileged --rm tonistiigi/binfmt --install all`

Note 2: i've run the same command 

### Platform

Ubuntu 25.04 aarch64

### Version

uv 0.8.22 x86_64-unknown-linux-gnu (extracted from logs, before the segfault)

### Python version

irrelevant

---

_Label `bug` added by @lczyk on 2025-09-25 11:13_

---

_Comment by @konstin on 2025-09-25 11:19_

We don't have any reports from something similar happening with the native binary, so this sounds like a QEMU bug. Can you `cargo build` a debug build and use gdb to capture a backtrace?

---

_Comment by @lczyk on 2025-09-25 11:34_

already on it üòÅ 

---

_Comment by @lczyk on 2025-09-25 11:40_

apparently not üòÜ *definitely* looks like an upstream bug though. `rust` or `qemu` or both. will escalate.

```
root@952773e6b9c4:~/uv# cargo build
error: process didn't exit successfully: `/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/bin/rustc -vV` (signal: 11, SIGSEGV: invalid memory reference)
--- stderr
error: rustc interrupted by SIGSEGV, printing backtrace

/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/lib/librustc_driver-890dfd19c9b338c0.so(+0x3c83a9f)[0xffffaf083a9f]
/lib/x86_64-linux-gnu/libc.so.6(+0x45330)[0xffffab233330]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/bin/rustc(realloc+0xc5c)[0x55555557be2c]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/lib/librustc_driver-890dfd19c9b338c0.so(+0x5403598)[0xffffb0803598]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/lib/librustc_driver-890dfd19c9b338c0.so(_ZN5alloc3ffi5c_str7CString19_from_vec_unchecked17hd3132e195204e147E+0x4d)[0xffffb18ea54d]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/lib/librustc_driver-890dfd19c9b338c0.so(_ZN118_$LT$std..thread..thread_name_string..ThreadNameString$u20$as$u20$core..convert..From$LT$alloc..string..String$GT$$GT$4from17h40ccdde012c08396E+0x49)[0xffffb18ea65d]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/lib/librustc_driver-890dfd19c9b338c0.so(_RNvCsaeDQxODg9Sp_17rustc_driver_impl21install_ctrlc_handler+0x1da)[0xffffb190efda]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/lib/librustc_driver-890dfd19c9b338c0.so(_RNvCsaeDQxODg9Sp_17rustc_driver_impl4main+0x15e)[0xffffb191049e]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/bin/rustc(+0x37a37)[0x55555558da37]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/bin/rustc(+0x37a23)[0x55555558da23]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/bin/rustc(+0x37a19)[0x55555558da19]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/lib/librustc_driver-890dfd19c9b338c0.so(_ZN3std2rt19lang_start_internal17h34f9328d113fd60aE+0x491)[0xffffb197c451]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/bin/rustc(+0x74da7)[0x5555555cada7]
/lib/x86_64-linux-gnu/libc.so.6(+0x2a1ca)[0xffffab2181ca]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x8b)[0xffffab21828b]
/root/.rustup/toolchains/1.90-x86_64-unknown-linux-gnu/bin/rustc(+0x74cb4)[0x5555555cacb4]

note: we would appreciate a report at https://github.com/rust-lang/rust
help: you can increase rustc's stack size by setting RUST_MIN_STACK=16777216
qemu: uncaught target signal 11 (Segmentation fault) - core dumped
```

---

_Referenced in [rust-lang/rust#147026](../../rust-lang/rust/issues/147026.md) on 2025-09-25 12:47_

---

_Label `external` added by @zanieb on 2025-09-25 12:48_

---

_Label `bug` removed by @konstin on 2025-09-25 13:20_

---

_Comment by @lczyk on 2025-09-25 13:24_

escalated to [rust](https://github.com/rust-lang/rust/issues/147026) and [QEMU](https://gitlab.com/qemu-project/qemu/-/issues/3130)

---

_Referenced in [gpo/gpo-platform-configs#132](../../gpo/gpo-platform-configs/issues/132.md) on 2025-12-08 21:58_

---
