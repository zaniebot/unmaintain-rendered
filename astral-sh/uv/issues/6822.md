```yaml
number: 6822
title: Dynamic dependencies in setup.py are not considered when editing dependencies
type: issue
state: closed
author: AbdealiLoKo
labels: []
assignees: []
created_at: 2024-08-29T16:45:16Z
updated_at: 2024-09-10T01:44:15Z
url: https://github.com/astral-sh/uv/issues/6822
synced_at: 2026-01-10T01:57:15Z
```

# Dynamic dependencies in setup.py are not considered when editing dependencies

---

_Issue opened by @AbdealiLoKo on 2024-08-29 16:45_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->


Here is a reproducible example in a docker container:
```bash
docker run --rm -it ubuntu:22.04
$ apt update
$ apt install -y curl
$ curl -LsSf https://astral.sh/uv/install.sh | sh
$ echo 'eval "$(uv generate-shell-completion bash)"' >> ~/.bashrc
$ source ~/.bashrc
$ uv init myapp
$ cd myapp
$ echo "babel==2.15.0" > pinned.txt
$ echo -e "from setuptools import setup\nsetup(install_requires=[i.strip() for i in open('pinned.txt', 'r').readlines()])" > setup.py
$ sed -i '/^dependencies/d' pyproject.toml
$ echo 'dynamic = ["dependencies"]' >> pyproject.toml
$ uv venv
$ uv pip install -e .
$ echo "babel==2.16.0" > pinned.txt

$ uv pip install -e . -v
DEBUG uv 0.4.0
DEBUG Searching for Python interpreter in system path
DEBUG Found `cpython-3.12.5-linux-x86_64-gnu` at `/myapp/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.12.5 environment at .venv/bin/python3
DEBUG Acquired lock for `.venv`
DEBUG Requirement satisfied: babel==2.15.0  <--------------------- This should have been 2.16.0
DEBUG Requirement satisfied: file:///myapp
Audited 1 package in 5ms

$ uv pip tree
myapp v0.1.0
└── babel v2.15.0
```

I expected that the second `uv pip install -e .` should have noticed that the dependencies for `myapp` have changed.
But it looks like it is not.

Seems related: https://github.com/astral-sh/uv/issues/2844

Workarounds I have seen:
- `uv pip install -e . --reinstall`
- `uv clean; uv pip install -e .`


---

_Comment by @charliermarsh on 2024-08-29 16:49_

You'll need to mark your package as requiring reinstallation if you want it to be reinstalled on every operation. This is documented here: https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata.

---

_Comment by @AbdealiLoKo on 2024-08-29 17:41_

Sighs ... not sure how I missed that in the documentation !
Thanks for the pointer, I'll read it and try it out !

---

_Closed by @AbdealiLoKo on 2024-08-29 17:41_

---

_Comment by @AbdealiLoKo on 2024-08-30 04:00_

@charliermarsh was thinking about this a bit more ... is there any benefit of making a heuristic here that if a package is being installed from a local path + The package has dynamic fields in pyproject.toml -- uv would automatically reinstall it in every operation to be safe ?

1. Local path - I assume uv already has this information
2. Dynamic fields - If the [project.dynamic](https://peps.python.org/pep-0621/#dynamic) field is defined in pyproject.toml then we know if has dynamic fields ?

---

_Referenced in [astral-sh/uv#6860](../../astral-sh/uv/issues/6860.md) on 2024-08-30 12:26_

---

_Comment by @charliermarsh on 2024-09-10 01:44_

We have a new API whereby you can add additional files to consider when invalidating the cache. You can also include the current Git commit (i.e., invalidate whenever the SHA changes).

Looks like this:

```toml
[tool.uv]
cache-keys = [{ file = "pyproject.toml" }, { file = "requirements.txt" }, { git = true }]
```

See: https://docs.astral.sh/uv/concepts/cache/#dynamic-metadata.

---
