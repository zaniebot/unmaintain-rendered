```yaml
number: 16180
title: "[Question] UV Caching in Docker behaviour?"
type: issue
state: closed
author: vaibhavmano
labels:
  - question
assignees: []
created_at: 2025-10-08T10:28:05Z
updated_at: 2025-12-22T11:46:53Z
url: https://github.com/astral-sh/uv/issues/16180
synced_at: 2026-01-10T01:57:35Z
```

# [Question] UV Caching in Docker behaviour?

---

_Issue opened by @vaibhavmano on 2025-10-08 10:28_

### Question

I have checked out [Docker Caching](https://docs.astral.sh/uv/guides/integration/docker/#caching) and the [uv docker example](https://github.com/astral-sh/uv-docker-example/blob/main/Dockerfile). Both of them fail to clarify on the behaviour of the cache directory. 

In the local system, I'm able to check and verify that the `UV_CACHE_DIR` contains many folders and files like `CACHEDIR.TAG`, `wheels`, `interpreter` etc.

The case is different when building a Docker Image though! Below is one of my `Dockerfile` for a service

```
FROM basexg:latest

ENV SERVICE_NAME=application
ENV UV_CACHE_DIR=/${SERVICE_NAME}/cache/uv

COPY /pyproject.toml /build/
COPY /uv.lock /build/
COPY /baselib /build/baselib
COPY /application /build/application

WORKDIR /build
# WITH CACHE
RUN --mount=type=cache,target=${UV_CACHE_DIR} \
    uv sync --active --frozen --no-group dev --package application

RUN useradd -u 1001 snapp && chown -R snapp:snapp /build
USER snapp

ENTRYPOINT ["sh", "/build/application/start.sh"]
```

This is the `pyproject.toml` for the service file
```
[project]
name = "application"
version = "1.0.0"
description = "Contains all business logics related to application service"
authors = [{ email = "john@test.com" }]
requires-python = "==3.12.*"
dependencies = [
    "baselib==0.1.0",
    "jsonschema==4.22.0",
]

[tool.uv]
package = false

[tool.uv.sources]
baselib = { workspace = true }


[dependency-groups]
dev = [
    "ruff==0.13.0",
    "bandit>=1.8.6",
    "pytest>=8.4.2",
    "pytest-cov>=7.0.0",
]

[tool.pytest.ini_options]
pythonpath = ["."]
addopts = "--cov=. --cov-report=xml"
testpaths = ["tests"]

```

Running `uv cache dir` inside the container returns the value `/application/cache/uv`. However, as mentioned in the doc, the cache directory is not created inside the container as well as in the host system.

1) Is this the right behaviour? I'm guessing the cache mount should exist somewhere. I have also been able to verify this because the packages keep downloading from the source and not used from the cache. This is the docker build command `docker build -f application/Dockerfile -t apps . --progress=plain`. I've added `tokenizers` as a dependency to test the cache and it starts to download all the package and I assumed the cache would install only the new package.

Snippet that all the dependent packages are being downloaded.
```
#11 11.11  Downloading google-api-python-client
#11 11.53  Downloading uv
#11 11.85  Downloading pymupdf
#11 12.14  Downloading botocore
#11 15.23       Built uwsgi==2.0.28
#11 15.24 Prepared 157 packages in 14.27s
#11 15.57 Installed 157 packages in 330ms
```

2) My existing setup consists of using Jenkins as the CI/CD server running on k8s. All the jenkins build agents are therefore ephemeral and I won't be able to use the host file system for the uv cache. Only if above problem is resolved, I'll be able to check and see if I can mount a k8s pvc as a `UV_CACHE_DIR`



### Platform

macOS 15.4 x86_64

### Version

uv 0.8.17

---

_Label `question` added by @vaibhavmano on 2025-10-08 10:28_

---

_Renamed from "UV Caching in Docker behaviour?" to "[Question] UV Caching in Docker behaviour?" by @vaibhavmano on 2025-10-09 06:54_

---

_Comment by @konstin on 2025-12-18 13:33_

I tried to reproduce this with a simple project and this docker and it is caching for me:

```dockerfile
FROM ghcr.io/astral-sh/uv:0.9.18 AS uv
FROM debian

COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/
ADD pyproject.toml pyproject.toml
ADD uv.lock uv.lock
ADD src src

ENV UV_LINK_MODE=copy

RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync
```

The caching relies on local docker volume, which docker manages for you. If you have a distributed setup, you can mount in e.g. a shared volume and with `uv cache prune` to only cache the slow parts, it's not something we can give general advice on in the uv docs.

---

_Closed by @vaibhavmano on 2025-12-22 11:46_

---
