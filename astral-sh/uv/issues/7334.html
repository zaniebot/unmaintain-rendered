<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv run` does not sync when `uv.lock` changes across branches - astral-sh/uv #7334</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv run</code> does not sync when <code>uv.lock</code> changes across branches</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7334">#7334</a>
        opened by <a href="https://github.com/bayashi-cl">@bayashi-cl</a>
        on 2024-09-12 15:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bayashi-cl">@bayashi-cl</a></div>
            <div class="timeline-body"><p>Thank you for this amazing tool!</p>
Issue Description
<p>It seems like <code>uv run</code> only syncs when there is a mismatch between the venv and <code>pyproject.toml</code>, not <code>uv.lock</code>. Is this the intended behavior?</p>
Details
<p>I am running a scenario where I switch between two branches with different <code>uv.lock</code> files and execute <code>uv run</code>.</p>
<code>main</code> Branch
<ul>
<li>pyproject.toml</li>
</ul>
<pre><code>[project]
name = &quot;uv-run-sync&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = []
</code></pre>
<ul>
<li>uv.lock</li>
</ul>
<pre><code>version = 1
requires-python = &quot;&gt;=3.12&quot;

[[package]]
name = &quot;uv-run-sync&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
</code></pre>
<code>sub</code> Branch
<ul>
<li>pyproject.toml</li>
</ul>
<pre><code>[project]
name = &quot;uv-run-sync&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;ruff&gt;=0.6.4&quot;,
]
</code></pre>
<ul>
<li>uv.lock</li>
</ul>
<pre><code>version = 1
requires-python = &quot;&gt;=3.12&quot;

[[package]]
name = &quot;ruff&quot;
version = &quot;0.6.4&quot;
source = { registry = &quot;https://pypi.org/simple&quot; }
sdist = { url = &quot;https://files.pythonhosted.org/packages/a4/55/9f485266e6326cab707369601b13e3e72eb90ba3eee2d6779549a00a0d58/ruff-0.6.4.tar.gz&quot;, hash = &quot;sha256:ac3b5bfbee99973f80aa1b7cbd1c9cbce200883bdd067300c22a6cc1c7fba212&quot;, size = 2469375 }
wheels = [
    { url = &quot;https://files.pythonhosted.org/packages/e3/78/307591f81d09c8721b5e64539f287c82c81a46f46d16278eb27941ac17f9/ruff-0.6.4-py3-none-linux_armv6l.whl&quot;, hash = &quot;sha256:c4b153fc152af51855458e79e835fb6b933032921756cec9af7d0ba2aa01a258&quot;, size = 9692673 },
    { url = &quot;https://files.pythonhosted.org/packages/69/63/ef398fcacdbd3995618ed30b5a6c809a1ebbf112ba604b3f5b8c3be464cf/ruff-0.6.4-py3-none-macosx_10_12_x86_64.whl&quot;, hash = &quot;sha256:bedff9e4f004dad5f7f76a9d39c4ca98af526c9b1695068198b3bda8c085ef60&quot;, size = 9481182 },
    { url = &quot;https://files.pythonhosted.org/packages/a6/fd/8784e3bbd79bc17de0a62de05fe5165f494ff7d77cb06630d6428c2f10d2/ruff-0.6.4-py3-none-macosx_11_0_arm64.whl&quot;, hash = &quot;sha256:d02a4127a86de23002e694d7ff19f905c51e338c72d8e09b56bfb60e1681724f&quot;, size = 9174356 },
    { url = &quot;https://files.pythonhosted.org/packages/6d/bc/c69db2d68ac7bfbb222c81dc43a86e0402d0063e20b13e609f7d17d81d3f/ruff-0.6.4-py3-none-manylinux_2_17_aarch64.manylinux2014_aarch64.whl&quot;, hash = &quot;sha256:7862f42fc1a4aca1ea3ffe8a11f67819d183a5693b228f0bb3a531f5e40336fc&quot;, size = 10129365 },
    { url = &quot;https://files.pythonhosted.org/packages/3b/10/8ed14ff60a4e5eb08cac0a04a9b4e8590c72d1ce4d29ef22cef97d19536d/ruff-0.6.4-py3-none-manylinux_2_17_armv7l.manylinux2014_armv7l.whl&quot;, hash = &quot;sha256:eebe4ff1967c838a1a9618a5a59a3b0a00406f8d7eefee97c70411fefc353617&quot;, size = 9483351 },
    { url = &quot;https://files.pythonhosted.org/packages/a9/69/13316b8d64ffd6a43627cf0753339a7f95df413450c301a60904581bee6e/ruff-0.6.4-py3-none-manylinux_2_17_i686.manylinux2014_i686.whl&quot;, hash = &quot;sha256:932063a03bac394866683e15710c25b8690ccdca1cf192b9a98260332ca93408&quot;, size = 10301099 },
    { url = &quot;https://files.pythonhosted.org/packages/42/00/9623494087272643e8f02187c266638306c6829189a5bf1446968bbe438b/ruff-0.6.4-py3-none-manylinux_2_17_ppc64.manylinux2014_ppc64.whl&quot;, hash = &quot;sha256:50e30b437cebef547bd5c3edf9ce81343e5dd7c737cb36ccb4fe83573f3d392e&quot;, size = 11033216 },
    { url = &quot;https://files.pythonhosted.org/packages/c5/31/e0c9d881db42ea1267e075c29aafe0db5a8a3024b131f952747f6234f858/ruff-0.6.4-py3-none-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl&quot;, hash = &quot;sha256:c44536df7b93a587de690e124b89bd47306fddd59398a0fb12afd6133c7b3818&quot;, size = 10618140 },
    { url = &quot;https://files.pythonhosted.org/packages/5b/35/f1d8b746aedd4c8fde4f83397e940cc4c8fc619860ebbe3073340381a34d/ruff-0.6.4-py3-none-manylinux_2_17_s390x.manylinux2014_s390x.whl&quot;, hash = &quot;sha256:0ea086601b22dc5e7693a78f3fcfc460cceabfdf3bdc36dc898792aba48fbad6&quot;, size = 11606672 },
    { url = &quot;https://files.pythonhosted.org/packages/c5/70/899b03cbb3eb48ed0507d4b32b6f7aee562bc618ef9ffda855ec98c0461a/ruff-0.6.4-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl&quot;, hash = &quot;sha256:0b52387d3289ccd227b62102c24714ed75fbba0b16ecc69a923a37e3b5e0aaaa&quot;, size = 10288013 },
    { url = &quot;https://files.pythonhosted.org/packages/17/c6/906bf895640521ca5115ccdd857b2bac42bd61facde6620fdc2efc0a4806/ruff-0.6.4-py3-none-musllinux_1_2_aarch64.whl&quot;, hash = &quot;sha256:0308610470fcc82969082fc83c76c0d362f562e2f0cdab0586516f03a4e06ec6&quot;, size = 10109473 },
    { url = &quot;https://files.pythonhosted.org/packages/28/da/1284eb04172f8a5d42eb52fce9d643dd747ac59a4ed6c5d42729f72e934d/ruff-0.6.4-py3-none-musllinux_1_2_armv7l.whl&quot;, hash = &quot;sha256:803b96dea21795a6c9d5bfa9e96127cc9c31a1987802ca68f35e5c95aed3fc0d&quot;, size = 9568817 },
    { url = &quot;https://files.pythonhosted.org/packages/6c/e2/f8250b54edbb2e9222e22806e1bcc35a192ac18d1793ea556fa4977a843a/ruff-0.6.4-py3-none-musllinux_1_2_i686.whl&quot;, hash = &quot;sha256:66dbfea86b663baab8fcae56c59f190caba9398df1488164e2df53e216248baa&quot;, size = 9910840 },
    { url = &quot;https://files.pythonhosted.org/packages/9c/7c/dcf2c10562346ecdf6f0e5f6669b2ddc9a74a72956c3f419abd6820c2aff/ruff-0.6.4-py3-none-musllinux_1_2_x86_64.whl&quot;, hash = &quot;sha256:34d5efad480193c046c86608dbba2bccdc1c5fd11950fb271f8086e0c763a5d1&quot;, size = 10354263 },
    { url = &quot;https://files.pythonhosted.org/packages/f1/94/c39d7ac5729e94788110503d928c98c203488664b0fb92c2b801cb832bec/ruff-0.6.4-py3-none-win32.whl&quot;, hash = &quot;sha256:f0f8968feea5ce3777c0d8365653d5e91c40c31a81d95824ba61d871a11b8523&quot;, size = 7958602 },
    { url = &quot;https://files.pythonhosted.org/packages/6b/d2/2dee8c547bee3d4cfdd897f7b8e38510383acaff2c8130ea783b67631d72/ruff-0.6.4-py3-none-win_amd64.whl&quot;, hash = &quot;sha256:549daccee5227282289390b0222d0fbee0275d1db6d514550d65420053021a58&quot;, size = 8795059 },
    { url = &quot;https://files.pythonhosted.org/packages/07/1a/23280818aa4fa89bd0552aab10857154e1d3b90f27b5b745f09ec1ac6ad8/ruff-0.6.4-py3-none-win_arm64.whl&quot;, hash = &quot;sha256:ac4b75e898ed189b3708c9ab3fc70b79a433219e1e87193b4f2b77251d058d14&quot;, size = 8239636 },
]

[[package]]
name = &quot;uv-run-sync&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;ruff&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;ruff&quot;, specifier = &quot;&gt;=0.6.4&quot; }]
</code></pre>
Switching from <code>main</code> to <code>sub</code>
<pre><code>uv-run-sync on ÓÇ† main [!] is üì¶ v0.1.0
‚ùØ uv sync
Resolved 1 package in 0.59ms
Audited in 0.00ms

uv-run-sync on ÓÇ† main [!] is üì¶ v0.1.0
‚ùØ uv run python -c &quot;import ruff&quot;
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
ModuleNotFoundError: No module named &#x27;ruff&#x27;

uv-run-sync on ÓÇ† main [!] is üì¶ v0.1.0
‚ùØ git switch sub
M       README.md
Switched to branch &#x27;sub&#x27;

uv-run-sync on ÓÇ† sub [!] is üì¶ v0.1.0
‚ùØ uv run python -c &quot;import ruff&quot;
Installed 1 package in 7ms

uv-run-sync on ÓÇ† sub [!] is üì¶ v0.1.0
‚ùØ uv sync
Resolved 2 packages in 0.73ms
Audited 1 package in 0.01ms
</code></pre>
<p>As expected, <code>uv run</code> installs <code>ruff</code>.</p>
Switching from <code>sub</code> back to <code>main</code>
<pre><code>uv-run-sync on ÓÇ† sub [!] is üì¶ v0.1.0
‚ùØ uv sync
Resolved 2 packages in 0.63ms
Audited 1 package in 0.00ms

uv-run-sync on ÓÇ† sub [!] is üì¶ v0.1.0
‚ùØ uv run python -c &quot;import ruff&quot;

uv-run-sync on ÓÇ† sub [!] is üì¶ v0.1.0
‚ùØ git switch main
M       README.md
Switched to branch &#x27;main&#x27;

uv-run-sync on ÓÇ† main [!] is üì¶ v0.1.0
‚ùØ uv run python -c &quot;import ruff&quot;

uv-run-sync on ÓÇ† main [!] is üì¶ v0.1.0
‚ùØ uv sync
Resolved 1 package in 0.75ms
Uninstalled 1 package in 0.58ms
 - ruff==0.6.4
</code></pre>
<p><code>ruff</code> is uninstalled not during <code>uv run</code>, but when running <code>uv sync</code> afterwards.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 01:49</div>
            <div class="timeline-body"><p>I think the behavior you&#x27;re seeing is that <code>uv sync</code> does a &quot;strict&quot; sync (removes unnecessary packages), while <code>uv run</code> does an inexact syntax (does the minimal operations necessary, so leaves extraneous packages in place).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-16 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-25 21:47</div>
            <div class="timeline-body"><p>Hopefully my answer helped but let me know if you have any follow-up questions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-25 21:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:33:59 UTC
    </footer>
</body>
</html>
