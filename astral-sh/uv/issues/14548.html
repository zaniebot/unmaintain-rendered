<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empty files in uv_build wheel flagged by check-wheel-contents as being duplicates - astral-sh/uv #14548</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Empty files in uv_build wheel flagged by check-wheel-contents as being duplicates</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/14548">#14548</a>
        opened by <a href="https://github.com/caleb531">@caleb531</a>
        on 2025-07-10 19:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/caleb531">@caleb531</a> on 2025-07-10 19:50</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi,</p>
<p>Apologies, the title is somewhat of a mouthful. The issue is actually pretty simple (and yes, I've checked for existing issues).</p>
<h2>TL;DR</h2>
<p>Every empty file in a <code>uv_build</code>-built wheel is flagged as a duplicate by check-wheel-contents, even when they are at different paths (whereas setuptools generates a valid wheel).</p>
<h2>Long Answer</h2>
<p>I am the author of the https://github.com/caleb531/automata package, which I recently migrated to uv quite successfully. Now, I am trying to migrate my build-system from setuptools to uv_build. My project is a package containing multiple sub-packages, and each level has their own <code>__init__.py</code> file.</p>
<ol>
<li>When I build the wheel with setuptools, <a href="https://pypi.org/project/check-wheel-contents/">check-wheel-contents</a> reports the wheel as OK.</li>
<li>However, when I build with <code>uv_build</code>, check-wheel-contents flags every empty file as a duplicate, even if they are at different paths</li>
</ol>
<h2>Reproduction Steps</h2>
<ol>
<li>Run <code>git clone https://github.com/caleb531/automata &amp;&amp; cd automata</code></li>
<li>Run <code>git checkout 67fcf0b5f78b25b604611301176242caeaea5fec</code> (caleb531/automata@67fcf0b5f78b25b604611301176242caeaea5fec)</li>
<li>Run <code>uv build</code> to build the wheel via setuptools`</li>
<li>Run <code>uvx check-wheel-contents dist</code>; it will report the wheel as OK (i.e. valid)</li>
<li>Run <code>git checkout 96da40c68d1280ca83fee8cb5453ec6a94638d09</code> (caleb531/automata@96da40c68d1280ca83fee8cb5453ec6a94638d09)</li>
<li>Run <code>uv build</code> to build the wheel using uv_build</li>
<li>Run <code>uvx check-wheel-contents dist</code>; it will report <code>W002: Wheel contains duplicate files</code>:</li>
</ol>
<pre><code>dist/automata_lib-9.1.2-py3-none-any.whl: W002: Wheel contains duplicate files:
  automata/__init__.py
  automata/base/__init__.py
  automata/fa/__init__.py
  automata/pda/__init__.py
  automata/py.typed
  automata/regex/__init__.py
  automata/tm/__init__.py
</code></pre>
<p>At first, I thought this was a problem specifically with subpackage handling, but given that <code>py.typed</code> (also an empty file) is in this list, it seems like this might have to do with the way files are hashed irrespective of the path they are at. Because again, setuptools does not have this problem.</p>
<h2>build setup with setuptools (in pyproject.toml)</h2>
<pre><code class="language-toml">[build-system]
requires = [&quot;setuptools&gt;=77.0.3&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[tool.setuptools.packages.find]
where = [&quot;.&quot;]
include = [&quot;automata&quot;, &quot;automata.*&quot;]
# Explicitly exclude other top-level items
exclude = [&quot;docs&quot;, &quot;tests&quot;, &quot;joss&quot;, &quot;example_notebooks&quot;]
</code></pre>
<h2>new build setup with uv_build (in pyproject.toml)</h2>
<pre><code class="language-toml">[build-system]
requires = [&quot;uv_build&gt;=0.7.19,&lt;0.8.0&quot;]
build-backend = &quot;uv_build&quot;

[tool.uv.build-backend]
module-name = &quot;automata&quot;
module-root = &quot;&quot;
</code></pre>
<p>I hope the detail and reproduction steps are helpful, but please let me know if there's any other information I can provide, or if you need me to try anything.</p>
<p>Thanks,
Caleb</p>
<h3>Platform</h3>
<p>macOS 15.5, MacBook Air M4</p>
<h3>Version</h3>
<p>uv 0.7.20 (251420396 2025-07-09)</p>
<h3>Python version</h3>
<p>Python 3.12.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @caleb531 on 2025-07-10 19:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-10 19:56</div>
            <div class="timeline-body"><p>Interesting, thanks for the report!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @zanieb on 2025-07-10 22:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-17 12:05</div>
            <div class="timeline-body"><p>Is there a problem with the wheel from uv_build? Having multiple empty <code>__init__.py</code> is normal for Python projects, I'm not following why check-wheel-contents is raising an alarm about this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../dasch-swiss/dsp-tools/pulls/1886.html">dasch-swiss/dsp-tools#1886</a> on 2025-07-23 14:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @konstin by @konstin on 2025-08-08 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-08-08 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-08-08 14:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/caleb531">@caleb531</a> on 2025-09-26 20:53</div>
            <div class="timeline-body"><p>@konstin Apologies, just saw your comment. But good news!</p>
<p>I am no longer able to reproduce this issue in the latest version of uv_build (0.8.22). I can still reproduce it in the latest 0.7.x release (0.7.22).</p>
<p>I've run the following code against all versions between 0.7.22 and 0.8.22, and 0.8.13 is the first one where the issue is no longer reproducible. Looking through the release notes, it seems that #15400 has definitively fixed this issue. Apparently, #15398 also highlights the underlying issue.</p>
<p>I'll be upgrading all my projects to use this new version of uv_build, so I will be closing the issue now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @caleb531 on 2025-09-26 20:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:09 UTC
    </footer>
</body>
</html>
