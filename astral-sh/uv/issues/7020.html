<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order-dependent install failure - astral-sh/uv #7020</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Order-dependent install failure</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/7020">#7020</a>
        opened by <a href="https://github.com/wence-">@wence-</a>
        on 2024-09-04 13:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/wence-">@wence-</a> on 2024-09-04 13:59</div>
            <div class="timeline-body"><p>When trying to install <code>numpy</code> and <code>numba</code> in a venv with python 3.10, it is only possible to do so with <code>uv</code> if passing <code>numba</code> before <code>numpy</code> in the requirements list. In contrast, <code>pip</code> does not seem to mind, see transcript:</p>
<pre><code>$ python --version
Python 3.10.12
$ pip --version
pip 24.2 from /home/wence/Documents/venvs/py3.10/lib/python3.10/site-packages/pip (python 3.10)
$ uv --version
uv 0.4.4
$ pip install --use-pep517 numpy numba
Collecting numpy
  Downloading numpy-2.1.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (60 kB)
Collecting numba
  Downloading numba-0.60.0-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (2.7 kB)
Collecting llvmlite&lt;0.44,&gt;=0.43.0dev0 (from numba)
  Downloading llvmlite-0.43.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.8 kB)
Collecting numpy
  Downloading numpy-2.0.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (60 kB)
Downloading numba-0.60.0-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (3.7 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3.7/3.7 MB 26.4 MB/s eta 0:00:00
Downloading numpy-2.0.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (19.5 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19.5/19.5 MB 33.7 MB/s eta 0:00:00
Downloading llvmlite-0.43.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (43.9 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 43.9/43.9 MB 36.4 MB/s eta 0:00:00
Installing collected packages: numpy, llvmlite, numba
Successfully installed llvmlite-0.43.0 numba-0.60.0 numpy-2.0.2
$ uv pip uninstall numpy numba llvmlite
Uninstalled 3 packages in 85ms
 - llvmlite==0.43.0
 - numba==0.60.0
 - numpy==2.0.2
$ pip install --use-pep517 numba numpy
Collecting numba
  Using cached numba-0.60.0-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (2.7 kB)
Collecting numpy
  Using cached numpy-2.1.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (60 kB)
Collecting llvmlite&lt;0.44,&gt;=0.43.0dev0 (from numba)
  Using cached llvmlite-0.43.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.8 kB)
Collecting numpy
  Using cached numpy-2.0.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (60 kB)
Using cached numba-0.60.0-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (3.7 MB)
Using cached numpy-2.0.2-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (19.5 MB)
Using cached llvmlite-0.43.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (43.9 MB)
Installing collected packages: numpy, llvmlite, numba
Successfully installed llvmlite-0.43.0 numba-0.60.0 numpy-2.0.2
$ uv pip uninstall numpy numba llvmlite
Uninstalled 3 packages in 85ms
 - llvmlite==0.43.0
 - numba==0.60.0
 - numpy==2.0.2
$ uv pip install numba numpy
Resolved 3 packages in 84ms
Installed 3 packages in 26ms
 + llvmlite==0.43.0
 + numba==0.60.0
 + numpy==2.0.2
$ uv pip uninstall numba numpy llvmlite
Uninstalled 3 packages in 85ms
 - llvmlite==0.43.0
 - numba==0.60.0
 - numpy==2.0.2
$ uv pip install numpy numba
Resolved 4 packages in 22ms
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: numba==0.53.1
  Caused by: Build backend failed to determine extra requires with `build_wheel()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
  File &quot;/home/wence/.cache/uv/builds-v0/.tmplaOLv8/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 332, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=[])
  File &quot;/home/wence/.cache/uv/builds-v0/.tmplaOLv8/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 302, in _get_build_requires
    self.run_setup()
  File &quot;/home/wence/.cache/uv/builds-v0/.tmplaOLv8/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 503, in run_setup
    super().run_setup(setup_script=setup_script)
  File &quot;/home/wence/.cache/uv/builds-v0/.tmplaOLv8/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 318, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 50, in &lt;module&gt;
  File &quot;&lt;string&gt;&quot;, line 47, in _guard_py_ver
RuntimeError: Cannot install on Python version 3.10.12; only versions &gt;=3.6,&lt;3.10 are supported.
---
</code></pre>
<details>

<summary> <code>uv pip install numba numpy -vvv</code> output </summary>

<p><a href="https://github.com/user-attachments/files/16871696/numba-numpy.log">numba-numpy.log</a></p>
</details>

<details>

<summary> <code>uv pip install numpy numba -vvv</code> output </summary>

<p><a href="https://github.com/user-attachments/files/16871698/numpy-numba.log">numpy-numba.log</a></p>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pola-rs/polars/issues/18543.html">pola-rs/polars#18543</a> on 2024-09-04 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-04 14:05</div>
            <div class="timeline-body"><p>It's nuanced but this looks correct to me. If you pass <code>numba</code> first, we prioritize getting the latest version of <code>numba</code> (<code>0.60.0</code>) and then find a compatible version of NumPy (<code>2.0.2</code>). If you pass <code>numpy</code> first, we prioritize getting the last version of <code>numpy</code> (probably <code>2.1.1</code>), and then find a compatible version of Numba (presumedly <code>0.53.1</code>). However, that version of Numba has a runtime guard disallowing later versions of Python. There's no way for us to know that from the package metadata, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-04 14:43</div>
            <div class="timeline-body"><p>See also https://docs.astral.sh/uv/pip/compatibility/#package-priority</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2024-09-04 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wence-">@wence-</a> on 2024-09-04 15:26</div>
            <div class="timeline-body"><p>Ah, thanks.</p>
<blockquote>
<p>and then find a compatible version of Numba (presumedly 0.53.1)</p>
</blockquote>
<p>I think this is just where the backtracking through numba versions failed (there's no numba version that is compatible with numpy 2.1.1). I guess the issue is that numba 0.53.1 <a href="https://github.com/numba/numba/blob/release0.53/setup.py#L367">didn't advertise an upper-bound pin on numpy</a> so uv must assume that it would work.</p>
<p>If I restrict the backtracking to stop at 0.54, then I get the same install as if numba is specified first:</p>
<pre><code>$ uv pip install numpy 'numba&gt;=0.54'
Installed 3 packages in 23ms
 + llvmlite==0.43.0
 + numba==0.60.0
 + numpy==2.0.2
</code></pre>
<p>Happy to close, and we'll update our lower-bound pinning for numba.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pola-rs/polars/pulls/18555.html">pola-rs/polars#18555</a> on 2024-09-04 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-09-04 15:42</div>
            <div class="timeline-body"><p>Thanks! Eventually we may be able to explore better heuristics here but it's very challenging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-09-04 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10302.html">astral-sh/uv#10302</a> on 2025-01-10 06:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12126.html">astral-sh/uv#12126</a> on 2025-03-12 01:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../basf/MolPipeline/issues/190.html">basf/MolPipeline#190</a> on 2025-07-21 15:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:22 UTC
    </footer>
</body>
</html>
