<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv` fails to install `pyyaml==5.4.1` - astral-sh/uv #1455</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv</code> fails to install <code>pyyaml==5.4.1</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/1455">#1455</a>
        opened by <a href="https://github.com/sbrugman">@sbrugman</a>
        on 2024-02-16 08:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sbrugman">@sbrugman</a></div>
            <div class="timeline-body"><p><code>uv pip install &quot;pyyaml&lt;6&quot;</code></p>
<pre><code>Resolved 1 package in 0ms
error: Failed to download distributions
  Caused by: Failed to fetch wheel: pyyaml==5.4.1
  Caused by: Failed to build: pyyaml==5.4.1
  Caused by: Build backend failed to determine extra requires with `build_wheel()`:
--- stdout:
running egg_info
writing lib3/PyYAML.egg-info/PKG-INFO
writing dependency_links to lib3/PyYAML.egg-info/dependency_links.txt
writing top-level names to lib3/PyYAML.egg-info/top_level.txt
--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 10, in &lt;module&gt;
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 325, in get_requires_for_build_wheel
    return self._get_build_requires(config_settings, requirements=['wheel'])
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 295, in _get_build_requires
    self.run_setup()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
    exec(code, locals())
  File &quot;&lt;string&gt;&quot;, line 271, in &lt;module&gt;
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/__init__.py&quot;, line 103, in setup
    return distutils.core.setup(**attrs)
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/_distutils/core.py&quot;, line 185, in setup
    return run_commands(dist)
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/_distutils/core.py&quot;, line 201, in run_commands
    dist.run_commands()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/_distutils/dist.py&quot;, line 969, in run_commands
    self.run_command(cmd)
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/dist.py&quot;, line 963, in run_command
    super().run_command(command)
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/_distutils/dist.py&quot;, line 988, in run_command
    cmd_obj.run()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/command/egg_info.py&quot;, line 321, in run
    self.find_sources()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/command/egg_info.py&quot;, line 329, in find_sources
    mm.run()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/command/egg_info.py&quot;, line 550, in run
    self.add_defaults()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/command/egg_info.py&quot;, line 588, in add_defaults
    sdist.add_defaults(self)
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/command/sdist.py&quot;, line 102, in add_defaults
    super().add_defaults()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/_distutils/command/sdist.py&quot;, line 251, in add_defaults
    self._add_defaults_ext()
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/_distutils/command/sdist.py&quot;, line 336, in _add_defaults_ext
    self.filelist.extend(build_ext.get_source_files())
  File &quot;&lt;string&gt;&quot;, line 201, in get_source_files
  File &quot;/private/var/folders/ns/sj_tmscs2b10hq8jbzxvx54r0000gq/T/.tmpF4F30H/.venv/lib/python3.10/site-packages/setuptools/_distutils/cmd.py&quot;, line 107, in __getattr__
    raise AttributeError(attr)
AttributeError: cython_sources
---
</code></pre>
<hr />
<p><code>pip install &quot;pyyaml&lt;6&quot;</code></p>
<pre><code>Collecting pyyaml&lt;6
  Using cached PyYAML-5.4.1-cp310-cp310-macosx_12_0_arm64.whl
Installing collected packages: pyyaml
  Attempting uninstall: pyyaml
    Found existing installation: PyYAML 6.0
    Uninstalling PyYAML-6.0:
      Successfully uninstalled PyYAML-6.0
Successfully installed pyyaml-5.4.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2024-02-16 09:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-16 15:16</div>
            <div class="timeline-body"><p>I'm able to reproduce this, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @BurntSushi by @BurntSushi on 2024-02-16 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-21 14:39</div>
            <div class="timeline-body"><p>OK, so I took a deeper dive into this and I found what appears to be a pretty nasty rat's nest of build problems with PyYAML and Cython:</p>
<ul>
<li>https://github.com/yaml/pyyaml/issues/601</li>
<li>https://github.com/cython/cython/issues/4568</li>
<li>https://github.com/yaml/pyyaml/pull/731</li>
</ul>
<p>So then I wondered, but if <code>pip</code> works, why doesn't <code>uv</code>? So I tried <code>pip</code> and it actually fails for me:</p>
<pre><code>$ pip install &quot;pyyaml&lt;6&quot;
Collecting pyyaml&lt;6
  Downloading PyYAML-5.4.1.tar.gz (175 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 175.1/175.1 kB 4.8 MB/s eta 0:00:00
  Installing build dependencies ... done
  Getting requirements to build wheel ... error
  error: subprocess-exited-with-error

  × Getting requirements to build wheel did not run successfully.
  │ exit code: 1
  ╰─&gt; [54 lines of output]
      running egg_info
      writing lib3/PyYAML.egg-info/PKG-INFO
      writing dependency_links to lib3/PyYAML.egg-info/dependency_links.txt
      writing top-level names to lib3/PyYAML.egg-info/top_level.txt
      Traceback (most recent call last):
        File &quot;/home/andrew/astral/issues/uv/i1455/pip/.venv/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 353, in &lt;module&gt;
          main()
        File &quot;/home/andrew/astral/issues/uv/i1455/pip/.venv/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 335, in main
          json_out['return_val'] = hook(**hook_input['kwargs'])
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;/home/andrew/astral/issues/uv/i1455/pip/.venv/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py&quot;, line 118, in get_requires_for_build_wheel
          return hook(config_settings)
                 ^^^^^^^^^^^^^^^^^^^^^
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 325, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=['wheel'])
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 295, in _get_build_requires
          self.run_setup()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/build_meta.py&quot;, line 311, in run_setup
          exec(code, locals())
        File &quot;&lt;string&gt;&quot;, line 271, in &lt;module&gt;
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/__init__.py&quot;, line 103, in setup
          return distutils.core.setup(**attrs)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/_distutils/core.py&quot;, line 185, in setup
          return run_commands(dist)
                 ^^^^^^^^^^^^^^^^^^
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/_distutils/core.py&quot;, line 201, in run_commands
          dist.run_commands()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/_distutils/dist.py&quot;, line 969, in run_commands
          self.run_command(cmd)
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/dist.py&quot;, line 963, in run_command
          super().run_command(command)
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/_distutils/dist.py&quot;, line 988, in run_command
          cmd_obj.run()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py&quot;, line 321, in run
          self.find_sources()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py&quot;, line 329, in find_sources
          mm.run()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py&quot;, line 550, in run
          self.add_defaults()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py&quot;, line 588, in add_defaults
          sdist.add_defaults(self)
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/command/sdist.py&quot;, line 102, in add_defaults
          super().add_defaults()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/_distutils/command/sdist.py&quot;, line 251, in add_defaults
          self._add_defaults_ext()
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/_distutils/command/sdist.py&quot;, line 336, in _add_defaults_ext
          self.filelist.extend(build_ext.get_source_files())
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File &quot;&lt;string&gt;&quot;, line 201, in get_source_files
        File &quot;/tmp/pip-build-env-ter9lqc8/overlay/lib/python3.11/site-packages/setuptools/_distutils/cmd.py&quot;, line 107, in __getattr__
          raise AttributeError(attr)
      AttributeError: cython_sources
      [end of output]

  note: This error originates from a subprocess, and is likely not a problem with pip.
error: subprocess-exited-with-error
</code></pre>
<p>And in particular, this is precisely the same error that <code>uv pip install &quot;pyyaml&lt;6&quot;</code> fails with. So to me, this seems likely not a problem with <code>uv</code>, although it is still somewhat mysterious that your <code>pip install</code> command worked. But, because of the known build errors with PyYAML and Cython, it seems likely that this isn't an issue on our end. Of course, I'm sure we'd welcome a deeper analysis here!</p>
<p>Note that installing <code>pyyaml&gt;=6</code> works:</p>
<pre><code>$ uv pip install &quot;pyyaml&gt;=6&quot;
Resolved 1 package in 59ms
Downloaded 1 package in 47ms
Installed 1 package in 6ms
 + pyyaml==6.0.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-02-21 14:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/HernandoR">@HernandoR</a> on 2025-01-14 01:51</div>
            <div class="timeline-body"><p>is ther any workaround here, to install pyyaml with uv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 01:57</div>
            <div class="timeline-body"><p>This error is reproducible with <code>pip</code> — it's not a uv error. You'll need to report the failure to pyyaml.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/HernandoR">@HernandoR</a> on 2025-01-14 02:21</div>
            <div class="timeline-body"><p>based on <a href="https://github.com/yaml/pyyaml/issues/724">pyyaml#724</a>; current work around is <code>--no-build-isolation</code> with preinstalled cython&lt;3. Is it possible to address this method in <code>pyproject.toml</code>, such that uv can solve it?</p>
<p>my dependencies will solve to <code>pyyaml==5.4.1</code> so manally installing would not work for me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-14 03:18</div>
            <div class="timeline-body"><p>You can set <a href="https://docs.astral.sh/uv/reference/settings/#no-build-isolation-package"><code>no-build-isolation-package</code></a></p>
<pre><code class="language-toml">[project]
name = &quot;example&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;pyyaml&lt;6&quot;]

[tool.uv]
no-build-isolation-package = [&quot;pyyaml&quot;]

[dependency-groups]
pyyaml-build = [&quot;cython&lt;3&quot;, &quot;setuptools&quot;]
</code></pre>
<pre><code>❯ uv sync --only-group pyyaml-build
Resolved 4 packages in 5ms
Prepared 1 package in 263ms
Installed 2 packages in 11ms
 + cython==3.0.11
 + setuptools==75.8.0
❯ uv sync
Resolved 4 packages in 1ms
   Built pyyaml==5.4.1
Prepared 1 package in 812ms
Uninstalled 2 packages in 46ms
Installed 1 package in 1ms
 - cython==0.29.37
 + pyyaml==5.4.1
 - setuptools==75.8.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tux3">@tux3</a> on 2025-06-27 11:11</div>
            <div class="timeline-body"><p>For any future visitors, this happens when trying to run <code>uvx some_package</code> when some_package depends on pyyaml 5</p>
<p><code>uvx --with pyyaml==5.3.1 somepackage</code> is another way to workaround</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:23:30 UTC
    </footer>
</body>
</html>
