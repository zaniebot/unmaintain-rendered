<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support nightly PyTorch installs - astral-sh/uv #2541</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support nightly PyTorch installs</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2541">#2541</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-03-19 15:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/charliermarsh">@charliermarsh</a></div>
            <div class="timeline-body"><p>See: <a href="https://github.com/astral-sh/uv/issues/2008">astral-sh/uv#2008</a>.</p>
<p>Commands like <code>pip install -U --prerelease allow torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu121</code> currently fail, and it&#x27;s inconvenient to add the <code>+cu121</code> specifiers where necessary because the user is intentionally pulling in the &quot;latest&quot; release, and so doesn&#x27;t want to add a dedicated version specifier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-19 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">compatibility</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-19 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ewhauser">@ewhauser</a> on 2024-03-22 17:31</div>
            <div class="timeline-body"><p>Here&#x27;s a resolution issue I&#x27;m running into that <code>pip install</code> handles:</p>
<pre><code> whisperX @ https://github.com/m-bain/whisperX/archive/befe2b242eb59dcd7a8a122d127614d5c63d36e9.zip
 pyannote-audio @ git+https://github.com/pyannote/pyannote-audio@11b56a137a578db9335efc00298f6ec1932e6317
 torch @ https://download.pytorch.org/whl/cu118/torch-2.2.1%2Bcu118-cp311-cp311-linux_x86_64.whl#sha256=84328a35621cc6a67a182a327baaab67e5f5869981c4b1677ed05f92c15cceb1
 torchaudio @ https://download.pytorch.org/whl/cu118/torchaudio-2.2.1%2Bcu118-cp311-cp311-linux_x86_64.whl#sha256=cd3b1c3582b17792c6d7a367dea0459b123e54d7a4242809ea87ccc10fa220e5
 pytorch_triton @ https://download.pytorch.org/whl/nightly/pytorch_triton-2.1.0%2B7d1a95b046-cp311-cp311-linux_x86_64.whl
</code></pre>
<pre><code>&gt; ./uv pip install -r requirements.txt
  × No solution found when resolving dependencies:
  ╰─▶ Because only whisperx==3.1.1 is available and whisperx==3.1.1 depends on torchaudio&gt;=2, we can conclude that all versions of whisperx depend on torchaudio&gt;=2.
      And because only the following versions of torchaudio are available:
          torchaudio&lt;2
          torchaudio==2.2.1+cu118
      and torchaudio==2.2.1+cu118 depends on torch==2.2.1, we can conclude that all versions of whisperx depend on torch==2.2.1.
      And because there is no version of torch==2.2.1 and you require whisperx, we can conclude that the requirements are unsatisfiable.
</code></pre>
<p>I believe this is documented <a href="https://github.com/astral-sh/uv/blob/main/PIP_COMPATIBILITY.md#local-version-identifiers">here</a> but unclear if there is a way to override?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-22 17:57</div>
            <div class="timeline-body"><p>I think it&#x27;s possible we could support that specific case by extracting the name and version from the wheel filename (i.e., the URL). Can I ask why you prefer to use direct references for these?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ewhauser">@ewhauser</a> on 2024-03-22 19:55</div>
            <div class="timeline-body"><p>This is an existing requirements file so it is possible there is no good reason under <code>uv</code>. However, in order for this to work without direct references, you have to specify:</p>
<pre><code> --extra-index-url https://download.pytorch.org/whl/cu118
torch==2.2.1+cu118
torchaudio==2.2.1+cu118
</code></pre>
<p>which I assume has a performance hit for large requirements files? It does for <code>pip-tools</code>.</p>
<p>I did try that with <code>uv</code> and it started to choke on some of our dependencies that were valid:</p>
<pre><code> certifi==2024.2.2

 --extra-index-url https://download.pytorch.org/whl/cu118

 whisperX @ https://github.com/m-bain/whisperX/archive/befe2b242eb59dcd7a8a122d127614d5c63d36e9.zip
 pyannote-audio @ git+https://github.com/pyannote/pyannote-audio@11b56a137a578db9335efc00298f6ec1932e6317
 torch==2.2.1+cu118
 torchaudio==2.2.1+cu118
 pytorch_triton @ https://download.pytorch.org/whl/nightly/pytorch_triton-2.1.0%2B7d1a95b046-cp311-cp311-linux_x86_64.whl
</code></pre>
<pre><code>  × No solution found when resolving dependencies:
  ╰─▶ Because there is no version of certifi==2024.2.2 and you require certifi==2024.2.2, we can conclude that the requirements are unsatisfiable.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-22 20:03</div>
            <div class="timeline-body"><p>Ah yeah, that&#x27;s because certifi is published on https://download.pytorch.org/whl/cu118, but only at a different version. We don&#x27;t allow dependencies to pull &quot;mixed&quot; versions from across indexes as a security measure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-22 20:03</div>
            <div class="timeline-body"><p>Anyway, I think we can support this specific thing with the URLs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-22 20:24</div>
            <div class="timeline-body"><p>I created a new issue to track that here: <a href="https://github.com/astral-sh/uv/issues/2623">astral-sh/uv#2623</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fernandogrd">@fernandogrd</a> on 2024-09-06 16:15</div>
            <div class="timeline-body"><blockquote>
<p>Ah yeah, that&#x27;s because certifi is published on https://download.pytorch.org/whl/cu118, but only at a different version. We don&#x27;t allow dependencies to pull &quot;mixed&quot; versions from across indexes as a security measure.</p>
</blockquote>
<p>Hi, just experienced this today, specially the different versions of packages being available in the pytorch.</p>
<p>The <code>@</code> workaround worked, but wondering if there would be other workarounds by now as it is a bit tedious to copy the link of each package specially when there a number of them.</p>
<p>Edit.: Nvm, just found about UV_INDEX_STRATEGY in the docs. I wish pytorch would not keep the copied versions available on pypi though..</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 00:38</div>
            <div class="timeline-body"><p>This works now!</p>
<pre><code>uv pip install -U --prerelease allow torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu121
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-20 00:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:30:32 UTC
    </footer>
</body>
</html>
