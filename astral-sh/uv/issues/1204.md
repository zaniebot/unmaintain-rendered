```yaml
number: 1204
title: Optimize cold start with refresh by prefetching revalidation requests
type: issue
state: closed
author: konstin
labels:
  - performance
assignees: []
created_at: 2024-01-31T12:16:53Z
updated_at: 2025-01-14T18:58:37Z
url: https://github.com/astral-sh/uv/issues/1204
synced_at: 2026-01-10T01:57:01Z
```

# Optimize cold start with refresh by prefetching revalidation requests

---

_Issue opened by @konstin on 2024-01-31 12:16_

If the last request was >10min or when using `--refresh` or , we observe a slow start pattern: We make revalidation requests for direct dependencies first, and only when those succeed, we start scheduling more requests in parallel. Instead, we should assume that the transitive dependency remain the same and already start prefetching revalidation requests for them in the background.

Example below: Resolving `jupyter`

```shell
RUST_LOG=puffin=info TRACING_DURATIONS_FILE=target/traces/jupyter-refresh.ndjson cargo run --features tracing-durations-export --bin puffin --profile profiling -- pip compile --refresh scripts/requirements/jupyter.in
```

![image](https://github.com/astral-sh/puffin/assets/6826232/f14eef37-5534-4164-ab35-7f69a912f736)

See also https://github.com/astral-sh/puffin/issues/1206 for the case with a lockfile.


---

_Label `performance` added by @konstin on 2024-01-31 12:16_

---

_Comment by @charliermarsh on 2024-01-31 15:24_

Agree. We actually might want to do this prefetching _always_ when we have an existing requirements.txt?

---

_Comment by @charliermarsh on 2024-01-31 15:35_

(Do you want to benchmark it?)

---

_Referenced in [astral-sh/uv#1206](../../astral-sh/uv/issues/1206.md) on 2024-01-31 15:48_

---

_Comment by @konstin on 2024-01-31 15:49_

Good idea! Opened a separate issue since the prefetching will be in a different place: https://github.com/astral-sh/puffin/issues/1206

> (Do you want to benchmark it?)

I want to finish windows testing first.

---

_Comment by @charliermarsh on 2024-01-31 15:51_

> I want to finish windows testing first.

Good prioritization.


---

_Comment by @konstin on 2025-01-14 18:58_

Closing this since i can't reproduce the speedup anymore.

---

_Closed by @konstin on 2025-01-14 18:58_

---
