<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Init project without src - astral-sh/uv #6293</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Init project without src</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6293">#6293</a>
        opened by <a href="https://github.com/santigandolfo">@santigandolfo</a>
        on 2024-08-21 02:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/santigandolfo">@santigandolfo</a> on 2024-08-21 02:02</div>
            <div class="timeline-body"><p>Hi, is there a way to init a uv project without a <code>src</code> directory and <code>[build-system]</code> in the <code>pyproject.toml</code>?</p>
<p>I currently use rye and to do that I create my project with:</p>
<pre><code class="language-bash">rye init --virtual
</code></pre>
<p>But <code>uv</code> looks to work differently. When I run:</p>
<pre><code class="language-bash">uv init --virtual
</code></pre>
<ol>
<li>It doesn't generate the <code>[project]</code> section in the <code>pyproject.toml</code></li>
<li>I'm forced to keep the <code>[tool.uv.workspace]</code> in the pyproject.toml (or else I get the error <code>error: No ``project`` table found in: ``/Users/&lt;my_user&gt;/&lt;my_project&gt;/pyproject.toml`` </code> when I run <code>uv sync</code>)</li>
<li>I'm not allowed to add dependencies like this:</li>
</ol>
<pre><code class="language-bash">uv add pydantic
</code></pre>
<p>I must do it like this:</p>
<pre><code class="language-bash">uv add --dev pydantic
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 02:05</div>
            <div class="timeline-body"><p>You can definitely remove the <code>src</code> directory if you don't want to use a <code>src</code> layout, but we do need a build system if you want to use a &quot;real&quot; project. Alternatively, if you want to use a virtual layout, it has to <em>not</em> be a real project (i.e., you can't have a <code>[project]</code> section). It doesn't really make sense to have a <code>[project]</code> section for something that isn't a project.</p>
<p>What are you looking to achieve? Why do you want a virtual layout?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-08-21 02:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/santigandolfo">@santigandolfo</a> on 2024-08-21 02:15</div>
            <div class="timeline-body"><p>My problem is that the alternative <code>uv init</code> also has some things that don't work well for me, because it adds the <code>src</code> directory and a <code>[build-system]</code> section.
And if I only delete the <code>src</code>  directory, when I run <code>uv add pydantic</code>I get this error:</p>
<pre><code class="language-console">santiago@192 test_uv % uv add pydantic
Using Python 3.12.4 interpreter at: /opt/homebrew/opt/python@3.12/bin/python3.12
Creating virtualenv at: .venv
Resolved 5 packages in 18ms
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: test-uv @ file:///Users/santiago/Desktop/test_uv
  Caused by: Build backend failed to build wheel through `build_editable()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/build.py&quot;, line 83, in build_editable
    return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/plugin/interface.py&quot;, line 155, in build
    artifact = version_api[version](directory, **build_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 494, in build_editable
    return self.build_editable_detection(directory, **build_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 505, in build_editable_detection
    for included_file in self.recurse_selected_project_files():
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/plugin/interface.py&quot;, line 180, in recurse_selected_project_files
    if self.config.only_include:
       ^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/config.py&quot;, line 806, in only_include
    only_include = only_include_config.get('only-include', self.default_only_include()) or self.packages
                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 260, in default_only_include
    return self.default_file_selection_options.only_include
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/opt/homebrew/Cellar/python@3.12/3.12.4/Frameworks/Python.framework/Versions/3.12/lib/python3.12/functools.py&quot;, line 995, in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 248, in default_file_selection_options
    raise ValueError(message)
ValueError: Unable to determine which files to ship inside the wheel using the following heuristics: https://hatch.pypa.io/latest/plugins/builder/wheel/#default-file-selection

The most likely cause of this is that there is no directory that matches the name of your project (test_uv).

At least one file selection option must be defined in the `tool.hatch.build.targets.wheel` table, see: https://hatch.pypa.io/latest/config/build/

As an example, if you intend to ship a directory named `foo` that resides within a `src` directory located at the root of your project, you can define the following:

[tool.hatch.build.targets.wheel]
packages = [&quot;src/foo&quot;]
---
</code></pre>
<p>And if I delete both I don't get that error, but the directory <code>test_uv.egg-info</code> is created.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-21 02:20</div>
            <div class="timeline-body"><p>How do you plan to structure your projects though? I'm just trying to understand your desired project layout and workflow. If you just want the build to work, you can add this to your <code>pyproject.toml</code> (even if you don't plan to create a <code>test_uv</code> directory):</p>
<pre><code class="language-toml">[tool.hatch.build.targets.wheel]
packages = [&quot;test_uv&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/santigandolfo">@santigandolfo</a> on 2024-08-21 02:28</div>
            <div class="timeline-body"><p>In my case the root folder would be called test_uv, and the structure inside of it would look like this for example:</p>
<p>.venv
main.py
pyproject.toml
README.md
uv.lock</p>
<p>In a larger case I would maybe have all my python files structured inside an app folder, for example on a FastAPI microservice, where I would also dockerize the proyect. I don't want to create a package or wheel</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukewiwa">@lukewiwa</a> on 2024-08-21 02:31</div>
            <div class="timeline-body"><blockquote>
<p>In my case the root folder would be called test_uv, and the structure inside of it would look like this for example:</p>
<p>.venv main.py pyproject.toml README.md uv.lock</p>
<p>In a larger case I would maybe have all my python files structured inside an app folder, for example on a FastAPI microservice, where I would also dockerize the proyect. I don't want to create a package or wheel</p>
</blockquote>
<p>@santigandolfo  In this specific case I believe a work around at the moment is to set this in your <code>pyproject.toml</code> file</p>
<pre><code class="language-toml">[tool.hatch.build.targets.wheel]
packages = [&quot;.&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndreuCodina">@AndreuCodina</a> on 2024-08-21 21:40</div>
            <div class="timeline-body"><p>In my case, I have a <code>src</code> folder, but not a folder inside (i.e. <code>my-fastapi-app/my-fastapi-app/src</code>):</p>
<pre><code>my-fastapi-app/
    src/
        main.py
    pyproject.toml
    uv.lock
    .venv/
</code></pre>
<p>And, for example, when I execute <code>uv run ruff check</code>, I get this error:</p>
<pre><code>error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: my-fastapi-app @ file:///workspaces/my-fastapi-app
  Caused by: Build backend failed to build wheel through `build_editable()` with exit status: 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jbevi">@jbevi</a> on 2024-08-22 19:29</div>
            <div class="timeline-body"><blockquote>
<p>My problem is that the alternative <code>uv init</code> also has some things that don't work well for me, because it adds the <code>src</code> directory and a <code>[build-system]</code> section. And if I only delete the <code>src</code> directory, when I run <code>uv add pydantic</code>I get this error:</p>
<pre><code>santiago@192 test_uv % uv add pydantic
Using Python 3.12.4 interpreter at: /opt/homebrew/opt/python@3.12/bin/python3.12
Creating virtualenv at: .venv
Resolved 5 packages in 18ms
error: Failed to prepare distributions
  Caused by: Failed to fetch wheel: test-uv @ file:///Users/santiago/Desktop/test_uv
  Caused by: Build backend failed to build wheel through `build_editable()` with exit status: 1
--- stdout:

--- stderr:
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 11, in &lt;module&gt;
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/build.py&quot;, line 83, in build_editable
    return os.path.basename(next(builder.build(directory=wheel_directory, versions=['editable'])))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/plugin/interface.py&quot;, line 155, in build
    artifact = version_api[version](directory, **build_data)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 494, in build_editable
    return self.build_editable_detection(directory, **build_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 505, in build_editable_detection
    for included_file in self.recurse_selected_project_files():
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/plugin/interface.py&quot;, line 180, in recurse_selected_project_files
    if self.config.only_include:
       ^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/config.py&quot;, line 806, in only_include
    only_include = only_include_config.get('only-include', self.default_only_include()) or self.packages
                                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 260, in default_only_include
    return self.default_file_selection_options.only_include
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/opt/homebrew/Cellar/python@3.12/3.12.4/Frameworks/Python.framework/Versions/3.12/lib/python3.12/functools.py&quot;, line 995, in __get__
    val = self.func(instance)
          ^^^^^^^^^^^^^^^^^^^
  File &quot;/Users/santiago/Library/Caches/uv/builds-v0/.tmp0RSYov/lib/python3.12/site-packages/hatchling/builders/wheel.py&quot;, line 248, in default_file_selection_options
    raise ValueError(message)
ValueError: Unable to determine which files to ship inside the wheel using the following heuristics: https://hatch.pypa.io/latest/plugins/builder/wheel/#default-file-selection

The most likely cause of this is that there is no directory that matches the name of your project (test_uv).

At least one file selection option must be defined in the `tool.hatch.build.targets.wheel` table, see: https://hatch.pypa.io/latest/config/build/

As an example, if you intend to ship a directory named `foo` that resides within a `src` directory located at the root of your project, you can define the following:

[tool.hatch.build.targets.wheel]
packages = [&quot;src/foo&quot;]
---
</code></pre>
<p>And if I delete both I don't get that error, but the directory <code>test_uv.egg-info</code> is created.</p>
</blockquote>
<p>The same thing happens to me.
A few days ago I heard about UV thanks to a post by Tiangolo on X. I'm testing it to see if we migrate from pipenv to uv.
It seems that if /src does not exist, the installation of libraries fails.
In my company, projects do not have a /src, but a /app.
It doesn't seem like a correct solution to have to edit pyproject.toml by hand.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 20:33</div>
            <div class="timeline-body"><p>You shouldn't need a <code>src</code> directory to use uv -- can you provide an example? E.g., this works without any <code>pyproject.toml</code> changes (it uses an <code>./app</code> directory): https://github.com/astral-sh/uv-fastapi-example</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndreuCodina">@AndreuCodina</a> on 2024-08-23 14:47</div>
            <div class="timeline-body"><blockquote>
<p>You shouldn't need a <code>src</code> directory to use uv -- can you provide an example? E.g., this works without any <code>pyproject.toml</code> changes (it uses an <code>./app</code> directory): https://github.com/astral-sh/uv-fastapi-example</p>
</blockquote>
<p>That repository works with</p>
<pre><code class="language-bash">uv run fastapi dev app/main.py
</code></pre>
<p>but there's a trick: in the <code>pyproject.toml</code> root you have this:</p>
<pre><code class="language-toml">[project]
name = &quot;app&quot;
</code></pre>
<p>so you're specifying you need a subfolder named <code>app</code>. Why do I need that? The project name should be <code>uv-fastapi-example</code>, and <code>app</code> would have no pyproject.toml or a pyproject.toml with <code>name = &quot;app&quot;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jbevi">@jbevi</a> on 2024-08-23 15:35</div>
            <div class="timeline-body"><p>Thanks for your answers. I'll tell you a little more, clarifying that I'm new to UV.
We currently have projects already managed with pipenv. The Pipfile and Pipfile.lock files are maintained by the pipenv tool, we do not edit them by hand.
I try to operate in the same way, that when running the tool the files are generated correctly (pyproject.toml and uv.lock).
In order to migrate from pipenv to uv, as far as I know, I must first initialize the project by running <strong>uv init</strong> in the existing project folder. At that moment the /src folder is created and becomes essential for uv to work. The proposed solution requires modifying pyproject.toml by hand, which I don't like very much, I would prefer that the command line execution of uv already provides the option of, for example, initializing with another directory or none at all. This would help run the migration from pipenv automatically on many projects with a script, which I understand is not currently possible due to the need to modify pyproject.toml (although my script could modify pyproject.toml and remove /src but it requires a script smarter and will require further validation).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 15:39</div>
            <div class="timeline-body"><p>Aside, this would be resolved by https://github.com/astral-sh/uv/issues/6511.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-23 15:45</div>
            <div class="timeline-body"><p>@AndreuCodina -- To clarify, this works (<code>uv run fastapi dev src/uv_fastapi_example/app/main.py</code>):</p>
<p><img src="https://github.com/user-attachments/assets/15796a78-65a7-4dbc-9c64-f723b8bb4453" alt="Screenshot 2024-08-23 at 11 42 23 AM" /></p>
<p>As does this (<code>uv run fastapi dev uv_fastapi_example/app/main.py</code>):</p>
<p><img src="https://github.com/user-attachments/assets/8f757e35-a354-4fa9-bdc0-a03a0cf7ecb2" alt="Screenshot 2024-08-23 at 11 43 47 AM" /></p>
<p>Either of these are totally fine. You can also remove the <code>app</code> subdirectory if you want. I only included it there because your example from Discord wanted multiple top-level directories.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndreuCodina">@AndreuCodina</a> on 2024-08-23 17:15</div>
            <div class="timeline-body"><p>I see, but there's something I don't understand. I'll show a case to be more graphical.</p>
<p>I want to create a repository called facedetector, with the next workspaces: <code>api</code>, <code>domain</code>, <code>infrastructure</code> and <code>common</code>.</p>
<p>I'm very flexible in how to do it.</p>
<p>If I execute <code>uv init facedetector</code> to create a new repository, a folder <code>facedetector</code> with a <code>src</code> folder is created, so I imagine I have to create the <code>api</code>, <code>domain</code>, <code>infrastructure</code> and <code>common</code> workspaces under <code>src</code>. Okay, but if I execute <code>uv init api</code> under <code>src</code>, the <code>api</code> workspace has a <code>src</code> under it too, so I'm confused (we have 2 <code>src</code> folders with different meaning).</p>
<img width="208" alt="image" src="https://github.com/user-attachments/assets/558a74a9-f40f-4d31-84a7-c945e3503f2d">

<p>But if I execute <code>uv init api</code> in the facedetector folder then I'm more confused.</p>
<img width="216" alt="image" src="https://github.com/user-attachments/assets/827d76e7-1c02-4c6c-a8a2-afe30e2d9b78">

<p>Is <code>src</code> the entry point of the repository and I don't have to have an <code>api</code> workspace?
Please, can you clarify for me what's the architecture you're proposing?</p>
<p>In .NET I always have this structure:</p>
<pre><code>src/
    api/
        main.py
    domain/
    infrastructure/
    common/
tests/
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbd">@kbd</a> on 2024-08-25 14:17</div>
            <div class="timeline-body"><blockquote>
<p>How do you plan to structure your projects though? I'm just trying to understand your desired project layout and workflow.</p>
</blockquote>
<p>I think it's a valid and common layout to have your top-level module be a top-level directory in your project. To pick one example, this is how <a href="https://github.com/django/django/">Django</a> is structured. I would expect <code>uv init</code> to create a structure like this:</p>
<pre><code>$ uv init hello
$ tree hello
hello
├── pyproject.toml
└── hello
    └── __init__.py
</code></pre>
<p>This is the more natural layout, as when you launch the Python repl at the root of the project it can import your module. Imo, additions to the above basic layout should be behind flags. <code>--add-src</code>, <code>--add-readme</code>, etc.</p>
<hr />
<p>FWIW, I generally make <code>create-X</code> scripts for every language. Here's my <a href="https://github.com/kbd/setup/blob/main/HOME/bin/create-python">create-python script</a>, which also initializes a fresh git repo with appropriate git ignores, sets up a tests dir, installs basic modules I'll always want (eg. pytest), sets up direnv to automatically activate my venv, etc.</p>
<pre><code>$ create-python hello
...
$ tree hello
hello
├── README.md
├── bin
├── hello
│   └── __init__.py
├── justfile
├── main
├── poetry.lock
├── poetry.toml
├── pyproject.toml
├── pytest.ini
└── tests
    └── __init__.py
</code></pre>
<p>I currently use Poetry to manage my Python projects (though I now use <code>uv</code> to manage my <em>user-level</em> <code>.venv</code>). I initialize my projects with (the equivalent of):</p>
<pre><code>poetry init --no-interaction --name=hello --author=&quot;$(git config --get user.name)&quot;
</code></pre>
<p>That doesn't presume any layout and conveniently lets me specify the author metadata during creation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-26 14:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-28 18:11</div>
            <div class="timeline-body"><p>This exists now as of <a href="https://github.com/astral-sh/uv/releases/tag/0.4.0">v0.4.0</a>. You can run <code>uv init --app</code> to avoid creating a <code>src</code> layout. See: https://docs.astral.sh/uv/concepts/projects/#applications.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-28 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lawouach">@Lawouach</a> on 2025-09-24 08:48</div>
            <div class="timeline-body"><p>Hi @charliermarsh, do you think there was a regression on using <code>--app</code> to not generate the src directory?</p>
<p>Whenever I'm using it, the <code>src</code> folder still gets created. The doc doesn't advertize the behavior either way https://docs.astral.sh/uv/reference/cli/#uv-init--app</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:33 UTC
    </footer>
</body>
</html>
