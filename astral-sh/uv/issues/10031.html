<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`index-strategy`: `first-match` or `first-index`? - astral-sh/uv #10031</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`index-strategy`: `first-match` or `first-index`?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10031">#10031</a>
        opened by <a href="https://github.com/yaochie">@yaochie</a>
        on 2024-12-19 14:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/yaochie">@yaochie</a> on 2024-12-19 14:39</div>
            <div class="timeline-body"><p>Not sure if this is a documentation issue or a bug.</p>
<p>The documentation shows both <code>first-match</code> and <code>first-index</code> as possible options for <code>index-strategy</code>:</p>
<ul>
<li>https://docs.astral.sh/uv/reference/settings/#index-strategy (in the paragraph, the option is written as <code>first-match</code>, but the possible values below that only contain <code>first-index</code>)</li>
<li>https://docs.astral.sh/uv/configuration/indexes/#searching-across-multiple-indexes (only mentions <code>first-match</code>)</li>
</ul>
<p><code>--help</code> also only shows <code>first-index</code> as a possible value:</p>
<pre><code class="language-bash">$ uv add --help    #also for uv pip install --help
...
Index options:
...
      --no-index
          Ignore the registry index (e.g., PyPI), instead relying on direct URL dependencies and
          those provided via `--find-links`
      --index-strategy &lt;INDEX_STRATEGY&gt;
          The strategy to use when resolving against multiple index URLs [env: UV_INDEX_STRATEGY=]
          [possible values: first-index, unsafe-first-match, unsafe-best-match]
      --keyring-provider &lt;KEYRING_PROVIDER&gt;
          Attempt to use `keyring` for authentication for index URLs [env: UV_KEYRING_PROVIDER=]
          [possible values: disabled, subprocess]
</code></pre>
<p>I tried to set the index strategy using (uv 0.5.10):</p>
<ul>
<li><code>--index-strategy</code></li>
<li><code>UV_INDEX_STRATEGY</code></li>
<li><code>pyproject.toml</code></li>
</ul>
<p>Both <code>first-index</code> and <code>first-match</code> work when set using <code>--index-strategy</code> or <code>UV_INDEX_STRATEGY</code>, but only <code>first-index</code> works in <code>pyproject.toml</code>, not sure if this is intended:</p>
<pre><code>warning: Failed to parse `pyproject.toml` during settings discovery:
  TOML parse error at line 10, column 18
     |
  10 | index-strategy = &quot;first-match&quot;
     |                  ^^^^^^^^^^^^^
  unknown variant `first-match`, expected one of `first-index`, `unsafe-any-match`, `unsafe-first-match`, `unsafe-best-match`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2024-12-19 15:38</div>
            <div class="timeline-body"><p>I'm not familiar with Rust, but it seems that &quot;first-match&quot; only appears in this part of the code, excluding the comments.
https://github.com/astral-sh/uv/blob/ac348eecdfca2af2ec3cab0056faf7991c1f8ae8/crates/uv-configuration/src/build_options.rs#L318-L325
So, I believe there is a mistake in the document.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-19 17:16</div>
            <div class="timeline-body"><p>Thanks, I believe this was renamed and we must've missed a few places.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-12-19 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2024-12-19 17:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-12-19 17:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10036.html">astral-sh/uv#10036</a> on 2024-12-19 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-19 17:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:53 UTC
    </footer>
</body>
</html>
