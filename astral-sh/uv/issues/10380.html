<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uvx offline fallback mode? - astral-sh/uv #10380</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uvx offline fallback mode?</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/10380">#10380</a>
        opened by <a href="https://github.com/alexjbuck">@alexjbuck</a>
        on 2025-01-07 23:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alexjbuck">@alexjbuck</a> on 2025-01-07 23:35</div>
            <div class="timeline-body"><p>I do a lot of work in offline environments with an alternate package index. That index goes down sometimes (much more often than the public pypi repo would).</p>
<p>A lot of routine uv/uvx tasks will check against network locations before running unless the <code>--offline</code> flag is passed. When the index goes offline I can continue working with the <code>--offline</code> flag and <code>uv/uvx</code> will use its local cache. This is great!</p>
<p>The issue is when I start having scripts or other tooling that invoke <code>uvx</code>. When the index is up, I don't want to run in <code>--offline</code> mode, because I want <code>uvx</code> to work normally. So I can write those scripts to not use <code>--offline</code>. However, when the index goes down, now I need to be running in <code>--offline</code> mode because a network failure doesn't automatically fallback to the local cache. That means I have to go edit all the callsites to use <code>uvx --offline</code>  for that time period.</p>
<p>Example:</p>
<p><code>uvx ruff check</code> fails when the package repo goes down and must be changed to <code>uvx --offline ruff check</code> to use the locally cached version of ruff. You have to have already run <code>uvx ruff ...</code> at least once with access to a package index to get it loaded into the cache for this to work but that's not something <code>uv</code> can fix ðŸ˜†.</p>
<p>There are plenty of workarounds (such as maintaining a parallel set of scripts or accepting an &quot;--offline&quot; flag into the scripts) but this does seem like it could be behavior that <code>uv/uvx</code> could subsume.</p>
<p>I think this comes down to the fact that there's only two modes right now:</p>
<ul>
<li><strong>Online</strong>: Default, <code>uvx</code> always tries to reach out to the package registry. e.g. <code>uv ruff format</code></li>
<li><strong>Offline</strong>: <code>--offline</code> passed, <code>uvx</code> will never reach out to the package registry. e.g. <code>uv --offline ruff format</code></li>
</ul>
<p>I'm finding in my circumstances it would be great to have a third mode:</p>
<ul>
<li><strong>Online with Fallback</strong>: Act like the default however, if a network request fails, fall back to <code>--offline</code> type behavior for that dependency and check if it exists in the local cache. If it doesn't, then fail just like how <code>uvx --offline &lt;package not in cache&gt;</code> would fail. e.g. <code>uv --offline-fallback ruff format</code>.</li>
</ul>
<p>While my circumstances are probably fairly niche, the general idea is to let <code>uvx</code> have a &quot;best effort&quot; in case it can't reach the package index and not just fail when there's a valid local cached version.</p>
<p>I'm not sure if there are any pitfalls you could end up in with what could be a mixed online/offline dependency resolution. You can think of some weird cases where a specific dependency has a <code>git</code> source defined and that's accessible but transitive dependencies aren't online  because the package index is offline so they fallback to previously local cached versions. My first though is so long as the versions can be resolved satisfactorily it wouldn't be any different.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uvx partial offline mode" to "uvx offline fallback mode" by @alexjbuck on 2025-01-07 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uvx offline fallback mode" to "uvx offline fallback mode?" by @alexjbuck on 2025-01-07 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-08 00:09</div>
            <div class="timeline-body"><p>This seems reasonable to me. I think the problem might be that we can't respect the registry's cache options? I'm not sure though, @charliermarsh would know better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @zanieb on 2025-01-08 00:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cache</span> added by @zanieb on 2025-01-08 00:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10444.html">astral-sh/uv#10444</a> on 2025-01-09 21:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ksamuel">@ksamuel</a> on 2025-02-20 00:26</div>
            <div class="timeline-body"><p>Doesn't <code>UV_OFFLINE</code> help with this use case ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13316.html">astral-sh/uv#13316</a> on 2025-05-06 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/taranlu-houzz">@taranlu-houzz</a> on 2025-05-30 23:56</div>
            <div class="timeline-body"><p>@zanieb This would be really helpful for my workflow as well. I have a service that uses <code>uv</code> in a subprocess in order to allow running different versions of an internal package that is pulled from an internal pypi server. When the pypi server is inaccessible (not a frequent occurrence, but it has happened a couple of times now), it causes jobs that call the service to fail because <code>uv</code> must make a successful connection. Having a fallback would be extremely handy.</p>
<p>On a related note: when looking into this further, I also noticed some oddities with the way the <code>--offline</code> flag and cached packages seem to work, so I create another issue here: https://github.com/astral-sh/uv/issues/13747</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14754.html">astral-sh/uv#14754</a> on 2025-07-20 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ajfriend">@ajfriend</a> on 2025-07-21 03:34</div>
            <div class="timeline-body"><p>+1. An &quot;online, but best effort when offline&quot; option would also be helpful to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15454.html">astral-sh/uv#15454</a> on 2025-08-22 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-08-25 11:11</div>
            <div class="timeline-body"><p>I could see a <code>--never-refresh</code> [^1] option that skips over doing HTTP if there's something in the cache. A trickier but even more effective implementation would prioritize versions in the resolver that are cached, falling back to uncached versions.</p>
<p>[^1]: <code>--no-refresh</code> would give the default behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15899.html">astral-sh/uv#15899</a> on 2025-09-16 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16108.html">astral-sh/uv#16108</a> on 2025-10-02 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/J3ronimo">@J3ronimo</a> on 2025-12-11 13:43</div>
            <div class="timeline-body"><p>+1</p>
<p>Together with #16108 , in short we'd need &quot;prefer cache&quot; and &quot;prefer latest&quot; modes added, while currently we only have &quot;strict cache&quot; (--offline) and &quot;strict latest&quot; (default, fails if offline).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
