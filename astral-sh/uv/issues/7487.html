<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dev-dependencies in workspace pyproject.toml not installed with `uv run` - astral-sh/uv #7487</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>dev-dependencies in workspace pyproject.toml not installed with <code>uv run</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7487">#7487</a>
        opened by <a href="https://github.com/KilianMichiels">@KilianMichiels</a>
        on 2024-09-18 08:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/KilianMichiels">@KilianMichiels</a></div>
            <div class="timeline-body">

<p>We have a mono repository with a couple of packages and services. I wanted to unify the dev-dependencies for all packages (each of them have their own pyproject.toml file) since they are largely the same dependencies.</p>
<p>I noticed when moving the <code>dev-dependencies</code> from the package pyproject.toml files to the workspace one in the root folder, that these dependencies are no longer installed when I run <code>uv run</code> in a package folder (e.g., to run a test script with pytest).</p>
<p>Is this behaviour expected? I assumed dependency resolution would take into account all <code>dev-dependencies</code> in all pyproject.toml files inside the workspace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-18 14:23</div>
            <div class="timeline-body"><p>To confirm my understanding: you want to define the <code>dev-dependencies</code> in a root <code>pyproject.toml</code>, and then have them available when running commands like <code>uv run --package some-member</code> -- is that right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-09-18 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KilianMichiels">@KilianMichiels</a> on 2024-09-18 14:44</div>
            <div class="timeline-body"><p>Hi @charliermarsh, that is correct! Since I&#x27;m working in a workspace where things like pytest, coverage, ruff, etc. are all shared, it seemed like the logical thing to do.</p>
<p>I added an example below to explain my use case a bit further:</p>
<p>Directory structure:</p>
<pre><code>&lt;root&gt;
  -- pyproject.toml
  -- scripts
  -- other_stuff
  -- my-package
      -- pyproject.toml
      -- my-package
      -- tests
</code></pre>
<p>In my root directory, I have this <code>pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;my-project&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.10,&lt;3.13&quot;
description = &quot;My simple project&quot;

[tool.uv]
# NOTE: These dependencies are not picked up when running
#       in a package folder. Therefore I kept them in the
#       pyproject.toml of each package for now.
dev-dependencies = [
    &quot;bandit&gt;=1.7.9&quot;,
    &quot;pytest-cov&gt;=5.0.0&quot;,
    &quot;pytest-env&gt;=1.1.3&quot;,
    &quot;pytest-xdist&gt;=3.6.1&quot;,
    &quot;pytest&gt;=8.3.2&quot;,
    &quot;ruff&gt;=0.6.5&quot;,
]

[tool.uv.sources]
my-package = { workspace = true }

[tool.uv.workspace]
members = [
    &quot;my-package&quot;,
]
</code></pre>
<p>Then in my package folder I have this <code>pyproject.toml</code>:</p>
<pre><code>[project]
name = &quot;my-package&quot;
version = &quot;0.1.0&quot;
requires-python = &quot;&gt;=3.10,&lt;3.13&quot;
description = &quot;My simple package&quot;

[tool.uv]
# I would expect these to not be needed anymore as they are defined in the dev-dependencies of the workspace.
dev-dependencies = [
    &quot;bandit&gt;=1.7.9&quot;,
    &quot;pytest-cov&gt;=5.0.0&quot;,
    &quot;pytest-env&gt;=1.1.3&quot;,
    &quot;pytest-xdist&gt;=3.6.1&quot;,
    &quot;pytest&gt;=8.3.2&quot;,
    &quot;ruff&gt;=0.6.5&quot;,
]
</code></pre>
<p>Then I&#x27;d like to be able to do for example:</p>
<pre><code>cd my-package
uv run ruff check my-package/
</code></pre>
<p>And this gives me the error (on a cold run, so no <code>uv sync</code> was run yet, inside a Docker Gitlab CI) if I comment out the <code>dev-dependencies</code> in the package <code>pyproject.toml</code> and only have the ones in the root file:</p>
<pre><code>&gt; error: Failed to spawn: `ruff`
  &gt;   Caused by: No such file or directory (os error 2)
</code></pre>
<hr>
<p>Additionally, it might be nice to be able to add common dependencies to the root workspace <code>pyproject.toml</code> and add more specific ones to the package <code>pyproject.toml</code>.</p>
<p><strong>Edit:</strong> Added <code>my-package = { workspace = true }</code> and <code>members</code> to the root <code>pyproject.toml</code> to better represent my current implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;dev-dependencies in workspace pyproject.toml not installed with `uv sync`&quot; to &quot;dev-dependencies in workspace pyproject.toml not installed with `uv run`&quot; by <a href="https://github.com/KilianMichiels">@KilianMichiels</a> on 2024-09-18 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-18 15:21</div>
            <div class="timeline-body"><p>I think I like the status quo, where you can do <code>dep = { workspace = true }</code> to inherit the specification for <code>dep</code>, so you don&#x27;t need to repeat the version constraints, but still requires opt-in to add the dev-dependency in the first place. I wouldn&#x27;t expect all packages in all workspaces to need the same dev-dependencies in all cases, so if we made this case work as expected, I&#x27;d also expect some way to opt out of it. Another approach here might be to add an option for dev-dependencies as to whether they should be &quot;forcefully&quot; inherited in packages contained in the workspace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KilianMichiels">@KilianMichiels</a> on 2024-09-18 16:39</div>
            <div class="timeline-body"><blockquote>
<p>I think I like the status quo, where you can do dep = { workspace = true } to inherit the specification for dep, so you don&#x27;t need to repeat the version constraints, but still requires opt-in to add the dev-dependency in the first place.</p>
</blockquote>
<p>Is this the functionality under <code>[tool.uv.sources]</code> you are talking about? As I thought this solution was mainly to set your own packages as part of the workspace environment?  I tried adding <code>ruff = {workspace = true}</code> in my root <code>pyproject.toml</code> but got a <code>Package is not included as workspace package in &#x27;tool.uv.workspace&#x27;</code> error...which makes sense.</p>
<blockquote>
<p>I wouldn&#x27;t expect all packages in all workspaces to need the same dev-dependencies in all cases, so if we made this case work as expected, I&#x27;d also expect some way to opt out of it.</p>
</blockquote>
<p>I agree this is not by default the case. I believe the proposed solution should indeed be an opt-in if you add specific dev-dependencies to your root <code>pyproject.toml</code>. Then only those would be shared across the workspace. Not doing so, essentially results in the current working implementation where only dev-dependencies in the package&#x27;s <code>pyproject.toml</code> are picked up. But since I&#x27;m quite new to <code>uv</code> I might be missing something here. :)</p>
<blockquote>
<p>Another approach here might be to add an option for dev-dependencies as to whether they should be &quot;forcefully&quot; inherited in packages contained in the workspace.</p>
</blockquote>
<p>I don&#x27;t think I have enough experience with <code>uv</code> to provide any useful input here, but here&#x27;s my 2 cents :) On the one hand this would make the settings more explicit which is nice. On the other hand, it might add more complexity to the <code>pyproject.toml</code> files and one might lose the overview of which packages force this behaviour if it should be set in the package&#x27;s <code>pyproject.toml</code>. If it&#x27;s a single setting in the root <code>pyproject.toml</code> I think it could be nice, but I don&#x27;t see the added benefit of having both the setting <em>and</em> common dev-dependencies (adding them to the root implies having this setting on <code>true</code> as far as I can see).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-18 16:54</div>
            <div class="timeline-body"><p>The issue is when you add a <code>dev-dependency</code> to the root but <em>don&#x27;t</em> want it to be included in a sub-package. That&#x27;s how dev-dependencies and normal dependencies work today. Correct me if I&#x27;m wrong, but I believe you are suggesting that dev-dependencies should work differently: that a dev-dependency in the workspace root <code>pyproject.toml</code> should be automatically inherited by all workspace packages.</p>
<p>The <code>{ workspace = true }</code> thing applies to your <code>my-package</code> example, not the workspace root. It&#x27;s saying, &quot;use the value defined in the workspace root <code>pyproject.toml</code>.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KilianMichiels">@KilianMichiels</a> on 2024-09-19 10:54</div>
            <div class="timeline-body"><p>Oh now I understand! In that case, my suggestion indeed works differently than the current behavior. So this might be quite a big change to add and I don&#x27;t think I have a proper overview of the impact of such a change..</p>
<p>I&#x27;m only looking for a way to only define some dev-dependencies once, if they are shared across all packages / services / ... in the workspace. Like <code>ruff</code>! :) But as far as I can see, there is no easy way to do this? The only solution I could find was adding <code>ruff</code> to all my dev-dependencies for all <code>pyproject.toml</code> files. If there is a better way, that would be more than welcome! :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-19 12:01</div>
            <div class="timeline-body"><p>So one thing it looks like I got wrong is that <code>{ workspace = true }</code> is not working as I had expected it to. From the docs:</p>
<blockquote>
<p>The <code>workspace = true</code> key-value pair in the tool.uv.sources table indicates the bird-feeder dependency should be provided by the workspace, rather than fetched from PyPI or another registry.</p>
</blockquote>
<p>That&#x27;s saying the dependency should be <em>in</em> the workspace. I had gotten this wrong and thought it meant that it &quot;inherits&quot; what dependency specification is in the workspace root. So I think the situation is a little worse than I was painting: you do have to repeat not just the dependency but the version constraint.</p>
<p>I don&#x27;t have a strong opinion about whether there&#x27;s an option to make dev-dependencies apply everywhere, but I do kind of think it should be opt-in. Or maybe even opt-in on a dependency-by-dependency basis in the workspace root.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/KilianMichiels">@KilianMichiels</a> on 2024-09-19 12:56</div>
            <div class="timeline-body"><p>I really like the idea of having the opt-in on a dependency-by-dependency basis in the workspace root! However, looking at the <a href="https://docs.astral.sh/uv/concepts/dependencies/#development-dependencies">docs</a> I don&#x27;t see a ready-to-use solution that aligns neatly with PEP 508 and allows you to set a flag or something for each dev-dependency? So perhaps a global opt-in under <code>[tool.uv]</code> or <code>[tool.uv.dev-dependencies]</code> would already be an easy win until there is a need for a more fine-grained solution?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-26 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alex-debrecht-kcftech">@alex-debrecht-kcftech</a> on 2025-01-22 01:33</div>
            <div class="timeline-body"><p>I see this is closed as completed, but I can&#x27;t find anything in the documentation about enabling functionality like this, and trying <code>uv run --exact --package ...</code> does not install either <code>dev-dependencies</code> or the <code>dev</code> dependency group from the workspace root. Am I missing something, or should this be closed as &quot;not planned&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-22 01:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-22 01:37</div>
            <div class="timeline-body"><p>I&#x27;ll re-close as &quot;not planned&quot;. No, we don&#x27;t allow you to define dependencies in the workspace root that apply to individual members.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chuikoffru">@chuikoffru</a> on 2025-01-28 12:05</div>
            <div class="timeline-body"><p><code>uv sync --all-extras</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anentropic">@anentropic</a> on 2025-08-12 18:27</div>
            <div class="timeline-body"><p>I have the opposite problem</p>
<p>I want to be able to easily, from the project root, install the dev dependencies for project workspaces when they are defined in the workspaces rather than the project root</p>
<p><code>uv sync --all-extras</code> does not do this AFAICT</p>
<p>I mostly want this so that VS Code can just point to the venv of the project root and not have missing packages when editing files in any of the workspaces</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anentropic">@anentropic</a> on 2025-08-12 18:29</div>
            <div class="timeline-body"><p>ah ok, <code>uv sync --all-packages</code> does what I need</p>
<p>as mentioned on <a href="https://github.com/astral-sh/uv/issues/7541">astral-sh/uv#7541</a>#issuecomment-2487051795</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nfantone">@nfantone</a> on 2025-10-02 19:20</div>
            <div class="timeline-body"><p>Apologies for reviving this, but today I hit the same wall.</p>
<p>As someone with a more JS-centric background, where a root <code>package.json</code> would <a href="https://github.com/vercel/next.js/blob/canary/package.json#L115">typically define cross-package/common dependencies</a> and configuration, I find the pattern very natural. From reading this thread, I&#x27;m not sure I gather why this was rejected.</p>
<p>@charliermarsh</p>
<blockquote>
<p>No, we don&#x27;t allow you to define dependencies in the workspace root that <strong>apply to individual members</strong>.</p>
</blockquote>
<p>Not sure this is the right mental framework for the feature being requested here, if I may. These wouldn&#x27;t be dependencies applying to &quot;individual members&quot;, but to <em>all</em> members, indiscriminately. As @KilianMichiels elaborated in his original post, classic examples of this are testing (<code>pytest</code>), linting (<code>ruff</code>) and type checking (<code>mypy</code>). As your project grows, you wouldn&#x27;t want to repeat these deps every time and deal with the bookkeeping that comes with it.</p>
<p>In every case, their configuration is already resolved by traversing the file system upwards — which means that running <code>pytest</code> or <code>ruff</code> from inside an individual package would fetch settings from the root. The convenience of this flow is deterred by how <code>uv sync</code> and <code>uv run</code> currently operate.</p>
<p>Given the following monorepo setup:</p>
<pre><code>py-project/
├── pyproject.toml           # Shared dev tools and config (mypy, ruff, pytest)
├── uv.lock                  
├── packages/
│   ├── my-package/
│   │   ├── pyproject.toml   # Package specific deps
│   │   └── src/...
│   └── my-service/
│       ├── pyproject.toml
│       └── myservice/...
</code></pre>
<p>My current workaround for running tools inside a package dir is:</p>
<pre><code>cd packages/my-package

# Install dev deps from the root
uv sync --only-dev --no-install-workspace --directory ../../ 

# Add package-specific dependencies
uv sync --inexact

# Run package only tests
uv run pytest
</code></pre>
<p>Which feels redundant, but does the trick. <code>--all-extras</code> doesn&#x27;t help here and <code>--all-packages</code> would install dependencies from unrelated packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anentropic">@anentropic</a> on 2025-10-03 08:08</div>
            <div class="timeline-body"><p>I agree that being able to specify some dev dependencies in the root project would be useful</p>
<p>I realise there is a tension between whether root project deps should belong &quot;to the root project itself&quot; as currently, or &quot;to all workspaces&quot;</p>
<p>But in a monorepo scenario the root project is often an empty stub that just contains the workspaces, and the latter pattern would be more useful. Perhaps it could be opt-in</p>
<p>(I encountered recently that when building to publish there is already a behaviour that supports this, i.e. <code>uv build</code> at the root builds the root itself, while <code>uv build --all-packages</code> at the root builds only the workspaces and not the root)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wxgeo">@wxgeo</a> on 2025-10-30 14:37</div>
            <div class="timeline-body"><p>Sad it was rejected.
Having to duplicate dev-dependencies 4 times and maintaining all of them synchronized manually seems like a non-sense to me.
I&#x27;m switching from poetry to uv, mainly because I was expecting a lot from uv workspaces, but apart from the common <code>uv.lock</code>, I don&#x27;t see much benefice from using them.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:34:07 UTC
    </footer>
</body>
</html>
