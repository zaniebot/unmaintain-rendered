<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv pip compile incorrectly compiles extras in requirements.txt - astral-sh/uv #10020</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv pip compile incorrectly compiles extras in requirements.txt</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10020">#10020</a>
        opened by <a href="https://github.com/mumin91">@mumin91</a>
        on 2024-12-19 06:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mumin91">@mumin91</a> on 2024-12-19 06:58</div>
            <div class="timeline-body"><h3>Version Information</h3>
<ul>
<li>UV version: uv 0.5.10 (37b11ddb2 2024-12-17)</li>
<li>OS: macOS 14.7.1</li>
<li>Python: 3.12.7</li>
</ul>
<h3>Steps to Reproduce</h3>
<ol>
<li>Create a new project:</li>
</ol>
<pre><code>mkdir uv_test
cd uv_test
</code></pre>
<ol start="2">
<li>Initiate UV project:</li>
</ol>
<pre><code>uv init .
</code></pre>
<ol start="3">
<li>Add sentry-sdk with fastapi extras:</li>
</ol>
<pre><code>uv add 'sentry-sdk[fastapi]'
</code></pre>
<ol start="4">
<li>This creates a pyproject.toml with:</li>
</ol>
<pre><code>[project]
name = &quot;uv-test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;sentry-sdk[fastapi]&gt;=2.19.2&quot;,
]
</code></pre>
<ol start="5">
<li>Generate <code>requirements.txt</code>. Using <code>--versbose</code> for debug perpose:</li>
</ol>
<pre><code>uv pip compile pyproject.toml -o requirements.txt --verbose
</code></pre>
<p>the output:</p>
<pre><code>DEBUG uv 0.5.10 (37b11ddb2 2024-12-17)
DEBUG Starting Python discovery for a default Python
DEBUG Looking for exact match for request a default Python
DEBUG Searching for default Python interpreter in virtual environments, managed installations, or search path
DEBUG Found `cpython-3.12.7-macos-aarch64-none` at `/Users/muminur.rahman/Desktop/uv_test/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.12.7 interpreter at .venv/bin/python3 for builds
DEBUG Using request timeout of 30s
DEBUG Found static `requires-dist` for: /Users/muminur.rahman/Desktop/uv_test
DEBUG No workspace root found, using project root
DEBUG Solving with installed Python version: 3.12.7
DEBUG Solving with target Python version: &gt;=3.12.7
DEBUG Adding direct dependency: sentry-sdk[fastapi]&gt;=2.19.2
DEBUG Found fresh response for: https://pypi.org/simple/sentry-sdk/
DEBUG Searching for a compatible version of sentry-sdk[fastapi] (&gt;=2.19.2)
DEBUG Selecting: sentry-sdk==2.19.2 [preference] (sentry_sdk-2.19.2-py2.py3-none-any.whl)
DEBUG Adding transitive dependency for sentry-sdk==2.19.2: sentry-sdk==2.19.2
DEBUG Adding transitive dependency for sentry-sdk==2.19.2: sentry-sdk[fastapi]==2.19.2
DEBUG Searching for a compatible version of sentry-sdk[fastapi] (==2.19.2)
DEBUG Selecting: sentry-sdk==2.19.2 [preference] (sentry_sdk-2.19.2-py2.py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/31/4d/74597bb6bcc23abc774b8901277652c61331a9d4d0a8d1bdb20679b9bbcb/sentry_sdk-2.19.2-py2.py3-none-any.whl.metadata
DEBUG Adding transitive dependency for sentry-sdk==2.19.2: fastapi&gt;=0.79.0
DEBUG Searching for a compatible version of sentry-sdk (==2.19.2)
DEBUG Selecting: sentry-sdk==2.19.2 [preference] (sentry_sdk-2.19.2-py2.py3-none-any.whl)
DEBUG Adding transitive dependency for sentry-sdk==2.19.2: urllib3&gt;=1.26.11
DEBUG Adding transitive dependency for sentry-sdk==2.19.2: certifi*
DEBUG Found fresh response for: https://pypi.org/simple/certifi/
DEBUG Found fresh response for: https://pypi.org/simple/urllib3/
DEBUG Found fresh response for: https://pypi.org/simple/fastapi/
DEBUG Searching for a compatible version of fastapi (&gt;=0.79.0)
DEBUG Selecting: fastapi==0.115.6 [preference] (fastapi-0.115.6-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/a5/32/8f6669fc4798494966bf446c8c4a162e0b5d893dff088afddf76414f70e1/certifi-2024.12.14-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/ce/d9/5f4c13cecde62396b0d3fe530a50ccea91e7dfc1ccf0e09c228841bb5ba8/urllib3-2.2.3-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/52/b3/7e4df40e585df024fac2f80d1a2d579c854ac37109675db2b0cc22c0bb9e/fastapi-0.115.6-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for fastapi==0.115.6: starlette&gt;=0.40.0, &lt;0.42.0
DEBUG Adding transitive dependency for fastapi==0.115.6: pydantic&gt;=1.7.4, &lt;1.8 | &gt;=1.8+, &lt;1.8.1 | &gt;=1.8.1+, &lt;2.0.0 | &gt;=2.0.0+, &lt;2.0.1 | &gt;=2.0.1+, &lt;2.1.0 | &gt;=2.1.0+, &lt;3.0.0
DEBUG Adding transitive dependency for fastapi==0.115.6: typing-extensions&gt;=4.8.0
DEBUG Searching for a compatible version of urllib3 (&gt;=1.26.11)
DEBUG Selecting: urllib3==2.2.3 [preference] (urllib3-2.2.3-py3-none-any.whl)
DEBUG Searching for a compatible version of certifi (*)
DEBUG Selecting: certifi==2024.12.14 [preference] (certifi-2024.12.14-py3-none-any.whl)
DEBUG Found fresh response for: https://pypi.org/simple/typing-extensions/
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/26/9f/ad63fc0248c5379346306f8668cda6e2e2e9c95e01216d2b8ffd9ff037d0/typing_extensions-4.12.2-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://pypi.org/simple/starlette/
DEBUG Searching for a compatible version of starlette (&gt;=0.40.0, &lt;0.42.0)
DEBUG Selecting: starlette==0.41.3 [preference] (starlette-0.41.3-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/96/00/2b325970b3060c7cecebab6d295afe763365822b1306a12eeab198f74323/starlette-0.41.3-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for starlette==0.41.3: anyio&gt;=3.4.0, &lt;5
DEBUG Found fresh response for: https://pypi.org/simple/pydantic/
DEBUG Found fresh response for: https://pypi.org/simple/anyio/
DEBUG Searching for a compatible version of pydantic (&gt;=1.7.4, &lt;1.8 | &gt;=1.8+, &lt;1.8.1 | &gt;=1.8.1+, &lt;2.0.0 | &gt;=2.0.0+, &lt;2.0.1 | &gt;=2.0.1+, &lt;2.1.0 | &gt;=2.1.0+, &lt;3.0.0)
DEBUG Selecting: pydantic==2.10.4 [preference] (pydantic-2.10.4-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/a0/7a/4daaf3b6c08ad7ceffea4634ec206faeff697526421c20f07628c7372156/anyio-4.7.0-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/f3/26/3e1bbe954fde7ee22a6e7d31582c642aad9e84ffe4b5fb61e63b87cd326f/pydantic-2.10.4-py3-none-any.whl.metadata
DEBUG Adding transitive dependency for pydantic==2.10.4: annotated-types&gt;=0.6.0
DEBUG Adding transitive dependency for pydantic==2.10.4: pydantic-core&gt;=2.27.2, &lt;2.27.2+
DEBUG Adding transitive dependency for pydantic==2.10.4: typing-extensions&gt;=4.12.2
DEBUG Searching for a compatible version of typing-extensions (&gt;=4.12.2)
DEBUG Selecting: typing-extensions==4.12.2 [preference] (typing_extensions-4.12.2-py3-none-any.whl)
DEBUG Searching for a compatible version of anyio (&gt;=3.4.0, &lt;5)
DEBUG Selecting: anyio==4.7.0 [preference] (anyio-4.7.0-py3-none-any.whl)
DEBUG Adding transitive dependency for anyio==4.7.0: idna&gt;=2.8
DEBUG Adding transitive dependency for anyio==4.7.0: sniffio&gt;=1.1
DEBUG Adding transitive dependency for anyio==4.7.0: typing-extensions{python_full_version &lt; '3.13'}&gt;=4.5
DEBUG Searching for a compatible version of typing-extensions{python_full_version &lt; '3.13'} (&gt;=4.5)
DEBUG Selecting: typing-extensions==4.12.2 [preference] (typing_extensions-4.12.2-py3-none-any.whl)
DEBUG Adding transitive dependency for typing-extensions==4.12.2: typing-extensions==4.12.2
DEBUG Adding transitive dependency for typing-extensions==4.12.2: typing-extensions{python_full_version &lt; '3.13'}==4.12.2
DEBUG Found fresh response for: https://pypi.org/simple/annotated-types/
DEBUG Searching for a compatible version of typing-extensions{python_full_version &lt; '3.13'} (==4.12.2)
DEBUG Selecting: typing-extensions==4.12.2 [preference] (typing_extensions-4.12.2-py3-none-any.whl)
DEBUG Searching for a compatible version of annotated-types (&gt;=0.6.0)
DEBUG Selecting: annotated-types==0.7.0 [preference] (annotated_types-0.7.0-py3-none-any.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/78/b6/6307fbef88d9b5ee7421e68d78a9f162e0da4900bc5f5793f6d3d0e34fb8/annotated_types-0.7.0-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://pypi.org/simple/sniffio/
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/e9/44/75a9c9421471a6c4805dbf2356f7c181a29c1879239abab1ea2cc8f38b40/sniffio-1.3.1-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://pypi.org/simple/idna/
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl.metadata
DEBUG Found fresh response for: https://pypi.org/simple/pydantic-core/
DEBUG Searching for a compatible version of pydantic-core (&gt;=2.27.2, &lt;2.27.2+)
DEBUG Selecting: pydantic-core==2.27.2 [preference] (pydantic_core-2.27.2-cp312-cp312-macosx_11_0_arm64.whl)
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/d3/f3/c97e80721735868313c58b89d2de85fa80fe8dfeeed84dc51598b92a135e/pydantic_core-2.27.2-cp312-cp312-macosx_11_0_arm64.whl.metadata
DEBUG Adding transitive dependency for pydantic-core==2.27.2: typing-extensions&gt;=4.6.0, &lt;4.7.0 | &gt;=4.7.0+
DEBUG Searching for a compatible version of idna (&gt;=2.8)
DEBUG Selecting: idna==3.10 [preference] (idna-3.10-py3-none-any.whl)
DEBUG Searching for a compatible version of sniffio (&gt;=1.1)
DEBUG Selecting: sniffio==1.3.1 [preference] (sniffio-1.3.1-py3-none-any.whl)
DEBUG Tried 12 versions: annotated-types 1, anyio 1, certifi 1, fastapi 1, idna 1, pydantic 1, pydantic-core 1, sentry-sdk 1, sniffio 1, starlette 1, typing-extensions 1, urllib3 1
DEBUG marker environment resolution took 0.014s
Resolved 12 packages in 18ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml -o requirements.txt
annotated-types==0.7.0
    # via pydantic
anyio==4.7.0
    # via starlette
certifi==2024.12.14
    # via sentry-sdk
fastapi==0.115.6
    # via sentry-sdk
idna==3.10
    # via anyio
pydantic==2.10.4
    # via fastapi
pydantic-core==2.27.2
    # via pydantic
sentry-sdk==2.19.2
    # via uv-test (pyproject.toml)
sniffio==1.3.1
    # via anyio
starlette==0.41.3
    # via fastapi
typing-extensions==4.12.2
    # via
    #   anyio
    #   fastapi
    #   pydantic
    #   pydantic-core
urllib3==2.2.3
    # via sentry-sdk
</code></pre>
<h3>Expected Behavior</h3>
<p>The generated <code>requirements.txt</code> should include <code>sentry-sdk[fastapi]==2.19.2</code> to maintain the extras specification.</p>
<h3>Actual Behavior</h3>
<p>The generated <code>requirements.txt</code> includes just <code>sentry-sdk==2.19.2</code> without the <code>[fastapi]</code> extra specification.</p>
<h3>Additional Context</h3>
<ul>
<li>Using <code>pip-tools</code> to generate <code>requirements.txt</code> correctly maintains the extras syntax</li>
<li>While all dependencies are correctly resolved and installed, the lack of extras syntax in the <code>requirements.txt</code> causing issues where the extra is required.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv pip compile does not add extra option to requirements.txt" to "uv pip compile incorrectly compiles extras in requirements.txt" by @mumin91 on 2024-12-19 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-19 13:36</div>
            <div class="timeline-body"><p>You're looking for the <code>--no-strip-extras</code> flag. For reference, this has no practical impact on behavior. The file functions exactly the same way with our without the extras, which is why they're omitted. It's only a superficial difference (i.e., a difference in appearance).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-19 13:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-12-19 13:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:24 UTC
    </footer>
</body>
</html>
