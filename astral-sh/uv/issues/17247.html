<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom command hook for uv sync/lock/run/... calls - astral-sh/uv #17247</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Custom command hook for uv sync/lock/run/... calls</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/17247">#17247</a>
        opened by <a href="https://github.com/danijar">@danijar</a>
        on 2025-12-28 20:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/danijar">@danijar</a> on 2025-12-28 20:10</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We have been exploring uv extensively for our mono repository, and noticed that currently the only way to support our requirements is to wrap all uv commands to generate <code>pyproject.toml</code> entries before calling into uv.</p>
<p>Being able to register a custom command with uv for ensuring a consistent environment would make this much easier, allowing our users to still call uv directly (and rely on the uv documentation).</p>
<p>This could be done by specifying an environment variable <code>UV_PRE_SYNC_COMMAND=&quot;shell command&quot;</code>. uv would execute this command each time it needs to ensure a consistent environment.</p>
<h3>Example</h3>
<p>As one example, we want to specify our dependencies as repository-absolute paths like <code>org-deep-nested-namespace-dependency</code> instead of relative paths like <code>../../../namespace/dependency</code>.</p>
<p>For this, we can add a custom section to the <code>pyproject.toml</code> of each package in the monorepo:</p>
<pre><code class="language-toml">[tool.monorepo]
dependencies = [
  'org-deep-nested-namespace-dependency',
]
</code></pre>
<p>We then have a custom <code>sync_deps.sh</code> script that finds all <code>pyproject.toml</code> files in the monorepo, reads the above config block, and generates the <code>[tool.uv.sources]</code> block with relatives paths as required by uv:</p>
<pre><code class="language-toml"># generated
[tool.uv.source]
org-deep-nested-namespace-dependency = { path = &quot;../../../namespace/dependency&quot;, editable = true }
</code></pre>
<p>Currently, we have to manually call <code>sync_deps.sh</code> each time we change a <code>pyproject.toml</code> file, which slows down developers and is easy to forget. We could also wrap all uv commands to always call <code>sync_deps.sh</code> (for the whole repo or just the <code>pyproject.toml</code> targeted by the uv command and its recursive dependencies) before forwarding the call to the uv binary, but then our developers can't call the familiar uv binary directly anymore.</p>
<p>With a custom command hook, we'd register <code>sync_deps.sh</code> with uv, for example via an environment variable:</p>
<pre><code>export UV_PRE_SYNC_COMMAND=&quot;repo/sync_deps.sh&quot;
</code></pre>
<p>We could then use uv natively and with low maintenance burden.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @danijar on 2025-12-28 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17209.html">astral-sh/uv#17209</a> on 2025-12-28 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17283.html">astral-sh/uv#17283</a> on 2026-01-02 16:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-06 19:20</div>
            <div class="timeline-body"><p>This sounds like https://github.com/astral-sh/uv/issues/11826</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
