<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Define commands to run right after package install (via uv pip install) - astral-sh/uv #12750</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Define commands to run right after package install (via uv pip install)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/12750">#12750</a>
        opened by <a href="https://github.com/Miamrion">@Miamrion</a>
        on 2025-04-08 16:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Miamrion">@Miamrion</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hello there,</p>
<p>First of all thank you so much for the amazing work you've been doing with uv and for the amount of delivered updates. It's great !</p>
<p>We're a small animation studio which has recently adopted the use of uv as package manager mostly to handle our own custom Python libraries.
We store them on our own server, and generate virtual envs containing said libraries in order to execute software while having access to our packages.</p>
<p>In the domain, there's a quite popular package manager, Rez, which offers the possibility to define one or several commands in the setup.py (they're still using this convention) of the packages.
These commands are then automatically executed by Rez when said package is being installed into a virtual environment.</p>
<p>This can be particularly practical, for example if you wish to add your packages to your PYTHONPATH automatically at install.</p>
<p>So again the idea of this feature request would be :
implement, via the package.pyproject.toml, a place to define commands which would be executed by uv at <code>uv pip install package</code></p>
<p>We did not go with Rez, as uv seemed way faster and matched PEP conventions in a more graceful way ;)
But some of the features offered by Rez could be really interesting if implemented in uv</p>
<p>Here is a link to the REZ page about the commands :
https://rez.readthedocs.io/en/3.2.1/basic_concepts.html#package-commands</p>
<p>Thanks a lot in advance</p>
<h3>Example</h3>
<p>Let's imagine a package myLibrary
In the pyproject.toml of myLibrary, I would have something as such :</p>
<p>[project]
name = &quot;myLibrary&quot;
version = &quot;0.1.0&quot;
dependencies = [
&quot;PySide2&quot;,
&quot;customLibrary &gt;=0.1.0&quot;,
&quot;anotherCustomLibrary &gt;=0.1.0&quot;,
]
requires-python = &quot;&gt;=3.10&quot;
authors = [
{name = &quot;Zorro&quot;, email = &quot;zorro@magicMail.com&quot;},
]
maintainers = [
{name = &quot;Zorro&quot;, email = &quot;zorro@magicMail.com&quot;},
]
description = &quot;An amazing custom library made in house at MagicStudio&quot;
[uv.commands]
sys.path.append(&quot;.&quot;) # automatically execute this part at install. Here, append package root to sys path</p>
<p>When using <code>uv pip install myLibrary</code> in a uv venv, uv would automatically execute the uv.commands part of the pyproject.toml file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @Miamrion on 2025-04-08 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-04-08 17:30</div>
            <div class="timeline-body"><p>Glad to hear you're enjoying uv :)</p>
<p>I think I'm broadly opposed to this â€” unfortunately, arbitrary command execution on install is a dangerous concept that I don't think we want to expose to all users.</p>
<p>Would adding <code>post-install</code> hooks to the <code>pyproject.toml</code> that executes when you install something in the <em>current</em> project rather than defining post-install commands in arbitrary packages work for you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @zanieb on 2025-04-08 17:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Miamrion">@Miamrion</a> on 2025-04-09 07:51</div>
            <div class="timeline-body"><p>Hi zanieb, thank a lot for your fast answer !
I can see why you wouldn't want such a thing, outside of very specific worklows. And I feel like our need is indeed quite specific.
I do like the idea of post-install hooks though.</p>
<p>Do you have an example of the usage they could have ? or the shape they could take ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pelson">@pelson</a> on 2025-05-07 04:02</div>
            <div class="timeline-body"><p>Author of a private tool which transparently adds post-install hooks to <code>pip install</code>, being used by 100s of internal users for the last ~5 years, here ðŸ‘‹ (<code>.pth</code> files have a lot to answer for ðŸ˜‰). There are two reasons I have this:</p>
<ul>
<li>As I have to fix run paths of some binaries (because of reasons around the way the Python distribution was initially built)</li>
<li>As I need to gather the Java requirements of the installed Python packages to resolve Java dependencies for use with JPype (example of such a declaration https://gitlab.cern.ch/scripting-tools/pyjapc/-/blob/c47e93c6c13bd4dc95d7f0d385573d00535c1f8f/pyjapc/<strong>init</strong>.py#L33)</li>
</ul>
<blockquote>
<p>I think I'm broadly opposed to this â€” unfortunately, arbitrary command execution on install is a dangerous concept that I don't think we want to expose to all users.</p>
</blockquote>
<p>I totally agree that arbitrary code execution (ASE) is a scary concept. I just want to push back a little though, and state that if you install an sdist, you are exposed to ASE (both for <code>pyproject.toml</code> and <code>setup.py</code>). If you install a wheel, you are exposed to ASE on the next run of the Python interpreter.</p>
<p>Given the act of doing <em>Arbitrary Code Installation</em> is the purpose of a package installer, I find it hard to see the disadvantage of explicitly declaring post-install behaviour. Perhaps it is so that you can run some checks on the installed code before you execute it? (but you must be careful not to run the interpreter before those checks are complete!).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanmusser">@nathanmusser</a> on 2025-12-16 18:31</div>
            <div class="timeline-body"><blockquote>
<p>Would adding <code>post-install</code> hooks to the <code>pyproject.toml</code> that executes when you install something in the <em>current</em> project rather than defining post-install commands in arbitrary packages work for you?</p>
</blockquote>
<p>I'm not the original commenter but this would be really useful for my needs. A simple example is using uv to manage an infrastructure as code project using something like ansible. Being able to define some ansible-galaxy install commands as a post-install hook would be a nice QoL improvement. Currently I use small wrapper scripts that run a uv sync and then whatever other commands I need to do to finish making sure the environment is ready for use.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 16:49</div>
            <div class="timeline-body"><p>Note that there's also a security aspect to pre-/post-install scripts, which have been used recently for credential theft (https://trigger.dev/blog/shai-hulud-postmortem). This is also possible in Python using source distributions, though this would add another vector.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanmusser">@nathanmusser</a> on 2025-12-18 17:45</div>
            <div class="timeline-body"><p>That's for pre-/post-install scripts defined in packages correct?</p>
<p>What I was trying to express support for (but I may have misunderstood) is the addition of pre-/post-install scripts for the local project. Every time I create a new project I would need to as a user go manually defined my scripts/commands inside the project's <code>pyproject.toml</code>. I want the ability to say, &quot;anytime this project installs packages I want to run xyz after the install is done&quot;. I agree that running arbitrary scripts defined by packages upon install is a security risk.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:30:52 UTC
    </footer>
</body>
</html>
