<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git submodule cloning not working when using relative paths - astral-sh/uv #9822</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Git submodule cloning not working when using relative paths</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/9822">#9822</a>
        opened by <a href="https://github.com/breuninger-dgrimm">@breuninger-dgrimm</a>
        on 2024-12-11 18:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/breuninger-dgrimm">@breuninger-dgrimm</a> on 2024-12-11 18:31</div>
            <div class="timeline-body"><p>Hey,</p>
<p>I am really enjoying <code>uv</code> because I think it's the best Python package manager around. However, I have one problem which keeps me from using it at the moment.</p>
<p>I might have found a bug or I am doing something wrong.</p>
<p>Let's assume I have a repo <code>mylib</code> with a <code>.gitmodule</code> file that  looks like this:</p>
<pre><code class="language-bash">[submodule &quot;helpers&quot;]
	path = helpers
	url = ../../utilities/helpers.git
</code></pre>
<p>The repo is hosted on a private Gitlab instance.</p>
<p>I will run</p>
<pre><code class="language-bash">uv pip install 'mylib@git+ssh://git@gitlab.mycompany.de/.../mylib.git'
</code></pre>
<p>This fails with the following error:</p>
<pre><code>  ├─▶ Git operation failed
  ╰─▶ process didn't exit successfully: `/usr/bin/git submodule update --recursive --init` (exit status: 1)
      --- stderr
      Submodule 'helpers' (/Users/ebuser/.cache/uv/git-v0/utilities/helpers.git) registered for path 'helpers'
      fatal: repository '/Users/ebuser/.cache/uv/git-v0/utilities/helpers.git' does not exist
      fatal: clone of '/Users/ebuser/.cache/uv/git-v0/utilities/helpers.git' into submodule path '/Users/ebuser/.cache/uv/git-v0/checkouts/9f3d7b05f0eb7565/abd7aca/helpers' failed
      Failed to clone 'helpers'. Retry scheduled
      fatal: repository '/Users/ebuser/.cache/uv/git-v0/utilities/helpers.git' does not exist
      fatal: clone of '/Users/ebuser/.cache/uv/git-v0/utilities/helpers.git' into submodule path '/Users/ebuser/.cache/uv/git-v0/checkouts/9f3d7b05f0eb7565/abd7aca/helpers' failed
      Failed to clone 'helpers' a second time, aborting
</code></pre>
<p>I am assuming that <code>uv</code> interprets the <code>.gitmodule</code> references with the relative paths as local references. However, when I clone the library manually and run <code>git submodule update --recursive --init</code> it works fine.</p>
<p>When I run <code>pip install git+ssh://git@gitlab.mycompany.de/.../mylib.git</code>, it works just fine.</p>
<p>I also never had problems with <code>poetry</code> and this library.</p>
<p>I am a bit lost here. Can you give me a hint if I'm doing something wrong and how I can fix it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/draustin">@draustin</a> on 2025-01-04 11:49</div>
            <div class="timeline-body"><p>I observe similar behavior using <code>uv tool install</code>. In my case, I have a monorepo <code>my-monorepo</code> containing a Poetry project in <code>path/my-project</code>. Among this project's dependencies are some editable local folders, which are Git submodules. The <code>.gitmodules</code> file at the root of <code>monorepo</code> contains entries of the form:</p>
<pre><code>[submodule &quot;path/other-project1&quot;]
   path = path/other-project1
   url = ../other-project1
</code></pre>
<p>Note the lack of <code>.git</code> on the URL compared to the original post. The submodule repositories are hosted alongside <code>my-monorepo</code> in Bitbucket.</p>
<p><code>uv tool install git+https://my-name@bitbucket.org/my-company/my-monorepo.git#subdirectory=path/my-project</code></p>
<pre><code>Updating https://my-name@bitbucket.org/my-company/my-monorepo.git (HEAD)
error: Git operation failed
  Caused by: process didn't exit successfully: `C:\Program Files\Git\cmd\git.exe submodule update --recursive --init` (exit code: 1)
--- stderr
Submodule 'path/other-project1' (C:\Users\DaneAustin\AppData\Local\uv\cache\git-v0\db/other-project1) registered for path 'path/other-project1'
Cloning into 'C:/Users/DaneAustin/AppData/Local/uv/cache/git-v0/checkouts/aebdb5132ba74ab3/fe60ad9d6/path/other-project1'...
fatal: 'C:\Users\DaneAustin\AppData\Local\uv\cache\git-v0\db/other-project1' does not appear to be a git repository
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
</code></pre>
<p>The cache folder does not contain <code>other-project</code>. Here is the output of <code>dir C:\Users\DaneAustin\AppData\Local\uv\cache\git-v0\db</code>:</p>
<pre><code>    Directory: C:\Users\DaneAustin\AppData\Local\uv\cache\git-v0\db


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----          1/4/2025   3:19 AM                aebdb5132ba74ab3
</code></pre>
<p>Another possibly relevant fact: before reaching this point, I encountered an <code>fatal: transport 'file' not allowed</code> error at the cloning step. Following <a href="https://stackoverflow.com/questions/74486167/git-clone-recurse-submodules-throws-error-on-macos-transmission-type-file-n">this advice</a> I did <code>git config --global protocol.file.allow always</code>, and reran <code>uv tool ...</code>. This brought me to the situation described above.</p>
<p>A direct <code>git clone https://my-name@bitbucket.org/my-company/my-monorepo.git</code> followed by <code>git submodule update --recursive --init</code> works fine.</p>
<p>For context: I am investigating <code>uv</code> as a way of sharing my Python-based tools with non-programmer colleagues in a small manufacturing startup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2025-01-07 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2025-01-07 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jeffmelville">@jeffmelville</a> on 2025-01-09 19:13</div>
            <div class="timeline-body"><p>I'm having the same issue. I defined a <code>[tool.uv.source]</code> as a git repository. The git repository has submodules (which I do not need - related #10130)</p>
<p>It looks like the checkout in <code>~/.cache/uv/git-v0/...</code> is configured with a remote of <code>~/.cache/uv/git-v0/db/...</code> rather than the original upstream URL. When the submodule init happens, it tries to evaluate the submodule paths relative to this remote URL rather than the original upstream URL and it fails.</p>
<p>Not sure what the fix would be without changing how git checkouts are cloned or fixing up the .git/modules in between init and update</p>
<p>I'm uv 0.5.13 on Darwin</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12156.html">astral-sh/uv#12156</a> on 2025-03-13 23:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/watsonjj">@watsonjj</a> on 2025-05-08 05:23</div>
            <div class="timeline-body"><p>I've hit this a few times now. For example, when trying to install <a href="https://github.com/VUnit/vunit">vunit</a> from the github repo:</p>
<pre><code>uv pip install vunit-hdl@git+https://github.com/VUnit/vunit.git@acf7e7f

  × Failed to download and build `vunit-hdl @ git+https://github.com/VUnit/vunit.git@acf7e7f`
  ├─▶ Git operation failed
  ╰─▶ process didn't exit successfully: `/usr/local/bin/git submodule update --recursive --init` (exit status: 1)
      --- stderr
      Submodule 'vunit/vhdl/JSON-for-VHDL' (/Users/Jason/.cache/uv/git-v0/Paebbels/JSON-for-VHDL.git) registered for path 'vunit/vhdl/JSON-for-VHDL'
      Submodule 'vunit/vhdl/osvvm' (/Users/Jason/.cache/uv/git-v0/OSVVM/OSVVM.git) registered for path 'vunit/vhdl/osvvm'
      fatal: repository '/Users/Jason/.cache/uv/git-v0/Paebbels/JSON-for-VHDL.git' does not exist
      fatal: clone of '/Users/Jason/.cache/uv/git-v0/Paebbels/JSON-for-VHDL.git' into submodule path '/Users/Jason/.cache/uv/git-v0/checkouts/9b32958e04bf51f8/acf7e7f2/vunit/vhdl/JSON-for-VHDL' failed
      Failed to clone 'vunit/vhdl/JSON-for-VHDL'. Retry scheduled
      fatal: repository '/Users/Jason/.cache/uv/git-v0/OSVVM/OSVVM.git' does not exist
      fatal: clone of '/Users/Jason/.cache/uv/git-v0/OSVVM/OSVVM.git' into submodule path '/Users/Jason/.cache/uv/git-v0/checkouts/9b32958e04bf51f8/acf7e7f2/vunit/vhdl/osvvm' failed
      Failed to clone 'vunit/vhdl/osvvm'. Retry scheduled
      fatal: repository '/Users/Jason/.cache/uv/git-v0/Paebbels/JSON-for-VHDL.git' does not exist
      fatal: clone of '/Users/Jason/.cache/uv/git-v0/Paebbels/JSON-for-VHDL.git' into submodule path '/Users/Jason/.cache/uv/git-v0/checkouts/9b32958e04bf51f8/acf7e7f2/vunit/vhdl/JSON-for-VHDL' failed
      Failed to clone 'vunit/vhdl/JSON-for-VHDL' a second time, aborting
</code></pre>
<p>Which works fine if I instead use <code>pip</code>. I hope a fix (maybe #12156) can be merged soon!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:01 UTC
    </footer>
</body>
</html>
