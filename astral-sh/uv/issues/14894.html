<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problems with git installs in CI via Github Actions - astral-sh/uv #14894</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Problems with git installs in CI via Github Actions</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/14894">#14894</a>
        opened by <a href="https://github.com/emdneto">@emdneto</a>
        on 2025-07-25 12:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/emdneto">@emdneto</a> on 2025-07-25 12:53</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>In opentelemetry-python, we have a lot of CI jobs that run tests using a specific version of the API/SDK against all instrumentation packages. To make this work, we install API/SDK packages pointing to a git address and pinned to a specific SHA commit, like this:</p>
<pre><code>uv pip install 'opentelemetry-api@ git+https://github.com/open-telemetry/opentelemetry-python.git@0f166e3136033f3230a692f82381fb66f39d417f#egg=opentelemetry-api&amp;subdirectory=opentelemetry-api'
</code></pre>
<p>The thing is, the installation is failing randomly in our CI with:</p>
<pre><code>× Failed to download and build `opentelemetry-api @
  │ git+[https://github.com/open-telemetry/opentelemetry-python.git@0f166e3136033f3230a692f82381fb66f39d417f#egg=opentelemetry-api&amp;subdirectory=opentelemetry-api`](https://github.com/open-telemetry/opentelemetry-python.git@0f166e3136033f3230a692f82381fb66f39d417f#egg=opentelemetry-api&amp;subdirectory=opentelemetry-api%60)
  ├─▶ Git operation failed
  ├─▶ failed to find branch, tag, or commit
  │   `0f166e3136033f3230a692f82381fb66f39d417f`
  ╰─▶ process didn't exit successfully: `/usr/bin/git rev-parse
      '0f166e3136033f3230a692f82381fb66f39d417f^0'` (exit status: 128)
      --- stdout
      0f166e3136033f3230a692f82381fb66f39d417f^0

      --- stderr
      fatal: ambiguous argument '0f166e3136033f3230a692f82381fb66f39d417f^0':
      unknown revision or path not in the working tree.
      Use '--' to separate paths from revisions, like this:
      'git &lt;command&gt; [&lt;revision&gt;...] -- [&lt;file&gt;...]'
</code></pre>
<p>The weird thing is that the SHA commit exists, and if you try to install it locally, it will work.</p>
<p>This issue occurs with approximately 10-15 CI jobs in every push.</p>
<p>See example:</p>
<ol>
<li>https://github.com/open-telemetry/opentelemetry-python/actions/runs/16509062023/job/46686986557?pr=4692</li>
<li>https://github.com/open-telemetry/opentelemetry-python/actions/runs/16507371027/job/46681351748?pr=4695</li>
</ol>
<h3>Platform</h3>
<p>Ubuntu 24.04.2 LTS</p>
<h3>Version</h3>
<p>latest</p>
<h3>Python version</h3>
<p>3.9+</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @emdneto on 2025-07-25 12:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13054.html">astral-sh/uv#13054</a> on 2025-07-25 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-25 13:02</div>
            <div class="timeline-body"><p>Is the issue spurious or consistently reproduced?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-25 13:03</div>
            <div class="timeline-body"><p>Do you think you could isolate this into a minimal reproduction in a separate repository?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../open-telemetry/opentelemetry-python-contrib/issues/3352.html">open-telemetry/opentelemetry-python-contrib#3352</a> on 2025-07-25 13:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emdneto">@emdneto</a> on 2025-07-25 13:05</div>
            <div class="timeline-body"><blockquote>
<p>Is the issue spurious or consistently reproduced?</p>
</blockquote>
<p>It's happening consistently. Like, every PR. If you open any PR in the repo, you'll see that there are Core Contrib Tests failing with that error message.</p>
<blockquote>
<p>Do you think you could isolate this into a minimal reproduction in a separate repository?</p>
</blockquote>
<p>I think so. Like, we just need to have an action with:</p>
<pre><code>name: Core Contrib Test

on:
  push:
    branches-ignore:
    - 'release/*'
  pull_request:

permissions:
  contents: read

jobs:
  contrib_0:
    uses: open-telemetry/opentelemetry-python-contrib/.github/workflows/core_contrib_test_0.yml@main
    with:
      CORE_REPO_SHA: ${{ github.sha }}
      CONTRIB_REPO_SHA: main
</code></pre>
<p>where ${{ github.sha }} is a commit sha from opentelemetry-python repo</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emdneto">@emdneto</a> on 2025-07-25 13:16</div>
            <div class="timeline-body"><p>@zanieb Created a minimal repo to reproduce: https://github.com/emdneto/otel-python-ci/actions/runs/16522889749/job/46728711816</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-25 13:23</div>
            <div class="timeline-body"><p>The issue only occurs in CI?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jomcgi">@jomcgi</a> on 2025-07-25 13:26</div>
            <div class="timeline-body"><blockquote>
<p>The issue only occurs in CI?</p>
</blockquote>
<p>I've not hit it locally but I'm also not running as many concurrent builds locally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emdneto">@emdneto</a> on 2025-07-25 13:30</div>
            <div class="timeline-body"><blockquote>
<p>The issue only occurs in CI?</p>
</blockquote>
<p>I was never able to reproduce the issue locally, because I don't need to run all tests, but it seems to be a problem only in CI. Locally, I usually point to <code>main</code> and it always works. I'll try run everything locally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jomcgi">@jomcgi</a> on 2025-07-25 13:32</div>
            <div class="timeline-body"><p>Would this benefit from adding controls like this? with the associate retry logic</p>
<pre><code class="language-diff">    /// The number of retries for HTTP requests. (default: 3)
    pub const UV_HTTP_RETRIES: &amp;'static str = &quot;UV_HTTP_RETRIES&quot;;
+
+   /// The number of retries for git operations. (default: 3)
+   pub const UV_GIT_RETRIES: &amp;'static str = &quot;UV_GIT_RETRIES&quot;;
</code></pre>
<p>Happy to share a PR if that makes sense.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-25 15:53</div>
            <div class="timeline-body"><p>I'm unsure why a retry would help here. It sounds like the issue isn't spurious?</p>
<p>I can't reproduce with</p>
<pre><code>uv pip install 'opentelemetry-api@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-api&amp;subdirectory=opentelemetry-api' 'opentelemetry-sdk@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-sdk&amp;subdirectory=opentelemetry-sdk' 'opentelemetry-semantic-conventions@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-semantic-conventions&amp;subdirectory=opentelemetry-semantic-conventions' 'opentelemetry-test-utils@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-test-utils&amp;subdirectory=tests/opentelemetry-test-utils'
</code></pre>
<p>locally.</p>
<p>Regarding a minimal reproduction, can you do one without tox and such please? It has to actually be minimized to the core problem for it to help us narrow things down.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emdneto">@emdneto</a> on 2025-07-28 14:43</div>
            <div class="timeline-body"><blockquote>
<p>I'm unsure why a retry would help here. It sounds like the issue isn't spurious?</p>
<p>I can't reproduce with</p>
<pre><code>uv pip install 'opentelemetry-api@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-api&amp;subdirectory=opentelemetry-api' 'opentelemetry-sdk@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-sdk&amp;subdirectory=opentelemetry-sdk' 'opentelemetry-semantic-conventions@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-semantic-conventions&amp;subdirectory=opentelemetry-semantic-conventions' 'opentelemetry-test-utils@ git+https://github.com/open-telemetry/opentelemetry-python.git@c3bef5d6c3ed054cac12bbc037db4f58a8cda30d#egg=opentelemetry-test-utils&amp;subdirectory=tests/opentelemetry-test-utils'
</code></pre>
<p>locally.</p>
<p>Regarding a minimal reproduction, can you do one without tox and such please? It has to actually be minimized to the core problem for it to help us narrow things down.</p>
</blockquote>
<p>We use tox to run the tests, which installs uv in the environment and generates the commands to run <code>uv pip install ...</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-28 17:30</div>
            <div class="timeline-body"><p>Yeah but we'll need an example that's not using <code>tox</code> so we can narrow down where the problem is in uv specifically?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
