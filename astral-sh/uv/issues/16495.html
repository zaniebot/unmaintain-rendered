<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv build errors on exception, uv sync does not - astral-sh/uv #16495</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv build errors on exception, uv sync does not</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/16495">#16495</a>
        opened by <a href="https://github.com/Timoses">@Timoses</a>
        on 2025-10-29 14:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Timoses">@Timoses</a> on 2025-10-29 14:06</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When raising an exception in <code>setup.py</code> using <code>cmdclass</code> <em>uv build</em> will fail, however <em>uv sync</em> will simply ignore the raised exception.</p>
<pre><code>&gt; uv build &amp;&gt; /dev/null ; echo $?
2
&gt; uv sync --reinstall &amp;&gt; /dev/null ; echo $?
0
</code></pre>
<p><code>uv sync -v --reinstall</code> will also show the Exception in the log, however it just ignores it and successfully syncs.</p>
<p>setup.py:</p>
<pre><code>from setuptools import setup
from setuptools.command.build_py import build_py as _build_py

class CustomBuildPy(_build_py):
    def run(self):
        raise Exception
        super().run()

setup(cmdclass={ &quot;build_py&quot;: CustomBuildPy, })
</code></pre>
<p>pyproject.toml</p>
<pre><code>[project]
name = &quot;test&quot;
version = &quot;0.0.0&quot;


[build-system]
requires = [
    &quot;setuptools&quot;,
]
build-backend = &quot;setuptools.build_meta&quot;

[tool.setuptools.package-dir]
&quot;test&quot; = &quot;test&quot;
</code></pre>
<p>test/<strong>init</strong>.py:</p>
<pre><code>print('test')
</code></pre>
<h3>Platform</h3>
<p>Linux 6.1.0-40-amd64 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.9.5</p>
<h3>Python version</h3>
<p>Python 3.13.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @Timoses on 2025-10-29 14:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2025-10-29 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">great writeup</span> added by @konstin on 2025-10-29 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @konstin on 2025-10-29 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-29 14:52</div>
            <div class="timeline-body"><p>This is a problem in setuptools: With a regular build (<code>uv build</code>), setuptools errors, but with an editable build (the <code>uv sync</code> default), setuptools finishes successfully and returns and editable wheel for uv to install. You can make <code>uv sync</code> fail the same way as<code>uv build</code> by switching to a non-editable build with <code>uv sync --no-editable</code>.</p>
<p>Setuptools shows a matching warning:</p>
<pre><code>DEBUG 
DEBUG                         If you are seeing this warning it is very likely that a setuptools
DEBUG                         plugin or customization overrides the `build_py` command, without
DEBUG                         taking into consideration how editable installs run build steps
DEBUG                         starting from setuptools v64.0.0.
DEBUG 
DEBUG                         Plugin authors and developers relying on custom build steps are
DEBUG                         encouraged to update their `build_py` implementation considering the
DEBUG                         information about editable installs in
DEBUG                         https://setuptools.pypa.io/en/latest/userguide/extension.html.
DEBUG 
DEBUG                         For the time being `setuptools` will silence this error and ignore
DEBUG                         the faulty command, but this behavior will change in future versions.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-11-09 03:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:14 UTC
    </footer>
</body>
</html>
