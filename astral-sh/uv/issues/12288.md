```yaml
number: 12288
title: "`torch.utils.cpp_extension.CUDAExtension` is built with `uv` but symbol not found"
type: issue
state: closed
author: jackalcooper
labels:
  - bug
assignees: []
created_at: 2025-03-18T15:26:24Z
updated_at: 2025-03-19T06:22:49Z
url: https://github.com/astral-sh/uv/issues/12288
synced_at: 2026-01-10T01:57:28Z
```

# `torch.utils.cpp_extension.CUDAExtension` is built with `uv` but symbol not found

---

_Issue opened by @jackalcooper on 2025-03-18 15:26_

### Summary

## The error
```bash
ImportError: [the lib].cpython-312-x86_64-linux-gnu.so: undefined symbol: _ZNK3c1011StorageImpl27throw_data_ptr_access_errorEv
```

The symbol is from c10:
```bash
c++filt _ZNK3c1011StorageImpl27throw_data_ptr_access_errorEv
c10::StorageImpl::throw_data_ptr_access_error() const
```
## Running ldd
- appending the path manually will help ldd print right lookup
```bash
LD_LIBRARY_PATH=[project path]/.venv/lib/python3.12/site-packages/torch/lib:$LD_LIBRARY_PATH ldd [the lib].cpython-312-x86_64-linux-gnu.so
        linux-vdso.so.1 (0x00007fff80fc9000)
        libc10.so => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libc10.so (0x00007f46b4721000)
        libtorch_python.so => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libtorch_python.so (0x00007f46b32ba000)
        libcudart.so.12 => /usr/local/cuda-12.3/targets/x86_64-linux/lib/libcudart.so.12 (0x00007f46b2e00000)
        libc10_cuda.so => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libc10_cuda.so (0x00007f46b31fb000)
        libnccl.so.2 => /lib/x86_64-linux-gnu/libnccl.so.2 (0x00007f46a30ea000)
        libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f46a2ebe000)
        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f46b31d9000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f46a2c95000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f46b486d000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f46b30f0000)
        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f46b30eb000)
        libtorch.so => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libtorch.so (0x00007f46b30c5000)
        libshm.so => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libshm.so (0x00007f46b30b9000)
        libtorch_cpu.so => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libtorch_cpu.so (0x00007f468e062000)
        libtorch_cuda.so => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libtorch_cuda.so (0x00007f4659153000)
        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f46b30b2000)
        libcudnn.so.9 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/cudnn/lib/libcudnn.so.9 (0x00007f4658e00000)
        librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007f465914e000)
        libgomp-a34b3233.so.1 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libgomp-a34b3233.so.1 (0x00007f4658a00000)
        libcupti.so.12 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/cuda_cupti/lib/libcupti.so.12 (0x00007f4658000000)
        libcusparse.so.12 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/cusparse/lib/libcusparse.so.12 (0x00007f4647000000)
        libcufft.so.11 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/cufft/lib/libcufft.so.11 (0x00007f4635400000)
        libcusparseLt-294d6944.so.0 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/libcusparseLt-294d6944.so.0 (0x00007f4628400000)
        libcurand.so.10 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/curand/lib/libcurand.so.10 (0x00007f4621e00000)
        libcublas.so.12 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/cublas/lib/libcublas.so.12 (0x00007f461b200000)
        libcublasLt.so.12 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/cublas/lib/libcublasLt.so.12 (0x00007f45fd200000)
        libutil.so.1 => /lib/x86_64-linux-gnu/libutil.so.1 (0x00007f4659149000)
        libnvJitLink.so.12 => [PROJECT PATH]/.venv/lib/python3.12/site-packages/torch/lib/../../nvidia/cusparse/lib/../../nvjitlink/lib/libnvJitLink.so.12 (0x00007f45f9c00000)
```
- without appending, `ldd` doesn't print correct lookup
```
        linux-vdso.so.1 (0x00007ffe5b578000)
        libc10.so => not found
        libtorch_python.so => not found
        libcudart.so.12 => /usr/local/cuda-12.3/targets/x86_64-linux/lib/libcudart.so.12 (0x00007ffbdf600000)
        libc10_cuda.so => not found
        libnccl.so.2 => /lib/x86_64-linux-gnu/libnccl.so.2 (0x00007ffbcf8ea000)
        libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007ffbcf6be000)
        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007ffbdfa75000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffbcf495000)
        /lib64/ld-linux-x86-64.so.2 (0x00007ffbdfacd000)
        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007ffbdfa70000)
        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007ffbdfa6b000)
        librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007ffbdfa66000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007ffbdf97d000)
```
## Appending `LD_LIBRARY_PATH` when running `uv run -m`
doesn't help, still produce `undefined symbol: _ZNK3c1011StorageImpl27throw_data_ptr_access_errorEv`
## Note
Using `conda`'s pip to do dev installation and run the module was successful.

### Platform

Ubuntu 2

### Version

uv 0.6.7

### Python version

Python 3.12.9

---

_Label `bug` added by @jackalcooper on 2025-03-18 15:26_

---

_Closed by @jackalcooper on 2025-03-19 06:22_

---
