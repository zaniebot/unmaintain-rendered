<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv_build fails to build if directory symlink found in package path - astral-sh/uv #15243</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv_build fails to build if directory symlink found in package path</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15243">#15243</a>
        opened by <a href="https://github.com/dusktreader">@dusktreader</a>
        on 2025-08-12 16:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dusktreader">@dusktreader</a></div>
            <div class="timeline-body">Summary
Bug Description
<p>If the package path for a package project type includes a symlink to a directory, the uv_build backend fails.</p>
Reproduction
<ol>
<li>Create a new package project with <code>uv init</code>:<pre><code>mkdir dummy &amp;&amp; cd dummy &amp;&amp; uv init --package
</code></pre>
</li>
<li>Add an assets directory with a single text file in the project root:<pre><code>mkdir assets &amp;&amp; echo &quot;dummy text file&quot; &gt; assets/dummy.txt
</code></pre>
</li>
<li>Create a symlink in the package directory to the assets directory:<pre><code>cd src/dummy &amp;&amp; ln -s ../../assets assets &amp;&amp; cd -
</code></pre>
</li>
<li>Build<pre><code>uv build
</code></pre>
</li>
</ol>
<p>The final step will produce an error:</p>
<pre><code>► uv build
Building source distribution (uv build backend)...
  × Failed to build `.../dummy`
  ├─▶ Failed to write to dist/dummy-0.1.0.tar.gz
  ╰─▶ failed to read from file `.../dummy/src/dummy/assets`: Is a directory (os error 21)
</code></pre>
Expected
<p>When building with hatchling, the package may contain symlinks to directories. These are treated as normal directories and the resulting package build includes non-symlink directories with the expected contents. I would expect uv_build to produce the same results.</p>
Platform
<p>macos 15.5</p>
Version
<p>0.8.4</p>
Python version
<p>3.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dusktreader">@dusktreader</a> on 2025-08-12 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-12 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-12 17:07</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">build-backend</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-09-05 12:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/konstin">@konstin</a> by <a href="https://github.com/konstin">@konstin</a> on 2025-09-09 07:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-09-09 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/konstin">@konstin</a> on 2025-09-09 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jduf">@jduf</a> on 2025-09-23 14:37</div>
            <div class="timeline-body"><p>I also have the same problem with uv 0.8.17 on MacOS 15.6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-09-23 15:27</div>
            <div class="timeline-body"><p>Is there a reason you can&#x27;t place the directory inside the <code>src</code> directory instead of symlinking?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dusktreader">@dusktreader</a> on 2025-09-23 17:03</div>
            <div class="timeline-body"><blockquote>
<p>Is there a reason you can&#x27;t place the directory inside the <code>src</code> directory instead of symlinking?</p>
</blockquote>
<p>Yes, I&#x27;m writing a multi-lingual package where each implementation depends on the same assets that live in a directory in the project root. It looks something like:</p>
<pre><code>jawa-lib/
|- schemas/                            # these are shared among each implementation
|- py                                  # this is the python implementation
|  |- pyproject.toml
|  |- src
|     |- py-jawa/
|        |- schemas -&gt; ../../schemas
|- ts                                  # this is the typescript/javascript implementation
|  |- package.json
|  |- src
|     |- ts-jawa/
|        |- schemas -&gt; ../../schemas
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bersace">@bersace</a> on 2025-11-20 14:57</div>
            <div class="timeline-body"><p>Same here. We use symlink to deduplicate files between workspace members. Setuptools is fine, not uv_build.</p>
<p>uv is awesome, btw !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TDYQ-Liu">@TDYQ-Liu</a> on 2025-12-14 08:22</div>
            <div class="timeline-body"><p>Same here.</p>
<pre><code>path/main$ uv build --wheel 
Building wheel...
Error: failed to read from file `some_path/mypkg/main/src/mypkg/another_pkg`: Is a directory (os error 21)
  × Failed to build `some_path/mypkg/main`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `uv_build.build_wheel` failed (exit status: 1)
      hint: This usually indicates a problem with the package or the build
      environment.
</code></pre>
<p>In order to solve this problem, I have written a bash script to deal with it. Hoping to support symbolic package directory in the future uv version.</p>
<pre><code>#!/usr/bin/bash
PKGNAME=$(basename &quot;$(find ./src/ -mindepth 1 -maxdepth 1 -type d)&quot;)
DIRS=$(find .. -maxdepth 1 -mindepth 1 -type d ! -name &quot;$(basename &quot;$(pwd)&quot;)&quot;)

function build {
    clean_and_copy
    uv
    clean_and_create
}

function clean_and_copy {
    find ./src/&quot;$PKGNAME&quot;/ -maxdepth 1 -type l -exec rm -rf {} +

    for d in $DIRS; do
        base=$(basename &quot;$d&quot;)
        source=&quot;$d&quot;/src/&quot;$base&quot;
        cp -r &quot;$source&quot; ./src/&quot;$PKGNAME&quot;/
    done
}

function uv {
    command uv build --wheel
}

function clean_and_create {
    for d in $DIRS; do
        base=$(basename &quot;$d&quot;)
        source=&quot;$d&quot;/src/&quot;$base&quot;
        rm -rf ./src/&quot;$PKGNAME&quot;/&quot;$base&quot;
        ln -sr &quot;$source&quot; ./src/&quot;$PKGNAME&quot;/
    done
}

build
</code></pre>
<pre><code>.
├── build.sh
├── dist
├── pyproject.toml
├── README.md
├── src
│   └── mypkg
└── uv.lock

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bersace">@bersace</a> on 2025-12-15 07:48</div>
            <div class="timeline-body"><p>Finally, I created a workspace with the library as an unpublished, unversionned project. Vendoring this library is quite clunky but as it&#x27;s an app released only as rpm/deb, that&#x27;s ok.</p>
<p>Would be nice if uv implements something like go vendoring.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:58 UTC
    </footer>
</body>
</html>
