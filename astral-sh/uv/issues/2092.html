<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv venv` doesn't add PyPy executables - astral-sh/uv #2092</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv venv` doesn't add PyPy executables</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/2092">#2092</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2024-02-29 18:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 18:05</div>
            <div class="timeline-body"><p>We don't officially support PyPy right now, this is more a note for the future, but we need to include a variety of <code>pypy</code> binaries / symlinks:</p>
<pre><code>❯ ls .venv/bin
Activate.ps1  activate      activate.csh  activate.fish pip           pip3          pip3.9        pypy          pypy3         pypy3.9       python        python3       python3.9
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">pypy</span> added by @charliermarsh on 2024-02-29 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 18:46</div>
            <div class="timeline-body"><p>@gaborbernat - A related question: how does <code>virtualenv</code> &quot;know&quot; to create site-packages for PyPy at <code>.venv/lib/pypy3.10/site-packages</code> instead of <code>.venv/lib/python3.10/site-packages</code>? Is that encoded in <code>virtualenv</code> somewhere? Or is it read from the interpreter? Was trying to find it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-02-29 18:52</div>
            <div class="timeline-body"><p>That's done here https://github.com/pypa/virtualenv/blob/main/src/virtualenv/create/via_global_ref/builtin/pypy/pypy3.py#L31 and https://github.com/pypa/virtualenv/blob/main/src/virtualenv/create/via_global_ref/builtin/pypy/common.py#L41. It knows to do that just for PyPy because of https://github.com/pypa/virtualenv/blob/main/src/virtualenv/create/via_global_ref/builtin/pypy/common.py#L13. The purelib/platlib paths are using the sysconfig information, which is inquired as part of https://github.com/pypa/virtualenv/blob/main/src/virtualenv/discovery/py_info.py#L80-L103.</p>
<p>Note that <code>.venv/lib/pypy3.10/site-packages</code> is often refered to as purelib, and in CPython by default this aligns up with platlib, but CPython allows distributions to move this to their desired path. So ultimately, the question is: When you say <code>.venv/lib/pypy3.10/site-packages</code> are you refering to platlib or purelib?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 18:58</div>
            <div class="timeline-body"><p>Ah yeah, I'm referring to <code>purelib</code>. (Though I haven't really done the work yet to understand what happens when you, e.g., <code>pip uninstall</code> and <code>purelib</code> and <code>platlib</code> are not the same thing.)</p>
<p>If <code>sysconfig</code> is returning the <code>purelib</code> and <code>platlib</code> paths for the invoked interpreter, where / how do those get translated to paths for the virtualenv? E.g.:</p>
<pre><code class="language-python">&gt;&gt;&gt; sysconfig.get_paths(scheme=&quot;venv&quot;)
{'stdlib': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/lib/python3.12', 'platstdlib': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/lib/python3.12', 'purelib': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/lib/python3.12/site-packages', 'platlib': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/lib/python3.12/site-packages', 'include': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/include/python3.12', 'platinclude': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/include/python3.12', 'scripts': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0/bin', 'data': '/Users/crmarsh/.local/share/rtx/installs/python/3.12.0'}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-02-29 19:04</div>
            <div class="timeline-body"><p>That depends. You can get the schema and inject your config vars of sys.prefix to calculate where it should go.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gaborbernat">@gaborbernat</a> on 2024-02-29 19:05</div>
            <div class="timeline-body"><p>See https://github.com/pypa/virtualenv/blob/main/src/virtualenv/discovery/py_info.py#L224</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 20:36</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-29 20:48</div>
            <div class="timeline-body"><p>Filed some info in https://github.com/astral-sh/uv/issues/2095. (No obligation to chime in there.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-09 20:05</div>
            <div class="timeline-body"><p>@edgarrmondragon - when you’re in a PyPy virtualenv, do you typically invoke Python as “pypy” or “python”? I’m trying to make some decisions around this with respect to #2316.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/edgarrmondragon">@edgarrmondragon</a> on 2024-03-11 05:16</div>
            <div class="timeline-body"><blockquote>
<p>@edgarrmondragon - when you’re in a PyPy virtualenv, do you typically invoke Python as “pypy” or “python”? I’m trying to make some decisions around this with respect to #2316.</p>
</blockquote>
<p>Actually, always as <code>python</code> or <code>python3.x</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-07-15 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2024-07-15 18:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 05:33:58 UTC
    </footer>
</body>
</html>
