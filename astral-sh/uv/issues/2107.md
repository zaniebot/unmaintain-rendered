```yaml
number: 2107
title: "`uv pip install --python=.venv/bin/python` error: failed to create file `/usr/.lock`"
type: issue
state: closed
author: gschaffner
labels:
  - bug
assignees: []
created_at: 2024-03-01T11:12:55Z
updated_at: 2024-03-01T18:12:51Z
url: https://github.com/astral-sh/uv/issues/2107
synced_at: 2026-01-10T01:57:04Z
```

# `uv pip install --python=.venv/bin/python` error: failed to create file `/usr/.lock`

---

_Issue opened by @gschaffner on 2024-03-01 11:12_

here's a reproducer (latest is v0.1.13 at time of writing): `cargo build --target=x86_64-unknown-linux-musl --features=vendored-libgit2,vendored-openssl` and then

```bash
#!/usr/bin/env -S sh -c '< "$0" podman run --rm -i -v=./target/x86_64-unknown-linux-musl/debug/uv:/usr/bin/uv:ro --pull=newer docker.io/archlinux/archlinux bash "$@"'

shopt -s inherit_errexit
set -o errexit -o errtrace -o nounset -o pipefail -o xtrace

pacman --noconfirm -Syu sudo
useradd --create-home --groups=wheel user
echo '%wheel ALL=(ALL:ALL) NOPASSWD: ALL' > /etc/sudoers.d/wheel
<<'EOF' sudo -u user bash
    shopt -s inherit_errexit
    set -o errexit -o errtrace -o nounset -o pipefail -o xtrace

    cd ~
    sudo pacman --noconfirm -S python
    uv venv
    # uv pip install uv  # succeeds
    uv pip install --python=.venv/bin/python uv  # fails
EOF
```

this also reproduces on `docker.io/debian:stable-slim`. it also reproduces on my Arch Linux host if i remove pyenv from `$PATH` s.t. `which python` -> `/usr/bin/python`.

possibly the problem is that `PythonEnvironment::from_requested_python` is using the installation's (base) prefix for the root instead of using the venv's prefix? the following patchset seems to work: https://github.com/astral-sh/uv/compare/main...ea8257a25404ce1bbec32d601df60670266585af

---

_Comment by @charliermarsh on 2024-03-01 13:55_

Ah yeah, that should be prefix - thanks! PR welcome if youâ€™re interested.

---

_Label `bug` added by @konstin on 2024-03-01 13:56_

---

_Comment by @charliermarsh on 2024-03-01 17:55_

Fixing now so I can include in release.

---

_Referenced in [astral-sh/uv#2117](../../astral-sh/uv/pulls/2117.md) on 2024-03-01 17:58_

---

_Assigned to @charliermarsh by @charliermarsh on 2024-03-01 17:58_

---

_Closed by @charliermarsh on 2024-03-01 18:12_

---
