<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv run / uvx does not support virtual workspaces - astral-sh/uv #15812</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv run / uvx does not support virtual workspaces</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15812">#15812</a>
        opened by <a href="https://github.com/seandlg">@seandlg</a>
        on 2025-09-12 14:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seandlg">@seandlg</a></div>
            <div class="timeline-body">Summary
<p>When building a virtual workspace locally</p>
<pre><code>git clone https://github.com/astral-sh/uv.git
cd uv/scripts/workspaces/albatross-virtual-workspace
uv build
</code></pre>
<p>this works, with warnings:</p>
<pre><code>uv build
Building source distribution...
warning: `/Users/seandlg/Coding/Playground/uv/scripts/workspaces/albatross-virtual-workspace` appears to be a workspace root without a Python project; consider using `uv sync` to install the workspace, or add a `[build-system]` table to `pyproject.toml`
No parent package detected, impossible to derive `name`
running egg_info
writing UNKNOWN.egg-info/PKG-INFO
writing dependency_links to UNKNOWN.egg-info/dependency_links.txt
writing top-level names to UNKNOWN.egg-info/top_level.txt
reading manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
writing manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
No parent package detected, impossible to derive `name`
running sdist
running egg_info
writing UNKNOWN.egg-info/PKG-INFO
writing dependency_links to UNKNOWN.egg-info/dependency_links.txt
writing top-level names to UNKNOWN.egg-info/top_level.txt
reading manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
writing manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
warning: sdist: standard file not found: should have one of README, README.rst, README.txt, README.md

running check
warning: check: missing required meta-data: name

creating unknown-0.0.0
creating unknown-0.0.0/UNKNOWN.egg-info
creating unknown-0.0.0/packages/albatross
creating unknown-0.0.0/packages/albatross/src/albatross
creating unknown-0.0.0/packages/seeds/src/seeds
copying files to unknown-0.0.0...
copying pyproject.toml -&gt; unknown-0.0.0
copying UNKNOWN.egg-info/PKG-INFO -&gt; unknown-0.0.0/UNKNOWN.egg-info
copying UNKNOWN.egg-info/SOURCES.txt -&gt; unknown-0.0.0/UNKNOWN.egg-info
copying UNKNOWN.egg-info/dependency_links.txt -&gt; unknown-0.0.0/UNKNOWN.egg-info
copying UNKNOWN.egg-info/top_level.txt -&gt; unknown-0.0.0/UNKNOWN.egg-info
copying packages/albatross/check_installed_albatross.py -&gt; unknown-0.0.0/packages/albatross
copying packages/albatross/src/albatross/__init__.py -&gt; unknown-0.0.0/packages/albatross/src/albatross
copying packages/seeds/src/seeds/__init__.py -&gt; unknown-0.0.0/packages/seeds/src/seeds
copying UNKNOWN.egg-info/SOURCES.txt -&gt; unknown-0.0.0/UNKNOWN.egg-info
Writing unknown-0.0.0/setup.cfg
Creating tar archive
removing &#x27;unknown-0.0.0&#x27; (and everything under it)
Building wheel from source distribution...
No parent package detected, impossible to derive `name`
running egg_info
writing UNKNOWN.egg-info/PKG-INFO
writing dependency_links to UNKNOWN.egg-info/dependency_links.txt
writing top-level names to UNKNOWN.egg-info/top_level.txt
reading manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
writing manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
No parent package detected, impossible to derive `name`
running bdist_wheel
running build
running build_py
creating build/lib/packages/albatross
copying packages/albatross/check_installed_albatross.py -&gt; build/lib/packages/albatross
creating build/lib/packages/seeds/src/seeds
copying packages/seeds/src/seeds/__init__.py -&gt; build/lib/packages/seeds/src/seeds
creating build/lib/packages/albatross/src/albatross
copying packages/albatross/src/albatross/__init__.py -&gt; build/lib/packages/albatross/src/albatross
installing to build/bdist.macosx-11.0-arm64/wheel
running install
running install_lib
creating build/bdist.macosx-11.0-arm64/wheel
creating build/bdist.macosx-11.0-arm64/wheel/packages
creating build/bdist.macosx-11.0-arm64/wheel/packages/seeds
creating build/bdist.macosx-11.0-arm64/wheel/packages/seeds/src
creating build/bdist.macosx-11.0-arm64/wheel/packages/seeds/src/seeds
copying build/lib/packages/seeds/src/seeds/__init__.py -&gt; build/bdist.macosx-11.0-arm64/wheel/./packages/seeds/src/seeds
creating build/bdist.macosx-11.0-arm64/wheel/packages/albatross
copying build/lib/packages/albatross/check_installed_albatross.py -&gt; build/bdist.macosx-11.0-arm64/wheel/./packages/albatross
creating build/bdist.macosx-11.0-arm64/wheel/packages/albatross/src
creating build/bdist.macosx-11.0-arm64/wheel/packages/albatross/src/albatross
copying build/lib/packages/albatross/src/albatross/__init__.py -&gt; build/bdist.macosx-11.0-arm64/wheel/./packages/albatross/src/albatross
running install_egg_info
running egg_info
writing UNKNOWN.egg-info/PKG-INFO
writing dependency_links to UNKNOWN.egg-info/dependency_links.txt
writing top-level names to UNKNOWN.egg-info/top_level.txt
reading manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
writing manifest file &#x27;UNKNOWN.egg-info/SOURCES.txt&#x27;
Copying UNKNOWN.egg-info to build/bdist.macosx-11.0-arm64/wheel/./UNKNOWN-0.0.0-py3.14.egg-info
running install_scripts
creating build/bdist.macosx-11.0-arm64/wheel/unknown-0.0.0.dist-info/WHEEL
creating &#x27;/Users/seandlg/Coding/Playground/uv/scripts/workspaces/albatross-virtual-workspace/dist/.tmp-k2kn3bdk/unknown-0.0.0-py3-none-any.whl&#x27; and adding &#x27;build/bdist.macosx-11.0-arm64/wheel&#x27; to it
adding &#x27;packages/albatross/check_installed_albatross.py&#x27;
adding &#x27;packages/albatross/src/albatross/__init__.py&#x27;
adding &#x27;packages/seeds/src/seeds/__init__.py&#x27;
adding &#x27;unknown-0.0.0.dist-info/METADATA&#x27;
adding &#x27;unknown-0.0.0.dist-info/WHEEL&#x27;
adding &#x27;unknown-0.0.0.dist-info/top_level.txt&#x27;
adding &#x27;unknown-0.0.0.dist-info/RECORD&#x27;
removing build/bdist.macosx-11.0-arm64/wheel
Successfully built dist/unknown-0.0.0.tar.gz
Successfully built dist/unknown-0.0.0-py3-none-any.whl
</code></pre>
<p>However, when attempting to load this workspace with <code>uv run</code> I observe the following error:</p>
<pre><code>uv run --isolated --with &#x27;git+https://github.com/astral-sh/uv.git@main#subdirectory=scripts/workspaces/albatross-virtual-workspace&#x27; python3
      Built albatross @ file:///Users/seandlg/Coding/Playground/uv/scripts/workspaces/albatross-virtual-workspace/packages/albatross
      Built bird-feeder @ file:///Users/seandlg/Coding/Playground/uv/scripts/workspaces/albatross-virtual-workspace/packages/bird-feeder
      Built seeds @ file:///Users/seandlg/Coding/Playground/uv/scripts/workspaces/albatross-virtual-workspace/packages/seeds
Installed 7 packages in 9ms
⠙ Resolving dependencies...
warning: `/Users/seandlg/.cache/uv/git-v0/checkouts/5d8dbe36cd6ea14f/8f3583a6e/scripts/workspaces/albatross-virtual-workspace` appears to be a workspace root without a Python project; consider using `uv sync` to install the workspace, or add a `[build-system]` table to `pyproject.toml`
  × Failed to resolve `--with` requirement
  ╰─▶ Failed to parse metadata from built wheel
</code></pre>
<p>and with <code>uvx</code>:</p>
<pre><code>uvx --isolated --from &#x27;git+https://github.com/astral-sh/uv.git@main#subdirectory=scripts/workspaces/albatross-virtual-workspace&#x27; python3
⠹ Resolving dependencies...
warning: `/Users/seandlg/.cache/uv/git-v0/checkouts/5d8dbe36cd6ea14f/8f3583a6e/scripts/workspaces/albatross-virtual-workspace` appears to be a workspace root without a Python project; consider using `uv sync` to install the workspace, or add a `[build-system]` table to `pyproject.toml`
  × Failed to resolve `--with` requirement
  ╰─▶ Failed to parse metadata from built wheel
</code></pre>
<p>I have omitted verbose logs, as these are easy to produce locally. It would be great if <code>uv</code> supported loading packages from virtual workspaces.</p>
<p>For reference, this works flawlessly in non-virtual workspaces:</p>
<pre><code>uv run --isolated --with &#x27;git+https://github.com/astral-sh/uv.git@main#subdirectory=scripts/workspaces/albatross-root-workspace&#x27; python3 -c &#x27;from albatross import fly; fly(); print(&quot;Success!&quot;)&#x27;
Installed 7 packages in 16ms
      Built seeds @ git+https://github.com/astral-sh/uv.git@8f3583a6e63800b770fec3b7be9b754be9d65602#subdirectory=scripts/workspaces/albatross-root-workspace/packag
      Built bird-feeder @ git+https://github.com/astral-sh/uv.git@8f3583a6e63800b770fec3b7be9b754be9d65602#subdirectory=scripts/workspaces/albatross-root-workspace/
      Built albatross @ git+https://github.com/astral-sh/uv.git@8f3583a6e63800b770fec3b7be9b754be9d65602#subdirectory=scripts/workspaces/albatross-root-workspace
Installed 5 packages in 3ms
Success!
</code></pre>
<p>and</p>
<pre><code>uvx --isolated --from &#x27;git+https://github.com/astral-sh/uv.git@main#subdirectory=scripts/workspaces/albatross-root-workspace&#x27; python3 -c &#x27;from albatross import fly; fly(); print(&quot;Success!&quot;)&#x27;
Success!
</code></pre>
<p>A side note: It&#x27;s great that <code>uv</code> includes <a href="https://github.com/astral-sh/uv/tree/main/scripts/workspaces">reference workspaces in this repository</a>; I think these should be linked in the public documentation. Happy to provide an MR, if you agree.</p>
Platform
<p>macOS 15.6.1</p>
Version
<p>uv 0.8.17 (Homebrew 2025-09-10)</p>
Python version
<p>3.13.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/seandlg">@seandlg</a> on 2025-09-12 14:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-12 14:54</div>
            <div class="timeline-body"><p>Thanks for the clear write-up. Can you give an example of what you&#x27;re trying to do with <code>--with</code> pointing to a virtual workspace? Whatever you target with <code>--with</code> has to be built and installed as a package (e.g., it&#x27;s generally for things that you&#x27;d then <code>import</code>), but virtual workspaces by definition aren&#x27;t meant to be built as packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/seandlg">@seandlg</a> on 2025-09-12 16:01</div>
            <div class="timeline-body"><p>Thanks for the quick reply, and sure! I&#x27;m playing with a workflow for debugging parts of a virtual workspace. Constructing an example for <a href="https://github.com/astral-sh/uv/tree/main/scripts/workspaces/albatross-virtual-workspace">albatross-virtual-workspace</a>: If package <code>seeds</code> had <code>src/client.py</code>, s.t.:</p>
<pre><code>import binascii

import httpx


class SeedClient:
    def __init__(self, base_url: str = &quot;https://httpbingo.org/&quot;):
        self.client = httpx.Client(base_url=base_url)

    def get_seed(self, seed_id: str):
        response = self.client.get(f&quot;/bytes/{seed_id}&quot;)
        return binascii.hexlify(response.content).decode()
</code></pre>
<p>I&#x27;d like to use/debug this client using:</p>
<pre><code>uv run --isolated  --with ipython --with &#x27;git+https://github.com/astral-sh/uv.git@main#subdirectory=scripts/workspaces/albatross-virtual-workspace&#x27; ipython
</code></pre>
<p>To be able to do things like:</p>
<pre><code># assume import
In [1]: c = SeedClient()

In [2]: c.get_seed(5)
Out[2]: &#x27;14df57fa82&#x27;
</code></pre>
<hr>
<p>A nice solution could be to allow for pulling only select packages into scope. This does not currently seem to work though, neither for virtual, nor normal workspaces.</p>
<pre><code>uv run --isolated --package albatross --with &#x27;git+https://github.com/astral-sh/uv.git#subdirectory=scripts/workspaces/albatross-root-workspace&#x27; python3
error: Package `albatross` not found in workspace
</code></pre>
<p>I suppose that <code>--package</code> and <code>--all-packages</code> are evaluated before the <code>--with</code> overlays are applied, because otherwise it&#x27;s unclear which <code>--with</code> overlay to resolve the <code>--package</code> from…</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:40:21 UTC
    </footer>
</body>
</html>
