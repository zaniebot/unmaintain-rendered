<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv run with only a dependency-group - astral-sh/uv #8771</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv run with only a dependency-group</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8771">#8771</a>
        opened by <a href="https://github.com/nijel">@nijel</a>
        on 2024-11-03 09:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nijel">@nijel</a> on 2024-11-03 09:37</div>
            <div class="timeline-body"><p>I'd like to execute a tool of version pinned as a dependency group (PEP 735) in <code>pyproject.toml</code>. I was thinking about using <code>uv run</code> for that, but I don't see a way to omit it installing project.</p>
<p>Let's have the following in <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[dependency-groups]
pre-commit = [
  &quot;pre-commit==4.0.1&quot;
]
</code></pre>
<p>What works:</p>
<pre><code>uv sync --only-group pre-commit
.venv/bin/pre-commit run --all
</code></pre>
<p>What I'd like to use:</p>
<pre><code>uv run --only-group pre-commit pre-commit run --all
</code></pre>
<p>But this does install whole project (what takes long and needs additional system deps thus fails at CI). On the other side, I don't care if the project is actually installed and keeping it installed is also fine (unlike the <code>uv sync</code> approach above).</p>
<p>Maybe I'm just unable to find the command and/or parameters in the documentation...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-03 13:10</div>
            <div class="timeline-body"><p><code>uv run --only-group pre-commit --no-install-project</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-03 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nijel">@nijel</a> on 2024-11-03 15:12</div>
            <div class="timeline-body"><p>Is this something in the upcoming release? I'm using 0.4.29:</p>
<pre><code>$ uv run --no-install-project --only-group pre-commit pre-commit run
error: unexpected argument '--no-install-project' found

  tip: a similar argument exists: '--no-reinstall'

Usage: uv run [OPTIONS] [COMMAND]

For more information, try '--help'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-03 15:19</div>
            <div class="timeline-body"><p>I think we actually only support that option in <code>uv sync</code>, since we only intended it to be used for constructing the environment in separate steps not actually running commands in a partial environment. <code>--only-group</code> is supposed to omit the project — I'm surprised that it does not in <code>uv run</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-03 21:22</div>
            <div class="timeline-body"><p>I just confirmed locally that <code>--only-group pre-commit</code> doesn't actually install the project. Does your project have dynamic metadata or something @nijel? Something that would <em>require</em> us to build the project, in order to resolve the dependencies or versions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nijel">@nijel</a> on 2024-11-04 07:01</div>
            <div class="timeline-body"><p>Yes, it has a dynamic version. I somehow didn't expect that would trigger build just to figure out the package version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nijel">@nijel</a> on 2024-11-04 07:12</div>
            <div class="timeline-body"><p>But even removing the dynamic version doesn't solve this. It appears that the dependency resolution happens, what in turn triggers building packages which are not available as wheels. These are then not installed in the virtualenv (I should have noticed this earlier, but I assumed that when uv builds wheels, it builds them to install them).</p>
<p>This is the beginning of the verbose log:</p>
<pre><code>$ uv run -v  --only-group pre-commit pre-commit run
DEBUG uv 0.4.29
DEBUG Found project root: `/tmp/weblate`
DEBUG No workspace root found, using project root
DEBUG Discovered project `weblate` at: /tmp/weblate
DEBUG Searching for Python &gt;=3.11 in managed installations or system path
DEBUG Searching for managed installations at `/home/nijel/.local/share/uv/python`
DEBUG Found managed installation `cpython-3.13.0rc2-linux-x86_64-gnu`
DEBUG Found `cpython-3.13.0rc2-linux-x86_64-gnu` at `/home/nijel/.local/share/uv/python/cpython-3.13.0rc2-linux-x86_64-gnu/bin/python3.13` (managed installations)
DEBUG Skipping pre-release cpython-3.13.0rc2-linux-x86_64-gnu
DEBUG Found `cpython-3.11.2-linux-x86_64-gnu` at `/usr/bin/python3` (search path)
Using CPython 3.11.2 interpreter at: /usr/bin/python3
Creating virtual environment at: .venv
DEBUG Using request timeout of 30s
DEBUG Found static `pyproject.toml` for: weblate @ file:///tmp/weblate
DEBUG No workspace root found, using project root
DEBUG Solving with installed Python version: 3.11.2
DEBUG Solving with target Python version: &gt;=3.11
DEBUG Adding direct dependency: weblate*
DEBUG Adding direct dependency: weblate[alibaba]*
DEBUG Adding direct dependency: weblate[all]*
DEBUG Adding direct dependency: weblate[amazon]*
DEBUG Adding direct dependency: weblate[antispam]*
DEBUG Adding direct dependency: weblate[gerrit]*
DEBUG Adding direct dependency: weblate[google]*
DEBUG Adding direct dependency: weblate[ldap]*
DEBUG Adding direct dependency: weblate[mercurial]*
DEBUG Adding direct dependency: weblate[mysql]*
DEBUG Adding direct dependency: weblate[openai]*
DEBUG Adding direct dependency: weblate[postgres]*
DEBUG Adding direct dependency: weblate[saml]*
DEBUG Adding direct dependency: weblate[zxcvbn]*
DEBUG Searching for a compatible version of weblate @ file:///tmp/weblate (*)
DEBUG Adding transitive dependency for weblate==1: weblate==1
DEBUG Adding transitive dependency for weblate==1: weblate[zxcvbn]==1
DEBUG Searching for a compatible version of weblate @ file:///tmp/weblate (==1)
DEBUG Adding transitive dependency for weblate==1: aeidon&gt;=1.14.1, &lt;1.16
DEBUG Adding transitive dependency for weblate==1: ahocorasick-rs&gt;=0.20.0, &lt;0.23.0
DEBUG Adding transitive dependency for weblate==1: borgbackup&gt;=1.2.5, &lt;1.5
</code></pre>
<p>The <code>pyproject.toml</code> is here: https://github.com/WeblateOrg/weblate/blob/2430e2a888312f024e4c90e3c336d0ee76166014/pyproject.toml (I only edited it to get rid of the dynamic version).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../WeblateOrg/weblate/pulls/12925.html">WeblateOrg/weblate#12925</a> on 2024-11-04 07:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 12:29</div>
            <div class="timeline-body"><p>We still need to create a lockfile for the full project — there are no &quot;partial&quot; locks at this time. We should skip doing the resolution if the lockfile is up to date. You can use <code>--frozen</code> to skip checking if it is up to date entirely, but then you might not have the correct dependencies.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nijel">@nijel</a> on 2024-11-04 12:35</div>
            <div class="timeline-body"><p>Ah, creating lockfile explains it. I will probably use <code>--frozen</code> for now.</p>
<p>Still, having a way to avoid complex dependency resolution to run a single command based on dependencies specified in a dependency group would be useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 12:37</div>
            <div class="timeline-body"><p>It's sort of antithetical to the intent of the lockfile though. For example, you shouldn't get different versions of the packages in your dependency group depending on if you run it with <code>--only-group</code> or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nijel">@nijel</a> on 2024-11-04 13:16</div>
            <div class="timeline-body"><p>Actually, I was not aware of the lock file before, and I had no intention to use it. I understand that it might be useful (and I will give it a try), but what I really wanted is to use dependency groups to pin tool versions and then use uv to execute the pinned version. If using lock file is the way to do it, I will give it a try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-04 13:23</div>
            <div class="timeline-body"><p>Yeah I'd recommend just adding pre-commit with a lower bound and the lockfile will take care of pinning the version for you.</p>
<p>I understand it's a bit more complicated, but the goal is to create a consistent experience when working on projects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @nijel on 2024-11-05 13:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:23 UTC
    </footer>
</body>
</html>
