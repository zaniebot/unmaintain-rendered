<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv remove --group any_group any_package. All deps are removed. - astral-sh/uv #9012</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv remove --group any_group any_package. All deps are removed.</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/9012">#9012</a>
        opened by <a href="https://github.com/VladislavSoren">@VladislavSoren</a>
        on 2024-11-11 10:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/VladislavSoren">@VladislavSoren</a> on 2024-11-11 10:16</div>
            <div class="timeline-body"><p>Is this correct behavior?</p>
<p>Info:</p>
<ul>
<li>MacOS</li>
<li>uv 0.5.0</li>
<li>python 3.9.18</li>
</ul>
<p><img src="https://github.com/user-attachments/assets/26eb86fe-7ad0-4f8d-b808-7c6dd83ea960" alt="Screenshot 2024-11-11 at 13 07 34" /></p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-11 13:45</div>
            <div class="timeline-body"><p>Was <code>&quot;six&quot;</code> removed from the <code>pyproject.toml</code>, or just the virtual environment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-11-11 13:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VladislavSoren">@VladislavSoren</a> on 2024-11-11 15:03</div>
            <div class="timeline-body"><blockquote>
<p>Was <code>&quot;six&quot;</code> removed from the <code>pyproject.toml</code>, or just the virtual environment?</p>
</blockquote>
<p>I had three packages in my virtual environment: six, pillow and lxml.
With the command uv remove --group gr2 lxml
I wanted to remove only one package
Expected behavior - the package will be removed from all files (tom and lock) and from the virtual environment
In fact - the package is removed from all files (toml and lock) AND all packages are removed from the virtual environment.
In this regard, all dependencies need to be reinstalled.
Is this how it should work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-11 15:05</div>
            <div class="timeline-body"><p>It's not really clear from <code>uv remove --group gr2 lxml</code> what we should do when we re-sync the project. We can't just remove <code>lxml</code> -- it might still be a requirement, or a requirement of one of your requirements. So we just re-sync with the project's default dependencies, which excludes the group.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-11-11 16:34</div>
            <div class="timeline-body"><p>The behavior for optional dependencies seems to differ here. When using <code>uv remove</code>, the re-sync will automatically include all of the extras. We should probably do the same for both, wdyt?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VladislavSoren">@VladislavSoren</a> on 2024-11-11 18:34</div>
            <div class="timeline-body"><blockquote>
<p>It's not really clear from <code>uv remove --group gr2 lxml</code> what we should do when we re-sync the project. We can't just remove <code>lxml</code> -- it might still be a requirement, or a requirement of one of your requirements. So we just re-sync with the project's default dependencies, which excludes the group.</p>
</blockquote>
<p>Does resynchronization mean deleting all packages?
It turns out that this is the intended algorithm:</p>
<ol>
<li>The dependency in the group is deleted</li>
<li>The files are deleted from the toml and local</li>
<li>The virtual environment is cleared
And we need to force a separate command to start resynchronization via `uv sync --group gr1  --group gr2?</li>
</ol>
<p>If I'm wrong, please tell me how the change (deletion, addition, update) in dependency groups was intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-11 18:37</div>
            <div class="timeline-body"><p>Re-synchronization means removing any extraneous packages. It's identical to running <code>uv sync</code> at the end of the command (with no additional arguments), which would (correctly) remove the dependencies in those groups, since they're not marked as default groups.</p>
<p>From <code>uv remove --group gr2 lxml</code> alone, it's just not really clear what we should do. We could include all groups, but then we'd often be installing <em>more</em> unrelated packages at the end of <code>uv remove</code>. We could not sync at all -- that's another option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VladislavSoren">@VladislavSoren</a> on 2024-11-11 18:40</div>
            <div class="timeline-body"><blockquote>
<p>The behavior for optional dependencies seems to differ here. When using <code>uv remove</code>, the re-sync will automatically include all of the extras. We should probably do the same for both, wdyt?</p>
</blockquote>
<p>It is not a problem to re-synchronize by entering the necessary command.
Usually, when deleting a package from a virtual environment, all other packages were NOT deleted. I want to understand why it was done this way, because there may be some complex logic in the CI/CD pipelines and reinstalling all dependencies will slightly, but still affect the speed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-11 18:47</div>
            <div class="timeline-body"><p>I'm trying to explain the model to you. At the end of <code>uv remove</code>, we perform a <code>uv sync</code>. <code>uv sync</code> will sync the default groups and extras in your project. That could mean removing installed packages. You can pass <code>--no-sync</code> to avoid this. In the future, we could be smarter about what we remove, but it's not trivial.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-11 18:50</div>
            <div class="timeline-body"><p>In short, we want to remove anything was previously required but is no longer required, so we have to diff the resolutions. That may or may not include the package that you specified with <code>uv remove</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-11-11 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2024-11-11 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VladislavSoren">@VladislavSoren</a> on 2024-11-13 08:49</div>
            <div class="timeline-body"><blockquote>
<p>In short, we want to remove anything was previously required but is no longer required, so we have to diff the resolutions. That may or may not include the package that you specified with <code>uv remove</code>.</p>
</blockquote>
<p>Thank you for your answers</p>
<p>I have determined that for my tasks it is optimal to add a section
[dependency-groups] with two groups main and common.
This way they will be added to the environment via regular uv sync</p>
<p>And for optional dependencies add a section [project.optional-dependencies] with two groups development and test.
They will be added to the project via the flag â€”extra (uv sync --extra development).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VladislavSoren">@VladislavSoren</a> on 2024-11-13 08:52</div>
            <div class="timeline-body"><p>However, there is strange behavior when deleting dependencies again</p>
<p>Example toml</p>
<pre><code>[dependency-groups]
main = [
&quot;six==1.15.0&quot;,
]
[project.optional-dependencies]
development = [
&quot;django-debug-toolbar==4.4.2&quot;,
&quot;pytest&gt;=8.2.1&quot;,
]

[tool.uv]
default-groups = [&quot;main&quot;]
</code></pre>
<p>With <code>uv sync</code> - the six package will be installed
With <code>uv add --group main requests==2.31.0</code> - requests will be installed and will pull in the necessary dependencies
With <code>uv remove --group main requests</code> - all requests dependencies are removed, but all dependencies for the optional development group are installed.
Very strange behavior</p>
<p>Does it make sense to open an issue on this problem?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-13 16:47</div>
            <div class="timeline-body"><p>@VladislavSoren -- It's the same underlying issue. We'll fix it. It's just not a good approach right now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-11-13 16:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VladislavSoren">@VladislavSoren</a> on 2024-11-13 17:20</div>
            <div class="timeline-body"><blockquote>
<p>@VladislavSoren -- It's the same underlying issue. We'll fix it. It's just not a good approach right now.</p>
</blockquote>
<p>i've got it. Thank u!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-11-13 18:11</div>
            <div class="timeline-body"><p>Thanks for bringing it up. We have some TODOs around this in the codebase but I think we'd just been putting it off until users started hitting it given everything else we had to prioritize.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/9973.html">astral-sh/uv#9973</a> on 2024-12-17 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-12-17 15:26</div>
            <div class="timeline-body"><p>Hi everyone, I failed to find this issue before writing a new one (sorry!)</p>
<p>But I still would like to understand how sync behaves and if there are docs that explain the existence of a softer sync than the full sync.</p>
<p>And if it is possible for the sync to remember how it was last used so a package that is locked is never removed unless on the real sync command</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s-lopez">@s-lopez</a> on 2024-12-24 12:42</div>
            <div class="timeline-body"><p>To give another example of the same underlying issue in a similar scenario:</p>
<p>Given the following dependencies in <code>pyproject.toml</code>, which I install with <code>uv sync --all-groups</code>:</p>
<pre><code>dependencies = [
    &quot;aiofiles&gt;=24.1.0&quot;,
    &quot;geopandas&gt;=1.0.1&quot;,
    &quot;networkx&gt;=3.4.2&quot;,
    &quot;openpyxl&gt;=3.1.5&quot;,
    &quot;pyyaml&gt;=6.0.2&quot;,
    &quot;requests&gt;=2.32.3&quot;,
    &quot;tabulate&gt;=0.9.0&quot;,
]

[dependency-groups]
dev = [
    &quot;black&gt;=24.10.0&quot;,
    &quot;flake8&gt;=7.1.1&quot;,
    &quot;flake8-bugbear&gt;=24.10.31&quot;,
    &quot;isort&gt;=5.13.2&quot;,
    &quot;jupyter&gt;=1.1.1&quot;,
    &quot;pep8-naming&gt;=0.14.1&quot;,
    &quot;pytest&gt;=8.3.3&quot;,
    &quot;folium&gt;=0.18.0&quot;,
    &quot;mapclassify&gt;=2.8.1&quot;,
    &quot;pyvis&gt;=0.3.2&quot;,
    &quot;matplotlib&gt;=3.9.3&quot;,
    &quot;snakeviz&gt;=2.2.2&quot;,
]
sagemaker = [&quot;sagemaker&gt;=2.235.2&quot;]
</code></pre>
<p>My expectation running  <code>uv remove aiofiles</code> would be that only <code>aiofiles</code> (plus its own dependencies) are removed. However, <code>uv remove aiofiles</code> results in the following uninstalls:</p>
<pre><code> - aiofiles==24.1.0
 - annotated-types==0.7.0
 - boto3==1.35.72
 - botocore==1.35.72
 - cloudpickle==2.2.1
 - dill==0.3.9
 - docker==7.1.0
 - google-pasta==0.2.0
 - importlib-metadata==6.11.0
 - jmespath==1.0.1
 - markdown-it-py==3.0.0
 - mdurl==0.1.2
 - mock==4.0.3
 - multiprocess==0.70.17
 - pathos==0.3.3
 - pox==0.3.5
 - ppft==1.7.6.9
 - protobuf==4.25.5
 - pydantic==2.10.2
 - pydantic-core==2.27.1
 - rich==13.9.4
 - s3transfer==0.10.4
 - sagemaker==2.235.2
 - sagemaker-core==1.0.16
 - schema==0.7.7
 - smdebug-rulesconfig==1.0.1
 - tblib==3.0.0
 - tqdm==4.67.1
 - zipp==3.21.0
</code></pre>
<p>Which is basically everything in the unrelated <code>sagemaker</code> dependency group, including sub-dependencies.</p>
<p>As a workaround, I can circumvent this by running the <code>--all-groups</code> again:</p>
<pre><code>uv remove aiofiles
uv sync --all-groups
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/liquidcarbon">@liquidcarbon</a> on 2025-03-22 11:30</div>
            <div class="timeline-body"><p>I think the default behavior should be <code>uv remove pkg --no-sync &amp;&amp; uv pip uninstall pkg -p .venv/bin/python</code></p>
<details><summary>this is frustrating</summary>
<p>

<pre><code>(py) [ec2-user@ip-10-92-33-26 remove]$ uv init
Initialized project `remove`
(py) [ec2-user@ip-10-92-33-26 remove]$ uv add cowsay
Using CPython 3.12.8
Creating virtual environment at: .venv
Resolved 2 packages in 2ms
Installed 1 package in 9ms
 + cowsay==6.1
(py) [ec2-user@ip-10-92-33-26 remove]$ uv add requests --group r
Resolved 7 packages in 3ms
Installed 5 packages in 2ms
 + certifi==2025.1.31
 + charset-normalizer==3.4.1
 + idna==3.10
 + requests==2.32.3
 + urllib3==2.3.0
(py) [ec2-user@ip-10-92-33-26 remove]$ uv remove cowsay
Resolved 6 packages in 3ms
Uninstalled 6 packages in 1ms
 - certifi==2025.1.31
 - charset-normalizer==3.4.1
 - cowsay==6.1
 - idna==3.10
 - requests==2.32.3
 - urllib3==2.3.0
(py) [ec2-user@ip-10-92-33-26 remove]$ echo &quot;???&quot;
???
(py) [ec2-user@ip-10-92-33-26 remove]$ uv sync -U --all-groups
Resolved 6 packages in 14ms
Prepared 5 packages in 0.37ms
Installed 5 packages in 2ms
 + certifi==2025.1.31
 + charset-normalizer==3.4.1
 + idna==3.10
 + requests==2.32.3
 + urllib3==2.3.0
(py) [ec2-user@ip-10-92-33-26 remove]$ uv add cowsay
Resolved 7 packages in 3ms
Installed 1 package in 1ms
 + cowsay==6.1
(py) [ec2-user@ip-10-92-33-26 remove]$ uv add httpx --group httpx
Resolved 13 packages in 4ms
Installed 6 packages in 3ms
 + anyio==4.9.0
 + h11==0.14.0
 + httpcore==1.0.7
 + httpx==0.28.1
 + sniffio==1.3.1
 + typing-extensions==4.12.2
(py) [ec2-user@ip-10-92-33-26 remove]$ uv remove httpx --group httpx
Resolved 7 packages in 3ms
Uninstalled 11 packages in 2ms
 - anyio==4.9.0
 - certifi==2025.1.31
 - charset-normalizer==3.4.1
 - h11==0.14.0
 - httpcore==1.0.7
 - httpx==0.28.1
 - idna==3.10
 - requests==2.32.3
 - sniffio==1.3.1
 - typing-extensions==4.12.2
 - urllib3==2.3.0
</code></pre>
</p>
</details> 

<p>what we intend:</p>
<pre><code>(py) [ec2-user@ip-10-92-33-26 remove]$ uv remove cowsay --no-sync &amp;&amp; uv pip uninstall cowsay -p .venv/bin/python
Resolved 12 packages in 4ms
Uninstalled 1 package in 32ms
 - cowsay==6.1
(py) [ec2-user@ip-10-92-33-26 remove]$ uv remove httpx --no-sync &amp;&amp; uv pip uninstall cowsay -p .venv/bin/python
hint: `httpx` is in the `httpx` group (try: `uv remove httpx --group httpx`)   #  &lt;--- helpful!
error: The dependency `httpx` could not be found in `project.dependencies`
(py) [ec2-user@ip-10-92-33-26 remove]$ uv remove httpx --group httpx --no-sync &amp;&amp; uv pip uninstall httpx -p .venv/bin/p
ython
Resolved 6 packages in 3ms
Uninstalled 1 package in 0.59ms
 - httpx==0.28.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13319.html">astral-sh/uv#13319</a> on 2025-05-20 13:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gxxeel">@gxxeel</a> on 2025-06-18 09:59</div>
            <div class="timeline-body"><p>Confirmed, I had the same issue. I fixed it by running an additional <code>uv sync --all-groups</code> command after removing packages from the general group:</p>
<pre><code>dependencies = [
    &quot;alembic&gt;=1.15.2&quot;,
    &quot;authlib&gt;=1.5.2&quot;,
    &quot;dotenv&gt;=0.9.9&quot;,
    &quot;fastapi-jwt&gt;=0.3.0&quot;,
    &quot;fastapi[standard]&gt;=0.115.12&quot;,
    &quot;jinja2&gt;=3.1.6&quot;,
    &quot;passlib[bcrypt]&gt;=1.7.4&quot;,
    &quot;prometheus-client&gt;=0.22.0&quot;,
    &quot;psycopg[binary]&gt;=3.2.8&quot;,
    &quot;pydantic-settings&gt;=2.9.1&quot;,
    &quot;pyjwt&gt;=2.10.1&quot;,
    &quot;python-json-logger&gt;=3.3.0&quot;,
    &quot;requests&gt;=2.32.3&quot;,
    &quot;sqlalchemy[asyncio]&gt;=2.0.40&quot;,
    &quot;uvicorn&gt;=0.34.2&quot;,
]

[dependency-groups]
dev = [
    &quot;pre-commit&gt;=4.2.0&quot;,
    &quot;ruff&gt;=0.11.9&quot;,
    &quot;tach&gt;=0.29.0&quot;,
]
tests = [
    &quot;codecov&gt;=2.1.13&quot;,
    &quot;coverage&gt;=7.8.2&quot;,
    &quot;pytest&gt;=8.3.5&quot;,
    &quot;pytest-asyncio&gt;=0.26.0&quot;,
    &quot;pytest-cov&gt;=6.1.1&quot;,
    &quot;pytest-dotenv&gt;=0.5.2&quot;,
    &quot;pytest-xdist&gt;=3.6.1&quot;,
]
</code></pre>
<p>For example:
When I delete any dependency from the general group, it also deletes every dependency from the tests group:</p>
<pre><code> &gt; uv remove fastapi-jwt-auth

Resolved 90 packages in 537ms
Uninstalled 12 packages in 42ms
 - codecov==2.1.13
 - coverage==7.8.2
 - execnet==2.1.1
 - fastapi-jwt-auth==0.2.0
 - iniconfig==2.1.0
 - packaging==25.0
 - pluggy==1.6.0
 - pytest==8.3.5
 - pytest-asyncio==0.26.0
 - pytest-cov==6.1.1
 - pytest-dotenv==0.5.2
 - pytest-xdist==3.6.1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/peacefulotter">@peacefulotter</a> on 2025-08-19 14:51</div>
            <div class="timeline-body"><p>Still having this issue; removing a single package removes all my optional dependencies and I have to run uv sync afterwards.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/liquidcarbon">@liquidcarbon</a> on 2025-08-19 15:03</div>
            <div class="timeline-body"><p>Confirmed as of 0.8.10 - removing main dep removes all optionals <strong>except <code>dev</code></strong> Â¯_(ãƒ„)_/Â¯</p>
<p>There is one thing that  works: when you try to remove a dependency that is in a group, you get</p>
<pre><code>hint: `cyclopts` is in the `cli` group (try: `uv remove cyclopts --group cli`)
error: The dependency `cyclopts` could not be found in `project.dependencies`
</code></pre>
<p>And if you follow the hint, it does what it should - removes just that one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dimanu-py">@dimanu-py</a> on 2025-09-08 15:54</div>
            <div class="timeline-body"><p>I was facing the same issue: when I uninstalled one concrete library, <code>uv</code> removed all the dependencies from <code>[dependencies-groups]</code> section too. I found two fixes:</p>
<ul>
<li><p>As mentioned before, just do a <code>uv sync --all-groups</code>  after removing that dependency (may be a bit tedious, but can be automated with makefile for example)</p>
</li>
<li><p>Put this section in your <code>pyproject.tom</code> file</p>
<pre><code class="language-toml"> [tool.uv]
 default-groups = [&lt;the names of your groups under dependencies-groups&gt;]
</code></pre>
</li>
</ul>
<p>This second option uninstalled only the dependency I wanted, even if the dependency belongs to one of the default groups.</p>
<p>Hope this helps ðŸ˜„</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:23 UTC
    </footer>
</body>
</html>
