<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inline script metadata ignored when using `uv run -m` - astral-sh/uv #8317</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Inline script metadata ignored when using `uv run -m`</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/8317">#8317</a>
        opened by <a href="https://github.com/rkern">@rkern</a>
        on 2024-10-18 03:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rkern">@rkern</a> on 2024-10-18 03:03</div>
            <div class="timeline-body"><p><code>uv run -m</code> will not respond to PEP 723 inline script metadata that is included in the script module. My motivating use case is that I typically have some developer and CI conveniences wrapped up in a <code>click</code> script with lots of subcommands. I want it to run in an isolated Python venv which only needs <code>click</code> installed, not the project's venv. The inline script metadata with <code>uv run</code> works great for this. However, I usually implement this in a package with a <code>__main__.py</code> script (I factor some things out like configuration into a separate module and might have some data files; a package works great to isolate all of this to keep it tidy from the rest of the project). <code>uv run -m</code> does not seem to read the inline script metadata implemented in the <code>__main__.py</code> (or other modules run via <code>-m</code>).</p>
<p>It's entirely possible that this is not possible if you need the Python env already set up to dereference the <code>package.module</code> name to find the actual file. If that is the case, this limitation would be good to document.</p>
<p>Thank you!</p>
<pre><code>❯ uv --version
uv 0.4.24 (b9cd54913 2024-10-17)

❯ tree
.
└── foo
    ├── __init__.py
    ├── __main__.py
    └── script1.py

2 directories, 3 files

❯ cat foo/script1.py
# /// script
# dependencies = [
#   &quot;click&quot;
# ]
# ///


import click


@click.command()
def cli():
    click.echo(&quot;Hello, world, from script1!&quot;)


if __name__ == &quot;__main__&quot;:
    cli()

❯ cat foo/__main__.py
# /// script
# dependencies = [
#   &quot;click&quot;
# ]
# ///


import click


@click.command()
def cli():
    click.echo(&quot;Hello, world, from __main__!&quot;)


if __name__ == &quot;__main__&quot;:
    cli()

❯ uv run foo/script1.py
Reading inline script metadata from: foo/script1.py
Hello, world, from script1!

❯ uv run -m foo.script1
Traceback (most recent call last):
  File &quot;/Users/rkern/Library/Application Support/uv/python/cpython-3.10.14-macos-x86_64-none/lib/python3.10/runpy.py&quot;, line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File &quot;/Users/rkern/Library/Application Support/uv/python/cpython-3.10.14-macos-x86_64-none/lib/python3.10/runpy.py&quot;, line 86, in _run_code
    exec(code, run_globals)
  File &quot;/Users/rkern/scratch/uv-m-bug/foo/script1.py&quot;, line 8, in &lt;module&gt;
    import click
ModuleNotFoundError: No module named 'click'

❯ uv run -m foo
Traceback (most recent call last):
  File &quot;/Users/rkern/Library/Application Support/uv/python/cpython-3.10.14-macos-x86_64-none/lib/python3.10/runpy.py&quot;, line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File &quot;/Users/rkern/Library/Application Support/uv/python/cpython-3.10.14-macos-x86_64-none/lib/python3.10/runpy.py&quot;, line 86, in _run_code
    exec(code, run_globals)
  File &quot;/Users/rkern/scratch/uv-m-bug/foo/__main__.py&quot;, line 8, in &lt;module&gt;
    import click
ModuleNotFoundError: No module named 'click'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @zanieb on 2024-10-18 04:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 04:06</div>
            <div class="timeline-body"><p>Thanks for the detailed write-up!</p>
<p>This feels like a pretty weird pattern, i.e., I don't think this is an intended use of PEP 723. I see how it's helpful, but I'm not sure if we should support it or if there's another pattern we can recommend.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rkern">@rkern</a> on 2024-10-18 04:30</div>
            <div class="timeline-body"><p>It seems to me that the PEP 723 section on &quot;<a href="https://peps.python.org/pep-0723/#why-not-just-set-up-a-python-project-with-a-pyproject-toml">Why not just set up a Python project with a <code>pyproject.toml</code>?</a>&quot; applies to the most obvious alternative pattern. This is an internal script not for redistribution (packaging in a bdist). It's just local stuff. It happens to be organized in small package with a <code>__main__.py</code> instead of a script because it happens to have multiple files.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:31:12 UTC
    </footer>
</body>
</html>
