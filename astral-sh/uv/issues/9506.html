<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enable configuration of additional paths when detecting system pythons - astral-sh/uv #9506</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enable configuration of additional paths when detecting system pythons</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/9506">#9506</a>
        opened by <a href="https://github.com/Stealthii">@Stealthii</a>
        on 2024-11-28 16:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Stealthii">@Stealthii</a></div>
            <div class="timeline-body"><p>The high level ask here is to provide a <strong>setting</strong> configuration option to provide additional paths to search when resolving system Pythons.</p>
<hr />
<p>On Enterprise Linux systems, it's common for additional packages to support products to be installed on non-system paths (such as <code>/opt/</code>). To use a public example, on CentOS 7 (and other RHEL7 derivatives) the Software Collections List (<a href="https://wiki.centos.org/SpecialInterestGroup(2f">CentOS</a>SCLo.html), <a href="https://docs.redhat.com/en/documentation/red_hat_software_collections/3/html/3.8_release_notes/chap-usage#sect-Usage-Use-Executable">RHEL</a>) provides a build of Python 3.8 (RPM: <code>rh-python38</code>) that has an interpreter path of <code>/opt/rh/rh-python38/root/bin/python</code> among its supporting files.</p>
<p><code>uv</code> can be packaged and installed as an RPM with supporting config for the environment (such as internal PyPI mirrors or <code>python-preference = &quot;only-system&quot;</code>) at <code>/etc/uv/uv.toml</code>, however there are no provisions to provide additional paths to discover &quot;system&quot; Python installations. To enable interpreter auto-discovery without overriding <code>PATH</code> for an environment, a shim can be used (to replace <code>uv</code> and <code>uvx</code>):</p>
<pre><code class="language-sh">#!/bin/sh
# uv shim script

# Add known internal Python versions to PATH if they exist
[ -d /opt/company/python311/bin ] &amp;&amp; export PATH=&quot;/opt/company/python311/bin:${PATH}&quot;
[ -d /opt/company/python39/bin ] &amp;&amp; export PATH=&quot;/opt/company/python39/bin:${PATH}&quot;
[ -d /opt/rh/rh-python38/root/bin ] &amp;&amp; export PATH=&quot;/opt/rh/rh-python38/root/bin:${PATH}&quot;

# Determine the actual binary to execute based on the name this script was called with
if [ &quot;$(basename &quot;$0&quot;)&quot; = &quot;uvx&quot; ]; then
	exec /usr/lib/company-uv/bin/uvx &quot;$@&quot;
else
	exec /usr/lib/company-uv/bin/uv &quot;$@&quot;
fi
</code></pre>
<p>Rather than shim, and to avoid PATH overrides for autodiscovery, it would be nice to be able to provide additional (or override) paths when resolving available system Python installations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Stealthii">@Stealthii</a> on 2024-11-28 17:04</div>
            <div class="timeline-body"><p>Please consider this low priority from a user-standpoint, as PATH overrides in a build environment are common and a supported method of doing this.</p>
<p>To provide a contextual example, we may be producing an RPM targeting Python 3.11, containing a virtualenv built with uv and supporting scriptlets. If we decide to target el7 through el9:</p>
<ul>
<li>We should inform uv of <code>-p 3.11</code> as our desired target</li>
<li>uv would resolve <code>/opt/company/python311/bin/python3.11</code> on an el7 build container, and <code>/usr/bin/python3.11</code> on el9</li>
<li>RPM dependency resolution will require &quot;company-python311&quot; on el7, and &quot;python3.11&quot; on el9</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2024-11-29 16:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-11-29 16:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lgarrison">@lgarrison</a> on 2025-02-11 22:35</div>
            <div class="timeline-body"><p>To add different use-case where a <code>PATH</code> shim wouldn't work quite as well: on our cluster we have multiple Python modules (installations), each with some pre-installed packages. I'd like uv to discover these installations without the user having to load a given module first. The reason is mostly convenience, but also to eliminate surprises when you run <code>uv venv -p 3.11 --system-site-packages</code> but forget to run <code>module load python/3.11</code> first. This will result in a venv without the site packages that you expected, because the OS python was found.  We don't want to totally disallow managed Python, so I don't think <code>UV_PYTHON_PREFERENCE=only-system</code> is exactly what we want either.</p>
<p>And I'd rather not inject these Pythons into the <code>PATH</code> via a uv/uvx shim because each Python has quite a few pre-installed packages that place scripts in the <code>bin</code> dir (over 200 scripts each). Having all these scripts on the path simultaneously, corresponding to different Python versions, seems like a recipe for tricky bugs.</p>
<p>For us, I think the ideal solution is similar to the initial request: a setting that accepts a list of additional Python interpreters to discover.</p>
<p>In terms of what the setting could look like, a <code>UV_SYSTEM_PYTHONS</code> environment variable that accepted a list of Python interpreters would be one option. Then we could keep a versioned <code>uv</code> module that would set that variable. We might be able to make a system-level configuration file work instead, but we'd probably need a way to select this file via an environment variable since we have multiple module sets.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mneumei">@mneumei</a> on 2025-03-06 12:36</div>
            <div class="timeline-body"><p>And: more and more applications ship some own python, which is a reason PATH can be cluttered with python versions you really don´t want to be used for your execution</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Stealthii">@Stealthii</a> on 2025-03-06 16:14</div>
            <div class="timeline-body"><blockquote>
<p>And: more and more applications ship some own python, which is a reason PATH can be cluttered with python versions you really don´t want to be used for your execution</p>
</blockquote>
<p>Arguably, that's a failing in the application for cluttering global PATH, rather than using its own PATH extensions when executing. The request here is sort of the opposite - providing additional paths to search for Python distributions that are <strong>not</strong> part of the executed PATH env.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MayeulC">@MayeulC</a> on 2025-04-22 17:26</div>
            <div class="timeline-body"><p>Ah, I was just creating an issue on this topic, and finally found this one when looking for other relevant issues to link.</p>
<p>I will instead add the content of my issue text below, it may be relevant.</p>
<hr />
<p>Title: Make system python search path configurable</p>
<details><summary>Summary</summary>

<p>In short: I would like the Python system installation discovery mechanism to examine a second list, independent of PATH.</p>
<p>Changing <code>PATH</code> may not be appropriate due to the side effects, therefore providing an alternate way tell <code>uv</code> where to look for Python versions is desirable.</p>
<p>My current use-case is: we already have multiple Python versions installed on our machines, in separate prefixes, and would like <code>uv</code> to leverage them.</p>
</details>

<p>Example:</p>
<details><summary>I would suggest introducing a new setting and environment variable.</summary>

<ul>
<li><code>UV_PYTHON_SEARCH_PATH=/some/location/python3.13/bin/</code></li>
<li><code>python-search-path</code> in <code>uv.conf</code> or <code>pyproject.toml</code><ul>
<li>Could be either a list<pre><code class="language-toml">python-search-path = [
    &quot;/some/location/python3.13/bin&quot;,
    &quot;/some/location/python3.14/bin&quot;,
]
</code></pre>
</li>
<li>or key/value pairs (may be less desirable? More complex to implement, anyway):<pre><code class="language-toml">[python-search-path]
&quot;3.11-clang&quot; = &quot;/some/location/python3.11-clang/bin&quot;
&quot;3.11-gcc&quot; = &quot;/some/location/python3.11-gcc/bin&quot;
</code></pre>
</li>
</ul>
</li>
</ul>
<p>An alternate name could be <code>PYTHON_DISCOVERY_PATH</code>.</p>
</details>

<details><summary>Code that would be impacted</summary>

<ul>
<li>New source at https://github.com/astral-sh/uv/blob/45910eb6d1152903d54b9bc3a607630898e2d862/crates/uv-python/src/discovery.rs#L187</li>
<li>Repeat search path search on the additional path:<ul>
<li>https://github.com/astral-sh/uv/blob/473d7c75a4e8a99a14bbbca459c493acb717fae2/crates/uv-python/src/discovery.rs#L338</li>
</ul>
</li>
<li>I would likely parametrize this function with the path: https://github.com/astral-sh/uv/blob/473d7c75a4e8a99a14bbbca459c493acb717fae2/crates/uv-python/src/discovery.rs#L477</li>
<li>And then duplicate its call or iterate on <em>NEW_VAR</em>, <em>PATH</em>: https://github.com/astral-sh/uv/blob/473d7c75a4e8a99a14bbbca459c493acb717fae2/crates/uv-python/src/discovery.rs#L338</li>
<li>Needs a discussion on whether this would just prepend to <code>from_search_path</code>, or impact search preference in some other way (I could see some wanting to disable <code>PATH</code> scanning while allowing this new setting): https://github.com/astral-sh/uv/blob/473d7c75a4e8a99a14bbbca459c493acb717fae2/crates/uv-python/src/discovery.rs#L399</li>
<li>Config parsing</li>
</ul>
<p>I can work towards a PR if wanted.</p>
</details>

<p>Incidentally, I see in the code that <code>UV_TEST_PYTHON_PATH</code> overrides <code>PATH</code>, which could be a suitable temporary workaround (<code>TEST</code>, it being intended for unit testing, and no documentation probably mean that this should not be relied upon).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:28:37 UTC
    </footer>
</body>
</html>
