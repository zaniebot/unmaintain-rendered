<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorting dependencies in `pyproject.toml` does not work as expected - astral-sh/uv #10076</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Sorting dependencies in `pyproject.toml` does not work as expected</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10076">#10076</a>
        opened by <a href="https://github.com/paduszyk">@paduszyk</a>
        on 2024-12-21 13:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/paduszyk">@paduszyk</a> on 2024-12-21 13:26</div>
            <div class="timeline-body"><h3>Related issues</h3>
<p>Relates to #6203.</p>
<h3>Setup</h3>
<ul>
<li>uv 0.5.11 (Homebrew 2024-12-20)</li>
<li>Python 3.13</li>
<li>macOS Sequoia 15.1.1</li>
</ul>
<h3>Observed behavior</h3>
<p>When adding a series of dependencies with <code>uv add</code>:</p>
<pre><code class="language-bash">uv add ruff
uv add pytest
uv add pytest-mock
uv add pytest-randomly
</code></pre>
<p>this is what I get in my <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[project]
# ...
dependencies = [
    &quot;pytest-mock&gt;=3.14.0&quot;,
    &quot;pytest&gt;=8.3.4&quot;,
    &quot;ruff&gt;=0.8.4&quot;,
    &quot;pytest-randomly&gt;=3.16.0&quot;,
]
</code></pre>
<p>The list of dependencies is updated as follows:</p>
<ol>
<li><code>uv add ruff</code>: <code>ruff</code> is added.</li>
<li><code>uv add pytest</code>: <code>pytest</code> is inserted before <code>ruff</code>.</li>
<li><code>uv add pytest-mock</code>: <code>pytest-mock</code> is inserted before <code>pytest</code>.</li>
<li><code>uv add pytest-randomly</code>: <code>pytest-randomly</code> is appended as the last item.</li>
</ol>
<p>So, sorting is broken at point 3.</p>
<h3>Expected behavior</h3>
<p>Since uv <em>should</em> sort the dependencies alphabetically (see #6388), I would rather expect:</p>
<pre><code class="language-toml">[project]
# ...
dependencies = [
    &quot;pytest&gt;=8.3.4&quot;,
    &quot;pytest-mock&gt;=3.14.0&quot;,
    &quot;pytest-randomly&gt;=3.16.0&quot;,
    &quot;ruff&gt;=0.8.4&quot;,
]
</code></pre>
<p>or, assuming that <code>&gt;=</code> are taken into account in sorting:</p>
<pre><code class="language-toml">[project]
# ...
dependencies = [
    &quot;pytest-mock&gt;=3.14.0&quot;,
    &quot;pytest-randomly&gt;=3.16.0&quot;,
    &quot;pytest&gt;=8.3.4&quot;,
    &quot;ruff&gt;=0.8.4&quot;,
]
</code></pre>
<p>I believe that the first options seems to be more intuitive. In fact, by &quot;sorting&quot; dependencies I would rather think of sorting dependency names, not its specifiers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-12-21 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-21 13:38</div>
            <div class="timeline-body"><p>Thanks! Looks like a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-12-21 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kavan72">@Kavan72</a> on 2025-01-18 08:48</div>
            <div class="timeline-body"><p>@charliermarsh I’m encountering a strange bug. When I try to add a new library to an existing project, sorting doesn’t work properly. However, when I create a new project, it works perfectly. I’m using the latest version of UV (0.5.21).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-18 15:25</div>
            <div class="timeline-body"><p>@Kavan72 -- Please open a new issue with a clear, minimal reproduction. Thanks.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:30:20 UTC
    </footer>
</body>
</html>
