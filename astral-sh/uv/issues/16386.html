<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fail to install torchvision 0.24 for CPU using accelerator extras (because no wheels for manylinux x86_64 can be found) - astral-sh/uv #16386</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fail to install torchvision 0.24 for CPU using accelerator extras (because no wheels for manylinux x86_64 can be found)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16386">#16386</a>
        opened by <a href="https://github.com/nathanpainchaud">@nathanpainchaud</a>
        on 2025-10-21 13:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nathanpainchaud">@nathanpainchaud</a> on 2025-10-21 13:37</div>
            <div class="timeline-body"><h3>Summary</h3>
<h2>Description</h2>
<p>Updating from torch 2.8 and torchvision 0.23 to torch 2.9 and torchvision 0.24 and following <a href="https://docs.astral.sh/uv/guides/integration/pytorch/#configuring-accelerators-with-optional-dependencies">uv's documentation on how to configure accelerators with optional dependencies</a>, I ran into the error below when trying to install a project for CPU:</p>
<pre><code class="language-console">Distribution `torchvision==0.24.0 @ registry+https://download.pytorch.org/whl/cpu` can't be installed because it doesn't have a source distribution or wheel for the current platform

hint: You're on Linux (`manylinux_2_42_x86_64`), but `torchvision` (v0.24.0) only has wheels for the following platforms: `manylinux_2_28_aarch64`, `macosx_11_0_arm64`; consider adding your platform to `tool.uv.required-environments` to ensure uv resolves to a version with compatible wheels
</code></pre>
<p>The message seems clear that wheels are not available for my platform (manylinux x86_64), but manually inspecting <a href="https://download.pytorch.org/whl/torchvision/">PyTorch's index of torchvision packages</a> reveals that a compatible wheel should be available: <a href="https://download.pytorch.org/whl/cpu/torchvision-0.24.0%2Bcpu-cp312-cp312-manylinux_2_28_x86_64.whl#sha256=baa37f80155a3b055911d5c2418be1e16b95bb69f671dbb0d07d67504093e23d"><code>torchvision-0.24.0+cpu-cp312-cp312-manylinux_2_28_x86_64.whl</code></a>.</p>
<p>Therefore, I suspect there is an issue with how uv resolves the package (e.g. handling of markers?) which incorrectly leads it to believe there are no wheels available for this platform. I didn't have time to follow uv's resolution mechanism further to identify a more precise root cause.</p>
<h2>How to Reproduce</h2>
<p>I first ran into the issue in a more complex project, but I managed to reproduce it in the following simple setup.</p>
<ol>
<li>Create a new project by running <code>uv init PROJECT_NAME</code>, with managed Python <code>cpython-3.12.9-linux-x86_64-gnu</code> already installed</li>
<li>Copy the following content into the <code>pyproject.toml</code> (following <a href="https://docs.astral.sh/uv/guides/integration/pytorch/#configuring-accelerators-with-optional-dependencies">uv's documentation on how to configure accelerators with optional dependencies</a>):</li>
</ol>
<pre><code class="language-toml">[project]
name = &quot;PROJECT_NAME&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = []
[project.optional-dependencies]
cpu = [
  &quot;torch&gt;=2.9,&lt;2.10&quot;,
  &quot;torchvision&gt;=0.24,&lt;0.25&quot;,
]
cu126 = [
  &quot;torch&gt;=2.9,&lt;2.10&quot;,
  &quot;torchvision&gt;=0.24,&lt;0.25&quot;,
]
cu128 = [
  &quot;torch&gt;=2.9,&lt;2.10&quot;,
  &quot;torchvision&gt;=0.24,&lt;0.25&quot;,
]
cu130 = [
  &quot;torch&gt;=2.9,&lt;2.10&quot;,
  &quot;torchvision&gt;=0.24,&lt;0.25&quot;,
]

[tool.uv]
conflicts = [
  [
    { extra = &quot;cpu&quot; },
    { extra = &quot;cu126&quot; },
    { extra = &quot;cu128&quot; },
    { extra = &quot;cu130&quot; },
  ],
]

[tool.uv.sources]
torch = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu126&quot;, extra = &quot;cu126&quot; },
  { index = &quot;pytorch-cu128&quot;, extra = &quot;cu128&quot; },
  { index = &quot;pytorch-cu130&quot;, extra = &quot;cu130&quot; },
]
torchvision = [
  { index = &quot;pytorch-cpu&quot;, extra = &quot;cpu&quot; },
  { index = &quot;pytorch-cu126&quot;, extra = &quot;cu126&quot; },
  { index = &quot;pytorch-cu128&quot;, extra = &quot;cu128&quot; },
  { index = &quot;pytorch-cu130&quot;, extra = &quot;cu130&quot; },
]

[[tool.uv.index]]
name = &quot;pytorch-cpu&quot;
url = &quot;https://download.pytorch.org/whl/cpu&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu126&quot;
url = &quot;https://download.pytorch.org/whl/cu126&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu128&quot;
url = &quot;https://download.pytorch.org/whl/cu128&quot;
explicit = true

[[tool.uv.index]]
name = &quot;pytorch-cu130&quot;
url = &quot;https://download.pytorch.org/whl/cu130&quot;
explicit = true
</code></pre>
<ol start="3">
<li>Try to install the cpu version with <code>uv sync --extra cpu</code> and you should see the error above</li>
</ol>
<h2>More Context</h2>
<ul>
<li>As mentioned at the beginning, the issue appeared when updating torch 2.8-&gt;2.9 and torchvision 0.23-&gt;0.24 (and adapting the <code>pyproject.toml</code> to drop <code>cu129</code> and add <code>cu130</code>). The same configuration for dependencies (minus the differences in CUDA target versions) was working fine before.</li>
<li>As far as I could tell, I did not see any changes in the availability of wheels published to PyTorch's index with this update that could explain the lack of support for my platform.</li>
<li>The error only happens when installing to target CPU, and the project installs fine when targeting GPU (e.g. <code>uv sync --extra cu126</code>)</li>
</ul>
<h3>Platform</h3>
<p>Linux 6.17.2-arch1-1 x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.9.0</p>
<h3>Python version</h3>
<p>Python 3.12.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @nathanpainchaud on 2025-10-21 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-22 17:07</div>
            <div class="timeline-body"><p>Raised this upstream, we'll figure out if it's on the torch or uv side: https://github.com/pytorch/vision/issues/9249</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nathanpainchaud">@nathanpainchaud</a> on 2025-10-22 21:07</div>
            <div class="timeline-body"><p>Thanks @konstin for taking care of this. I've looked at the issue you opened with pytorch/vision, and I just want to point out some things I've observed:</p>
<ul>
<li>There are indeed no local (no <code>+</code>) versions of torchvision in the index for torchvision 0.24.0. Howevere, there are no such versions for torchvision&lt;0.24 either, but uv was still able to resolve the environment for both cpu/gpu;</li>
<li>I am not seeing the duplicate versions of the <code>manylinux_2_28_aarch64</code> wheels. The different versions of the wheels I'm seeing are for different python versions (3.10-3.14, with 3.13 and 3.14 also having free-threaded versions);</li>
<li>Some torchvision wheels seem to have a hash after the <code>+</code>, and I've got no ideas what platform these wheels are supposed to target. Maybe that's an indicator of a bug on torch's side?</li>
</ul>
<p>In any case, thanks again for picking this up, as it goes beyond my abilities to diagnose environment setup issues ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ghpu">@ghpu</a> on 2025-11-04 10:44</div>
            <div class="timeline-body"><p>There are now +cpu versions for torchvision 0.24.0 , but also +e437e35 versions of torchvision 0.24.0 only for Windows. When uv resolves torchvision 0.24.0, it selects the &quot;latest&quot; version (+e437e35) instead of the +cpu suffix version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/YoniChechik">@YoniChechik</a> on 2025-11-18 11:48</div>
            <div class="timeline-body"><p>this hack fixed it for me: https://github.com/pilipolio/chess-sandbox/commit/67a773aa9fba945290e54fce062ca052d268e5d7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/appleparan">@appleparan</a> on 2026-01-08 21:56</div>
            <div class="timeline-body"><p>This is a <code>torchvision</code> wheel issue, not a <code>uv</code> issue.</p>
<p>Here is my fix by adding local version specifier <code>+cpu</code>. <a href="https://github.com/appleparan/copier-modern-ml/blob/main/project/pyproject.toml.jinja">It works!</a></p>
<pre><code>[project.optional-dependencies]
cu130 = [
  &quot;torch==2.9.1&quot;,
  &quot;torchvision==0.24.1&quot;,
]
cu128 = [
  &quot;torch==2.9.1&quot;,
  &quot;torchvision==0.24.1&quot;,
]
cu126 = [
  &quot;torch==2.9.1&quot;,
  &quot;torchvision==0.24.1&quot;,
]
cpu = [
  &quot;torch==2.9.1&quot;,
  # Linux x86_64
  &quot;torchvision==0.24.1+cpu; sys_platform == 'linux' and platform_machine == 'x86_64'&quot;,
  # Windows x86_64 (AMD64)
  &quot;torchvision==0.24.1+cpu; sys_platform == 'win32' and platform_machine == 'AMD64'&quot;,
  # Linux aarch64, macOS arm64: PyPI default wheel
  &quot;torchvision==0.24.1; (sys_platform == 'linux' and platform_machine == 'aarch64') or (sys_platform == 'darwin' and platform_machine == 'arm64')&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2026-01-09 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2026-01-09 10:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:17:50 UTC
    </footer>
</body>
</html>
