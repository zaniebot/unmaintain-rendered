<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>how to get uv to run my app on a read-only volume? - astral-sh/uv #10687</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>how to get uv to run my app on a read-only volume?</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/10687">#10687</a>
        opened by <a href="https://github.com/straz">@straz</a>
        on 2025-01-16 17:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/straz">@straz</a> on 2025-01-16 17:15</div>
            <div class="timeline-body"><p>My <code>Dockerfile</code> implements a <code>FastAPI</code> web server, as follows:</p>
<pre><code>...
RUN uv sync
CMD [&quot;uv&quot;, &quot;run&quot;, &quot;--no-dev&quot;, &quot;uvicorn&quot;, &quot;myapp.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;]
</code></pre>
<p>The <code>/app</code> volume is read-only for safety reasons. At startup, python imports <code>site</code>, whose <a href="https://docs.python.org/3/library/site.html">documentation</a> says</p>
<blockquote>
<p><strong>This module is automatically imported during initialization.</strong> The automatic import can be suppressed using the interpreterâ€™s <a href="https://docs.python.org/3/using/cmdline.html#cmdoption-S">-S</a> option.</p>
</blockquote>
<p><code>site</code> attempts to write to this path, and fails because the volume is read-only:
<code>/app/.venv/lib/python3.11/site-packages/_myapp_back_end.pth</code></p>
<p>How do I get <code>uv</code> to be aware of running code on read-only volumes? Can <code>uv</code> suppress this by somehow calling python with the <code>-S</code> parameter?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-16 17:34</div>
            <div class="timeline-body"><p>You can probably use <code>uv run --no-dev python -S -m uvicorn ...</code></p>
<p>It looks like there's an editable package or something writing the <code>.pth</code>? You could try not using an editable install or using a different build backend?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-01-16 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/straz">@straz</a> on 2025-01-16 21:07</div>
            <div class="timeline-body"><p>Thank you @zanieb . I'll try your suggestion <code>uv run --no-dev python -S -m uvicorn ...</code></p>
<p>The <code>.pth</code> file is being written by <a href="https://docs.python.org/3/library/site.html">site</a>, and it's not editable.
The only configurable option apparently is to use <code>python -S</code>.</p>
<p>Is fair to suggest creating a FAQ question for how to run <code>uv</code> on a read-only volume? I've also figured out I need to suppress or redirect <code>.cache</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-16 21:22</div>
            <div class="timeline-body"><p><code>.pth</code> files are generally used to power editable dependencies, e.g., <code>uv pip install --editable ./foo</code>. Why is <code>site</code> to writing this file in the first place?</p>
<blockquote>
<p>Is fair to suggest creating a FAQ question for how to run uv on a read-only volume? I've also figured out I need to suppress or redirect .cache.</p>
</blockquote>
<p>I'm not sure yet. I think I need to understand more about what's going on. This isn't really a uv-specific problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/straz">@straz</a> on 2025-01-19 02:07</div>
            <div class="timeline-body"><p>Thanks for your help. I have no idea what makes <code>site</code> try to write a file - the doc page for <code>site</code> isn't particularly clear about this.</p>
<p>I'll try following the multistage <a href="https://github.com/astral-sh/uv-docker-example/blob/main/multistage.Dockerfile">uv dockerfile example</a> which doesn't invoke <code>uv</code> in the deployed (read-only) stage.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:02 UTC
    </footer>
</body>
</html>
