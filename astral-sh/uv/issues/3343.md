```yaml
number: 3343
title: uv pip compile skips optional dependencies
type: issue
state: closed
author: nmichlo
labels:
  - duplicate
  - question
assignees: []
created_at: 2024-05-03T11:38:12Z
updated_at: 2024-05-07T18:54:11Z
url: https://github.com/astral-sh/uv/issues/3343
synced_at: 2026-01-10T01:57:07Z
```

# uv pip compile skips optional dependencies

---

_Issue opened by @nmichlo on 2024-05-03 11:38_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

Create `r.txt`

```
qdrant-client~=1.6.1
```

**uv**:

Now compile:

```
uv pip compile r.txt
```

Gives:

```
# This file was autogenerated by uv via the following command:
#    uv pip compile r.txt
annotated-types==0.6.0
    # via pydantic
anyio==4.3.0
    # via httpx
certifi==2024.2.2
    # via
    #   httpcore
    #   httpx
exceptiongroup==1.2.1
    # via anyio
grpcio==1.63.0
    # via
    #   grpcio-tools
    #   qdrant-client
grpcio-tools==1.63.0
    # via qdrant-client
h11==0.14.0
    # via httpcore
h2==4.1.0
    # via httpx
hpack==4.0.0
    # via h2
httpcore==1.0.5
    # via httpx
httpx==0.27.0
    # via qdrant-client
hyperframe==6.0.1
    # via h2
idna==3.7
    # via
    #   anyio
    #   httpx
numpy==1.26.4
    # via qdrant-client
portalocker==2.8.2
    # via qdrant-client
protobuf==5.26.1
    # via grpcio-tools
pydantic==2.7.1
    # via qdrant-client
pydantic-core==2.18.2
    # via pydantic
qdrant-client==1.6.9
setuptools==69.5.1
    # via grpcio-tools
sniffio==1.3.1
    # via
    #   anyio
    #   httpx
typing-extensions==4.11.0
    # via
    #   anyio
    #   pydantic
    #   pydantic-core
urllib3==1.26.18
    # via qdrant-client
```

The important difference to look for is `httpx==0.27.0`

**pip-tools v7**:

Compare this to `pip-tools`

```
pip-compile r.txt -o out.txt
```

Output

```
#
# This file is autogenerated by pip-compile with Python 3.9
# by the following command:
#
#    pip-compile --output-file=out.txt r.txt
#
annotated-types==0.6.0
    # via pydantic
anyio==4.3.0
    # via httpx
certifi==2024.2.2
    # via
    #   httpcore
    #   httpx
exceptiongroup==1.2.1
    # via anyio
grpcio==1.63.0
    # via
    #   grpcio-tools
    #   qdrant-client
grpcio-tools==1.63.0
    # via qdrant-client
h11==0.14.0
    # via httpcore
h2==4.1.0
    # via httpx
hpack==4.0.0
    # via h2
httpcore==1.0.5
    # via httpx
httpx[http2]==0.27.0
    # via qdrant-client
hyperframe==6.0.1
    # via h2
idna==3.7
    # via
    #   anyio
    #   httpx
numpy==1.26.4
    # via qdrant-client
portalocker==2.8.2
    # via qdrant-client
protobuf==5.26.1
    # via grpcio-tools
pydantic==2.7.1
    # via qdrant-client
pydantic-core==2.18.2
    # via pydantic
qdrant-client==1.6.9
    # via -r r.txt
sniffio==1.3.1
    # via
    #   anyio
    #   httpx
typing-extensions==4.11.0
    # via
    #   anyio
    #   pydantic
    #   pydantic-core
urllib3==1.26.18
    # via qdrant-client

# The following packages are considered to be unsafe in a requirements file:
# setuptools
```

The important difference to look for is `httpx[http2]==0.27.0`

ALTHOUGH, in version `v8` the `--strip-extras` flag is being added which can remove this.




---

_Comment by @zanieb on 2024-05-03 13:15_

Hi looks like a duplicate of https://github.com/astral-sh/uv/issues/2163 â€” the default behavior is changing in pip-tools to match ours. You can use `--no-strip-extras` if you want it. 

---

_Closed by @zanieb on 2024-05-03 13:15_

---

_Label `duplicate` added by @zanieb on 2024-05-03 13:15_

---

_Label `question` added by @zanieb on 2024-05-03 13:15_

---

_Comment by @nmichlo on 2024-05-07 18:53_

Oops, thank you! Didn't realise that `--no-strip-extras` was already added.

---
