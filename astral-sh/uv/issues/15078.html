<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv sync and uv pip install do not share the same behaviour when working with extras - astral-sh/uv #15078</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv sync and uv pip install do not share the same behaviour when working with extras</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/15078">#15078</a>
        opened by <a href="https://github.com/lilian-delouvy">@lilian-delouvy</a>
        on 2025-08-05 08:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/lilian-delouvy">@lilian-delouvy</a> on 2025-08-05 08:22</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hello,</p>
<p>When trying to include a path dependency that can be in two different directories ('../../common_modules' locally and './common_modules' in a pipeline setting), I found out that using 'uv sync' will never work in the following pyproject.toml:</p>
<pre><code>[project]
name = &quot;teststep&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [{ name = &quot;lilian-delouvy&quot; }]
requires-python = &quot;&gt;=3.11, &lt;3.12&quot;
dependencies = []

[project.optional-dependencies]
local = [&quot;common-modules&quot;]
pipeline = [&quot;common-modules&quot;]

[tool.uv.sources]
common-modules = [
    { path = &quot;../../common_modules&quot;, editable = true, extra = &quot;local&quot; },
    { path = &quot;./common_modules&quot;, extra = &quot;pipeline&quot; }
]

[tool.uv]
package = true
conflicts = [
    [
        { extra = &quot;local&quot; },
        { extra = &quot;pipeline&quot; }
    ]
]

[tool.hatch.build.targets.sdist]
include = [&quot;src/teststep&quot;]

[tool.hatch.build.targets.wheel]
include = [&quot;src/teststep&quot;]

[tool.hatch.build.targets.wheel.sources]
&quot;src/teststep&quot; = &quot;teststep&quot;

[tool.hatch.metadata]
allow-direct-references = true

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;
</code></pre>
<p>Running <code>uv sync --extra local</code> here provides the following error:</p>
<pre><code>error: Distribution not found at: file:///C:/&lt;MY_PATH&gt;/teststep/common_modules
</code></pre>
<p>It seems that uv still tries to resolve the &quot;pipeline&quot; path, which of course won't work locally.</p>
<p>Using <code>uv pip install -r pyproject.toml --extra local</code> however, will install the common_modules from '../../common_modules' without error.</p>
<p>I'm not sure this is the intended behaviour. From my understanding, <code>uv sync --extra local</code> and <code>uv pip install -r pyproject.toml --extra local</code> should have the same behaviour here.</p>
<p>This is related to <a href="https://github.com/astral-sh/uv/issues/15057">issue 15057</a>.</p>
<p>This also means that no 'uv.lock' file is required, which can be problematic to lock dependencies.</p>
<h3>Platform</h3>
<p>Windows locally and ubuntu on pipeline environment</p>
<h3>Version</h3>
<p>0.7.15 (4ed9c5791 2025-06-25)</p>
<h3>Python version</h3>
<p>Python 3.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @lilian-delouvy on 2025-08-05 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-05 10:54</div>
            <div class="timeline-body"><p>This seems correct to me. <code>uv sync</code> has to create a lockfile for all environments, so those packages have to be available on the machine to create the <code>uv.lock</code>, even if they won't be <em>installed</em> in all environments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilian-delouvy">@lilian-delouvy</a> on 2025-08-05 12:28</div>
            <div class="timeline-body"><p>@charliermarsh  Then it seems I'm misunderstanding something. I can place the package twice at both '../../common_modules' and './common_modules' to generate the lock file, but once this is done and I'm running this in pipeline mode, where the dependency is available only on one of the two paths, which command am I supposed to run ? I tried <code>uv sync --locked</code> but to no avail, as uv still tries to reach common_modules on the other path</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-05 12:31</div>
            <div class="timeline-body"><p>I would expect <code>uv sync --frozen</code> to work in that case (but not <code>--locked</code>, which requires both paths to ensure the lockfile is up-to-date).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @zanieb on 2025-08-05 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2025-08-05 13:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilian-delouvy">@lilian-delouvy</a> on 2025-08-05 15:10</div>
            <div class="timeline-body"><p>It works. Thanks for your help and your quick answers !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @lilian-delouvy on 2025-08-05 15:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:26:46 UTC
    </footer>
</body>
</html>
