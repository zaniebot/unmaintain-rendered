<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markers under universal resolution could have more concise representation  - astral-sh/uv #5992</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Markers under universal resolution could have more concise representation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/5992">#5992</a>
        opened by <a href="https://github.com/notatallshaw">@notatallshaw</a>
        on 2024-08-10 03:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2024-08-10 03:20</div>
            <div class="timeline-body"><p>uv 0.2.35</p>
<p>Markers are looking much better in general, but here's an example that popped up for me that felt a little too verbose:</p>
<pre><code>$ echo -e &quot;sqlalchemy&gt;=2&quot; | uv pip compile --universal --annotation-style line - 2&gt;/dev/null | grep &quot;greenlet==&quot;
greenlet==3.0.3 ; (python_version &lt; '3.13' and platform_machine == 'AMD64') or (python_version &lt; '3.13' and platform_machine == 'WIN32') or (python_version &lt; '3.13' and platform_machine == 'aarch64') or (python_version &lt; '3.13' and platform_machine == 'amd64') or (python_version &lt; '3.13' and platform_machine == 'ppc64le') or (python_version &lt; '3.13' and platform_machine == 'win32') or (python_version &lt; '3.13' and platform_machine == 'x86_64')  # via sqlalchemy
</code></pre>
<p>This could have been more neatly represented as:</p>
<pre><code>greenlet==3.0.3 ; python_version &lt; '3.13'  and (platform_machine == 'AMD64' or platform_machine == 'WIN32' or platform_machine == 'aarch64' or platform_machine == 'amd64' or platform_machine == 'ppc64le' or platform_machine == 'win32' or platform_machine == 'x86_64')  # via sqlalchemy
</code></pre>
<p>This is fairly small and not that big of a deal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ibraheemdev">@ibraheemdev</a> on 2024-08-10 03:29</div>
            <div class="timeline-body"><p>Hmm yeah this is a consequence of us strictly writing in DNF form. Your example does seem like it would be much simpler in CNF.. it's possible that we want more aggressive simplification. However, having a stable representation of markers is also important (see https://github.com/astral-sh/uv/issues/5179), so if we do decide to simplify more we should use an established algorithm instead of continuously adding heuristics (as we were before https://github.com/astral-sh/uv/pull/5898).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2024-08-10 03:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-12-27 14:51</div>
            <div class="timeline-body"><p>I did look at using DNF when it's more concise, and interestingly it turned out that there were only one or two markers in our entire test suite that fell back to DNF.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-09-25 13:32</div>
            <div class="timeline-body"><p>I think this is unlikely to change, and if it does it will likely have a motivating issue other than this one, I'm going to close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @notatallshaw on 2025-09-25 13:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:38 UTC
    </footer>
</body>
</html>
