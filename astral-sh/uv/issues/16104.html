<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add ability to refresh hashes in pinned requirements file (`uv pip compile`) - astral-sh/uv #16104</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add ability to refresh hashes in pinned requirements file (`uv pip compile`)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/16104">#16104</a>
        opened by <a href="https://github.com/thejcannon">@thejcannon</a>
        on 2025-10-02 17:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thejcannon">@thejcannon</a> on 2025-10-02 17:22</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I ran into the issue that we uploaded wheels for an sdist in our private Cheeseshop but users were still seeing sdist compilation. I narrowed it down to the fact that the pinned requirements file didn't have the hash for the new wheels, however rerunning <code>uv pip compile</code> wasn't adding it.</p>
<p>In trying to see if this is a duplicate issue I found https://github.com/astral-sh/uv/issues/1530 which means this is a feature not a bug!</p>
<p>I'd love to be able to have a command that has the behavior pre-bug-fix, where the pinned version stays the same but the available hashes can change/grow (in this case including the hashes of the newly uploaded wheels).</p>
<p>I imagine the easiest way to do this is some new flag a la <code>--update-hashes</code> (but am not picky).</p>
<p>(I tried <code>--refresh</code> but that didn't work. <code>--upgrade</code> doesn't work because ideally I keep the existing pins if possible)</p>
<h3>Example</h3>
<p>Given https://pypi.org/project/uv/0.8.22/#uv-0.8.22.tar.gz as an example...</p>
<p>(Note <code>e6e12...</code> is the hash of the <code>uv</code> sdist)</p>
<pre><code class="language-console">me@computer:~$  cat reqs.txt
# This file was autogenerated by uv via the following command:
#    uv pip compile - --output-file reqs.txt --generate-hashes
uv==0.8.22 \
    --hash=sha256:e6e1289c411d43e0ca245f46e76457f3807de646d90b656591b6cf46348bed5c
me@computer:~$ echo &quot;uv&quot; | uv pip compile - --output-file reqs.txt --generate-hashes --refresh -q
me@computer:~$  cat reqs.txt
# This file was autogenerated by uv via the following command:
#    uv pip compile - --output-file reqs.txt --generate-hashes
uv==0.8.22 \
    --hash=sha256:e6e1289c411d43e0ca245f46e76457f3807de646d90b656591b6cf46348bed5c
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @thejcannon on 2025-10-02 17:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-10-06 13:18</div>
            <div class="timeline-body"><p>Usually hashes do not change once a version was released, which iirc was the motivation for https://github.com/astral-sh/uv/pull/2532.</p>
<p>As a workaround, you can use the existing resolution as constraints and generate a new one:</p>
<pre><code>uv pip compile requirements.in -c requirements.txt --generate-hashes --refresh
</code></pre>
<p>or</p>
<pre><code>echo &quot;uv&quot; | uv pip compile - -c reqs.txt --generate-hashes --refresh
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qbedard">@qbedard</a> on 2025-10-15 17:35</div>
            <div class="timeline-body"><p>The current functionality poses an issue if you are updating a subset of pinned package. If uv has re-locked uv.lock with the upgraded packages and you run <code>uv pip compile --generate-hashes</code>, it will bump the versions for the upgraded packages, <strong>but not the hashes</strong>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:13 UTC
    </footer>
</body>
</html>
