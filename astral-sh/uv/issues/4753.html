<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow specifying different index strategies for different extra indexes - astral-sh/uv #4753</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow specifying different index strategies for different extra indexes</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/4753">#4753</a>
        opened by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a>
        on 2024-07-03 00:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nathanjmcdougall">@nathanjmcdougall</a> on 2024-07-03 00:51</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>This is a request for an enhancement.</p>
<p>I would like to be able to specify a different index strategy for each index specified in <code>--extra-index-url</code>.</p>
<h3>Rationale</h3>
<p>I have a situation where I have three indexes I want to use:</p>
<ul>
<li><code>index-url</code> is set to PyPI</li>
<li><code>extra-index-url</code> is set to a Pytorch index at https://download.pytorch.org/whl/cu118 followed by another private index.</li>
</ul>
<p>I would like to use the <code>first-index</code> strategy when resolving on the first index (the private one), to protect from dependency confusion attacks in the other two.</p>
<p>But the Pytorch index has out-of-date packages like <code>packaging==22.0</code>, so I would like to use the <code>unsafe-first-match</code> strategy to allow the dependency resolver to find a compatible version of packages in PyPI even if the package name is found in the Pytorch index first.</p>
<h3>Possible option</h3>
<p>I think one way to handle this would be to allow <code>index-strategy</code> to be a comma-separated list of options with the same length as <code>extra-index</code> e.g. in this case perhaps it would be <code>unsafe-first-match,first-index</code>.</p>
<p>I am not sure how <code>unsafe-best-match</code> would be used in this way though, possibly just forbid this, although it seems like in some cases you might want to be able to use <code>unsafe-best-match</code> for a sequence of consecutive indexes and then the best match would be selected from that the indexes in that subsequence.</p>
<p>Another (related) complication with this approach is that it associates each strategy uniquely with a <em>pair</em> of indexes adjacent in priority order. In general, strategies might be abstract enough such that this is unnecessarily restrictive. In the most abstract case, the user might want to specify a sequence of strategies, each of which is associated with an ordered sequence of indexes, and strategies may re-use the same index multiple times.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2024-07-28 00:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:29 UTC
    </footer>
</body>
</html>
