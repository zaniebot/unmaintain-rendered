<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv sync` with a private repo does not work in docker with uv &gt;= 0.98 - astral-sh/uv #16741</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`uv sync` with a private repo does not work in docker with uv &gt;= 0.98</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/16741">#16741</a>
        opened by <a href="https://github.com/morbatex">@morbatex</a>
        on 2025-11-14 17:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/morbatex">@morbatex</a> on 2025-11-14 17:47</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using <code>uv sync</code> in docker with uv &gt;=  0.99 the with a private repo the following error occurs in some cases:</p>
<pre><code>uv sync --no-dev --frozen --no-install-project
Using CPython 3.13.9 interpreter at: /usr/local/bin/python3
Creating virtual environment at: .venv
× Failed to download `hexaly==14.0.20251029`
├─▶ Failed to fetch:
│   `https://pip.hexaly.com/hexaly/hexaly-14.0.20251029-py2.py3.py27.py36.py37.py38.py39.py310.py311.py312.py313.py314-none-linux_x86_64.whl`
├─▶ Request failed after 3 retries
├─▶ error sending request for url
│   (https://pip.hexaly.com/hexaly/hexaly-14.0.20251029-py2.py3.py27.py36.py37.py38.py39.py310.py311.py312.py313.py314-none-linux_x86_64.whl)├─▶ client error (Connect)
├─▶ dns error
╰─▶ failed to lookup address information: Name does not resolve
help: `hexaly` (v14.0.20251029) was included because `optimization` (v0.1.0)
depends on `hexaly`
</code></pre>
<p>As stated this only happens in some cases. I encountered it only when running <code>docker build</code> inside in a docker based gitlab runner. When executing the same build locally or without gitlab-ci on the same machine as the gitlab runner it works flawless.</p>
<details>

<summary>Docker file</summary>

<pre><code>ARG PYTHON_VERSION
FROM python:3.13.3-slim

COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

ENV UV_COMPILE_BYTECODE=1
ENV UV_LINK_MODE=copy
ENV UV_CACHE_DIR=/root/.cache/uv

WORKDIR /app
COPY uv.lock backend/pyproject.toml ./
# install just the requirements
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --no-dev --frozen --no-install-project

COPY backend .
# install the project again to make sure scripts are working
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --no-dev --frozen

EXPOSE 80
ENTRYPOINT [&quot;entrypoint&quot;]
</code></pre>
</details>

<details>

<summary>pyproject.toml</summary>

<pre><code>[project]
name = &quot;optimization&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;hexaly&gt;=14.0&quot;,
]

[tool.uv.sources]
hexaly = { index = &quot;hexaly&quot; }

[[tool.uv.index]]
name = &quot;hexaly&quot;
url = &quot;https://pip.hexaly.com/&quot;
explicit = true
</code></pre>
</details>

<p>As this is only happening in the pipeline and I am not able to reproduce it outside of it I cannot provide more information regarding reproduction.  If I can assist with any information, I will gladly provide them.</p>
<p>If I change the dockerfile so that <code>pip install uv</code> is used to install uv, the build works without problems.</p>
<p>As the uv version copied from the docker image is linked against musl and the one istalled via pip is linked against glibc, I assume that the issue is somehow caused by musl in specific environments.</p>
<p>Furthermore as 0.97 worked and 0.98 does not work anymore I assume that the <a href="https://github.com/astral-sh/uv/pull/16584">switch</a> from musl 1.24 to 1.25 introduced this, while fixing a similar <a href="https://github.com/astral-sh/uv/issues/8450">issue</a>.</p>
<h3>Platform</h3>
<p>Linux 6.14.0-35-generic x86_64 GNU/Linux</p>
<h3>Version</h3>
<p>uv 0.9.9</p>
<h3>Python version</h3>
<p>Python 3.13.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @morbatex on 2025-11-14 17:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-14 18:05</div>
            <div class="timeline-body"><p>That's quite unfortunate.</p>
<p>You can also use our standalone installer (i.e., <code>curl ..</code>) instead of <code>pip</code> to workaround this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-11-14 18:08</div>
            <div class="timeline-body"><p>As a note.... While I appreciate the report, I think the resolution here will be to file an issue against musl and hexaly — there's nothing we're going to be able to do here in uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Linnore">@Linnore</a> on 2025-11-21 10:33</div>
            <div class="timeline-body"><p>Encounter the same problem here. UV will not fall back to other indexes (e.g. pypi) if it fails to connect to the private index.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-11-28 08:46</div>
            <div class="timeline-body"><p>@Linnore That's a security feature, we don't want to use a public package where a private one should be used due to e.g. unstable internet, or because the private server is temporarily down.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hrushikesh-hd1-tfs">@hrushikesh-hd1-tfs</a> on 2025-12-26 20:49</div>
            <div class="timeline-body"><p>Any update on this?? I am using <code>ghcr.io/astral-sh/uv:0.9.5</code> the sync fails to install private packages while building the image.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">external</span> added by @konstin on 2026-01-06 19:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:30 UTC
    </footer>
</body>
</html>
