<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>no-manylinux support does not work when cache is enabled - astral-sh/uv #10832</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>no-manylinux support does not work when cache is enabled</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/10832">#10832</a>
        opened by <a href="https://github.com/pythonweb2">@pythonweb2</a>
        on 2025-01-21 23:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pythonweb2">@pythonweb2</a> on 2025-01-21 23:05</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Reference: https://docs.astral.sh/uv/pip/compatibility/#manylinux_compatible-enforcement</p>
<p>I have noticed that when the cache is not disabled, no-manylinux being installed won't make a difference. For example:</p>
<pre><code class="language-bash"># uv venv
# uv pip install no-manylinux
# uv pip install cryptography
Resolved 3 packages in 144ms
Installed 3 packages in 23ms
 + cffi==1.17.1
 + cryptography==44.0.0
 + pycparser==2.22
# uv pip install --no-cache cryptography
Resolved 3 packages in 460ms
   Built cffi==1.17.1
Building cryptography==44.0.0
таз Preparing packages... (2/3)
</code></pre>
<p>It seems like regardless of whether or not the cache is disabled, this should work and build the package from source.</p>
<h3>Platform</h3>
<p>Ubuntu 20.04</p>
<h3>Version</h3>
<p>uv 0.5.22</p>
<h3>Python version</h3>
<p>Python 3.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @pythonweb2 on 2025-01-21 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-21 23:08</div>
            <div class="timeline-body"><p>Can you share <code>--verbose</code> logs? Perhaps with <code>RUST_LOG=uv=trace</code> set?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pythonweb2">@pythonweb2</a> on 2025-01-21 23:09</div>
            <div class="timeline-body"><p>Verbose logs for the first command (with cache)</p>
<pre><code>root@9fffee1db09a:~/test2# uv pip list
Package      Version
------------ -------
no-manylinux 3.0.0
root@9fffee1db09a:~/test2# RUST_LOG=uv=trace uv pip install --verbose cryptography
DEBUG uv 0.5.22
DEBUG Searching for default Python interpreter in virtual environments
TRACE Cached interpreter info for Python 3.13.1, skipping probing: .venv/bin/python3
DEBUG Found `cpython-3.13.1-linux-x86_64-gnu` at `/root/test2/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.13.1 environment at: .venv
TRACE Checking lock for `.venv` at `.venv/.lock`
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: cryptography
DEBUG Using request timeout of 30s
DEBUG Solving with installed Python version: 3.13.1
DEBUG Solving with target Python version: &gt;=3.13.1
TRACE assigned packages: 
TRACE Chose package for decision: root. remaining choices: 
DEBUG Adding direct dependency: cryptography*
TRACE assigned packages: root==0a0.dev0
TRACE Chose package for decision: cryptography. remaining choices: 
TRACE Fetching metadata for cryptography from https://pypi.org/simple/cryptography/
TRACE cached request https://pypi.org/simple/cryptography/ is storable because its response has a 'public' cache-control directive
TRACE freshness lifetime found via cache-control max age setting: 600s
TRACE cached request https://pypi.org/simple/cryptography/ has a cached response that does not allow staleness
TRACE request https://pypi.org/simple/cryptography/ does not have a fresh cache because its age is 880 seconds, it is greater than the freshness lifetime of 600 seconds and stale cached responses are not allowed
DEBUG Found stale response for: https://pypi.org/simple/cryptography/
DEBUG Sending revalidation request for: https://pypi.org/simple/cryptography/
TRACE Handling request for https://pypi.org/simple/cryptography/
TRACE Request for https://pypi.org/simple/cryptography/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://pypi.org/simple/cryptography/
TRACE Attempting unauthenticated request for https://pypi.org/simple/cryptography/
TRACE not modified because old and new etag values ([34, 109, 57, 77, 69, 49, 56, 90, 83, 68, 48, 54, 81, 99, 107, 43, 114, 81, 49, 55, 101, 102, 65, 34]) match
DEBUG Found not-modified response for: https://pypi.org/simple/cryptography/
TRACE Received package metadata for: cryptography
TRACE Selecting candidate for cryptography with range * with 134 remote versions
DEBUG Searching for a compatible version of cryptography (*)
TRACE Selecting candidate for cryptography with range * with 134 remote versions
TRACE Found candidate for package cryptography with range * after 1 steps: 44.0.0 version
TRACE Found candidate for package cryptography with range * after 1 steps: 44.0.0 version
TRACE Returning candidate for package cryptography with range * after 1 steps
TRACE Returning candidate for package cryptography with range * after 1 steps
DEBUG Selecting: cryptography==44.0.0 [compatible] (cryptography-44.0.0-cp39-abi3-manylinux_2_28_x86_64.whl)
TRACE cached request https://files.pythonhosted.org/packages/ef/82/72403624f197af0db6bac4e58153bc9ac0e6020e57234115db9596eee85d/cryptography-44.0.0-cp39-abi3-manylinux_2_28_x86_64.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE freshness lifetime found via cache-control max age setting: 365000000s
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/ef/82/72403624f197af0db6bac4e58153bc9ac0e6020e57234115db9596eee85d/cryptography-44.0.0-cp39-abi3-manylinux_2_28_x86_64.whl.metadata
TRACE Received built distribution metadata for: cryptography==44.0.0
DEBUG Adding transitive dependency for cryptography==44.0.0: cffi{platform_python_implementation != 'PyPy'}&gt;=1.12
TRACE assigned packages: root==0a0.dev0, cryptography==44.0.0
TRACE Chose package for decision: cffi{platform_python_implementation != 'PyPy'}. remaining choices: 
TRACE Fetching metadata for cffi from https://pypi.org/simple/cffi/
TRACE cached request https://pypi.org/simple/cffi/ is storable because its response has a 'public' cache-control directive
TRACE freshness lifetime found via cache-control max age setting: 600s
TRACE cached request https://pypi.org/simple/cffi/ has a cached response that does not allow staleness
TRACE request https://pypi.org/simple/cffi/ does not have a fresh cache because its age is 879 seconds, it is greater than the freshness lifetime of 600 seconds and stale cached responses are not allowed
DEBUG Found stale response for: https://pypi.org/simple/cffi/
DEBUG Sending revalidation request for: https://pypi.org/simple/cffi/
TRACE Handling request for https://pypi.org/simple/cffi/
TRACE Request for https://pypi.org/simple/cffi/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://pypi.org/simple/cffi/
TRACE Attempting unauthenticated request for https://pypi.org/simple/cffi/
TRACE not modified because old and new etag values ([34, 52, 79, 70, 72, 55, 117, 108, 50, 78, 81, 122, 70, 67, 48, 113, 54, 55, 120, 86, 112, 87, 103, 34]) match
DEBUG Found not-modified response for: https://pypi.org/simple/cffi/
TRACE Received package metadata for: cffi
DEBUG Searching for a compatible version of cffi{platform_python_implementation != 'PyPy'} (&gt;=1.12)
TRACE Selecting candidate for cffi with range &gt;=1.12 with 78 remote versions
TRACE Found candidate for package cffi with range &gt;=1.12 after 1 steps: 1.17.1 version
TRACE Returning candidate for package cffi with range &gt;=1.12 after 1 steps
DEBUG Selecting: cffi==1.17.1 [compatible] (cffi-1.17.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl)
DEBUG Adding transitive dependency for cffi==1.17.1: cffi==1.17.1
DEBUG Adding transitive dependency for cffi==1.17.1: cffi{platform_python_implementation != 'PyPy'}==1.17.1
TRACE assigned packages: root==0a0.dev0, cryptography==44.0.0
TRACE Selecting candidate for cffi with range ==1.17.1 with 78 remote versions
TRACE Found candidate for package cffi with range ==1.17.1 after 1 steps: 1.17.1 version
TRACE Returning candidate for package cffi with range ==1.17.1 after 1 steps
TRACE Chose package for decision: cffi. remaining choices: cffi{platform_python_implementation != 'PyPy'}
DEBUG Searching for a compatible version of cffi (==1.17.1)
TRACE Selecting candidate for cffi with range ==1.17.1 with 78 remote versions
TRACE Found candidate for package cffi with range ==1.17.1 after 1 steps: 1.17.1 version
TRACE Returning candidate for package cffi with range ==1.17.1 after 1 steps
DEBUG Selecting: cffi==1.17.1 [compatible] (cffi-1.17.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl)
TRACE cached request https://files.pythonhosted.org/packages/26/9f/1aab65a6c0db35f43c4d1b4f580e8df53914310afc10ae0397d29d697af4/cffi-1.17.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE freshness lifetime found via cache-control max age setting: 365000000s
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/26/9f/1aab65a6c0db35f43c4d1b4f580e8df53914310afc10ae0397d29d697af4/cffi-1.17.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata
TRACE Received built distribution metadata for: cffi==1.17.1
DEBUG Adding transitive dependency for cffi==1.17.1: pycparser*
TRACE assigned packages: root==0a0.dev0, cryptography==44.0.0, cffi==1.17.1
TRACE Chose package for decision: cffi{platform_python_implementation != 'PyPy'}. remaining choices: pycparser
DEBUG Searching for a compatible version of cffi{platform_python_implementation != 'PyPy'} (==1.17.1)
TRACE Fetching metadata for pycparser from https://pypi.org/simple/pycparser/
TRACE Selecting candidate for cffi with range ==1.17.1 with 78 remote versions
TRACE Found candidate for package cffi with range ==1.17.1 after 1 steps: 1.17.1 version
TRACE Returning candidate for package cffi with range ==1.17.1 after 1 steps
DEBUG Selecting: cffi==1.17.1 [compatible] (cffi-1.17.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl)
DEBUG Adding transitive dependency for cffi==1.17.1: pycparser*
TRACE assigned packages: root==0a0.dev0, cryptography==44.0.0, cffi==1.17.1, cffi{platform_python_implementation != 'PyPy'}==1.17.1
TRACE Chose package for decision: pycparser. remaining choices: 
TRACE cached request https://pypi.org/simple/pycparser/ is storable because its response has a 'public' cache-control directive
TRACE freshness lifetime found via cache-control max age setting: 600s
TRACE cached request https://pypi.org/simple/pycparser/ has a cached response that does not allow staleness
TRACE request https://pypi.org/simple/pycparser/ does not have a fresh cache because its age is 879 seconds, it is greater than the freshness lifetime of 600 seconds and stale cached responses are not allowed
DEBUG Found stale response for: https://pypi.org/simple/pycparser/
DEBUG Sending revalidation request for: https://pypi.org/simple/pycparser/
TRACE Handling request for https://pypi.org/simple/pycparser/
TRACE Request for https://pypi.org/simple/pycparser/ is unauthenticated, checking cache
TRACE No credentials in cache for URL https://pypi.org/simple/pycparser/
TRACE Attempting unauthenticated request for https://pypi.org/simple/pycparser/
TRACE not modified because old and new etag values ([34, 48, 99, 74, 102, 97, 100, 47, 80, 101, 80, 66, 114, 76, 51, 43, 101, 83, 103, 53, 71, 99, 65, 34]) match
DEBUG Found not-modified response for: https://pypi.org/simple/pycparser/
TRACE Received package metadata for: pycparser
TRACE Selecting candidate for pycparser with range * with 22 remote versions
DEBUG Searching for a compatible version of pycparser (*)
TRACE Selecting candidate for pycparser with range * with 22 remote versions
TRACE Found candidate for package pycparser with range * after 1 steps: 2.22 version
TRACE Found candidate for package pycparser with range * after 1 steps: 2.22 version
TRACE Returning candidate for package pycparser with range * after 1 steps
DEBUG Selecting: pycparser==2.22 [compatible] (pycparser-2.22-py3-none-any.whl)
TRACE Returning candidate for package pycparser with range * after 1 steps
TRACE cached request https://files.pythonhosted.org/packages/13/a3/a812df4e2dd5696d1f351d58b8fe16a405b234ad2886a0dab9183fb78109/pycparser-2.22-py3-none-any.whl.metadata is storable because its response has a 'public' cache-control directive
TRACE freshness lifetime found via cache-control max age setting: 365000000s
DEBUG Found fresh response for: https://files.pythonhosted.org/packages/13/a3/a812df4e2dd5696d1f351d58b8fe16a405b234ad2886a0dab9183fb78109/pycparser-2.22-py3-none-any.whl.metadata
TRACE Received built distribution metadata for: pycparser==2.22
TRACE assigned packages: root==0a0.dev0, cryptography==44.0.0, cffi==1.17.1, cffi{platform_python_implementation != 'PyPy'}==1.17.1, pycparser==2.22
DEBUG Tried 3 versions: cffi 1, cryptography 1, pycparser 1
DEBUG marker environment resolution took 0.151s
TRACE Resolution: ResolverEnvironment { kind: Specific { marker_env: ResolverMarkerEnvironment(MarkerEnvironment { inner: MarkerEnvironmentInner { implementation_name: &quot;cpython&quot;, implementation_version: StringVersion { string: &quot;3.13.1&quot;, version: &quot;3.13.1&quot; }, os_name: &quot;posix&quot;, platform_machine: &quot;x86_64&quot;, platform_python_implementation: &quot;CPython&quot;, platform_release: &quot;5.15.153.1-microsoft-standard-WSL2&quot;, platform_system: &quot;Linux&quot;, platform_version: &quot;#1 SMP Fri Mar 29 23:14:13 UTC 2024&quot;, python_full_version: StringVersion { string: &quot;3.13.1&quot;, version: &quot;3.13.1&quot; }, python_version: StringVersion { string: &quot;3.13&quot;, version: &quot;3.13&quot; }, sys_platform: &quot;linux&quot; } }) } }
TRACE Resolution edge: ROOT -&gt; cryptography
TRACE Resolution edge:     0a0.dev0 -&gt; 44.0.0
TRACE Resolution edge: cffi -&gt; pycparser
TRACE Resolution edge:     1.17.1 -&gt; 2.22
TRACE Resolution edge: cryptography -&gt; cffi
TRACE Resolution edge:     44.0.0 -&gt; 1.17.1 ; platform_python_implementation != 'PyPy'
Resolved 3 packages in 155ms
DEBUG Requirement already cached: cryptography==44.0.0
DEBUG Requirement already cached: cffi==1.17.1
DEBUG Requirement already cached: pycparser==2.22
DEBUG Unnecessary package: no-manylinux==3.0.0
TRACE Extracting file name=PackageName(&quot;cryptography&quot;)
TRACE Extracting file name=PackageName(&quot;cffi&quot;)
TRACE Extracting file name=PackageName(&quot;pycparser&quot;)
TRACE Extracted 29 files name=PackageName(&quot;cffi&quot;)
TRACE No entrypoints name=PackageName(&quot;cffi&quot;)
TRACE No data name=PackageName(&quot;cffi&quot;)
TRACE Writing installer metadata name=PackageName(&quot;cffi&quot;)
TRACE Writing record name=PackageName(&quot;cffi&quot;)
TRACE Extracted 23 files name=PackageName(&quot;pycparser&quot;)
TRACE No entrypoints name=PackageName(&quot;pycparser&quot;)
TRACE No data name=PackageName(&quot;pycparser&quot;)
TRACE Writing installer metadata name=PackageName(&quot;pycparser&quot;)
TRACE Writing record name=PackageName(&quot;pycparser&quot;)
TRACE Extracted 111 files name=PackageName(&quot;cryptography&quot;)
TRACE No entrypoints name=PackageName(&quot;cryptography&quot;)
TRACE No data name=PackageName(&quot;cryptography&quot;)
TRACE Writing installer metadata name=PackageName(&quot;cryptography&quot;)
TRACE Writing record name=PackageName(&quot;cryptography&quot;)
Installed 3 packages in 31ms
 + cffi==1.17.1
 + cryptography==44.0.0
 + pycparser==2.22
DEBUG Released lock at `/root/test2/.venv/.lock`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pythonweb2">@pythonweb2</a> on 2025-01-21 23:12</div>
            <div class="timeline-body"><p>And here are the logs for the second command, they are longer so I attached a file.</p>
<p><a href="https://github.com/user-attachments/files/18497513/scratch_82.txt">scratch_82.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-21 23:12</div>
            <div class="timeline-body"><p>This is returned as part of the interpreter metadata, I'm guessing it gets cached and we don't really know to invalidate it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pythonweb2">@pythonweb2</a> on 2025-01-21 23:17</div>
            <div class="timeline-body"><p>I also tested this with python 3.8 using the pre-packaged python from ubuntu-20.04, and this was still an issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-21 23:18</div>
            <div class="timeline-body"><p>Yeah, that shouldn't make a difference.</p>
<p>Does running with <code>--refresh</code> resolve it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pythonweb2">@pythonweb2</a> on 2025-01-21 23:20</div>
            <div class="timeline-body"><p>Yes, that does look like it also resolves the issue, similar to <code>--no-cache</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-23 19:17</div>
            <div class="timeline-body"><p>I'm going to mark this as wontfix. It's an incorrect behavior, but no-manylinux is very niche and I'd prefer not to make changes to our caching strategies on its behalf. <code>--refresh</code> is the recommended workaround.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-01-23 19:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 04:30:31 UTC
    </footer>
</body>
</html>
