<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uninstall + Install 1 package everytime uv is called in a monorepo library with a different virtual environment from the root - astral-sh/uv #17283</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Uninstall + Install 1 package everytime uv is called in a monorepo library with a different virtual environment from the root</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17283">#17283</a>
        opened by <a href="https://github.com/btakita">@btakita</a>
        on 2026-01-02 08:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/btakita">@btakita</a> on 2026-01-02 08:15</div>
            <div class="timeline-body"><h3>Question</h3>
<p>Hi, I'm migrating my repo from poetry to uv. I'm very happy with how fast the installs are. However, I'm running into issues with the root config (Python 3.14) wiping out all dependencies in my library venv (3.12) and even switching it over to Python 3.14 if I'm not careful.</p>
<p>I don't want to remember all of the flags to use Python 3.12 and really don't want to force other devs on the team to.</p>
<p>I currently have a Makefile which seems to be the most reliable starting point. But otherwise, every time I try to run a poe task or use uv in general, it takes over &amp; messes up the environment.</p>
<pre><code class="language-Makefile">init_uv:
	uv venv .venv --python 3.12 --clear
	uv sync --python 3.12 --all-extras

</code></pre>
<p>Are there any tips to make <code>uv</code> keep the python 3.12 and all dependencies (including groups and optional dependencies) when in the library directory? Without any extra cli options? Any tips in general? Sorry about the lack of specifics. I have to admit, this has been very confusing &amp; I just want to start from the basics rather than document everything I have tried.</p>
<h3>Platform</h3>
<p>Linux 6.18.2-3-cachyos x86_64 unknown</p>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @btakita on 2026-01-02 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/btakita">@btakita</a> on 2026-01-02 16:01</div>
            <div class="timeline-body"><p>I got the proper version of Python to remain the the subdirectory with the help of mise. Which loads the virtual environment. However I now get a warning when running a poe task within the subdirectory of a monorepo...using a different version of Python:</p>
<p>Here is the poe task:</p>
<pre><code>python = &quot;uv run --active --no-project python&quot;
</code></pre>
<p>Here is the output:</p>
<pre><code>❯ poe python --version
Poe =&gt; uv run --active --no-project python --version
warning: `VIRTUAL_ENV=.venv` does not match the project environment path `/home/brian/work/monorepo-root/.venv` and will be ignored; use `--active` to target the active environment instead
Uninstalled 1 package in 0.84ms
Installed 1 package in 6ms
Python 3.12.12
</code></pre>
<p>Is this warning something to be concerned about or is there a way to silence the warning since I want a different virtual env? Is there a way to make uv stop uninstalling &amp; installing a package everytime it's used?</p>
<hr />
<p>Tracking:</p>
<p>https://github.com/astral-sh/uv/pull/6834
https://github.com/astral-sh/uv/issues/7778
https://github.com/astral-sh/uv/issues/17209
https://github.com/astral-sh/uv/issues/17154
https://github.com/astral-sh/uv/issues/17247</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/btakita">@btakita</a> on 2026-01-02 16:51</div>
            <div class="timeline-body"><p>I was able to silence the warning by setting:</p>
<pre><code>UV_PROJECT_ENVIRONMENT=relative/path/from/monorepo/root/.venv
</code></pre>
<p>But I still have the uninstall + install everytime uv is run.</p>
<pre><code>❯ poe python --version
Poe =&gt; uv run --active --exact --no-project python --version
Uninstalled 1 package in 0.73ms
Installed 1 package in 14ms
Python 3.12.12
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Monorepo where packages have different virtual environments & versions of python" to "Uninstall + Install 1 package in a monorepo library with a different virtual environment from the root" by @btakita on 2026-01-02 16:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Uninstall + Install 1 package in a monorepo library with a different virtual environment from the root" to "Uninstall + Install 1 package everytime uv is called in a monorepo library with a different virtual environment from the root" by @btakita on 2026-01-02 16:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/btakita">@btakita</a> on 2026-01-02 16:58</div>
            <div class="timeline-body"><p>This may be a poe issue. Because if I run:</p>
<pre><code>❯ uv run --no-project python --version
Python 3.12.12
</code></pre>
<p>But with the poe task:</p>
<pre><code>python = &quot;uv run --no-project python&quot;
</code></pre>
<p>I get:</p>
<pre><code>❯ poe python --version
Poe =&gt; uv run --no-project python --version
Uninstalled 1 package in 0.76ms
Installed 1 package in 6ms
Python 3.12.12
</code></pre>
<p>Even though this is a <a href="https://github.com/nat-n/poethepoet/issues/345">poe issue</a>, some clarity on why a package is uninstalled &amp; installed would be great! I wasn't able to figure out how to log which package it is. <code>--verbose</code> doesn't provide more detail.</p>
<p>Note that <code>--no-project</code> prevents the uninstall + install of the package. Without it:</p>
<pre><code>❯ uv run python --version
Uninstalled 1 package in 0.40ms
Installed 1 package in 9ms
Python 3.12.12
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nat-n">@nat-n</a> on 2026-01-03 14:23</div>
            <div class="timeline-body"><p>Hi @btakita ,</p>
<p>I suspect your problem is the default behaviour of uv workspaces which cause all projects in a monorepo to share a venv, which is usually helpful, but goes against what you want here.</p>
<p>Here's a formula to setup a minimal example of a project setup similar to what you describe:</p>
<pre><code class="language-sh">uv tool install poethepoet # ensure poe cli is installed globally
</code></pre>
<pre><code class="language-sh"># create buildable root project with dependencies and a poe task
mkdir rootproject
cd rootproject
uv init --lib --python 3.13.0
uv add typer
cat &gt;&gt; pyproject.toml &lt;&lt;EOF
[tool.poe.tasks.check-env]
cmd = &quot;python --version&quot;
EOF
poe check-env

# create buildable child project with dependencies and a poe task
mkdir childproject
cd childproject
uv init --lib --python 3.12.0 --no-workspace # make sure childproject isn't added to shared workspace!
uv add flask
cat &gt;&gt; pyproject.toml &lt;&lt;EOF
[tool.poe.tasks.check-env]
cmd = &quot;python --version&quot;
EOF
poe check-env
</code></pre>
<p>With this you should see that there is a separate .venv for the childproject with distinct dependencies, and you can go back and forth between the two project directories and run their respective <code>poe check-env</code> tasks and see that they run with different python versions without having to update the venv back and forth every time :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:18:12 UTC
    </footer>
</body>
</html>
