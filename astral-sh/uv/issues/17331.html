<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows: `uv tool update-shell` saves but does not apply PATH change - astral-sh/uv #17331</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Windows: <code>uv tool update-shell</code> saves but does not apply PATH change</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/17331">#17331</a>
        opened by <a href="https://github.com/thedewi">@thedewi</a>
        on 2026-01-06 02:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thedewi">@thedewi</a> on 2026-01-06 02:35</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><code>uv tool update-shell</code> is updating the <code>PATH</code> in registry, but it seems Windows is not aware it needs to reload the change.</p>
<p>Version: uv 0.9.18 (0cee76417 2025-12-16)
Context: Windows 10 22H2</p>
<h2>Steps to reproduce</h2>
<ol>
<li>Ensure <code>%SYSTEMPROFILE%\.local\bin</code> is not already included in <code>%PATH%</code>.</li>
<li>Install any uv tool, like <code>uv tool install jtbl</code>.</li>
<li>Run <code>uv tool update-shell</code>.</li>
<li>Open a fresh cmd.exe and try to run the tool, like <code>jtbl</code>.</li>
</ol>
<h2>Expected result</h2>
<p>The tool runs.</p>
<h2>Current result</h2>
<p>The tool is not found.</p>
<h2>Workaround</h2>
<p>Before step 4, in Control Panel &quot;System Properties&quot;, click &quot;Environment Variables...&quot; then &quot;Ok&quot;.</p>
<h2>Explanation</h2>
<p><code>uv tool update-shell</code> is updating the <code>PATH</code> in registry, but it seems Windows is not aware it needs to reload the change.</p>
<p>One way to do this is to broadcast <code>WM_SETTINGCHANGE</code> to the system. Here's a PowerShell example that works for me:</p>
<pre><code class="language-ps1">$windowBroadcastHandle = [IntPtr]0xffff
$wmSettingChangeMessageId = 0x1A
$environmentChangedParameter = &quot;Environment&quot;
$abortIfHungFlag = 0x0002

Add-Type @&quot;
using System;
using System.Runtime.InteropServices;

public static class NativeMethods
{
    [DllImport(&quot;user32.dll&quot;, SetLastError = true, CharSet = CharSet.Auto)]
    public static extern IntPtr SendMessageTimeout(
        IntPtr windowHandle,
        int messageId,
        IntPtr wParam,
        string lParam,
        int flags,
        int timeoutMilliseconds,
        out IntPtr result);
}
&quot;@

[NativeMethods]::SendMessageTimeout(
    $windowBroadcastHandle,
    $wmSettingChangeMessageId,
    [IntPtr]::Zero,
    $environmentChangedParameter,
    $abortIfHungFlag,
    5000,
    [ref]([IntPtr]::Zero)
)
</code></pre>
<h3>Platform</h3>
<p>Windows 10 22H2</p>
<h3>Version</h3>
<p>uv 0.9.18 (0cee76417 2025-12-16)</p>
<h3>Python version</h3>
<p>Python 3.14.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @thedewi on 2026-01-06 02:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Windows: `uv tool update-shell` saves but does not apply changes" to "Windows: `uv tool update-shell` saves but does not apply PATH change" by @thedewi on 2026-01-06 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2026-01-06 09:04</div>
            <div class="timeline-body"><p>CC @Gankra @samypr100 for windows expertise</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2026-01-11 03:35</div>
            <div class="timeline-body"><p>I'm unable to reproduce on Win 11 25H2 Command Prompt. I also tried PWSH and PowerShell.</p>
<p>I verify its behavior with edits made by uv to <code>HKEY_CURRENT_USER\Environment</code> (adding <code>%USERPROFILE%\.local\bin</code>) and it picked up the changes.</p>
<p>I don't have a Windows 10 22H2 system around to see if it's a version specific issue.</p>
<p>Does <code>setx</code> or <code>regedit</code> (via reg add) from the command prompt session work for you?
Is there something special about the type of account you're using (e.g. is it not a regular user account)? or perhaps some group policy in effect?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2026-01-11 04:17</div>
            <div class="timeline-body"><p>Following up, I believe command prompt (cmd.exe) is not exactly the issue here.</p>
<p>I was able to reproduce this by using the legacy Console Host (conhost.exe) over the newer Windows Terminal.</p>
<p>I believe it would reasonable to include the broadcast to support conhost in https://github.com/astral-sh/uv/blob/7e7f1656ca361b4d3e6ee4d1f2b1dfad6fe08a64/crates/uv-shell/src/windows.rs#L40-L50</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @samypr100 on 2026-01-11 04:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2026-01-11 14:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 02:13:50 UTC
    </footer>
</body>
</html>
