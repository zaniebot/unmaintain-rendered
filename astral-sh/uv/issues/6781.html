<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add the option to `uv add` to pin to latest version of package - astral-sh/uv #6781</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add the option to <code>uv add</code> to pin to latest version of package</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6781">#6781</a>
        opened by <a href="https://github.com/SamEdwardes">@SamEdwardes</a>
        on 2024-08-28 22:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SamEdwardes">@SamEdwardes</a></div>
            <div class="timeline-body">Current behaviour
<p>When you run <code>uv add</code> without specifying a version constraint, it defaults to <code>&gt;=</code> latest version. I think this is a good default.</p>
<pre><code>uv init --app --python 3.12.5
uv add black

cat pyproject.toml
# [project]
# name = &quot;example-2&quot;
# version = &quot;0.1.0&quot;
# description = &quot;Add your description here&quot;
# readme = &quot;README.md&quot;
# requires-python = &quot;&gt;=3.12.4&quot;
# dependencies = [
#     &quot;black&gt;=24.8.0&quot;,
# ]
</code></pre>
Idea
<p>It would be helpful if there was an option to specify a different version constraint. For example:</p>
<pre><code>uv add black --pin-to-latest

cat pyproject.toml
# [project]
# name = &quot;example-2&quot;
# version = &quot;0.1.0&quot;
# description = &quot;Add your description here&quot;
# readme = &quot;README.md&quot;
# requires-python = &quot;&gt;=3.12.4&quot;
# dependencies = [
#     &quot;black==24.8.0&quot;,
# ]
</code></pre>
Use case
<p>When developing apps, I do not need to support a range of different versions. I could instead do the following:</p>
<pre><code>uv add black==24.8.0
</code></pre>
<p>The only downside to the above, is that it requires me to know the latest version of black. This is easy to find, searching on PyPI. But, I find this is a common enough task I do that I would like a shorthand to install the latest version, but also pin to that specific version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-28 23:05</div>
            <div class="timeline-body"><p>The lockfile is used for pinning versions: https://docs.astral.sh/uv/concepts/projects/#project-lockfile</p>
<p>I think it&#x27;s almost always an anti-pattern to pin to the latest version in your <code>pyproject.toml</code>. Can you share more about why using the lockfile to manage pins is not ideal for your use-case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-28 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SamEdwardes">@SamEdwardes</a> on 2024-08-29 16:01</div>
            <div class="timeline-body"><p>Thanks for getting back to me @zanieb. Maybe I need to do some more reading on how the lockfile works, but my thinking is as follows:</p>
<ul>
<li>I am using uv to manage a project that is an app. I have no concern about supporting multiple versions of packages or Python.</li>
<li>For example, lets pretend my app is a FastAPI app.</li>
<li>I want to tightly control the version of FastAPI I am using. When I upgrade to a new version, I want it to be really explicit, so I pin FastAPI to a specific version.</li>
<li>I am less worried about the transitive dependencies of FastAPI. I will let the resolver figure out the latest versions of the packages that will work with my desired version of FastAPI.</li>
<li>To achieve this, I was using a workflow like this:</li>
</ul>
<pre><code># requirements.in
fastapi==0.112.2
</code></pre>
<ul>
<li>Then use pip compile to create a requirements.txt</li>
</ul>
<pre><code>uv pip compile requirements.in --quiet --output-file requirements.txt uv pip sync requirements.txt
</code></pre>
<ul>
<li>Now that I am using the <code>uv add</code> workflow, my intuition was to use the same approach:<ul>
<li><code>requirements.in</code> is now <code>pyproject.toml</code></li>
<li><code>requirements.txt</code> is now <code>uv.lock</code></li>
</ul>
</li>
</ul>
<p>In the context of building an app (as opposed to a library) do you think it makes sense to pin top level dependencies in pyproject.toml?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-08-29 16:14</div>
            <div class="timeline-body"><p>I think even with an application, it makes sense to leave the version in the <code>pyproject.toml</code> unpinned.</p>
<p>There <em>is</em> <code>--upgrade-package &lt;name&gt;</code> which is helpful if you want to only upgrade a single package — but that doesn&#x27;t quite solve your transitive dependency use-case. I think what you&#x27;re looking for is more control over how we do upgrades. For example, these don&#x27;t exist, but would probably help with your use-case?</p>
<ul>
<li><code>--no-upgrade-package &lt;name&gt;</code></li>
<li><code>--upgrade-strategy &lt;transitive | direct&gt;</code></li>
</ul>
<p>You definitely <em>can</em> still pin your packages in your <code>pyproject.toml</code>, but I&#x27;m not sure it makes sense for us to prioritize support for doing it automatically?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SamEdwardes">@SamEdwardes</a> on 2024-09-05 00:54</div>
            <div class="timeline-body"><p>Hi @zanieb thanks for the thoughtful response. I think I agree, it does not make sense for uv to add anything to the CLI at this time to automatically pin to the latest.</p>
<p>I think that maybe my mental model has been wrong and I am not fully Embarrassing the correct use of pyproject.toml and uv.lock.</p>
<ul>
<li>pyproject.toml: broad requirments</li>
<li>uv.lock: exact requirements</li>
</ul>
<p>I will try this workflow for a longer period of time and see if I run into any challenges. Thank you for your help!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/SamEdwardes">@SamEdwardes</a> on 2024-09-05 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samuelhwilliams">@samuelhwilliams</a> on 2024-11-20 12:18</div>
            <div class="timeline-body"><p>I think it feels slightly &#x27;off&#x27; to have <code>pyproject.toml</code> say something like <code>flask&gt;=1</code>, but the lockfile say <code>flask==3.1.0</code>. If that&#x27;s the case, <code>flask==1</code> is probably very much <em>not</em> a valid requirement any more. <code>uv add -U flask</code> will only upgrade <code>uv.lock</code>, and not bump the range in <code>pyproject.toml</code>. So over time, without manual management, <code>pyproject.toml</code> will gradually just be less and less in line with reality?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dudicoco">@dudicoco</a> on 2024-12-09 19:52</div>
            <div class="timeline-body"><blockquote>
<p>The lockfile is used for pinning versions: <a href="https://docs.astral.sh/uv/concepts/projects/#project-lockfile">docs.astral.sh/uv/concepts/projects#project-lockfile</a></p>
<p>I think it&#x27;s almost always an anti-pattern to pin to the latest version in your <code>pyproject.toml</code>. Can you share more about why using the lockfile to manage pins is not ideal for your use-case?</p>
</blockquote>
<p>@zanieb why is it an anti-pattern to pin the version in <code>pyproject.toml</code>?
<code>npm/pnpm add --save-exact</code> for example will pin the version in <code>package.json</code>.
These days we have renovate which can update both <code>pyproject.toml</code> and <code>uv.lock</code>, so we there&#x27;s no problem with pinning the version.</p>
<p>In turn we get a more stable lock file which can&#x27;t change without notice.
Please let me know if we can reopen this issue or if i&#x27;ll should open a new issue instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-09 20:01</div>
            <div class="timeline-body"><blockquote>
<p>@zanieb why is it an anti-pattern to pin the version in pyproject.toml?</p>
</blockquote>
<p>The project metadata is used to declare supported ranges. The lockfile is used to pin to a consistent version within that range. Using the project metadata to pin to an exact version is overly restrictive, e.g., the project won&#x27;t be installable alongside other projects, the resolver can&#x27;t solve for the pinned version for you, etc.</p>
<blockquote>
<p>In turn we get a more stable lock file which can&#x27;t change without notice.</p>
</blockquote>
<p>The lockfile already shouldn&#x27;t change without notice — it&#x27;ll only change if the inputs change or you pass <code>--upgrade</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-09 20:03</div>
            <div class="timeline-body"><blockquote>
<p>I think it feels slightly &#x27;off&#x27; to have pyproject.toml say something like flask&gt;=1, but the lockfile say flask==3.1.0. If that&#x27;s the case, flask==1 is probably very much not a valid requirement any more. uv add -U flask will only upgrade uv.lock, and not bump the range in pyproject.toml. So over time, without manual management, pyproject.toml will gradually just be less and less in line with reality?</p>
</blockquote>
<p>This is why projects should also test against the lowest supported versions of packages, e.g., with <code>--resolution lowest-direct</code>.</p>
<p>See <a href="https://github.com/astral-sh/uv/issues/6794">astral-sh/uv#6794</a> for discussion on updating the <code>pyproject.toml</code> during upgrade.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samuelhwilliams">@samuelhwilliams</a> on 2024-12-09 20:23</div>
            <div class="timeline-body"><blockquote>
<p>The project metadata is used to declare supported ranges. The lockfile is used to pin to a consistent version within that range. Using the project metadata to pin to an exact version is overly restrictive, e.g., the project won&#x27;t be installable alongside other projects, the resolver can&#x27;t solve for the pinned version for you, etc.</p>
</blockquote>
<blockquote>
<p>This is why projects should also test against the lowest supported versions of packages, e.g., with <code>--resolution lowest-direct</code>.</p>
</blockquote>
<p>I think I disagree in a few places.</p>
<p>For libraries, it makes sense to test against lowest direct resolution/a range of dependency versions. For applications, you don&#x27;t ever need to support ranges - your direct dependencies are only ever going to be one thing?</p>
<p>Also, for applications, the lockfile is more about pinning exact versions of transitive dependencies than it is for saying what version of direct dependencies you care about, I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dudicoco">@dudicoco</a> on 2024-12-09 22:12</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p><a href="https://github.com/zanieb"><img alt="" src="https://avatars.githubusercontent.com/u/2586601?s=64&amp;u=e5c86f7ff3b859e7e183187ac2b17fd6ee32b3ab&amp;v=4">@zanieb</a> why is it an anti-pattern to pin the version in pyproject.toml?</p>
</blockquote>
<p>The project metadata is used to declare supported ranges. The lockfile is used to pin to a consistent version within that range. Using the project metadata to pin to an exact version is overly restrictive, e.g., the project won&#x27;t be installable alongside other projects, the resolver can&#x27;t solve for the pinned version for you, etc.</p>
<blockquote>
<p>In turn we get a more stable lock file which can&#x27;t change without notice.</p>
</blockquote>
<p>The lockfile already shouldn&#x27;t change without notice — it&#x27;ll only change if the inputs change or you pass <code>--upgrade</code></p>
</blockquote>
<p>The lockfile will change if I add/change another dependency in <code>pyproject.toml</code>, this change could bump the version and possibly break my existing dependencies.</p>
<p>I&#x27;m using the <code>pyproject.toml</code> for installing CLI tools via <code>devDependencies</code> (for example yamllint, ansible etc.), I want each tool to be locked to a specific version and a change to one tool&#x27;s version should not change the other tools versions.</p>
<p>I think this is becoming more of a philosophical/opinionated discussion on how people should work with <code>pyproject.toml</code> and <code>uv.lock</code>.
Some of us prefer to lock the versions down within <code>pyproject.toml</code>, and as I&#x27;ve mentioned before there is a precedence to this with <code>npm add --save-exact</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SamEdwardes">@SamEdwardes</a> on 2024-12-10 20:34</div>
            <div class="timeline-body"><blockquote>
<p>and as I&#x27;ve mentioned before there is a precedence to this with npm add --save-exact</p>
</blockquote>
<p>I have never seen that option before with NPM. But I would like to have something similar with uv :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lbraglia">@lbraglia</a> on 2025-02-23 08:15</div>
            <div class="timeline-body"><p>I&#x27;d like to see this option as well (would become my default I guess), to ease reproducibility of scripts (say scientific area, but not only) after a lot of time passed and libraries have changed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-02-24 15:43</div>
            <div class="timeline-body"><p>@lbraglia I&#x27;d recommend using https://docs.astral.sh/uv/reference/settings/#exclude-newer in your scripts or generating a lockfile https://docs.astral.sh/uv/guides/scripts/#locking-dependencies — pinning dependency versions won&#x27;t fix your problem because transitive dependencies are not included.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lbraglia">@lbraglia</a> on 2025-02-25 12:13</div>
            <div class="timeline-body"><p>@zanieb Thanks, I&#x27;ll definitely give <code>exclude-newer</code> a shot.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/silverwind">@silverwind</a> on 2025-10-08 11:11</div>
            <div class="timeline-body"><blockquote>
<p>I think it&#x27;s almost always an anti-pattern to pin to the latest version in your pyproject.toml</p>
</blockquote>
<p>If you are not pinning a dependency in <code>pyproject.toml</code> and another package depends on your package, the version of your dependency isn&#x27;t actually pinned.</p>
<p>I always change the <code>&gt;=</code> dependencies that uv creates to <code>==</code> and I would really like a <code>save-exact</code> option which does this by default. It should be trivial to implement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/christopherwerner">@christopherwerner</a> on 2026-01-20 19:15</div>
            <div class="timeline-body"><p>Tl;dr  <code>uv add &lt;something&gt; --bounds=exact</code> as of uv 0.7.9 (preview feature!)
Excluded-newer is a poor workaround. It turns out though that this has been since added - found by following mquan86&#x27;s link.
It was added in May 2025 - here are the release notes: https://github.com/astral-sh/uv/releases/tag/0.7.9</p>
<p>See the pyproject setting here https://docs.astral.sh/uv/reference/settings/#add-bounds
This issue seemed to be the one that convinced zanieb et al: <a href="https://github.com/astral-sh/uv/issues/6783">astral-sh/uv#6783</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:47:04 UTC
    </footer>
</body>
</html>
