<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatic Retry on Archive Extraction Failure (&quot;unexpected BufError&quot;) - astral-sh/uv #8692</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Automatic Retry on Archive Extraction Failure (&quot;unexpected BufError&quot;)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8692">#8692</a>
        opened by <a href="https://github.com/tinovyatkin">@tinovyatkin</a>
        on 2024-10-30 08:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tinovyatkin">@tinovyatkin</a> on 2024-10-30 08:23</div>
            <div class="timeline-body"><p>We are frequently encountering intermittent unzipping errors when using uv with AWS CodeArtifact, resulting in failed installations during uv pip install operations. These errors appear to stem from network issues, as re-running the installation command usually resolves the problem.</p>
<p>Example Error:</p>
<pre><code class="language-sh">error: Failed to prepare distributions
  Caused by: Failed to download `pyarrow==18.0.0`
  Caused by: Failed to extract archive
  Caused by: unexpected BufError                                  
</code></pre>
<p>For instance, NPM's handling of similar issues:</p>
<pre><code class="language-sh">npm warn tarball tarball data for ts-jest@29.2.3 (sha512-yCcfVdiBFngVz9/keHin9EnsrQtQtEu3nRykNy9RVp+FiPFFbPJ3Sg6Qg4+TkmH0vMP5qsTKgXSsk80HRwvdgQ==) seems to be corrupted. Trying again.
</code></pre>
<p>It would be highly beneficial if <code>uv</code> could automatically retry the extraction process upon failure, similar to how NPM handles tarball data errors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-30 12:41</div>
            <div class="timeline-body"><p>We do generally retry these. What version of uv are you on?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-10-30 12:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tinovyatkin">@tinovyatkin</a> on 2024-10-30 16:44</div>
            <div class="timeline-body"><blockquote>
<p>We do generally retry these. What version of uv are you on?</p>
</blockquote>
<img width="566" alt="Screenshot 2024-10-30 at 17 44 30" src="https://github.com/user-attachments/assets/7431056c-bea3-44fd-bae6-78f0fb6236b4">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-03 03:19</div>
            <div class="timeline-body"><p>I think we fixed this in a later version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-03-03 03:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-03-03 03:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../delta-io/delta-rs/pulls/3146.html">delta-io/delta-rs#3146</a> on 2025-03-11 07:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JabobKrauskopf">@JabobKrauskopf</a> on 2025-03-11 10:22</div>
            <div class="timeline-body"><p>@charliermarsh This still seems to be a problem in the latest version (<code>0.6.5</code>).</p>
<p>It happened to me today in a GitHub Action.</p>
<p>Logs:
Install <code>uv</code> step to confirm the latest version</p>
<pre><code>2025-03-11T09:14:00.2206286Z ##[group]Run astral-sh/setup-uv@v5
2025-03-11T09:14:00.2206642Z with:
2025-03-11T09:14:00.2206869Z   enable-cache: true
2025-03-11T09:14:00.2207146Z   cache-dependency-glob: pyproject.toml
2025-03-11T09:14:00.2207465Z   python-version: 3.12
2025-03-11T09:14:00.2207908Z   github-token: ***
2025-03-11T09:14:00.2208177Z   prune-cache: true
2025-03-11T09:14:00.2208438Z   ignore-nothing-to-cache: false
2025-03-11T09:14:00.2208721Z ##[endgroup]
2025-03-11T09:14:00.7565566Z Downloading uv from &quot;https://github.com/astral-sh/uv/releases/download/0.6.5/uv-x86_64-unknown-linux-gnu.tar.gz&quot; ...
2025-03-11T09:14:01.2792730Z [command]/usr/bin/tar xz --warning=no-unknown-keyword --overwrite -C /home/runner/work/_temp/660348e6-30ae-41d0-b85c-b7524da7e49c -f /home/runner/work/_temp/e5fe18f1-8888-4175-a3ba-ba915f34e4a7
2025-03-11T09:14:01.6530733Z Added /opt/hostedtoolcache/uv/0.6.5/x86_64 to the path
2025-03-11T09:14:01.6533572Z Added /home/runner/.local/bin to the path
2025-03-11T09:14:01.6535070Z Set UV_PYTHON to 3.12
2025-03-11T09:14:01.6536448Z Activating python venv...
2025-03-11T09:14:03.0357001Z Set UV_CACHE_DIR to /home/runner/work/_temp/setup-uv-cache
2025-03-11T09:14:03.0357682Z Successfully installed uv version 0.6.5
2025-03-11T09:14:03.0358278Z Searching files using cache dependency glob: pyproject.toml
2025-03-11T09:14:03.0385263Z /home/runner/work/medmodels-plus/medmodels-plus/pyproject.toml
2025-03-11T09:14:03.0403237Z Found 1 files to hash.
2025-03-11T09:14:03.0470812Z Trying to restore uv cache from GitHub Actions cache with key: setup-uv-1-x86_64-unknown-linux-gnu-3.12-029840fbbef2cea6424fa2a081f12f2a5903f2a5a7c819e8ef1e70192c4c4a8d
2025-03-11T09:14:03.1742737Z Cache hit for: setup-uv-1-x86_64-unknown-linux-gnu-3.12-029840fbbef2cea6424fa2a081f12f2a5903f2a5a7c819e8ef1e70192c4c4a8d
2025-03-11T09:14:03.8168472Z Received 4998252 of 4998252 (100.0%), 9.8 MBs/sec
2025-03-11T09:14:03.8172615Z Cache Size: ~5 MB (4998252 B)
2025-03-11T09:14:03.8212366Z [command]/usr/bin/tar -xf /home/runner/work/_temp/ccf2698e-856b-4120-95e9-e342d7f22b96/cache.tzst -P -C /home/runner/work/medmodels-plus/medmodels-plus --use-compress-program unzstd
2025-03-11T09:14:03.8762905Z Cache restored successfully
2025-03-11T09:14:03.8790678Z uv cache restored from GitHub Actions cache with key: setup-uv-1-x86_64-unknown-linux-gnu-3.12-029840fbbef2cea6424fa2a081f12f2a5903f2a5a7c819e8ef1e70192c4c4a8d
</code></pre>
<p>Dependency installation step</p>
<pre><code>2025-03-11T09:14:35.4702896Z ##[group]Run uv sync --extra tests
2025-03-11T09:14:35.4703201Z [36;1muv sync --extra tests[0m
2025-03-11T09:14:35.4759664Z shell: /usr/bin/bash -e {0}
2025-03-11T09:14:35.4759900Z env:
2025-03-11T09:14:35.4760066Z   UV_PYTHON: 3.12
2025-03-11T09:14:35.4760358Z   VIRTUAL_ENV: /home/runner/work/medmodels-plus/medmodels-plus/.venv
2025-03-11T09:14:35.4760737Z   UV_CACHE_DIR: /home/runner/work/_temp/setup-uv-cache
2025-03-11T09:14:35.4761078Z   pythonLocation: /opt/hostedtoolcache/Python/3.12.9/x64
2025-03-11T09:14:35.4761462Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.12.9/x64/lib/pkgconfig
2025-03-11T09:14:35.4761836Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.9/x64
2025-03-11T09:14:35.4762356Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.9/x64
2025-03-11T09:14:35.4762691Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.12.9/x64
2025-03-11T09:14:35.4763023Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.12.9/x64/lib
2025-03-11T09:14:35.4763316Z   CARGO_HOME: /home/runner/.cargo
2025-03-11T09:14:35.4763568Z   CARGO_INCREMENTAL: 0
2025-03-11T09:14:35.4763756Z   CARGO_TERM_COLOR: always
2025-03-11T09:14:35.4763955Z ##[endgroup]
2025-03-11T09:14:36.3958869Z Resolved 119 packages in 769ms
2025-03-11T09:14:36.4079192Z    Building medmodels @ file:///home/runner/work/medmodels-plus/medmodels-plus
2025-03-11T09:14:36.5012557Z Downloading pyarrow (40.1MiB)
2025-03-11T09:14:36.5015044Z Downloading nvidia-nvjitlink-cu12 (37.4MiB)
2025-03-11T09:14:36.5016925Z Downloading polars (32.7MiB)
2025-03-11T09:14:36.5018077Z Downloading nvidia-cuda-nvrtc-cu12 (22.6MiB)
2025-03-11T09:14:36.5019476Z Downloading scipy (35.6MiB)
2025-03-11T09:14:36.5021019Z Downloading llvmlite (40.4MiB)
2025-03-11T09:14:36.5022766Z Downloading nvidia-cufft-cu12 (116.0MiB)
2025-03-11T09:14:36.5024709Z Downloading numpy (17.1MiB)
2025-03-11T09:14:36.5025309Z Downloading nvidia-cuda-cupti-cu12 (13.5MiB)
2025-03-11T09:14:36.5026793Z Downloading scikit-learn (12.5MiB)
2025-03-11T09:14:36.5027258Z Downloading sympy (5.9MiB)
2025-03-11T09:14:36.5029402Z Downloading numba (3.7MiB)
2025-03-11T09:14:36.5030309Z Downloading networkx (1.6MiB)
2025-03-11T09:14:36.5060683Z Downloading nvidia-nccl-cu12 (158.3MiB)
2025-03-11T09:14:36.5507047Z Downloading pandas (12.1MiB)
2025-03-11T09:14:36.5508881Z Downloading torch (720.5MiB)
2025-03-11T09:14:36.5509644Z Downloading nvidia-cusolver-cu12 (118.4MiB)
2025-03-11T09:14:36.5511595Z Downloading nvidia-cudnn-cu12 (697.8MiB)
2025-03-11T09:14:36.5512412Z Downloading nvidia-cusparse-cu12 (186.9MiB)
2025-03-11T09:14:36.5514884Z Downloading nvidia-cublas-cu12 (391.6MiB)
2025-03-11T09:14:36.5515752Z Downloading nvidia-curand-cu12 (53.9MiB)
2025-03-11T09:14:37.3803063Z   Ã— Failed to download `pyarrow==19.0.1`
2025-03-11T09:14:37.3804071Z   â”œâ”€â–¶ Failed to extract archive
2025-03-11T09:14:37.3805085Z   â•°â”€â–¶ unexpected BufError
2025-03-11T09:14:37.3805875Z   help: `pyarrow` (v19.0.1) was included because `medmodels` (v0.2.1) depends
2025-03-11T09:14:37.3812670Z         on `polars[pandas]` (v1.24.0) which depends on `pyarrow`
2025-03-11T09:14:37.3886819Z ##[error]Process completed with exit code 1.
</code></pre>
<p>It's not great that this error is still a thing, especially since CI pipelines are supposed to be robust and not fail randomly/unexpectedly.</p>
<p>Other people seem to also have this issuse: https://github.com/delta-io/delta-rs/pull/3146#issuecomment-2712917020
The action: https://github.com/delta-io/delta-rs/actions/runs/13775527214/job/38540888622?pr=3146#step:5:116</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-03-11 11:30</div>
            <div class="timeline-body"><p>We're seeing these error in uv's CI too: https://github.com/astral-sh/uv/actions/runs/13779390991/job/38534745223</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Automatic Retry on Archive Extraction Failure" to "Automatic Retry on Archive Extraction Failure ("unexpected BufError")" by @konstin on 2025-03-11 11:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @konstin on 2025-03-11 11:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2025-03-11 11:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @konstin on 2025-03-11 11:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ion-elgreco">@ion-elgreco</a> on 2025-03-11 12:12</div>
            <div class="timeline-body"><p>Yup our CI at <code>delta-rs</code> are constantly failing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-11 12:47</div>
            <div class="timeline-body"><p>This looks like an actual bug in either the archive or more likely one of our dependencies?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/omkar-foss">@omkar-foss</a> on 2025-03-11 13:16</div>
            <div class="timeline-body"><p>Yeah I checked this, looks a source archive corruption, as PyPI is facing a file corruption incident in the last few hours today: https://status.python.org/incidents/2zf08fkp0nd1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12114.html">astral-sh/uv#12114</a> on 2025-03-11 13:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-03-11 14:05</div>
            <div class="timeline-body"><p>PyPI reports the incident has been resolved, I'll close this if we see no further issues</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-07-03 18:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
