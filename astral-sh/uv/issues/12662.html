<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv venv` activation script has side effects with zsh and bash - astral-sh/uv #12662</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv venv</code> activation script has side effects with zsh and bash</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/12662">#12662</a>
        opened by <a href="https://github.com/zsimic">@zsimic</a>
        on 2025-04-04 03:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zsimic">@zsimic</a> on 2025-04-04 03:17</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>The <code>venv/bin/activate</code> script has an unfortunate side-effect: it defines and leaves behind a variable called <code>SCRIPT_PATH</code>, which can then adversely impact shell scripts that also had the idea of using a <code>SCRIPT_PATH</code> shell variable.</p>
<p>Ideally, the activation script should not leak variables, or as few as possible.</p>
<p>I'm attaching here a script that shows what happens, and the difference with standard <code>-mvenv</code> activation script.</p>
<p>You can observe this issue by running this demo shell script in a sandbox folder somewhere (it creates 3 files):</p>
<pre><code>zsh repro-venv-leak.sh     # no leak with -mvenv
zsh repro-venv-leak.sh uv  # leak with uv

# Same with bash:
bash repro-venv-leak.sh
bash repro-venv-leak.sh uv
</code></pre>
<p>Script:</p>
<pre><code>#!/bin/bash

record_shell_variables() {
    local _where=$1
    set | grep -Ev &quot;^(_|PS1|_OLD_VIRTUAL_PS1|(BASH_)LINENO|RANDOM|'\*'|@|_where|argv)=&quot; &gt; &quot;$_where&quot;
}

if [[ &quot;$1&quot; == &quot;uv&quot; ]]; then
    echo &quot;Creating venv with uv&quot;
    uv venv
else
    echo &quot;Creating venv with python3 -mvenv&quot;
    rm -rf .venv ; python3 -mvenv .venv
fi

record_shell_variables original-vars.txt
echo &quot;Activating then de-activating venv&quot;
source .venv/bin/activate
record_shell_variables activated-vars.txt
deactivate
record_shell_variables post-activation-vars.txt

echo &quot;Diff (should be empty):&quot;
diff original-vars.txt post-activation-vars.txt
echo --------
</code></pre>
<h3>Platform</h3>
<p>macos, linux</p>
<h3>Version</h3>
<p>0.6.12</p>
<h3>Python version</h3>
<p>any</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zsimic on 2025-04-04 03:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zsimic">@zsimic</a> on 2025-04-04 03:26</div>
            <div class="timeline-body"><p>It appears that the shell variable <code>SCRIPT_PATH</code> is not used in the activation script, but is used from outside, to try and make venvs relocatable.</p>
<p>May I suggest to rename the variable <code>_UV_VENV_ACTIVATOR</code>? This will lower the chance of clashing with other shell scripts out in the wild that can be surprised by this &quot;side effect&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-04-04 12:50</div>
            <div class="timeline-body"><p>That seems like a good idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-04-04 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-04-07 18:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:59 UTC
    </footer>
</body>
</html>
