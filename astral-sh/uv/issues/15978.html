<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Request: Persist Environment Variables in pyproject.toml for Git Dependencies - astral-sh/uv #15978</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature Request: Persist Environment Variables in pyproject.toml for Git Dependencies</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/15978">#15978</a>
        opened by <a href="https://github.com/luigibrb">@luigibrb</a>
        on 2025-09-22 10:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/luigibrb">@luigibrb</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When adding a private Git dependency with uv add using environment variables for authentication, the environment variables are not persisted in the <code>pyproject.toml</code> file.</p>
<h3>Problem Description</h3>
<p>Our current workflow involves using a Gitlab deploy token with environment variables to avoid storing secrets in the repository:</p>
<pre><code>export GITLAB_DEPLOY_USER=&lt;your_gitlab_user&gt;
export GITLAB_DEPLOY_TOKEN=&lt;your_gitlab_token&gt;

uv add &quot;git+https://${GITLAB_DEPLOY_USER}:${GITLAB_DEPLOY_TOKEN}@&lt;private_gitlab_address&gt;/&lt;repo_path&gt;/&lt;repo-name&gt;.git@main&quot;
</code></pre>
<p>The uv add command successfully adds the dependency and resolves it. However, the resulting entry in <code>pyproject.toml</code> looks like this:</p>
<pre><code>[tool.uv.sources]
&lt;dependency_name&gt; = { git = &quot;https://&lt;private_gitlab_address&gt;/&lt;repo_path&gt;/&lt;repo-name&gt;.git&quot;, rev = &quot;main&quot; }
</code></pre>
<p>As you can see, the <code>${GITLAB_DEPLOY_USER}:${GITLAB_DEPLOY_TOKEN}</code> part is removed. This means that if another user clones the repository and tries to install dependencies with <code>uv install</code>, they will get an authentication error unless they manually edit their local <code>pyproject.toml</code> file. This defeats the purpose of using environment variables for secure, portable configurations.</p>
<h3>Steps to Reproduce</h3>
<p>Set up environment variables for a private Git repository:</p>
<pre><code>export GITLAB_DEPLOY_USER=&quot;oauth2&quot;
export GITLAB_DEPLOY_TOKEN=&quot;glpat-&lt;your-token&gt;&quot;
</code></pre>
<p>Run uv add with the environment variables in the URL:</p>
<pre><code>uv add &quot;git+https://${GITLAB_DEPLOY_USER}:${GITLAB_DEPLOY_TOKEN}@&lt;private_gitlab_address&gt;/&lt;repo_path&gt;/&lt;repo-name&gt;.git@main&quot;
</code></pre>
<p>Check the <code>pyproject.toml</code> file. The URL will be missing the authentication part, instead of retaining the environment variables.</p>
<h3>Proposed Solution</h3>
<p>I propose that <code>uv</code> should recognize and retain the environment variable syntax <code>(${VAR_NAME})</code> when adding a git-based dependency to the <code>pyproject.toml</code> file.
The desired output in <code>pyproject.toml</code> should be:</p>
<pre><code>[tool.uv.sources]
&lt;dependency_name&gt; = { git = &quot;https://${GITLAB_DEPLOY_USER}:${GITLAB_DEPLOY_TOKEN}@&lt;private_gitlab_address&gt;/&lt;repo_path&gt;/&lt;repo-name&gt;.git&quot;, rev = &quot;main&quot; }
</code></pre>
<p>This would allow teams to securely share projects without exposing secrets or requiring manual changes to the project's configuration file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @luigibrb on 2025-09-22 10:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:32:58 UTC
    </footer>
</body>
</html>
