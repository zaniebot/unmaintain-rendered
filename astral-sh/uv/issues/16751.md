```yaml
number: 16751
title: "Build backend: `source-include` silently ignores directory without a glob pattern"
type: issue
state: open
author: woodruffw
labels:
  - bug
  - build-backend
assignees: []
created_at: 2025-11-16T05:52:09Z
updated_at: 2025-11-17T21:08:04Z
url: https://github.com/astral-sh/uv/issues/16751
synced_at: 2026-01-10T01:57:37Z
```

# Build backend: `source-include` silently ignores directory without a glob pattern

---

_Issue opened by @woodruffw on 2025-11-16 05:52_

### Summary

This is potentially PEBKAC or addressable with some documentation, but I figured I'd file it as a bug for visibility ðŸ™‚ 

TL;DR: I had a `[tool.uv.build-backend]` section like this:

```toml
[tool.uv.build-backend]
source-include = ["tests/"]
```

I _expected_ this to include the `tests/` directory in the sdist produced by `uv build`, but it didn't. This can be seen here (along with the `pyproject.toml`:

https://inspector.pypi.io/project/cachecontrol/0.14.4/packages/2d/f6/c972b32d80760fb79d6b9eeb0b3010a46b89c0b23cf6329417ff7886cd22/cachecontrol-0.14.4.tar.gz/

To fix this, I needed to add an explicit pattern:

```toml
[tool.uv.build-backend]
source-include = ["tests/**"]
```

with that, the sdist contained the `tests/` directory (and all child files/directories) as expected.

See https://github.com/psf/cachecontrol/issues/396 and https://github.com/psf/cachecontrol/pull/397 for some more (but not much more) context.

In terms of expected behavior: I expected `source-include = ["tests/"]` to fully include the `tests/` directory, since my intuition is that "including" a directory means including it in full, even without a double-glob for "collect everything." Alternatively/separately, I expected `uv build` to produce a warning that the `source-include` setting was a no-op/didn't actually include anything.

On the docs side, this is sort of covered by `source-include` being described as a list of "glob expressions." However, since `tests/` didn't actually produce a warning/error about being an invalid glob expression, I expected it to work (for the reasons above about my intuitions with directories).

Ref: https://docs.astral.sh/uv/reference/settings/#build-backend_source-include

### Platform

Darwin 24.6.0 arm64

### Version

uv 0.9.9 (Homebrew 2025-11-12)

### Python version

Python 3.14.0

---

_Label `bug` added by @woodruffw on 2025-11-16 05:52_

---

_Label `build-backend` added by @woodruffw on 2025-11-16 05:52_

---

_Comment by @konstin on 2025-11-17 20:46_

A warning if a literal expression doesn't match any files is good idea.

Picking the right glob semantics is hard, often choosing one thing that sounds like an improvement is a regression or a footgun in another case. I have to think some more about the file vs. directory case. Currently, the model is that we walk the source tree and include every path, including parents, that matches the glob, similar to git.

---

_Comment by @woodruffw on 2025-11-17 20:52_

> A warning if a literal expression doesn't match any files is good idea.

Sounds good!

> Currently, the model is that we walk the source tree and include every path, including parents, that matches the glob, similar to git.

This makes sense, although git (or at least `gitignore`) _does_ have the directory matching semantics I'd expect here: `foo/` in `gitignore` means "ignore everything under `foo/`". FWICT, in `gitignore` these are equivalent:

```
foo/
foo/**
```

---

_Comment by @woodruffw on 2025-11-17 21:05_

(Noting: include and exclude globs are collected and then merged into `GlobDirFilter`s, which have both a fast-path DFA and a fallback `GlobSet` internally. So tracking "hits" for each glob is going to be a little interesting.)

---
