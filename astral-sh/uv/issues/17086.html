<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add some local package failed - astral-sh/uv #17086</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add some local package failed</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/17086">#17086</a>
        opened by <a href="https://github.com/imbear">@imbear</a>
        on 2025-12-11 14:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/imbear">@imbear</a> on 2025-12-11 14:20</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>First, I try a project with below configure:</p>
<p>pyproject.toml</p>
<pre><code>[project]
name = &quot;pypy&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.14&quot;
dependencies = [
    &quot;xlwings&gt;=0.33.17&quot;,
]

[tool.uv]
cache-dir = &quot;D:/pypy/cache&quot;
find-links = [&quot;d:/python-packages&quot;]
no-index = true
</code></pre>
<p>Command execute failed:</p>
<pre><code>❯ uv add xlwings
  × No solution found when resolving dependencies:
  ╰─▶ Because only appscript{sys_platform == 'darwin'}&lt;1.0.1 is available and xlwings==0.33.17 depends on appscript{sys_platform == 'darwin'}&gt;=1.0.1, we can conclude that xlwings==0.33.17 cannot be used.
      And because only xlwings==0.33.17 is available and your project depends on xlwings, we can conclude that your project's requirements are unsatisfiable.
  help: If you want to add the package regardless of the failed resolution, provide the `--frozen` flag to skip locking and syncing.
</code></pre>
<p>I change the configure:</p>
<pre><code>...

[tool.uv]
index-url = &quot;https://mirrors.aliyun.com/pypi/simple&quot;
cache-dir = &quot;D:/pypy/cache&quot;
</code></pre>
<p>Command execute successfully:</p>
<pre><code>❯ uv add xlwings
Resolved 6 packages in 648ms
Prepared 2 packages in 813ms
Installed 2 packages in 180ms
 + pywin32==311
 + xlwings==0.33.17
</code></pre>
<h3>Platform</h3>
<p>windows11 x64</p>
<h3>Version</h3>
<p>uv 0.9.17 (2b5d65e61 2025-12-09)</p>
<h3>Python version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @imbear on 2025-12-11 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-12-11 15:22</div>
            <div class="timeline-body"><p>Those configurations are different though. The former is only looking at your find-links directory, the latter includes the PyPI mirror. Does your <code>d:/python-packages</code> contain all of your dependencies? The error message suggests it does not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-12-11 15:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-12-11 15:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imbear">@imbear</a> on 2025-12-11 22:50</div>
            <div class="timeline-body"><p>I download xlwings by <code>pip download</code>, so the dependencies is good.</p>
<p>METADATA of xlwings-0.33.17-cp314-cp314-win_amd64.whl:</p>
<pre><code>...
Requires-Dist: pywin32&gt;=224; platform_system == &quot;Windows&quot;
Requires-Dist: psutil&gt;=2.0.0; platform_system == &quot;Darwin&quot;
Requires-Dist: appscript&gt;=1.0.1; platform_system == &quot;Darwin&quot;
...
</code></pre>
<p>My system is Windows, but it seemed uv misuse the third Requires-Dist.</p>
<p>I delete this line, now <code>uv add</code> run ok.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-16 14:50</div>
            <div class="timeline-body"><p>You shouldn't manually METADATA files, it will lead to broken installs. Instead, you can limit the environments to windows with <code>tool.uv.environments</code>. By default, uv will resolve for all platforms at the same time, for which it needs access to metadata from all platforms, including metadata for <code>appscript</code>, so it needs to have either an index with the package or the wheel for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @konstin on 2025-12-16 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-12-16 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imbear">@imbear</a> on 2025-12-16 23:20</div>
            <div class="timeline-body"><blockquote>
<p>You shouldn't manually METADATA files, it will lead to broken installs. Instead, you can limit the environments to windows with <code>tool.uv.environments</code>. By default, uv will resolve for all platforms at the same time, for which it needs access to metadata from all platforms, including metadata for <code>appscript</code>, so it needs to have either an index with the package or the wheel for it.</p>
</blockquote>
<p>Oh, I want to know why the requirement checks of <code>uv add</code> by online and local are different.
If I add by online, checking is ok，no other configure is needed. But add by local, checking is failed because of <code>Requires-Dist: appscript&gt;=1.0.1; platform_system == &quot;Darwin&quot;</code>, although my system is Windows, and as you say, I need a extra configure<code>tool.uv.environments</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 09:33</div>
            <div class="timeline-body"><p>What's in the local directory, does it contain an appscript wheel?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imbear">@imbear</a> on 2025-12-17 11:54</div>
            <div class="timeline-body"><blockquote>
<p>What's in the local directory, does it contain an appscript wheel?</p>
</blockquote>
<p>I have downloaded all necessary wheels by <code>pip download xlwings</code>(<code>xlwings</code> only requires <code>pywin32</code> on Windows), also I can install the <code>xlwings</code> by <code>pip --find-links d:/python-packages --no-index xlwings</code>.</p>
<p>I don't understand the error message <code>Because only appscript{sys_platform == 'darwin'}&lt;1.0.1 is available and xlwings==0.33.17 depends on appscript{sys_platform == 'darwin'}&gt;=1.0.1, we can conclude that xlwings==0.33.17 cannot be used.</code>, because my system is Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 12:09</div>
            <div class="timeline-body"><p>the uv project commands resolves for all platforms by default, independent of the host system, so the lockfile is usable universally. This means you can get errors for missing metadata/missing wheels for platforms that aren't the current one. This is different from pip (and <code>uv pip</code> without <code>--universal</code>), which can only use the current platform. That's why <code>tool.uv.environments</code> is the recommendation for limiting to only Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imbear">@imbear</a> on 2025-12-17 23:03</div>
            <div class="timeline-body"><blockquote>
<p>the uv project commands resolves for all platforms by default, independent of the host system, so the lockfile is usable universally. This means you can get errors for missing metadata/missing wheels for platforms that aren't the current one. This is different from pip (and <code>uv pip</code> without <code>--universal</code>), which can only use the current platform. That's why <code>tool.uv.environments</code> is the recommendation for limiting to only Windows.</p>
</blockquote>
<p>Thanks your reply! Now I know.</p>
<p>But why the requirement checking rules of <code>uv add</code> from internet and local are different?
Adding from internet and without configure <code>tool.uv.environments</code>, I also can add <code>xlwings</code> successfully. In this situation, uv will ignore the requirement of other than Windows?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
