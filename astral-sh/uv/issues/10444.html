<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow users to override cache control headers - astral-sh/uv #10444</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Allow users to override cache control headers</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/10444">#10444</a>
        opened by <a href="https://github.com/charliermarsh">@charliermarsh</a>
        on 2025-01-09 21:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-09 21:02</div>
            <div class="timeline-body"><p>Some registries don't provide any cache-control headers, which can make for a suboptimal experience (see: #10359). (PyPI returns 10-minute caching headers.) I wonder if it makes sense to allow users to override the cache-control headers?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2025-01-09 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">network</span> added by @charliermarsh on 2025-01-09 21:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-09 21:42</div>
            <div class="timeline-body"><p>See also #10380</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-10 03:37</div>
            <div class="timeline-body"><p>#10380 seems different -- that appears to be a request that we add a mode that attempts to hit the index, but falls back to <code>--offline</code> behavior if it's unavailable?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-10 04:46</div>
            <div class="timeline-body"><p>I agree it's different. I think the similarity is that we may need to override cache control headers (as I mentioned there) to read from a stale cache? I'm not actually familiar with how that interacts with the offline mode.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-10 04:48</div>
            <div class="timeline-body"><p>I believe we allow reading from a stale cache in offline mode.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chanderson0">@chanderson0</a> on 2025-02-12 23:23</div>
            <div class="timeline-body"><p>+1 to this, just contributing a use case for our organization:</p>
<p>We are working on installing NVIDIA IsaacLab via uv - a huge step up from their bespoke conda envs. This requires downloading a few gigabytes of packages that do not cache because (I assume) NVIDIA's package index is set to return <code>cache-control: max-age=0, no-cache, no-store</code>. This makes fresh Docker build times using uv quite slow compared to the previous approach, which was to install the package at the system level.</p>
<details>

<summary>An example wheel and HTTP headers</summary>

<pre><code>curl -v https://pypi.nvidia.com/isaacsim-benchmark/isaacsim_benchmark-4.5.0.0-cp310-none-manylinux_2_34_x86_64.whl
*   Trying 23.209.72.14:443...
* Connected to pypi.nvidia.com (23.209.72.14) port 443 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
*  CAfile: /etc/ssl/certs/ca-certificates.crt
*  CApath: /usr/lib/ssl/certs
* TLSv1.0 (OUT), TLS header, Certificate Status (22):
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.2 (IN), TLS header, Certificate Status (22):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS header, Finished (20):
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.2 (OUT), TLS header, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384
* ALPN, server accepted to use h2
* Server certificate:
*  subject: C=US; ST=California; L=Santa Clara; O=NVIDIA Corporation; CN=it.nvidia.com
*  start date: Dec  2 00:00:00 2024 GMT
*  expire date: Dec  2 23:59:59 2025 GMT
*  subjectAltName: host &quot;pypi.nvidia.com&quot; matched cert's &quot;*.nvidia.com&quot;
*  issuer: C=US; O=DigiCert Inc; CN=DigiCert TLS RSA SHA256 2020 CA1
*  SSL certificate verify ok.
* Using HTTP2, server supports multiplexing
* Connection state changed (HTTP/2 confirmed)
* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
* Using Stream ID: 1 (easy handle 0x63b43ddf0eb0)
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
&gt; GET /isaacsim-benchmark/isaacsim_benchmark-4.5.0.0-cp310-none-manylinux_2_34_x86_64.whl HTTP/2
&gt; Host: pypi.nvidia.com
&gt; user-agent: curl/7.81.0
&gt; accept: */*
&gt; 
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* old SSL session ID is stale, removing
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
* TLSv1.2 (IN), TLS header, Supplemental data (23):
* TLSv1.2 (IN), TLS header, Supplemental data (23):
&lt; HTTP/2 200 
&lt; content-type: application/x-gzip
&lt; content-length: 3318653
&lt; last-modified: Wed, 29 Jan 2025 23:45:30 GMT
&lt; x-amz-server-side-encryption: AES256
&lt; accept-ranges: bytes
&lt; server: AmazonS3
&lt; etag: &quot;d92eac51baff4bf6ba14a6d4f0bb8bba&quot;
&lt; x-amz-cf-pop: EWR53-C1
&lt; x-amz-cf-id: E6Wtn-2__Xl3Zj_upc2AkLe2TfEo7vVta1wTO6Pk9j3JXPLiFKwlBg==
&lt; expires: Wed, 12 Feb 2025 23:14:25 GMT
&lt; cache-control: max-age=0, no-cache, no-store
&lt; pragma: no-cache
&lt; date: Wed, 12 Feb 2025 23:14:25 GMT
&lt; x-cdn-version: v1
&lt; x-cdn: akam
&lt; akamai-grn: 0.8e04d217.1739402065.1f05112d
&lt; 
* TLSv1.2 (IN), TLS header, Supplemental data (23):
Warning: Binary output can mess up your terminal. Use &quot;--output -&quot; to tell 
Warning: curl to output it to your terminal anyway, or consider &quot;--output 
Warning: &lt;FILE&gt;&quot; to save to a file.
* Failure writing output to destination
* TLSv1.2 (OUT), TLS header, Supplemental data (23):
* stopped the pause stream!
* Connection #0 to host pypi.nvidia.com left intact
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-19 01:49</div>
            <div class="timeline-body"><p>The only thing I'm not sure about here is... There are cache-control headers for the Simple API, and then cache-control headers for wheels. And you definitely don't want them to be the same. You probably want, like, 10 minutes for the Simple API, and then forever (immutable) for wheels.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-03-19 02:06</div>
            <div class="timeline-body"><p>I'm tempted to say that we always treat registry wheels as immutable for cache purposes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/heathkh-recursion">@heathkh-recursion</a> on 2025-05-05 18:26</div>
            <div class="timeline-body"><p>In case it is useful... I believe we are experiencing the same issue with a private Google Artifact Registry python index.  From the logs, the cache-control headers are set to 0 which seems to be associated with redownloading the same package (and unbounded growth of the cache).   If there is something we can do to help troubleshoot or test, let me know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/14121.html">astral-sh/uv#14121</a> on 2025-06-18 00:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-07-14 21:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14620.html">astral-sh/uv#14620</a> on 2025-07-14 23:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-07-15 14:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s22chan">@s22chan</a> on 2025-07-15 16:59</div>
            <div class="timeline-body"><p>for https://github.com/astral-sh/uv/pull/14620, does this only allow cache overrides for simple API registries?</p>
<p>One issue I experience is that installing wheels from github releases can explode a cache directory pretty quickly, each one (prior to 2.8.1) is 1GB unzipped.
https://github.com/Dao-AILab/flash-attention/releases</p>
<pre><code>❯ curl -I
https://github.com/Dao-AILab/flash-attention/releases/download/v2.8.0.post2/flash_attn-2.8.0.post2+cu12torch2.5cxx11abiTRUE-cp313-cp313-linux_x86_64.whl
HTTP/2 302
...
cache-control: no-cache
</code></pre>
<p>the pypi sources take 30mins+ to compile, so it's not ideal to fallback to that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-07-15 17:47</div>
            <div class="timeline-body"><p>I believe we already cache direct URL dependencies indefinitely. Can you give me a concrete workflow or example that exhibits this problem?</p>
<p>Separately: why download the wheels directly rather than going through the PyPI source distribution? The Flash Attention source distribution just downloads the wheels from GitHub when you're using a compatible version -- by default, it doesn't build from source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s22chan">@s22chan</a> on 2025-07-15 18:31</div>
            <div class="timeline-body"><p>Thanks for responding so quickly!</p>
<blockquote>
<p>I believe we already cache direct URL dependencies indefinitely. Can you give me a concrete workflow or example that exhibits this problem?</p>
</blockquote>
<p>Unfortunately this is under pixi, so let me try to make a minimal repro.</p>
<blockquote>
<p>Separately: why download the wheels directly rather than going through the PyPI source distribution? The Flash Attention source distribution just downloads the wheels from GitHub when you're using a compatible version -- by default, it doesn't build from source.</p>
</blockquote>
<p>I wasn't aware of the automatic wheel download, I tried and it still builds; I'm not sure what I'm doing wrong:</p>
<pre><code class="language-shell">❯ uv add --script example.py 'torch' 'flash-attn'
Updated `example.py`

❯ uv run example.py
  × Failed to build `flash-attn==2.8.1`
  ├─▶ The build backend returned an error
  ╰─▶ Call to `setuptools.build_meta:__legacy__.build_wheel` failed (exit status: 1)

      [stderr]
      Traceback (most recent call last):
        File &quot;&lt;string&gt;&quot;, line 14, in &lt;module&gt;
          requires = get_requires_for_build({})
        File
      &quot;/mnt/main0/home/stevechan/.cache/uv/builds-v0/.tmpinViaV/lib/python3.13/site-packages/setuptools/build_meta.py&quot;,
      line 331, in get_requires_for_build_wheel
          return self._get_build_requires(config_settings, requirements=[])
                 ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File
      &quot;/mnt/main0/home/stevechan/.cache/uv/builds-v0/.tmpinViaV/lib/python3.13/site-packages/setuptools/build_meta.py&quot;,
      line 301, in _get_build_requires
          self.run_setup()
          ~~~~~~~~~~~~~~^^
        File
      &quot;/mnt/main0/home/stevechan/.cache/uv/builds-v0/.tmpinViaV/lib/python3.13/site-packages/setuptools/build_meta.py&quot;,
      line 512, in run_setup
          super().run_setup(setup_script=setup_script)
          ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
        File
      &quot;/mnt/main0/home/stevechan/.cache/uv/builds-v0/.tmpinViaV/lib/python3.13/site-packages/setuptools/build_meta.py&quot;,
      line 317, in run_setup
          exec(code, locals())
          ~~~~^^^^^^^^^^^^^^^^
        File &quot;&lt;string&gt;&quot;, line 22, in &lt;module&gt;
      ModuleNotFoundError: No module named 'torch'

      hint: This error likely indicates that `flash-attn@2.8.1` depends on `torch`, but doesn't declare it as a build
      dependency. If `flash-attn` is a first-party package, consider adding `torch` to its `build-system.requires`.
      Otherwise, `uv pip install torch` into the environment and re-run with `--no-build-isolation`.
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:25 UTC
    </footer>
</body>
</html>
