```yaml
number: 3794
title: Plans for eventually using published pubgrub?
type: issue
state: closed
author: musicinmybrain
labels:
  - question
assignees: []
created_at: 2024-05-23T14:11:18Z
updated_at: 2024-05-23T14:50:00Z
url: https://github.com/astral-sh/uv/issues/3794
synced_at: 2026-01-10T01:57:08Z
```

# Plans for eventually using published pubgrub?

---

_Issue opened by @musicinmybrain on 2024-05-23 14:11_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

I noticed that `pubgrub` is one of two dependencies that `uv` currently needs to fork (https://github.com/astral-sh/pubgrub), with [`async_zip`](https://github.com/prefix-dev/async_http_range_reader/issues/14) being the other. I also noticed that there seems to be ongoing work toward minimizing the changes in the fork, e.g. https://github.com/astral-sh/uv/pull/3713, https://github.com/astral-sh/pubgrub/commit/eeb63dd5fe524d4e3633d789da81e1d73dd574e5.

For the benefit of distribution packagers and others who [need to treat git dependencies specially](https://docs.fedoraproject.org/en-US/packaging-guidelines/Rust/#_replacing_git_dependencies), could you please comment briefly on whether you have a plan for eventually using the published [`pubgrub` crate](https://crates.io/crates/pubgrub)?

---

_Comment by @konstin on 2024-05-23 14:25_

We unfortunately require api-breaking changes to pubgrub and access to some of the internals that will not be exposed in the published version. While we have been and will be spending significant effort into upstreaming our changes (https://github.com/pubgrub-rs/pubgrub/pulls?q=is%3Apr+author%3Akonstin), we unfortunately do not have plans to switch to a crates.io version of pubgrub.

---

_Comment by @musicinmybrain on 2024-05-23 14:31_

Thanks! Even if the fork will be maintained indefinitely, the statement and explanation is valuable.

---

_Closed by @musicinmybrain on 2024-05-23 14:31_

---

_Comment by @zanieb on 2024-05-23 14:35_

We could vendor it within `uv` itself if it makes a big difference externally. We generally find it easier to maintain the fork in a separate repository though.

---

_Label `question` added by @zanieb on 2024-05-23 14:35_

---

_Comment by @musicinmybrain on 2024-05-23 14:49_

> We could vendor it within `uv` itself if it makes a big difference externally. We generally find it easier to maintain the fork in a separate repository though.

In Fedora, we handle `git` crate dependencies by adding an additional source archive, like https://github.com/astral-sh/pubgrub/archive/0e684a874c9fb8f74738cd8875524c80e3d4820b/pubgrub-0e684a874c9fb8f74738cd8875524c80e3d4820b.tar.gz, to the source RPM. Then we extract it and patch the `git` crate dependency into a `path` one.

This is perhaps a little more effort than dealing with an “in-tree” vendored/bundled crate, but not much more, as long as the number of such crates is small. Plus, this method has the advantage that it’s explicit, with no chance of missing vendored/bundled code that we needed to document and justify to satisfy our packaging guidelines. So I can’t speak for other distributions, but I’m perfectly happy with the way these two forked crates are managed now.

---

_Referenced in [astral-sh/uv#5588](../../astral-sh/uv/issues/5588.md) on 2024-07-30 05:05_

---
