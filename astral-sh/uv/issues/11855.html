<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add &quot;current platform&quot; to `required-environments` by default - astral-sh/uv #11855</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Add &quot;current platform&quot; to `required-environments` by default</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/11855">#11855</a>
        opened by <a href="https://github.com/jonaslb">@jonaslb</a>
        on 2025-02-28 14:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jonaslb">@jonaslb</a> on 2025-02-28 14:15</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Related to #9412 / #9711, I was made aware of the new <code>required-environments</code> feature, which looks great. Especially it makes sense for &quot;deployed projects&quot; where you know the intended destination platform, and obviously the lock must be compatible there.</p>
<p>The issue I'm facing is that even if you don't have a single intended prod platform, you still have an implied required environment: The environment you're developing on. This means you'll need to add boilerplate in every pyproject file. And it gets more complicated when the project developers are on multiple platforms or if the project is a library without a single intended destination platform.</p>
<p>So, I would like to propose that <code>uv</code> by default adds the &quot;current platform&quot; to <code>required-environments</code> when locking. Or perhaps, as a step one, only does so if <code>required-environments</code> is unset. I don't know if that would be considered a breaking change, I guess it would, but it would make it nicer to use <code>uv</code> without needing too much copy-pasta boilerplate :)</p>
<h3>Example</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @jonaslb on 2025-02-28 14:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-28 14:21</div>
            <div class="timeline-body"><p>This makes sense intuitively though I'm hesitant to add behavior to the locking process that would vary from machine to machine. Today, <code>uv lock</code> operates in exactly the same way regardless of the user's current platform, and that's a really, really useful property.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-02-28 14:43</div>
            <div class="timeline-body"><p>If we would take the current platform into account, with colleagues working on different platform, them running <code>uv sync</code> could cause a re-lock and a lockfile change, without any requirements change. We found that in most cases, the default support all platforms that users care about, or put the other way round: The cases where projects are making releases with neither a source distribution and nor wheels for common platforms that existed in earlier releases are rare enough that we didn't make that the default.</p>
<p>Since you are having such a case with the ecmwf libraries, we provide <code>required-environments</code> so you can manually specify the platforms you require around those libraries.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonaslb">@jonaslb</a> on 2025-02-28 14:57</div>
            <div class="timeline-body"><p>I think that's a fair prioritization considering the relative rarity of the issue at hand, and yes we can make workarounds and manually specify <code>required-environments</code> for that.</p>
<p>However, I do still think that &quot;the right thing&quot;, hypothetically and regardless how unreachable/large effort it might seem right now, is either something like my proposal here or doing it for all platforms at once, like what was worked on in #9928. This would eliminate those last corner cases like what I had here permanently, without workarounds needed.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:26 UTC
    </footer>
</body>
</html>
