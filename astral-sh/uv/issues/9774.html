<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv pip compile` should have the option to use `uv.lock` as constraints file - astral-sh/uv #9774</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`uv pip compile` should have the option to use `uv.lock` as constraints file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/9774">#9774</a>
        opened by <a href="https://github.com/fnep">@fnep</a>
        on 2024-12-10 14:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/fnep">@fnep</a> on 2024-12-10 14:44</div>
            <div class="timeline-body"><p>We use the <code>pyproject.toml</code> to maintain dependencies of our project (which is not a library, but a product using libraries).</p>
<p>To install the project we use <code>uv sync</code> or <code>uv pip install -r pyproject.toml</code>, but the final product is rolled out on servers where <code>uv</code> is not available, and so we need to compile a set of <code>requirements.txt</code> files for different features / extras when we &quot;bundle&quot; all the files.</p>
<p>For this, we use <code>uv pip compile</code> with <code>pyproject.toml</code> as source file, but for this the <code>uv.lock</code> file is ignored, what makes it hard to maintain  &quot;stable&quot; <code>requirements.txt</code> files.</p>
<p>The current workaround is to use the output of <code>uv export</code> as input for <code>--constraints</code>, but this feels like a hack.</p>
<pre><code class="language-bash">uv export --all-extras | uv pip compile ---constraints - --output-file requirements.txt pyproject.toml
</code></pre>
<p>Instead, please allow giving <code>uv.lock</code> as constraints file to <code>uv pip compile</code> to make this easier to use it as a single source of truth.</p>
<pre><code class="language-bash">uv pip compile --constraints uv.lock --output-file requirements.txt pyproject.toml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-10 14:46</div>
            <div class="timeline-body"><p>Why does using <code>uv export</code> feel like a hack?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fnep">@fnep</a> on 2024-12-10 14:50</div>
            <div class="timeline-body"><p>Its not the <code>uv export</code> itself, but more that we have to pipe it into another uv command as input.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @zanieb on 2024-12-10 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-12-10 14:54</div>
            <div class="timeline-body"><p>Thanks üëç</p>
<p>We need to decide if we want to support this. It has other implications, like probably <code>--requirements</code> support too for consistency. I'm a little hesitant since <code>export</code> exists for this purpose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`uv pip compile` should have the option to use `uv.lock` as constraint file" to "`uv pip compile` should have the option to use `uv.lock` as constraints file" by @fnep on 2024-12-10 15:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fnep">@fnep</a> on 2024-12-10 15:10</div>
            <div class="timeline-body"><p>Thank you for considering it.</p>
<p>I know feeding the information generated using a tool into the same tool again is not uncommon in Unix tools. But it is not very intuitive to use and understand.</p>
<p>I'm not entirely sure how much sense it makes to give a <code>uv.lock</code> file to <code>--requirements</code>. What the practical use case would be. The file is in its meaning very close to the constraints option, but not to the requirements option. For pip they share the same format, so maybe there is one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fnep">@fnep</a> on 2024-12-10 15:51</div>
            <div class="timeline-body"><p>Thinking about your comment, i assume i missed one very important detail.</p>
<p>We do not need to run <code>uv pip compile</code> at all. The <code>uv export</code> with some options, will provide almost the same. There is no need for compile.</p>
<p>I think we can close this issue. Sorry for wasting your time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @fnep on 2024-12-10 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/patrick-kidger">@patrick-kidger</a> on 2025-05-02 11:41</div>
            <div class="timeline-body"><p>I'd like to reopen this issue: I have a use for <code>uv pip compile foo bar --constraints uv.lock</code>, namely https://github.com/astral-sh/uv/issues/13245#issuecomment-2846861803 . This is useful as a way to ad-hoc include extra dependencies (e.g. a custom debugger for tackling a particular problem) without affecting the rest of the packages already available in an environment.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 03:44:12 UTC
    </footer>
</body>
</html>
