```yaml
number: 16378
title: Slower startup time compared to using pip in Docker
type: issue
state: closed
author: dyens
labels:
  - performance
assignees: []
created_at: 2025-10-20T23:07:52Z
updated_at: 2025-10-22T11:29:20Z
url: https://github.com/astral-sh/uv/issues/16378
synced_at: 2026-01-12T16:02:30Z
```

# Slower startup time compared to using pip in Docker

---

_@dyens_

### Summary

I created project with only one dependency: fastapi==0.119.0

I have Dockerfile using UV:

```Dockerfile
FROM python:3.13.6

COPY --from=docker.io/astral/uv:latest /uv /uvx /bin/

ARG APP_HOME="/app"
WORKDIR ${APP_HOME}

COPY uv.lock pyproject.toml /app/

RUN uv sync --frozen --no-cache --no-dev --no-install-project --no-editable --link-mode=copy --compile-bytecode
ENV PATH="${APP_HOME}/.venv/bin:$PATH"
```

And Dockerfile using pip

```Dockerfile
FROM python:3.13.6
RUN pip install "fastapi==0.119.0"
```

```bash
time docker run --rm -it --cpus="0.2" pip-variant:local python -c "import fastapi" 
0.01s user 0.01s system 0% cpu 3.399 total

time docker run --rm -it --cpus="0.2" uv-variant:local python -c "import fastapi"
0.02s user 0.02s system 0% cpu 6.073 total
```

I assume there is some problem with the `bytecode` files. Maybe some `.pyc` files are missing or need to be recompiled.

Python tries to compile bytecode and create `.pyc` files, but on a stripped-down CPU this process is slow. If the filesystem is read-only and the user is not root, the slowdown will be even more significant.

### Platform

Linux 6.16.12-200.fc42.x86_64 x86_64 GNU/Linux

### Version

uv 0.8.11

### Python version

python:3.13.6

---

_Label `bug` added by @dyens on 2025-10-20 23:07_

---

_Comment by @zanieb on 2025-10-21 00:02_

Ah interesting, this appears to be entirely due to bytecode compilation of the Python standard library, not the installed packages.

cc @konstin 

---

_Label `bug` removed by @zanieb on 2025-10-21 00:02_

---

_Label `performance` added by @zanieb on 2025-10-21 00:02_

---

_Comment by @konstin on 2025-10-21 08:54_

That's an interesting performance problem!

The reason why the pip version starts faster is that running pip itself import the standard library. The difference disappears when running pip without bytecode compilation:

```
FROM python:3.13.6
RUN python -B -m pip install "fastapi==0.119.0"
```

Similarly, the uv version becomes fast when using:

```
RUN python -m compileall /usr/local/lib/python3.13
```

We could try to compile the standard library with `--compile-bytecode`, but `/usr/local/lib/python3.13` is owned by root and usually we're not root, so we'd only be triggering a lot of permission errors, or have a surprisingly faster startup with uv when running as root (which we don't want to encourage). For example, this version is as slow as uv:

```
FROM python:3.13.6

RUN useradd -m -u 1000 appuser

USER appuser
WORKDIR /home/appuser

RUN python -m venv /home/appuser/venv

ENV PATH="/home/appuser/venv/bin:$PATH"

RUN pip install "fastapi==0.119.0"
```

My Ubuntu system Python does have `/usr/lib/python3.12/__pycache__/` with std compiled, while the official `python:3.13` image has an intentionally empty `/usr/local/lib/python3.13/__pycache__/` to save image size: https://github.com/docker-library/python/issues/615#issuecomment-842692129.

A different case are PBS Python builds, we know that those are managed by uv, and can bytecode compile the standard library. This does not help with `FROM python:3.13.6`, but it also doesn't clash with that image's design.

---

_Comment by @edmorley on 2025-10-21 11:14_

One of the reasons the `.pyc` files generated by CPython's default `make install` target end up being ~30MB is that it by default generates them for all three optimisation levels (standard, -O and -OO), when 99% of users will only use the standard mode. As a compromise for Heroku's Python archives (which are downloaded from S3 during the build) we do ship the `.pyc` files to aid app boot times, but only for the standard optimisation level to reduce the size impact of both the Python archive download, and the resultant output app image transfer times. 

https://github.com/heroku/heroku-buildpack-python/blob/088bce0d919e018ae6bf44767d13aecb0f70336a/builds/build_python_runtime.sh#L192-L215

---

_Comment by @konstin on 2025-10-21 11:34_

I've ran some numbers when not restricting the CPUs:
```
$ hyperfine 'docker run --rm pip-variant:local python -c "import fastapi"' 'docker run --rm uv-variant:local python -c "import fastapi"'
Benchmark 1: docker run --rm pip-variant:local python -c "import fastapi"
  Time (mean ± σ):     612.8 ms ±  13.9 ms    [User: 6.6 ms, System: 5.9 ms]
  Range (min … max):   590.2 ms … 637.9 ms    10 runs
 
Benchmark 2: docker run --rm uv-variant:local python -c "import fastapi"
  Time (mean ± σ):     900.6 ms ±  14.0 ms    [User: 6.5 ms, System: 5.4 ms]
  Range (min … max):   883.1 ms … 918.8 ms    10 runs
 
Summary
  docker run --rm pip-variant:local python -c "import fastapi" ran
    1.47 ± 0.04 times faster than docker run --rm uv-variant:local python -c "import fastapi"
```

---

_Comment by @konstin on 2025-10-21 11:36_

We can also show that invoking `pip` only compiles a subset of std, by comparing it with uv with an extra `RUN python -m compileall /usr/local/lib/python3.13`:
```
$ hyperfine 'docker run --rm uv2-variant:local python -c "import fastapi"' 'docker run --rm pip-variant:local python -c "import fastapi"' --warmup 1
Benchmark 1: docker run --rm uv2-variant:local python -c "import fastapi"
  Time (mean ± σ):     513.0 ms ±  15.2 ms    [User: 6.4 ms, System: 6.3 ms]
  Range (min … max):   485.7 ms … 543.6 ms    10 runs
 
Benchmark 2: docker run --rm pip-variant:local python -c "import fastapi"
  Time (mean ± σ):     613.5 ms ±  29.1 ms    [User: 6.2 ms, System: 5.8 ms]
  Range (min … max):   591.0 ms … 686.3 ms    10 runs
 
Summary
  docker run --rm uv2-variant:local python -c "import fastapi" ran
    1.20 ± 0.07 times faster than docker run --rm pip-variant:local python -c "import fastapi"
```

---

_Comment by @dyens on 2025-10-21 19:48_

Thank you! I think the mystery is solved. ❤️ 

---

_Closed by @dyens on 2025-10-22 07:39_

---

_Comment by @konstin on 2025-10-22 11:29_

Following up in: https://github.com/astral-sh/uv/issues/16408

---
