<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`uv run --with` fails to include virtual environment in `sys.path` for Homebrew-installed Python - astral-sh/uv #7152</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>uv run --with</code> fails to include virtual environment in <code>sys.path</code> for Homebrew-installed Python</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/7152">#7152</a>
        opened by <a href="https://github.com/dhduvall">@dhduvall</a>
        on 2024-09-07 02:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dhduvall">@dhduvall</a> on 2024-09-07 02:05</div>
            <div class="timeline-body"><p>I'm trying to run <code>uv run --with pylint -- pylint ...</code>, and <code>pylint</code> is complaining about not being able to resolve <code>import</code> statements in my source. Indeed, <code>sys.path</code> in that context doesn't have the virtual environment's packages.</p>
<pre><code class="language-toml">[project]
name = &quot;test&quot;
version = &quot;1.2.3&quot;
requires-python = &quot;==3.11.*&quot;
dependencies = [
  &quot;regex&quot;, # or whatever
]
</code></pre>
<pre><code class="language-console">$ uv run --with pylint -- python -c 'import sys; print(&quot;\n&quot;.join(sys.path))'
Using Python 3.11.9 interpreter at: /opt/homebrew/opt/python@3.11/bin/python3.11
Removed virtual environment at: .venv
Creating virtualenv at: .venv
Installed 1 package in 4ms

/opt/homebrew/Cellar/python@3.11/3.11.9_1/Frameworks/Python.framework/Versions/3.11/lib/python311.zip
/opt/homebrew/Cellar/python@3.11/3.11.9_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11
/opt/homebrew/Cellar/python@3.11/3.11.9_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/lib-dynload
/Users/duvall/Library/Caches/uv/archive-v0/rpeJdmPWBfImmHdlLv7hN/lib/python3.11/site-packages
$ uv run --with pylint -- python -c &quot;import regex&quot;
Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
ModuleNotFoundError: No module named 'regex'
</code></pre>
<p>Interestingly, this works fine with the Python 3.9 installed on the system, but not on any version installed by Homebrew (3.9 included):</p>
<pre><code class="language-console">‚ùØ uv run --with pylint python -c 'import sys; print(&quot;\n&quot;.join(sys.path))'
Using Python 3.9.6 interpreter at: /Library/Developer/CommandLineTools/usr/bin/python3
Removed virtual environment at: .venv
Creating virtualenv at: .venv
Installed 1 package in 2ms

/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python39.zip
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/lib-dynload
/Users/duvall/Library/Caches/uv/archive-v0/AiY6Z--H2Ja4w3r7Vaquv/lib/python3.9/site-packages
/Users/duvall/test/.venv/lib/python3.9/site-packages
</code></pre>
<pre><code class="language-console">$ uv --version
uv 0.4.6 (Homebrew 2024-09-05)
</code></pre>
<p>though I was seeing this with <code>0.4.4</code> as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-09-07 09:10</div>
            <div class="timeline-body"><p>I think this has something to do with sitecustomize.py - homebrew pythons are for some reason installing such a file? And it interferes with how uv is creating the overlay effect (ephemeral virtualenv layered on top of .venv).</p>
<p>breadcrumbs</p>
<p>https://github.com/Homebrew/homebrew-core/pull/133490</p>
<p>https://docs.brew.sh/Homebrew-and-Python</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-09 13:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:30:42 UTC
    </footer>
</body>
</html>
