<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better error message for invalid `[project]` table - astral-sh/uv #6419</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better error message for invalid <code>[project]</code> table</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6419">#6419</a>
        opened by <a href="https://github.com/soof-golan">@soof-golan</a>
        on 2024-08-22 09:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/soof-golan">@soof-golan</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Hey Astral team!</p>
<p>I found an interesting behavior around installing a git based project that is managed by poetry (as opposed to any other build system).
Since the name of the project is defined under the <code>tool.poetry</code> section uv fails to pick it up when reading the pyproject.toml file.
I'm not sure if this is considered Poetry's fault, but pip definitely succeeds in installing this exact package. I have not checked whether this issue can be also replicated locally with a relative path package.</p>
<p>Many thanks üôè</p>
<h1>What Happens</h1>
<p>uv fails to install a (seemingly) valid python dependency. pip successfully installs this project.</p>
<h1>Expected Behavior</h1>
<p>uv should install the package</p>
<h1>Reproduction</h1>
<pre><code class="language-bash">cd $(mktemp -d)
uv venv
uv pip install -v git+https://github.com/elevenlabs/elevenlabs-python.git@6db2fdd7458ce5c7f1bbdc2c3936784f995acd44
</code></pre>
<p>outputs:</p>
<pre><code>Using Python 3.12.5
Creating virtualenv at: .venv
Activate with: source .venv/bin/activate
DEBUG uv 0.3.1
DEBUG Searching for Python interpreter in system path
DEBUG Found `cpython-3.12.5-macos-aarch64-none` at `/private/var/folders/f0/m68x433x79n628trx7zp0x3h0000gn/T/tmp.BZTiKhI3Af/.venv/bin/python3` (virtual environment)
DEBUG Using Python 3.12.5 environment at .venv/bin/python3
DEBUG Acquired lock for `.venv`
DEBUG At least one requirement is not satisfied: git+https://github.com/elevenlabs/elevenlabs-python.git@6db2fdd7458ce5c7f1bbdc2c3936784f995acd44
DEBUG Using request timeout of 30s
DEBUG Fetching source distribution from Git: https://github.com/elevenlabs/elevenlabs-python.git
DEBUG Acquired lock for `https://github.com/elevenlabs/elevenlabs-python`
DEBUG Using existing git source `Url { scheme: &quot;https&quot;, cannot_be_a_base: false, username: &quot;&quot;, password: None, host: Some(Domain(&quot;github.com&quot;)), port: None, path: &quot;/elevenlabs/elevenlabs-python.git&quot;, query: None, fragment: None }`
DEBUG Acquired lock for `/Users/soof/Library/Caches/uv/built-wheels-v3/git/8be1b43a58e07c63/6db2fdd7458ce5c7`
DEBUG No static `PKG-INFO` available for: git+https://github.com/elevenlabs/elevenlabs-python.git@6db2fdd7458ce5c7f1bbdc2c3936784f995acd44 (MissingPkgInfo)
error: Failed to extract static metadata from `pyproject.toml`
  Caused by: TOML parse error at line 31, column 2
   |
31 | [project.urls]
   |  ^^^^^^^
missing field `name`
</code></pre>
<img width="1291" alt="image" src="https://github.com/user-attachments/assets/69d3fef1-0ee9-432b-a19d-f7b805ce3661">

<h3><code>uv --version</code></h3>
<pre><code>uv 0.3.1 (be17d132a 2024-08-21)
</code></pre>
<h3>Platform</h3>
<p>macOS Sonoma</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @konstin on 2024-08-22 09:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-08-22 09:59</div>
            <div class="timeline-body"><p>We should fall back to building instead of trying to the read the metadata here, as we're doing in other cases, this is a bug.</p>
<p>Is there a reason you're using <code>[project.urls]</code> here instead of <code>[tool.poetry.urls]</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @konstin on 2024-08-22 09:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> removed by @konstin on 2024-08-22 09:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/soof-golan">@soof-golan</a> on 2024-08-22 10:06</div>
            <div class="timeline-body"><p>@konstin
Thanks for the fast response :)
This is not a project I own / maintain, but an external package that is specified as a git dependency in another project.</p>
<p>(This is why I wrote <em>seemingly valid</em>)</p>
<blockquote>
<p>uv fails to install a (seemingly) valid python dependency</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-22 12:31</div>
            <div class="timeline-body"><p>@konstin -- I'm somewhat unsure... It <em>is</em> spec-incompliant. If we accept it here, we risk false negatives for other projects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @konstin on 2024-08-22 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-08-22 12:34</div>
            <div class="timeline-body"><p>Oh right, because it's not dynamic like in the other cases.</p>
<p>We should change the error message with a note about the <code>[project]</code> table spec, maybe linking to https://packaging.python.org/en/latest/guides/writing-pyproject-toml/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @konstin on 2024-08-26 08:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @konstin by @konstin on 2024-08-26 13:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-08-26 13:48</div>
            <div class="timeline-body"><p>The toml crate doesn't give us this information unfortunately, so we can add better context to the error message: https://github.com/toml-rs/toml/issues/778</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "uv fails to install git pacakges managed by poetry" to "Better error message for invalid `[project]` table" by @konstin on 2024-08-26 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">upstream</span> added by @konstin on 2024-08-26 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @konstin on 2024-08-26 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-14 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-09-14 20:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:26:21 UTC
    </footer>
</body>
</html>
