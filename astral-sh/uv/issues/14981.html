<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv seems to incorrectly match local versions on triple-equals - astral-sh/uv #14981</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>uv seems to incorrectly match local versions on triple-equals</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/14981">#14981</a>
        opened by <a href="https://github.com/geofft">@geofft</a>
        on 2025-07-30 19:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/geofft">@geofft</a> on 2025-07-30 19:10</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>From https://packaging.python.org/en/latest/specifications/version-specifiers/#arbitrary-equality :</p>
<blockquote>
<p>Arbitrary equality comparisons are simple string equality operations which do not take into account any of the semantic information such as zero padding or local versions. [...]
This operator may also be used to explicitly require an unpatched version of a project such as <code>===1.0</code> which would not match for a version <code>1.0+downstream1</code>.</p>
</blockquote>
<p>However, the following test case produces a package and environment with a dependency on <code>dependency===1.0</code> that is locked to <code>1.0+downstream1</code>:</p>
<pre><code>#!/bin/bash

set -eux

uv init --lib dependency
cd dependency
uv version 1.0
uv build
uv version 1.0+downstream1
uv build
cd ..
uv init consumer
cd consumer
uv add ../dependency/dist/dependency-1.0-py3-none-any.whl
uv add ../dependency/dist/dependency-1.0+downstream1-py3-none-any.whl
uv add dependency===1.0
cat pyproject.toml
cat uv.lock
</code></pre>
<p>I <em>think</em> the code appears to handle the <code>ExactEqual</code> case right, so I'm not totally sure what's wrong. Linking #8797 which implemented local version handling.</p>
<h3>Platform</h3>
<p>Ubuntu 24.04, x86_64</p>
<h3>Version</h3>
<p>uv 0.8.4</p>
<h3>Python version</h3>
<p>3.13.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @geofft on 2025-07-30 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-30 19:50</div>
            <div class="timeline-body"><p>As a note, it seems dubious that this is worth prioritizing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-07-30 20:01</div>
            <div class="timeline-body"><p>uv is incorrect here but only on a &quot;may&quot;, and more importantly:</p>
<blockquote>
<p>The primary use case for arbitrary equality is to allow for specifying a version which cannot otherwise be represented by this specification. This operator is special and acts as an escape hatch to allow someone using a tool which implements this specification to still install a legacy version which is otherwise incompatible with this specification.</p>
</blockquote>
<p>This is increasingly less relevant, as almost all tools now only accept valid version numbers.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
