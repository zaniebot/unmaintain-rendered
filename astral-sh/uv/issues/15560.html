<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lock files are inconsistent on Windows when using private repos explicitly - astral-sh/uv #15560</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Lock files are inconsistent on Windows when using private repos explicitly</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/15560">#15560</a>
        opened by <a href="https://github.com/sakost">@sakost</a>
        on 2025-08-27 18:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sakost">@sakost</a> on 2025-08-27 18:43</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I'm trying to use <code>uv</code> with a setting explicit private repo:</p>
<pre><code># pyproject.toml
# ...
[tool.uv.sources]
internal-package = { index = &quot;private-repo&quot; }

[[tool.uv.index]]
name = &quot;private-repo&quot;
url = &quot;https://gitlab.example.com/api/v4/projects/xxxx/packages/pypi/simple/&quot;
explicit = true
</code></pre>
<p>When I'm locking via <code>uv lock</code> and then trying to use this lock file within Dockerfile like this:</p>
<pre><code class="language-Dockerfile"># Install the project's dependencies using the lockfile and settings
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --locked --no-install-project --no-dev

# Then, add the rest of the project source code and install it
# Installing separately from its dependencies allows optimal layer caching
COPY . /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --locked --no-dev
</code></pre>
<blockquote>
<p>this code was taken from an <a href="https://github.com/astral-sh/uv-docker-example">official</a> example of uv+docker.</p>
</blockquote>
<p>And while building this image with docker compose <code>docker compose --env-file .env up --watch</code> it throws an error:</p>
<pre><code class="language-bash">0.234 Using CPython 3.12.9 interpreter at: /usr/local/bin/python3.12
0.234 Creating virtual environment at: .venv
1.658 Resolved 142 packages in 1.41s
1.662 The lockfile at `uv.lock` needs to be updated, but `--locked` was provided. To update the lockfile, run `uv lock`.
------
failed to solve: process &quot;/bin/sh -c uv sync --locked --no-dev&quot; did not complete successfully: exit code: 1
</code></pre>
<p>You can check a full reproducible example of such a problem in my repo: https://github.com/sakost/uv-docker-example-win (forked from official)</p>
<p>The diff between two <code>uv.lock</code> (one from Docker, one from system) is just an extra slash at the end of the public pypi repo: <code>https://pypi.org/simple</code> vs <code>https://pypi.org/simple/</code>. The <code>https://pypi.org/simple</code> is from the system.</p>
<p>This issue can be related to this problem, but I'm not sure: https://github.com/astral-sh/uv/issues/15043</p>
<h3>Platform</h3>
<p>Windows 11 x86_64</p>
<h3>Version</h3>
<p>uv 0.8.13 (ede75fe62 2025-08-21)</p>
<h3>Python version</h3>
<p>Python 3.12.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @sakost on 2025-08-27 18:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sakost">@sakost</a> on 2025-08-27 18:45</div>
            <div class="timeline-body"><p>I'll try to fix it tomorrow, but I'm not sure that I'm capable of it, so any help with this would be awesome</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sakost">@sakost</a> on 2025-08-28 19:01</div>
            <div class="timeline-body"><p>Didn't find anything :(
It seems that it is a difficult bug to fix</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-08-29 00:01</div>
            <div class="timeline-body"><p>If you see:</p>
<blockquote>
<p>https://pypi.org/simple vs https://pypi.org/simple/</p>
</blockquote>
<p>That typically means that you're setting <code>UV_INDEX=https://pypi.org/simple/</code> or something like that. You must be adding that configuration somewhere, since uv omits the trailing slash by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sakost">@sakost</a> on 2025-10-23 06:40</div>
            <div class="timeline-body"><p>You're right!
Thank you so much</p>
<p>It was not obvious to me
Maybe we should add some notes about it in the doc?</p>
<p>Closing the issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sakost on 2025-10-23 06:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
