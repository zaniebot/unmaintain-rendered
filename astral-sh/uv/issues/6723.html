<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uv can't sync with rye --virutal / uv can't sync with data-style layouts - astral-sh/uv #6723</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>uv can't sync with rye --virutal / uv can't sync with data-style layouts</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/6723">#6723</a>
        opened by <a href="https://github.com/dream-dasher">@dream-dasher</a>
        on 2024-08-27 21:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dream-dasher">@dream-dasher</a> on 2024-08-27 21:28</div>
            <div class="timeline-body"><p><code>uv sync</code> does not seem to support a layout like the following:</p>
<ul>
<li>root<ul>
<li>data<ul>
<li>input</li>
<li>intermediate</li>
<li>output</li>
</ul>
</li>
<li>notebooks<ul>
<li>nb_1.py</li>
<li>nb_2.py</li>
<li>nb_3.py</li>
</ul>
</li>
<li>pyproject.toml</li>
</ul>
</li>
</ul>
<p>e.g., image:
<img src="https://github.com/user-attachments/assets/3a7f3184-eb60-4522-b948-0b85d100bd7c" alt="uv-nosync-layout" /></p>
<p>I made the above repo with <code>rye init --virtual</code>
However, uv has been unable to work with it.<br />
It seems to have decided that both <strong>data</strong> and <strong>notebooks_python</strong> are packages.  (Note: there are no python files in the data directory at any depth)</p>
<p><code>‚ùØ uv sync</code></p>
<blockquote>
<p>Resolved 40 packages in 12ms
error: Failed to prepare distributions
Caused by: Failed to fetch wheel: redacted @ file:///Users/redacted/redacted/redacted/redacted
Caused by: Build backend failed to determine extra requires with <code>build_editable()</code> with exit status: 1
--- stdout:</p>
<p>--- stderr:
error: Multiple top-level packages discovered in a flat-layout: ['data', 'notebooks_python'].</p>
<p>To avoid accidental inclusion of unwanted files or directories,
setuptools will not proceed with this build.</p>
<p>If you are trying to create a single distribution with multiple packages
on purpose, you should not rely on automatic discovery.
Instead, consider the following options:</p>
<ol>
<li>set up custom discovery (<code>find</code> directive with <code>include</code> or <code>exclude</code>)</li>
<li>use a <code>src-layout</code></li>
<li>explicitly set <code>py_modules</code> or <code>packages</code> with a list of names</li>
</ol>
<h2>To find more information, look for &quot;package discovery&quot; on setuptools docs.</h2>
</blockquote>
<p>I use src layouts for apps and scripts, but they add a considerable level of indirection and complexity in data oriented notebooks.  (Not least because files run with different relative paths to the data depending on if you run them as a notebook or a script.  And absolute paths obviously don't work across collaborators.)</p>
<p>Am I missing a solution?
If not, I'd appreciate support for this from uv.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-27 21:30</div>
            <div class="timeline-body"><p>This is solved on main by #6585 but not yet released.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-28 01:39</div>
            <div class="timeline-body"><p>Closed by https://github.com/astral-sh/uv/pull/6585 which will be released tomorrow morning :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-28 01:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-08-28 01:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:34 UTC
    </footer>
</body>
</html>
