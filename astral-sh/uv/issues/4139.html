<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packages without source dists break universal resolver - astral-sh/uv #4139</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Packages without source dists break universal resolver</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/4139">#4139</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2024-06-07 18:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>Consider a project with one of the following requirements, where the host linux and <code>tensorflow-macos</code> has only mac os wheels and no source dist, i.e. it is only installable on mac os.</p>
<ol>
<li><code>tensorflow-macos==2.16.1</code></li>
<li><code>tensorflow-macos==2.16.1; platform_system == &quot;Darwin&quot;</code></li>
<li><code>tensorflow-macos==2.16.1; platform_system == &quot;Linux&quot;</code></li>
</ol>
<p>Option 1 currently fails:</p>
<pre><code>  x No solution found when resolving dependencies:
  `-&gt; Because the requested Python version (&gt;=3.8) does not satisfy Python&gt;=3.9 and tensorflow-macos==2.16.1 depends on Python&gt;=3.9, we can conclude that
      tensorflow-macos==2.16.1 cannot be used.
      And because foo==1.0.0 depends on tensorflow-macos==2.16.1, we can conclude that foo==1.0.0 cannot be used.
      And because only foo==1.0.0 is available and foo depends on foo, we can conclude that the requirements are unsatisfiable.

      hint: The `Requires-Python` requirement (&gt;=3.8) defined in your `pyproject.toml` includes Python versions that are not supported by your dependencies (e.g.,        
      tensorflow-macos==2.16.1 only supports &gt;=3.9). Consider using a more restrictive `Requires-Python` requirement (like &gt;=3.9).
</code></pre>
<p>So does option 2 and 3:</p>
<pre><code>  x No solution found when resolving dependencies:
  `-&gt; Because the requested Python version (&gt;=3.8) does not satisfy Python&gt;=3.9 and tensorflow-macos{platform_system == 'Darwin'}==2.16.1 depends on Python&gt;=3.9, we can
      conclude that tensorflow-macos{platform_system == 'Darwin'}==2.16.1 cannot be used.
      And because foo==1.0.0 depends on tensorflow-macos{platform_system == 'Darwin'}==2.16.1, we can conclude that foo==1.0.0 cannot be used.
      And because only foo==1.0.0 is available and foo depends on foo, we can conclude that the requirements are unsatisfiable.

      hint: The `Requires-Python` requirement (&gt;=3.8) defined in your `pyproject.toml` includes Python versions that are not supported by your dependencies (e.g.,        
      tensorflow-macos{platform_system == 'Darwin'}==2.16.1 only supports &gt;=3.9). Consider using a more restrictive `Requires-Python` requirement (like &gt;=3.9).
</code></pre>
<p>Option 1 failing on linux is fine, unless we require that a non-installing target should be able to lock. Option 2 failing is a problem: This is a mac-only dep, it should not break linux or universal wheels! We know that there a wheels that work on macos, so the macos side of things should resolve. Option 3 failing could be considered a feature, because this can never install (there is no platform that is both a linux system and supports mac tags).</p>
<p>One option at solving this would be dropping the solve time tag check and doing only an install time check. This would remove backpropagation from wheels with unsupported to wheels with supported tags, otoh tags are usually not a version-to-version difference in that different version support different tags but a per-package property where certain packages are platform specific, such as tensorflow-macos is mac os only and pywin32 is windows only (and doesn't build on linux).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">resolver</span> added by @konstin on 2024-06-07 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @konstin on 2024-06-07 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-07 18:06</div>
            <div class="timeline-body"><p>I think the only option really is to ignore tags are solve time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-06-07 18:13</div>
            <div class="timeline-body"><p>I'm pretty sure that's what poetry does too</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-06-09 17:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-09 19:14</div>
            <div class="timeline-body"><p>I can give it a shot.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-09 19:15</div>
            <div class="timeline-body"><p>I think there's a possible improvement here, like... if we know we're in a branch that only supports macOS, ensure that there's <em>at least one</em> macOS-compliant wheel. But I don't know how to formalize that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-06-10 12:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:13 UTC
    </footer>
</body>
</html>
