<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`Access is denied` error on windows when `uv sync` - astral-sh/uv #15968</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`Access is denied` error on windows when `uv sync`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15968">#15968</a>
        opened by <a href="https://github.com/petesmc">@petesmc</a>
        on 2025-09-21 09:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/petesmc">@petesmc</a> on 2025-09-21 09:15</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi,</p>
<p>Within a corporate environment, when running <code>uv sync</code> or <code>uv add</code>, I often get an <code>Access is denied. (OS error 5)</code> when it is trying to delete a directory. E.g. &quot;Failed to remove directory C:\mylib.venv\Lib\site-packages\polars-123.<strong>data</strong>&quot;. It is usually the <strong>data</strong> or <strong>__pycache__</strong></p>
<p>I'm unable to replicate this outside of a corporate environment, and cannot provide logs due to company policy. To resolve it I need to run <code>uv sync</code> / <code>uv add</code> multiple times, depending on the number of dependencies/transistive dependencies, can be 50+ times.</p>
<p>The trace shows the error coming from <code>remove_dir_all</code></p>
<p>I don't see this problem with other package managers like pnpm / cargo, etc.</p>
<p>Potential solution could be using this package which helps with lock issues on Windows: https://crates.io/crates/remove_dir_all</p>
<h3>Platform</h3>
<p>Windows 11 x86_64</p>
<h3>Version</h3>
<p>0.8.19</p>
<h3>Python version</h3>
<p>3.13.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @petesmc on 2025-09-21 09:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by @konstin on 2025-09-23 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @konstin on 2025-09-23 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/retropc">@retropc</a> on 2025-10-31 16:18</div>
            <div class="timeline-body"><p>I've seen this too</p>
<p>uv add ruff -&gt;</p>
<pre><code>error: Failed to install ruff-0.14.1-py-none-win_amd64.wsl (ruff==0.14.1)
  Caused by: failed to remove directory `C:\.......\.venv\Lib\site-packages\ruff-0.14.1.data`: The filename, directory name, or volume label syntax is incorrect. (os error 123)
</code></pre>
<p>most likely defender is holding the directory open, need to wait and retry a few times</p>
<p>terrible but that's Windows for you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7382.html">astral-sh/uv#7382</a> on 2025-11-10 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16747.html">astral-sh/uv#16747</a> on 2025-11-15 17:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Ndnes">@Ndnes</a> on 2025-11-21 14:08</div>
            <div class="timeline-body"><p>Not sure if this is the same exact issue, but I am also having problems with Windows Defender. I can not run uv at all though, and I had the same issue with pip as well. This is definitely something local IT / Windows should deal with, but I'll provide the log from Event Viewer anyways.</p>
<p>The event was triggered when running the command &quot;uv --version&quot; in command prompt.</p>
<pre><code>&lt;Event xmlns=&quot;http://schemas.microsoft.com/win/2004/08/events/event&quot;&gt;
&lt;System&gt;
&lt;Provider Name=&quot;Microsoft-Windows-Windows Defender&quot; Guid=&quot;{11cd958a-c507-4ef3-b3f2-5fd9dfbd2c78}&quot; /&gt; 
&lt;EventID&gt;1121&lt;/EventID&gt; 
&lt;Version&gt;0&lt;/Version&gt; 
&lt;Level&gt;3&lt;/Level&gt; 
&lt;Task&gt;0&lt;/Task&gt; 
&lt;Opcode&gt;0&lt;/Opcode&gt; 
&lt;Keywords&gt;0x8000000000000000&lt;/Keywords&gt; 
&lt;TimeCreated SystemTime=&quot;2025-11-21T12:54:16.9075113Z&quot; /&gt; 
&lt;EventRecordID&gt;1688&lt;/EventRecordID&gt; 
&lt;Correlation ActivityID=&quot;{4c4fd6cc-21e3-43e3-9c9e-cfc6f13f4fdd}&quot; /&gt; 
&lt;Execution ProcessID=&quot;19856&quot; ThreadID=&quot;24948&quot; /&gt; 
&lt;Channel&gt;Microsoft-Windows-Windows Defender/Operational&lt;/Channel&gt; 
&lt;Computer&gt;***&lt;/Computer&gt; 
&lt;Security UserID=&quot;S-1-5-18&quot; /&gt; 
&lt;/System&gt;
&lt;EventData&gt;
&lt;Data Name=&quot;Product Name&quot;&gt;Microsoft Defender Antivirus&lt;/Data&gt; 
&lt;Data Name=&quot;Product Version&quot;&gt;4.18.25100.9008&lt;/Data&gt; 
&lt;Data Name=&quot;Unused&quot; /&gt; 
&lt;Data Name=&quot;ID&quot;&gt;01443614-CD74-433A-B99E-2ECDC07BFC25&lt;/Data&gt; 
&lt;Data Name=&quot;Detection Time&quot;&gt;2025-11-21T12:54:16.906Z&lt;/Data&gt; 
&lt;Data Name=&quot;User&quot;&gt;***&lt;/Data&gt; 
&lt;Data Name=&quot;Path&quot;&gt;C:\Users\***\.local\bin\uv.exe&lt;/Data&gt; 
&lt;Data Name=&quot;Process Name&quot;&gt;C:\Windows\System32\cmd.exe&lt;/Data&gt; 
&lt;Data Name=&quot;Security intelligence Version&quot;&gt;1.441.381.0&lt;/Data&gt; 
&lt;Data Name=&quot;Engine Version&quot;&gt;1.1.25100.9002&lt;/Data&gt; 
&lt;Data Name=&quot;RuleType&quot;&gt;ENT\ConsR&lt;/Data&gt; 
&lt;Data Name=&quot;Target Commandline&quot; /&gt; 
&lt;Data Name=&quot;Parent Commandline&quot;&gt;&quot;C:\WINDOWS\system32\cmd.exe&quot;&lt;/Data&gt; 
&lt;Data Name=&quot;Involved File&quot; /&gt; 
&lt;Data Name=&quot;Inhertiance Flags&quot;&gt;0x00000000&lt;/Data&gt; 
&lt;/EventData&gt;
&lt;/Event&gt;
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:29 UTC
    </footer>
</body>
</html>
