```yaml
number: 2003
title: "Requirement with `--only-binary apache-beam` fails to resolve even though solution exists"
type: issue
state: closed
author: notatallshaw
labels:
  - bug
assignees: []
created_at: 2024-02-27T05:09:57Z
updated_at: 2024-03-08T20:55:10Z
url: https://github.com/astral-sh/uv/issues/2003
synced_at: 2026-01-10T01:57:04Z
```

# Requirement with `--only-binary apache-beam` fails to resolve even though solution exists

---

_Issue opened by @notatallshaw on 2024-02-27 05:09_

Python 3.11.6, Linux x64, uv 0.1.11

```
$ echo "apache-airflow[all]" | uv pip compile - --only-binary apache-beam
error: Failed to download and build: apache-beam==2.2.0
  Caused by: Building source distributions is disabled
```

But a solution exists because if I put a lower bound on `apache-beam` so that my environment can always get a wheel it can resolve:

```
$ echo -e "apache-airflow[all]\napache-beam>=2.47" | uv pip compile -
Resolved 546 packages in 6.30s
...
apache-beam==2.54.0
    # via apache-airflow-providers-apache-beam
...
```


---

_Referenced in [astral-sh/uv#1560](../../astral-sh/uv/issues/1560.md) on 2024-02-27 05:10_

---

_Comment by @charliermarsh on 2024-02-27 05:13_

IIRC, `--only-binary` doesn't affect the resolution -- it just disallows building from source. Like, we don't _skip_ versions that lack binaries, we just error if you try to build one. I don't know if this was intentional, @zanieb would know when they're back from vacation.

---

_Comment by @notatallshaw on 2024-02-27 05:19_

Interesting, pip definitely uses this to determine what is resolved: https://pip.pypa.io/en/stable/development/architecture/upgrade-options/#controlling-what-gets-considered

I wouldn't of normally tried this but this comment indicated it would work like that with uv but I can't reproduce resolving it: https://github.com/astral-sh/uv/issues/1560#issuecomment-1949626187

---

_Comment by @zanieb on 2024-02-27 06:50_

Yeah this sounds unintentional. I think `--no-binary` is taken into consideration during resolutions i.e. we mark distributions with only wheels as unusable but I don't think we don't do the same for `--only-binary` right now? I could take a look at this as part of (or after) #1298 

---

_Label `bug` added by @charliermarsh on 2024-02-27 15:31_

---

_Comment by @charliermarsh on 2024-02-27 15:31_

Cool, marking as a bug.

---

_Assigned to @charliermarsh by @charliermarsh on 2024-02-28 21:47_

---

_Comment by @charliermarsh on 2024-02-28 21:47_

Looking into this, I think I see the path forward.

---

_Referenced in [astral-sh/uv#2066](../../astral-sh/uv/pulls/2066.md) on 2024-02-29 00:32_

---

_Assigned to @zanieb by @charliermarsh on 2024-02-29 16:55_

---

_Unassigned @charliermarsh by @charliermarsh on 2024-02-29 16:55_

---

_Comment by @charliermarsh on 2024-03-08 20:55_

I believe this is closed by https://github.com/astral-sh/uv/pull/1298 (merged but not yet released).

---

_Closed by @charliermarsh on 2024-03-08 20:55_

---
