<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication error to Google Artifactory with custom index and env variables - astral-sh/uv #8324</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Authentication error to Google Artifactory with custom index and env variables</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/uv/issues/8324">#8324</a>
        opened by <a href="https://github.com/harteros">@harteros</a>
        on 2024-10-18 11:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/harteros">@harteros</a> on 2024-10-18 11:39</div>
            <div class="timeline-body"><p>Hi team, thanks for all your hard work, uv is amazing!</p>
<p>We are currently trying to migrate to uv from poetry. We awaited the update to uv version 0.4.24 for the environmental variables and custom indexes but we have issues with the authentication to our private Google Artifactory.</p>
<p>The problem is as follows:</p>
<p>We have setup uv with keyring for Google Artifactory as follows:</p>
<pre><code class="language-shell">uv tool install keyring --with keyrings.google-artifactregistry-auth
</code></pre>
<p>We have our custom index defined as follows in our <code>pyproject.toml</code></p>
<pre><code class="language-toml">[tool.uv]
keyring-provider = &quot;subprocess&quot;

[[tool.uv.index]]
name = &quot;internal&quot;
url = &quot;https://&lt;internal url&gt;/&lt;internal artifacts&gt;/pypi-virtual/simple&quot;
explicit = true

[tool.uv.sources]
internal-utils = { index = &quot;internal&quot; }
</code></pre>
<p>We have also set our env variable (<a href="https://github.com/astral-sh/uv/blob/05ed4bc11d31c8ef19971812d5554d9158f8823d/CHANGELOG.md#0133">discussed here for Google Artifactory auth</a>)</p>
<pre><code class="language-shell">UV_INDEX_INTERNAL_USERNAME=oauth2accesstoken
</code></pre>
<p>Running <code>uv sync --verbose</code> in this way returns</p>
<pre><code class="language-shell">DEBUG Skipping keyring lookup for https:///&lt;internal url&gt;/&lt;internal artifacts&gt;/pypi-virtual/simple/internal-utils/ with no username
...
DEBUG No compatible version found for: custom-project
  × No solution found when resolving dependencies:
╰─▶ Because only the following versions of ... are available:
       ...
      and your project depends on ... we can conclude that your project's requirements are unsatisfiable.
</code></pre>
<p>On the other hard when we change our <code>pyproject.toml</code> to include the username in the url uv successfully pulls the credentials from the artifactory and installs the dependencies</p>
<pre><code class="language-toml">[tool.uv]
keyring-provider = &quot;subprocess&quot;

[[tool.uv.index]]
name = &quot;internal&quot;
url = &quot;https://oauth2accesstoken@&lt;internal url&gt;/&lt;internal artifacts&gt;/pypi-virtual/simple&quot;
explicit = true

[tool.uv.sources]
internal-utils = { index = &quot;internal&quot; }
</code></pre>
<p>From my tests it seems that the env variable is either not read or appended to the URL causing the artifactory to not work.
Could you please take a look at it, as it seems to me as a possible bug.</p>
<p>Thanks a lot!</p>
<p>uv version: <code>uv 0.4.24 (b9cd54913 2024-10-17)</code>
system platform <code>Apple Silicon macOS</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 12:31</div>
            <div class="timeline-body"><p>Can you try providing both the username and password via the env vars, rather than one in the URL and one in the env var?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/harteros">@harteros</a> on 2024-10-18 12:36</div>
            <div class="timeline-body"><p>Yeah i have tried that, but it does not work. I get the error with skipping the keyring</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-18 12:57</div>
            <div class="timeline-body"><p>Oh sorry, I misread the issue. This may be a bug -- we'll take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-10-18 12:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ticosax">@ticosax</a> on 2024-10-18 14:10</div>
            <div class="timeline-body"><p>I'm observing the same behavior with <code>AWS CodeArtifact</code>.
the workaround to specify the username in the url allows the keyring backend to go through, and successfully install the package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-10-18 14:31</div>
            <div class="timeline-body"><p>Sounds like we're missing something in the credential attachment here. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aditya-PS-05">@Aditya-PS-05</a> on 2024-10-18 14:52</div>
            <div class="timeline-body"><p>Working on it and It's strange but I guess <code>from_env</code> from credentials to set the credentials is not used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8335.html">astral-sh/uv#8335</a> on 2024-10-18 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-10-18 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-10-20 16:14</div>
            <div class="timeline-body"><p>I believe this is closed by https://github.com/astral-sh/uv/pull/8345.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/harteros">@harteros</a> on 2024-10-20 19:46</div>
            <div class="timeline-body"><p>Thanks a lot for the quick response and fix!
I would like to test it out when you release the next version of uv including the fix and close the issue then if thats ok with you too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @harteros on 2024-10-21 09:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:00 UTC
    </footer>
</body>
</html>
