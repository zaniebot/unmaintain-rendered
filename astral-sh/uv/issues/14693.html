<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conflicting information about the PATH on Windows - astral-sh/uv #14693</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Conflicting information about the PATH on Windows</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/14693">#14693</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2025-07-17 20:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>In my Windows PowerShell, uv 0.8.0 (branch) can&#x27;t decide whether the bin directory is already on path or not:</p>
<pre><code>PS C:\Users\Konsti\projects-ext\uv&gt; target\debug\uv python install --reinstall 3.13
Installed Python 3.13.5 in 12.84s
 + cpython-3.13.5-windows-x86_64-none (python3.13.exe)
warning: `C:\Users\Konsti\.local\bin` is not on your PATH. To use installed Python executables, run `$env:PATH = &quot;C:`\Users`\Konsti`\.local`\bin;$env:PATH&quot;` or `uv python update-shell`.
PS C:\Users\Konsti\projects-ext\uv&gt; target\debug\uv tool update-shell              
Executable directory C:\Users\Konsti\.local\bin is already in PATH
</code></pre>
<p>According to the PATH and the GUI that shows the same information, the bin path is not on PATH:</p>
<pre><code>PS $Env:PATH
C:\Users\Konsti\.cargo\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\W
indowsPowerShell\v1.0\;C:\WINDOWS\System32\OpenSSH\;C:\Program Files\nodejs\;C:\ProgramData\chocolatey\b
in;C:\Program Files\Git\cmd;C:\Program Files\Docker\Docker\resources\bin;C:\Program Files\PowerShell\7\;
C:\Users\Konsti\AppData\Local\Programs\Python\Launcher\;C:\Users\Konsti\.pyenv\pyenv-win\bin;C:\Users\Ko
nsti\.pyenv\pyenv-win\shims;C:\Users\Konsti\AppData\Local\Programs\Python\Python38\Scripts\;C:\Users\Kon
sti\AppData\Local\Programs\Python\Python38\;C:\Users\Konsti\AppData\Local\Programs\Python\Python312\Scri
pts\;C:\Users\Konsti\AppData\Local\Programs\Python\Python312\;C:\Users\Konsti\.cargo\bin;C:\Users\Konsti
\AppData\Local\Microsoft\WindowsApps;C:\Users\Konsti\AppData\Local\JetBrains\Toolbox\scripts;C:\Users\Ko
nsti\AppData\Roaming\npm;C:\Users\Konsti\AppData\Local\Programs\Microsoft VS Code\bin;C:\Users\Konsti\AppData\Local\Microsoft\WindowsApps;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-17 20:54</div>
            <div class="timeline-body"><p>That&#x27;s.. interesting. I presume that&#x27;s a longstanding bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-17 20:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">windows</span> added by <a href="https://github.com/konstin">@konstin</a> on 2025-07-17 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-17 20:59</div>
            <div class="timeline-body"><p>It already fails with 0.7.0 (with <code>uv tool update-shell</code>), but it surfaced with the testing now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karnawhat">@karnawhat</a> on 2025-07-25 15:51</div>
            <div class="timeline-body"><p>+1 I also faced this issue with <code>uv==0.7.14</code>. Perhaps the check needs to be done against the specific shell currently running?</p>
<p>I was trying to update the <code>PATH</code> for the <code>C:\windows\system32\cmd.exe</code> &quot;shell&quot; using <code>uv tool update-shell</code>, and ran into the similar issue.</p>
<pre><code>$ echo %COMSPEC%
C:\windows\system32\cmd.exe

$ uv tool update-shell
Executable directory C:\Users\N764265\.local\bin is already in PATH

$ echo %PATH%
C:\Program Files (x86)\Micro Focus\Reflection\;C:\Program Files\Micro Focus\Reflection\;C:\Program Files (x86)\Common Files\Oracle\Java\javapath;C:\windows\system32;C:\windows;C:\windows\System32\Wbem;C:\windows\System32\WindowsPowerShell\v1.0\;C:\Program Files\aim\aim-install\bin\;C:\Program Files\dotnet\;C:\Program Files\PKWARE\SCCLI;C:\Program Files\Citrix\System32\;C:\Program Files\Citrix\ICAService\;C:\Users\N764265\AppData\Local\Microsoft\WindowsApps;
</code></pre>
<p>but checking the PATH for the <code>cmd.exe</code> shell, we see that the bin directory is not included in that PATH and the message that the bin directory is already in the path is a bit misleading. However, it seems like it updates the environment variables for the Windows PowerShell, as that bin directory is available in its PATH?</p>
<pre><code>PS H:\&gt; $ENV:PATH
C:\Program Files (x86)\Micro Focus\Reflection\;C:\Program Files\Micro Focus\Reflection\;C:\Program Files (x86)\Common Files\Oracle\Java\javapath;C:\windows\system32;C:\windows;C:\windows\System32\Wbem;C:\windows\System32\WindowsPowershell\v1.0\;C:\Program Files\aim\aim-install\bin\;C:\Program Files\dotnet\;C:\Program Files\PKWARE\SCCLI;C:\Program Files\Citrix\System32\;C:\ProgramFiles\Citrix\ICAService\;C:\Users\N764265\.local\bin;C:\Users\N764265\AppData\Local\Microsoft\WindowsApps
</code></pre>
<p>If possible, can the message be improved to say which shell the PATH was updated for?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karnawhat">@karnawhat</a> on 2025-07-28 15:34</div>
            <div class="timeline-body"><p><strong>EDIT:</strong> It turns out the <code>%PATH%</code> variable was updated globally, but was not reflected in the windows command prompt <code>cmd.exe</code> even after restarting the shell as recommended by <code>uv tool update-shell</code>. The reason, it turns out, is due to VSCode not updating the environment variables unless you <strong>restart the whole workspace</strong>, despite sourcing and/or opening a new shell (<a href="https://github.com/microsoft/vscode/issues/47816">microsoft/vscode#47816</a>).</p>
<p>When re-opened, the terminal in VS Code now has the updated PATH, e.g.</p>
<pre><code>$ echo %PATH%
C:\Program Files (x86)\Micro Focus\Reflection\;C:\Program Files\Micro Focus\Reflection\;C:\Program Files (x86)\Common Files\Oracle\Java\javapath;C:\windows\system32;C:\windows;C:\windows\System32\Wbem;C:\windows\System32\WindowsPowershell\v1.0\;C:\Program Files\aim\aim-install\bin\;C:\Program Files\dotnet\;C:\Program Files\PKWARE\SCCLI;C:\Program Files\Citrix\System32\;C:\ProgramFiles\Citrix\ICAService\;C:\Users\N764265\.local\bin;C:\Users\N764265\AppData\Local\Microsoft\WindowsApps
</code></pre>
<p>cc @konstin @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-28 16:04</div>
            <div class="timeline-body"><p>Can we detect that we are in a VSCode terminal?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-07-28 16:39</div>
            <div class="timeline-body"><p>Maybe we can check <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment</code> and <code>HKEY_CURRENT_USER\Environment</code>? If the registry and the current session disagree over whether the uv python directory is in PATH, we can recommend to restart the application.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/karnawhat">@karnawhat</a> on 2025-07-30 14:59</div>
            <div class="timeline-body"><p>Thanks @konstin and @zanieb for the quick reply! Please let me know if you would want me to attempt a fix. Happy to contribute back! I&#x27;m guessing <a href="https://github.com/astral-sh/uv/blob/17f0c91896d43b66851229d26385a6989d9e71b2/crates/uv/src/commands/tool/update_shell.rs#L18">this</a> script would be the script to modify?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-07-30 15:04</div>
            <div class="timeline-body"><p>Happy to review a fix!</p>
<p>I think that makes sense. We might want to make a change in <code>Shell::contains_path</code> too? I&#x27;m not sure though. It could be a separate goal to improve the <code>warn_if_not_on_path</code> messaging.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:39:29 UTC
    </footer>
</body>
</html>
