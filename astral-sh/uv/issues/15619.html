<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support for environment markers unclear – docs incomplete/need updating - astral-sh/uv #15619</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support for environment markers unclear – docs incomplete/need updating</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/uv/issues/15619">#15619</a>
        opened by <a href="https://github.com/keikoro">@keikoro</a>
        on 2025-09-01 13:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/keikoro">@keikoro</a> on 2025-09-01 13:07</div>
            <div class="timeline-body"><p>The docs include information about environment markers to narrow down dependency definitions and link to the relevant Python docs in several places, like <a href="https://docs.astral.sh/uv/concepts/projects/dependencies/#dependency-specifiers">here</a> or <a href="https://docs.astral.sh/uv/concepts/resolution/#dependency-overrides">here</a>, but fail to warn users they can't actually use them all (!) since <code>uv</code> <a href="https://github.com/astral-sh/uv/issues/15520#issuecomment-3221289223">doesn't fully support them</a>.</p>
<p>This applies to the markers <code>extras</code> and <code>dependency_groups</code>. Thanks to #14753, assumably, they don't throw any errors – which obscures the fact they aren't properly implemented yet. Until that's done, please update the docs to make users aware of that fact so they don't unnecessarily waste time on them, thinking whatever <em>they</em> are doing must be wrong.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-01 13:12</div>
            <div class="timeline-body"><blockquote>
<p>...which obscures the fact they aren't properly implemented yet.</p>
</blockquote>
<p>To clarify, they are properly implemented. You <em>cannot</em> use those markers anywhere but in the output of a PEP 751 lockfile, per the spec. Those aren't markers that users are allowed to use in any other context. You can read the PEP here: https://peps.python.org/pep-0751/#additions-to-marker-expression-syntax</p>
<blockquote>
<p>The additions outlined in this PEP ONLY apply in the context of lock files as defined by this PEP and not in other contexts where marker syntax is used (e.g. METADATA, pyproject.toml).</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-09-01 13:12</div>
            <div class="timeline-body"><p>We should error in other contexts though, per the PEP:</p>
<blockquote>
<p>Fourth, use of extras and dependency_groups will be considered an error outside of lock file (much like extra outside of <a href="https://packaging.python.org/en/latest/specifications/core-metadata/#core-metadata">Core metadata specifications</a>).</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">error messages</span> added by @charliermarsh on 2025-09-01 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keikoro">@keikoro</a> on 2025-09-01 14:14</div>
            <div class="timeline-body"><blockquote>
<p>To clarify, they are properly implemented. You <em>cannot</em> use those markers anywhere but in the output of a PEP 751 lockfile, per the spec. Those aren't markers that users are allowed to use in any other context. You can read the PEP here: https://peps.python.org/pep-0751/#additions-to-marker-expression-syntax</p>
</blockquote>
<p>The links in the <code>uv</code> docs that I found don't talk about or link to <em>lockfile</em>-specific PEPs or Python documentation, though.</p>
<p>The sections I pointed to as well as others I came across all (eventually) reference or link to <a href="https://peps.python.org/pep-0508/"><code>PEP 508</code></a> or the <a href="https://packaging.python.org/en/latest/specifications/dependency-specifiers/">dependency specifiers page</a> of the Packaging docs. The <a href="https://packaging.python.org/en/latest/specifications/dependency-specifiers/#environment-markers">environment markers section</a> of the latter links to again different PEPs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keikoro">@keikoro</a> on 2025-09-01 14:25</div>
            <div class="timeline-body"><blockquote>
<p>The <a href="https://packaging.python.org/en/latest/specifications/dependency-specifiers/#environment-markers">environment markers section</a> of the latter links to again different PEPs.</p>
</blockquote>
<p>Above the table with all the markers, it says:</p>
<blockquote>
<p>The “extras” and “dependency_groups” variables are also special. They are used to specify any requested extras or dependency groups when installing from a lock file. Outside of the context of lock files, these two variables should result in an error like all other unknown variables.</p>
</blockquote>
<p>The average user wouldn't necessarily know that <code>uv</code>'s lock files are formatted differently than the &quot;ideal&quot; or recommended lock file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-01 14:46</div>
            <div class="timeline-body"><p>I don't really get what you're saying? Maybe you should be more concrete about what you want here? I think the linked specification documentation is quite clear that these fields are only usable inside lockfiles, but you're complaining that we're not explaining that you can't use them elsewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keikoro">@keikoro</a> on 2025-09-01 18:32</div>
            <div class="timeline-body"><blockquote>
<p>I think the linked specification documentation is quite clear that these fields are only usable inside lockfiles</p>
</blockquote>
<p>It isn't, though. Maybe that's how you know to interpret it with your greater knowledge of how packaging works and what packaging tool devs (need to) know.</p>
<p>I am not that. The passage I quoted doesn't say what you are saying. It talks about &quot;<em>installing</em> from lock files&quot; and that these fields are only relevant in the &quot;<em>context</em> of lock files&quot;. The context exists merely by using a tool that uses lock files.</p>
<blockquote>
<p>I don't really get what you're saying? Maybe you should be more concrete about what you want here?</p>
</blockquote>
<p>Expert's curse? I don't know how much clearer I could have been in describing my issue. Unless you're asking me to type out concrete suggestions for changes, i.e. what would normally go in a PR.</p>
<blockquote>
<p>but you're complaining that we're not explaining that you can't use them elsewhere?</p>
</blockquote>
<p>This is a really weird way to react to feedback regarding improvements that could be made to documentation you maintain. Whose entire point is to make things easier to use and understand for more people.</p>
<p>If <code>uv</code> doesn't look further than its own docs because ¯_(ツ)_/¯ it clearly isn't your responsibility: point taken &amp; useful to know going forward.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/keikoro">@keikoro</a> on 2025-09-02 08:07</div>
            <div class="timeline-body"><blockquote>
<p>We should error in other contexts though, per the PEP:</p>
<blockquote>
<p>Fourth, use of extras and dependency_groups will be considered an error outside of lock file (much like extra outside of <a href="https://packaging.python.org/en/latest/specifications/core-metadata/#core-metadata">Core metadata specifications</a>).</p>
</blockquote>
</blockquote>
<p>Thank you. Had there been an error, I might have found out about proper usage/that specific PEP sooner.</p>
<p>(Not being particularly knowledgeable about lock files and then seeing several remarks about these fields <em>not yet</em> being supported certainly didn't help.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-09-03 12:12</div>
            <div class="timeline-body"><p>I think you're assuming the worst of us here. We're both interested in improving our documentation and helping you, but the tone of this interaction is making it challenging.</p>
<p>I think in your last post you clarified part of what I didn't understand:</p>
<blockquote>
<p>The passage I quoted doesn't say what you are saying. It talks about &quot;installing from lock files&quot; and that these fields are only relevant in the &quot;context of lock files&quot;. The context exists merely by using a tool that uses lock files.</p>
</blockquote>
<p>I think this should be clarified in the upstream documentation, as it is in the PEP. They're talking about these markers only being valid when present in a lockfile. It sounds like you interpreted this as them being available outside of a lockfile when a lockfile exists? Where were you trying to use the markers?</p>
<p>I still don't understand what you mean by:</p>
<blockquote>
<p>The average user wouldn't necessarily know that uv's lock files are formatted differently than the &quot;ideal&quot; or recommended lock file.</p>
</blockquote>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:05 UTC
    </footer>
</body>
</html>
