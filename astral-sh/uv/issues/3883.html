<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure pip compile via pyproject.toml or uv.toml - astral-sh/uv #3883</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Configure pip compile via pyproject.toml or uv.toml</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/3883">#3883</a>
        opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a>
        on 2024-05-28 14:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-05-28 14:55</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->

<p>Recently uv started supporting TOML config files and it has been very useful. I believe it could be greatly expanded. (BTW, there is no &quot;discussions&quot; page on this Github project. I would prefer posting it there instead of an issue).</p>
<p>Currently <a href="https://github.com/jazzband/pip-tools?tab=readme-ov-file#configuration">pip-tools is configurable via pyproject.toml </a>, so I believe we could have very similar configs for the high level options like <code>generate_hashes</code> and <code>annotate</code>.</p>
<p>The reason I opened this discussion is to go even further and solve a problem I always had with pip-tools.</p>
<p>My project has multiple <code>.in</code> files and multiple <code>.txt</code> outputs. Each in file has windows and linux versions and we will start having them for multiple python versions to be able to support Python 3.12 and 3.13 where it is hard to find compatible libs that still support 3.9 simultaneously.</p>
<p>Our current approach is to have a script like this:</p>
<pre><code>uv pip compile ./requirements/requirements.in ./requirements/requirements-dev.in -o ./requirements/requirements-dev-linux.txt --python-platform=linux
uv pip compile ./requirements/requirements.in -o ./requirements/requirements-linux.txt --python-platform=linux
uv pip compile ./requirements/requirements.in ./requirements/requirements-dev.in -o ./requirements/requirements-dev-win.txt --python-platform=windows
uv pip compile ./requirements/requirements.in -o ./requirements/requirements-win.txt --python-platform=windows
</code></pre>
<p>But if I want, lets say, upgrade a lib, I have to pass extra parameters to all these commands. So in fact I never use <code>uv pip compile</code> but a wrapper around it.</p>
<p>It would be way better if I had a pyproject.toml like this:</p>
<pre><code>[tool.uv.pip.compile.outputs]
foo-win.txt = { in = foo.in, python-platform = windows }
foo-linux.txt = { in = foo.in, python-platform = linux }
bar-py39.txt = { in = bar.in, python-version = 3.9 }
bar-py312.txt = { in = bar.in, python-version = 3.12 }
</code></pre>
<p>Then I would just run <code>uv pip compile</code> and it would generate all files. Better yet, if I did <code>uv pip compile --upgrade numpy</code> it would also pass this parameter to all the files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2024-05-28 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2024-09-20 00:33</div>
            <div class="timeline-body"><p>Hi everyone, I feel like uv lock is way more versatile and my worflow no longer contains pip compile but it does have multiple uv export which guarantee versions are the same across multiple txt files. Also I adopted the universal format long ago which greatly simplified the workflow even with pip compile.</p>
<p>From my end, this PR can be closed. I let the maintainer decide since there are some thumbs up emojis</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8865.html">astral-sh/uv#8865</a> on 2024-11-07 12:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssbarnea">@ssbarnea</a> on 2024-11-07 12:11</div>
            <div class="timeline-body"><p>I don't think this should be closed because current behavior can cause some nasty bugs, basically if someone tries to configure <code>--python-version=3.10</code> for compile, they will break their uv usage in other places. <code>[tool.uv.pip]</code> is not appropriate for use, clearly we need a <code>[tool.uv.pip.compile]</code> for putting specific options there.</p>
<p>Note that <code>uv.lock</code> file is not supported by dependabot and is highly unlikely that it will become supported in the next few years.</p>
<h1>How to fully break uv:</h1>
<pre><code class="language-toml">[tool.uv.pip]
annotation-style = &quot;line&quot;
custom-compile-command = &quot;tox run deps&quot;
python-version = &quot;3.10&quot; # &lt;-- that will cause it to install wrong wheels
</code></pre>
<p>The last line makes uv install the wrong wheel, even if documentation states that it should do something different:</p>
<pre><code> --python-version &lt;PYTHON_VERSION&gt;      The minimum Python version that should be supported by the requirements (e.g., `3.7` or `3.7.9`)
</code></pre>
<p>I tried to use this config option in order to produce predictable lock file using <code>uv pip compile</code> but the side effect is that once you configure it, uv will start installing wrong binary wheel all the time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-11-07 20:25</div>
            <div class="timeline-body"><p>I think we should be able to improve the behavior you've described there.</p>
<blockquote>
<p>Note that uv.lock file is not supported by dependabot and is highly unlikely that it will become supported in the next few years.</p>
</blockquote>
<p>A bit of an aside, but it's a pity to see how slow support is moving over there. It's worth noting that Renovate does support <code>uv.lock</code> already.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kiyoon">@kiyoon</a> on 2024-12-12 04:44</div>
            <div class="timeline-body"><p>I would like to see this support soon. I'm dying to have to type the full options for every project, especially the python platform and versions. I'm not ready to move onto <code>uv.lock</code> now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssbarnea">@ssbarnea</a> on 2025-01-29 13:56</div>
            <div class="timeline-body"><p>@zanieb Any chance we can see a fix here as we are facing it again and we are forced to add lots of workarounds and comments explaining why is the use the <code>--python-version</code> is broken for  building constraints.</p>
<p>Even an intermediary change like detecting unused or broken options could be seen as helpful, as it would prevent users from wasting hours trying to figure-out why the outcomes are not the desired ones, especially as the problem with regex described at https://github.com/astral-sh/uv/issues/8865 is quite hard to spot, as it translates to uv installing wrong dependencies and failing not when building the constraints, but when installing them later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-01-30 16:58</div>
            <div class="timeline-body"><p>I'm looking into the <code>python-version</code> behavior specifically.</p>
<blockquote>
<p>why is the use the --python-version is broken for building constraints.</p>
</blockquote>
<p>Can you explain this?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:27 UTC
    </footer>
</body>
</html>
