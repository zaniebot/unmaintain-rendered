```yaml
number: 8342
title: Executables not found in Docker after installing with uv
type: issue
state: closed
author: victor-ajayi
labels:
  - question
assignees: []
created_at: 2024-10-18T17:45:56Z
updated_at: 2025-01-09T13:50:47Z
url: https://github.com/astral-sh/uv/issues/8342
synced_at: 2026-01-10T01:57:19Z
```

# Executables not found in Docker after installing with uv

---

_Issue opened by @victor-ajayi on 2024-10-18 17:45_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with uv.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `uv pip sync requirements.txt`), ideally including the `--verbose` flag.
* The current uv platform.
* The current uv version (`uv --version`).
-->
I'm trying to use uv in my Docker container but the image keeps failing, because of a `Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "fastapi": executable file not found in $PATH: unknown` error.

Here's my Dockerfile, it's basically the same as the example from the uv docs, this specific one is from tiangolo's fullstack FastAPI template.

```
FROM python:3.12

ENV PYTHONUNBUFFERED=1

WORKDIR /app/

COPY --from=ghcr.io/astral-sh/uv:0.4.15 /uv /bin/uv

ENV PATH="/app/.venv/bin:$PATH"

ENV UV_COMPILE_BYTECODE=1

ENV UV_LINK_MODE=copy

RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project

ENV PYTHONPATH=/app

COPY ./pyproject.toml ./uv.lock ./alembic.ini /app/

COPY ./app /app/app

RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync

CMD ["fastapi", "run", "--workers", "4", "app/main.py"]
```

The final command keeps failing, how do I get this to work?

---

_Comment by @charliermarsh on 2024-10-18 17:56_

Does `CMD ["/app/.venv/bin/fastapi", "run", "--workers", "4", "app/main.py"]` work as expected?

---

_Label `question` added by @charliermarsh on 2024-10-18 17:56_

---

_Comment by @victor-ajayi on 2024-10-18 18:39_

No, it doesn't. ((

`Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "/app/.venv/bin/fastapi": stat /app/.venv/bin/fastapi: no such file or directory: unknown`

---

_Comment by @zanieb on 2024-10-18 18:45_

Sounds like the Python executable is missing. What does `/app/.venv/bin/python` point to?

---

_Comment by @victor-ajayi on 2024-10-18 18:47_

When I run `CMD which python3` as the final line in the Dockerfile it prints `/usr/local/bin/python3`. Version 3.12.7. So it does exist. But it seems Python can't find any of the installed packages


---

_Comment by @zanieb on 2024-10-18 19:04_

But what does `ls -lah /app/.venv/bin` show?

---

_Comment by @victor-ajayi on 2024-10-18 19:16_

`ls: cannot access '/app/.venv/bin': No such file or directory`.

Okay so I tried this `CMD ls -lah backend/.venv/bin` and the packages are in fact installed. 

<img width="764" alt="image" src="https://github.com/user-attachments/assets/9239c9f5-b52b-4269-964b-d5988104f16a">

But interestingly, when I try `CMD ["backend/.venv/bin/fastapi", "dev", "--workers", "4", "backend/app/main.py"]`, which is the same path, I get a `exec backend/.venv/bin/fastapi: no such file or directory`. I noticed the Python executable is pointing to my local instance of Python? Is that normal?

---

_Comment by @zanieb on 2024-10-18 22:26_

Yeah the `python` is pointing to a file that does not exist, hence the error. My best guess is that you don't have a `dockerignore` file that excludes your virtual environment and it's being copied into the container or something?

I'd recommend checking out https://github.com/astral-sh/uv-docker-example/

---

_Comment by @victor-ajayi on 2024-10-19 00:24_

The uv-docker-example works! I'm not sure exactly what about the tiangolo example Dockerfile wasn't right, it seemed to me like the same thing. Thank you!

Also, my apologies for creating an issue that really has more to do with Docker than uv itself. I appreciate the help!

---

_Comment by @zanieb on 2024-10-19 04:02_

No problem. That message when a Python executable can't be found is really confusing, but I'm not sure what we can do about it. Glad you got it working.

---

_Closed by @zanieb on 2024-10-19 04:02_

---

_Comment by @gabo71096 on 2024-11-05 13:26_

I have the same issue, not even the uv-docker-example works :( I really want to use uv in Docker because it really speeds build time, but has been a pain, I've tried many things and always hit the same spot of

`exec /app/.venv/bin/fastapi: no such file or directory`

or

`Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "fastapi": executable file not found in $PATH: unknown.`

Here's the Dockerfile, it's basically the same as the example:

```
FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim AS builder
ENV UV_COMPILE_BYTECODE=1 UV_LINK_MODE=copy
WORKDIR /app
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev
ADD . /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# Then, use a final image without uv
FROM python:3.12-slim-bookworm
# It is important to use the image that matches the builder, as the path to the
# Python executable must be the same, e.g., using `python:3.11-slim-bookworm`
# will fail.

# Copy the application from the builder
COPY --from=builder --chown=app:app /app /app

# Place executables in the environment at the front of the path
ENV PATH="/app/.venv/bin:$PATH"

# Run the FastAPI application by default
CMD ["fastapi", "run", "app/main.py", "--proxy-headers", "--port", "80"]
```

If I run `CMD ls -lah /app` I can see that the `.venv` folder doesn't exist, so it makes sense I think that the command wasn't found, is it supposed to be like this, though?

I am doing this in Windows, and also tried WSL, none works :(, a little help please.

---

_Comment by @petebachant on 2024-12-09 23:30_

Had a similar problem, and noticed that the Docker Compose config was mounting the local directory, which in turn mounted the local `.venv` directory, messing up the path to the Python executable in the `fastapi` script shebang line. The fix was to ensure that directory was not mapped, e.g., in `docker-compose.yml`:

```yaml
  backend:
    restart: "no"
    env_file:
      - .env
    ports:
      - "8000:8000"
    volumes:
      - ./backend/:/app
      - /app/.venv
    build:
      context: ./backend
    command:
      - fastapi
      - run
      - --reload
      - "app/main.py"
```

---

_Comment by @gabo71096 on 2025-01-09 13:50_

> I have the same issue, not even the uv-docker-example works :( I really want to use uv in Docker because it really speeds build time, but has been a pain, I've tried many things and always hit the same spot of
> 
> `exec /app/.venv/bin/fastapi: no such file or directory`
> 
> or
> 
> `Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "fastapi": executable file not found in $PATH: unknown.`
> 
> Here's the Dockerfile, it's basically the same as the example:
> 
> ```
> FROM ghcr.io/astral-sh/uv:python3.12-bookworm-slim AS builder
> ENV UV_COMPILE_BYTECODE=1 UV_LINK_MODE=copy
> WORKDIR /app
> RUN --mount=type=cache,target=/root/.cache/uv \
>     --mount=type=bind,source=uv.lock,target=uv.lock \
>     --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
>     uv sync --frozen --no-install-project --no-dev
> ADD . /app
> RUN --mount=type=cache,target=/root/.cache/uv \
>     uv sync --frozen --no-dev
> 
> # Then, use a final image without uv
> FROM python:3.12-slim-bookworm
> # It is important to use the image that matches the builder, as the path to the
> # Python executable must be the same, e.g., using `python:3.11-slim-bookworm`
> # will fail.
> 
> # Copy the application from the builder
> COPY --from=builder --chown=app:app /app /app
> 
> # Place executables in the environment at the front of the path
> ENV PATH="/app/.venv/bin:$PATH"
> 
> # Run the FastAPI application by default
> CMD ["fastapi", "run", "app/main.py", "--proxy-headers", "--port", "80"]
> ```
> 
> If I run `CMD ls -lah /app` I can see that the `.venv` folder doesn't exist, so it makes sense I think that the command wasn't found, is it supposed to be like this, though?
> 
> I am doing this in Windows, and also tried WSL, none works :(, a little help please.

I stopped trying since this comment, and today I got it working.
Stupid error as always.
I was bind mounting in my docker-compose file.

End of story.

Thanks guys.

---

_Referenced in [Paulescu/kubernetes-for-ml-engineers#3](../../Paulescu/kubernetes-for-ml-engineers/issues/3.md) on 2025-03-30 02:09_

---
