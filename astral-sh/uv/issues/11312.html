<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Differences in uv.lock File Generated by uv sync Across Different Platforms - astral-sh/uv #11312</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Differences in uv.lock File Generated by uv sync Across Different Platforms</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/uv/issues/11312">#11312</a>
        opened by <a href="https://github.com/junxy">@junxy</a>
        on 2025-02-07 11:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/junxy">@junxy</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hi there,
When executing <code>uv sync</code> on different platforms, the <code>uv.lock</code> file is automatically updated. The main observed differences are:</p>
<ul>
<li>On Windows, the entries end with a <code>/</code>.</li>
<li>On macOS, the entries do not end with a <code>/</code>.</li>
<li>Linux has not been tested.</li>
</ul>
<p>Additionally, when using <code>uv run python --version</code>, this difference also causes the <code>uv.lock</code> file to be updated.</p>
<pre><code class="language-diff">...
 [[package]]
 name = &quot;aiohappyeyeballs&quot;
 version = &quot;2.4.4&quot;
-source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
+source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot; }
 sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/7f/55/e4373e888fdacb15563ef6fa9fa8c8252476ea071e96fb46defac9f18bf2/aiohappyeyeballs-2.4.4.tar.gz&quot;, hash = &quot;sha256:5fdd7d87889c63183afc18ce9271f9b0a7d32c2303e394468dd45d514a757745&quot;, size = 21977 }
...
</code></pre>
<p><code>pyproject.toml</code></p>
<pre><code class="language-toml">#...
[[tool.uv.index]]
url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;
default = true
#...
</code></pre>
<h3>Platform</h3>
<p>macOS 14 arm64, Windows 11 x86_64</p>
<h3>Version</h3>
<p>uv 0.5.29 (ca73c4754 2025-02-05)</p>
<h3>Python version</h3>
<p>Python 3.12.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @junxy on 2025-02-07 11:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-07 13:58</div>
            <div class="timeline-body"><p>Sorry, I can't replicate this. Are you sure you aren't including a trailing slash in one context but not the other?</p>
<p>E.g.:</p>
<pre><code>‚ùØ uv add --index https://pypi.tuna.tsinghua.edu.cn/simple/ iniconfig
Using CPython 3.13.0
Creating virtual environment at: .venv
Resolved 2 packages in 2ms
Installed 1 package in 2ms
 + iniconfig==2.0.0

‚ùØ cat uv.lock
version = 1
requires-python = &quot;&gt;=3.13.0&quot;

[[package]]
name = &quot;bar&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;iniconfig&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;iniconfig&quot;, specifier = &quot;&gt;=2.0.0&quot; }]

[[package]]
name = &quot;iniconfig&quot;
version = &quot;2.0.0&quot;
source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot; }
sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
wheels = [
    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
]
</code></pre>
<p>Versus:</p>
<pre><code>‚ùØ uv add --index https://pypi.tuna.tsinghua.edu.cn/simple iniconfig
Using CPython 3.13.0
Creating virtual environment at: .venv
Resolved 2 packages in 2.09s
Prepared 1 package in 836ms
Installed 1 package in 3ms
 + iniconfig==2.0.0

‚ùØ cat uv.lock
version = 1
requires-python = &quot;&gt;=3.13.0&quot;

[[package]]
name = &quot;foo&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;iniconfig&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;iniconfig&quot;, specifier = &quot;&gt;=2.0.0&quot; }]

[[package]]
name = &quot;iniconfig&quot;
version = &quot;2.0.0&quot;
source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
wheels = [
    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-07 14:02</div>
            <div class="timeline-body"><p>We can consider normalizing the trailing slash either way, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2025-02-07 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/junxy">@junxy</a> on 2025-02-07 16:11</div>
            <div class="timeline-body"><p>@charliermarsh I may not have explained myself clearly. The presence or absence of a trailing <code>/</code> in <code>--index https://pypi.tuna.tsinghua.edu.cn/simple/</code> yields consistent results in the same environment. The inconsistency arises in different environments: I've noticed that the results differ between Windows and macOS. I'm not sure if this is related to <code>Python 3.12.3</code>. I will test the method you provided later to see if I can reproduce the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-07 16:59</div>
            <div class="timeline-body"><p>Got it. I'll test that out later today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-07 21:33</div>
            <div class="timeline-body"><p>I don't think I can reproduce this. At least, these tests passed on all platforms: https://github.com/astral-sh/uv/pull/11332.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @charliermarsh on 2025-02-07 21:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> added by @charliermarsh on 2025-02-07 21:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/junxy">@junxy</a> on 2025-02-08 04:12</div>
            <div class="timeline-body"><p>@charliermarsh I can confirm that this issue only occurs on the Windows platform, and I have found a way to reproduce it:</p>
<pre><code class="language-ps1">&gt; mkdir test1
&gt; cd test1
&gt; uv init

&gt; uv add --index https://pypi.tuna.tsinghua.edu.cn/simple iniconfig
Using CPython 3.13.1
Creating virtual environment at: .venv
Resolved 2 packages in 4ms
Installed 1 package in 15ms
 + iniconfig==2.0.0

&gt; cat uv.lock
version = 1
requires-python = &quot;&gt;=3.13&quot;

[[package]]
name = &quot;iniconfig&quot;
version = &quot;2.0.0&quot;
source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
wheels = [
    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
]

[[package]]
name = &quot;test1&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;iniconfig&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;iniconfig&quot;, specifier = &quot;&gt;=2.0.0&quot; }]

# ‚úÖ So far, everything seems normal.

# üî® One more time
&gt; uv sync
Resolved 2 packages in 5ms
Audited 1 package in 0.02ms

# üî® Checking again, and there is a change
&gt; cat uv.lock
version = 1
requires-python = &quot;&gt;=3.13&quot;

[[package]]
name = &quot;iniconfig&quot;
version = &quot;2.0.0&quot;
# üëá
source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot; }
sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
wheels = [
    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
]

[[package]]
name = &quot;test1&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;iniconfig&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;iniconfig&quot;, specifier = &quot;&gt;=2.0.0&quot; }]

# üî® Checking the pyproject.toml, you'll find that it adds a `/`, even when using: uv add --index https://pypi.tuna.tsinghua.edu.cn/simple iniconfig 
&gt; cat pyproject.toml
[project]
name = &quot;test1&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;iniconfig&gt;=2.0.0&quot;,
]

[[tool.uv.index]]
# üëá
url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot;
default = true

# üî® Manually modify pyproject.toml to remove the `/`
&gt; cat pyproject.toml
[project]
name = &quot;test1&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.13&quot;
dependencies = [
    &quot;iniconfig&gt;=2.0.0&quot;,
]

[[tool.uv.index]]
# üëá
url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;
default = true

# üî® One more time
&gt; rm uv.lock
&gt; uv sync
&gt; cat uv.lock
version = 1
requires-python = &quot;&gt;=3.13&quot;

[[package]]
name = &quot;iniconfig&quot;
version = &quot;2.0.0&quot;
# üëá Still adds a `/` 
source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot; }
sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
wheels = [
    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
]

[[package]]
name = &quot;test1&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;iniconfig&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;iniconfig&quot;, specifier = &quot;&gt;=2.0.0&quot; }]
</code></pre>
<p><strong>When I compared it using the Docker container <code>ghcr.io/astral-sh/uv:0.5-python3.12-bookworm</code>, I was unable to reproduce the issue.</strong></p>
<p>Summary:</p>
<ol>
<li>When using <code>uv add --index https://pypi.tuna.tsinghua.edu.cn/simple iniconfig</code>, the first execution works correctly (the <code>uv.lock</code> does not have a trailing <code>/</code>). However, the configuration in <code>pyproject.toml</code> under <code>[[tool.uv.index]]</code> will automatically add a trailing <code>/</code>. On subsequent executions of <code>uv sync</code>, this leads to inconsistency (the <code>uv.lock</code> now has a trailing <code>/</code>).</li>
<li>If the <code>[[tool.uv.index]]</code> URL is manually added without a trailing <code>/</code>, executing <code>uv sync</code> will result in a <code>uv.lock</code> that contains a trailing <code>/</code>, which creates a mismatch with the configuration in <code>pyproject.toml</code>.</li>
<li>A temporary workaround is to add a trailing <code>/</code> to the <code>[[tool.uv.index]]</code> URL in the <code>pyproject.toml</code> configuration file. This adjustment can help prevent the bug from being triggered.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-09 20:01</div>
            <div class="timeline-body"><p>Thanks for the clear write-up. Unfortunately I can't reproduce this on my own Windows machine... I'm not seeing any such trailing slash added to the <code>pyproject.toml</code>, and the <code>uv.lock</code> doesn't contain a trailing slash after re-running <code>uv sync</code>. Are you certain you're on the latest version of uv?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/junxy">@junxy</a> on 2025-02-10 06:17</div>
            <div class="timeline-body"><p>@charliermarsh Thanks for your confirmation. I am using the latest version of <code>uv</code>. I just re-downloaded it from <code>https://github.com/astral-sh/uv/releases/download/0.5.29/uv-x86_64-pc-windows-msvc.zip</code>. On another machine running <code>Microsoft Windows 10 (22H2) [Version 10.0.19045.5371]</code>, I was unable to reproduce the issue. However, on my original machine with <code>Microsoft Windows 11 (23H2) [Version 10.0.22631.4751]</code>, I can consistently reproduce the problem. I'm not sure if it's related to this specific version of Windows or if there might be an issue with my environment. I will test it on another Windows machine later.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/junxy">@junxy</a> on 2025-02-12 09:08</div>
            <div class="timeline-body"><p>Just when I was about to give up, I found the root of the problem, which seems to be independent of the operating system, as it can also be reproduced on Linux. I had forgotten that I set an environment variable at some point: <code>UV_DEFAULT_INDEX=https://pypi.tuna.tsinghua.edu.cn/simple/</code> (with a trailing slash) („Ñío„Ñí)~</p>
<p>Probably found these problems, may be the same reason:</p>
<ol>
<li>The update handling of <code>uv.lock</code> and <code>pyproject.toml</code> is inconsistent when executing <code>uv add --index</code>. (<code>uv.lock</code> -&gt; <code>--index</code>, <code>pyproject.toml</code> -&gt; <code>UV_DEFAULT_INDEX</code>)</li>
<li>The <code>default = true</code> in <code>[[tool.uv.index]]</code> in <code>pyproject.toml</code> also affects which index is used.</li>
<li>Modifying the URL in <code>[[tool.uv.index]]</code> in <code>pyproject.toml</code> to include a trailing slash and executing <code>uv sync</code> may require deleting <code>uv.lock</code> to update, potentially influenced by <code>UV_DEFAULT_INDEX</code>.</li>
</ol>
<p>The logic here is a bit complex, so I will demonstrate directly(Use the official UV Docker image to maintain a consistent environment):</p>
<pre><code class="language-bash">&gt; docker pull ghcr.io/astral-sh/uv:0.5-python3.12-bookworm
&gt; docker run --rm -it ghcr.io/astral-sh/uv:0.5-python3.12-bookworm bash
&gt; uv -V
# latest
uv 0.5.30
&gt; mkdir test &amp;&amp; cd test &amp;&amp; uv init
Initialized project `test`

# üëá
&gt; export UV_DEFAULT_INDEX=https://pypi.tuna.tsinghua.edu.cn/simple/   # üî¥ with trailing slash

&gt; uv add --index https://pypi.tuna.tsinghua.edu.cn/simple iniconfig   # üü¢ without trailing slash
Using CPython 3.12.9 interpreter at: /usr/local/bin/python3.12
Creating virtual environment at: .venv
Resolved 2 packages in 81ms
Prepared 1 package in 63ms
Installed 1 package in 4ms
 + iniconfig==2.0.0

&gt; cat pyproject.toml
[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;iniconfig&gt;=2.0.0&quot;,
]

[[tool.uv.index]]
# üî¥ with trailing slash - same as UV_DEFAULT_INDEX
url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot;
default = true

&gt; cat uv.lock
version = 1
requires-python = &quot;&gt;=3.12&quot;

[[package]]
name = &quot;iniconfig&quot;
version = &quot;2.0.0&quot;
# üü¢ without trailing slash - same as `uv add --index`
source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
wheels = [
    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
]

[[package]]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;iniconfig&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;iniconfig&quot;, specifier = &quot;&gt;=2.0.0&quot; }]

&gt; git add .
üëâ 1: inconsistent VS `uv add --index`
&gt; uv sync
Resolved 2 packages in 2ms
Audited 1 package in 0.01ms
</code></pre>
<pre><code class="language-diff"># git diff | cat
diff --git a/uv.lock b/uv.lock
index 52e98f1..877856d 100644
--- a/uv.lock
+++ b/uv.lock
@@ -4,7 +4,7 @@ requires-python = &quot;&gt;=3.12&quot;
 [[package]]
 name = &quot;iniconfig&quot;
 version = &quot;2.0.0&quot;
# changed to üî¥with / ends - same as UV_DEFAULT_INDEX
-source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
+source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot; }
 sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
 wheels = [
     { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
</code></pre>
<pre><code class="language-bash">&gt; git add .
# üëâ 3: Modify pyproject.toml to remove the trailing slash and check if uv.lock changes
&gt; sed -i 's#url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot;#url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;#g' pyproject.toml
&gt; uv sync  # uv.lock will not change
&gt; rm uv.lock # Delete uv.lock
&gt; uv sync  # uv.lock still will not change
</code></pre>
<pre><code class="language-diff"># git diff | cat
diff --git a/pyproject.toml b/pyproject.toml
index db79f42..9e3cc3c 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -9,5 +9,5 @@ dependencies = [
 ]

 [[tool.uv.index]]
-url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot;
+url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;
 default = true
</code></pre>
<pre><code class="language-bash"># üëâ 2: Modify pyproject.toml to comment out default = true
&gt; sed -i 's#default = true#\# default = true#g' pyproject.toml
&gt; uv sync  # uv.lock will not change
# Executing `uv sync` will update the `uv.lock` file with the need to delete it.
&gt; rm uv.lock # Delete uv.lock
&gt; uv sync  # uv.lock has changed
</code></pre>
<pre><code class="language-diff"># git diff | cat
diff --git a/pyproject.toml b/pyproject.toml
index 9e3cc3c..ff1fcb4 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -10,4 +10,4 @@ dependencies = [

 [[tool.uv.index]]
 url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;
-default = true
+# default = true
diff --git a/uv.lock b/uv.lock
index 877856d..52e98f1 100644
--- a/uv.lock
+++ b/uv.lock
@@ -4,7 +4,7 @@ requires-python = &quot;&gt;=3.12&quot;
 [[package]]
 name = &quot;iniconfig&quot;
 version = &quot;2.0.0&quot;
-source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple/&quot; }
+source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
 sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
 wheels = [
     { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
</code></pre>
<pre><code class="language-bash"># full
&gt; cat pyproject.toml
[project]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
description = &quot;Add your description here&quot;
readme = &quot;README.md&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [
    &quot;iniconfig&gt;=2.0.0&quot;,
]

[[tool.uv.index]]
# üü¢ without trailing slash
url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;
# default = true

&gt; cat uv.lock
version = 1
requires-python = &quot;&gt;=3.12&quot;

[[package]]
name = &quot;iniconfig&quot;
version = &quot;2.0.0&quot;
# üü¢ without trailing slash
source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
wheels = [
    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
]

[[package]]
name = &quot;test&quot;
version = &quot;0.1.0&quot;
source = { virtual = &quot;.&quot; }
dependencies = [
    { name = &quot;iniconfig&quot; },
]

[package.metadata]
requires-dist = [{ name = &quot;iniconfig&quot;, specifier = &quot;&gt;=2.0.0&quot; }]

&gt; env | grep UV
# üî¥ with trailing slash
UV_DEFAULT_INDEX=https://pypi.tuna.tsinghua.edu.cn/simple/

</code></pre>
<p>If the environment variable is set to <code>UV_DEFAULT_INDEX=https://pypi.tuna.tsinghua.edu.cn/simple</code> (without a trailing slash), the same operations can still reproduce the issue, but the results will be exactly the opposite.</p>
<pre><code class="language-bash"># additional
# üëâ 3: Modify pyproject.toml to another index url.
# Executing `uv sync` will update the `uv.lock` file without the need to delete it.
# Previously, it was necessary to delete uv.lock for the file to be updated, which seems to be related to whether UV_DEFAULT_INDEX is the same (regardless of the trailing slash).
&gt; git add .
&gt; sed -i 's#url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;#url = &quot;https://mirrors.aliyun.com/pypi/simple&quot;#g' pyproject.toml
</code></pre>
<pre><code class="language-diff"># git diff | cat
diff --git a/pyproject.toml b/pyproject.toml
index ff1fcb4..47bab81 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -9,5 +9,5 @@ dependencies = [
 ]

 [[tool.uv.index]]
-url = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot;
+url = &quot;https://mirrors.aliyun.com/pypi/simple&quot;
 # default = true
diff --git a/uv.lock b/uv.lock
index 52e98f1..051897a 100644
--- a/uv.lock
+++ b/uv.lock
@@ -4,10 +4,10 @@ requires-python = &quot;&gt;=3.12&quot;
 [[package]]
 name = &quot;iniconfig&quot;
 version = &quot;2.0.0&quot;
-source = { registry = &quot;https://pypi.tuna.tsinghua.edu.cn/simple&quot; }
-sdist = { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot;, size = 4646 }
+source = { registry = &quot;https://mirrors.aliyun.com/pypi/simple&quot; }
+sdist = { url = &quot;https://mirrors.aliyun.com/pypi/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot; }
 wheels = [
-    { url = &quot;https://pypi.tuna.tsinghua.edu.cn/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot;, size = 5892 },
+    { url = &quot;https://mirrors.aliyun.com/pypi/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot; },
 ]

 [[package]]
</code></pre>
<pre><code class="language-bash">&gt; git add .
&gt; sed -i 's#url = &quot;https://mirrors.aliyun.com/pypi/simple&quot;#url = &quot;https://mirrors.aliyun.com/pypi/simple/&quot;#g' pyproject.toml
&gt; uv sync
</code></pre>
<pre><code class="language-diff"># git diff | cat
diff --git a/pyproject.toml b/pyproject.toml
index 47bab81..73b6704 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -9,5 +9,5 @@ dependencies = [
 ]

 [[tool.uv.index]]
-url = &quot;https://mirrors.aliyun.com/pypi/simple&quot;
+url = &quot;https://mirrors.aliyun.com/pypi/simple/&quot;
 # default = true
diff --git a/uv.lock b/uv.lock
index 051897a..d00bcc2 100644
--- a/uv.lock
+++ b/uv.lock
@@ -4,7 +4,7 @@ requires-python = &quot;&gt;=3.12&quot;
 [[package]]
 name = &quot;iniconfig&quot;
 version = &quot;2.0.0&quot;
-source = { registry = &quot;https://mirrors.aliyun.com/pypi/simple&quot; }
+source = { registry = &quot;https://mirrors.aliyun.com/pypi/simple/&quot; }
 sdist = { url = &quot;https://mirrors.aliyun.com/pypi/packages/d7/4b/cbd8e699e64a6f16ca3a8220661b5f83792b3017d0f79807cb8708d33913/iniconfig-2.0.0.tar.gz&quot;, hash = &quot;sha256:2d91e135bf72d31a410b17c16da610a82cb55f6b0477d1a902134b24a455b8b3&quot; }
 wheels = [
     { url = &quot;https://mirrors.aliyun.com/pypi/packages/ef/a6/62565a6e1cf69e10f5727360368e451d4b7f58beeac6173dc9db836a5b46/iniconfig-2.0.0-py3-none-any.whl&quot;, hash = &quot;sha256:b6a85871a79d2e3b22d2d1b94ac2824226a63c6b741c88f7ae975f18b6778374&quot; },


</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-02-12 15:37</div>
            <div class="timeline-body"><p>Okay thanks. This actually does make sense, I think, but perhaps we can do better here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-mre</span> removed by @charliermarsh on 2025-02-12 15:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2025-02-12 15:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2025-02-12 17:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:29:46 UTC
    </footer>
</body>
</html>
