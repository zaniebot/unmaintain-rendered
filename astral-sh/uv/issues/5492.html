<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ability to resolve lowest compatible versions of specific packages only - astral-sh/uv #5492</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ability to resolve lowest compatible versions of specific packages only</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/5492">#5492</a>
        opened by <a href="https://github.com/connortann">@connortann</a>
        on 2024-07-26 20:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/connortann">@connortann</a></div>
            <div class="timeline-body"><p>First, thank you for the amazing package! We're migrating to it over at the <code>shap</code> repo and seeing wonderful speedups.</p>
<p>My question is about how best to test for compatibility with the lowest supported versions &quot;important&quot; dependencies, whilst using the highest versions of all &quot;dev&quot; dependencies. I have tried a few ways so far, but each has a few issues.</p>
<h2>Proposal</h2>
<p>It would be fantastic to be able to install the old versions of <strong>just the subset of libraries for which value broad compatibility</strong>, excluding things like dev dependencies. Something like:</p>
<pre><code class="language-bash">uv pip install --resolution=lowest-subset &quot;numpy,pandas,tensorflow` .[test]
</code></pre>
<h2>Context: a typical scenario</h2>
<p>Taking <a href="https://github.com/shap/shap">shap</a> as an example, we have about 10 optional dependencies for which we'd like to test against older versions. These are the major scientific python libraries: numpy, pandas, tensorflow, pytorch, xgboost, et cetera. We think it's quite likely that users will have their own constraints for these packages, so we'd like to support a wide range and avoid overly restrictive pins.</p>
<p>We also have a number of other dependencies like pytest, setuptools &amp; ipython, for which we only really need to use the latest version. These are mostly &quot;dev&quot; dependencies.</p>
<p>In our case, both of these two types of dependencies are included in the &quot;test&quot; extra. We can install them on ci with: <code>uv pip install --system .[test]</code></p>
<h2>Our objective</h2>
<p>We'd like to be able to test against the oldest supported numpy, pandas, tensorflow and pytorch.</p>
<p>Ideally we would minimise the number of new dependency pins that we introduce. For example, we might want to test against 2-year-old numpy, but as it happens the package might still work with 4-year-old numpy and we wouldn't want to prevent a user from using that version.</p>
<h2>Options explored so far</h2>
<h3>1. resolution=lowest-direct</h3>
<p>I tried the <code>--resolution=lowest-direct</code> flag to test older versions of numpy and tensorflow. However, this also resolves the lowest versions of all the &quot;dev&quot; dependencies like pytest. To mitigate this, we could:</p>
<ol>
<li>Add lower version constraints for every single dev dependency. These would then have to be maintained manually; AFAIK there is no automated solution like dependabot to update the lower pins according to something like SPEC 0. This seems unwise as we don't really care about the lowest working pytest: we only need the latest version on CI.</li>
<li>Add exact pins for every dev dependency. Again, this is not ideal as they will have to be manually maintained and bumped for every release. It's likely that many of these pins would become outdated over time without a maintainer carefully keeping them under review.</li>
</ol>
<h3>2. exclude-newer</h3>
<p>I also tried the <code>--exclude-newer</code> flag from #2088, which could be used to automatically determine the lowest versions that should be supported according to SPEC 0. However, this prevents us from using the latest dev dependencies. In our case, our build fails as we use recent features from <code>setuptools-scm</code> that weren't around two years ago.</p>
<h3>3. Explicit constraint in install command</h3>
<p>Finally, I also tried adding some constraints into the <code>uv pip install</code> command directly, like: <code>uv pip install --system numpy==1.24.0 '.[test]'</code>. This seems to be the best solution so far, but it doesn't use the lower bounds in our pyproject.toml config and so is a little duplicative.</p>
<p>[Edited for clarity]</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-27 12:22</div>
            <div class="timeline-body"><p>This seems like a reasonable use-case (though not yet sure how best to resolve it). One other option is that you could add a constraints file to set lower-bounds on your development dependencies... You could even take the output of the &quot;standard&quot; resolution to seed those constraints.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @charliermarsh on 2024-07-27 12:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antonymilne">@antonymilne</a> on 2024-09-26 19:30</div>
            <div class="timeline-body"><p>Just to add another data point and explain my use case: I'm looking for exactly the same thing on Vizro. We use hatch for project management, and I have an environment <code>lower-bounds</code>. This includes both dev dependencies and some of our core dependencies with manually specified lower bounds:</p>
<pre><code>[envs.default]
dependencies = [&quot;pytest&quot;] # and others

[envs.lower-bounds]
# inherits dev dependencies from default environment and then manually specify lower bounds
# for some core dependencies
extra-dependencies = [&quot;pydantic==1.10.13&quot;, &quot;dash==2.17.1&quot;]
</code></pre>
<p>What I'd like to do is this:</p>
<pre><code>[envs.lower-bounds]
env-vars = {UV_RESOLUTION = &quot;lowest-direct&quot;}
</code></pre>
<p>... but unfortunately this means specifying a lower bound for all our dev dependencies. So ideally there would be some way to specify <code>lowest-direct</code> for just a subset of the dependencies.</p>
<p>Also just wanted to echo a huge thank you for the amazing work on uv. It's sped up our development process massively!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:25:47 UTC
    </footer>
</body>
</html>
