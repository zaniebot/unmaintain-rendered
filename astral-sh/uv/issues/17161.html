<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make settings from [uv.tool] section defined in pyproject.toml always effective when pyproject.toml is used in uv CLI commands. - astral-sh/uv #17161</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Make settings from [uv.tool] section defined in pyproject.toml always effective when pyproject.toml is used in uv CLI commands.</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/uv/issues/17161">#17161</a>
        opened by <a href="https://github.com/pstrzelczak">@pstrzelczak</a>
        on 2025-12-17 10:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pstrzelczak">@pstrzelczak</a> on 2025-12-17 10:45</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I noticed that in some cases settings defined in <code>[uv.tool]</code> get lost when current directory differs from the location of <code>pyproject.toml</code> file. This is particularly painful for use cases when multiple <code>pyproject.toml</code> are involved. A notable example of this pain is a use case to compile dependencies of multiple projects via <code>uv pip compile</code> when each respective <code>pyproject.toml</code> has exclude-dependencies defined.</p>
<h3>Example</h3>
<p>I have a project-a and project-b.</p>
<p>project-a pyproject.toml:</p>
<pre><code>[project]
name = &quot;project-a&quot;
version = &quot;0.1.0&quot;
description = &quot;A helpful local library&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;python-dateutil&quot;]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.hatch.build.targets.wheel]
packages = [&quot;src/project_a&quot;]

[tool.uv]
exclude-dependencies = [&quot;six&quot;]
</code></pre>
<p>project-b pyproject.toml (almost same):</p>
<pre><code>[project]
name = &quot;project-b&quot;
version = &quot;0.1.0&quot;
description = &quot;A helpful local library&quot;
requires-python = &quot;&gt;=3.12&quot;
dependencies = [&quot;python-dateutil&quot;]

[build-system]
requires = [&quot;hatchling&quot;]
build-backend = &quot;hatchling.build&quot;

[tool.hatch.build.targets.wheel]
packages = [&quot;src/project_b&quot;]

[tool.uv]
exclude-dependencies = [&quot;six&quot;]
</code></pre>
<p>Now:</p>
<pre><code>$ uv pip compile project-b/pyproject.toml project-a/pyproject.toml
Resolved 2 packages in 91ms
# This file was autogenerated by uv via the following command:
#    uv pip compile project-b/pyproject.toml project-a/pyproject.toml
python-dateutil==2.9.0.post0
    # via
    #   project-a (project-a/pyproject.toml)
    #   project-b (project-b/pyproject.toml)
six==1.17.0
    # via python-dateutil

$ uv pip compile project-b/pyproject.toml project-a/pyproject.toml --project project-a/
Resolved 2 packages in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile project-b/pyproject.toml project-a/pyproject.toml --project project-a/
python-dateutil==2.9.0.post0
    # via
    #   project-a (project-a/pyproject.toml)
    #   project-b (project-b/pyproject.toml)
six==1.17.0
    # via python-dateutil
</code></pre>
<p>The only way to get rid of unwanted transitive dependency is to use --exclude:</p>
<pre><code>$ cat excludes.txt 
six

$ uv pip compile project-b/pyproject.toml project-a/pyproject.toml --exclude excludes.txt 
Resolved 1 package in 2ms
# This file was autogenerated by uv via the following command:
#    uv pip compile project-b/pyproject.toml project-a/pyproject.toml --exclude excludes.txt
python-dateutil==2.9.0.post0
    # via
    #   project-a (project-a/pyproject.toml)
    #   project-b (project-b/pyproject.toml)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @pstrzelczak on 2025-12-17 10:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> removed by @konstin on 2025-12-17 10:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @konstin on 2025-12-17 10:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @konstin on 2025-12-17 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @konstin on 2025-12-17 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2025-12-17 11:19</div>
            <div class="timeline-body"><p>Currently, uv only loads the settings of the closest <code>pyproject.toml</code>, i.e. the one in the current directory, while ignoring the other configurations (there is no configuration merging across input files).</p>
<p>It also looks like in project-a pyproject.toml, the <code>[tool.uv]</code> header before <code>exclude-dependencies = [&quot;six&quot;]</code> is missing, though that's not the cause here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pstrzelczak">@pstrzelczak</a> on 2025-12-17 11:33</div>
            <div class="timeline-body"><p>@konstin thanks for noticing the mistake. I edited my original report. I aware of the note <a href="https://docs.astral.sh/uv/reference/settings/#exclude-dependencies">here</a> but I would like to have this limitation waived:</p>
<pre><code>In uv lock, uv sync, and uv run, uv will only read exclude-dependencies from the pyproject.toml at the workspace root, and will ignore any declarations in other workspace members or uv.toml files.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Make settings from [uv.tool] section defined in pyproject.toml always effective when that pyproject.toml is used in uv CLI commands." to "Make settings from [uv.tool] section defined in pyproject.toml always effective when pyproject.toml is used in uv CLI commands." by @pstrzelczak on 2025-12-19 12:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:15 UTC
    </footer>
</body>
</html>
