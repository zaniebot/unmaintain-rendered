<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule request: Detect dataclass() usage with Enum and its subclasses - astral-sh/ruff #15275</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule request: Detect dataclass() usage with Enum and its subclasses</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15275">#15275</a>
        opened by <a href="https://github.com/correctmost">@correctmost</a>
        on 2025-01-05 19:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/correctmost">@correctmost</a></div>
            <div class="timeline-body"><h3>Motivation</h3>
<p>There was a <a href="https://github.com/archlinux/archinstall/issues/3055">bug in archinstall</a> because a <code>dataclass</code> decorator was incorrectly applied to an <code>Enum</code>:</p>
<pre><code class="language-python">@dataclass
class Audio(Enum):
    NoAudio = 'No audio server'
    Pipewire = 'pipewire'
    ...
</code></pre>
<p>The <a href="https://docs.python.org/3/howto/enum.html#dataclass-support">Python docs</a> warn about such usage, but I am not aware of any linter that currently catches the error:</p>
<blockquote>
<p>Adding dataclass() decorator to Enum and its subclasses is not supported. It will not raise any errors, but it will produce very strange results at runtime, such as members being equal to each other</p>
</blockquote>
<p>Note: The docs mention that dataclass mixins can be used with enums, so there are some valid combinations of the constructs.</p>
<h3>Related discussions</h3>
<ul>
<li>https://github.com/python/cpython/issues/114803</li>
<li>https://github.com/python/cpython/pull/114891</li>
</ul>
<h3>Documentation</h3>
<ul>
<li>https://docs.python.org/3/howto/enum.html#dataclass-support</li>
</ul>
<h3>Real world bugs</h3>
<ul>
<li>https://github.com/archlinux/archinstall/pull/3058</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-05 21:45</div>
            <div class="timeline-body"><p>There do seem to be <a href="https://sourcegraph.com/search?q=context:global+%40%28%3F:dataclasses%5C.%29%3Fdataclass%5Cn%5B+%5Ct%5D*class%5Cs%2B%5Cw%2B%5C%28%5B%5E%28%29%5D*Enum%5Cb&amp;patternType=regexp&amp;case=yes&amp;sm=0">quite a few bugs</a> of this pattern.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-06 08:59</div>
            <div class="timeline-body"><p>Thanks, this makes sense to me</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-01-06 08:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @MichaReiser on 2025-01-06 08:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-01-06 13:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:55 UTC
    </footer>
</body>
</html>
