<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E252: false positive with TypeVarDefault [PEP696] [preview] - astral-sh/ruff #21066</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>E252: false positive with TypeVarDefault [PEP696] [preview]</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/21066">#21066</a>
        opened by <a href="https://github.com/randolf-scholz">@randolf-scholz</a>
        on 2025-10-24 16:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-10-24 16:52</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>https://play.ruff.rs/7a92d282-f540-41cb-83f1-01fc0f33422e</p>
<pre><code class="language-python">def foo[T=int]() -&gt; None: ...
# E252 [*] Missing whitespace around parameter equals
</code></pre>
<p>However, one would expect for <a href="https://docs.astral.sh/ruff/rules/missing-whitespace-around-parameter-equals/">E252</a> that the same rules that apply to regular function arguments also apply to TypeVars, that is:</p>
<pre><code class="language-python">def foo[T=int]() -&gt; None: ... # without upper bound
def bar[T: object = int]() -&gt; None: ... # with upper bound
</code></pre>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-10-24 19:19</div>
            <div class="timeline-body"><p>I personally kind of prefer the space, and it's consistent with our formatter (as noted in your other issue, https://github.com/astral-sh/ruff/issues/18746). I also think we agree with pycodestyle here:</p>
<pre><code class="language-shell">&gt; pycodestyle - &lt;&lt;EOF
def foo[T=int]() -&gt; None: ... # without upper bound
def bar[T: object = int]() -&gt; None: ... # with upper bound
EOF
stdin:1:10: E225 missing whitespace around operator
stdin:1:10: E252 missing whitespace around parameter equals
stdin:1:11: E252 missing whitespace around parameter equals
stdin:1:30: E261 at least two spaces before inline comment
stdin:2:40: E261 at least two spaces before inline comment
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ntBre on 2025-10-24 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-10-25 08:39</div>
            <div class="timeline-body"><p>It seems that behavior was introduced in pycodestyle by https://github.com/PyCQA/pycodestyle/commit/8621e318655267c2a6cfa15bfd3f7cc02a60881f without any discussion. As I explained in the other PR, I find this confusing, because it differs from the spacing rules of regular function arguments, and it eats up valuable space without - in my opinion - improving readability.</p>
<p>Especially when you have multiple overloads, readability degradates a lot when they no longer fit on a single line, as I explained in the other issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-10-25 08:42</div>
            <div class="timeline-body"><p>And if I disable E252, it no longer reports errors for regular function parameters!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-27 08:36</div>
            <div class="timeline-body"><p>I don't think I follow the consistency argument between type vars and function arguments.</p>
<pre><code class="language-py">def foo[T=int]() -&gt; None: ... # without upper bound
def bar[T: object = int]() -&gt; None: ... # with upper bound


def foo(a: T = 4): ...
</code></pre>
<p>This seems consistent to me: Ruff enforces a space before and after the <code>=</code> following a type (annotation).</p>
<p>Which follows PEP8</p>
<blockquote>
<p>When combining an argument annotation with a default value, however, do use spaces around the = sign:</p>
<pre><code class="language-py"># Correct:
def munge(sep: AnyStr = None): ...
def munge(input: AnyStr, sep: AnyStr = None, limit=1000): ...
</code></pre>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-10-27 09:45</div>
            <div class="timeline-body"><p>@MichaReiser For regular function parameters spaces are omitted for default values, unless there is a type annotation, e.g.</p>
<pre><code class="language-python">def munge(input: AnyStr, sep: AnyStr = None, limit=1000): ...
</code></pre>
<p>rather than</p>
<pre><code class="language-python">def munge(input: AnyStr, sep: AnyStr = None, limit = 1000): ...
</code></pre>
<p>I'm saying that one would expect the same for type-parameters, so for a type-var with default, but without upper bound:</p>
<pre><code class="language-python">def foo[X=int](): ...
</code></pre>
<p>rather than</p>
<pre><code class="language-python">def foo[X = int](): ...
</code></pre>
<p>Both E252 and the ruff formatter want the version with spaces here. The maintainers of <code>pycodestyle</code> base this decision on how the code was presented in PEP696, but that PEP doesn't make any explicit style recommendations.</p>
<p>Personally, I strongly prefer <code>=</code> without spaces in this context, for the same reason we use <code>=</code> without spaces for un-annotated function parameters. It is visually more clear and saves horizontal space. So I'd love to be able to globally disable E252 for type-parameters (but not the other uses of E252).</p>
<p>Does ruff support sub-error codes? (like E252a, E252b, etc?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-27 09:53</div>
            <div class="timeline-body"><p>I see. I don't think there's much to argue other than preferences differ :)</p>
<blockquote>
<p>Does ruff support sub-error codes? (like E252a, E252b, etc?)</p>
</blockquote>
<p>No, I also don't think it should. Rule selection is already a very hard problem</p>
<p>I think there's an argument that it should be a separate rule:</p>
<blockquote>
<p>Checks for missing whitespace around the equals sign in an annotated function keyword parameter.</p>
</blockquote>
<p>Or we should update the rule documentation.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
