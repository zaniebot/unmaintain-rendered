<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: wrap comments (`E501`) - astral-sh/ruff #7414</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: wrap comments (<code>E501</code>)</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7414">#7414</a>
        opened by <a href="https://github.com/kdeldycke">@kdeldycke</a>
        on 2023-09-15 18:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kdeldycke">@kdeldycke</a></div>
            <div class="timeline-body"><p>Playing with the beta formatter, I was curious why it did not wrap long comments.</p>
<p>See the following <code>long.py</code> file:</p>
<pre><code class="language-python">def test():
    # This is a very very very very very very very very very very very very very very very very very long comment.
    pass
</code></pre>
<p>Running the latest <code>ruff</code> version, the file is left unchanged, while I expected the long comment line to be wrapped:</p>
<pre><code class="language-shell-session">$ ruff --version
ruff 0.0.289

$ ruff format ./long.py
warning: `ruff format` is a work-in-progress, subject to change at any time, and intended only for experimentation.
1 file left unchanged
</code></pre>
<p>I then realized that <a href="https://github.com/psf/black/issues/181#issuecomment-385326100">Black itself doesn't format comments</a>. Even in its last iteration:</p>
<pre><code class="language-shell-session">$ black --version
black, 23.9.1 (compiled: yes)
Python (CPython) 3.11.5

$ black --preview ./long.py
All done! ‚ú® üç∞ ‚ú®
1 file left unchanged.
</code></pre>
<p>Wrapping comments would be a nice quality of life improvement to auto-fix a number of <code>E501</code> rule violations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kdeldycke">@kdeldycke</a> on 2023-09-15 18:16</div>
            <div class="timeline-body"><p>Possibly related issues:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/7361</li>
<li>https://github.com/astral-sh/ruff/issues/5630</li>
<li>https://github.com/astral-sh/ruff/issues/3894</li>
<li>https://github.com/astral-sh/ruff/issues/1904#issuecomment-1671613520</li>
<li>https://github.com/astral-sh/ruff/issues/4595</li>
<li>https://github.com/astral-sh/ruff/issues/6269</li>
<li>https://github.com/astral-sh/ruff/issues/7400</li>
<li>https://github.com/astral-sh/ruff/issues/1904</li>
<li>https://github.com/astral-sh/ruff/issues/2402</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-15 18:17</div>
            <div class="timeline-body"><p>Hey @kdeldycke ‚Äî I think there are some fair concerns raised in the Black issue but thanks for starting the discussion!</p>
<p>Out of curiosity, would docstring formatting resolve most of your needs here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kdeldycke">@kdeldycke</a> on 2023-09-15 18:28</div>
            <div class="timeline-body"><p>In the mean time, <code>autopep8</code> is supporting comment wrapping. You can perform this task and this only with the following one-liner:</p>
<pre><code class="language-shell-session">$ autopep8 --in-place --max-line-length 88 --select E501 --aggressive ./long.py
</code></pre>
<pre><code class="language-shell-session">$ cat ./long.py
</code></pre>
<pre><code class="language-python">def test():
    # This is a very very very very very very very very very very very very
    # very very very very very long comment.
    pass
</code></pre>
<pre><code class="language-shell-session">$ autopep8 --version
autopep8 2.0.4 (pycodestyle: 2.11.0)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kdeldycke">@kdeldycke</a> on 2023-09-15 18:38</div>
            <div class="timeline-body"><blockquote>
<p>Hey @kdeldycke ‚Äî I think there are some fair concerns raised in the Black issue but thanks for starting the discussion!</p>
</blockquote>
<p>Oh yes. I'm just starting to understand the complexity of the issue. It's hard to generalize comment autoformat. Especially because of the line-dependency of <code># pragma</code> kind of comments. I haven't looked into ruff code so I have no idea how hard and how feasible is it to handle these two situations.</p>
<blockquote>
<p>Out of curiosity, would docstring formatting resolve most of your needs here?</p>
</blockquote>
<p>Oh you mean moving this long comment into a docstring? On paper yes. And yes, I guess when comments become that long, it is time to consider moving them into your function's docstring.</p>
<p>I still have the case in which I need long comments: to not have them appears in the auto-generated Sphinx documentation. I have some places in my code where I need long explanation of implementation details, but don't want to distract the user of my library with these implementation details in the top-level documentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: wrap comments" to "Formatter: wrap comments (`E501`)" by @kdeldycke on 2023-09-15 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @charliermarsh on 2023-09-18 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2023-09-18 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2024-03-12 10:13</div>
            <div class="timeline-body"><p>I've just come across this again and wanted to throw in something for consideration if this gets implemented...</p>
<p>Some directives in Sphinx, e.g. <a href="https://www.sphinx-doc.org/en/master/usage/extensions/autodoc.html#directive-autodata"><code>autodata</code></a>, have a special comment notation to indicate that the comment should be used for documentation, e.g.</p>
<pre><code class="language-python">#: A generic type variable.
T = TypeVar(&quot;T&quot;)
</code></pre>
<p>It would be nice to preserve the correct comment marker when wrapping, i.e. the following:</p>
<pre><code class="language-python">#: This is a very very very very very very very very very very very very very very very very very long comment.
MAGIC_NUMBER = 123
</code></pre>
<p>...after formatting would produce:</p>
<pre><code class="language-python">#: This is a very very very very very very very very very very very very very very very
#: very very long comment.
MAGIC_NUMBER = 123
</code></pre>
<p>...and not this:</p>
<pre><code class="language-python">#: This is a very very very very very very very very very very very very very very very
# very very long comment.
MAGIC_NUMBER = 123
</code></pre>
<p>Another thing for consideration might be what happens with comment tags, as defined in <code>lint.task-tags</code>. How should these wrap?</p>
<p>Like this?</p>
<pre><code class="language-python"># TODO: This is a very very very very very very very very very very very very very very
# very very very long comment.
</code></pre>
<p>Or like this? <em>(Which I personally like...)</em></p>
<pre><code class="language-python"># TODO: This is a very very very very very very very very very very very very very very
#       very very very long comment.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/skyfenton">@skyfenton</a> on 2025-04-03 22:18</div>
            <div class="timeline-body"><p>+1 on this, using yet another VS Code extension (Rewrap) to handle this doesn't always fix up paragraphs correctly :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/real-or-random">@real-or-random</a> on 2025-04-04 06:36</div>
            <div class="timeline-body"><p>I think if this is ever implemented, it should have a separate configurable line length because <a href="https://peps.python.org/pep-0008/#maximum-line-length">PEP8</a> suggests different line lengths for code and comments/docstrings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rudy-lath-vizio">@rudy-lath-vizio</a> on 2025-04-22 15:38</div>
            <div class="timeline-body"><p>+1 This would be a godsent feature</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/swirle13">@swirle13</a> on 2025-05-02 21:29</div>
            <div class="timeline-body"><blockquote>
<p>I think if this is ever implemented, it should have a separate configurable line length because <a href="https://peps.python.org/pep-0008/#maximum-line-length">PEP8</a> suggests different line lengths for code and comments/docstrings.</p>
</blockquote>
<p>Found this issue due to looking into exactly this, using Ruff. I'm wrapping up defining a team/project coding standards doc and used as much of PEP8 and Google Python style guide. I'm using as many tools to automate the enforcement of our coding standards, but I couldn't find a way to check/force comment line lengths separately from code. I was hoping to enforce with Ruff a max line length for any code to 88 chars and autoformat comments that exceed 72 lines, per PEP8.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-05-02 21:53</div>
            <div class="timeline-body"><p>On the subject of autopep8, I'll share this list I made comparing parity with it: https://github.com/astral-sh/ruff/discussions/9057#discussioncomment-7850584 (of course <code>E501</code> isn't checked)</p>
<p>I think it would be fair for an <code>E501</code> autofix to always be marked as <code>unsafe</code> (since it really depends on human intentions).
And to always ignore lines with special comments that Ruff cares to identify (<code>noqa:</code>, <code>type:</code>, <code>ruff:</code>, <code>isort:</code>, etc.)</p>
<p>For more prior art, <code>clang-format</code> can also be looked at.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:22 UTC
    </footer>
</body>
</html>
