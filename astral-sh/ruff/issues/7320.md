```yaml
number: 7320
title: "Formatter undocumented deviation: remove parenthesis"
type: issue
state: closed
author: JonathanPlasse
labels:
  - documentation
  - formatter
assignees: []
created_at: 2023-09-12T21:09:13Z
updated_at: 2023-09-29T17:27:33Z
url: https://github.com/astral-sh/ruff/issues/7320
synced_at: 2026-01-10T01:56:49Z
```

# Formatter undocumented deviation: remove parenthesis

---

_Issue opened by @JonathanPlasse on 2023-09-12 21:09_

<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->
Black formatting
```python
def update_emission_strength(self: "Lightshow", context: bpy.types.Context) -> None:  # noqa: ARG001
    (
        get_rgbw_emission_node_tree(self)
        .nodes["Emission"]
        .inputs["Strength"]
        .default_value  # pyright: ignore
    ) = (self.emission_strength * 2)
```
Ruff formatting
```python
def update_emission_strength(self: "Lightshow", context: bpy.types.Context) -> None:  # noqa: ARG001
    (
        get_rgbw_emission_node_tree(self).nodes["Emission"].inputs["Strength"].default_value  # pyright: ignore
    ) = self.emission_strength * 2
```
Ruff 0.0.289, line-length 100

The pragma deviation is documented, but not the removal of parenthesis.

I prefer the Ruff formatting.

---

_Comment by @MichaReiser on 2023-09-13 06:28_

There are two differences here:

1. Ruff splits the call chain differently because of the `pyright: ignore` comment. I think the current formatting is fine because enforcing black's layout can be wrong if you intend to document the whole call chain (and not just the last attribute). 
2. Black seems to parenthesize the right if the assignment target doesn't fit, regardless of whether the assigned value was parenthesized before. Adding these parentheses seems unnecessary in my view. 


```python
# Blacked code

def update_emission_strength():
    (
        get_rgbw_emission_node_tree(self)
        .nodes["Emission"]
        .inputs["Strength"]
        .default_value  # pyright: ignore
    ) = (self.emission_strength * 2)

    (
        get_rgbw_emission_node_tree(self)
        .nodes["Emission"]
        .inputs["Strength"]
        .default_value  # pyright: ignore
    ) = (self.emission_strength * 2)


def update_emission_strength():
    (get_rgbw_emission_node_tree(self).nodes["Emission"].default_value) = self.emission_strength * 2


def update_emission_strength():
    (get_rgbw_emission_node_tree(self).nodes["Emission"].default_valueeeeeeeeeeeeee) = (
        self.emission_strength * 2
    )


def update_emission_strength():
    (get_rgbw_emission_node_tree(self).nodes["Emission"].default_valueeeeeeeeeeeeee) = (
        self.emission_strength * 2
    )


def update_emission_strength():
    (
        get_rgbw_emission_node_tree(self)
        .nodes["Emission"]
        .default_valueeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
    ) = (self.emission_strength * 2)

```

---

_Label `wontfix` added by @MichaReiser on 2023-09-13 06:28_

---

_Label `formatter` added by @MichaReiser on 2023-09-13 06:28_

---

_Added to milestone `Formatter: Beta` by @MichaReiser on 2023-09-13 06:29_

---

_Comment by @charliermarsh on 2023-09-27 15:34_

The parentheses we're considering an intentional deviation. Can be closed once it's documented.

The comment positioning deviation is expected because we ignore suppression comments when computing line length. (If you change it to some other comment, we use the same formatting as Black, apart from the extra parentheses on the RHS.) We're not planning to change this for the Beta, but we'll revisit based on feedback around suppression comment handling more generally.


---

_Assigned to @charliermarsh by @charliermarsh on 2023-09-27 18:45_

---

_Referenced in [astral-sh/ruff#7679](../../astral-sh/ruff/pulls/7679.md) on 2023-09-27 20:18_

---

_Label `wontfix` removed by @MichaReiser on 2023-09-28 09:44_

---

_Label `documentation` added by @MichaReiser on 2023-09-28 09:44_

---

_Closed by @charliermarsh on 2023-09-29 17:27_

---
