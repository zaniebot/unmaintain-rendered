<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invalid syntax error location for Notebook with `ruff format` - astral-sh/ruff #11453</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Invalid syntax error location for Notebook with `ruff format`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/11453">#11453</a>
        opened by <a href="https://github.com/david-waterworth">@david-waterworth</a>
        on 2024-05-16 23:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-05-16 23:52</div>
            <div class="timeline-body"><p>I'm getting the error <code>error: Failed to parse notebooks/tickets v2.ipynb:1:1:5: Invalid decimal integer literal</code> when I run <code>ruff format .</code> on a project (previously I was using whatever the default vscode formatter is).</p>
<p>I assume the :1:1:5 is a reference to a cell but I cannot parse it, does that mean cell 1, line 1 column 5? And is it 0 or 1 based - either way the message doesn't help as the first cell contains</p>
<pre><code>%load_ext autoreload
%autoreload 2
</code></pre>
<p>and the second</p>
<pre><code>from datetime import datetime, timezone
...
</code></pre>
<p>Also <code>pre-commit</code> doesn't seem to complain, not does <code>format on save</code> (vscode setting) which I've configured to use Ruff as the default formatter, it's only when I try and format from the cmd line. I tried escaping the space with <code>\ </code> and surrounding the filename with &quot; &quot;</p>
<p>I'm using ruff 0.4.4 (global pipx installation) and my settings are:</p>
<pre><code>[tool.ruff]
extend-include = [&quot;*.ipynb&quot;]

# Same as Black.
line-length = 120
lint.ignore-init-module-imports = true

exclude = []
lint.select = [
    &quot;E&quot;,  # pycodestyle errors (settings from FastAPI, thanks, @tiangolo!)
    &quot;W&quot;,  # pycodestyle warnings
    &quot;F&quot;,  # pyflakes
    &quot;I&quot;,  # isort
    &quot;C&quot;,  # flake8-comprehensions
    &quot;B&quot;,  # flake8-bugbear
]
lint.ignore = [
    &quot;E501&quot;,  # line too long, handled by black
    &quot;C901&quot;,  # too complex
]
lint.per-file-ignores = { &quot;*.ipynb&quot; = [&quot;E402&quot;, &quot;F704&quot;, &quot;B018&quot;] }

[tool.ruff.lint.isort]
order-by-type = true
relative-imports-order = &quot;closest-to-furthest&quot;
extra-standard-library = [&quot;typing&quot;]
section-order = [&quot;future&quot;, &quot;standard-library&quot;, &quot;third-party&quot;, &quot;first-party&quot;, &quot;local-folder&quot;]
known-first-party = []

[tool.ruff.format]
quote-style = &quot;double&quot;
indent-style = &quot;space&quot;
skip-magic-trailing-comma = false
line-ending = &quot;auto&quot;
docstring-code-format = true
docstring-code-line-length = &quot;dynamic&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-17 03:19</div>
            <div class="timeline-body"><p>Are you able to share the raw notebook file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @charliermarsh on 2024-05-17 03:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-05-17 04:17</div>
            <div class="timeline-body"><p>I figured it out, right down the bottom there was as cell I missed containing</p>
<pre><code>559/02408930-81c7-47d7-b2b0-ee38cb3f6e62
</code></pre>
<p>Which is clearly invalid - it's actually a fragment of a uri I added at some stage to test something and I should have set the cell to markdown or commented it out. The linter was flagging as an error, I guess the only real issue is the message is a bit cryptic, ideally <code>ruff format</code> would report the cell number at least, and maybe that this is a linter error - the image below shows what ruff reports in the &quot;Problems&quot; panel of vscode but <code>ruff format</code> is leaving out some context (also the message below doesn't include the cell number)</p>
<p><img src="https://github.com/astral-sh/ruff/assets/5028974/0c8f53c8-9e84-43bb-9611-e7b8dfc8df87" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-17 06:31</div>
            <div class="timeline-body"><p>Thanks for the details. So, yeah the <code>ruff format</code> command does not include the cell details while the <code>ruff check</code> command does:</p>
<pre><code>error: Failed to parse notebooks/syntax_error.ipynb:4:1:5: Invalid decimal integer literal
</code></pre>
<p>I can look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by @dhruvmanila on 2024-05-17 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">notebook</span> added by @dhruvmanila on 2024-05-17 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @dhruvmanila on 2024-05-17 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @dhruvmanila on 2024-05-17 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "error: Failed to parse notebook Invalid decimal integer literal" to "Invalid syntax error location for Notebook with `ruff format`" by @dhruvmanila on 2024-05-17 06:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> removed by @dhruvmanila on 2024-05-17 06:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2024-05-17 06:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-05-17 06:51</div>
            <div class="timeline-body"><p>Note the <code>ruff check</code> command isn't really including the cell details either - see below, it has line and column number but not cell number. It works in the vscode &quot;Problems&quot; panel because it's linked, i.e. I can click on the message and it'll jump to the correct cell but the message itself would ideally also contain the cell number (i.e. the first message should have suffix [Cell 24, Line 2, Col 28] if that's possible</p>
<p><img src="https://github.com/astral-sh/ruff/assets/5028974/48a61b05-c979-49ee-893c-c5bdca8b6c61" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-17 07:16</div>
            <div class="timeline-body"><p>I meant that the output in the CLI does provide the correct cell number:</p>
<pre><code class="language-console">$ ruff check ~/playground/ruff/notebooks/syntax_error.ipynb 
error: Failed to parse /Users/dhruv/playground/ruff/notebooks/syntax_error.ipynb:4:1:5: Invalid decimal integer literal
/Users/dhruv/playground/ruff/notebooks/syntax_error.ipynb:cell 4:1:5: E999 SyntaxError: Invalid decimal integer literal
</code></pre>
<p>Regarding the VS Code problems tab, I don't know if that's even possible. I'll need to look into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-05-17 07:47</div>
            <div class="timeline-body"><p>Ah right yeah, I don't think it's an issue in the vs code tab, as I mentioned you can click to jump to the problem anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11456.html">astral-sh/ruff#11456</a> on 2024-05-17 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16499.html">astral-sh/ruff#16499</a> on 2025-03-04 15:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-03-04 17:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
