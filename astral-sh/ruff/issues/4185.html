<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change CLI to respect `Applicability` - astral-sh/ruff #4185</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Change CLI to respect <code>Applicability</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4185">#4185</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-05-02 09:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-05-02 09:24</div>
            <div class="timeline-body"><p>This task is part of #4181 and depends on #4183. The goal is to change the CLI to respect the <code>Fix::applicability</code>.</p>
<ul>
<li>Change <code>--fix</code> to only apply <code>Applicability::Safe</code> fixes. Print a message with the number of fixes that were skipped because they have an <code>Applicability</code> other than <code>Safe</code> and print the number at the end.</li>
<li>Add a new <code>--fix-unsafe</code> CLI option that applies all fixes</li>
<li>Change <code>--diff</code> and <code>--fix-only</code> to imply <code>--fix</code> but runs all fixes if the user also provides <code>--fix-unsafe</code>.</li>
</ul>
<h2>Considerations</h2>
<ul>
<li>We may want to hold off with this change until we've categorized a significant part of the fixes (see #4184).</li>
<li>I recommend introducing a new <code>--fix-unsafe</code> to apply unsafe fixes of past experience at Rome. Rome used to apply all fixes with <code>--fix</code> but we got multiple reports from users that they did not expect Rome to make changes that may change the program's semantic. That's why we decided to rename the CLI option to <code>--apply</code> and <code>--apply-unsafe</code> to make it clear, that the latter applies fixes that may be incorrect. The downside of not running all fixes with <code>--fix</code> is that I expect that some users may be confused why ruff doesn't apply all fixes when running <code>--fix</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by @MichaReiser on 2023-05-02 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2023-05-02 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2023-05-02 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-19 17:55</div>
            <div class="timeline-body"><p>Are <code>Applicability::Manual</code> fixes included with <code>--fix-unsafe</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-05-19 19:15</div>
            <div class="timeline-body"><blockquote>
<p>Are <code>Applicability::Manual</code> fixes included with <code>--fix-unsafe</code>?</p>
</blockquote>
<p>No. Manual fixes are never applied automatically. Similar to clippy when it tells you to use a if let chain instead of match</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanrittenhouse">@evanrittenhouse</a> on 2023-06-14 13:11</div>
            <div class="timeline-body"><p>You can assign this to me - seems like there have been several rules that have already been categorized, so there's at least a good sample size to test with. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @evanrittenhouse by @charliermarsh on 2023-06-14 14:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-03 14:21</div>
            <div class="timeline-body"><p>design discussion: #5476</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2023-10-06 03:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:58 UTC
    </footer>
</body>
</html>
