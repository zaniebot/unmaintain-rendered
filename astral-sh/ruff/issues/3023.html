<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request: rewrite compound context managers (nested `with` blocks) - astral-sh/ruff #3023</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Request: rewrite compound context managers (nested `with` blocks)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/3023">#3023</a>
        opened by <a href="https://github.com/thatlittleboy">@thatlittleboy</a>
        on 2023-02-19 01:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thatlittleboy">@thatlittleboy</a> on 2023-02-19 01:11</div>
            <div class="timeline-body"><p>Since python 3.10+, <a href="https://docs.python.org/3.10/whatsnew/3.10.html#parenthesized-context-managers">parenthesized context managers</a> is supported as well. It would be nice to have a <code>ruff</code> rule to promote the use of this new syntax because of fewer levels of indentation.</p>
<p>Note that both sync and async versions of <code>with</code> are supported here (it's not clearly mentioned in the docs, but this is true).</p>
<pre><code class="language-python"># or `async with`
with A() as a:
    with a.B() as b:
        pass
</code></pre>
<p>is semantically equivalent to</p>
<pre><code class="language-python"># or `async with`
with (
    A() as a,
    a.B() as b,
):
    pass
</code></pre>
<p>I suppose we could also support this new syntax in the case where the two context managers ` are independent (e.g. for long context manager definitions that need to be split across multiple lines).</p>
<p>The async scenario happens very frequently when <a href="https://github.com/aio-libs/aiohttp#client">using <code>aiohttp</code></a>, for example.</p>
<hr />
<p>Somewhat related rule: SIM117 (already implemented)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thatlittleboy">@thatlittleboy</a> on 2023-02-19 08:00</div>
            <div class="timeline-body"><p>Sorry, I just realized my request here doesn't really make sense. Apologies for the noise. I'll rewrite and open up a separate issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @thatlittleboy on 2023-02-19 08:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
