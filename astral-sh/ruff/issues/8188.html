<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unintentional formatter deviation: strange spacing around `TypeAlias` declarations - astral-sh/ruff #8188</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Unintentional formatter deviation: strange spacing around `TypeAlias` declarations</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8188">#8188</a>
        opened by <a href="https://github.com/stinodego">@stinodego</a>
        on 2023-10-24 22:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/stinodego">@stinodego</a> on 2023-10-24 22:10</div>
            <div class="timeline-body"><p>Reproducible example:</p>
<pre><code class="language-python">from typing import TypeAlias

MultiColSelector: TypeAlias = (
    &quot;slice | range | list[int] | list[str] | list[bool] | Series&quot;
)
</code></pre>
<p>black leaves this alone, while ruff formats it as follows:</p>
<pre><code class="language-diff">- MultiColSelector: TypeAlias = (
-     &quot;slice | range | list[int] | list[str] | list[bool] | Series&quot;
- )
+ MultiColSelector: (
+     TypeAlias
+ ) = &quot;slice | range | list[int] | list[str] | list[bool] | Series&quot;
</code></pre>
<p>This looks like an undesirable change to me.</p>
<p>In our code base, I worked around this by rewriting the string as a <code>Union</code> of types.</p>
<p>Command: <code>ruff format .</code>
Formatter settings: None
Version: ruff <code>0.1.2</code></p>
<p><em>P.S.: Other than the two minor issues I just reported, the new ruff formatter is working excellently. It has improved formatting in quite a few cases. Thank you for the amazing work!</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-24 23:47</div>
            <div class="timeline-body"><p>Thank's for reporting and thank you for the kind words.</p>
<p>This deviation is documented as <a href="https://docs.astral.sh/ruff/formatter/black/#type-annotations-may-be-parenthesized-when-expanded">type annotations may be parenthesized</a> and is related to <a href="https://github.com/astral-sh/ruff/issues/7315">7315</a>.</p>
<p>Let's keep this issue open to collect some more feedback as I can see that the formatting in this case is not ideal. I also want to re-test if implementing https://github.com/astral-sh/ruff/issues/6975 (preview style) will make fixing it obsolete.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-10-24 23:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2023-10-24 23:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Stable" by @MichaReiser on 2023-10-24 23:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8233.html">astral-sh/ruff#8233</a> on 2023-10-25 23:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8226.html">astral-sh/ruff#8226</a> on 2023-10-26 00:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-10-26 02:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-10-26 13:57</div>
            <div class="timeline-body"><p>AFAICT, the rule should be that type annotations are only parenthesized if the type annotation itself is long. It should never parenthesize a type annotation to make something after the equals sign have more space.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-26 15:11</div>
            <div class="timeline-body"><p>We ended up reverting this decision (so we no longer have this Black deviation). Once we implement preview style, we should have roughly the behavior you describe.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Toufool/AutoSplit/pulls/259.html">Toufool/AutoSplit#259</a> on 2023-10-27 14:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
