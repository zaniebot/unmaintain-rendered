<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“‹ Formatter: Syntax Formatting - astral-sh/ruff #4798</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ðŸ“‹ Formatter: Syntax Formatting</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4798">#4798</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2023-06-02 06:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>This task coordinates the work on implementing formatting for the Python syntax.</p>
<p>Please create an issue and comment that you intend to work on before starting a new syntax. This allows us to better coordinate the work.</p>
<h2>Module</h2>
<ul>
<li>[x] #4800</li>
<li>[ ] Formatter: <code>Interactive</code></li>
<li>[x] Formatter: <code>Expression</code> https://github.com/astral-sh/ruff/pull/5689</li>
<li>[ ] Formatter: <code>FunctionType</code></li>
</ul>
<blockquote>
<p><em>Note</em>: Our infrastructure only supports testing <code>Module</code>. We should, therefore, wait to implement the other variants.</p>
</blockquote>
<h2>Statements</h2>
<ul>
<li>[x] #4799</li>
<li>[x] #4955</li>
<li>[x] Formatter: <code>Return</code> (#4960)</li>
<li>[x] #5287</li>
<li>[x] Formatter: <code>Assign</code> (basic implementation done, missing is wrapping the left hand side like black which is hard)</li>
<li>[x] Formatter: <code>AugAssign</code> https://github.com/astral-sh/ruff/pull/5655</li>
<li>[x] #5662</li>
<li>[x] #5288</li>
<li>[x] #4806</li>
<li>[x] #4956</li>
<li>[x] #5368</li>
<li>[x] #5834</li>
<li>[x] #5595</li>
<li>[x] #5245</li>
<li>[x] Formatter: <code>Assert</code> (https://github.com/astral-sh/ruff/pull/5168)</li>
<li>[x] Formatter: <code>Import </code> https://github.com/astral-sh/ruff/pull/5493</li>
<li>[x] Formatter: <code>ImportFrom</code> (includes <code>Alias</code>) https://github.com/astral-sh/ruff/pull/5493</li>
<li>[x] Formatter: <code>Global</code> https://github.com/astral-sh/ruff/pull/6170 (deviation from black: break over multiple lines if it exceeds the line-width https://github.com/psf/black/issues/1357)</li>
<li>[x] Formatter: <code>Nonlocal</code> https://github.com/astral-sh/ruff/pull/6170 (deviation from black: break over multiple lines if it exceeds the line-width https://github.com/psf/black/issues/1357)</li>
<li>[x] Formatter: <code>Expr</code> #4788</li>
<li>[x] Formatter: <code>Pass</code> (#4959)</li>
<li>[x] Formatter: <code>Break</code></li>
<li>[x] Formatter: <code>Continue</code></li>
<li>[ ] #5929 (https://github.com/astral-sh/ruff/pull/6161, https://github.com/astral-sh/ruff/pull/6162)</li>
</ul>
<h2>Expressions</h2>
<ul>
<li>[x] #4962</li>
<li>[x] Formatter: <code>NamedExpr</code> https://github.com/astral-sh/ruff/issues/5613</li>
<li>[x] #4896</li>
<li>[x] #5216</li>
<li>[x] #5826</li>
<li>[x] Formatter: <code>IfExp</code> https://github.com/astral-sh/ruff/pull/5597</li>
<li>[x] #5206</li>
<li>[x] Formatter: <code>Set</code></li>
<li>[x] #5600</li>
<li>[x] #5674</li>
<li>[x] #5778</li>
<li>[x] #5676</li>
<li>[x] Formatter: <code>Await</code></li>
<li>[x] #5916</li>
<li>[x] #5242</li>
<li>[ ] Formatter: <code>Call</code> (https://github.com/astral-sh/ruff/pull/5341, https://github.com/astral-sh/ruff/issues/5343)</li>
<li>[x] #5913</li>
<li>[ ] Formatter: <code>Constant</code> (#4954)<ul>
<li>[x] #5294</li>
<li>[ ] #6064 (https://github.com/astral-sh/ruff/pull/6166)</li>
<li>[x] Tuple constant formatting</li>
<li>[x] Float constant formatting  #5972</li>
<li>[x] Int constant formatting  #5972</li>
<li>[x] Complex constant formatting  #5972</li>
<li>[x] Bool constant (good first issue)</li>
<li>[x] Ellipsis constant (good first issue)</li>
<li>[x] None constant (good first issue)</li>
</ul>
</li>
<li>[x] #5257 (https://github.com/astral-sh/ruff/issues/5343)</li>
<li>[x] #5286</li>
<li>[x] #5650</li>
<li>[x] #4802</li>
<li>[x] Formatter: <code>List</code> (https://github.com/astral-sh/ruff/pull/4862)</li>
<li>[x] Formatter: <code>Tuple</code> (#4963)</li>
<li>[x] Formatter: <code>Slice</code> (https://github.com/astral-sh/ruff/pull/5047)</li>
</ul>
<h2>Improvements</h2>
<ul>
<li>[x] #5779</li>
<li>[x] #5780</li>
<li>[x] #5781</li>
</ul>
<h2>Cross-cutting</h2>
<ul>
<li>[x] #5671</li>
<li>[x] #4801</li>
<li>[x] #6196</li>
<li>[x] #5336</li>
<li>[x] #6197</li>
<li>[x] #5326</li>
<li>[ ] Decide on trailing comments formatting https://github.com/astral-sh/ruff/pull/5353</li>
</ul>
<h2>Bugs</h2>
<p>See <a href="https://github.com/astral-sh/ruff/issues?q=is%3Aopen+is%3Aissue+label%3Abug+label%3Aformatter">open issues</a></p>
<h2>Notes</h2>
<p>https://github.com/charliermarsh/ruff/pull/4730 removed the prototype from @charliermarsh. It's worth taking a look at it when implementing new formatting because it already formatted a lot of syntaxes correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autoformatter</span> added by @MichaReiser on 2023-06-02 06:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2023-06-02 06:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @konstin by @MichaReiser on 2023-06-02 06:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-06-02 06:31</div>
            <div class="timeline-body"><p><code>Alilas</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-02 06:35</div>
            <div class="timeline-body"><blockquote>
<p><code>Alilas</code>?</p>
</blockquote>
<p>It seems to be used in <code>ImportFrom</code>. I moved it to <code>ImportFrom</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-05 17:27</div>
            <div class="timeline-body"><p>If someone's interested in familiarizing themselves with the formatter API, then the following are probably good starters:</p>
<ul>
<li><code>Pass</code>, <code>Break</code>, and <code>Continue</code>: I don't expect this to change the formatter output (also because we only support formatting <code>while</code> statements) but you can see how the IR and <code>write</code> macro work</li>
<li><code>Constant::None</code> and <code>Bool</code>: Same as for <code>Pass</code>...</li>
<li><code>Constant::Ellipsis</code>: this should be easy, but I believe black removes ellipsis sometimes. It would be good to understand when this is the case. We don't necessarily have to implement it in the first PR</li>
<li>nolocal and global</li>
<li>These may be good starts, but could also be difficult.<ul>
<li><code>UnaryOp</code></li>
<li><code>Await</code></li>
<li><code>YieldFrom</code></li>
<li><code>Return</code></li>
<li><code>Raise</code></li>
<li><code>Assert</code></li>
<li><code>Delete</code></li>
</ul>
</li>
</ul>
<p>Let me know if you're interested.</p>
<p>For testing. We have tests that automatically compare our output with black's output. You can run them with <code>cargo test</code> and review the changes with <code>cargo insta review</code>. You can also add your own tests by adding a file to <code>crates/ruff_python_formatter/resources/test/fixtures/ruff</code> (it may sometimes be necessary to run a <code>cargo clean</code> in case your test doesn't get picked up)</p>
<p>What's worth testing:</p>
<ul>
<li>Comments in all possible positions :D</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2023-06-05 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/addisoncrump">@addisoncrump</a> on 2023-06-06 07:53</div>
            <div class="timeline-body"><p>Is the goal here to reach parity with black?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-06 07:58</div>
            <div class="timeline-body"><blockquote>
<p>Is the goal here to reach parity with black?</p>
</blockquote>
<p>The goal is to be black-compatible except for pathological cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/addisoncrump">@addisoncrump</a> on 2023-06-06 08:01</div>
            <div class="timeline-body"><p>Okay. Depending on how strictly you want to be having the exact same output as black, this could potentially be tested with <a href="https://en.wikipedia.org/wiki/Differential_testing">differential fuzzing</a>. If that's desirable, please let me know and I can write a harness for this :slightly_smiling_face:</p>
<p>Otherwise, I will likely swing back around once this reaches a steady state and add an idempotency fuzzer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/warsaw">@warsaw</a> on 2023-06-06 16:16</div>
            <div class="timeline-body"><blockquote>
<p>The goal is to be black-compatible except for pathological cases</p>
</blockquote>
<p>I would dearly love at least the option to choose a different default quote character.  At least on US keyboards, double quotes are ergonomically inferior.  It's the number one reason why <a href="https://blue.readthedocs.io/en/latest/">blue</a> exists.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-06 16:39</div>
            <div class="timeline-body"><p>We still plan to make the quote style and indentation style configurable, though the exact settings scheme etc. havenâ€™t been designed yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-06 16:51</div>
            <div class="timeline-body"><p>See  #1904 for an in-depth discussion around the goal. The purpose of this task is to track the implementation work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-06-22 06:50</div>
            <div class="timeline-body"><p>Some other good first issues could be</p>
<ul>
<li>Star expression</li>
<li>Yield and Yield from</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LouisDISPA">@LouisDISPA</a> on 2023-07-07 13:04</div>
            <div class="timeline-body"><p>Hello, I'm interested in the formatter and while having a look at the code I did the raise formatter code. I'm not sure it's good but I can open a PR if you want. I took inspiration from the return formatter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-07 13:54</div>
            <div class="timeline-body"><blockquote>
<p>Hello, I'm interested in the formatter and while having a look at the code I did the formatter code. I'm not sure it's good but I can open a PR if you want. I took inspiration from the return formatter.</p>
</blockquote>
<p>Feel free to open a PR. On which node where you working?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LouisDISPA">@LouisDISPA</a> on 2023-07-07 13:58</div>
            <div class="timeline-body"><blockquote>
<p>Feel free to open a PR. On which node where you working?</p>
</blockquote>
<p>Sorry I edited my comment, it was the StmtRaise node.<br />
Ok I'll open the PR!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnpryer">@cnpryer</a> on 2023-07-15 22:03</div>
            <div class="timeline-body"><p>Any chance we can open an issue for <code>lambda</code>? I have a <a href="https://github.com/cnpryer/ruff/tree/expr-lambda">lambda branch</a> but I'm not sure I'm ready to claim it. If I have any questions it'd be nice to ask there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-17 08:42</div>
            <div class="timeline-body"><blockquote>
<p>Any chance we can open an issue for <code>lambda</code>? I have a <a href="https://github.com/cnpryer/ruff/tree/expr-lambda?rgh-link-date=2023-07-15T22%3A03%3A35Z">lambda branch</a> but I'm not sure I'm ready to claim it. If I have any questions it'd be nice to ask there.</p>
</blockquote>
<p>Sure: https://github.com/astral-sh/ruff/issues/5826</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Alpha" by @MichaReiser on 2023-07-31 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-31 17:02</div>
            <div class="timeline-body"><p>I'm closing this one. There's still some work left to be done but we'll track this as part of #6203</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-07-31 17:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:47:19 UTC
    </footer>
</body>
</html>
