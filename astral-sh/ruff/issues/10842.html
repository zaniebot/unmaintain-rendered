<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add an enabled-by-default rule about imports from an src package - astral-sh/ruff #10842</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add an enabled-by-default rule about imports from an src package</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10842">#10842</a>
        opened by <a href="https://github.com/pradyunsg">@pradyunsg</a>
        on 2024-04-09 01:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pradyunsg">@pradyunsg</a></div>
            <div class="timeline-body"><p>This is meant to prevent misused of PEP 420 (namespace packages) with the src/ layout.</p>
<p>https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/ discusses the tradeoffs between the src layout vs flat layout. The src layout is preferable for the reasons outlines there, although it is also feasible to undermine the benefits of the layout by doing <code>from src import mypackage</code> and similar misuses.</p>
<p>It would be nice if ruff had an enabled-by-default rule for warning about misuse of an src namespace package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-09 07:02</div>
            <div class="timeline-body"><blockquote>
<p>It would be nice if ruff had an enabled-by-default rule for warning about misuse of an src namespace package.</p>
</blockquote>
<p>Could you explain what you consider a misuse of a src namespace package and how this would be detected by analysing a project?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-04-09 07:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2024-04-09 09:36</div>
            <div class="timeline-body"><p>Any of the following imports:</p>
<pre><code>import src.whatever
from src import something
from src.something import something_else
</code></pre>
<p>(and their <code>as</code> variants)</p>
<p>This is effectively warning when an import starts from the top level namespace of src.</p>
<p>To avoid repeating too much content from the link, the main benefit of the src layout is that it forces you to install the project to be able to import any of the code within it. This helps ensure that the project configuration is correct, that the package is being installed appropriately and that you're only able to import what would be actually installed. Importing from src directly undermines the whole point of using an src layout.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-04-09 14:19</div>
            <div class="timeline-body"><p>This rule would just make it an error to have a top-level package named <code>src</code> in your project, with the reasoning that the name <code>src</code> is most commonly used for the outer container of your source tree (to isolate your Python source tree from the rest of your project), but unfortunately Python will happily treat any directory as a package, and therefore allow you to <code>from src import whatever</code>, even though <code>src</code> wasn't supposed to itself be a Python package, <code>whatever</code> was supposed to be top-level.</p>
<p>It makes sense why this would be useful in many cases, though it feels a little icky to have an enabled-by-default rule that just says &quot;you can't use this otherwise-valid name for a Python package.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pradyunsg">@pradyunsg</a> on 2024-04-09 17:22</div>
            <div class="timeline-body"><p>TBH, I share some hesitation around this feeling a bit icky.</p>
<p>That said, I filed this issue since I think this is not substantially different in terms of &quot;otherwise valid Python code flagged by the linter&quot; as compared to other existing rules, like https://docs.astral.sh/ruff/rules/unused-import/ or https://docs.astral.sh/ruff/rules/import-shadowed-by-loop-var/ or https://docs.astral.sh/ruff/rules/module-import-not-at-top-of-file/.</p>
<p>All of those are valid ways to use import or other Python syntax, and there might even be situations where one or more of those would be ignored manually because doing that is <em>exactly</em> what the user wants (which is why ignores are nice).</p>
<p>It's almost never what you want to/should do though, and having this get flagged to users by default helps users discover their misuse (thanks to an error with a associated documentation that provides specific guidance, like those aforementioned ones) and helps guide them away from doing what they're doing (or telling the linter to shut up, which should be MUCH rarer, which will be the case for this specific rule).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:02 UTC
    </footer>
</body>
</html>
