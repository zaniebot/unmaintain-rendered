<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F821 false positives for `__annotate__` and `__warningregistry__` - astral-sh/ruff #19970</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F821 false positives for <code>__annotate__</code> and <code>__warningregistry__</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19970">#19970</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-08-18 14:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body">Summary
<p>There are two documented module-level dunder attributes that <a href="https://docs.astral.sh/ruff/rules/undefined-name/"><code>undefined-name</code> (F821)</a> doesn’t recognize: <a href="https://docs.python.org/3.14/reference/datamodel.html#other-writable-attributes-on-module-objects"><code>__annotate__</code></a> and <a href="https://docs.python.org/3.14/library/warnings.html#warnings.warn_explicit"><code>__warningregistry__</code></a>. They are like <code>__file__</code> and <code>__cached__</code> in that not every module has them and they are not commonly used, but if someone uses them it was probably intentional, so F821 shouldn’t flag them. <a href="https://play.ruff.rs/1ba60c54-4666-4cd7-abfb-e02fc526c6ff">Example</a>:</p>
<pre><code>$ cat &gt;f821.py &lt;&lt;&#x27;# EOF&#x27;
x: str = str(b&quot;!&quot;)
print(__warningregistry__)
print(__annotate__(1))
# EOF

$ python3.14 -b f821.py 2&gt;/dev/null
{&#x27;version&#x27;: 1, (&#x27;str() on a bytes instance&#x27;, &lt;class &#x27;BytesWarning&#x27;&gt;, 1): True}
{&#x27;x&#x27;: &lt;class &#x27;str&#x27;&gt;}

$ ruff --isolated check f821.py --select F821 --target-version py314 --preview --output-format concise -q
f821.py:2:7: F821 Undefined name `__warningregistry__`
f821.py:3:7: F821 Undefined name `__annotate__`
</code></pre>
Version
<p>ruff 0.12.9 (ef422460d 2025-08-14)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-18 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-08-18 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-23 12:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:21 UTC
    </footer>
</body>
</html>
