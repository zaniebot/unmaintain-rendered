<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F821 false positives for `__annotate__` and `__warningregistry__` - astral-sh/ruff #19970</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F821 false positives for `__annotate__` and `__warningregistry__`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/19970">#19970</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-08-18 14:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dscorbett">@dscorbett</a> on 2025-08-18 14:50</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>There are two documented module-level dunder attributes that <a href="https://docs.astral.sh/ruff/rules/undefined-name/"><code>undefined-name</code> (F821)</a> doesn’t recognize: <a href="https://docs.python.org/3.14/reference/datamodel.html#other-writable-attributes-on-module-objects"><code>__annotate__</code></a> and <a href="https://docs.python.org/3.14/library/warnings.html#warnings.warn_explicit"><code>__warningregistry__</code></a>. They are like <code>__file__</code> and <code>__cached__</code> in that not every module has them and they are not commonly used, but if someone uses them it was probably intentional, so F821 shouldn’t flag them. <a href="https://play.ruff.rs/1ba60c54-4666-4cd7-abfb-e02fc526c6ff">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;f821.py &lt;&lt;'# EOF'
x: str = str(b&quot;!&quot;)
print(__warningregistry__)
print(__annotate__(1))
# EOF

$ python3.14 -b f821.py 2&gt;/dev/null
{'version': 1, ('str() on a bytes instance', &lt;class 'BytesWarning'&gt;, 1): True}
{'x': &lt;class 'str'&gt;}

$ ruff --isolated check f821.py --select F821 --target-version py314 --preview --output-format concise -q
f821.py:2:7: F821 Undefined name `__warningregistry__`
f821.py:3:7: F821 Undefined name `__annotate__`
</code></pre>
<h3>Version</h3>
<p>ruff 0.12.9 (ef422460d 2025-08-14)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-08-18 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-08-18 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/20154.html">astral-sh/ruff#20154</a> on 2025-08-29 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-23 12:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
