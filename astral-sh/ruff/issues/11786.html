<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No longer works w/o kludges on Mac OS X versions (&lt;10.12) which are still supported by official Python - astral-sh/ruff #11786</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>No longer works w/o kludges on Mac OS X versions (&lt;10.12) which are still supported by official Python</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11786">#11786</a>
        opened by <a href="https://github.com/TurtleWilly">@TurtleWilly</a>
        on 2024-06-06 22:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TurtleWilly">@TurtleWilly</a></div>
            <div class="timeline-body"><pre><code>$ ./ruff --help
dyld: lazy symbol binding failed: Symbol not found: _os_unfair_lock_trylock
  Referenced from: /Volumes/Temporary/ruff (which was built for Mac OS X 10.12)
  Expected in: /usr/lib/libSystem.B.dylib

dyld: Symbol not found: _os_unfair_lock_trylock
  Referenced from: /Volumes/Temporary/ruff (which was built for Mac OS X 10.12)
  Expected in: /usr/lib/libSystem.B.dylib

Trace/BPT trap: 5
</code></pre>
<p>(on Mac OS X 10.10.5 aka Yosemite, an OS version still officially supported by Python/CPython)</p>
<p>Note: ruff version 0.1.2 from end of last year which I had previously installed did not have this issue.</p>
<p>It&#x27;s still possible to temporarily/ awkwardly workaround it by injecting the legacy support support library from the MacPorts project, so it really should be just a minor compatibility issue really:</p>
<pre><code>$ DYLD_FORCE_FLAT_NAMESPACE=1 DYLD_INSERT_LIBRARIES=/usr/local/lib/libMacportsLegacySupport.dylib \
  ruff --version
ruff 0.4.8
</code></pre>
<hr>
<p>Likewise trying to install it via pip is a sad outcome (used to work before too)</p>
<pre><code>$ python3.12 -m venv foobar
$ cd foobar/
$ source ./bin/activate
(foobar) $ pip install ruff
Collecting ruff
  Downloading ruff-0.4.8.tar.gz (2.6 MB)
     ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 2.6/2.6 MB 6.1 MB/s eta 0:00:00
  Installing build dependencies ... error
  error: subprocess-exited-with-error
  
  √ó pip subprocess to install build dependencies did not run successfully.
  ‚îÇ exit code: 1
  ‚ï∞‚îÄ&gt; [57 lines of output]
      Collecting maturin&lt;2.0,&gt;=1.0
        Downloading maturin-1.6.0.tar.gz (187 kB)
           ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 187.9/187.9 kB 2.6 MB/s eta 0:00:00
        Installing build dependencies: started
        Installing build dependencies: finished with status &#x27;done&#x27;
        Getting requirements to build wheel: started
        Getting requirements to build wheel: finished with status &#x27;done&#x27;
        Preparing metadata (pyproject.toml): started
        Preparing metadata (pyproject.toml): finished with status &#x27;done&#x27;
      Building wheels for collected packages: maturin
        Building wheel for maturin (pyproject.toml): started
        Building wheel for maturin (pyproject.toml): finished with status &#x27;error&#x27;
        error: subprocess-exited-with-error
      
        √ó Building wheel for maturin (pyproject.toml) did not run successfully.
        ‚îÇ exit code: 1
        ‚ï∞‚îÄ&gt; [34 lines of output]
            /private/var/folders/b7/***REDACTED***/T/pip-build-env-dm4wttt1/overlay/lib/python3.12/site-packages/setuptools/config/_apply_pyprojecttoml.py:83: SetuptoolsWarning: `install_requires` overwritten in `pyproject.toml` (dependencies)
              corresp(dist, value, root_dir)
            running bdist_wheel
            running build
            running build_py
            creating build
            creating build/lib.macosx-10.9-universal2-cpython-312
            creating build/lib.macosx-10.9-universal2-cpython-312/maturin
            copying maturin/__init__.py -&gt; build/lib.macosx-10.9-universal2-cpython-312/maturin
            copying maturin/__main__.py -&gt; build/lib.macosx-10.9-universal2-cpython-312/maturin
            copying maturin/import_hook.py -&gt; build/lib.macosx-10.9-universal2-cpython-312/maturin
            running egg_info
            creating maturin.egg-info
            writing maturin.egg-info/PKG-INFO
            writing dependency_links to maturin.egg-info/dependency_links.txt
            writing requirements to maturin.egg-info/requires.txt
            writing top-level names to maturin.egg-info/top_level.txt
            writing manifest file &#x27;maturin.egg-info/SOURCES.txt&#x27;
            reading manifest file &#x27;maturin.egg-info/SOURCES.txt&#x27;
            reading manifest template &#x27;MANIFEST.in&#x27;
            warning: no files found matching &#x27;*.json&#x27; under directory &#x27;src/python_interpreter&#x27;
            writing manifest file &#x27;maturin.egg-info/SOURCES.txt&#x27;
            running build_ext
            running build_rust
            error: failed to parse manifest at `/private/var/folders/b7/***REDACTED***/T/pip-install-5wc38rd9/maturin_1c9e0ae9cb1a47d4a6545f02c734b4be/Cargo.toml`
      
            Caused by:
              failed to parse the `edition` key
      
            Caused by:
              this version of Cargo is older than the `2021` edition, and only supports `2015` and `2018` editions.
            error: `cargo metadata --manifest-path Cargo.toml --format-version 1 --locked` failed with code 101
            -- Output captured from stdout:
      
            [end of output]
      
        note: This error originates from a subprocess, and is likely not a problem with pip.
        ERROR: Failed building wheel for maturin
      Failed to build maturin
      ERROR: Could not build wheels for maturin, which is required to install pyproject.toml-based projects
      [end of output]
  
  note: This error originates from a subprocess, and is likely not a problem with pip.
error: subprocess-exited-with-error

√ó pip subprocess to install build dependencies did not run successfully.
‚îÇ exit code: 1
‚ï∞‚îÄ&gt; See above for output.

note: This error originates from a subprocess, and is likely not a problem with pip.
</code></pre>
<p>So no luck on that route either (albeit that doesn&#x27;t look like ruff&#x27;s fault.) The Rust ecosystem really gives nothing about any sort of backwards compatibility it seems. üò¢</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-06 22:58</div>
            <div class="timeline-body"><p>I don&#x27;t think we can support macOS 10. It&#x27;s extremely EOL -- even macOS 11 is EOL and has been for almost a year, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-07 06:29</div>
            <div class="timeline-body"><p>Yeah I don&#x27;t think we can support it. <a href="https://blog.rust-lang.org/2023/09/25/Increasing-Apple-Version-Requirements.html">Rust dropped sierra support with Rust 1.74</a> which is the minimal rust version that we require.</p>
<p>I just tried and we can&#x27;t downgrade below 1.74 because we make use of the new cargo <code>lints</code> configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-06-07 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TurtleWilly">@TurtleWilly</a> on 2024-06-07 21:13</div>
            <div class="timeline-body"><p>Rust and Go are the worst offenders when it comes to basic compatibility. I can compile C programs from the 80 w/o problems, or get the latest C compiler, but running simple Rust or Go commands is a big disaster. Just broken ecosystems, IMHO.</p>
<p>Anyway‚Ä¶ if someone else stumbles onto this problem, here&#x27;s the proper solution. We can replace the the linked libSystem.B.dylib in the ruff binary with a wrapper library which inserts the missing functions and passes the rest along to Apple&#x27;s libSystem.B.dylib afterwards:</p>
<pre><code>$ otool -L ruff
ruff:
	/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 1953.255.0)
	/System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices (compatibility version 1.0.0, current version 1228.0.0)
	/usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1319.0.0)

$ install_name_tool -change /usr/lib/libSystem.B.dylib /usr/local/lib/libMacportsLegacySystem.B.dylib ruff

$ otool -L ruff
ruff:
	/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 1953.255.0)
	/System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices (compatibility version 1.0.0, current version 1228.0.0)
	/usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)
	/usr/local/lib/libMacportsLegacySystem.B.dylib (compatibility version 1.0.0, current version 1319.0.0)

$ ./ruff --version
ruff 0.4.8
</code></pre>
<p>The legacy wrappers are available here: https://github.com/macports/macports-legacy-support or alternatively here: https://ports.macports.org/port/legacy-support/details/</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:54 UTC
    </footer>
</body>
</html>
