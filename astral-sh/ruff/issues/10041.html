<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E203: conflicts with formatter - astral-sh/ruff #10041</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>E203: conflicts with formatter</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10041">#10041</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2024-02-19 07:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-19 07:35</div>
            <div class="timeline-body"><p>Hi, I think there is another case, where it is not working and that is when we have multiple indices, like in pandas:</p>
<p>My example looks like this:</p>
<p><code>dataframe.loc[index + 1 :, &quot;columnname&quot;] </code></p>
<p><code>Ruff format</code> always adds the space and <code>ruff . --fix</code> always removes it.</p>
<p><em>Originally posted by @Blumenkind111 in https://github.com/astral-sh/ruff/issues/8752#issuecomment-1948430614</em></p>
<p>Playground https://play.ruff.rs/de63f867-2176-4c27-b653-d0c3eb49754d</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "E203: conflict with formatter" to "E203: conflicts with formatter" by @MichaReiser on 2024-02-19 07:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-02-19 07:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2024-02-19 07:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Paciupa">@Paciupa</a> on 2024-02-21 00:22</div>
            <div class="timeline-body"><p>I have the same issue:</p>
<pre><code class="language-python">countries = [&quot;Spain&quot;, &quot;France&quot;, &quot;UK&quot;, &quot;Norway&quot;, &quot;Iceland&quot;]
print(f&quot;{countries[:3]}&quot;)
print(f&quot;{countries[1:4]}&quot;)

middle = len(countries) // 2
print(f&quot;{countries[middle  :  middle + 3]}&quot;) # `ruff format --preview` add spaces here, byt `ruff --fix` removes spaces.

print(f&quot;{countries[-3:]}&quot;)
</code></pre>
<p>It started only since version <code>0.2.2</code>.
Without <code>--preview</code> ruff doesn't format that line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-21 05:20</div>
            <div class="timeline-body"><blockquote>
<p>It started only since version <code>0.2.2</code>.</p>
</blockquote>
<p>This is because f-string formatting was added in preview in that release. This isn't the issue here but just clarifying that the problem was present before that version as well. You can try it out by keeping the expression outside the f-string:</p>
<pre><code class="language-python">countries[middle  :  middle + 3]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @MichaReiser on 2024-02-23 08:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 09:30</div>
            <div class="timeline-body"><p>It might be difficult to fix <code>dataframe.loc[index + 1 :, &quot;columnname&quot;] </code> without an AST or more lookahead (which is slow). The rule would need to know that what it encounters here is a tuple where this is fine.</p>
<p>I wonder if it's worth the struggle. To me it seems the main purpose of the rule related to <code>:</code> is to detect whitespace before the colon in clause headers. Maybe we just skip over colons entirely when inside parentheses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 09:45</div>
            <div class="timeline-body"><p>Regarding <code>countries[middle  :  middle + 3]</code>:</p>
<p><code>E203</code> enforces equal spacing around the <code>:</code> in accordance to PEP8:</p>
<blockquote>
<p>However, in a slice the colon acts like a binary operator, and should have equal amounts on either side (treating it as the operator with the lowest priority). <a href="https://peps.python.org/pep-0008/#pet-peeves">source</a></p>
</blockquote>
<p>However, the rule disallows leading tabs or multiple spaces (which I think is in accordance with PEP8 although not explicitly mentioned). The rule's fix isn't as sophisticated as the formatter. It always removes the whitespace if it encounters multiple spaces or tabs that may disagree with the formatter). However, that's fine, because we only aim for formatted code not to raise lint errors but our fixes don't need to be properly formatted.</p>
<p>The linter won't raise an error for your example if you only use one whitespace around the colons.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @MichaReiser by @MichaReiser on 2024-02-23 09:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-26 17:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:32:51 UTC
    </footer>
</body>
</html>
