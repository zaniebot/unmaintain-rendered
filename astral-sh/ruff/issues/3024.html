<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imports are formatted with different max-line-length then fixed - astral-sh/ruff #3024</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Imports are formatted with different max-line-length then fixed</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3024">#3024</a>
        opened by <a href="https://github.com/Nicholas-Autio-Mitchell">@Nicholas-Autio-Mitchell</a>
        on 2023-02-19 03:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Nicholas-Autio-Mitchell">@Nicholas-Autio-Mitchell</a></div>
            <div class="timeline-body">

<p>Just discovered <code>ruff</code> recently - amazing work - thanks!</p>
<p>I show the problem in the short video below. When running ruff (via vscode&#x27;s <code>formatOnSave</code>), an import line of length &gt;79 is formatted to break imports over several lines - then black/ruff settings of max line length 120 are respected, reformatting the imports. I run this 5 times in the video:</p>
<p>https://user-images.githubusercontent.com/12820901/219914833-90165e62-2ac5-43e1-b607-a7e5c653ac55.mov</p>
<ul>
<li>I am using the vscode plugin, shipping with ruff version <code>ruff 0.0.239</code>.</li>
<li><code>black, 23.1.0 (compiled: yes) -- Python (CPython) 3.9.16</code></li>
<li>The effect is not observable when plain ruff from the command line without the plugin.</li>
<li>This could well be a conflict in configs (I&#x27;m new here:)</li>
</ul>
Minimal example
<p>These files reproduce the video example.</p>
<code>entrypoint.py</code>
<pre><code>&quot;&quot;&quot;Imports with a line length over 79 are formatted by some rule(?), then reformatted by black/ruff max line length.&quot;&quot;&quot;

from busy_module import ReallyLongClassName1, ReallyLongClassName2, ReallyLongClassName3, ReallyLongClassName4

# Just to hide &quot;unused import&quot; warning
print(ReallyLongClassName1)
print(ReallyLongClassName2)
print(ReallyLongClassName3)
print(ReallyLongClassName4)
</code></pre>
<code>busy_module.py</code>
<pre><code>class ReallyLongClassName1: pass

class ReallyLongClassName2: pass

class ReallyLongClassName3: pass

class ReallyLongClassName4: pass
</code></pre>
<code>pyproject.yaml</code>
<pre><code>[tool.black]
line-length = 120
target-version = [&quot;py39&quot;]

[tool.ruff]
# Must match the Black formatter.
line-length = 120
target-version = &quot;py39&quot;

select = [&quot;ALL&quot;]
ignore = [&quot;ANN101&quot;, &quot;D202&quot;, &quot;INP001&quot;, &quot;TCH003&quot;, &quot;I001&quot;]

# Allow autofix for all enabled rules (when `--fix`) is provided.
fixable = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot;]
unfixable = []

# Allow unused variables when underscore-prefixed.
dummy-variable-rgx = &quot;^(_+|(_+[a-zA-Z0-9_]*[a-zA-Z0-9]+?))$&quot;

[tool.ruff.mccabe]
# Unlike Flake8, default to a complexity level of 10.
max-complexity = 10
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-19 12:12</div>
            <div class="timeline-body"><p>Hey thanks for the kind words!</p>
<p>My best guess is that you have isort enabled (since the style of formatting that&#x27;s being applied to the imports matches isort&#x27;s behavior IIRC, but doesn&#x27;t match Ruff&#x27;s).</p>
<p>Can you try disabling the isort extension in VS Code?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-19 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nicholas-Autio-Mitchell">@Nicholas-Autio-Mitchell</a> on 2023-02-19 14:54</div>
            <div class="timeline-body"><p>ðŸ¤¦  the <code>isort</code> plugin was sync&#x27;d and enabled globally - deactivating resolves the issue ðŸ™Œ</p>
<p>@charliermarsh - one quick question - I saw in a thread somewhere that there is an <code>&quot;ALL&quot;</code> tag for the <code>select</code> config. Is there also one for <code>fixable</code>?  I can&#x27;t find any documentation on this, but want to check the following is a valid starting point to build from, while learning about ruff:</p>
<pre><code>[tool.ruff]
select = [&quot;ALL&quot;]
fixable = [&quot;ALL&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-19 14:59</div>
            <div class="timeline-body"><p>Yeah that works.</p>
<p>So in that case, you&#x27;d start from <code>ALL</code>, then disable rules selectively as you go:</p>
<pre><code>[tool.ruff]
select = [&quot;ALL&quot;]
ignore = [
  # Or whatever you want to turn off.
  &quot;D100&quot;,
]

fixable = [&quot;ALL&quot;]
unfixable = [
  # Maybe you want to avoid autofixing `SIM` violations.
  # Note that any rules you include in `ignore` don&#x27;t have to be
  # included here, since we won&#x27;t even _try_ to fix those.
  &quot;SIM&quot;,
]
</code></pre>
<p>The other approach is to explicitly build up the list of rules you <em>do</em> care about, like:</p>
<pre><code>select = [
  &quot;E&quot;,
  &quot;F&quot;,
  &quot;SIM&quot;,  # flake8-simplify
  &quot;B&quot;,  # flake8-bugbear
]
</code></pre>
<p>I tend to prefer the latter approach as it&#x27;s more explicit but it&#x27;s just a personal preference.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-19 14:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:32 UTC
    </footer>
</body>
</html>
