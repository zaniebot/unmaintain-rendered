<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebook related rule updates - astral-sh/ruff #8669</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Notebook related rule updates</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8669">#8669</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2023-11-14 04:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-14 04:36</div>
            <div class="timeline-body"><p>This is an open discussion around linting Jupyter Notebooks using certain rules that doesn't map well with the notebook model.</p>
<p>For some context, Notebooks are made up of cells, each cell can be assumed to act as a single Python file but that's not exactly true as anything defined in a cell is available throughout the notebook via the global scope.</p>
<p>There are certain lint rules which doesn't map well with notebooks and this issue is to keep track of them in a central place. We can discuss on possible solutions here.</p>
<ul>
<li>[x] <a href="https://docs.astral.sh/ruff/rules/module-import-not-at-top-of-file/"><code>E402: module-import-not-at-top-of-file</code></a> - Usually imports definition in a notebook is scattered across multiple cells. The current workaround is to ignore this rule but one could argue that this rule should work at <em>cell</em> level i.e., &quot;Module level import not at top of cell&quot;.</li>
<li>[x] <a href="https://docs.astral.sh/ruff/rules/useless-expression/"><code>B018: useless-expression</code></a>, <a href="https://docs.astral.sh/ruff/rules/useless-comparison/"><code>B015: useless-comparison</code></a> - Expressions in a cell are not useless if they're at the end because the result of that expression is the output of the cell. So, these rules should be updated to avoid raising any violation if it's the last expression in the cell.</li>
<li>[x] <a href="https://docs.astral.sh/ruff/rules/useless-semicolon/"><code>E703: useless-semicolon</code></a> - On the other hand, semicolons are used to avoid the output mentioned in the previous point. If there's a trailing semicolon for the last expression in a cell, it's probably best to avoid raising a violation for it. The formatter does a similar thing: https://github.com/astral-sh/ruff/pull/8590</li>
<li>[x] <a href="https://docs.astral.sh/ruff/rules/undocumented-public-module/"><code>D100: undocumented-public-module</code></a> - This is irrelevant for Notebooks.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dhruvmanila on 2023-11-14 04:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/ruff-vscode/issues/340.html">astral-sh/ruff-vscode#340</a> on 2023-11-14 04:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6586.html">astral-sh/ruff#6586</a> on 2023-11-14 04:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/7300.html">astral-sh/ruff#7300</a> on 2023-11-14 04:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alkatar21">@alkatar21</a> on 2023-11-16 08:01</div>
            <div class="timeline-body"><p>I think another rule that makes less sense in notebooks is <code>D100</code>. Module docstrings are there most likely in markdown.
And I'm also not shure about <code>T201</code>, because you need this from time to time if something within the cell should also be output and not just the last line?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-20 19:58</div>
            <div class="timeline-body"><p>Thanks for chiming in on the issue!</p>
<p>Can you help me understand when does <code>D100</code> would give a false positive in Notebook? Do you mean that the content of the module docstring will be as a separate markdown cell? If so, then I think yeah we should avoid triggering this rule. Also, I think <code>D100</code> in general isn't relevant for Notebooks as they can't be imported.</p>
<p>For <code>flake8-print</code> rules, I would actually recommend to disable them for Notebooks as some users might actually not want them to be present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alkatar21">@alkatar21</a> on 2023-11-20 21:55</div>
            <div class="timeline-body"><blockquote>
<p>Do you mean that the content of the module docstring will be as a separate markdown cell?</p>
</blockquote>
<p>Yes, I would put everything I write in a module in the module docstring in a notebook in a markdown cell, which is why it makes no sense to have a module docstring.</p>
<blockquote>
<p>If so, then I think yeah we should avoid triggering this rule. Also, I think D100 in general isn't relevant for Notebooks as they can't be imported.</p>
</blockquote>
<p>That's what I basically wanted to say. That it makes no sense to me in notebooks that the rule triggers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @dhruvmanila on 2023-11-21 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8815.html">astral-sh/ruff#8815</a> on 2023-11-21 22:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8816.html">astral-sh/ruff#8816</a> on 2023-11-21 22:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8821.html">astral-sh/ruff#8821</a> on 2023-11-22 17:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/ruff-lsp/issues/328.html">astral-sh/ruff-lsp#328</a> on 2023-11-28 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-28 16:31</div>
            <div class="timeline-body"><p>I'm a bit torn on how to go for <code>E402</code>. There are a few solutions for this:</p>
<ol>
<li>We recommend disabling them for notebooks</li>
<li>By default we disable them for notebooks</li>
<li>For notebooks, we'd check the rule for each cell so &quot;Module level import not at top of cell&quot;</li>
</ol>
<p>I'm thinking of going with (3) in preview.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8872.html">astral-sh/ruff#8872</a> on 2023-11-28 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-11-29 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/redeboer">@redeboer</a> on 2024-04-25 15:56</div>
            <div class="timeline-body"><p>Thanks for maintaining this great project!</p>
<blockquote>
<p>Another potential solution is to introduce <code>E403</code> rule that is specifically for notebooks that works at cell level while <code>E402</code> will be disabled for notebooks.
https://github.com/astral-sh/ruff/pull/8872#issue-2015007451</p>
</blockquote>
<p>In some of our projects, we work with notebooks where we prefer to put all imports in one cell at the top of the notebook. If I understand correctly, there is no rule anymore that can enforce this. Might it be an idea to define a new rule <code>E403</code> specifically for notebooks, like mentioned by @dhruvmanila, but that works on the whole notebook?</p>
<p>If this idea is worth pursuing, I can post it as a separate issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ComPWA/compwa.github.io/pulls/270.html">ComPWA/compwa.github.io#270</a> on 2024-04-25 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-26 04:08</div>
            <div class="timeline-body"><p>@redeboer Yeah, I think we can discuss this in a separate issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
