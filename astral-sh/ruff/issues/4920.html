<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>git submodule files not being excluded - astral-sh/ruff #4920</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>git submodule files not being excluded</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4920">#4920</a>
        opened by <a href="https://github.com/mckib2">@mckib2</a>
        on 2023-06-07 05:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mckib2">@mckib2</a> on 2023-06-07 05:12</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Working on https://github.com/scipy/scipy/pull/18642, I'm having trouble getting the ruff <code>lint.toml</code> file to ignore python files found in 3rd party git submodules.  It's reproducible locally and in CI.  I've tried the following locally:</p>
<ul>
<li>add additional <code>exclude</code> item <code>&quot;scipy/_lib/highs/**/*.py&quot;</code></li>
<li>added additional <code>per-file-ignore</code>:<ul>
<li><code>&quot;scipy/_lib/highs/highspy/tests/test_highspy.py&quot; = [&quot;ALL&quot;]</code></li>
</ul>
</li>
</ul>
<p>Both result in the unhelpful message for 3rd-party code found in a git submodule:</p>
<pre><code>scipy/_lib/highs/highspy/tests/test_highspy.py:57:4 found test function 'get_infeasible_model' which does not start with 'test'
</code></pre>
<p>Command I'm running: <code>python dev.py lint</code>, which I understand is running:</p>
<pre><code>ruff --config=lint.toml [list of files that notably does not include scipy/_lib/highs/highspy/tests/test_highspy.py]
</code></pre>
<p>Version info:</p>
<pre><code>$  python --version
Python 3.10.6
$ ruff --version
ruff 0.0.271
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-07 21:27</div>
            <div class="timeline-body"><p>Adding this to <code>lint.toml</code> does seem to resolve the issue for me:</p>
<pre><code class="language-diff">‚ùØ git diff HEAD
diff --git a/tools/lint.toml b/tools/lint.toml
index 67b996939..6f6756372 100644
--- a/tools/lint.toml
+++ b/tools/lint.toml
@@ -25,6 +25,7 @@ target-version = &quot;py39&quot;
 &quot;scipy/optimize/_linprog.py&quot; = [&quot;F401&quot;]
 &quot;scipy/optimize/_linprog_ip.py&quot; = [&quot;F401&quot;]
 &quot;setup.py&quot; = [&quot;ALL&quot;]
+&quot;scipy/_lib/highs/**/*.py&quot; = [&quot;ALL&quot;]

 [mccabe]
 # Unlike Flake8, default to a complexity level of 10.
</code></pre>
<p>Running <code>ruff --config=tools/lint.toml .</code> before and after suppresses an error in <code>test_highspy.py</code>. Do you mind giving that a try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-06-07 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mckib2">@mckib2</a> on 2023-06-07 22:55</div>
            <div class="timeline-body"><p>Thanks @charliermarsh!  This is actually working, it's another utility printing out that message that's causing me grief.  Ruff is (and was) working as expected, operator error :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @mckib2 on 2023-06-07 22:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-08 00:40</div>
            <div class="timeline-body"><p>No worries, glad to hear it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5285.html">astral-sh/ruff#5285</a> on 2023-06-22 06:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
