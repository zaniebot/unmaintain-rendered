<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Behaviour of E721 with numpy.dtype - astral-sh/ruff #9570</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Behaviour of E721 with numpy.dtype</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/9570">#9570</a>
        opened by <a href="https://github.com/nstarman">@nstarman</a>
        on 2024-01-17 22:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nstarman">@nstarman</a> on 2024-01-17 22:00</div>
            <div class="timeline-body"><p><code>numpy.dtype</code> is tripping rule E721. I'm not sure it should be.</p>
<pre><code class="language-python">x = np.array([1,2,3], dtype=float)
x.dtype == float  # &lt;- trips E721
</code></pre>
<p><code>.dtype</code> is an object, e.g. a <code>dtype('float64')</code>.
While <code>x.dtype == float</code> may not be the best means of testing a dtype, I don't think this is E721.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-18 05:20</div>
            <div class="timeline-body"><p>What about <code>x.dtype is np.dtype(float)</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-01-18 05:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nstarman">@nstarman</a> on 2024-01-18 15:01</div>
            <div class="timeline-body"><p>Looking at https://github.com/numpy/numpy/blob/5feea41396910a3065c8e79886127fad4cbdebf3/numpy/<strong>init</strong>.pyi#L844, it appears that <code>==</code> is fine for dtypes.</p>
<p>I suppose we should ask a numpy dev — ping @mhvk — about preferred syntax.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astropy/astropy/pulls/15889.html">astropy/astropy#15889</a> on 2024-01-18 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mhvk">@mhvk</a> on 2024-01-18 16:00</div>
            <div class="timeline-body"><p><code>dtype</code> are a bit of a strange beast, but definitely best thought of as instances, not classes, and they are meant to be comparable not just to their own class, but also to the corresponding scalar types (e.g., <code>x.dtype == np.float32</code>) and strings (e.g., <code>x.dtype == ['i1,i4']</code>; basically, <code>__eq__</code> always tries to do <code>dtype(other)</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-19 16:47</div>
            <div class="timeline-body"><p>Okay, we can try to special-case it when comparing a <code>.dtype</code> attribute directly, though we'll still get it wrong in the general case (since given <code>x == y</code>, we can't know definitively whether <code>x</code> is a <code>dtype</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2024-01-19 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-01-19 16:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-19 16:59</div>
            <div class="timeline-body"><p>@mhvk -- Just to clarify, is <code>x.dtype == float</code> is preferable over (e.g.) <code>x.dtype is np.dtype(float)</code> or looking at the dtype kind or char?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-01-19 17:23</div>
            <div class="timeline-body"><p>I feel like <code>x.dtype is np.dtype(float)</code> is more correct, but this might make sense to exclude from E721 as it doesn't seem worse to use <code>== float</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mhvk">@mhvk</a> on 2024-01-19 19:21</div>
            <div class="timeline-body"><p>I think it is much safer in general usage to use <code>==</code>, since <code>is</code> really only works for the basic numpy built-in dtype. <code>np.dtype(&quot;i,i&quot;) is np.dtype(&quot;i,i&quot;)</code> gives <code>False</code>, because a new structured dtype is created for every call. So, to the point of this PR, <code>dtype</code> really should not generally be considered classes and thus no preference for <code>is</code> over <code>isinstance</code> or <code>==</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-20 01:00</div>
            <div class="timeline-body"><p>Okay, sounds good. Thanks for chiming in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @charliermarsh on 2024-01-29 03:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-01-29 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9676.html">astral-sh/ruff#9676</a> on 2024-01-29 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-01-29 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12290.html">astral-sh/ruff#12290</a> on 2024-07-11 16:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
