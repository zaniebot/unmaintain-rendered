<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> PLR0912: branches inside `with` statement not counted - astral-sh/ruff #11313</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1> PLR0912: branches inside `with` statement not counted</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/11313">#11313</a>
        opened by <a href="https://github.com/Kakadus">@Kakadus</a>
        on 2024-05-06 18:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Kakadus">@Kakadus</a> on 2024-05-06 18:15</div>
            <div class="timeline-body"><p>PLR0912(too-many-branches) does not count branches inside <code>with: </code> blocks. With pylint the following is detected, while ruff does not detect this rule violation</p>
<pre><code class="language-py">from contextlib import suppress
def capital(country):
    with suppress(Exception):
        if country == &quot;Australia&quot;:
            return &quot;Canberra&quot;
        elif country == &quot;Brazil&quot;:
            return &quot;Brasilia&quot;
        elif country == &quot;Canada&quot;:
            return &quot;Ottawa&quot;
        elif country == &quot;England&quot;:
            return &quot;London&quot;
        elif country == &quot;France&quot;:
            return &quot;Paris&quot;
        elif country == &quot;Germany&quot;:
            return &quot;Berlin&quot;
        elif country == &quot;Poland&quot;:
            return &quot;Warsaw&quot;
        elif country == &quot;Romania&quot;:
            return &quot;Bucharest&quot;
        elif country == &quot;Spain&quot;:
            return &quot;Madrid&quot;
        elif country == &quot;Thailand&quot;:
            return &quot;Bangkok&quot;
        elif country == &quot;Turkey&quot;:
            return &quot;Ankara&quot;
        elif country == &quot;Undefined&quot;:
            return None
        else:
            return &quot;Some&quot;

</code></pre>
<p>Ruff version: 0.4.3
command: <code>ruff check test.py --select PLR0912 --isolated</code></p>
<!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-05-06 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-06 19:57</div>
            <div class="timeline-body"><p>Seems like a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @dhruvmanila on 2024-05-07 09:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-07 09:03</div>
            <div class="timeline-body"><p>This seems like an easy fix which is to just include the <code>Stmt::With</code> in this function:</p>
<p>https://github.com/astral-sh/ruff/blob/868bbd4de6e193352d2d9a44be2f323a0887dd51/crates/ruff_linter/src/rules/pylint/rules/too_many_branches.rs#L88-L88</p>
<p>And then to add some test cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11321.html">astral-sh/ruff#11321</a> on 2024-05-07 10:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-08 03:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
