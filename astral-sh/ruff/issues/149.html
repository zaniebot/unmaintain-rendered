<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F821 triggers when referencing a deleted (in an if) variable in an else/elif - astral-sh/ruff #149</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F821 triggers when referencing a deleted (in an if) variable in an else/elif</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/149">#149</a>
        opened by <a href="https://github.com/Jackenmen">@Jackenmen</a>
        on 2022-09-11 03:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-11 03:20</div>
            <div class="timeline-body"><p>Example reproduction code:</p>
<pre><code class="language-py">def func(seq, arg):
    if seq:
        del arg
    elif arg:  # false-positive F821
        print(arg)  # false-positive F821
    else:
        print(arg)  # false-positive F821

    print(arg)  # correctly reported F821
</code></pre>
<hr />
<p><em>Story time</em></p>
<p>While running into this false-positive, I actually found a different issue so it's net-positive :)</p>
<pre><code class="language-py">def func(seq, show_this_once):
    if seq:
        for elem in seq:
            print(elem, show_this_once)
            del show_this_once
    elif show_this_once:
        print(show_this_once)
</code></pre>
<p>The <code>del</code> in the <code>for</code> loop here was problematic because on second iteration the variable no loner exists. Somehow we never tested it with a sequence longer than one so this went undetected. Note that ruff didn't report this directly, I just found it because of the <code>elif</code> branch I had :) I suppose there could be a rule for reporting this kind of possibly unbound variable issue but it would probably be prone to false positives so I'm not really feature requesting that :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2022-09-11 03:34</div>
            <div class="timeline-body"><p>Would be great if early returns were supported as well:</p>
<pre><code class="language-py">def func(remove, arg1, arg2, arg3):
    if remove &amp; 1:
        del arg1
        return

    print(arg1)

    if remove &amp; 2:
        del arg2
        raise RuntimeError(&quot;!!!&quot;)

    print(arg2)

    for _ in range(2):
        if remove &amp; 4:
            del arg3
            continue
        print(arg3)
</code></pre>
<p>as in, all <code>print</code>s should be considered valid.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-09-11 13:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-09-11 14:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 15:56:29 UTC
    </footer>
</body>
</html>
