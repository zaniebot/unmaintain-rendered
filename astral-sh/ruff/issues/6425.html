<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unexpected line length check behaviour when line has tabs. - astral-sh/ruff #6425</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unexpected line length check behaviour when line has tabs.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6425">#6425</a>
        opened by <a href="https://github.com/Nuno-Mota">@Nuno-Mota</a>
        on 2023-08-08 12:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Nuno-Mota">@Nuno-Mota</a> on 2023-08-08 12:38</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hi.</p>
<p>It seems like the counting of line length with tabs has an unexpected behaviour.</p>
<p>From what I can infer, the length of each line is first counted considering that tabs have a size of 1.
If the resulting length is equal to or greater than the <code>line-length</code> setting, then the size is recomputed taking into account the <code>tab-size</code> setting.
Furthermore, the line needs to have at least 1 space (as discussed in #6424).</p>
<p>Is this the intended behaviour? If so, is there some place that explains the reasoning behind it?</p>
<p>This was tested for <code>ruff 0.0.282</code>.</p>
<p>MWE:</p>
<p>pyproject.toml</p>
<pre><code class="language-toml">[tool.ruff]
line-length = 6
tab-size = 4
show-source = true
</code></pre>
<p>test file (note that github uses a default tab size of 8)</p>
<pre><code class="language-python"># aaaa
# aaaaa
    # a
	# a
	# aa
	# aaa
	# aaaa
		# a
		# aa
		# aaa

if True: # noqa: E501
	[12]
	[12 ]
	[1,2]
	[1, 2]
</code></pre>
<p>ruff's output</p>
<pre><code class="language-zsh">ruff test3.py 
test3.py:2:7: E501 Line too long (7 &gt; 6 characters)
  |
1 | # aaaa
2 | # aaaaa
  |       ^ E501
3 |     # a
4 |     # a
  |

test3.py:3:7: E501 Line too long (7 &gt; 6 characters)
  |
1 | # aaaa
2 | # aaaaa
3 |     # a
  |       ^ E501
4 |     # a
5 |     # aa
  |

test3.py:6:4: E501 Line too long (9 &gt; 6 characters)
  |
4 |     # a
5 |     # aa
6 |     # aaa
  |       ^^^ E501
7 |     # aaaa
8 |         # a
  |

test3.py:7:4: E501 Line too long (10 &gt; 6 characters)
  |
5 |     # aa
6 |     # aaa
7 |     # aaaa
  |       ^^^^ E501
8 |         # a
9 |         # aa
  |

test3.py:9:3: E501 Line too long (12 &gt; 6 characters)
   |
 7 |     # aaaa
 8 |         # a
 9 |         # aa
   |         ^^^^ E501
10 |         # aaa
   |

test3.py:10:3: E501 Line too long (13 &gt; 6 characters)
   |
 8 |         # a
 9 |         # aa
10 |         # aaa
   |         ^^^^^ E501
11 | 
12 | if True: # noqa: E501
   |

test3.py:14:4: E501 Line too long (9 &gt; 6 characters)
   |
12 | if True: # noqa: E501
13 |     [12]
14 |     [12 ]
   |       ^^^ E501
15 |     [1,2]
16 |     [1, 2]
   |

test3.py:16:4: E501 Line too long (10 &gt; 6 characters)
   |
14 |     [12 ]
15 |     [1,2]
16 |     [1, 2]
   |       ^^^^ E501
   |

Found 8 errors.
âœ— - status code 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-08 12:55</div>
            <div class="timeline-body"><p>Do you mind clarifying what behavior here is unexpected? &quot;...then the size is recomputed taking into account...&quot; sounds like an implementation detail as-described, and not a behavior per se.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nuno-Mota">@Nuno-Mota</a> on 2023-08-08 13:41</div>
            <div class="timeline-body"><blockquote>
<p>Do you mind clarifying what behavior here is unexpected?</p>
</blockquote>
<p>Of course.</p>
<p>The issue is that tab-indented lines that are longer than the <code>line-length</code> setting (taking into consideration the <code>tab-size</code> setting), might not be flagged for <code>E501</code>.</p>
<blockquote>
<p>&quot;...then the size is recomputed taking into account...&quot; sounds like an implementation detail as-described, and not a behavior per se.</p>
</blockquote>
<p>That might be. This is simply the behaviour I was able to infer.
In any case it seems to lead to an erroneous line length count in certain cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-08 18:58</div>
            <div class="timeline-body"><p>Ah, I think that's a result of the performance optimization I proposed in https://github.com/astral-sh/ruff/pull/5811/files, which doesn't hold true for tabs (for which a single-byte character can be wider than one byte).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-08-08 19:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-08-11 01:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-08-11 02:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:55 UTC
    </footer>
</body>
</html>
