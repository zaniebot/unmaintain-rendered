<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PYI034 false positive if Self is a quoted annotation - astral-sh/ruff #12928</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PYI034 false positive if Self is a quoted annotation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12928">#12928</a>
        opened by <a href="https://github.com/BenGale93">@BenGale93</a>
        on 2024-08-16 12:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BenGale93">@BenGale93</a></div>
            <div class="timeline-body"><p>List of keywords searched:</p>
<ul>
<li>PYI034</li>
</ul>
<p>Code example:</p>
<pre><code class="language-python">import typing as t

if t.TYPE_CHECKING:
    from typing_extensions import Self


class Foo:
    def __init__(self, x: int) -&gt; None:
        self.x = x

    def __iadd__(self, other: &quot;Self&quot;) -&gt; &quot;Self&quot;:
        &quot;&quot;&quot;Adds two Foo objects together.&quot;&quot;&quot;
        self.x += other.x
        return self
</code></pre>
<p>Command: <code>ruff check file.py --isolated --select=PYI034</code></p>
<p>Ruff Version: 0.5.7</p>
<p>I'd be happy to try and fix this as I have some Rust experience. Please let me know if I can be of help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @AlexWaygood on 2024-08-16 13:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @AlexWaygood on 2024-08-16 13:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-16 13:05</div>
            <div class="timeline-body"><blockquote>
<p>I'd be happy to try and fix this as I have some Rust experience. Please let me know if I can be of help.</p>
</blockquote>
<p>Please feel free! We have logic elsewhere for handling quoted annotations, so I'd definitely go and check how other rules do this kind of thing first</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BenGale93">@BenGale93</a> on 2024-08-16 20:00</div>
            <div class="timeline-body"><p>I think this might be more of a fundamental issue.</p>
<p>If I extend the example:</p>
<pre><code class="language-python">import typing as t

if t.TYPE_CHECKING:
    from typing import Any

    from typing_extensions import Self


class Foo:
    def __init__(self, x: int) -&gt; None:
        self.x = x

    def __iadd__(self, other: &quot;Self&quot;) -&gt; &quot;Self&quot;:
        self.x += other.x
        return self

    def __eq__(self, value: &quot;Any&quot;) -&gt; bool:
        return True
</code></pre>
<p>PYI031 should pick up the <code>Any</code> in the <code>__eq__</code> but it doesn't. Appreciate the example is a little contrived.</p>
<p>I've been combing through the code on how to resolve it but I'm struggling. Any suggestions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-17 13:17</div>
            <div class="timeline-body"><p>Hmm, yeah, this was a bit more complicated than I realised. Unfortunately in order to figure out how to fix it, I've basically had to go ahead and implement the fix locally, so I might just go ahead and file a PR myself if that's okay :/ Sorry -- I thought this was a good contributor issue but I think I was mistaken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-17 14:12</div>
            <div class="timeline-body"><p>I've filed #12951</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @AlexWaygood on 2024-08-17 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BenGale93">@BenGale93</a> on 2024-08-18 07:01</div>
            <div class="timeline-body"><p>Thanks @AlexWaygood! No worries about taking over, I'm certain I would have never come up with that fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-09-02 13:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:53 UTC
    </footer>
</body>
</html>
