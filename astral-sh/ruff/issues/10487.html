<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation for ruff config file - astral-sh/ruff #10487</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Validation for ruff config file</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10487">#10487</a>
        opened by <a href="https://github.com/VascoSch92">@VascoSch92</a>
        on 2024-03-20 09:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/VascoSch92">@VascoSch92</a></div>
            <div class="timeline-body"><p><strong>Ruff-version : 0.3.3</strong></p>
<p>Hello everyone,</p>
<p>I&#x27;m concerned about the configuration file for Ruff (<code>pyproject.toml</code>,<code> ruff.toml</code>, ...).</p>
<p>Are there checks for this configuration file? I&#x27;m asking not only about the syntax but also about the content.</p>
<p>I&#x27;m asking because of several reasons:</p>
<ul>
<li>As a project becomes more complex, the configuration file for Ruff can also become complex, and we would like to find a way to keep it clean.</li>
<li>There are situations where it is unclear how Ruff behaves with respect to the configuration file.</li>
</ul>
<p>To clarify my point of view, here is a snippet of the configuration file that I use:</p>
<pre><code>[tool.ruff]
# Set of rules enabled
lint.select = [
    &quot;ARG002&quot;, # Checks for the presence of unused arguments in instance method definitions
    &quot;ANN201&quot;, # Missing return type annotation for public function
    &quot;E&quot;, # Pycodestyle Error
    &quot;F&quot;, # Pyflakes
    &quot;B&quot;, # Flake8-bugbear
    &quot;W&quot;, # Pycodestyle Warning
    &quot;D101&quot;, # Undocumented public class
    &quot;D102&quot;, # Undocumneted public method
    &quot;D103&quot;, # Undocumented public function
    &quot;D105&quot;, # Undocumented magic method
    &quot;D200&quot;, # One-line docstring should fit on one line
    &quot;D202&quot;, # No blank lines allowed after function docstring
    &quot;D300&quot;, # Use triple double quotes &quot;&quot;&quot;
    &quot;D404&quot;, # First word of the docstring should not be &quot;This&quot;
    &quot;UP003&quot;, # Use {} instead of type(...)
    &quot;UP008&quot;, # Use super() instead of super(_class_, self)
    &quot;UP011&quot;, # Unnecessary parentheses to functools.lru_cache
    &quot;UP027&quot;, # Replace unpacked list comprehension with a generator expression
    &quot;UP032&quot;, # Use f-string instead of format call
    &quot;C4&quot;, # flake8-comprehensions
    &quot;ICN&quot;, # flake8-import-conventions
    &quot;NPY&quot;, # NumPy-specific rules (NPY)
    &quot;ARG&quot;, # flake8-unused-arguments
    &quot;PLE0604&quot;, # Invalid object in __all__, must contain only strings
    &quot;PLE0605&quot;, # Invalid format for __all__, must be tuple or list
    &quot;PIE&quot;, # flake8-pie
    &quot;PTH&quot;, # flake8-use-pathlib
    &quot;Q000&quot;,
    &quot;LOG&quot;, # checks for impropriate use of logging
    &quot;Q002&quot;, # flake-8 double quotes for dosctring
    &quot;I001&quot;, # Import block is un-sorted or un-formatted
]

# Ignored rules
lint.ignore = [
    &quot;ARG002&quot;, # Checks for the presence of unused arguments in instance method definitions
    &quot;F821&quot;, # Checks for uses of undefined names
    &quot;B020&quot;, # Checks for contextlib.suppress without arguments
    &quot;B023&quot;, # Checks for function definitions that use a loop variable
    &quot;PTH123&quot;, # Checks for uses of the open builtin
    &quot;PIE804&quot;, # Checks for unnecessary dict kwargs
    &quot;PIE807&quot;, # Checks for lambdas that can be replaced with the list builtin
    &quot;W605&quot;, # Checks for invalid escape sequences
]

# Set the max length of a line
line-length = 121

# The style in which the output message should be formatted
output-format = &quot;grouped&quot;

lint.flake8-quotes.inline-quotes = &quot;double&quot;
lint.flake8-quotes.docstring-quotes = &quot;double&quot;
lint.flake8-quotes.multiline-quotes = &quot;double&quot;

lint.isort.combine-as-imports = true
lint.isort.length-sort = true

[tool.ruff.format]
indent-style = &quot;space&quot;
skip-magic-trailing-comma = false
quote-style = &quot;single&quot;
</code></pre>
<p>Problems:</p>
<ol>
<li>You can see that the rule <code>&quot;ARG002&quot;</code> is included in both <code>select</code> and <code>ignore</code>. As my project doesn&#x27;t have unused arguments, I don&#x27;t know if the rule is ignored or it is just satisfied.</li>
<li>you can see that I have <code>lint.flake8-quotes.inline-quotes = &quot;double&quot;</code> and <code>quote-style = &quot;single&quot;</code>. Which rule are we applying? In this case the first one but I had to run ruff and check the output.</li>
</ol>
<p>At the end of the day, I&#x27;m just asking to add checks to make the config file free of situations where there may be some confusion</p>
<p>Thanks for your answer</p>
<p>PS: Ruff is really nice, you are doing a great job :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-20 10:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-20 13:28</div>
            <div class="timeline-body"><p>Yeah that makes a lot of sense. I think we do some very basic verification today but it is limited to whether the pyproject.toml is valid. But we don&#x27;t perform any validation to catch potential errors in the configuration.</p>
<p>This is related to <a href="https://github.com/astral-sh/ruff/issues/10227">astral-sh/ruff#10227</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-20 14:36</div>
            <div class="timeline-body"><p>You can also verify these configuration files via their JSON schemas</p>
<p>e.g. https://github.com/astral-sh/ruff/blob/main/ruff.schema.json / https://www.schemastore.org/json/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">linter</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-20 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2024-03-24 10:28</div>
            <div class="timeline-body"><blockquote>
<p>Yeah that makes a lot of sense. I think we do some very basic verification today but it is limited to whether the pyproject.toml is valid. But we don&#x27;t perform any validation to catch potential errors in the configuration.
This is related to <a href="https://github.com/astral-sh/ruff/issues/10227">astral-sh/ruff#10227</a></p>
</blockquote>
<p>I understand. Regarding issue <a href="https://github.com/astral-sh/ruff/issues/10227">astral-sh/ruff#10227</a>, I wanted to inquire about implementing rules to verify configuration files (and I see that the config file of Ruff can be one of these :-( ;-) ).</p>
<p>My idea is to introduce additional checks/verifications on the Ruff configuration file to potentially block linting or formatting if the configuration file is ambiguous. For example:</p>
<ul>
<li>Ensuring there are no duplicate rules in the <code>select</code> section.</li>
<li>Ensuring there are no duplicate rules in the <code>ignore</code> section.</li>
<li>Ensuring there are no rules that appear both in the <code>select</code> and <code>ignore</code> sections simultaneously.</li>
<li>Ensuring there are no conflicting rule pairs in the <code>select</code> section.</li>
<li>(This is not an exhaustive list, but I can provide a more complete one if people are interested :-) )</li>
</ul>
<p>By implementing these checks, we can ensure that the Ruff configuration file is unambiguous before proceeding with linting or formatting. This could help for the following cases:</p>
<ul>
<li>Helping the user to have a clean, and clear, Ruff config file</li>
<li>Prevent unintended linting or formatting.</li>
<li>Prevent formatting/linting bugs in Ruff due to peculiar/weird combinations.</li>
</ul>
<blockquote>
<p>You can also verify these configuration files via their JSON schemas
e.g. https://github.com/astral-sh/ruff/blob/main/ruff.schema.json / https://www.schemastore.org/json/</p>
</blockquote>
<p>Yes, but this is just for the structure not for the content right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-24 20:04</div>
            <div class="timeline-body"><p>You can also run <code>ruff check --show-settings</code> to view the final, resolved settings for your project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aneeshusa">@aneeshusa</a> on 2024-04-01 14:52</div>
            <div class="timeline-body"><p>+1 to this, I accidentally ran into <code>Ensuring there are no rules that appear both in the select and ignore sections simultaneously.</code> when updating an old POC to use latest ruff. Went to write an internal test and realized this is something ruff could be handling itself</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:51 UTC
    </footer>
</body>
</html>
