<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FURB188 false positive for affix expression with side effect - astral-sh/ruff #15334</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>FURB188 false positive for affix expression with side effect</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15334">#15334</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-01-07 22:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body"><p><a href="https://docs.astral.sh/ruff/rules/slice-to-remove-prefix-or-suffix/">slice-to-remove-prefix-or-suffix (FURB188)</a> produces a false positive in Ruff 0.8.6 when the affix expression has a side effect.</p>
<pre><code class="language-console">$ cat furb188.py
gen = (x for x in [&quot;1&quot;, &quot;23&quot;])
string = &quot;0x1&quot;
print(string[:-len(next(gen))] if string.endswith(next(gen)) else string)

$ python furb188.py
0

$ ruff check --isolated --preview --select FURB188 furb188.py --fix
Found 1 error (1 fixed, 0 remaining).

$ cat furb188.py
gen = (x for x in [&quot;1&quot;, &quot;23&quot;])
string = &quot;0x1&quot;
print(string.removesuffix(next(gen)))

$ python furb188.py
0x
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2025-01-07 22:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2025-01-07 22:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-07 22:36</div>
            <div class="timeline-body"><p>While you're absolutely correct on this, and we should fix it, it feels like enough of an edge case that I think we can still stabilise this rule as part of Ruff 0.9. It's just very unlikely that anybody would write code like this, realistically, I think :-)</p>
<p>Cc. @MichaReiser and @dylwil3 in case either of you disagree, though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-07 22:58</div>
            <div class="timeline-body"><p>Was just about to write the same thing - I've never seen this before... and it would seem very strange to rely on that behavior in any case.</p>
<p>It's not even clear to me that we <em>should</em> try to fix this behavior? In a dynamically typed language like Python, even with an excellent type checker, I think it's impractical (bordering on impossible?) to tell if function calls have side effects, statically. At the moment the only prior art in Ruff itself is very heavy-handed: we just assume that <em>all</em> functions have side effects (except for builtins that we think are not being overloaded):</p>
<p>https://github.com/astral-sh/ruff/blob/71ad9a2ab141126062f7c0cdb31f071967f2cccf/crates/ruff_python_ast/src/helpers.rs#L42-L46</p>
<p>That doesn't really seem appropriate here. We probably could (and should) make this method smarter by teaching it about various builtins and things from the standard library, but for any given rule I think we have to accept some level of approximation to the truth.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:56 UTC
    </footer>
</body>
</html>
