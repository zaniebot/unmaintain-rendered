<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP045 fixes `Optional[None]` to `None | None` - astral-sh/ruff #18508</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP045 fixes <code>Optional[None]</code> to <code>None | None</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18508">#18508</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-06-06 18:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body">Summary
<p>The fix for <a href="https://docs.astral.sh/ruff/rules/non-pep604-annotation-optional/"><code>non-pep604-annotation-optional</code> (UP045)</a> can produce <code>None | None</code>, the persistently inconvenient exception to PEP 604.</p>
<pre><code>$ cat &gt;up045.py &lt;&lt;&#x27;# EOF&#x27;
from typing import Optional
foo: Optional[None] = None
# EOF

$ ruff --isolated check up045.py --select UP045 --preview --target-version py310 --fix 
Found 1 error (1 fixed, 0 remaining).

$ cat up045.py
from typing import Optional
foo: None | None = None

$ python up045.py 2&gt;&amp;1 | tail -n 1
TypeError: unsupported operand type(s) for |: &#x27;NoneType&#x27; and &#x27;NoneType&#x27;
</code></pre>
Version
<p>ruff 0.11.13 (5faf72a4d 2025-06-05)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-06 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-06 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-06-06 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-06 18:59</div>
            <div class="timeline-body"><p>we should ignore it or fix <code>foo: Optional[None] = None</code> =&gt; <code>foo: None = None</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-06 19:06</div>
            <div class="timeline-body"><p>Is there ever a valid reason for <code>Optional[None]</code> or is it a likely mistake on its own? If it&#x27;s probably a mistake, we should leave it alone in UP045 and possibly consider a separate rule to catch it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-06 19:16</div>
            <div class="timeline-body"><blockquote>
<p>Is there ever a valid reason for <code>Optional[None]</code> or is it a likely mistake on its own? If it&#x27;s probably a mistake, we should leave it alone in UP045 and possibly consider a separate rule to catch it.</p>
</blockquote>
<p><code>Optional[None]</code> =&gt; <code>Union[None, None]</code>, i don&#x27;t think that makes sense</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-06-06 19:22</div>
            <div class="timeline-body"><p>should this be put a separate rule? or should the fix just do from <code>Optional[None]</code> to <code>None</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-06 19:27</div>
            <div class="timeline-body"><blockquote>
<p>should this be put a separate rule? or should the fix just do from <code>Optional[None]</code> to <code>None</code>?</p>
</blockquote>
<p>Yeah that&#x27;s what I was getting at. In my opinion, we should <em>not</em> transform <code>Optional[None]</code> to <code>None</code> because that&#x27;s assuming a lot about the user&#x27;s intention when the original code was likely a separate mistake. So the action items would be:</p>
<ul>
<li>Avoid offering an UP045 fix here (again because it&#x27;s unclear what the user wanted)</li>
<li>Open a separate rule suggestion for catching <code>Optional[None]</code> so we can discuss that generally</li>
</ul>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:02 UTC
    </footer>
</body>
</html>
