<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: Less strict enforcement of blank lines - astral-sh/ruff #22568</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: Less strict enforcement of blank lines</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22568">#22568</a>
        opened by <a href="https://github.com/MichaReiser">@MichaReiser</a>
        on 2026-01-14 10:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MichaReiser">@MichaReiser</a></div>
            <div class="timeline-body"><p>Add a formatter option so that it is less strict about the number of empty lines between statements. More specifically: Preserve the number of empty lines but no more than 2.</p>
<p>Related to https://github.com/astral-sh/ruff/issues/18448</p>
<p>The original request:</p>
<p>Opening this to get some feedback on if this is a feature that would be more widely useful</p>
<p>Similar to Black's <code>--pyi</code> mode:</p>
<pre><code>  --pyi                           Format all input files like typing stubs
                                  regardless of file extension. This is useful
                                  when piping source on standard input.
</code></pre>
<p>We use it in mdtests today to get more concise formatting.</p>
<p>Or add a similar option that allows for more concise formatting in documentation (markdown files, code snippets in docstrings)</p>
<p>A design question here is: If a user specifies <code>--pyi</code>, does that take precedence over the language specified on the fenced code block? If yes, this becomes useless for ty's mdtests ðŸ˜†</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @MichaReiser on 2026-01-14 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2026-01-14 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-14 12:16</div>
            <div class="timeline-body"><p>Having thought more about this, I'm coming to the conclusion that we definitely shouldn't support <code>--pyi</code> because:</p>
<ul>
<li>Ruff uses <code>--stdin-filename</code> to determine the extension of files when passing them via stdin</li>
<li>Looking at the diff in https://github.com/astral-sh/ruff/pull/22566, the main concern is that the &quot;normal&quot; mode is stricter about where it inserts blank lines and line breaks. One solution to this problem is to make the normal mode less strict about enforcing blank lines. Something I'm very empathetic with, but this is a larger discussion. However, allowing users to specify <code>--pyi</code> is effectively asking the formatter to support two formatting styles: &quot;compact&quot; and &quot;normal&quot;. I'm not sure if the pyi formatting captures &quot;compact&quot; well (it's more compact, but I'm not sure if all the special casing for pyi should apply to all Python code in documentation). It also opens us op to supporting even more style guides which has a pretty high bar for me.</li>
</ul>
<p>TLDR: I'd be open to adding an option that makes Ruff less strict about enforcing blank lines (specifically, allowing 1-2 empty lines at the statement level, everywhere, and up to 1 blank line between expressions, matching Prettier's behavior). But that's a separate feature request and something entirely separate of formatting fenced code blocks in markdown files</p>
<p>Related to https://github.com/astral-sh/ruff/issues/18448</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2026-01-14 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @MichaReiser on 2026-01-14 12:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> removed by @MichaReiser on 2026-01-14 12:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @MichaReiser on 2026-01-14 12:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: Support `--pyi` mode" to "Formatter: Less strict enforcement of blank lines" by @MichaReiser on 2026-01-14 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-14 12:45</div>
            <div class="timeline-body"><p>For markdown files. The solution is to change the language on the fenced code block from <code>py</code> to <code>pyi</code>.</p>
<p>Unfortunately, this might not always be a feasible option in ty if it's a fenced code block without a preceding file name (<code>**file.py**</code>). But it's probably feasible in many instances, which should be enough to mitigate the worst blank line regressions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leonace924">@leonace924</a> on 2026-01-15 05:05</div>
            <div class="timeline-body"><p>Good morning @MichaReiser,
would you assign me this issue as well?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 07:01</div>
            <div class="timeline-body"><p>Sorry. This is not ready for implementation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2026-01-15 07:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-15 07:50:03 UTC
    </footer>
</body>
</html>
