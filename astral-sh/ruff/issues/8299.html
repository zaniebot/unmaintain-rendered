<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Substring: infine loop using ruff v0.1.2 - astral-sh/ruff #8299</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Python Substring: infine loop using ruff v0.1.2</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8299">#8299</a>
        opened by <a href="https://github.com/bigluck">@bigluck</a>
        on 2023-10-28 09:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bigluck">@bigluck</a></div>
            <div class="timeline-body"><p>Using <code>ruff</code> v0.1.2 and <code>ruff-pre-commit</code> v0.1.2, pre-commit fails with:</p>
<pre><code class="language-bash">ruff.....................................................................Failed
- hook id: ruff
- exit code: 1

error: Failed to converge after 100 iterations.

This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BInfinite%20loop%5D

...quoting the contents of `my/service/folder/api_v0/router.py`, the rule codes E231, along with the `pyproject.toml` settings and executed command, we'd be very appreciative!

my/service/folder/api_v0/router.py:215:106: E231 Missing whitespace after ':'
Found 101 errors (100 fixed, 1 remaining).
</code></pre>
<p>The code is pretty straightforward:</p>
<pre><code class="language-python">from sqlalchemy.orm import DeclarativeBase

class Base(DeclarativeBase):
    pass

class MyClass(Base):
    file_uri: Mapped[str] = mapped_column(
        String(1024),
        nullable=False,
    )

...

def my_function(snapshot: MyClass):
    assert snapshot.file_uri is not None, f'Run &quot;{req.run_id}&quot; does not have a snapshot file.'
    snapshot_path = snapshot.file_uri[len(f's3://{self.s3_bucket_name}/'):]
</code></pre>
<p>Here my <code>pyproject.toml</code> settings:</p>
<pre><code class="language-toml">
[tool.mypy]
warn_return_any = true
warn_unused_configs = true

plugins = [&quot;pydantic.mypy&quot;]

# follow_imports = &quot;silent&quot;
warn_redundant_casts = true
warn_unused_ignores = true
disallow_any_generics = true
check_untyped_defs = true
no_implicit_reexport = true

# for strict mypy: (this is the tricky one :-))
disallow_untyped_defs = true

[tool.pydantic-mypy]
init_forbid_extra = true
init_typed = true


[tool.coverage.run]
branch = true
omit = [&quot;.devenv/*&quot;, &quot;stages/*&quot;, &quot;tests/*&quot;, &quot;.venv/*&quot;]


[tool.coverage.report]


[tool.coverage.xml]
output = &quot;cov.xml&quot;


[tool.ruff]
# Enable Pyflakes and pycodestyle rules.
select = [&quot;E&quot;, &quot;F&quot;]
# select = [&quot;ALL&quot;]
preview = true

# Never enforce `E501` (line length violations).
ignore = [&quot;E501&quot;]

# Always autofix, but never try to fix `F401` (unused imports).
fix = true
unfixable = [&quot;F401&quot;]


[tool.ruff.per-file-ignores]
# &quot;__init__.py&quot; = [&quot;E402&quot;]

</code></pre>
<p>It works when I set:</p>
<pre><code class="language-python">    snapshot_path = snapshot.file_uri[len(f's3://{self.s3_bucket_name}/'): len(snapshot.file_uri)]
</code></pre>
<p>but still, it wants a space between the first and the second length :/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-28 10:30</div>
            <div class="timeline-body"><p>Thank you for filing!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-10-28 10:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/FishAlchemist">@FishAlchemist</a> on 2023-10-28 15:28</div>
            <div class="timeline-body"><p>This is my simplified pyproject.toml, I don't know if it works for everywhere. Interestingly, I need to run Ruff in the directory where the Python file is located to trigger the issue.
E231 and E202 need to be selected at the same time, otherwise the problem does not occur.</p>
<pre><code class="language-toml">[tool.ruff]
select = [&quot;E231&quot;,&quot;E202&quot;]
preview = true
fix = true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-28 22:37</div>
            <div class="timeline-body"><p>(I think flagging those errors in the first place is incorrect -- pycodestyle doesn't.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-10-30 23:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-10-30 23:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:48 UTC
    </footer>
</body>
</html>
