<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT006 issue not raised when keyword arguments are used instead of positional arguments. - astral-sh/ruff #15324</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PT006 issue not raised when keyword arguments are used instead of positional arguments.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15324">#15324</a>
        opened by <a href="https://github.com/caarmen">@caarmen</a>
        on 2025-01-07 18:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/caarmen">@caarmen</a></div>
            <div class="timeline-body">Summary
<p>For pytest checks:</p>
<p>When <code>argnames</code> and <code>argvalues</code> are passed as keyword arguments to <code>pytest.mark.parametrize</code>, ruff doesn&#x27;t raise <code>PT006</code> where it would otherwise (for passing a list instead of a single value).</p>
Details
<p>Steps to reproduce the issue:</p>
<ul>
<li><p>Create a test file<code>test_something.py</code>, containing two test functions.
Note that the test functions only expect a single parametrized argument.</p>
<p>In both cases, the <code>parametrize()</code> decorator is called with a list for <code>argnames</code> and a list of list for <code>argvalues</code>. The difference is that the first one uses positional arguments, and the second one uses keyword arguments.</p>
<pre><code>import pytest


@pytest.mark.parametrize(
    [&quot;contact_type&quot;],
    [[&quot;email&quot;], [&quot;phone&quot;]],
)   
def test_function_issue_caught_PT006(contact_type: str):...

@pytest.mark.parametrize(
    argnames=[&quot;contact_type&quot;],
    argvalues=[[&quot;email&quot;], [&quot;phone&quot;]],
)   
def test_function_issue_uncaught_PT006(contact_type: str):...
</code></pre>
</li>
<li><p>Run ruff explicitly looking for the <code>PT006</code> issue:</p>
<pre><code>$ ruff check test_something.py  --select PT006
</code></pre>
</li>
<li><p>Expected behavior (I think, you&#x27;ll confirm ðŸ˜… ):</p>
<ul>
<li>Ruff raises an issue <code>PT006</code> with the same message for both test functions: &quot;<em>Use a string for the first argument</em>&quot;.</li>
</ul>
</li>
<li><p>Actual behavior:</p>
<ul>
<li>Ruff raises an issue only for the first test function (the one with positional arguments):<pre><code>$ ruff check test_something.py  --select PT006
test_something.py:5:5: PT006 [*] Wrong type passed to first argument of `pytest.mark.parametrize`; expected `str`
  | 
4 | @pytest.mark.parametrize(
5 |     [&quot;contact_type&quot;],
  |     ^^^^^^^^^^^^^^^^ PT006
6 |     [[&quot;email&quot;], [&quot;phone&quot;]],
7 | )
  | 
  = help: Use a string for the first argument
</code></pre>
</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;PT006 doesn&#x27;t raise issues when keyword arguments are used.&quot; to &quot;PT006 issue not raised when keyword arguments are used instead of positional arguments.&quot; by <a href="https://github.com/caarmen">@caarmen</a> on 2025-01-07 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-07 19:24</div>
            <div class="timeline-body"><p>Currently keyword arguments are only detected in preview mode:</p>
<p>(from <a href="https://github.com/astral-sh/ruff/blob/a876090715/crates/ruff_linter/src/rules/flake8_pytest_style/rules/parametrize.rs#L881-L890"><code>flake8_pytest_style/rules/parametrize.rs</code></a>)</p>
<pre><code>let names = if checker.settings.preview.is_enabled() {
    call.arguments.find_argument_value(&quot;argnames&quot;, 0)
} else {
    call.arguments.find_positional(0)
};
let values = if checker.settings.preview.is_enabled() {
    call.arguments.find_argument_value(&quot;argvalues&quot;, 1)
} else {
    call.arguments.find_positional(1)
};
</code></pre>
<p>These were added in #14699. The corresponding issue #11243 doesn&#x27;t have any relevant information, so the reason was probably backward compatibility.</p>
<p>Perhaps it&#x27;s safe to remove these preview checks; I think this is by no mean a breaking change, even when <code>PT006</code> is stable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 05:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-08 05:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-01-08 08:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:15 UTC
    </footer>
</body>
</html>
