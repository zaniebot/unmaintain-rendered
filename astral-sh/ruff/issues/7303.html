<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 triggers based on renaming imports - astral-sh/ruff #7303</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 triggers based on renaming imports</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7303">#7303</a>
        opened by <a href="https://github.com/henryiii">@henryiii</a>
        on 2023-09-12 14:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/henryiii">@henryiii</a></div>
            <div class="timeline-body">

<p>Ruff&#x27;s F401 triggers if you import something <em>and</em> rename it, but not if you rename it but keep the name the same.</p>
<p>For example, this file doesn&#x27;t use any of it&#x27;s imports:</p>
<pre><code>from . import clients as clients
from .config import config as config
from .config_training import config as config_training # E: F401 [*] `.config_training.config` imported but unused
from .thing import other as foobar # E: F401 [*] `.thing.other` imported but unused
from . import x as y # E: F401 [*] `.x` imported but unused
from a import b as c # E: F401 [*] `a.b` imported but unused
</code></pre>
<p>Which I&#x27;m running in VI via ALE using the LSP to get the comments, but I can also run it manually:</p>
<pre><code>$ ruff check --isolated --select=F401 example.py
example.py:3:40: F401 [*] `.config_training.config` imported but unused
example.py:4:29: F401 [*] `.thing.other` imported but unused
example.py:5:20: F401 [*] `.x` imported but unused
example.py:6:20: F401 [*] `a.b` imported but unused
Found 4 errors.
[*] 4 potentially fixable with the --fix option.
</code></pre>
<p>Notice that the error doesn&#x27;t trigger if you <code>from a import b as b</code>, but only if you use <code>from a import b as c</code>. This was from an <code>__init__.py</code> file that didn&#x27;t set <code>__all__</code>, which <a href="https://learn.scientific-python.org/development/patterns/exports/">isn&#x27;t a good pattern</a>, and it goes away as it should if you set <code>__all__</code>). But I think it should be consistent. I&#x27;m pretty sure the problem is that <code>from a import b as b</code> is being treated as <code>from a import b; b = b</code> which &quot;uses&quot; <code>b</code>, making it not unused. That&#x27;s a guess.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-12 14:38</div>
            <div class="timeline-body"><p>We allow <code>from a import b as b</code> because it&#x27;s respected by type checkers as a way to &quot;export&quot; the name similar to <code>__all__</code>. See the <a href="https://github.com/microsoft/pyright/blob/ada1ea63e8360fe3bd203bff3b0069c34d142817/docs/typed-libraries.md#library-interface">Pyright documentation section</a> that discusses redundant aliases.</p>
<p>Some related discussion at <a href="https://github.com/astral-sh/ruff/issues/5697">astral-sh/ruff#5697</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-12 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2023-09-12 14:51</div>
            <div class="timeline-body"><p>To me, this looks correct and intended. Whilst both import examples lead to <strong>unused</strong> symbol in the <strong>current</strong> module, both also lead to symbols that <strong>exist</strong> and can be imported by other modules.
<code>from example import clients</code> and <code>from example import y</code> are both valid at runtime.
To keep public interfaces sane, type checkers (and some import linters like pycln, isort, etc.) have a bit of heuristic to define what is private and public, and the form <code>import X as X</code> is how you explicitly flag an import as an intended re-export without having to specify <code>__all__</code> (which affects star imports at runtime).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2023-09-12 14:56</div>
            <div class="timeline-body"><p>That being said, mixing explicit re-exports and <code>__all__</code> isn&#x27;t a great pattern as you&#x27;ve mentioned, and maybe a rule dedicated to that might satisfy your needs and expectations?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-09-12 14:57</div>
            <div class="timeline-body"><p>Okay, I see why it happens, then, but the code that someone originally was confused about:</p>
<pre><code>from .config import config as config
from .config_training import config as config_training
</code></pre>
<p>still seems surprising - you can&#x27;t &quot;reexport&quot; the second <code>config</code>, since it can&#x27;t keep the original name. The current form obviously was trying to reexport, but if it has to be renamed, that doesn&#x27;t work then.</p>
<p>I&#x27;ll just suggest that they use <code>__all__</code>, explicit is better than implicit. And makes the imports look less odd. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/henryiii">@henryiii</a> on 2023-09-12 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-09-12 14:57</div>
            <div class="timeline-body"><p>Thanks, by the way!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-09-12 15:38</div>
            <div class="timeline-body"><blockquote>
<p>maybe a rule dedicated to that might satisfy your needs and expectations?</p>
</blockquote>
<p>I was thinking the best solution would be to not do the explicit reexports, but move entirely to <code>__all__</code>.</p>
<p>I wouldn&#x27;t mind having a rule that enforced all files (that don&#x27;t start with an underscore, anyway) have an <code>__all__</code>, and all non-<code>__init__.py</code> files have a <code>def __dir__()</code> too (actually, I already enforce exactly this in pytest for scikit-build-core). But that&#x27;s pretty specific to following this pattern.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:42 UTC
    </footer>
</body>
</html>
