<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Per-file customisation of builtins - astral-sh/ruff #17663</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Per-file customisation of builtins</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/17663">#17663</a>
        opened by <a href="https://github.com/jakeanq">@jakeanq</a>
        on 2025-04-28 02:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jakeanq">@jakeanq</a> on 2025-04-28 02:13</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>It would be useful to be able to customise the <code>builtins</code> setting on a per-file basis.</p>
<p>We have a specific file that's loaded in a different context to the other Python code in the same project, and as a part of that load process several additional builtins are defined.</p>
<p>Currently the only options that I'm aware of to fix the issue would be:</p>
<ul>
<li>Disable the <code>F821</code> rule with a per-file ignore.  This means we lose the ability to catch any other things that might be undefined in the file.</li>
<li>Add the extra builtins to the global list, which is not ideal as the list of added builtins includes some commonly-used names like <code>env</code>.</li>
</ul>
<p>While it's not necessary for my use-case, I could also see it being useful to have per-file customisation of some other config options such as <code>line-length</code> and the options in the various <code>lint.*</code> sections.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Daverball">@Daverball</a> on 2025-04-28 06:27</div>
            <div class="timeline-body"><p>You could also move the module into a package with a single <code>__init__.py</code> and put a <code>ruff.toml</code> in that folder that extends your base config with your desired <code>builtins</code> section. See <a href="https://docs.astral.sh/ruff/configuration/#config-file-discovery">Config File Discovery</a> in the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jakeanq">@jakeanq</a> on 2025-04-28 06:31</div>
            <div class="timeline-body"><p>Unfortunately in this case I'm restricted by where the file can live (it has to be in the root of the repository).  For now I'm going to go with a per-file ignore of the rule.</p>
<p>Thanks for the suggestion though, much appreciated ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2025-04-28 06:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @MichaReiser on 2025-04-28 06:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-28 06:33</div>
            <div class="timeline-body"><p>That makes sense. I think we have to wait with adding such a configuration option until we have a more general approach for <em>per-file</em> options than adding *per-file-** settings for each of them. We plan on trying a new approach with our new type checker red-knot and might decide to port it to Ruff if it proves to work well.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
