<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False `RUF012` on empty mutable collections as default values in `msgspec.Struct`s - astral-sh/ruff #7785</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False <code>RUF012</code> on empty mutable collections as default values in <code>msgspec.Struct</code>s</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7785">#7785</a>
        opened by <a href="https://github.com/floxay">@floxay</a>
        on 2023-10-03 16:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/floxay">@floxay</a></div>
            <div class="timeline-body"><p><code>msgspec.Structs</code> allow empty mutable collections as default values, however Ruff currently warns about these.<br />
<a href="https://jcristharif.com/msgspec/structs.html#default-values">Docs</a>:</p>
<blockquote>
<p>Builtin empty mutable collections ([], {}, set(), and bytearray()) may be used as default values (as in c above). Since defaults of these types are so common, these are “syntactic sugar” for specifying the corresponding default_factory (to avoid accidental sharing of mutable values). A default of [] is identical to a default of field(default_factory=list), with a new list instance used each time.</p>
</blockquote>
<p>Ruff version: <code>0.0.292</code></p>
<p>MRE:</p>
<pre><code class="language-py">import msgspec

class Example(msgspec.Struct):
    c: list[int] = []  # Mutable class attributes should be annotated with `typing.ClassVar` Ruff(RUF012)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-03 16:02</div>
            <div class="timeline-body"><p>Thanks, will fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-10-03 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-10-03 16:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:32 UTC
    </footer>
</body>
</html>
