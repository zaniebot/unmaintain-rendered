<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I001 (isort) local vs CI ordering differs for wandb - astral-sh/ruff #8571</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>I001 (isort) local vs CI ordering differs for wandb</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8571">#8571</a>
        opened by <a href="https://github.com/StuartMesham">@StuartMesham</a>
        on 2023-11-08 22:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/StuartMesham">@StuartMesham</a></div>
            <div class="timeline-body">Summary
<p>Isort places the wandb import at different positions when I run ruff locally compared to on my CI.</p>
Problem description
<p>In <a href="https://github.com/StuartMesham/transformer-stu/blob/e141468a96e2c58a9a90135bc8ec84008d1c05d5/train.py">this file</a> I have the following imports:</p>
<pre><code>import os.path
import shutil
from functools import partial
from glob import glob

import click
import jax
import jax.numpy as jnp
import optax
import tensorflow as tf
import tensorflow_text as tf_text
import wandb
from flax.training.early_stopping import EarlyStopping
from flax.training.train_state import TrainState
from jax import random
from orbax.checkpoint import (
    CheckpointManager,
    CheckpointManagerOptions,
    PyTreeCheckpointer,
)
from tqdm.auto import tqdm

from data_loading import bucket, get_translation_dataset
from transformer import Transformer
</code></pre>
<p>This passes (is unmodified by) my <a href="https://github.com/StuartMesham/transformer-stu/blob/e141468a96e2c58a9a90135bc8ec84008d1c05d5/.github/workflows/ci.yml">GitHub action</a>. When I run it <a href="https://github.com/StuartMesham/transformer-stu/blob/e141468a96e2c58a9a90135bc8ec84008d1c05d5/.pre-commit-config.yaml">locally via pre-commit</a> using <code>pre-commit run --all-files</code>, it makes the following modification:</p>
<pre><code>@@ -9,7 +9,6 @@
 import optax
 import tensorflow as tf
 import tensorflow_text as tf_text
-import wandb
 from flax.training.early_stopping import EarlyStopping
 from flax.training.train_state import TrainState
 from jax import random
@@ -20,6 +19,7 @@
 )
 from tqdm.auto import tqdm
 
+import wandb
 from data_loading import bucket, get_translation_dataset
 from transformer import Transformer
</code></pre>
<p>If I remove the <code>--fix</code> argument from my <code>.pre-commit-config.yaml</code> I see that it&#x27;s outputting the <code>I001</code> (Import block is un-sorted or un-formatted) error code.</p>
Expected behaviour
<p>The file should not be modified run I run <code>pre-commit run --all-files</code> locally.</p>
My environment
<p>I&#x27;m using ruff version 0.4.1.</p>
<p>Here&#x27;s my <code>ruff.toml</code>:</p>
<pre><code>target-version = &quot;py311&quot;

select = [&quot;F&quot;, &quot;W&quot;, &quot;I&quot;, &quot;D&quot;, &quot;UP&quot;]
ignore = [&quot;D100&quot;]

[lint.pydocstyle]
convention = &quot;google&quot;

[lint.pycodestyle]
max-doc-length = 120
</code></pre>
<p>Thanks in advance for any help!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 00:43</div>
            <div class="timeline-body"><p>@StuartMesham - This happens occasionally with <code>wandb</code> specifically because it often creates a <code>wandb</code> directory in your project, and then Ruff thinks that this <code>wandb</code> directory means <code>wandb</code> is a first-party dependency. Can you try either removing your local <code>wandb</code> directory (if it exists), or marking it as known-third-party?</p>
<pre><code>[isort]
known-third-party = [&quot;wandb&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-09 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;I001 (isort) inconsistent results on Apple Silicon vs x86&quot; to &quot;I001 (isort) local vs CI ordering differs for wandb&quot; by <a href="https://github.com/StuartMesham">@StuartMesham</a> on 2023-11-09 07:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/StuartMesham">@StuartMesham</a> on 2023-11-09 07:20</div>
            <div class="timeline-body"><p>Thanks @charliermarsh that solved it!</p>
<p>I have updated the issue title and description to make it easier for others to find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/StuartMesham">@StuartMesham</a> on 2023-11-09 07:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:45 UTC
    </footer>
</body>
</html>
