<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow noqa on preceding line - astral-sh/ruff #2999</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow noqa on preceding line</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2999">#2999</a>
        opened by <a href="https://github.com/NeilGirdhar">@NeilGirdhar</a>
        on 2023-02-17 23:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/NeilGirdhar">@NeilGirdhar</a> on 2023-02-17 23:08</div>
            <div class="timeline-body"><p>Would it be possible to place the ignore comment on the preceding line?  Something like:</p>
<pre><code class="language-python">    def to_exp(self) -&gt; VonMisesFisherEP:
        q = self.mean_times_concentration
        kappa: RealArray = jnp.linalg.norm(q, 2, axis=-1, keepdims=True)
        # noqa: PLR2004
        return VonMisesFisherEP(jnp.where(kappa == 0.0, q, q * (_a_k(d, kappa) / kappa)))
</code></pre>
<p>in addition to</p>
<pre><code class="language-python">    def to_exp(self) -&gt; VonMisesFisherEP:
        q = self.mean_times_concentration
        kappa: RealArray = jnp.linalg.norm(q, 2, axis=-1, keepdims=True)
        return VonMisesFisherEP(
            jnp.where(kappa == 0.0,  # noqa: PLR2004
                      q,
                      q * (_a_k(d, kappa) / kappa)))
</code></pre>
<p>The latter sometimes requires breaking long lines of code in unnatural places.  The simple rule would be if <code>noqa</code> occurs on a line <em>without any code</em>, then it applies to the next line <em>that has code in it</em>.</p>
<p>This will be even more useful if human-friend rule names https://github.com/charliermarsh/ruff/issues/1773 are implemented since then the rule names will be longer, breaking even more lines of code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">noqa</span> added by @charliermarsh on 2023-02-17 23:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesbraza">@jamesbraza</a> on 2023-05-26 20:41</div>
            <div class="timeline-body"><p>For reference, <a href="https://pylint.readthedocs.io/en/latest/user_guide/messages/message_control.html"><code>pylint</code> has a <code>disable-next</code> directive</a>, which accomplishes this nicely.</p>
<p>So similarly, there could be <code># noqa-next</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NeilGirdhar">@NeilGirdhar</a> on 2024-04-07 20:37</div>
            <div class="timeline-body"><p><code>noqa-next</code> is a cool idea.  If we're going down that road, you could also have:</p>
<ul>
<li><code>noqa-file</code>: At the top of a file to indicate blocking the whole file.</li>
<li><code>noqa-block</code>: At the start of a block to indicate that it's for the entire block (function, if, while, etc.)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-04-07 21:32</div>
            <div class="timeline-body"><p>I think if/when we go this route we'd use directives similar to the Rust ecosystem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/NeilGirdhar">@NeilGirdhar</a> on 2024-04-08 02:02</div>
            <div class="timeline-body"><p>@zanieb What are those like?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:24 UTC
    </footer>
</body>
</html>
