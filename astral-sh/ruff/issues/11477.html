<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C901: The `max-complexity` linting rule does not appear to work - astral-sh/ruff #11477</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>C901: The <code>max-complexity</code> linting rule does not appear to work</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11477">#11477</a>
        opened by <a href="https://github.com/grahamlyons">@grahamlyons</a>
        on 2024-05-20 14:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/grahamlyons">@grahamlyons</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Adding the following into a <code>ruff.toml</code> config file and running <code>ruff check -v</code> against the file produces no violations, whereas <code>flake8</code> with <code>mccabe</code> flags the code as too complex.</p>
<pre><code class="language-toml">[lint.mccabe]
# Flag errors (`C901`) whenever the complexity level exceeds 5.
max-complexity = 3
</code></pre>
<p>Example code:</p>
<pre><code class="language-python">def foo(a, b, c):
    if a:
        if b:
            if c:
                return 1
            else:
                return 2
        else:
            return 3
    else:
        return 4
</code></pre>
<p>Output from <code>flake8</code>:</p>
<pre><code class="language-shell"># flake8 --max-complexity=3 test.py 
test.py:2:1: C901 'foo' is too complex (4)
</code></pre>
<p>Output from <code>ruff</code>:</p>
<pre><code class="language-shell"># ruff check test.py  -v
[2024-05-20][08:47:12][ruff::resolve][DEBUG] Using configuration file (via parent) at: /workspaces/ruff-test/ruff.toml
[2024-05-20][08:47:12][ruff_workspace::pyproject][DEBUG] `project.requires_python` in `pyproject.toml` will not be used to set `target_version` when using `ruff.toml`.
[2024-05-20][08:47:12][ruff::commands::check][DEBUG] Identified files to lint in: 2.615875ms
[2024-05-20][08:47:12][ruff::commands::check][DEBUG] Checked 1 files in: 31.084Âµs
All checks passed!
</code></pre>
<p>Ruff version:
<code>ruff --version: ruff 0.4.4</code></p>
<p>This looks to be a bug but if I'm doing something wrong then please let me know.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 14:13</div>
            <div class="timeline-body"><p>Did you add <code>C901</code> to the list of enabled rules? That rule isn't enabled by default. Something like:</p>
<pre><code class="language-toml">[lint]
extend-select = [&quot;C901&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grahamlyons">@grahamlyons</a> on 2024-05-20 14:16</div>
            <div class="timeline-body"><p>Thanks for the quick response - that was the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @grahamlyons on 2024-05-20 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-20 14:16</div>
            <div class="timeline-body"><p>No prob.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:17 UTC
    </footer>
</body>
</html>
