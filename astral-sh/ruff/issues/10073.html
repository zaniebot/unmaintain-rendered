<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerPC pip package is not suitable for systems with 64 KiB pages - astral-sh/ruff #10073</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PowerPC pip package is not suitable for systems with 64 KiB pages</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10073">#10073</a>
        opened by <a href="https://github.com/nwf">@nwf</a>
        on 2024-02-21 18:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nwf">@nwf</a> on 2024-02-21 18:48</div>
            <div class="timeline-body"><p>I'm not sure if this is the right place; if not, please point me in the right direction and sorry for the noise.</p>
<p>Trying to run the <code>pip</code> packaged <code>ruff</code> on Debian 12.2 on a PowerPC LE system (in Docker, on a Raptor Computing Talos II workstation, if it matters) whose <code>uname -a</code> describes itself as <code>Linux 0abaa1dc35a7 6.1.0-13-powerpc64le #1 SMP Debian 6.1.55-1 (2023-09-29) ppc64le GNU/Linux</code> results in a very short trip:</p>
<pre><code>root@0abaa1dc35a7:/# python3 -m venv /root/venv

root@0abaa1dc35a7:/# /root/venv/bin/pip3 install ruff
Collecting ruff
  Using cached ruff-0.2.2-py3-none-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl (8.2 MB)
Installing collected packages: ruff
Successfully installed ruff-0.2.2

root@0abaa1dc35a7:/# /root/venv/bin/ruff
&lt;jemalloc&gt;: Unsupported system page size
&lt;jemalloc&gt;: Unsupported system page size
memory allocation of 5 bytes failed
Aborted (core dumped)
</code></pre>
<p>Debian builds their PowerPC kernels to use 64 KiB pages; <code>/boot/config-$(uname -r)</code> contains</p>
<pre><code># CONFIG_PPC_4K_PAGES is not set
CONFIG_PPC_64K_PAGES=y
CONFIG_PAGE_SIZE_64KB=y
CONFIG_PPC_PAGE_SHIFT=16
</code></pre>
<p>~~I <em>suspect</em> that~~ configuring <code>jemalloc</code> to assume 64 KiB pages will allow it to also function on 4 KiB page systems: https://github.com/jemalloc/jemalloc/issues/2572#issuecomment-1823559681</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-21 21:41</div>
            <div class="timeline-body"><p>I think this is the same root cause as https://github.com/astral-sh/ruff/issues/3791#issuecomment-1489722670</p>
<p>The difference is that you're building from source. So you would have to set the env variable yourself as far as I understand. @konstin or is there a way for us to set an env variable in the wheel code?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nwf">@nwf</a> on 2024-02-21 21:48</div>
            <div class="timeline-body"><p>I didn't <em>mean</em> to be building from source.  I see that the log I attached above was the second time through so <code>pip</code> said &quot;Using cached&quot; rather than &quot;Downloading&quot; but it definitely downloaded the first time:</p>
<pre><code>root@0abaa1dc35a7:/# python3 -m venv /usr/local/pyvenv &amp;&amp; /usr/local/pyvenv/bin/pip3 install ruff
Collecting ruff
  Downloading ruff-0.2.2-py3-none-manylinux_2_17_ppc64le.manylinux2014_ppc64le.whl (8.2 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 8.2/8.2 MB 11.1 MB/s eta 0:00:00
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2024-02-22 09:40</div>
            <div class="timeline-body"><blockquote>
<p>is there a way for us to set an env variable in the wheel code?</p>
</blockquote>
<p>maturin doesn't support this atm, but it should be passed through if you set it outside the build command.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-02-23 07:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:32:52 UTC
    </footer>
</body>
</html>
