<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff should warn on all CPython SyntaxWarnings - astral-sh/ruff #20196</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff should warn on all CPython SyntaxWarnings</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20196">#20196</a>
        opened by <a href="https://github.com/JelleZijlstra">@JelleZijlstra</a>
        on 2025-09-01 15:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JelleZijlstra">@JelleZijlstra</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>CPython emits a SyntaxWarning for certain code, but SyntaxWarnings have some issues that can make them difficult to reliably detect in CI (current discussion in <a href="discuss.python.org">https://discuss.python.org/t/pep-765-disallow-return-break-continue-that-exit-a-finally-block/71348</a> about PEP 765). So it would be nice if Ruff could guarantee that it emits an error on any code for which CPython would produce a SyntaxWarning.</p>
<p>Here is a <a href="https://play.ruff.rs/0437f5dd-3ea3-463c-b27e-71814287282e">playground link</a> covering all current SyntaxWarnings I could find in the CPython source code. Ruff already warns for most of them, though the logic may not always match exactly.</p>
<ul>
<li>Invalid numeric literals (e.g., <code>123or 1</code>) <a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Parser/lexer/lexer.c#L346">lexer.c</a><ul>
<li>Not implemented in Ruff. See <a href="https://discuss.python.org/t/whats-going-on-with-syntaxwarning-invalid-decimal-literal/52694">this thread</a> and linked discussions for background.</li>
</ul>
</li>
<li>Invalid escape sequences in strings (e.g., <code>&quot;\99&quot;</code>) <a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Parser/string_parser.c#L47">string_parser.c</a><ul>
<li>Ruff W605. Might need auditing of the code to verify this matches the CPython logic exactly.</li>
</ul>
</li>
<li>Backslash next to <code>{</code> or <code>}</code> in f-strings or t-strings (e.g., <code>f&quot;\{1}&quot;</code>) (<a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Parser/lexer/lexer.c#L1578">lexer.c</a>)<ul>
<li>Also W605, but uses a different code path in CPython.</li>
</ul>
</li>
<li>Control flow in a <code>finally</code> block (see PEP 765) (<a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Python/ast_preprocess.c#L71">ast_preprocess.c</a>)<ul>
<li>Ruff B012.</li>
</ul>
</li>
<li><code>is</code> / <code>is not</code> with a literal (<code>() is ()</code>) <a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Python/codegen.c#L1836">codegen.c</a><ul>
<li>Ruff F632.</li>
</ul>
</li>
<li><code>assert</code> that is always true (<code>assert (1,)</code>) <a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Python/codegen.c#L2951">codegen.c</a><ul>
<li>Ruff F631.</li>
</ul>
</li>
<li>Calling something that definitely isn't callable (<code>{}()</code>) <a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Python/codegen.c#L3650">codegen.c</a><ul>
<li>Not implemented in Ruff. Type checkers will surely catch this (and more), but it may be valuable to add a rule specifically for the SyntaxWarning-triggering code here.</li>
</ul>
</li>
<li>Subscripting something that definitely is not subscriptable (<code>{1}[1]</code>) <a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Python/codegen.c#L3679">codegen.c</a><ul>
<li>Not implemented in Ruff; similar considerations to the last one.</li>
</ul>
</li>
<li>Using a wrong index type for some types (<code>&quot;a&quot;[&quot;b&quot;]</code>) <a href="https://github.com/python/cpython/blob/2a54acf3c3d9f388c3d878a17ea804a801affca9/Python/codegen.c#L3715">codegen.c</a><ul>
<li>Ruff RUF016.</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-09-02 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-09-02 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @ntBre on 2025-09-02 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @ntBre on 2025-09-02 13:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:16 UTC
    </footer>
</body>
</html>
