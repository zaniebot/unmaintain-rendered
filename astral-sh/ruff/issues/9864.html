<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test display_default_settings fails downstream - astral-sh/ruff #9864</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Test display_default_settings fails downstream</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9864">#9864</a>
        opened by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a>
        on 2024-02-06 21:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/WhyNotHugo">@WhyNotHugo</a></div>
            <div class="timeline-body"><p>Alpine's package runs the tests suite during builds to confirm some sanity.
The test <code>display_default_settings</code> fails downstream.</p>
<pre><code>     Running tests/show_settings.rs (target/debug/deps/show_settings-bed726651286f822)

running 1 test
stored new snapshot /home/hugo/src/gitlab.alpinelinux.org/alpine/aports/testing/ruff/src/ruff-0.2.1/crates/ruff/tests/snapshots/show_settings__display_default_settings.snap.new
test display_default_settings ... FAILED

failures:

---- display_default_settings stdout ----
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” Snapshot Summary â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Snapshot file: crates/ruff/tests/snapshots/show_settings__display_default_settings.snap
Snapshot: display_default_settings
Source: crates/ruff/tests/show_settings.rs:26
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
program: ruff
args:
  - check
  - &quot;--show-settings&quot;
  - unformatted.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-old snapshot
+new results
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   51    51 â”‚ 	&quot;**/pyproject.toml&quot;,
   52    52 â”‚ ]
   53    53 â”‚ file_resolver.extend_include = []
   54    54 â”‚ file_resolver.respect_gitignore = true
   55       â”‚-file_resolver.project_root = &quot;[BASEPATH]&quot;
         55 â”‚+file_resolver.project_root = &quot;/home/hugo/src/gitlab.alpinelinux.org/alpine/aports/testing/ruff/src/ruff-0.2.1&quot;
   56    56 â”‚ 
   57    57 â”‚ # Linter Settings
   58    58 â”‚ linter.exclude = []
   59       â”‚-linter.project_root = &quot;[BASEPATH]&quot;
         59 â”‚+linter.project_root = &quot;/home/hugo/src/gitlab.alpinelinux.org/alpine/aports/testing/ruff/src/ruff-0.2.1&quot;
   60    60 â”‚ linter.rules.enabled = [
   61    61 â”‚ 	MultipleImportsOnOneLine,
   62    62 â”‚ 	ModuleImportNotAtTopOfFile,
   63    63 â”‚ 	MultipleStatementsOnOneLineColon,
â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”¼â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ
  194   194 â”‚ linter.external = []
  195   195 â”‚ linter.ignore_init_module_imports = false
  196   196 â”‚ linter.logger_objects = []
  197   197 â”‚ linter.namespace_packages = []
  198       â”‚-linter.src = [&quot;[BASEPATH]&quot;]
        198 â”‚+linter.src = [&quot;/home/hugo/src/gitlab.alpinelinux.org/alpine/aports/testing/ruff/src/ruff-0.2.1&quot;]
  199   199 â”‚ linter.tab_size = 4
  200   200 â”‚ linter.line_length = 88
  201   201 â”‚ linter.task_tags = [
  202   202 â”‚ 	TODO,
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
To update snapshots run `cargo insta review`
Stopped on the first failure. Run `cargo insta test` to run all snapshots.
thread 'display_default_settings' panicked at 'snapshot assertion for 'display_default_settings' failed in line 26', /home/hugo/.local/state/cargo/registry/src/index.crates.io-6f17d22bba15001f/insta-1.34.0/src/runtime.rs:563:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    display_default_settings

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.06s

error: test failed, to rerun pass `-p ruff --test show_settings`
</code></pre>
<p>Looks like this <code>BASEPATH</code></p>
<p>I checked other distributions, and they seem to also skip this test:</p>
<ul>
<li>Gentoo: https://gitweb.gentoo.org/repo/gentoo.git/tree/dev-util/ruff/files/ruff-0.1.14-tests.patch?id=a186698019a008ad1aba682fa2b4cd95be916f3a</li>
<li>ArchLinux https://gitlab.archlinux.org/archlinux/packaging/packages/ruff/-/blob/main/PKGBUILD?ref_type=heads#L41</li>
</ul>
<p>Do you know what could be causing the above issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-06 21:15</div>
            <div class="timeline-body"><p>Thanks -- I'll take a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-06 21:31</div>
            <div class="timeline-body"><p>It looks like the filter assumes that the directory name is <code>&quot;ruff&quot;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-02-06 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-02-06 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-07 03:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-07 03:28</div>
            <div class="timeline-body"><p>Should be fixed in the next release, but please let me know if not. I changed the test to use the current working directory rather than hard-coding <code>&quot;ruff&quot;</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-07 04:25</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a> on 2024-02-07 14:40</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a> on 2024-02-18 13:24</div>
            <div class="timeline-body"><p>No issues with 0.2.2 :+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-18 13:35</div>
            <div class="timeline-body"><p>Thank you for following up! ğŸ™</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:34 UTC
    </footer>
</body>
</html>
