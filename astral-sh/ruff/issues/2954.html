<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update bugbear - astral-sh/ruff #2954</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Update bugbear</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/2954">#2954</a>
        opened by <a href="https://github.com/henryiii">@henryiii</a>
        on 2023-02-16 14:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-16 14:37</div>
            <div class="timeline-body"><p>Looks like bugbear has new rules:</p>
<ul>
<li>[x] B028: No explicit stacklevel keyword argument found. The warn method from the warnings module uses a stacklevel of 1 by default. This will only show a stack trace for the line on which the warn method is called. It is therefore recommended to use a stacklevel of 2 or greater to provide more information to the user.</li>
<li>[x] B029: Using except (): with an empty tuple does not handle/catch anything. Add exceptions to handle.</li>
<li>[x] B030: Except handlers should only be exception classes or tuples of exception classes.</li>
<li>[x] B031: Using the generator returned from itertools.groupby() more than once will do nothing on the second usage. Save the result to a list if the result is needed multiple times.</li>
<li>[x] B032: Possible unintentional type annotation (using :). Did you mean to assign (using =)?</li>
</ul>
<p>Also, some of the B9 rules are nice if opted into explicitly and seem to be missing (B90x except ~~B901 (Python 2 related)~~ &amp; B907 which is nice but poorly implemented in bugbear) - only B904 is present.</p>
<p>I don't actually <em>need</em> these for something specific, just noticed this due to an incorrect noqa and thought a tracking issue would be useful.</p>
<p>Opinionated checks:</p>
<ul>
<li>[ ] B901: Using <code>return x</code> in a generator function. <em>(Somewhat bad reasoning in description, talks about Python 2, see comments below.)</em></li>
<li>[ ] B902: Invalid first argument used for method.</li>
<li>[ ] B903: Use collections.namedtuple (or typing.NamedTuple) for data classes that only set attributes in an <strong>init</strong> method, and do nothing else. <em>(Probably should include dataclasses recommendation? NamedTuple injects extra tuple methods and is meant for backward compat, not a data class replacement. That's <code>dataclasses</code> nowadays.)</em></li>
<li>[ ] B906: <code>visit_</code> function with no further call to a <code>visit</code> function.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">plugin</span> added by @charliermarsh on 2023-02-16 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @charliermarsh on 2023-02-17 23:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-17 23:44</div>
            <div class="timeline-body"><p>(Good rules if anyone's looking for a first issue :))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-20 20:57</div>
            <div class="timeline-body"><p>B029 implemented in #3068.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-21 19:50</div>
            <div class="timeline-body"><p>B032 implemented in #3085.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjdemartini">@sjdemartini</a> on 2023-02-22 21:18</div>
            <div class="timeline-body"><p>Would it be possible to add B901 to the checklist above? (I'm not sure I understand the original caveat about it in the description.)</p>
<p>I haven't contributed to ruff before (or used Rust), but might be interested in trying. That rule is the only one keeping me from migrating to ruff from flake8/flake8-bugbear. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-23 02:34</div>
            <div class="timeline-body"><p>B901 is really a Python 2 compatibly rule, so I'd assume it is really low priority (and when Python 2 is gone, there's no need to outlaw perfectly valid Python 3 syntax for compatibility with Python 2 anymore).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjdemartini">@sjdemartini</a> on 2023-02-23 03:12</div>
            <div class="timeline-body"><p>@henryiii Hm, I don't think that fully captures the utility of the rule. It's valid syntax in Python 3 as you say, but like most of the B9 opinionated rules in bugbear, the point is that the syntax (<code>return x</code> within a generator) can be misused and lead to difficult-to-discover bugs. Here's one example (all python 3):</p>
<pre><code class="language-python">from collections.abc import Iterable
from pathlib import Path

def get_file_paths(file_types: Iterable[str] | None = None) -&gt; Iterable[Path]:
    dir_path = Path('.')
    if file_types is None:
        return dir_path.glob(&quot;*&quot;)

    for file_type in file_types:
        yield from dir_path.glob(f&quot;*.{file_type}&quot;)
</code></pre>
<p>While one might assume that the above will give an iterable of all paths in the directory if <code>file_types</code> is None, instead it passes the returned argument to <code>StopIteration</code>, so it yields no results:</p>
<pre><code class="language-python">&gt;&gt;&gt; list(get_file_paths(file_types=[&quot;cfg&quot;, &quot;toml&quot;]))
[PosixPath('.bumpversion.cfg'),
 PosixPath('setup.cfg'),
 PosixPath('pyproject.toml')]
&gt;&gt;&gt; list(get_file_paths())
[]
</code></pre>
<p>B901 catches this, since the syntax/behavior that the author of the code likely intended was:</p>
<pre><code class="language-python">def get_file_paths_fixed(file_types: Iterable[str] | None = None) -&gt; Iterable[Path]:
    dir_path = Path('.')
    if file_types is None:
        yield from dir_path.glob(&quot;*&quot;)
    else:
        for file_type in file_types:
            yield from dir_path.glob(f&quot;*.{file_type}&quot;)
</code></pre>
<p>which works:</p>
<pre><code class="language-python">&gt;&gt;&gt; list(get_file_paths_fixed())
[PosixPath('.pylintrc'),
 PosixPath('.DS_Store'),
 PosixPath('pyproject.toml'),
 PosixPath('.bumpversion.cfg'),
 PosixPath('tests'),
 PosixPath('README.md'),
 ...]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-02-23 13:46</div>
            <div class="timeline-body"><p>Thanks for the explanation - then the original explanation for B001 isn't ideal. I've added the opinionated rules above, including B001. B007 would actually be nice too if Ruff was smart enough to only include it if the target Python version was high enough - flake8 &amp; bugbear can't do this, as they don't have a target Python setting like Ruff has.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjdemartini">@sjdemartini</a> on 2023-02-23 16:25</div>
            <div class="timeline-body"><p>Thanks for discussing; agreed that the bugbear README's B901 explanation isn't great. One note: looks like you meant B901-B907 in your latest comment and edits to the checklist (rather than B001-B007, which are actually already implemented in Ruff).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aacunningham">@aacunningham</a> on 2023-03-08 05:37</div>
            <div class="timeline-body"><p>Not sure where best to discuss it, but I've been looking at B030. How closely do we need to implement the solution from the base package? I looked over bugbear's code for B030 and maybe found a bug in it(?), so not sure whether to implement the bug or try to make ruff a little smarter than that (with big emphasis on <em>little</em> smarter).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3400.html">astral-sh/ruff#3400</a> on 2023-03-08 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3550.html">astral-sh/ruff#3550</a> on 2023-03-15 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-03-22 16:41</div>
            <div class="timeline-body"><p>I'll take up the last rule (B031) üöÄ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3680.html">astral-sh/ruff#3680</a> on 2023-03-23 09:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-24 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjdemartini">@sjdemartini</a> on 2023-03-24 21:45</div>
            <div class="timeline-body"><p>@charliermarsh it looks like this issue was closed prematurely with the merging of the B031 rule PR. There are still 4 opinionated rules listed in the description which haven't yet been implemented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-24 23:41</div>
            <div class="timeline-body"><p>Let's open a new issue for those. To me the goal here was to regain parity based on bugbear updates.</p>
<p>I will mention that the challenge with including opinionated rules is that they'll be enabled by default by any users that have <code>select = [&quot;B&quot;]</code> in their configuration, unlike in <code>flake8</code>, where plugins are turned on implicitly by way of being installed in the environment (and so users <em>have</em> to explicitly enable the <code>B900</code> rules, since they're not part of the <code>flake8-bugbear</code> defaults -- at least, that's my understanding). We don't really have a way to require users to explicitly opt-in to a rule beyond opting in to a plugin. So, in some contexts, this will feel like a divergence from <code>flake8-bugbear</code>.</p>
<p>For me, right now that means potentially being a bit more picky about which of the opinionated rules we include...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3758.html">astral-sh/ruff#3758</a> on 2023-03-27 16:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sjdemartini">@sjdemartini</a> on 2023-03-27 16:10</div>
            <div class="timeline-body"><p>Sounds good, and that makes sense üëç  I opened a separate issue to track the opinionated rules here https://github.com/charliermarsh/ruff/issues/3758</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/henryiii">@henryiii</a> on 2023-03-27 16:15</div>
            <div class="timeline-body"><p>IIUC, Flake8 makes all X9** opt-in only, so you have to do <code>B,B9</code> to get both the base and B9xx rules. (It's possible this is configurable by the plugin, and it just happens that most of them use X9xx, but I <em>think</em> it's automatic?). If so, then maybe a way forward in Ruff would be to duplicate that behavior - <code>B</code> would not select <code>B9xx</code>, and you'd have to specify <code>B9</code> or (better) the individual codes to get them? I feel like, even it wasn't automatic (which, given there are no Ruff plugins, wouldn't be needed), there's likely enough in the current config system to split <code>B</code> and <code>B9</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11644.html">astral-sh/ruff#11644</a> on 2024-05-31 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11977.html">astral-sh/ruff#11977</a> on 2024-06-21 21:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:08 UTC
    </footer>
</body>
</html>
