<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyntaxError when unpacking sequences inside of [] - astral-sh/ruff #6078</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>SyntaxError when unpacking sequences inside of []</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6078">#6078</a>
        opened by <a href="https://github.com/Morkunas">@Morkunas</a>
        on 2023-07-25 21:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Morkunas">@Morkunas</a> on 2023-07-25 21:06</div>
            <div class="timeline-body"><p>Ruff version: 0.0.280
Python version: 3.8.10</p>
<p>Command run:
<code>ruff check code.py</code>
Contents of <code>code.py</code>:</p>
<pre><code>c = {}
c[(*[1, 2]), 3] = 4
</code></pre>
<p>This is a valid Python 3.8 code, which creates a dictionary <code>{(1, 2, 3): 4}</code>. The above invocation of ruff however throws this error:</p>
<p><code>E999 SyntaxError: cannot use starred expression here</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-25 21:13</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-07-25 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">parser</span> added by @konstin on 2023-07-26 10:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-27 14:43</div>
            <div class="timeline-body"><p>Fixing this requires that our parser supports parsing different python versions by passing a <em>python version</em> to the parser and respecting it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-27 15:02</div>
            <div class="timeline-body"><p>Why is that required? Don't we just parse a superset?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-27 15:58</div>
            <div class="timeline-body"><blockquote>
<p>Why is that required? Don't we just parse a superset?</p>
</blockquote>
<p>We could do that, but I don't think that's what the parser does today. I would expect my linter to warn me about this syntax error when I target Python 3.12, so that I don't have to find out at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-27 16:10</div>
            <div class="timeline-body"><p>But that’s valid syntax under Python 3.12. Do you mean, if you target Python 3.7?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-27 16:11</div>
            <div class="timeline-body"><p>And I believe that <em>is</em> what the parser does today. We parse all valid Python 3.12 syntax, even if the user is targeting earlier Python versions. But I may be misunderstanding your comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-07-27 16:16</div>
            <div class="timeline-body"><blockquote>
<p>But that’s valid syntax under Python 3.12. Do you mean, if you target Python 3.7?</p>
</blockquote>
<p>I need to double check but I pasted it into Python 3.12 and it failed with a syntax error</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-27 16:52</div>
            <div class="timeline-body"><p>Huh, interesting... I agree, it seems to work on Python 3.8 but not later versions. That's very confusing to me, I had thought that they'd increased the number of locations in which starred expressions were supported, not that they'd made backwards incompatible changes. We can't really support this right now though, since we don't support version upper-bounds, only lower-bounds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-27 16:58</div>
            <div class="timeline-body"><p>Related: https://github.com/astral-sh/ruff/issues/2321</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-07-27 17:02</div>
            <div class="timeline-body"><p>Yeah interesting...</p>
<pre><code>Python 3.7.17
OK

Python 3.8.17
OK

Python 3.9.17
  File &quot;&lt;string&gt;&quot;, line 1
    c = {}; c[(*[1, 2]), 3] = 4
               ^
SyntaxError: can't use starred expression here

Python 3.10.12
  File &quot;&lt;string&gt;&quot;, line 1
    c = {}; c[(*[1, 2]), 3] = 4
               ^^^^^^^
SyntaxError: cannot use starred expression here

Python 3.11.4
  File &quot;&lt;string&gt;&quot;, line 1
    c = {}; c[(*[1, 2]), 3] = 4
               ^^^^^^^
SyntaxError: cannot use starred expression here

Python 3.12.0b4+
  File &quot;&lt;string&gt;&quot;, line 1
    c = {}; c[(*[1, 2]), 3] = 4
               ^^^^^^^
SyntaxError: cannot use starred expression here
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-27 17:03</div>
            <div class="timeline-body"><p>My best guess is that this was an unintentional change from <a href="https://peps.python.org/pep-0646/#grammar-changes">PEP 646</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-07-27 17:04</div>
            <div class="timeline-body"><p>Agreed — I haven't found a bug report upstream yet. I could open one unless someone else knows of an existing issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-28 04:28</div>
            <div class="timeline-body"><p>I read through this issue in CPython which was flagged to me on <a href="https://twitter.com/isidentical/status/1684683536790335489">Twitter</a>: https://github.com/python/cpython/issues/84811#issuecomment-1093871867.</p>
<p>It sounds like Guido effectively considers it a bug that this worked in earlier versions of Python 3. I am inclined to mark this as <code>wontfix</code>, since it stopped working some time around Python 3.9 (<a href="https://twitter.com/mgdotdev/status/1684615055692951552">Twitter</a>) and wasn't an intentional part of the grammar.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-28 04:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
