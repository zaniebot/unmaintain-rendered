<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug with uppercase `# noqa: SIM114` and RUF100 - astral-sh/ruff #6025</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bug with uppercase <code># noqa: SIM114</code> and RUF100</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6025">#6025</a>
        opened by <a href="https://github.com/sondrfos">@sondrfos</a>
        on 2023-07-24 08:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sondrfos">@sondrfos</a></div>
            <div class="timeline-body">

<p>Hi,</p>
<p>Thanks for making Ruff, it&#x27;s an exellent linter :)</p>
<p>We just recently updated our project to Ruff 0.0.280 and seems to experience a weird bug.
Our code uses a rather large if-statement pulled straight form a research paper. To keep the code and the paper pretty equal, the code is written the exact same way as the paper. This means that we need to ignore some SIM114-warnings.</p>
<p>When updating to 0.0.280 we started to receive a warning
<code>RUF100 [*] Unused `noqa` directive (unused: `SIM114`)</code>
However, when removing the <code># noqa: SIM114</code> we start to receive the warning:
<code>SIM114 Combine `if` branches using logical `or` operator</code></p>
<p>When testing we discovered that if we changed to the comment to <code># noqa: sim114</code> we dont receive the RUF100 anymore.</p>
<p>I&#x27;ll include some small example code which shows the weird behaviour:</p>
<pre><code>a = True
b = False

def foo():
    if a &gt; b: # noqa: SIM114
        return 3
    elif a == b:
        return 3
    elif a &lt;  b: # noqa: sim114
        return 4
    elif b is None:
        return 4
</code></pre>
<p>The first <code>noqa</code> gives a RUF100 warning, the second gives none.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 11:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 11:58</div>
            <div class="timeline-body"><p>Will take a look today!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 14:40</div>
            <div class="timeline-body"><p>Okay, it&#x27;s a few confusing things working together... The root of the problem is that if branches contain different comments, we avoid flagging <code>SIM114</code>. So when you have this:</p>
<pre><code>def foo():
    if a &gt; b: # noqa: SIM114
        return 3
    elif a == b:
        return 3
</code></pre>
<p>We <em>don&#x27;t</em> flag <code>SIM114</code> <em>because</em> of the <code># noqa: SIM114</code> comment, and so the comment then becomes unused. If you remove the comment, then <code>SIM114</code> is raised again, because the comment is no longer present to <em>make</em> the branches non-identical.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 14:41</div>
            <div class="timeline-body"><p>I&#x27;m going to change the logic to ignore end-of-line comments and only check in-body comments, which will remove this confusion. (Your code with <code># noqa: SIM114</code> at the end of the test lines should work as expected.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-24 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sondrfos">@sondrfos</a> on 2023-07-25 12:43</div>
            <div class="timeline-body"><p>That makes sense. thanks for such quick responses! : )</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:39 UTC
    </footer>
</body>
</html>
