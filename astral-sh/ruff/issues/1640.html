<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suggest type annotations similar to autotyping - astral-sh/ruff #1640</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Suggest type annotations similar to autotyping</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/1640">#1640</a>
        opened by <a href="https://github.com/twoertwein">@twoertwein</a>
        on 2023-01-04 22:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/twoertwein">@twoertwein</a> on 2023-01-04 22:12</div>
            <div class="timeline-body"><p><a href="https://github.com/JelleZijlstra/autotyping">autotyping</a> suggests type annotations in a &quot;safe&quot; and more &quot;aggressive&quot; manner. It would be nice to include its rules in ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">plugin</span> added by @charliermarsh on 2023-01-05 04:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 04:57</div>
            <div class="timeline-body"><p>That's a neat library. We could definitely support this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 05:04</div>
            <div class="timeline-body"><p>This would benefit from #835.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-05 05:15</div>
            <div class="timeline-body"><p>I think this should probably be framed as autofix for the flake8-annotation rules, with settings to enable or disable the various heuristics. That way, we avoid introducing multiple rules around annotation presence.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-01-05 05:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @charliermarsh on 2023-01-05 05:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-02-16 08:20</div>
            <div class="timeline-body"><p>Since the <code>autotyping</code> package contains a guessing strategy, it would benefit from autofix aggressiveness levels (https://github.com/charliermarsh/ruff/issues/1997)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-02-16 15:10</div>
            <div class="timeline-body"><p>Ok tried this out and it's simple but pretty neat simple start: when default arguments are present it's pretty easy to infer the scalar types. Similarly, if no return statement is present the <code>None</code> type is easy too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> removed by @charliermarsh on 2023-02-17 23:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-02-18 16:54</div>
            <div class="timeline-body"><p>For anyone interested in picking this up: this potentially is one of the most impactful autofixes to offer.</p>
<p>In 69 major open-source projects annotations account for 3 of the top-5 violations:</p>
<ul>
<li>ANN001  226.197   Missing type annotation for function argument <code>unique</code></li>
<li>ANN101   202.229   Missing type annotation for <code>self</code> in method</li>
<li>ANN201  143.044   Missing return type annotation for public function <code>setup</code></li>
</ul>
<p>Even fixing a subset of these 500.000 annotations will hugely reduce manual efforts needed to move to typed libraries.</p>
<p>The safest autofixes are:</p>
<ul>
<li>None return</li>
<li>Scalar return</li>
<li>Annotate magics</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3633.html">astral-sh/ruff#3633</a> on 2023-03-20 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/twoertwein">@twoertwein</a> on 2023-07-27 13:43</div>
            <div class="timeline-body"><p>Are there plans to add the (potentially controversial) parameter annotations from autotyping as autofixes for ANN001:
<code>def foo(x=True)</code> -&gt; <code>def foo(x:bool=True)</code>
<code>def foo(x=1)</code> -&gt; <code>def foo(x:int=1)</code>
<code>def foo(x=1.0)</code> -&gt; <code>def foo(x:float=1.0)</code>
<code>def foo(x=&quot;&quot;)</code> -&gt; <code>def foo(x:str=&quot;&quot;)</code>
<code>def foo(x=b&quot;&quot;)</code> -&gt; <code>def foo(x:bytes=b&quot;&quot;)</code></p>
<p>Pyright uses non-none default values to infer missing annotations, mypy doesn't. I believe people who enable ANN, would welcome this autofix as they are anyway working on adding type annotations (low &quot;cost/frustration&quot; of false positives).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-07-27 14:38</div>
            <div class="timeline-body"><p>@twoertwein, as a Pyright user, I would prefer the option to exclude these cases from <code>ANN001</code>, as suggested in #5958. I find the unnecessary annotations can make it harder to visually parse a function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/twoertwein">@twoertwein</a> on 2023-07-27 15:04</div>
            <div class="timeline-body"><blockquote>
<p>@twoertwein, as a Pyright user, I would prefer the option to exclude these cases from ANN001, as suggested in https://github.com/astral-sh/ruff/issues/5958. I find the unnecessary annotations can make it harder to visually parse a function.</p>
</blockquote>
<p>If it was a PEP that would mandate that missing type annotations should be the type of a non-None default value (or if all major type checkers would do it anyway), I would be inclined to agree with you (I still prefer explicit over implicit and it would look more consistent). When I see an un-annotated parameter, my thought is not it must be the default value's type but it was probably too difficult to annotate it (a more complex union of types).</p>
<p>Pyright is my type checker of choice :) but most open source projects use mypy or use multiple type checkers (for example pandas started with mypy and is slowly inching to enable more pyright rules). Adding those annotations would help that different type checkers behave more similar. It would also narrow the gap between autotyping and ruff (surprise: ruff is way faster) :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-07-27 15:47</div>
            <div class="timeline-body"><p>Sure, I'm not against the option existing for those who want it! Apologies if I came across that way. I want it to exist, I just don't want it forced upon Pyright and Basedmypy users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pandas-dev/pandas/pulls/54260.html">pandas-dev/pandas#54260</a> on 2023-07-28 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8643.html">astral-sh/ruff#8643</a> on 2023-11-13 04:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-14 04:34</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
