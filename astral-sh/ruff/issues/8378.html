<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B008 complains about function call when constructing a default parameter value as a exception - astral-sh/ruff #8378</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>B008 complains about function call when constructing a default parameter value as a exception</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8378">#8378</a>
        opened by <a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a>
        on 2023-10-31 13:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a></div>
            <div class="timeline-body"><p>https://play.ruff.rs/54edf8a4-4c2f-4c0e-a5d8-b7b4afa7a19e</p>
<p>a definition like</p>
<pre><code class="language-py">def pain( error: Exception | None = ValueError(&quot;Hosts weren't successfully added&quot;)):
    pass
</code></pre>
<p>triggers</p>
<pre><code>B008: Do not perform function call `ValueError` in argument defaults`
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-31 17:00</div>
            <div class="timeline-body"><p>I'm definitely open-minded about improving the rule, but can you say a bit more about why you think this case should be excluded? Alternatively, why prefer this over the in-body initialization pattern?</p>
<pre><code class="language-python">if error is None:
    error = ValueError(&quot;Hosts weren't successfully added&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-10-31 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a> on 2023-10-31 19:16</div>
            <div class="timeline-body"><p>In my case none is a valid meaningful parameter variant</p>
<p>Creating sentinels as replacement is pretty painful</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-31 20:12</div>
            <div class="timeline-body"><p>Ahh I see, so passing in <code>error=None</code> has meaningfully different behavior. And I assume you don't want to define the sentinel in the module body.</p>
<p>The challenge here is that I don't know how to avoid this without disabling the rule altogether. Even here, <code>error</code> isn't immutable, so calls to <code>pain</code> could modify the shared error value...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a> on 2023-10-31 20:32</div>
            <div class="timeline-body"><p>The rule is about function calls,I believe it's fair game to allow construction of built-in exceptions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> removed by @charliermarsh on 2023-10-31 23:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-10-31 23:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a> on 2023-11-05 21:54</div>
            <div class="timeline-body"><p>https://github.com/PyCQA/flake8-bugbear/blob/907e0dd29a99818591a604d4557c70ea33204712/bugbear.py#L1660-L1667 has more details in the error</p>
<p>https://github.com/astral-sh/ruff/blob/4170ef050853998f2ea3423e7fbf0a5c38a9323b/crates/ruff_linter/src/rules/flake8_bugbear/rules/function_call_in_argument_default.rs#L60 is rather barebones</p>
<p>i would recommend to extend the error with the suggestion</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-05 22:09</div>
            <div class="timeline-body"><p>Does that suggestion solve the problem for you though? Do you consider that a reasonable workaround?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RonnyPfannschmidt">@RonnyPfannschmidt</a> on 2023-11-05 23:52</div>
            <div class="timeline-body"><p>Yes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-07 04:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:50 UTC
    </footer>
</body>
</html>
