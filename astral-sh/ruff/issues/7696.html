<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow configuration to be defined on a file-scoped basis - astral-sh/ruff #7696</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow configuration to be defined on a file-scoped basis</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7696">#7696</a>
        opened by <a href="https://github.com/Czaki">@Czaki</a>
        on 2023-09-28 11:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Czaki">@Czaki</a> on 2023-09-28 11:45</div>
            <div class="timeline-body"><p>It will be nice to allow define <code>banned-api</code> rules per file pattern.</p>
<p>In general, there are API that may be useful in tests but should not be used in the library itself:
For example, <code>warnings.catch_warnings</code> because of https://github.com/python/cpython/issues/73858.</p>
<p>On the other hand, I would like to block using <code>numpy.random</code> in tests but allow in the library and/or examples (as it leads to random test failure).</p>
<p>If you think it is useful, I could try to contribute (learning rust).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-28 12:23</div>
            <div class="timeline-body"><p>That makes sense. Have you tried using a <a href="https://docs.astral.sh/ruff/configuration/#pyprojecttoml-discovery">hierarchical configuration</a> to achieve your goal? The way this works is that you create a new <code>ruff.toml</code> in the test directory that <code>extend</code>s your default configuration. The test-specific configuration can override individual settings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Czaki">@Czaki</a> on 2023-09-28 12:51</div>
            <div class="timeline-body"><p>Unfortuantelly in this project (napari), test are not stored in a separate directory but in <code>_test</code> modules. And I'm only one of the maintainers.
(and this simplifies searching for a test of a given function).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-29 01:29</div>
            <div class="timeline-body"><p>Really wishing we had ESLint-style file overrides, as in:</p>
<pre><code class="language-json">{
  &quot;rules&quot;: {
    &quot;quotes&quot;: [&quot;error&quot;, &quot;double&quot;]
  },

  &quot;overrides&quot;: [
    {
      &quot;files&quot;: [&quot;bin/*.js&quot;, &quot;lib/*.js&quot;],
      &quot;excludedFiles&quot;: &quot;*.test.js&quot;,
      &quot;rules&quot;: {
        &quot;quotes&quot;: [&quot;error&quot;, &quot;single&quot;]
      }
    }
  ]
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2023-09-29 01:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Czaki">@Czaki</a> on 2023-09-29 07:34</div>
            <div class="timeline-body"><p>cibuildwheel project use toml tables to implement overwrite rules inside pyproject.toml https://github.com/pypa/cibuildwheel/
https://cibuildwheel.readthedocs.io/en/stable/options/#overrides</p>
<p>Maybe it could be an inspiration?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-29 09:01</div>
            <div class="timeline-body"><blockquote>
<p>Really wishing we had ESLint-style file overrides, as in:</p>
<pre><code class="language-json">{
  &quot;rules&quot;: {
    &quot;quotes&quot;: [&quot;error&quot;, &quot;double&quot;]
  },

  &quot;overrides&quot;: [
    {
      &quot;files&quot;: [&quot;bin/*.js&quot;, &quot;lib/*.js&quot;],
      &quot;excludedFiles&quot;: &quot;*.test.js&quot;,
      &quot;rules&quot;: {
        &quot;quotes&quot;: [&quot;error&quot;, &quot;single&quot;]
      }
    }
  ]
}
</code></pre>
</blockquote>
<p>I've mixed feelings about <code>overrides</code>. It is powerful but can become confusing if you mix it with extend. E.g. what happens if you have:</p>
<pre><code class="language-json">{
   &quot;rules&quot;: {
     &quot;quotes&quot;: [&quot;error&quot;, &quot;double&quot;]
   },
 
   &quot;overrides&quot;: [
     {
       &quot;files&quot;: [&quot;bin/*.js&quot;, &quot;lib/*.js&quot;],
       &quot;excludedFiles&quot;: &quot;*.test.js&quot;,
       &quot;rules&quot;: {
         &quot;quotes&quot;: [&quot;error&quot;, &quot;single&quot;]
       }
     }
   ]
}
</code></pre>
<p>and</p>
<pre><code class="language-json">{
	&quot;extend&quot;: &quot;config-above.json&quot;,
   &quot;rules&quot;: {
     &quot;quotes&quot;: [&quot;error&quot;, &quot;double&quot;]
   }
}
</code></pre>
<p>What does now bind stronger, the parent configuration because it's in the <code>overrides</code> section or the <code>extend</code>? I think we would need to change our configuration more drastically to make &quot;overrides&quot; feel intuitive, similar to what <a href="https://eslint.org/blog/2022/08/new-config-system-part-2/#glob-based-configs-everywhere">eslint does with the new flat configuration</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Allow define banned-api per file" to "Allow configuration to be defined on a file-scoped basis" by @charliermarsh on 2023-10-11 13:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-11 13:40</div>
            <div class="timeline-body"><p>(Making this issue more general -- it would be nice to support something like ESLint's flat configuration, in which you can define configuration that only applies to a subset of files.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DetachHead">@DetachHead</a> on 2023-10-26 06:17</div>
            <div class="timeline-body"><p>i'm fine with hierarchical configuration, but the only problem is that i wish it would inherit the <code>flake8-tidy-imports.banned-api</code> options from parent directories:</p>
<pre><code class="language-toml"># ./pyproject.toml
[tool.ruff.flake8-tidy-imports.banned-api]
&quot;foo&quot;.msg = &quot;banned project-wide&quot;
</code></pre>
<pre><code class="language-toml"># ./tests/ruff.toml
extend = &quot;../pyproject.toml&quot;

[flake8-tidy-imports.banned-api]
&quot;bar&quot;.msg = &quot;only banned in tests&quot;
</code></pre>
<pre><code class="language-py"># tests/test_foo.py
import foo # no error, because the `banned-api` the `tests` directory doesn't inherit from the global one
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BT-rmartin">@BT-rmartin</a> on 2024-01-11 17:05</div>
            <div class="timeline-body"><p>In my case #7890 we want to configure isort on file-scope basis, and in our particular need the hierarchical solution is not feasible, as we want it for every <strong>init</strong>.py file. Is there any progress on this topic @charliermarsh ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BT-rmartin">@BT-rmartin</a> on 2024-10-23 20:16</div>
            <div class="timeline-body"><p>@charliermarsh Is there any progress on configure isort on file-scope basis?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jorenham">@jorenham</a> on 2025-02-10 14:14</div>
            <div class="timeline-body"><p>see https://github.com/astral-sh/ruff/issues/16057 for another unique use-case of this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/irdkwmnsb">@irdkwmnsb</a> on 2025-02-11 18:19</div>
            <div class="timeline-body"><p>I'm not sure if that's the feature I want, but my usecase is as follows:<br />
Coming from a big legacy project I have multiple files with long variable names where it's ok to have wider lines.<br />
And the formatter wants to split those lines into multiple lines, which ends up being not so pretty.</p>
<p>One specific example of this is such code:</p>
<pre><code class="language-python3">if (
    (something1) is not None
    and (something2) is not None
    and (something3) is not None
):
</code></pre>
<p>With the default value of 88 the formatter will split up those lines to have <code>and</code> and <code>is not None</code> to be sometimes on one line, and sometimes on multiple, since the length of <code>something1</code> expression can be different.
If I set the <code>line-length</code> parameter to some large number the code looks neat and every <code>is not None</code> statement is placed on a separate line. But I don't want such large <code>line-length</code> on the whole project, so having a feature to be able to change settings on a per-file basis would be nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-11 18:23</div>
            <div class="timeline-body"><p>@irdkwmnsb you can already achieve that <em>if</em> all legacy files have a common ancestor directory by adding a <code>ruff.toml</code> in that ancestor directory.</p>
<p>You need this feature if the files are side by side to non-legacy files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arogozhnikov">@arogozhnikov</a> on 2025-02-27 17:07</div>
            <div class="timeline-body"><p>I have two use-cases for this feature, line-length in notebooks vs plain python files (they are side by side), and an additional 'type' of python file, which also should have a different line-length (also side by side with rest of codebase)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:29 UTC
    </footer>
</body>
</html>
