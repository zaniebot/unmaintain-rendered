<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lint when `|` annotations contain string segments - astral-sh/ruff #9139</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Lint when <code>|</code> annotations contain string segments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9139">#9139</a>
        opened by <a href="https://github.com/tylerlaprade">@tylerlaprade</a>
        on 2023-12-14 18:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tylerlaprade">@tylerlaprade</a></div>
            <div class="timeline-body"><img width="1138" alt="image" src="https://github.com/astral-sh/ruff/assets/5475199/4fffbbd1-c71b-427e-819c-3d0f5cd67009">

<p>This is one of the inputs to my function, after quotes were automatically added (and I manually turned <code>QuerySet['ContractVersion']</code> into <code>'QuerySet[ContractVersion]'</code> due to #9135 and #9136:</p>
<pre><code>contract_versions_list: list['ContractVersion']
    | 'QuerySet[ContractVersion]'
    | None = None,
</code></pre>
<p>When I manually changed it to the following, the tests ran fine again:</p>
<pre><code>contract_versions_list: 'list[ContractVersion] | QuerySet[ContractVersion]| None' = None,
</code></pre>
<p>I'm on Ruff v0.1.8 in a Django 4.2.7 project, running tests with PyTest 7.4.3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-14 19:01</div>
            <div class="timeline-body"><p>What was the original annotation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-14 19:05</div>
            <div class="timeline-body"><p>The issue here is that you changed <code>QuerySet['ContractVersion']</code> to <code>'QuerySet[ContractVersion]'</code> which isn't valid -- you need to quote the entire binary operation. But I'm just trying to understand, because you applied that change yourself?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-12-14 19:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-12-14 20:30</div>
            <div class="timeline-body"><p>Yes, it looks like I introduced this error when trying to manually resolve the warning from Ruff, since I didn't realize it was invalid to quote just part of it. I'm surprised Pyright doesn't complain about an invalid annotation. Is it possible to make Ruff complain about it?</p>
<p>My original annotation had no quotes in it:</p>
<pre><code>list[ContractVersion]
    | QuerySet[ContractVersion]
    | None = None,
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-15 00:07</div>
            <div class="timeline-body"><p>We could probably lint against that, yeah.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`TCH` `quote-annotations` fixes introduced runtime errors into my tests" to "Lint when `|` annotations contain string segments" by @charliermarsh on 2023-12-15 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-12-15 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-12-15 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-15 00:12</div>
            <div class="timeline-body"><p>Repurposing the issue to lint against <code>&quot;int&quot; | str</code> which is invalid.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-12-15 01:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-12-16 21:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:16 UTC
    </footer>
</body>
</html>
