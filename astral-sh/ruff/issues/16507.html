<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prevent non-new-variable `for` loop targets - astral-sh/ruff #16507</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Prevent non-new-variable <code>for</code> loop targets</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16507">#16507</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2025-03-04 18:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a></div>
            <div class="timeline-body"><p>The <code>target</code> of a <code>for</code> loop can be names (<code>global</code>, <code>nonlocal</code>, local), subcripts, attributes and/or any derivation of those:</p>
<pre><code>a: str
b = 42
global c
nonlocal d

# Valid syntax
for a, (b, c, [d, e[f], g.h]), i.j().k, l in m: ...
</code></pre>
<p>Only new variables should be allowed as loop targets. That is, in the above example, only <code>a</code> and <code>l</code> would be allowed: <code>l</code> is defined by the loop itself, while <code>a</code> doesn&#x27;t have a value prior to the loop.</p>
<p>A fix for this is trivial:</p>
<pre><code># Before
for a, (b, c, [d, e[f], g.h]), i.j().k, l in m: ...

# After
for _element in l:
    a, (b, c, [d, e[f], g.h]), i.j().k, l = _element
    ...
</code></pre>
<p>This issue is a follow-up to #16496. See that issue for a few edge cases related to the fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-04 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-04 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-05 07:48</div>
            <div class="timeline-body"><p>Thanks for opening this issue and the detailed write up!</p>
<p>I think the rule overall does make sense to me but I&#x27;m not sure if this pattern is common enough to justify adding a rule</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:37 UTC
    </footer>
</body>
</html>
