```yaml
number: 17437
title: "[red-knot] support narrowing on an assignment expression in a predicate"
type: issue
state: closed
author: carljm
labels:
  - help wanted
  - ty
assignees: []
created_at: 2025-04-16T23:14:16Z
updated_at: 2025-04-18T00:28:07Z
url: https://github.com/astral-sh/ruff/issues/17437
synced_at: 2026-01-10T01:56:56Z
```

# [red-knot] support narrowing on an assignment expression in a predicate

---

_Issue opened by @carljm on 2025-04-16 23:14_

We narrow in the first case below but not the second ([playground](https://types.ruff.rs/67775f86-0718-4e6f-b7ec-5cc15de71aa9)):

```py
def maybe_int() -> int | None:
    return 1

def _():
    x = maybe_int()
    if x is not None:
        reveal_type(x)

    if (y := maybe_int()) is not None:
        reveal_type(y)
```

Anywhere we would narrow on a test against a `Name`, we should narrow in the same way if that name is the target of an assignment expression in the same test.

---

_Label `help wanted` added by @carljm on 2025-04-16 23:14_

---

_Label `red-knot` added by @carljm on 2025-04-16 23:14_

---

_Referenced in [astral-sh/ruff#17434](../../astral-sh/ruff/pulls/17434.md) on 2025-04-16 23:14_

---

_Comment by @sharkdp on 2025-04-17 06:25_

This looks like a duplicate of https://github.com/astral-sh/ruff/issues/14866?

---

_Referenced in [astral-sh/ruff#17448](../../astral-sh/ruff/pulls/17448.md) on 2025-04-17 12:27_

---

_Comment by @carljm on 2025-04-17 13:17_

Ah indeed, thank you, closing this one as duplicate.

---

_Closed by @carljm on 2025-04-17 13:17_

---

_Closed by @carljm on 2025-04-18 00:28_

---
