<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inconsistent logging detection - astral-sh/ruff #7502</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Inconsistent logging detection</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7502">#7502</a>
        opened by <a href="https://github.com/konstin">@konstin</a>
        on 2023-09-18 20:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/konstin">@konstin</a></div>
            <div class="timeline-body"><p>There are three ways you can call the logging module:</p>
<ol>
<li></li>
</ol>
<pre><code>import logging
logger = logging.getLoger(__name__)
logger.info(&quot;msg&quot;)
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>import logging
logging.info(&quot;msg&quot;)
</code></pre>
<ol>
<li></li>
</ol>
<pre><code>from logging import info
info(&quot;msg&quot;)
</code></pre>
<p>The logging rules are enforced inconsistently between those three call kinds:</p>
<pre><code>import logging
from logging import warn, info, error

logger = logging.getLogger(__name__)

logging.info(f&quot;{1}&quot;)  # G004
logger.info(f&quot;{1}&quot;)  # G004
info(f&quot;{1}&quot;)

logging.info(&quot;&quot;, 2)  # PLE1205
logger.info(&quot;&quot;, 2)  # PLE1205
info(&quot;&quot;, 2)

logging.warn(&quot;a&quot;)  # PGH002, G010
logger.warn(&quot;a&quot;)  # G010
warn(&quot;a&quot;)  # PGH002

try:
    print(1 / 0)
except Exception:
    logging.error(&quot;a&quot;)  # TRY400
    logger.error(&quot;a&quot;)  # TRY400
    error(&quot;a&quot;)
</code></pre>
<p>Checking for a common logger name is generally consistent, but <code>PGH002</code> mismatches expectations here.</p>
<p>It might also make sense to look for usages of <code>logging.getLogger</code> for a more semantic coverage, even though the vast majority of usages in the wild seem to match our pattern (see also https://grep.app/search?q=logging.getLogger&amp;filter[lang][0]=Python, https://github.com/hummingbot/hummingbot/blob/b3ba248e7b9bab26c010fcb69a53040146084adb/hummingbot/client/config/conf_migration.py#L45, https://github.com/qutebrowser/qutebrowser/blob/4190a470c56ed90d97af89711a30c4603a347858/qutebrowser/utils/log.py#L104)</p>
<p>The main questions i&#x27;m trying to answer are, a) should we change the scope of the existing rule (or not) and b) which of the three cases should new logging rules capture?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/konstin">@konstin</a> on 2023-09-18 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/konstin">@konstin</a> on 2023-09-18 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-19 00:05</div>
            <div class="timeline-body"><p>We should be treating <code>error</code> as equivalent to <code>logging.error</code> -- that seems like a bug in <code>is_logger_candidate</code>.</p>
<p>And we should change <code>PGH002</code> to match <code>G010</code>. Actually, we should probably just remove <code>PGH002</code>, and redirect to <code>G010</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-19 03:53</div>
            <div class="timeline-body"><blockquote>
<p>We should be treating <code>error</code> as equivalent to <code>logging.error</code></p>
</blockquote>
<p>I looked into this a bit and I think it requires some minor modifications to the various rules that call <code>is_logger_candidate</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-19 04:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qdegraaf">@qdegraaf</a> on 2023-09-19 15:04</div>
            <div class="timeline-body"><blockquote>
<p>I looked into this a bit and I think it requires some minor modifications to the various rules that call <code>is_logger_candidate</code>.</p>
</blockquote>
<p>Could it not be handled in <code>is_logger_candidate()</code> itself?</p>
<p>Am I correct in thinking the issue is that <code>is_logger_candidate()</code> assumes the func to be an <code>Expr::Attribute</code> whereas a loose <code>error()</code> call is an <code>Expr::Name</code>? If so, would it be better to add a branch of logic to <code>is_logger_candidate</code> for this scenario, seeing as <code>resolve_call_path()</code> and <code>collect_call_path()</code> already allow for both <code>Expr::Attribute</code> and <code>Expr::Name</code> values to be passed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 00:22</div>
            <div class="timeline-body"><p>Closed by <a href="https://github.com/astral-sh/ruff/pull/7521">astral-sh/ruff#7521</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 00:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:42 UTC
    </footer>
</body>
</html>
