<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document supported settings for `ruff server` - astral-sh/ruff #11217</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Document supported settings for `ruff server`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/11217">#11217</a>
        opened by <a href="https://github.com/snowsignal">@snowsignal</a>
        on 2024-04-30 17:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/snowsignal">@snowsignal</a> on 2024-04-30 17:15</div>
            <div class="timeline-body"><p>Right now, we don't have any centralized documentation for <code>ruff server</code>'s client settings, similar to what <a href="https://github.com/astral-sh/ruff-lsp?tab=readme-ov-file#settings"><code>ruff-lsp</code> has in its README</a>. This would be a useful resource for users to have, especially for clients that require settings to be added manually in configuration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @snowsignal on 2024-04-30 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @snowsignal on 2024-04-30 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @snowsignal by @snowsignal on 2024-04-30 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11183.html">astral-sh/ruff#11183</a> on 2024-04-30 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-22 03:35</div>
            <div class="timeline-body"><p>Some of this in: https://github.com/astral-sh/ruff-vscode/pull/469</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tartley">@tartley</a> on 2024-06-17 13:38</div>
            <div class="timeline-body"><p>Apologies for the uninformed drive-by, but as a user, I perceive the problem to be addressed here as two-fold:</p>
<ol>
<li><p>As far as I can tell, the only current documentation of the available settings is in two places:</p>
<ol>
<li>The incidental mention on the <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_server/docs/MIGRATION.md">ruff-lsp migration guide</a>. I do not know if this list is exhaustive, but my uninformed browsing of the source makes me think it is.</li>
<li>I see there have been recent merges which have refined a table of the available options <a href="https://github.com/astral-sh/ruff-vscode/pull/469/commits/ae69083a78b2ba4e05c2e6531173765fbe3cd8e7">on the ruff-vscode project README</a> - but this is a bad place for it, people configuring other editors need this table too.</li>
</ol>
<p>This list should exist in somewhere more findable, more centrally applicable to all users of ruff server, not just those who are migrating from ruff-lsp or using VSCode.</p>
</li>
<li><p>For each of the editor specific guides, there needs to be an example which demonstrates how to provide the above settings in the initial lsp .setup() call (if that is actually the intent, I currently cannot tell.) For example, I'm looking at <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_server/docs/setup/NEOVIM.md">the Neovim setup guide</a>, which:</p>
<ol>
<li><p>Links to nvim-lspconfig's #suggested-configuration, but this anchor does not exist in the linked document, nor does any similar-sounding title.</p>
</li>
<li><p>Documents making the <code>require('lspconfig').ruff.setup {}</code> call without any args, which is fine.</p>
</li>
<li><p>Links to the <a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#ruff">#ruff entry in the nvim-lspserver project</a>. This documents the default values to the setup() call to be (cmd, filetypes, root_dir, settings, single_file_support). I infer that the 'settings' table is where I should pass the settings documented in the ruff-lsp/ruff-vscode projects above. However, I have been unable to get any of those settings to work here. Do I pass them as:</p>
<pre><code>require('lspconfig').ruff.setup{ settings={ lineLength=100 } }
</code></pre>
<p>I cannot get this to work, having tried many variations on it. But the following does work for me:</p>
<pre><code>require('lspconfig').ruff.setup{ settings={ args={ &quot;--line-length=100&quot; } } }
</code></pre>
<p>even though &quot;args&quot; is not documented on the above linked pages, not on the linked <a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#ruff">nvim-lspconfig entry</a>, nor in the table of <a href="https://github.com/astral-sh/ruff-vscode/blob/7ef6eff8d6f760bb2861a96774b286f927152ad1/README.md#settings">ruff server settings</a>. Clearly I am misunderstanding. The docs should make this very clear.</p>
</li>
</ol>
</li>
</ol>
<p>I would send PRs, but I have no idea what I'm doing so wanted to at least chat about it first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Ruff Server: Stable" by @snowsignal on 2024-06-17 16:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-18 06:03</div>
            <div class="timeline-body"><p>Hey @tartley, thank you for providing such a detailed analysis and sorry that you're facing this problem. @snowsignal can provide more details around it but I think the documentation for the new <code>ruff server</code> is in flux but we do plan to accumulate it in a central place like a &quot;The Ruff Server&quot; section at https://docs.astral.sh/.</p>
<p>I'll address a couple of points that you've mentioned here:</p>
<blockquote>
<ol start="2">
<li>I see there have been recent merges which have refined a table of the available options <a href="https://github.com/astral-sh/ruff-vscode/pull/469/commits/ae69083a78b2ba4e05c2e6531173765fbe3cd8e7">on the ruff-vscode project README</a> - but this is a bad place for it, people configuring other editors need this table too.</li>
</ol>
</blockquote>
<p>I think the settings provided in the linked table is specific to VS Code. Other editors need to configure it via other methods like <code>setup</code> function in Neovim and <code>language.toml</code> file for Helix. I think the goal of this issue is to address this need.</p>
<blockquote>
<p>This list should exist in somewhere more findable, more centrally applicable to all users of ruff server, not just those who are migrating from ruff-lsp or using VSCode.</p>
<ul>
<li>For each of the editor specific guides, there needs to be an example which demonstrates how to provide the above settings in the initial lsp .setup() call (if that is actually the intent, I currently cannot tell.)</li>
</ul>
</blockquote>
<p>Yes, I completely agree with this.</p>
<blockquote>
<ol>
<li>Links to nvim-lspconfig's #suggested-configuration, but this anchor does not exist in the linked document, nor does any similar-sounding title.</li>
</ol>
</blockquote>
<p>Hmm, let me fix that quickly. I don't think <code>nvim-lspconfig</code> now provides any suggestion on the configuration as it did earlier. I think I'll just provide a minimal config or link to some <code>:help</code> topic.</p>
<blockquote>
<ol start="3">
<li><p>Links to the <a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md?rgh-link-date=2024-06-17T13%3A38%3A16Z#ruff">#ruff entry in the nvim-lspserver project</a>. This documents the default values to the setup() call to be (cmd, filetypes, root_dir, settings, single_file_support). I infer that the 'settings' table is where I should pass the settings documented in the ruff-lsp/ruff-vscode projects above. However, I have been unable to get any of those settings to work here. Do I pass them as:</p>
<pre><code>require('lspconfig').ruff.setup{ settings={ lineLength=100 } }
</code></pre>
<p>I cannot get this to work, having tried many variations on it. But the following does work for me:</p>
<pre><code>require('lspconfig').ruff.setup{ settings={ args={ &quot;--line-length=100&quot; } } }
</code></pre>
<p>even though &quot;args&quot; is not documented on the above linked pages, not on the linked <a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md?rgh-link-date=2024-06-17T13%3A38%3A16Z#ruff">nvim-lspconfig entry</a>, nor in the table of <a href="https://github.com/astral-sh/ruff-vscode/blob/7ef6eff8d6f760bb2861a96774b286f927152ad1/README.md#settings">ruff server settings</a>. Clearly I am misunderstanding. The docs should make this very clear.</p>
</li>
</ol>
</blockquote>
<p>I'm sorry that you had to face this but the solution to this is to provide it under <code>init_options</code>. So, your example would be:</p>
<pre><code class="language-lua">require('lspconfig').ruff.setup {
  init_options = {
    settings = {
      -- Ruff server settings would go here
    }
  }
}
</code></pre>
<p>I know this isn't obvious and we're going to fix this in https://github.com/astral-sh/ruff/issues/11897 and I'll add an example section in NEOVIM.md file as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tartley">@tartley</a> on 2024-06-18 14:49</div>
            <div class="timeline-body"><p>@dhruvmanila Thank you for the detailed response! No apologies are necessary - my intent was not to complain, merely to try and help by being as explicit as I could about what I would like to see. Many thanks for all the amazing and exciting work to date, and to come!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-07-03 14:48</div>
            <div class="timeline-body"><p>it seems that over time lspconfig maintainers moved away from a <code>suggested-configuration</code> and provide only a &quot;minimal&quot; configuration for bug reporting. I am sure they have their reasons but it makes it much harder to pick up the package for people like me. Also some of those handed down mappings have became hardcoded defaults in neovim 0.10+.</p>
<p>I have been playing the dictionary hunting game for finding where a setting is picked up, where it isn't for ages and it's very frustrating. I wish docs writers would stop using &quot;...&quot; and actually used an actual argument in their examples.</p>
<p>For example it took me a lot of trying to find out how to overwrite the default <code>cmd</code> for <code>ruff server</code>...  Is it in <code>init_options</code>? no.  Is it in <code>settings</code>?  no.  Is it in <code>settings</code> inside <code>init_options</code>? no.</p>
<pre><code>lspconfig.ruff.setup {
  cmd = { &quot;ruff&quot;, &quot;server&quot;, &quot;--preview&quot;, &quot;--config&quot;, &quot;~/Library/Application Support/ruff/pyproject.toml&quot;},
}
</code></pre>
<p>My use case to override a project specified <code>pyproject.toml</code> file with my own as it has more checks than the ones the team agreed on...</p>
<p>While I can confirm with <code>LspInfo</code> that the command arguments are picked up, <code>ruff</code> still seems to favour the closest pyproject.toml file in the project directory, so now I am confused about the documentation: https://docs.astral.sh/ruff/configuration/#config-file-discovery point no 2...</p>
<pre><code>Client: ruff (id: 2, bufnr: [1])
      filetypes:       python
      autostart:       true
 root directory:       ...
            cmd:       /opt/homebrew/bin/ruff server --preview --config ~/Library/Application Support/ruff/pyproject.toml
</code></pre>
<p>The new diagnostics show up only if I remove the project's <code>pyproject.toml</code> file. AAAnyway, I digressed a bit :D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-07-03 14:56</div>
            <div class="timeline-body"><p>ah, turning on the trace messages told me at least to move the config file to <code>.config</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-07-03 15:23</div>
            <div class="timeline-body"><p>to give a positive update to my issue for anyone looking at a similar problem, <code>ruff-lsp</code> has honoured the settings correctly:</p>
<pre><code>require('lspconfig').ruff_lsp.setup {
  init_options = {
    settings = {
      -- Any extra CLI arguments for `ruff` go here.
      args = {&quot;--config&quot;, &quot;~/.config/ruff/pyproject.toml&quot;},
    }
  }
}
</code></pre>
<p>so back to <code>ruff-lsp</code> for a little while.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-04 05:03</div>
            <div class="timeline-body"><p>@minusf Sorry that you're facing this, I agree that it's very frustrating to find where a specific information goes with the amount of options available. I'm going to be working on the new <code>ruff server</code> documentation next week and this is helpful context to guide in how I should go about writing the examples. Thank you for sharing this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-07-04 08:44</div>
            <div class="timeline-body"><p>To be clear, I think this is an lspconfig issue first, other projects later.  They just kind of expect everyone to be a lua dev ðŸ¤£</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dhruvmanila by @dhruvmanila on 2024-07-16 09:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @snowsignal by @dhruvmanila on 2024-07-16 09:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12344.html">astral-sh/ruff#12344</a> on 2024-07-16 09:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-07-18 12:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-07-18 12:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-18 18:35</div>
            <div class="timeline-body"><p>Thank you all for providing feedback here! It was helpful while writing the documentation. Feel free to provide any additional suggestions that you might have in the new documentation. Reference: https://docs.astral.sh/ruff/editors</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tartley">@tartley</a> on 2024-07-18 18:40</div>
            <div class="timeline-body"><p>Yes, I've been poring through it right now. I'll let you know and could work on modest PRs if I spot anything.</p>
<p>On Thu, Jul 18, 2024, at 12:36, Dhruv Manilawala wrote:</p>
<blockquote>
<p>Thank you all for providing feedback here! It was helpful while writing the documentation. Feel free to provide any additional suggestions that you might have in the new documentation. Reference: https://docs.astral.sh/ruff/editors</p>
<p>â€”
Reply to this email directly, view it on GitHub <a href="https://github.com/astral-sh/ruff/issues/11217#issuecomment-2237247445">https://github.com/astral-sh/ruff/issues/11217#issuecomment-2237247445</a>, or unsubscribe <a href="https://github.com/notifications/unsubscribe-auth/AABBV66D3YMTUCDIME7GBR3ZNADJVAVCNFSM6AAAAABHAVNULKVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDEMZXGI2DONBUGU">https://github.com/notifications/unsubscribe-auth/AABBV66D3YMTUCDIME7GBR3ZNADJVAVCNFSM6AAAAABHAVNULKVHI2DSMVQWIX3LMV43OSLTON2WKQ3PNVWWK3TUHMZDEMZXGI2DONBUGU</a>.
You are receiving this because you were mentioned.Message ID: <em><strong>@</strong></em>.***&gt;</p>
</blockquote>
<p>--
Jonathan Hartley         USA, Central(UTC-5)
<em><strong>@</strong></em>.***  https://tartley.com</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
