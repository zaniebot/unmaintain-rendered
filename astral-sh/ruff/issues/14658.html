<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`RUF018` false positive. Assignment for variables only used in other asserts - astral-sh/ruff #14658</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`RUF018` false positive. Assignment for variables only used in other asserts</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14658">#14658</a>
        opened by <a href="https://github.com/Skylion007">@Skylion007</a>
        on 2024-11-28 15:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Skylion007">@Skylion007</a> on 2024-11-28 15:52</div>
            <div class="timeline-body"><p><code>RUF018</code> flags any asserts which assigns values in them, which is sensible. However, there are two cases where value assignment is actually fine, and even makes the code more readable. This rule is to prevent code breakages when asserts are disabled. I ran it on the sympy code and found two use cases that make sense.</p>
<pre><code class="language-python">    assert (t:=cancel((F, G))) == (1, P, Q)
    assert isinstance(t, tuple)
</code></pre>
<p>Here this is using a variable which is ONLY referenced in other assert expressions. There is no clean way to write this compound assert without knowing what assert failed, without storing the variable t in a temporary variable. Furthermore, the<code>t:=</code> may be expensive construct, we may only want to assign this variable when asserts are enabled.</p>
<p>The other less useful, but interesting case is using the assert expression in the error message of the assert. See here:</p>
<pre><code class="language-python">     assert (g:=solve(groebner(eqs, s), dict=True)) == sol, g
</code></pre>
<p>without this, the value has to be repeated to know what <code>g</code> actually is in this context, or it needs to be assigned to a temporary variable which may be constructed when asserts are also disabled. <code>g</code> should be cast to a string, but that is a fix for another rule`</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-11-28 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-11-28 17:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14661.html">astral-sh/ruff#14661</a> on 2024-11-28 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-11-29 13:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12990.html">astral-sh/ruff#12990</a> on 2024-12-09 22:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
