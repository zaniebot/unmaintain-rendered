<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F601: Duplicated keys with different parenthesisation fixed incorrectly - astral-sh/ruff #4897</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F601: Duplicated keys with different parenthesisation fixed incorrectly</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4897">#4897</a>
        opened by <a href="https://github.com/addisoncrump">@addisoncrump</a>
        on 2023-06-06 08:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/addisoncrump">@addisoncrump</a> on 2023-06-06 08:45</div>
            <div class="timeline-body"><p>This is a case which I believe is potentially indicative of other bugs with the F601 fix.</p>
<p>Duplicated keys are merged by Ruff in the case of equal values, but the method by which this is done leads to a strange error in the case of different parenthesisation:</p>
<pre><code class="language-py">t={&quot;x&quot;:&quot;test123&quot;, &quot;x&quot;:(&quot;test123&quot;)}
</code></pre>
<p>And the applied diff:</p>
<pre><code>Fixed source has a syntax error where the source document does not. This is a bug in one of the generated fixes:
&lt;filename&gt;:1:17: E999 SyntaxError: unexpected token ')'
  |
1 | t={&quot;x&quot;:&quot;test123&quot;)}
  |                 ^ E999
  |


Last generated fixes:
&lt;filename&gt;:1:19: F601 [*] Dictionary key literal `&quot;x&quot;` repeated
  |
1 | t={&quot;x&quot;:&quot;test123&quot;, &quot;x&quot;:(&quot;test123&quot;)}
  |                   ^^^ F601
  |
  = help: Remove repeated key literal `&quot;x&quot;`

â„¹ Suggested fix
1   |-t={&quot;x&quot;:&quot;test123&quot;, &quot;x&quot;:(&quot;test123&quot;)}
  1 |+t={&quot;x&quot;:&quot;test123&quot;)}


Source with applied fixes:
t={&quot;x&quot;:&quot;test123&quot;)}
</code></pre>
<p>Discovered by #4822.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-06-06 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-06-06 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4972.html">astral-sh/ruff#4972</a> on 2023-06-08 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-09-21 01:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7559.html">astral-sh/ruff#7559</a> on 2023-09-21 01:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-21 01:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
