<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: quote-style bug - astral-sh/ruff #13120</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Formatter: quote-style bug</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13120">#13120</a>
        opened by <a href="https://github.com/blackteahamburger">@blackteahamburger</a>
        on 2024-08-27 09:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/blackteahamburger">@blackteahamburger</a> on 2024-08-27 09:25</div>
            <div class="timeline-body"><p>With <code>quote-style = &quot;double&quot;</code>.</p>
<p>Example:</p>
<pre><code># test.py
test = {&quot;x&quot;: 0}
print(f&quot;{test['x']}&quot;)
</code></pre>
<pre><code>$ ruff format test.py
1 file left unchanged
</code></pre>
<p><code>test['x']</code> is left unchanged.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @AlexWaygood on 2024-08-27 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-27 19:06</div>
            <div class="timeline-body"><p>Hi! I can reproduce with <code>target-version</code> set to <code>&quot;py311&quot;</code>, but not with <code>target-version</code> set to <code>&quot;py312&quot;</code>. Do you have <code>target-version</code> or <code>requires-python</code> set in your <code>pyproject.toml</code> or <code>ruff.toml</code> config file at all? (The reason for this is that <code>f&quot;{test[&quot;x&quot;]})&quot;</code> is not a valid f-string on Python 3.11. Python's grammar was changed in 3.12 as part of PEP 701.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @AlexWaygood on 2024-08-27 19:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @AlexWaygood on 2024-08-27 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blackteahamburger">@blackteahamburger</a> on 2024-08-28 02:26</div>
            <div class="timeline-body"><p>I can reproduce it with <code>ruff format test.py --config &quot;target-version = 'py312'&quot; --config &quot;format.quote-style = 'double'&quot;</code>. I'm using ruff 0.6.2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-08-28 04:53</div>
            <div class="timeline-body"><p>Is the expected output that the formatter should change the code like so?</p>
<pre><code class="language-diff">- print(f&quot;{test['x']}&quot;)
+ print(f&quot;{test[&quot;x&quot;]}&quot;)
</code></pre>
<p>That is available as a preview style, but only when the target version is 3.12 or later: https://play.ruff.rs/9cea74b1-c3fe-4f08-94bc-05f0c53a7ead</p>
<p>The reason is that f-string with repeated quotes is only valid for 3.12 or later and the formatting style is currently under preview: https://github.com/astral-sh/ruff/discussions/9785</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> removed by @dhruvmanila on 2024-08-28 04:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blackteahamburger">@blackteahamburger</a> on 2024-08-28 10:23</div>
            <div class="timeline-body"><p>Yes, it's expected, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @blackteahamburger on 2024-08-28 11:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
