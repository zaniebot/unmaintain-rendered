<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Range formatting semicolon-separated statements introduces whitespace - astral-sh/ruff #22494</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Range formatting semicolon-separated statements introduces whitespace</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22494">#22494</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2026-01-10 14:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>We currently do the following:</p>
<pre><code class="language-python">class Foo:
    x=1;&lt;RANGE_START&gt;x=2&lt;RANGE_END&gt;
</code></pre>
<p>becomes:</p>
<pre><code class="language-python">class Foo:
    x=1;    x = 2
</code></pre>
<p>The enclosing node of the range here is correctly determined to be the full suite (because it can't find the indentation for <code>x=2</code>), but then something must go wrong when narrowing from the formatted</p>
<pre><code class="language-python">class Foo:
    x=1
    x=2
</code></pre>
<p>back down. My guess is that this comes down to the <a href="https://github.com/astral-sh/ruff/blob/046c5a46d88c930e4e5e4638ec6b3515ba919982/crates/ruff_python_formatter/src/range.rs#L563"><code>is_logical_line</code></a> helper being not quite right, or else maybe we aren't emitting/interpreting source positions correctly here? I haven't looked closely.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dylwil3 on 2026-01-10 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @dylwil3 on 2026-01-10 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leonace924">@leonace924</a> on 2026-01-13 18:12</div>
            <div class="timeline-body"><p>Hi @AlexWaygood nice to meet you
I'd like to contribute on this project, is this good issue to take up?
Thank you</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-13 18:27:42 UTC
    </footer>
</body>
</html>
