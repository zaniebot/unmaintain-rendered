<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[nvim/server] code action popup menu does not appear  - astral-sh/ruff #11458</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[nvim/server] code action popup menu does not appear </h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11458">#11458</a>
        opened by <a href="https://github.com/baggiponte">@baggiponte</a>
        on 2024-05-17 09:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-05-17 09:51</div>
            <div class="timeline-body"><p>Ciao!</p>
<p>I am using neovim with ruff (and/or ruff-lsp) as LSP server, in tandem with pyright. Yesterday I update to nvim 0.10.0 and noticed ruff odes not display the code action popup menu (<code>vim.lsp.buf.code_action()</code>). I was just using ruff, so I reinstalled ruff-lsp and in the logs found this:</p>
<pre><code>[ERROR][2024-05-17 11:38:37] .../vim/lsp/rpc.lua:770	&quot;rpc&quot;	&quot;/Users/luca/.local/share/nvim/mason/bin/ruff&quot;	&quot;stderr&quot;	&quot;  10.131295s ERROR ruff_server::server::api An error occurred with result ID 4: failed to deserialize diagnostic data: missing field `range`\n&quot;

[ERROR][2024-05-17 11:38:37] .../vim/lsp/rpc.lua:770	&quot;rpc&quot;	&quot;/Users/luca/.local/share/nvim/mason/bin/ruff-lsp&quot;	&quot;stderr&quot;	&quot;Exception occurred for message \&quot;3\&quot;: KeyError: 'location'\nTraceback (most recent call last):\n  File \&quot;/Users/luca/.local/share/nvim/mason/packages/ruff-lsp/venv/lib/python3.12/site-packages/pygls/protocol/json_rpc.py\&quot;, line 194, in _execute_request_callback\n    self._send_response(msg_id, result=future.result())\n                                       ^^^^^^^^^^^^^^^\n  File \&quot;/Users/luca/.local/share/nvim/mason/packages/ruff-lsp/venv/lib/python3.12/site-packages/ruff_lsp/server.py\&quot;, line 1000, in code_action\n    edit=_create_workspace_edit(\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \&quot;/Users/luca/.local/share/nvim/mason/packages/ruff-lsp/venv/lib/python3.12/site-packages/ruff_lsp/server.py\&quot;, line 1490, in _create_workspace_edit\n    line=edit[\&quot;location\&quot;][\&quot;row\&quot;] - 1,\n         ~~~~^^^^^^^^^^^^\nKeyError: 'location'\n&quot;
</code></pre>
<p>The first log should be the error within ruff server, the second within ruff-lsp. Am finding it really hard to dissect, any suggestion on how I can improve the report? Thanks! I guess I should s/o @dhruvmanila</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-05-17 12:17</div>
            <div class="timeline-body"><p>Don't know why but this solved itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @baggiponte on 2024-05-17 12:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-17 12:20</div>
            <div class="timeline-body"><p>Thank you for updating the issue. Feel free to re-open if you face this problem again, I can debug it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-05-17 13:04</div>
            <div class="timeline-body"><p>Thanks for your answer! Now I have this small issue:</p>
<img width="629" alt="image" src="https://github.com/astral-sh/ruff/assets/57922983/837acf26-5616-4942-b7bc-f06c214cf659">

<p>Set aside the error message (don't know what this is due to), I see a duplicated message for errors 1-2 and no option to ignore the rule. Maybe nvim can only display 4 options?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-20 05:33</div>
            <div class="timeline-body"><p>I don't think there's any limit as to how many code actions Neovim can display. I'm not exactly sure what I'm seeing here. Is it a notification popup like the one in <a href="https://github.com/rcarriga/nvim-notify"><code>nvim-notify</code></a>? Is it some other plugin which shows a floating window and then you type an appropriate number?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dhruvmanila on 2024-05-20 05:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/baggiponte">@baggiponte</a> on 2024-05-20 07:47</div>
            <div class="timeline-body"><blockquote>
<p>I don't think there's any limit as to how many code actions Neovim can display. I'm not exactly sure what I'm seeing here. Is it a notification popup like the one in <a href="https://github.com/rcarriga/nvim-notify"><code>nvim-notify</code></a>? Is it some other plugin which shows a floating window and then you type an appropriate number?</p>
</blockquote>
<p>Ops, sorry. It's <a href="https://github.com/folke/noice.nvim"><code>noice.nvim</code></a>. It uses notify under the hood. It might simply be an error on their side. Will open a new issue if I see that pop up again ðŸ˜Š</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:13 UTC
    </footer>
</body>
</html>
