<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ERROR] Failed to fix nested if: Expected outer if to have indented body and no else - astral-sh/ruff #2094</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ERROR] Failed to fix nested if: Expected outer if to have indented body and no else</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2094">#2094</a>
        opened by <a href="https://github.com/LefterisJP">@LefterisJP</a>
        on 2023-01-22 22:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/LefterisJP">@LefterisJP</a> on 2023-01-22 22:12</div>
            <div class="timeline-body"><p>ruff version: <code>0.0.230</code></p>
<pre><code class="language-python">a = True
b = True

if a:
    if b:
        print('do something')  # noqa: T201
else:
    print('at else')  # noqa: T201
</code></pre>
<p>Running ruff here will result with:</p>
<pre><code>test.py:4:1: SIM102 Use a single `if` statement instead of nested `if` statements
</code></pre>
<p>If we try to autofix we get <code>[2023-01-22][23:09:59][ruff::rules::flake8_simplify::rules::ast_if][ERROR] Failed to fix nested if: Expected outer if to have indented body and no else</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-01-22 22:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 22:15</div>
            <div class="timeline-body"><p>Apart from the autofix error, this is a false positive, right?!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-01-22 22:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 22:17</div>
            <div class="timeline-body"><p>Looks like a regression introduced in #2050 \cc @harupy</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 22:20</div>
            <div class="timeline-body"><p>I'll either fix or revert that for now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LefterisJP">@LefterisJP</a> on 2023-01-22 22:23</div>
            <div class="timeline-body"><blockquote>
<p>Apart from the autofix error, this is a false positive, right?!</p>
</blockquote>
<p>It's a really tricky false positive.</p>
<p>I think if you &quot;fix&quot; to this code:</p>
<pre><code class="language-python">if a and b:
    print('do something')  # noqa: T201
else:
    print('at else')  # noqa: T201
</code></pre>
<p>Then only if <code>a=True</code> and <code>b=False</code> you get different program flow. Original code would not print anything, while fixed code would go in the else.</p>
<p>On the other hand, the places where it showed up in our code, did require some refactoring, so I don't count it as a total loss.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 22:28</div>
            <div class="timeline-body"><p>Yeah, I do consider it a false positive because the suggested fix actually has different behavior and semantics.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-22 22:39</div>
            <div class="timeline-body"><p>Ok, this should be fixed in the next release (either tonight or tomorrow).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-22 22:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-22 22:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:28:59 UTC
    </footer>
</body>
</html>
