<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support configuration to skip formatting for certain lines. - astral-sh/ruff #10506</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support configuration to skip formatting for certain lines.</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/10506">#10506</a>
        opened by <a href="https://github.com/zen-xu">@zen-xu</a>
        on 2024-03-21 09:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zen-xu">@zen-xu</a> on 2024-03-21 09:54</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Ruff formatter is awesome, and I have completely migrated my project from Black.</p>
<p>In addition, I am very eager for it to support the configuration to not format certain matching lines, rather than manually specifying in the code. Because I have some DSLs implemented in Python, I don't want Ruff to format those related codes. It would be great if Ruff had a related configuration to set this globally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @AlexWaygood on 2024-03-21 10:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @AlexWaygood on 2024-03-21 10:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zen-xu">@zen-xu</a> on 2024-03-21 10:08</div>
            <div class="timeline-body"><p>for example, I have a pytest BDD <a href="https://github.com/zen-xu/spock">plugin</a> (It hasn't been maintained for a long time ðŸ˜…), its DSL is similar to a table.</p>
<pre><code class="language-python">import pytest


@pytest.mark.spock(&quot;maximum of {first} and {second} is {ret}&quot;)
def test_maximum():
    def expect(first, second, ret):
        assert max(first, second) == ret

    def where(_, first, second, ret):
        _ | first | second | ret
        _ | 3     | 7      | 7
        _ | 5     | 4      | 5
        _ | 9     | 9      | 9
</code></pre>
<p>ruff will format these code into</p>
<pre><code class="language-python">import pytest


@pytest.mark.spock(&quot;maximum of {first} and {second} is {ret}&quot;)
def test_maximum():
    def expect(first, second, ret):
        assert max(first, second) == ret

    def where(_, first, second, ret):
        _ | first | second | ret
        _ | 3 | 7 | 7
        _ | 5 | 4 | 5
        _ | 9 | 9 | 9
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zen-xu">@zen-xu</a> on 2024-03-21 10:14</div>
            <div class="timeline-body"><p>Additionally, it is also necessary to turn off lint for certain lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> removed by @MichaReiser on 2024-03-21 10:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by @MichaReiser on 2024-03-21 10:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> removed by @MichaReiser on 2024-03-21 10:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-03-21 10:20</div>
            <div class="timeline-body"><blockquote>
<p>Ruff formatter is awesome, and I have completely migrated my project from Black.</p>
</blockquote>
<p>Thank you!</p>
<p>I can see the need for a configuration option to exclude certain code patterns from linting and formatting, and AST Grep (or GritIo) patterns could be a nice way of specifying that. I would rather not do a string-based search because that is error-prone and imposes the challenge that Ruff would need to map string offsets back to AST nodes (it's unclear what should happen if the start doesn't match the node offsets directly).</p>
<p>I'm afraid that this is probably a more distant feature because it requires building some infrastructure to support this and a very stable AST representation (changes to the AST would become breaking changes)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
