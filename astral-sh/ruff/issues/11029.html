<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0.4.0: pytest fails with errors in 3 units - astral-sh/ruff #11029</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>0.4.0: pytest fails with errors in 3 units</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11029">#11029</a>
        opened by <a href="https://github.com/wuch-g2v">@wuch-g2v</a>
        on 2024-04-19 07:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/wuch-g2v">@wuch-g2v</a> on 2024-04-19 07:20</div>
            <div class="timeline-body"><p>Python 3.10.14 and pytest 8.1.1.
Looks like something is wrong with latest 0.4.0 because pytest fails</p>
<details>
<summary>Here is pytest output:</summary>

<pre><code class="language-console">+ PYTHONPATH=/home/builder/rpmbuild/BUILDROOT/python-ruff-0.4.0-2.fc37.x86_64/usr/lib64/python3.10/site-packages:/home/builder/rpmbuild/BUILDROOT/python-ruff-0.4.0-2.fc37.x86_64/usr/lib/python3.10/site-packages
+ /usr/bin/pytest -ra -m 'not network' --exit-0-if-no-units
============================= test session starts ==============================
platform linux -- Python 3.10.14, pytest-8.1.1, pluggy-1.4.0
rootdir: /home/builder/rpmbuild/BUILD/ruff-0.4.0
configfile: pyproject.toml
collected 0 items / 3 errors

==================================== ERRORS ====================================
_ ERROR collecting crates/ruff_python_parser/resources/inline/err/assert_empty_test.py _
/usr/lib/python3.10/site-packages/_pytest/python.py:525: in importtestmodule
    mod = import_path(
/usr/lib/python3.10/site-packages/_pytest/pathlib.py:584: in import_path
    importlib.import_module(module_name)
/usr/lib64/python3.10/importlib/__init__.py:126: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
&lt;frozen importlib._bootstrap&gt;:1050: in _gcd_import
    ???
&lt;frozen importlib._bootstrap&gt;:1027: in _find_and_load
    ???
&lt;frozen importlib._bootstrap&gt;:1006: in _find_and_load_unlocked
    ???
&lt;frozen importlib._bootstrap&gt;:688: in _load_unlocked
    ???
/usr/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:169: in exec_module
    source_stat, co = _rewrite_test(fn, self.config)
/usr/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:351: in _rewrite_test
    tree = ast.parse(source, filename=strfn)
/usr/lib64/python3.10/ast.py:50: in parse
    return compile(source, filename, mode, flags,
E     File &quot;/home/builder/rpmbuild/BUILD/ruff-0.4.0/crates/ruff_python_parser/resources/inline/err/assert_empty_test.py&quot;, line 1
E       assert
E             ^
E   SyntaxError: invalid syntax
_ ERROR collecting crates/ruff_python_parser/resources/inline/err/if_stmt_missing_test.py _
/usr/lib/python3.10/site-packages/_pytest/python.py:525: in importtestmodule
    mod = import_path(
/usr/lib/python3.10/site-packages/_pytest/pathlib.py:584: in import_path
    importlib.import_module(module_name)
/usr/lib64/python3.10/importlib/__init__.py:126: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
&lt;frozen importlib._bootstrap&gt;:1050: in _gcd_import
    ???
&lt;frozen importlib._bootstrap&gt;:1027: in _find_and_load
    ???
&lt;frozen importlib._bootstrap&gt;:1006: in _find_and_load_unlocked
    ???
&lt;frozen importlib._bootstrap&gt;:688: in _load_unlocked
    ???
/usr/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:169: in exec_module
    source_stat, co = _rewrite_test(fn, self.config)
/usr/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:351: in _rewrite_test
    tree = ast.parse(source, filename=strfn)
/usr/lib64/python3.10/ast.py:50: in parse
    return compile(source, filename, mode, flags,
E     File &quot;/home/builder/rpmbuild/BUILD/ruff-0.4.0/crates/ruff_python_parser/resources/inline/err/if_stmt_missing_test.py&quot;, line 1
E       if : ...
E          ^
E   SyntaxError: invalid syntax
_ ERROR collecting crates/ruff_python_parser/resources/inline/err/while_stmt_missing_test.py _
/usr/lib/python3.10/site-packages/_pytest/python.py:525: in importtestmodule
    mod = import_path(
/usr/lib/python3.10/site-packages/_pytest/pathlib.py:584: in import_path
    importlib.import_module(module_name)
/usr/lib64/python3.10/importlib/__init__.py:126: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
&lt;frozen importlib._bootstrap&gt;:1050: in _gcd_import
    ???
&lt;frozen importlib._bootstrap&gt;:1027: in _find_and_load
    ???
&lt;frozen importlib._bootstrap&gt;:1006: in _find_and_load_unlocked
    ???
&lt;frozen importlib._bootstrap&gt;:688: in _load_unlocked
    ???
/usr/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:169: in exec_module
    source_stat, co = _rewrite_test(fn, self.config)
/usr/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:351: in _rewrite_test
    tree = ast.parse(source, filename=strfn)
/usr/lib64/python3.10/ast.py:50: in parse
    return compile(source, filename, mode, flags,
E     File &quot;/home/builder/rpmbuild/BUILD/ruff-0.4.0/crates/ruff_python_parser/resources/inline/err/while_stmt_missing_test.py&quot;, line 1
E       while : ...
E             ^
E   SyntaxError: invalid syntax
=========================== short test summary info ============================
ERROR crates/ruff_python_parser/resources/inline/err/assert_empty_test.py
ERROR crates/ruff_python_parser/resources/inline/err/if_stmt_missing_test.py
ERROR crates/ruff_python_parser/resources/inline/err/while_stmt_missing_test.py
!!!!!!!!!!!!!!!!!!! Interrupted: 3 errors during collection !!!!!!!!!!!!!!!!!!!!
============================== 3 errors in 1.50s ===============================
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2024-04-19 07:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-19 07:32</div>
            <div class="timeline-body"><p>hi @wuch-g2v</p>
<p>It seems that pytest picks up our parser tests and some of those tests intentionally contain invalid syntax.</p>
<p>Can you tell us more about what command you're running and how you installed ruff?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2024-04-19 08:05</div>
            <div class="timeline-body"><p>Why are you using <code>pytest</code>?</p>
<p>Pytest is picking the three files</p>
<pre><code class="language-text">ERROR crates/ruff_python_parser/resources/inline/err/assert_empty_test.py
ERROR crates/ruff_python_parser/resources/inline/err/if_stmt_missing_test.py
ERROR crates/ruff_python_parser/resources/inline/err/while_stmt_missing_test.py
</code></pre>
<p>because:</p>
<ol>
<li>they are python script</li>
<li>there is the word <code>test</code> in the script name</li>
</ol>
<p>Perhaps there is a little bit of confusion, <code>Ruff</code> is a <code>Rust</code> package which format/lint <code>Python</code> code. Therefore, it is written in <code>Rust</code> and you should use <code>Rust</code> tools to test it. I don't think there are Python tests in the package (or I'm wrong?).</p>
<p>Or I'm misunderstanding your question? :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-19 13:52</div>
            <div class="timeline-body"><p>üëç I think there's a small misunderstanding here. We don't run pytest in Ruff, but we do have some files checked-in that make it look like we use pytest, since we lint against pytest features.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-19 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wuch-g2v">@wuch-g2v</a> on 2024-04-19 14:01</div>
            <div class="timeline-body"><p>I'm using <code>installer</code> module.
Q: what it has to do it install pytest is failing on files test suite in source tree? ü§î
Content of the .whl archive.</p>
<pre><code class="language-console">Archive:  ruff-0.4.0-py3-none-linux_x86_64.whl
  Length      Date    Time    Name
---------  ---------- -----   ----
    24039  04-18-2024 20:43   ruff-0.4.0.dist-info/METADATA
       96  04-18-2024 20:43   ruff-0.4.0.dist-info/WHEEL
    68613  04-18-2024 20:43   ruff-0.4.0.dist-info/license_files/LICENSE
        0  04-18-2024 20:43   ruff/__init__.py
     1045  04-18-2024 20:43   ruff/__main__.py
 21206976  04-18-2024 20:43   ruff-0.4.0.data/scripts/ruff
      530  04-18-2024 20:44   ruff-0.4.0.dist-info/RECORD
---------                     -------
 21301299                     7 files
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wuch-g2v">@wuch-g2v</a> on 2024-04-19 14:05</div>
            <div class="timeline-body"><p>BTW .. why in LICENSE file are included licenses of many other modules?
<code>ruff</code> is written from scratch in rust so it does not inherit any code from those modules.
Idea of performing exact filtering and AFAIK is is not licensedü§î</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:12 UTC
    </footer>
</body>
</html>
