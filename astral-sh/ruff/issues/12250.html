<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linter and formatter considers unrecognized file extension as Python files - astral-sh/ruff #12250</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Linter and formatter considers unrecognized file extension as Python files</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/12250">#12250</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-07-09 03:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-09 03:34</div>
            <div class="timeline-body"><p>Linter:</p>
<pre><code class="language-console">❯ ruff check --extend-select=Q biome.json
biome.json:1:2: Q000 [*] Double quotes found but single quotes preferred
  |
1 | {&quot;$schema&quot;: &quot;https://biomejs.dev/schemas/1.8.2/schema.json&quot;}
  |  ^^^^^^^^^ Q000
  |
  = help: Replace double quotes with single quotes

biome.json:1:13: Q000 [*] Double quotes found but single quotes preferred
  |
1 | {&quot;$schema&quot;: &quot;https://biomejs.dev/schemas/1.8.2/schema.json&quot;}
  |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Q000
  |
  = help: Replace double quotes with single quotes

Found 2 errors.
[*] 2 fixable with the `--fix` option.
</code></pre>
<p>Formatter:</p>
<pre><code class="language-console">❯ ruff format biome.json 
1 file reformatted
</code></pre>
<p>The root cause of this is that <code>PySourceType::from_extension</code> falls back to <code>Python</code> source type if the extension isn't recognized. But, we have the <code>--extension</code> flag to allow users to map any file extension to a Python file so we should use an <code>Option&lt;PySourceType&gt;</code> return type instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2024-07-09 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samamorgan">@samamorgan</a> on 2024-07-10 00:11</div>
            <div class="timeline-body"><p>Is there an intermediate workaround for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-10 05:46</div>
            <div class="timeline-body"><p>@samamorgan Can you describe your workflow where you're facing this issue? Is it in an editor context? If so, are you using <code>ruff-lsp</code> or the new native server (<code>ruff server</code>)? Are you facing this issue via the command-line?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-07-10 12:37</div>
            <div class="timeline-body"><p>Strictly speaking, I think this behaviour might be... correct? If you pass a <code>.json</code> file directly to the Python interpreter and ask it to parse it as Python, the interpreter will happily do so, so it makes sense to me that Ruff would do the same if we passed it a <code>.json</code> file directly:</p>
<pre><code>~/dev/experiment % cat script.json
print(&quot;Hello, world!&quot;)
~/dev/experiment % python script.json
Hello, world!
</code></pre>
<p>Although it's obviously not very common for people to save their Python scripts with <code>.json</code> extensions, it's not uncommon for people to save single-file scripts without any extension at all. E.g. here's a whole folder of them in a pretty popular project: https://github.com/asottile/reorder-python-imports/tree/main/testing</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-10 15:17</div>
            <div class="timeline-body"><p>I think this is correct (or at least intentional). If you pass a file <em>directly</em> to Ruff, we will always try to analyze it. You could probably add <code>*.json</code> to <code>extend-exclude</code> and then run with <code>--force-exclude</code> if you don't want it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samamorgan">@samamorgan</a> on 2024-07-10 18:56</div>
            <div class="timeline-body"><blockquote>
<p>@samamorgan Can you describe your workflow where you're facing this issue? Is it in an editor context? If so, are you using <code>ruff-lsp</code> or the new native server (<code>ruff server</code>)? Are you facing this issue via the command-line?</p>
</blockquote>
<p>I'm trying to update my project from <code>ruff</code> 0.2.2 -&gt; 0.5.1 and have added a pre-commit hook to run <code>ruff format</code>. I hadn't fully thought it through, and needed to add a <code>files</code> pattern for pre-commit, since it's running the hook against all committed files.</p>
<p>My pattern that seems to do the trick: <code>&quot;\\.(py|pyi|ipynb)$&quot;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-10 19:19</div>
            <div class="timeline-body"><p>I think pre-commit should only be passing Python files? You can also set <code>types_or: [ python, pyi, jupyter ]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-11 04:33</div>
            <div class="timeline-body"><p>Pre-commit docs reference: https://pre-commit.com/#filtering-files-with-types</p>
<p>Yeah, I think this behavior makes sense. I'll close this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-07-11 04:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @dhruvmanila on 2024-07-11 04:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @dhruvmanila on 2024-07-11 04:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12318.html">astral-sh/ruff#12318</a> on 2024-07-14 13:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
