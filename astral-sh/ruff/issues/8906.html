<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIE810 gives wrong suggestions - astral-sh/ruff #8906</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>PIE810 gives wrong suggestions</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8906">#8906</a>
        opened by <a href="https://github.com/deliro">@deliro</a>
        on 2023-11-29 08:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/deliro">@deliro</a> on 2023-11-29 08:36</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Hey! Given the code:</p>
<pre><code class="language-python">import sys

if __name__ == &quot;__main__&quot;:
    x = (&quot;hello&quot;, &quot;world&quot;)
    y = &quot;foo&quot;

    msg = &quot;abracadabra&quot;

    if msg.startswith(x) or msg.startswith(y):
        sys.exit(1)
</code></pre>
<p>Ruff suggests (<code>ruff check x.py</code>):</p>
<pre><code>x.py:9:8: PIE810 Call `startswith` once with a `tuple`
</code></pre>
<p>The problem is <code>x</code> is a tuple and the expression cannot be combined to <code>msg.startswith((x, y))</code></p>
<h5>Ruff settings</h5>
<pre><code class="language-yaml">[tool.ruff]
line-length = 120
target-version = &quot;py311&quot;
exclude = [&quot;*migrations*&quot;]
select = [
    &quot;E&quot;, # pyflakes
    &quot;F&quot;, # pycodestyle errors
    &quot;W&quot;, # pycodestyle warnings
    &quot;UP&quot;, # pyupgrade
    &quot;I&quot;, # isort
    &quot;C4&quot;, # flake8-comprehensions
    # pytest
    &quot;PT018&quot;, # Assertion should be broken down into multiple parts
    &quot;PT022&quot;, # No teardown in fixture {name}, use return instead of yield

    &quot;T10&quot;, # flake8-debugger
    &quot;SIM&quot;, # flake8-simplify
    &quot;ISC&quot;, # flake8-implicit-str-concat
    &quot;FA&quot;, # flake8-future-annotations
    &quot;PIE&quot;, # flake8-pie
    &quot;T20&quot;, # flake8-print
    &quot;RET&quot;, # flake8-return
    &quot;FLY&quot;, # flynt
]
ignore = [
    &quot;E741&quot;, # Ambiguous variable name
    &quot;SIM115&quot;, # Use context handler for opening files
    &quot;SIM116&quot;, # Use a dictionary instead of consecutive `if` statements
    &quot;RET501&quot;, # Do not explicitly return None in function if it is the only possible return value
    # broken ones in RET:
    &quot;RET505&quot;, # Unnecessary `elif` after `return` statement
    &quot;RET506&quot;, # Unnecessary `elif` after `raise` statement
    &quot;RET507&quot;, # Unnecessary `elif` after `continue` statement
    &quot;RET508&quot;, # Unnecessary {branch} after break statement
]
</code></pre>
<h5>Ruff version</h5>
<p>ruff 0.1.6 (f460f9c5c 2023-11-17)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/prokie">@prokie</a> on 2023-11-29 08:46</div>
            <div class="timeline-body"><p>I guess you can do like this?</p>
<pre><code class="language-python">if msg.startswith(x + (y,)):
    sys.exit(1)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/deliro">@deliro</a> on 2023-11-29 08:50</div>
            <div class="timeline-body"><p>I can, but the point is ruff suggests invalid code that will throw</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-11-29 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-29 14:53</div>
            <div class="timeline-body"><p>Makes sense, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-30 21:54</div>
            <div class="timeline-body"><p>I guess one solution would be to avoid raising the violation if we're sure that it's a collection type like the mentioned code:</p>
<pre><code class="language-python">x = [&quot;a&quot;, &quot;b&quot;]
y = &quot;c&quot;

msg.startswith(x) or msg.startswith(y)
</code></pre>
<p>But, if there are more than 1 <code>startswith</code> calls which has non-collection type or an unknown type, then we can raise an error:</p>
<pre><code class="language-python">x = [&quot;a&quot;, &quot;b&quot;]
y = &quot;c&quot;
z = &quot;d&quot;

msg.startswith(x) or msg.startswith(y) or msg.startswith(z)
#                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
#                    Raise here
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/9661.html">astral-sh/ruff#9661</a> on 2024-01-28 12:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-28 19:24</div>
            <div class="timeline-body"><p>Closed by https://github.com/astral-sh/ruff/pull/9661.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-01-28 19:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ArduPilot/ardupilot/pulls/30343.html">ArduPilot/ardupilot#30343</a> on 2025-06-14 09:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
