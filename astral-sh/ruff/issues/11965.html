<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCH010 False positive when one argument is a TypeVar. - astral-sh/ruff #11965</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>TCH010 False positive when one argument is a TypeVar.</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11965">#11965</a>
        opened by <a href="https://github.com/randolf-scholz">@randolf-scholz</a>
        on 2024-06-21 12:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/randolf-scholz">@randolf-scholz</a></div>
            <div class="timeline-body"><p><a href="https://docs.astral.sh/ruff/rules/runtime-string-union/">Rule TCH010</a> should not apply when either argument is a TypeVar:</p>
<pre><code class="language-python">from typing import TypeVar
X =TypeVar(&quot;X&quot;)
X | &quot;test&quot;  # no RuntimeError, because TypeVar implements __or__
</code></pre>
<p>This matters for instance for recursive type aliases:</p>
<pre><code class="language-python">NestedMapping: TypeAlias = Mapping[K, V | &quot;NestedMapping[K,V]&quot;]
</code></pre>
<p>Here, writing <code>Mapping[K, &quot;V | NestedMapping[K,V]&quot;]</code> instead would cause errors at runtime, because the type-alias will only expect one argument:</p>
<pre><code class="language-python">from typing import TypeVar, Mapping, TypeAlias
K = TypeVar(&quot;K&quot;)
V = TypeVar(&quot;V&quot;)
NestedMapping: TypeAlias = Mapping[K, V | &quot;NestedMapping[K,V]&quot;]
NestedMapping2: TypeAlias = Mapping[K, &quot;V | NestedMapping2[K,V]&quot;]
NestedMapping[str, float]  # Mapping[str, Union[float, ForwardRef('NestedMapping[K,V]')]]
NestedMapping2[str, float]  # TypeError: Too many arguments
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @AlexWaygood on 2024-06-21 12:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-06-21 12:42</div>
            <div class="timeline-body"><p>I feel like the only way we could implement this is by special-casing <code>TypeVar</code> and certain other special types from the <code>typing</code> module. But your use case is fairly persuasive, so I guess that's what we'll have to do :/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-06-21 12:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/randolf-scholz">@randolf-scholz</a> on 2025-10-28 19:13</div>
            <div class="timeline-body"><p>This probably can be closed with <code>wont-fix</code>, as this resolves itself with PEP 695 style type aliases.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:30 UTC
    </footer>
</body>
</html>
