<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File-scoped `flake8: noqa` directive with comment is not recognized - astral-sh/ruff #10239</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>File-scoped <code>flake8: noqa</code> directive with comment is not recognized</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10239">#10239</a>
        opened by <a href="https://github.com/tylerlaprade">@tylerlaprade</a>
        on 2024-03-05 17:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tylerlaprade">@tylerlaprade</a></div>
            <div class="timeline-body"><pre><code># flake8: noqa -- comment explaining why we&#x27;re disabling flake8 for this file
</code></pre>
<p>As per <a href="https://docs.astral.sh/ruff/linter/#error-suppression">Ruff&#x27;s documentation</a>, this is treated the same as <code># ruff: noqa</code>, which doesn&#x27;t allow comments. However, <code>flake8</code> <em>does</em> allow comments - and I happen to believe comments should be required any time some/all rules are disabled to explain why. This particular comment is in fact being used to disable <code>flake8</code> for this file. The author would have liked to also disable Ruff for the whole file, but didn&#x27;t realize that the comment could do both due to the comment, and ended up disabling the particular line with a Ruff violation.</p>
<p>This came to my attention when I upgraded to Ruff v0.3.0 (I&#x27;m very excited to try the new formatting, by the way!). I ran <code>ruff check</code> and got a warning every time:</p>
<pre><code>warning: Invalid `# ruff: noqa` directive at abacus/migrations/0324_manual_recompute_all_patient_journeys.py:2: expected `:` followed by a comma-separated list of codes (e.g., `# noqa: F401, F841`).
</code></pre>
<p>Ideally, comments would be allowed on <code>ruff: noqa</code>. But even if not, Ruff should not be warning about a valid <code>flake8</code> directive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 18:23</div>
            <div class="timeline-body"><p>I think a format we could allow (which would be consistent with <code># noqa</code>) would be like: <code># flake8: noqa # some comment</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-05 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2024-03-05 20:31</div>
            <div class="timeline-body"><p>I got in the habit of using <code>--</code> from ESLint, but any consistent format would be good, and I think it&#x27;d be good if Ruff chose a single format, whatever that is, to help the community standardize (and to encourage commenting on why rules are suppressed).</p>
<p>That being said, anything that Flake8 currently allows should at the very least not trigger a Ruff warning, since a large legacy codebase might be discouraged from migrating if they see hundreds of warnings on previously valid code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-11 17:17</div>
            <div class="timeline-body"><p>Related discussion at <a href="https://github.com/astral-sh/ruff/pull/8876">astral-sh/ruff#8876</a>#issuecomment-1831171627</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-11 17:21</div>
            <div class="timeline-body"><p>Going to track this in <a href="https://github.com/astral-sh/ruff/issues/10343">astral-sh/ruff#10343</a> instead since this is not a flake8-specific problem.</p>
<p>Thank you for raising! If you have thoughts on the design please respond over there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-11 17:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:50 UTC
    </footer>
</body>
</html>
