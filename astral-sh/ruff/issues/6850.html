<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule: prefer `if` over ternary operation evaluating to `None` if cond doesn't hold - astral-sh/ruff #6850</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule: prefer `if` over ternary operation evaluating to `None` if cond doesn't hold</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/6850">#6850</a>
        opened by <a href="https://github.com/dorschw">@dorschw</a>
        on 2023-08-24 11:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dorschw">@dorschw</a> on 2023-08-24 11:21</div>
            <div class="timeline-body"><h3>Proposal</h3>
<p>Disallow ternary operations that:</p>
<ul>
<li>if <code>condition</code> holds, call a method</li>
<li>otherwise, do nothing (the whole expression evaluates to<code>None</code>)</li>
</ul>
<p>e.g. <code>method(...) if condition else None</code></p>
<h3>Why is it bad?</h3>
<p>Can be autofixed, simplified, and be clearer for future maintainers.</p>
<h3>Examples &amp; autofix</h3>
<pre><code class="language-diff">- print(&quot;üêç&quot;) if condition else None
+ if condition:
+     print(&quot;üêç&quot;)
</code></pre>
<pre><code class="language-diff">- dictionary.update({&quot;foo&quot;:&quot;bar&quot;}) if condition else None
+ if condition:
+     dictionary.update({&quot;foo&quot;:&quot;bar&quot;})
</code></pre>
<p><em>(the second example can be simplified to <code>dictionary[&quot;foo&quot;]=&quot;bar&quot;</code>, but the example is what inspired this proposal, and the simplification doesn't serve as good example)</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../demisto/content/pulls/28992.html">demisto/content#28992</a> on 2023-08-24 11:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Rule: useless ternary operation - `method() if cond else None`" to "Rule: prefer `if` over ternary operation evaluating to `None` if cond doesn't hold" by @dorschw on 2023-08-24 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @zanieb on 2023-08-24 21:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wookie184">@wookie184</a> on 2023-08-26 14:03</div>
            <div class="timeline-body"><p>Would a better rule just be one that just triggered if the result of a ternary is unused (i.e. on a line by itself)? I think that would still catch both of your cases, but would avoid potential false positives e.g.</p>
<pre><code class="language-python">maybe_int = int(s) if s.isdecimal() else None
</code></pre>
<p>And would also catch extra cases like:</p>
<pre><code class="language-python">print(&quot;hello&quot;) if cond else print(&quot;goodbye&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wookie184">@wookie184</a> on 2023-08-26 15:39</div>
            <div class="timeline-body"><p>I can have a go at implementing this, I assume it would be a <code>RUF</code> rule since I can't see an implementation elsewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-08-26 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-26 15:53</div>
            <div class="timeline-body"><p>We could include it as a <code>RUF</code> rule. I'd like to see if it flags anything on the ecosystem CI checks before committing to merging it. Are you open to implementing, then evaluating whether there are valid patterns that we might be overlooking based on what gets flagged?</p>
<p>(I think your suggestion of checking if the result is unused makes sense -- so checking for <code>StmtExpr</code> where the <code>Expr</code> is a ternary.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wookie184">@wookie184</a> on 2023-08-26 16:09</div>
            <div class="timeline-body"><p>Yeah that sounds good, it doesn't look too difficult to implement so there'd be little loss if we decide not to continue after opening a PR üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6900.html">astral-sh/ruff#6900</a> on 2023-08-26 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fgimian">@fgimian</a> on 2024-01-09 12:57</div>
            <div class="timeline-body"><p>I think there's merit in a rule that completely disallows ternary expressions as they <a href="https://github.com/nedbat/coveragepy/issues/509">cannot be accurately measured by coverage.py</a>. There's <a href="https://github.com/afonasev/flake8-if-expr">flake8-if-expr</a> which does this.</p>
<p>Would it be possible to support this as part of this feature please?</p>
<p>Thanks heaps
Fotis</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
