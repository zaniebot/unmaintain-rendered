<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>operate on files with certain hashbang - astral-sh/ruff #2192</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>operate on files with certain hashbang</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2192">#2192</a>
        opened by <a href="https://github.com/spaceone">@spaceone</a>
        on 2023-01-26 12:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-26 12:21</div>
            <div class="timeline-body"><p>ruff seems only to search for files with <code>.py</code> (maybe also `.pyi) file extensions?!</p>
<p>it would be good to detect some certain hashbangs like:
<code>!#/usr/bin/python</code>
<code>!#/usr/bin/python3</code>
<code>!#/usr/bin/python -b</code>
<code>!#/usr/bin/env python3</code></p>
<p>and it would be nice to be able to put further definitions in the config files, we e.g. have definitions like:
<code>#!/usr/share/test/runner python3</code>
<code>#!/usr/share/test/runner py.test-3</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @charliermarsh on 2023-01-26 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sciyoshi">@sciyoshi</a> on 2023-01-26 14:49</div>
            <div class="timeline-body"><p>Rather than looking for a specific shebang, maybe a configuration could be added to include certain files based on paths?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-26 14:52</div>
            <div class="timeline-body"><p>Yeah, I'm extremely hesitant to check every file for a shebang.</p>
<p>If you pass a file to Ruff directly, it will check it, even if it's not a <code>.py</code> or <code>.pyi</code> file (like <code>ruff /path/to/file</code>). That's what most users have done in the past. Though I'd be open to some kind of opt-in list.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-26 14:55</div>
            <div class="timeline-body"><p>I wouldn't use a configurable list of files as files are too often just changing by too many people. The files are tracked in git and all of them might be relevant.</p>
<p>What's wrong with checking hashbangs? I am using it currently and it is not really making a performance issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-26 14:58</div>
            <div class="timeline-body"><p>I assume it will come at a performance cost. I'd need to benchmark it.</p>
<p>Is there a common extension on those files? (Or even: do they all have <em>no</em> extension?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-26 14:58</div>
            <div class="timeline-body"><p>I guess they all have no extension. simple scripts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-26 15:00</div>
            <div class="timeline-body"><p>We could consider checking non-extension files for hashbangs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-26 15:03</div>
            <div class="timeline-body"><p>That would be great. we have 462 python files without file extensions and 4 python files with (accidental) file extensions (<code>.in</code>, <code>.conf</code>, <code>.3</code>, <code>.0-dev</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sciyoshi">@sciyoshi</a> on 2023-01-26 15:05</div>
            <div class="timeline-body"><p>Another simple workaround would be to find the files separately and pass those explicitly to ruff, e.g. (with ripgrep):</p>
<pre><code>rg -l -0 '\A#!/usr/bin/env python' | xargs -0 ruff
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-26 15:09</div>
            <div class="timeline-body"><p>yes, this is kind of my current workaround.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-01-27 11:38</div>
            <div class="timeline-body"><p>This workaround would also be needed in a pre-commit hook, where I did not yet find out how to achieve it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-08 21:28</div>
            <div class="timeline-body"><p>ok, <code>pre-commit</code> already supports it: it first searches for files with <code>.py</code>[<code>i</code>] extension and then for executable files with common python hashbangs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-08 22:55</div>
            <div class="timeline-body"><p>This could also be solved by https://github.com/charliermarsh/ruff/issues/3410, sort of, though you'd have to enumerate them explicitly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/neingeist">@neingeist</a> on 2023-03-08 22:57</div>
            <div class="timeline-body"><blockquote>
<p>This could also be solved by #3410, sort of, though you'd have to enumerate them explicitly.</p>
</blockquote>
<p>For me, it would suffice to include them explicitly and I agree that performance could suffer if ruff would read every file to search for the bang.</p>
<p>(Using the term &quot;include&quot; here, because the include option is how you can do it with Black.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-04-12 03:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-04-12 07:15</div>
            <div class="timeline-body"><p>hm,  #3914 closed it but this allows only files with a specific extension. our files/scripts don't have any file extension.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-12 14:40</div>
            <div class="timeline-body"><p>Ah yeah, the reasoning was that this now provides a manual workaround, analogous to Black's own configuration (whereby you can specify the script names in the <code>extend-include</code> vector). I'm open to re-opening this, although I don't yet have a solution that I'm happy with for supporting arbitrary scripts via shebangs, so I can't commit to improving it further.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:02 UTC
    </footer>
</body>
</html>
