<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pyupgrade (`UP`) fixes do not include `dict`/`set` literal fixes - astral-sh/ruff #12592</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pyupgrade (<code>UP</code>) fixes do not include <code>dict</code>/<code>set</code> literal fixes</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12592">#12592</a>
        opened by <a href="https://github.com/stephenfin">@stephenfin</a>
        on 2024-07-31 10:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/stephenfin">@stephenfin</a> on 2024-07-31 10:47</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>I noticed that the pyupgrade fixes result in different output to pyupgrade itself. Namely, it doesn't apply replace the use of <code>dict()</code> and <code>set()</code> with the equivalent literals.</p>
<pre><code>x = dict(a=1)
y = dict((a, b) for a, b in ['a', '1'])
a = set(['a', 'b'])
b = set([x for x in ['a', 'b']])
</code></pre>
<p><code>pyupgrade</code> identifies and replaces these:</p>
<pre><code>‚ùØ pyupgrade --py38-plus test.py 
Rewriting test.py
‚ùØ cat test.py 
x = dict(a=1)
y = {a: b for a, b in ['a', '1']}
a = {'a', 'b'}
b = {x for x in ['a', 'b']}
</code></pre>
<p><code>ruff</code> does not (at least not using just the <code>U</code> fix class):</p>
<pre><code>‚ùØ ruff check --select U --fix --unsafe-fixes test.py 
All checks passed!
</code></pre>
<p>However, while I couldn't find anything confirming this (it's not mentioned in https://github.com/astral-sh/ruff/issues/827 and a search through other issues didn't highlight anything), it seems enabling another class of rules, the flake8-comprehensions (<code>C4</code>), resolves this.</p>
<pre><code>‚ùØ ruff check --select U,C4 --fix --unsafe-fixes test.py 
Found 7 errors (7 fixed, 0 remaining).
‚ùØ cat test.py 
x = {'a': 1}
y = dict(['a', '1'])
a = {'a', 'b'}
b = {'a', 'b'}
</code></pre>
<p>I don't know if the documentation tooling allows this (https://docs.astral.sh/ruff/rules/ appears to be auto-generated) but it could be helpful to provide a pointer or note to this effect for someone looking to replace pyupgrade wholesale? Alternatively, maybe this issue is enough of a pointer and it can simply be closed straight off :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "pyupgrade (`U`) fixes do not include `dict`/`set` literal fixes" to "pyupgrade (`UP`) fixes do not include `dict`/`set` literal fixes" by @stephenfin on 2024-07-31 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-31 12:47</div>
            <div class="timeline-body"><p>üëç Yeah I think we just rolled these out under the <code>C4</code> category because the already existed there. I'm not sure where we could relay this information. We've talked about supporting rule aliases in the past, but it raises all kinds of tricky UX questions ü§î</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2024-07-31 12:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:30 UTC
    </footer>
</body>
</html>
