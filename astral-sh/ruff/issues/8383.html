<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider non-whitespace split points for line-too-long exemptions - astral-sh/ruff #8383</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider non-whitespace split points for line-too-long exemptions</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/8383">#8383</a>
        opened by <a href="https://github.com/alanwilter">@alanwilter</a>
        on 2023-10-31 17:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alanwilter">@alanwilter</a> on 2023-10-31 17:52</div>
            <div class="timeline-body"><p>I have this line of code:</p>
<pre><code class="language-python">        if not opt.save_model_path:
            opt.save_model_path = os.path.abspath(
                f&quot;models_out/FineTuned_{os.path.basename(opt.model_path).split('.')[0]}_{opt.feature_name}_{opt.loss}_{today_date_string}.pth&quot;
            )
            print(f&quot;Model name is automatically set to {opt.save_model_path}&quot;)
</code></pre>
<p>The offending line has 143 chars and my <code>pyproject.toml</code> is:</p>
<pre><code class="language-toml">[tool.ruff]
target-version = &quot;py39&quot;
line-length = 120
extend-select = [
    &quot;B&quot;,   # flake8-bugbear
    &quot;C4&quot;,  # flake8-comprehensions
    &quot;ERA&quot;, # flake8-eradicate/eradicate
    &quot;I&quot;,   # isort
    &quot;N&quot;,   # pep8-naming
    # &quot;NPY&quot;, # numpy
    &quot;PIE&quot;,  # flake8-pie
    &quot;PGH&quot;,  # pygrep
    &quot;RUF&quot;,  # ruff checks
    &quot;SIM&quot;,  # flake8-simplify
    &quot;TCH&quot;,  # flake8-type-checking
    &quot;TID&quot;,  # flake8-tidy-imports
    &quot;UP&quot;,   # pyupgrade
    &quot;E501&quot;, # check line length
]
</code></pre>
<p>But <code>ruff check . --select E501  --line-length=120</code> does not pick it!
I understand that this line:</p>
<pre><code class="language-python">f&quot;models_out/FineTuned_{os.path.basename(opt.model_path).split('.')[0]}_{opt.feature_name}_{opt.loss}_{today_date_string}.pth&quot;
</code></pre>
<p>cannot be automatically formatted but the others linters will spot them.
Also, if I comment the line like:
<code># hi f&quot;models_out/FineTuned_{os.pa...</code> and run <code>ruff check . --select E501  --line-length=120</code> I get this:</p>
<pre><code>isam/main.py:71:121: E501 Line too long (144 &gt; 120)
</code></pre>
<p>So it seems like a bug for me. Because I truly want anything going beyond 120 chars limit so I can fix manually if needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2023-10-31 21:12</div>
            <div class="timeline-body"><pre><code class="language-py">#LINE_WITH_89_CHARACTERSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
</code></pre>
<p>Also tried this with <code>ruff check test.py --select E501</code>, no violation reported!
After adding a whitespace after <code>#</code>, it starts reporting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-31 21:16</div>
            <div class="timeline-body"><p>We don't enforce E501 on lines that consist of a single token -- this is mentioned in the rule documentation <a href="https://docs.astral.sh/ruff/rules/line-too-long/">here</a>. The comment is actually a decent example of why: sometimes, there just isn't a way to split a line, and so enforcing the lint rule isn't' really helpful.</p>
<p>I suspect we could do a better job with the f-string case, since there actually are some reasonable split points in that code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-10-31 21:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alanwilter">@alanwilter</a> on 2023-10-31 21:27</div>
            <div class="timeline-body"><p>But I'd still like to be warned about long lines.</p>
<pre><code class="language-bash">flake8 test.py
test.py:2:80: E501 line too long (126 &gt; 79 characters)
</code></pre>
<p>One of the reason I move to <code>ruff</code> was to get rid of <code>flake8</code>. It should be enforced. There's a pragma in <code>flake8</code> to ignore long lines if you really need it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-31 21:44</div>
            <div class="timeline-body"><p>We could consider adding a strict mode for this rule that ignores all the stated exemptions. But I think it would need to be all-or-nothing (so, e.g., when that setting is enabled, we'd also flag URLs that exceed the line length limit, which are allowed right now).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-10-31 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @charliermarsh on 2023-10-31 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-10-31 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2023-10-31 21:46</div>
            <div class="timeline-body"><blockquote>
<ol>
<li>Ignores lines that consist of a single &quot;word&quot; (i.e., without any whitespace between its characters).</li>
</ol>
</blockquote>
<p>I agree with it, but whitespace is not only word separator. In mentioned example in description, I see +10 words.
IMO something like <code>str.isidentifier()</code> check in python could be happened instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alanwilter">@alanwilter</a> on 2023-10-31 21:51</div>
            <div class="timeline-body"><p>Reading <a href="https://docs.astral.sh/ruff/rules/line-too-long/">E501</a> and I agree with the 3 exceptions. I just don't get why my original example is an exception.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-31 21:54</div>
            <div class="timeline-body"><p>@alanwilter - It's because there's no whitespace anywhere on the line, so Ruff doesn't think it's splittable. I think we can do a better job of figuring out whether the line is splittable though. (That exemption wasn't designed for cases like the one in your example, I agree that it's not quite right.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-31 21:56</div>
            <div class="timeline-body"><blockquote>
<p>Reading <a href="https://docs.astral.sh/ruff/rules/line-too-long/">E501</a> and I agree with the 3 exceptions. I just don't get why my original example is an exception.</p>
</blockquote>
<p>It's because the line contains no whitespace (not justifying that it is correct, but it is why it the reason why the line isn't flagged):</p>
<blockquote>
<p>Ignores lines that consist of a single &quot;word&quot; (i.e., without any whitespace between its characters).</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alanwilter">@alanwilter</a> on 2023-10-31 22:08</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<ol>
<li>Ignores lines that consist of a single &quot;word&quot; (i.e., without any whitespace between its characters).</li>
</ol>
</blockquote>
<p>I agree with it, but whitespace is not only word separator. In mentioned example in description, I see +10 words. IMO something like <code>str.isidentifier()</code> check in python could be happened instead.</p>
</blockquote>
<p>Ah, ok, thanks @charliermarsh. So now I agree with @T-256. IIRC, <code>ruff</code> knows about commented python code lines (<a href="https://docs.astral.sh/ruff/rules/commented-out-code/">ERA001</a>), so it should know when a long line is a python code too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/T-256">@T-256</a> on 2023-10-31 22:24</div>
            <div class="timeline-body"><blockquote>
<p><code>ruff</code> knows about commented python code lines (<a href="https://docs.astral.sh/ruff/rules/commented-out-code/">ERA001</a>), so it should know when a long line is a python code too.</p>
</blockquote>
<p>This check is unnecessary for this rule.</p>
<p>https://github.com/astral-sh/ruff/blob/1642f4dbd9d4ff04e50d08b88eebbbef6e4cc077/crates/ruff_linter/src/rules/pycodestyle/overlong.rs#L55-L59
Instead here should split by word separators instead of only whitespace.
Sample word separators got from default VSCode settings:</p>
<pre><code>`~!@#$%^&amp;*()-=+[{]}\|;:'&quot;,.&lt;&gt;/?
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-31 23:30</div>
            <div class="timeline-body"><p>I'm open to something like that, though we may need to see how it affects existing projects (via our ecosystem checks, which run automatically on every PR).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> removed by @charliermarsh on 2023-11-03 03:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @charliermarsh on 2023-11-03 03:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-11-03 03:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Line length check/format does not work in a specific case" to "Consider non-whitespace split points for line-too-long exemptions" by @charliermarsh on 2023-11-03 03:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8922.html">astral-sh/ruff#8922</a> on 2023-11-30 14:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8939.html">astral-sh/ruff#8939</a> on 2023-12-01 03:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11432.html">astral-sh/ruff#11432</a> on 2024-05-15 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15236.html">astral-sh/ruff#15236</a> on 2025-01-03 08:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
