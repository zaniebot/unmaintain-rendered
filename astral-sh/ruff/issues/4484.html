<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expected for noqa to be ignored for multi-line string variable? - astral-sh/ruff #4484</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Expected for noqa to be ignored for multi-line string variable?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4484">#4484</a>
        opened by <a href="https://github.com/fennerm">@fennerm</a>
        on 2023-05-17 22:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/fennerm">@fennerm</a> on 2023-05-17 22:29</div>
            <div class="timeline-body"><p>(ruff=v0.0.267).</p>
<p>Based on the docs we can add a noqa annotation to a multi-line string as follows:</p>
<pre><code>&quot;&quot;&quot;
Some long
string.
&quot;&quot;&quot;  # noqa
</code></pre>
<p>I would assume this should also be true if the string is a variable, but the noqa annotation seems to be ignored in that case.</p>
<p>Minimal example:</p>
<pre><code>weirdly_Cased: str = &quot;&quot;&quot;
Some long
string.
&quot;&quot;&quot;  # noqa: N816
</code></pre>
<p>Ruff outputs:</p>
<pre><code>N816 Variable `weirdly_Cased` in global scope should not be mixedCase
RUF100 [*] Unused `noqa` directive (unused: `N816`)
</code></pre>
<p>Possible that this case is deliberately not supported yet but figured I'd flag it. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Is it expected for noqa to be ignored for this multi-line string variable?" to "Expected for noqa to be ignored for multi-line string variable?" by @fennerm on 2023-05-17 22:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-18 00:47</div>
            <div class="timeline-body"><p>Hmm -- I suspect this changed when we did the &quot;byte offset&quot; refactor (\cc @MichaReiser), though I'm torn on what should be considered &quot;correct&quot; here... The motivation for respecting <code>noqa</code> directives at the end of multi-line strings is that you can't feasible put a <code>noqa</code> directive <em>within</em> a multi-line string (otherwise, it becomes part of the string itself). In this case, you <em>could</em> put the <code>noqa</code> here:</p>
<pre><code class="language-py">weirdly_Cased: str = (  # noqa: N816
    &quot;&quot;&quot;
Some long
string.
&quot;&quot;&quot;
)
</code></pre>
<p>But, we're clearly not making that change with <code>--add-noqa</code>, and it feels somewhat &quot;surprising&quot; that the form you provided above doesn't work.</p>
<p>What do you think, @MichaReiser?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-05-18 00:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">noqa</span> added by @charliermarsh on 2023-05-18 00:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-05-18 12:08</div>
            <div class="timeline-body"><p>I think this is a bug and can probably be fixed by remapping the range from the start of the line instead of the multiline-string range only in:</p>
<p>https://github.com/charliermarsh/ruff/blob/ddd541b1987493a69ef5e8f65ef8030eda6198cd/crates/ruff/src/directives.rs#L100-L107</p>
<p>by using <code>string_mappings.push(TextRange::new(locator.line_start(range.start()), range.end()));</code></p>
<pre><code class="language-py">weirdly_Cased: str = (  # noqa: N816
    &quot;&quot;&quot;
Some long
string.
&quot;&quot;&quot;
)
</code></pre>
<p>should then continue to work because we only remap the lines of the multiline-string, not the assignment's line</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-05-18 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4490.html">astral-sh/ruff#4490</a> on 2023-05-18 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-18 13:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
