<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid enforcing EXE001 and EXE002 checks on WSL + Windows *file systems* - astral-sh/ruff #5445</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid enforcing EXE001 and EXE002 checks on WSL + Windows <em>file systems</em></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/5445">#5445</a>
        opened by <a href="https://github.com/bersbersbers">@bersbersbers</a>
        on 2023-06-29 18:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bersbersbers">@bersbersbers</a></div>
            <div class="timeline-body"><p>This is a follow-up to <a href="https://github.com/astral-sh/ruff/issues/3110">astral-sh/ruff#3110</a>, and I am not sure it is valid, but I wanted to at least bring it up.</p>
<p>Running WSL on Windows means one can easily use a Windows file system as working directory. However, such file system do not support the executable flag, so to make <em>anything</em> executable, <em>everything</em> is considered executable (see also <a href="https://github.com/microsoft/WSL/issues/936">microsoft/WSL#936</a>). That triggers EXE002.</p>
<p>So I wonder if #3111 could be extended to ignore not only Window operation system, but also Windows file systems on Linux. One way of detecting such file systems would be by creating a new file and checking if it is executable:</p>
<pre><code>bers@hostname:~$ touch foo
bers@hostname:~$ ll foo
-rw-r--r-- 1 bers bers 0 Jun 29 20:06 foo
bers@hostname:~$ cd /mnt/c/Code/project
bers@hostname:/mnt/c/Code/project$ touch foo
bers@hostname:/mnt/c/Code/project$ ll foo
-rwxrwxrwx 1 bers bers 0 Jun 29 20:06 foo*
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bersbersbers">@bersbersbers</a> on 2023-06-29 18:24</div>
            <div class="timeline-body"><p>Another way might be this:</p>
<pre><code>bers@hostname:/mnt/c/Code/project$ df -T | grep /mnt/c
drvfs          9p       498171168 427346648  70824520  86% /mnt/c
</code></pre>
<p>but this may yield false-positives since metadata can also be enabled on these file systems.</p>
<p>In fact, a suggested workaround is to mount <code>/mnt/c</code> with <code>metadata</code>, which in fact allows to do <code>chmod -x</code> succesfully.</p>
<p>However:</p>
<pre><code>bers@hostname:/mnt/c/Code/project$ more /etc/wsl.conf
[automount]
options = &quot;metadata&quot;

bers@hostname:/mnt/c/Code/project$ ll bug.py
-rw-rw-rw- 1 bers bers 1232 Jun 29 13:37 bug.py

bers@hostname:/mnt/c/Code/project$ ruff bug.py
bug.py:1:1: EXE002 The file is executable but no shebang is present
Found 1 error.
</code></pre>
<p>I had to <code>rm -rf .ruff_cache/</code> to make it work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-30 02:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-30 02:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-01 02:34</div>
            <div class="timeline-body"><p>I think this makes sense. There&#x27;s a crate we can use for this apparently: https://crates.io/crates/wsl.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-01 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-01 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-01 02:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-13 11:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:38 UTC
    </footer>
</body>
</html>
