<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implicit string concatenation rule with a list with a comment in between  - astral-sh/ruff #20854</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Implicit string concatenation rule with a list with a comment in between </h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20854">#20854</a>
        opened by <a href="https://github.com/notatallshaw">@notatallshaw</a>
        on 2025-10-14 04:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-10-14 04:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Currently this will not be picked up by any implicit concatenation rule nor by formatting:</p>
<pre><code class="language-python">foobar = [
    &quot;foo&quot;
    # Implicit concatenation occurs even with comment
    &quot;bar&quot;
]

print(foobar)
</code></pre>
<p>Every other issue I could find on this appeared to be closed, but none of them seemed to handle the edge case of comments in between. So apologies if this is a duplicate but I couldn't find it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Implicit string concatination rule with a list with comments" to "Implicit string concatenation rule with a list with a comment in between " by @notatallshaw on 2025-10-14 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypa/packaging/pulls/946.html">pypa/packaging#946</a> on 2025-10-14 04:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2025-10-14 06:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-10-14 06:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @dylwil3 on 2025-10-15 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @dylwil3 on 2025-10-15 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dylwil3 on 2025-10-15 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-10-15 21:35</div>
            <div class="timeline-body"><p>As explained in the docs for <code>ISC002</code>, this is picked up if <a href="https://docs.astral.sh/ruff/settings/#lint_flake8-implicit-str-concat_allow-multiline">lint.flake8-implicit-str-concat.allow-multiline</a> is set to <code>false</code>. <a href="https://play.ruff.rs/7ca53671-06f8-4039-b68f-2d94ffa8072f">Playground</a></p>
<p>I guess maybe it could be worth considering whether that option should <em>default</em> to <code>false</code>? Since I think this has come up before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-10-15 21:46</div>
            <div class="timeline-body"><p>I don't have to deal with backlash of changing ruff defaults, but I would say yes.</p>
<p>This incorrect test has been sitting in the packaging repo for 11 years: https://github.com/pypa/packaging/pull/946/files. So it's a case that's pretty easy to miss.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-10-15 21:57</div>
            <div class="timeline-body"><p>Actually I just tried tuning on <code>tool.ruff.lint.flake8-implicit-str-concat</code> for the packaging repo and I see the problem with it, it errors on something like this:</p>
<pre><code class="language-python">        assert ctx.exconly() == (
            &quot;packaging.requirements.InvalidRequirement: &quot;
            &quot;Expected marker operator, one of &lt;=, &lt;, !=, ==, &gt;=, &gt;, ~=, ===, &quot;
            &quot;in, not in\n&quot;
            &quot;    name; '3.7' ~ python_version\n&quot;
            &quot;                ^&quot;
        )
</code></pre>
<p>But the use of parenthesis to hold a long implicitly concatenated string across multiple lines is common practice.</p>
<p>What is bad practice, and usually an error, at least IMO, is the use of multi-line implicitly concatenated string in a container literal like a list, tuple, or set.</p>
<p>So ideally I would like some option that errors on the latter, but not the former.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-10-15 22:10</div>
            <div class="timeline-body"><p>That makes sense. Can you help me distinguish between this issue and https://github.com/astral-sh/ruff/issues/13014 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw">@notatallshaw</a> on 2025-10-15 23:21</div>
            <div class="timeline-body"><p>#13014 would have caught the original issue, and I don't mind this issue being marked as a duplicate of that.</p>
<p>But one thing I'll add now I've played around with this a little is I would also want this to be caught:</p>
<pre><code class="language-python">facts = [
    &quot;Lobsters have blue blood.&quot;,
    &quot;The liver is the only human organ that can fully regenerate itself.&quot;,
    &quot;Clarinets are made almost entirely out of wood from the mpingo tree.&quot;
    &quot;In 1971, astronaut Alan Shepard played golf on the moon.&quot;,
]
</code></pre>
<p>Here there is no comment separating the implicit string literal, but this is not caught by any of the default setting of ISC, nor formatting (because the strings are long enough to not be automatically folded together by ruff).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-10-16 07:29</div>
            <div class="timeline-body"><p>Thanks @dylwil3 for catching my mistake! Indeed, this is intended behavior.</p>
<p>I wonder if there's an argument for a ISC rule or option that catches any implicit string concatenation within a set list, or a many-element tuple. I think that would also cover the example from https://github.com/astral-sh/ruff/issues/13014</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-10-16 07:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13014.html">astral-sh/ruff#13014</a> on 2025-10-16 07:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:18 UTC
    </footer>
</body>
</html>
