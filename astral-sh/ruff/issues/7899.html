<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unable to parse '.ruff.toml' when configured for Ruff linter - astral-sh/ruff #7899</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unable to parse '.ruff.toml' when configured for Ruff linter</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7899">#7899</a>
        opened by <a href="https://github.com/echoix">@echoix</a>
        on 2023-10-10 16:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/echoix">@echoix</a> on 2023-10-10 16:36</div>
            <div class="timeline-body"><p><strong>Describe the bug</strong>
A clear and concise description of what the bug is.</p>
<p>I configured '.ruff.toml' with additional parameters for Ruff linter, and when running locally or GHA I encounter parsing error:</p>
<pre><code>--Error detail:
&lt;jemalloc&gt;: MADV_DONTNEED does not work (memset will be used instead)
&lt;jemalloc&gt;: (This is the expected behaviour if you are running under QEMU)
ruff failed
  Cause: Failed to parse `/tmp/lint/.ruff.toml`: TOML parse error at line 1, column 1
  |
1 | [format]
  | ^^^^^^^^
wanted exactly 1 element, more than 1 element
</code></pre>
<p><strong>To Reproduce</strong>
Steps to reproduce the behavior:</p>
<ol>
<li>enable Ruff linter and Create .ruff.toml</li>
<li>Provide the following parameters in .ruff.toml:</li>
</ol>
<pre><code>[format]
indent-style = &quot;tab&quot;
quote-style = &quot;single&quot;
</code></pre>
<ol start="4">
<li>Run locally 'mega-linter-runner --flavor python' (or) via GH Actions.</li>
<li>See error:</li>
</ol>
<pre><code>--Error detail:
&lt;jemalloc&gt;: MADV_DONTNEED does not work (memset will be used instead)
&lt;jemalloc&gt;: (This is the expected behaviour if you are running under QEMU)
ruff failed
  Cause: Failed to parse `/tmp/lint/.ruff.toml`: TOML parse error at line 1, column 1
  |
1 | [format]
  | ^^^^^^^^
wanted exactly 1 element, more than 1 element
</code></pre>
<p><strong>Expected behavior</strong>
Script expected to be tab indented and quote style be single quote.</p>
<p><strong>Screenshots</strong>
N/A</p>
<p><strong>Additional context</strong>
When running Ruff as-is it works well with:</p>
<pre><code>ruff format &quot;myScript.py&quot;
</code></pre>
<p>Megalinter's ruff ver :</p>
<pre><code> &quot;ruff&quot;: &quot;0.0.291&quot;,
</code></pre>
<p>My local Stand-alone Ruff ver: ruff 0.0.291</p>
<p>Python flavor: oxsecurity/megalinter/flavors/python@v7.4.0</p>
<p><em>Originally posted by @fawazsalah in https://github.com/oxsecurity/megalinter/issues/2995</em></p>
<hr />
<p>And with a comment that has the same bug directly with ruff:</p>
<blockquote>
<blockquote>
<p>Since <a href="https://github.com/toml-rs/toml-rs/blob/464e7153879be75965eb067062cc8cc6743b7eb6/src/de.rs#L263-L270">the error</a> occurs when running Ruff through MegaLinter but not when running Ruff directly, and <a href="https://megalinter.io/7.4.0/descriptors/python_ruff/">MegaLinter v7.4.0 is on Ruff 0.0.290</a>, I would try running Ruff directly at 0.0.290.</p>
</blockquote>
<p>Thanks @Kurt-von-Laven and @echoix for the support.</p>
<p>Bingo Good catch; I can confirm similar error with 0.0.290 locally.</p>
<p>[...]</p>
</blockquote>
<p><em>Originally posted by @fawazsalah in https://github.com/oxsecurity/megalinter/issues/2995#issuecomment-1754720775</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "**Describe the bug**" to "Unable to parse '.ruff.toml' when configured for Ruff linter" by @echoix on 2023-10-10 16:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-10 16:38</div>
            <div class="timeline-body"><p>Hmm, I'm unable to reproduce this on Ruff v0.0.291 or v0.0.292.</p>
<p>With:</p>
<pre><code>‚ùØ ruff --version
ruff 0.0.291
</code></pre>
<p>I created <code>foo.py</code> with <code>x=1</code>, and <code>ruff.toml</code> with:</p>
<pre><code class="language-toml">[format]
indent-style = &quot;tab&quot;
quote-style = &quot;single&quot;
</code></pre>
<p>Running <code>ruff format foo.py</code>:</p>
<pre><code>warning: `ruff format` is a work-in-progress, subject to change at any time, and intended only for experimentation.
1 file reformatted
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-10 16:39</div>
            <div class="timeline-body"><p>Let me verify that the config is being picked up in my repro.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-10 16:40</div>
            <div class="timeline-body"><p>Hmm, yes, confirmed, so still unable to repro. Could megalinter be using an older version?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> added by @charliermarsh on 2023-10-10 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/echoix">@echoix</a> on 2023-10-10 16:41</div>
            <div class="timeline-body"><p>If the whole parsing of the format section in a ruff.toml file instead of a pyproject.toml file isn't broken, I suspect something with a BOM header might be going on here.</p>
<p>Does your tests cover a similar case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/echoix">@echoix</a> on 2023-10-10 16:43</div>
            <div class="timeline-body"><p>The affected version was 0.290 (from that user).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/echoix">@echoix</a> on 2023-10-10 16:45</div>
            <div class="timeline-body"><blockquote>
<p>Hmm, yes, confirmed, so still unable to repro. Could megalinter be using an older version?</p>
</blockquote>
<p>The latest release of Megalinter still has 0.290, but 0.291 is already in main.</p>
<p>0.292 is still in https://github.com/oxsecurity/megalinter/pull/2988</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-10 16:51</div>
            <div class="timeline-body"><p>The new <code>format</code> section is only available in 0.0.291+ (https://github.com/astral-sh/ruff/pull/7543); related https://github.com/astral-sh/ruff/pull/7514</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/echoix">@echoix</a> on 2023-10-10 17:10</div>
            <div class="timeline-body"><p>I saw the second, #7514, but thought that an existing cli option was renamed, but didn't realise by the release notes that it didn't exist yet, as I thought it was a rename of an old command, and output-format wasn't at a section level.</p>
<p>So I'll go and mention that. I really didn't catch that it was a new feature from the release notes, I caught that <code>lint</code> was a new section though.
Some projects, like the Python documentation, or CMake documentation add at what version a feature was added. Is it something that would be worth it for your project? (I see it is very fast-moving, congratulations for your work!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kurt-von-Laven">@Kurt-von-Laven</a> on 2023-10-10 17:19</div>
            <div class="timeline-body"><p>I have often spent significant time determining which rules are available at which version. Sometimes I have found the answer in the release notes, and sometimes have resorted to binary search.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-10 17:20</div>
            <div class="timeline-body"><p>So... we took the <code>format = &lt;string&gt;</code> option and renamed it to <code>output-format = &lt;string&gt;</code> (with backwards compatibility) to make room for the <code>[format]</code> section which can be used for our formatter options. Since you were using <code>[format]</code> with an older version that expected a string you were getting the error message &quot;wanted exactly 1 element, more than 1 element&quot;.</p>
<p>I'd like to have documentation include versions in which things are added. We'd need to build out tooling for it though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">waiting-on-author</span> removed by @zanieb on 2023-10-10 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2023-10-10 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kurt-von-Laven">@Kurt-von-Laven</a> on 2023-10-10 17:44</div>
            <div class="timeline-body"><p>Sphinx offers <a href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html#paragraph-level-markup"><code>::versionadded::</code></a>. <a href="https://sphinxcontrib-versioning.readthedocs.io/en/latest/">Sphinx</a>, <a href="https://docusaurus.io/docs/versioning">Docusaurus</a>, and  <a href="https://squidfunk.github.io/mkdocs-material/setup/setting-up-versioning/">MkDocs</a> offer versioning.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-10-10 17:49</div>
            <div class="timeline-body"><p>Unfortunately I don't think those really address our use-cases. We'd probably need to build the tooling into our Rust documentation generator, but we should talk about this in a <a href="https://github.com/astral-sh/ruff/discussions/new?category=ideas">new discussion</a> instead of cluttering this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @echoix on 2023-10-10 20:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:34 UTC
    </footer>
</body>
</html>
