<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff reports F704 `await` statement outside of a function for notebooks - astral-sh/ruff #6584</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff reports F704 `await` statement outside of a function for notebooks</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6584">#6584</a>
        opened by <a href="https://github.com/david-waterworth">@david-waterworth</a>
        on 2023-08-15 04:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2023-08-15 04:06</div>
            <div class="timeline-body"><p>In notebooks <code>await</code> is allowed in a cell (i.e. outside of a function), but <code>ruff</code> reports F704 - see also https://github.com/microsoft/pylance-release/issues/1754 and https://ipython.readthedocs.io/en/stable/interactive/autoawait.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-08-15 04:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-15 04:17</div>
            <div class="timeline-body"><p>Wow, interesting, TIL. Thanks for filing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-08-16 03:46</div>
            <div class="timeline-body"><p>Interesting! It also seems that this can be disabled using <code>%autoawait False</code> or using <code>c.InteractiveShell.autoawait</code> in the config file.</p>
<p>I'm not sure what the long term solution would be but one idea is to store these as a context while processing the Notebook and then using that in some kind of a middleware to filter out such diagnostics. Or, instead of middleware this context can be passed around to the checkers. For example, in this example the context would give us information if <code>autoawait</code> is disabled or not. This will still be limited as it can be disabled in the config file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6607.html">astral-sh/ruff#6607</a> on 2023-08-16 03:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-08-16 03:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:08 UTC
    </footer>
</body>
</html>
