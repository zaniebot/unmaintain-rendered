<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N805 ignores classmethod-decorators setting - astral-sh/ruff #4604</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>N805 ignores classmethod-decorators setting</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4604">#4604</a>
        opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a>
        on 2023-05-23 14:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2023-05-23 14:08</div>
            <div class="timeline-body"><h3>ruff.toml</h3>
<pre><code class="language-toml">select = ['N805']

[pep8-naming]
classmethod-decorators = [
    'classmethod',
    'declared_attr',
    'strict_classproperty',
    'expression',
    'comparator',
]
</code></pre>
<h3>ruff_sample.py</h3>
<pre><code class="language-python">from sqlalchemy.ext.hybrid import hybrid_property
from indico.util.decorators import strict_classproperty


class SQLAlchemyModel:
    @hybrid_property
    def foo(self):
        return not self._foo

    @foo.expression
    def foo(cls):
        return ~cls._foo

    @strict_classproperty
    def bar(cls):
        return cls._bar
</code></pre>
<h3>Output</h3>
<pre><code>$ ruff check ruff_sample.py
ruff_sample.py:11:13: N805 First argument of a method should be named `self`
ruff_sample.py:15:13: N805 First argument of a method should be named `self`
Found 2 errors.
</code></pre>
<h3>Versions</h3>
<pre><code>flake8-to-ruff==0.0.233
ruff==0.0.269
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-05-23 14:30</div>
            <div class="timeline-body"><p>Ah, you need to provide fully-qualified paths, e.g., <code>classmethod-decorators = [&quot;sqlalchemy.ext.hybrid.hybrid_property&quot;]</code>. We match on the binding, not the symbol name, which ensures that (e.g.) you can import symbols under aliases and everything works as expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-05-23 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2023-05-23 14:45</div>
            <div class="timeline-body"><p>This works fine for my <code>strict_classproperty</code> decorator but I don't see how this would work for the hybrids. The method decorated with <code>hybrid_property</code> itself does not become a classmethod. The <code>foo.expression</code> one does. And that's not something I can specify as a fully-qualified name...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2023-10-23 08:15</div>
            <div class="timeline-body"><p>@charliermarsh ping :) I think this issue was closed too soon.</p>
<p>I just tested again using <code>ruff==0.1.1</code> and it still seems to be impossible to handle those classproperties...</p>
<pre><code class="language-python">from sqlalchemy.ext.hybrid import hybrid_property


class SQLAlchemyModel:
    @hybrid_property
    def foo(self):
        return not self._foo

    @foo.expression
    def foo(cls):
        return ~cls._foo
</code></pre>
<p>Basically I need ruff to treat either <code>@*.expression</code> as a classmethod decorator, or alternatively have a way of telling it that <code>sqlalchemy.ext.hybrid.hybrid_property</code> returns a normal property, but the method decorated with that property has a <code>.expression</code> attribute that is a classmethod decorator...</p>
<p>Considering that this is a very common SQLAlchemy feature, and larger projects may have plenty of those, it's still a blocker for using ruff :/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8397.html">astral-sh/ruff#8397</a> on 2023-10-31 22:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
