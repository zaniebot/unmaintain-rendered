<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W391 reported but not fixed in Jupyter notebook - astral-sh/ruff #13763</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>W391 reported but not fixed in Jupyter notebook</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13763">#13763</a>
        opened by <a href="https://github.com/DimitriPapadopoulos">@DimitriPapadopoulos</a>
        on 2024-10-15 14:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/DimitriPapadopoulos">@DimitriPapadopoulos</a></div>
            <div class="timeline-body"><p>Ruff emits a <strong>W391</strong> error, a spurious one as far as I can see, and <code>--fix</code> doesn&#x27;t modify the file:</p>
<pre><code>$ ruff check --isolated --no-cache --extend-select W --preview --fix file.ipynb
Found 1 error (1 fixed, 0 remaining).
$ 
$ ruff check --isolated --no-cache --extend-select W --preview --fix file.ipynb
Found 1 error (1 fixed, 0 remaining).
$ 
</code></pre>
<p>The issue is associated to this line in the Jupyter Notebook:</p>
<pre><code>   &quot;source&quot;: []
</code></pre>
<ul>
<li><p>List of keywords you searched for before creating this issue: &quot;W391&quot;</p>
</li>
<li><p>A minimal code snippet that reproduces the bug.</p>

code snippet

<pre><code>{
 &quot;cells&quot;: [
  {
   &quot;cell_type&quot;: &quot;code&quot;,
   &quot;execution_count&quot;: null,
   &quot;metadata&quot;: {},
   &quot;outputs&quot;: [
    {
     &quot;name&quot;: &quot;stdout&quot;,
     &quot;output_type&quot;: &quot;stream&quot;,
     &quot;text&quot;: [
      &quot;True\n&quot;
     ]
    }
   ],
   &quot;source&quot;: [
    &quot;True&quot;
   ]
  },
  {
   &quot;cell_type&quot;: &quot;code&quot;,
   &quot;execution_count&quot;: null,
   &quot;metadata&quot;: {},
   &quot;outputs&quot;: [],
   &quot;source&quot;: []
  }
 ],
 &quot;metadata&quot;: {
  &quot;kernelspec&quot;: {
   &quot;display_name&quot;: &quot;Python 3 (ipykernel)&quot;,
   &quot;language&quot;: &quot;python&quot;,
   &quot;name&quot;: &quot;python3&quot;
  }
 },
 &quot;nbformat&quot;: 4,
 &quot;nbformat_minor&quot;: 2
}

</code></pre>


</li>
<li><p>The command you invoked (e.g., <code>ruff /path/to/file.py --fix</code>), ideally including the <code>--isolated</code> flag.</p>
<pre><code> ruff check --isolated --no-cache --extend-select W --preview --fix file.ipynb
</code></pre>
</li>
<li><p>The current Ruff settings (any relevant sections from your <code>pyproject.toml</code>).</p>
</li>
<li><p>The current Ruff version (<code>ruff --version</code>).</p>
<pre><code>ruff 0.6.9
</code></pre>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;W391 not fixed in Jupyter notebook&quot; to &quot;W391 reported but not fixed in Jupyter notebook&quot; by <a href="https://github.com/DimitriPapadopoulos">@DimitriPapadopoulos</a> on 2024-10-15 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-16 05:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">notebook</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-16 05:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-16 05:56</div>
            <div class="timeline-body"><p>Yeah, I think we should limit this rule to individual cells and not for the concatenated content.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-10-16 05:59</div>
            <div class="timeline-body"><p>The challenge here is that the rule looks at the tokens, so we&#x27;d need to basically run the <code>too_many_newlines_at_end_of_file</code> function for the tokens corresponding to each cell. I think that can be done by using the <code>CellOffsets</code>. We&#x27;d need to keep an iterator of cell offsets and loop over all the tokens of the file in reverse order and reset some state to indicate that we&#x27;re at the end of the cell. This would be similar to what&#x27;s being done for blank line rules by the <code>LinePreprocessor</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-09 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-09 16:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:58 UTC
    </footer>
</body>
</html>
