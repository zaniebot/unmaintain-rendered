<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`RUF046` is doing two things instead of one - astral-sh/ruff #14793</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`RUF046` is doing two things instead of one</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14793">#14793</a>
        opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a>
        on 2024-12-05 16:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-12-05 16:44</div>
            <div class="timeline-body"><p>I know that 0.8.2 has just been released and that I did say everything looked fine to me before #14697 was merged, but the more I think about it, the more I find it wrong to handle both <code>round()</code> and <code>int()</code> in one fell swoop. I probably won't be able to sleep well tonight without first sharing my concerns, so here's the big proposal:</p>
<p><code>RUF046</code> should only handle cases where the <code>int()</code> call is unnecessary. The logic to detect <code>round()</code> calls with unnecessary second argument should be moved to a new rule.</p>
<p>This will also make it easier to extend <code>RUF046</code> to handle expressions more complex than a simple call, as it won't need to care about the exact content.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dylwil3 on 2024-12-05 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dylwil3 on 2024-12-05 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-06 09:30</div>
            <div class="timeline-body"><blockquote>
<p>I probably won't be able to sleep well tonight without first sharing my concerns, so here's the big proposal:</p>
</blockquote>
<p>Oh no! Don't worry too much about it. The rule is in preview. We're still allowed to make changes to its intent.</p>
<blockquote>
<p>RUF046 should only handle cases where the int() call is unnecessary. The logic to detect round() calls with unnecessary second argument should be moved to a new rule.</p>
</blockquote>
<p>Can you tell me a bit more about it? Do you mean that the rule fixes <code>int(round(4, 0))</code> to <code>round(4)</code>? And what you're suggesting is to introduce a new rule that detects <em>unnecessary-round-call</em> for <code>round(int)</code>. The way <code>int(round(4))</code> would then first be fixed to <code>int(4)</code> and then to just 4?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @MichaReiser on 2024-12-06 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-12-06 10:33</div>
            <div class="timeline-body"><p>@MichaReiser Yes, that's correct. There will be a <code>expr_is_strictly_int()</code> function that checks if an expression is strictly an integer, which can be utilized by both rules to determine fix safety.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-06 10:39</div>
            <div class="timeline-body"><p>The suggested split makes sense to me. So we'd have two rules:</p>
<ul>
<li>unnecessary-cast-to-int (e.g. <code>int(round(4.0))</code>)</li>
<li>unnecessary-rounding (e.g. <code>round(4)</code>)</li>
</ul>
<p>Do you want to a) first simplify <code>unnecessary-cast-to-int</code> and then add a new rule for unnecessary-rounding?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2024-12-06 10:46</div>
            <div class="timeline-body"><p>(It's actually <code>round(4, 0)</code>/<code>round(whatever, None)</code>.)</p>
<p>I intend to extend <code>unnecessary-cast-to-int</code> so that it can detect complex expressions at the same time I introduce <code>unnecessary-round-ndigits</code> (already named locally, changing is trivial).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14828.html">astral-sh/ruff#14828</a> on 2024-12-07 00:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-01-02 09:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/15481.html">astral-sh/ruff#15481</a> on 2025-01-14 21:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:15 UTC
    </footer>
</body>
</html>
