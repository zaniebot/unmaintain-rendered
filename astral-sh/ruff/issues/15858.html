<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 is not doing the &quot;right&quot; thing with __init__.py - astral-sh/ruff #15858</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 is not doing the &quot;right&quot; thing with <strong>init</strong>.py</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15858">#15858</a>
        opened by <a href="https://github.com/mlasevich">@mlasevich</a>
        on 2025-01-31 20:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mlasevich">@mlasevich</a></div>
            <div class="timeline-body">Description
<p>Ok, yet another question/request about how F401 treats <code>__init__.py</code> . I recognize &quot;right&quot; is a matter of an opinion, but tools should be configurable to match user&#x27;s needs - and this is not the case here.</p>
<p>Generally speaking, in most libraries, <code>__init__.py</code> imports are used to expose internal module items to uses outside the library or package. This simplifies consumption of the library/package and allows to change implementation details without affecting the code depending on it. As such, of course most(if not all) of the imports in <code>__init__.py</code>  <em>look</em> like they are unused. Pylint seems to have no issues with this. However ruff still gets confused. It wants you to either add things to <code>__all__</code> (which only affects wildcard imports, which we do not want to encourage or support, thus adding unused duplicate code just to make a linter happy, which is silly) or by doing redundant exports (import x as x), a step that is not only redundant (and silly), but also breaks some use cases where you legitimately want to change the name on presenting it to the package&#x27;s clients.</p>
<p>So, while I recognize that not everyone will agree with me, I would like to have some means to configure this behavior so that i can use ruff without rewriting all my code to add redundant/unused stuff. There is a <code>ignore-init-module-imports</code> configuration setting which seemed promising - but it is labeled as deprecated, and, more importantly, just does not seem to do anything.</p>
<p>So, what am I asking for is one of:</p>
<p>1 - restore <code>ignore-init-module-imports</code> setting to that it works</p>
<p>or</p>
<p>2 - Just split F401 into two separate rules, one for <code>__init__.py</code> files and one for everything else. This will allow disabling one without disabling the other.</p>
<p>Currently the only way to make ruff work is to just disable the rule globally, which is less than ideal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-02-01 00:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-02-01 00:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2025-02-01 13:14</div>
            <div class="timeline-body"><blockquote>
<p>Currently the only way to make ruff work is to just disable the rule globally, which is less than ideal.</p>
</blockquote>
<p>Alternatively,</p>
<pre><code>[tool.ruff.lint.per-file-ignores]
&quot;__init__.py&quot; = [&quot;F401&quot;]
</code></pre>
<p>should disable the diagnostic in <code>__init__.py</code>. It&#x27;s what I did when adding Ruff to a codebase which didn&#x27;t follow a re-export convention.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-03 09:34</div>
            <div class="timeline-body"><p>Thanks for the write up. Our current recommendation is to do what @tjkuson suggested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-03 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mlasevich">@mlasevich</a> on 2025-02-04 15:23</div>
            <div class="timeline-body"><p>A bit ugly, but good enough. Thank you :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stevenh">@stevenh</a> on 2025-05-29 17:43</div>
            <div class="timeline-body"><p>I found this report, when investigating why ruff had stopped removing unused imports. At the time I was unaware of any special behaviour for <code>F401</code> for <code>__init__.py</code>. I went down the hole of <code>--unsafe-fixes</code> and <code>--verbose</code> in the hope of some info as to why it was reporting but not fixing.</p>
<p>I&#x27;ve now found the <code>--preview</code> does allow the fix, which is what I expected to be the default.</p>
<p>I understand the motivation when a module has been released but when it hasn&#x27;t the default behaviour is frustrating.</p>
<p>I also found that setting <a href="https://docs.astral.sh/ruff/settings/#lint_ignore-init-module-imports">ignore-init-module-imports = false</a>, allowed <code>--unsafe-fixes</code> to remove it, however it&#x27;s deprecated so can&#x27;t rely on its behaviour long term.</p>
<pre><code>[tool.ruff.lint]
ignore-init-module-imports = false
</code></pre>
<p>I think the important thing to address is the unexplained behaviour when the user believes they have been explicit, the special nature adds to the confusion. A simple log message to inform the user of the issue would really help in the case.</p>
<p>The current deprecation warning for <code>ignore-init-module-imports</code> is also confusing</p>
<blockquote>
<p>warning: The <code>ignore-init-module-imports</code> option is deprecated and will be removed in a future release. Ruff&#x27;s handling of imports in <code>__init__.py</code> files has been improved (in preview) and unused imports will always be flagged.
Found 1 error (1 fixed, 0 remaining).</p>
</blockquote>
<p>I don&#x27;t have preview enabled but F401 is reporting all unused imports in <code>__init__.py</code>, so contrary to the above message you don&#x27;t need preview enabled for it to be reported, you only need <code>--preview</code> for <code>--unsafe-fixes</code> to fix <code>F401</code> in <code>__init__.py</code>.</p>
<p>Hope this helps others.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:25 UTC
    </footer>
</body>
</html>
