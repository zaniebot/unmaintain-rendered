<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`fmt: on` is broken/ignored with decorators - astral-sh/ruff #18681</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`fmt: on` is broken/ignored with decorators</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/18681">#18681</a>
        opened by <a href="https://github.com/user27182">@user27182</a>
        on 2025-06-15 07:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/user27182">@user27182</a> on 2025-06-15 07:38</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Trying to disable formatting for a decorator like this doesn't work:</p>
<pre><code class="language-python"># fmt: off
@decorator()
# fmt: on
def foo(): ...

x = [0,0,0]
</code></pre>
<p>In this case, <code># fmt: off</code> works and properly disables the formatting as expected, but <code># fmt: on</code> is not recognized, and hence formatting is still off thereafter, and <code>x = [0,0,0]</code> will <em>not</em> be formatted. But, since formatting is enabled after the decorator, I would expect <code>x = [0,0,0]</code> to be formatted  as <code>x = [0, 0, 0]</code></p>
<h3>Version</h3>
<p>v0.11.13 (ruff playground)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2025-06-15 07:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">suppression</span> added by @MichaReiser on 2025-06-15 07:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2025-06-15 07:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-15 07:43</div>
            <div class="timeline-body"><p>Hi.</p>
<p>This is expected because Ruff only supports <code>fmt:off</code> and <code>fmt:on</code> between statements but a <code>decorator</code> isn't a statement. You can use <code>RUF028</code> to be warned about invalid uses of formatter suppression comments (<a href="https://play.ruff.rs/7eb655e5-efda-48fe-8a0d-a3dbc416dfa1">playground</a>). See also the <a href="https://docs.astral.sh/ruff/formatter/#format-suppression">documentation</a> that goes into more depth where suppression comments are allowed.</p>
<p>To only suppress the decorator, I recommend using <code>fmt: skip</code> like so:</p>
<pre><code class="language-py">@decorator() # fmt: skip
def foo(): ...

x = [0,0,0]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/user27182">@user27182</a> on 2025-06-15 07:45</div>
            <div class="timeline-body"><p>Makes sense, thanks for the info!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @user27182 on 2025-06-15 07:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
