<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q000 is not enforced with  `inline-quotes = &quot;single&quot;` - astral-sh/ruff #11209</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Q000 is not enforced with  <code>inline-quotes = &quot;single&quot;</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11209">#11209</a>
        opened by <a href="https://github.com/Borda">@Borda</a>
        on 2024-04-29 23:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Borda">@Borda</a></div>
            <div class="timeline-body"><p>following my comment in https://github.com/astral-sh/ruff/issues/7834#issuecomment-2083830199 and https://github.com/OpenDevin/OpenDevin/pull/1425#discussion_r1582056596</p>
<p>We are using <code>v0.4.1</code> with preco-commit and setting single-quotes but it is not enforced...
This is our config:</p>
<pre><code class="language-toml">[lint]
select = [
    &quot;E&quot;, &quot;W&quot;, &quot;F&quot;,
    &quot;Q&quot;,
]

[lint.flake8-quotes]
docstring-quotes = &quot;double&quot;
inline-quotes = &quot;single&quot;

[format]
quote-style = &quot;single&quot;
</code></pre>
<p>and this is the sample string which is untouched</p>
<pre><code class="language-py">logger.info(
    f&quot;Connecting to {username}@{hostname} via ssh. If you encounter any issues, you can try `ssh -v -p {self._ssh_port} {username}@{hostname}` with the password '{self._ssh_password}' and report the issue on GitHub.&quot;
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-30 03:21</div>
            <div class="timeline-body"><p>I don't think we touch this because it contains single quotes within it, so changing to single quotes would thus require that we escape the inner quotes, and the rule prefers avoiding escapes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-04-30 03:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/li-boxuan">@li-boxuan</a> on 2024-04-30 03:23</div>
            <div class="timeline-body"><p>@charliermarsh The line should actually be this:</p>
<pre><code class="language-python">f&quot;Connecting to {username}@{hostname} via ssh. &quot;
</code></pre>
<p>Full context: https://github.com/xingyaoww/OpenDevin/blob/e38b3ab1efdbadb990988318ecd4a3faf741233a/opendevin/sandbox/docker/ssh_box.py#L178-L182</p>
<pre><code class="language-python">        logger.info(
            f&quot;Connecting to {username}@{hostname} via ssh. &quot;
            f&quot;If you encounter any issues, you can try `ssh -v -p {self._ssh_port} {username}@{hostname}` with the password '{self._ssh_password}' and report the issue on GitHub. &quot;
            f&quot;If you started OpenDevin with `docker run`, you should try `ssh -v -p {self._ssh_port} {username}@localhost` with the password '{self._ssh_password} on the host machine (where you started the container).&quot;
        )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/li-boxuan">@li-boxuan</a> on 2024-04-30 03:25</div>
            <div class="timeline-body"><p>https://github.com/zheller/flake8-quotes/, on the other hand, would have caught this line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-30 03:46</div>
            <div class="timeline-body"><p>Yeah, we enforce it on the entire implicit concatenation. See: https://github.com/astral-sh/ruff/issues/2400.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/li-boxuan">@li-boxuan</a> on 2024-04-30 03:52</div>
            <div class="timeline-body"><blockquote>
<p>Yeah, we enforce it on the entire implicit concatenation. See: #2400.</p>
</blockquote>
<p>Interesting, this &quot;bug fix&quot; seems to be a &quot;bug&quot; to me and the original version seemed more correct ðŸ¤£  but I see why you want to choose this.</p>
<p>If one chooses to use single quote, does Q000 attempt to change it to double quotes in this case? From a developer's perspective, I don't care whether it's single quote or double quote - as long as the linter could enforce a consistent behavior, I am happy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-04-30 07:47</div>
            <div class="timeline-body"><blockquote>
<p>If one chooses to use single quote, does Q000 attempt to change it to double quotes in this case?</p>
</blockquote>
<p>No, the rule wouldn't convert a single-quoted string to a double-quoted string if the user preferred the &quot;single&quot; quotes in their config. But, in your case, there's a single quote in the string content which is why Ruff doesn't flag the string. This is to maintain consistency across all the parts of an implicitly concatenated string. For example, the following is inconsistent because some parts uses single quotes while others uses double quotes.</p>
<pre><code class="language-py">        logger.info(
            f'Connecting to {username}@{hostname} via ssh. '
            f&quot;If you encounter any issues, you can try `ssh -v -p {self._ssh_port} {username}@{hostname}` with the password '{self._ssh_password}' and report the issue on GitHub. &quot;
            f&quot;If you started OpenDevin with `docker run`, you should try `ssh -v -p {self._ssh_port} {username}@localhost` with the password '{self._ssh_password} on the host machine (where you started the container).&quot;
        )
</code></pre>
<p>I think in this case you might get away with using <code>!r</code> instead of explicit quotes:</p>
<pre><code class="language-py">        logger.info(
            f'Connecting to {username}@{hostname} via ssh. '
            f'If you encounter any issues, you can try `ssh -v -p {self._ssh_port} {username}@{hostname}` with the password {self._ssh_password!r} and report the issue on GitHub. '
            f'If you started OpenDevin with `docker run`, you should try `ssh -v -p {self._ssh_port} {username}@localhost` with the password {self._ssh_password!r} on the host machine (where you started the container).'
        )
</code></pre>
<p>This should put the quotes around the <code>self._ssh_password</code> value. For example:</p>
<pre><code>In [3]: print(f'hello {x!r}')
hello 'world'
</code></pre>
<p>Does this help?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-30 16:00</div>
            <div class="timeline-body"><p>The behaviors here are intentional and I think we're unlikely to make a bunch of changes to the rule, since we generally recommend using the formatter to enforce this anyway (which also allows specifying single-quote for inline with double-quote for docstrings).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/li-boxuan">@li-boxuan</a> on 2024-05-01 04:49</div>
            <div class="timeline-body"><p>Thanks, I think we can live with that protocol. @Borda what do you think? Can we close the issue now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-04 21:12</div>
            <div class="timeline-body"><p>Closing for now as &quot;working as intended&quot;, hopefully clarified by the above!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-04 21:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:10 UTC
    </footer>
</body>
</html>
