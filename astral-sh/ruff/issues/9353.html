<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff format insist on &quot;single line after imports&quot; for pyi files - astral-sh/ruff #9353</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff format insist on &quot;single line after imports&quot; for pyi files</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9353">#9353</a>
        opened by <a href="https://github.com/kkpattern">@kkpattern</a>
        on 2024-01-02 07:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kkpattern">@kkpattern</a></div>
            <div class="timeline-body">

<p>When formatting a pyi file, <code>ruff format</code> only keeps a single line after the imports. If <code>ruff.lint.isort.lines-after-imports</code> is configured to <code>2</code>. <code>ruff format</code> will conflict with <code>ruff check</code>.</p>
<p>This doesn&#x27;t happen to py files. <code>ruff format</code> will keep the two lines after the imports.</p>
<p>Example:</p>
<pre><code>(.venv) ☁  ruff-demo  cat test.py
from typing import Any


class Foo:
    def bar(self, data: Any) -&gt; None:
        pass
(.venv) ☁  ruff-demo  ruff format --check test.py
1 file already formatted


(.venv) ☁  ruff-demo  cat test.pyi
from typing import Any


class Foo:
    def bar(self, data: Any) -&gt; None: ...
(.venv) ☁  ruff-demo  ruff format --check test.pyi
Would reformat: test.pyi
1 file would be reformatted
(.venv) ☁  ruff-demo
</code></pre>
<p>Ruff Version: 0.1.9
Ruff Command: <code>ruff format</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-02 16:50</div>
            <div class="timeline-body"><p>This feels like it&#x27;s &quot;working as intended&quot; even though the option is conflicting. If anything, we may want to warn here, as we do for other incompatible options (<code>2</code> is a permitted value, but I don&#x27;t think we considered that it would conflict for <code>.pyi</code> files). The alternative would be to ignore <code>lines-after-imports</code> in <code>.pyi</code> files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-02 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-02 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkpattern">@kkpattern</a> on 2024-01-03 01:39</div>
            <div class="timeline-body"><p>Ignore <code>lines-after-imports</code> in .pyi files would be nice. Currently, we&#x27;re using both <code>ruff check</code> and <code>ruff format --check</code> in our CI pipeline. We do want two lines after the imports in py files. So, in order to make the CI green, we need to skip <code>ruff check</code> for all the pyi files for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Formatter: Stable&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 07:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-01-08 07:21</div>
            <div class="timeline-body"><p>Thank you for reporting this issue. That&#x27;s something I haven&#x27;t been aware when adding the warnings.</p>
<p>Warning when setting <code>lines-after-imports</code> to a value other than 1 might be noisy, except if we limit it only to warn when formatting a pyi file (which would be different from the other incompatible warnings). It would also not enable the use case mentioned by @kkpattern.</p>
<p>I think I would start by ignoring <code>lines-after-imports</code> in <code>pyi</code> files. But we may need to do run a GitHub code search first to find projects that use <code>lines-after-imports</code> with a value other than 1 and have <code>pyi</code> files to not break their setup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-13 07:48</div>
            <div class="timeline-body"><p><code>isort</code> fixes <code>lines-after-imports</code> and <code>lines-before-imports</code> to 1 when using the <code>black</code> profile</p>
<p>https://github.com/PyCQA/isort/blob/eed5d059a8ea5442266be892322f8815074800a5/isort/output.py#L211-L225</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-13 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/MichaReiser">@MichaReiser</a> by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-13 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-28 16:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:48 UTC
    </footer>
</body>
</html>
