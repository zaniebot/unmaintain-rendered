<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Third-party namespace packages can be incorrectly considered first-party packages by `isort` rules - astral-sh/ruff #12984</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Third-party namespace packages can be incorrectly considered first-party packages by `isort` rules</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/12984">#12984</a>
        opened by <a href="https://github.com/tehkirill">@tehkirill</a>
        on 2024-08-19 09:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tehkirill">@tehkirill</a> on 2024-08-19 09:32</div>
            <div class="timeline-body"><p>Hi, team. Thanks for your hard work.</p>
<p>I noticed a change in how known-first-party imports get classified recently.
If I'm working on <code>my_namespace.a</code> project, I expect <code>my_namespace.b</code> to be classified as a Known(ThirdParty) (so does <code>isort</code>). This was the case with ruff as well, up until version 0.5.7 .</p>
<p>Working on <code>my_namespace.a</code> project, with the following stucture:</p>
<pre><code>ruff-namespace-src-imports-test/
  ├─ main.py
  ├─ ruff.toml
  └─ src/
     └─ my_namespace/
        └─ a/
           └─ ...
</code></pre>
<pre><code class="language-toml"># ruff.toml
[lint.isort]
known-first-party = [&quot;my_namespace.a&quot;]
</code></pre>
<pre><code class="language-python"># main.py
import os

import my_namespace.b
import numpy

import my_namespace.a
</code></pre>
<p>^ I see it as a valid import order, so does v0.5.6:</p>
<pre><code>$ python3.12 -m ruff check main.py --select I --diff -v
[2024-08-19][11:11:40][ruff::resolve][DEBUG] Using configuration file (via parent) at: C:\ruff-namespace-src-imports-test\ruff.toml
[2024-08-19][11:11:40][ruff_workspace::pyproject][DEBUG] `project.requires_python` in `pyproject.toml` will not be used to set `target_version` when using `ruff.toml`.
[2024-08-19][11:11:40][ruff::commands::check][DEBUG] Identified files to lint in: 4.5661ms
[2024-08-19][11:11:40][ruff::diagnostics][DEBUG] Checking: C:\ruff-namespace-src-imports-test\main.py
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.a' as Known(FirstParty) (KnownFirstParty)
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.b' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:11:40][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'numpy' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:11:40][ruff::commands::check][DEBUG] Checked 1 files in: 2.7995ms
</code></pre>
<p>But 0.5.7+ (including the latest 0.6.1) sees otherwise:</p>
<pre><code>$ python3.12 -m ruff check main.py --select I --diff -v
[2024-08-19][11:12:44][ruff::resolve][DEBUG] Using configuration file (via parent) at: C:\ruff-namespace-src-imports-test\ruff.toml
[2024-08-19][11:12:44][ruff_workspace::pyproject][DEBUG] `project.requires_python` in `pyproject.toml` will not be used to set `target_version` when using `ruff.toml`.
[2024-08-19][11:12:44][ruff::commands::check][DEBUG] Identified files to lint in: 4.8756ms
[2024-08-19][11:12:44][ruff::diagnostics][DEBUG] Checking: C:\ruff-namespace-src-imports-test\main.py
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.a' as Known(FirstParty) (KnownFirstParty)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.b' as Known(FirstParty) (SourceMatch(&quot;C:\\ruff-namespace-src-imports-test\\src&quot;))
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'numpy' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.b' as Known(FirstParty) (SourceMatch(&quot;C:\\ruff-namespace-src-imports-test\\src&quot;))
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'os' as Known(StandardLibrary) (KnownStandardLibrary)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'numpy' as Known(ThirdParty) (NoMatch)
[2024-08-19][11:12:44][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'my_namespace.a' as Known(FirstParty) (KnownFirstParty)
--- main.py
+++ main.py
@@ -1,6 +1,6 @@
 import os

-import my_namespace.b
 import numpy

 import my_namespace.a
+import my_namespace.b

[2024-08-19][11:12:44][ruff::commands::check][DEBUG] Checked 1 files in: 2.8168ms
Would fix 1 error.
</code></pre>
<p>Removing <code>src/my_namespace</code> correctly classifies <code>my_namespace.b</code> as known-third-party again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2024-08-19 10:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-19 10:09</div>
            <div class="timeline-body"><p>Hi @tehkirill</p>
<p>This behavior changed with Ruff 0.6 where the directory <code>src</code> is now included in the <a href="https://docs.astral.sh/ruff/settings/#src"><code>src</code></a> setting. You can get back the old behavior by setting <code>src = [&quot;.&quot;]</code> which was the default until Ruff 0.6.</p>
<p>You can read more about it in <a href="https://astral.sh/blog/ruff-v0.6.0#migrating-to-v06">our blog post</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tehkirill">@tehkirill</a> on 2024-08-19 10:48</div>
            <div class="timeline-body"><p>Thanks for the prompt response and linking to where it was documented, @MichaReiser
In my case - I <em>am</em> using <code>src/</code> layout - don't think I should exclude it to make this work.</p>
<p>The way it's implemented at the moment makes sense for projects without namespaces, eg <code>./src/requests</code> from <a href="https://github.com/psf/requests">requests repo</a>.</p>
<p>It does, however, incorrectly identifies a third-party import under the same namespace as first-party, e.g. using an example from <a href="https://packaging.python.org/en/latest/guides/packaging-namespace-packages/">packaging.python.org</a>:</p>
<pre><code>mynamespace-subpackage-a/
    pyproject.toml
    src/
        mynamespace/
            subpackage_a/
                __init__.py

mynamespace-subpackage-b/
    pyproject.toml
    src/
        mynamespace/
            subpackage_b/
                __init__.py
            module_b.py
</code></pre>
<p>When working on <code>mynamespace-subpackage-a</code>, <code>mynamespace-subpackage-b</code> would be identified as first-party (in fact, anything starting with <code>mynamespace.</code> would), I don't think it's an expected behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @AlexWaygood on 2024-08-19 11:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-19 11:10</div>
            <div class="timeline-body"><blockquote>
<p>When working on <code>mynamespace-subpackage-a</code>, <code>mynamespace-subpackage-b</code> would be identified as first-party (in fact, anything starting with <code>mynamespace.</code> would), I don't think it's an expected behaviour.</p>
</blockquote>
<p>That's an interesting edge case! This seems to me to be a general issue with the way our <code>isort</code> rules detect first-party packages when it comes to namespace packages, that has been exposed in your project by the recent change to <code>isort</code>'s configuration defaults, rather than an issue with the change in defaults itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @AlexWaygood on 2024-08-19 11:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Having src/my_namespace/a changes my_namespace.b from known-third-party to known-first-party" to "Third-party namespace packages can be incorrectly considered first-party packages by `isort` rules" by @AlexWaygood on 2024-08-19 11:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-08-19 12:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/12987.html">astral-sh/ruff#12987</a> on 2024-08-19 12:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pypa/pip/pulls/12937.html">pypa/pip#12937</a> on 2024-08-24 20:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/smartYSC">@smartYSC</a> on 2024-11-06 10:14</div>
            <div class="timeline-body"><p>I ran into the same problem recently but thought I was just too stupid to find the right settings combination. I opened a discussion about it here: https://github.com/astral-sh/ruff/discussions/12038</p>
<p>We did not find a solution back then and I went on to other tasks. Now I revisted this and found this issue.</p>
<p>I built <code>ruff</code> from the linked PR https://github.com/astral-sh/ruff/pull/12987 and this indeed fixes the issue!</p>
<p>We now need to have this merged...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @AlexWaygood by @AlexWaygood on 2025-03-17 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16565.html">astral-sh/ruff#16565</a> on 2025-03-27 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-05-05 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-05-05 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/20453.html">astral-sh/ruff#20453</a> on 2025-09-17 21:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:13 UTC
    </footer>
</body>
</html>
