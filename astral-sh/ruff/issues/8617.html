<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q000 fixer does not remove obsolete backslash-escape inside string after changing quotes - astral-sh/ruff #8617</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Q000 fixer does not remove obsolete backslash-escape inside string after changing quotes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8617">#8617</a>
        opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a>
        on 2023-11-11 13:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2023-11-11 13:52</div>
            <div class="timeline-body"><p>ruff.toml:</p>
<pre><code class="language-toml">select = ['Q']

[flake8-quotes]
inline-quotes = 'single'
multiline-quotes = 'single'
docstring-quotes = 'double'
avoid-escape = true
</code></pre>
<p>Code:</p>
<pre><code class="language-python">a = &quot;hello\&quot;world&quot;
</code></pre>
<p>ruff output:</p>
<pre><code>[adrian@claptrap:/tmp/rufftest]&gt; ~/dev/ruff/target/release/ruff check --no-cache test.py
test.py:1:5: Q000 [*] Double quotes found but single quotes preferred
Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>And after running with <code>--fix</code> added:</p>
<pre><code class="language-python">a = 'hello\&quot;world'
</code></pre>
<p>While not invalid, this is ugly - in particular since <code>avoid-escape</code> is enabled. It should have been this:</p>
<pre><code class="language-python">a = 'hello&quot;world'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2023-11-11 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-11 14:52</div>
            <div class="timeline-body"><p>Agreed, it makes sense to remove redundant escapes when converting quote styles.</p>
<p>(I consider this low-priority since we're more focused on string normalization in the formatter, but I would gladly accept a contribution here.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> removed by @charliermarsh on 2023-11-11 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-11-11 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @charliermarsh on 2023-11-11 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2023-11-11 14:57</div>
            <div class="timeline-body"><p>I would gladly use the formatter if it had an option to only apply certain changes (such as quote style) since I really do not like what black does to my codebase, so I don't think I'd want to use the ruff formatter either. :/</p>
<p>For implementing a fix, would you do it as part of this fixer of as a new rule (if yes: where, since it's not in the original flake8-quotes) that only looks at unnecessary escapes in a string?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-11 15:02</div>
            <div class="timeline-body"><p>I hear you! While I don't share that opinion for my own code :) I do understand why saying &quot;Just use the formatter&quot; doesn't close out the issue. I'm more just trying to convey that for our own prioritization, we're more focused on improving the formatter's string normalization than investing further in the linter's string-formatting rules (right now, we basically have to maintain these two separate implementations).</p>
<p>I think easiest would be to add a new rule to the <code>Q</code> set to detect unnecessary escape quotes. We could <em>also</em> change the existing <code>Q</code> rules to take unnecessary escapes into account, but it wouldn't be strictly necessary, since the new rule would fix any unnecessary escapes after the outer quote conversion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-13 21:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:57 UTC
    </footer>
</body>
</html>
