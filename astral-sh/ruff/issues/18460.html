<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F841: `unused-variable` conflicts with Pydantic's ForwardRef - astral-sh/ruff #18460</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F841: <code>unused-variable</code> conflicts with Pydantic&#x27;s ForwardRef</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18460">#18460</a>
        opened by <a href="https://github.com/Konfus-ius">@Konfus-ius</a>
        on 2025-06-04 13:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Konfus-ius">@Konfus-ius</a></div>
            <div class="timeline-body">Summary
<p>Taking the following class definition</p>
<pre><code>from pydantic import BaseModel, ConfigDict, field_validator

class ClassName(BaseModel):
    output: ForwardRef(&quot;unused_variable&quot;)

    @classmethod
    def initialize(cls, db_repository: DatabaseRepository) -&gt; &quot;WhatEver&quot;:
        unused_variable = List[Literal[*output]] 
        cls.model_rebuild()
        return cls
</code></pre>
<p>ruff check shows a finding for F841 unused variable. This is theroretically correct but actually wrong. As the pydantic ForwardRef makes use of the <code>unused_variable</code>.</p>
<p>Request:</p>
<ul>
<li>Either &quot;flexibilize&quot; F841 such that pydantic ForwardRef is properly taken into account or</li>
<li>add rule to enforce getting rid of ForwardRef within pydantic (if wanted)</li>
</ul>
<p>Thanks for guidance</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Viicos">@Viicos</a> on 2025-06-04 14:38</div>
            <div class="timeline-body"><p>Not a Ruff maintainer but I don&#x27;t think special casing this is necessary. <code>model_rebuild()</code> fetches the current namespace where it is called to resolve forward annotations, which is really uncommon behavior (and only works with some Python implementations). Instead, we recommend explicitly providing the rebuild namespace with <code>model_rebuild(_types_namespace={&#x27;unused_variable&#x27;: unused_variable})</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-04 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Konfus-ius">@Konfus-ius</a> on 2025-06-06 08:10</div>
            <div class="timeline-body"><p>Hi @Viicos</p>
<p>thanks for the feedback, we will check this approach. In best case, we get fully rid of the ForwardRefs ...</p>
<p>But your approach is much better and is in line with linting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-24 12:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:01 UTC
    </footer>
</body>
</html>
