<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: deviation from Black when line splitting subscript assignment - astral-sh/ruff #9781</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: deviation from Black when line splitting subscript assignment</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9781">#9781</a>
        opened by <a href="https://github.com/rhynix">@rhynix</a>
        on 2024-02-02 10:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/rhynix">@rhynix</a> on 2024-02-02 10:43</div>
            <div class="timeline-body"><p>Ruff splits lines differently when the line length exceeds the configured line length, and the line contains assignment using subscript notation. For instance, when assigning to a dict.</p>
<p>I had a look at the known deviations, and at other open issues, but could not find this deviation.</p>
<p>Input:</p>
<pre><code class="language-python">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa[&quot;bbbbbbbbbbbbbbbbbbbb&quot;] = &quot;ccccccccccc&quot;
</code></pre>
<p>Black output:</p>
<pre><code class="language-python">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa[&quot;bbbbbbbbbbbbbbbbbbbb&quot;] = (
    &quot;ccccccccccc&quot;
)
</code></pre>
<p>Ruff (<code>ruff format --isolated file.py</code>) output:</p>
<pre><code class="language-python">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa[
    &quot;bbbbbbbbbbbbbbbbbbbb&quot;
] = &quot;ccccccccccc&quot;
</code></pre>
<p>Ruff version:</p>
<pre><code>% ruff version
ruff 0.2.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Formatter: different line splitting on subscript assignment" to "Formatter: deviation from Black when line splitting subscript assignment" by @rhynix on 2024-02-02 10:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @AlexWaygood on 2024-02-02 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @AlexWaygood on 2024-02-02 11:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rhynix">@rhynix</a> on 2024-02-02 11:03</div>
            <div class="timeline-body"><p>Black used to use the style ruff currently uses, but was changed late 2022.</p>
<p>This was the issue: https://github.com/psf/black/issues/1498
This was the PR: https://github.com/psf/black/pull/3368</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-02 11:03</div>
            <div class="timeline-body"><p>Thanks for reporting this issue.</p>
<p>Is it possible that you use/used black 24? Or what black version are you using?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rhynix">@rhynix</a> on 2024-02-02 11:05</div>
            <div class="timeline-body"><blockquote>
<p>Is it possible that you use/used black 24? Or what black version are you using?</p>
</blockquote>
<p>That is correct.</p>
<pre><code>% black --version
black, 24.1.1 (compiled: no)
Python (CPython) 3.8.18
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rhynix">@rhynix</a> on 2024-02-02 11:08</div>
            <div class="timeline-body"><p>I can confirm this change was introduced in Black 24.1:</p>
<p>https://github.com/psf/black/blob/main/CHANGES.md#2410</p>
<blockquote>
<p>If an assignment statement is too long, we now prefer splitting on the right-hand side (#3368)</p>
</blockquote>
<p>Setting the format.preview setting to true changes this behaviour to match Black.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-02-02 11:19</div>
            <div class="timeline-body"><p>So, Black 24.1 moved a lot of preview style rules into it's stable style (https://github.com/psf/black/issues/4042). We've implemented the same in our own preview style formatting which can be enabled through <code>--preview</code> flag. Refer to the <a href="https://docs.astral.sh/ruff/preview/">preview docs</a> for more details.</p>
<p>If you run the mentioned code snippet under the preview style then you'd get the same output:</p>
<pre><code class="language-console">ruff format --preview --diff
</code></pre>
<pre><code class="language-diff">--- /Users/dhruv/playground/ruff/formatter/isolated.py
+++ /Users/dhruv/playground/ruff/formatter/isolated.py
@@ -1 +1,3 @@
-aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa[&quot;bbbbbbbbbbbbbbbbbbbb&quot;] = &quot;ccccccccccc&quot;
+aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa[&quot;bbbbbbbbbbbbbbbbbbbb&quot;] = (
+    &quot;ccccccccccc&quot;
+)
</code></pre>
<p>You can track the progress of the pull request which will promote the same preview style rules into stable style for Ruff here: https://github.com/astral-sh/ruff/pull/9639</p>
<p>I hope this helps :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rhynix">@rhynix</a> on 2024-02-02 11:22</div>
            <div class="timeline-body"><blockquote>
<p>So, Black 24.1 moved a lot of preview style rules into it's stable style (<a href="https://github.com/psf/black/issues/4042">psf/black#4042</a>). We've implemented the same in our own preview style formatting which can be enabled through <code>--preview</code> flag. Refer to the <a href="https://docs.astral.sh/ruff/preview/">preview docs</a> for more details.</p>
<p>If you run the mentioned code snippet under the preview style then you'd get the same output:</p>
<pre><code>ruff format --preview --diff
</code></pre>
<pre><code class="language-diff">--- /Users/dhruv/playground/ruff/formatter/isolated.py
+++ /Users/dhruv/playground/ruff/formatter/isolated.py
@@ -1 +1,3 @@
-aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa[&quot;bbbbbbbbbbbbbbbbbbbb&quot;] = &quot;ccccccccccc&quot;
+aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa[&quot;bbbbbbbbbbbbbbbbbbbb&quot;] = (
+    &quot;ccccccccccc&quot;
+)
</code></pre>
<p>You can track the progress of the pull request which will promote the same preview style rules into stable style for Ruff here: #9639</p>
<p>I hope this helps :)</p>
</blockquote>
<p>It sure does. Thank you for your help.</p>
<p>I'll close this issue, since I believe it does not provide any extra value at this point.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @rhynix on 2024-02-02 11:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:11 UTC
    </footer>
</body>
</html>
