<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>noqa: PLC0415 F401 - PLC0415 directive gets ignored - astral-sh/ruff #21773</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>noqa: PLC0415 F401 - PLC0415 directive gets ignored</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/21773">#21773</a>
        opened by <a href="https://github.com/cleder">@cleder</a>
        on 2025-12-03 12:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/cleder">@cleder</a> on 2025-12-03 12:24</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I have an import inside a method of a class.</p>
<pre><code class="language-python">class Foo:
    def bar(self):
        try:
            from foo import (
                baz,  # noqa: F401,PLC0415
            )
        except ImportError:
            foobar()


def foobar():
    from foo import (
        baz,  # noqa: F401,PLC0415
    )
</code></pre>
<pre><code class="language-bash">&gt; ruff check PLC0415.py --no-fix --ignore=D,ANN,N --select=ALL
PLC0415 `import` should be at the top-level of a file
 --&gt; PLC0415.py:4:13
  |
2 |       def bar(self):
3 |           try:
4 | /             from foo import (
5 | |                 baz,  # noqa: F401,PLC0415
6 | |             )
  | |_____________^
7 |           except ImportError:
8 |               foobar()
  |

RUF100 [*] Unused `noqa` directive (unused: `PLC0415`)
 --&gt; PLC0415.py:5:23
  |
3 |         try:
4 |             from foo import (
5 |                 baz,  # noqa: F401,PLC0415
  |                       ^^^^^^^^^^^^^^^^^^^^
6 |             )
7 |         except ImportError:
  |
help: Remove unused `noqa` directive

PLC0415 `import` should be at the top-level of a file
  --&gt; PLC0415.py:12:5
   |
11 |   def foobar():
12 | /     from foo import (
13 | |         baz,  # noqa: F401,PLC0415
14 | |     )
   | |_____^
   |

RUF100 [*] Unused `noqa` directive (unused: `PLC0415`)
  --&gt; PLC0415.py:13:15
   |
11 | def foobar():
12 |     from foo import (
13 |         baz,  # noqa: F401,PLC0415
   |               ^^^^^^^^^^^^^^^^^^^^
14 |     )
   |
help: Remove unused `noqa` directive
</code></pre>
<p>When the imports are all on the same line, it works</p>
<h3>Version</h3>
<p>0.14.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-03 12:59</div>
            <div class="timeline-body"><p>Hi @cleder</p>
<p>Ruff, unlike e.g. Pyright, the ignore comment must be on the first line or last line. In your case, the <code>noqa</code> comment should be after the <code>(</code> or <code>)</code>:</p>
<pre><code class="language-py">def test():
    try:
        from my_service.services import ( # noqa: PLC0415 F401
            schedule_sync_job_tasks,  
    )
    except ImportError:
        pass
</code></pre>
<pre><code class="language-py">def test():
    try:
        from my_service.services import (
            schedule_sync_job_tasks,  
    )  # noqa: PLC0415 F401
    except ImportError:
        pass
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2025-12-03 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cleder">@cleder</a> on 2025-12-03 13:19</div>
            <div class="timeline-body"><p>confusing is that F401 MUST be on the same line:</p>
<pre><code>class Foo:
    def bar(self):
        try:
            from foo import ( # noqa: PLC0415
                baz,  # noqa: F401
            )
        except ImportError:
            foobar()


def foobar():
    from foo import ( # noqa: PLC0415
        baz,  # noqa: F401
    )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-12-03 13:28</div>
            <div class="timeline-body"><p>Yeah, I can see how this might be a bit confusing. <code>F401</code> flags a specific import rather than the entire statement because there could be multiple once. <code>PLC0415</code> always flags the entire import statement, regardless of how many members you import, because the entire import needs to be moved (or allowed, as you do in this instance)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cleder">@cleder</a> on 2025-12-03 13:34</div>
            <div class="timeline-body"><p>The suggestion to put it after <code>)</code> does not work:</p>
<pre><code>ruff check PLC0415.py --no-fix --ignore=D,ANN,N --select=ALL
PLC0415 `import` should be at the top-level of a file
 --&gt; PLC0415.py:4:13
  |
2 |       def bar(self):
3 |           try:
4 | /             from foo import (
5 | |                 baz,  # noqa: F401
6 | |             )  # noqa: PLC0415
  | |_____________^
7 |           except ImportError:
8 |               foobar()
  |

RUF100 [*] Unused `noqa` directive (unused: `PLC0415`)
 --&gt; PLC0415.py:6:16
  |
4 |             from foo import (
5 |                 baz,  # noqa: F401
6 |             )  # noqa: PLC0415
  |                ^^^^^^^^^^^^^^^
7 |         except ImportError:
8 |             foobar()
  |
help: Remove unused `noqa` directive

Found 2 errors.
[*] 1 fixable with the `--fix` option.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cleder">@cleder</a> on 2025-12-03 13:45</div>
            <div class="timeline-body"><p>adding the noqa via ruff works great btw:</p>
<p><code>ruff check PLC0415.py --no-fix --ignore=D,ANN,N --select=ALL --add-noqa</code></p>
<p>I guess I should use that more ;-)</p>
<p>Thanks for your help and ruff ❤️</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @cleder on 2025-12-03 13:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:17 UTC
    </footer>
</body>
</html>
