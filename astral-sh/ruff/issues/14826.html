<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect resolution of nested modules - astral-sh/ruff #14826</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Incorrect resolution of nested modules</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14826">#14826</a>
        opened by <a href="https://github.com/dcreager">@dcreager</a>
        on 2024-12-06 22:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dcreager">@dcreager</a> on 2024-12-06 22:06</div>
            <div class="timeline-body"><p>In #14825 I tried creating a test case that refers to a class in a nested module:</p>
<pre><code class="language-md">```py path=a/b.py
class C: ...
```

```py
import a.b
x: type[a.b.C]
```
</code></pre>
<p>This produced an unexpected <code>unresolved-attribute</code> error:</p>
<blockquote>
<p>Type <code>&lt;module 'System(&quot;/src/a/b.py&quot;)'&gt;</code> has no attribute <code>b</code></p>
</blockquote>
<p>This suggests that our module resolution code is binding <code>a</code> to <code>a.b</code>, and not to <code>a</code> as the Python spec requires.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @dcreager on 2024-12-06 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @dcreager by @dcreager on 2024-12-06 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/14825.html">astral-sh/ruff#14825</a> on 2024-12-06 22:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Red Knot 2024" by @carljm on 2024-12-07 01:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-12-07 13:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-07 13:30</div>
            <div class="timeline-body"><p>@carljm this shouldn't be too hard to fix? Maybe something for a contributor to take on?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carljm">@carljm</a> on 2024-12-07 17:21</div>
            <div class="timeline-body"><p>@MichaReiser I suggested @dcreager might take a look, good intro task for the module resolver.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-12-07 23:36</div>
            <div class="timeline-body"><p>Great spot @dcreager! There <em>is</em> an existing TODO in the codebase regarding submodule imports, but this doesn't seem to be the same issue; I think it is a previously unknown bug.</p>
<p>For the record, the existing TODO is here:</p>
<p>https://github.com/astral-sh/ruff/blob/269e47be961d3eb95c0351e8f7006b71e083a6a4/crates/red_knot_python_semantic/src/types/infer.rs#L2155-L2163</p>
<p>The tests referenced by that TODO don't exist anymore, however; that's because they've been ported to mdtests. They're now here:</p>
<p>https://github.com/astral-sh/ruff/blob/269e47be961d3eb95c0351e8f7006b71e083a6a4/crates/red_knot_python_semantic/resources/mdtest/import/relative.md?plain=1#L114-L143</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/15026.html">astral-sh/ruff#15026</a> on 2024-12-16 23:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcreager">@dcreager</a> on 2024-12-17 19:24</div>
            <div class="timeline-body"><p>Fixed in https://github.com/astral-sh/ruff/pull/14946 and https://github.com/astral-sh/ruff/pull/15026</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dcreager on 2024-12-17 19:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
