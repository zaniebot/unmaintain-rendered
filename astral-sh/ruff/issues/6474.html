<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INP001 false positive in tests folder - astral-sh/ruff #6474</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>INP001 false positive in tests folder</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6474">#6474</a>
        opened by <a href="https://github.com/flying-sheep">@flying-sheep</a>
        on 2023-08-10 07:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-08-10 07:49</div>
            <div class="timeline-body"><p>The recommended Python + Pytest layout is</p>
<ul>
<li><code>src/</code><ul>
<li><code>mypkg/</code><ul>
<li><code>__init__.py</code></li>
<li><code>subpkg/</code><ul>
<li><code>__init__.py</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>tests/</code><ul>
<li><code>test_thing.py</code></li>
<li><code>test_more/</code><ul>
<li><code>test_other_thing.py</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Notably, <code>tests</code> and all files under it <em>aren’t packages</em>. The <a href="https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#tests-outside-application-code">recommended import mode</a> enforces that you can’t import from them.</p>
<p>Therefore <code>INP001</code> shouldn’t trigger when <code>tests</code> is on top level of the project.</p>
<p>In fact, it would be great to have both a rule that enforces the opposite and to ensure that <code>tests/**/test_*.py</code> files don’t import things from each other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2023-08-10 08:27</div>
            <div class="timeline-body"><p>I think this could be related to #6114.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-08-10 08:56</div>
            <div class="timeline-body"><p>Pytest collects and imports individual files. That’s independent from Python’s namespace packages.</p>
<p>It’s possible that that other issue incidentally fixes this, but this is an independent issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-10 13:03</div>
            <div class="timeline-body"><p>Interesting. To what degree is this specific to pytest? On the surface it feels like per-file-ignores is the right solution here…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-08-10 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-08-10 14:43</div>
            <div class="timeline-body"><p>It’s very specific to Pytest. I’m coming from the perspective that when people have e.g.</p>
<pre><code class="language-toml">[tool.ruff]
select = ['INP', 'PT']
</code></pre>
<pre><code>project_dir
+- src/...
+- tests/
   +- test_foo.py
   +- test_bar/
      +- __init__.py
      +- test_bar_basic.py
</code></pre>
<p>then they should optimally see something like this:</p>
<pre><code>tests/test_bar/__init__.py:1:1: PT030 File `tests/test_bar/__init__.py` found. Pytest test directories shouldn’t contain packages.
</code></pre>
<p>Currently they will see an instruction to do the opposite of the recommended route:</p>
<pre><code>tests/test_foo.py:1:1: INP001 File `tests/test_foo.py` is part of an implicit namespace package. Add an `__init__.py`.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sanmai-NL">@sanmai-NL</a> on 2023-11-15 09:38</div>
            <div class="timeline-body"><p>See also #8690</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Artalus">@Artalus</a> on 2025-05-22 11:12</div>
            <div class="timeline-body"><p>For what it's worth, it seems that even <em>with</em> the <code>__init__.py</code> file present, <code>ruff</code> still complains about the <code>INP001</code> (unlike the original flake linter):</p>
<pre><code>[artalus@idpad foo]$ tree --gitignore
.
├── pyproject.toml
├── README.md
├── src
│   └── foo
│       └── __init__.py
├── tests
│   └── test_foo.py
└── uv.lock

[artalus@idpad foo]$ uv pip install flake8-no-pep420 ruff
Using Python 3.13.2 environment at: /tmp/420/.venv
Resolved 6 packages in 519ms
Installed 3 packages in 52ms
 + flake8==7.2.0
 + flake8-no-pep420==2.8.0
 + ruff==0.11.10

[artalus@idpad foo]$ flake8
./tests/test_foo.py:1:1: INP001 File is part of an implicit namespace package. Add an __init__.py?

[artalus@idpad foo]$ ruff check
tests/test_foo.py:1:1: INP001 File `tests/test_foo.py` is part of an implicit namespace package. Add an `__init__.py`.
Found 1 error.

[artalus@idpad foo]$ touch tests/__init__.py

[artalus@idpad foo]$ flake8

[artalus@idpad foo]$ ruff check
tests/test_foo.py:1:1: INP001 File `tests/test_foo.py` is part of an implicit namespace package. Add an `__init__.py`.
Found 1 error.
</code></pre>
<p>We ended up disabling <code>INP001</code> for the tests dir:</p>
<pre><code class="language-toml"># /pyproject.toml
[tool.ruff.lint.per-file-ignores]
&quot;tests/*&quot; = [  # /* ensures it works for all subdirectories
    &quot;INP001&quot;,  # &quot;implicit namespace package&quot; is invalid for pytest
]

# OR,

# /tests/ruff.toml
# inherit all settings from the main file
extend = &quot;../pyproject.toml&quot;
[lint]
ignore = [
    &quot;INP001&quot;,
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/calumy">@calumy</a> on 2025-05-23 06:37</div>
            <div class="timeline-body"><p>I believe the <code>__init__.py</code> file needs to be present in the test directory to fix the <code>INP001</code> error</p>
<pre><code>.
├── pyproject.toml
├── README.md
├── src
│   └── foo
│       └── __init__.py
├── tests
│   ├── test_foo.py
│   └── __init__.py
└── uv.lock
</code></pre>
<p>(I haven't actually tested this, but I believe it is correct as we have <code>__init__.py</code> files in our test directories and don't see these errors.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2025-05-26 09:05</div>
            <div class="timeline-body"><blockquote>
<p>I believe the <code>__init__.py</code> file needs to be present in the test directory to fix the INP001 error</p>
</blockquote>
<p>The <code>tests</code> directory is not a Python package, so putting an <code>__init__.py</code> anywhere in the <code>tests</code> directory is wrong, don’t do it. Therefore Ruff asking you to do that is an issue. The issue right here that you’re commenting under.</p>
<p>Saying “put <code>__init__.py</code> into the tests directory” in here is like if I went to the vet with my sick dog and you came in saying “did you try killing the dog?” Yeah, sure, that would remove the issue, but that’s not the point now, is it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @MichaReiser on 2025-05-26 09:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-05-26 09:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-26 09:27</div>
            <div class="timeline-body"><p>Special casing <code>tests</code> in INP001` if it's at the root of the project seems like a reasonable default to me.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:57 UTC
    </footer>
</body>
</html>
