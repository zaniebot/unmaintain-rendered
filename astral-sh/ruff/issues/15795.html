<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`redundant-none-literal (PYI061)`: Unsafe or different autofix for Python 3.9 - astral-sh/ruff #15795</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>redundant-none-literal (PYI061)</code>: Unsafe or different autofix for Python 3.9</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15795">#15795</a>
        opened by <a href="https://github.com/Avasam">@Avasam</a>
        on 2025-01-28 21:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Avasam">@Avasam</a></div>
            <div class="timeline-body">Description
<p>In <a href="https://github.com/astral-sh/ruff/pull/14872">astral-sh/ruff#14872</a>, more autofixes were added for <code>redundant-none-literal (PYI061)</code>, but it only applies to Python 3.10+ as the <code>|</code> may not be usable in annotations in &lt;=3.9 in all cases, even with <code>from __future__ import annotations</code>.</p>
<p>I am requesting to either allow the fix on &lt;=3.9 as an &quot;unsafe&quot; autofix.
OR to autofix using <code>typing.Union</code>. Leaving the <code>Union</code> --&gt; <code>|</code> transformation logic to other (<code>UP</code>?) rules.</p>
<p>I also think this fix should always be available using <code>|</code> in type stubs (<code>.pyi</code> files)</p>
Current vs expected
<p>The following code:</p>
<pre><code>def get_rotation(rotation: float | Literal[None, &quot;horizontal&quot;, &quot;vertical&quot;]) -&gt; float: ...
</code></pre>
<p>With the following command:
<code>ruff check --fix --unsafe-fixes --preview --select=PYI061 --isolated --target-version=py39</code></p>
In Ruff 0.9.3:
<pre><code>stubs\matplotlib\text.pyi:16:44: PYI061 `Literal[None, ...]` can be replaced with `Literal[...] | None`
   |
14 | from .transforms import Bbox, Transform
15 |
16 | def get_rotation(rotation: float | Literal[None, &quot;horizontal&quot;, &quot;vertical&quot;]) -&gt; float: ...
   |                                            ^^^^ PYI061
17 |
18 | class Text(Artist):
   |
   = help: Replace with `Literal[...] | None`

Found 1 error.
</code></pre>
I expect:
<pre><code>Found 1 error (1 fixed, 0 remaining).
</code></pre>
<p>Unsafely autofixed to:</p>
<pre><code>def get_rotation(rotation: float | Literal[&quot;horizontal&quot;, &quot;vertical&quot;] | None) -&gt; float: ...
</code></pre>
<p>Or safely autofixed to:</p>
<pre><code>def get_rotation(rotation: float | Union[Literal[&quot;horizontal&quot;, &quot;vertical&quot;], None]) -&gt; float: ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-28 23:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-01-28 23:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/dylwil3">@dylwil3</a> by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-02-03 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-02-08 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-02-08 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-02-09 15:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:23 UTC
    </footer>
</body>
</html>
