<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False negatives on PYI rules - astral-sh/ruff #8771</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False negatives on PYI rules</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8771">#8771</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2023-11-19 21:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/AlexWaygood">@AlexWaygood</a></div>
            <div class="timeline-body"><p>Ruff reports no errors on the following code snippet (saved as a <code>.pyi</code> stub file) with the command <code>ruff --select=PYI</code>, whereas flake8-pyi reports quite a few ;)</p>
<pre><code>import mypy_extensions
import typing
import typing_extensions

from typing import TypedDict, TypeVarTuple, Union
from typing_extensions import TypeAlias

DoublyNestedAlias: TypeAlias = Union[type[str], type[float] | type[bytes]]

class _UnusedTypedDict3(mypy_extensions.TypedDict):
    baz: dict[str, str]

_UnusedTypedDict4 = TypedDict(&quot;_UnusedTypedDict4&quot;, {&quot;-&quot;: int, &quot;def&quot;: str})
_UnusedTypedDict5 = typing_extensions.TypedDict(&quot;_UnusedTypedDict5&quot;, {&quot;foo&quot;: bytes, &quot;bar&quot;: str})
_P = typing_extensions.ParamSpec(&quot;_P&quot;)
_Ts = TypeVarTuple(&quot;_Ts&quot;)

type lowercase_alias = str | int
type _LooksLikeATypeVarT = str | int
type _Unused = str | int

def badfunc1(*args: typing.NoReturn) -&gt; None: ...
def badfunc2(**kwargs: typing_extensions.NoReturn) -&gt; None: ...
</code></pre>
<p>If I run <code>flake8 --extend-ignore=Y023,Y031,Y037</code> on the same file (with the latest version of the flake8-pyi installed), it reports the following violations:</p>
<pre><code>sample.pyi:8:49: Y055 Multiple &quot;type[Foo]&quot; members in a union. Combine them into one, e.g. &quot;type[float | bytes]&quot;.
sample.pyi:10:1: Y049 TypedDict &quot;_UnusedTypedDict3&quot; is not used
sample.pyi:13:1: Y049 TypedDict &quot;_UnusedTypedDict4&quot; is not used
sample.pyi:14:1: Y049 TypedDict &quot;_UnusedTypedDict5&quot; is not used
sample.pyi:15:1: Y018 ParamSpec &quot;_P&quot; is not used
sample.pyi:16:1: Y018 TypeVarTuple &quot;_Ts&quot; is not used
sample.pyi:18:1: Y042 Type aliases should use the CamelCase naming convention
sample.pyi:19:1: Y043 Bad name for a type alias (the &quot;T&quot; suffix implies a TypeVar)
sample.pyi:19:1: Y047 Type alias &quot;_LooksLikeATypeVarT&quot; is not used
sample.pyi:20:1: Y047 Type alias &quot;_Unused&quot; is not used
sample.pyi:22:15: Y050 Use &quot;typing_extensions.Never&quot; instead of &quot;NoReturn&quot; for argument annotations
sample.pyi:23:16: Y050 Use &quot;typing_extensions.Never&quot; instead of &quot;NoReturn&quot; for argument annotations
</code></pre>
<p>TODO:</p>
<ul>
<li>[x] Y018 false negatives on unused TypeVarTuples and ParamSpecs</li>
<li>[x] Y042 false negatives on lowercase PEP-695 type aliases</li>
<li>[x] Y043 false negatives on PEP-695 type aliases</li>
<li>[x] Y047 false negatives on PEP-695 type aliases (<a href="https://github.com/astral-sh/ruff/pull/9566">astral-sh/ruff#9566</a>)</li>
<li>[ ] Y049 false negatives on TypedDicts constructed using <code>mypy_extensions.TypedDict</code> rather than <code>typing.TypedDict</code> or <code>typing_extensions.TypedDict</code></li>
<li>[x] Y049 false negatives on TypedDicts constructed using call-based syntax (<a href="https://github.com/astral-sh/ruff/pull/9567">astral-sh/ruff#9567</a>)</li>
<li>[x] Y050 false negatives on <code>*args</code> and <code>**kwargs</code> annotated using <code>typing.NoReturn</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2023-11-19 21:56</div>
            <div class="timeline-body"><p>(Some of these are due to recent changes we&#x27;ve made in flake8-pyi -- e.g. the violations on lines 18-20 are because we recently extended our type alias rules to cover type aliases created using PEP-695 type statements.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-19 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-19 22:58</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-20 16:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-01-18 10:06</div>
            <div class="timeline-body"><p>All but one of these are now ticked off ðŸ¥³</p>
<p>I&#x27;m closing this now, since the last one is sort-of in a category by itself, and I&#x27;m not sure we&#x27;d want to fix it. The obvious way to teach ruff to recognize <code>mypy_extensions.TypedDict</code> would be to have ruff recognize <code>mypy_extensions</code> as a &quot;typing module&quot; in the same way as <code>typing</code> or <code>typing_extensions</code>. But unlike <code>typing</code> and <code>typing_extensions</code>, <code>mypy_extensions</code> is, well, mypy-specific -- other type checkers accord it no special treatment. <code>mypy_extensions.TypedDict</code> specifically <a href="https://github.com/python/mypy_extensions/commit/e0c6670e05a87507d59b7d3a0aa2eec88e9813b0">is also deprecated</a> in favour of <code>typing(_extensions).TypedDict</code> (though there&#x27;s yet to be a release that includes the <code>DeprecationWarning</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-01-18 10:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:46 UTC
    </footer>
</body>
</html>
