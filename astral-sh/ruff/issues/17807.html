<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pyproject.toml typo prevents nvim from formatting the whole project. - astral-sh/ruff #17807</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pyproject.toml typo prevents nvim from formatting the whole project.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17807">#17807</a>
        opened by <a href="https://github.com/vbardakos">@vbardakos</a>
        on 2025-05-03 08:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/vbardakos">@vbardakos</a> on 2025-05-03 08:47</div>
            <div class="timeline-body"><h3>Summary</h3>
<p><strong>Description</strong>
A missing trailing comma inside the <code>pyproject.toml</code> dependencies list prevents ruff from formatting any file inside the project, while the lsp is working as expected. It behaves like the format keybind has stopped working, while the same occurs with the format on save.</p>
<p><strong>Example</strong></p>
<pre><code class="language-bash">uv init --package mock_project --python 3.12
</code></pre>
<p>Manually added:</p>
<pre><code class="language-toml">dependencies = [
    &quot;pydantic&quot;
    &quot;pytest&quot;
]
</code></pre>
<p><strong>Vim Configuration:</strong>
<code>conform.nvim</code> setup:</p>
<pre><code>formatters_by_ft = {
  python = {
    &quot;ruff_fix&quot;,
    &quot;ruff_format&quot;,
    &quot;ruff_organize_imports&quot;,
    lsp_format = &quot;fallback&quot;,
  },
</code></pre>
<p>LspConfig options:</p>
<pre><code>pyright = {
  settings = {
    pyright = {
      -- Using Ruff's import organizer
      disableOrganizeImports = true,
    },
    python = {
      analysis = {
        -- Ignore all files for analysis to exclusively use Ruff for linting
        ignore = { &quot;*&quot; },
      },
    },
  },
},
ruff = {
  -- https://docs.astral.sh/ruff/editors/settings
  init_options = {
    settings = {
      logLevel = &quot;debug&quot;,
      codeAction = {
        fixViolation = { enable = true },
      },
      lint = {
        preview = true,
        extendSelect = {
          &quot;F&quot;,
          &quot;E&quot;,
          &quot;W&quot;,
          &quot;C&quot;,
          &quot;I&quot;,
          &quot;N&quot;,
          &quot;U&quot;,
          &quot;ASYNC&quot;,
          &quot;S&quot;,
          &quot;B&quot;,
          &quot;A&quot;,
          &quot;C4&quot;,
          &quot;DTZ&quot;,
          &quot;EM&quot;,
          &quot;EXE&quot;,
          &quot;FA&quot;,
          &quot;ICN&quot;,
          &quot;LOG&quot;,
          &quot;G&quot;,
          &quot;INP&quot;,
          &quot;PIE&quot;,
          &quot;PYI&quot;,
          &quot;PT&quot;,
          &quot;Q&quot;,
          &quot;RET&quot;,
          &quot;SIM&quot;,
          &quot;TID&quot;,
          &quot;TC&quot;,
          &quot;ARG&quot;,
          &quot;PTH&quot;,
          &quot;FIX&quot;,
          &quot;ERA&quot;,
          &quot;PD&quot;,
          &quot;PGH&quot;,
          &quot;PL&quot;,
          &quot;TRY&quot;,
          &quot;NPY&quot;,
          &quot;FAST&quot;,
          &quot;AIR&quot;,
          &quot;PERF&quot;,
          &quot;FURB&quot;,
          &quot;RUF&quot;,
        },
        ignore = { &quot;D&quot; },
      },
      format = {
        preview = true,
      },
    },
  },
}
</code></pre>
<h3>Version</h3>
<p>0.11.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ntBre on 2025-05-05 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-05 12:54</div>
            <div class="timeline-body"><p>My initial reaction is that this is working as intended. I don't think it would make much sense to try checking or formatting the project if we failed to load the config file, which is what seems to be happening here. That could easily reformat the entire project with the wrong settings instead of doing nothing. There should be a log message somewhere explaining what's going on, though. Were you able to find one of those?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-12 08:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:23 UTC
    </footer>
</body>
</html>
