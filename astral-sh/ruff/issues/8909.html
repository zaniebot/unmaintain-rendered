<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>docstring code formatter: add benchmarks - astral-sh/ruff #8909</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>docstring code formatter: add benchmarks</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/8909">#8909</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2023-11-29 13:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-11-29 13:31</div>
            <div class="timeline-body"><p>There is some concern over whether the new docstring code snippet formatting could slow down the overall formatting process. To ameliorate this and understand its performance characteristics, we should try to write some micro-benchmarks that will help us track performance over time. @MichaReiser in particular had some suggestions here: https://github.com/astral-sh/ruff/issues/8857#issuecomment-1830959726</p>
<p>I think we should try to include some &quot;real world&quot; examples of code snippets, but it might also be useful to try to include some &quot;tortured&quot; examples too. That is, try to devise the absolute worst case for performance and see how it does. This will give us an idea of what perf might look like at the extremes. For example, this might help us characterize the costs of us checking whether the reformatted code is valid or not. See #8857.</p>
<p>At present, I have done <a href="https://github.com/astral-sh/ruff/issues/8857#issuecomment-1830018211">some very loose ad hoc benchmarking</a> to get a general sense of things:</p>
<blockquote>
<p>For an ad hoc benchmark, if I run the formatter with and without <code>docstring-code</code> enabled, then runtime is about the same. I ran it a few times and couldn't notice a difference. (Not that this is a good substitute for a real benchmark, but perhaps suggestive that docstring code formatting doesn't have a huge impact on perf.)</p>
</blockquote>
<p>In particular, I did that on CPython and polars.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">performance</span> added by @BurntSushi on 2023-11-29 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @BurntSushi on 2023-11-29 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @BurntSushi on 2023-11-29 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/8857.html">astral-sh/ruff#8857</a> on 2023-11-29 13:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
