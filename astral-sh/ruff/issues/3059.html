<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>isort: bug in sorting sub-package modules - astral-sh/ruff #3059</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>isort: bug in sorting sub-package modules</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3059">#3059</a>
        opened by <a href="https://github.com/spaceone">@spaceone</a>
        on 2023-02-20 14:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-20 14:42</div>
            <div class="timeline-body"><p><code>.isort.cfg</code></p>
<pre><code class="language-ini">[settings]
known_first_party=foo.bar,baz
known_third_party=foo,blub,blah
</code></pre>
<p>valid isort-compatible code:</p>
<pre><code class="language-python">import sys

import blah
import blub
import foo
from foo import bar, baz

import baz
import foo.bar
from foo.bar import blah, blub
</code></pre>
<p><code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[tool.ruff]
select = [&quot;I&quot;]
[tool.ruff.isort]
known-first-party = [&quot;foo.bar&quot;, &quot;baz&quot;]
known-third-party = [&quot;foo&quot;, &quot;blub&quot;, &quot;blah&quot;]
</code></pre>
<pre><code class="language-console">$ ruff --fix --diff foo.py
--- foo.py
+++ foo.py
@@ -3,8 +3,8 @@
 import blah
 import blub
 import foo
+import foo.bar
 from foo import bar, baz
+from foo.bar import blah, blub
 
 import baz
-import foo.bar
-from foo.bar import blah, blub

Would fix 1 error.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "isort: bugs in sorting third party modules" to "isort: bug in sorting sub-package modules" by @spaceone on 2023-02-20 14:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-20 14:44</div>
            <div class="timeline-body"><p>I'm tempted to call this unsupported. Isn't the issue here that you're marking a module and one of its submodules as third- and first-party respectively?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-20 14:48</div>
            <div class="timeline-body"><p>ruff should be isort compatible, right?</p>
<p>we have a main package <code>foo</code> with many different sub-packages as <code>foo.bar</code> or <code>foo.blub</code>.
In the code of <code>foo.bar</code> we want that <code>foo.bar</code> is a first-party module and everything else (<code>foo</code> and <code>foo.blub</code>) is just a third-party module.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @charliermarsh on 2023-02-20 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-20 17:23</div>
            <div class="timeline-body"><p>The intent is to be <code>isort</code>-compatible, but we do deviate in a small number of cases, and this to me seems like a situation where there isn't a clear definition of correct behavior. I'd be open to doing what <code>isort</code> does rather than our current behavior, but I won't personally prioritize it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spaceone">@spaceone</a> on 2023-02-20 18:39</div>
            <div class="timeline-body"><p>I provided a fix in #3064. Isort has a test case for it: https://github.com/PyCQA/isort/blob/main/tests/unit/test_isort.py#L2213-L2304 â†’ <code>test_placement_control()</code> and <code>test_custom_sections()</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/astaric">@astaric</a> on 2023-03-27 08:15</div>
            <div class="timeline-body"><p>One usecase where we encounter the same issue are namespace packages. We have different packages (in different repositories) share the same namespace package.</p>
<p>With the following config, isort lists <code>namespace.packageA</code> imports in the last section while all other namespace imports are listed in the third party section above.</p>
<pre><code>known_first_party = namespace.packageA
default_section = THIRDPARTY
</code></pre>
<p>I played around with <code>known_first_party</code> and <code>known_third_party</code> options but I cannot get packages with the same namespace prefix to end up in different sections.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-29 03:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:26 UTC
    </footer>
</body>
</html>
