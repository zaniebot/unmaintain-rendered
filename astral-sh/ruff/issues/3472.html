<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug - Cannot ignore `TCH004` via config file - astral-sh/ruff #3472</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bug - Cannot ignore `TCH004` via config file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3472">#3472</a>
        opened by <a href="https://github.com/Kilo59">@Kilo59</a>
        on 2023-03-13 01:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Kilo59">@Kilo59</a> on 2023-03-13 01:14</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Ignoring <code>TCH004</code> in the configuration file has no effect. This seems to be true for <code>ruff.toml</code> and <code>pyproject.toml</code> files.</p>
<p>Suppressing in-line with <code># noqa: TCH004</code> works fine.
Ignoring other <code>TCH**</code> rules seems to work fine.</p>
<pre><code>ruff 0.0.254
</code></pre>
<pre><code class="language-toml"># ruff.toml
select = [&quot;TCH&quot;]
ignore = [&quot;TCH004&quot;]
</code></pre>
<pre><code class="language-python"># my_script.py
from typing import TYPE_CHECKING, Union

try:
    import numpy as np
except ImportError:
    np = None


if TYPE_CHECKING:
    import numpy as np


# Note: without postponed annotations, this will fail at runtime
def my_func(a: Union[float, np.float64], b: Union[float, np.float64]):
    return a + b
</code></pre>
<pre><code>❯ ruff my_script.py
my_script.py:10:12: TCH004 Move import `numpy` out of type-checking block. Import is used for more than type hinting.
Found 1 error.
</code></pre>
<p>☝️ I would expect to get no errors above due to the config ignore of <code>TCH004</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Bug - Cannot ignore `TCH004`" to "Bug - Cannot ignore `TCH004` via config file" by @Kilo59 on 2023-03-13 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-13 02:15</div>
            <div class="timeline-body"><p>Just a bug, fixing...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-03-13 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-03-13 02:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3474.html">astral-sh/ruff#3474</a> on 2023-03-13 02:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-13 02:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../great-expectations/great_expectations/pulls/7349.html">great-expectations/great_expectations#7349</a> on 2023-03-14 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5787.html">astral-sh/ruff#5787</a> on 2023-07-15 20:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:06 UTC
    </footer>
</body>
</html>
