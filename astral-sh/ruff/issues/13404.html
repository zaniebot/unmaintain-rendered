<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>previous import affects # noqa: I001 directive - astral-sh/ruff #13404</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>previous import affects # noqa: I001 directive</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/13404">#13404</a>
        opened by <a href="https://github.com/AntiSol">@AntiSol</a>
        on 2024-09-19 03:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AntiSol">@AntiSol</a> on 2024-09-19 03:40</div>
            <div class="timeline-body"><p>Hi, I'm seeing a weird issue when I ignore import sorting for one module. If I have another import statement before the <code>#noqa: I001</code> directive, ruff ignores the <code>noqa</code> directive and tries to sort imports for that file. However having an import statement <em>after</em> the manually-sorted imports works as expected*.</p>
<ul>
<li><p>I tried searching for a few things like I001, isort, etc, didn't see any likely candidates that described my issue</p>
</li>
<li><p>code without the issue (ruff is happy): https://play.ruff.rs/bf6b5099-2f83-4277-8777-08d286384606</p>
</li>
<li><p>code showing the issue (simply add an import before the import with the #noqa: I001 directive to make ruff unhappy): https://play.ruff.rs/cd78f390-38c1-4769-85c3-55267a4f6fec</p>
</li>
<li><p>Notice that applying the &quot;fix&quot; also &quot;fixes&quot; unsorted imports even for the file with the noqa directive applied.</p>
</li>
<li><p>Notice that moving the <code>from a_module import something</code> import to below the multi-line import does not trigger I001, which may or may not be considered correct behaviour - I want manually-sorted imports <em>within</em> the z_file import, but IMO the a_file import should probably still be sorted before z_file. However one could argue that disabling I001 for the z_file import removes it from the module sort order (I consider this less desirable, but it's a matter of opinion)</p>
</li>
<li><p>The current Ruff version: <code>ruff 0.6.5</code></p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntiSol">@AntiSol</a> on 2024-09-19 03:54</div>
            <div class="timeline-body"><p>Update: workaround: add a block comment between your imports: https://play.ruff.rs/4ed0f148-ee97-487d-8d9e-89fda8e3d568</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2024-09-19 06:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-19 07:01</div>
            <div class="timeline-body"><p>Thanks for the nice write-up and for sharing the examples in the playground!</p>
<p>This behavior is a consequence that Ruff only creates a single diagnostic for the entire import block and adding a new import at the top changes the diagnostic range to the first import's line.</p>
<p>I recommend you use the <a href="https://docs.astral.sh/ruff/linter/#action-comments"><code>isort</code> action comments</a> to suppress sorting over <code>noqa</code>. New imports should not be impacted for as long as they are all added above or below the existing import.</p>
<pre><code class="language-python">from a_module import something

# isort: off
# imports from z_module have their own manual order
from z_module import (
    # functions
    d,
    a,
    # variables
    b,
    e,
    c,
)
# isort: on

from b import c
</code></pre>
<p>(for some reason the isort action comments are ignored in the playground)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntiSol">@AntiSol</a> on 2024-09-19 07:54</div>
            <div class="timeline-body"><p>Hey, thanks for the quick response, glad my report is useful.</p>
<p>The isort off/on directives did indeed do the trick, too, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-09-19 08:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:53 UTC
    </footer>
</body>
</html>
