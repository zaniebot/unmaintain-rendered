<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FURB110 may break code  - astral-sh/ruff #11398</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>FURB110 may break code</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11398">#11398</a>
        opened by <a href="https://github.com/martinlehoux">@martinlehoux</a>
        on 2024-05-13 07:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/martinlehoux">@martinlehoux</a> on 2024-05-13 07:55</div>
            <div class="timeline-body"><ul>
<li>Keywords: FURB110</li>
<li>Command: <code>ruff --preview --select FURB110 --fix</code></li>
<li>Ruff version: 0.4.3</li>
</ul>
<p>FURB110 autofix (with preview) changed code</p>
<pre><code class="language-py">place_id = (
    location_place_id
    if location_place_id
    else City.objects.get(pk=city_id).gmaps_place_id
    if city_id
    else None
)    
</code></pre>
<p>into</p>
<pre><code class="language-py">place_id = location_place_id or City.objects.get(pk=city_id).gmaps_place_id if city_id else None
</code></pre>
<p>With inputs <code>location_place_id = &quot;abc&quot;</code> and <code>city_id = None</code>, the code previously returned &quot;abc&quot; but now returns None</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2024-05-13 08:03</div>
            <div class="timeline-body"><p>Could you provide a minimal code snippet to try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blueraft">@blueraft</a> on 2024-05-13 11:01</div>
            <div class="timeline-body"><p>I'm able to reproduce it using the following example.</p>
<pre><code class="language-sh">❯ bat test.py
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: test.py
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ location_place_id = &quot;abc&quot;
   2   │ city_id = None
   3   │ place_id = (
   4   │     location_place_id
   5   │     if location_place_id
   6   │     else &quot;ghi&quot;
   7   │     if city_id
   8   │     else None
   9   │ )
  10   │
  11   │ print(place_id)
───────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ python test.py
abc

</code></pre>
<p>After running <code>ruff --fix</code>.</p>
<pre><code class="language-sh">❯ ruff check test.py --preview --select FURB110 --fix
Found 1 error (1 fixed, 0 remaining).
❯ bat test.py
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: test.py
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ location_place_id = &quot;abc&quot;
   2   │ city_id = None
   3   │ place_id = (
   4   │     location_place_id or &quot;ghi&quot;
   5   │     if city_id
   6   │     else None
   7   │ )
   8   │
   9   │ print(place_id)
───────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ python test.py
None
</code></pre>
<p>The correct fix here should wrap the second <code>or</code> statement in parentheses.</p>
<pre><code class="language-sh">❯ bat test.py
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: test.py
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ location_place_id = &quot;abc&quot;
   2   │ city_id = None
   3   │ place_id = location_place_id or (&quot;ghi&quot; if city_id else None)
   4   │ print(place_id)
───────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
❯ python test.py
abc
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/martinlehoux">@martinlehoux</a> on 2024-05-13 11:34</div>
            <div class="timeline-body"><p>Thanks @blueraft , and yes that is exactly the fix I did ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-05-13 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @charliermarsh on 2024-05-13 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-13 13:57</div>
            <div class="timeline-body"><p>Probably a precedence issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-13 14:03</div>
            <div class="timeline-body"><p>I think the edit content should be generated using the <code>Generator</code> to account for precedence as it currently uses raw string:</p>
<p>https://github.com/astral-sh/ruff/blob/1c18408e5223f34857c514c78a3885e102ea39b1/crates/ruff_linter/src/rules/refurb/rules/if_exp_instead_of_or_operator.rs#L85-L92</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-13 14:05</div>
            <div class="timeline-body"><p>Raw strings are better right now IMO since they preserve more of the verbatim content. I think I'd rather augment the fix to parenthesize if needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @charliermarsh on 2024-05-13 17:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-05-18 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @charliermarsh on 2024-05-18 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-19 03:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:33:53 UTC
    </footer>
</body>
</html>
