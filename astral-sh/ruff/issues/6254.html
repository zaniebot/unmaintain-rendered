<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean up unused variables after fixes - astral-sh/ruff #6254</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Clean up unused variables after fixes</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/6254">#6254</a>
        opened by <a href="https://github.com/tylerlaprade">@tylerlaprade</a>
        on 2023-08-01 17:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-08-01 17:44</div>
            <div class="timeline-body"><pre><code class="language-python">x = None
try:
    x = func_that_might_throw()
except AttributeError:
    pass
return x
</code></pre>
<p>is getting simplified to</p>
<pre><code>x = None  # Variable &quot;x&quot; is not accessed
with contextlib.suppress(AttributeError):
    return func_that_might_throw()
</code></pre>
<p>If this is the first time we've seen <code>x</code>, can we clean up the null assignment?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @zanieb on 2023-08-01 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @zanieb on 2023-08-01 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-01 17:50</div>
            <div class="timeline-body"><p>Thanks for the report! Seems reasonable to me although it may be non-trivial.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 17:53</div>
            <div class="timeline-body"><p>I believe this works as expected, assuming you enable the right set of rules: <code>ruff check foo.py --select SIM --select RET --select F -n --fix</code>.</p>
<p>We like to treat each fix as independent. Here, the <code>SIM105</code> rule gives you:</p>
<pre><code class="language-python">import contextlib
def f():
    x = None
    with contextlib.suppress(AttributeError):
        x = func_that_might_throw()

    return x
</code></pre>
<p>Then the <code>RET</code> rule simplifies to:</p>
<pre><code class="language-python">import contextlib
def f():
    x = None
    with contextlib.suppress(AttributeError):
        return func_that_might_throw()
</code></pre>
<p>Then the <code>F</code> rule identifies the unused variable:</p>
<pre><code class="language-python">import contextlib
def f():
    with contextlib.suppress(AttributeError):
        return func_that_might_throw()
</code></pre>
<p>(This all happens in one <code>ruff</code> invocation, I'm just breaking it down for clarity.)</p>
<p>Perhaps you have <code>F841</code> disabled?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-08-01 18:29</div>
            <div class="timeline-body"><p>Ahh, @charliermarsh is correct.</p>
<pre><code class="language-toml">unfixable = [&quot;B007&quot;, &quot;ERA001&quot;, &quot;F841&quot;, &quot;RUF100&quot;]
</code></pre>
<p>We disabled autofix on <code>F841</code> because variables are often temporarily unused while rearranging a file. We don't want an errant <code>⌘ + S</code> to accidentally delete useful code. In this case, though, there's no danger since it's only unused as a result of the other (safe) autofixes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-01 18:58</div>
            <div class="timeline-body"><p>@tylerlaprade I agree that seems like a fair use-case. We probably don't want to resolve this <em>just</em> for this specific rule though, instead we should work on a general solution that checks for unused variables <em>introduced</em> by an autofix.</p>
<p>Would you mind if I retitle this issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-08-01 19:05</div>
            <div class="timeline-body"><p>Yes, please do! I'm glad this could potentially turn out to be more generally applicable than just a single rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`SIM105` should clean up unused variable after refactor" to "Clean up unused variables after fixes" by @zanieb on 2023-08-01 19:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-01 19:10</div>
            <div class="timeline-body"><p>In the meantime, for this use-case, I'd recommend leaving <code>F841</code> enabled in your configuration and only disabling it in the flags passed when used by the IDE. Would that help?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> removed by @zanieb on 2023-08-01 19:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-08-01 20:55</div>
            <div class="timeline-body"><p>Yes, that's a good suggestion, thank you Zanie!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tylerlaprade">@tylerlaprade</a> on 2023-08-01 21:01</div>
            <div class="timeline-body"><p>Ah, no luck - that same flag is used for the recursive fixes, so <code>⌘ + S</code> still has the same behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-01 21:34</div>
            <div class="timeline-body"><p>I think the suggestion was to leave you with a setup such that unused variables would be removed when running via the CLI, but not when running in the editor (which could happen &quot;by accident&quot;).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10954.html">astral-sh/ruff#10954</a> on 2024-04-15 12:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
