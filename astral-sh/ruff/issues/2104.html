<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Potential inconsistency between Ruff's ``I`` and isort - astral-sh/ruff #2104</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Potential inconsistency between Ruff's ``I`` and isort</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/2104">#2104</a>
        opened by <a href="https://github.com/AA-Turner">@AA-Turner</a>
        on 2023-01-23 08:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AA-Turner">@AA-Turner</a> on 2023-01-23 08:52</div>
            <div class="timeline-body"><p>I believe this is distinct from https://github.com/charliermarsh/ruff/issues/1718; cross-linking in case there are similarities, though.</p>
<p>isort version: 5.11.4
Ruff version: 230</p>
<p>isort config:</p>
<pre><code class="language-toml">[tool.isort]
line_length = 95
profile = &quot;black&quot;
remove_redundant_aliases = true
</code></pre>
<p>Commands:</p>
<pre><code class="language-powershell">(sphinx) PS I:\Development\sphinx&gt; ruff -V        
ruff 0.0.230
(sphinx) PS I:\Development\sphinx&gt; type bug.py                                   
from operator import add  # NoQA: F401
from operator import mul, sub
(sphinx) PS I:\Development\sphinx&gt; ruff --isolated --select I bug.py
bug.py:1:1: I001 Import block is un-sorted or un-formatted
Found 1 error(s).
1 potentially fixable with the --fix option.
(sphinx) PS I:\Development\sphinx&gt; isort --check bug.py 
</code></pre>
<p>Note Ruff wants to re-format to:</p>
<pre><code class="language-python">from operator import (
    add,  # NoQA: F401
    mul,
    sub,
)

</code></pre>
<p>whereas <code>isort</code> wants to reformat to:</p>
<pre><code class="language-python">from operator import add  # NoQA: F401
from operator import mul, sub
</code></pre>
<p>This appeared in the Sphinx project where some imports are type-comment only (e.g. in giving type annotations to iterators, where the pattern is <code>for item in items:  # type: blah`, should MyPy not be able to deduce the type of </code>item``).</p>
<p>A</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-23 17:35</div>
            <div class="timeline-body"><p>This does look like an incompatibility. I think the thing to decide is whether it's a known and accepted deviation, or not :)</p>
<p>Do you have a preference between the outputs? Did it cause any problems, or the issue is more that it deviated at all?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-01-23 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @charliermarsh on 2023-01-23 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jackenmen">@Jackenmen</a> on 2023-01-23 18:35</div>
            <div class="timeline-body"><p>Personally, I like Ruff's variant more as it keeps imports from a specific module in one statement. I don't know if the <code>noqa</code> comment applies properly in both cases though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-23 18:37</div>
            <div class="timeline-body"><p>Ruff will respect that noqa in both cases, but I don't think Flake8 respects the version that Ruff outputs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AA-Turner">@AA-Turner</a> on 2023-01-24 00:36</div>
            <div class="timeline-body"><blockquote>
<p>the issue is more that it deviated at all?</p>
</blockquote>
<p>This is the case for me, we run both isort and Ruff in continuous integration testing so either will fail unless an ungainly <code>isort: skip</code> or ruff-specific NoQA comment were added.</p>
<p>I don't particularly mind which style 'wins'.</p>
<p>A</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/skshetry">@skshetry</a> on 2023-01-29 11:22</div>
            <div class="timeline-body"><p>I prefer isort's output here as it is more granular for the ignores/disables to work. <code>pylint</code> for example cannot work with inlined-disables. Take this code for example, from a codebase that I work with:</p>
<pre><code class="language-python">from dvc.api.data import open  # pylint: disable=redefined-builtin
from dvc.api.data import read

__all__ = [&quot;read&quot;, &quot;open&quot;]
</code></pre>
<p><code>ruff</code> changes it to:</p>
<pre><code class="language-diff">--- script.py
+++ script.py
@@ -1,4 +1,6 @@
-from dvc.api.data import open  # pylint: disable=redefined-builtin
-from dvc.api.data import read
+from dvc.api.data import (
+    open,  # pylint: disable=redefined-builtin
+    read,
+)
 
 __all__ = [&quot;read&quot;, &quot;open&quot;]
</code></pre>
<p>And, <code>pylint</code> now fails:</p>
<pre><code class="language-console">script.py:1:0: W0622: Redefining built-in 'open' (redefined-builtin)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-29 17:24</div>
            <div class="timeline-body"><p>Yeah I think we should likely change this going forward given the handling of action comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-01-29 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-01-29 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../python-telegram-bot/python-telegram-bot/pulls/3594.html">python-telegram-bot/python-telegram-bot#3594</a> on 2023-03-19 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../microsoft/LightGBM/pulls/5871.html">microsoft/LightGBM#5871</a> on 2023-05-11 04:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andersk">@andersk</a> on 2023-08-02 22:04</div>
            <div class="timeline-body"><blockquote>
<p><code>pylint</code> for example cannot work with inlined-disables.</p>
</blockquote>
<p>Sure it can, you just need to move the comment to the right line.</p>
<pre><code class="language-python">from dvc.api.data import (  # pylint: disable=redefined-builtin
    open,
    read,
)

__all__ = [&quot;read&quot;, &quot;open&quot;]
</code></pre>
<p>Ruff canâ€™t be sure in advance which line the comment belongs on (and honestly, its first guess makes more sense), but once you put it on the right line, Ruff will leave it there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-10 21:09</div>
            <div class="timeline-body"><p>I'm going to close this for now as an intentional deviation. If we receive more reports or more feedback on it, as always, I'll reconsider.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-01-10 21:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../microsoft/LightGBM/issues/6304.html">microsoft/LightGBM#6304</a> on 2024-02-08 22:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../emlid/code-quality/pulls/24.html">emlid/code-quality#24</a> on 2025-02-24 14:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
