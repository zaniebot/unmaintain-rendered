<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow token-based rules to work on source code with syntax errors - astral-sh/ruff #11915</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow token-based rules to work on source code with syntax errors</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11915">#11915</a>
        opened by <a href="https://github.com/dhruvmanila">@dhruvmanila</a>
        on 2024-06-18 04:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dhruvmanila">@dhruvmanila</a></div>
            <div class="timeline-body"><p>Currently, the rules which work with the tokens doesn&#x27;t emit diagnostics after the location of the first syntax error. For example:</p>
<pre><code>foo;

&quot;hello world

bar;
</code></pre>
<p>This will only raise the <a href="https://docs.astral.sh/ruff/rules/useless-semicolon/"><code>useless-semicolon</code></a> for <code>foo</code> and not <code>bar</code> because there&#x27;s an unterminated string literal in between them.</p>
<p>Playground: https://play.ruff.rs/4c17a92c-0189-4b98-b961-27b04db14599</p>
<p>The task here is to disable this limit and allow token-based rules to check all the tokens. This raises a question: Now that the parser can now recover from an unclosed parenthesis (<a href="https://github.com/astral-sh/ruff/pull/11845">astral-sh/ruff#11845</a>), how to make sure that the rule logic knows about this and has the correct information about the nesting level? Should we reduce the nesting level if we encounter a <code>Newline</code> token?</p>
<p>We also need to make sure that this doesn&#x27;t panic in any scenarios (valid or invalid source code). This can be done via lots of fuzzing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">linter</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-18 04:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-18 04:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-02 08:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:54 UTC
    </footer>
</body>
</html>
