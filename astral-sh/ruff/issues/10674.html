<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feature: detect missing imports for submodules - astral-sh/ruff #10674</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>feature: detect missing imports for submodules</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/10674">#10674</a>
        opened by <a href="https://github.com/jaraco">@jaraco</a>
        on 2024-03-30 18:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jaraco">@jaraco</a> on 2024-03-30 18:52</div>
            <div class="timeline-body"><p>In #10673, I stumbled on a piece of lint that if detected would have helped me avoid trouble when using isort. Although ruff does detect missing imports for top-level modules, it appears not to do so for submodules. Consider this simple example:</p>
<pre><code> draft @ cat &gt; mod.py
import urllib


class MyRequest(urllib.request.Request):
  pass
 draft @ ruff check mod.py
All checks passed!
 draft @ py -m mod
Traceback (most recent call last):
  File &quot;&lt;frozen runpy&gt;&quot;, line 198, in _run_module_as_main
  File &quot;&lt;frozen runpy&gt;&quot;, line 88, in _run_code
  File &quot;/Users/jaraco/draft/mod.py&quot;, line 4, in &lt;module&gt;
    class MyRequest(urllib.request.Request):
                    ^^^^^^^^^^^^^^
AttributeError: module 'urllib' has no attribute 'request'
 draft @ sed -i -e 's/import urllib/import urllib.request/' mod.py
 draft @ py -m mod &amp;&amp; echo done
done
</code></pre>
<p>It's my understanding that best practice dictates the following:</p>
<ul>
<li>If the top level module is used directly, it should be imported separately.</li>
<li>All submodules referenced in the code should get explicit imports.</li>
</ul>
<p>So if one uses <code>os.getcwd()</code>, they should <code>import os</code>, and if they use <code>os.path.join</code>, they should <code>import os.path</code>, even if <code>import os</code> implicitly imports <code>os.path</code>.</p>
<p>I can't currently find the reference where this question was answered by the Python Core Devs, but I do recall that it contradicted my interpretation of the documentation (which was that it's fine to let the implied import suffice in both cases).</p>
<p>I'm not sure how tricky it could be to detect these missing imports (as a submodule name could be a separate module or could be a name programmatically added to the parent module), but I file the issue here for consideration anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jaraco">@jaraco</a> on 2024-03-30 19:01</div>
            <div class="timeline-body"><p>I see now my current understanding is based on a mixed opinion from core devs in a non-public chat:</p>
<p><img src="https://github.com/astral-sh/ruff/assets/308610/f6112f9f-4d62-427a-b01f-8bff51194e70" alt="image" /></p>
<p>There's definitely a <a href="https://stackoverflow.com/q/2724348/70170">mixed opinion in the community as well</a>, so it's not obvious that ruff could enforce one pattern or another, even with the technical challenges aside.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-30 23:12</div>
            <div class="timeline-body"><p>A few related issues from the past:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/9193</li>
<li>https://github.com/astral-sh/ruff/issues/4656</li>
<li>https://github.com/astral-sh/ruff/issues/60</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 02:03</div>
            <div class="timeline-body"><p>Thank you for the clear issue!</p>
<p>Some background: in Ruff's semantic model, we treat <code>import os</code> and <code>import os.path</code> as <em>roughly</em> equivalent, with a few exceptions (e.g., <code>import os; import os</code> will lead to a &quot;redefined while unused&quot; diagnostic, while <code>import os; import os.path</code> will not). So, e.g., <code>import os</code> allows you to access <code>os.getcwd() </code> or <code>os.path.join</code>. Similarly, <code>import os.path</code> allows you to access <code>os.getcwd()</code> or <code>os.path.join</code>.</p>
<p>This matches Pyflakes' approach and tends to yield reasonable behavior <em>most of</em> the time. <code>urllib</code> is the most common exception (as seen here), and we've considered special-casing it before since it's in the standard library...</p>
<p>I think we're unlikely to change the high-level rules around import <em>norms</em> in the near future, since it would be fairly disruptive and I don't see consensus in the community. However, I'd like to fix cases in which it's <em>actually</em> wrong (e.g., don't remove <code>from urllib import request</code> when it's necessary) once we've extended our semantic model to support analyzing these imports across files.</p>
<p>So, for now, I'm gonna close this as &quot;working as intended&quot; and track correctness fixes in https://github.com/astral-sh/ruff/issues/9193.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-04-01 02:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2024-04-01 02:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
