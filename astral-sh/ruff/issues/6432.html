<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PD rules trigger on non-Pandas DataFrames - astral-sh/ruff #6432</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PD rules trigger on non-Pandas DataFrames</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6432">#6432</a>
        opened by <a href="https://github.com/beskep">@beskep</a>
        on 2023-08-09 00:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/beskep">@beskep</a> on 2023-08-09 00:06</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>command: <code>ruff check test.py</code>
ruff version: <code>ruff 0.0.282</code>
settings: <code>select = ['ALL']</code></p>
<p>example:</p>
<pre><code class="language-python">import polars as pl

pldf = pl.DataFrame()
pldf.pivot()  # PD010 `.pivot_table` is preferred to `.pivot` or `.unstack`; provides same functionality
</code></pre>
<p>polars DataFrame provides <a href="https://pola-rs.github.io/polars/py-polars/html/reference/dataframe/api/polars.DataFrame.pivot.html"><code>.pivot()</code> function</a> but no <code>.pivot_table()</code> unlike pandas.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-08-09 02:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @charliermarsh on 2023-08-09 02:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-09 02:29</div>
            <div class="timeline-body"><p>Difficult for us to fully resolve this without a full type inference engine (we could use heuristics, like avoid flagging these rules if <code>polars</code> is imported, but that comes with other problems: you don't have to import Polars in order to access a Polars DataFrame, and just because you import Polars doesn't mean you aren't working with Pandas DataFrames anywhere). Likely won't be fixed in the near-term.</p>
<p>(I'd recommend against using these rules if you're working with Polars.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MarcoGorelli">@MarcoGorelli</a> on 2023-08-23 13:57</div>
            <div class="timeline-body"><p>for a simpler heuristic, would it be possible to check the alias used to instantiate the dataframe? <code>pl.DataFrame</code> rather than <code>pd.DataFrame</code> gives a pretty strong clue that it's not pandas</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kleinicke">@kleinicke</a> on 2024-04-17 12:19</div>
            <div class="timeline-body"><p>Currently the pandas rules are applied on many non pandas objects. For example PD011 tries to stop you from using .values anywhere, even if you use a library where you should use it.
Therefore some kind of check, if the object is even belonging to pandas would be pretty useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "PD010 false positive on polars.DataFrame" to "PD rules trigger on non-Pandas DataFrames" by @charliermarsh on 2024-05-02 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bje-">@bje-</a> on 2024-07-01 02:51</div>
            <div class="timeline-body"><p>The same thing happens with the Python <code>DEAP</code> package which has class members named <code>values</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ItsDrike">@ItsDrike</a> on 2024-07-21 13:22</div>
            <div class="timeline-body"><p>Ruff is actually really trigger happy here, just posting another quick example that causes ruff to trigger while just messing around with python builtins:</p>
<pre><code class="language-python"># ruff: noqa: F841
# pyright: reportUnusedVariable=false

x = {}
values_dict_func = x.values  # PD011
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bje-">@bje-</a> on 2024-07-22 17:56</div>
            <div class="timeline-body"><blockquote>
<p>Difficult for us to fully resolve this without a full type inference engine (we could use heuristics, like avoid flagging these rules if <code>polars</code> is imported, but that comes with other problems: you don't have to import Polars in order to access a Polars DataFrame, and just because you import Polars doesn't mean you aren't working with Pandas DataFrames anywhere). Likely won't be fixed in the near-term.</p>
</blockquote>
<p>I think the false positive rate on this warning is so high it should be abandoned. Could Pandas be modified to emit a deprecation warning instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-22 17:58</div>
            <div class="timeline-body"><p>Why not just turn it off in your project? By definition you've opted into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bje-">@bje-</a> on 2024-07-22 18:07</div>
            <div class="timeline-body"><p>A good lint tool should be one that doesn't require littering your source files with pragmas to disable false positives. Isn't one of the purposes of a linter to improve code readability?</p>
<p>(I just used a noqa pragma to disable NPY002, but in this case, ruff is correct, but I can't change it).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ncooder">@ncooder</a> on 2024-11-18 20:39</div>
            <div class="timeline-body"><p>This problem persists with pyspark. It tries to replace pivot with pivot_table.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SerTetora">@SerTetora</a> on 2025-01-28 14:14</div>
            <div class="timeline-body"><p>I think, i have same issue, but with <code>pytest.param</code></p>
<pre><code class="language-python">import pytest


def foo(bar: list[pytest.param]) -&gt; list[str]:
    ids = []
    for e in bar:
        a = e.values[0][&quot;a&quot;]  # noqa: PD011 # RUF100: Unused `noqa` directive (unused: `PD011`)
        ids.append(a)
    return ids
</code></pre>
<p>Playground:
https://play.ruff.rs/8b6c0675-5d75-4eb5-a7ed-df33b194e7fa</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-29 10:50</div>
            <div class="timeline-body"><p>@SerTetora I'm confused, it seems like it's working as expected i.e., you should remove the <code>noqa: PD011</code> because Ruff won't highlight <code>e.values</code> for <code>PD011</code>. We updated the rules related to Pandas to only trigger when there's a <code>pandas</code> import in the module (https://github.com/astral-sh/ruff/pull/14671).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SerTetora">@SerTetora</a> on 2025-01-29 11:14</div>
            <div class="timeline-body"><p>I can't reproduce it anymore. Maybe something wrong was on my local. Sorry for a noise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MeGaGiGaGon">@MeGaGiGaGon</a> on 2025-06-19 02:27</div>
            <div class="timeline-body"><p>I just double-checked all the <code>PD</code> rules, and currently the only one that still triggers without a <code>pandas</code> import is <code>PD002</code> <a href="https://play.ruff.rs/8ac74de3-e23d-47f3-9187-7473bc3b705d">playground</a> so it probably got missed in #14671.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-06-19 05:06</div>
            <div class="timeline-body"><p>Thanks for reporting!</p>
<p>I think we should replace the following code:</p>
<p>https://github.com/astral-sh/ruff/blob/e352a50b74329268589cdc18eafab123832559ac/crates/ruff_linter/src/rules/pandas_vet/rules/inplace_argument.rs#L55-L62</p>
<p>with the following which is more robust:</p>
<pre><code class="language-rs">    if !checker.semantic().seen_module(Modules::PANDAS) {
        return;
    }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2025-06-19 09:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @MichaReiser on 2025-06-19 09:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jordyjwilliams">@jordyjwilliams</a> on 2025-06-26 15:14</div>
            <div class="timeline-body"><blockquote>
<p>Thanks for reporting!</p>
<p>I think we should replace the following code:</p>
</blockquote>
<p>@dhruvmanila @MeGaGiGaGon thanks for doing all the hard work here xD</p>
<p>PR in: https://github.com/astral-sh/ruff/pull/18963</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GDYendell">@GDYendell</a> on 2025-08-02 16:04</div>
            <div class="timeline-body"><p>This should have been closed when #18963 was merged</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-08-02 19:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nataziel">@nataziel</a> on 2025-09-05 00:21</div>
            <div class="timeline-body"><p>This behaviour still occurs on non-Pandas objects, such as <code>xarray.DataArray</code>, if pandas is also imported.</p>
<p><img width="756" height="187" alt="Image" src="https://github.com/user-attachments/assets/60c65e1c-c2c2-4140-9dec-1ed5528248e7" /></p>
<p>Seems like type aware linting is needed for these types of rules. I believe you're already working towards using <code>ty</code> to do the type inference for when to apply the lint?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:30:55 UTC
    </footer>
</body>
</html>
