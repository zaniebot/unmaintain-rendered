<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>assertion failed: start.raw &lt;= end.raw appears again - astral-sh/ruff #11429</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>assertion failed: start.raw &lt;= end.raw appears again</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11429">#11429</a>
        opened by <a href="https://github.com/zhangzhen">@zhangzhen</a>
        on 2024-05-15 02:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/zhangzhen">@zhangzhen</a> on 2024-05-15 02:10</div>
            <div class="timeline-body"><p>I'm using ruff in neovim 0.9.5.</p>
<pre><code>RANGE_DICT = {
    (&quot;NRF1_chr9_gap1_g0&quot;, 0): (32, 43),
    (&quot;NRF1_chr9_gap1_g0&quot;, 1): (62, 73),
}
</code></pre>
<p>Before the constant defining statement, i typed def and then type a space. No errors occurred.
After it, i typed def and then a space. I got the following error:
thread 'main' panicked at /Users/runner/work/ruff/ruff/crates/ruff_text_size/src/range.rs:48:9:
assertion failed: start.raw &lt;= end.raw</p>
<p>The current Ruff version: 0.4.4.
The current Ruff settings:</p>
<pre><code>[build-system]
requires = [&quot;setuptools&quot;]
build-backend = &quot;setuptools.build_meta&quot;
[tool.pyright]
include = [&quot;foodie&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-15 02:38</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>Can you tell me exactly where you're typing the <code>def</code> and a space? Is it like below?</p>
<pre><code class="language-py">RANGE_DICT = {
    (&quot;NRF1_chr9_gap1_g0&quot;, 0): (32, 43),
    (&quot;NRF1_chr9_gap1_g0&quot;, 1): (62, 73),
}
def 
</code></pre>
<p>I'm not getting any panics if I type <code>def</code> and a space anywhere around this code.</p>
<p>Can you confirm that Neovim is using the correct <code>ruff</code> executable i.e., the one you mentioned the version for?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zhangzhen">@zhangzhen</a> on 2024-05-15 08:15</div>
            <div class="timeline-body"><blockquote>
<p>Can you confirm that Neovim is using the correct <code>ruff</code> executable i.e., the one you mentioned the version for?</p>
</blockquote>
<p>yes, it is 0.4.4</p>
<blockquote>
<p>Can you tell me exactly where you're typing the def and a space? Is it like below?</p>
</blockquote>
<p>yes. In any line after the global variable definition, the error occurs. here is the screenshot:
<img width="1058" alt="image" src="https://github.com/astral-sh/ruff/assets/782824/5bfd9c99-314b-443d-b7df-939cbe77e753"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-15 08:28</div>
            <div class="timeline-body"><p>Sorry but I'm unable to reproduce this with the snippet above.</p>
<blockquote>
<p>yes, it is 0.4.4</p>
</blockquote>
<p>Can you provide the steps you took to get this value? I'm specifically referring to the Ruff version <code>ruff-lsp</code> is using. You can get this by following the steps below:</p>
<ol>
<li>Set the LSP log level to INFO with: <code>:lua vim.lsp.set_log_level(vim.lsp.log_levels.INFO)</code></li>
<li>Write the function to reproduce the panic</li>
<li>Open the LSP logs with <code>:LspLog</code> command</li>
<li>Look for a message like <code>Found ruff 0.4.3 at /Users/dhruv/.local/bin/ruff</code></li>
</ol>
<p>Can you confirm the Ruff version with this steps? If you face any problem, you can connect withe me on Discord (username: dhruvmanila) and we can diagnose the issue :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zhangzhen">@zhangzhen</a> on 2024-05-16 00:50</div>
            <div class="timeline-body"><blockquote>
<p>Can you confirm the Ruff version with this steps?</p>
</blockquote>
<p>Found ruff 0.4.0 at /Users/zhangzhen/.local/share/nvim/mason/packages/ruff-lsp/venv/bin/ruff
The Ruff version is 0.4.0 not 0.4.4.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-16 01:20</div>
            <div class="timeline-body"><p>Ah ok. Can you upgrade the <code>ruff</code> version installed in that environment? I believe this was fixed in a prior release as @dhruvmanila mentioned.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-05-16 03:17</div>
            <div class="timeline-body"><p>Yes, this was fixed in <code>0.4.1</code> via https://github.com/astral-sh/ruff/pull/11032. Can you try it after upgrading Ruff to <code>0.4.1</code> or later?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-16 12:14</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:13 UTC
    </footer>
</body>
</html>
