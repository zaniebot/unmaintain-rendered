<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP032: Don't suggest f-string inside logging statements - astral-sh/ruff #13916</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP032: Don&#x27;t suggest f-string inside logging statements</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13916">#13916</a>
        opened by <a href="https://github.com/rpdelaney">@rpdelaney</a>
        on 2024-10-24 17:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rpdelaney">@rpdelaney</a></div>
            <div class="timeline-body">

<p>Keywords: UP302, G004</p>
<pre><code>$ ruff --version
ruff 0.6.9
</code></pre>
<p>Consider this statement. <a href="https://docs.astral.sh/ruff/rules/f-string/">UP032</a> objects to the use of <code>str.format</code> here:</p>
<pre><code>logger.info(&quot;Result received: {}&quot;.format(result))
</code></pre>
<p>Following its suggestion to use an f-string instead, one might try this:</p>
<pre><code>logger.info(f&quot;Result received: {result}&quot;)
</code></pre>
<p>However, the recommendation to use an f-string is inappropriate, as this code now throws <a href="https://docs.astral.sh/ruff/rules/logging-f-string/">G004</a>.</p>
<p>Better is:</p>
<pre><code>logger.info(&quot;Result received: %s&quot;, result)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 06:31</div>
            <div class="timeline-body"><p>Ruff should suggest you two violations for your code example if you have both UP032 and G001 enabled (<a href="https://play.ruff.rs/3cb1e0a7-44fa-445f-90f7-38c4f0ed3de4">playground</a>)</p>
<pre><code>logger.info(&quot;Result received: {}&quot;.format(result))
</code></pre>
<ol>
<li>that the there&#x27;s a <code>str.format</code> call in a logging call and 2. that the string could be replaced with an f-string</li>
</ol>
<p>I do see how, ideally, Ruff would only flag 1. because fixing 1. also address 2. However, it introduces some complexity. E.g should 2. be raised if the user suppressed 1. with a <code>noqa</code> comment? That&#x27;s why we avoid adding rule logic rely on other rules, in addition to that doing so increases the complexity of rule implementations (and that makes ruff slower).</p>
<p>That G004 flags the f-string is correct and consistent to the behavior with UP032 and G001.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rpdelaney">@rpdelaney</a> on 2024-10-25 15:10</div>
            <div class="timeline-body"><blockquote>
<p>That G004 flags the f-string is correct</p>
</blockquote>
<p>Fully agree.</p>
<p>As a user, I want the linter to give me the shortest path to resolution. Resolving the UP032 finding by following ruff&#x27;s suggestion, only to get another finding, is not ideal.</p>
<p>Perhaps it would be enough if UP032 checks for a logging context, and if found, offers the solution from G004 instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-25 15:20</div>
            <div class="timeline-body"><blockquote>
<p>Perhaps it would be enough if UP032 checks for a logging context, and if found, offers the solution from G004 instead?</p>
</blockquote>
<p>That would be possible but we prefer to avoid it because rules then become very interdependent. E.g. it should only do so when <code>G004</code> is enabled, otherwise you still want to see the errors.</p>
<p>I would have to look at the fixability of those rules but <code>ruff check --fix</code> iterates until there are no new fixable violations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-26 08:27</div>
            <div class="timeline-body"><p>Maybe I&#x27;m overly strict here. @AlexWaygood what&#x27;s your take on whether we should make <code>UP032</code> logger aware (but only if <code>G004</code> is enabled?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rpdelaney">@rpdelaney</a> on 2024-10-26 22:01</div>
            <div class="timeline-body"><blockquote>
<p>but only if G004 is enabled?</p>
</blockquote>
<p>I am nearing the limits of my knowledge, and therefore, my confidence. That said, I&#x27;ll provide an opposing argument for your consideration. The current behavior is that UP032 recommends an f-string in this case: a recommendation that is categorically wrong. Although the user might not have selected G004, that doesn&#x27;t support giving <em>wrong</em> advice about how to resolve UP032.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-27 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-27 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-10-27 08:27</div>
            <div class="timeline-body"><p>I looked at how we detect logging calls, and the implementation is prone to false positives because of Ruff&#x27;s lack of multifile analysis (we&#x27;re working on it). Ignoring <code>UP032</code> in logging statements would also disable the rule for some call sites where it isn&#x27;t an actual logging call. This is less of a problem for <code>G004</code> because you would notice that it isn&#x27;t a logging call and add a <code>noqa</code>. However, you would then want the linter to raise <code>G004</code> because this string should now be rewritten as an f-string.</p>
<blockquote>
<p>Although the user might not have selected G004, that doesn&#x27;t support giving wrong advice about how to resolve UP032.</p>
</blockquote>
<p>A user that disabled <code>G004</code> and enabled <code>UP032</code> decided that string formatting in logging calls is okay for them. Whatever the reasons. But they do care that al code uses f-string formatting. I would be surprised if my linter didn&#x27;t flag <code>UP032</code> in this case because using an f-string is the &quot;correct&quot; fix given my preference.</p>
<p>Either way, I think the current behavior isn&#x27;t unreasonable, and suppressing the error would lead to too many false negatives because our &quot;is logging call&quot; method has a fair number of false positives. I&#x27;ll wait to hear @AlexWaygood thoughts but I&#x27;m for closing this issue given these considerations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdulcet">@tdulcet</a> on 2025-01-12 21:36</div>
            <div class="timeline-body"><p>Maybe another solution to this would be to add an autofix for the G001, G002 and G004 rules. This would effectively perform the reverse of pyupgrade and convert the printf, <code>str.format</code> and f-string syntax to use the logger&#x27;s builtin formatter, which is of course just the printf style without the <code>%</code> operator. That would be compatible with the UP031 and UP032 rules, and it should not matter what order the autofixes were performed, as it would eventually produce the same result and resolve all of the lint errors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rpdelaney">@rpdelaney</a> on 2025-02-17 18:43</div>
            <div class="timeline-body"><p>I find the responses from Micha are reasonable and persuasive, so I&#x27;m withdrawing this feature request. If anyone else wants to re-open discussion they can create another issue, discussion thread, or whatever is appropriate at that time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/rpdelaney">@rpdelaney</a> on 2025-02-17 18:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:59 UTC
    </footer>
</body>
</html>
