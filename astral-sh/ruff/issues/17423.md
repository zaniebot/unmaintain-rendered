```yaml
number: 17423
title: Allow to define comments (or arbitrary code) that act as barriers for code changes
type: issue
state: closed
author: vnmabus
labels:
  - configuration
  - suppression
assignees: []
created_at: 2025-04-16T10:30:31Z
updated_at: 2025-04-27T07:24:11Z
url: https://github.com/astral-sh/ruff/issues/17423
synced_at: 2026-01-10T01:56:56Z
```

# Allow to define comments (or arbitrary code) that act as barriers for code changes

---

_Issue opened by @vnmabus on 2025-04-16 10:30_

Some comments, like `sphinx_gallery_start_ignore` and `sphinx_gallery_end_ignore` design separate code "areas". It is in general incorrect to move code across these areas, as the semantics will change (in particular, code in between will not appear in the generated documentation).

In my case I have imports above and below the comments, but Ruff is suggesting to me that I should "organize imports", moving them across that boundary.

Would it be possible to add a new setting that allows to configure comments, or maybe arbitrary lines of code, that prevent Ruff from trying to move code across them?

---

_Label `suppression` added by @ntBre on 2025-04-16 13:40_

---

_Label `configuration` added by @ntBre on 2025-04-16 13:51_

---

_Comment by @ntBre on 2025-04-16 13:54_

This sounds at least somewhat related to #3711, with the addition of custom start and end comments, at least in the block formulation. A single-line barrier would be a little different.

---

_Comment by @vnmabus on 2025-04-16 13:58_

It is not really the same, as I want Ruff to check all code, including the one inside the `sphinx_gallery_*_ignore` block. I just do not want that Ruff suggest a change that affects lines at both sides of the "barrier".

---

_Comment by @ntBre on 2025-04-16 13:59_

Ah I see, thanks for the clarification!

---

_Comment by @MichaReiser on 2025-04-23 06:23_

I think we'd have to implement this rule by rule. Most rules shouldn't be impacted by this but it's hard to tell. E.g. even something as simple as a "rename" refactor could make changes across those boundaries. That's why I'm not sure this is feasible. 

For isort specifically, would using `isort: split` action comments to mark the boundary be an option for you? https://pycqa.github.io/isort/docs/configuration/action_comments.html

---

_Comment by @vnmabus on 2025-04-23 06:31_

Actually, I think so. I didn't know about that option. Does Ruff support all isort directives?

---

_Comment by @MichaReiser on 2025-04-23 06:35_

Ruff supports most isort comments, see https://docs.astral.sh/ruff/linter/#action-comments

---

_Comment by @vnmabus on 2025-04-26 21:20_

So, for my part you can close, as I think `isort: split` covers my current needs. If I notice other case in which it is not enough I can reopen this issue.

---

_Closed by @MichaReiser on 2025-04-27 07:24_

---
