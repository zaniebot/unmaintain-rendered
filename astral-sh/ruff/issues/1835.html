<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--format=github` inline annotations don't work when running in a subdirectory - astral-sh/ruff #1835</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>--format=github</code> inline annotations don't work when running in a subdirectory</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1835">#1835</a>
        opened by <a href="https://github.com/jbbakst">@jbbakst</a>
        on 2023-01-12 22:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jbbakst">@jbbakst</a> on 2023-01-12 22:14</div>
            <div class="timeline-body"><p>Issue:
I have a multi-language monorepo with a Github Action to lint on <code>pull_request</code>. Since ruff is running inside a subdirectory, Github doesn't properly resolve file names to display inline annotations.</p>
<p>Potential fix:
Update file names in output to be absolute instead of relative paths</p>
<p><code>ruff --version</code>
0.0.219</p>
<p>Repro:</p>
<pre><code>name: CI
on: push
jobs:
  build:
    runs-on: ubuntu-latest

    defaults:
        run:
            working-directory: subdir

    steps:
      - uses: actions/checkout@v3
      - name: Install Python
        uses: actions/setup-python@v4
        with:
          python-version: &quot;3.11&quot;
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ruff
      # Include `--format=github` to enable automatic inline annotations.
      - name: Run Ruff
        run: ruff --format=github .
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-12 22:36</div>
            <div class="timeline-body"><p>Yeah we can probably always use absolute paths for <code>--format=github</code>. In the meantime, you might be able to invoke Ruff from outside the subdirectory? We don't rely on the current working directory to pick up configuration, so <code>ruff subdir</code> should be identical to what you have above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-01-12 22:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-12 22:36</div>
            <div class="timeline-body"><p>But, I can change this pretty easily.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-12 22:37</div>
            <div class="timeline-body"><p>Actually, I'm not really familiar -- does GitHub respect absolute paths? What does the path even look like on Actions? :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jbbakst">@jbbakst</a> on 2023-01-12 22:42</div>
            <div class="timeline-body"><p>Yeah I think it should respect absolute paths â€” ESLint outputs absolute paths and the inline annotations work out of the box, even in a subdirectory.</p>
<p>Re: running outside the subdirectory, in my actual setup I'm using poetry to ensure that package versions are the same in CI as they are in my dev environment, so this gets a bit tricky since my <code>pyproject.toml</code> and <code>poetry.lock</code> files are both located in the subdirectory. I guess for now I could just relax that requirement, install ruff directly (risking some version drift), and run it from outside the subdirectory while I wait for an update :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jbbakst">@jbbakst</a> on 2023-01-12 22:47</div>
            <div class="timeline-body"><blockquote>
<p>What does the path even look like on Actions?</p>
</blockquote>
<p>Just ran the following action:</p>
<pre><code>name: pwd

on:
    - push

jobs:
    pwd:
        name: pwd
        runs-on: ubuntu-latest
        steps:
            - run: pwd
</code></pre>
<p>And got this (replace <code>&lt;repo-name&gt;</code> with the name of the repo):
<code>/home/runner/work/&lt;repo-name&gt;/&lt;repo-name&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-12 22:50</div>
            <div class="timeline-body"><p>Ok cool. Regardless, I'll fix this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-12 22:50</div>
            <div class="timeline-body"><p>(Thanks for trying that.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-12 22:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jbbakst">@jbbakst</a> on 2023-01-12 22:57</div>
            <div class="timeline-body"><p>Amazing, thank you! ðŸ™Œ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-12 23:01</div>
            <div class="timeline-body"><p>No prob! This will go out in v0.0.220 which will be kicked off in a sec (so should be available within, IDK, an hour or so?).</p>
<p>I don't personally use Ruff within GitHub Actions right now just given where I'm spending my time (lots of Rust!), so definitely appreciate feedback on this kind of stuff! And of course, if this fix doesn't work for you or as intended, just LMK.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/levrik">@levrik</a> on 2023-10-09 14:26</div>
            <div class="timeline-body"><p>~Mhh. Absolute paths don't seem to work. I manually echoed examples with absolute and with relative path and only the relative one worked.~</p>
<p>Seems to be related to my specific setup of running Ruff inside Docker instead of on the host system directly. This obviously yields different absolute paths which GitHub isn't able to map. Relative paths are working fine in this case.</p>
<p>I wonder if Ruff could switch to relative paths if <code>GITHUB_ACTIONS</code> env var isn't available and output absolute ones if it's not?
In the end paths must be absolute on the GitHub Actions host system or relative to <code>GITHUB_WORKSPACE</code> env var. Maybe this could also be used. If <code>GITHUB_WORKSPACE</code> is available make paths relative to this directory, if not simply output relative paths from working directory as a best guess.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:28:51 UTC
    </footer>
</body>
</html>
