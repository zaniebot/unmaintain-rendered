<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Panic] - Error Encountered - astral-sh/ruff #22350</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Panic] - Error Encountered</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22350">#22350</a>
        opened by <a href="https://github.com/orrdjoshua">@orrdjoshua</a>
        on 2026-01-03 03:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/orrdjoshua">@orrdjoshua</a> on 2026-01-03 03:04</div>
            <div class="timeline-body"><p>Got this error:</p>
<pre><code>error: Ruff crashed. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BPanic%5D

...quoting the executed command, along with the relevant file contents and `pyproject.toml` settings, we'd be very appreciative!


thread 'main' panicked at /root/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/rayon-core-1.12.1/src/registry.rs:168:10:
The global thread pool has not been initialized.: ThreadPoolBuildError { kind: IOError(Os { code: 11, kind: WouldBlock, message: &quot;Resource temporarily unavailable&quot; }) }
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>I did not capture what command exactly was being run, as it was running within an automated coding platform, but it should have been executed from this source, the directory/path for the file to be linted was dynamically determined:</p>
<pre><code class="language-py">    if file_type == &quot;python&quot;:
        try:
            try:
                cmd = [&quot;ruff&quot;, &quot;check&quot;, abs_path, &quot;--fix&quot;]
                result = subprocess.run(cmd, capture_output=True, text=True, timeout=20)
                linter_type = &quot;ruff&quot;
            except Exception:
                cmd = [&quot;flake8&quot;, abs_path, &quot;--max-line-length=120&quot;]
                result = subprocess.run(cmd, capture_output=True, text=True, timeout=20)
                linter_type = &quot;flake8&quot;
            output = (result.stdout or &quot;&quot;) + (&quot;\n&quot; + result.stderr if result.stderr else &quot;&quot;)
            success = result.returncode == 0
</code></pre>
<p>The real curiosity is that really this seemed to have occurred at a deeper level because of some strange unknown issue/crash within Git itself in this repository while we were operating the system.  Not sure what happened, but I was getting some random git errors simultaneously with this (pretty large repo).</p>
<p>Anyway, just following directions by sending this in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-04 00:57</div>
            <div class="timeline-body"><p>Thanks for the report!</p>
<p>This is interesting. Assuming the response <a href="https://github.com/rayon-rs/rayon/issues/579">here</a> is still relevant, I think this was caused by the OS failing to create a thread. I found a couple of other potentially related issues, including one from uv:</p>
<ul>
<li>https://github.com/rayon-rs/rayon/issues/694</li>
<li>https://github.com/astral-sh/uv/issues/14462</li>
</ul>
<p>You could try setting the <code>RAYON_NUM_THREADS</code> environment variable to a smaller number than the number of cores, which is the default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2026-01-04 00:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-04 01:10</div>
            <div class="timeline-body"><p>Probably not too much help, but I can at least reproduce a similar panic with a command like:</p>
<pre><code class="language-shell">‚ùØ (ulimit -u 16; ruff check crates/ruff_linter/resources/test/cpython)

error: Ruff crashed. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BPanic%5D

...quoting the executed command, along with the relevant file contents and `pyproject.toml` settings, we'd be very appreciative!


thread 'main' (2362097) panicked at /usr/src/debug/rust/rustc-1.92.0-src/library/std/src/thread/scoped.rs:199:46:
failed to spawn thread: Os { code: 11, kind: WouldBlock, message: &quot;Resource temporarily unavailable&quot; }
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @MichaReiser on 2026-01-04 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2026-01-04 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-04 17:47</div>
            <div class="timeline-body"><p>Can you say more about your environment? E.g. did you set a thread or open file limit? Is this error reproducible or only happens occasionally?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/orrdjoshua">@orrdjoshua</a> on 2026-01-05 19:26</div>
            <div class="timeline-body"><p>@MichaReiser  I'm not a very experienced person, so I'm not sure exactly how to answer, but I can say that:</p>
<ol>
<li>I run the server on WSL2 in windows 11 via WSL plugin of vscode</li>
<li>The program is a fastAPI server running async python code</li>
<li>receiving the Ruff error didn't crash or hang the server (error was captured in the code branch and saved as output from the &quot;linter attempt&quot; branch in my system)</li>
<li>not sure if I hit any &quot;thread&quot; limits but did not hit any open file limits in vscode.  If your talking about async threadpool or coroutine limits, I don't think I hit any of those in the server as I was just running one copy of it locally and not doing anything particularly excessive, also the error continued to occur over time during variety of use.</li>
<li>I have not been able to reproduce the error</li>
<li>I did not call ruff directly myself in bash but was using subprocess.run within a module for auto-linting files after code patches had been auto-applied from an LLM-provided-response.  The whole system is deeply automated (think &quot;codex&quot; but homebuilt and running locally)</li>
</ol>
<p>Took me a while to notice that the linter was failing with this error, and restarting the fastAPI server did not resolve the issue, and it happened consistently during the situation (i.e. probably dozens of times over hours of automation).  It never worked again until I restarted IDE (vscode) itself.  I THINK that's what solved it.  Possibly it didn't work again until I actually restarted the computer, but I think restarting vscode worked.</p>
<p>I was getting lots of EAGAIN error pop-ups within vscode for GIT.  These were coming up because of automated commit commands occurring in worktrees or background git tasks from using source control in vscode.</p>
<p>My guess is that there was some kind of issue with the connection between WSL/bash server/Windows environment...  Likely due to leaving the fastAPI server running and the WSL port in vscode connected over probably 24 hours and multiple computer sleep/hibernate cycles...</p>
<p>but that doesn't really explain the ruff errors seemingly since that would have all been within the same process... strangely none of these errors prevented me from continuing my work for hours (except that I couldn't lint python files from within the system, but vscode linting extensions still worked), so after that got annoying enough I restarted vscode and the issue went away...  In over 6 months of use in the same environment I've never had this issue before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-07 09:34</div>
            <div class="timeline-body"><p>This sounds to me like your system run out of file handles or memory, so that the OS failed to spawn new threads. Which also explains why restarting your computer or restarting whatever program is responsible for the high resource usage resolved the issue. There isn't anything we can do here on the Ruff side other than catching the error more gracefully, but that would require upstream changes in rayon.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:38:54 UTC
    </footer>
</body>
</html>
