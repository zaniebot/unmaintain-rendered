<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keep single-line signatures when body is an Ellipsis (`...`) in `.py` files - astral-sh/ruff #10026</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Keep single-line signatures when body is an Ellipsis (<code>...</code>) in <code>.py</code> files</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10026">#10026</a>
        opened by <a href="https://github.com/etienneschalk">@etienneschalk</a>
        on 2024-02-18 13:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/etienneschalk">@etienneschalk</a></div>
            <div class="timeline-body">

A minimal code snippet that reproduces the bug.
<p>File name: <code>format_ruff.py</code></p>
<p>Before ruff:</p>
<pre><code>class MyClass:
    def __add__(self, other: int) -&gt; int: ...
</code></pre>
<p>After ruff:</p>
<pre><code>class MyClass:
    def __add__(self, other: int) -&gt; int:
        ...
</code></pre>
The command you invoked
<pre><code>ruff format format_ruff.py 
</code></pre>
<p>Note: in real-life scenario, one might have installed the Ruff extension on VSCode, opened a file with many stubs like in the minimal code snippet, and see them all formatted, introducing unwanted code change, which can be annoying for version control.</p>
<p>This might also slow down ruff adoption in existing large code bases where the case mentioned above happens a lot.</p>
The current Ruff settings
<p>No overriden settings. I ran a <code>pip install ruff</code> then ran the command above</p>
The current Ruff version
<pre><code>ruff --version
ruff 0.2.2
</code></pre>
What I would like
<p>A way to opt-out of de-inlining the Ellipsis (<code>...</code>) in stubs. I have searched in documentation without finding such an option. I browsed the following issues (in Links section).</p>
<p>An option could be:</p>
<pre><code>[tool.ruff.format]
keep-single-line-ellipsis = true
</code></pre>
Links
<p>Related Issues:</p>
<ul>
<li>https://github.com/astral-sh/ruff/issues/5822 -&gt; It seems the solution only applied to <code>.pyi</code> files, not <code>.py</code> ; I would like the option to be activable for all types of files.</li>
<li>https://github.com/psf/black/issues/1797 (referred to in the issue above)</li>
</ul>
<p>Related PRs:</p>
<ul>
<li>https://github.com/astral-sh/ruff/pull/6592 (exposes the same situation described in this issue! it seems to only apply to <code>.pyi</code> files, but maybe it could be generalized to <code>.py</code>?)</li>
<li>https://github.com/astral-sh/ruff/pull/6501</li>
</ul>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-18 15:50</div>
            <div class="timeline-body"><p>Thanks for the excellent writeup! We&#x27;ve implemented your desired behavior but it&#x27;s currently only applied when you format your code with <code>--preview</code> mode enabled as you can see here https://play.ruff.rs/6cc50dba-b5ae-4dea-9f58-14b179932e65.</p>
<p>We hope to promote the new formatting to stable in this month, but you can already start using it if you enable <code>ruff.format.preview = true</code> or call <code>ruff format --preview</code></p>
<p>Let me know if that works for you</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/etienneschalk">@etienneschalk</a> on 2024-02-18 16:35</div>
            <div class="timeline-body"><p>Hello, thanks for you answer!</p>
<p>I ran a <code>pre-commit run --all</code> after enabling the <code>preview</code> flag in <code>pyproject.toml</code>:</p>
<pre><code>[tool.ruff.format]
preview = true
</code></pre>
<p>It puts back the Ellipses back on their single line :+1:</p>
<p>However, it also brings new changes, mainly compressing multiple braces in a javascript formatting style.</p>
<p>Excerpt from the xarray repo:</p>
<pre><code>-        self.ds = Dataset(
-            {
-                &quot;a&quot;: ((&quot;x&quot;, &quot;y&quot;), np.ones((300, 400))),
-                &quot;b&quot;: ((&quot;x&quot;, &quot;y&quot;), np.ones((300, 400))),
-            }
-        )
+        self.ds = Dataset({
+            &quot;a&quot;: ((&quot;x&quot;, &quot;y&quot;), np.ones((300, 400))),
+            &quot;b&quot;: ((&quot;x&quot;, &quot;y&quot;), np.ones((300, 400))),
+        })
</code></pre>
<p>Even though I personally like this new formatting (it looks like javascript formatting, is more concise, and saves  a level of indentation), I would still like to get more granularity inside of the <code>preview</code> flag, to choose which features to opt-in (orthogonal configuration), reducing code diff at the same time in a migration context.</p>
<p>According to the <a href="https://docs.astral.sh/ruff/preview/#enabling-preview-mode">documentation of Preview</a> we can select rules for the linter with <code>explicit-preview-rules = true</code>, however I cannot find an equivalent for the formatter. Is there a &quot;formatting rule&quot; concept, equivalent to the &quot;linting rules&quot;, that would enable me to opt-in only the Ellipsis formatting rule?</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-18 16:55</div>
            <div class="timeline-body"><p>That makes sense. There&#x27;s no such granular opt-in to preview formatting. It&#x27;s all or nothing, similar to the formatter itself which only provides very few configuration nobs.</p>
<p>For preview, this is especially important because it ensures that users give feedback to all preview styles and don&#x27;t just disable the styles they don&#x27;t like. It prevents situations where all users disabled a controversial style change but we decide releasing it because we never received any negative feedback on the style.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/etienneschalk">@etienneschalk</a> on 2024-02-18 17:03</div>
            <div class="timeline-body"><p>Okay, I fully understand the point of having a single preview style!</p>
<p>Thanks a lot for the help on that topic!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-18 17:10</div>
            <div class="timeline-body"><p>I&#x27;ll close this issue. You can follow <a href="https://github.com/astral-sh/ruff/issues/8678">astral-sh/ruff#8678</a> to get notified when we promote the new preview styles (The style you&#x27;re calling out won&#x27;t be promoted)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-18 17:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:50 UTC
    </footer>
</body>
</html>
