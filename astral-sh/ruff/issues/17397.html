<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff check --select I --fix` messes up redundant import aliases - astral-sh/ruff #17397</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`ruff check --select I --fix` messes up redundant import aliases</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17397">#17397</a>
        opened by <a href="https://github.com/pekkaklarck">@pekkaklarck</a>
        on 2025-04-14 19:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pekkaklarck">@pekkaklarck</a> on 2025-04-14 19:40</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>We have started to use redundant import aliases like <code>from mod import Class as Class</code> when defining public module and package APIs. For example, <a href="https://github.com/robotframework/robotframework/blob/master/src/robot/api/parsing.py#L488">this module</a> has code like this:</p>
<pre><code class="language-python">from robot.parsing import (
    get_tokens as get_tokens,
    get_resource_tokens as get_resource_tokens,
    get_init_tokens as get_init_tokens,
    get_model as get_model,
    get_resource_model as get_resource_model,
    get_init_model as get_init_model,
    Token as Token,
)
from robot.parsing.model.blocks import (
    File as File,
    SettingSection as SettingSection,
    VariableSection as VariableSection,
    TestCaseSection as TestCaseSection,
    KeywordSection as KeywordSection,
    CommentSection as CommentSection,
    TestCase as TestCase,
    Keyword as Keyword,
    If as If,
    Try as Try,
    For as For,
    While as While,
    Group as Group,
)
</code></pre>
<p>We are experimenting with automatic code formatting, including automatically sorting imports. My understanding is that with Ruff the command to use if <code>ruff check --select I --fix</code>. When I use that command to format the above code, I get this:</p>
<pre><code class="language-python">from robot.parsing import (
    Token as Token,
)
from robot.parsing import (
    get_init_model as get_init_model,
)
from robot.parsing import (
    get_init_tokens as get_init_tokens,
)
from robot.parsing import (
    get_model as get_model,
)
from robot.parsing import (
    get_resource_model as get_resource_model,
)
from robot.parsing import (
    get_resource_tokens as get_resource_tokens,
)
from robot.parsing import (
    get_tokens as get_tokens,
)
from robot.parsing.model.blocks import (
    CommentSection as CommentSection,
)
from robot.parsing.model.blocks import (
    File as File,
)
from robot.parsing.model.blocks import (
    For as For,
)
from robot.parsing.model.blocks import (
    Group as Group,
)
from robot.parsing.model.blocks import (
    If as If,
)
from robot.parsing.model.blocks import (
    Keyword as Keyword,
)
from robot.parsing.model.blocks import (
    KeywordSection as KeywordSection,
)
from robot.parsing.model.blocks import (
    SettingSection as SettingSection,
)
from robot.parsing.model.blocks import (
    TestCase as TestCase,
)
from robot.parsing.model.blocks import (
    TestCaseSection as TestCaseSection,
)
from robot.parsing.model.blocks import (
    Try as Try,
)
from robot.parsing.model.blocks import (
    VariableSection as VariableSection,
)
from robot.parsing.model.blocks import (
    While as While,
)
</code></pre>
<p>Although imports now are sorted, I consider the end result horrible. I consider this a bug, but if this is intentional, I propose a style change. In my opinion the original format is good except for ordering.</p>
<h3>Version</h3>
<p>ruff 0.11.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pekkaklarck">@pekkaklarck</a> on 2025-04-14 19:44</div>
            <div class="timeline-body"><p>As a reference, below is the code that isort produces with default settings. I don't like that either, but it isn't as bad as the above.</p>
<pre><code class="language-python">from robot.parsing import Token as Token
from robot.parsing import get_init_model as get_init_model
from robot.parsing import get_init_tokens as get_init_tokens
from robot.parsing import get_model as get_model
from robot.parsing import get_resource_model as get_resource_model
from robot.parsing import get_resource_tokens as get_resource_tokens
from robot.parsing import get_tokens as get_tokens
from robot.parsing.model.blocks import CommentSection as CommentSection
from robot.parsing.model.blocks import File as File
from robot.parsing.model.blocks import For as For
from robot.parsing.model.blocks import Group as Group
from robot.parsing.model.blocks import If as If
from robot.parsing.model.blocks import Keyword as Keyword
from robot.parsing.model.blocks import KeywordSection as KeywordSection
from robot.parsing.model.blocks import SettingSection as SettingSection
from robot.parsing.model.blocks import TestCase as TestCase
from robot.parsing.model.blocks import TestCaseSection as TestCaseSection
from robot.parsing.model.blocks import Try as Try
from robot.parsing.model.blocks import VariableSection as VariableSection
from robot.parsing.model.blocks import While as While
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-14 20:23</div>
            <div class="timeline-body"><p>This looks like a duplicate of #16399. As stated in this comment (https://github.com/astral-sh/ruff/issues/16399#issuecomment-2685560342):</p>
<blockquote>
<p>It is due to the last item ending with a trailing comma (see https://docs.astral.sh/ruff/settings/#lint_isort_split-on-trailing-comma). You get the isort formatting if you remove the trailing comma.</p>
</blockquote>
<p>I tested this on your example, and I also get the desired isort output if I remove the trailing commas from both of the initial blocks. The other issue is still labeled as a bug, though, so this is something we want to fix!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-04-14 20:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pekkaklarck">@pekkaklarck</a> on 2025-04-14 20:58</div>
            <div class="timeline-body"><p>Yeah, this is dupe. I tried searching for similar issues but failed with generic terms like &quot;from import as&quot;.</p>
<p>Although the isort default format is much better than what Ruff now produces, it don't consider it &quot;desired&quot;. I'd much rather see Ruff producing the same format as the original and not splitting as-imports. Notice that isort makes this behavior <a href="https://pycqa.github.io/isort/docs/configuration/options.html#combine-as-imports">configurable</a> and apparently the <a href="https://github.com/PyCQA/isort/issues/1305#issuecomment-926369825">default will change in the next major release</a>. Using just <code>--combine-as</code> with isort doesn't yield good results, though, but <code>isort --combine-as --multi-line=5 --split-on-trailing-comma</code> produces output that's Black and Ruff compatible:</p>
<pre><code class="language-python">from robot.parsing import (
    Token as Token,
    get_init_model as get_init_model,
    get_init_tokens as get_init_tokens,
    get_model as get_model,
    get_resource_model as get_resource_model,
    get_resource_tokens as get_resource_tokens,
    get_tokens as get_tokens,
)
from robot.parsing.model.blocks import (
    CommentSection as CommentSection,
    File as File,
    For as For,
    Group as Group,
    If as If,
    Keyword as Keyword,
    KeywordSection as KeywordSection,
    SettingSection as SettingSection,
    TestCase as TestCase,
    TestCaseSection as TestCaseSection,
    Try as Try,
    VariableSection as VariableSection,
    While as While,
)
</code></pre>
<p>I believe the above should be the target for Ruff's import sorting. If you are open to this idea, I can submit a separate issue about the format change where this can be discussed more.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-14 21:22</div>
            <div class="timeline-body"><p>Oh, we also support isort's <a href="https://docs.astral.sh/ruff/settings/#lint_isort_combine-as-imports"><code>combine-as-imports</code></a> setting. If you enable that even with the trailing commas, we only sort your initial example within its existing sections:</p>
<pre><code class="language-shell">ruff check --select I --diff --config 'lint.isort.combine-as-imports=true'
</code></pre>
<p>Output:</p>
<pre><code class="language-diff">--- fmt.py
+++ fmt.py
@@ -1,24 +1,24 @@
 from robot.parsing import (
-    get_tokens as get_tokens,
-    get_resource_tokens as get_resource_tokens,
+    Token as Token,
+    get_init_model as get_init_model,
     get_init_tokens as get_init_tokens,
     get_model as get_model,
     get_resource_model as get_resource_model,
-    get_init_model as get_init_model,
-    Token as Token,
+    get_resource_tokens as get_resource_tokens,
+    get_tokens as get_tokens,
 )
 from robot.parsing.model.blocks import (
+    CommentSection as CommentSection,
     File as File,
+    For as For,
+    Group as Group,
+    If as If,
+    Keyword as Keyword,
+    KeywordSection as KeywordSection,
     SettingSection as SettingSection,
-    VariableSection as VariableSection,
+    TestCase as TestCase,
     TestCaseSection as TestCaseSection,
-    KeywordSection as KeywordSection,
-    CommentSection as CommentSection,
-    TestCase as TestCase,
-    Keyword as Keyword,
-    If as If,
     Try as Try,
-    For as For,
+    VariableSection as VariableSection,
     While as While,
-    Group as Group,
 )

Would fix 1 error.
</code></pre>
<p>Is that the behavior you'd expect? Maybe I should comment this on the original issue too, if so.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pekkaklarck">@pekkaklarck</a> on 2025-04-14 21:47</div>
            <div class="timeline-body"><p>That looks excellent! I actually didn't know that <code>ruff check --fix</code> supports configuration, I thought it's &quot;opinionated&quot; like other formatters seem to be. Happy to be wrong! I'm all for sensible defaults, but often <em>some</em> configuration helps.</p>
<p>Talking about sensible defaults, I still believe the defaults for as-import handling should be changed. It's odd that</p>
<pre><code class="language-python">from module import (
    First,
    Second,
)
</code></pre>
<p>is accepted as-is, but</p>
<pre><code class="language-python">from module import (
    First as First,
    Second as Second,
)
</code></pre>
<p>is not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-15 01:25</div>
            <div class="timeline-body"><p>The formatter is pretty opinionated, but the <code>isort</code> rules are somewhat counter-intuitively in the linter, which is more configurable.</p>
<p>I think you may be right about the default value, especially if <code>isort</code> is changing theirs. I'll summarize this discussion in the other issue (unless you'd like to), and then maybe we can discuss the default there too.</p>
<p>Thanks again for the report and the <code>isort</code> links!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/16399.html">astral-sh/ruff#16399</a> on 2025-04-15 13:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:17 UTC
    </footer>
</body>
</html>
