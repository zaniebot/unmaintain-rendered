<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`wasm-pack build` doesn't support the new crate structure - astral-sh/ruff #1860</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>wasm-pack build</code> doesn&#x27;t support the new crate structure</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1860">#1860</a>
        opened by <a href="https://github.com/not-my-profile">@not-my-profile</a>
        on 2023-01-14 03:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/not-my-profile">@not-my-profile</a></div>
            <div class="timeline-body"><p>The new structure introduced in #1816 is now unfortunately causing the &quot;[Playground] Release&quot; workflow to fail. This is because the <code>wasm-pack build --target web --out-dir playground/src/pkg</code> command defined in <code>playground.yaml</code> is attempting to also build <code>ruff_cli</code> (which no longer supports wasm).</p>
<p>The fix for that would be to append <code>-p ruff</code> to the command, so that the command only builds the <code>ruff</code> crate ... only that <code>wasm-pack build</code> apparently doesn&#x27;t support that yet for our a bit unconventional structure of having the <code>src</code> in the top-level directory as opposed to <code>ruff/src</code>. I just reported this to wasm-pack as <a href="https://github.com/rustwasm/wasm-pack/issues/1211">rustwasm/wasm-pack#1211</a> ... I&#x27;ll try to see if I can contribute a fix there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-14 03:20</div>
            <div class="timeline-body"><p>Thanks, let me know if I can be helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-14 03:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/not-my-profile">@not-my-profile</a> on 2023-01-14 08:21</div>
            <div class="timeline-body"><p>While it did take me another commit to actually fix the playground CI 7b1ce72f862f0967df1924c583288ccc8b7cb81c and wasm-pack does in fact support our crate structure and I was wrong to assume that wasm-pack had such a limitation, looking further into it not only was the initial <code>wasm-pack</code> error  message very confusing but the  <code>wasm-pack build</code> CLI is apparently quite poorly designed with an optional positional argument that suddenly becomes required when you want to pass options to <code>cargo</code> ... and even worse <code>wasm-pack build</code> and <code>wasm-pack test</code> treat the same arguments differently ... I reported this as <a href="https://github.com/rustwasm/wasm-pack/issues/1213">rustwasm/wasm-pack#1213</a> ... I would contribute a fix to wasm-pack but their tests are failing on master and I am not interested in debugging that.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:30 UTC
    </footer>
</body>
</html>
