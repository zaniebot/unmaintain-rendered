<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`single-item-membership-test` (FURB171) should be marked unsafe - astral-sh/ruff #20255</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>single-item-membership-test</code> (FURB171) should be marked unsafe</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20255">#20255</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2025-09-04 20:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p><a href="https://docs.astral.sh/ruff/rules/single-item-membership-test/"><code>single-item-membership-test</code> (FURB171)</a> can change behavior in two ways. First, <code>in</code> tries both <code>is</code> and <code>==</code>, whereas the fix is just <code>==</code>, which changes behavior for values like NaN. There is no way to know in general which values it is safe for, although it would be possible for this rule to safely special-case certain expressions like <code>str</code> and number literals. Second, <code>in</code> returns a <code>bool</code> whereas <code>==</code> can return anything. The current fix is only safe in boolean contexts like a <code>bool</code> argument or an <code>if</code> condition. Otherwise, the fix should be marked unsafe or the fix should wrap the expression in a <code>bool</code> call (or use the <code>not</code> operator, in the negated case). <a href="https://play.ruff.rs/764834c7-4ee1-4126-b270-9ce50dc5f014">Example</a>:</p>
<pre><code class="language-console">$ cat &gt;furb171.py &lt;&lt;'# EOF'
import numpy as np
print(np.nan in [np.nan])
print(np.zeros(1) in [np.zeros(1)])
# EOF

$ python furb171.py
True
True

$ ruff --isolated check furb171.py --select FURB171 --preview --fix
Found 2 errors (2 fixed, 0 remaining).

$ cat furb171.py
import numpy as np
print(np.nan == np.nan)
print(np.zeros(1) == np.zeros(1))

$ python furb171.py
False
[ True]
</code></pre>
<p>When the container is a string literal and the fix is currently marked safe, thatâ€™s fine. This is only an issue for <code>list</code>, <code>tuple</code>, <code>set</code>, and <code>frozenset</code>.</p>
<h3>Version</h3>
<p>ruff 0.12.12 (c6516e9b6 2025-09-04)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @ntBre on 2025-09-04 23:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @ntBre on 2025-09-04 23:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TaKO8Ki">@TaKO8Ki</a> on 2025-09-05 11:12</div>
            <div class="timeline-body"><p>I will take this one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @TaKO8Ki by @ntBre on 2025-09-05 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-18 15:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:17 UTC
    </footer>
</body>
</html>
