<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F601: Repeated tuple keys with different values are not detected - astral-sh/ruff #5691</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F601: Repeated tuple keys with different values are not detected</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/5691">#5691</a>
        opened by <a href="https://github.com/MatthewHoadSWO">@MatthewHoadSWO</a>
        on 2023-07-11 16:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/MatthewHoadSWO">@MatthewHoadSWO</a></div>
            <div class="timeline-body">

<p>Duplicate tuple keys with different values in a dict are not detected. Not sure if <code>F601</code> is the correct rule to file this under since I&#x27;m unsure if tuples are technically literals. If not, then it would be really handy to have a rule for this. Flake8 seems to think that duplicate tuple keys fall under F601 though. Reproduced with ruff <code>0.0.269</code>, <code>0.0.273</code>, <code>0.0.275</code>, and <code>0.0.277</code>.</p>
<p>To reproduce:
Default ruff settings (no <code>pyproject.toml</code>)</p>
<pre><code>&gt;&gt;&gt; ruff --version
ruff 0.0.277
</code></pre>
<p><code>f601_sample.py</code> ðŸ‘‡</p>
<pre><code>my_dict = {
    (&#x27;a&#x27;, &#x27;b&#x27;): &#x27;asdf&#x27;,
    (&#x27;a&#x27;, &#x27;b&#x27;): &#x27;qwer&#x27;,
    &#x27;a&#x27;: &#x27;asdf&#x27;,
    &#x27;a&#x27;: &#x27;qwer&#x27;,
}
</code></pre>
<p>Ruff correctly detects the duplicated string literal key, but not the tuple key:</p>
<pre><code>&gt;&gt;&gt; ruff --isolated f601_sample.py
f601_sample.py:5:5: F601 Dictionary key literal `&#x27;a&#x27;` repeated
Found 1 error.
</code></pre>
<p>Flake8 detects both string and tuple key duplication:</p>
<pre><code>&gt;&gt;&gt; flake8 f601_sample.py 
f601_sample.py:2:5: F601 dictionary key (&#x27;a&#x27;, &#x27;b&#x27;) repeated with different values
f601_sample.py:3:5: F601 dictionary key (&#x27;a&#x27;, &#x27;b&#x27;) repeated with different values
f601_sample.py:4:5: F601 dictionary key &#x27;a&#x27; repeated with different values
f601_sample.py:5:5: F601 dictionary key &#x27;a&#x27; repeated with different values
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-11 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-11 16:27</div>
            <div class="timeline-body"><p>Yeah, this should be supported. For anyone interested, a new <code>DictionaryKey</code> type would be added <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff/src/rules/pyflakes/rules/repeated_keys.rs#L129">here</a> and the <code>match</code> expressions using this value would need to account for it <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff/src/rules/pyflakes/rules/repeated_keys.rs#L135">here</a> and <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff/src/rules/pyflakes/rules/repeated_keys.rs#L157">here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-11 16:32</div>
            <div class="timeline-body"><p>I wonder why we have a dedicated type there rather than just using ComparableExpr.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-07-11 16:59</div>
            <div class="timeline-body"><p>I haven&#x27;t looked into <code>ComparableExpr</code> much but I think as dictionary keys needs to be hashable we can&#x27;t consider all of <code>ComparableExpr</code> variants. Or, are you referring to something else?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-11 17:02</div>
            <div class="timeline-body"><p>I was suggesting just using ComparableExpr and removing DictionaryKey. If a key uses an unhashable Python type, like a set, thatâ€™s a problem regardless, right? But itâ€™s not a big deal, it just seems simpler and would also catch things like attribute accesses and subscript accesses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-12 03:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MatthewHoadSWO">@MatthewHoadSWO</a> on 2023-07-12 08:15</div>
            <div class="timeline-body"><p>Thanks @charliermarsh @dhruvmanila @qdegraaf for the speedy response and action!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:38 UTC
    </footer>
</body>
</html>
