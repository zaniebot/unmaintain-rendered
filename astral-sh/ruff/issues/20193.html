<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use loop variables or variables defined in a loop outside the loop - astral-sh/ruff #20193</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use loop variables or variables defined in a loop outside the loop</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/20193">#20193</a>
        opened by <a href="https://github.com/ShaiAvr">@ShaiAvr</a>
        on 2025-09-01 14:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ShaiAvr">@ShaiAvr</a> on 2025-09-01 14:13</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I recently got bitten by the accidental use of a loop variable outside the loop. For example, this code works since the loop's variable name still exists after the loop is over and holds the value from the last iteration:</p>
<pre><code class="language-python">for x in container:
    print(x)

print(x)  # I can still use the value from the last iteration, which is most likely a mistake.
</code></pre>
<p>Most of the time, code like that indicates an error or a mistake. If <code>container</code> is empty, for example, the loop won't run, and we'd get a <code>NameError</code> when trying to use the variable <code>x</code>. Even if we can guarantee that the loop runs and <code>x</code> will be valid after the loop, it's likely a logical error to use it. The same applies to other variables created inside a loop:</p>
<pre><code class="language-python">for x in container:
    y = manipulate(x)
    print(x, y)

print(y)  # Likely a mistake
</code></pre>
<p>I tried to enable the <code>ALL</code> rule of ruff, but it didn't catch these mistakes. I think a rule should be added to warn about such code. It could be legitimate to use this technique to capture the last value of a loop, but in most cases, such code indicates a mistake or logical error, and it should be avoided. For the cases where this behaviour is used intentionally, the user can always ignore the rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-01 14:49</div>
            <div class="timeline-body"><p>I think this would be a nice rule, I've been bitten by this before too. There's previous work in https://github.com/astral-sh/ruff/pull/11769, but there are some unresolved questions around balancing false positives and negatives. This kind of rule is pretty tricky to write in Ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-09-01 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-09-01 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-09-15 13:33</div>
            <div class="timeline-body"><p>ty can catch this kind of error if you enable <code>possibly-unbound-reference</code> (https://play.ty.dev/671c6094-729f-4d97-941e-f6c52ee3d236).</p>
<p>But it doesn't cover:</p>
<blockquote>
<p>Even if we can guarantee that the loop runs and x will be valid after the loop, it's likely a logical error to use it.</p>
</blockquote>
<p>which may justify a dedicated rule</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
