<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E203: Incompatible with formatter when closing `]` is on its own line - astral-sh/ruff #10973</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>E203: Incompatible with formatter when closing <code>]</code> is on its own line</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10973">#10973</a>
        opened by <a href="https://github.com/antolu">@antolu</a>
        on 2024-04-15 22:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/antolu">@antolu</a></div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
* A description of your environment (e.g., operating system, Python version, etc.).
-->

<p><strong>Ruff version</strong>: 0.1.7
<strong>OS</strong>: MacOS / ArchLinux / RHEL
<strong>Python</strong>: 3.11.5</p>
<p>I put both <code>ruff</code> and <code>ruff format</code> in my pre-commit hooks as follows:</p>
<pre><code>  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: &quot;v0.3.7&quot;
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
      - id: ruff-format
</code></pre>
<p>Ruff config</p>
<pre><code>
[tool.ruff]

exclude = [
    &quot;.bzr&quot;,
    &quot;.direnv&quot;,
    &quot;.eggs&quot;,
    &quot;.git&quot;,
    &quot;.hg&quot;,
    &quot;.mypy_cache&quot;,
    &quot;.nox&quot;,
    &quot;.pants.d&quot;,
    &quot;.pytype&quot;,
    &quot;.ruff_cache&quot;,
    &quot;.svn&quot;,
    &quot;.tox&quot;,
    &quot;.venv&quot;,
    &quot;__pypackages__&quot;,
    &quot;_build&quot;,
    &quot;buck-out&quot;,
    &quot;build&quot;,
    &quot;dist&quot;,
    &quot;node_modules&quot;,
    &quot;venv&quot;,
    &quot;.venv&quot;,
    &quot;transformertf/hysteresis&quot;
]

line-length = 88
target-version = &quot;py311&quot;

preview = true
unsafe-fixes = true

[tool.ruff.lint]
# All rules can be found here: https://docs.astral.sh/ruff/rules/
select = [
    &quot;F&quot;,   # pyflakes
    &quot;E&quot;,   # error  (pycodestyle)
    &quot;W&quot;,   # warning (pycodestyle)
    &quot;I&quot;,   # isort
    &quot;N&quot;,   # naming  (pep8)
    &quot;UP&quot;,  # pyupgrade
    &quot;PLC&quot;, # convention  (pylint)
    &quot;PLE&quot;, # error  (pylint)
    &quot;PLW&quot;, # warning  (pylint)
    # &quot;D&quot;,  # docstring (pydocstyle),  # not enabled by default
    &quot;PD&quot;,   # pandas
    &quot;TRY&quot;,  # tryceratops
    &quot;NPY&quot;,  # numpy
    &quot;PERF&quot;, # perflint
    &quot;RUF&quot;,  # ruff
    # v flake8 v
    &quot;B&quot;,
    &quot;C4&quot;,
    &quot;FBT&quot;,
    &quot;A&quot;,
    &quot;EM&quot;,
    &quot;ISC&quot;,
    &quot;FA&quot;,
    &quot;G&quot;,
    &quot;PIE&quot;,
    &quot;PYI&quot;,
    &quot;PT&quot;,
    &quot;Q&quot;,
    &quot;RSE&quot;,
    &quot;RET&quot;,
    &quot;SLF&quot;,
    &quot;SIM&quot;,
]
fixable = [&quot;ALL&quot;]
ignore = [&quot;E501&quot;, &quot;W505&quot;, &quot;ISC001&quot;, &quot;PD901&quot;, &quot;PLW2901&quot;, &quot;N812&quot;, &quot;N806&quot;, &quot;G004&quot;]

[tool.ruff.format]
preview = true
</code></pre>
<p>When running the hooks the <code>check --fix</code> seems to do something that <code>format</code> reverts.
<img width="572" alt="image" src="https://github.com/astral-sh/ruff-pre-commit/assets/9421489/951a3ac4-3018-4bb9-acb0-4b328d9c5acd"></p>
<p>Seems to be <code>ruff format</code> wanting to add space before colon:
<img width="1228" alt="image" src="https://github.com/astral-sh/ruff-pre-commit/assets/9421489/16293f47-e9a7-4d86-9b9b-bf2975f952ac">
<img width="1228" alt="image" src="https://github.com/astral-sh/ruff-pre-commit/assets/9421489/0c6cc289-0275-48b1-9fe2-324e01401962"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @antolu on 2024-04-15 22:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @antolu on 2024-04-15 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-15 22:44</div>
            <div class="timeline-body"><p>Does <code>ruff check --fix</code> then <em>remove</em> the colon?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-15 23:01</div>
            <div class="timeline-body"><p>Can you include the full contents of the file needed to reproduce this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-16 07:22</div>
            <div class="timeline-body"><p>Note: I haven't been able to reproduce this by pasting the visible code into the playground. https://play.ruff.rs/f218da06-df69-4979-bd30-aea8d1572447</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/antolu">@antolu</a> on 2024-04-16 09:12</div>
            <div class="timeline-body"><p>I was able to reproduce it by putting my code in the playground and putting in some of my settings (even without those, I believe): https://play.ruff.rs/d0579912-6c11-41df-b509-78a79b416881. See line 201</p>
<p>Great tool btw! I think the &quot;share&quot; button does not actually copy the link in Safari though...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-16 09:19</div>
            <div class="timeline-body"><p>Thank you. That was very helpful!</p>
<p>Okay I think I have a minimal repro. The linter only warns about the whitespace if the closing bracket is on its own line.</p>
<p>https://play.ruff.rs/bc811d2d-2386-4859-a948-dd9682df55e0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-04-16 09:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @MichaReiser on 2024-04-16 09:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "ruff check --fix --preview --unsafe-fixes conflicts with ruff format" to "E203: Incompatible with formatter when closing `]` is on its own line" by @MichaReiser on 2024-04-16 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @MichaReiser on 2024-04-16 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-14 12:55</div>
            <div class="timeline-body"><p>@MichaReiser Is this resolved by #10999 ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-14 13:08</div>
            <div class="timeline-body"><p>Yeah I think so. At least it no longer shows up in the playground.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-06-14 13:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-14 13:17</div>
            <div class="timeline-body"><blockquote>
<p>Yeah I think so. At least it no longer shows up in the playground.</p>
</blockquote>
<p>I don't think the linked PR is released yet unless you're running it locally ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-14 13:29</div>
            <div class="timeline-body"><p>I'm just gonna pretend that I tested it locally... But yes, the error no longer shows locally (but still does on play.ruff)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:05 UTC
    </footer>
</body>
</html>
