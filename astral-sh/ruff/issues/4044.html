<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ruff --fix removes import which is needed - astral-sh/ruff #4044</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ruff --fix removes import which is needed</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/4044">#4044</a>
        opened by <a href="https://github.com/Qumeric">@Qumeric</a>
        on 2023-04-20 11:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Qumeric">@Qumeric</a></div>
            <div class="timeline-body"><p>I am running <code>ruff --fix</code> with the default config and it removes an import which is needed.</p>
<pre><code># observation_log.py
from __future__ import annotations
from dataclasses import dataclass, field
from typing import TYPE_CHECKING
from game_time import current_datetime

if TYPE_CHECKING:
    from datetime import datetime

@dataclass
class Observation:
    datetime: datetime = field(default_factory=current_datetime)
</code></pre>
<pre><code># game_time.py
from datetime import datetime, timedelta

_ticks = 0
def current_datetime() -&gt; datetime:
    return datetime(1, 1, 1) + timedelta(minutes=_ticks)

</code></pre>
<p>Ruff removes <code>datetime</code> import. It is clearly used and also <code>mypy</code> reports it as an error <code>[name-defined]</code>.</p>
<p>Moving it from <code>TYPE_CHECKING</code> to the top level didn&#x27;t help either.</p>
<p>v0.0.262</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Qumeric">@Qumeric</a> on 2023-04-20 11:43</div>
            <div class="timeline-body"><p>Oh, I guess that my code is problematic, I didn&#x27;t notice I named my variable <code>datetime</code>, the same name as the other <code>datetime</code> I use.</p>
<p>However, it works fine in Python (I think) and the current behaviour is not ideal.</p>
<p>FWIW when I added <code># noqa</code> to the import line, I got
<code>components/observation_log.py:28:5: F811 Redefinition of unused &#x27;datetime&#x27; from line 18</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-21 01:37</div>
            <div class="timeline-body"><p>Ah yeah, I agree that this is a bug, though I think it&#x27;s a duplicate of an old issue (<a href="https://github.com/charliermarsh/ruff/issues/1401">charliermarsh/ruff#1401</a>), so I&#x27;m going to mark it as a duplicate. Let me know if that seems off.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-21 01:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-21 01:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-21 01:37</div>
            <div class="timeline-body"><p>Funnily enough it&#x27;s always <code>datetime</code> shadowing <code>datetime</code>!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:35 UTC
    </footer>
</body>
</html>
