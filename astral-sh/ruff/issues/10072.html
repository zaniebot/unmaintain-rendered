<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERA001 false positive on examples in comments - astral-sh/ruff #10072</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ERA001 false positive on examples in comments</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10072">#10072</a>
        opened by <a href="https://github.com/9999years">@9999years</a>
        on 2024-02-21 18:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/9999years">@9999years</a></div>
            <div class="timeline-body"><p>Ruff treats this as commented-out code, despite being an example.</p>
<pre><code># NOTE: Only upper-case fields in `extra` will be sent to `journald`.
# For instance, this:
#
#     logging.error(&quot;Uh oh!&quot;, extra={&quot;payload&quot;: &quot;my-payload&quot;})
#
# Will not show up as a `payload` field in `journalctl`, but this will:
#
#     logging.error(&quot;Uh oh!&quot;, extra={&quot;PAYLOAD&quot;: &quot;my-payload&quot;})
journal_handler = JournalHandler()
</code></pre>
<p>It would be nice if Ruff could recognize &quot;for example&quot; or <code>```python</code>-blocks as &quot;example code&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-22 15:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-22 15:15</div>
            <div class="timeline-body"><p>Hmm that&#x27;s an interesting one. The rule is working as intended but I can see how it is undesired in this specific case.</p>
<p>I would favor the solution where the rule ignores <code>Python</code> code blocks, although that would require that the rule supports some form of markdown parsing, which seems a bit much.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ottaviohartman">@ottaviohartman</a> on 2024-02-22 22:54</div>
            <div class="timeline-body"><p>It&#x27;s a bit of a hack, but you can use triple quotes to get around this case https://play.ruff.rs/42481cc7-c07b-4158-9b6b-c65f0be7c09c</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 07:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 07:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kurellajunior">@kurellajunior</a> on 2024-04-15 13:04</div>
            <div class="timeline-body"><p>Mine is different but matches the title. Maybe the rule is too eager? It worked on ruff 0.2.1, FP on 0.3.7</p>
<pre><code>    # case 1: both codes are CREATE
    if cond1:
        pass
    # case 2: one code is a CREATE, the other is an existing 
    elif cond2:
        pass
    # case 3: both codes are existing
    elif cond3:
        pass
</code></pre>
<p>removing the colons removes the FP, is that how it is meant to be?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rmorshea">@rmorshea</a> on 2024-08-22 18:17</div>
            <div class="timeline-body"><p>A reasonable heuristic might be to allow code in comments so long as there&#x27;s a preceding explanation. In particular, this means the rule would check that a commented code block is immediately preceded by comment lines with non-code content.</p>
<p>Ok cases:</p>
<pre><code># here&#x27;s an example:
# x = y + z
</code></pre>
<pre><code># here&#x27;s an example:
#
# x = y + z
</code></pre>
<p>Bad cases:</p>
<pre><code># x = y + z
</code></pre>
<pre><code>#
# x = y + z
</code></pre>
<pre><code># here&#x27;s an example:

# x = y + z
</code></pre>
<pre><code>more_code = here  # here&#x27;s an example:
# x = y + z
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rmorshea">@rmorshea</a> on 2024-08-22 18:30</div>
            <div class="timeline-body"><p>@kurellajunior I&#x27;d argue your issue is a bit different. You&#x27;re using natural language but ruff is identifying it as code. This particular issue focuses on cases in which you actually want to include code in your comment because it serves as an example.</p>
<p>More specifically, <code>case N:</code> is likely being confused with the <code>match</code> statement syntax. If you change to use <code>condition N:</code> I suspect it won&#x27;t match anymore. Granted, that still looks like an issue since what follows the <code>:</code> should be enough to ignore the line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kurellajunior">@kurellajunior</a> on 2024-08-26 21:42</div>
            <div class="timeline-body"><blockquote>
<p>@kurellajunior I&#x27;d argue your issue is a bit different. You&#x27;re using natural language but ruff is identifying it as code. This particular issue focuses on cases in which you actually want to include code in your comment because it serves as an example.</p>
</blockquote>
<p>Fully agree, it is a bit different. I thought it might still fit here, if someone is looking into the rule, to make it more robust to keep this case in mind too. I am happy to open a separate issue if this would be prefered.</p>
<p>And yes, changing the wording to a synonym solves the issue (or removing the colon or else). So I considered it not pressing enough for a separate issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Danipulok">@Danipulok</a> on 2024-10-31 04:21</div>
            <div class="timeline-body"><p>I have the same issue:</p>
<pre><code># simple comment1
# TASKS: processing
# simple comment2
</code></pre>
<p><code>ruff check --select=ERA001 mre.py</code>:</p>
<pre><code>$ ruff check --select=ERA001 mre.py 
mre.py:2:1: ERA001 Found commented-out code
  |
1 | # simple comment1
2 | # TASKS: processing
  | ^^^^^^^^^^^^^^^^^^^ ERA001
3 | # simple comment2
  |
  = help: Remove commented-out code

Found 1 error.
</code></pre>
<pre><code>$ ruff --version
ruff 0.6.9
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:50 UTC
    </footer>
</body>
</html>
