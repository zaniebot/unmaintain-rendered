<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`F841 and F811` On match-case expression - astral-sh/ruff #16969</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>F841 and F811</code> On match-case expression</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16969">#16969</a>
        opened by <a href="https://github.com/slothyrulez">@slothyrulez</a>
        on 2025-03-25 14:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/slothyrulez">@slothyrulez</a> on 2025-03-25 14:16</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Getting a F841 and F811 in a match-case expression:</p>
<pre><code>from typing import Literal

TLLM_PROVIDER_OPENAI = Literal['openai']
LLM_PROVIDER_OPENAI: TLLM_PROVIDER_OPENAI = 'openai'
TLLM_PROVIDER_OPENAI_WITH_AZURE = Literal['openai_azure']
LLM_PROVIDER_OPENAI_WITH_AZURE: TLLM_PROVIDER_OPENAI_WITH_AZURE = 'openai_azure'
TLLM_PROVIDER_ANTHROPIC = Literal['anthropic']
LLM_PROVIDER_ANTHROPIC: TLLM_PROVIDER_ANTHROPIC = 'anthropic'

TLLMProvider = Literal[
    TLLM_PROVIDER_OPENAI, TLLM_PROVIDER_OPENAI_WITH_AZURE, TLLM_PROVIDER_ANTHROPIC
]


def get_provider(provider: TLLMProvider) -&gt; TLLMProvider:
    from . import LLM_PROVIDER_OPENAI, LLM_PROVIDER_OPENAI_WITH_AZURE, LLM_PROVIDER_ANTHROPIC
    match provider:
        case LLM_PROVIDER_OPENAI:
            return 'LLM_PROVIDER_OPENAI'
        case LLM_PROVIDER_OPENAI_WITH_AZURE:
            return 'LLM_PROVIDER_OPENAI_WITH_AZURE'
        case LLM_PROVIDER_ANTHROPIC:
            return 'LLM_PROVIDER_ANTHROPIC'
        case _:
            raise ValueError(f'Unknown LLM provider: {provider}')

</code></pre>
<p>https://play.ruff.rs/1cdedaef-a8c2-4248-ab86-08121086cf06</p>
<pre><code>... F841 Local variable `LLM_PROVIDER_ANTHROPIC` is assigned to but never used
    |
123 |         case LLM_PROVIDER_OPENAI_WITH_AZURE:
124 |             return openai.LLM.with_azure(model=model_id, temperature=0, api_key=get_config('AZURE_OPENAI_API_KEY'))
125 |         case LLM_PROVIDER_ANTHROPIC:
    |              ^^^^^^^^^^^^^^^^^^^^^^ F841
126 |             return anthropic_llm.LLM(model=model_id, temperature=0, api_key=get_config('ANTHROPIC_API_KEY'))
127 |         case _:
    |
    = help: Remove assignment to unused variable `LLM_PROVIDER_ANTHROPIC`

... F811 Redefinition of unused `LLM_PROVIDER_OPENAI` from line 142
    |
148 |     match active_provider:
149 |         case LLM_PROVIDER_OPENAI:
    |              ^^^^^^^^^^^^^^^^^^^ F811
150 |             failover_providers = [LLM_PROVIDER_OPENAI_WITH_AZURE, LLM_PROVIDER_ANTHROPIC]
151 |         case LLM_PROVIDER_OPENAI_WITH_AZURE:
    |
    = help: Remove definition: `LLM_PROVIDER_OPENAI`
</code></pre>
<p>The second error, F811 comes from inside the function defining the match-case, that imports the literal</p>
<h3>Version</h3>
<p>0.9.9 and 0.11.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`F841 and F811` On match-case exp`ression" to "`F841 and F811` On match-case expression" by @slothyrulez on 2025-03-25 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-25 17:34</div>
            <div class="timeline-body"><p>The <code>case</code>s are shadowing the variables declared above, not treating them as constants. See the section on <code>match</code> statements just above <a href="https://docs.python.org/3/tutorial/controlflow.html#defining-functions">this link</a> in the docs:</p>
<blockquote>
<p>Patterns may use named constants. These must be dotted names to prevent them from being interpreted as capture variable</p>
</blockquote>
<p>Here's another example:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; LLM_PROVIDER_OPENAI = 4
&gt;&gt;&gt; match 2:
...     case LLM_PROVIDER_OPENAI:
...         print(LLM_PROVIDER_OPENAI)
...
2
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ntBre on 2025-03-25 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/slothyrulez">@slothyrulez</a> on 2025-03-27 17:21</div>
            <div class="timeline-body"><p>TIL! thanks @ntBre Sorry for your lost time</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @slothyrulez on 2025-03-27 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/slothyrulez">@slothyrulez</a> on 2025-03-27 17:23</div>
            <div class="timeline-body"><p>For future references, I fixed it like:</p>
<pre><code>def get_provider(provider: TLLMProvider) -&gt; TLLMProvider:
    from fu import constants
    match provider:
        case constants.LLM_PROVIDER_OPENAI:
            return 'LLM_PROVIDER_OPENAI'
        case constants.LLM_PROVIDER_OPENAI_WITH_AZURE:
            return 'LLM_PROVIDER_OPENAI_WITH_AZURE'
        case constants.LLM_PROVIDER_ANTHROPIC:
            return 'LLM_PROVIDER_ANTHROPIC'
        case _:
            raise ValueError(f'Unknown LLM provider: {provider}')
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-03-27 19:48</div>
            <div class="timeline-body"><p>No worries, this has tripped me up before too!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:03 UTC
    </footer>
</body>
</html>
