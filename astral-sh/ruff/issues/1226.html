<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Removal of unused imports leads to syntax error - astral-sh/ruff #1226</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Removal of unused imports leads to syntax error</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1226">#1226</a>
        opened by <a href="https://github.com/squiddy">@squiddy</a>
        on 2022-12-13 03:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/squiddy">@squiddy</a> on 2022-12-13 03:46</div>
            <div class="timeline-body"><p>See #1206</p>
<p>Running <code>ruff --select F401 --fix</code> against</p>
<pre><code class="language-python">x = 1; import sys
import os

if True:
    x = 1; import sys
    import os
</code></pre>
<p>produces</p>
<pre><code>
if True:

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1206.html">astral-sh/ruff#1206</a> on 2022-12-13 03:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2022-12-13 03:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-13 03:52</div>
            <div class="timeline-body"><p>:)</p>
<p><img src="https://user-images.githubusercontent.com/1309177/207222204-bef48747-a94d-44dc-aab9-ec00f9fffa28.png" alt="Screen Shot 2022-12-12 at 10 51 48 PM" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-13 03:54</div>
            <div class="timeline-body"><p>I feel like the <code>else</code> should be:</p>
<pre><code class="language-rust">Ok(Fix::deletion(stmt.location, stmt.end_location.unwrap()))
</code></pre>
<p>...but... why didn't I do that in the first place?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-13 03:54</div>
            <div class="timeline-body"><p>(At least, that logic does the right thing for the case above.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-13 03:57</div>
            <div class="timeline-body"><p>I'm guessing it's a formatting thing, the version above doesn't leave behind as many empty newlines. That's my guess at least. We should probably either do <code>Ok(Fix::deletion(stmt.location, stmt.end_location.unwrap()))</code> and accept the newlines (Black will clean them up), <em>or</em> only do the above when the statement is the only statement on the line (which will require looking at the text content, probably).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-13 03:59</div>
            <div class="timeline-body"><p>What do you think, @squiddy?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/squiddy">@squiddy</a> on 2022-12-13 05:16</div>
            <div class="timeline-body"><p>I think I saw you mentioning that you plan for ruff to become a formatter itself. With that in mind, I'd slightly prefer accepting newlines over introspecting the line further. Let's have black (or humans) fix the newline issue and let ruff deal with it eventually.</p>
<p>The fix ideally can also handle this scenario:</p>
<pre><code class="language-python">import sys; import bar
bar
</code></pre>
<p>Removing just the statement, based on its location, yields:</p>
<pre><code>; import bar
bar
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-13 05:17</div>
            <div class="timeline-body"><p>(Is the latter invalid syntax? Or just undesirable?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/squiddy">@squiddy</a> on 2022-12-13 05:19</div>
            <div class="timeline-body"><p>Hehe, now I needed to check myself again. It is invalid.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-13 05:19</div>
            <div class="timeline-body"><p>Ok cool :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2022-12-14 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-12-15 04:58</div>
            <div class="timeline-body"><p>I am working on this, it's just a bit tricky. But I think I've mostly figured out the rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1253.html">astral-sh/ruff#1253</a> on 2022-12-15 22:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2022-12-16 03:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:03 UTC
    </footer>
</body>
</html>
