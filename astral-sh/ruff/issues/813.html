<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replacing black and blue? - astral-sh/ruff #813</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Replacing black and blue?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/813">#813</a>
        opened by <a href="https://github.com/warsaw">@warsaw</a>
        on 2022-11-19 00:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/warsaw">@warsaw</a> on 2022-11-19 00:58</div>
            <div class="timeline-body"><p>Do you have thoughts about <code>ruff</code> eventually subsuming and replacing <code>black</code> or <a href="https://blue.readthedocs.io/en/latest/">blue</a>?  I'm one of the maintainers of <code>blue</code> (because we have different opinions about a few things), and it's been pretty difficult to both keep our monkey patching of black up to date, and rely on flake8's <code>pyproject.toml</code> support across multiple different major versions of <code>flake8</code>.</p>
<p>I'm thinking about alternatives, and this looks like a nice framework which could be a good starting point, so I'd like to get your thoughts about this project's direction.  Would something like this be in or out of scope?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-19 19:02</div>
            <div class="timeline-body"><p>I'm really interested in this and definitely consider it to be within scope. Would love to chat about how it would work and how we'd push it forward :)</p>
<p>To-date, I've focused on making Ruff a Black-compatible linter and code transformation tool, but I'd like it to expand to an all-in-one code formatter (ideally, though, in a way that's totally opt-in and incrementally adoptable, so users <em>could</em> continue to use Black as a formatter and Ruff as a linter). I think coupling a linter (with autofix capabilities) with an auto-formatter can make both tools more effective and efficient.</p>
<p>Philosophically, I'm comfortable enabling a higher level of configuration than is supported by <code>black</code>. Though it's somewhat subjective, my general philosophy towards auto-formatted settings is that I don't care what settings are used, as long as they're consistent in a codebase and automatically applied. I think <a href="https://prettier.io/docs/en/configuration.html#basic-configuration">Prettier</a> has done a reasonable job of exposing a few configuration settings, like space width and quotation style. <a href="https://rust-lang.github.io/rustfmt/">Rustfmt</a> goes much further, maybe further than is desired in this case. But, regardless, it's critical to me that Ruff enforces a single formatting style; rather, than it's capable of enforcing and applying formatting style.</p>
<p>The biggest fundamental blocker to starting on auto-formatting is that we <em>may</em> need a CST rather than an AST. (The lexer outputs comments, so if we don't care about preserving whitespace in code, and view auto-formatting as a function of (AST + comments) =&gt; (source code),  we may not actually <em>need</em> a CST? I haven't done enough research to understand the requirements here.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andersk">@andersk</a> on 2022-11-19 22:05</div>
            <div class="timeline-body"><p>More information than just AST + comments will likely be needed. Black preserves <a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#empty-lines">empty lines</a> between statements (up to 1 or 2 depending on where), <a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#parentheses">extra parentheses</a> with certain specific exceptions, the distinction between <a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#strings">normal and raw strings</a> (<code>&quot;&quot;</code>, <code>r&quot;&quot;</code>, <code>R&quot;&quot;</code>), and a <a href="https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html#the-magic-trailing-comma">magic trailing comma</a> that forces vertical layout.</p>
<p>But maybe an AST-like type with just that extra information would still be nicer than a CST?</p>
<p>Thereâ€™s also <code># fmt: off</code> and <code># fmt: skip</code> to deal with somehow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2022-11-20 00:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2022-11-20 22:31</div>
            <div class="timeline-body"><p>This would be excellent; all users would need would be Ruff and a type checker</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-21 03:08</div>
            <div class="timeline-body"><p>Yeah, I'd like to see what minimal set of extensions we'd need to the AST and parser to support Black-compatible formatting.  Part of me wonders if we could generate any extra metadata by taking the AST and augmenting it through a second pass over the token stream... For example, we could collect comments and empty lines. We could also tag strings as normal or raw (though that's not captured in the token stream -- we'd have to look at the actual source), and so on.</p>
<p>(We could move to LibCST and generate code from a CST representation, but I'm really hesitant since the parser is so much slower and the representation is indeed more complex.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-22 17:01</div>
            <div class="timeline-body"><p>For more inspiration, there's also <a href="https://github.com/asottile/tokenize-rt">tokenize-rt</a>, which implements round-tripping for Python's <code>tokenize</code>. However, this would require that the entire autoformatter operate on tokens rather than an AST, which seems challenging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-16 03:03</div>
            <div class="timeline-body"><p>Closing in favor of #1904. I'm going to start work on this.</p>
<p>(I wrote more in #1904, but I'd like the autoformatter to be a little more flexible than Black, which would in theory make it a suitable replacement for Blue too.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-16 03:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:28:29 UTC
    </footer>
</body>
</html>
