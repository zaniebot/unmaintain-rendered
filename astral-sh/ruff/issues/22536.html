<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff server` ignores config from nested directory if files are opened directly - astral-sh/ruff #22536</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ruff server</code> ignores config from nested directory if files are opened directly</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22536">#22536</a>
        opened by <a href="https://github.com/ZedThree">@ZedThree</a>
        on 2026-01-12 17:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ZedThree">@ZedThree</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Here's a simple example:</p>
<pre><code>└── dir
    ├── ruff.toml
    └── test.py
</code></pre>
<p><code>dir/test.py</code>:</p>
<pre><code class="language-py">import os
</code></pre>
<p><code>dir/ruff.toml</code>:</p>
<pre><code class="language-toml">[lint]
select = [&quot;FURB&quot;]
preview = true
</code></pre>
<p><code>ruff check</code> gives the expected behaviour: no warnings. Opening the top-level dir or <code>dir_1</code> in VS Code also gives the expected behaviour.</p>
<p>However, opening the file directly does give a warning (<code>F401</code>). This also happens with helix, neovim, and emacs (which don't all necessarily have opening a folder as a workspace as a concept).</p>
<p>Creating <code>pyproject.toml</code> at the top level resolves the issue.</p>
<p>This might be a duplicate of #20847 and #17944, which are similar issues where the server is not resolving config correctly.</p>
<h3>Version</h3>
<p>ruff 0.14.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 17:55</div>
            <div class="timeline-body"><p>Thanks for the great write up and also mentioning the related issues. The root cause for this is the same as https://github.com/astral-sh/ruff/issues/17944, Ruff doesn't even try to find settings for files outside the workspace root.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2026-01-12 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ZedThree">@ZedThree</a> on 2026-01-12 18:01</div>
            <div class="timeline-body"><p>Well, not quite -- in this case, it's <em>below</em> the workspace root:</p>
<pre><code>DEBUG Indexing settings for workspace: /tmp/mvce
 INFO Registering workspace: /tmp/mvce
DEBUG Received message: Notification(Notification { method: &quot;textDocument/didOpen&quot;, params: Object {&quot;textDocument&quot;: Object {&quot;languageId&quot;: String(&quot;python&quot;), &quot;text&quot;: String(&quot;import os\n&quot;), &quot;uri&quot;: String(&quot;file:///tmp/mvce/dir/test.py&quot;), &quot;version&quot;: Number(0)}} })
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 18:06</div>
            <div class="timeline-body"><blockquote>
<p>Well, not quite -- in this case, it's below the workspace root:</p>
</blockquote>
<p>I understood that it's working if you open the folder (in which case the workspace root is <code>/tmp/mvce</code>) but not when opening the file (in which case I believe VS Code uses <code>~/</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ZedThree">@ZedThree</a> on 2026-01-12 18:21</div>
            <div class="timeline-body"><p>Ah, indeed, that is true with VS code, but with other editors like neovim and helix, the workspace root is the cwd, so <code>/tmp/mvce</code> in this case. Here's the logs from neovim from first <code>nvim dir/test.py</code>, then from <code>cd dir; nvim test.py</code></p>
<pre><code> INFO No workspace(s) were provided during initialization. Using the current working directory as a default workspace: /tmp/mvce
 INFO No workspace options found for file:///tmp/mvce, using default options
DEBUG Negotiated position encoding: UTF8
DEBUG Indexing settings for workspace: /tmp/mvce
 INFO Registering workspace: /tmp/mvce
 WARN LSP client does not support dynamic capability registration - automatic configuration reloading will not be available.
DEBUG notification{method=&quot;textDocument/didOpen&quot;}: enter
DEBUG request{id=2 method=&quot;textDocument/diagnostic&quot;}: enter
DEBUG request{id=2 method=&quot;textDocument/diagnostic&quot;}: Included path via `include`: /tmp/mvce/dir/test.py
DEBUG request{id=3 method=&quot;shutdown&quot;}: enter
DEBUG request{id=3 method=&quot;shutdown&quot;}: Received shutdown request, waiting for shutdown notification
DEBUG Received exit notification, exiting
 INFO Server shut down


 INFO No workspace(s) were provided during initialization. Using the current working directory as a default workspace: /tmp/mvce/dir
 INFO No workspace options found for file:///tmp/mvce/dir, using default options
DEBUG Negotiated position encoding: UTF8
DEBUG Indexing settings for workspace: /tmp/mvce/dir
DEBUG No `target-version` found in `ruff.toml` log.target=&quot;ruff_workspace::pyproject&quot; log.module_path=&quot;ruff_workspace::pyproject&quot; log.file=&quot;crates/ruff_workspace/src/pyproject.rs&quot; log.line=207
DEBUG No `pyproject.toml` with `requires-python` in same directory; `target-version` unspecified log.target=&quot;ruff_workspace::pyproject&quot; log.module_path=&quot;ruff_workspace::pyproject&quot; log.file=&quot;crates/ruff_workspace/src/pyproject.rs&quot; log.line=218
DEBUG Loaded settings from: `/tmp/mvce/dir/ruff.toml`
 INFO Registering workspace: /tmp/mvce/dir
 WARN LSP client does not support dynamic capability registration - automatic configuration reloading will not be available.
DEBUG notification{method=&quot;textDocument/didOpen&quot;}: enter
DEBUG request{id=2 method=&quot;textDocument/diagnostic&quot;}: enter
DEBUG request{id=2 method=&quot;textDocument/diagnostic&quot;}: Included path via `include`: /tmp/mvce/dir/test.py
DEBUG request{id=3 method=&quot;shutdown&quot;}: enter
DEBUG request{id=3 method=&quot;shutdown&quot;}: Received shutdown request, waiting for shutdown notification
DEBUG Received exit notification, exiting
 INFO Server shut down
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 18:29</div>
            <div class="timeline-body"><p>@dhruvmanila will know more here but the editors still run in single-file mode</p>
<p>https://github.com/astral-sh/ruff/blob/4c4ddc8c29e649dad381b21c90593226687825e1/crates/ruff_server/src/session/index/ruff_settings.rs#L237-L254</p>
<p>which was added here https://github.com/astral-sh/ruff/pull/13770</p>
<p>That's why I still think it's the same issue. Ruff uses the default settings for files outside the workspace root (which also applies if the editor sends no workspace root)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 19:15:28 UTC
    </footer>
</body>
</html>
