<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP032: detect more cases - astral-sh/ruff #2031</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP032: detect more cases</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/2031">#2031</a>
        opened by <a href="https://github.com/spaceone">@spaceone</a>
        on 2023-01-20 15:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/spaceone">@spaceone</a></div>
            <div class="timeline-body"><p>UP032 could detect more cases when <code>.format()</code> is used and suggest to use a fstring.</p>
<pre><code>&#x27;Magic wand: {}&#x27;.format(bag[&#x27;wand&#x27;])
&#x27;Magic wand: {}&#x27;.format(bag[&quot;wand&quot;])
&#x27;Magic wand: {}&#x27;.format(&#x27;bag&#x27;)
&#x27;Magic wand: {}&#x27;.format(bag)
</code></pre>
<p>(only the last is detected).</p>
<p>A fixer for all cases is of course not trivial: https://peps.python.org/pep-0701/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-20 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/link2xt">@link2xt</a> on 2023-02-08 12:13</div>
            <div class="timeline-body"><p>Also multiline <code>.format()</code> is not detected:</p>
<pre><code>&#x27;Magic wand: {}&#x27;.format(
  bag
)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-02-08 15:40</div>
            <div class="timeline-body"><p>IIRC we only flag what we can confidently fix. We could instead flag <em>all</em> usages of <code>.format</code>, even those we can&#x27;t fix right now...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-08-17 21:12</div>
            <div class="timeline-body"><p>I found a special case today that I think should be safe to fix:</p>
<pre><code>&quot;  reading {filename}&quot;.format(**locals())
</code></pre>
<p>I don&#x27;t see why fixing to <code>f&quot;  reading {filename}&quot;</code> shouldn&#x27;t be safe as <code>filename</code> should necessarily be in the local scope (otherwise the code would already fail anyway)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2024-08-20 21:04</div>
            <div class="timeline-body"><p>Here&#x27;s another fun case I found today in setuptools again:</p>
<pre><code>    &#x27;%(foo)s:%(bar)s&#x27; % vars(x)
    # can be either
    &#x27;{x.foo}:{x.bar}&#x27;.format(x=x)
    f&#x27;{x.foo}:{x.bar}&#x27;

    # original example I found:
    def __str__(self):
        return &#x27;%(username)s:%(password)s&#x27; % vars(self)
</code></pre>
<p>Which also makes me realize that for UP031:</p>
<pre><code>    &#x27;%(foo)s:%(bar)s&#x27; % x
    # can be
    &#x27;{foo}:{bar}&#x27;.format(**x)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdulcet">@tdulcet</a> on 2025-01-12 16:27</div>
            <div class="timeline-body"><p>UP031 does not flag this, although I thought it was supposed to detect everything after #11229:</p>
<pre><code>&#x27;├─%s─&#x27; % (len(l) * &#x27;─&#x27;)
</code></pre>
<p>After manually updating it use <code>str.format</code>, it is also not detected by UP032:</p>
<pre><code>&#x27;├─{}─&#x27;.format(len(l) * &#x27;─&#x27;)
</code></pre>
<p>The issue seems to be the string multiplication, as removing that causes them to be detected by both rules respectively as expected. This of course should have no effect on UP031, as an autofix would not need to embed the string and thus change the quote style like it would with UP032.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/inoa-jboliveira">@inoa-jboliveira</a> on 2025-03-16 02:10</div>
            <div class="timeline-body"><blockquote>
<p>IIRC we only flag what we can confidently fix. We could instead flag <em>all</em> usages of <code>.format</code>, even those we can&#x27;t fix right now...</p>
</blockquote>
<p>Yes please. I don&#x27;t believe there is a single format op that cannot be expressed as f-string. Specially with python 3.12 changes regarding quotes and backslashes.</p>
<p>So at least give us the warnings even if no fix exists. That is the purpose of a checker. IMO not showing a warn for <code>&quot;{}&quot;.format(&quot;a&quot;)</code> should be considered a bug.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:30 UTC
    </footer>
</body>
</html>
