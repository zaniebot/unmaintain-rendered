<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposal: Formatting options to enable &quot;vertical formatting&quot; and &quot;grid formatting&quot; - astral-sh/ruff #8197</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Proposal: Formatting options to enable &quot;vertical formatting&quot; and &quot;grid formatting&quot;</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8197">#8197</a>
        opened by <a href="https://github.com/NeilGirdhar">@NeilGirdhar</a>
        on 2023-10-25 04:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/NeilGirdhar">@NeilGirdhar</a> on 2023-10-25 04:36</div>
            <div class="timeline-body"><p>I realize that this may not be a popular feature request, but it's the only thing stopping me from using Black, and I love the idea of Black, so I feel compelled to propose it.  Feel free to close this as &quot;will not implement&quot;.</p>
<p>Fundamentally, Black has <a href="https://black.readthedocs.io/en/stable/the_black_code_style.html">chosen</a> to wrap lines in one of three ways:</p>
<ul>
<li>single line:<pre><code class="language-python">def super_softplus(x: JaxRealArray) -&gt; JaxRealArray:
</code></pre>
</li>
<li>hanging single line:<pre><code class="language-python">  def geometry_energy(
      self, intermediate_explanation: FisherMessage, observation: FisherMessage, case: int
  ) -&gt; RivalMessageEnergy:
</code></pre>
</li>
<li>and hanging multi-line:<pre><code class="language-python">  def infer_explanation_variationally(
      self,
      observation: FisherMessage,
      weights: Weights,
      *,
      key: None | KeyArray = None,
      use_variational_signal_noise: bool,
  ) -&gt; RivalMessagePrediction:
</code></pre>
</li>
</ul>
<p>This hanging formatting like mode 3 of isort.   While mode 3 is very versatile, some people consider it harder to read than isort's mode 1: &quot;vertical&quot; (see e.g., <a href="https://github.com/numpy/numpy/blob/382eedf3891d474196677e65f3aae066afb32c5f/numpy/_core/_internal.py#L432">numpy</a>).  My proposal is to try vertical formatting to see if all lines fit without wrapping, and if so prefer that to either of the hanging outputs.  Thus, for the above examples, we have:</p>
<pre><code class="language-python">    def geometry_energy(self,
                        intermediate_explanation: FisherMessage,
                        observation: FisherMessage,
                        case: int
                        ) -&gt; RivalMessageEnergy:
</code></pre>
<p>and</p>
<pre><code class="language-python">    def infer_explanation_variationally(self,
                                        observation: FisherMessage,
                                        weights: Weights,
                                        *,
                                        key: None | KeyArray = None,
                                        use_variational_signal_noise: bool,
                                        ) -&gt; RivalMessagePrediction:

</code></pre>
<p>Of course legibility is in the eye of the beholder, but the two points in favour of vertical layout are that:</p>
<ul>
<li>The arguments sit to the right of the function call, which makes the function call more visually obvious.</li>
<li>In the case of hanging multi-line, the vertical version uses fewer lines of vertical space.  Minimizing vertical space means that more code is visible on the screen, which makes reasoning about large functions a lot easier since you don't need to scroll and memorize code.</li>
<li>In the case of hanging single line, the vertical layout puts each argument on its own line, which makes them easier to distinguish without looking for commas.</li>
</ul>
<p>I concede that when there is a line that doesn't fit within the line length, hanging is definitely superior.  I'm not proposing eliminating that.  I'm proposing using vertical in particular cases.  In short, my proposal is to format as follows:</p>
<ul>
<li>Prefer single line if possible (as before)</li>
<li><strong>Try vertical to see if all lines can be rendered without wrapping</strong> (proposed)</li>
<li>Try hanging multi-line otherwise (as before)</li>
</ul>
<p>This algorithm would need to applied recursively for nested structures.</p>
<p>I realize that Black's rules are simple, but if the goal is to write code the way humans read and write code, I think a little bit of extra complexity in the rules would go a long way to making code easier for people to read.  The downside of this proposal is longer diffs, but diffs are read a lot less often than code is read as it's being worked on.</p>
<p>--</p>
<p>Edit: Similarly, it would be nice to support <em>grid formatting</em> as another option.  This comes in handy for NumPy arrays and imports:</p>
<pre><code class="language-python">from ...structure import (InferenceResult, InferenceResults, ListLabeler, LoggingManager, Plot,
                          Plotter, RLInference, Solver, TrainingResult, TrainingResults,
                          TrainingSolution, chooser_field, smooth_data, ui_dataclass)

np.array([[1, ...
           2, 1],
          [1, 1, 0],
          [0, 1, 1]])
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Proposal: Formatting option for compact output" to "Proposal: Formatting option to enable "vertical formatting"" by @NeilGirdhar on 2023-10-25 04:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-10-25 06:30</div>
            <div class="timeline-body"><p>Thanks for this detailed issue. Supporting different &quot;styles&quot; (similar to docstring conventions) might be something that we want to explore in the future but is currently out of scope. There's still a lot to do on the current style: from preview style, fixing deviations, <code>check</code> integration, etc... and building this style took us 6 months.</p>
<p>But we do understand that we have different preferences and a single style doesn't satisfy the needs of everyone.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-10-25 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @MichaReiser on 2023-10-25 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2023-10-26 23:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Proposal: Formatting option to enable "vertical formatting"" to "Proposal: Formatting options to enable "vertical formatting" and "grid formatting"" by @NeilGirdhar on 2023-11-13 23:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2600.html">astral-sh/ruff#2600</a> on 2023-11-13 23:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
