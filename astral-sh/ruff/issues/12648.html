<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flake8-comprehensions (C4) - Remove unnecessary list comprehensions in additional contexts that can take arbitrary iterables (C419) - astral-sh/ruff #12648</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>flake8-comprehensions (C4) - Remove unnecessary list comprehensions in additional contexts that can take arbitrary iterables (C419)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12648">#12648</a>
        opened by <a href="https://github.com/gandhis1">@gandhis1</a>
        on 2024-08-02 22:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gandhis1">@gandhis1</a></div>
            <div class="timeline-body"><p>The following code all creates unnecessary list comprehensions</p>
<pre><code>    a = all([i is not None for i in range(10)])
    b = tuple([i * 2 for i in range(10)])
    c = sum([i * 2 for i in range(10)])
    d = &quot;,&quot;.join([str(i * 2) for i in range(10)])
</code></pre>
<p>ruff will only suggest changes on the first line:</p>
<pre><code>stuff.py:3:13: C419 Unnecessary list comprehension
  |
2 | def main() -&gt; None:
3 |     a = all([i is not None for i in range(10)])
  |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ C419
4 |     b = tuple([i * 2 for i in range(10)])
5 |     c = sum([i * 2 for i in range(10)])
  |
  = help: Remove unnecessary list comprehension
</code></pre>
<p>However all of these are unnecessary list comprehensions. It ought to be able to identify them all. For one, the <a href="https://docs.astral.sh/ruff/rules/unnecessary-comprehension-in-call/">docs suggest</a> that <code>sum</code> is covered, but from the above, it appears to not fully be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 22:11</div>
            <div class="timeline-body"><p><code>sum</code> is covered under <code>--preview</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 22:12</div>
            <div class="timeline-body"><p>Honestly not sure why <code>tuple</code> doesn&#x27;t have any corresponding rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 22:13</div>
            <div class="timeline-body"><p>Oh, I think it&#x27;s because <code>tuple([1, 2])</code> gets rewritten to <code>(1, 2)</code> (so the rule only supports literals). We could extend it to remove the inner list.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 22:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 23:25</div>
            <div class="timeline-body"><p>I think we should expand C409 to include comprehensions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 23:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 23:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 23:26</div>
            <div class="timeline-body"><p><code>C419</code> is an example of how that logic would work -- it&#x27;s nearly identical. (This would be behind <code>--preview</code> for now.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eth3lbert">@eth3lbert</a> on 2024-08-03 01:43</div>
            <div class="timeline-body"><p>While <code>tuple</code> and <code>&quot;&quot;.join</code> can be rewritten without list comprehensions, it doesn&#x27;t necessarily mean there&#x27;s a performance improvement.</p>
<pre><code>In [1]: %timeit tuple([i for i in range(1000)])
20.4 μs ± 148 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)

In [2]: %timeit tuple(i for i in range(1000))
39.7 μs ± 205 ns per loop (mean ± std. dev. of 7 runs, 10,000 loops each)

In [3]: %timeit &quot;,&quot;.join([str(i * 2) for i in range(10)])
1.02 μs ± 22.6 ns per loop (mean ± std. dev. of 7 runs, 1,000,000 loops each)

In [4]: %timeit &quot;,&quot;.join(str(i * 2) for i in range(10))
1.49 μs ± 14.4 ns per loop (mean ± std. dev. of 7 runs, 1,000,000 loops each)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-03 12:22</div>
            <div class="timeline-body"><p>I believe the same is true for <code>sum</code> et al which is why they&#x27;re still in preview and we considered adding a separate rule for them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2024-08-04 00:35</div>
            <div class="timeline-body"><p>It seems like a toss up to me whether it should be <code>C409</code> or <code>C419</code> that should be expanded to include this violation/fix. In the PR above I did what was suggested above (and extended <code>C409</code>) - but let me know if you have second thoughts and I can extend <code>C419</code> instead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 02:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-05 02:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gandhis1">@gandhis1</a> on 2024-08-05 12:10</div>
            <div class="timeline-body"><p>What about <code>str.join</code>?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:56 UTC
    </footer>
</body>
</html>
