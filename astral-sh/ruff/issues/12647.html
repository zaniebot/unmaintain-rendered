<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOC501 False Positive - astral-sh/ruff #12647</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>DOC501 False Positive</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12647">#12647</a>
        opened by <a href="https://github.com/will-schneble">@will-schneble</a>
        on 2024-08-02 21:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/will-schneble">@will-schneble</a></div>
            <div class="timeline-body"><p><strong>Describe the bug</strong>
DOC501 rule violation when the docstring includes the exception.</p>
<p>ruff==0.5.5
python==3.12.4</p>
<p>Command: <code>ruff check --preview --select DOC</code></p>
<p>No pyproject.toml or other configuration than what&#x27;s shown here.</p>
<p><strong>Steps to reproduce</strong>
Sample file to test against.</p>
<pre><code>class Foo:
    def __init__(self, bar, zap):
        self.bar = bar
        self.zap = zap
        
    def get_bar(self) -&gt; str:
        &quot;&quot;&quot;Print and return bar.
        
        Raises:
            ValueError: bar is not bar.

        Returns:
            str: bar value.
        &quot;&quot;&quot;    
        print(self.bar)
        if self.bar != &quot;bar&quot;:
            raise ValueError(self.bar)
        return self.bar
</code></pre>
<p><strong>Expected behavior</strong>
No violations.</p>
<p>Running <code>pydoclint --style=google test.py</code> gives the expected no violation result.</p>
<p><strong>Debug logs</strong></p>
<pre><code>test.py:17:19: DOC501 Raised exception `ValueError` missing from docstring
   |
15 |         print(self.bar)
16 |         if self.bar != &quot;bar&quot;:
17 |             raise ValueError(self.bar)
   |                   ^^^^^^^^^^^^^^^^^^^^ DOC501
18 |         return self.bar
   |
</code></pre>
<p><strong>Notes</strong>
Adding an argument to Foo.get_bar and adding that to the docstring then makes the DOC501 violation go away. Example below:</p>
<pre><code>    def get_bar(self, x: str) -&gt; str:
        &quot;&quot;&quot;Print and return bar.
        
        Args:
            x (str): A dummy value.
        
        Raises:
            ValueError: bar is not bar.

        Returns:
            str: bar value
        &quot;&quot;&quot;    
        print(self.bar)
        if self.bar != &quot;bar&quot;:
            raise ValueError(self.bar)
        return self.bar
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/will-schneble">@will-schneble</a> on 2024-08-02 21:47</div>
            <div class="timeline-body"><p>Just saw ruff==0.5.6 released. Double checked and it is still an issue in that version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 21:51</div>
            <div class="timeline-body"><p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 22:34</div>
            <div class="timeline-body"><p>I think the issue is that the above section is actually ambiguous. All the defined sections are valid section names in both NumPy and Google. You should set the convention explicitly in your <code>pyproject.toml</code>, e.g.:</p>
<pre><code>[tool.ruff.lint.pydocstyle]
convention = &quot;google&quot;
</code></pre>
<p>(Adding <code>Args</code> works because <code>Args</code> is Google-only, so we can safely differentiate.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/will-schneble">@will-schneble</a> on 2024-08-02 22:39</div>
            <div class="timeline-body"><p>You&#x27;re correct, adding <code>--config &#x27;lint.pydocstyle.convention=&quot;google&quot;&#x27;</code> produces the expected results. For some reason I thought pydocstyle config didn&#x27;t affect the pydoclint rules. Thanks for looking into it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JasonGrace2282">@JasonGrace2282</a> on 2024-08-02 22:44</div>
            <div class="timeline-body"><p>It might make sense to produce a more reasonable error message instead of a vague DOC501 linting error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 22:50</div>
            <div class="timeline-body"><p>@JasonGrace2282 - can you expand on that? It’s inferring a NumPy docstring, and in that case, it can’t find any raises.</p>
<p>@will-schneble - gonna leave this open because I think we can improve our detection.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JasonGrace2282">@JasonGrace2282</a> on 2024-08-02 23:00</div>
            <div class="timeline-body"><p>I&#x27;m not familiar with how the parsing works in Ruff, but as a user I would expect a warning if the convention is numpy but a docstring looks like Google convention.
I understand what I just said is a bit vague (and possibly hard to implement), so really any kind of hint if the docstring convention isn&#x27;t explicitly set would be useful imo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/charliermarsh">@charliermarsh</a> by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 23:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-03 01:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-03 01:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trim21">@trim21</a> on 2024-08-08 16:58</div>
            <div class="timeline-body"><p>this is confusing, doc use google style but it requires extra config</p>
<p>https://docs.astral.sh/ruff/rules/docstring-missing-exception/</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:56 UTC
    </footer>
</body>
</html>
