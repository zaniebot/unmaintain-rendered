<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trigger UP043 on &lt;3.13 with __future__.annotations - astral-sh/ruff #19566</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Trigger UP043 on &lt;3.13 with __future__.annotations</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/19566">#19566</a>
        opened by <a href="https://github.com/Gallaecio">@Gallaecio</a>
        on 2025-07-25 21:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Gallaecio">@Gallaecio</a> on 2025-07-25 21:58</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>I wonder if this could be considered part of https://github.com/astral-sh/ruff/issues/18502. It may also be related to https://github.com/astral-sh/ruff/issues/19402 and https://github.com/astral-sh/ruff/issues/19359. But I am not sure, and none of those mention this rule specifically.</p>
<p><a href="https://docs.astral.sh/ruff/rules/unnecessary-default-type-args/">UP043</a> seems to only trigger in Python 3.13+. However, it seems that (as long as you are using <code>from __future__ import annotations</code>?) the new syntax works in older versions. I tried 3.9, and things work both at run time (at least as long as you do not try to resolve the type?) and when running mypy.</p>
<h3>Version</h3>
<p>0.12.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-25 22:48</div>
            <div class="timeline-body"><p>Oh cool, thanks for pointing that out! It sounds like this should definitely be added to #19359/#18502, but allowing the rule to apply if <code>from __future__ import annotations</code> is already present could also be a separate (preview) change to the rule.</p>
<p>I feel like I'm missing something obvious, but I'm actually having trouble causing errors by using this syntax on earlier versions. The example from the docs, plus an added module-level annotation, seems fine in mypy, pyright, ty, and even Python with 3.9:</p>
<pre><code class="language-python"># try.py
from collections.abc import Generator, AsyncGenerator


x: Generator[int] = (1 for _ in range(3))


def sync_gen() -&gt; Generator[int]:
    yield 42


async def async_gen() -&gt; AsyncGenerator[int]:
    yield 42


for y in sync_gen():
    print(y)
</code></pre>
<pre><code class="language-shell">&gt; mypy try.py --python-version 3.9
Success: no issues found in 1 source file
&gt; pyright --pythonversion 3.9 try.py
0 errors, 0 warnings, 0 informations
&gt; ty check --python-version 3.9 try.py
All checks passed!
&gt; uvx python@3.9 try.py
42
</code></pre>
<p>Maybe the version check isn't needed in general?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-07-25 22:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gallaecio">@Gallaecio</a> on 2025-07-25 23:54</div>
            <div class="timeline-body"><blockquote>
<p>I'm actually having trouble causing errors by using this syntax on earlier versions</p>
</blockquote>
<p>+1. I assumed it should, <a href="https://peps.python.org/pep-0696/">it sounds like it was introduced in 3.13</a>, but it does not seem to ðŸ¤· .</p>
<p>Also tried aliasing in 3.9, <code>MyType = Generator[str]</code>, works as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-07-26 11:52</div>
            <div class="timeline-body"><blockquote>
<p>I feel like I'm missing something obvious, but I'm actually having trouble causing errors by using this syntax on earlier versions. The example from the docs, plus an added module-level annotation, seems fine in mypy, pyright, ty, and even Python with 3.9:</p>
</blockquote>
<p>At runtime, providing &lt;3 parameters works with <code>collections.abc.Generator</code> on all Python versions, but if you use <code>typing.Generator</code> you can only provide &lt;3 parameters if you're on Python 3.13+ <em>or</em> it's a type annotation and you have <code>from __future__ import annotations</code> enabled:</p>
<pre><code class="language-pycon">% uvx python3.9
Python 3.9.6 (default, Apr 30 2025, 02:07:17) 
[Clang 17.0.0 (clang-1700.0.13.5)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import typing, collections.abc
&gt;&gt;&gt;
&gt;&gt;&gt; x = collections.abc.Generator[int]  # succeeds on all versions of Python
&gt;&gt;&gt;
&gt;&gt;&gt; x: collections.abc.Generator[int]  # succeeds on all versions of Python
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; y = typing.Generator[int]  # Fails on Python &lt;3.13 with or without `__future__.annotations`
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 275, in inner
    return func(*args, **kwds)
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 828, in __getitem__
    _check_generic(self, params, self._nparams)
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 212, in _check_generic
    raise TypeError(f&quot;Too {'many' if alen &gt; elen else 'few'} parameters for {cls};&quot;
TypeError: Too few parameters for typing.Generator; actual 1, expected 3
&gt;&gt;&gt;
&gt;&gt;&gt; y: typing.Generator[int]  # Fails on Python &lt;3.13 without `__future__.annotations`
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 275, in inner
    return func(*args, **kwds)
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 828, in __getitem__
    _check_generic(self, params, self._nparams)
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 212, in _check_generic
    raise TypeError(f&quot;Too {'many' if alen &gt; elen else 'few'} parameters for {cls};&quot;
TypeError: Too few parameters for typing.Generator; actual 1, expected 3
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; from __future__ import annotations
&gt;&gt;&gt;
&gt;&gt;&gt; z = typing.Generator[int]  # still fails despite the `__future__` import
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 275, in inner
    return func(*args, **kwds)
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 828, in __getitem__
    _check_generic(self, params, self._nparams)
  File &quot;/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/typing.py&quot;, line 212, in _check_generic
    raise TypeError(f&quot;Too {'many' if alen &gt; elen else 'few'} parameters for {cls};&quot;
TypeError: Too few parameters for typing.Generator; actual 1, expected 3
&gt;&gt;&gt;
&gt;&gt;&gt; z: typing.Generator[int]  # now passes due to the `__future__` import
&gt;&gt;&gt;
</code></pre>
<p><code>typing_extensions.Generator</code> should also allow &lt;3 parameters on all Python versions, regardless of whether <code>__future__.annotations</code> has been imported or not. Type checkers aren't aware of the subtle differences between <code>collections.abc.Generator</code> and <code>typing.Generator</code> here; it would be hard to make them aware of these differences. They assume <code>collections.abc.Generator</code> semantics for <code>typing.Generator</code> on all Python versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-26 13:48</div>
            <div class="timeline-body"><p>Thanks Alex! It sounds like we should definitely keep the version check, and the change suggested in the issue would still be helpful, even if it only strictly applies to <code>typing.Generator</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/20011.html">astral-sh/ruff#20011</a> on 2025-08-20 21:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/20027.html">astral-sh/ruff#20027</a> on 2025-09-08 22:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
