<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>query: UP032 fix leaves bad formatting? - astral-sh/ruff #8683</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>query: UP032 fix leaves bad formatting?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8683">#8683</a>
        opened by <a href="https://github.com/lucascolley">@lucascolley</a>
        on 2023-11-14 20:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/lucascolley">@lucascolley</a> on 2023-11-14 20:21</div>
            <div class="timeline-body"><p>noted by @ilayn https://github.com/scipy/scipy/pull/19516#issuecomment-1810150463</p>
<p>version: ruff 0.1.5</p>
<p>UP032 fix seems to leave some undesired formatting. In the case of SciPy where we want to run the linter without a formatter, this is less than ideal. Is this the intended behaviour, or could it be improved? Examples:</p>
<pre><code class="language-diff">- raise ValueError(&quot;Conflicting configuration dicts: {!r} {!r}&quot;
-                  &quot;&quot;.format(new_dict, d))
+ raise ValueError(f&quot;Conflicting configuration dicts: {new_dict!r} {d!r}&quot;
+                  &quot;&quot;)
</code></pre>
<pre><code class="language-diff">+ raise ValueError(&quot;invalid number of data points ({}) specified&quot;
+                  .format(tmp.shape[axis]))
- raise ValueError(f&quot;invalid number of data points ({tmp.shape[axis]}) specified&quot;
-                  )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-14 21:31</div>
            <div class="timeline-body"><p>Fix formatting is very much a best-effort thing, but we can definitely try to improve these. (I might argue that the first one had strange formatting <em>before</em> the fix too :))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-11-14 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lucascolley">@lucascolley</a> on 2023-11-14 21:35</div>
            <div class="timeline-body"><blockquote>
<p>I might argue that the first one had strange formatting <em>before</em> the fix too</p>
</blockquote>
<p>Definitely ðŸ˜† I don't know how much code is formatted like this in the wider world but there are quite a few cases of this in scipy/scipy#19516</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilayn">@ilayn</a> on 2023-11-14 21:41</div>
            <div class="timeline-body"><blockquote>
<p>first one had strange formatting before the fix too</p>
</blockquote>
<p>Indeed and I am responsible for a few of those. But in our defense, the reasoning is the PEP8 80 chars line limit olympics.</p>
<p>We can live with the 2nd example though not really a big deal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-15 17:38</div>
            <div class="timeline-body"><p>It'd be nice to detect-and-strip trailing empty strings and trailing newlines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-11-16 02:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/8712.html">astral-sh/ruff#8712</a> on 2023-11-16 03:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-16 04:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-16 04:15</div>
            <div class="timeline-body"><p>Hopefully better in the next release! At least, the two examples above are fixed by https://github.com/astral-sh/ruff/pull/8712.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilayn">@ilayn</a> on 2023-11-16 07:47</div>
            <div class="timeline-body"><p>@charliermarsh thank you for the rapid action. Much appreciated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../scipy/scipy/pulls/19516.html">scipy/scipy#19516</a> on 2023-11-16 08:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../scikit-image/scikit-image/pulls/7197.html">scikit-image/scikit-image#7197</a> on 2023-11-16 18:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
