<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import sort grouping does not work for namespaced editable workspace packages - astral-sh/ruff #19198</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Import sort grouping does not work for namespaced editable workspace packages</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19198">#19198</a>
        opened by <a href="https://github.com/Spenhouet">@Spenhouet</a>
        on 2025-07-08 09:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Spenhouet">@Spenhouet</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When using namespaced editable workspace packages the grouping of the auto sorted imports does not work as expected (mixes internal and external imports).</p>
<h2>Reproduction</h2>
<ol>
<li>Download and open in VS Code:  <a href="https://github.com/user-attachments/files/21117885/ruff-bug-sort.zip">ruff-bug-sort.zip</a></li>
<li>Execute VS code Task &quot;Install Dependencies&quot;</li>
<li>Open <code>apps/qwe-web/main.py</code></li>
<li>Press save to sort (no change, as it's already sorted)</li>
</ol>
<h2>Expected Behavior</h2>
<p>The imports are grouped into standard packages, external packages and internal packages.</p>
<pre><code class="language-python">from typing import Any

from fastapi import APIRouter
from fastapi import FastAPI
from fastapi import HTTPException

from airamed.flags import feature
</code></pre>
<h2>Actual Behavior</h2>
<pre><code class="language-python">from typing import Any

from airamed.flags import feature
from fastapi import APIRouter
from fastapi import FastAPI
from fastapi import HTTPException
</code></pre>
<h2>Additional Context</h2>
<p>The issue here is related to the namespace and not directly to the editable workspace package. Without namespace the import is grouped correctly.</p>
<h2>Environment</h2>
<p>OS and version: Windows 11 with WSL and Ubuntu 20.04
Python version: 3.10.18 via uv</p>
<h3>Version</h3>
<p>ruff 0.12.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-08 13:12</div>
            <div class="timeline-body"><p>This sounds familiar to me, but I'm not turning up the right related issue at the moment. cc @dylwil3</p>
<p>You can at least work around it with the <a href="https://docs.astral.sh/ruff/settings/#lint_isort_known-first-party">known-first-party</a> option in your <code>.ruff.toml</code> file, if nothing else.</p>
<p>Here's the project layout:</p>
<pre><code>.
├── README.md
├── apps
│   └── qwe-web
│       ├── README.md
│       ├── main.py
│       ├── pyproject.toml
│       └── tests
│           ├── __init__.py
│           ├── conftest.py
│           └── test_main.py
├── components
│   └── flags
│       ├── README.md
│       ├── pyproject.toml
│       └── src
│           └── airamed
│               └── flags
│                   ├── __init__.py
│                   ├── core.py
│                   ├── py.typed
│                   └── testing.py
├── pyproject.toml
├── ruff-bug-sort.zip
├── scripts
│   ├── init.sh
│   └── install.sh
└── uv.lock
</code></pre>
<details><summary>Verbose logs</summary>

<pre><code>[2025-07-08][13:05:15][ruff::resolve][DEBUG] Using configuration file (via parent) at: /home/clod/.ruff.toml
warning: The following rules have been removed and ignoring them has no effect:
    - ANN101
    - ANN102

[2025-07-08][13:05:15][ignore::gitignore][DEBUG] opened gitignore file: /home/clod/.gitignore
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Ignored path via `exclude`: &quot;/home/clod/.vscode&quot;
[2025-07-08][13:05:15][ignore::gitignore][DEBUG] opened gitignore file: /home/clod/.ruff_cache/.gitignore
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/components/flags/src/airamed/flags/core.py&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Ignored path via `exclude`: &quot;/home/clod/.ruff_cache&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/components/flags/src/airamed/flags/testing.py&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/pyproject.toml&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/components/flags/pyproject.toml&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/components/flags/src/airamed/flags/__init__.py&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/apps/qwe-web/main.py&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/apps/qwe-web/tests/test_main.py&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/apps/qwe-web/pyproject.toml&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/apps/qwe-web/tests/__init__.py&quot;
[2025-07-08][13:05:15][ruff_workspace::resolver][DEBUG] Included path via `include`: &quot;/home/clod/apps/qwe-web/tests/conftest.py&quot;
[2025-07-08][13:05:15][ruff::commands::check][DEBUG] Identified files to lint in: 3.81885ms
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/components/flags/pyproject.toml
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/apps/qwe-web/tests/__init__.py
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/apps/qwe-web/main.py
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/components/flags/src/airamed/flags/__init__.py
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/apps/qwe-web/tests/test_main.py
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/pyproject.toml
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/components/flags/src/airamed/flags/core.py
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/apps/qwe-web/pyproject.toml
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/apps/qwe-web/tests/conftest.py
[2025-07-08][13:05:15][ruff::diagnostics][DEBUG] Checking: /home/clod/components/flags/src/airamed/flags/testing.py
[2025-07-08][13:05:15][ruff_linter::settings::types][DEBUG] Adding per-file ignores for &quot;/home/clod/apps/qwe-web/tests/__init__.py&quot; due to absolute match on &quot;(?-u)^/home/clod(?:/|/.*/)tests(?:/|/.*/).*\\.py$&quot;: {Assert, BooleanTypeHintPositionalArgument}
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'airamed.flags.core' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'airamed.flags' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'pydantic_settings' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::settings::types][DEBUG] Adding per-file ignores for &quot;/home/clod/apps/qwe-web/tests/conftest.py&quot; due to absolute match on &quot;(?-u)^/home/clod(?:/|/.*/)tests(?:/|/.*/).*\\.py$&quot;: {Assert, BooleanTypeHintPositionalArgument}
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'pytest' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'fastapi' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'pytest' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::settings::types][DEBUG] Adding per-file ignores for &quot;/home/clod/apps/qwe-web/tests/test_main.py&quot; due to absolute match on &quot;(?-u)^/home/clod(?:/|/.*/)tests(?:/|/.*/).*\\.py$&quot;: {Assert, BooleanTypeHintPositionalArgument}
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'airamed.flags.core' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'functools' as Known(StandardLibrary) (KnownStandardLibrary)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'fastapi.testclient' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'airamed.flags.testing' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'pydantic_settings' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'typing' as Known(StandardLibrary) (KnownStandardLibrary)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'typing' as Known(StandardLibrary) (KnownStandardLibrary)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'collections.abc' as Known(StandardLibrary) (KnownStandardLibrary)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'fastapi.testclient' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'fastapi' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'airamed.flags.testing' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'pytest' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'main' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'typing' as Known(StandardLibrary) (KnownStandardLibrary)
[2025-07-08][13:05:15][ruff_linter::rules::isort::categorize][DEBUG] Categorized 'fastapi' as Known(ThirdParty) (NoMatch)
[2025-07-08][13:05:15][ruff::commands::check][DEBUG] Checked 10 files in: 2.659625ms
All checks passed!
</code></pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @ntBre on 2025-07-08 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Spenhouet">@Spenhouet</a> on 2025-07-08 13:27</div>
            <div class="timeline-body"><p>Nice! Yes, adding our namespace to the <code>.ruff.toml</code> does fix that for us. As everything is under this single namespace, this is a sufficient fix for us. From my point the issue can be closed. But should you plan to improve the underlying detection, we can leave the issue open.</p>
<pre><code>[lint.isort]
known-first-party = [&quot;airamed&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-09 07:07</div>
            <div class="timeline-body"><p>What I understand is that <code>airmed</code> is a package and linked into the venv (using an editable install). Ruff can't infer this but you can tell it that <code>components/flags/src</code> is a search path root path by setting the <a href="https://docs.astral.sh/ruff/settings/#src"><code>src</code></a> setting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2025-07-09 07:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-07-24 11:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:01 UTC
    </footer>
</body>
</html>
