<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E712 fix silently breaks Pandas/Polars queries - astral-sh/ruff #9883</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>E712 fix silently breaks Pandas/Polars queries</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/9883">#9883</a>
        opened by <a href="https://github.com/david-waterworth">@david-waterworth</a>
        on 2024-02-07 21:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-02-07 21:59</div>
            <div class="timeline-body"><p>The following fragments</p>
<pre><code class="language-python">df.filter(pl.col(&quot;X&quot;)==True) # polars
df[df[&quot;X&quot;]==True] # pandas
</code></pre>
<p>are flagged as E712 violations, however the fix is invalid, and worse it silently changes the result of the query, causing subtle and hard to find errors.</p>
<pre><code class="language-python">df.filter(pl.col(&quot;X&quot;) is True) # polars
df[df[&quot;X&quot;] is True] # pandas
</code></pre>
<p>The correct fix is</p>
<pre><code class="language-python">df.filter(pl.col(&quot;X&quot;)) # polars
df[df[&quot;X&quot;]] # pandas
</code></pre>
<p>and for completeness, <code>==False</code> should be replaced by</p>
<pre><code class="language-python">df.filter(~pl.col(&quot;X&quot;)) # polars
df[~df[&quot;X&quot;]] # pandas
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-08 03:32</div>
            <div class="timeline-body"><p>I believe this fix is marked as unsafe for this reason. Did you opt-in to the fix with <code>--unsafe-fixes</code>, or do you have <code>unsafe-fixes = true</code> enabled in your project? If so, I think Ruff's behavior here is okay... I'd love to make sure we <em>don't</em> flag these at all, but at least it's not a silent breakage, and instead one that's surfaced to the user as potentially-unsafe.</p>
<p>(I'm going to merge this ticket into https://github.com/astral-sh/ruff/issues/4560 which tracks the underlying limitation.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-08 03:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/david-waterworth">@david-waterworth</a> on 2024-02-08 04:15</div>
            <div class="timeline-body"><p>@charliermarsh  I think what I probably did is manually apply the fix in vscode (i.e. right click on the squiggle generated by the ruff vscode extensions) as I defn don't have <code>--unsafe-fixes</code> set.</p>
<p>So I guess the issue here is the extension might have displayed safe and unsafe fixes in the same colour (i.e. yellow underline) or perhaps I just didn't read the message correctly. Either way that issue should be raise in the ruff vscode extension repo so I'll double check and raise it there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-08 04:25</div>
            <div class="timeline-body"><p>Ahh yeah this makes total sense. I think we have an issue for that in the VS Code extension repo: https://github.com/astral-sh/ruff-vscode/issues/342.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
