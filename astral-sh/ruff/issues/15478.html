<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suggest ternary operator in more situations - astral-sh/ruff #15478</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Suggest ternary operator in more situations</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/15478">#15478</a>
        opened by <a href="https://github.com/nickdrozd">@nickdrozd</a>
        on 2025-01-14 20:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nickdrozd">@nickdrozd</a> on 2025-01-14 20:32</div>
            <div class="timeline-body"><p>Rule <code>SIM108</code> suggests using assignment expressions (ternary operator) instead of if/else blocks. Very good. But it is only raised for assignment. Assignment expressions are great in other situations too. For example, function calls and returns:</p>
<pre><code class="language-python">def f(x, y):
    if x == 3:  # flagged as SIM108, good
        z = 4
    else:
        z = 2

    # not flagged, but could be rewritten:
    # print(y if x + y == 0 else x)
    if x + y == 0:
        print(y)
    else:
        print(x)

    # not flagged, but could be rewritten:
    # return z if x == y else 2 + z
    if x == y:
        return z
    else:
        return 2 + z
</code></pre>
<p>It would be great if <code>SIM108</code> could flag these other situations as well. Just as autofixable I think.</p>
<p>A somewhat trickier circumstance is when the branches have a function call of multiple arguments where only one argument depends on the branch:</p>
<pre><code class="language-python">def g(x, y):
    if x == 3:
        h(x, y, 5)
    else:
        h(x, y, 6)

    # could be rewritten

    h(x, y, 5 if x == 3 else 6)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Suggest assignment expressions in more situations" to "Suggest ternary operator in more situations" by @dylwil3 on 2025-01-15 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @dylwil3 on 2025-01-15 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-01-15 00:34</div>
            <div class="timeline-body"><p>The first block of examples sounds reasonable and in-scope for this rule, especially the return statement. The second block seems more controversial just in terms of style, even ignoring potential difficulties in implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @dylwil3 on 2025-01-15 00:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-15 05:06</div>
            <div class="timeline-body"><p>Thank you for the suggestion. I agree with Dylan's analysis on the provided snippets.</p>
<p>I think this rule is specifically tailored to assignment statements (as you've highlighted) and not really any general form that can be converted into a conditional expression. This will also diverge the rule from the original plugin, it might be useful to open an upstream issue regarding similar improvements.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nickdrozd">@nickdrozd</a> on 2025-01-15 15:06</div>
            <div class="timeline-body"><p>Basic motivation is that the &quot;scope&quot; of the branching should be as narrow as possible. In many cases branching only extends to selection of values, but <code>if / else</code> construction tends to pull more stuff into branch scope.</p>
<p>In the first code block, three things happen: a variable is assigned, something is printed, and a value is returned. Very simple. But because of branches, it looks more complicated. In the second block, just one thing happens: a function of three arguments is called. Again, simple. Only thing that changes is one of the function args.</p>
<p>Not everyone likes of course. Could be new check, put behind <code>--aggressive</code> flag, something like that. Personally, I just want to see all annoying stuff autofixed ðŸ˜Ž</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
