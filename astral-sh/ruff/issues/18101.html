<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`SIM905` fix is incorrect for unpacked dict arguments - astral-sh/ruff #18101</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>SIM905</code> fix is incorrect for unpacked dict arguments</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18101">#18101</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-05-14 17:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ntBre">@ntBre</a></div>
            <div class="timeline-body">Summary
<p>While reviewing <a href="https://github.com/astral-sh/ruff/pull/17454">astral-sh/ruff#17454</a> just after reviewing <a href="https://github.com/astral-sh/ruff/pull/18075">astral-sh/ruff#18075</a>, I realized that the <a href="https://docs.astral.sh/ruff/rules/split-static-string/#split-static-string-sim905">split-static-string (SIM905)</a> fix breaks when <code>**kwargs</code> are passed to <code>split</code>:</p>
<pre><code>&gt; cat &lt;&lt;EOF | ruff check --select SIM905 --diff -
d = {&quot;sep&quot;: &quot;,&quot;}

&quot;a,b,c,d&quot;.split(**{&quot;sep&quot;: &quot;,&quot;})
&quot;a,b,c,d&quot;.split(**d)
EOF
@@ -1,4 +1,4 @@
 d = {&quot;sep&quot;: &quot;,&quot;}

-&quot;a,b,c,d&quot;.split(**{&quot;sep&quot;: &quot;,&quot;})
-&quot;a,b,c,d&quot;.split(**d)
+[&quot;a,b,c,d&quot;]
+[&quot;a,b,c,d&quot;]

Would fix 2 errors.
</code></pre>
<p>The same code in Python produces <code>[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]</code> instead of <code>[&#x27;a,b,c,d&#x27;]</code>.</p>
<p>I think the root cause here is that <code>find_argument_value</code> doesn&#x27;t (or possibly can&#x27;t) resolve the starred argument, so this might affect any rule that uses it.</p>
<p>Shoutout to @vjurczenia whose careful dict handling in #17454 brought this to my attention.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-05-14 20:56</div>
            <div class="timeline-body"><p>I can take this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 21:03</div>
            <div class="timeline-body"><p>@LaBatata101 Thanks! However, I&#x27;m not sure this is really specific to SIM905 (despite what I put in the title!). I kind of want to see what others think about possibly tackling this at the level of <code>find_argument_value</code> before jumping into an implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 21:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-05-14 21:39</div>
            <div class="timeline-body"><p>For the case, <code>&quot;a,b,c,d&quot;.split(**d)</code>, there isn&#x27;t much to do I think, we can resolve the type to <code>dict</code> but we can&#x27;t know what is the dictionary value. But for the case, <code>&quot;a,b,c,d&quot;.split(**{&quot;sep&quot;: &quot;,&quot;})</code>, where we have a <code>dict</code> literal, I think <code>find_argument_value</code> could lookup the name in the dictionary keys and return the value of that key.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-15 13:53</div>
            <div class="timeline-body"><p>Yeah that&#x27;s a good point. I guess I&#x27;m  wondering if we need to return a <code>Result&lt;Option&lt;&amp;Expr&gt;&gt;</code> instead of just an <code>Option</code>,  or something like that. Some way to indicate a situation where we don&#x27;t know if an argument is present, so it&#x27;s not really safe to proceed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LaBatata101">@LaBatata101</a> on 2025-05-15 19:36</div>
            <div class="timeline-body"><blockquote>
<p>Some way to indicate a situation where we don&#x27;t know if an argument is present, so it&#x27;s not really safe to proceed.</p>
</blockquote>
<p>Isn&#x27;t that the purpose of <code>Option</code>?</p>
<p>It would make sense to wrap in a <code>Result</code> if the operation could fail, but that&#x27;s not the case here, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-15 19:40</div>
            <div class="timeline-body"><p>Well we already have one <code>Option</code> here with <code>Some</code> for &quot;we know the argument is present&quot; and <code>None</code> for &quot;we know the argument is <em>not</em> present.&quot; The <code>Result::Err</code> case would be for cases where we aren&#x27;t sure. But yes, it probably makes more sense just to have a separate three-variant enum than mix in a <code>Result</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:56 UTC
    </footer>
</body>
</html>
