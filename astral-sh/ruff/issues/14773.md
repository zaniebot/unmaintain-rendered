```yaml
number: 14773
title: Ban urllib.parse.urljoin (security issue and confusing name)
type: issue
state: open
author: ashrub-holvi
labels:
  - rule
  - needs-decision
assignees: []
created_at: 2024-12-04T15:50:42Z
updated_at: 2024-12-10T06:36:57Z
url: https://github.com/astral-sh/ruff/issues/14773
synced_at: 2026-01-10T01:56:54Z
```

# Ban urllib.parse.urljoin (security issue and confusing name)

---

_Issue opened by @ashrub-holvi on 2024-12-04 15:50_

Hi, idea for the rule - ban `urllib.parse.urljoin`, there are two issue with it:
1. [Docs](https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urljoin) says:
> Warning Because an absolute URL may be passed as the url parameter, it is generally not secure to use urljoin with an attacker-controlled url. For example in, urljoin("https://website.com/users/", username), if username can contain an absolute URL, the result of urljoin will be the absolute URL.
2. Behaviour is far away from what you might expect from `join` function (for example base on `join` method for strings), it's some merging/overlaying/mixing of two urls, see also [here](https://stackoverflow.com/questions/10893374/python-confusions-with-urljoin).
```
>>> from urllib.parse import urljoin
>>> urljoin("https://astral.sh/", "https://hackme.co")
'https://hackme.co'
```

I guess it's easy to ban it by
```
[lint.flake8-tidy-imports.banned-api]
"urllib.parse.urljoin".msg = "Use yarl's URL"
```
but same time you need to get know somehow about the issue, it's hidden by the function name, so, perhaps good to have a rule.

---

_Comment by @ashrub-holvi on 2024-12-04 18:17_

Another option might be - forbid to use it directly, without proper alias like `merge_urls` which will make it more clear.
Same thing I want to have for `random` - if it always would be used as `preudorandom` (same for functions - `preudorand` etc) it will be difficult to use it in any crypto/security code.

---

_Label `rule` added by @AlexWaygood on 2024-12-05 01:14_

---

_Label `needs-decision` added by @AlexWaygood on 2024-12-05 01:14_

---

_Comment by @ashrub-holvi on 2024-12-06 07:16_

Looking to [this answer](https://stackoverflow.com/a/10893427) the right name would be something like
```
get_url_after_click(current_url, link)
```

---

_Comment by @andreymal on 2024-12-06 11:03_

> (for example base on `join` method for strings)

Compare with `os.path.join` instead, and you'll notice this is expected behavior:

```
>>> from os.path import join
>>> join(r'C:\astral\sh', r'D:\hackme\co') 
'D:\\hackme\\co'
>>> join(r'C:\some\more', r'\thing')  
'C:\\thing'
```

---

_Comment by @ashrub-holvi on 2024-12-09 07:27_

> Compare with `os.path.join` instead, and you'll notice this is expected behaviour:

I don't think it's expected for functions named "join", both are consistently confusing and should be banned.


---

_Comment by @ashrub-holvi on 2024-12-09 09:22_

`os.path.join` sort of banned by [this rule](https://docs.astral.sh/ruff/rules/os-path-join/), of course `pathlib` has same behaviour, but at least it's not named "join"

---

_Comment by @andreymal on 2024-12-09 09:33_

[Path.joinpath](https://docs.python.org/3/library/pathlib.html#pathlib.PurePath.joinpath) Â¯\\\_(ãƒ„)_/Â¯

---

_Comment by @ashrub-holvi on 2024-12-09 09:39_

> [Path.joinpath](https://docs.python.org/3/library/pathlib.html#pathlib.PurePath.joinpath) Â¯\_(ãƒ„)_/Â¯

I mean main usage is `/`, not method call

---

_Comment by @ashrub-holvi on 2024-12-09 16:22_

and I hope for `pathlib` it can be solved by creating more strict subclass of Path which will fail if second arg is absolute, like yarl.URL does.

---

_Comment by @akx on 2024-12-09 19:54_

> [Path.joinpath](https://docs.python.org/3/library/pathlib.html#pathlib.PurePath.joinpath) Â¯\_(ãƒ„)_/Â¯

... does not do the right thing here ðŸ˜„ See what happens to slashes...

```
>>> pathlib.Path("https://astral.sh/").joinpath("https://hackme.co")
WindowsPath('https:/astral.sh/https:/hackme.co')
>>> pathlib.PurePath("https://astral.sh/").joinpath("https://hackme.co")
PureWindowsPath('https:/astral.sh/https:/hackme.co')
>>> pathlib.PurePosixPath("https://astral.sh/").joinpath("https://hackme.co")
PurePosixPath('https:/astral.sh/https:/hackme.co')
```

---

_Comment by @andreymal on 2024-12-09 22:20_

@akx this is absolutely the right thing at least for posix paths (source: [POSIX.1-2017 / Base Definitions / 3.271 Pathname](https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html#tag_03_271))

---

_Comment by @akx on 2024-12-10 06:36_

Absolutely! Sorry, I was thinking you meant `Path()` could be the right thing to use for joining URLs. Never mind me...

---

_Referenced in [aio-libs/yarl#2](../../aio-libs/yarl/issues/2.md) on 2024-12-18 09:35_

---
