<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New rule from `SonarQube`: python:S1244 - astral-sh/ruff #20579</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>New rule from <code>SonarQube</code>: python:S1244</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/20579">#20579</a>
        opened by <a href="https://github.com/chirizxc">@chirizxc</a>
        on 2025-09-25 18:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chirizxc">@chirizxc</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>From <a href="https://cloud-ci.sgs.com/sonar/coding_rules?open=python%3AS1244&amp;rule_key=python%3AS1244">SonarQube</a>:</p>
<p>This rule raises an issue when direct and indirect equality/inequality checks are made on floats.</p>
<p>Floating point math is imprecise because of the challenges of storing such values in a binary representation.</p>
<p>In base 10, the fraction <code>1/3</code> is represented as <code>0.333…​</code> which, for a given number of significant digit, will never exactly be <code>1/3</code>. The same problem happens when trying to represent <code>1/10</code> in base 2, with leads to the infinitely repeating fraction <code>0.0001100110011…​</code>. This makes floating point representations inherently imprecise.</p>
<p>Even worse, floating point math is not associative; push a float through a series of simple mathematical operations and the answer will be different based on the order of those operation because of the rounding that takes place at each step.</p>
<p>Even simple floating point assignments are not simple, as can be vizualized using the format function to check for significant digits:</p>
<pre><code class="language-python">&gt;&gt;&gt; format(0.1, &quot;.17g&quot;)
'0.10000000000000001'
</code></pre>
<p>This can also be vizualized as a fraction using the as_integer_ratio method:</p>
<pre><code class="language-python">&gt;&gt;&gt; my_float = 0.1
&gt;&gt;&gt; numerator, denominator = my_float.as_integer_ratio()
&gt;&gt;&gt; f&quot;{numerator} / {denominator}&quot;
'3602879701896397 / 36028797018963968'
</code></pre>
<p>Therefore, the use of the equality (==) and inequality (!=) operators on float values is almost always erroneous.</p>
<p>Fixes:</p>
<pre><code class="language-diff">+ import math
+
 def foo(a, b):
-    return a == b - 0.1
+    return math.isclose(a, b - 0.1, rel_tol=1e-09, abs_tol=1e-09)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-09-25 18:43</div>
            <div class="timeline-body"><p>I can try to implement this rule, but to which of the rule code can it be assigned?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chirizxc">@chirizxc</a> on 2025-09-25 18:46</div>
            <div class="timeline-body"><p>Duplicate of: https://github.com/astral-sh/ruff/issues/18154, https://github.com/astral-sh/ruff/issues/14220</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-25 19:29</div>
            <div class="timeline-body"><p>Thanks for finding the older issues, I'll go ahead and close this in favor of #14220 to keep the discussion in one place. #14220 is labeled <code>type-inference</code>, but we could consider adding a version that relies on our basic type inference for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-25 19:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:22 UTC
    </footer>
</body>
</html>
