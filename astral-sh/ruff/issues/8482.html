<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better documentation of unsafe fixes - astral-sh/ruff #8482</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better documentation of unsafe fixes</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8482">#8482</a>
        opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a>
        on 2023-11-03 22:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2023-11-03 22:34</div>
            <div class="timeline-body"><p>It would be nice if it was easier to figure out what checks have unsafe fixes, e.g. maybe there could be a different icon next to the rules in https://docs.astral.sh/ruff/rules/</p>
<p>It would also be nice if the per-rule documentation also mentioned why the fix is unsafe. E.g. for https://docs.astral.sh/ruff/rules/unnecessary-comprehension/ I'm left guessing, is it because ruff will apply the fix even when <code>dict</code> is bound to something else (edit: maybe because cases where we unpack we now lose errors)?</p>
<p>(For some user context: on a lot of our code, we only run ruff for autofixes and do not report errors for unfixable lints. Autofixing is a killer feature)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-03 23:51</div>
            <div class="timeline-body"><p>Yeah that's a nice idea. We've started doing this in some places via a &quot;Known problems&quot; section. I'll try to get the remaining rules covered next week.</p>
<p>(If helpful, you can also set <code>unsafe-fixes = true</code> in your configuration file to get the same behavior as before we shipped the applicability settings -- but I assume you're asking because you want to know which rules you should be fixing vs. not :))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2023-11-03 23:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-11-03 23:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2023-11-04 19:55</div>
            <div class="timeline-body"><p>There's some overlap in the ideas from my comment in https://github.com/astral-sh/ruff/issues/8075#issuecomment-1783877479 so I'll copy here as well:</p>
<blockquote>
<p>On the rule page itself, I think you could have:
&quot;Fix is always available&quot; / &quot;Fix is sometimes available&quot; / (no fix available)
and separately mention that &quot;Some fixes are marked <a href="https://docs.astral.sh/ruff/linter/#fix-safety">unsafe</a> by default&quot;</p>
<p>I don't think it's necessary to mention that &quot;All fixes are unsafe&quot;. But at a user I wouldn't mind being a touch more exact. As long as it is show that I need to run <code>--unsafe-fixes</code> to get all the available fixes.</p>
<hr />
<p>As for the &quot;all rules&quot; page.
You could differentiate between &quot;sometimes autofixable&quot; and &quot;always autofixable&quot; with üî® or üîß, it's visually just üõ†Ô∏è but with a tool missing. I personally quite like that.</p>
<p>As fox fix safety, I'm less certain of the best way to display that / convey the information concisely. I think that adding a column should be fine.
The first thing that comes to mind is ‚ö†Ô∏è, but it looks out of place/scary even when grayed out:
<img src="https://github.com/astral-sh/ruff/assets/1350584/130736c3-d225-4c7b-bb66-bc940967a8ac" alt="image" />
Other suggestions may include ‚Åâ, üö¶, or just annotating the autofix with <code>*</code>, or even get fancy with it with a set-width column (or a 0-width element translated to the right position):
<img src="https://github.com/astral-sh/ruff/assets/1350584/b07547c7-781f-4a32-b491-99cf37e475d2" alt="image" /></p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-28 18:42</div>
            <div class="timeline-body"><p>Please let us know if there's a rule with an unsafe fix that is not explained in the documentation, we can start tracking adding documentation at least.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2023-11-29 05:20</div>
            <div class="timeline-body"><p>Rule with unsafe fix that caused me to open this issue was C416. I'll post on here as I notice others :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sh-at-cs">@sh-at-cs</a> on 2023-11-29 09:18</div>
            <div class="timeline-body"><p>Why the fix is unsafe is not explained for <a href="https://docs.astral.sh/ruff/rules/non-pep604-annotation/"><code>UP007</code></a>, as mentioned in #8868.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-30 01:34</div>
            <div class="timeline-body"><p>(Adding docs for those rules now.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-30 01:52</div>
            <div class="timeline-body"><p>Done in #8918.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2023-12-17 22:08</div>
            <div class="timeline-body"><p>A few more unsafe fixes that could use docs:</p>
<ul>
<li>[x] UP028</li>
<li>[x] PERF102</li>
<li>[x] PT014</li>
<li>[x] PYI025</li>
<li>[x] PLR6201</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-12-18 03:37</div>
            <div class="timeline-body"><p>I think UP028 <em>might</em> be safe except in very rare circumstances. I'm trying to come up with an example in which the modification could lead to a breaking change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/notatallshaw-gts">@notatallshaw-gts</a> on 2024-01-02 18:46</div>
            <div class="timeline-body"><blockquote>
<p>I think UP028 <em>might</em> be safe except in very rare circumstances. I'm trying to come up with an example in which the modification could lead to a breaking change.</p>
</blockquote>
<p>Sure, when the generator is being sent values (and discarding them) but it's yielding values from an iterator it is an unsafe fix.</p>
<p>E.g. this code works fine:</p>
<pre><code class="language-python">def foo():
    for x in range(10):
        yield x

gen_foo = foo()
next(gen_foo)
gen_foo.send(10)
</code></pre>
<p>But UP028 fixes is to this:</p>
<pre><code class="language-python">def foo():
    yield from range(10)

gen_foo = foo()
next(gen_foo)
gen_foo.send(10)
</code></pre>
<p>Which throws the exception:</p>
<pre><code>Traceback (most recent call last):
  File &quot;yield_example.py&quot;, line 7, in &lt;module&gt;
    gen_foo.send(10)
  File &quot;yield_example.py&quot;, line 2, in foo
    yield from range(10)
AttributeError: 'range_iterator' object has no attribute 'send'
</code></pre>
<p>Now, there probably should be some rule about sending to a generator that doesn't read the values. But I'm sure someone has some code somewhere that does this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-02 18:50</div>
            <div class="timeline-body"><p>@notatallshaw-gts - thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-01-29 17:31</div>
            <div class="timeline-body"><p>Okay, all of the enumerated rules in the issue have either been documented or are being prompted to safe in v0.2.0. Going forward, I'm also ensuring that all unsafe fixes are included in the rule documentation for new fixes and rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-01-29 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sh-at-cs">@sh-at-cs</a> on 2024-08-20 10:55</div>
            <div class="timeline-body"><p>I don't know if it's fine to comment here or if I should open a new issue, but <a href="https://docs.astral.sh/ruff/rules/multiple-with-statements/">SIM117's docs</a> don't have a &quot;Fix safety&quot; section, even though the fix for it seems to only get activated when enabling unsafe fixes. So it would be good if such a section was added.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:53 UTC
    </footer>
</body>
</html>
