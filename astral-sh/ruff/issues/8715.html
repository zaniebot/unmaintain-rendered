<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruff Jupiter notebook removes imports in separate block from use - astral-sh/ruff #8715</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ruff Jupiter notebook removes imports in separate block from use</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8715">#8715</a>
        opened by <a href="https://github.com/Matt-Ord">@Matt-Ord</a>
        on 2023-11-16 09:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Matt-Ord">@Matt-Ord</a></div>
            <div class="timeline-body"><p>Notebook</p>
<pre><code>{
    &quot;cells&quot;: [
        {
            &quot;cell_type&quot;: &quot;code&quot;,
            &quot;execution_count&quot;: 1,
            &quot;id&quot;: &quot;840d65b4-53dd-4ee6-a5a6-e57293fabd2c&quot;,
            &quot;metadata&quot;: {
                &quot;editable&quot;: true,
                &quot;slideshow&quot;: {
                    &quot;slide_type&quot;: &quot;&quot;
                },
                &quot;tags&quot;: []
            },
            &quot;outputs&quot;: [],
            &quot;source&quot;: [
                &quot;import numpy as np &quot;
            ]
        },
        {
            &quot;cell_type&quot;: &quot;code&quot;,
            &quot;execution_count&quot;: 2,
            &quot;id&quot;: &quot;8c74da64-4991-4501-8c88-1262e59e256e&quot;,
            &quot;metadata&quot;: {
                &quot;editable&quot;: true,
                &quot;slideshow&quot;: {
                    &quot;slide_type&quot;: &quot;&quot;
                },
                &quot;tags&quot;: []
            },
            &quot;outputs&quot;: [],
            &quot;source&quot;: [
                &quot;# The matrix we want to block-encode\n&quot;,
                &quot;matrix_1 = np.array([[1, 1], [1, -1]])&quot;
            ]
        }
    ],
    &quot;metadata&quot;: {
        &quot;kernelspec&quot;: {
            &quot;display_name&quot;: &quot;Python 3 (ipykernel)&quot;,
            &quot;language&quot;: &quot;python&quot;,
            &quot;name&quot;: &quot;python3&quot;
        },
        &quot;language_info&quot;: {
            &quot;codemirror_mode&quot;: {
                &quot;name&quot;: &quot;ipython&quot;,
                &quot;version&quot;: 3
            },
            &quot;file_extension&quot;: &quot;.py&quot;,
            &quot;mimetype&quot;: &quot;text/x-python&quot;,
            &quot;name&quot;: &quot;python&quot;,
            &quot;nbconvert_exporter&quot;: &quot;python&quot;,
            &quot;pygments_lexer&quot;: &quot;ipython3&quot;,
            &quot;version&quot;: &quot;3.11.6&quot;
        }
    },
    &quot;nbformat&quot;: 4,
    &quot;nbformat_minor&quot;: 5
}
</code></pre>
<p>Vscode settings.json</p>
<pre><code>{
	&quot;notebook.formatOnSave.enabled&quot;: true,
	&quot;notebook.codeActionsOnSave&quot;: {
		&quot;source.fixAll&quot;: true,
		&quot;source.organizeImports&quot;: true
	},
	&quot;[python]&quot;: {
		&quot;editor.defaultFormatter&quot;: &quot;charliermarsh.ruff&quot;
	},
	&quot;editor.formatOnSave&quot;: true,
	&quot;editor.codeActionsOnSave&quot;: {
	         &quot;source.fixAll&quot;: true,
	         &quot;source.organizeImports&quot;: true
	},
	&quot;python.analysis.typeCheckingMode&quot;: &quot;basic&quot;,
	&quot;python.analysis.diagnosticMode&quot;: &quot;workspace&quot;
}
</code></pre>
<p>using an empty pyproject.toml
when saving the notebook the import <code>numpy as np</code> block is removed
ruff version 0.1.5</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-16 17:36</div>
            <div class="timeline-body"><p>üëç I believe this is a known problem that we&#x27;re working on. It&#x27;s tracked in the LSP repository, so I&#x27;ll merge into that issue: <a href="https://github.com/astral-sh/ruff-lsp/issues/320">astral-sh/ruff-lsp#320</a>.</p>
<p>I think that if you use the <code>Ruff:</code> specific versions of these commands, we avoid this issue since it runs over the whole notebook rather than the cell, but we do plan to fix this:</p>
<img alt="Screen Shot 2023-11-16 at 12 36 10 PM" src="https://github.com/astral-sh/ruff/assets/1309177/2a7f9f7f-d472-4a6e-97f5-0beeb755fb26">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-16 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-16 17:36</div>
            <div class="timeline-body"><p>\cc @dhruvmanila for visibility</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:45 UTC
    </footer>
</body>
</html>
