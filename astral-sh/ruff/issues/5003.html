<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F821 False Positive when using equivalent script characters - astral-sh/ruff #5003</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>F821 False Positive when using equivalent script characters</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/5003">#5003</a>
        opened by <a href="https://github.com/TizzySaurus">@TizzySaurus</a>
        on 2023-06-10 12:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/TizzySaurus">@TizzySaurus</a> on 2023-06-10 12:02</div>
            <div class="timeline-body"><p>Bug: Ruff incorrectly treats characters from other scripts as different, resulting in a F821 undefined name.
This is possibly related to #942.</p>
<pre><code class="language-python">ğ’ = 500
print(ğ’)
print(C + ğ’)  # ruff says `C` isn't defined
print(C / ğ’)
print(C == ğ‘ª == ğ’ == ğ“’ == ğ•®)  # ruff says `C`, `ğ‘ª`, ... isn't defined
</code></pre>
<p>The above code, albeit somewhat funky, is actually perfectly valid python code and runs successfully, due to how Python handles different script characters (it treats equivalent characters from different scripts as the same at runtime).</p>
<p>However, it appears that ruff (somewhat understandably) doesn't like this, and errors stating that <code>C</code>, etc. isn't defined.</p>
<p>Ruff should realise that these characters are equivalent at runtime, and not error stating that they're undefined.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-10 14:44</div>
            <div class="timeline-body"><p>Woah, whaaaaaat? I've never seen this.</p>
<p>I understand that these are the language semantics, but just to help illustrate the issue, do you have a realistic example of where this is used &quot;in the wild&quot;?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-06-10 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-06-10 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-06-10 15:02</div>
            <div class="timeline-body"><p>FWIW, <code>pyright</code> and <code>mypy</code> understands them correctly and another interesting note is that the error message specifies that &quot;C&quot; is undefined (instead of the actual character) once you remove the assignment statement:</p>
<pre><code>mypy: Name &quot;C&quot; is not defined
Pyright: &quot;C&quot; is not defined [reportUndefinedVariable]
Ruff: Undefined name `ğ’` [F821]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @charliermarsh on 2023-06-10 15:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TizzySaurus">@TizzySaurus</a> on 2023-06-11 13:11</div>
            <div class="timeline-body"><blockquote>
<p>do you have a realistic example of where this is used &quot;in the wild&quot;?
Not really ğŸ˜…</p>
</blockquote>
<p>It's very much a &quot;quirk&quot; of the language that the vast majority of people aren't even aware of, and I'm not aware of a practical use case for it -- although it is quite a nice thing that Python supports multiple scripts, being (afaik) the only mainstream language to do so.</p>
<p>I came across this feature of Python years ago, and realised Ruff specifically doesn't like it when messing with some esoteric (deliberately unreadable and obfuscated) code yesterday.</p>
<p>Figured that if other linters both support this behaviour and correctly report which variable is undefined etc., then &quot;why can't ruff?&quot;, hence the creation of this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-12 00:25</div>
            <div class="timeline-body"><p>Makes sense. We <em>should</em> support it, and I don't think it's <em>too</em> hard to do so, but I also consider it low priority for now :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10381.html">astral-sh/ruff#10381</a> on 2024-03-13 12:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10412.html">astral-sh/ruff#10412</a> on 2024-03-14 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-03-18 11:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/covracer">@covracer</a> on 2024-03-29 23:48</div>
            <div class="timeline-body"><p>In case anyone wants to read more about Python's NFKC normalization for characters above 0x7f: https://peps.python.org/pep-3131/</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
