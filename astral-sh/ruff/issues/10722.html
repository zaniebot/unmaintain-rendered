<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Linter panic] related to cache, cannot provide repro - astral-sh/ruff #10722</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Linter panic] related to cache, cannot provide repro</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10722">#10722</a>
        opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a>
        on 2024-04-01 18:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hauntsaninja">@hauntsaninja</a></div>
            <div class="timeline-body"><p>With ruff 0.3.5</p>
<p>Possibly related to the &quot;Different package root in cache&quot; warning immediately prior.</p>
<p>I think I could repro deterministically, but then I wiped cache and no longer could reproduce.</p>
<pre><code>warning: Different package root in cache: expected '/Users/shantanu/devoai/openai/project/REDACTED/REDACTEDPROJ', got '/Users/shantanu/devoai/openai/project/REDACTED/REDACTED/PROJ'
error: Panicked while linting project/REDACTED/REDACTEDPROJ/pyproject.toml: This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BLinter%20panic%5D

...with the relevant file contents, the `pyproject.toml` settings, and the following stack trace, we'd be very appreciative!

panicked at crates/ruff/src/diagnostics.rs:198:18:
wrong package cache for file
Backtrace:    0: std::backtrace::Backtrace::force_capture
   1: &lt;ruff::panic::PanicError as core::fmt::Display&gt;::fmt
   2: std::panicking::rust_panic_with_hook
   3: &lt;std::panicking::begin_panic_handler::StaticStrPayload as core::panic::PanicPayload&gt;::take_box
   4: &lt;std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display&gt;::fmt
   5: _rust_begin_unwind
   6: core::panicking::panic_fmt
   7: core::option::expect_failed
   8: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
   9: &lt;ruff::panic::PanicError as core::fmt::Display&gt;::fmt
  10: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  11: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  12: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  13: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  14: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  15: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  16: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  17: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  18: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  19: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  20: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  21: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  22: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  23: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  24: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  25: rayon_core::registry::WorkerThread::wait_until_cold
  26: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  27: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  28: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  29: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  30: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  31: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  32: rayon_core::registry::WorkerThread::wait_until_cold
  33: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  34: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  35: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  36: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  37: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  38: rayon_core::registry::WorkerThread::wait_until_cold
  39: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  40: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  41: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  42: rayon_core::registry::WorkerThread::wait_until_cold
  43: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  44: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  45: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  46: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  47: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  48: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  49: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  50: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  51: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  52: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  53: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  54: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  55: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  56: rayon_core::registry::WorkerThread::wait_until_cold
  57: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  58: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  59: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  60: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  61: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  62: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  63: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  64: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  65: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  66: rayon_core::registry::WorkerThread::wait_until_cold
  67: &lt;ruff::args::LogLevelArgs as clap_builder::derive::Args&gt;::augment_args
  68: &lt;ruff::version::VersionInfo as core::fmt::Display&gt;::fmt
  69: &lt;ruff::diagnostics::FixMap as core::ops::arith::AddAssign&gt;::add_assign
  70: rayon_core::registry::WorkerThread::wait_until_cold
  71: rayon_core::registry::ThreadBuilder::run
  72: &lt;rayon_core::unwind::AbortIfPanic as core::ops::drop::Drop&gt;::drop
  73: &lt;rayon_core::registry::WorkerThread as core::convert::From&lt;rayon_core::registry::ThreadBuilder&gt;&gt;::from
  74: std::sys::pal::unix::thread::Thread::new
  75: __pthread_joiner_wake
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 18:17</div>
            <div class="timeline-body"><p>Just thinking about what this could be... Do you use the <code>namespace-packages</code> setting?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-04-01 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 18:17</div>
            <div class="timeline-body"><p>(Were you upgrading from v0.3.4?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-04-01 18:33</div>
            <div class="timeline-body"><p>No use of <code>namespace-packages</code>. I'm not sure what I was upgrading from, could have been v0.3.4, another possibility is v0.2.2?</p>
<p>Note I found the first line pretty interesting: <code>warning: Different package root in cache: expected '/Users/shantanu/devoai/openai/project/REDACTED/REDACTEDPROJ', got '/Users/shantanu/devoai/openai/project/REDACTED/REDACTED/PROJ'</code></p>
<p>It looks like there was some package refactoring on our side that maybe the cache isn't resilient to</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-09-26 06:24</div>
            <div class="timeline-body"><p>@hauntsaninja did you ever run into this again or has this been resolved?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-09-26 06:30</div>
            <div class="timeline-body"><p>Ah I think I actually reported this at some other point with a clear repro and we fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @hauntsaninja on 2024-09-26 06:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-09-26 06:31</div>
            <div class="timeline-body"><p>https://github.com/astral-sh/ruff/issues/12158#issuecomment-2204761724</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:59 UTC
    </footer>
</body>
</html>
