<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test_generate_json_schema failing as of 0.9.2 - astral-sh/ruff #15707</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>test_generate_json_schema failing as of 0.9.2</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/15707">#15707</a>
        opened by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a>
        on 2025-01-24 03:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/WhyNotHugo">@WhyNotHugo</a></div>
            <div class="timeline-body">Description
<p>As of 0.9.2, the test_generate_json_schema test fails when building from source. Of note, we build with the default features.</p>
<p>Full build output is here: https://paste.sr.ht/~whynothugo/41004049e3a4f9d2098bec4593a68fd949bd5cd4</p>
<p>The output for this specific test starts at <a href="https://paste.sr.ht/~whynothugo/41004049e3a4f9d2098bec4593a68fd949bd5cd4#ruff-0.9.3.log-L1816">line 1816</a> and is 4251 lines long.</p>
<p>This error is produced when building the Alpine packages. The build steps can be summarised as:</p>
<pre><code># prepare()
# shadow git repo for tests
git init -q

# Avoid downloading a different toolchain on systems with rustup installed.
rm rust-toolchain.toml

cargo fetch --locked

# build()
gpep517 build-wheel \
        --wheel-dir .dist \
        --config-json &#x27;{&quot;build-args&quot;: &quot;--frozen&quot;}&#x27; \
        --output-fd 3 3&gt;&amp;1 &gt;&amp;2

./target/release/ruff generate-shell-completion bash &gt; $pkgname.bash
./target/release/ruff generate-shell-completion fish &gt; $pkgname.fish
./target/release/ruff generate-shell-completion zsh &gt; $pkgname.zsh

# Update ruff.schema.json as the pre-built one is generated
# using the &#x27;--all-features&#x27; Cargo flag which we don&#x27;t pass.
cargo dev generate-all

# check()
unset CI_PROJECT_DIR
cargo test --frozen --workspace --exclude ruff_benchmark
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-24 04:16</div>
            <div class="timeline-body"><p><a href="https://paste.sr.ht/~whynothugo/41004049e3a4f9d2098bec4593a68fd949bd5cd4#ruff-0.9.3.log-L5474">Line 5474</a> is the one in question:</p>
<pre><code>5472 |          &quot;PLW01&quot;,
5473 |          &quot;PLW010&quot;,
5474 | [32m&gt;        &quot;PLW0101&quot;,[0m
5475 |          &quot;PLW0108&quot;,
5476 |          &quot;PLW012&quot;,
</code></pre>
<p><code>PLW0101</code> was added in #10801. Its implementation turned out to have an infinite loop bug, which was reported in #15248. #15252 then made it a test-only rule, adding <a href="https://github.com/astral-sh/ruff/pull/15252/files#diff-6aee1fd915e8ed29e72aa56560f2b15b8abc4168dc73a8b40afe516b08572a94R369">these attributes</a>:</p>
<pre><code>#[cfg(any(feature = &quot;test-rules&quot;, test))]  // &lt; !!!
if checker.enabled(Rule::UnreachableCode) {
    /* ... */
}
</code></pre>
<p>#15278 fixed the issue, but did not revert the attributes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 04:20</div>
            <div class="timeline-body"><p>This will be fixed with <a href="https://github.com/astral-sh/ruff/pull/15627">astral-sh/ruff#15627</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/dhruvmanila">@dhruvmanila</a> by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 04:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 04:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-24 04:25</div>
            <div class="timeline-body"><p>@dhruvmanila I don&#x27;t think so. #15278 fixed <code>PLW0101</code>, so the correct thing to do is perhaps to repromote it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 04:28</div>
            <div class="timeline-body"><p>I don&#x27;t think we&#x27;re sure of promoting it yet, so for now we should just fix the JSON schema generation. cc @dylwil3 who&#x27;s taking the lead on this specific issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/InSyncWithFoo">@InSyncWithFoo</a> on 2025-01-24 04:33</div>
            <div class="timeline-body"><p>Now that I rechecked it, @dylwil3 <a href="https://github.com/astral-sh/ruff/pull/15278#pullrequestreview-2537389009">did say</a> that the rule should be kept in test-only realm:</p>
<blockquote>
<p>Added the latest example from the fuzzer, which passes. So let&#x27;s merge this in and continue to test this rule and improve the CFG implementation.</p>
</blockquote>
<p>It has been two weeks since then, though, and there don&#x27;t seem to be any new issues. Maybe it&#x27;s time?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 04:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-01-24 04:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WhyNotHugo">@WhyNotHugo</a> on 2025-01-24 04:53</div>
            <div class="timeline-body"><p>Thanks for the quick fix!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:21 UTC
    </footer>
</body>
</html>
