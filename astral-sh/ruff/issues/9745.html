<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow newlines after block open (or not) - astral-sh/ruff #9745</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow newlines after block open (or not)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9745">#9745</a>
        opened by <a href="https://github.com/vaughnkoch">@vaughnkoch</a>
        on 2024-01-31 17:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vaughnkoch">@vaughnkoch</a></div>
            <div class="timeline-body"><p>Hi, I'm opening this issue per a suggestion from @MichaReiser, based on this closed issue: https://github.com/astral-sh/ruff/issues/8893.</p>
<p>The formatting question is whether Ruff should automatically remove a blank line after a block definition:</p>
<pre><code>def some_func():

    some_more_code()
</code></pre>
<p>to</p>
<pre><code>def some_func():
    some_more_code()
</code></pre>
<p>The alternative is &quot;allow zero or one&quot; newlines, i.e. not to remove the newline if it exists, but also not to automatically add one. This is the approach that Black chose in their 2024 preview style. Full Black discussion here: https://github.com/psf/black/issues/4043.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2024-01-31 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">style</span> added by @MichaReiser on 2024-01-31 17:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cbandera">@cbandera</a> on 2024-02-23 12:16</div>
            <div class="timeline-body"><p>Yes I can second this request as well. While investigating the transition to ruff, this inconsistency to black is causing many changes across our code base.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-02-23 12:28</div>
            <div class="timeline-body"><blockquote>
<p>Yes I can second this request as well. While investigating the transition to ruff, this inconsistency to black is causing many changes across our code base.</p>
</blockquote>
<p>Thanks for reporting. Do you mainly mind that there are many differences or did you prefer black's formatting? Would you be able to share some examples where you preferred black's formatting over ruff's?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cbandera">@cbandera</a> on 2024-02-23 12:52</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>Yes I can second this request as well. While investigating the transition to ruff, this inconsistency to black is causing many changes across our code base.</p>
</blockquote>
<p>Thanks for reporting. Do you mainly mind that there are many differences or did you prefer black's formatting? Would you be able to share some examples where you preferred black's formatting over ruff's?</p>
</blockquote>
<p>For me it's mainly about the diff that is created. Working in a big monorepo, it's always easier for us toolies to roll out changes if we don't need to touch the other devs code. Having read that <code>ruff</code> would be a &quot;drop-in&quot; replacement for <code>black</code>, my expectation was that I would see no diff at all.</p>
<p>Having said that and after looking at the <a href="https://docs.astral.sh/ruff/formatter/black/">known deviations</a> I can't say that I don't agree with ruff's design decisions though...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chicheng">@chicheng</a> on 2024-03-27 15:27</div>
            <div class="timeline-body"><p>Hi, yes please add an option to preserve up to 1 empty line.</p>
<p>As empty lines used for separating/grouping lines, the first line(s) stay closer to block head but not the remaining parts feel like it's part of the block head (since empty line inside block content is inevitable), e.g.</p>
<pre><code>block head
   part of block head

   block content
   block content
   block content

   block content
   block content
</code></pre>
<p>so I prefer to read as</p>
<pre><code>block head

   block content
   block content
   block content

   block content
   block content
</code></pre>
<p>Personally I always insert an empty line at the beginning of the block, except 2 scenarios:</p>
<pre><code class="language-python">class B(A):

    def single_line(self):    # an empty line after `class B`, because single_line() is not closer to B than other methods
        return something    # Two exceptions that no empty line after `def instance_methods():`: 1. one liner, otherwises a few one lines consecutively will feel strange as there are equal space between block head and content and next block head and content

    def override_super(self):
        super().override_super()    # 2. `super()...` call (easier to tell whether non-one-liner class method called super or not? just personal preference probably)

        remaining_codes = ...

    def function(
        self, data: torch.Tensor | tuple[torch.Tensor, ...], other_argument: int
    ) -&gt; torch.Tensor | tuple[torch.Tensor, ...]:
        something = do_something(data)    # An empty line above please, this line is part of method body, not head. borrowed from black issue comment

        return something
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alechouse97">@alechouse97</a> on 2024-05-30 19:13</div>
            <div class="timeline-body"><p>Any updates on this? This is one the last remaining issues for ruff to finally replace black in my workflow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/michaelhball">@michaelhball</a> on 2024-07-11 09:03</div>
            <div class="timeline-body"><p>Also checking in to say the same as above, I think this is our last remaining &quot;issue&quot; with ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dcnadler">@dcnadler</a> on 2024-08-01 20:29</div>
            <div class="timeline-body"><blockquote>
<p>Yes I can second this request as well. While investigating the transition to ruff, this inconsistency to black is causing many changes across our code base.</p>
</blockquote>
<p>Agreed, this is what's blocking us from adopting Ruff. Too many diffs - not a &quot;drop-in&quot;.</p>
<p>Looking forward to updates, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thclark">@thclark</a> on 2024-09-13 14:17</div>
            <div class="timeline-body"><p>From the perspective of someone with dyslexia; this really makes code harder to read - I need whitespace around the block to help parse what's in it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/plynch-chwy">@plynch-chwy</a> on 2024-10-18 14:23</div>
            <div class="timeline-body"><p>I was looking to make the switch to ruff and use the handful of ignored linting rules we use with pre-commit. After a couple of hours I only just found that this is an option I can't ignore or set as <code>unfixable</code>? It's kinda unfortunate that this issue is still open for almost a year as I was excited to switch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hankertrix">@hankertrix</a> on 2024-11-27 05:57</div>
            <div class="timeline-body"><p>Second this change. I only adopted black as a formatter after they implemented this change as I find it very difficult to read code without the extra newline. This is especially so when the start of the block is very long, and there's a comment right underneath the block.</p>
<p>For example:</p>
<pre><code class="language-python">if long_boolean_variable_name and another_long_conditional:
    # A pretty long comment documenting what the block does
    print(&quot;Do stuff&quot;)
</code></pre>
<p>I find this to be much easier to read:</p>
<pre><code class="language-python">if long_boolean_variable_name and another_long_conditional:

    # A pretty long comment documenting what the block does
    print(&quot;Do stuff&quot;)
</code></pre>
<p>For formatters in other languages that don't support this extra new line, I use a hack to force a new line:</p>
<pre><code class="language-javascript">if (long_boolean_variable_name &amp;&amp; another_long_conditional) {
    //

    // A pretty long comment documenting what the block does
    console.log(&quot;Do stuff&quot;)
}
</code></pre>
<p>Since the Pylsp formatter and black already allow an extra new line, I don't bother doing this hack for my Python code. It would be great to have Ruff support this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laymonage">@laymonage</a> on 2025-02-17 11:17</div>
            <div class="timeline-body"><p>Hi, what's the status on this? If I'm not mistaken, Black already made this stable in 2024.</p>
<p>I see that this was discussed for https://github.com/astral-sh/ruff/issues/8678 in #8893. Then it was briefly mentioned in the plans for the 2025 style guide in https://github.com/astral-sh/ruff/issues/13371#issuecomment-2498529767, but it wasn't planned.</p>
<p>We've switched from black to ruff and loving it, but this issue prevents us from formatting Django migrations without the unnecessary noise of removing empty newlines after the <code>class</code> header that Black leaves as-is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dduarteo">@dduarteo</a> on 2025-02-23 17:23</div>
            <div class="timeline-body"><p>Was excited to start moving all of our codebases to ruff but discovered this issue with the blank line after func definitions.  I second that it makes code much easier to read.</p>
<p>Hopefully this gets implemented in the near future!  For now back to black.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vitaliyf">@vitaliyf</a> on 2025-03-03 18:03</div>
            <div class="timeline-body"><p>One more datapoint: Django generates migrations/*.py files that look like:</p>
<pre><code>class Migration(migrations.Migration):

    dependencies = [
        ...
</code></pre>
<p>Current black-25.1.0 has no opinion on this (does not add nor remove the line break), but ruff-0.9.9 removes it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2025-03-03 19:12</div>
            <div class="timeline-body"><p>We recently switched from black to ruff format at work and this issue caused many thousands of lines of diff, very little of which was an improvement and a lot of which imo hurt readability. This is currently a top 3 upvoted ruff formatter issue, so fingers crossed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-04 07:53</div>
            <div class="timeline-body"><p>@hauntsaninja could you share some of those examples with me? I'm interested in better understanding the cases that hurt readability. Mainly, if they have something in common (e.g. type annotations, split over multiple lines etc).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2025-03-04 08:23</div>
            <div class="timeline-body"><p>I think the ones where it most often feels bad to me involve functions with type annotations and no docstring. There are some other cases involving dense if statements, especially nested ones or ones with comments. And a longer tail of more debatable cases, e.g. where it improves symmetry. A few not particularly cherry picked examples here: https://play.ruff.rs/bd268928-cf4e-458a-b41d-a1f163cb6347?secondary=Format</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-03-04 09:11</div>
            <div class="timeline-body"><p>Thanks. That's helpful. I agree that some of those function definitions are a big wall of text. I do have mixed feelings about the empty blank line because it <em>cuts</em> the function definition in half. It makes it less clear to me what belongs together.</p>
<p>I have to play a bit with those examples to understand why this feels so heavy in Python where the same in other languages seems fine (maybe it's simply because Python doesn't use <code>{}</code> as block delimiters). Or it could be that it's just unfortunate that the return type annotation <code>) -&gt; </code> results in a 4 width indent, the same as the function's body.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2025-03-04 22:39</div>
            <div class="timeline-body"><p>I'm not sure! In TypeScript and Rust, if your first statement is an assignment, the <code>let</code> distinguishes it from function parameters (it's effectively additional indent and syntax highlighting). Whereas in Python with a return type annotation it's a largely undifferentiated mass. I guess return type inference in TypeScript helps too. And I guess kwargs may mean it's more common to have functions with long signatures in Python.</p>
<p>I'm not sure I quite get the thing you mention about cutting, many functions have empty lines in them that aren't at code block open that we don't remove. Function signatures are read more often than function implementations, so visual distinction does at least align with a difference in use. I do agree that removing the blank line feels like a cut for one liners though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shivan2418">@shivan2418</a> on 2025-03-05 20:44</div>
            <div class="timeline-body"><p>i have the same problem.
I was really surprised that you could not change the config the formatter more. I also want my blank lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grizzlydevil">@grizzlydevil</a> on 2025-04-08 08:02</div>
            <div class="timeline-body"><p>I was testing Ruff for our project. It's super quick but the change from black to this is a bit of a deal breaker as people in the project are used to these blank lines they improve readability. Also probably we're used to it. We'll see what others decide. But this change would be very appreciated.</p>
<p>Thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/polsanlorenzo">@polsanlorenzo</a> on 2025-04-23 13:49</div>
            <div class="timeline-body"><p>Like others here, we were really excited to implement Ruff in our project due to its impressive performance, but this issue is kind of stopping us from making the move. Hopefully, this change gets implemented soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rynskyi">@rynskyi</a> on 2025-05-10 23:29</div>
            <div class="timeline-body"><p>Same here - this is the only thing keeping us from switching from back to ruff</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-13 11:47</div>
            <div class="timeline-body"><p>I'm sympathetic to allowing a blank line after function headers. I don't love it because it trades consistency with readability but I think it's a net positive until we can come up with something better.</p>
<p>I'd prefer to keep this specific to functions for now, which seems to be the main concern for most. Or is this incorrect?</p>
<p>I'd be open to reviewing a PR that allows one extra blank line below a function header (in preview)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guyboltonking">@guyboltonking</a> on 2025-05-13 12:26</div>
            <div class="timeline-body"><blockquote>
<p>I'd prefer to keep this specific to functions for now, which seems to be the main concern for most. Or is this incorrect?</p>
</blockquote>
<p>I think (and know in my case) that it applies to all blocks; I have a lot of code that has blank lines after conditionals, loops, and other constructs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laymonage">@laymonage</a> on 2025-05-13 13:03</div>
            <div class="timeline-body"><p>Also, as mentioned in https://github.com/astral-sh/ruff/issues/9745#issuecomment-2662810468 and https://github.com/astral-sh/ruff/issues/9745#issuecomment-2695173158, Django migrations generate classes with a newline after the <code>class</code> header. Applying it for classes would allow for switching from black to ruff with less noisy diffs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisbune">@chrisbune</a> on 2025-05-13 13:20</div>
            <div class="timeline-body"><blockquote>
<p>I'd prefer to keep this specific to functions for now, which seems to be the main concern for most. Or is this incorrect?</p>
</blockquote>
<p>We mainly would like to have blank lines after class headers. Often after function and method headers. Only very rarely for conditional or loop blocks (neglectable).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alechouse97">@alechouse97</a> on 2025-05-13 13:47</div>
            <div class="timeline-body"><p>Really excited to see some traction on this! We primarily have blank lines after conditional or loop statements. Classes and functions, etc. usually have docstrings which ruff allows a new line after.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dduarteo">@dduarteo</a> on 2025-05-13 14:32</div>
            <div class="timeline-body"><p>We are also in the blank line after all blocks of code camp (at least the option as does black).
Excited to see this happen and move all of our stuff to ruff!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nonoash">@nonoash</a> on 2025-07-14 16:33</div>
            <div class="timeline-body"><p>Bumping this. Same situation as others concerning the improved readability and allowing Blank lines at the start of a block.</p>
<p>That is the only diff I have with Black and unfortunately prevent me from switching, much to my regret.
I hope Astral will work on their improved heuristic and adopts Black's formatting soon.</p>
<p>Do not forget to upvote OP</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gagaga67">@gagaga67</a> on 2025-07-17 13:14</div>
            <div class="timeline-body"><p>Personally, I don't want a blank line after the block like black does. This behavior is what made me choose ruff.</p>
<p>Why argue about what is best? It is enough to make a setting for this. Then some people will be able to add an empty line, and some will not. But forcing someone to accept one side is not a very good solution.</p>
<p>These are tools that should help in writing code, and not dictate what and how to do.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-11 12:36</div>
            <div class="timeline-body"><p>@ntBre should we close this now that #21110 has merged. (I'm leaning towards yes to get a better sense in which cases where we should allow empty lines and why)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-11-11 12:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/laymonage">@laymonage</a> on 2025-11-11 13:24</div>
            <div class="timeline-body"><p>@MichaReiser @ntBre What about newlines after class headers? If I'm not mistaken, #21110 only covers functions. This issue covers blocks in general â€“ should a new issue be opened for class headers (and maybe for each header), or should this be reopened?</p>
<p>There's a clear demand for it, at least for classes: #8566, https://github.com/astral-sh/ruff/issues/9745#issuecomment-2023056948, https://github.com/astral-sh/ruff/issues/9745#issuecomment-2662810468, https://github.com/astral-sh/ruff/issues/9745#issuecomment-2695173158, https://github.com/astral-sh/ruff/issues/9745#issuecomment-2876498730.</p>
<p>Just to reiterate, our main use case is for Django migration files. It might be anecdotal but Django has a big user base, so I think it's likely there are other people wanting the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-11-11 13:36</div>
            <div class="timeline-body"><p>I suggest opening a new issue specifically for class headers so that we get clear feedback on what's most important)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:31 UTC
    </footer>
</body>
</html>
