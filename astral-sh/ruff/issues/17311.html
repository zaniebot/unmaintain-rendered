<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLR1730 &quot;safe&quot; fix may delete comments - astral-sh/ruff #17311</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLR1730 &quot;safe&quot; fix may delete comments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17311">#17311</a>
        opened by <a href="https://github.com/JimMajor">@JimMajor</a>
        on 2025-04-09 12:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JimMajor">@JimMajor</a></div>
            <div class="timeline-body">Summary
<p>When ruff with rule PLR1730 and --fix option is used, it will delete comments which were present in the if block reformatted to min/max functions.</p>
<p>For example:</p>
<pre><code>if some_value &gt; LIMIT:
    # very important comment
    some_value = LIMIT
</code></pre>
<p>will turn into:</p>
<pre><code>some_value = min(some_value, LIMIT)
</code></pre>
<p>This works like that for any number of comment lines between <code>if</code> line and assignment line.</p>
<p>Other possibly connected issue is that, if we replace comment with docstring, the ruff rule PLR1730 will not be triggered at all.
That is:</p>
<pre><code>if some_value &gt; LIMIT:
    &quot;&quot;&quot;
    Strange place for a docstring
    &quot;&quot;&quot;
    some_value = LIMIT
</code></pre>
<p>will pass without any notice.</p>
Version
<p>0.11</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-09 13:33</div>
            <div class="timeline-body"><p>The first is a bug, thanks for reporting.</p>
<p>The second isn&#x27;t, because that&#x27;s not a valid docstring position. It&#x27;s an expression statement with a useless string literal expression</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-09 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-04-09 13:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/VascoSch92">@VascoSch92</a> on 2025-04-09 18:23</div>
            <div class="timeline-body"><p>So if we check that there is a comment in the <code>if-statement</code>, then the fix should be unsafe: correct?</p>
<p>If yes, i can give a try ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-09 18:26</div>
            <div class="timeline-body"><blockquote>
<p>So if we check that there is a comment in the <code>if-statement</code>, then the fix should be unsafe: correct?</p>
</blockquote>
<p>Yes, I think that&#x27;s right.</p>
<blockquote>
<p>If yes, i can give a try ;)</p>
</blockquote>
<p>I&#x27;ll assign you! Please also add a <code>## Fix safety</code> section to the rule docs :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/VascoSch92">@VascoSch92</a> by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-09 18:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ntBre">@ntBre</a> on 2025-04-18 16:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:48 UTC
    </footer>
</body>
</html>
