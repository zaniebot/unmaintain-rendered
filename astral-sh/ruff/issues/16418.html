<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Default Python version and version detection - astral-sh/ruff #16418</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Default Python version and version detection</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/16418">#16418</a>
        opened by <a href="https://github.com/ntBre">@ntBre</a>
        on 2025-02-27 16:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-27 16:30</div>
            <div class="timeline-body"><p>As brought up in https://github.com/astral-sh/ruff/issues/16417, the default Python version of 3.9 in ruff can be quite confusing, especially with the new version-related syntax errors. It would be nice if we could improve the no-config experience here.</p>
<p>A few possibilities for addressing this could be:</p>
<ul>
<li>change the default Python version to latest (3.13 currently)</li>
<li>introduce a distinct <code>undefined</code> version value to suppress version-related errors and rules</li>
<li>try to detect the environment Python version</li>
</ul>
<p>The first of these would probably be easiest to implement but would make some rules (like the <a href="https://docs.astral.sh/ruff/rules/#pyupgrade-up"><code>UP</code></a> rules) ~~useless~~ apply incorrectly without setting a lower target version. The second option would likely have the same effect (<code>target_version &lt; 3.10</code> just becomes <code>target_version.is_some_and(&lt; 3.10)</code> for example).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @ntBre on 2025-02-27 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-27 16:40</div>
            <div class="timeline-body"><blockquote>
<p>The first of these would probably be easiest to implement but would make some rules (like the <a href="https://docs.astral.sh/ruff/rules/#pyupgrade-up"><code>UP</code></a> rules) useless without setting a lower target version.</p>
</blockquote>
<p>Rather than making the <code>UP</code> rules useless, this would make the <code>UP</code> rules break a lot of code unintentionally! They might start upgrading Python files to use newer syntax that doesn't work on older Python versions, even though the library or application is meant to still work on those older Python versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-27 16:45</div>
            <div class="timeline-body"><p>Oh of course, thanks! I've been using so many <code>target_version &lt; ...</code> checks for syntax errors that I forgot most rules bail out in those cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-27 18:32</div>
            <div class="timeline-body"><blockquote>
<p>The second option would likely have the same effect</p>
</blockquote>
<p>So here's some different effects the second option might have:</p>
<ul>
<li>We could just disapply all pyupgrade rules (and rules like them) if no target version had been explicitly set in <code>ruff.toml</code> or <code>pyproject.toml</code>. If we see that no target version has been explicitly set, arguably we can't say for sure that upgrading to use new syntax won't break the user's code, so no pyupgrade rule would be safe.</li>
<li>We could not emit any syntax error rules that only occur on some Python versions</li>
<li>We could apply a &quot;generous&quot; interpretation of which modules are standard-library. We get quite a lot of issues like https://github.com/astral-sh/ruff/issues/16405, where users are confused that <code>tomllib</code>, for example, is not considered standard-library unless they explicitly set <code>requires-python = &quot;&gt;= 3.11&quot;</code> (or similar with <code>tool.ruff.target-version</code>). If we're sorting imports and we see that no target version has been set explicitly, we could consider a module standard-library if it's a standard-library module on <em>any</em> Python version rather than checking if it's a standard-library module on <em>some specific</em> Python version.</li>
<li>Similarly, we've had reports of user confusion before when a symbol is considered undefined because it's a builtin symbol added in a new version of Python, but they haven't set the target version explicitly. We could do the same thing there -- be generous and assume a symbol is a bound builtin symbol if it's a builtin on <em>any</em> Python version, when the target version is not set.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16425.html">astral-sh/ruff#16425</a> on 2025-02-27 22:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-27 23:01</div>
            <div class="timeline-body"><p>Ah those are good points, and I think they make this sound like the best option to me, at least of the ones listed in the issue.</p>
<p>Are there any cases where &quot;any Python version&quot; is different from &quot;latest Python version&quot; in the &quot;generous&quot; interpretation? I guess that would be the case if symbols were removed from the standard library. It would be nice if using the latest version for these checks would cover everything, like with the syntax errors, but that's just an implementation detail really.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-27 23:04</div>
            <div class="timeline-body"><blockquote>
<p>Are there any cases where &quot;any Python version&quot; is different from &quot;latest Python version&quot; in the &quot;generous&quot; interpretation?</p>
</blockquote>
<p>Yes -- an example might be that a bunch of modules were removed in Python 3.13 as part of <a href="https://peps.python.org/pep-0594/">PEP 594</a>. Under the &quot;generous&quot; interpretation, we would still sort these as if they were stdlib modules when no Python version was specified, since they are stdlib modules on <em>some</em> Python versions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-28 06:13</div>
            <div class="timeline-body"><p>I think (3) is also a very compelling option because that would move us closer towards the &quot;better default behavior&quot; goal.</p>
<p>At least in an editor context, especially with the VS Code extension, we get that for free (at least for now, see https://github.com/astral-sh/ruff-vscode/issues/479#issuecomment-2688555550). We would still have to make a decision or highlight it to the user when there's a mismatch between the selected Python version in the editor v/s the one in <code>pyproject.toml</code> (<code>project.requires-python</code>) or the <a href="https://docs.astral.sh/ruff/settings/#target-version"><code>tool.ruff.target-version</code></a>.</p>
<p>On the command-line, we could default to (2) and a possibility to develop it during a uv integration in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-28 07:13</div>
            <div class="timeline-body"><p>I'm not convinced that 3 is the right solution here for two reasons:</p>
<ul>
<li>We still need 1. or 2. in cases where Python isn't installed. That's unlikely but can be the case for CI jobs that only run <code>ruff format</code> and <code>ruff lint</code> (they don't need python!)</li>
<li>Your Ruff configuration might work fine on one machine and fail on another. For example, you setup Ruff in your project and push to CI where checks suddenly start failing (or formatting changes) because a different or no Python version is installed.</li>
</ul>
<p>I think my preference is a combination of 1 and 2:</p>
<p>Using <code>Unknown</code> for the python version gives each tool -- each rule even -- the possibility to decide what the least error prone version is: syntax errors: assume latest, formatter: assume a reasonably old version but not ancient version, builtins lint rule: assume latest (because it's more likely that new builtins are added then removed), py upgrade: skip?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-02-28 07:24</div>
            <div class="timeline-body"><p>My main motivation for (3) at least in an editor context is from the screenshot in https://github.com/astral-sh/ruff-vscode/issues/709 and I don't consider it as a priority right now but something to consider for the future. I think it's a common scenario that a user would open an editor with a Python file and start writing code. They might use an older Python version or the editor selected an older Python version by default which might result in Ruff not highlighting this because it assumed the latest version. For an editor context, it might be useful to consider this as the last resort before using <code>Unknown</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-02-28 07:27</div>
            <div class="timeline-body"><p>I'm okay to change how we initialize the python version in the editor. I do think we should make use of the information that the editor provides us or implement 3 ourselves. I think that's also something that has come up in the red knot proposal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kristinita">@Kristinita</a> on 2025-04-19 12:48</div>
            <div class="timeline-body"><h3>1. Summary</h3>
<p>I use latest Python versions. I don’t want to get warnings and errors specific for old Python versions, and I want to get warnings and errors from tools like Pyupgrade about outdated syntax.</p>
<p>It would be nice if would be possible not change the value of the variable <code>target-version</code> manually every time when a new Python version be released.</p>
<h3>2. Examples of the desired behavior</h3>
<ol>
<li><code>target-version = &quot;current&quot;</code> — Ruff will detect the Python version of the current environment and set the value of the <code>target-version</code> based on it <a href="https://pylint.pycqa.org/en/latest/user_guide/configuration/all-options.html#py-version"><strong>like Pylint use by default the value <code>sys.version_info[:2]</code> for its option <code>--py-version</code></strong></a>.</li>
<li><code>target-version = &quot;latest&quot;</code> — Ruff will use for the value of the option <code>target-version</code> the number of the latest Python version. I.e., at the moment of writing this comment <code>target-version = &quot;latest&quot;</code> is the equivalent of <code>target-version = &quot;py313&quot;</code>.</li>
</ol>
<p>Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/17529.html">astral-sh/ruff#17529</a> on 2025-04-21 21:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17531.html">astral-sh/ruff#17531</a> on 2025-04-21 22:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danra">@danra</a> on 2025-04-21 22:37</div>
            <div class="timeline-body"><blockquote>
<p>A few possibilities for addressing this could be:</p>
</blockquote>
<blockquote>
<p>change the default Python version to latest (3.13 currently)</p>
</blockquote>
<p>Doing so with no transition period would likely cause friction in many codebases after upgrading <code>ruff</code> due to new rules kicking-in which were previously disabled, e.g., <a href="https://docs.astral.sh/ruff/rules/zip-without-explicit-strict/">B905</a> (I've only just become aware of the existence of such rules myself)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-09 06:04</div>
            <div class="timeline-body"><p>@ntBre I think we can close this now</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-05-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kristinita">@Kristinita</a> on 2025-05-09 18:55</div>
            <div class="timeline-body"><p><strong>Type: Question</strong> :question:</p>
<p>@ntBre, @Glyphack, @MichaReiser, what needs to do users that want to have something like <code>target-version = &quot;latest&quot;</code> or <code>target-version = &quot;current&quot;</code>? I don’t see changes in the <a href="https://docs.astral.sh/ruff/settings/#target-version"><strong>documentation of the option <code>target-version</code></strong></a>.</p>
<p>Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-09 19:22</div>
            <div class="timeline-body"><p>You can open a separate feature request, but I don't think we're planning to support this kind of thing in the near future.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
