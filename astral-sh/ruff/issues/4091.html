<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF009: False positives in case of immutable objects - astral-sh/ruff #4091</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>RUF009: False positives in case of immutable objects</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/4091">#4091</a>
        opened by <a href="https://github.com/aberres">@aberres</a>
        on 2023-04-25 08:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/aberres">@aberres</a> on 2023-04-25 08:38</div>
            <div class="timeline-body"><p>I'd argue the following code is ok, as all default parameters are immutable.</p>
<pre><code class="language-python">import datetime as dt
from dataclasses import dataclass
from pathlib import Path

MyId = int

@dataclass
class Example:
    timedelta: dt.datetime = dt.timedelta(hours=1)

    date: dt.date = dt.date(2042, 1, 1)

    id: MyId = MyId(5)

    path: Path = Path()

e = Example()
</code></pre>
<p><code>ruff</code> is not happy though:</p>
<pre><code>ruff009.py:9:30: RUF009 Do not perform function call `dt.timedelta` in dataclass defaults
ruff009.py:11:21: RUF009 Do not perform function call `dt.date` in dataclass defaults
ruff009.py:13:16: RUF009 Do not perform function call `MyId` in dataclass defaults
ruff009.py:15:18: RUF009 Do not perform function call `Path` in dataclass defaults
</code></pre>
<p>Isn't there a similar case for default values of method parameters? I think this rule had a list of (at least some) allowed calls.</p>
<p>EDIT: Here is the list: https://github.com/charliermarsh/ruff/blob/main/crates/ruff/src/rules/flake8_bugbear/rules/function_call_argument_default.rs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "RUFF009: False positives in case of immutable objects" to "RUF009: False positives in case of immutable objects" by @aberres on 2023-04-25 08:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-25 15:11</div>
            <div class="timeline-body"><p>I agree.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-04-25 15:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-26 17:15</div>
            <div class="timeline-body"><p>We should just add the same immutable-type checks as we do for the bugbear rules. \cc @mosauter if this is interesting to you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4122.html">astral-sh/ruff#4122</a> on 2023-04-26 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mosauter">@mosauter</a> on 2023-04-26 17:54</div>
            <div class="timeline-body"><p>I created a PR for this. But have to say the type-alias <code>MyId</code> is AFAIK not something that ruff can detect (yet?). This would mean resolving the actual type behind a generic call.</p>
<p>Which would in turn also enable us to detect a <code>NamedTuple</code> type which would technically also be a RUF009-False-Positive at this point in time.</p>
<p>Please correct me if I'm wrong on that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-04-28 01:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4451.html">astral-sh/ruff#4451</a> on 2023-05-16 14:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:08 UTC
    </footer>
</body>
</html>
