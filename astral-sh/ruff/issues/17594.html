<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>duplicate diagnosis - astral-sh/ruff #17594</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>duplicate diagnosis</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/17594">#17594</a>
        opened by <a href="https://github.com/cnjackhu">@cnjackhu</a>
        on 2025-04-23 20:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/cnjackhu">@cnjackhu</a> on 2025-04-23 20:49</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>i am using nvim with setting pyright as lsp and ruff as linter.
with the code in the image i get duplicate ruff and Ruff messages, how to solve this? why there is a ruff and Ruff?</p>
<p><img width="1546" alt="Image" src="https://github.com/user-attachments/assets/90d43bd6-f690-42c3-a579-d280f91832b8" /></p>
<p>my setting in nvim is:
inside nvim-lint plugin setting:</p>
<pre><code>lint.linters_by_ft = {
        python = { &quot;ruff&quot;, &quot;mypy&quot; },
      }
</code></pre>
<p>inside lsp setting:</p>
<pre><code>pyright = {
        settings = {
          pyright = {
            -- Using Ruff's import organizer
            disableOrganizeImports = true,
          },
          python = {
            analysis = {
              -- Ignore all files for analysis to exclusively use Ruff for linting
              ignore = { &quot;*&quot; },
              typeCheckingMode = &quot;off&quot;, -- Using mypy
            },
          },
        },
      },

</code></pre>
<h3>Version</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dhruvmanila on 2025-04-23 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-23 21:40</div>
            <div class="timeline-body"><p>I think you might be also running the Ruff language server via <code>nvim-lspconfig</code>. Can you confirm?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cnjackhu">@cnjackhu</a> on 2025-04-24 10:27</div>
            <div class="timeline-body"><p>i double check in the <code>nvim-lspconfig</code>, i didn't set ruff lsp, <strong>the way i use ruff is</strong>: using mason UI to download ruff, ruff exist in mason both as linter and lsp, does this cause any conflict?
after download ruff using mason UI, i set the linters as:</p>
<pre><code>lint.linters_by_ft = {
        python = { &quot;ruff&quot;, &quot;mypy&quot; },
      }
</code></pre>
<p>my config for lsp is here: <a href="https://github.com/cnjackhu/nvim/blob/master/lua/plugins/lsp.lua">lsp</a>
my config for linting is here:  <a href="https://github.com/cnjackhu/nvim/blob/master/lua/plugins/linting.lua">linting</a></p>
<p>then i get the duplicate diagnosis as above, also with pyright and ruff both exist, it cause conflict.
the message is: <strong>Client pyright quit with exit code 0 and signal 9.</strong></p>
<p>the following are the log messges:
does my .vscode-server setting will affect the ruff inside neovim?</p>
<p>[ERROR][2025-04-24 13:15:56] .../vim/lsp/rpc.lua:770	&quot;rpc&quot;	&quot;/home/huj0b/.local/share/andr/mason/bin/ruff&quot;	&quot;stderr&quot;	&quot;2025-04-24 13:15:56.565255584  WARN The top-level linter settings are deprecated in favour of their
counterparts in the <code>lint</code> section. Please update the following options in <code>.vscode-server/extensions/donjayamanne.python- environment-manager-1.2.4/pythonFiles/pyproject.toml</code>:\n  - 'ignore' -&gt; 'lint.ignore'
log.target=&quot;ruff_workspace::configuration&quot; log.module_path=&quot;ruff_workspace::configuration&quot;
log.file=&quot;crates/ruff_workspace/src/configuration.rs&quot; log.line=1582\n&quot;</p>
<p>some other recent lsp log for shut down:</p>
<p><img width="1325" alt="Image" src="https://github.com/user-attachments/assets/6b6ff3e3-080d-4093-98da-1547d0c1593a" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-24 12:26</div>
            <div class="timeline-body"><blockquote>
<p>using mason UI to download ruff, ruff exist in mason both as linter and lsp, does this cause any conflict?</p>
</blockquote>
<p>Probably yes. I'm not exactly sure what you are doing but you should only use Ruff either as a linter or the LSP. The LSP will provide diagnostics from the linter.</p>
<blockquote>
<p>then i get the duplicate diagnosis as above, also with pyright and ruff both exist, it cause conflict.
the message is: <strong>Client pyright quit with exit code 0 and signal 9.</strong></p>
</blockquote>
<p>I don't think this is related to what the original issue is here. You should look at the logs created by Pyright to check why it quits.</p>
<blockquote>
<p>the following are the log messges:
does my .vscode-server setting will affect the ruff inside neovim?</p>
<p>[ERROR][2025-04-24 13:15:56] .../vim/lsp/rpc.lua:770	&quot;rpc&quot;	&quot;/home/huj0b/.local/share/andr/mason/bin/ruff&quot;	&quot;stderr&quot;	&quot;2025-04-24 13:15:56.565255584  WARN The top-level linter settings are deprecated in favour of their
counterparts in the <code>lint</code> section. Please update the following options in <code>.vscode-server/extensions/donjayamanne.python- environment-manager-1.2.4/pythonFiles/pyproject.toml</code>:\n  - 'ignore' -&gt; 'lint.ignore'
log.target=&quot;ruff_workspace::configuration&quot; log.module_path=&quot;ruff_workspace::configuration&quot;
log.file=&quot;crates/ruff_workspace/src/configuration.rs&quot; log.line=1582\n&quot;</p>
</blockquote>
<p>I don't know what &quot;.vscode-server&quot; is but the logs do suggest that you're also running the ruff language server. You could check that via the <code>LspInfo</code> command which lists all the configured LSP and the ones that are currently running in the buffer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-05-12 08:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alveifbklsiu259">@alveifbklsiu259</a> on 2025-12-13 06:18</div>
            <div class="timeline-body"><p>I had the same issue as the OP, and I have the similar configurations:</p>
<ul>
<li>using <code>pyright</code> as python LSP.</li>
<li>using <code>ruff</code> as python linter in <code>nvim-lint</code> plugin.</li>
</ul>
<p>At first I thought ruff is only run as linter + formatter, not an LSP, and as of the time of writing, Mason does have two ruff packages:</p>
<ul>
<li><code>ruff</code></li>
<li><code>ruff-lsp</code> (deprecated)</li>
</ul>
<p>So whenever people said running ruff as LSP, I thought they were talking about the <code>ruff-lsp</code> package, and since I didn't have it installed, it had nothing to do with me. But after checking <code>LspInfo</code>, I did see:</p>
<pre><code>- ruff (id: 2)
  - Version: 0.14.7
  - Root directory: ~/test/j-test
  - Command: { &quot;ruff&quot;, &quot;server&quot; }
  - Settings: {}
  - Attached buffers: 6
</code></pre>
<p>For some reason it just runs <code>ruff</code> as an LSP even though I don't have it configured in my <code>neovim/nvim-lspconfig</code> plugin.</p>
<p>And since I had <code>ruff</code> configured as linter in <code>nvim-lint</code>,  it showed duplicate diagnostic messages for <code>ruff</code>, one from the <code>ruff</code> LSP, one from <code>ruff</code> in  <code>nvim-lint</code>.</p>
<p>Anyway, the solution for me to solve the duplicate diagnostic messages problem is to remove ruff from <code>nvim-lint</code>, and run <code>ruff</code> as LSP alongside <code>pyright</code>.</p>
<pre><code class="language-lua">-- Autocmd to disable Ruff hover
vim.api.nvim_create_autocmd(&quot;LspAttach&quot;, {
  group = vim.api.nvim_create_augroup(&quot;lsp_attach_disable_ruff_hover&quot;, { clear = true }),
  callback = function(args)
    local client = vim.lsp.get_client_by_id(args.data.client_id)
    if client and client.name == &quot;ruff&quot; then
      client.server_capabilities.hoverProvider = false
    end
  end,
  desc = &quot;LSP: Disable hover capability from Ruff&quot;,
})

return {
  {
    &quot;mason-org/mason-lspconfig.nvim&quot;,
    opts = {
      ensure_installed = {
        &quot;pyright&quot;,
        &quot;ruff&quot;,
      },
    },
  },
  {
    &quot;neovim/nvim-lspconfig&quot;,
    opts = {
      servers = {
        pyright = {
          settings = {
            pyright = {
              disableOrganizeImports = true, -- let Ruff handle imports
            },
            python = {
              pythonPath = &quot;./.venv/bin/python&quot;, -- direct interpreter path
              venvPath = &quot;.&quot;, -- project root
              venv = &quot;.venv&quot;, -- venv folder name
            },
          },
        },
        ruff = {},
      },
    },
  },
}
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
