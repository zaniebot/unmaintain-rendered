<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`PLE1520` false positive when using `singledispatchmethod` with `staticmethod` - astral-sh/ruff #10619</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>PLE1520</code> false positive when using <code>singledispatchmethod</code> with <code>staticmethod</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10619">#10619</a>
        opened by <a href="https://github.com/ForeverProglamer">@ForeverProglamer</a>
        on 2024-03-26 17:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ForeverProglamer">@ForeverProglamer</a> on 2024-03-26 17:55</div>
            <div class="timeline-body"><p><strong>Ruff version:</strong> ruff 0.3.4.
<strong>Python version:</strong> Python 3.12.2.
<strong>Code to reproduce a bug:</strong></p>
<pre><code class="language-python">from functools import singledispatch, singledispatchmethod


class Foo:
    @singledispatchmethod
    @staticmethod
    def bar(value):
        raise NotImplementedError() 

    @bar.register
    @staticmethod
    def _(value: int) -&gt; int:
        return 42 * value

    def method(self) -&gt; int:
        return self.bar(2)


print(Foo().method())
</code></pre>
<p><strong>Command invoked to lint the code:</strong> <code>ruff check --isolated --preview --select=PL main.py</code>.</p>
<pre><code>main.py:5:5: PLE1520 `@singledispatchmethod` decorator should not be used on non-method functions
  |
4 | class Foo:
5 |     @singledispatchmethod
  |     ^^^^^^^^^^^^^^^^^^^^^ PLE1520
6 |     @staticmethod
7 |     def bar(value):
  |
  = help: Replace with `@singledispatch`
</code></pre>
<p>Running this code outputs <code>84</code>. However, if you replace <code>@singledispatchmethod</code> with <code>@singledispatch</code> as Ruff suggests, and then run the code, you will get an error:</p>
<pre><code class="language-Traceback">  File &quot;/home/ebubuntu/projects/test/ruff/main.py&quot;, line 19, in &lt;module&gt;
    print(Foo().method())
          ^^^^^^^^^^^^^^
  File &quot;/home/ebubuntu/projects/test/ruff/main.py&quot;, line 16, in method
    return self.bar(2)
           ^^^^^^^^^^^
  File &quot;/home/ebubuntu/.pyenv/versions/3.12.2/lib/python3.12/functools.py&quot;, line 909, in wrapper
    return dispatch(args[0].__class__)(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Foo.bar() takes 1 positional argument but 2 were given
</code></pre>
<p><a href="https://docs.python.org/3/library/functools.html#functools.singledispatchmethod">Python docs on <code>singledispatchmethod</code> states</a>:</p>
<blockquote>
<p>@singledispatchmethod supports nesting with other decorators such as <a href="https://docs.python.org/3/library/functions.html#classmethod">@classmethod</a>. ... The same pattern can be used for other similar decorators: <a href="https://docs.python.org/3/library/functions.html#staticmethod">@staticmethod</a>, <a href="https://docs.python.org/3/library/abc.html#abc.abstractmethod">@abstractmethod</a>, and others.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @MichaReiser on 2024-03-28 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @MichaReiser on 2024-03-28 12:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-04-02 16:30</div>
            <div class="timeline-body"><p>This issue is interesting because our behaviour is currently consistent with pylint's here. However, we discussed this internally, and we agree that the rule is indeed behaving in quite an odd way right now -- we think both pylint's behaviour and ruff's behaviour are both incorrect currently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-04-02 16:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:33:19 UTC
    </footer>
</body>
</html>
