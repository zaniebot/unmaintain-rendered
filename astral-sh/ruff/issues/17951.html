<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLW2901 should be more configurable - astral-sh/ruff #17951</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLW2901 should be more configurable</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17951">#17951</a>
        opened by <a href="https://github.com/siegfriedpammer">@siegfriedpammer</a>
        on 2025-05-08 13:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/siegfriedpammer">@siegfriedpammer</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Similar to #7273</p>
<p>PLW2901 seems to combine different problems into one rule:</p>
<ul>
<li>reassignment of loop variables</li>
<li>reuse of loop variables in nested loops/contexts</li>
</ul>
<p>In our codebase we often reassign the loop variable to do some preprocessing or in-place conversions/type hints, for ex. like this:</p>
<pre><code class="language-py">for line in lines:
    line = line.strip()
    # ...
</code></pre>
<pre><code class="language-py">for file in files:
    file = pathlib.Path(file)
    # ...
</code></pre>
<p>Wouldn't it make sense to split this into multiple rules or provide a configuration option? Having to introduce a second variable name for the &quot;processed&quot; loop value could also be a source of bugs: now you have two valid names to choose from and it could be the wrong one.</p>
<p>However <strong>reusing the same loop variable name in a nested loop is just plain wrong</strong> and wouldn't compile in most other programming languages, while reassigning the loop variable is just fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-05-08 16:08</div>
            <div class="timeline-body"><p>I considered disabling this rule in typeshed for similar reasons: https://github.com/python/typeshed/pull/13749</p>
<blockquote>
<p><a href="https://docs.astral.sh/ruff/rules/redefined-loop-name/#redefined-loop-name-plw2901">redefined-loop-name (PLW2901)</a> disallows overwriting a loop variable with an assignement. Can catch some good code smells, but what it caught here feels quite pedantic. Maybe we could feature-request an exception for immediatly-reassigned loop variables? (which also feels cleaner than an additional comprehension/map)</p>
</blockquote>
<p>But we ended up renaming on re-assignement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2025-05-09 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @MichaReiser on 2025-05-09 06:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mscheifer">@mscheifer</a> on 2025-07-31 08:09</div>
            <div class="timeline-body"><p>My code base has several functions that conditionally re-assign loop variables. It's stuff like:</p>
<pre><code class="language-python">simplified_args = []
for arg in arguments:
   for other_arg in arguments:
       if intersect(arg, other_arg):
          arg = arg.reduce(other_arg)
   if arg.is_empty():
      continue
   simplified_args.append(arg)
</code></pre>
<p>Note that I can't mutate <code>arg</code> (as suggested in #7273) as other contexts might share a reference to it.</p>
<p>I'd consider PLW2901 a false-positive on this code.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:52:41 UTC
    </footer>
</body>
</html>
