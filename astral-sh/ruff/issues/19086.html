<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration format depends on hardcoded `pyproject.toml` filename - astral-sh/ruff #19086</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Configuration format depends on hardcoded <code>pyproject.toml</code> filename</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19086">#19086</a>
        opened by <a href="https://github.com/sin-ack">@sin-ack</a>
        on 2025-07-02 11:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sin-ack">@sin-ack</a> on 2025-07-02 11:49</div>
            <div class="timeline-body"><p>I am currently trying to write a Nix flake check to lint our Python project. In Nix, the actual mapped name of a file from the source directory can be different from the original file name. In our case, we have to validate a workspace with multiple Python packages so the source directory and the <code>pyproject.toml</code> files are separate. I tried to get only <code>pyproject.toml</code> as a single file, which turns its filename into <code>/nix/store/zgx...i2-pyproject.toml</code>. So the command to run becomes <code>.../bin/ruff format --config /nix/store/zgx...i2-pyproject.toml --check --diff /nix/store/abc...def-source/</code>.</p>
<p>However, the hardcoded check below makes Ruff fail, because it requires the filename to be exactly <code>pyproject.toml</code> (<code>Path::ends_with</code> compares against the whole path component):</p>
<p>https://github.com/astral-sh/ruff/blob/f7fc8fb084e30c6846709cc4aa8cbd18fcc86a8b/crates/ruff_workspace/src/pyproject.rs#L161</p>
<p>Could you please either:</p>
<ul>
<li>Check whether the filename <em>ends</em> with <code>pyproject.toml</code> (not the whole path component, but as a string match)</li>
<li>Provide a command-line switch to explicitly declare which format is being used (<code>pyproject</code> or <code>ruff</code> format)</li>
</ul>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-02 12:53</div>
            <div class="timeline-body"><p>Thanks for the report! I'd like to get @MichaReiser's input on this when he's back from PTO next week, but either of your suggested fixes make sense to me. The first would be quick and easy, but the second could be cool to allow arbitrary file names.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">configuration</span> added by @ntBre on 2025-07-02 12:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-design</span> added by @ntBre on 2025-07-02 12:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-07 07:48</div>
            <div class="timeline-body"><p>Hmm, I'm not a huge fan of either approach. Do you configure other tools in your <code>pyproject.toml</code> that also support multiple configuration formats? How do they handle this case.</p>
<p>The reason I'm not excited about checking if the file ends with <code>pyproject.toml</code> is because the specification (as far as I understand) is fairly clear that the file should be named <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/"><code>pyproject.toml</code></a>. But I'm not totally oposed to it.</p>
<p>What's your reason for not using a <code>ruff.toml</code> file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sin-ack">@sin-ack</a> on 2025-07-07 11:29</div>
            <div class="timeline-body"><blockquote>
<p>Hmm, I'm not a huge fan of either approach. Do you configure other tools in your <code>pyproject.toml</code> that also support multiple configuration formats? How do they handle this case.</p>
</blockquote>
<p>I looked at <code>isort</code> (which supports both <code>pyproject.toml</code> and <code>.isort.cfg</code> files) and <code>black</code> (which only seems to support <code>pyproject.toml</code>). Both of them allow specifying a custom file (isort through <code>--settings-file</code>, black through <code>--config</code>). isort seems to handle this case better by <a href="https://pycqa.github.io/isort/docs/configuration/config_files#custom-config-files:~:text=Custom%20config%20files%20should%20place%20their%20configuration%20options%20inside">assuming that the file can contain other things by default</a>:</p>
<blockquote>
<p>Custom config files should place their configuration options inside an <code>[isort]</code> section and never a generic <code>[settings]</code> section. This is because isort can't know for sure how other tools are utilizing the config file.</p>
</blockquote>
<p>Black will only interpret files in <code>pyproject.toml</code> format.</p>
<blockquote>
<p>The reason I'm not excited about checking if the file ends with <code>pyproject.toml</code> is because the specification (as far as I understand) is fairly clear that the file should be named <a href="https://packaging.python.org/en/latest/guides/writing-pyproject-toml/"><code>pyproject.toml</code></a>. But I'm not totally oposed to it.</p>
</blockquote>
<p>That's fair. We can hack around it right now by creating a derivation that outputs a folder with a single <code>pyproject.toml</code> file in it. However I like <code>isort</code>'s approach here better personally, and it would solve this particular issue (it would be breaking if implemented directly though, hence the flag).</p>
<blockquote>
<p>What's your reason for not using a <code>ruff.toml</code> file?</p>
</blockquote>
<p>I think it's good to have a single file that can configure the whole project. Without this, we would have to separate out every tool's config. It also forces all configuration to be written in TOML (i.e. consistent).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-07 12:33</div>
            <div class="timeline-body"><p>Thanks for the research!</p>
<p>I think a reasonable option here would be:</p>
<ul>
<li>If the file is named <code>ruff.toml</code> or <code>pyproject.toml</code>, keep the existing behavior.</li>
<li>For any other file: Assume it's a <code>pyproject.toml</code> if it has a <code>tool</code> section. I'm not sure if this can be done &quot;cheaply&quot; without parsing the file (could we look for a line starting with <code>[tool.</code> ?</li>
</ul>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:37:54 UTC
    </footer>
</body>
</html>
