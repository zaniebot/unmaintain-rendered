<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF023: Sorting `__match_args__` changes match semantics - astral-sh/ruff #9723</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF023: Sorting <code>__match_args__</code> changes match semantics</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9723">#9723</a>
        opened by <a href="https://github.com/dosisod">@dosisod</a>
        on 2024-01-30 22:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dosisod">@dosisod</a></div>
            <div class="timeline-body"><p>RUF023 should not sort <code>__match_args__</code> because the order of <code>__match_args__</code> affects which elements are matched against when using positional args in class patterns.</p>
<p>Take the following code example:</p>
<pre><code class="language-python">from dataclasses import dataclass

@dataclass
class UnaryExpr:
    __match_args__ = (&quot;op&quot;, &quot;lhs&quot;)

    op: str
    lhs: int


def is_minus_one(expr):
    match expr:
        case UnaryExpr(&quot;-&quot;, 1):
            return True

    return False


is_minus_one(UnaryExpr(&quot;-&quot;, 1))  # True
is_minus_one(UnaryExpr(&quot;+&quot;, 1))  # False
</code></pre>
<p>Ruff emits the following errors:</p>
<pre><code>$ ruff --preview --select RUF023 file.py
file.py:6:22: RUF023 [*] `UnaryExpr.__match_args__` is not sorted
</code></pre>
<p>If you change <code>__match_args__</code> to <code>(&quot;lhs&quot;, &quot;op&quot;)</code>, the semantics of the match statement changes, and now both <code>is_minus_one</code> calls return <code>False</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-01-30 22:06</div>
            <div class="timeline-body"><p>Oof, I can't believe I forgot that this was how things worked. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @AlexWaygood by @AlexWaygood on 2024-01-30 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-01-30 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-01-30 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-01-30 22:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:30 UTC
    </footer>
</body>
</html>
