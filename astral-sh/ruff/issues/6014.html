<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>re-export `from typing import Literal as L`: F821 Undefined name `bar` - astral-sh/ruff #6014</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>re-export `from typing import Literal as L`: F821 Undefined name `bar`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/6014">#6014</a>
        opened by <a href="https://github.com/Jasha10">@Jasha10</a>
        on 2023-07-23 10:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Jasha10">@Jasha10</a> on 2023-07-23 10:55</div>
            <div class="timeline-body"><p>Hello,</p>
<p>If I import <code>typing.Literal</code> in <code>lib.py</code> then do <code>from lib import Literal</code> in <code>main.py</code>, ruff fails to treat the <code>Literal</code> type annotations properly.</p>
<pre><code class="language-python"># lib.py
from typing import Literal

__all__ = [&quot;Literal&quot;]
</code></pre>
<pre><code class="language-python"># main.py
from lib import Literal

foo: Literal[&quot;bar&quot;] = &quot;bar&quot;
</code></pre>
<pre><code class="language-bash">$ ruff check *.py
main.py:4:15: F821 Undefined name `bar`
Found 1 error.
$ ruff --version
ruff 0.0.280
</code></pre>
<h3>Expected behavior:</h3>
<p>Ruff should recognize that <code>Literal[&quot;bar&quot;]</code> is an annotation for a string literal and not flag the name <code>bar</code> as undefined.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-23 15:56</div>
            <div class="timeline-body"><p>For now, you'll need to mark <code>lib</code> in <a href="https://beta.ruff.rs/docs/settings/#typing-modules"><code>typing-modules</code></a>, like:</p>
<pre><code class="language-python">[tool.ruff]
typing-modules = [&quot;lib&quot;]
</code></pre>
<p>This tells Ruff to treat exports from <code>lib</code> as if they are re-exports from <code>typing</code>. Let me know if it doesn't work for whatever reason :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-07-23 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jasha10">@Jasha10</a> on 2023-07-23 16:48</div>
            <div class="timeline-body"><p>Thanks for the tip, @charliermarsh.
This still does not cover my use-case which involves <code>from typing import Literal as L</code> and then re-export of <code>L</code>. Here's an updated repro:</p>
<pre><code class="language-python"># lib.py
from typing import Literal as L
from typing import Literal

__all__ = [&quot;L&quot;, &quot;Literal&quot;]
</code></pre>
<pre><code class="language-python"># main.py
from lib import L, Literal

foo1: Literal[&quot;bar&quot;] = &quot;bar&quot;
foo2: L[&quot;bar&quot;] = &quot;bar&quot;
</code></pre>
<pre><code class="language-toml"># pyproject.toml
[tool.ruff]
typing-modules = [&quot;lib&quot;]
</code></pre>
<pre><code class="language-bash">$ ruff check *.py
main.py:5:10: F821 Undefined name `bar`
Found 1 error.
</code></pre>
<p>I'll update this issue's name accordingly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "re-export `typing.Literal`: F821 Undefined name `bar`" to "re-export `from typing import Literal as L`: F821 Undefined name `bar`" by @Jasha10 on 2023-07-23 16:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @charliermarsh on 2023-07-23 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-23 17:30</div>
            <div class="timeline-body"><p>Makes sense, thanks. To set expectations, this won't be fixed in an imminent release since it requires us to resolve symbols across files, but it will be fixed eventually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-07-24 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @charliermarsh on 2023-07-24 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rlipperts">@rlipperts</a> on 2023-07-25 06:33</div>
            <div class="timeline-body"><p>I also stumbled upon this while evaluating if I want to use <a href="https://github.com/ramonhagenaars/nptyping">nptyping</a> in my work project:</p>
<pre><code class="language-python">from nptyping import Float, NDArray, Shape

my_array: NDArray[Shape[&quot;x, y, z, 3&quot;], Float]
</code></pre>
<p>results in</p>
<pre><code class="language-bash">$ ruff check nptyping_test.py
nptyping_test.py:3:26: F821 Undefined name `x`
nptyping_test.py:3:29: F821 Undefined name `y`
nptyping_test.py:3:32: F821 Undefined name `z`
Found 3 errors.
</code></pre>
<p>even with</p>
<pre><code class="language-toml">typing-modules = [&quot;nptyping&quot;]
</code></pre>
<p>in my <code>pyproject.toml</code>.</p>
<p>As it seems this is a real-world example of the issue described by @Jasha10 - <a href="https://github.com/ramonhagenaars/nptyping/blob/master/USERDOCS.md?plain=1#L117C00-L126C82">nptyping uses Literal for their shape Keyword</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jasha10">@Jasha10</a> on 2023-07-25 17:10</div>
            <div class="timeline-body"><p>Thanks for adding this context @rlipperts. My usecase is also related to <code>ntyping</code> -- I'm using a personal fork of <code>ntyping</code> in my own project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-25 17:14</div>
            <div class="timeline-body"><p>We could special-case <code>nptying.Shape</code> as an alias of <code>Literal</code>. (But it wouldn't solve cases in which that's re-exported under some other alias.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rlipperts">@rlipperts</a> on 2023-07-25 17:21</div>
            <div class="timeline-body"><p>As outlined in the referenced link it is possible to replace <code>Shape</code> with <code>Literal</code>. For me that is a sufficient work-around so that there is no need to clutter your codebase, @charliermarsh,  if you intend to fix it in the long run.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pierre-Sassoulas">@Pierre-Sassoulas</a> on 2023-07-26 10:02</div>
            <div class="timeline-body"><p>We also encounter something very similar in pylint when upgrading to 0.0.280, but on the actual <code>typing.Litteral</code> and not an alias:</p>
<pre><code>pylint/utils/utils.py:56:31: F821 Undefined name `ignored`
pylint/utils/utils.py:56:39: F821 Undefined name `modules`
pylint/utils/utils.py:64:36: F821 Undefined name `py`
pylint/utils/utils.py:64:39: F821 Undefined name `version`
Found 4 errors.
</code></pre>
<p>When there are multiple values in the <code>Literal</code> it seems to works:
Code:</p>
<p>https://github.com/pylint-dev/pylint/blob/a57dd01c465a1357fc96833bec278fbf47147a4c/pylint/utils/utils.py#L27C1-L64</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-26 12:37</div>
            <div class="timeline-body"><p>@Pierre-Sassoulas - I believe that issue is separate and related to the use of future annotations. Itâ€™s fixed on main and will be out soon. (Similar to https://github.com/astral-sh/ruff/issues/6055.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6651.html">astral-sh/ruff#6651</a> on 2023-08-30 15:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../frappe/frappe/issues/25313.html">frappe/frappe#25313</a> on 2024-03-10 19:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> added by @AlexWaygood on 2024-03-12 16:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">multifile-analysis</span> removed by @MichaReiser on 2024-10-24 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17386.html">astral-sh/ruff#17386</a> on 2025-04-14 12:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17931.html">astral-sh/ruff#17931</a> on 2025-05-08 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/13121.html">astral-sh/ruff#13121</a> on 2025-07-09 23:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/20716.html">astral-sh/ruff#20716</a> on 2025-10-06 13:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
