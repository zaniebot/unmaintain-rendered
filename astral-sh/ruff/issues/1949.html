<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider splitting `PLR2004` (`MagicValueComparison`) into different rules - astral-sh/ruff #1949</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Consider splitting `PLR2004` (`MagicValueComparison`) into different rules</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/1949">#1949</a>
        opened by <a href="https://github.com/ofek">@ofek</a>
        on 2023-01-18 06:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ofek">@ofek</a> on 2023-01-18 06:07</div>
            <div class="timeline-body"><p>I would suggest one rule for numeric types and another that would be the current behavior. Checking string values inline is extremely common and as it is now when I have time I'm going to disable this for new projects generated by Hatch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1828.html">astral-sh/ruff#1828</a> on 2023-01-18 06:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2023-01-18 06:59</div>
            <div class="timeline-body"><p>For example, Hatch which is a moderately sized project with high code coverage has almost 600 instances of this and none of them are numeric https://github.com/pypa/hatch/actions/runs/3946429939/jobs/6754217718 ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/martinkozle">@martinkozle</a> on 2023-01-18 09:10</div>
            <div class="timeline-body"><p>Yeah this rule doesn't make sense to me for single occurrence inline strings. Inline string values most of the time are self explanatory because, well, they are strings. And in 90% of cases the constant variable that would replace them would have the same exact name as the string value.
Is it ruff's goal to be opinionated and make such changes? Because this is just an implementation of pylint rule R2004. This issue should probably be reopened on the pylint repository if I am not mistaken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-18 12:45</div>
            <div class="timeline-body"><p>In this case, it's Ruff's goal for <code>R2004</code> to be a faithful reimplementation of the Pylint rule. We do deviate from &quot;upstream&quot; rules to fix clear false positives or false negatives (especially when there are open issues in the upstream repo), but in this case, it feels like this would be changing the definition of the rule?</p>
<p>(Though it's outside the scope of this issue: eventually, we want to get to that point that the flake8 and pylint terminology and mappings are viewed as more of a compatibility layer. E.g., we'll likely recategorize the rules into a first-class taxonomy; we may migrate from numeric to human-readable codes, and so on. Should we make these changes, the intent is for it be done in a way that preserves existing compatibility and even allows for &quot;automatic&quot; configuration migrations -- but the idea is that we'd start viewing Ruff's taxonomy as its own standalone thing rather than a reimplementation, while retaining all the compatibility benefits we get today.)</p>
<p>A few comments (even if not a prescriptive solution, yet -- to be clear, I definitely want to figure out something that works for @ofek here):</p>
<ul>
<li>We could introduce a <em>separate</em> rule in Ruff itself (in the <code>RUF</code> category` that's more discriminate, and Hatch (and others) could use that in lieu of the Pylint rules.</li>
<li>We could add a configuration option to avoid checking strings. That doesn't exist in Pylint, but it'd be easy to add (I could do it today, certainly).</li>
<li>This rule is actually only enabled in Pylint when users turn on the <a href="https://pylint.pycqa.org/en/latest/user_guide/configuration/all-options.html#magic-value-checker"><code>Magic-value</code> extension</a>. So in some sense, it should require more &quot;opt-in&quot; than merely enabling the <code>PLR</code> rule category. We don't have a great way to express that in our API, but I thought I would mention it.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-01-18 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-18 21:52</div>
            <div class="timeline-body"><p>Specifically, a configuration option would look something like:</p>
<pre><code class="language-toml">[tool.ruff.pylint]
allow-magic-value-comparisons = [&quot;str&quot;] # Or &quot;string&quot;? Or &quot;String&quot;?
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2023-01-18 21:59</div>
            <div class="timeline-body"><p>Yeah that sounds like a reasonable option. In the future scenario in which Ruff has its own rule taxonomy it would be nice if the default behavior excluded strings since almost everyone will add that to their config, or simply not use PL*</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-18 22:51</div>
            <div class="timeline-body"><p>Yeah, I would likely either exclude strings or even omit this rule altogether from the default set. (I personally don't find it useful, but I try to avoid injecting too much of my own opinion when porting third-party rules.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-18 22:51</div>
            <div class="timeline-body"><p>I do think it'd be reasonable for you to omit the <code>PL*</code> rules by default in Hatch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2023-01-18 23:06</div>
            <div class="timeline-body"><blockquote>
<p>I would likely either exclude strings or even omit this rule altogether from the default set.</p>
</blockquote>
<p>I think the rule for numeric types is quite useful and is actually something that I will probably always comment on in a code review.</p>
<blockquote>
<p>I do think it'd be reasonable for you to omit the <code>PL*</code> rules by default in Hatch.</p>
</blockquote>
<p>I hadn't considered doing that but maybe that's a good idea. 2004 is the only thing that I think would be disruptive though and I want beginners to get as much benefit as possible out of this in order to learn best practices.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-01-19 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1987.html">astral-sh/ruff#1987</a> on 2023-01-19 01:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-19 01:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-19 01:45</div>
            <div class="timeline-body"><p>Added said option in #1987. I actually went ahead and ignored string comparisons by default per this thread. It deviates from Pylint, but users can always re-enable string comparisons via the setting, so that's fine with me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ofek">@ofek</a> on 2023-01-19 02:53</div>
            <div class="timeline-body"><p>Thank you!!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-19 03:02</div>
            <div class="timeline-body"><p>Of course, thanks as always for being such a great supporter of the project @ofek!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/12155.html">astral-sh/ruff#12155</a> on 2024-07-02 18:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
