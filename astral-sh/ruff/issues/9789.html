<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC2801 triggers for cases that are not necessarily errors - astral-sh/ruff #9789</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>PLC2801 triggers for cases that are not necessarily errors</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/9789">#9789</a>
        opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a>
        on 2024-02-02 16:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ThiefMaster">@ThiefMaster</a></div>
            <div class="timeline-body"><p>Is PLC2801 really supposed to trigger in this case, and suggest using a <code>get</code> method that does not exist? I can of course easily silence the rule, but just in case it's overzealous here I'm opening this issue.</p>
<pre><code class="language-python">class classproperty(property):
    def __get__(self, obj, type=None):
        return self.fget.__get__(None, type)()


class A:
    @classproperty
    @classmethod
    def prop(cls):
        return 'aaa'


class B:
    prop = 'bbb'


class C:
    pass


class Foo(A, B, C):
    @classmethod
    def test(cls):
        for class_ in reversed(cls.mro()[:-1]):
            prop = class_.__dict__.get('prop')
            if isinstance(prop, classproperty):
                prop = prop.__get__(None, class_)
            print(class_.__name__, prop)


Foo.test()
</code></pre>
<pre><code>[adrian@eluvian:~/dev/indico/py3/src:update-ruff +$]&gt; ruff --version
ruff 0.2.0

[adrian@eluvian:~/dev/indico/py3/src:update-ruff +$]&gt; ruff --isolated --select PLC2801 --preview --no-cache rufftest/ruff_sample.py
rufftest/ruff_sample.py:27:24: PLC2801 Unnecessary dunder call to `__get__`. Use `get` method.
   |
25 |             prop = class_.__dict__.get('prop')
26 |             if isinstance(prop, classproperty):
27 |                 prop = prop.__get__(None, class_)
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^ PLC2801
28 |             print(class_.__name__, prop)
   |
   = help: Use `get` method

Found 1 error.

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-02-02 16:18</div>
            <div class="timeline-body"><p>Huh... reading https://docs.python.org/3/howto/descriptor.html this sounds like a totally incorrect suggestion for how <code>__get__</code> is supposed to work in the first place?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2024-02-02 16:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-02-02 16:20</div>
            <div class="timeline-body"><p>Yes, <code>__get__</code> is a property thing and has nothing to do with a dict's <code>.get()</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2024-02-02 16:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 16:37</div>
            <div class="timeline-body"><p>Looks like it is similar in Pylint: https://github.com/pylint-dev/pylint/blob/6062c1d8bb16de5d1a9f14f51b265653483ad6dd/pylint/constants.py#L143</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LefterisJP">@LefterisJP</a> on 2024-02-04 13:47</div>
            <div class="timeline-body"><p>We also get lots of unecessary hits on this rule. We also use the dunder set in a hacky way to get around immutability somewhere temporarily so it's also on us, but then this rule also hits.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-04 18:14</div>
            <div class="timeline-body"><p>I believe we're removing <code>__get__</code> and <code>__set__</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-02-05 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s-banach">@s-banach</a> on 2024-05-24 17:25</div>
            <div class="timeline-body"><p>Why would calling a dunder method ever be an error?
Nobody is doing it accidentally, they do it because they're method chaining.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2024-05-24 17:27</div>
            <div class="timeline-body"><p>Just because something is possible it's not a good idea. And you can disable the rule altogether if you like doing it and want to keep doing it in your own codebase...</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:49:32 UTC
    </footer>
</body>
</html>
