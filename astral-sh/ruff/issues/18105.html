<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule proposal: subclasses of a `@dataclass` should be a `@dataclass` - astral-sh/ruff #18105</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule proposal: subclasses of a <code>@dataclass</code> should be a <code>@dataclass</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/18105">#18105</a>
        opened by <a href="https://github.com/netanel-haber">@netanel-haber</a>
        on 2025-05-14 19:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/netanel-haber">@netanel-haber</a></div>
            <div class="timeline-body">Summary
<p>The following situation is almost certainly a user oversight [although legal]:
subclasses not annotated with <code>@dataclass</code> of superclasses that <em>are</em> annotated with <code>@dataclass</code>.</p>
<p>The 5 tools I checked didn&#x27;t provide a diagnostic/warning for this: mypy, ruff, ty, pylint, flake8.</p>
<pre><code>from dataclasses import dataclass

@dataclass(kw_only=True, frozen=True)
class Base:
    x: int

# The user almost certainly forgot to annotate Child with `@dataclass(kw_only=True, frozen=True)`
class Child(Base):
    y: int  # Just a class attribute, not a dataclass field

Child(x=1,y=2)         # TypeError: Base.__init__() got an unexpected keyword argument &#x27;y&#x27;
Child.__init__         # &quot;Signature: Child.__init__(self, *, x: int) -&gt; None&quot;
</code></pre>
<p>Would it make sense for me to try to create a rule for this?
It should also be discussed whether the rule should additionally enforce that the annotations provide identical arguments (e.g. kw_only etc.) as well, but this is less important than the warning about a complete absence of the annotation as that is easy to miss across files, and additionally it might be more complex to eke out whether the user actually <em>did</em> intent to provide disparate arguments.</p>
<p>Related to: https://docs.astral.sh/ruff/rules/implicit-class-var-in-dataclass/.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;warning for subclasses not annotated with `@dataclass` of superclasses that *are* annotated with `@dataclass`&quot; to &quot;Rule proposal: warning for subclasses not annotated with `@dataclass` of superclasses that *are* annotated with `@dataclass`&quot; by <a href="https://github.com/netanel-haber">@netanel-haber</a> on 2025-05-14 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Rule proposal: warning for subclasses not annotated with `@dataclass` of superclasses that *are* annotated with `@dataclass`&quot; to &quot;Rule proposal: subclasses of a `@dataclass` should be a `@dataclass`&quot; by <a href="https://github.com/netanel-haber">@netanel-haber</a> on 2025-05-14 19:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 20:19</div>
            <div class="timeline-body"><p>I don&#x27;t think it would make sense to try to add a <em>ruff</em> rule for this since you&#x27;d be limited to analyzing a single file at a time. So you&#x27;d need the type inference/multi-file analysis from ty. But I don&#x27;t think we&#x27;re quite ready to add type-inference-powered lint rules there either.</p>
<p>In short, it sounds like a good idea, but I don&#x27;t think it would be doable to implement it right now.</p>
<p>Somewhat related: <a href="https://github.com/astral-sh/ruff/issues/5837">astral-sh/ruff#5837</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-05-14 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/netanel-haber">@netanel-haber</a> on 2025-05-15 13:50</div>
            <div class="timeline-body"><p>I assume the model for those will be similar to typescript-eslint, a ruff plugin that uses ty for type-informed linting rules.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:57 UTC
    </footer>
</body>
</html>
