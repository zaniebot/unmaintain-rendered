```yaml
number: 19581
title: RUF033 fix changes the default expression’s indentation
type: issue
state: closed
author: dscorbett
labels:
  - bug
  - fixes
assignees: []
created_at: 2025-07-28T02:00:58Z
updated_at: 2025-08-27T19:15:45Z
url: https://github.com/astral-sh/ruff/issues/19581
synced_at: 2026-01-10T01:56:57Z
```

# RUF033 fix changes the default expression’s indentation

---

_Issue opened by @dscorbett on 2025-07-28 02:00_

### Summary

When the fix for [`post-init-default` (RUF033)](https://docs.astral.sh/ruff/rules/post-init-default/) moves and reindents the expression for a parameter’s default, it changes line-initial white space within a string literal, which changes the program’s behavior. [Example](https://play.ruff.rs/c5f9e029-9779-4d41-b6a7-e681f76b5a1e):
```console
$ cat >ruf033.py <<'# EOF'
from dataclasses import dataclass
@dataclass
class C:
    def __post_init__(self, x: int = """
    """) -> None:
        self.x = x
print(len(C().x))
# EOF

$ python ruf033.py
5

$ ruff --isolated check ruf033.py --select RUF033 --unsafe-fixes --fix
Found 1 error (1 fixed, 0 remaining).

$ cat ruf033.py
from dataclasses import dataclass, InitVar
@dataclass
class C:
    x: InitVar[int] = """
        """
    def __post_init__(self, x: int) -> None:
        self.x = x
print(len(C().x))

$ python ruf033.py
9
```

In general, even when it doesn’t change the program’s behavior, the fix’s indentation is stylistically poor. The new indentation should be the same relative to the indentation of the first line of the new `InitVar` attribute as the old indentation was to the indentation of the first line of the old `__post_init__` parameter. For example, [this](https://play.ruff.rs/f2d963b0-5987-4e55-8753-790b3f01e893):
```python
from dataclasses import dataclass
@dataclass
class C:
    def __post_init__(self, x: tuple[int, ...] = (
        1,
        2,
    )) -> None:
        self.x = x
```
becomes:
```python
from dataclasses import dataclass, InitVar
@dataclass
class C:
    x: InitVar[tuple[int, ...]] = (
            1,
            2,
        )
    def __post_init__(self, x: tuple[int, ...]) -> None:
        self.x = x
```
but should become:
```python
from dataclasses import dataclass, InitVar
@dataclass
class C:
    x: InitVar[tuple[int, ...]] = (
        1,
        2,
    )
    def __post_init__(self, x: tuple[int, ...]) -> None:
        self.x = x
```

### Version

ruff 0.12.5 (d13228ab8 2025-07-24)

---

_Comment by @MichaReiser on 2025-07-28 09:43_

Thank you


> In general, even when it doesn’t change the program’s behavior, the fix’s indentation is stylistically poor. The new indentation should be the same relative to the indentation of the first line of the new InitVar attribute as the old indentation was to the indentation of the first line of the old __post_init__ parameter

For anyone picking this up. Stylistically "nice" fixes is a nice to have and not a strict requirement for ruff's fixes. We try to create reasonable looking code but we sometimes decide not to do so to reduce the fix complexity. I don't know whether fixing this here is easy and even required to address the underlying issue but I'd be fine with a PR that only fixes the semantic difference. 

---

_Label `bug` added by @MichaReiser on 2025-07-28 09:43_

---

_Label `fixes` added by @MichaReiser on 2025-07-28 09:43_

---

_Comment by @dscorbett on 2025-07-28 12:05_

Replacing the rule’s use of `textwrap::indent` with something that only indents the first line, not all the lines, should fix both the correctness issue and the style issue.

---

_Referenced in [astral-sh/ruff#19647](../../astral-sh/ruff/pulls/19647.md) on 2025-07-30 19:50_

---

_Closed by @ntBre on 2025-08-27 19:15_

---
