<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule request: useless generator call - astral-sh/ruff #19018</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Rule request: useless generator call</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19018">#19018</a>
        opened by <a href="https://github.com/xavdid">@xavdid</a>
        on 2025-06-28 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/xavdid">@xavdid</a></div>
            <div class="timeline-body">Summary
<p>Because generators don&#x27;t execute until they&#x27;re consumed, I had a small bug today where I expected a function call to throw and it didn&#x27;t.</p>
<pre><code>import pytest

def my_gen():
    yield 1
    yield 2
    
    raise ValueError()

def test_raises(): # test fails incorrectly
    with pytest.raises(ValueError):
        my_gen()
</code></pre>
<p>Though everything looks correct (and passes all the lints I could find), <code>test_raises</code> fails because the expression doesn&#x27;t actually raise.</p>
<p>To produce working code, I&#x27;d need to consume the generator:</p>
<pre><code>def test_raises(): # test fails incorrectly
    with pytest.raises(ValueError):
-       my_gen()
+       list(my_gen())
</code></pre>
<p>And then it passes as expected.</p>
<p>It would be great if it could warn me that the generator call won&#x27;t do anything. The original code should fail the lint, but assigning it to a variable or using the result in another function (like <code>list</code>) should pass.</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-28 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-28 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-28 22:59</div>
            <div class="timeline-body"><p>This sounds reasonable to me, but I&#x27;m open to other thoughts.</p>
<p>Somewhat related: <a href="https://github.com/astral-sh/ruff/issues/9833">astral-sh/ruff#9833</a>. This rule could benefit from better type inference too, but we could potentially handle the single-file case for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-07 12:49</div>
            <div class="timeline-body"><p>The single file is tricky because it only works if the called functions annotate their return types. Which isn&#x27;t the case for the example provided by @xavdid. I&#x27;m not sure how useful this rule is without return type inference</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:10 UTC
    </footer>
</body>
</html>
