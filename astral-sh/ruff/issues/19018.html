<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule request: useless generator call - astral-sh/ruff #19018</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Rule request: useless generator call</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/19018">#19018</a>
        opened by <a href="https://github.com/xavdid">@xavdid</a>
        on 2025-06-28 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/xavdid">@xavdid</a> on 2025-06-28 19:05</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Because generators don't execute until they're consumed, I had a small bug today where I expected a function call to throw and it didn't.</p>
<pre><code class="language-py">import pytest

def my_gen():
    yield 1
    yield 2
    
    raise ValueError()

def test_raises(): # test fails incorrectly
    with pytest.raises(ValueError):
        my_gen()
</code></pre>
<p>Though everything looks correct (and passes all the lints I could find), <code>test_raises</code> fails because the expression doesn't actually raise.</p>
<p>To produce working code, I'd need to consume the generator:</p>
<pre><code class="language-diff">def test_raises(): # test fails incorrectly
    with pytest.raises(ValueError):
-       my_gen()
+       list(my_gen())
</code></pre>
<p>And then it passes as expected.</p>
<p>It would be great if it could warn me that the generator call won't do anything. The original code should fail the lint, but assigning it to a variable or using the result in another function (like <code>list</code>) should pass.</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-06-28 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-06-28 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-28 22:59</div>
            <div class="timeline-body"><p>This sounds reasonable to me, but I'm open to other thoughts.</p>
<p>Somewhat related: https://github.com/astral-sh/ruff/issues/9833. This rule could benefit from better type inference too, but we could potentially handle the single-file case for now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-07 12:49</div>
            <div class="timeline-body"><p>The single file is tricky because it only works if the called functions annotate their return types. Which isn't the case for the example provided by @xavdid. I'm not sure how useful this rule is without return type inference</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
