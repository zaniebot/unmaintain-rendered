<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fix failed to converge within 100 iterations, ruff-0.0.206 - astral-sh/ruff #1575</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fix failed to converge within 100 iterations, ruff-0.0.206</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/1575">#1575</a>
        opened by <a href="https://github.com/marscher">@marscher</a>
        on 2023-01-03 00:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/marscher">@marscher</a> on 2023-01-03 00:17</div>
            <div class="timeline-body"><p>command: <code>ruff --fix $file  # code posted below</code></p>
<p>output:</p>
<pre><code>weldx/transformations/rotation.py:22:5: D203 1 blank line required before class docstring
weldx/transformations/rotation.py:22:5: D213 Multi-line docstring summary should start at the second line
weldx/transformations/rotation.py:29:9: D213 Multi-line docstring summary should start at the second line
weldx/transformations/rotation.py:39:9: D213 Multi-line docstring summary should start at the second line
weldx/transformations/rotation.py:49:9: D213 Multi-line docstring summary should start at the second line
weldx/transformations/rotation.py:65:9: D213 Multi-line docstring summary should start at the second line
Found 106 error(s) (100 fixed, 6 remaining).

</code></pre>
<p>pyproject.toml (ruff.tool section):</p>
<pre><code class="language-toml">[tool.ruff]
exclude = [
    '__init__.py',
    'doc/conf.py',
]
# TODO: should be the following list, but Ruff does not yet impl all of them.
#    W503,W504
#    E203
#    C408
ignore = ['C408','E402']
line-length = 88
select = [
    'B',
    'C',
    'D',
    'E',
    'F',
    'W',
    'UP', # pyupgrade
    'T',  # flake8-print
    #'B950'  # not yet implemented by Ruff.
]

external = [&quot;B950&quot;]
pydocstyle = {convention = &quot;numpy&quot;}
pyupgrade = {keep-runtime-typing = true}
mccabe = {max-complexity = 15}
target-version = &quot;py38&quot;
per-file-ignores = {&quot;**/{tests,tags,asdf}/**&quot; = [&quot;D&quot;]}
</code></pre>
<p>code:</p>
<pre><code class="language-python">&quot;&quot;&quot;Contains tools to handle rotations.&quot;&quot;&quot;
from __future__ import annotations

from typing import TYPE_CHECKING, Union

import pint
from scipy.spatial.transform import Rotation as _Rotation

from weldx.constants import U_
from weldx.constants import WELDX_UNIT_REGISTRY as UREG

if TYPE_CHECKING:  # pragma: no cover
    import numpy.typing as npt

_DEFAULT_LEN_UNIT = UREG.millimeters
_DEFAULT_ANG_UNIT = UREG.rad

ROT_META = &quot;wx_rot&quot;


class WXRotation(_Rotation):
    &quot;&quot;&quot;Wrapper for creating meta-tagged `~scipy.spatial.transform.Rotation` objects.

    See `scipy.spatial.transform.Rotation` docs for details.
    &quot;&quot;&quot;

    @classmethod
    def from_quat(cls, quat: npt.ArrayLike) -&gt; &quot;WXRotation&quot;:  # noqa
        &quot;&quot;&quot;Initialize from quaternions.

        See `scipy.spatial.transform.Rotation.from_quat` docs for details.
        &quot;&quot;&quot;
        rot = super().from_quat(quat)
        setattr(rot, ROT_META, {&quot;constructor&quot;: &quot;from_quat&quot;})
        return rot

    @classmethod
    def from_matrix(cls, matrix: npt.ArrayLike) -&gt; &quot;WXRotation&quot;:  # noqa
        &quot;&quot;&quot;Initialize from matrix.

        See `scipy.spatial.transform.Rotation.from_matrix` docs for details.
        &quot;&quot;&quot;
        rot = super().from_matrix(matrix)
        setattr(rot, ROT_META, {&quot;constructor&quot;: &quot;from_matrix&quot;})
        return rot

    @classmethod
    def from_rotvec(cls, rotvec: npt.ArrayLike) -&gt; &quot;WXRotation&quot;:  # noqa
        &quot;&quot;&quot;Initialize from rotation vector.

        See `scipy.spatial.transform.Rotation.from_rotvec` docs for details.
        &quot;&quot;&quot;
        rot = super().from_rotvec(rotvec)
        setattr(rot, ROT_META, {&quot;constructor&quot;: &quot;from_rotvec&quot;})
        return rot

    @classmethod
    @UREG.check(None, None, &quot;[]&quot;, None)
    def from_euler(
        cls,
        seq: str,
        angles: Union[pint.Quantity, npt.ArrayLike],
        degrees: bool = False,
    ) -&gt; &quot;WXRotation&quot;:  # noqa
        &quot;&quot;&quot;Initialize from euler angles.

        See `scipy.spatial.transform.Rotation.from_euler` docs for details.
        &quot;&quot;&quot;
        if isinstance(angles, pint.Quantity):
            if angles.u == U_(&quot;&quot;):
                angles = angles.to(&quot;rad&quot;)
            degrees = &quot;rad&quot; not in str(angles.u)
            if degrees:
                angles = angles.to(&quot;degree&quot;)
            else:
                angles = angles.to(&quot;rad&quot;)
            angles = angles.m

        rot = super().from_euler(seq=seq, angles=angles, degrees=degrees)
        setattr(
            rot,
            ROT_META,
            {&quot;constructor&quot;: &quot;from_euler&quot;, &quot;seq&quot;: seq, &quot;degrees&quot;: degrees},
        )
        return rot
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "failed to converge within 100 iterations, ruff-0.0.20" to "failed to converge within 100 iterations, ruff-0.0.206" by @marscher on 2023-01-03 00:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "failed to converge within 100 iterations, ruff-0.0.206" to "fix failed to converge within 100 iterations, ruff-0.0.206" by @marscher on 2023-01-03 00:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-03 00:38</div>
            <div class="timeline-body"><p>Taking a look.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-03 00:41</div>
            <div class="timeline-body"><p>I think the issue is that both <code>D203</code> and <code>D211</code> are enabled. I should add a warning for this. Those checks are incompatible (they exist to support different docstring conventions), so Ruff will just go back and forth fixing them endlessly.</p>
<p>I'd recommend disabling <code>D203</code>. In the next release, you could also remove <code>D</code> from your list and set:</p>
<pre><code class="language-toml">[tool.ruff.pydocstyle]
convention = &quot;google&quot;  # Accepts: &quot;google&quot;, &quot;numpy&quot;, or &quot;pep257&quot;.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/marscher">@marscher</a> on 2023-01-03 00:45</div>
            <div class="timeline-body"><p>Thank you so much! A warning would be helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-03 00:46</div>
            <div class="timeline-body"><p>On it now :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1576.html">astral-sh/ruff#1576</a> on 2023-01-03 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-01-03 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2289.html">astral-sh/ruff#2289</a> on 2023-01-28 03:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:49 UTC
    </footer>
</body>
</html>
