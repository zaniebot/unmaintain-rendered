<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Including F841 in the default --fix behaviour is a gigantic footgun - astral-sh/ruff #6835</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Including F841 in the default --fix behaviour is a gigantic footgun</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/6835">#6835</a>
        opened by <a href="https://github.com/ssokolow">@ssokolow</a>
        on 2023-08-24 04:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ssokolow">@ssokolow</a> on 2023-08-24 04:23</div>
            <div class="timeline-body"><p>I have a habit of writing my code from the top down and saving part-way through to trigger things like MyPy at a time when they won't be distracting. After installing Ruff and integrating it into my Vim+ALE-based setup that triggers everything (including autofix/autoformat) on save (thank you, rustfmt, for bringing my habits into the 21st century), I started getting confusing errors.</p>
<p>After a couple of times, I realized I wasn't at risk of dementia, but that Ruff was deleting assignments that I hadn't used <strong>yet</strong>... sometimes at the worst possible time for derailing my memory of how I planned things to work.</p>
<p>Beyond that, while it's very much a &quot;do not rely on this!&quot; thing in the Python language spec, because, in practice, CPython only uses garbage collection to break cycles and uses reference counting for non-cyclical data structures, dropping memory <em>does</em> have Rust-style determinism in CPython,  it <em>does</em> alter the drop order in the same way it would in Rust, and <a href="https://www.hyrumslaw.com/">Hyrum's law</a> <em>does</em> apply...</p>
<p>...which means the fixer can alter the semantics of the program in ways other than &quot;pulled the rug out from under the train of thought&quot;. Take a look at how ruff alters the observed behaviour of this code:</p>
<pre><code class="language-python">class Foo:
    def __init__(self, msg):
        self.msg = msg
    def __del__(self):
        print(self.msg)

def main():
    print(&quot;Yo Ho Ho&quot;)
    ham = Foo(&quot;bottle of rum&quot;)
    print(&quot;and a&quot;)

main()
</code></pre>
<pre><code class="language-sh">ssokolow@monolith ~ % python3 demo.py
Yo Ho Ho
and a
bottle of rum
ssokolow@monolith ~ % ruff --fix demo.py
Found 1 error (1 fixed, 0 remaining).
ssokolow@monolith ~ % python3 demo.py   
Yo Ho Ho
bottle of rum
and a
</code></pre>
<p>I think that, if <code>--fix</code> support is offered for F841, it shouldn't be part of the set of fixes that's enabled by default when a new user (or their IDE/editor integration plugin) just blindly runs <code>ruff --fix</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-24 13:58</div>
            <div class="timeline-body"><p>I think this will be solved once we respect suggested fixes on the CLI, since these are already &quot;suggested&quot; and not &quot;automatic&quot; fixes \cc @zanieb</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">autofix</span> added by @charliermarsh on 2023-08-24 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cli</span> added by @charliermarsh on 2023-08-24 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-24 13:59</div>
            <div class="timeline-body"><p>I'm going to merge with https://github.com/astral-sh/ruff/issues/4185 for that reason.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-08-24 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-08-24 13:59</div>
            <div class="timeline-body"><p>Thank you for reporting and sorry that it's been inconvenient for you. If you want, you <em>can</em> turn this off by marking it as <a href="https://beta.ruff.rs/docs/settings/#unfixable"><code>unfixable</code></a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssokolow">@ssokolow</a> on 2023-08-24 14:12</div>
            <div class="timeline-body"><p>Thanks.</p>
<p>I'll probably want to look up how to get ALE to specify <code>--unfixable</code> instead. I can't be dependant on PyQt or Django in <em>all</em> my projects and, as Rust's ecosystem matures and the allure of strong compile-time correctness beckons, I continue to push Python+MyPy further and further into the &quot;throwaway single-file script with no project folder&quot; niche.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssokolow">@ssokolow</a> on 2023-08-24 21:32</div>
            <div class="timeline-body"><p>For the record, it's <code>let g:ale_python_ruff_options = '--unfixable=F841'</code> in your <code>.vimrc</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7041.html">astral-sh/ruff#7041</a> on 2023-09-04 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7769.html">astral-sh/ruff#7769</a> on 2023-10-03 17:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
