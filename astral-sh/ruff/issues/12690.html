<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C419 should not flag set comprehensions for `sum` - astral-sh/ruff #12690</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>C419 should not flag set comprehensions for <code>sum</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12690">#12690</a>
        opened by <a href="https://github.com/dylwil3">@dylwil3</a>
        on 2024-08-05 16:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dylwil3">@dylwil3</a></div>
            <div class="timeline-body"><p>As was pointed out in a <a href="https://github.com/astral-sh/ruff/pull/12657#issuecomment-2267564369">recent comment</a>, set comprehension is not always as safe to remove as list comprehension in function calls because sets deduplicate elements.</p>
<p>For example:</p>
<pre><code class="language-python">sum({x for x in [1,1,1]})
</code></pre>
<p>is not the same as</p>
<pre><code class="language-python">sum(x for x in [1,1,1])
</code></pre>
<p>(Incidentally the violation message says &quot;list comprehension&quot; here when it ought to say &quot;set comprehension&quot;).</p>
<p><a href="https://play.ruff.rs/c1030c61-729c-4c33-9f29-40eab88c39ef">Playground link</a></p>
<p>I propose that we organize the builtins covered by this rule as either being <code>duplication-invariant</code> or not, and only suggest removing set comprehensions in that case. At the moment, the only <em>non</em> duplication-invariant rule is <code>sum</code> (but more builtins may be added later).</p>
<p>Incidentally, later we may have to also account for whether the builtin function is symmetric (i.e. invariant under permutation of the inputs), but maybe it's best to address that when the time comes (all currently supported builtins are symmetric).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-08-06 02:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-06 02:18</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-06 02:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-08-06 02:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:47 UTC
    </footer>
</body>
</html>
