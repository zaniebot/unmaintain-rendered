<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter undocumented deviation: remove parenthesis - astral-sh/ruff #7320</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter undocumented deviation: remove parenthesis</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/7320">#7320</a>
        opened by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a>
        on 2023-09-12 21:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-09-12 21:09</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Black formatting</p>
<pre><code class="language-python">def update_emission_strength(self: &quot;Lightshow&quot;, context: bpy.types.Context) -&gt; None:  # noqa: ARG001
    (
        get_rgbw_emission_node_tree(self)
        .nodes[&quot;Emission&quot;]
        .inputs[&quot;Strength&quot;]
        .default_value  # pyright: ignore
    ) = (self.emission_strength * 2)
</code></pre>
<p>Ruff formatting</p>
<pre><code class="language-python">def update_emission_strength(self: &quot;Lightshow&quot;, context: bpy.types.Context) -&gt; None:  # noqa: ARG001
    (
        get_rgbw_emission_node_tree(self).nodes[&quot;Emission&quot;].inputs[&quot;Strength&quot;].default_value  # pyright: ignore
    ) = self.emission_strength * 2
</code></pre>
<p>Ruff 0.0.289, line-length 100</p>
<p>The pragma deviation is documented, but not the removal of parenthesis.</p>
<p>I prefer the Ruff formatting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-13 06:28</div>
            <div class="timeline-body"><p>There are two differences here:</p>
<ol>
<li>Ruff splits the call chain differently because of the <code>pyright: ignore</code> comment. I think the current formatting is fine because enforcing black's layout can be wrong if you intend to document the whole call chain (and not just the last attribute).</li>
<li>Black seems to parenthesize the right if the assignment target doesn't fit, regardless of whether the assigned value was parenthesized before. Adding these parentheses seems unnecessary in my view.</li>
</ol>
<pre><code class="language-python"># Blacked code

def update_emission_strength():
    (
        get_rgbw_emission_node_tree(self)
        .nodes[&quot;Emission&quot;]
        .inputs[&quot;Strength&quot;]
        .default_value  # pyright: ignore
    ) = (self.emission_strength * 2)

    (
        get_rgbw_emission_node_tree(self)
        .nodes[&quot;Emission&quot;]
        .inputs[&quot;Strength&quot;]
        .default_value  # pyright: ignore
    ) = (self.emission_strength * 2)


def update_emission_strength():
    (get_rgbw_emission_node_tree(self).nodes[&quot;Emission&quot;].default_value) = self.emission_strength * 2


def update_emission_strength():
    (get_rgbw_emission_node_tree(self).nodes[&quot;Emission&quot;].default_valueeeeeeeeeeeeee) = (
        self.emission_strength * 2
    )


def update_emission_strength():
    (get_rgbw_emission_node_tree(self).nodes[&quot;Emission&quot;].default_valueeeeeeeeeeeeee) = (
        self.emission_strength * 2
    )


def update_emission_strength():
    (
        get_rgbw_emission_node_tree(self)
        .nodes[&quot;Emission&quot;]
        .default_valueeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
    ) = (self.emission_strength * 2)

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @MichaReiser on 2023-09-13 06:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-09-13 06:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-09-13 06:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 15:34</div>
            <div class="timeline-body"><p>The parentheses we're considering an intentional deviation. Can be closed once it's documented.</p>
<p>The comment positioning deviation is expected because we ignore suppression comments when computing line length. (If you change it to some other comment, we use the same formatting as Black, apart from the extra parentheses on the RHS.) We're not planning to change this for the Beta, but we'll revisit based on feedback around suppression comment handling more generally.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-09-27 18:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/7679.html">astral-sh/ruff#7679</a> on 2023-09-27 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> removed by @MichaReiser on 2023-09-28 09:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @MichaReiser on 2023-09-28 09:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-29 17:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
