<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unlike `pyflakes`, which correctly detects the problem, `redefined-while-unused (F811)` does not report duplicate imports when `if TYPE_CHECKING` is used - astral-sh/ruff #21888</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unlike <code>pyflakes</code>, which correctly detects the problem, <code>redefined-while-unused (F811)</code> does not report duplicate imports when <code>if TYPE_CHECKING</code> is used</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/21888">#21888</a>
        opened by <a href="https://github.com/alessio-locatelli">@alessio-locatelli</a>
        on 2025-12-10 07:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alessio-locatelli">@alessio-locatelli</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<h4>MRE</h4>
<pre><code class="language-py">from collections.abc import Iterator
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from collections.abc import Iterator


def func(_: Iterator[int]): ...
</code></pre>
<h4>ruff behavior (it fails to detect the problem)</h4>
<p>Command:</p>
<pre><code class="language-bash">ruff check --select=F --preview mre.py
</code></pre>
<p>Output:</p>
<pre><code>All checks passed!
</code></pre>
<p>Command:</p>
<pre><code class="language-bash">ruff check --select=F mre.py
</code></pre>
<p>Output:</p>
<pre><code>All checks passed!
</code></pre>
<h4><code>pyflakes</code> (it correctly detects the problem)</h4>
<p>Command:</p>
<pre><code class="language-bash">uvx pyflakes mre.py
</code></pre>
<p>Output:</p>
<pre><code>mre.py:5:5: redefinition of unused 'Iterator' from line 1
</code></pre>
<h3>Version</h3>
<p>0.14.8</p>
<h3>Notes</h3>
<p>By the way, running <code>ruff check --select=ALL --verbose mre.py</code> on the same code shows:</p>
<pre><code>TC004 Move import `collections.abc.Iterator` out of type-checking block. Import is used for more than type hinting.
 --&gt; mre.py:5:33
  |
4 | if TYPE_CHECKING:
5 |     from collections.abc import Iterator
  |                                 ^^^^^^^^
  |
help: Move out of type-checking block
</code></pre>
<p>which looks like one more bug because <code>Iterator</code> in this file is used only for the type hinting.</p>
<p>Perhaps the logic in both rules should be fixed to follow the workflow:</p>
<pre><code class="language-mermaid">graph TD
    A[&quot;Start: Encounter Two Duplicate Imports (One under TYPE_CHECKING)&quot;] --&gt; B;
    B{Is the import actually used in this file for **more than just** type annotations?} -- Yes --&gt; C;
    B -- No --&gt; D;
    C[Keep import in **TYPE_CHECKING** block AND Delete the duplicate import above.] --&gt; E(End);
    D[&quot;Delete import from **TYPE_CHECKING** block (Keep the duplicate above, as it is used for runtime purposes).&quot;] --&gt; E;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-10 13:39</div>
            <div class="timeline-body"><p>Thanks for the report and for the cool diagram! I think this is a duplicate of https://github.com/astral-sh/ruff/issues/17555.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-12-10 13:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alessio-locatelli">@alessio-locatelli</a> on 2025-12-10 17:48</div>
            <div class="timeline-body"><p>I apologize for creating a duplicate issue; I searched for duplicates using the issue title.</p>
<p>Searching the issue body at https://github.com/search?q=repo%3Aastral-sh%2Fruff%20F811%20is%3Aissue&amp;type=issues yields 85 issues, which is simply impossible to review in an adequate amount of time.</p>
<p>@ntBre, if you have permission to edit the issue title, it would be greatly appreciated if you could include <code>F811</code> in the title of this issue: https://github.com/astral-sh/ruff/issues/17555. Perhaps this may help other people find an issue that is relevant to specific rule(s).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-12-10 17:54</div>
            <div class="timeline-body"><p>No worries, the search can be a bit unreliable. I only knew because I'd seen the other issue before, and I guess searching for <code>f811 type_checking</code> got me there faster. I'll update the title.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:40 UTC
    </footer>
</body>
</html>
