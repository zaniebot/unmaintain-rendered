<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`implicit-namespace-package` (`INP001`) - error is not reported in the language server when a package is nested inside an implicit namespace package - astral-sh/ruff #14752</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>implicit-namespace-package</code> (<code>INP001</code>) - error is not reported in the language server when a package is nested inside an implicit namespace package</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/14752">#14752</a>
        opened by <a href="https://github.com/DetachHead">@DetachHead</a>
        on 2024-12-03 10:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/DetachHead">@DetachHead</a></div>
            <div class="timeline-body"><p>the scenario covered by #14236 seems to work in the CLI, but the error is not reported in vscode.</p>
<p>i'm not sure if this is an issue with the vscode extension or the language server, but the language server seems to not be sending any diagnostics so i assume that's where the issue is.</p>
<p>i'm using the same version of ruff in both the CLI and the vscode extension: 0.8.1</p>
<h1>project structure</h1>
<pre><code>foo/
├── __init__.py
└── bar/
    └── baz/
        └── __init__.py
</code></pre>
<h1>cli output</h1>
<pre><code>&gt; ruff check --no-cache foo
foo\bar\baz\__init__.py:1:1: INP001 File `foo\bar\baz\__init__.py` declares a package, but is nested under an implicit namespace package. Add an `__init__.py` to `foo\bar`.
Found 1 error.
</code></pre>
<h1>vscode output</h1>
<p><img src="https://github.com/user-attachments/assets/50000174-b75a-422f-8899-17ac7716462b" alt="Image" /></p>
<pre><code>2024-12-03 20:47:55.022 [info] [Trace - 8:47:55 PM] Sending request 'textDocument/diagnostic - (175)'.
2024-12-03 20:47:55.022 [info] Params: {
    &quot;identifier&quot;: &quot;Ruff&quot;,
    &quot;textDocument&quot;: {
        &quot;uri&quot;: &quot;file:///c%3A/Users/user/project/foo/bar/baz/__init__.py&quot;
    }
}


2024-12-03 20:47:55.028 [info] [Trace - 8:47:55 PM] Received response 'textDocument/diagnostic - (175)' in 6ms.
2024-12-03 20:47:55.028 [info] Result: {
    &quot;items&quot;: [],
    &quot;kind&quot;: &quot;full&quot;
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">server</span> added by @AlexWaygood on 2024-12-03 11:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-05 04:45</div>
            <div class="timeline-body"><p>Let me look into it. Can you provide the Ruff config file (if any) and the VS Code extension settings that's being used here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-12-05 04:51</div>
            <div class="timeline-body"><p>Yeah, this seems like a bug as we never account for the nested package root when checking from the server side:</p>
<p>https://github.com/astral-sh/ruff/blob/bd27bfab5d636cd5979ce78423ba069833ab13e2/crates/ruff_server/src/lint.rs#L86-L92</p>
<p>I'll need to look into the original change to understand where <code>PackageRoot::Nested</code> is being constructed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @dhruvmanila on 2024-12-05 04:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maxromanovsky">@maxromanovsky</a> on 2025-04-25 08:36</div>
            <div class="timeline-body"><p>Faced lack of this check too when migrating from <code>flake8-no-pep420</code> to ruff.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:51:43 UTC
    </footer>
</body>
</html>
