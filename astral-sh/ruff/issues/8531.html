<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Difference in line-length handling between ruff and black when line ends in # - astral-sh/ruff #8531</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Difference in line-length handling between ruff and black when line ends in #</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/8531">#8531</a>
        opened by <a href="https://github.com/dwyatte">@dwyatte</a>
        on 2023-11-06 22:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dwyatte">@dwyatte</a> on 2023-11-06 22:23</div>
            <div class="timeline-body"><p>Settings: Default ruff 0.1.3</p>
<p>Note: there is something specific about the example line below in terms of variable string length vs actual assignment value such that reproduction becomes difficult when changing the name/value, but this example captures the behavior I'm interested in raising in this issue</p>
<p>Example</p>
<pre><code>AAAAA_BBBBBBB_CCCC = &quot;xxxxxxxx_xxxxxxxxxx_xxx_xxxxxxxx_xx_xxxx_xxxxxxx_xxxx_xxxx_xxxx_xxxxxxx_xxxx_xxxxx&quot;
</code></pre>
<p>When the line above is suffixed with a <code>#</code> e.g., to disable linting / formatting, black will not break it:
https://black.vercel.app/?version=stable&amp;state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AFEAGhdAD2IimZxl1N_WjPZmMnerqoaitTnd2a09E8Bi61KJWbnQshHGxfdai0l17K2DqAdXFD89RHKQ6jT30nA8Il4tW9g8JRaFzqeaQ-5TntovkAApVkiDMflIUXe64zjHKvCTRtNm3SZQwHmAKLERh2XSkjRAAGEAcUCAAD5YQM5scRn-wIAAAAABFla</p>
<p>Ruff however, will always break this line into</p>
<pre><code>AAAAA_BBBBBBB_CCCC = (
    &quot;xxxxxxxx_xxxxxxxxxx_xxx_xxxxxxxx_xx_xxxx_xxxxxxx_xxxx_xxxx_xxxx_xxxxxxx_xxxx_xxxxx&quot;  #
)
</code></pre>
<p>My code has some long constant names that I'd prefer not to split and apparently <code># noqa: E501</code> is enough to exclude them from flake8 <em>as well as</em> black's formatting by virtue of how it handles lines ending in <code>#</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-06 22:28</div>
            <div class="timeline-body"><p>In general, we're far more careful with comment handling and therefore <em>can</em> wrap lines like that without fear of dropping comments accidentally.</p>
<p>We explicitly exclude pragma comments from the line length #6772</p>
<p>We provide a <code># fmt: skip</code> pragma to skip formatting of statements, which appears to be what you need here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @zanieb on 2023-11-06 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @zanieb on 2023-11-06 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dwyatte">@dwyatte</a> on 2023-11-06 22:43</div>
            <div class="timeline-body"><blockquote>
<p>We provide a # fmt: skip pragma to skip formatting of statements, which appears to be what you need here?</p>
</blockquote>
<p>Thanks, I think this will get me what I need although I suppose it's not clear how to support both disabling linting E501 <em>and</em> formatting on a single line -- I wonder if that's something ruff should support since it does both linting and formatting? Similar <code>black</code> feature that was recently implemented: https://github.com/psf/black/pull/3959</p>
<p>Seems this is a known divergence from <code>black</code> as you mention though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-07 15:14</div>
            <div class="timeline-body"><p>Hm yeah I don't see a good way to do that cc @MichaReiser</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-07 15:48</div>
            <div class="timeline-body"><p>This works as expected, which seems reasonable to me?</p>
<pre><code class="language-python">AAAAA_BBBBBBB_CCCC = &quot;xxxxxxxx_xxxxxxxxxx_xxx_xxxxxxxx_xx_xxxx_xxxxxxx_xxxx_xxxx_xxxx_xxxxxxx_xxxx_xxxxx&quot;  # fmt: skip  # noqa: E501
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-11-07 15:52</div>
            <div class="timeline-body"><p>@charliermarsh that is formatted for me with</p>
<pre><code>‚ùØ ruff version
ruff 0.1.3 (3e7b92991 2023-10-26)
</code></pre>
<p>but it looks fixed in 0.1.4 so @dwyatte perhaps upgrade</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-07 15:56</div>
            <div class="timeline-body"><p>Ah okay, interesting. I'll close for now then. It does require that the skip comes before the noqa, but I think that's <em>okay</em>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-07 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dwyatte">@dwyatte</a> on 2023-11-07 16:07</div>
            <div class="timeline-body"><blockquote>
<p>Ah okay, interesting. I'll close for now then. It does require that the skip comes before the noqa, but I think that's okay.</p>
</blockquote>
<p>Perfect, thanks all!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Stable" by @MichaReiser on 2023-11-28 06:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
