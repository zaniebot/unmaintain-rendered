<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTZ005 false postitive for `tz=None` - astral-sh/ruff #10251</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>DTZ005 false postitive for `tz=None`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/10251">#10251</a>
        opened by <a href="https://github.com/adriangb">@adriangb</a>
        on 2024-03-06 18:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/adriangb">@adriangb</a> on 2024-03-06 18:16</div>
            <div class="timeline-body"><pre><code class="language-python">import datetime

datetime.datetime.now(tz=None) 
# The use of `datetime.datetime.now()` without `tz` argument is not allowed Ruff DTZ005
</code></pre>
<p>ruff 0.1.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-06 19:29</div>
            <div class="timeline-body"><p>I think this is arguably a true positive, since <code>tz=None</code> is equivalent to omitting it, in that it won't produce a timezone-aware object. Perhaps the documentation and message need to be tweaked to reflect that?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @charliermarsh on 2024-03-06 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adriangb">@adriangb</a> on 2024-03-06 23:02</div>
            <div class="timeline-body"><p>I think itâ€™s arguable. No arguments could be a mistake (and is a common one). Explicitly passing None is acknowledging that you actually want None. In my case I want to use UTC everywhere except in a helper script.</p>
<p>But yes at least an error message tweak would be nice.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-03-06 23:26</div>
            <div class="timeline-body"><p>Yeah I also view it as borderline. I could definitely be convinced to ignore it. May need more opinions. @AlexWaygood, what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> removed by @charliermarsh on 2024-03-06 23:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2024-03-06 23:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-03-07 19:24</div>
            <div class="timeline-body"><p>It seems like we're following what the original flake8 rule does here, which is explicitly going out of its way to make sure that calls are still flagged when <code>None</code> is passed to this argument: https://github.com/pjknkda/flake8-datetimez/blob/1bcda18963ef61861a57c86f83741172884aadd1/flake8_datetimez.py#L96-L110. (But that's obviously not decisive -- if this is bad behaviour, we shouldn't do it!)</p>
<p>I... am sort-of inclined to leave this rule as it is, though. It's simple to explain currently: &quot;aware datetimes are good; naive datetimes are bad&quot;. Keeping a rule simple to explain to users and easy to describe in documentation is valuable. Moreover, if we changed the behaviour here, it's possible people who don't understand the rationale behind the rule might think that they're &quot;fixing&quot; the issue by passing <code>None</code> (since the linter stops complaining at them). That wouldn't necessarily be true.</p>
<p>I feel like if you're working in a domain where you don't need aware timezones, you can probably just not enable this rule on your project. And if you have a specific script in a larger project where it's just that script that doesn't need aware timezones, you can probably just put <code># ruff: noqa: DTZ005</code> somewhere near the top of the file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adriangb">@adriangb</a> on 2024-03-07 19:29</div>
            <div class="timeline-body"><blockquote>
<p>it's possible people who don't understand the rationale behind the ruule might think that they're &quot;fixing&quot; the issue by passing None (since linter stops complaining at them)</p>
</blockquote>
<p>That's a fair point, I hadn't thought of that.</p>
<p>I guess the other recommendation is to do:</p>
<pre><code class="language-python">datetime.now(tz=timezone.utc).astimezone()
</code></pre>
<p>Which I think gives you the local timezone, although it's not as simple as <code>tz=None</code></p>
<p>Either way, whatever you choose is fine by my, I just wanted to bring it to attention.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2024-03-11 17:13</div>
            <div class="timeline-body"><p>I think we should just improve the rule documentation and recommendation here</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @zanieb on 2024-03-11 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">documentation</span> added by @zanieb on 2024-03-11 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @zanieb on 2024-03-11 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @zanieb on 2024-03-11 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10590.html">astral-sh/ruff#10590</a> on 2024-03-25 21:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/10621.html">astral-sh/ruff#10621</a> on 2024-03-26 18:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2024-03-27 19:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:52 UTC
    </footer>
</body>
</html>
