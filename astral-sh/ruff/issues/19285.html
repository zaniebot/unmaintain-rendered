<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suggestion to edit #PLC0415 ruff rules - astral-sh/ruff #19285</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Suggestion to edit #PLC0415 ruff rules</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/19285">#19285</a>
        opened by <a href="https://github.com/lighting9999">@lighting9999</a>
        on 2025-07-11 13:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lighting9999">@lighting9999</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>While top-level imports are generally preferred, PEP 8 explicitly allows exceptions for:</p>
<blockquote>
<p>&quot;Imports [...] can be placed inside functions to avoid circular import problems&quot;</p>
</blockquote>
<p>#<a href="https://peps.python.org/pep-0008/#imports">PEP 8: Imports</a>
However, local imports are necessary as they can shorten code execution time. For example, in Doctests, loading imports at the top is <strong>unnecessary and may slow down code execution</strong>.<br />
So I suggest edit #PLC0415 rules</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Suggestion to readme #PLC0415 ruff rules" to "Suggestion to edit #PLC0415 ruff rules" by @lighting9999 on 2025-07-11 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-07-11 13:35</div>
            <div class="timeline-body"><p>Do you have a suggested edit in mind? I think this is already covered in the <a href="https://docs.astral.sh/ruff/rules/import-outside-top-level/">rule documentation</a>:</p>
<blockquote>
<p>An import statement would typically be placed within a function only to avoid a circular dependency, to defer a costly module load, or to avoid loading a dependency altogether in a certain runtime environment.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ntBre on 2025-07-11 13:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lighting9999">@lighting9999</a> on 2025-07-12 09:14</div>
            <div class="timeline-body"><p>But I think you can edit.
Because:
Impact:<br />
Local imports must be evaluated because unnecessary top-level imports significantly slow down execution. This is critical in contexts like doctests where:</p>
<ol>
<li><strong>Startup latency</strong> matters (milliseconds compound across test suites)</li>
<li><strong>Module-load overhead</strong> becomes measurable in hot code paths</li>
<li><strong>Resource consumption</strong> scales with unused imports&quot;
For example:</li>
</ol>
<pre><code class="language-python"># Slower: 15ms per doctest (100 tests = 1500ms)  
import heavy_library  

def test_function():  
    &quot;&quot;&quot;  
    &gt;&gt;&gt; test_function()  
    Result  
    &quot;&quot;&quot;  
    return heavy_library.process(&quot;data&quot;)  

# Faster: 2ms per doctest (100 tests = 200ms)  
def test_function():  
    &quot;&quot;&quot;  
    &gt;&gt;&gt; test_function()  
    Result  
    &quot;&quot;&quot;  
    import heavy_library  # Local import  
    return heavy_library.process(&quot;data&quot;)  
</code></pre>
<pre><code>So I suggest to edit this rules.</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-07-14 07:49</div>
            <div class="timeline-body"><p>The case you describe is already outlined in the documentation (see the documentation that @ntBre).</p>
<p>In the case of a heavy import, use a noqa comment or you can disable the rule alltogether if you disagree with it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2025-07-14 07:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:53:03 UTC
    </footer>
</body>
</html>
