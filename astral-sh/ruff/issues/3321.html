<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D406 auto-detect pydocstyle - astral-sh/ruff #3321</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>D406 auto-detect pydocstyle</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3321">#3321</a>
        opened by <a href="https://github.com/epenet">@epenet</a>
        on 2023-03-03 14:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epenet">@epenet</a> on 2023-03-03 14:54</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<ul>
<li><code>command</code>: <code>ruff .</code></li>
<li><code>version</code>: <code>ruff 0.0.247</code></li>
<li><code>pyproject.toml</code>: https://github.com/home-assistant/core/blob/3a34f818e8add8527ec66c85a4066162d2a715d9/pyproject.toml#L267-L274</li>
</ul>
<p>We currently ignore <code>D406</code> on the Home Assistant repository, and I would like to remove that code from the ignore list.</p>
<p>We also currently have a mixture of <code>numpy</code> and <code>google</code> styles, so we are not setting the convention at this stage.</p>
<p>What I don't understand right now is why <code>Args:</code> passes but not <code>Returns:</code> in the following docstring:</p>
<pre><code class="language-python">def get_gas_price(data: EasyEnergyData, hours: int) -&gt; float | None:
    &quot;&quot;&quot;Get the gas price for a given hour.

    Args:
        data: The data object.
        hours: The number of hours to add to the current time.

    Returns:
        The gas market price value.
    &quot;&quot;&quot;
</code></pre>
<p>I would expect either both <code>Args</code> and <code>Returns</code> to fail, or neither.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 15:03</div>
            <div class="timeline-body"><p>Will take a look at this today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @charliermarsh on 2023-03-03 15:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 19:12</div>
            <div class="timeline-body"><p><code>pydocstyle</code> does have the same behavior, I think:</p>
<pre><code class="language-py"> foo.py:2 in public function `get_gas_price`:
        D406: Section name should end with a newline ('Returns', not 'Returns:')
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 19:14</div>
            <div class="timeline-body"><p>Yeah this kind of thing has come up before. Basically, &quot;Returns&quot; is <em>both</em> a NumPy <em>and</em> a Google-compatible section name (but &quot;Args&quot; is not).</p>
<p>So if you have both, we infer &quot;NumPy&quot;, and don't validate the &quot;Args&quot; header. <code>pydocstyle</code> suffers from the same issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 19:14</div>
            <div class="timeline-body"><p>I think a better heuristic would be to see if there are any headers that are only in one of the two conventions (like &quot;Args&quot;).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-03-03 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 19:21</div>
            <div class="timeline-body"><p>I'll improve this a bit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epenet">@epenet</a> on 2023-03-03 21:40</div>
            <div class="timeline-body"><p>Cc @frenck, for information.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-03 21:42</div>
            <div class="timeline-body"><p>#3325 will improve this quite a bit, in that any docstring that contains (e.g.) <code>Args</code> will be treated as Google-style, any docstring that contains (e.g.) <code>Parameters</code> will be treated as NumPy-style, etc. (assuming you haven't set a <code>convention</code> in your config).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-03-03 22:13</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:29:33 UTC
    </footer>
</body>
</html>
