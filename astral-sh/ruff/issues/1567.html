<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: Add Length-Sort config to isort - astral-sh/ruff #1567</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: Add Length-Sort config to isort</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/1567">#1567</a>
        opened by <a href="https://github.com/einarwar">@einarwar</a>
        on 2023-01-02 22:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/einarwar">@einarwar</a> on 2023-01-02 22:09</div>
            <div class="timeline-body"><p>Thanks for an awsome library. I am currently trying to replace the old flake8 and isort setup on our repo with ruff.</p>
<p>We can almost replace isort with ruff, but we are currently using the <a href="https://pycqa.github.io/isort/docs/configuration/options.html#length-sort">Length-Sort</a> configuration from isort, which currently can't be found in ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-01-02 22:55</div>
            <div class="timeline-body"><p>Love the Annoy-o-Tron.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @charliermarsh on 2023-01-02 22:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @charliermarsh on 2023-01-04 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RobertCraigie">@RobertCraigie</a> on 2023-02-01 14:39</div>
            <div class="timeline-body"><p>We also need this to be able to migrate to ruff!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mihirsn">@mihirsn</a> on 2023-04-08 18:54</div>
            <div class="timeline-body"><p>Hi @charliermarsh üëãüèº I've started learning Rust for a while but haven't contributed yet and want to start from somewhere. So if you allow can I pick this one ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mihirsn">@mihirsn</a> on 2023-04-14 04:57</div>
            <div class="timeline-body"><p>Hi @charliermarsh, just wanted to know that if you have any idea for the implementation approach for this..if so could let me know I am thinking to pick this up. I saw the <a href="https://github.com/charliermarsh/ruff/pull/2082#issuecomment-1399410260">comment</a>, a bit confused by it.. so if you can elaborate it would be great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vadim-su">@vadim-su</a> on 2023-06-01 15:45</div>
            <div class="timeline-body"><p>Hi there :wave:
I will try to implement this option, but I have a question about the already implemented method.
Do I understand correctly that <code>order_by_type</code> and <code>length-sort</code> are mutually exclusive options? If so, should I add an enum with the options?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/warsaw">@warsaw</a> on 2023-06-08 17:39</div>
            <div class="timeline-body"><p>While you're at supporting <code>length-sort</code>, please also support <a href="https://pycqa.github.io/isort/docs/configuration/options.html#length-sort-straight"><code>length-sort-straight</code></a>.  That's probably the biggest isort feature I rely on that is missing from ruff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/warsaw">@warsaw</a> on 2023-06-17 19:56</div>
            <div class="timeline-body"><blockquote>
<p>Do I understand correctly that order_by_type and length-sort are mutually exclusive options? If so, should I add an enum with the options?</p>
</blockquote>
<p>I don't know the answer to that.  My guess is that they are not mutually exclusive since different isort options control them, but I don't know how they interact if both are set.</p>
<p>For <code>length-sort</code> and <code>length-sort-straight</code> my guess is that the latter is a subset of the former, but I'm not sure how they interact if say the former were true and the latter were false.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-09-25 17:01</div>
            <div class="timeline-body"><p>Hey! I'm currently working on this one and I have a working implementation of the basic functionality. @suharnikov if you're still working on it as well I'll leave it for you of course :)</p>
<p>I do have one question though, I couldn't help but notice that there are a bunch of functions that take in a whole lot of <code>isort</code> settings (like <code>format_imports</code> in <code>rules/isort/mod.rs</code>), and I was wondering why they don't just take in a reference to an <code>isort::settings::Settings</code>? Is there a particular reason for that? I tried changing the function signatures and it seems to work alright that way too.
Having all the settings passed around separately yields a fair amount of tedious work when you're trying to add a new setting because you have to chase down all the places that they need to be added and change all the function signatures.
But if there's a good reason that I just haven't figured out I'd love to know about it üôÇ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-25 17:31</div>
            <div class="timeline-body"><p>@bluthej - I think it's probably okay to refactor those methods to accept <code>Settings</code>. If you're able to work on that, do you mind putting it up as a standalone PR, with <em>just</em> that refactor, to make it easier to review and merge?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-09-25 19:13</div>
            <div class="timeline-body"><p>@charliermarsh absolutely! That's no problem at all :)</p>
<p>Then I'll start with the refactor and come back to this one when it's merged üòä</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-30 04:38</div>
            <div class="timeline-body"><p>#7963 is merged, which should pave the way for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-02 07:00</div>
            <div class="timeline-body"><p>Hey, so I got back to working on this, and that led me to the following question.</p>
<p>When using length-sort, isort will count the dots of relative imports in the length instead of sorting by distance and then length of the module name itself (without the dots). Is that the behavior we want? Or do we want to first sort based on distance and then length of module name?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-02 07:25</div>
            <div class="timeline-body"><p>Note: We should clarify whether the <code>length</code> means number of characters or the unicode width. Or are unicode names not supported by python (whether they're discouraged is another question ;))</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-02 17:52</div>
            <div class="timeline-body"><p>That's a fair point!</p>
<p>On my system (Python 12 on Arch Linux) I cannot seem to be able to import a module with a non-ASCII character, I get a module not found error. However importing members with non-ASCII characters works. Now isort uses the built-in <code>len</code>, which yields the number of characters, not the number of bytes or whatever.</p>
<p>I guess we can use <code>.chars().count()</code> to get the number of characters for members and <code>.len()</code> for modules (I assume the <code>len</code> method is faster because it doesn't iterate over the characters, it just accesses the length stored in the <code>str</code>/<code>String</code>). We might not sort modules properly if there are non-ASCII characters in some of them but as far as I can tell that means the input is not valid Python so it's probably worth the speedup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-11-03 10:22</div>
            <div class="timeline-body"><blockquote>
<p>Now isort uses the built-in <code>len</code>, which yields the number of characters</p>
</blockquote>
<p>What‚Äôs a ‚Äúcharacter‚Äù? I think <code>len</code> does codepoints and not, say, grapheme clusters ‚Ä¶</p>
<p>For a more accurate length, I think we‚Äôd have to iterate grapheme clusters and check <a href="https://unicode.org/reports/tr11/">which ones are likely to render at double width</a>. (Don‚Äôt let yourself be confused by ‚Äúwide character‚Äù sometimes meaning storage size and sometimes literal width on screen)</p>
<p>E.g. check out how my terminal renders ‚ÄúÂπ≥‚Äù, which of course is a valid Python identifier:</p>
<p><img src="https://github.com/astral-sh/ruff/assets/291575/c010a1c6-d7be-441e-91ab-a1315948b054" alt="image" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-03 17:30</div>
            <div class="timeline-body"><blockquote>
<p>What‚Äôs a ‚Äúcharacter‚Äù? I think <code>len</code> does codepoints and not, say, grapheme clusters ‚Ä¶</p>
</blockquote>
<p>According to the <a href="https://docs.python.org/3/howto/unicode.html#the-string-type">Python docs</a>:</p>
<blockquote>
<p>Since Python 3.0, the language‚Äôs str type contains Unicode characters</p>
</blockquote>
<p>and they add:</p>
<blockquote>
<p>The Unicode standard describes how characters are represented by code points</p>
</blockquote>
<p>So you are correct, <code>len</code> does codepoints. The Rust equivalent would be <code>.chars().count()</code> right?</p>
<blockquote>
<p>For a more accurate length, I think we‚Äôd have to iterate grapheme clusters</p>
</blockquote>
<p>I wouldn't necessarily say &quot;more accurate&quot;, but the argument can be made that it's more &quot;natural&quot; for humans. The downside is that it would make ruff behave differently from isort, so there's a bit of a tradeoff.</p>
<blockquote>
<p>E.g. check out how my terminal renders ‚ÄúÂπ≥‚Äù, which of course is a valid Python identifier:</p>
</blockquote>
<p>Interesting! I'm going to have to figure out why my example didn't work :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-03 17:34</div>
            <div class="timeline-body"><p>I would prefer that we use Unicode width, which is what we use everywhere else (even though we use the term &quot;length&quot; -- we nearly renamed them all when we released the formatter but decided to defer that decision).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-03 17:35</div>
            <div class="timeline-body"><p>(You should be able to call <code>.width()</code> on any string using the <code>use unicode_width::UnicodeWidthChar</code> trait.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/flying-sheep">@flying-sheep</a> on 2023-11-03 18:11</div>
            <div class="timeline-body"><p>That‚Äôs exactly the concept I was talking about btw :smiley:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluthej">@bluthej</a> on 2023-11-04 10:32</div>
            <div class="timeline-body"><blockquote>
<p>(You should be able to call <code>.width()</code> on any string using the <code>use unicode_width::UnicodeWidthChar</code> trait.)</p>
</blockquote>
<p>I think you meant the <code>unicode_width::UnicodeWidthStr</code> trait for strings :)
I switched to <code>.width()</code> and added some tests with non-ASCII characters.</p>
<p>What about relative imports? Should we follow isort and count the dots in the length?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-11-28 06:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:28:45 UTC
    </footer>
</body>
</html>
