<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXE003 and uv run? - astral-sh/ruff #13021</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>EXE003 and uv run?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13021">#13021</a>
        opened by <a href="https://github.com/fschulze">@fschulze</a>
        on 2024-08-21 04:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fschulze">@fschulze</a></div>
            <div class="timeline-body"><p>Should EXE003 be extended for <code>uv run</code>?</p>
<p>I used the following she-bang:</p>
<pre><code>#!/usr/bin/env uv run
</code></pre>
<p>Maybe another she-bang would work better?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-08-21 15:48</div>
            <div class="timeline-body"><p>@zanieb @charliermarsh, how official is the use of <code>uv run</code> in shebang?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ngnpope">@ngnpope</a> on 2024-08-21 17:14</div>
            <div class="timeline-body"><p>It'd be really nice to be able to do this for a fully distributable script, but note that it will need the <code>-S</code> flag.</p>
<p>Using the example from <a href="https://astral.sh/blog/uv-unified-python-packaging#single-file-scripts">here</a>:</p>
<pre><code class="language-python">#!/usr/bin/env -S uv run --quiet

# /// script
# requires-python = &quot;&gt;=3.12&quot;
# dependencies = [
#     &quot;requests&lt;3&quot;,
#     &quot;rich&quot;,
# ]
# ///

import requests
from rich.pretty import pprint

resp = requests.get(&quot;https://peps.python.org/api/peps.json&quot;)
data = resp.json()
pprint([(k, v[&quot;title&quot;]) for k, v in data.items()][:10])
</code></pre>
<p>This makes it usable as truly standalone executable, e.g. <code>./list-peps.py</code> instead of <code>uv run list-peps.py</code>:</p>
<pre><code class="language-console">$ ./list-peps.py 
[
‚îÇ   ('1', 'PEP Purpose and Guidelines'),
‚îÇ   ('2', 'Procedure for Adding New Modules'),
‚îÇ   ('3', 'Guidelines for Handling Bug Reports'),
‚îÇ   ('4', 'Deprecation of Standard Modules'),
‚îÇ   ('5', 'Guidelines for Language Evolution'),
‚îÇ   ('6', 'Bug Fix Releases'),
‚îÇ   ('7', 'Style Guide for C Code'),
‚îÇ   ('8', 'Style Guide for Python Code'),
‚îÇ   ('9', 'Sample Plaintext PEP Template'),
‚îÇ   ('10', 'Voting Guidelines')
]
</code></pre>
<p>And adding <code>--quiet</code> allows hiding the extra noise at the beginning:</p>
<pre><code class="language-console">Reading inline script metadata from: ./list-peps.py
</code></pre>
<hr />
<p>As a curious aside, if I wanted to drop the <code>.py</code> extension, <code>uv</code> gets confused and gets stuck in an recursive loop.</p>
<p>This is with switching <code>--quiet</code> for <code>--verbose</code>:</p>
<pre><code class="language-console">$ ./list-peps
DEBUG uv 0.3.0
DEBUG No project found; searching for Python interpreter
DEBUG Searching for Python interpreter in managed installations or system path
DEBUG Searching for managed installations at `.local/share/uv/python`
DEBUG Found `cpython-3.12.4-linux-x86_64-gnu` at `/home/nick/.pyenv/shims/python3` (search path)
DEBUG Using Python 3.12.4 interpreter at: /usr/bin/python3
DEBUG Running `./list-peps`
DEBUG uv 0.3.0
DEBUG No project found; searching for Python interpreter
DEBUG Searching for Python interpreter in managed installations or system path
DEBUG Searching for managed installations at `.local/share/uv/python`
DEBUG Found `cpython-3.12.4-linux-x86_64-gnu` at `/usr/bin/python3` (search path)
DEBUG Using Python 3.12.4 interpreter at: /usr/bin/python3
DEBUG Running `./list-peps`
...
</code></pre>
<p>So it doesn't seem to realise that it's a Python script and so doesn't look for the PEP 723 metadata and then attempts to call itself. I've not got around to reporting this yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fschulze">@fschulze</a> on 2024-08-22 07:50</div>
            <div class="timeline-body"><p>Hmm, it seems like <code>/usr/bin/env</code> isn't as portable as I thought:
https://stackoverflow.com/a/16365367/3748142</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @MichaReiser on 2024-08-22 08:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2024-08-22 08:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PaarthShah">@PaarthShah</a> on 2024-08-22 08:11</div>
            <div class="timeline-body"><p>@fschulze That answer is very, very outdated (from 2013, edited 2018). It's far more portable nowadays.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/martimlobao">@martimlobao</a> on 2025-01-29 09:32</div>
            <div class="timeline-body"><p>This is a @charliermarsh -<a href="https://x.com/charliermarsh/status/1884448591617384688">sanctioned</a> way of running <code>uv</code> scripts, clearly this rule needs to be updated üòè</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2025-01-29 13:49</div>
            <div class="timeline-body"><p>That's true!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avasam">@Avasam</a> on 2025-03-08 03:27</div>
            <div class="timeline-body"><p>Just hit this in typeshed, trying to promote usage of <code>uv run</code> to help new contributors who'd forget to enable (or don't want to handle) their virtual environment! https://github.com/python/typeshed/pull/13599</p>
<p>Also, would the <code>--active</code> flag be allowed here? Would any flag even be restricted (ie: just check for <code>uv run</code>)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andrei-korshikov">@andrei-korshikov</a> on 2025-03-19 03:04</div>
            <div class="timeline-body"><blockquote>
<p>Would any flag even be restricted (ie: just check for <code>uv run</code>)?</p>
</blockquote>
<p>I don't think that <code>uv run</code> options should be restricted‚Äîit would reduce flexibility. Sometimes I use <code>--offline</code>, for example.</p>
<p>Also don't forget, that <code>uv run</code> might not have space on the left:</p>
<pre><code class="language-sh">#! /usr/bin/env --split-string=uv run --script
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">priority:medium</span> added by @MichaReiser on 2025-03-19 07:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hyperknot">@hyperknot</a> on 2025-03-19 14:06</div>
            <div class="timeline-body"><p>I also come here to say that please embrace the uv shebang. This is currently the best way to work with Python scripts, yet it's totally unofficial / you have to ask on Discord level hidden.</p>
<p>I recommend the following:</p>
<ol>
<li>Please agree on an official uv shebang line. Just in this thread there are quite a few alternatives. I'm personally using</li>
</ol>
<pre><code>#!/usr/bin/env -S uv run
</code></pre>
<ol start="2">
<li><p>Advertise it everywhere, in the FAQ, in the uv init scripts, etc.</p>
</li>
<li><p>Modify EXE003 rule to allow this.</p>
</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-03-19 15:34</div>
            <div class="timeline-body"><p>I think for the purposes of this issue the linked PR should suffice - the rule was not doing anything super sophisticated to check for flags and such, it's just skipping if it finds, e.g. &quot;python&quot;.</p>
<p>As for advertising <code>uv run</code> and the shebang trick, and settling on the &quot;official recommendation&quot; - I'm all for it! But that probably makes more sense in the <code>uv</code> docs rather than the <code>ruff</code> docs üòÑ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-03-19 15:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hyperknot">@hyperknot</a> on 2025-03-19 16:53</div>
            <div class="timeline-body"><p>Thanks for the PR!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:56 UTC
    </footer>
</body>
</html>
