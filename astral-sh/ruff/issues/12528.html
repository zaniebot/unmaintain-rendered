<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linter: possibly W291 false positive - astral-sh/ruff #12528</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Linter: possibly W291 false positive</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12528">#12528</a>
        opened by <a href="https://github.com/minusf">@minusf</a>
        on 2024-07-26 12:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/minusf">@minusf</a> on 2024-07-26 12:42</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>I think this is a nice corner case, so perhaps not a bug at all. It is somewhat confusing though, please comment.</p>
<p>In ruff 0.5.5 I see a <code>Trailing whitespace</code> (W291) https://docs.astral.sh/ruff/rules/trailing-whitespace/#trailing-whitespace-w291 note for this tricky yaml inside a multiline <code>&quot;&quot;&quot;</code> python string:</p>
<pre><code class="language-py">in_yaml = &quot;&quot;&quot;

Key: &quot;‚ê£‚ê£^M&quot;  

&quot;&quot;&quot;
</code></pre>
<p><code>^M</code> is the control character for <code>0x0d</code> and the string is actually all on one line (in nvim). I think in this case the warning is a false positive as the default value for
https://docs.astral.sh/ruff/settings/#format_line-ending is <code>auto</code> and in all these files that would be native unix: <code>0x0a</code>.</p>
<p>Copy pasting it, etc however can turn it into</p>
<pre><code>in_yaml = &quot;&quot;&quot;

Key: &quot;‚ê£‚ê£
&quot;

&quot;&quot;&quot;
</code></pre>
<p>in which case <code>ruff</code> would be correct.</p>
<p>The pure python version fails even more completely:</p>
<pre><code class="language-py">text = &quot; ^M&quot;
</code></pre>
<pre><code>   ‚îÇ ‚îú‚ï¥E SyntaxError: missing closing quote in string literal Ruff  [1, 8]
   ‚îÇ ‚îú‚ï¥E SyntaxError: Expected a statement Ruff  [1, 10]
   ‚îÇ ‚îú‚ï¥E SyntaxError: missing closing quote in string literal Ruff  [2, 1]
   ‚îÇ ‚îú‚ï¥E SyntaxError: Expected a statement Ruff  [2, 2]
   ‚îÇ ‚îî‚ï¥W Trailing whitespace Ruff (W291) [1, 9]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-07-29 06:14</div>
            <div class="timeline-body"><p>Hi.</p>
<p>Thanks for the nice write-up. I'm trying to get my head around this issue, so I'll write down what I understand and add some notes:</p>
<ul>
<li><code>^M</code> is the ASCII character <code>0x0D</code> which is a <code>carriage return</code></li>
<li><code>would be native unix: 0x0a.: </code>0x0A` is a line feed</li>
</ul>
<blockquote>
<p><a href="https://docs.astral.sh/ruff/settings/#format_line-ending">docs.astral.sh/ruff/settings#format_line-ending</a> is auto</p>
</blockquote>
<p>The <code>format</code> option <code>line-ending</code> doesn't apply to <code>W291</code>. It only applies to <code>ruff format</code>, but not <code>ruff check</code>. It also is determined depending on the first line-ending in the file. You want to use <code>native</code> if you want to enforce <code>ln</code> on linux.</p>
<blockquote>
<p>The newline style is detected automatically on a file per file basis. Files with mixed line endings will be converted to the first detected line ending. Defaults to \n for files that contain no line endings.</p>
</blockquote>
<p>Can you tell me more about why you think the following snippet should not raise a trailing whitespace error?</p>
<pre><code class="language-python">text = &quot; ^M&quot;
</code></pre>
<p>What I understand is that the snippet is equivalent to</p>
<pre><code class="language-python">text = &quot; \r&quot;
</code></pre>
<p>where the string literal's first line ends with trailing whitespace</p>
<p>or without using any control character it's equivalent to (assuming <code>\r</code> line endings)</p>
<pre><code class="language-python">text = &quot;&quot;&quot;‚ê£‚ê£
&quot;&quot;&quot;
</code></pre>
<p>which also raises W291</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-07-29 07:24</div>
            <div class="timeline-body"><p>Thank you for looking into this. I was not sure if <code>line-ending</code> was used or not, but I mentioned it for completeness.</p>
<blockquote>
<p>Can you tell me more about why you think the following snippet should not raise a trailing whitespace error?</p>
</blockquote>
<p>Very good question. I think it basically boils down to:</p>
<p>Because my editor/my source code files uses <code>\n</code> as new line, not <code>\r</code>, the control character <code>^M</code> is a single character on a single line, followed by a <code>&quot;</code>. The last character on the line is <code>&quot;</code>, so &quot;technically&quot; there is no trailing whitespace.</p>
<p>But in the end I think I should just use <code>\r</code> instead of <code>^M</code> for obvious reasons üòÑ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2024-07-29 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2024-07-29 09:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:13 UTC
    </footer>
</body>
</html>
