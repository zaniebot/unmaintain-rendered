<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support text Jupyter notebooks created with Jupytext - astral-sh/ruff #8800</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Support text Jupyter notebooks created with Jupytext</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/8800">#8800</a>
        opened by <a href="https://github.com/owenlamont">@owenlamont</a>
        on 2023-11-21 03:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/owenlamont">@owenlamont</a> on 2023-11-21 03:44</div>
            <div class="timeline-body"><p>I have a use case for Ruff and Ruff formatter that is a bit related to some of the other Markdown / Docstring feature requests but specifically I hoped to run Ruff and Ruff formatter on Jupyter notebooks that had been exported to markdown with <a href="https://jupytext.readthedocs.io/en/latest/">Jupytext</a>.</p>
<p>The company I'm at prefer converting notebooks to Markdown as it makes the notebook diffs much easier to read on Bitbucket (which doesn't support any notebook rendering/diffing like GitHub).</p>
<p>At first I noticed I could add markdown as a target file format for Ruff formatter and linter which got my hopes up that this would just work:</p>
<pre><code class="language-yaml">  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: v0.1.6
    hooks:
      - id: ruff-format
        types_or: [python, pyi, jupyter, markdown]
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
        types_or: [python, pyi, jupyter, markdown]
</code></pre>
<p>But when I ran Ruff I see it is failing to parse the markdown properly - I had hoped it would just run on the python comment code blocks in the same way it would parse Jupyter notebook cells and ignore all the other markdown content but its obviously trying to parse all the markdown, e.g.</p>
<img width="1142" alt="image" src="https://github.com/astral-sh/ruff/assets/12672027/384f83de-5236-4184-89b2-b4ae4b232b1d">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-21 14:45</div>
            <div class="timeline-body"><p>Hey, we currently don't have support for linting / formatting Python code in markdown blocks (https://github.com/astral-sh/ruff/issues/8237, https://github.com/astral-sh/ruff/issues/3792). I'll close this in favor of the markdown issue for bookkeeping purposes as I think that should solve this but correct me if I'm wrong here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2023-11-21 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2023-11-21 14:48</div>
            <div class="timeline-body"><p>Hmm, actually it would be a bit different as for markdown we wouldn't need to have the concatenated source code from all code blocks but if it's a notebook converted to markdown then I think it should have context from other code blocks? @owenlamont Do you think this is true?</p>
<p>Another solution currently that I can think of is to lint / format <em>before</em> converting it to markdown. I'm not sure how feasible this would be given my lack of knowledge about your setup.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @dhruvmanila on 2023-11-21 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/owenlamont">@owenlamont</a> on 2023-11-21 20:41</div>
            <div class="timeline-body"><p>Hi @dhruvmanila - yeah it would have to have the concatenated source code - I can see Ruff still tracks which code was in which Jupyter cell when raising warnings so if it could treat comment blocks exactly as Jupyter cells are treated that would be ideal.</p>
<p>As a work-around it could be exported to ipynb, linted and formatted, then re-exported to markdown - but that would be onerous. When working with Jupytext the notebook never gets persisted (in any permanent/visible way) as an ipynb - it gets loaded from Markdown and saved back to Markdown.</p>
<p>The ideal solution (from my perspective) would be to parse the YAML front matter of the Markdown, identify this as a Juptext generated Markdown, then recognise the code blocks need to be concatenated and treated as notebook cells. I totally understand though if this use case is too niche to justify the effort though. I can't speak much as to how many people use this format - as a repo <a href="https://github.com/mwouts/jupytext">jupytext </a> is relatively popular (around 6k users - I recognise some relatively prominent Jupyter developers as contributors).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @dhruvmanila on 2023-12-01 01:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3792.html">astral-sh/ruff#3792</a> on 2024-01-26 09:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tvatter">@tvatter</a> on 2024-01-26 09:10</div>
            <div class="timeline-body"><p>There's a similar request for quarto notebooks (#6140), and generally for Python code included in Markdown code blocks (#3792).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6140.html">astral-sh/ruff#6140</a> on 2024-01-26 09:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">notebook</span> added by @dhruvmanila on 2024-02-12 06:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/11160.html">astral-sh/ruff#11160</a> on 2024-04-26 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Feature request: Lint and format Jupyter notebooks exported to markdown with Jupytext" to "Support text Jupyter notebooks created with Jupytext" by @dhruvmanila on 2024-04-26 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidorme">@davidorme</a> on 2024-06-06 10:39</div>
            <div class="timeline-body"><p>I think I'm looking at the same issue.  We also use Myst Markdown notebooks in several projects and have been using the <code>jupytext</code> ability to pipe code through <code>black</code> to apply Python formatting:</p>
<pre><code class="language-sh">$ jupytext --pipe black docs/source/users/pmodel/c3c4model.md 
[jupytext] Reading docs/source/users/pmodel/c3c4model.md in format md
[jupytext] Executing black -
reformatted -

All done! ‚ú® üç∞ ‚ú®
1 file reformatted.
[jupytext] Writing docs/source/users/pmodel/c3c4model.md in format md:myst
</code></pre>
<p>We have that as part of a <code>pre-commit</code> hook to ensure that the code in our notebooks is properly formatted.</p>
<pre><code class="language-yaml">  - repo: https://github.com/mwouts/jupytext
    rev: v1.16.2
    hooks:
    - id: jupytext
      args: [--pipe, black]
      files: docs/source 
      additional_dependencies:
        - black==24.4.2 # Matches hook
</code></pre>
<p>I haven't been able to work out exactly what happens, but the <code>jupytext.cli</code> module provides a <code>pipe_notebook</code> function that is used to round trip <em>something</em> (I think it must be just the code cell contents?) through <code>black</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ImperialCollegeLondon/pyrealm/pulls/247.html">ImperialCollegeLondon/pyrealm#247</a> on 2024-06-06 19:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidorme">@davidorme</a> on 2024-06-07 09:16</div>
            <div class="timeline-body"><p>OK - so <code>jupytext</code> converts the notebook to <code>percent</code> format, which is a python file with the markdown content stored as comments. <code>black</code> can then run on the code alone and the format can be converted back.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tovrstra">@tovrstra</a> on 2024-07-17 06:58</div>
            <div class="timeline-body"><p>Probably related: Ruff does currently not see <code>py:percent</code> files as notebooks. For example, for <code>py:percent</code> files, #8590 is still unresolved. (I'm not sure if this comment belongs here. I'm happy to open a new issue for it.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-07-17 07:44</div>
            <div class="timeline-body"><p>Yes, that's true. Currently, Ruff only supports the <a href="https://github.com/jupyter/nbformat/blob/main/nbformat/v4/nbformat.v4.schema.json">official Jupyter Notebook format</a> and none of the other formats.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bluss">@bluss</a> on 2024-07-17 13:19</div>
            <div class="timeline-body"><p>@tovrstra py percent belongs here because #11160 was redirected here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidorme">@davidorme</a> on 2024-07-17 14:45</div>
            <div class="timeline-body"><p>Just to add details about our use case.</p>
<p><code>jupytext</code> allows you to <a href="https://jupytext.readthedocs.io/en/latest/paired-notebooks.html">pair notebook formats</a> so that you can have a synchronised MyST <code>.md</code> and <code>.ipynb</code> files. It seems like one solution here is that <code>ruff</code> formats the <code>.ipynb</code> version and then <code>jupytext</code> can resynchronise the files.</p>
<p>However, we're not using paired notebooks and only have the MyST <code>.md</code> versions in our repo. That does mean that the files don't contain the outputs of running code, so we don't get the nicely rendered versions in GitHub, but we also avoid quite a lot of commit chaff from trivial changes to <code>.ipynb</code> files and only commit changes to the notebook source. So I guess with the existing functionality, we could convert files to <code>.ipynb</code>, format using <code>ruff</code>, convert back to MyST <code>.md</code> and delete the <code>.ipynb</code> formats.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ImperialCollegeLondon/virtual_ecosystem/pulls/607.html">ImperialCollegeLondon/virtual_ecosystem#607</a> on 2024-10-16 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ImperialCollegeLondon/pyrealm/issues/329.html">ImperialCollegeLondon/pyrealm#329</a> on 2024-10-16 12:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/17117.html">astral-sh/ruff#17117</a> on 2025-04-01 12:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ctcjab">@ctcjab</a> on 2025-04-29 17:35</div>
            <div class="timeline-body"><p>#17117 was recently closed as a duplicate of this issue. Should that instead be added as a subtask of this issue, to make sure that specific issue is resolved as part of this more general effort?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-04-29 19:32</div>
            <div class="timeline-body"><blockquote>
<p><a href="https://github.com/astral-sh/ruff/issues/17117">#17117</a> was recently closed as a duplicate of this issue. Should that instead be added as a subtask of this issue, to make sure that specific issue is resolved as part of this more general effort?</p>
</blockquote>
<p>Thank you for the suggestion, but I don't think that's necessary here as that rule is already ignored for Jupyter Notebooks and adding support for notebooks created by Jupytext should automatically consider that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../plenoptic-org/plenoptic/pulls/362.html">plenoptic-org/plenoptic#362</a> on 2025-07-11 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/19885.html">astral-sh/ruff#19885</a> on 2025-08-13 14:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
