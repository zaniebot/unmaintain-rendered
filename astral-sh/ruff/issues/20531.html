<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ambiguous-chained-operator - astral-sh/ruff #20531</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>ambiguous-chained-operator</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/20531">#20531</a>
        opened by <a href="https://github.com/kapkekes">@kapkekes</a>
        on 2025-09-23 12:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kapkekes">@kapkekes</a> on 2025-09-23 12:14</div>
            <div class="timeline-body"><h3>Summary</h3>
<h3>Context</h3>
<p>A few days ago, I stumbled upon this snippet:</p>
<pre><code class="language-python">False == False in [False]
</code></pre>
<p>At first, I thought that it evaluates to <code>False</code>, <em>which is wrong</em>.</p>
<p>That day, I learned that <code>in</code> and <code>not in</code> are actually <a href="https://docs.python.org/3/reference/expressions.html#comparisons">comparison operators</a>, which makes them chainable.</p>
<p>You can argue that this snippet is a little unobvious, but not terrible; so, I modified it:</p>
<pre><code class="language-python">False == False in [False] == [False]
</code></pre>
<p>This lil' guy also evaluates to <code>True</code>, but in my opinion, it doesn't even look like valid Python code.</p>
<h3>Proposal</h3>
<p>My feeling is that the knowledge of <code>in</code> being a comparison (so chainable) operator is more of a secret, and not something obvious. I want to suggest a rule that forbids using <code>in</code> in chained comparisons.</p>
<p>I think, the samples I provided are not typical code anyone would write. Strictly speaking, they are the first examples of chained <code>in</code> I have ever seen. However, if the proposed rule makes sense, I am willing to implement it.</p>
<p>Note that the <a href="https://docs.astral.sh/ruff/rules/boolean-chained-comparison/#boolean-chained-comparison-plr1716">PLR1716</a> rule may conflict with this one, I haven't checked for that yet.</p>
<h3>PS</h3>
<p>While writing this proposal, I considered another rule that would prohibit things like <code>a &lt; b &gt;= c</code>; more formal definition would be &quot;if a chained comparison contains <code>&lt;=</code> or <code>&lt;</code>, it should only use <code>&lt;=</code> and <code>&lt;</code> (same with <code>&gt;</code> and <code>&gt;=</code>)&quot;, so:</p>
<ul>
<li><code>a &lt; b &lt;= c &lt;= d</code> - valid;</li>
<li><code>a &gt; b &gt; c &gt;= d</code> - valid;</li>
<li><code>a &lt; b &gt;= c == d</code> - invalid.</li>
</ul>
<p>I would like to hear feedback on this suggestion, thanks in advance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-23 12:25</div>
            <div class="timeline-body"><p>This is interesting and does look confusing to me. It looks like PLR1716 only checks for chained less than and greater than operators, much like your PS suggestion, so it shouldn't conflict, good idea to check though!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @ntBre on 2025-09-23 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @ntBre on 2025-09-23 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kapkekes">@kapkekes</a> on 2025-09-24 07:39</div>
            <div class="timeline-body"><p>I'll start implementing both proposals this weekend as separate rules: <code>chained-in-usage</code> and <code>ambiguous-chained-operator</code>; I'm too interested to not try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adavis444">@adavis444</a> on 2025-09-25 19:29</div>
            <div class="timeline-body"><p>Although <a href="https://docs.astral.sh/ruff/rules/boolean-chained-comparison/#boolean-chained-comparison-plr1716">PLR1716</a> comes from Pylint, Pylint has a related warning: <a href="https://pylint.readthedocs.io/en/stable/user_guide/messages/warning/bad-chained-comparison.html">bad-chained-comparison / W3601</a></p>
<p>From the tracker in https://github.com/astral-sh/ruff/issues/970, there is no Ruff equivalent.
It would be great to see it implemented!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/20597.html">astral-sh/ruff#20597</a> on 2025-09-26 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tjkuson">@tjkuson</a> on 2025-09-28 12:39</div>
            <div class="timeline-body"><p>Should this issue be closed in favour of #8964? FWIW, I wrote a PR for this, and it was rejected until #1774 gets resolved, though that might not be the case any more.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/serjflint">@serjflint</a> on 2025-09-29 05:09</div>
            <div class="timeline-body"><p>I wonder if it can go in the preview category.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kapkekes">@kapkekes</a> on 2025-09-29 08:46</div>
            <div class="timeline-body"><p>@ntBre, hi!</p>
<p>Can you take a look at the situation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-29 20:43</div>
            <div class="timeline-body"><p>Thanks @tjkuson, I missed the earlier issue and PR. I think the reasoning related to #1774 still stands (this is an opinionated/stylistic lint that restricts valid Python syntax), so I think we should continue holding off on implementing this and fold this issue into #8964.</p>
<p>Sorry for not catching this earlier @kapkekes. We should be able to pull from both your and @tjkuson's PRs when we are ready to add this rule.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ntBre on 2025-09-29 20:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
