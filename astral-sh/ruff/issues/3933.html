<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extend SLF001 to allow accessing private fields on &quot;other&quot; instance in binary operators? - astral-sh/ruff #3933</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Extend SLF001 to allow accessing private fields on &quot;other&quot; instance in binary operators?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/3933">#3933</a>
        opened by <a href="https://github.com/tpgillam">@tpgillam</a>
        on 2023-04-11 13:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tpgillam">@tpgillam</a></div>
            <div class="timeline-body"><p>Suppose I run the follow code through ruff with the <code>SLF</code> module enabled, with Ruff 0.0.256:</p>
<pre><code class="language-python">class Moo:
    def __init__(self, a: int):
        self._a = a

    def __eq__(self, other) -&gt; bool:
        return isinstance(other, Moo) and self._a == other._a
</code></pre>
<p>Currently the last line will trigger <code>SLF001: private member access</code>, specifically the <code>other._a</code> call.</p>
<p>Since this is a fairly common pattern (and also within other binary operations, e.g. addition, multiplication), arguably it would be nice if this were permitted without a <code># noqa</code> (*).</p>
<p>Is this something that could be addressed within Ruff? Or is the policy to first decide changes inside flake8-self, and then ensure that Ruff always replicates upstream exactly?</p>
<p>If it <em>were</em> something that could be addressed within Ruff I'm not sure the best approach to implement it. It seems as though the current implementation relies on the string <code>&quot;self&quot;</code> being used, as opposed to noting what <code>self</code> would have been bound to given its position in the argument list to the method. A generalisation to the latter method could presumably also tag the <em>second</em> object in e.g. <code>__eq__, __add__, __radd, ...</code> as &quot;allowed to access private members&quot;</p>
<p>(*) At least, everywhere I have worked has preferred this approach, as opposed to e.g. explicitly publicising any necessary internal state via properties.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type-inference</span> added by @charliermarsh on 2023-04-12 04:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-04-12 20:58</div>
            <div class="timeline-body"><p>I'm torn on this but find myself erring on the side of &quot;it's a reasonable thing to expect&quot; (that we wouldn't enforce <code>SLF</code> here).</p>
<p>We may be able to handle it in the common case with our current semantic analysis tools.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2023-04-12 20:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-06-08 17:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-08 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nickbutsky">@nickbutsky</a> on 2024-02-17 10:46</div>
            <div class="timeline-body"><p>Is there any reasoning why it only would be allowed in dunder methods?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:46:58 UTC
    </footer>
</body>
</html>
