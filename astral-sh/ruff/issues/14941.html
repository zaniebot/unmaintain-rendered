<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ruff format` is failing  to reformat some code - astral-sh/ruff #14941</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`ruff format` is failing  to reformat some code</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/14941">#14941</a>
        opened by <a href="https://github.com/samuelcolvin">@samuelcolvin</a>
        on 2024-12-12 18:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/samuelcolvin">@samuelcolvin</a> on 2024-12-12 18:31</div>
            <div class="timeline-body"><p>I think I might actually found a bug in Ruff! Do I get a prize???</p>
<p>See <a href="https://gist.github.com/samuelcolvin/3d2b490d140defae08286bf1bdfab9a1">this code</a>.</p>
<p>Trying to format it with <code>uv run ruff format ruff_format_broken.py</code> is not reformatting the weirdly formatted dicts on line:</p>
<ul>
<li>214</li>
<li>241</li>
<li>266</li>
</ul>
<p>I've tried ruff 0.8.0 and 0.8.3.</p>
<p>config:</p>
<pre><code class="language-toml">[tool.ruff.lint]
extend-select = [
    &quot;Q&quot;,
    &quot;RUF100&quot;,
    &quot;C90&quot;,
    &quot;UP&quot;,
    &quot;I&quot;,
    &quot;D&quot;,
]
flake8-quotes = { inline-quotes = &quot;single&quot;, multiline-quotes = &quot;double&quot; }
isort = { combine-as-imports = true, known-first-party = [&quot;pydantic_ai&quot;] }
mccabe = { max-complexity = 15 }
ignore = [
    &quot;D100&quot;, # ignore missing docstring in module
    &quot;D102&quot;, # ignore missing docstring in public method
    &quot;D104&quot;, # ignore missing docstring in public package
    &quot;D105&quot;, # ignore missing docstring in magic methods
    &quot;D107&quot;, # ignore missing docstring in __init__ methods
]

[tool.ruff.lint.pydocstyle]
convention = &quot;google&quot;

[tool.ruff.format]
# don't format python in docstrings, pytest-examples takes care of it
docstring-code-format = false
quote-style = &quot;single&quot;

[tool.ruff.lint.per-file-ignores]
&quot;tests/**/*.py&quot; = [&quot;D&quot;]
&quot;docs/**/*.py&quot; = [&quot;D&quot;]
&quot;pydantic_ai_examples/**/*.py&quot; = [&quot;D101&quot;, &quot;D103&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pydantic/pydantic-ai/pulls/228.html">pydantic/pydantic-ai#228</a> on 2024-12-12 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @MichaReiser on 2024-12-12 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-12-12 18:38</div>
            <div class="timeline-body"><p>I'm sorry. I have to disappoint you :( At least the formatter is working as expected. There's an argument that RUF028 should flag the suppression comment on line 203 because it doesn't enable any formatting.</p>
<p>The suppression comments need to be at the same level or the <code>fmt: on</code> has no effect.</p>
<pre><code class="language-py"># fmt: off
async def google_style_docstring_no_body(
    foo: int, bar: Annotated[str, Field(description='from fields')]
) -&gt; str:  # pragma: no cover
    &quot;&quot;&quot;
    Args:
        foo: The foo thing.
        bar: The bar thing.
    &quot;&quot;&quot;
    return f'{foo} {bar}'
# fmt: on
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samuelcolvin">@samuelcolvin</a> on 2024-12-12 18:44</div>
            <div class="timeline-body"><p>ðŸ¤¦ ðŸ¤¦ ðŸ¤¦ ðŸ¤¦</p>
<p>thanks. maybe one day...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @samuelcolvin on 2024-12-12 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pydantic/pydantic-ai/pulls/229.html">pydantic/pydantic-ai#229</a> on 2024-12-12 18:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:14 UTC
    </footer>
</body>
</html>
