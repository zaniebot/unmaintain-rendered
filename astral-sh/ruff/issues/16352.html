<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[red-knot] Make it easier to avoid typos in `&lt;!-- snapshot-diagnostics --&gt;` mdtest HTML comments - astral-sh/ruff #16352</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[red-knot] Make it easier to avoid typos in <code>&lt;!-- snapshot-diagnostics --&gt;</code> mdtest HTML comments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/16352">#16352</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2025-02-24 18:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-24 18:28</div>
            <div class="timeline-body"><h3>Description</h3>
<p>I've been learning the hard way in #16321 (several times over...) that it's pretty easy to accidentally put <code>&lt;!-- snpashot-diagnostics --&gt;</code> or <code>&lt;!--snapshot-diagnostics --&gt;</code> in an mdtest ðŸ˜„ Either of these will result in the test snippet silently not generating any snapshots at all, leading you to think your test has been successful when in fact it never really ran at all. Maybe we should just reject all unrecognised HTML comments in an mdtest file?</p>
<p>Cc. @BurntSushi as the person who implemented the snapshotting feature for mdtest (not saying you need to necessarily take this on, though!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">testing</span> added by @AlexWaygood on 2025-02-24 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">red-knot</span> added by @AlexWaygood on 2025-02-24 18:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-02-24 18:32</div>
            <div class="timeline-body"><p>Good point. An alternative to rejecting all HTML comments (which I could see being too aggressive) is to give <em>special</em> comments a bit more structure. So for example, <code>&lt;!-- directive: snapshot-diagnostics --&gt;</code>. Then we could error for cases like <code>&lt;!-- directive: snpashot-diagnostics --&gt;</code>. Although, of course, a typo in <code>directive</code> itself would go unnoticed.</p>
<p>It might also be better to make recognition whitespace insensitive. e.g., <code>&lt;!--snapshot-diagnostics--&gt;</code> would be accepted.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-02-25 19:02</div>
            <div class="timeline-body"><blockquote>
<p>rejecting all HTML comments (which I could see being too aggressive)</p>
</blockquote>
<p>hmm, yes, it seems like we're already using some other HTML comments, to e.g. switch off the blacken-docs linter (since it can't handle invalid Python syntax):</p>
<p>https://github.com/astral-sh/ruff/blob/fa76f6cbb2c48f6fc020a00954841b6e5c71e531/crates/red_knot_python_semantic/resources/mdtest/suppressions/knot_ignore.md?plain=1#L73-L84</p>
<p>One solution could be to provide a whitelist of &quot;known HTML comment directives&quot;, but that might be confusing to users and/or hard to maintain.</p>
<blockquote>
<p>An alternative to rejecting all HTML comments [...] is to give special comments a bit more structure. So for example, <code>&lt;!-- directive: snapshot-diagnostics --&gt;</code>. Then we could error for cases like <code>&lt;!-- directive: snpashot-diagnostics --&gt;</code>. Although, of course, a typo in <code>directive</code> itself would go unnoticed.</p>
</blockquote>
<p>Hmm, not sure. I feel like one reason why this is already kinda typo-prone is that <code>snapshot-diagnostics</code> is already quite long (my bad I guess, since it was originally my suggestion ðŸ˜„). Making it even longer feels like it might go in the wrong direction.</p>
<blockquote>
<p>It might also be better to make recognition whitespace insensitive. e.g., <code>&lt;!--snapshot-diagnostics--&gt;</code> would be accepted.</p>
</blockquote>
<p>Great idea! See https://github.com/astral-sh/ruff/pull/16380</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-02-28 16:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:36:44 UTC
    </footer>
</body>
</html>
