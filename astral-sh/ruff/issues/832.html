<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Windows] Issues when running as a module - astral-sh/ruff #832</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Windows] Issues when running as a module</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/832">#832</a>
        opened by <a href="https://github.com/andriilahuta">@andriilahuta</a>
        on 2022-11-20 16:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andriilahuta">@andriilahuta</a></div>
            <div class="timeline-body"><p>If the interpreter path contains spaces (e.g. <code>C:\Program Files\Python311\python.exe</code>), then ruff produces the following output: <code>Files\Python311\Scripts\ruff:0:0: E902 The system cannot find the path specified</code> and exits with code 1.</p>
<p>Replacing</p>
<pre><code>sys.exit(os.spawnv(os.P_WAIT, ruff, [ruff, *sys.argv[1:]]))
</code></pre>
<p>with</p>
<pre><code>sys.exit(subprocess.call([ruff, *sys.argv[1:]]))
</code></pre>
<p>in <code>__main__.py</code> seems to resolve the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2022-11-20 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-01-30 12:20</div>
            <div class="timeline-body"><p>@andriilahuta Could you confirm this is still an issue? We&#x27;ve added windows testing in the meantime, so if it&#x27;s still an issue we should extend our testing suite (and fix it).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/andriilahuta">@andriilahuta</a> on 2023-01-30 16:13</div>
            <div class="timeline-body"><p>@sbrugman Still an issue.<br>
To reproduce, you can run ruff like this: <code>&quot;C:\Program Files\Python311\python.exe&quot; -m ruff .</code>.<br>
Replacing <code>os.spawnv</code> with <code>subprocess.call</code> fixes the issue for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sbrugman">@sbrugman</a> on 2023-01-31 22:55</div>
            <div class="timeline-body"><p>Suppose we could add this to the maturin test stage in the CI pipeline. Needs some testing to ensure there are no regressions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/srhinos">@srhinos</a> on 2023-03-06 09:17</div>
            <div class="timeline-body"><p>Coming in to confirm this is happening for me too. Synced the vscode setting from my macbook (where ruff runs fine), to my windows PC and when ruff is set to handle <code>source.fixAll</code>, its actually wiping the python file on save.</p>
<p>Replacing the file with</p>
<pre><code>[
    {
        &quot;code&quot;: &quot;E902&quot;,
        &quot;message&quot;: &quot;The system cannot find the file specified. (os error 2)&quot;,
        &quot;fix&quot;: null,
        &quot;location&quot;: {&quot;row&quot;: 1, &quot;column&quot;: 1},
        &quot;end_location&quot;: {&quot;row&quot;: 1, &quot;column&quot;: 1},
        &quot;filename&quot;: &quot;c:\\Users\\rhino\\Downloads\\folder with spaces in it\\-&quot;,
    },
    {
        &quot;code&quot;: &quot;E902&quot;,
        &quot;message&quot;: &quot;The system cannot find the file specified. (os error 2)&quot;,
        &quot;fix&quot;: null,
        &quot;location&quot;: {&quot;row&quot;: 1, &quot;column&quot;: 1},
        &quot;end_location&quot;: {&quot;row&quot;: 1, &quot;column&quot;: 1},
        &quot;filename&quot;: &quot;c:\\Users\\rhino\\Downloads\\folder with spaces in it\\line-length = 100&quot;,
    },
]
</code></pre>
<p>Thankfully, black comes in after and auto corrects the JSON to a Python friendly dict or I&#x27;d have been REALLY sad :,)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-03-06 13:17</div>
            <div class="timeline-body"><p>Woah, the Python file contents are <em>replaced</em> by that JSON?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/srhinos">@srhinos</a> on 2023-03-06 13:56</div>
            <div class="timeline-body"><p>yeah, super weird interaction!</p>
<p>Running python 3.11 but it might be an issue too with the fact that my Windows PC&#x27;s installation is syncing settings from my Macbook&#x27;s with no regard for what that might mean. I can dig into what settings are needed for repro if y&#x27;all can&#x27;t get a repro of the issue down</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/konstin">@konstin</a> on 2023-06-15 18:58</div>
            <div class="timeline-body"><p>We&#x27;ve now implemented this change in #5115, this should also fix your problem. If it doesn&#x27;t, please feel free to reopen.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/konstin">@konstin</a> on 2023-06-15 18:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:27 UTC
    </footer>
</body>
</html>
