<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter conflict with E501 and comments - astral-sh/ruff #7471</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter conflict with E501 and comments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7471">#7471</a>
        opened by <a href="https://github.com/shughes-uk">@shughes-uk</a>
        on 2023-09-17 19:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shughes-uk">@shughes-uk</a></div>
            <div class="timeline-body"><p>Ruff version 0.0.289</p>
<p>Before</p>
<pre><code class="language-python">if (
    &quot;aaaaaaaaaaaaaaaaaaaa&quot;
    and &quot;sdasdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;  # type: ignore
):
    pass
</code></pre>
<p>After <code>ruff format</code></p>
<pre><code class="language-python">if (
    &quot;aaaaaaaaaaaaaaaaaaaa&quot; and &quot;sdasdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;  # type: ignore
):
    pass
</code></pre>
<p>There's now an E501 violation, due to the length of the comment. I'm guessing this is a disparity between the formatter ignoring comments for line length calculations and E501 not.</p>
<p>I understand there's some disparity between the way <code>black</code> handles line length and ruff, but i'd expect the ruff formatter to be consistent with ruff's line length rules, which is not the case here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JonathanPlasse">@JonathanPlasse</a> on 2023-09-18 17:42</div>
            <div class="timeline-body"><p>~Did you try <a href="https://docs.astral.sh/ruff/settings/#pycodestyle-ignore-overlong-task-comments">pycodestyle.ignore-overlong-task-comments</a> mentioned in <a href="https://docs.astral.sh/ruff/rules/line-too-long/">line-too-long</a>?~
My bad, this has not been implemented yet.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-09-27 16:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-09-27 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 16:35</div>
            <div class="timeline-body"><p>Our plan is to modify E501 to allow for overlong pragma comments, to make it consistent with the formatter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">accepted</span> added by @charliermarsh on 2023-09-27 16:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 16:36</div>
            <div class="timeline-body"><p>(That we allow the formatter to exceed the line length for pragma comments is intended and documented.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-09-27 23:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-29 23:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gertvdijk">@gertvdijk</a> on 2023-10-02 18:22</div>
            <div class="timeline-body"><p>Hi @charliermarsh! Just installed 0.0.292 (from 0.0.291), using the Ruff linter (not formatter) and I have found this change to the formatting it wants (removing <code># noqa: E501</code>), which I think may be unexpected or not (?):</p>
<pre><code class="language-diff">-    @serial.validator  # pyright: ignore[reportUnknownMemberType, reportUntypedFunctionDecorator, reportGeneralTypeIssues]  # noqa: E501
+    @serial.validator  # pyright: ignore[reportUnknownMemberType, reportUntypedFunctionDecorator, reportGeneralTypeIssues]
</code></pre>
<p>(source code <a href="https://github.com/gertvdijk/PyKMP/blob/c2eb95487aed9b347caed9804924087c8af1732b/src/pykmp/messages.py#L338">here</a>) ... which sounds like what's happened in 1646939383336c45f91a553035c6e5b1f1e2341a for this issue.</p>
<p>That change in behaviour for E501 appears to be missing from <a href="https://github.com/astral-sh/ruff/releases/tag/v0.0.292">the 0.0.292 changelog</a>, I guess?</p>
<pre><code>$ flake8 src/pykmp/messages.py --max-line-length 88
src/pykmp/messages.py:338:89: E501 line too long (122 &gt; 88 characters)
src/pykmp/messages.py:429:89: E501 line too long (125 &gt; 88 characters)
</code></pre>
<p>This wasn't clear after reading the changelog and I believe deviating from flake8's E501, may deserve a line in the changelog, if that's intentional. If not, I'm happy to create a new issue for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-10-02 18:27</div>
            <div class="timeline-body"><p>@gertvdijk - Sorry, that's intentional -- I knew I was missing something from the changelog. I'll update it now.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:48:25 UTC
    </footer>
</body>
</html>
