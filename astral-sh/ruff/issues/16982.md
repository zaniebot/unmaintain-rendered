```yaml
number: 16982
title: F821 (undefined name) incorrectly flags Python 3.11 forward references
type: issue
state: closed
author: anilbey
labels: []
assignees: []
created_at: 2025-03-26T13:11:24Z
updated_at: 2025-03-26T13:44:37Z
url: https://github.com/astral-sh/ruff/issues/16982
synced_at: 2026-01-10T01:56:56Z
```

# F821 (undefined name) incorrectly flags Python 3.11 forward references

---

_Issue opened by @anilbey on 2025-03-26 13:11_

### Summary

#### **Problem**  
Ruff's `F821` (undefined name) rule incorrectly raises errors for **valid forward references** in Python 3.11, even when the target version is explicitly set.  Adding `from __future__ import annotations` fixes it but in Python3.11 that should not be required.

#### **Expected Behavior**  
Since Python 3.11 supports forward references (without requiring `from __future__ import annotations`), Ruff should:  
✅ **Not** trigger `F821` for quoted type annotations when `target-version = "py311"` (or higher).  
✅ Behave consistently with `mypy`, which correctly handles forward references regardless of `__future__ annotations`.  

### Version

ruff 0.11.0

---

_Comment by @Daverball on 2025-03-26 13:16_

That's not an incorrect flag, Python 3.11 still requires the `__future__` import. The earliest Python version that will have deferred annotations by default will be Python 3.14 and the runtime semantics will likely differ ever so slightly in some edge-cases from the `__future__` import variant.

---

_Comment by @anilbey on 2025-03-26 13:18_

Great, thanks a lot for the quick response. The issue can be closed in this case.

---

_Closed by @dylwil3 on 2025-03-26 13:44_

---
