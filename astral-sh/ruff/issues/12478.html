<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrectly sorting first-party modules when referenced by full name instead of .my_module - astral-sh/ruff #12478</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrectly sorting first-party modules when referenced by full name instead of .my_module</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12478">#12478</a>
        opened by <a href="https://github.com/GellertPalfi">@GellertPalfi</a>
        on 2024-07-23 15:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/GellertPalfi">@GellertPalfi</a></div>
            <div class="timeline-body"><p>Ruff seems to incorrectly sort first-party modules when they are referenced by their full name when using a config file.
<code>--select &quot;I&quot;</code> seems to work correctly.</p>
<p>Config file:</p>
<pre><code>[tool.ruff]
line-length = 120

[tool.ruff.lint]
extend-select = [&quot;Q&quot;, &quot;I&quot;]

[tool.ruff.lint.flake8-quotes]
docstring-quotes = &quot;double&quot;
inline-quotes = &quot;single&quot;

[tool.ruff.format]
quote-style = &quot;single&quot;
</code></pre>
<p>Problem:</p>
<pre><code>from airbyte.slack_hook import slack_message_on_failure  # first party module
from dagster import build_hook_context, op
from unittest import mock
</code></pre>
<p>Running:
<code> ruff  check . --config path/to/pyproject.toml  --fix</code>
Output:</p>
<pre><code>from unittest import mock

from airbyte.slack_hook import slack_message_on_failure
from dagster import build_hook_context, op 
</code></pre>
<p>VS expected:</p>
<pre><code>from unittest import mock

from dagster import build_hook_context, op

from airbyte.slack_hook import slack_message_on_failure
</code></pre>
<p>However when running <code>ruff check path/to/file --select &quot;I&quot; --fix </code> the imports are correctly sorted:</p>
<pre><code>from airbyte.slack_hook import slack_message_on_failure
from dagster import build_hook_context, op
from unittest import mock
</code></pre>
<p>Output:</p>
<pre><code>from unittest import mock

from dagster import build_hook_context, op

from airbyte.slack_hook import slack_message_on_failure
</code></pre>
<p>Ruff version: 0.5.4
&quot;ruff isort&quot;, &quot;ruff sort imports&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-23 15:07</div>
            <div class="timeline-body"><p>What is your project structure? I believe <code>--config</code> requires that we treat the current working directory as root, whereas omitting it means we use the directory containing your configuration file as root.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GellertPalfi">@GellertPalfi</a> on 2024-07-23 15:26</div>
            <div class="timeline-body"><p>Here is my project structure:</p>
<pre><code>PROJECT-REPO/
└── setup/
    └── dagster/
        ├── airbyte/
        └── pyproject.toml
</code></pre>
<p>I used all commands from the <code>PROJECT-REPO</code> directory</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-23 15:28</div>
            <div class="timeline-body"><p>Which of <code>dagster</code> and/or <code>airbyte</code> is intended to be first-party vs. third-party?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GellertPalfi">@GellertPalfi</a> on 2024-07-23 15:31</div>
            <div class="timeline-body"><p><code>dagster</code> is third-party and <code>airbyte</code> is first-party.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GellertPalfi">@GellertPalfi</a> on 2024-07-23 15:36</div>
            <div class="timeline-body"><p>Apologies for the confusion i see, that my folder structure example was very bad.
Here is an updated version to hopefully avoid confusion. The code snippets are from script.py</p>
<pre><code>PROJECT-REPO/
└── setup/
    └── dagster_own/
        ├── airbyte/
        │   └── slack_hook.py
        ├── scripts/
        │   └── script.py
        └── pyproject.toml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-23 16:00</div>
            <div class="timeline-body"><p>If you pass <code>--config</code>, you should probably run from <code>dagster_own</code>, since we use the current working directory as root if you override the configuration discovery.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GellertPalfi">@GellertPalfi</a> on 2024-07-23 16:07</div>
            <div class="timeline-body"><p>That actually solves the issue!
Could you point me to some explanation why is this happening?
Also this problem still persists with the VSC extension although im using the same config file</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-07-23 16:08</div>
            <div class="timeline-body"><p>There's some documentation on it here, including the <code>--config</code> behavior: https://docs.astral.sh/ruff/faq/#how-does-ruff-determine-which-of-my-imports-are-first-party-third-party-etc</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GellertPalfi">@GellertPalfi</a> on 2024-07-24 07:08</div>
            <div class="timeline-body"><p>Thank you, that helped a lot!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @GellertPalfi on 2024-07-24 07:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:50:42 UTC
    </footer>
</body>
</html>
