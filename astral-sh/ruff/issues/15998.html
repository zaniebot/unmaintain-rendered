<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`DTZ005`: false positive when `replace(...)` before `astimezone()` - astral-sh/ruff #15998</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`DTZ005`: false positive when `replace(...)` before `astimezone()`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/15998">#15998</a>
        opened by <a href="https://github.com/trim21">@trim21</a>
        on 2025-02-06 16:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/trim21">@trim21</a> on 2025-02-06 16:15</div>
            <div class="timeline-body"><h3>Description</h3>
<pre><code class="language-python">import datetime


print(&quot;update at&quot;, datetime.datetime.now().replace(microsecond=0).astimezone())
</code></pre>
<p>https://play.ruff.rs/ca289032-db85-4067-bbf2-e77e59d90365</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`DTZ005`: false positive with `replace`" to "`DTZ005`: false positive when `replace(...)` before `astimezone()`" by @trim21 on 2025-02-06 16:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @ntBre on 2025-02-06 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-02-06 20:09</div>
            <div class="timeline-body"><p>Thanks for the report! I think this can be considered a bug because we do have special handling for <a href="https://github.com/astral-sh/ruff/blob/main/crates/ruff_linter/src/rules/flake8_datetimez/rules/call_datetime_now_without_tzinfo.rs#L85">astimezone</a> that could possibly be extended to other known methods.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayushbaweja">@ayushbaweja</a> on 2025-02-08 06:30</div>
            <div class="timeline-body"><p>Should DTZ005 only allow replace() method chains before astimezone(), or should it allow any method/attribute chain as long as the object remains a datetime.datetime before calling astimezone()?</p>
<p>For example, would both of these be valid?</p>
<pre><code>datetime.now().replace(hour=12).astimezone()  
datetime.now().other_method().foo.bar().astimezone()  # Using other methods/attributes that return datetime object
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/trim21">@trim21</a> on 2025-02-08 09:50</div>
            <div class="timeline-body"><p>I think <code>replace</code> is the only method on datatime return a datatime except <code>astimezone</code>ï¼Ÿ <code>.other_method().foo.bar()</code> currently doesn't exist.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/16050.html">astral-sh/ruff#16050</a> on 2025-02-09 00:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @AlexWaygood on 2025-02-09 15:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:15 UTC
    </footer>
</body>
</html>
