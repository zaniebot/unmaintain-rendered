<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP013 does not account for functional use-cases - astral-sh/ruff #5027</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP013 does not account for functional use-cases</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/5027">#5027</a>
        opened by <a href="https://github.com/ergoithz">@ergoithz</a>
        on 2023-06-12 15:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ergoithz">@ergoithz</a> on 2023-06-12 15:54</div>
            <div class="timeline-body"><p>pyupgrade UP013 does not check for when typed dict cannot be expressed as a class (in this example because of reserved keys).</p>
<pre><code class="language-py">import typing
MyDictType = typing.TypedDict('MyDictType', {'id': str})
</code></pre>
<p>UP013 tells to migrate to class like:</p>
<pre><code class="language-py">import typing
class MyDictType(typing.TypedDict):
    id : str
</code></pre>
<p>Which is a violation of A003 and one of the many reasons of functional APIs exist.</p>
<p>Version: 0.0.272</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-12 15:59</div>
            <div class="timeline-body"><p>Can you say a bit more about the contexts in which you wouldn't want UP013 to trigger? The fact that it triggers A003 doesn't seem like a fully satisfying explanation to me, since in theory this should <em>still</em> be an A003 violation, given that A003 is about creating classes with confusing attributes, and not the mechanism through which those attributes are defined.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @charliermarsh on 2023-06-12 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ergoithz">@ergoithz</a> on 2023-06-12 16:15</div>
            <div class="timeline-body"><p>@charliermarsh Since dict key's aren't subject to the same restrictions as class attributes, there are situations where a typed dict cannot be expressed using a class.</p>
<p>The explanation is simple, <code>{'__dict__': 'something'}</code> is a perfectly valid dictionary which cannot be expressed as per UP013 suggests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-06-12 16:20</div>
            <div class="timeline-body"><p>Yup -- and we handle some of those! For example, we validate that the keys are valid Python identifiers before suggesting this rewrite. What I'm trying to understand is: what are other such use-cases? It looks like one that you're proposing is: special dunder methods.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ergoithz">@ergoithz</a> on 2023-06-12 16:36</div>
            <div class="timeline-body"><p>I may suggest including an extra check for keys that are valid identifiers in the strict sense, but will cause issues in a class definition context: builtins and reserved attribute names, preventing UP013 from triggering.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-06-12 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5038.html">astral-sh/ruff#5038</a> on 2023-06-12 21:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-06-12 21:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:50 UTC
    </footer>
</body>
</html>
