<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UP032 should throw errors when the replacement is a string - astral-sh/ruff #17918</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>UP032 should throw errors when the replacement is a string</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/17918">#17918</a>
        opened by <a href="https://github.com/jbrunton96">@jbrunton96</a>
        on 2025-05-07 13:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jbrunton96">@jbrunton96</a></div>
            <div class="timeline-body">Summary
<p>Ruff&#x27;s UP032 is supposed to complain about uses of <code>str.format()</code> which should be f-strings, but when any of the arguments are a string literal (or result in a string), the error won&#x27;t be thrown:</p>
<pre><code>def foo() -&gt; int: ...

_ = &quot;Hello {}&quot;.format(False)  # Correct error
_ = &quot;Hello {}&quot;.format(123)  # Correct error
_ = &quot;Hello {}&quot;.format(foo())  # Correct error
_ = &quot;Hello {}&quot;.format([1, 2, 3])  # Correct error
_ = &quot;Hello {}&quot;.format(&quot;world&quot;)  # Why not an error?
_ = &quot;Hello {}&quot;.format(&quot;, &quot;.join([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]))  # Why not an error?

_ = &quot;Hello {}&quot;.format(1 if foo() else 2)  # Correct error
_ = &quot;Hello {}&quot;.format(1 if foo() else &quot;2&quot;)  # Why not an error?
_ = &quot;Hello {}&quot;.format(&quot;1&quot; if foo() else 2)  # Why not an error?

_ = &quot;Hello {} {}&quot;.format(1, 2)  # Correct error
_ = &quot;Hello {} {}&quot;.format(1, &quot;2&quot;)  # Why not an error?
_ = &quot;Hello {} {}&quot;.format(&quot;1&quot;, 2)  # Why not an error?
</code></pre>
<p><a href="https://play.ruff.rs/06bed571-0632-4722-8699-c012c334c64c">Playground to reproduce the issue</a></p>
<p>For all of these examples, I think UP032 should be thrown. My best guess is that the error isn&#x27;t thrown because in older versions of Python (before 3.12) the fix would have to be careful about getting the right quotes around the replaced string, but in 3.12 onwards, I don&#x27;t think it should be a problem. Regardless, I&#x27;d rather have the error thrown without an auto-fix than no error for them at all.</p>
<p>The only other wrinkle I can think of is that when the format arg is <em>just</em> a string literal (<code>&quot;Hello {}&quot;.format(&quot;world&quot;)</code>) then the auto-fix probably shouldn&#x27;t use an f-string escape for it (<code>f&quot;Hello {&quot;world&quot;}&quot;</code> should really just be <code>&quot;Hello world&quot;</code>). It&#x27;s pretty weird to be using <code>str.format()</code> to insert a string literal in the first place though, so might not be worth the effort to special-case that.</p>
Version
<p>v0.11.8</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-07 16:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:49:55 UTC
    </footer>
</body>
</html>
