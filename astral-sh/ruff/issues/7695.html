<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`enum.global_enum` members are not added to global scope - astral-sh/ruff #7695</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`enum.global_enum` members are not added to global scope</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/7695">#7695</a>
        opened by <a href="https://github.com/petrem">@petrem</a>
        on 2023-09-28 10:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/petrem">@petrem</a> on 2023-09-28 10:38</div>
            <div class="timeline-body"><p>Consider this <code>foo.py</code>:</p>
<pre><code class="language-python">import enum

@enum.global_enum
class Foo(enum.Enum):
    A = 1

print(A)
</code></pre>
<p>While the code works</p>
<pre><code class="language-bash">$ python foo.py
A
</code></pre>
<p>ruff complains</p>
<pre><code class="language-bash">$ ruff --version
ruff 0.0.291

$ ruff foo.py

foo.py:7:7: F821 Undefined name `A`
Found 1 error.
</code></pre>
<p><code>enum.global_enum</code> was introduced in Python 3.11.</p>
<p>Thank you for a super-cool-tool! I'm tempted to learn rust just to be be able to contribute :D.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-09-28 13:56</div>
            <div class="timeline-body"><p>Honestly, I had no idea <code>global_enum</code> existed! We'll need to add special handling this while constructing our semantic model.</p>
<p>Thank you :) learn some Rust!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @zanieb on 2023-09-28 13:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "enum.global_enum is not honoured" to "`enum.global_enum` members are not added to global scope" by @zanieb on 2023-09-28 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/petrem">@petrem</a> on 2023-10-01 12:03</div>
            <div class="timeline-body"><blockquote>
<p>Honestly, I had no idea global_enum existed!</p>
</blockquote>
<p>Turns out most other python tools fail in the same way, at the moment.</p>
<blockquote>
<p>learn some Rust!
Alas, so much to do, so little time (but I got ~the~ a book already).</p>
</blockquote>
<p>Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/goodmami">@goodmami</a> on 2023-11-22 04:15</div>
            <div class="timeline-body"><p>For Python versions prior to 3.11, there is <a href="https://stackoverflow.com/a/28130684">another idiom</a> for putting Enums in the global namespace:</p>
<pre><code class="language-python">globals().update(Foo.__members__)
</code></pre>
<p>Ruff complains with an F821 on enums added this way, too.</p>
<p>This seems like a bigger issue than just enums, though, and modifying the dict returned by <code>globals()</code> is allowed by Python (<a href="https://stackoverflow.com/a/5958992">link</a>), unlike for <code>locals()</code>. Shall I raise a separate issue for it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-11-27 03:18</div>
            <div class="timeline-body"><p>@goodmami this pattern is probably difficult to support for static analysis tools. E.g. what if the <code>update</code> call is inside a function or an <code>if</code>. Should <code>ruff</code> assume that the members are part of the globals or not?</p>
<p>Do you know if other static-analysis tools support the above pattern? How common is this idiom in your code? Could you declare the globals in the configuration file instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/goodmami">@goodmami</a> on 2023-11-27 04:47</div>
            <div class="timeline-body"><blockquote>
<p>this pattern is probably difficult to support for static analysis tools.</p>
</blockquote>
<p>@MichaReiser Yeah, I was afraid of that.</p>
<blockquote>
<p>Do you know if other static-analysis tools support the above pattern?</p>
</blockquote>
<p>Both flake8 and mypy complain about the undeclared names, and it doesn't look like pyright will handle this pattern either (https://github.com/microsoft/pyright/issues/2485).</p>
<blockquote>
<p>How common is this idiom in your code?</p>
</blockquote>
<p>Until now, unused. I was looking up recommended patterns for making Enum members into module-level constants and came across the SO posts by the author of the enum library and a CPython core developer. Honestly, I was a bit surprised at the recommendations and <em>not</em> surprised that static analysis tools were unable to deal with it.</p>
<blockquote>
<p>Could you declare the globals in the configuration file instead?</p>
</blockquote>
<p>What setting allows me to declare module-level constants? If this would require me to list them out, I might as well just have:</p>
<pre><code class="language-python">A = Foo.A
B = Foo.B
...
</code></pre>
<p>in my module instead.</p>
<p>In any case, I think I'll just ignore the <code>globals().update()</code> trick and wait for the <code>@enum.global_enum</code> decorator in Python 3.11.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @zanieb on 2023-11-27 15:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> removed by @MichaReiser on 2025-02-03 19:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:51 UTC
    </footer>
</body>
</html>
