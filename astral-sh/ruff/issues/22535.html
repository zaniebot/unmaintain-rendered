<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ruff-wasm-nodejs] Debug output &quot;built glob set&quot; leaking to stdout from globset crate - astral-sh/ruff #22535</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ruff-wasm-nodejs] Debug output &quot;built glob set&quot; leaking to stdout from globset crate</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22535">#22535</a>
        opened by <a href="https://github.com/fschaeffler">@fschaeffler</a>
        on 2026-01-12 16:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fschaeffler">@fschaeffler</a></div>
            <div class="timeline-body"><h2>Summary</h2>
<p>The <code>@astral-sh/ruff-wasm-nodejs</code> package outputs debug messages from the <code>globset</code> crate to stdout during normal operation. These messages bypass any application-level logging and cannot be suppressed.</p>
<h2>Minimal Reproduction</h2>
<pre><code class="language-js">const { Workspace, PositionEncoding } = require('@astral-sh/ruff-wasm-nodejs');

const ws = new Workspace({}, PositionEncoding.Utf8);
ws.format('x=1');
</code></pre>
<p><strong>Output:</strong></p>
<pre><code>built glob set; 25 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
built glob set; 0 literals, 1 basenames, 3 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
</code></pre>
<h2>Expected Behavior</h2>
<p>No debug output should be printed to stdout. The WASM build should have debug/tracing output disabled or set to a level that doesn't emit these internal messages.</p>
<h2>Environment</h2>
<ul>
<li><strong>Package</strong>: <code>@astral-sh/ruff-wasm-nodejs</code> v0.14.10 (also tested concept with v0.14.11 release notes - no relevant fix)</li>
<li><strong>Node.js</strong>: v22.14.0</li>
<li><strong>OS</strong>: Linux 6.14.0-37-generic (Ubuntu)</li>
</ul>
<h2>Analysis</h2>
<p>The output appears to come from Rust's <code>globset</code> crate (used by Ruff internally). The debug logging is likely compiled into the WASM binary and writes directly to stdout, making it impossible to suppress from the Node.js side.</p>
<h2>Workaround</h2>
<p>Currently using a <code>process.stdout.write</code> monkey-patch to filter these lines, but this is fragile and shouldn't be necessary.</p>
<h2>Suggested Fix</h2>
<p>Disable debug/trace logging in the WASM build configuration, or ensure the <code>globset</code> crate's tracing subscriber isn't active in the WASM target.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> added by @ntBre on 2026-01-12 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> removed by @MichaReiser on 2026-01-12 17:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 17:19</div>
            <div class="timeline-body"><p>It's great to see that the wasm build has been useful to you.</p>
<p>I'd accept a PR fixing this, but it's unlikely that it's something we fix ourselves.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by @MichaReiser on 2026-01-12 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @MichaReiser on 2026-01-15 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fschaeffler">@fschaeffler</a> on 2026-01-15 12:00</div>
            <div class="timeline-body"><p>Not gonna lie. Didn't expect a fix at all and in no way that quickly ðŸ˜€ Thank you!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-15 12:54:39 UTC
    </footer>
</body>
</html>
