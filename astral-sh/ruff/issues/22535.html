<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ruff-wasm-nodejs] Debug output &quot;built glob set&quot; leaking to stdout from globset crate - astral-sh/ruff #22535</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ruff-wasm-nodejs] Debug output &quot;built glob set&quot; leaking to stdout from globset crate</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/22535">#22535</a>
        opened by <a href="https://github.com/fschaeffler">@fschaeffler</a>
        on 2026-01-12 16:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fschaeffler">@fschaeffler</a></div>
            <div class="timeline-body">Summary
<p>The <code>@astral-sh/ruff-wasm-nodejs</code> package outputs debug messages from the <code>globset</code> crate to stdout during normal operation. These messages bypass any application-level logging and cannot be suppressed.</p>
Minimal Reproduction
<pre><code>const { Workspace, PositionEncoding } = require(&#x27;@astral-sh/ruff-wasm-nodejs&#x27;);

const ws = new Workspace({}, PositionEncoding.Utf8);
ws.format(&#x27;x=1&#x27;);
</code></pre>
<p><strong>Output:</strong></p>
<pre><code>built glob set; 25 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
built glob set; 0 literals, 1 basenames, 3 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
</code></pre>
Expected Behavior
<p>No debug output should be printed to stdout. The WASM build should have debug/tracing output disabled or set to a level that doesn&#x27;t emit these internal messages.</p>
Environment
<ul>
<li><strong>Package</strong>: <code>@astral-sh/ruff-wasm-nodejs</code> v0.14.10 (also tested concept with v0.14.11 release notes - no relevant fix)</li>
<li><strong>Node.js</strong>: v22.14.0</li>
<li><strong>OS</strong>: Linux 6.14.0-37-generic (Ubuntu)</li>
</ul>
Analysis
<p>The output appears to come from Rust&#x27;s <code>globset</code> crate (used by Ruff internally). The debug logging is likely compiled into the WASM binary and writes directly to stdout, making it impossible to suppress from the Node.js side.</p>
Workaround
<p>Currently using a <code>process.stdout.write</code> monkey-patch to filter these lines, but this is fragile and shouldn&#x27;t be necessary.</p>
Suggested Fix
<p>Disable debug/trace logging in the WASM build configuration, or ensure the <code>globset</code> crate&#x27;s tracing subscriber isn&#x27;t active in the WASM target.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> added by <a href="https://github.com/ntBre">@ntBre</a> on 2026-01-12 17:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">playground</span> removed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 17:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 17:19</div>
            <div class="timeline-body"><p>It&#x27;s great to see that the wasm build has been useful to you.</p>
<p>I&#x27;d accept a PR fixing this, but it&#x27;s unlikely that it&#x27;s something we fix ourselves.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-12 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2026-01-15 08:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fschaeffler">@fschaeffler</a> on 2026-01-15 12:00</div>
            <div class="timeline-body"><p>Not gonna lie. Didn&#x27;t expect a fix at all and in no way that quickly ðŸ˜€ Thank you!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:50:44 UTC
    </footer>
</body>
</html>
