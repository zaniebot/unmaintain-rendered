<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUF009 incompatible with pyserde library dataclass field function - astral-sh/ruff #6656</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>RUF009 incompatible with pyserde library dataclass field function</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/6656">#6656</a>
        opened by <a href="https://github.com/kujenga">@kujenga</a>
        on 2023-08-17 19:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kujenga">@kujenga</a> on 2023-08-17 19:11</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>This issue is reporting what seems to be a limitation/bug in the RUF009 rule, where helper functions wrapping <code>dataclasses.field</code> are not allowed by the rule.</p>
<p>One such example of this comes from the https://github.com/yukinarit/pyserde library in the way it provides a helper function that allows metadata to be defined on fields, as documented here: https://yukinarit.github.io/pyserde/guide/en/field-attributes.html with the source code for the helper itself calling out to the <code>dataclasses.field</code> function here: https://github.com/yukinarit/pyserde/blob/89680ed429401d41e2a4584b8023cb6366786e41/serde/core.py#L541</p>
<p>My thinking here is that ruff should allow patterns like this. It would be ideal if it was able to determine these are acceptable automatically, or otherwise perhaps a configuration could allow specific functions to be used.</p>
<p>Thank you!</p>
<h2>Steps to reproduce:</h2>
<p>This file reproduces the issue in two ways, one with the serde library and another with a wrapper function defined here:</p>
<pre><code class="language-py">from dataclasses import dataclass

from serde import field


def field_wrapper(*args, **kwargs):
    field(*args, **kwargs)


@dataclass
class Example:
    serde_list: list[int] = field(default_factory=list)
    wrapped_list: list[int] = field_wrapper(default_factory=list)
</code></pre>
<p>These commands reproduce the error (no other config needed):</p>
<pre><code>$ pip install -q pyserde ruff
$ ruff --version
ruff 0.0.284
$ ruff check --select=RUF009 main.py
main.py:12:29: RUF009 Do not perform function call `field` in dataclass defaults
main.py:13:31: RUF009 Do not perform function call `field_wrapper` in dataclass defaults
Found 2 errors.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2023-08-17 19:56</div>
            <div class="timeline-body"><p>Hey @kujenga it sounds like you're looking for the <a href="https://beta.ruff.rs/docs/settings/#flake8-bugbear-extend-immutable-calls"><code>extend-immutable-calls</code></a> setting e.g. you'd add <code>serde.field</code>. Does that work for you?</p>
<p>I don't think we're likely to add defaults to that from outside the standard library since their APIs are harder for us to keep up to date with.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kujenga">@kujenga</a> on 2023-08-17 20:20</div>
            <div class="timeline-body"><p>Aha! And I even managed to miss it in the https://beta.ruff.rs/docs/rules/function-call-in-dataclass-default-argument/ docs. Thanks for the quick response! I'll close this out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kujenga on 2023-08-17 20:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:01 UTC
    </footer>
</body>
</html>
