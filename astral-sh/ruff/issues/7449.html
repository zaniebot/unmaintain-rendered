<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter undocumented deviation: implicit string concatenation - astral-sh/ruff #7449</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter undocumented deviation: implicit string concatenation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/7449">#7449</a>
        opened by <a href="https://github.com/m-richards">@m-richards</a>
        on 2023-09-17 06:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/m-richards">@m-richards</a> on 2023-09-17 06:01</div>
            <div class="timeline-body"><p>Just sharing another deviation, this time to do with implicit string concatenation (all with line-length=88):</p>
<pre><code class="language-python"># black / existing formatting
class TestIO:
    def test(self):
        new_rows, orig_rows = 1, 1

        assert new_rows == orig_rows * 2, (
            &quot;There should be {target} rows,&quot;
            &quot;found: {current}&quot;.format(target=orig_rows * 2, current=new_rows),
        )
</code></pre>
<p>Then with ruff this becomes</p>
<pre><code class="language-python">class TestIO:
    def test(self):
        new_rows, orig_rows = 1, 1

        assert new_rows == orig_rows * 2, (
            &quot;There should be {target} rows,&quot; &quot;found: {current}&quot;.format(
                target=orig_rows * 2, current=new_rows
            ),
        )
</code></pre>
<p>It's not significantly different, the snippet ends up one line longer. However the thing that seemed most surprising in the ruff output was that the two strings weren't concatenated. To illustrate what I mean, if I run <code>black --preview</code> on the ruff output I get</p>
<pre><code class="language-python">class TestIO:
    def test(self):
        new_rows, orig_rows = 1, 1

        assert new_rows == orig_rows * 2, (
            &quot;There should be {target} rows,found: {current}&quot;.format(
                target=orig_rows * 2, current=new_rows
            ),
        )
</code></pre>
<p>I appreciate this must have extra complexity to be able to do, but it seems like it should be possible when both strings are the same regular/ raw / f string variant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by @MichaReiser on 2023-09-17 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @MichaReiser on 2023-09-17 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Formatter: Beta" by @MichaReiser on 2023-09-17 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2023-09-17 13:16</div>
            <div class="timeline-body"><p>Thanks for reporting. We plan to implement Black's preview style once we shipped the Beta.</p>
<p>Regarding the deviation. I believe it is related to https://github.com/astral-sh/ruff/issues/7052 We already implement custom handling for implicit strings but it is limited to binary and compare expressions <a href="https://github.com/astral-sh/ruff/pull/7145">PR</a>. We may also need custom handling for call expressions where the string part group also includes the group of the right side (to get left to right, instead of right to left expansion)</p>
<p>A more minified example (to ensure it's unrelated to <code>assert</code>):</p>
<pre><code class="language-python"># black / existing formatting
class TestIO:
    def test(self):
        new_rows, orig_rows = 1, 1

        (
            &quot;There should be {target} rows,&quot;
            &quot;found: {current}&quot;.format(target=orig_rows * 2, current=new_rows),
        )
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/m-richards">@m-richards</a> on 2023-09-18 10:19</div>
            <div class="timeline-body"><p>Thanks for the quick response! This does look like it's the same or very similar to #7052, so I'd be happy to close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-09-27 15:59</div>
            <div class="timeline-body"><p>(Closing as it does appear to be the same as #7052. Thank you!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2023-09-27 15:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> removed by @charliermarsh on 2023-09-27 15:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:31:22 UTC
    </footer>
</body>
</html>
