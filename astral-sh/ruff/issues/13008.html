<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F401 autofix should only add a first-party import to `__all__` if the import is from the *same package* - astral-sh/ruff #13008</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>F401 autofix should only add a first-party import to `__all__` if the import is from the *same package*</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/13008">#13008</a>
        opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a>
        on 2024-08-20 13:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-20 13:06</div>
            <div class="timeline-body"><p>Consider the following directory structure:</p>
<ul>
<li><code>repo_root</code><ul>
<li><code>package.py</code> (empty)</li>
<li><code>package2</code><ul>
<li><code>__init__.py</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Where the contents of <code>repo_root/package2/__init__.py</code> are:</p>
<pre><code class="language-py">import package
__all__ = []
</code></pre>
<p>If you run <code>ruff check package2 --select=F401 --fix --preview --unsafe-fixes</code>, it will apply this fix:</p>
<pre><code class="language-diff">import package
-__all__ = []
+__all__ = [&quot;package&quot;]
</code></pre>
<p>It makes sense for the autofix to add first-party imports to <code>__all__</code> if the import is from the same package (or a subpackage of that package). But it doesn't really make sense for the autofix to do that if the import is from an entirely separate first-party package in the same repository.</p>
<p>This bug is most obvious when it comes to the autofix, but it's also present even if you don't run Ruff with <code>--fix</code>, since the help message says:</p>
<pre><code>F401 `package` imported but unused; consider removing, adding to `__all__`, or using a redundant alias
</code></pre>
<p>It probably shouldn't really suggest adding it to <code>__all__</code> or using a redundant alias if it's an import from a different package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-08-20 13:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @AlexWaygood on 2024-08-20 13:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:30:14 UTC
    </footer>
</body>
</html>
