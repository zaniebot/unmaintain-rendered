<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect `RUF015` on `dict.keys()` - astral-sh/ruff #20872</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect `RUF015` on `dict.keys()`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/20872">#20872</a>
        opened by <a href="https://github.com/Paillat-dev">@Paillat-dev</a>
        on 2025-10-14 20:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Paillat-dev">@Paillat-dev</a> on 2025-10-14 20:20</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>When selecting the first element of some dictionary keys with <code>list(my_dict.keys())[0]</code>, a <code>RUF015</code> warning is created. However, <code>dict_keys</code> is <em>not</em> an iterator, and doesn't implement <code>__next__</code>.</p>
<pre><code class="language-py"># test.py

my_dict: dict[str, int] = {&quot;1&quot;: 1, &quot;2&quot;: 2}

print(list(my_dict.keys())[0])
</code></pre>
<pre><code>PS C:\Users\usr\Downloads\test&gt; uvx ruff check --isolated --select RUF015 .\test.py
RUF015 Prefer `next(iter(my_dict.keys()))` over single element slice
 --&gt; test.py:3:7
  |
1 | my_dict: dict[str, int] = {&quot;1&quot;: 1, &quot;2&quot;: 2}
2 |
3 | print(list(my_dict.keys())[0])
  |       ^^^^^^^^^^^^^^^^^^^^^^^
  |
help: Replace with `next(iter(my_dict.keys()))`

Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
<p>Command: <code>uvx ruff check --isolated --select RUF015 test.py</code></p>
<p>Playground link: https://play.ruff.rs/60539f52-984b-496a-bbce-278094a277ca</p>
<p><code>dict_keys</code> items do not support <code>next</code>, but ruff's <code>RUF015</code> incorrectly suggests that one should instead use:</p>
<pre><code class="language-py">my_dict: dict[str, int] = {&quot;1&quot;: 1, &quot;2&quot;: 2}

print(next(my_dict.keys()))
</code></pre>
<p>but the above code leads to</p>
<pre><code>Traceback (most recent call last):
  File &quot;&lt;python-input-0&gt;&quot;, line 3, in &lt;module&gt;
    print(next(my_dict.keys()))
          ~~~~^^^^^^^^^^^^^^^^
TypeError: 'dict_keys' object is not an iterator
</code></pre>
<p>Currently, ruff incorrectly suggests the user to make code changes that would crash at runtime, and an unsafe fix is even present.</p>
<p>The <strong>expected result</strong> would be ruff not to create a <code>RUF015</code> warning when something that looks like a <code>dict_keys</code> object is passed (e.g. the user uses <code>.keys()</code>). Alternatively, the unsafe fix could at least not be presented in such cases.</p>
<h3>Version</h3>
<p><code>ruff 0.14.0</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @dylwil3 on 2025-10-14 20:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-10-14 20:38</div>
            <div class="timeline-body"><p>Yes this is a little confusing, but the help text says:</p>
<pre><code>Replace with `next(iter(my_dict.keys()))`
</code></pre>
<p><em>not</em> to replace with <code>next(my_dict.keys())</code>. And the former does work:</p>
<pre><code class="language-pycon">&gt;&gt;&gt; next(iter({&quot;a&quot;:1}))
'a'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Paillat-dev">@Paillat-dev</a> on 2025-10-14 20:44</div>
            <div class="timeline-body"><p>I actually misread this and completely missed the <code>iter()</code>. That's on me ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Paillat-dev on 2025-10-14 20:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
