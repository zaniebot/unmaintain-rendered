```yaml
number: 19948
title: "UP045 fixes `typing.Optional[collections.namedtuple]` to `collections.namedtuple | None`"
type: issue
state: closed
author: chirizxc
labels: []
assignees: []
created_at: 2025-08-17T14:26:45Z
updated_at: 2025-08-17T15:02:05Z
url: https://github.com/astral-sh/ruff/issues/19948
synced_at: 2026-01-10T01:56:57Z
```

# UP045 fixes `typing.Optional[collections.namedtuple]` to `collections.namedtuple | None`

---

_Issue opened by @chirizxc on 2025-08-17 14:26_

### Summary

[Playground*](https://play.ruff.rs/9b94e50a-11d8-4c21-b3d5-7a5312e242d5)
```python
import collections
import typing


def x(_: typing.Optional[collections.namedtuple]): # => def x(_: collections.namedtuple | None):
    ...
```
```
Traceback (most recent call last):
  File "...", line 5, in <module>
    def x(_: collections.namedtuple | None):
             ~~~~~~~~~~~~~~~~~~~~~~~^~~~~~
TypeError: unsupported operand type(s) for |: 'function' and 'NoneType'
```
### Version

ruff 0.12.9 (ef422460d 2025-08-14)

---

_Comment by @johnslavik on 2025-08-17 14:33_

Works as intended.
Use `from __future__ import annotations` on top or set Ruff's target version to less than `py310` to avoid the runtime error. üëç 

---

_Comment by @AlexWaygood on 2025-08-17 15:02_

Yes -- thanks for the report, but I don't think we need to make any changes here. Mypy, pyright, pyrefly and ty all reject `Optional[collections.namedtuple]` as a type annotation, so this is just a case of "garbage in, garbage out". There's an unlimited number of invalid type annotations that might work by accident with `typing.Optional` but fail if you use PEP-604 syntax; it would be infeasible for this lint to attempt to account for all of them.

If there was a type checker that accepted this as a valid type annotation, then that would be a different question -- but there isn't, so I can't see any practical use case for writing this code to begin with, and it seems very unlikely that it would come up in handwritten or generated code.

---

_Closed by @AlexWaygood on 2025-08-17 15:02_

---
