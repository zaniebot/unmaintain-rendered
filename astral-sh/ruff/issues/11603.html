<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C400 unsafe fix is more unsafe than the documentation suggests - astral-sh/ruff #11603</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>C400 unsafe fix is more unsafe than the documentation suggests</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/11603">#11603</a>
        opened by <a href="https://github.com/simonpercivall">@simonpercivall</a>
        on 2024-05-29 20:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/simonpercivall">@simonpercivall</a> on 2024-05-29 20:43</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Ruff 0.45</p>
<p>The C400 unsafe fix says that that it sometimes drops comments. It may also generate broken code:</p>
<p><code>ruff check fix --unsafe-fixes --select C400</code></p>
<pre><code class="language-python">list(
    (1 for _ in range(1))
)
</code></pre>
<p>expected</p>
<pre><code class="language-python">[
    1 for _ in range(1)
]  # [1]
</code></pre>
<p>actual</p>
<pre><code class="language-python">[
    (1 for _ in range(1))
]  # [&lt;generator object &lt;genexpr&gt; at ...&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @AlexWaygood on 2024-05-29 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by @AlexWaygood on 2024-05-29 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-30 00:04</div>
            <div class="timeline-body"><p>üëç Yeah that's a bug (rather than a question of fix safety). Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-05-30 02:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/11607.html">astral-sh/ruff#11607</a> on 2024-05-30 03:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @charliermarsh on 2024-05-30 03:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:12 UTC
    </footer>
</body>
</html>
