<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`unused-function-argument` (`ARG001`) - false positive on pytest `hookspec` functions - astral-sh/ruff #9803</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>`unused-function-argument` (`ARG001`) - false positive on pytest `hookspec` functions</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/9803">#9803</a>
        opened by <a href="https://github.com/DetachHead">@DetachHead</a>
        on 2024-02-02 22:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/DetachHead">@DetachHead</a> on 2024-02-02 22:04</div>
            <div class="timeline-body"><p>in pytest, a new hook function is defined using the <code>hookspec</code> decorator, and the function has no implementation as it's basically like an abstract method:</p>
<pre><code class="language-py">from pytest import hookspec

@hookspec
def pytest_foo(value: int):  # error Unused function argument: `value`
    ...
</code></pre>
<p><a href="https://play.ruff.rs/c8a25959-2278-4072-95ed-9894874dae5e">playground</a></p>
<p>ruff could detect the use of the <code>hookspec</code> decorator and not report the error here.</p>
<p>related:</p>
<ul>
<li>#7286</li>
<li>https://github.com/pytest-dev/pytest/issues/11300</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-02 22:05</div>
            <div class="timeline-body"><p>We should be able to support this. Can you link to any relevant docs on <code>hookspec</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DetachHead">@DetachHead</a> on 2024-02-03 00:25</div>
            <div class="timeline-body"><p>https://docs.pytest.org/en/7.1.x/how-to/writing_hook_functions.html#declaring-new-hooks</p>
<p>a couple things worth noting:</p>
<ul>
<li><p>the <code>hookspec</code> decorator isn't actually required to declare a hook. instead you have to hook <code>pytest_addhooks</code> and register the whole module:</p>
<pre><code class="language-py"># foo/hooks.py
from pytest import hookspec

def pytest_foo(value: int):
    ...
</code></pre>
<pre><code class="language-py"># conftest.py
def pytest_addhooks(pluginmanager):
    from foo import hooks

    pluginmanager.add_hookspecs(hooks)
</code></pre>
<p>as far as i can tell the <code>hookspec</code> decorator is mainly used to specify additional options to individual hooks (so it's not needed if you are just using the default options). however using the decorator without any options like in my original example is perfectly valid, and a good way to let ruff know it's a hookspec without needing multi-file analysis (#7447)</p>
</li>
<li><p>pytest' plugin functionality comes from <a href="https://pluggy.readthedocs.io/en/stable/">pluggy</a>, so ideally ruff would also recognize hookspecs in any project that uses pluggy. however since decorators are defined like this, it would either need multi-file analysis to work, or just assume any decorator called <code>hookspec</code> is a pluggy hook:</p>
<pre><code class="language-py">hookspec = pluggy.HookspecMarker(&quot;myproject&quot;)
hookimpl = pluggy.HookimplMarker(&quot;myproject&quot;)
</code></pre>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-02-05 00:41</div>
            <div class="timeline-body"><p>Assuming it's defined within the same file (which seems common), we <em>could</em> detect that <code>@hookspec</code> resolves to <code>hookspec = HookspecMarker(&quot;...&quot;)</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by @charliermarsh on 2024-02-05 00:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DetachHead">@DetachHead</a> on 2024-02-05 01:38</div>
            <div class="timeline-body"><p>would still require special casing for pytest, since its <code>hookspec</code> decorators are defined in a different file to where they're used in plugins</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10645.html">astral-sh/ruff#10645</a> on 2024-03-28 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../DetachHead/basedpyright/issues/311.html">DetachHead/basedpyright#311</a> on 2024-08-17 08:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../DetachHead/basedpyright/issues/1240.html">DetachHead/basedpyright#1240</a> on 2025-04-20 01:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:11 UTC
    </footer>
</body>
</html>
