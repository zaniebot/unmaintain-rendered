<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formatter: deviation from black: dict key split to multiline - astral-sh/ruff #11857</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Formatter: deviation from black: dict key split to multiline</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11857">#11857</a>
        opened by <a href="https://github.com/minusf">@minusf</a>
        on 2024-06-13 13:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/minusf">@minusf</a></div>
            <div class="timeline-body">

<p>ruff 0.4.8 python 3.10.14 macos 14.5</p>
<pre><code>[tool.ruff]
line-length = 100
</code></pre>
<p>input:</p>
<pre><code>        self.fields[&quot;redirect_link&quot;].help_text = &quot;Please do not use Tiny URLs for links to other www.xxxx.xxx pages.&quot;
</code></pre>
<p>black==24.4.2:</p>
<pre><code>        self.fields[&quot;redirect_link&quot;].help_text = (
            &quot;Please do not use Tiny URLs for links to other www.xxxx.xxx pages.&quot;
        )
</code></pre>
<p>ruff==0.4.8</p>
<pre><code>        self.fields[
            &quot;redirect_link&quot;
        ].help_text = &quot;Please do not use Tiny URLs for links to other www.xxx.xxx pages.&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-06-13 13:03</div>
            <div class="timeline-body"><p>I couldn&#x27;t find this one on the list of known deviations, and this was quite disliked with black IIRC.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-13 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">formatter</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-13 13:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-06-13 13:15</div>
            <div class="timeline-body"><p>also, <code>ruff</code> converted the <code>black</code> output (as well as the <code>input</code>) to the multiline version</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-14 14:39</div>
            <div class="timeline-body"><p>I can confirm that Ruff formats this differently than Black.</p>
<p>Black&#x27;s behavior is more consistent here in that it always tries to break the right first, before breaking the left. Ruff tries to do the same but I think it doesn&#x27;t because of <code>BestFitParanthesize</code>&#x27;s semantic.</p>
<p>Ruff uses <code>BestFitParenthesize</code> for the right side, and the left uses regular groups. The default behavior of the <code>Printer</code> is to prefer breaking right over left, by only testing if what comes after a group contains a line break before exceeding the line width. The problem is, there is no line break according to our current implementation. There&#x27;s an inline comment that I wrote... but I&#x27;m not sure I understand what I meant at that time.</p>
<p>https://github.com/astral-sh/ruff/blob/5806bc915d9a6cd30ce78644b84ff884f26cf841/crates/ruff_formatter/src/printer/mod.rs#L1289-L1291</p>
<p>Unfortunately, my hope that this would be fixed by <a href="https://github.com/astral-sh/ruff/pull/8940">astral-sh/ruff#8940</a> is unjustified. This only changes another small difference.</p>
<p>I&#x27;ll need to take a closer look at this. Ultimately, I think we can only release this in a new minor version because it will break existing formatting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-06-14 14:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/minusf">@minusf</a> on 2024-06-19 20:10</div>
            <div class="timeline-body"><p>thank you for looking into this.  maybe it&#x27;s worth adding it to the list of known deviations?  it is a quite common occurance...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">breaking</span> added by <a href="https://github.com/zanieb">@zanieb</a> on 2024-06-19 21:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:54 UTC
    </footer>
</body>
</html>
