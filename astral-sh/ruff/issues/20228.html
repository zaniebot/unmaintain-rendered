<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indent being trimmed away under my caret - astral-sh/ruff #20228</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Indent being trimmed away under my caret</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/20228">#20228</a>
        opened by <a href="https://github.com/CorentinJ">@CorentinJ</a>
        on 2025-09-04 13:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/CorentinJ">@CorentinJ</a> on 2025-09-04 13:02</div>
            <div class="timeline-body"><h3>Question</h3>
<p>I'm confused by this behaviour I'm seeing from ruff in that I doubt it must be the normal experience with it given how it impedes my development</p>
<p>I believe it is <a href="https://docs.astral.sh/ruff/rules/blank-line-with-whitespace/">W293</a> that is causing me troubles. In VSCode, ruff seems to format my document on every keystroke, and even when idling. Say I am writing code in this function:</p>
<pre><code>def my_func(x):
••••a = x + 2
••••|             &lt;---- my caret
••••b = a ** 2    
</code></pre>
<p>With whitespace represented by &quot;•&quot;.
If ruff triggers at this point (and it usually will), the whitespace will be trimmed like so:</p>
<pre><code>def my_func(x):
••••a = x + 2
|                 &lt;---- my caret
••••b = a ** 2    
</code></pre>
<p>Forcing me to re-indent, and if I'm not quick enough with typing any code, ruff will erase it again. I've checked the related issue #12488, with no answer to help me deal with this problem.
Beyond trying to solve the issue I'm also confused as to why there aren't more users reporting it. I played with my vscode and ruff settings but this looks like the normal behaviour, which frankly surprises me</p>
<h3>Version</h3>
<p>extension version 2025.24.0 shipped with ruff version==0.12.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @CorentinJ on 2025-09-04 13:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 13:10</div>
            <div class="timeline-body"><p>Do you have <a href="https://code.visualstudio.com/docs/editing/codebasics#_formatting"><code>formatOnType</code></a> enabled in VS Code? I don't think this is the default behavior. It does sound very disruptive, as you said.</p>
<p>This shouldn't be directly related to W293, which is a lint rule rather than a part of the formatter, unless you're also applying fixes from the linter on each keystroke. You would also have had to explicitly enable W293 as a lint rule since it's off by default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CorentinJ">@CorentinJ</a> on 2025-09-04 17:57</div>
            <div class="timeline-body"><p>I don't have <code>editor.formatOnType</code> but I do have <code>editor.formatOnPaste</code> and <code>editor.formatOnSave</code> enabled, and checking now by disabling them it does seem that they trigger more often than they should. I disabled them and now the formatting does no longer occur randomly. Thank you for that.</p>
<p>Would it still be possible to not make ruff trim these whitespaces upon formatting? I assume it is ruff doing this, as the behaviour stops when I disable it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-09-04 20:10</div>
            <div class="timeline-body"><p>Interesting, maybe @dhruvmanila would have more ideas about settings to explore. Just based on the names, I wouldn't expect <code>formatOnPaste</code> or <code>formatOnSave</code> to be causing this.</p>
<p>I don't think this is something we'd want to remove from the formatter in general. Hopefully we can pinpoint the behavior in VS Code because I don't think this is the typical editor experience.</p>
<p>I just tried this in my own VS Code setup, and I'm not seeing this behavior unless I manually save. I actually have <code>editor.formatOnType</code> enabled but haven't experienced this before.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2025-09-05 08:33</div>
            <div class="timeline-body"><p>Can you provide the VS Code settings that you've set? That would help us figure out what might be causing this.</p>
<p>As you've set <code>editor.formatOnSave</code>, one possibility could be that you might've set <code>files.autoSave</code> in such a way that it automatically saves the file after a certain delay of inactivity.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CorentinJ">@CorentinJ</a> on 2025-09-07 05:11</div>
            <div class="timeline-body"><p>You're right thank you, I have <code>&quot;files.autoSave&quot;: &quot;onFocusChange&quot;</code> which is where this &quot;random saving&quot; (and thus reformatting of the file) is coming from.</p>
<p>Considering there is no plan to support disabling the ident trimming on blank lines, I'll mark this as closed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @CorentinJ on 2025-09-07 05:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
