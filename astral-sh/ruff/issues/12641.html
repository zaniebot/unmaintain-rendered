<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix for Q003 can create an erroneous multiline string - astral-sh/ruff #12641</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fix for Q003 can create an erroneous multiline string</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/12641">#12641</a>
        opened by <a href="https://github.com/dscorbett">@dscorbett</a>
        on 2024-08-02 18:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dscorbett">@dscorbett</a></div>
            <div class="timeline-body"><p>The automated fix for <a href="https://docs.astral.sh/ruff/rules/avoidable-escaped-quote/">Q003</a> can introduce a syntax error or change behavior.</p>
<p>It can introduce a syntax error when the affected string immediately follows an empty string with the opposite kind of quotation marks. The fix makes the three adjacent quotation marks be reinterpreted as the start of a multiline string. If the multiline string is not terminated, that is a syntax error.</p>
<pre><code>$ ruff --version
ruff 0.5.6
$ cat q003.py
print(&#x27;&#x27;&quot;\&quot;&quot;)
$ ruff check --isolated --select Q003 q003.py --fix

error: Fix introduced a syntax error. Reverting all changes.

This indicates a bug in Ruff. If you could open an issue at:

    https://github.com/astral-sh/ruff/issues/new?title=%5BFix%20error%5D

...quoting the contents of `q003.py`, the rule codes Q003, along with the `pyproject.toml` settings and executed command, we&#x27;d be very appreciative!

q003.py:1:9: Q003 Change outer quotes to avoid escaping inner quotes
  |
1 | print(&#x27;&#x27;&quot;\&quot;&quot;)
  |         ^^^^ Q003
  |
  = help: Change outer quotes to avoid escaping inner quotes

Found 1 error.
[*] 1 fixable with the `--fix` option.
</code></pre>
<p>If the multiline string introduced by the fix is terminated, the behavior of the program can change.</p>
<pre><code>$ cat q003.py
print(&#x27;&#x27;&quot;\&quot;&quot;&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;)  # &#x27;&#x27;&#x27;)
$ python q003.py
&quot;
$ ruff check --isolated --select Q003 q003.py --fix
Found 1 error (1 fixed, 0 remaining).
$ python q003.py
&quot;&#x27;)  # 
</code></pre>
<p>The fix should insert a space before the modified string, if it is necessary based on the previous token.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 21:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">fixes</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 21:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> removed by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-08-02 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2024-08-03 12:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:56 UTC
    </footer>
</body>
</html>
