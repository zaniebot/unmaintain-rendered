<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Include some of the checks from flake8-literal - astral-sh/ruff #8616</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Include some of the checks from flake8-literal</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/8616">#8616</a>
        opened by <a href="https://github.com/ThiefMaster">@ThiefMaster</a>
        on 2023-11-11 13:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ThiefMaster">@ThiefMaster</a></div>
            <div class="timeline-body"><p>This plugin is quite similar than <code>flake8-quotes</code>, but it contains some nice checks such as warning about unnecessary quote escapes, e.g. <code>&#x27;foo\&quot;bar&#x27;</code> (which, in fact, are created by ruff&#x27;s fixer - I&#x27;ve opened a separate issue about this: #8617).</p>
<p><code>.flake8</code> config:</p>
<pre><code>[flake8]
inline-quotes = single
multiline-quotes = single
docstring-quotes = double
avoid-escape = true

literal-inline-quotes = single
literal-multiline-quotes = single
literal-docstring-quotes = double
literal-avoid-escape = true
</code></pre>
<p><code>ruff.toml</code> config</p>
<pre><code>select = [&#x27;F&#x27;, &#x27;E&#x27;, &#x27;W&#x27;, &#x27;Q&#x27;, &#x27;RUF&#x27;, &#x27;SIM&#x27;]
preview = true

[flake8-quotes]
inline-quotes = &#x27;single&#x27;
multiline-quotes = &#x27;single&#x27;
docstring-quotes = &#x27;double&#x27;
avoid-escape = true
</code></pre>
<p>Python code:</p>
<pre><code>a = &#x27;hello&#x27;
b = &quot;world&quot;

c = &#x27;&#x27;&#x27;foo&#x27;&#x27;&#x27;
d = &quot;&quot;&quot;bar&quot;&quot;&quot;

e = &#x27;check \&#x27;this\&#x27;&#x27;
f = &quot;check &#x27;that&#x27;&quot;
g = &#x27;check \&#x27;this\&#x27; &quot;and that&quot; \&#x27;and this\&#x27;&#x27;
h = &quot;check \&quot;this\&quot; &#x27;and that&#x27; \&quot;and this\&quot;&quot;

i = &quot;foo\&#x27;bar&quot;
j = &#x27;foo\&quot;bar&#x27;


def foo():
    &#x27;&#x27;&#x27;doc&#x27;&#x27;&#x27;


def bar():
    &quot;&quot;&quot;doc&quot;&quot;&quot;
</code></pre>
<p>flake8 output:</p>
<pre><code>[adrian@claptrap:/tmp/rufftest]&gt; flake8 test.py
test.py:2:5: Q000 Double quotes found but single quotes preferred
test.py:2:5: LIT001 Use single quotes for string

test.py:5:5: Q001 Double quote multiline found but single quotes preferred
test.py:5:5: LIT003 Use single quotes for multiline string

test.py:7:5: Q003 Change outer quotes to avoid escaping inner quotes
test.py:7:5: LIT011 Use double quotes for string to avoid escaped single quote

test.py:10:5: LIT001 Use single quotes for string

test.py:12:5: LIT013 Escaped single quote is not necessary

test.py:13:5: LIT014 Escaped double quote is not necessary

test.py:17:5: Q002 Single quote docstring found but double quotes preferred
test.py:17:5: LIT006 Use double quotes for docstring
</code></pre>
<p>ruff output (built from latest master):</p>
<pre><code>[adrian@claptrap:/tmp/rufftest]&gt; ~/dev/ruff/target/release/ruff check --no-cache /tmp/rufftest/test.py
test.py:2:5: Q000 [*] Double quotes found but single quotes preferred
test.py:5:5: Q001 [*] Double quote multiline found but single quotes preferred
test.py:7:5: Q003 [*] Change outer quotes to avoid escaping inner quotes
test.py:17:5: Q002 [*] Single quote docstring found but double quotes preferred
Found 4 errors.
[*] 4 fixable with the `--fix` option.
</code></pre>
<p>In particular it would be nice if anything related to avoid escaping would actually pick the quote style to ensure the least amount of escapes (in case the string contains both types of quotes). Maybe even consider switching to a triple-quoted string, but maybe that&#x27;s a bit more controversial and should be configurable...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-11 14:56</div>
            <div class="timeline-body"><p>My first impression is that some of these feel redundant with existing rules, e.g., &quot;Use double quotes for docstring&quot; exists in the <code>D</code> rule set. The one I could imagine including is the unnecessary escape rule. We have <code>W605</code> which checks for <em>invalid</em> escapes, but not <em>unnecessary</em> escapes.</p>
<p>I do consider this low priority since the formatter already performs this normalization and removes unnecessary escapes, but I&#x27;d accept a contribution for such a rule in the `Q set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rule</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-11 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wish</span> added by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-11 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-14 04:36</div>
            <div class="timeline-body"><p>@ThiefMaster - Anything else you want to include here, or is the string-escaping sufficient to close?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ThiefMaster">@ThiefMaster</a> on 2023-11-14 08:56</div>
            <div class="timeline-body"><p>That was the main one I was interested in. These ones at least sound interesting:</p>
<ul>
<li>LIT015 - Use double quotes for continuation strings to match</li>
<li>LIT016 - Use single quotes for continuation strings to match</li>
</ul>
<p>This code currently triggers a warning in flake8-quotes but not in ruff (with single-quote preference):</p>
<pre><code>foo = (
    &quot;i&#x27;m&quot;
    &quot;really&quot;  # &lt;-- does not need double quotes
    &#x27;cool&#x27;
)
</code></pre>
<p>But probably this could be a setting that affects the existing Q000 rule (whether consistency for continuation strings should be preferred, avoided or ignored).</p>
<hr>
<ul>
<li>LIT101 - Remove raw prefix when not using escapes</li>
<li>LIT102 - Use raw prefix to avoid escaped slash</li>
</ul>
<p>There are no rules for this yet. Could be a nice one to add.</p>
<hr>
<ul>
<li>LIT103 - Use raw prefix for re pattern</li>
</ul>
<p>There is no rule for this one yet. It&#x27;s pretty common to always use raw strings for regexps regardless whether there are any escapes in it or not (but it&#x27;s particularly useful when there are escapes!), so at least for those passed directly as literals to the various functions from the <code>re</code> module a warning could be shown (probably not worth trying to track variables when the regex string is first assigned to a variable and that variable gets passed to one of these functions, unless there&#x27;s already functionality for such logic making it simple to do as well).</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:45 UTC
    </footer>
</body>
</html>
