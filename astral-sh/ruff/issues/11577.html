<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ignore D412 (`blank-lines-between-header-and-content`)  if a reStructuredText directive follows a section header - astral-sh/ruff #11577</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ignore D412 (<code>blank-lines-between-header-and-content</code>)  if a reStructuredText directive follows a section header</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/astral-sh/ruff/issues/11577">#11577</a>
        opened by <a href="https://github.com/harupy">@harupy</a>
        on 2024-05-28 05:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/harupy">@harupy</a> on 2024-05-28 05:40</div>
            <div class="timeline-body"><!--
Thank you for taking the time to report an issue! We're glad to have you involved with Ruff.

If you're filing a bug report, please consider including the following information:

* List of keywords you searched for before creating this issue. Write them down here so that others can find this issue more easily and help provide feedback.
  e.g. "RUF001", "unused variable", "Jupyter notebook"
* A minimal code snippet that reproduces the bug.
* The command you invoked (e.g., `ruff /path/to/file.py --fix`), ideally including the `--isolated` flag.
* The current Ruff settings (any relevant sections from your `pyproject.toml`).
* The current Ruff version (`ruff --version`).
-->

<p>Originally found in https://github.com/pytest-dev/pytest/pull/12375 where I was trying to fix pytest's API reference. The following code violates <code>D412</code>, but sphinx doesn't render the docstring correctly if the blank line after <code>Example:</code> is removed.</p>
<pre><code class="language-python"># violates D412

def f():
    &quot;&quot;&quot;
    Example:

    .. code-block:: python

        import foo
    &quot;&quot;&quot;
</code></pre>
<p>Autofixed code:</p>
<pre><code class="language-python"># doesn't violate D412, but sphinx fails to render correctly

def f():
    &quot;&quot;&quot;
    Example:
    .. code-block:: python

        import foo
    &quot;&quot;&quot;
</code></pre>
<p><img src="https://github.com/astral-sh/ruff/assets/17039389/03c5b34c-7969-4e27-b78d-ecd97b188017" alt="image" /></p>
<p>Repro on playground: https://play.ruff.rs/b4c94827-8503-4568-978d-59e74a31a01b</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-05-28 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">docstring</span> added by @charliermarsh on 2024-05-28 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-05-28 15:43</div>
            <div class="timeline-body"><p>We could disable <code>D412</code> enforcement when followed by a Sphinx code block?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/harupy">@harupy</a> on 2024-05-29 02:26</div>
            <div class="timeline-body"><p>@charliermarsh Thanks for the comment! I think any directive can cause the same issue. For example:</p>
<pre><code class="language-python">def f():
    &quot;&quot;&quot;
    Example:
    .. note::

        This example only works on windows.

    .. code-block:: python

        import foo
    &quot;&quot;&quot;
</code></pre>
<hr />
<p>update: tested this:</p>
<img width="687" alt="image" src="https://github.com/astral-sh/ruff/assets/17039389/9ecd7938-aeb6-4c92-b666-9353881a008b">

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2024-05-30 04:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dhruvmanila">@dhruvmanila</a> on 2024-06-03 11:31</div>
            <div class="timeline-body"><p>I think this is resolved by #11609, @charliermarsh feel free to re-open if it's not complete.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dhruvmanila on 2024-06-03 11:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:34:00 UTC
    </footer>
</body>
</html>
