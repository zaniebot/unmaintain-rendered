<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[`isort-I001`] Discrepancy between local ruff and GitHub action - astral-sh/ruff #18647</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>[`isort-I001`] Discrepancy between local ruff and GitHub action</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/18647">#18647</a>
        opened by <a href="https://github.com/gstrauss-zscaler">@gstrauss-zscaler</a>
        on 2025-06-12 13:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gstrauss-zscaler">@gstrauss-zscaler</a> on 2025-06-12 13:56</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Hey,
We currently have ruff as pre-commit hook for our project.
We inserted a GitHub Action to automate lint checking upon pull request</p>
<p>Although running <code>ruff check</code> and <code>ruff check --select I001</code> return <code>All checks passed!</code>
The GitHub Step fails on some files, with <code>I001 Import block is un-sorted or un-formatted</code>
I even tried to run <code>isort &lt;FILE_NAME&gt;</code> and it passes as well
We are latest version (<code>ruff 0.11.13 (5faf72a4d 2025-06-05)</code>)
I don't know how to solve this, is it some issue with the fact that we are running locally with macOS but GitHub Actions runs with linux?</p>
<pre><code class="language-toml">line-length = 120
target-version = &quot;py312&quot;

[lint]
select = [
    &quot;ALL&quot;, # include all the rules, including new ones
]
ignore = [
    &quot;FIX002&quot;,
    &quot;TD003&quot;,
    &quot;TD002&quot;,
    &quot;D104&quot;,
    &quot;D101&quot;,
    &quot;D102&quot;,
    &quot;D205&quot;,
    &quot;D401&quot;,
    &quot;D100&quot;,
    &quot;D103&quot;,
    &quot;RUF006&quot;,
    &quot;A002&quot;,
    &quot;D203&quot;,
    &quot;D213&quot;,
    &quot;COM812&quot;,
    &quot;D400&quot;,
    &quot;D415&quot;,
    &quot;D107&quot;,
]
[lint.per-file-ignores]
    &quot;tests/*&quot; = [&quot;S101&quot;, &quot;FBT001&quot;]
</code></pre>
<p>This is the step</p>
<pre><code class="language-yaml">  - uses: astral-sh/ruff-action@v3
</code></pre>
<h3>Version</h3>
<p>ruff 0.11.13 (5faf72a4d 2025-06-05)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ntBre">@ntBre</a> on 2025-06-12 14:11</div>
            <div class="timeline-body"><p>This sounds related to https://github.com/astral-sh/ruff-pre-commit/issues/121. Do you happen to have a local directory with the same name as one of your dependencies that is not present in CI? I think that can cause the isort rules to miscategorize the imports and cause formatting differences.</p>
<p>If so this could be a duplicate of https://github.com/astral-sh/ruff/issues/10519</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Discrepancy between local ruff and GitHub action" to "[isort-I001] Discrepancy between local ruff and GitHub action" by @gstrauss-zscaler on 2025-06-12 14:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[isort-I001] Discrepancy between local ruff and GitHub action" to "[`isort-I001`] Discrepancy between local ruff and GitHub action" by @gstrauss-zscaler on 2025-06-12 14:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gstrauss-zscaler">@gstrauss-zscaler</a> on 2025-06-12 14:18</div>
            <div class="timeline-body"><blockquote>
<p>This sounds related to <a href="https://github.com/astral-sh/ruff-pre-commit/issues/121">astral-sh/ruff-pre-commit#121</a>. Do you happen to have a local directory with the same name as one of your dependencies that is not present in CI? I think that can cause the isort rules to miscategorize the imports and cause formatting differences.</p>
<p>If so this could be a duplicate of <a href="https://github.com/astral-sh/ruff/issues/10519">#10519</a></p>
</blockquote>
<p>Thanks for the quick reply,
I am not sure, from a quick look I don't see anything like this. But how can I check?
So, if I am running <code>uv sync</code> and then manually running <code>ruff check</code> in the ci/cd. It should fix the error?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-06-12 14:32</div>
            <div class="timeline-body"><p>Could you share a minified file that gets changed in CI. E.g how does the ordering differ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-info</span> added by @MichaReiser on 2025-06-12 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-06-12 15:57</div>
            <div class="timeline-body"><p>If it's not too difficult to do, you might try running both locally and in CI in verbose mode once (maybe even hack it to only run on a specific file where the issue occurs), like this:</p>
<pre><code class="language-console">ruff check --select I001 -v path/to/problematic/file.py
</code></pre>
<p>This should print out Ruff's decision about how to categorize each of the imports and the reason behind the categorization.</p>
<p><code>isort</code> also offers a verbose mode, so you could print out both to see where Ruff is making a different categorization.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gstrauss-zscaler">@gstrauss-zscaler</a> on 2025-06-15 07:50</div>
            <div class="timeline-body"><p>Thanks everyone, found the issue
We are using protobuf and we only generate the python files in the dockerfile.
So ruff is thinking it's a third package, while it's not</p>
<p>Added this to my ruff.toml</p>
<pre><code class="language-toml">[lint.isort]
# Our own generated protobuf
known-first-party = [&quot;protobuf&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @gstrauss-zscaler on 2025-06-15 07:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/brownterryn">@brownterryn</a> on 2025-06-18 20:16</div>
            <div class="timeline-body"><p>Or if you're putting it in <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[tool.ruff.lint.isort]
# Our own generated protobuf
known-first-party = [&quot;protobuf&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/19684.html">astral-sh/ruff#19684</a> on 2025-08-01 13:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/ruff-pre-commit/issues/135.html">astral-sh/ruff-pre-commit#135</a> on 2025-09-15 16:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../linkml/linkml/pulls/2952.html">linkml/linkml#2952</a> on 2025-12-03 00:44</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:16 UTC
    </footer>
</body>
</html>
