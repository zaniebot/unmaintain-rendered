<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive with PLE4703 and immediate return / break - astral-sh/ruff #10721</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive with PLE4703 and immediate return / break</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ruff/issues/10721">#10721</a>
        opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a>
        on 2024-04-01 18:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/hauntsaninja">@hauntsaninja</a> on 2024-04-01 18:05</div>
            <div class="timeline-body"><p>Not the biggest deal, but I got a false positive on this with:</p>
<pre><code>λ cat x.py
def foo():
    s = {1, 2, 3}
    for e in s:
        if e &gt;= 3:
            s.remove(e)
            return

λ ruff check --select PLE x.py --preview 
x.py:3:5: PLE4703 Iterated set `s` is modified within the `for` loop
  |
1 |   def foo():
2 |       s = {1, 2, 3}
3 |       for e in s:
  |  _____^
4 | |         if e &gt;= 3:
5 | |             s.remove(e)
6 | |             return
  | |__________________^ PLE4703
  |
  = help: Iterate over a copy of `s`

Found 1 error.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
</code></pre>
<p>cc @boolean-light in case you're interested, and thanks for the new rule :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @charliermarsh on 2024-04-01 18:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">preview</span> added by @charliermarsh on 2024-04-01 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 18:18</div>
            <div class="timeline-body"><p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2024-04-01 18:20</div>
            <div class="timeline-body"><p>Struggling not to get sniped into fixing this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-02 09:11</div>
            <div class="timeline-body"><p>Hmm that makes sense. It would be nice to use the control flow graph for this because I assume there are other situations where the loop exits early (<code>continue</code>, <code>break</code>, <code>raise</code> etc) that aren't covered and they might be more subtle.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hikaru-kajita">@hikaru-kajita</a> on 2024-04-03 06:51</div>
            <div class="timeline-body"><p>Excuse me I'm back :D Thank you, and let me have a look on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hikaru-kajita">@hikaru-kajita</a> on 2024-04-08 02:32</div>
            <div class="timeline-body"><p>Sorry, actually I don't think I can implement this one by myself. Is there some kind of support for control flow group in Ruff already?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2024-04-08 06:36</div>
            <div class="timeline-body"><p>No, there's not. That's what I meant by my comment. We probably want to wait for a more complete control flow analysis or decided to only support a very small subset of control flow patterns for now.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:33:22 UTC
    </footer>
</body>
</html>
