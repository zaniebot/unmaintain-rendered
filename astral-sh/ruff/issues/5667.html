<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I001: ruff isort does not always respect the global src option - astral-sh/ruff #5667</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>I001: ruff isort does not always respect the global src option</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/astral-sh/ruff/issues/5667">#5667</a>
        opened by <a href="https://github.com/saippuakauppias">@saippuakauppias</a>
        on 2023-07-10 23:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/saippuakauppias">@saippuakauppias</a> on 2023-07-10 23:08</div>
            <div class="timeline-body"><p>I have a slightly odd bug that I don't understand how to fix yet. In a large project (django-service), there is a <code>statistics</code> application that overrides an builtin module with the same name.</p>
<p>When I run linter with rule <code>I001</code> - it offers to fix the imports so that imports from <code>statistics</code> go to the top (imports from the standard library). That is, the rule settings do not always take into account what is specified in <code>[tool.ruff].src</code>. And on the project this is the only case with incorrect processing, everything else works properly (I do not have separate settings for the linter isort in <code>pyproject.toml</code>).</p>
<p>What it looks like:
<img width="235" alt="image" src="https://github.com/astral-sh/ruff/assets/945306/3521edb2-817c-4e91-88f3-6cc504fce1ae"></p>
<p>I use ruff 0.0.270.</p>
<h3>File contents:</h3>
<p><em>pyproject.toml</em></p>
<pre><code class="language-toml">[tool.ruff]
target-version = &quot;py311&quot;
src = [&quot;src&quot;]
</code></pre>
<p><em>src/foobar/bar.py</em></p>
<pre><code class="language-python">class B:
    ...
</code></pre>
<p><em>src/foobar/baz.py</em></p>
<pre><code class="language-python">from logging import getLogger

from foobar.baz import B
from statistics.some import A

logger = getLogger('stream.logger')


a = A()
b = B()
logger.info('%s %s', a, b)
</code></pre>
<p><em>src/statistics/some.py</em></p>
<pre><code class="language-python">class A:
    ...
</code></pre>
<h3>If I run linter, it will</h3>
<pre><code class="language-shell">ruff --config=pyproject.toml src --select=I001
src/foobar/baz.py:1:1: I001 [*] Import block is un-sorted or un-formatted
Found 1 error.
[*] 1 potentially fixable with the --fix option.
</code></pre>
<h3>If I run linter with autocorrect, it will change the file <code>src/foobar/baz.py</code> as follows</h3>
<pre><code class="language-python">from logging import getLogger
from statistics.some import A

from foobar.baz import B

logger = getLogger('stream.logger')


a = A()
b = B()
logger.info('%s %s', a, b)
</code></pre>
<hr />
<p>Changing the application name is very problematic as it would entail a lot of refactoring. I would like the linter to take into account the settings from <code>[tool.ruff].src</code> (taking the list of packages from the directories that are listed there) and handle this case correctly. Or I would be grateful for your advice on how to fix it in the most painless way.</p>
<p>PS: yes, I realize that such an application name makes it inadmissible to import functions from the standard library, but specifically in my case - it seems that it can be neglected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-07-10 23:12</div>
            <div class="timeline-body"><p>I suspect we’re just checking if a module is in the standard library prior to checking if it’s available locally. I need to look at how other projects treat this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/saippuakauppias">@saippuakauppias</a> on 2023-07-10 23:21</div>
            <div class="timeline-body"><p>If anything - I've noticed this incorrect behavior in PyCharm.</p>
<p>In PyCharm I use imports sorting when applying the &quot;Optimize imports&quot; action. In the IDE I have</p>
<ul>
<li><p>&quot;Source folders&quot; are set correctly (Preferences -&gt; Project -&gt; Project Structure) - the &quot;src&quot; directory from my example is selected as &quot;Source folders&quot;.</p>
</li>
<li><p>I have these imports settings (Preferences -&gt; Editor -&gt; Code Style -&gt; Python -&gt; Imports):
<img width="679" alt="image" src="https://github.com/astral-sh/ruff/assets/945306/d51400eb-fc1d-40bf-83fb-9705967cdfe4"></p>
</li>
<li><p>And I have these settings (Preferences -&gt; Editor -&gt; Code Style -&gt; Python -&gt; Wrapping and Braces):
<img width="679" alt="image" src="https://github.com/astral-sh/ruff/assets/945306/3c776e37-8550-4437-b72a-b433b879da8d"></p>
</li>
</ul>
<p>I would be very grateful if you could help figure out how to solve this or fix the behavior in linter (thank you for such a quick response, once again I'm amazed how you always keep things under control!).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/saippuakauppias">@saippuakauppias</a> on 2023-07-11 08:22</div>
            <div class="timeline-body"><p>I meant that in PyCharm imports are sorted correctly (package <code>statistics</code> is not in the imports of the standard library, but in the imports block of the project).</p>
<p>Simply if I use &quot;Optimize Imports&quot; in PyCharm - after that ruff breaks, sorting of imports between them is not compatible in terms of the location of this package.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @charliermarsh by @charliermarsh on 2023-07-11 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">isort</span> added by @charliermarsh on 2023-07-11 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">needs-decision</span> added by @charliermarsh on 2023-07-11 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Stealthii">@Stealthii</a> on 2023-11-02 23:18</div>
            <div class="timeline-body"><p>This can be easily demonstrated with a namespaced package where the name masks a globally available package:</p>
<pre><code class="language-python">### mycompany/myproject/httpx/__init__.py

import httpx  # Treated as an internal import with ruff isort rules
</code></pre>
<p>The upstream <code>isort</code> tool does not exhibit this behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/charliermarsh">@charliermarsh</a> on 2023-11-02 23:28</div>
            <div class="timeline-body"><p>Whether or not that example is correct depends on your configuration and the overall structure of the project. Can you share your configuration? Why would httpx not be considered a first-party import there?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Stealthii">@Stealthii</a> on 2023-11-03 00:15</div>
            <div class="timeline-body"><p>You're right. In that example, under default configuration, ruff is considering the package as &quot;httpx&quot;, as namespace packages haven't been configured or defined in ruff config.</p>
<p>There's two options for avoiding httpx being treated as a first-party import in this case:</p>
<pre><code class="language-toml">[tool.ruff.isort]
# stop automatically marking imports from within the same package as first-party (masking the issue)
detect-same-package = false
</code></pre>
<pre><code class="language-toml">[tool.ruff]
# Mark the directory as a namespace package
namespace-packages = [&quot;mycompany/myproject/httpx&quot;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/10266.html">astral-sh/ruff#10266</a> on 2024-03-07 06:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ImperialCollegeLondon/SWMManywhere/pulls/295.html">ImperialCollegeLondon/SWMManywhere#295</a> on 2024-09-25 14:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/souliane">@souliane</a> on 2024-10-08 11:54</div>
            <div class="timeline-body"><p>I had a similar issue where my <code>tests</code> module was considered third party when running on GitLab CI [1].
<code>tests</code> is already listed in the <code>src</code> option.</p>
<p>I didn't manage to fix it with <code>detect-same-package</code> or <code>namespace-packages</code>, but using <a href="https://docs.astral.sh/ruff/settings/#lint_isort_known-first-party">known-first-party</a>.</p>
<p>[1] On my local machine, with the same ruff version and a clean env, I was not able to reproduce... I didn't find any explanation, but this is more likely not a ruff issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:09 UTC
    </footer>
</body>
</html>
