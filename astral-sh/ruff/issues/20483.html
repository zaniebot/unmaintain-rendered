<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I001 import sorting rule behaves differently in CI vs local with identical files and config - astral-sh/ruff #20483</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>I001 import sorting rule behaves differently in CI vs local with identical files and config</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/astral-sh/ruff/issues/20483">#20483</a>
        opened by <a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a>
        on 2025-09-19 13:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ReinforcedKnowledge">@ReinforcedKnowledge</a> on 2025-09-19 13:59</div>
            <div class="timeline-body"><h3>Question</h3>
<h2>Bug Description</h2>
<p>The I001 import sorting rule produces different results between local development and CI environments, despite identical file content, ruff version, and configuration.</p>
<h2>Environment</h2>
<ul>
<li><strong>Ruff version</strong>: 0.11.7</li>
<li><strong>Python version</strong>: 3.12.11</li>
<li><strong>Local OS</strong>: Linux</li>
<li><strong>CI</strong>: GitHub Actions (Linux)</li>
</ul>
<h2>Expected Behavior</h2>
<p>Ruff should produce consistent results across environments when file content, version, and configuration are identical.</p>
<h2>Actual Behavior</h2>
<ul>
<li><strong>Local</strong>: <code>ruff check testing_ci.py</code> → All checks passed!</li>
<li><strong>CI</strong>: <code>ruff check testing_ci.py</code> → I001 Import block is un-sorted or un-formatted</li>
</ul>
<h3>Code Sample</h3>
<pre><code class="language-python">try:
    import pandas as pd

    import wandb
    from wandb.errors import CommError
except ImportError as e:
    raise 
</code></pre>
<h3>CI Configuration</h3>
<pre><code class="language-yaml">- name: Run code quality checks on changed files
  if: steps.changed-files.outputs.any_changed == 'true'
  run: |
    echo &quot;Changed files: ${{ steps.changed-files.outputs.all_changed_files }}&quot;

    # Format changed files
    uv run ruff format ${{ steps.changed-files.outputs.all_changed_files }}

    # Check changed files
    uv run ruff check ${{ steps.changed-files.outputs.all_changed_files }}
</code></pre>
<h3>CI error</h3>
<p>That leads in CI to:</p>
<pre><code>testing_ci.py:2:5: I001 [*] Import block is un-sorted or un-formatted
  |
1 |   try:
2 | /     import pandas as pd
3 | |
4 | |     import wandb
5 | |     from wandb.errors import CommError
  | |______________________________________^ I001
6 |   except ImportError as e:
7 |       raise
  |
  = help: Organize imports
</code></pre>
<h2>Notes:</h2>
<ul>
<li>File hash identical between environments</li>
<li>Same <code>ruff</code> version: 0.11.7</li>
<li>Same <code>pyproject.toml</code> config</li>
<li>Same Python version: 3.12.11</li>
</ul>
<p>The imports appear to follow standard sorting conventions (stdlib imports separated from third-party), but CI consistently flags this as unsorted while local passes.</p>
<p><strong>Questions</strong>:</p>
<ol>
<li>Are there any environment-specific factors that could cause I001 to behave differently?</li>
<li>Could this be related to how <code>ruff</code> processes files within <code>try/except</code> blocks?</li>
<li>Are there any debug flags to understand why <code>ruff</code> considers these imports unsorted?</li>
</ol>
<h3>Version</h3>
<p>ruff 0.11.7</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @ReinforcedKnowledge on 2025-09-19 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dylwil3">@dylwil3</a> on 2025-09-19 14:03</div>
            <div class="timeline-body"><p>Thanks for the report! What's happening here is that there is a <code>wandb</code> folder within your <code>src</code> folder present in one of these situations but not the other. This creates an implicit namespace package which is treated as first-party and so sorted differently. A solution is to add this to your <code>pyproject.toml</code>:</p>
<pre><code class="language-toml">[tool.ruff.linter.isort]
known-third-party = [&quot;wandb&quot;]
</code></pre>
<p>We are working on including <code>wandb</code> as a default known third party since this happens quite a bit!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @dylwil3 on 2025-09-19 14:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:34:55 UTC
    </footer>
</body>
</html>
